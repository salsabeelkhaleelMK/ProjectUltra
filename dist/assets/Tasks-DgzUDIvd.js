import{d as m,o as a,F as _,i as ee,n as F,e,_ as Fe,r as S,g as O,m as P,w as me,z as H,A as E,T as Ye,c as q,B as ae,t as $,C as Z,D as ce,E as Ve,G as J,q as B,u as Oe,l as De,p as Y,H as re,k as U,I as Ke,J as rt,K as Re,j as ze,h as Me,y as Ue,L as Ge,M as qe,N as dt,O as pe,P as ut,Q as Ne,R as ct,S as pt,U as mt}from"./index-Baowk8yV.js";import{u as Be}from"./opportunities-DeYk_9MS.js";import{u as je}from"./users-CllAH7OS.js";import{Q as he,i as Le}from"./index-C1tcDFBl.js";import{_ as yt}from"./PageHeader-K4h7Nky0.js";import{y as gt}from"./components-j1JUk8PC.js";import{_ as vt,g as ft,a as bt,b as xt,i as ht,c as wt,d as kt,e as Ct,f as He}from"./ComingSoonModal-BmCgT_UL.js";import{f as Ae,a as Te,g as Je,b as Xe,c as $t}from"./formatters-E4EQSCf9.js";import{_ as ye}from"./ModalShell-DcQqocRS.js";import{_ as St}from"./CreateEventModal-ClRjWvQH.js";import{_ as At,a as Dt}from"./EditEventModal-B3m86Z4F.js";import{_ as Tt}from"./ReassignUserModal-BR__nY6Q.js";import"./index-Ct-3v9pQ-DjTMGHGd.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-N-LQGDgb.js";const Ot={class:"flex bg-gray-100 p-1 rounded-lg w-fit"},It=["onClick"],Ze={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:o=>o.every(D=>D.value&&D.icon&&D.label)}},emits:["update:view"],setup(o){return(D,t)=>(a(),m("div",Ot,[(a(!0),m(_,null,ee(o.options,i=>(a(),m("button",{key:i.value,onClick:w=>D.$emit("update:view",i.value),class:F(["p-1.5 rounded-md transition-all duration-200",o.view===i.value?"bg-white shadow-sm text-gray-900":"text-gray-400 hover:text-gray-600"])},[e("i",{class:F([i.icon,"text-base"])},null,2)],10,It))),128))]))}},qt={class:"flex items-center gap-2"},Nt={key:0,class:"flex gap-2"},Vt={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},Rt={key:0,class:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Lt={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0}},emits:["filter-change","sort-change"],setup(o,{emit:D}){const t=D,i=S(!1),w=()=>{i.value=!i.value},u=y=>{i.value=!1,t("sort-change",y)},x={mounted(y,k){y.clickOutsideEvent=f=>{y===f.target||y.contains(f.target)||k.value(f)},document.addEventListener("click",y.clickOutsideEvent)},unmounted(y){document.removeEventListener("click",y.clickOutsideEvent)}};return(y,k)=>(a(),m("div",qt,[o.showTypeFilter?(a(),m("div",Nt,[e("button",{onClick:k[0]||(k[0]=f=>y.$emit("filter-change","all")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:k[1]||(k[1]=f=>y.$emit("filter-change","lead")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:k[2]||(k[2]=f=>y.$emit("filter-change","opportunity")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):O("",!0),e("div",{class:F(["relative",o.showTypeFilter?"ml-auto":""]),ref:"sortContainer"},[e("button",{onClick:me(w,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[k[7]||(k[7]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),o.sortOption&&o.sortOption!=="recent-first"?(a(),m("span",Vt)):O("",!0)]),P(Ye,{name:"dropdown"},{default:H(()=>[i.value?E((a(),m("div",Rt,[e("button",{onClick:k[3]||(k[3]=f=>u("recent-first")),class:F(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="recent-first"}])},[e("i",{class:F(["fa-solid fa-check text-[10px] w-3",o.sortOption==="recent-first"?"opacity-100":"opacity-0"])},null,2),k[8]||(k[8]=e("span",null,"Most Recent First",-1))],2),e("button",{onClick:k[4]||(k[4]=f=>u("urgent-first")),class:F(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="urgent-first"}])},[e("i",{class:F(["fa-solid fa-check text-[10px] w-3",o.sortOption==="urgent-first"?"opacity-100":"opacity-0"])},null,2),k[9]||(k[9]=e("span",null,"Urgent first",-1))],2),e("button",{onClick:k[5]||(k[5]=f=>u("assigned-to-me")),class:F(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-me"}])},[e("i",{class:F(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-me"?"opacity-100":"opacity-0"])},null,2),k[10]||(k[10]=e("span",null,"Assigned to me",-1))],2),e("button",{onClick:k[6]||(k[6]=f=>u("assigned-to-my-team")),class:F(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-my-team"}])},[e("i",{class:F(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-my-team"?"opacity-100":"opacity-0"])},null,2),k[11]||(k[11]=e("span",null,"Assigned to my team",-1))],2)])),[[x,()=>i.value=!1]]):O("",!0)]),_:1})],2)]))}},Ft=Fe(Lt,[["__scopeId","data-v-59aa697a"]]),Mt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},Ut={class:"px-4 md:px-8 py-4 md:py-6 border-b border-gray-100 bg-gray-50/50 shrink-0"},Bt={class:"flex items-center justify-between gap-3"},jt={class:"flex items-center gap-3"},Wt={class:"page-header-title"},Et={key:0,class:"flex"},Pt={class:"px-5 py-3"},zt={class:"relative"},Ht=["placeholder"],Qt={key:0,class:"px-5 pb-3"},Yt=["onClick"],Kt={key:0,class:"absolute right-3 top-10 w-40 bg-white border border-gray-200 rounded-sm shadow-xl z-50 overflow-hidden animate-fade-in"},Gt={class:"p-3.5 flex flex-col gap-2.5"},Jt={class:"flex items-center justify-between"},Xt={class:"flex flex-wrap gap-1.5 text-xs font-medium"},Zt=["onClick"],_t={class:"flex items-center gap-3"},es={class:"flex-1 min-w-0"},ts={class:"text-sm font-bold text-gray-900 truncate group-hover:text-blue-600 transition-colors"},ss={class:"flex items-center gap-1.5 text-[10px] text-gray-500 mt-0.5"},os={class:"grid grid-cols-2 gap-2 p-2 bg-gray-50/50 rounded-sm border border-gray-100"},ls={class:"min-w-0"},ns={class:"text-[10px] font-semibold text-gray-700 truncate"},as={class:"min-w-0"},is={class:"text-[10px] font-semibold text-gray-700 truncate"},rs={class:"flex items-center justify-between pt-1 border-t border-gray-50"},ds={class:"flex items-center gap-1.5 text-[9px] text-gray-400"},us={class:"flex items-center gap-1.5 text-[9px] text-gray-400 font-medium"},cs={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(o,{emit:D}){const t={mounted(l,v){l.clickOutsideEvent=p=>{l===p.target||l.contains(p.target)||v.value()},document.addEventListener("click",l.clickOutsideEvent)},unmounted(l){document.removeEventListener("click",l.clickOutsideEvent)}},i=o,w=D,u=S(""),x=S("none"),y=q(()=>{let l=i.items;if(i.typeFilter&&i.typeFilter!=="all"&&(l=l.filter(v=>v.type===i.typeFilter)),u.value){const v=u.value.toLowerCase();l=l.filter(p=>{const R=i.getName(p).toLowerCase(),X=i.getVehicleInfo(p).toLowerCase();return R.includes(v)||X.includes(v)})}return l}),k=l=>{const v=l.compositeId||`${l.type||"task"}-${l.id}`||l.id;return i.selectedId===v},f=l=>{x.value=l,w("sort-change",l)},h=S(null),c=S(null);return ae(()=>i.selectedId,async l=>{if(l&&c.value){await Ve();try{c.value&&c.value.parentNode&&c.value.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(v){console.debug("Could not scroll to selected item:",v)}}},{immediate:!0}),ae(y,async()=>{i.selectedId&&c.value&&(await Ve(),setTimeout(()=>{try{c.value&&c.value.parentNode&&c.value.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(l){console.debug("Could not scroll to selected item:",l)}},100))},{immediate:!0}),(l,v)=>(a(),m("div",Mt,[e("div",Ut,[e("div",Bt,[e("div",jt,[o.showMobileClose?(a(),m("button",{key:0,onClick:v[0]||(v[0]=p=>l.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...v[4]||(v[4]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):O("",!0),e("h2",Wt,$(o.title),1)]),o.viewMode?(a(),m("div",Et,[P(Ze,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":v[1]||(v[1]=p=>l.$emit("view-change",p))},null,8,["view"])])):O("",!0)])]),e("div",Pt,[e("div",zt,[v[5]||(v[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),E(e("input",{"onUpdate:modelValue":v[2]||(v[2]=p=>u.value=p),type:"text",placeholder:o.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ht),[[Z,u.value]])])]),o.showTypeFilter?(a(),m("div",Qt,[P(Ft,{"type-filter":o.typeFilter,"sort-option":x.value,"show-type-filter":!0,onFilterChange:v[3]||(v[3]=p=>l.$emit("filter-change",p)),onSortChange:f},null,8,["type-filter","sort-option"])])):O("",!0),e("div",{ref_key:"scrollContainer",ref:h,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide bg-gray-50/50"},[(a(!0),m(_,null,ee(y.value,p=>(a(),m("div",{key:p.compositeId||`${p.type||"task"}-${p.id}`,ref_for:!0,ref:R=>{k(p)&&(c.value=R)},onClick:R=>l.$emit("select",p.compositeId||`${p.type||"task"}-${p.id}`||p.id),class:F(["bg-white border border-gray-200 flex flex-col overflow-hidden cursor-pointer relative group transition-all duration-200 shadow-sm hover:shadow-md rounded-sm",[k(p)?typeof o.selectedClass=="function"?o.selectedClass(p):o.selectedClass:typeof o.unselectedClass=="function"?o.unselectedClass(p):o.unselectedClass,p.type==="lead"?"border-l-4 border-l-blue-500":"border-l-4 border-l-purple-500"]])},[o.openMenuId===p.id&&o.showMenu?E((a(),m("div",Kt,[ce(l.$slots,"menu",{item:p},void 0,!0)])),[[t,()=>l.$emit("menu-close")]]):O("",!0),e("div",Gt,[e("div",Jt,[e("div",Xt,[ce(l.$slots,"badges",{item:p},void 0,!0)]),o.showMenu?(a(),m("button",{key:0,onClick:me(R=>l.$emit("menu-click",p.id),["stop"]),class:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-sm transition-all"},[...v[6]||(v[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Zt)):O("",!0)]),e("div",_t,[e("div",{class:F(["w-9 h-9 rounded-sm flex items-center justify-center text-xs font-bold shrink-0 shadow-sm border border-gray-100",o.avatarClass(p)])},$(o.getInitials(p)),3),e("div",es,[e("h3",ts,$(o.getName(p)),1),e("div",ss,[v[7]||(v[7]=e("i",{class:"fa-solid fa-location-dot text-[9px]"},null,-1)),ce(l.$slots,"location",{item:p},void 0,!0)])])]),e("div",os,[e("div",ls,[v[8]||(v[8]=e("p",{class:"text-[9px] font-bold uppercase tracking-wider text-gray-400 mb-0.5"},"Vehicle",-1)),e("p",ns,$(o.getVehicleInfo(p)),1)]),e("div",as,[v[9]||(v[9]=e("p",{class:"text-[9px] font-bold uppercase tracking-wider text-gray-400 mb-0.5"},"Status",-1)),e("div",is,[ce(l.$slots,"vehicle-status",{item:p},void 0,!0)])])]),e("div",rs,[e("div",ds,[v[10]||(v[10]=e("i",{class:"fa-solid fa-user-circle text-[10px]"},null,-1)),ce(l.$slots,"owner",{item:p},void 0,!0)]),e("div",us,[v[11]||(v[11]=e("i",{class:"fa-solid fa-clock text-[10px]"},null,-1)),ce(l.$slots,"dates",{item:p},void 0,!0)])])])],10,Yt))),128))],512)]))}},ps=Fe(cs,[["__scopeId","data-v-df98611c"]]),ms={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},ys={class:"flex-1 overflow-y-auto p-4 md:p-8"},gs={class:"table-wrapper w-full"},vs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","reassign","close","view-change"],setup(o,{emit:D}){const t=o,i=D;S("");const w=S({pageIndex:0,pageSize:10}),u=S(""),x=S([]),y=S([{id:"type",value:void 0},{id:"status",value:[]},{id:"source",value:[]},{id:"assignee",value:void 0}]);S({});const k=q(()=>{const b=[];t.showTypeFilter&&b.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),b.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),b.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),b.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const r=[...new Set(t.tasks.map(I=>I.assignee).filter(Boolean))];r.length>0&&b.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:r.map(I=>({value:I,label:I})),aiHint:"Person assigned to the task",pinned:!0});const g=[...new Set(t.tasks.map(I=>{const j=I.type==="lead"?I.requestedCar:I.vehicle;return j==null?void 0:j.brand}).filter(Boolean))];return g.length>0&&b.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:g.map(I=>({value:I,label:I})),aiHint:"Car brand requested by customer"}),b.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),b}),f=q(()=>t.tasks),h=b=>b.compositeId===t.currentTaskId||b.compositeId===t.highlightId,c=b=>b.type==="lead"?b.requestedCar?`${b.requestedCar.brand} ${b.requestedCar.model}`:"No vehicle specified":b.vehicle?`${b.vehicle.brand} ${b.vehicle.model}`:"No vehicle specified",l=b=>{const r=b.type==="lead"?b.requestedCar:b.vehicle;if(!r)return{status:"N/A",class:"bg-gray-100 text-gray-700"};const g=r.stockDays!==void 0&&r.stockDays!==null;return{status:g?"In Stock":"Out of Stock",class:g?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}},v=b=>{var r;return b.type==="lead"?((r=b.requestedCar)==null?void 0:r.requestType)||b.requestType||"N/A":b.requestType||"Opportunity"},p=q(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:b=>R(b.original)},cell:({row:b})=>{const r=b.original,g=r.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${g}`},r.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:b})=>{const r=b.original;return J("div",{class:"flex items-center gap-2 md:gap-3"},[J("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${r.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},r.customer.initials),J("div",{class:"min-w-0"},[J("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},r.customer.name),J("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},r.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:b})=>{const r=b.original,g=c(r);return g==="No vehicle specified"?J("span",{class:"text-sm text-gray-400"},"N/A"):J("div",{class:"flex items-center gap-2"},[J("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"}),J("span",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},g)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:b})=>{const r=b.original,g=l(r);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${g.class}`},g.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:b})=>{const r=b.original,g=v(r);return J("span",{class:"text-sm text-gray-600"},g)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:b})=>{const r=b.original;return J("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},r.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:b})=>{const r=b.original,g=t.getOwnerInfo(r);return J("div",{class:"flex items-center gap-2"},[J("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},g.initials),J("span",{class:"text-sm text-gray-600 truncate max-w-[80px]"},g.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:b})=>{const r=b.original,g=r.type==="lead"?r.status:r.displayStage||r.stage,I=t.getStageBadgeClass(g);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${I}`},g)}},{id:"actions",header:"",meta:{title:"Actions"},cell:({row:b})=>{const r=b.original;return J("button",{class:"text-gray-400 hover:text-gray-600",onClick:g=>{g.stopPropagation(),i("menu-click",r.id)}},[J("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),R=b=>{i("select",b.compositeId)},X=q(()=>({class:{tr:b=>{const r="cursor-pointer hover:bg-gray-50 transition-colors",g=b.original;return h(g)?`${r} bg-blue-50 border-l-4 border-l-blue-500`:r}}}));return ae(()=>[t.highlightId,t.tasks],async([b])=>{b&&t.tasks.length>0&&(await Ve(),setTimeout(()=>{var r,g;try{const I=document.querySelector(".table-wrapper");if(!I)return;const j=t.tasks.find(Q=>Q.compositeId===b);if(!j)return;const K=(r=j.customer)==null?void 0:r.name;if(K){const Q=I.querySelectorAll('tbody tr, [role="row"]');for(const A of Q)if(A&&A.parentNode&&((g=A.textContent)!=null&&g.includes(K))){A.scrollIntoView({behavior:"smooth",block:"nearest"});break}}}catch(I){console.debug("Could not scroll to highlighted row:",I)}},500))},{immediate:!0}),(b,r)=>(a(),m("div",ms,[P(yt,{title:"Tasks",subtitle:"Manage your leads and opportunities"},{actions:H(()=>[P(Ze,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":r[0]||(r[0]=g=>b.$emit("view-change",g))},null,8,["view"])]),_:1}),e("div",ys,[e("div",gs,[P(B(gt),{data:f.value,columns:p.value,meta:X.value,onRowClick:R,columnFiltersOptions:{filterDefs:k.value},pagination:w.value,"onUpdate:pagination":r[1]||(r[1]=g=>w.value=g),globalFilter:u.value,"onUpdate:globalFilter":r[2]||(r[2]=g=>u.value=g),sorting:x.value,"onUpdate:sorting":r[3]||(r[3]=g=>x.value=g),columnFilters:y.value,"onUpdate:columnFilters":r[4]||(r[4]=g=>y.value=g),paginationOptions:{rowCount:f.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{"empty-state":H(()=>[...r[5]||(r[5]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},fs={class:"space-y-4"},bs={label:"Teams"},xs=["value"],hs={label:"Users"},ws=["value"],ks={key:0,class:"text-xs text-gray-500 mt-1"},Cs={key:0,class:"animate-fade-in"},$s={class:"grid grid-cols-4 gap-2"},Ss=["onClick"],As={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(o,{emit:D}){const t=o,i=D,w=Oe(),u=je(),x=S(""),y=S(null),k=S(""),f=S(!1),h=S(""),c=q(()=>u.assignableUsers),l=q(()=>u.assignableTeams),v=q(()=>y.value&&y.value.startsWith("team-")),p=q(()=>!!(x.value&&k.value&&h.value&&y.value));De(()=>{var r;y.value=`user-${((r=w.currentUser)==null?void 0:r.id)||1}`}),ae(()=>t.show,r=>{r||R()});const R=()=>{var r;x.value="",y.value=`user-${((r=w.currentUser)==null?void 0:r.id)||1}`,k.value="",f.value=!1,h.value=""},X=()=>{if(!p.value)return;const r=y.value.startsWith("team-"),g=parseInt(y.value.split("-")[1]);let I={};if(r){const j=u.getTeamById(g);I={assigneeType:"team",teamId:g,team:(j==null?void 0:j.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const j=u.getUserById(g);I={assigneeType:"user",assigneeId:g,assignee:(j==null?void 0:j.name)||"Unknown",teamId:null,team:null}}i("confirm",{type:x.value,date:k.value,time:h.value,...I}),i("close")},b=()=>{i("close")};return(r,g)=>(a(),Y(ye,{show:o.show,title:"Schedule Appointment",subtitle:"Book an appointment with the customer",size:"lg",onClose:b,onCancel:b},{actions:H(()=>[P(B(he),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm",disabled:!p.value,onClick:X},null,8,["disabled"])]),default:H(()=>[e("div",fs,[e("div",null,[g[5]||(g[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),E(e("select",{"onUpdate:modelValue":g[0]||(g[0]=I=>x.value=I),class:"input"},[...g[4]||(g[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[re,x.value]])]),e("div",null,[g[7]||(g[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),E(e("select",{"onUpdate:modelValue":g[1]||(g[1]=I=>y.value=I),class:"input"},[e("optgroup",bs,[(a(!0),m(_,null,ee(l.value,I=>(a(),m("option",{key:`team-${I.id}`,value:`team-${I.id}`},$(I.name)+" Team ",9,xs))),128))]),e("optgroup",hs,[(a(!0),m(_,null,ee(c.value,I=>{var j;return a(),m("option",{key:`user-${I.id}`,value:`user-${I.id}`},$(I.name)+$(I.id===((j=B(w).currentUser)==null?void 0:j.id)?" (Me)":""),9,ws)}),128))])],512),[[re,y.value]]),v.value?(a(),m("p",ks,[...g[6]||(g[6]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),U(" Any available team member will be assigned ",-1)])])):O("",!0)]),e("div",null,[g[8]||(g[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":g[2]||(g[2]=I=>k.value=I),onChange:g[3]||(g[3]=I=>f.value=!0),class:"input"},null,544),[[Z,k.value]])]),f.value?(a(),m("div",Cs,[g[9]||(g[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",$s,[(a(),m(_,null,ee(["09:00","10:30","11:00","14:30","15:00","16:30"],I=>e("button",{key:I,onClick:j=>h.value=I,class:F(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",h.value===I?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},$(I),11,Ss)),64))])])):O("",!0)])]),_:1},8,["show"]))}},Ds={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},Ts={key:0,class:"flex justify-between items-center mb-4"},Os={class:"font-semibold text-slate-800 text-sm"},Is={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(o){return(D,t)=>(a(),m("div",Ds,[o.title?(a(),m("div",Ts,[e("h5",Os,$(o.title),1),o.showClose?(a(),m("button",{key:0,onClick:t[0]||(t[0]=i=>D.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[1]||(t[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):O("",!0)])):O("",!0),ce(D.$slots,"default")]))}},qs={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},Ns={class:"flex justify-between items-start mb-3"},Vs={class:"font-bold text-slate-800 text-sm"},Rs={class:"text-xs text-gray-500 mt-0.5"},Ls={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},Fs={class:"text-xs text-blue-700"},Ms={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},Us={class:"flex items-center justify-between"},Bs={class:"flex items-center gap-2"},js={class:"text-xs font-bold text-slate-800"},Ws={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},Es={class:"flex items-center gap-2 mb-3"},Ps={class:"text-sm text-slate-700 font-medium"},zs={key:2,class:"flex gap-2 items-center mb-4"},Hs=["disabled"],Qs={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Ys=["disabled"],Ks={key:3,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Gs={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Js={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Xs={class:"flex items-center gap-2 text-red-400"},Zs={class:"text-xs font-mono"},_s={class:"space-y-3 text-sm font-mono"},eo={class:"ml-2"},to={class:"ml-2"},so={key:0},oo={class:"ml-2"},lo={key:1},no={class:"ml-2"},ao={key:2},io={class:"ml-2"},ro={class:"mt-4 pt-4 border-t border-slate-700"},uo={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},co={key:4,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},po={class:"grid grid-cols-3 gap-2"},mo={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},yo={class:"grid grid-cols-4 gap-2"},go=["onClick"],vo={key:0},fo={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},bo={class:"text-xs text-slate-700"},xo={class:"grid grid-cols-3 gap-2"},ho={key:0,class:"mt-3 grid grid-cols-2 gap-3"},wo={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},ko={class:"flex gap-4"},Co={class:"flex items-center gap-2 cursor-pointer"},$o={class:"flex items-center gap-2 cursor-pointer"},So={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},Ao=["disabled"],Do={key:2,class:"space-y-4"},To={class:"bg-white border border-gray-200 rounded-lg p-4"},Oo={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Io=["value"],qo=["value"],No=["value"],Vo={class:"bg-white border border-gray-200 rounded-lg p-4"},Ro={class:"flex gap-2"},Lo={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Fo={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Mo={class:"ml-2 font-medium text-slate-800"},Uo={class:"ml-2 font-medium text-slate-800"},Bo={class:"ml-2 font-medium text-slate-800 capitalize"},jo={class:"ml-2 font-medium text-slate-800"},Wo={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},Eo={class:"space-y-2"},Po=["checked"],zo=["checked","disabled"],Ho={class:"flex-1"},Qo={class:"text-xs text-gray-500 mt-0.5"},Yo={class:"space-y-3"},Ko={class:"grid grid-cols-2 gap-3 text-sm"},Go={class:"ml-2 font-medium text-slate-800"},Jo={class:"ml-2 font-medium text-slate-800"},Xo={class:"ml-2 font-medium text-slate-800 capitalize"},Zo={class:"ml-2 font-medium text-slate-800"},_o={key:0,class:"text-sm"},el={class:"ml-2 font-medium text-slate-800"},tl={key:1,class:"text-sm"},sl={class:"mt-1 text-slate-700"},ol={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(o,{emit:D}){var We,Ee,Pe;const t=o,i=D,w=je(),u=Oe(),x=Ke(),y=S(!1),k=S(!1),f=S(0),h=S(""),c=S(null),l=S(!1),v=S(null),p=S(!1),R=S(!1),X=S(null),b=S(!1),r=S(null),g=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],I=S("whatsapp"),j=S("followup-1"),K=S("custom"),Q=S(""),A=S("09:00"),V=S("Not Interested"),z=S(""),oe=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],ge=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],ve=q(()=>w.assignableUsers),ue=q(()=>u.currentUser),le=S({dealership:((Ee=(We=t.lead)==null?void 0:We.requestedCar)==null?void 0:Ee.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Pe=ue.value)==null?void 0:Pe.id)||1}),ie=S({tradeIn:!1,financing:!1,contactAvailability:!1}),G=S({}),ne=S(null);De(()=>{const L=t.lead.displayStage||t.lead.stage;(L==="Valid"||L==="Validated")&&(v.value="interested",l.value=!0)});const te={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},fe=q(()=>{const L=Math.floor(f.value/60),s=f.value%60;return`${L.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}),we=q(()=>{const L=t.lead.displayStage||t.lead.stage;return L==="Valid"||L==="Validated"?"Lead Validated":t.lead.callbackDate||t.lead.callbackScheduled?"Call Prospect":"Call to Verify Contact Details"}),ke=q(()=>{const L=t.lead.displayStage||t.lead.stage;return L==="Valid"||L==="Validated"?"Lead is validated. Complete conversion details to create opportunity.":t.lead.callbackDate||t.lead.callbackScheduled?"Customer requested a callback. Make the call at scheduled time.":"Begin lead qualification by verifying customer contact information."}),Ce=q(()=>t.lead.scheduledAppointment?new Date(t.lead.scheduledAppointment.start)<new Date:!1),be=q(()=>!!t.lead.scheduledAppointment),d=q(()=>be.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Ce.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),n=q(()=>{var L;return((L=t.lead.contactAttempts)==null?void 0:L.length)||0}),T=q(()=>x.getSetting("maxContactAttempts"));q(()=>t.activities.filter(L=>L.type==="note"));const M={"followup-1":`Hi ${t.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}?`,"followup-2":`Hello ${t.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},C=q(()=>j.value==="custom"?"Type your custom message...":M[j.value]),W=()=>{y.value=!0,f.value=0,k.value=!1,h.value="",c.value=setInterval(()=>{f.value++,f.value>=20&&se()},1e3)},se=()=>{c.value&&(clearInterval(c.value),c.value=null),y.value=!1,k.value=!0,G.value={duration:f.value,notes:h.value,transcription:te,channel:"phone"},l.value=!0},$e=async()=>{try{await navigator.clipboard.writeText(t.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(L){console.error("Failed to copy:",L)}},_e=()=>{ne.value={tradeIn:te.leadLines.some(L=>L.toLowerCase().includes("trade")||L.toLowerCase().includes("exchange"))||!1,financing:te.leadLines.some(L=>L.toLowerCase().includes("financ")||L.toLowerCase().includes("payment")||L.toLowerCase().includes("loan"))||!1},ne.value.tradeIn&&(ie.value.tradeIn=!0),ne.value.financing&&(ie.value.financing=!0),l.value=!0,k.value=!1},et=async L=>{r.value=L,b.value=!0,R.value=!1,i("appointment-scheduled",L)},tt=()=>{const L={timestamp:new Date().toISOString(),outcome:"interested",channel:G.value.channel||"phone",notes:G.value.notes||"",transcription:G.value.transcription||null};i("call-attempt-logged",L),i("validated",{scheduleFollowUp:!1}),i("qualified",{assignment:le.value,preferences:ie.value,scheduleAppointment:b.value,appointmentData:r.value}),xe()},st=()=>{const L={timestamp:new Date().toISOString(),outcome:"interested",channel:G.value.channel||"phone",notes:G.value.notes||"",transcription:G.value.transcription||null};i("call-attempt-logged",L),v.value="not-valid"},ot=()=>{G.value={channel:"external",notes:"",transcription:null},l.value=!0},Ie=L=>{v.value=L,L==="interested"&&ne.value&&(ie.value.tradeIn=ne.value.tradeIn||!1,ie.value.financing=ne.value.financing||!1)},xe=()=>{v.value=null,l.value=!1,b.value=!1,r.value=null},lt=()=>{if(K.value==="tomorrow-9am"){const s=new Date;return s.setDate(s.getDate()+1),s.setHours(9,0,0,0),s.toISOString()}else if(K.value==="monday"){const s=new Date,N=(8-s.getDay())%7||7;return s.setDate(s.getDate()+N),s.setHours(9,0,0,0),s.toISOString()}else if(K.value==="custom"&&Q.value&&A.value)return new Date(`${Q.value}T${A.value}:00`).toISOString();const L=new Date;return L.setDate(L.getDate()+1),L.setHours(9,0,0,0),L.toISOString()},nt=async()=>{const L={timestamp:new Date().toISOString(),outcome:"no-answer",channel:G.value.channel||"phone",notes:G.value.notes||"",transcription:G.value.transcription||null};i("call-attempt-logged",L),I.value&&I.value;const s=lt(),N=s.split("T")[0],Se=new Date(s).toTimeString().slice(0,5);i("postponed",{date:N,time:Se,createAppointment:!0}),n.value+1>=T.value&&i("disqualified",{category:"Not Interested",reason:"Unreachable"}),xe()},at=()=>{const L={timestamp:new Date().toISOString(),outcome:"not-valid",channel:G.value.channel||"phone",notes:G.value.notes||"",transcription:G.value.transcription||null};i("call-attempt-logged",L),i("disqualified",{category:V.value,reason:z.value}),xe()},it=L=>{p.value=!1,i("note-saved",L)};return rt(()=>{c.value&&clearInterval(c.value)}),(L,s)=>(a(),m("div",qs,[e("div",Ns,[e("div",null,[e("h4",Vs,$(we.value),1),e("p",Rs,$(ke.value),1)]),e("div",{class:F(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",d.value.class])},$(d.value.text),3)]),be.value?(a(),m("div",Ls,[s[26]||(s[26]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",Fs,$(B(Ae)(o.lead.scheduledAppointment.start))+" at "+$(B(Te)(o.lead.scheduledAppointment.start)),1)])):O("",!0),n.value>0?(a(),m("div",Ms,[e("div",Us,[e("div",Bs,[s[27]||(s[27]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),s[28]||(s[28]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",js,$(n.value)+" / "+$(T.value),1)]),n.value>=T.value-1?(a(),m("div",Ws,[...s[29]||(s[29]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),U(" One more attempt before auto-disqualification ",-1)])])):O("",!0)])])):O("",!0),e("div",Es,[e("span",Ps,$(o.lead.customer.phone),1),e("button",{onClick:$e,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...s[30]||(s[30]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),!l.value&&!y.value&&!k.value?(a(),m("div",zs,[e("button",{onClick:W,disabled:y.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[s[31]||(s[31]=e("i",{class:"fa-solid fa-phone"},null,-1)),U(" "+$(n.value>0?"Call Again":"Initiate Call")+" ",1),n.value>0?(a(),m("span",Qs,$(n.value+1)+"/"+$(T.value),1)):O("",!0)],8,Hs),e("button",{onClick:ot,disabled:y.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[32]||(s[32]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),U(" Log Call Outcome ",-1)])],8,Ys)])):O("",!0),y.value||k.value?(a(),m("div",Ks,[y.value?(a(),m("div",Gs,[e("div",Js,[s[34]||(s[34]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Xs,[s[33]||(s[33]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Zs,"REC "+$(fe.value),1)])]),e("div",_s,[e("div",null,[s[35]||(s[35]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",eo,$(te.leadLines[0]),1)]),e("div",null,[s[36]||(s[36]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",to,$(te.salesLines[0]),1)]),f.value>=5?(a(),m("div",so,[s[37]||(s[37]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",oo,$(te.leadLines[1]),1)])):O("",!0),f.value>=8?(a(),m("div",lo,[s[38]||(s[38]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",no,$(te.salesLines[1]),1)])):O("",!0),f.value>=12?(a(),m("div",ao,[s[39]||(s[39]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",io,$(te.leadLines[2]),1)])):O("",!0)]),e("div",ro,[E(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=N=>h.value=N),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[Z,h.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:se,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[40]||(s[40]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),U(" End Call ",-1)])])])])):O("",!0),k.value&&!y.value?(a(),m("div",uo,[e("div",{class:"flex items-center justify-between"},[s[42]||(s[42]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:_e,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[41]||(s[41]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),U(" Extract information ",-1)])])])])):O("",!0)])):O("",!0),l.value?(a(),m("div",co,[e("div",null,[s[46]||(s[46]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",po,[e("button",{onClick:s[1]||(s[1]=N=>Ie("no-answer")),class:F(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[43]||(s[43]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:s[2]||(s[2]=N=>Ie("not-valid")),class:F(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[44]||(s[44]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:s[3]||(s[3]=N=>Ie("interested")),class:F(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[45]||(s[45]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),v.value==="no-answer"?(a(),m("div",mo,[s[54]||(s[54]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",yo,[(a(),m(_,null,ee(g,N=>e("button",{key:N.value,onClick:Se=>I.value=N.value,class:F(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",I.value===N.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},$(N.label),11,go)),64))]),I.value&&I.value!=="dont-send"?(a(),m("div",vo,[s[49]||(s[49]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),E(e("select",{"onUpdate:modelValue":s[4]||(s[4]=N=>j.value=N),class:"input"},[...s[47]||(s[47]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[re,j.value]]),e("div",fo,[s[48]||(s[48]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",bo,$(C.value),1)])])):O("",!0),e("div",null,[s[52]||(s[52]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",xo,[e("button",{onClick:s[5]||(s[5]=N=>K.value="tomorrow-9am"),class:F(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",K.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:s[6]||(s[6]=N=>K.value="monday"),class:F(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",K.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:s[7]||(s[7]=N=>K.value="custom"),class:F(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",K.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),K.value==="custom"?(a(),m("div",ho,[e("div",null,[s[50]||(s[50]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":s[8]||(s[8]=N=>Q.value=N),class:"input"},null,512),[[Z,Q.value]])]),e("div",null,[s[51]||(s[51]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),E(e("input",{type:"time","onUpdate:modelValue":s[9]||(s[9]=N=>A.value=N),class:"input"},null,512),[[Z,A.value]])])])):O("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:nt,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[53]||(s[53]=[U(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):O("",!0),v.value==="not-valid"?(a(),m("div",wo,[e("div",null,[s[57]||(s[57]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",ko,[e("label",Co,[E(e("input",{type:"radio","onUpdate:modelValue":s[10]||(s[10]=N=>V.value=N),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Re,V.value]]),s[55]||(s[55]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",$o,[E(e("input",{type:"radio","onUpdate:modelValue":s[11]||(s[11]=N=>V.value=N),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Re,V.value]]),s[56]||(s[56]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[s[59]||(s[59]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),E(e("select",{"onUpdate:modelValue":s[12]||(s[12]=N=>z.value=N),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...s[58]||(s[58]=[ze('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[re,z.value]])]),e("div",So,[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:at,disabled:!V.value||!z.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,Ao)])])):O("",!0),v.value==="interested"?(a(),m("div",Do,[e("div",To,[s[63]||(s[63]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",Oo,[e("div",null,[s[60]||(s[60]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),E(e("select",{"onUpdate:modelValue":s[13]||(s[13]=N=>le.value.dealership=N),class:"input"},[(a(),m(_,null,ee(oe,N=>e("option",{key:N,value:N},$(N),9,Io)),64))],512),[[re,le.value.dealership]])]),e("div",null,[s[61]||(s[61]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),E(e("select",{"onUpdate:modelValue":s[14]||(s[14]=N=>le.value.team=N),class:"input"},[(a(),m(_,null,ee(ge,N=>e("option",{key:N,value:N},$(N),9,qo)),64))],512),[[re,le.value.team]])]),e("div",null,[s[62]||(s[62]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),E(e("select",{"onUpdate:modelValue":s[15]||(s[15]=N=>le.value.assigneeId=N),class:"input"},[(a(!0),m(_,null,ee(ve.value,N=>(a(),m("option",{key:N.id,value:N.id},$(N.name)+$(N.id===ue.value.id?" (Me)":""),9,No))),128))],512),[[re,le.value.assigneeId]])])])]),e("div",Vo,[s[67]||(s[67]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",Ro,[e("button",{onClick:s[16]||(s[16]=N=>i("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[64]||(s[64]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),U(" Add purchase method ",-1)])]),e("button",{onClick:s[17]||(s[17]=N=>i("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[65]||(s[65]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),U(" Add trade-in ",-1)])]),e("button",{onClick:s[18]||(s[18]=N=>p.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[66]||(s[66]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),U(" Add note ",-1)])])])]),L.hasExistingAppointment&&!b.value?(a(),m("div",Lo,[s[73]||(s[73]=ze('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Fo,[e("div",null,[s[68]||(s[68]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Mo,$(B(Ae)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[69]||(s[69]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Uo,$(B(Te)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[70]||(s[70]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Bo,$(o.lead.scheduledAppointment.type),1)]),e("div",null,[s[71]||(s[71]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",jo,$(o.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:s[19]||(s[19]=N=>R.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[72]||(s[72]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),U(" Reschedule Appointment ",-1)])])])):O("",!0),L.hasExistingAppointment?O("",!0):(a(),m("div",Wo,[s[76]||(s[76]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",Eo,[e("label",{class:F(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!b.value}])},[e("input",{type:"radio",checked:!b.value,onChange:s[20]||(s[20]=()=>{b.value=!1,r.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Po),s[74]||(s[74]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:F(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":b.value}]),onClick:s[22]||(s[22]=N=>!b.value&&(R.value=!0))},[e("input",{type:"radio",checked:b.value,disabled:!b.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,zo),e("div",Ho,[s[75]||(s[75]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",Qo,$(b.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),b.value?(a(),m("button",{key:0,onClick:s[21]||(s[21]=me(N=>R.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):O("",!0)],2)])])),b.value?(a(),Y(Is,{key:2,title:"Scheduled Appointment","show-close":!1},{default:H(()=>[e("div",Yo,[e("div",Ko,[e("div",null,[s[77]||(s[77]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Go,$(B(Ae)(r.value.datetime)),1)]),e("div",null,[s[78]||(s[78]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Jo,$(r.value.time),1)]),e("div",null,[s[79]||(s[79]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Xo,$(r.value.type),1)]),e("div",null,[s[80]||(s[80]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Zo,$(r.value.assignee),1)])]),r.value.location?(a(),m("div",_o,[s[81]||(s[81]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",el,$(r.value.location),1)])):O("",!0),r.value.notes?(a(),m("div",tl,[s[82]||(s[82]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",sl,$(r.value.notes),1)])):O("",!0)])]),_:1})):O("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:st,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...s[83]||(s[83]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),U(" Disqualify ",-1)])]),e("button",{onClick:tt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[84]||(s[84]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),U(" Qualify ",-1)])])])])])):O("",!0)])):O("",!0),P(ye,{show:p.value,title:"Add Note",size:"2xl",onClose:s[24]||(s[24]=N=>p.value=!1)},{actions:H(()=>{var N,Se;return[P(B(he),{label:"Save Note",variant:"primary",size:"small",class:"rounded-sm",disabled:!((N=X.value)!=null&&N.canSubmit()),onClick:(Se=X.value)==null?void 0:Se.submit},null,8,["disabled","onClick"])]}),default:H(()=>[P(vt,{ref_key:"noteWidgetRef",ref:X,item:null,"task-type":"lead","task-id":o.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:it,onCancel:s[23]||(s[23]=N=>p.value=!1)},null,8,["task-id"])]),_:1},8,["show"]),P(As,{show:R.value,onConfirm:et,onClose:s[25]||(s[25]=N=>R.value=!1)},null,8,["show"])]))}},ll={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm"},nl={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},al={class:"flex items-center gap-3"},il={class:"flex-1"},rl={key:0,class:"text-xs font-normal opacity-75"},dl={class:"p-5 space-y-6"},ul={key:1,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},cl={class:"flex justify-between items-start mb-3"},pl={class:"text-xs text-gray-500 mt-0.5"},ml={key:0},yl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(o,{emit:D}){const t=o,i=D,w=Me(),u=Ue(),x=Oe(),y=S(new Set),k=q(()=>y.value.has(t.lead.id)),f=()=>{y.value.add(t.lead.id)},h=q(()=>Je(t.lead.nextActionDue)),c=q(()=>{var A,V;return((A=t.lead)==null?void 0:A.displayStage)||((V=t.lead)==null?void 0:V.stage)||"New Lead"}),l=q(()=>Ge(c.value,"lead"));q(()=>(t.lead.contactAttempts||[]).length||0),q(()=>t.lead.isDisqualified||c.value.startsWith("Closed"));const v=q(()=>c.value.startsWith("Closed"));async function p(A){try{const V=new Date(`${A.date}T${A.time}:00`),z=V.toISOString();await u.modifyLead(t.lead.id,{nextActionDue:z}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ae(V)} at ${Te(V)}`}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to postpone lead task:",V)}}async function R(A){try{if(await u.modifyLead(t.lead.id,{stage:"Validated"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),A.scheduleFollowUp&&A.appointmentData){const V=new Date(`${A.appointmentData.date}T${A.appointmentData.time}:00`);await u.scheduleFollowUp(t.lead.id,{dateTime:V.toISOString(),assignee:A.appointmentData.assignee||t.lead.assignee,assigneeId:A.appointmentData.assigneeId||null,assigneeType:A.appointmentData.assigneeType||"user",teamId:A.appointmentData.teamId||null,team:A.appointmentData.team||null}),await u.addActivity(t.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ae(V)} at ${Te(V)}`})}await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to validate lead:",V)}}async function X(){try{const A=await u.convertLeadToOpportunity(t.lead.id);x.canAccessOpportunities()?w.push({path:`/tasks/${A}`,query:{type:"opportunity"}}):w.push("/tasks/1")}catch(A){console.error("Failed to qualify lead:",A)}}async function b(A){try{const V=t.lead.contactAttempts||[];await u.modifyLead(t.lead.id,{contactAttempts:[...V,A],lastContactAttempt:A.timestamp,totalContactAttempts:V.length+1}),await u.addActivity(t.lead.id,{type:"call",user:"You",action:`logged call attempt - ${A.outcome}`,content:A.notes||`Call attempt via ${A.channel}`,data:{outcome:A.outcome,channel:A.channel,duration:A.duration}}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to log call attempt:",V)}}async function r(A){try{await u.addActivity(t.lead.id,{type:"note",user:"You",action:"added a note",content:A.content||A.text||"",data:A}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to save note:",V)}}function g(){i("open-purchase-method")}function I(){i("open-trade-in")}async function j(A){var V;try{const z=`${A.date}T${A.time}:00`,oe=new Date(z);oe.setHours(oe.getHours()+1),await u.modifyLead(t.lead.id,{scheduledAppointment:{id:Date.now(),title:`${A.type} - ${t.lead.customer.name}`,start:z,end:oe.toISOString(),type:A.type,assignee:A.assignee,assigneeId:A.assigneeId,status:"scheduled",location:A.location||"",notes:A.notes||""}}),await u.addActivity(t.lead.id,{type:"appointment",user:((V=x.currentUser)==null?void 0:V.name)||"You",action:"scheduled an appointment",content:`${A.type} scheduled for ${A.date} at ${A.time}`,data:{type:A.type,date:A.date,time:A.time,assignee:A.assignee}}),await u.loadLeadById(t.lead.id)}catch(z){console.error("Failed to schedule appointment:",z)}}async function K(A){try{const V=A.reason==="Duplicate";await u.modifyLead(t.lead.id,{isDisqualified:!0,disqualifyReason:A.reason,isDuplicate:V,stage:V?"Closed Failed":"Not Valid",status:"Disqualified"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${A.category}, Reason: ${A.reason}`}),w.push("/tasks")}catch(V){console.error("Failed to disqualify lead:",V)}}async function Q(){try{await u.modifyLead(t.lead.id,{isDisqualified:!1,disqualifyReason:null,stage:"Open Lead",status:"Open"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}),await u.loadLeadById(t.lead.id)}catch(A){console.error("Failed to reopen lead:",A)}}return(A,V)=>o.lead?(a(),m("div",ll,[e("div",nl,[V[0]||(V[0]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:F(["text-xs px-3 py-1 rounded-full font-medium border",l.value])},$(c.value),3)]),o.lead.nextActionDue&&!k.value&&(h.value.type==="overdue"||h.value.type==="urgent")?(a(),m("div",{key:0,class:F(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[h.value.bgClass,h.value.borderClass]])},[e("div",al,[e("div",{class:F(["w-9 h-9 rounded-lg flex items-center justify-center",[h.value.bgClass,h.value.borderClass,"border"]])},[e("i",{class:F(["text-base",[`fa-solid ${h.value.icon}`,h.value.textClass]])},null,2)],2),e("div",il,[V[1]||(V[1]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:F(["text-sm font-bold",h.value.textClass])},[U($(B(Xe)(o.lead.nextActionDue))+" ",1),h.value.type!=="overdue"?(a(),m("span",rl," ("+$(B($t)(o.lead.nextActionDue))+") ",1)):O("",!0)],2)]),h.value.type==="overdue"?(a(),m("div",{key:0,class:F(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[h.value.bgClass,h.value.textClass,h.value.borderClass,"border"]])},[...V[2]||(V[2]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),U(" Overdue ",-1)])],2)):h.value.type==="urgent"?(a(),m("div",{key:1,class:F(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[h.value.bgClass,h.value.textClass,h.value.borderClass,"border"]])},[...V[3]||(V[3]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),U(" Urgent ",-1)])],2)):O("",!0)]),e("button",{onClick:f,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...V[4]||(V[4]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):O("",!0),e("div",dl,[v.value?(a(),m("div",ul,[e("div",cl,[e("div",null,[V[5]||(V[5]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Closed",-1)),e("p",pl,[U(" Status: "+$(c.value)+" ",1),o.lead.disqualifyReason?(a(),m("span",ml," - "+$(o.lead.disqualifyReason),1)):O("",!0)])])]),e("button",{onClick:Q,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...V[6]||(V[6]=[U(" Reopen Lead ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):(a(),m(_,{key:0},[c.value==="New"||!v.value?(a(),Y(ol,{key:0,lead:o.lead,onPostponed:p,onValidated:R,onQualified:X,onDisqualified:K,onCallAttemptLogged:b,onNoteSaved:r,onOpenPurchaseMethod:g,onOpenTradeIn:I,onAppointmentScheduled:j},null,8,["lead"])):O("",!0)],64))])])):O("",!0)}},gl={class:"mt-1.5 border-t border-gray-200 pt-1.5"},vl={key:1},fl={class:"flex items-center justify-between mb-1.5"},bl={class:"space-y-1.5"},xl={class:"block label-upper mb-1"},hl=["onUpdate:modelValue","placeholder"],wl=["onUpdate:modelValue"],kl=["value"],Cl={key:2,class:"space-y-0.5"},$l=["onUpdate:modelValue","value"],de={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=S(!1),u=S({});ae(()=>t.questions,h=>{const c={};h.forEach(l=>{c[l.key]=""}),u.value=c},{immediate:!0});const x=()=>{i("survey-completed",{...u.value}),f()},y=()=>{i("survey-refused"),f()},k=()=>{i("not-responding"),f()},f=()=>{w.value=!1;const h={};t.questions.forEach(c=>{h[c.key]=""}),u.value=h};return(h,c)=>(a(),m("div",gl,[w.value?(a(),m("div",vl,[e("div",fl,[c[4]||(c[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:c[1]||(c[1]=l=>w.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...c[3]||(c[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",bl,[(a(!0),m(_,null,ee(o.questions,(l,v)=>(a(),m("div",{key:v,class:"bg-gray-50 rounded-md p-1.5"},[e("label",xl,$(l.label),1),l.type==="text"?E((a(),m("textarea",{key:0,"onUpdate:modelValue":p=>u.value[l.key]=p,placeholder:l.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,hl)),[[Z,u.value[l.key]]]):l.type==="select"?E((a(),m("select",{key:1,"onUpdate:modelValue":p=>u.value[l.key]=p,class:"input text-xs py-1 px-2"},[c[5]||(c[5]=e("option",{value:""},"Select an option...",-1)),(a(!0),m(_,null,ee(l.options,p=>(a(),m("option",{key:p,value:p},$(p),9,kl))),128))],8,wl)),[[re,u.value[l.key]]]):l.type==="radio"?(a(),m("div",Cl,[(a(!0),m(_,null,ee(l.options,p=>(a(),m("label",{key:p,class:"flex items-center text-xs"},[E(e("input",{type:"radio","onUpdate:modelValue":R=>u.value[l.key]=R,value:p,class:"mr-1"},null,8,$l),[[Re,u.value[l.key]]]),U(" "+$(p),1)]))),128))])):O("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:x,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(a(),m("button",{key:0,onClick:c[0]||(c[0]=l=>w.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...c[2]||(c[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Sl={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Al={class:"flex justify-between items-start mb-3"},Dl={class:"text-xs text-gray-500 mt-0.5"},Tl={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],u=q(()=>{if(!t.opportunity.createdAt)return 0;const c=new Date(t.opportunity.createdAt),v=Math.abs(new Date-c);return Math.ceil(v/(1e3*60*60*24))}),x=()=>{i("create-offer",t.opportunity)},y=()=>{i("review",t.opportunity)},k=c=>{i("survey-completed",{opportunity:t.opportunity,responses:c})},f=()=>{i("survey-refused",{opportunity:t.opportunity})},h=()=>{i("not-responding",{opportunity:t.opportunity})};return(c,l)=>(a(),m("div",Sl,[e("div",Al,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Dl,"This opportunity has been open for "+$(u.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),P(de,{questions:w,onSurveyCompleted:k,onSurveyRefused:f,onNotResponding:h})]))}},Ol={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Il={class:"flex justify-between items-start mb-3"},ql={class:"text-xs text-gray-500 mt-0.5"},Nl={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],u=q(()=>{if(!t.opportunity.createdAt)return 0;const h=new Date(t.opportunity.createdAt),l=Math.abs(new Date-h);return Math.ceil(l/(1e3*60*60*24))}),x=()=>{i("create-offer",t.opportunity)},y=h=>{i("survey-completed",{opportunity:t.opportunity,responses:h})},k=()=>{i("survey-refused",{opportunity:t.opportunity})},f=()=>{i("not-responding",{opportunity:t.opportunity})};return(h,c)=>(a(),m("div",Ol,[e("div",Il,[e("div",null,[c[0]||(c[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",ql,"This opportunity has been open for "+$(u.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),P(de,{questions:w,onSurveyCompleted:y,onSurveyRefused:k,onNotResponding:f})]))}},Vl={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Rl={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],u=()=>{i("schedule-closing",t.opportunity)},x=f=>{i("survey-completed",{opportunity:t.opportunity,responses:f})},y=()=>{i("survey-refused",{opportunity:t.opportunity})},k=()=>{i("not-responding",{opportunity:t.opportunity})};return(f,h)=>(a(),m("div",Vl,[h[0]||(h[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:u,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),P(de,{questions:w,onSurveyCompleted:x,onSurveyRefused:y,onNotResponding:k})]))}},Ll={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Fl={class:"flex justify-between items-start mb-3"},Ml={class:"text-xs text-gray-500 mt-0.5"},Ul={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],u=q(()=>{const h=t.opportunity.lastActivity||t.opportunity.createdAt;if(!h)return 0;const c=new Date(h),v=Math.abs(new Date-c);return Math.ceil(v/(1e3*60*60*24))}),x=()=>{i("create-contract",t.opportunity)},y=h=>{i("survey-completed",{opportunity:t.opportunity,responses:h})},k=()=>{i("survey-refused",{opportunity:t.opportunity})},f=()=>{i("not-responding",{opportunity:t.opportunity})};return(h,c)=>(a(),m("div",Ll,[e("div",Fl,[e("div",null,[c[0]||(c[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Ml,"This opportunity has been in negotiation for "+$(u.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),P(de,{questions:w,onSurveyCompleted:y,onSurveyRefused:k,onNotResponding:f})]))}},Bl={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},jl={class:"flex justify-between items-start mb-3"},Wl={class:"text-xs text-gray-500 mt-0.5"},El={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],u=q(()=>{var p;if(!((p=t.opportunity)!=null&&p.contractDate))return 0;const c=new Date(t.opportunity.contractDate),v=Math.abs(new Date-c);return Math.ceil(v/(1e3*60*60*24))}),x=()=>{i("prepare-delivery",t.opportunity)},y=()=>{i("pre-delivery-checklist",t.opportunity)},k=c=>{i("survey-completed",{opportunity:t.opportunity,responses:c})},f=()=>{i("survey-refused",{opportunity:t.opportunity})},h=()=>{i("not-responding",{opportunity:t.opportunity})};return(c,l)=>(a(),m("div",Bl,[e("div",jl,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Wl,"Contract was signed "+$(u.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),P(de,{questions:w,onSurveyCompleted:k,onSurveyRefused:f,onNotResponding:h})]))}},Pl={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},zl={class:"flex justify-between items-start mb-3"},Hl={class:"text-xs text-gray-500 mt-0.5"},Ql={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D,w=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],u=q(()=>{const h=t.activities.find(p=>{var R;return p.type==="delivery"||((R=p.action)==null?void 0:R.toLowerCase().includes("delivered"))});if(!h||!h.timestamp)return 0;const c=new Date(h.timestamp),v=Math.abs(new Date-c);return Math.ceil(v/(1e3*60*60*24))}),x=()=>{i("delivery-feedback",t.opportunity)},y=h=>{i("survey-completed",{opportunity:t.opportunity,responses:h})},k=()=>{i("survey-refused",{opportunity:t.opportunity})},f=()=>{i("not-responding",{opportunity:t.opportunity})};return(h,c)=>(a(),m("div",Pl,[e("div",zl,[e("div",null,[c[0]||(c[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Hl,"Vehicle was delivered "+$(u.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:x,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),P(de,{questions:w,onSurveyCompleted:y,onSurveyRefused:k,onNotResponding:f})]))}},Yl={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Kl={class:"flex justify-between items-start mb-3"},Gl={class:"font-bold text-slate-800 text-sm"},Jl={class:"text-xs text-gray-500 mt-0.5"},Xl={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(o,{emit:D}){const t=o,i=D,w=q(()=>{var p;return((p=t.scheduledAppointment)==null?void 0:p.noShowCount)||0}),u=q(()=>{const p=w.value;return p===0?"No-Show Follow-up":p>=3?`No-Show #${p} - Final Warning`:`No-Show #${p} Follow-up`}),x=q(()=>{const p=w.value;return p>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":p>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),y=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],k=q(()=>{var R;return(R=t.scheduledAppointment)!=null&&R.start?new Date(t.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),f=()=>{i("contact-customer",t.opportunity)},h=()=>{const p=w.value;if(p>=3)i("auto-close-lost",{opportunity:t.opportunity,reason:`Automatically closed after ${p} no-shows`});else if(p===1||p===2){const R=new Date;R.setDate(R.getDate()+2),i("set-callback",{opportunity:t.opportunity,callbackDate:R.toISOString()})}else i("reschedule",t.opportunity)},c=p=>{i("survey-completed",{opportunity:t.opportunity,responses:p})},l=()=>{i("survey-refused",{opportunity:t.opportunity})},v=()=>{i("not-responding",{opportunity:t.opportunity})};return(p,R)=>(a(),m("div",Yl,[e("div",Kl,[e("div",null,[e("h4",Gl,$(u.value),1),e("p",Jl,"Appointment was scheduled for "+$(k.value)+" but customer did not show up. "+$(x.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:h,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...R[0]||(R[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),U(" Book Another Appointment ",-1)])]),e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...R[1]||(R[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),U(" Contact Customer ",-1)])])]),P(de,{questions:y,onSurveyCompleted:c,onSurveyRefused:l,onNotResponding:v})]))}},Zl={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},_l={class:"flex justify-between items-start mb-3"},en={class:"text-xs text-gray-500 mt-0.5"},tn={__name:"AbandonedWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(o,{emit:D}){const t=o,i=D;Ke();const w=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],u=q(()=>{const l=t.opportunity.lastActivity||t.opportunity.createdAt;if(!l)return 0;const v=new Date(l),R=Math.abs(new Date-v);return Math.ceil(R/(1e3*60*60*24))}),x=()=>{i("reopen",t.opportunity)},y=()=>{i("close-lost",{opportunity:t.opportunity,reason:"Abandoned - no activity for extended period"})},k=()=>{i("requalify",t.opportunity)},f=l=>{i("survey-completed",{opportunity:t.opportunity,responses:l})},h=()=>{i("survey-refused",{opportunity:t.opportunity})},c=()=>{i("not-responding",{opportunity:t.opportunity})};return(l,v)=>(a(),m("div",Zl,[e("div",_l,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Abandoned",-1)),e("p",en,"This opportunity has been inactive for "+$(u.value)+" days. Consider reopening it or closing as lost.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...v[1]||(v[1]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),U(" Reopen Opportunity ",-1)])]),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...v[2]||(v[2]=[e("i",{class:"fa-solid fa-xmark"},null,-1),U(" Close as Lost ",-1)])]),e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),U(" Requalify as Lead ",-1)])])]),P(de,{questions:w,onSurveyCompleted:f,onSurveyRefused:h,onNotResponding:c})]))}},sn={OOFB:Tl,UFB:Nl,NFU:Rl,OFB:Ul,CFB:El,DFB:Ql,NS:Xl,ABANDONED:tn};function on(o,D,t,i,w){const u=q(()=>{const l=qe(o),v=qe(D),p=qe(t);return{opportunity:l,scheduledAppointment:v,activities:p,hasOffers:(p==null?void 0:p.some(R=>R.type==="offer"))||!1,stage:l.displayStage||l.stage,deliverySubstatus:l.deliverySubstatus||null,formatDateTime:w,hasActiveTaskWidget:!1}}),x=q(()=>{const l=u.value,v=ft(l.stage,l);if(!v)return null;const p=sn[v];return p?{type:v,component:p,props:{opportunity:l.opportunity,appointment:l.scheduledAppointment,activities:l.activities}}:(console.warn(`No component found for widget type: ${v}`),null)}),y=q(()=>({...u.value,hasActiveTaskWidget:!!x.value})),k=q(()=>{const l=y.value,v=bt(l.stage,l);if(!v)return null;const p=i[v.key];return{...v,handler:p||(()=>console.warn(`No handler for action: ${v.key}`))}}),f=q(()=>{const l=y.value;return xt(l.stage,l).map(p=>{const R=i[p.key];return{...p,handler:R||(()=>console.warn(`No handler for action: ${p.key}`))}})}),h=q(()=>{const l=u.value;return ht(l.stage)}),c=q(()=>!x.value||!x.value.type?"":wt(x.value.type));return{primaryAction:k,secondaryActions:f,activeTaskWidget:x,taskWidgetTitle:c,isClosed:h}}const ln=["disabled"],nn={key:0,class:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden max-h-96 overflow-y-auto min-w-full",style:{"z-index":"9999"}},an=["onClick","disabled"],rn={class:"flex-1"},dn={class:"font-medium text-slate-700"},un={key:0,class:"text-xs text-gray-500 mt-0.5"},cn={key:0,class:"px-4 py-3 text-sm text-gray-500 text-center"},pn={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(o,{emit:D}){const t=D,i=S(!1),w=S(null),u=()=>{i.value=!i.value},x=()=>{i.value=!1},y=f=>{f.disabled||(x(),t("action-selected",f),f.handler&&typeof f.handler=="function"&&f.handler())},k=f=>{w.value&&!w.value.contains(f.target)&&x()};return De(()=>{document.addEventListener("click",k)}),dt(()=>{document.removeEventListener("click",k)}),(f,h)=>(a(),m("div",{class:"relative",ref_key:"dropdownRef",ref:w},[e("button",{onClick:u,class:"w-auto bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!o.actions||o.actions.length===0},[h[0]||(h[0]=e("span",null,"More actions",-1)),e("i",{class:F(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":i.value}])},null,2)],8,ln),P(Ye,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:H(()=>[i.value?(a(),m("div",nn,[(a(!0),m(_,null,ee(o.actions,c=>(a(),m("button",{key:c.key,onClick:l=>y(c),class:F(["w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-start gap-3 border-b border-gray-100 last:border-b-0 transition-colors whitespace-nowrap",{"opacity-50 cursor-not-allowed":c.disabled}]),disabled:c.disabled},[e("i",{class:F([c.icon,"text-gray-400 mt-0.5 w-4 flex-shrink-0"])},null,2),e("div",rn,[e("div",dn,$(c.label),1),c.description?(a(),m("div",un,$(c.description),1)):O("",!0)])],10,an))),128)),!o.actions||o.actions.length===0?(a(),m("div",cn," No actions available ")):O("",!0)])):O("",!0)]),_:1})],512))}},mn={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},yn=["src","alt"],gn={key:1,class:"w-full h-full flex items-center justify-center"},vn={class:"flex items-center justify-between mb-1.5"},fn={class:"text-sm font-bold text-gray-900"},bn={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},xn={class:"text-[10px] text-gray-500 mb-1.5"},hn={key:0,class:"text-[10px] text-green-600 font-medium mb-2"},wn={key:1,class:"text-[10px] text-orange-600 font-medium mb-2"},Qe={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(o){const D=o,t=q(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[D.badge]||"gray"),i=w=>w?w.toLocaleString("en-US"):"0";return(w,u)=>(a(),m("div",{onClick:u[1]||(u[1]=x=>w.$emit("select")),class:F(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":o.selected}])},[e("div",mn,[o.vehicle.image?(a(),m("img",{key:0,src:o.vehicle.image,alt:`${o.vehicle.brand} ${o.vehicle.model}`,class:"w-full h-full object-cover"},null,8,yn)):(a(),m("div",gn,[...u[2]||(u[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",vn,[P(B(Le),{text:o.badge,size:"small",theme:t.value},null,8,["text","theme"]),e("span",fn,""+$(i(o.vehicle.price)),1)]),e("h4",bn,$(o.vehicle.brand)+" "+$(o.vehicle.model),1),e("p",xn,$(o.vehicle.year),1),o.stockDays!==null&&o.stockDays!==void 0?(a(),m("div",hn,[u[3]||(u[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),U(" In stock ("+$(o.stockDays)+" days) ",1)])):(a(),m("div",wn,[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),U(" Out of stock ",-1)])])),e("button",{onClick:u[0]||(u[0]=me(x=>w.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},kn={class:"space-y-6 max-h-[75vh] overflow-y-auto px-2"},Cn={key:0},$n={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Sn={class:"mb-4"},An={class:"relative"},Dn={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Tn={key:1,class:"text-center py-8 text-gray-500"},On={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},In={key:0,class:"mt-4 space-y-3"},qn={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Nn={class:"flex justify-end"},Vn=["disabled"],Rn={class:"p-4 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Ln={class:"flex items-center gap-3"},Fn={class:"font-bold text-sm text-gray-800"},Mn={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(o,{emit:D}){const t=o,i=D,w=S(""),u=S(!1),x=S(null),y=S(null),k=S(null),f=S({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""}),h=q(()=>t.requestedVehicle&&t.requestedVehicle.stockDays!==null&&t.requestedVehicle.stockDays!==void 0),c=q(()=>{const b=[];if(t.requestedVehicle&&h.value&&b.push({...t.requestedVehicle,isRequested:!0}),pe&&pe.length>0){const r=pe.filter(I=>t.requestedVehicle?I.brand!==t.requestedVehicle.brand||I.model!==t.requestedVehicle.model:!0),g=t.requestedVehicle&&h.value?3:4;b.push(...r.slice(0,g))}return b}),l=q(()=>{if(!pe||pe.length===0)return[];let b=[...pe];if(w.value){const r=w.value.toLowerCase();b=b.filter(g=>g.brand.toLowerCase().includes(r)||g.model.toLowerCase().includes(r)||g.year.toString().includes(r))}return b}),v=q(()=>f.value.brand&&f.value.model&&f.value.year&&f.value.price>0),p=(b,r)=>{x.value=b,y.value=b.id||`custom-${Date.now()}`,k.value=r},R=()=>{if(!v.value)return;const b={...f.value,id:`custom-${Date.now()}`,isCustom:!0};p(b,"custom")},X=()=>{x.value&&(i("vehicle-selected",{vehicle:x.value,type:k.value}),i("close"),x.value=null,y.value=null,k.value=null,w.value="",u.value=!1,f.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(b,r)=>(a(),Y(ye,{show:o.show,onClose:r[6]||(r[6]=g=>b.$emit("close")),title:"Select Vehicle",size:"6xl"},ut({default:H(()=>[e("div",kn,[c.value.length?(a(),m("div",Cn,[r[7]||(r[7]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),U(" Recommended Vehicles ")],-1)),e("div",$n,[(a(!0),m(_,null,ee(c.value,g=>(a(),Y(Qe,{key:g.id,vehicle:g,badge:g.isRequested?"Requested":"Recommended","stock-days":g.stockDays,selected:y.value===g.id,onSelect:I=>p(g,g.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):O("",!0),e("div",null,[r[10]||(r[10]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),U(" Browse Stock ")],-1)),e("div",Sn,[e("div",An,[r[8]||(r[8]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),E(e("input",{"onUpdate:modelValue":r[0]||(r[0]=g=>w.value=g),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Z,w.value]])])]),l.value.length?(a(),m("div",Dn,[(a(!0),m(_,null,ee(l.value,g=>(a(),Y(Qe,{key:g.id,vehicle:g,badge:"In Stock","stock-days":g.stockDays,selected:y.value===g.id,onSelect:I=>p(g,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(a(),m("div",Tn,[...r[9]||(r[9]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[r[18]||(r[18]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),U(" Configure Custom Vehicle ")],-1)),e("div",On,[r[17]||(r[17]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:r[1]||(r[1]=g=>u.value=!u.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[r[11]||(r[11]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),U(" "+$(u.value?"Hide Configuration":"Build Custom Configuration"),1)]),u.value?(a(),m("div",In,[e("div",qn,[e("div",null,[r[12]||(r[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),E(e("input",{"onUpdate:modelValue":r[2]||(r[2]=g=>f.value.brand=g),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[Z,f.value.brand]])]),e("div",null,[r[13]||(r[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),E(e("input",{"onUpdate:modelValue":r[3]||(r[3]=g=>f.value.model=g),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[Z,f.value.model]])]),e("div",null,[r[14]||(r[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),E(e("input",{"onUpdate:modelValue":r[4]||(r[4]=g=>f.value.year=g),type:"number",class:"input",placeholder:"2024"},null,512),[[Z,f.value.year]])]),e("div",null,[r[15]||(r[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price ()",-1)),E(e("input",{"onUpdate:modelValue":r[5]||(r[5]=g=>f.value.price=g),type:"number",class:"input",placeholder:"98000"},null,512),[[Z,f.value.price]])])]),e("div",Nn,[e("button",{onClick:R,disabled:!v.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...r[16]||(r[16]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),U(" Use Custom Configuration ",-1)])],8,Vn)])])):O("",!0)])])])]),_:2},[x.value?{name:"footer",fn:H(()=>[e("div",Rn,[e("div",Ln,[r[20]||(r[20]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg"},null,-1)),e("div",null,[r[19]||(r[19]=e("p",{class:"text-xs text-gray-500"},"Selected Vehicle",-1)),e("p",Fn,$(x.value.brand)+" "+$(x.value.model)+" ("+$(x.value.year)+") ",1)])]),e("button",{onClick:X,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors shadow-sm"}," Confirm Selection ")])]),key:"0"}:void 0]),1032,["show"]))}},Un={class:"space-y-4"},Bn=["max"],jn={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:D}){const t=o,i=D,w=S(""),u=S(""),x=S(""),y=q(()=>new Date().toISOString().split("T")[0]);ae(()=>t.show,h=>{if(h){const c=new Date;w.value=c.toISOString().split("T")[0],u.value=c.toTimeString().slice(0,5),x.value=""}});const k=()=>{if(!w.value)return;const h=u.value?`${w.value}T${u.value}:00`:`${w.value}T12:00:00`;i("confirm",{contractDate:h,notes:x.value})},f=()=>{i("cancel")};return(h,c)=>(a(),Y(ye,{show:o.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:f},{actions:H(()=>[P(B(he),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!w.value,onClick:k},null,8,["disabled"])]),default:H(()=>[e("div",Un,[e("div",null,[c[3]||(c[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":c[0]||(c[0]=l=>w.value=l),max:y.value,class:"input"},null,8,Bn),[[Z,w.value]])]),e("div",null,[c[4]||(c[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),E(e("input",{type:"time","onUpdate:modelValue":c[1]||(c[1]=l=>u.value=l),class:"input"},null,512),[[Z,u.value]])]),e("div",null,[c[5]||(c[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),E(e("textarea",{"onUpdate:modelValue":c[2]||(c[2]=l=>x.value=l),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[Z,x.value]])])])]),_:1},8,["show"]))}},Wn={class:"space-y-4"},En=["max"],Pn={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:D}){const t=o,i=D,w=S(""),u=S(""),x=S(""),y=S(""),k=q(()=>new Date().toISOString().split("T")[0]);ae(()=>t.show,c=>{if(c){const l=new Date;w.value=l.toISOString().split("T")[0],u.value=l.toTimeString().slice(0,5),x.value="",y.value=""}});const f=()=>{if(!w.value||!x.value)return;const c=u.value?`${w.value}T${u.value}:00`:`${w.value}T12:00:00`;i("confirm",{deliveryDate:c,location:x.value,notes:y.value})},h=()=>{i("cancel")};return(c,l)=>(a(),Y(ye,{show:o.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:h},{actions:H(()=>[P(B(he),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!w.value||!x.value,onClick:f},null,8,["disabled"])]),default:H(()=>[e("div",Wn,[e("div",null,[l[4]||(l[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=v=>w.value=v),max:k.value,class:"input"},null,8,En),[[Z,w.value]])]),e("div",null,[l[5]||(l[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),E(e("input",{type:"time","onUpdate:modelValue":l[1]||(l[1]=v=>u.value=v),class:"input"},null,512),[[Z,u.value]])]),e("div",null,[l[7]||(l[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),E(e("select",{"onUpdate:modelValue":l[2]||(l[2]=v=>x.value=v),class:"input"},[...l[6]||(l[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[re,x.value]])]),e("div",null,[l[8]||(l[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),E(e("textarea",{"onUpdate:modelValue":l[3]||(l[3]=v=>y.value=v),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[Z,y.value]])])])]),_:1},8,["show"]))}},zn={class:"space-y-4"},Hn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:D}){const t=o,i=D,w=S(""),u=S("");ae(()=>t.show,k=>{k&&(w.value="",u.value="")});const x=()=>{w.value&&i("confirm",{reason:w.value,notes:u.value})},y=()=>{i("cancel")};return(k,f)=>(a(),Y(ye,{show:o.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:y},{actions:H(()=>[P(B(he),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!w.value,onClick:x},null,8,["disabled"])]),default:H(()=>[e("div",zn,[e("div",null,[f[3]||(f[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),E(e("select",{"onUpdate:modelValue":f[0]||(f[0]=h=>w.value=h),class:"input"},[...f[2]||(f[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[re,w.value]])]),e("div",null,[f[4]||(f[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),E(e("textarea",{"onUpdate:modelValue":f[1]||(f[1]=h=>u.value=h),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[Z,u.value]])])])]),_:1},8,["show"]))}},Qn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o){return(D,t)=>(a(),Y(ye,{show:o.show,title:"Requalify as Lead",subtitle:"This will convert the opportunity back to a lead. Some data will be lost.",size:"lg",onCancel:t[1]||(t[1]=i=>D.$emit("cancel"))},{actions:H(()=>[P(B(he),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:t[0]||(t[0]=i=>D.$emit("confirm"))})]),default:H(()=>[t[2]||(t[2]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-sm text-gray-600"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),U(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),U(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),U(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},Yn={class:"flex justify-between items-start mb-3"},Kn={class:"font-bold text-slate-800 text-sm"},Gn={class:"text-xs text-gray-500 mt-0.5"},Jn={class:"flex gap-3 flex-wrap"},Xn={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(o){return(D,t)=>(a(),m("div",{class:F(["rounded-lg p-4 relative transition-all duration-300 border",[o.colorScheme.background,o.colorScheme.border]])},[e("div",Yn,[e("div",null,[e("h4",Kn,$(o.action.title),1),e("p",Gn,$(o.action.description),1)])]),e("div",Jn,[e("button",{onClick:t[0]||(t[0]=i=>D.$emit("action-clicked")),class:F([o.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:F(o.action.icon)},null,2),U(" "+$(o.action.label),1)],2)])],2))}},Zn={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-8"},_n={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},ea={class:"p-5 space-y-6"},ta={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},sa={class:"flex gap-3"},oa={key:2,class:"space-y-3"},la={class:"flex items-center gap-2 pb-2 border-b border-gray-200"},na={class:"font-semibold text-gray-900 text-sm"},aa={key:3,class:"flex justify-end"},ia={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(o,{emit:D}){const t=o,i=D,w=Me(),u=Be(),x=S(!1),y=S(!1),k=S(!1),f=S(!1),h=S(!1),c=S(!1),l=S(!1),v=S(!1),p=S(!1),R=S(!1),X=S([]),b=q(()=>{var d,n;return((d=t.opportunity)==null?void 0:d.displayStage)||((n=t.opportunity)==null?void 0:n.stage)||"Qualified"}),r=q(()=>Ge(b.value,"opportunity"));function g(d){return d?new Date(d).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const I={"schedule-appointment":()=>{x.value=!0},"view-or-schedule-appointment":()=>{t.scheduledAppointment?p.value=!0:x.value=!0},"select-vehicle":()=>{l.value=!0},"create-offer":()=>{!t.opportunity.selectedVehicle&&!t.opportunity.vehicle?l.value=!0:y.value=!0},"call-prospect":()=>{v.value=!0},"follow-up-offer":()=>{v.value=!0},"request-decision":()=>{v.value=!0},"finalize-contract":()=>{f.value=!0},"schedule-delivery":()=>{h.value=!0},"confirm-delivery":()=>{h.value=!0},"collect-feedback":()=>{v.value=!0},reschedule:()=>{R.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&le()},"close-won":()=>{f.value=!0},"add-offer":()=>{y.value=!0},"add-contract":()=>{f.value=!0},"extend-deadline":()=>{v.value=!0},"close-lost":()=>{k.value=!0},reopen:()=>{te()},requalify:()=>{c.value=!0}},{primaryAction:j,secondaryActions:K,activeTaskWidget:Q,taskWidgetTitle:A,isClosed:V}=on(Ne(t,"opportunity"),Ne(t,"scheduledAppointment"),Ne(t,"activities"),I,g);function z(d){}function oe(){}function ge(d){l.value=!1,i("vehicle-selected",d),setTimeout(()=>{y.value=!0},300)}function ve(d){y.value=!1,i("offer-created",d)}function ue(d){x.value=!1,i("appointment-scheduled",{...d,opportunityId:t.opportunity.id,customer:t.opportunity.customer.name})}function le(){t.scheduledAppointment&&i("appointment-cancelled",t.scheduledAppointment.id)}function ie(d){f.value=!1,u.modifyOpportunity(t.opportunity.id,{stage:"Closed Won",contractDate:d.contractDate})}function G(d){h.value=!1,u.addActivity(t.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:d})}function ne(d){k.value=!1,u.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:d})}function te(){u.modifyOpportunity(t.opportunity.id,{stage:"Qualified"})}function fe(d){c.value=!1,w.push(`/customer/${d.id}?type=lead`)}function we(d){p.value=!1}function ke(d){R.value=!1}function Ce(d){u.modifyOpportunity(t.opportunity.id,{callbackDate:d.callbackDate})}function be(d){u.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:d.reason||"Multiple no-shows (NS3)"})}return De(()=>{X.value=pe.filter(d=>d.stockDays!==null&&d.stockDays!==void 0).slice(0,5)}),(d,n)=>o.opportunity?(a(),m("div",Zn,[e("div",_n,[n[13]||(n[13]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:F(["text-xs px-3 py-1 rounded-full font-medium border",r.value])},$(o.opportunity.displayStage||o.opportunity.stage),3)]),e("div",ea,[B(V)&&!B(Q)?(a(),m("div",ta,[n[16]||(n[16]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",sa,[e("button",{onClick:te,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...n[14]||(n[14]=[U(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:n[0]||(n[0]=T=>c.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...n[15]||(n[15]=[U(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):O("",!0),!B(V)&&B(j)?(a(),Y(Xn,{key:1,action:B(j),"color-scheme":B(j).colorScheme,onActionClicked:n[1]||(n[1]=T=>B(j).handler())},null,8,["action","color-scheme"])):O("",!0),B(Q)&&B(Q).component?(a(),m("div",oa,[e("div",la,[n[17]||(n[17]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",na,$(B(A)),1)]),(a(),Y(pt(B(Q).component),ct(B(Q).props,{onClose:oe,onSetCallback:Ce,onAutoCloseLost:be}),null,16))])):O("",!0),B(K).length>0?(a(),m("div",aa,[P(pn,{actions:B(K),onActionSelected:z},null,8,["actions"])])):O("",!0),x.value?(a(),Y(St,{key:4,show:x.value,customer:o.opportunity.customer,assignee:o.opportunity.assignee,"disabled-fields":["customer"],onCreate:ue,onCancel:n[2]||(n[2]=T=>x.value=!1)},null,8,["show","customer","assignee"])):O("",!0)]),l.value?(a(),Y(Mn,{key:0,opportunity:o.opportunity,"requested-car":o.opportunity.requestedCar,"recommended-cars":X.value,onVehicleSelected:ge,onClose:n[3]||(n[3]=T=>l.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):O("",!0),y.value?(a(),Y(kt,{key:1,opportunity:o.opportunity,vehicle:o.opportunity.selectedVehicle||o.opportunity.vehicle||o.opportunity.requestedCar,onOfferCreated:ve,onClose:n[4]||(n[4]=T=>y.value=!1)},null,8,["opportunity","vehicle"])):O("",!0),f.value?(a(),Y(jn,{key:2,opportunity:o.opportunity,onContractSet:ie,onClose:n[5]||(n[5]=T=>f.value=!1)},null,8,["opportunity"])):O("",!0),h.value?(a(),Y(Pn,{key:3,opportunity:o.opportunity,onDelivered:G,onClose:n[6]||(n[6]=T=>h.value=!1)},null,8,["opportunity"])):O("",!0),k.value?(a(),Y(Hn,{key:4,opportunity:o.opportunity,onClosed:ne,onClose:n[7]||(n[7]=T=>k.value=!1)},null,8,["opportunity"])):O("",!0),c.value?(a(),Y(Qn,{key:5,opportunity:o.opportunity,onRequalified:fe,onClose:n[8]||(n[8]=T=>c.value=!1)},null,8,["opportunity"])):O("",!0),v.value?(a(),Y(Ct,{key:6,onClose:n[9]||(n[9]=T=>v.value=!1)})):O("",!0),p.value&&o.scheduledAppointment?(a(),Y(At,{key:7,show:p.value,event:o.scheduledAppointment,onClose:n[10]||(n[10]=T=>p.value=!1),onEdit:n[11]||(n[11]=T=>{p.value=!1,R.value=!0}),onDelete:we},null,8,["show","event"])):O("",!0),R.value&&o.scheduledAppointment?(a(),Y(Dt,{key:8,show:R.value,event:o.scheduledAppointment,customer:o.opportunity.customer,"disabled-fields":["customer"],onSave:ke,onCancel:n[12]||(n[12]=T=>R.value=!1)},null,8,["show","event","customer"])):O("",!0)])):O("",!0)}};function ra(o){const D=Ue(),t=Be(),i=q(()=>o.value?o.value.type==="lead"?yl:ia:null),w=q(()=>o.value?o.value.type==="lead"?{currentActivities:q(()=>D.currentLeadActivities),addActivity:(x,y)=>D.addActivity(x,y),updateActivity:(x,y,k)=>D.updateActivity(x,y,k),deleteActivity:(x,y)=>D.deleteActivity(x,y)}:{currentActivities:q(()=>t.currentOpportunityActivities),addActivity:(x,y)=>t.addActivity(x,y),updateActivity:(x,y,k)=>t.updateActivity(x,y,k),deleteActivity:(x,y)=>t.deleteActivity(x,y),addVehicle:(x,y)=>t.addVehicle(x,y),createOffer:(x,y)=>t.createOffer(x,y),loadOpportunityById:x=>t.loadOpportunityById(x)}:null),u=q(()=>o.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:i,storeAdapter:w,addNewConfig:u}}const da={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},ua={key:0},ca={key:1},pa={key:0},ma={key:1},ya={key:2},ga=["onClick"],va=["onClick"],fa=["onClick"],ba={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},xa={key:0,class:"flex-1 flex flex-col overflow-hidden border-l border-gray-200 lg:w-1/2"},ha={key:2,class:"flex-1 flex flex-col overflow-hidden"},wa={class:"lg:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},ka=["title"],Ca={key:3,class:"flex-1 flex items-center justify-center"},$a={__name:"Tasks",setup(o){const D=mt(),t=Me(),i=Ue(),w=Be(),u=Oe(),x=je(),y=S(localStorage.getItem("tasksViewMode")||"table"),k=q(()=>D.query.highlight||null);ae(y,d=>{localStorage.setItem("tasksViewMode",d)});const f=d=>{y.value;const n=z.value;if(y.value=d,d==="table"&&n)t.push({path:"/tasks",query:{highlight:n.compositeId}});else if(d==="card"&&k.value){const[T,M]=k.value.split("-");t.push({path:`/tasks/${M}`,query:{type:T}})}else d==="card"&&!k.value&&!z.value&&t.push({path:"/tasks"})},h=d=>{if(!d)return"No deadline";const n=Je(d);return n.type==="overdue"?"OVERDUE":n.type==="today"||n.type==="urgent"?n.relativeTime:Xe(d)},c=d=>{const n=d.type==="lead"?d.requestedCar:d.vehicle;return!n||!n.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[n.type]||{type:n.type.toLowerCase(),label:n.type}},l=d=>d?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[d.type]||"bg-gray-50 text-gray-700":"",v=d=>{if(!d||!d.assignee)return{name:"Unassigned",initials:"?"};const n=d.assigneeInitials||d.assignee.split(" ").map(T=>T[0]).join("");return{name:d.assignee,initials:n}},p=d=>{if(!d||!d.customer||!d.customer.address)return null;const T=d.customer.address.split(",");return T.length>1&&T[T.length-1].trim().replace(/^\d+\s*/,"").trim()||null},R=d=>{const n=p(d),T=d.source||"Unknown";return n?`${n}  ${T}`:T},X=d=>{const n=d.type==="lead"?d.requestedCar:d.vehicle;if(!n)return"No vehicle";const T=c(d),M=T?T.label:n.type||"Unknown";let C="";return n.kilometers!==void 0&&n.kilometers!==null&&(n.kilometers>=1e3?C=`${(n.kilometers/1e3).toFixed(0)}k`:C=`${n.kilometers}`),C?`${M} / ${C}`:M},b=S("all"),r=S("none"),g=S(null),I=S(!1),j=S(!1),K=S(null),Q=q(()=>{const n=i.leads.filter(C=>!C.isDisqualified).map(C=>{const W={...C,type:"lead",compositeId:`lead-${C.id}`};return!W.customer&&C.customer&&(W.customer=C.customer),W}),T=w.opportunities.map(C=>{const W={...C,type:"opportunity",compositeId:`opportunity-${C.id}`};return!W.customer&&C.customer&&(W.customer=C.customer),W});let M=[];return u.isOperator()?M=n:u.isSalesman()?M=T:M=[...n,...T],M}),A=q(()=>{let d=Q.value;if(b.value!=="all"&&(d=d.filter(n=>n.type===b.value)),r.value==="urgent-first")d=[...d].sort((n,T)=>{if(n.priority==="Hot"&&T.priority!=="Hot")return-1;if(n.priority!=="Hot"&&T.priority==="Hot")return 1;const M=new Date(n.lastActivity||n.createdAt||0);return new Date(T.lastActivity||T.createdAt||0)-M});else if(r.value==="assigned-to-me"){const n=u.currentUser.name;d=d.filter(T=>T.assignee===n),d=[...d].sort((T,M)=>{const C=new Date(T.lastActivity||T.createdAt||0);return new Date(M.lastActivity||M.createdAt||0)-C})}else if(r.value==="assigned-to-my-team"){const n=u.currentUser;let T=[];n.role==="manager"?T=x.users.map(M=>M.name):n.role==="salesman"?T=x.users.filter(M=>M.role==="salesman").map(M=>M.name):n.role==="operator"&&(T=x.users.filter(M=>M.role==="operator").map(M=>M.name)),d=d.filter(M=>T.includes(M.assignee)),d=[...d].sort((M,C)=>{const W=new Date(M.lastActivity||M.createdAt||0);return new Date(C.lastActivity||C.createdAt||0)-W})}else d=[...d].sort((n,T)=>{const M=new Date(n.lastActivity||n.createdAt||0);return new Date(T.lastActivity||T.createdAt||0)-M});return d}),V=q(()=>{const d=Q.value.some(T=>T.type==="lead"),n=Q.value.some(T=>T.type==="opportunity");return d&&n}),z=q(()=>{const d=parseInt(D.params.id),n=D.query.type;if(n){const se=`${n}-${d}`;return Q.value.find($e=>$e.compositeId===se)||null}const T=b.value!=="all"?Q.value.filter(se=>se.type===b.value):Q.value,M=`lead-${d}`,C=`opportunity-${d}`,W=T.find(se=>se.compositeId===M||se.compositeId===C);return W||Q.value.find(se=>se.compositeId===M||se.compositeId===C)||null});q(()=>z.value?z.value.type==="lead"?i.currentLeadActivities:w.currentOpportunityActivities:[]);const oe=ra(z),ge=oe.managementWidget,ve=oe.storeAdapter,ue=oe.addNewConfig,le=q(()=>d=>d.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");De(()=>{i.loadLeads(),w.loadOpportunities();const d=D.params.id;d&&ie(d)}),ae(()=>D.params.id,d=>{d&&ie(d)}),ae(z,d=>{d&&(d.type==="lead"?i.loadLeadById(d.id):w.loadOpportunityById(d.id))},{immediate:!0});const ie=d=>{const n=parseInt(d),T=Q.value.find(M=>M.id===n);T&&(T.type==="lead"?i.loadLeadById(n):w.loadOpportunityById(n))},G=d=>{const[n,T]=d.split("-");y.value==="table"&&(y.value="card"),t.push({path:`/tasks/${T}`,query:{type:n}}),I.value=!1},ne=d=>{g.value=g.value===d?null:d},te=d=>{K.value=d,j.value=!0,g.value=null},fe=d=>{r.value=d},we=async d=>{if(!K.value)return;const n=K.value,T=d.name;n.type==="lead"?await i.modifyLead(n.id,{assignee:T,assigneeType:d.type,teamId:d.type==="team"?d.id:null}):n.type==="opportunity"&&await w.updateOpportunity(n.id,{assignee:T,assigneeType:d.type,teamId:d.type==="team"?d.id:null}),j.value=!1,K.value=null},ke=async d=>{g.value=null,d.type==="lead"?await i.modifyLead(d.id,{priority:"Hot"}):d.type==="opportunity"&&await w.modifyOpportunity(d.id,{priority:"Hot"})},Ce=async d=>{g.value=null,d.type==="lead"?await i.modifyLead(d.id,{priority:"Normal"}):d.type==="opportunity"&&await w.modifyOpportunity(d.id,{priority:"Normal"})},be=d=>({Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"})[d]||"bg-gray-100 text-gray-700";return(d,n)=>{var T,M;return a(),m("div",da,[y.value==="card"?(a(),m("div",{key:0,class:F(["lg:relative lg:block",I.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[P(ps,{title:"Tasks",items:A.value,"selected-id":(T=z.value)==null?void 0:T.compositeId,"type-filter":b.value,"view-mode":y.value,"selected-class":C=>C.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":le.value,"open-menu-id":g.value,getName:C=>{const W=C.customer;return W&&W.name?W.name:W&&!W.name&&W.email&&W.email.split("@")[0]||"Unknown"},getInitials:C=>{const W=C.customer;return W&&W.initials?W.initials:W&&W.name&&W.name.split(" ").map($e=>$e[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:C=>C.type==="lead"?C.requestedCar?`${C.requestedCar.brand} ${C.requestedCar.model}`:"No vehicle specified":C.vehicle?`${C.vehicle.brand} ${C.vehicle.model}`:"No vehicle specified",avatarClass:C=>C.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:G,onMenuClick:ne,onMenuClose:n[0]||(n[0]=C=>g.value=null),onClose:n[1]||(n[1]=C=>I.value=!1),"show-type-filter":V.value,onFilterChange:n[2]||(n[2]=C=>b.value=C),onSortChange:fe,onViewChange:f},{badges:H(({item:C})=>[C&&C.type?(a(),Y(B(Le),{key:0,text:C.type==="lead"?"Lead":"Opportunity",size:"small",theme:C.type==="lead"?"blue":"gray"},null,8,["text","theme"])):O("",!0),C&&C.priority==="Hot"?(a(),Y(B(Le),{key:1,text:"HOT",size:"small",theme:"red"})):O("",!0)]),location:H(({item:C})=>[U($(R(C)),1)]),"vehicle-status":H(({item:C})=>[U($(X(C)),1)]),owner:H(({item:C})=>[C.assignee?(a(),m("span",ua,"Assignee: "+$(C.assignee),1)):(a(),m("span",ca,"Assignee: Unassigned"))]),dates:H(({item:C})=>[C.type==="lead"&&C.nextActionDue?(a(),m("span",pa,"Due: "+$(h(C.nextActionDue)),1)):C.type==="opportunity"&&C.nextActionDue?(a(),m("span",ma,"Due: "+$(h(C.nextActionDue)),1)):(a(),m("span",ya,"Due: No deadline"))]),menu:H(({item:C})=>[e("button",{onClick:me(W=>te(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...n[9]||(n[9]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),U(" Reassign ",-1)])],8,ga),C.priority!=="Hot"?(a(),m("button",{key:0,onClick:me(W=>ke(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...n[10]||(n[10]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),U(" Mark as hot ",-1)])],8,va)):(a(),m("button",{key:1,onClick:me(W=>Ce(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...n[11]||(n[11]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),U(" Unmark as hot ",-1)])],8,fa))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2)):O("",!0),y.value==="table"?(a(),m("div",ba,[P(vs,{tasks:A.value,"current-task-id":(M=z.value)==null?void 0:M.compositeId,"highlight-id":k.value,"type-filter":b.value,"sort-option":r.value,"show-type-filter":V.value,"show-mobile-close":!0,"open-menu-id":g.value,"get-vehicle-type":c,"get-vehicle-type-badge-class":l,"get-owner-info":v,"get-stage-badge-class":be,"view-mode":y.value,onSelect:G,onMenuClick:ne,onMenuClose:n[3]||(n[3]=C=>g.value=null),onFilterChange:n[4]||(n[4]=C=>b.value=C),onSortChange:fe,onReassign:te,onClose:n[5]||(n[5]=C=>I.value=!1),onViewChange:f,class:F(z.value?"lg:w-1/2":"w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","open-menu-id","view-mode","class"]),z.value?(a(),m("div",xa,[P(He,{task:z.value,type:z.value.type,"management-widget":B(ge),"store-adapter":B(ve),"add-new-config":B(ue)},{"pinned-extra":H(({task:C})=>[...n[12]||(n[12]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):O("",!0)])):O("",!0),y.value==="card"&&z.value?(a(),m("div",ha,[e("div",wa,[e("button",{onClick:n[6]||(n[6]=C=>f(y.value==="card"?"table":"card")),class:"w-14 h-14 bg-gray-700 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all hover:scale-110",title:y.value==="card"?"Switch to Table":"Switch to Cards"},[e("i",{class:F(y.value==="card"?"fa-solid fa-table text-lg":"fa-solid fa-list text-lg")},null,2)],8,ka),e("button",{onClick:n[7]||(n[7]=C=>I.value=!I.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...n[13]||(n[13]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])]),P(He,{task:z.value,type:z.value.type,"management-widget":B(ge),"store-adapter":B(ve),"add-new-config":B(ue)},{"pinned-extra":H(({task:C})=>[...n[14]||(n[14]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):O("",!0),!z.value&&y.value==="card"?(a(),m("div",Ca,[...n[15]||(n[15]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])])):O("",!0),P(Tt,{show:j.value,onClose:n[8]||(n[8]=C=>j.value=!1),onConfirm:we},null,8,["show"])])}}},Ba=Fe($a,[["__scopeId","data-v-fa5b4d26"]]);export{Ba as default};
