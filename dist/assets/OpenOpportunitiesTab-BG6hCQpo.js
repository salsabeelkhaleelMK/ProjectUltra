import{y as K}from"./components-WJKgpbNX.js";import{n as N}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{u as L}from"./opportunities-C7VMVq_4.js";import{g as W,c as j,f as H}from"./opportunityRules-DVPgyxsv.js";import{u as J}from"./useCustomersTable-CT-fT-ee.js";import{K as P,r as n,c as Q,I as X,m as Y,d as I,o as T,e as o,s as c,B as a,g as Z,y as i,t as ee,k as U,G as te}from"./index-BSxt259F.js";import{u as se}from"./useTableRowSelection-Bs49OKi4.js";import"./sparkles-ByigpcXa.js";import"./vehicles-sZbJG44U.js";const oe={class:"mb-8"},ie={class:"bg-white"},ne={key:0,class:"flex items-center gap-2"},ae={class:"flex items-center gap-2 mr-1"},le={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},re={__name:"OpenOpportunitiesTab",emits:["row-click"],setup(ue,{emit:B}){const l=L(),{rowSelection:r,selectedCount:R,hasSelection:_,getSelectedRows:$,clearSelection:d}=se(e=>e.id),m=n({pageIndex:0,pageSize:10}),p=n(""),g=n([]),f=n([]),y=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",u=Q(()=>l.opportunities.filter(e=>e.stage!=="Closed Won"&&e.stage!=="Closed Lost"&&e.stage!=="In Negotiation"&&e.stage!=="In negotiation").map(e=>{var s,x,b,w,k,C,D,S,h,O,F,A;const t=((s=e.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${e.id}`,stageKey:"open-opportunities",customer:((x=e.customer)==null?void 0:x.name)||"Unknown",email:((b=e.customer)==null?void 0:b.email)||"",initials:((w=e.customer)==null?void 0:w.initials)||((C=(k=e.customer)==null?void 0:k.name)==null?void 0:C.slice(0,2).toUpperCase())||"?",nextAction:H(e.expectedCloseDate)||"No due date",nextActionFull:j(e.expectedCloseDate),deadlineStatus:W(e.expectedCloseDate),car:`${((D=e.vehicle)==null?void 0:D.brand)||""} ${((S=e.vehicle)==null?void 0:S.model)||""}`.trim()||"N/A",carStatus:((h=e.vehicle)==null?void 0:h.stockDays)!==void 0&&((O=e.vehicle)==null?void 0:O.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((F=e.vehicle)==null?void 0:F.stockDays)!==void 0&&((A=e.vehicle)==null?void 0:A.stockDays)!==null?"bg-green-100 text-green-700":"bg-muted text-muted-foreground",requestType:e.requestType||"Opportunity",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:y(e.createdAt),lastAppointment:t?y(t):"N/A",status:X(e,"opportunity"),statusClass:"bg-purple-100 text-purple-700",priority:e.priority||"Normal"}})),V=B,v=e=>{e.id.startsWith("opp-")&&V("row-click",e)},z=n("open-opportunities"),{columns:M,filterDefinitions:q,tableMeta:E}=J(z,v),G=()=>{const e=$(u.value);e.length!==0&&confirm(`Are you sure you want to delete ${e.length} ${e.length===1?"opportunity":"opportunities"}?`)&&(e.forEach(t=>{const s=t.id.replace("opp-","");l.deleteOpportunity(s)}),d())};return Y(async()=>{await l.fetchOpportunities()}),(e,t)=>(T(),I("div",oe,[o("div",ie,[c(i(K),{data:u.value,columns:i(M),meta:i(E),onRowClick:v,columnFiltersOptions:{filterDefs:i(q)},pagination:m.value,"onUpdate:pagination":t[0]||(t[0]=s=>m.value=s),globalFilter:p.value,"onUpdate:globalFilter":t[1]||(t[1]=s=>p.value=s),sorting:g.value,"onUpdate:sorting":t[2]||(t[2]=s=>g.value=s),columnFilters:f.value,"onUpdate:columnFilters":t[3]||(t[3]=s=>f.value=s),rowSelection:i(r),"onUpdate:rowSelection":t[4]||(t[4]=s=>te(r)?r.value=s:null),paginationOptions:{rowCount:u.value.length},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":a(()=>[...t[5]||(t[5]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":a(()=>[i(_)?(T(),I("div",ne,[o("div",ae,[o("div",le,ee(i(R)),1),t[6]||(t[6]=o("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),t[9]||(t[9]=o("div",{class:"h-4 w-px bg-greys-700"},null,-1)),c(i(N),{variant:"ghost",size:"sm",onClick:G},{default:a(()=>[...t[7]||(t[7]=[o("i",{class:"fa-solid fa-trash mr-2"},null,-1),U(" Delete ",-1)])]),_:1}),c(i(N),{variant:"ghost",size:"sm",onClick:i(d)},{default:a(()=>[...t[8]||(t[8]=[o("i",{class:"fa-solid fa-x mr-2"},null,-1),U(" Close ",-1)])]),_:1},8,["onClick"])])):Z("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])]))}},be=P(re,[["__scopeId","data-v-93fcb08d"]]);export{be as default};
