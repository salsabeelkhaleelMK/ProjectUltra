import{u as _,r as m,O as z,d as N,P as S,Q as A,c as d,j as H,a as t,e as G,F as $,g as I,x as i,b as V,y as c,D,A as L,z as T,n as b,t as n,B as q,T as X,l as Y,o as r}from"./index-BO-ic-g4.js";import{_ as Z}from"./PageHeader-Dii1HdrE.js";import{b as ee}from"./formatters-CNf1MjAs.js";const te={class:"page-container"},se={class:"p-4 md:p-8"},ae={class:"flex items-center gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide"},oe=["onClick"],le={class:"text-sm font-medium text-foreground whitespace-nowrap"},ne={class:"mb-6 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3"},ie={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3"},re={class:"flex flex-wrap items-center gap-2 md:gap-3"},ue={class:"w-full sm:w-auto sm:min-w-[260px] sm:max-w-md"},pe={class:"relative"},de={class:"flex justify-end"},ce={key:0,class:"empty-state"},me={key:1,class:"card overflow-hidden"},be={class:"overflow-x-auto -mx-4 md:mx-0"},xe={class:"w-full"},ge={class:"divide-y divide-gray-100"},ye=["onClick"],ve={class:"px-3 md:px-6 py-3 whitespace-nowrap"},fe={class:"flex items-center gap-2 md:gap-3"},we={class:"w-9 h-9 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-xs font-bold shrink-0"},he={class:"min-w-0"},ke={class:"text-content-bold truncate"},Ce={class:"text-meta truncate hidden sm:block"},Ne={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Se={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Ae={class:"flex items-center gap-2"},Ve={class:"text-content font-medium truncate max-w-[120px]"},De={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Te={class:"px-3 md:px-6 py-3 text-content text-gray-600 whitespace-nowrap"},qe={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Me={class:"flex items-center gap-2"},Ue={class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},$e={class:"text-content text-gray-600 truncate max-w-[80px] hidden md:inline"},Ie={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Le={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 my-4 max-h-[90vh] overflow-y-auto animate-fade-in"},Oe={class:"p-5 border-b border-gray-100 bg-gray-50/50"},Re={class:"modal-title"},je={class:"p-5 space-y-4"},Be={key:0},Ke={key:1},Pe={key:2},Qe={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},_e={__name:"Pipeline",setup(Je){const h=Y(),M=_(),x=m(z),u=m("open-leads"),g=m(""),y=m(!1),v=m(!1),p=m({status:"",priority:"",source:""}),l=m({customerName:"",email:"",vehicle:"",value:"",probability:"",reason:""}),O=N(()=>{const o=[{key:"open-leads",label:"Open Leads",count:x.value.openLeads,borderColor:"border-t-blue-600",badgeColor:"bg-blue-600 text-white"},{key:"open-opportunities",label:"Open opportunities",count:x.value.openOpportunities,borderColor:"border-t-orange-500",badgeColor:"bg-orange-500 text-white"},{key:"in-negotiation",label:"In negotiation",count:x.value.inNegotiation,borderColor:"border-t-blue-500",badgeColor:"bg-blue-500 text-white"},{key:"won",label:"Won",count:x.value.won,borderColor:"border-t-green-500",badgeColor:"bg-green-500 text-white"},{key:"lost",label:"Lost",count:x.value.lost,borderColor:"border-t-red-500",badgeColor:"bg-red-500 text-white"}];return M.isOperator()?o.filter(e=>e.key==="open-leads"):M.isSalesman()?o.filter(e=>e.key!=="open-leads"):o}),R=()=>({"open-leads":"Create New Lead","open-opportunities":"Create New Opportunity","in-negotiation":"Create New Opportunity",won:"Add Won Deal",lost:"Add Lost Deal"})[u.value]||"Add New",j=()=>({"open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Deal",lost:"Deal"})[u.value]||"Item",B=()=>{l.value={customerName:"",email:"",vehicle:"",value:"",probability:"",reason:""},y.value=!1},K=N(()=>{let o=S;v.value?o=S.filter(a=>a.isDisqualified===!0):o=S.filter(a=>!a.isDisqualified);const e=o.map(a=>({id:`lead-${a.id}`,stageKey:"open-leads",customer:a.customer.name,email:a.customer.email,initials:a.customer.initials||a.customer.name.slice(0,2).toUpperCase(),nextAction:ee(a.nextActionDue)||"No due date",car:`${a.requestedCar.brand} ${a.requestedCar.model}`,carStatus:a.carStatus||"New",carStatusClass:a.carStatus==="New"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",requestType:a.requestType||"Quotation",source:a.source||"Marketing",assignee:a.assignee,assigneeInitials:a.assigneeInitials||(a.assignee?a.assignee.slice(0,2).toUpperCase():"NA"),createdAt:f(a.createdAt),lastActivity:f(a.lastActivity),status:a.status,statusClass:W(a.status),priority:a.priority})),s=A.map(a=>{let w="open-opportunities";return a.stage==="In Negotiation"||a.stage==="In negotiation"?w="in-negotiation":a.stage==="Closed"&&(w="won"),{id:`opp-${a.id}`,stageKey:w,customer:a.customer.name,email:a.customer.email,initials:a.customer.initials||a.customer.name.slice(0,2).toUpperCase(),nextAction:"1h 12m",car:`${a.vehicle.brand} ${a.vehicle.model}`,carStatus:"New",carStatusClass:"bg-green-100 text-green-700",requestType:"Opportunity",source:"Marketing",assignee:a.assignee,assigneeInitials:a.assignee?a.assignee.slice(0,2).toUpperCase():"NA",createdAt:f(a.createdAt),lastActivity:f(a.lastActivity),status:a.stage,statusClass:w==="in-negotiation"?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700",priority:"Normal"}}),C=[{id:"won-1",stageKey:"won",customer:"John Doe",email:"john.doe@example.com",initials:"JD",nextAction:"-",car:"Audi A6",carStatus:"New",carStatusClass:"bg-green-100 text-green-700",requestType:"Quotation",source:"Marketing",assignee:"Michael Thomas",assigneeInitials:"MT",createdAt:"15/03/2025",lastActivity:"15/03/2025",status:"Won",statusClass:"bg-green-100 text-green-700",priority:"Normal"}],F=[{id:"lost-1",stageKey:"lost",customer:"Jane Smith",email:"jane.smith@example.com",initials:"JS",nextAction:"-",car:"BMW X5",carStatus:"New",carStatusClass:"bg-green-100 text-green-700",requestType:"Test Drive",source:"Marketing",assignee:"Sarah Jenkins",assigneeInitials:"SJ",createdAt:"10/03/2025",lastActivity:"10/03/2025",status:"Lost",statusClass:"bg-red-100 text-red-700",priority:"Normal"}];return[...e,...s,...C,...F]}),U=N(()=>{let o=K.value.filter(e=>e.stageKey===u.value);if(g.value){const e=g.value.toLowerCase();o=o.filter(s=>s.customer.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)||s.car.toLowerCase().includes(e))}return p.value.status&&(o=o.filter(e=>e.status===p.value.status)),p.value.priority&&(o=o.filter(e=>e.priority===p.value.priority)),p.value.source&&(o=o.filter(e=>e.source===p.value.source)),o}),P=o=>{u.value=o},Q=()=>{},k=()=>{},J=()=>{p.value={status:"",priority:"",source:""},g.value=""},W=o=>({Valid:"bg-green-100 text-green-700","Not valid":"bg-red-100 text-red-700",Qualified:"bg-gray-100 text-gray-700","Not interested":"bg-red-100 text-red-700",Open:"bg-blue-100 text-blue-700"})[o]||"bg-gray-100 text-gray-700",f=o=>o?new Date(o).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",E=o=>{const e=o.id.match(/-(\d+)$/);if(u.value==="open-leads"&&o.id.startsWith("lead-")){const s=e?e[1]:o.id.replace("lead-","");h.push({path:`/tasks/${s}`,query:{type:"lead"}})}else if(o.id.startsWith("opp-")){const s=e?e[1]:o.id.replace("opp-","");h.push({path:`/tasks/${s}`,query:{type:"opportunity"}})}else(o.stageKey==="won"||o.stageKey==="lost")&&A.length>0&&h.push({path:`/tasks/${A[0].id}`,query:{type:"opportunity"}})};return(o,e)=>(r(),d("div",te,[H(Z,{title:"Pipeline",subtitle:"Manage your opportunities and deals"}),t("div",se,[t("div",ae,[(r(!0),d($,null,I(O.value,s=>(r(),d("button",{key:s.key,onClick:C=>P(s.key),class:b(["flex items-center justify-between gap-3 px-4 py-3 bg-white border border-border rounded-lg cursor-pointer hover:shadow-sm transition-all shrink-0 min-w-[160px] border-t-4",u.value===s.key?s.borderColor:"border-t-border"])},[t("span",le,n(s.label),1),t("span",{class:b(["px-2.5 py-1 text-sm font-semibold rounded-full min-w-[32px] text-center",u.value===s.key?s.badgeColor:"bg-muted text-muted-foreground"])},n(s.count),3)],10,oe))),128))]),t("div",ne,[t("div",ie,[t("div",re,[t("div",ue,[t("div",pe,[e[20]||(e[20]=t("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onInput:Q,type:"text",placeholder:"Search or ask a question",class:"input-with-icon"},null,544),[[c,g.value]])])]),i(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value.status=s),onChange:k,class:"input text-sm w-auto shrink-0"},[...e[21]||(e[21]=[L('<option value="">Status</option><option value="Valid">Valid</option><option value="Not valid">Not valid</option><option value="Qualified">Qualified</option><option value="Not interested">Not interested</option>',5)])],544),[[D,p.value.status]]),i(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>p.value.priority=s),onChange:k,class:"input text-sm w-auto shrink-0"},[...e[22]||(e[22]=[t("option",{value:""},"Priority",-1),t("option",{value:"Hot"},"Hot",-1),t("option",{value:"Normal"},"Normal",-1)])],544),[[D,p.value.priority]]),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.value.source=s),onChange:k,class:"input text-sm w-auto shrink-0"},[...e[23]||(e[23]=[t("option",{value:""},"Source",-1),t("option",{value:"Marketing"},"Marketing",-1)])],544),[[D,p.value.source]]),e[25]||(e[25]=t("button",{class:"btn-secondary text-sm"},[t("i",{class:"fa-solid fa-plus mr-1"}),T(" More filters ")],-1)),t("button",{onClick:J,class:"btn-secondary text-sm"}," Clear "),e[26]||(e[26]=t("button",{class:"btn-secondary text-sm"}," Save ",-1)),u.value==="open-leads"?(r(),d("button",{key:0,onClick:e[4]||(e[4]=s=>v.value=!v.value),class:b(["btn-secondary text-sm flex items-center gap-2 transition-colors",v.value?"bg-red-50 border-red-300 text-red-700 hover:bg-red-100":""])},[e[24]||(e[24]=t("i",{class:"fa-solid fa-ban"},null,-1)),T(" "+n(v.value?"Hide Disqualified":"Show Disqualified"),1)],2)):V("",!0)]),t("div",de,[u.value==="open-leads"||u.value==="open-opportunities"?(r(),d("button",{key:0,onClick:e[5]||(e[5]=s=>y.value=!0),class:"btn-primary-lg"},[...e[27]||(e[27]=[t("i",{class:"fa-solid fa-plus"},null,-1),T(" Add new ",-1)])])):V("",!0)])])]),U.value.length===0?(r(),d("div",ce,[...e[28]||(e[28]=[t("i",{class:"fa-solid fa-inbox empty-state-icon"},null,-1),t("p",{class:"empty-state-text"},"No records found",-1)])])):(r(),d("div",me,[t("div",be,[t("table",xe,[e[32]||(e[32]=t("thead",{class:"bg-gray-50 border-b border-gray-200"},[t("tr",null,[t("th",{class:"px-3 md:px-6 py-3 text-left"},[t("input",{type:"checkbox",class:"rounded"})]),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Customer"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Next action due"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Requested car"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Car status"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Source"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Assignee"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Status"),t("th",{class:"px-3 md:px-6 py-3"})])],-1)),t("tbody",ge,[(r(!0),d($,null,I(U.value,s=>(r(),d("tr",{key:s.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:C=>E(s)},[t("td",{class:"px-3 md:px-6 py-3 whitespace-nowrap",onClick:e[6]||(e[6]=q(()=>{},["stop"]))},[...e[29]||(e[29]=[t("input",{type:"checkbox",class:"rounded"},null,-1)])]),t("td",ve,[t("div",fe,[t("div",we,n(s.initials),1),t("div",he,[t("div",ke,n(s.customer),1),t("div",Ce,n(s.email),1)])])]),t("td",Ne,[t("span",{class:b(["text-content font-medium",s.priority==="Hot"?"text-red-600":"text-gray-600"])},n(s.nextAction),3)]),t("td",Se,[t("div",Ae,[e[30]||(e[30]=t("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"},null,-1)),t("span",Ve,n(s.car),1)])]),t("td",De,[t("span",{class:b(["badge-ui font-semibold",s.carStatusClass])},n(s.carStatus),3)]),t("td",Te,n(s.source),1),t("td",qe,[t("div",Me,[t("div",Ue,n(s.assigneeInitials),1),t("span",$e,n(s.assignee),1)])]),t("td",Ie,[t("span",{class:b(["badge-ui font-semibold",s.statusClass])},n(s.status),3)]),t("td",{class:"px-3 md:px-6 py-3 whitespace-nowrap",onClick:e[7]||(e[7]=q(()=>{},["stop"]))},[...e[31]||(e[31]=[t("button",{class:"text-gray-400 hover:text-gray-600"},[t("i",{class:"fa-solid fa-ellipsis-vertical"})],-1)])])],8,ye))),128))])])]),e[33]||(e[33]=L('<div class="px-4 md:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3"><div class="text-sm text-gray-600 flex items-center"> Rows per page: <select class="ml-2 input text-sm w-auto"><option>10</option><option>25</option><option>50</option><option>100</option></select></div><div class="flex items-center gap-1 md:gap-2 flex-wrap"><button class="btn-secondary text-sm whitespace-nowrap">Previous</button><button class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg font-medium">1</button><button class="btn-secondary text-sm">2</button><button class="btn-secondary text-sm hidden sm:inline-block">3</button><span class="px-2 text-sm text-gray-500 hidden sm:inline">...</span><button class="btn-secondary text-sm whitespace-nowrap">Next</button></div></div>',1))]))]),(r(),G(X,{to:"body"},[y.value?(r(),d("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",onClick:e[19]||(e[19]=q(s=>y.value=!1,["self"]))},[t("div",Le,[t("div",Oe,[t("h3",Re,n(R()),1),e[34]||(e[34]=t("p",{class:"modal-subtitle"},"Fill in the details below",-1))]),t("div",je,[u.value==="open-leads"?(r(),d("div",Be,[e[35]||(e[35]=t("label",{class:"block label-upper mb-2"},"Customer Name",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,l.value.customerName]]),e[36]||(e[36]=t("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.email=s),type:"email",placeholder:"customer@example.com",class:"input"},null,512),[[c,l.value.email]]),e[37]||(e[37]=t("label",{class:"block label-upper mb-2 mt-4"},"Requested Vehicle",-1)),i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.vehicle=s),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"input"},null,512),[[c,l.value.vehicle]])])):u.value==="open-opportunities"||u.value==="in-negotiation"?(r(),d("div",Ke,[e[38]||(e[38]=t("label",{class:"block label-upper mb-2"},"Customer Name",-1)),i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,l.value.customerName]]),e[39]||(e[39]=t("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),i(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.value.vehicle=s),type:"text",placeholder:"e.g., Porsche Taycan",class:"input"},null,512),[[c,l.value.vehicle]]),e[40]||(e[40]=t("label",{class:"block label-upper mb-2 mt-4"},"Opportunity Value",-1)),i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.value.value=s),type:"number",placeholder:"0",class:"input"},null,512),[[c,l.value.value]]),e[41]||(e[41]=t("label",{class:"block label-upper mb-2 mt-4"},"Probability (%)",-1)),i(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.value.probability=s),type:"number",min:"0",max:"100",placeholder:"75",class:"input"},null,512),[[c,l.value.probability]])])):(r(),d("div",Pe,[e[42]||(e[42]=t("label",{class:"block label-upper mb-2"},"Customer Name",-1)),i(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,l.value.customerName]]),e[43]||(e[43]=t("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),i(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>l.value.vehicle=s),type:"text",placeholder:"Vehicle model",class:"input"},null,512),[[c,l.value.vehicle]]),e[44]||(e[44]=t("label",{class:"block label-upper mb-2 mt-4"},"Reason",-1)),i(t("textarea",{"onUpdate:modelValue":e[17]||(e[17]=s=>l.value.reason=s),rows:"3",placeholder:"Reason for {{ activeTab === 'won' ? 'win' : 'loss' }}...",class:"input resize-none"},null,512),[[c,l.value.reason]])]))]),t("div",Qe,[t("button",{onClick:e[18]||(e[18]=s=>y.value=!1),class:"btn-secondary text-sm"}," Cancel "),t("button",{onClick:B,class:"btn-primary"}," Create "+n(j()),1)])])])):V("",!0)]))]))}};export{_e as default};
