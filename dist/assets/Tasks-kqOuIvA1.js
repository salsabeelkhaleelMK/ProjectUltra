const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calendar-DiXbb47i.js","assets/index-BO-ic-g4.js","assets/index-DC-wTrY8.css"])))=>i.map(i=>d[i]);
import{r as A,d as N,c as n,o as l,a as e,b as g,t as y,z as F,n as j,x as O,y as U,F as G,g as ee,B as ae,C as ve,j as Y,D as de,i as pe,w as me,e as K,f as Z,k as P,E as vt,G as ft,T as De,u as Ie,H as bt,I as Te,A as ot,J as it,l as _e,_ as xt,K as ht,L as rt,M as wt}from"./index-BO-ic-g4.js";import{useOpportunitiesStore as dt}from"./opportunities-lBb1Lrhg.js";import{u as ut}from"./users-D24nIegu.js";import{f as $e,a as Ae,b as kt,c as $t}from"./formatters-CNf1MjAs.js";import{createCalendarEvent as Xe}from"./calendar-DiXbb47i.js";import{_ as qe}from"./ModalShell-CKwPbxO4.js";const Ct={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},St={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},At={class:"flex items-center gap-3"},Dt={class:"font-bold text-lg text-gray-800"},Tt={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},It={class:"flex gap-2"},qt={class:"px-5 py-3"},Ot={class:"relative"},Nt=["placeholder"],Mt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Vt=["onClick"],Lt=["onClick"],jt={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Ft={class:"flex items-start gap-3.5 pr-6"},Rt={class:"flex-1 min-w-0"},Ut={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Et={class:"text-gray-600 text-xs mt-1 truncate"},Pt={class:"mt-3"},Bt={class:"flex items-center justify-between gap-2"},Wt={class:"flex items-center gap-2 flex-wrap flex-1"},zt={class:"text-right shrink-0"},Ht={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change","close"],setup(t,{emit:C}){const s={mounted(m,c){m.clickOutsideEvent=u=>{m===u.target||m.contains(u.target)||c.value()},document.addEventListener("click",m.clickOutsideEvent)},unmounted(m){document.removeEventListener("click",m.clickOutsideEvent)}},v=t,a=A(""),i=N(()=>{let m=v.items;if(v.typeFilter&&v.typeFilter!=="all"&&(m=m.filter(c=>c.type===v.typeFilter)),a.value){const c=a.value.toLowerCase();m=m.filter(u=>{const o=v.getName(u).toLowerCase(),r=v.getVehicleInfo(u).toLowerCase();return o.includes(c)||r.includes(c)})}return m}),p=m=>{const c=m.compositeId||`${m.type||"task"}-${m.id}`||m.id;return v.selectedId===c};return(m,c)=>(l(),n("div",Ct,[e("div",St,[e("div",At,[t.showMobileClose?(l(),n("button",{key:0,onClick:c[0]||(c[0]=u=>m.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...c[5]||(c[5]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):g("",!0),e("h2",Dt,y(t.title),1)]),c[6]||(c[6]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[F(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(l(),n("div",Tt,[e("div",It,[e("button",{onClick:c[1]||(c[1]=u=>m.$emit("filter-change","all")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:c[2]||(c[2]=u=>m.$emit("filter-change","lead")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:c[3]||(c[3]=u=>m.$emit("filter-change","opportunity")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):g("",!0),e("div",qt,[e("div",Ot,[c[7]||(c[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),O(e("input",{"onUpdate:modelValue":c[4]||(c[4]=u=>a.value=u),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Nt),[[U,a.value]])])]),e("div",Mt,[(l(!0),n(G,null,ee(i.value,u=>(l(),n("div",{key:u.id,onClick:o=>m.$emit("select",u.compositeId||`${u.type||"task"}-${u.id}`||u.id),class:j(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",p(u)?typeof t.selectedClass=="function"?t.selectedClass(u):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(u):t.unselectedClass])},[t.showMenu?(l(),n("button",{key:0,onClick:ae(o=>m.$emit("menu-click",u.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...c[8]||(c[8]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,Lt)):g("",!0),t.openMenuId===u.id&&t.showMenu?O((l(),n("div",jt,[ve(m.$slots,"menu",{item:u})])),[[s,()=>m.$emit("menu-close")]]):g("",!0),e("div",Ft,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(u)])},y(t.getInitials(u)),3),e("div",Rt,[e("div",Ut,y(t.getName(u)),1),e("div",Et,y(t.getVehicleInfo(u)),1)])]),e("div",Pt,[e("div",Bt,[e("div",Wt,[ve(m.$slots,"badges",{item:u})]),e("div",zt,[ve(m.$slots,"meta",{item:u}),ve(m.$slots,"footer",{item:u})])])])],10,Vt))),128))])]))}},Qt={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Yt={class:"flex items-center gap-3"},Kt={key:2,class:"font-bold text-lg text-gray-800"},Gt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Jt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Xt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Zt={class:"text-sm"},_t={key:2,class:"space-y-6 relative z-10"},es={key:0,class:"mb-4 pl-12"},ts={class:"text-sm font-semibold text-gray-800"},ss={class:"flex gap-4 relative mb-6"},os={class:"flex-1 min-w-0"},ls={class:"text-sm text-slate-700 leading-snug"},as={class:"font-bold"},ns={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},is={class:"text-xs text-gray-400 mt-1"},lt={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:C}){const s=t,v=c=>{const u={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return u[c]||u.default},a=c=>{const u={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return u[c]||u.default},i=c=>{if(!c)return"";const u=new Date(c),o=new Date,r=new Date(o);return r.setDate(r.getDate()-1),u.toDateString()===o.toDateString()?"Today":u.toDateString()===r.toDateString()?"Yesterday":u.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=c=>c?new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",m=(c,u)=>{if(c===0)return!0;const o=s.activities[c-1];if(!o)return!0;const r=new Date(u.timestamp).toDateString(),f=new Date(o.timestamp).toDateString();return r!==f};return(c,u)=>t.show?(l(),n("div",{key:0,class:j(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Qt,[e("div",Yt,[t.mobileFullscreen?(l(),n("button",{key:0,onClick:u[0]||(u[0]=o=>c.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...u[2]||(u[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(l(),n("button",{key:1,onClick:u[1]||(u[1]=o=>c.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:j(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):g("",!0),t.collapsed?g("",!0):(l(),n("h2",Kt,y(t.title),1))])]),t.collapsed?g("",!0):(l(),n("div",Gt,[t.activities.length>0?(l(),n("div",Jt)):g("",!0),t.activities.length===0?(l(),n("div",Xt,[u[3]||(u[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Zt,y(t.emptyMessage),1)])):(l(),n("div",_t,[(l(!0),n(G,null,ee(t.activities,(o,r)=>(l(),n(G,{key:o.id},[m(r,o)?(l(),n("div",es,[e("h3",ts,y(i(o.timestamp)),1)])):g("",!0),e("div",ss,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",a(o.type)])},[e("i",{class:j([v(o.type),"text-sm"])},null,2)],2),e("div",os,[e("div",ls,[e("span",as,y(o.user),1),F(" "+y(o.action),1)]),o.content?(l(),n("div",ns,y(o.content),1)):g("",!0),e("div",is,y(p(o.timestamp)),1)])])],64))),128))]))]))],2)):g("",!0)}},rs={class:"w-full"},ds={class:"flex items-center justify-between gap-3 md:gap-4"},us={class:"flex items-center gap-3 md:gap-4 flex-1"},cs={class:"min-w-0 flex-1"},ms={class:"heading-main truncate"},ps={class:"flex flex-wrap items-center gap-2 mt-1"},ys={class:"flex items-center gap-1 ml-2"},gs={class:"relative"},vs={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},fs={key:0,class:"border-t border-gray-100 my-1"},bs={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},xs={class:"flex items-center gap-4"},hs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ws={class:"flex items-center gap-2"},ks={class:"text-xs text-gray-900 font-medium"},$s={class:"flex items-center gap-2"},Cs={class:"text-xs text-gray-900 font-medium"},Ss={class:"flex items-center gap-2"},As={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},Ds={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},Ts={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},Is={class:"text-xs text-gray-900 font-medium"},qs={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},Os={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action"],setup(t,{emit:C}){const s={mounted(u,o){u.clickOutsideEvent=r=>{u===r.target||u.contains(r.target)||o.value()},document.addEventListener("click",u.clickOutsideEvent)},unmounted(u){document.removeEventListener("click",u.clickOutsideEvent)}},v=C,a=A(!1),i=A(!1),p=A(null),m=u=>{i.value=!1,v("action",u)},c=async(u,o)=>{try{await navigator.clipboard.writeText(u),p.value=o,setTimeout(()=>{p.value=null},1500)}catch(r){console.error("Failed to copy:",r)}};return(u,o)=>(l(),n("div",rs,[e("div",ds,[e("div",us,[e("div",{class:j(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},y(t.initials),3),e("div",cs,[e("h1",ms,y(t.name),1),e("div",ps,[ve(u.$slots,"tags")])])]),e("div",ys,[e("div",gs,[e("button",{onClick:o[0]||(o[0]=ae(r=>i.value=!i.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors"},[...o[12]||(o[12]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),i.value?O((l(),n("div",vs,[e("button",{onClick:o[1]||(o[1]=r=>m("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note "),e("button",{onClick:o[2]||(o[2]=r=>m("purchase-method")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase Method "),e("button",{onClick:o[3]||(o[3]=r=>m("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in "),e("button",{onClick:o[4]||(o[4]=r=>m("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment "),o[16]||(o[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),e("button",{onClick:o[5]||(o[5]=r=>m("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...o[13]||(o[13]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),F(" WhatsApp msg ",-1)])]),e("button",{onClick:o[6]||(o[6]=r=>m("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...o[14]||(o[14]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),F(" Email ",-1)])]),e("button",{onClick:o[7]||(o[7]=r=>m("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...o[15]||(o[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),F(" SMS ",-1)])]),t.taskType==="opportunity"?(l(),n("div",fs)):g("",!0),t.taskType==="opportunity"?(l(),n("button",{key:1,onClick:o[8]||(o[8]=r=>m("appointment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Appointment ")):g("",!0)])),[[s,()=>i.value=!1]]):g("",!0)]),e("button",{onClick:o[9]||(o[9]=r=>a.value=!a.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:j(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":a.value}])},null,2)])])]),a.value?(l(),n("div",bs,[e("div",xs,[e("div",hs,[e("div",ws,[o[18]||(o[18]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ks,y(t.email),1),e("button",{onClick:o[10]||(o[10]=ae(r=>c(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...o[17]||(o[17]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",$s,[o[20]||(o[20]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",Cs,y(t.phone),1),e("button",{onClick:o[11]||(o[11]=ae(r=>c(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...o[19]||(o[19]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",Ss,[e("div",As,[t.thirdFieldLabel.toLowerCase().includes("address")?(l(),n("i",Ds)):(l(),n("i",Ts))]),e("span",Is,y(t.thirdFieldValue),1)])])]),p.value?(l(),n("div",qs,y(p.value==="email"?"Email":"Phone")+" copied! ",1)):g("",!0)])):g("",!0)]))}},Ns={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},Ms=["onClick"],Vs={class:"hidden md:inline whitespace-nowrap"},Ls={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const C={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},s=v=>C[v]||"fa-solid fa-circle";return(v,a)=>(l(),n("div",Ns,[(l(!0),n(G,null,ee(t.tabs,i=>(l(),n("div",{key:i.key,onClick:p=>v.$emit("update:modelValue",i.key),class:j(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===i.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[e("i",{class:j([s(i.key),"text-base md:text-base"])},null,2),e("span",Vs,y(i.label),1),i.count!==void 0?(l(),n("span",{key:0,class:j(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===i.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},y(i.count),3)):g("",!0)],10,Ms))),128))]))}},js={class:"metadata-bar w-full"},Fs={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Rs={class:"text-xs sm:text-sm font-bold text-gray-800"},Us={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Es={class:"text-xs sm:text-sm font-bold text-gray-800"},Ps={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Bs={class:"text-xs sm:text-sm font-bold text-gray-800"},Ws={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""}},setup(t){return(C,s)=>(l(),n("div",js,[e("div",Fs,[s[0]||(s[0]=e("span",{class:"label-upper text-xs"},"Stage",-1)),e("span",Rs,y(t.stage),1)]),s[4]||(s[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Us,[s[1]||(s[1]=e("span",{class:"label-upper text-xs"},"Owner",-1)),e("span",Es,y(t.owner),1)]),t.source?(l(),n(G,{key:0},[s[3]||(s[3]=e("div",{class:"metadata-divider"},null,-1)),e("div",Ps,[s[2]||(s[2]=e("span",{class:"label-upper text-xs"},"Source",-1)),e("span",Bs,y(t.source),1)])],64)):g("",!0)]))}},zs={key:0,class:"flex-grow border-t border-gray-200"},Hs={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Qs={key:0,class:"border-t border-gray-100 my-1"},Ys={key:0,class:"border-t border-gray-100 my-1"},Ks={key:1,class:"flex-grow border-t border-gray-200"},at={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","purchase-method","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:C}){const s={mounted(b,h){b.clickOutsideEvent=S=>{b===S.target||b.contains(S.target)||h.value()},document.addEventListener("click",b.clickOutsideEvent)},unmounted(b){document.removeEventListener("click",b.clickOutsideEvent)}},v=t,a=C,i=A(!1),p=N(()=>v.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 md:px-4 py-2 md:py-2 text-xs md:text-sm rounded-lg shadow-sm transition-all flex items-center justify-center gap-1.5 md:gap-2 z-20 relative whitespace-nowrap":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),m={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},c=N(()=>{if(!v.activeTab||v.activeTab==="overview")return v.actions.filter(h=>!m[h]);const b=Object.entries(m).filter(([,h])=>h===v.activeTab).map(([h])=>h);return v.actions.filter(h=>b.includes(h))}),u=N(()=>c.value.some(b=>["email","whatsapp","sms"].includes(b))),o=N(()=>c.value.some(b=>["addVehicle","configureVehicle"].includes(b))),r=N(()=>c.value.some(b=>["note","purchase-method","tradein","attachment","requestedCar"].includes(b))),f=()=>{c.value.length===1?k(c.value[0]):i.value=!i.value},k=b=>{i.value=!1,a("action",b)};return(b,h)=>t.show?(l(),n("div",{key:0,class:j(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?g("",!0):(l(),n("div",zs)),e("div",{class:j(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:ae(f,["stop"]),class:j(p.value)},[...h[10]||(h[10]=[e("i",{class:"fa-solid fa-plus text-[10px] md:text-xs"},null,-1),e("span",{class:"text-xs md:text-sm"},"Add new",-1)])],2),i.value?O((l(),n("div",Hs,[o.value?(l(),n(G,{key:0},[c.value.includes("addVehicle")?(l(),n("button",{key:0,onClick:h[0]||(h[0]=S=>k("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):g("",!0),c.value.includes("configureVehicle")?(l(),n("button",{key:1,onClick:h[1]||(h[1]=S=>k("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):g("",!0)],64)):g("",!0),r.value?(l(),n(G,{key:1},[o.value?(l(),n("div",Qs)):g("",!0),c.value.includes("note")?(l(),n("button",{key:1,onClick:h[2]||(h[2]=S=>k("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):g("",!0),c.value.includes("purchase-method")?(l(),n("button",{key:2,onClick:h[3]||(h[3]=S=>k("purchase-method")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase Method ")):g("",!0),c.value.includes("tradein")?(l(),n("button",{key:3,onClick:h[4]||(h[4]=S=>k("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):g("",!0),c.value.includes("requestedCar")?(l(),n("button",{key:4,onClick:h[5]||(h[5]=S=>k("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):g("",!0),c.value.includes("attachment")?(l(),n("button",{key:5,onClick:h[6]||(h[6]=S=>k("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):g("",!0)],64)):g("",!0),u.value?(l(),n(G,{key:2},[r.value||o.value?(l(),n("div",Ys)):g("",!0),c.value.includes("email")?(l(),n("button",{key:1,onClick:h[7]||(h[7]=S=>k("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[11]||(h[11]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),F(" Send Email ",-1)])])):g("",!0),c.value.includes("whatsapp")?(l(),n("button",{key:2,onClick:h[8]||(h[8]=S=>k("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[12]||(h[12]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),F(" Send WhatsApp ",-1)])])):g("",!0),c.value.includes("sms")?(l(),n("button",{key:3,onClick:h[9]||(h[9]=S=>k("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[13]||(h[13]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),F(" Send SMS ",-1)])])):g("",!0)],64)):g("",!0)])),[[s,()=>i.value=!1]]):g("",!0)],2),t.inline?g("",!0):(l(),n("div",Ks))],2)):g("",!0)}},Gs={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Js={class:"flex items-start gap-3"},Xs={class:"flex-1 min-w-0"},Zs={class:"font-bold text-sm text-slate-800 mb-2"},_s={class:"space-y-1.5 text-xs text-gray-600"},eo={class:"flex items-center gap-2"},to={class:"flex items-center gap-2"},so={class:"flex items-center gap-2"},oo={key:0,class:"mt-2"},lo={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const C=t,s=N(()=>C.appointmentData.date?new Date(C.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),v=N(()=>C.appointmentData.time?C.appointmentData.time:""),a=i=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[i==null?void 0:i.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(i,p)=>(l(),n("div",Gs,[e("div",Js,[p[3]||(p[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Xs,[e("h4",Zs,y(t.appointmentData.type),1),e("div",_s,[e("div",eo,[p[0]||(p[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,y(s.value),1)]),e("div",to,[p[1]||(p[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,y(v.value),1)]),e("div",so,[p[2]||(p[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,y(t.appointmentData.assignee),1)])]),t.appointmentData.status?(l(),n("div",oo,[e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",a(t.appointmentData.status)])},y(t.appointmentData.status),3)])):g("",!0)])])]))}},ao={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},no={class:"flex-1"},io={class:"flex items-center gap-2 mb-1"},ro={class:"text-xs font-bold text-slate-800"},uo={class:"text-[10px] text-gray-400"},co={class:"text-[10px] text-gray-400"},mo={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},po={class:"ml-auto relative"},yo={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},go={key:0,class:"text-sm text-slate-700"},vo={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},fo={key:2,class:"mt-2"},bo={key:0},xo={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},ho={key:0},wo={class:"text-sm font-bold text-slate-800"},ko={key:0,class:"text-xs text-gray-600 mt-0.5"},$o={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},Co={key:0},So={key:1},Ao={key:2},Do={key:3},To={key:4},Io={key:1},qo={class:"text-sm font-bold text-slate-800 mb-2"},Oo={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},No={key:0},Mo={class:"text-slate-700 font-medium ml-1"},Vo={key:1},Lo={class:"text-slate-700 font-medium ml-1"},jo={key:2},Fo={class:"text-slate-700 font-medium ml-1"},Ro={key:3},Uo={class:"text-slate-700 font-medium ml-1"},Eo={key:4},Po={class:"text-slate-700 font-medium ml-1"},Bo={key:5},Wo={class:"text-slate-700 font-medium ml-1"},zo={key:2,class:"flex items-center gap-3"},Ho={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Qo=["src"],Yo={class:"flex-1"},Ko={class:"text-sm font-bold text-slate-800"},Go={class:"text-xs text-gray-500"},Jo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Xo={key:3,class:"flex items-center gap-3"},Zo={class:"flex-1"},_o={class:"text-sm font-bold text-slate-800"},el={class:"text-xs text-gray-500"},tl={key:0,class:"text-xs text-gray-400 mt-1"},sl={key:1,class:"text-xs text-gray-600 mt-1"},ol={__name:"TaskCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:C}){const s=t,v=C,a=A(!1),i={mounted(k,b){k.clickOutsideEvent=h=>{k===h.target||k.contains(h.target)||b.value()},setTimeout(()=>{document.addEventListener("click",k.clickOutsideEvent)},0)},unmounted(k){document.removeEventListener("click",k.clickOutsideEvent)}},p=k=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[k]||"fa-solid fa-circle",m=k=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[k]||"bg-gray-100 text-gray-600 border-gray-200",c=k=>{if(!k)return"Just now";const b=new Date(k),S=new Date-b,V=Math.floor(S/6e4),R=Math.floor(V/60),Q=Math.floor(R/24);return V<1?"Just now":V<60?`${V} minutes ago`:R<24?`${R} hours ago`:Q===1?"Yesterday":Q<7?`${Q} days ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},u=k=>k?new Intl.NumberFormat("en-US").format(k):"0",o=k=>k?new Date(k).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",r=()=>{a.value=!1,v("edit",s.item)},f=()=>{a.value=!1,confirm("Are you sure you want to delete this item?")&&v("delete",s.item)};return(k,b)=>(l(),n("div",ao,[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",m(t.item.type)])},[e("i",{class:j([p(t.item.type),"text-sm"])},null,2)],2),e("div",no,[e("div",io,[e("span",ro,y(t.customerInitials),1),e("span",uo,y(t.item.action||"added"),1),e("span",co,"• "+y(c(t.item.timestamp)),1),t.item.autoDetected?(l(),n("span",mo,"Auto-detected")):g("",!0),e("div",po,[e("button",{onClick:b[0]||(b[0]=ae(h=>a.value=!a.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),a.value?O((l(),n("div",yo,[e("button",{onClick:r,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...b[2]||(b[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),F(" Edit ",-1)])]),e("button",{onClick:f,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...b[3]||(b[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),F(" Delete ",-1)])])])),[[i,()=>a.value=!1]]):g("",!0)])]),t.item.content?(l(),n("div",go,y(t.item.content),1)):g("",!0),t.item.fileName?(l(),n("div",vo,[b[4]||(b[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,y(t.item.fileName),1)])):g("",!0),t.item.data?(l(),n("div",fo,[t.item.type==="appointment"?(l(),n("div",bo,[Y(lo,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(l(),n("div",xo,[t.item.type==="tradein"?(l(),n("div",ho,[e("h4",wo,y(t.item.data.brand)+" "+y(t.item.data.model),1),t.item.data.version?(l(),n("p",ko,y(t.item.data.version),1)):g("",!0),e("div",$o,[t.item.data.year?(l(),n("div",Co,[b[5]||(b[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),F(y(t.item.data.year),1)])):g("",!0),t.item.data.km?(l(),n("div",So,[b[6]||(b[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),F(y(t.item.data.km)+" km ",1)])):g("",!0),t.item.data.plate?(l(),n("div",Ao,[b[7]||(b[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),F(y(t.item.data.plate),1)])):g("",!0),t.item.data.date?(l(),n("div",Do,[b[8]||(b[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),F(y(o(t.item.data.date)),1)])):g("",!0),t.item.data.class?(l(),n("div",To,[b[9]||(b[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),F(y(t.item.data.class),1)])):g("",!0)])])):t.item.type==="financing"?(l(),n("div",Io,[e("h4",qo,y(t.item.data.product),1),e("div",Oo,[t.item.data.provider?(l(),n("div",No,[b[10]||(b[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Mo,y(t.item.data.provider),1)])):g("",!0),t.item.data.total?(l(),n("div",Vo,[b[11]||(b[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Lo,"€"+y(u(t.item.data.total)),1)])):g("",!0),t.item.data.monthly?(l(),n("div",jo,[b[12]||(b[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Fo,"€"+y(u(t.item.data.monthly)),1)])):g("",!0),t.item.data.deposit?(l(),n("div",Ro,[b[13]||(b[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Uo,"€"+y(u(t.item.data.deposit)),1)])):g("",!0),t.item.data.startDate?(l(),n("div",Eo,[b[14]||(b[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Po,y(o(t.item.data.startDate)),1)])):g("",!0),t.item.data.expDate?(l(),n("div",Bo,[b[15]||(b[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Wo,y(o(t.item.data.expDate)),1)])):g("",!0)])])):t.item.type==="offer"?(l(),n("div",zo,[t.item.data.image?(l(),n("div",Ho,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Qo)])):g("",!0),e("div",Yo,[e("h4",Ko,y(t.item.data.brand)+" "+y(t.item.data.model)+" ("+y(t.item.data.year)+")",1),e("p",Go,"€ "+y(u(t.item.data.price)),1)]),t.item.data.isMainOffer?(l(),n("span",Jo,"Main Offer")):g("",!0)])):t.item.type==="purchase"?(l(),n("div",Xo,[e("div",Zo,[e("h4",_o,y(t.item.data.brand)+" "+y(t.item.data.model)+" ("+y(t.item.data.year)+")",1),e("p",el,"€ "+y(u(t.item.data.price)),1),t.item.data.purchaseDate?(l(),n("p",tl,"Purchased: "+y(o(t.item.data.purchaseDate)),1)):g("",!0),t.item.data.notes?(l(),n("p",sl,y(t.item.data.notes),1)):g("",!0)])])):g("",!0)]))])):g("",!0)])]))}},ll={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},al={class:"flex justify-between items-center mb-4"},nl={class:"text-sm font-bold text-slate-800"},Je={__name:"InlineFormShell",props:{title:{type:String,required:!0}},emits:["close"],setup(t){return(C,s)=>(l(),n("div",ll,[s[2]||(s[2]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",al,[e("h5",nl,y(t.title),1),e("button",{onClick:s[0]||(s[0]=v=>C.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),ve(C.$slots,"default")]))}},il={class:"mb-3"},rl={class:"flex justify-end gap-2"},dl={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(""),i=A(""),p=()=>{!a.value.trim()&&!i.value||v("save",{type:"communication",action:`sent via ${s.type}`,content:a.value||`Sent template: ${i.value}`,communicationType:s.type})};return(m,c)=>(l(),n("div",null,[e("div",il,[c[4]||(c[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),O(e("select",{"onUpdate:modelValue":c[0]||(c[0]=u=>i.value=u),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...c[3]||(c[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[de,i.value]])]),O(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=u=>a.value=u),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[U,a.value]]),e("div",rl,[e("button",{onClick:c[2]||(c[2]=u=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},ul={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ct={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A("");pe(()=>{s.item&&(a.value=s.item.content||"")});const i=()=>{var p,m;a.value.trim()&&v("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:a.value,timestamp:((m=s.item)==null?void 0:m.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(p,m)=>(l(),n("div",null,[e("div",null,[m[2]||(m[2]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),O(e("textarea",{"onUpdate:modelValue":m[0]||(m[0]=c=>a.value=c),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[U,a.value]])]),e("div",ul,[e("button",{onClick:m[1]||(m[1]=c=>p.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:i,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},cl={class:"flex items-center gap-3"},ml={key:0,class:"text-sm text-slate-600"},pl={key:1,class:"text-sm text-gray-400"},yl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},gl=["disabled"],vl={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(null),i=A("");pe(()=>{s.item&&(i.value=s.item.fileName||"")});const p=c=>{const u=c.target.files[0];u&&(a.value=u,i.value=u.name)},m=()=>{var c,u;!a.value&&!s.item||v("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:i.value,timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,u)=>(l(),n("div",null,[e("div",null,[u[3]||(u[3]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",cl,[e("input",{type:"file",onChange:p,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:u[0]||(u[0]=o=>c.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...u[2]||(u[2]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),F("Choose File ",-1)])]),i.value?(l(),n("span",ml,y(i.value),1)):(l(),n("span",pl,"No file selected"))])]),e("div",yl,[e("button",{onClick:u[1]||(u[1]=o=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:m,disabled:!a.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,gl)])]))}},fl={class:"animate-fade-in"},bl={class:"space-y-4"},xl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},hl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wl={class:"block text-xs font-medium text-slate-700 mb-1"},kl={key:0,class:"space-y-4 pt-2 border-t border-gray-100"},$l={key:1,class:"space-y-4 pt-2 border-t border-gray-100"},Cl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Sl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Al={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dl=["value"],Tl={key:2,class:"space-y-4 pt-2 border-t border-gray-100"},Il={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ql={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ol={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Nl=["value"],Ml={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Vl=["disabled"],Ll={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A({method:"cash",brand:"",model:"",year:"",price:"",purchaseDate:"",productName:"",provider:"",deposit:"",loanTerm:36,leaseTerm:36,residualValue:"",startDate:"",expDate:"",notes:""});pe(()=>{s.item&&s.item.data&&(a.value={method:s.item.data.method||"cash",brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||s.item.data.total||"",purchaseDate:s.item.data.purchaseDate||"",productName:s.item.data.productName||s.item.data.product||"",provider:s.item.data.provider||"",deposit:s.item.data.deposit||"",loanTerm:s.item.data.loanTerm||36,leaseTerm:s.item.data.leaseTerm||36,residualValue:s.item.data.residualValue||"",startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",notes:s.item.data.notes||""})});const i=N(()=>{if(a.value.method==="financing"){const u=parseFloat(a.value.price||0)-parseFloat(a.value.deposit||0),o=parseFloat(a.value.loanTerm||36);if(u>0&&o>0)return Math.round(u/o).toString()}return"0"}),p=N(()=>{if(a.value.method==="lease"){const u=parseFloat(a.value.price||0)-parseFloat(a.value.residualValue||0)-parseFloat(a.value.deposit||0),o=parseFloat(a.value.leaseTerm||36);if(u>0&&o>0)return Math.round(u/o).toString()}return"0"}),m=N(()=>{const u=a.value.brand&&a.value.model&&a.value.price;return a.value.method==="cash"?u:a.value.method==="financing"?u&&a.value.productName:a.value.method==="lease"?u&&a.value.provider:!1}),c=()=>{var f,k;if(!m.value)return;const u={cash:"Cash",financing:"Financing",lease:"Lease"}[a.value.method],o=s.item?`updated purchase method: ${u}`:`added purchase method: ${u}`,r={method:a.value.method,brand:a.value.brand,model:a.value.model,year:a.value.year||new Date().getFullYear(),price:a.value.price,notes:a.value.notes||""};a.value.method==="cash"?r.purchaseDate=a.value.purchaseDate||new Date().toISOString().split("T")[0]:a.value.method==="financing"?(r.productName=a.value.productName,r.provider=a.value.provider||"Audi Financial",r.deposit=a.value.deposit,r.loanTerm=a.value.loanTerm,r.monthlyPayment=i.value,r.startDate=a.value.startDate,r.expDate=a.value.expDate):a.value.method==="lease"&&(r.provider=a.value.provider,r.leaseTerm=a.value.leaseTerm,r.deposit=a.value.deposit,r.residualValue=a.value.residualValue,r.monthlyPayment=p.value,r.startDate=a.value.startDate,r.expDate=a.value.expDate),v("save",{id:((f=s.item)==null?void 0:f.id)||Date.now(),type:"purchase-method",action:o,data:r,timestamp:((k=s.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(u,o)=>(l(),n("div",fl,[e("div",bl,[e("div",null,[o[21]||(o[21]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Payment Method",-1)),O(e("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.method=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...o[20]||(o[20]=[e("option",{value:"cash"},"Cash",-1),e("option",{value:"financing"},"Financing",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[de,a.value.method]])]),e("div",xl,[e("div",null,[o[22]||(o[22]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),O(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=r=>a.value.brand=r),placeholder:"e.g., Audi",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.brand]])]),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),O(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=r=>a.value.model=r),placeholder:"e.g., Q4 e-tron",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.model]])])]),e("div",hl,[e("div",null,[o[24]||(o[24]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[3]||(o[3]=r=>a.value.year=r),placeholder:"2024",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.year]])]),e("div",null,[e("label",wl,y(a.value.method==="cash"?"Purchase Price (€)":"Total Amount (€)"),1),O(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=r=>a.value.price=r),placeholder:"45000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.price]])])]),a.value.method==="cash"?(l(),n("div",kl,[e("div",null,[o[25]||(o[25]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":o[5]||(o[5]=r=>a.value.purchaseDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.purchaseDate]])])])):g("",!0),a.value.method==="financing"?(l(),n("div",$l,[e("div",Cl,[e("div",null,[o[26]||(o[26]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial Product",-1)),O(e("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=r=>a.value.productName=r),placeholder:"e.g., Auto Loan Plus",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.productName]])]),e("div",null,[o[27]||(o[27]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Provider",-1)),O(e("input",{type:"text","onUpdate:modelValue":o[7]||(o[7]=r=>a.value.provider=r),placeholder:"e.g., Audi Financial",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.provider]])])]),e("div",Sl,[e("div",null,[o[28]||(o[28]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[8]||(o[8]=r=>a.value.deposit=r),placeholder:"5000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.deposit]])]),e("div",null,[o[29]||(o[29]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Loan Term (months)",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[9]||(o[9]=r=>a.value.loanTerm=r),placeholder:"36",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.loanTerm]])])]),e("div",Al,[e("div",null,[o[30]||(o[30]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":o[10]||(o[10]=r=>a.value.startDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.startDate]])]),e("div",null,[o[31]||(o[31]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"End Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":o[11]||(o[11]=r=>a.value.expDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.expDate]])])]),e("div",null,[o[32]||(o[32]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),e("input",{type:"text",value:i.value,readonly:"",class:"w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,8,Dl)])])):g("",!0),a.value.method==="lease"?(l(),n("div",Tl,[e("div",Il,[e("div",null,[o[33]||(o[33]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Lease Provider",-1)),O(e("input",{type:"text","onUpdate:modelValue":o[12]||(o[12]=r=>a.value.provider=r),placeholder:"e.g., Audi Leasing",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.provider]])]),e("div",null,[o[34]||(o[34]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Lease Term (months)",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[13]||(o[13]=r=>a.value.leaseTerm=r),placeholder:"36",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.leaseTerm]])])]),e("div",ql,[e("div",null,[o[35]||(o[35]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Down Payment (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[14]||(o[14]=r=>a.value.deposit=r),placeholder:"3000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.deposit]])]),e("div",null,[o[36]||(o[36]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Residual Value (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":o[15]||(o[15]=r=>a.value.residualValue=r),placeholder:"15000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.residualValue]])])]),e("div",Ol,[e("div",null,[o[37]||(o[37]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":o[16]||(o[16]=r=>a.value.startDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.startDate]])]),e("div",null,[o[38]||(o[38]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"End Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":o[17]||(o[17]=r=>a.value.expDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,a.value.expDate]])])]),e("div",null,[o[39]||(o[39]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),e("input",{type:"text",value:p.value,readonly:"",class:"w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,8,Nl)])])):g("",!0),e("div",null,[o[40]||(o[40]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes",-1)),O(e("textarea",{"onUpdate:modelValue":o[18]||(o[18]=r=>a.value.notes=r),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Additional details..."},null,512),[[U,a.value.notes]])])]),e("div",Ml,[e("button",{onClick:o[19]||(o[19]=r=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:c,disabled:!m.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"}," Save ",8,Vl)])]))}},jl={class:"animate-fade-in"},Fl={class:"space-y-4"},Rl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ul={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},El={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Pl=["disabled"],Bl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});pe(()=>{s.item&&s.item.data&&(a.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const i=()=>{var p,m;a.value.brand&&v("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:a.value.class,brand:a.value.brand,model:a.value.model||"Unknown Model",year:a.value.date?new Date(a.value.date).getFullYear():"Unknown Year",km:a.value.km||"0",plate:a.value.plate||"",date:a.value.date||""},timestamp:((m=s.item)==null?void 0:m.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(p,m)=>(l(),n("div",jl,[e("div",Fl,[e("div",null,[m[9]||(m[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),O(e("select",{"onUpdate:modelValue":m[0]||(m[0]=c=>a.value.class=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...m[8]||(m[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[de,a.value.class]])]),e("div",Rl,[e("div",null,[m[10]||(m[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),O(e("input",{type:"text","onUpdate:modelValue":m[1]||(m[1]=c=>a.value.brand=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.brand]])]),e("div",null,[m[11]||(m[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),O(e("input",{type:"text","onUpdate:modelValue":m[2]||(m[2]=c=>a.value.model=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.model]])])]),e("div",null,[m[12]||(m[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),O(e("input",{type:"text","onUpdate:modelValue":m[3]||(m[3]=c=>a.value.version=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.version]])]),e("div",Ul,[e("div",null,[m[13]||(m[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),O(e("input",{type:"number","onUpdate:modelValue":m[4]||(m[4]=c=>a.value.km=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.km]])]),e("div",null,[m[14]||(m[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),O(e("input",{type:"text","onUpdate:modelValue":m[5]||(m[5]=c=>a.value.plate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.plate]])])]),e("div",null,[m[15]||(m[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),O(e("input",{type:"date","onUpdate:modelValue":m[6]||(m[6]=c=>a.value.date=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,a.value.date]])])]),e("div",El,[e("button",{onClick:m[7]||(m[7]=c=>p.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:i,disabled:!a.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Pl)])]))}},Wl=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function zl(t){const{store:C,taskId:s,getTabForItemType:v,isOverviewModalAction:a}=t,i=A("overview"),p=A(null),m=A(null),c=A("email"),u=A([]),o=N(()=>[...C.currentActivities.value,...u.value.filter(V=>!V.activityId)].filter(V=>{const R=v(V.type);return i.value==="overview"?R==="overview":R===i.value}).sort((V,R)=>{const Q=new Date(V.timestamp||0);return new Date(R.timestamp||0)-Q})),r=S=>(m.value=null,i.value==="overview"&&a(S)?{modalAction:S}:(["email","whatsapp","sms"].includes(S)?(c.value=S,p.value="communication"):p.value=S,null)),f=async S=>{var V;if(S.isEdit){const R=u.value.findIndex(Q=>Q.id===S.id);R>-1&&(u.value[R]={...u.value[R],...S}),(V=m.value)!=null&&V.activityId&&await C.updateActivity(s.value,m.value.activityId,{type:S.communicationType||S.type,user:"You",action:S.action,content:S.content,fileName:S.fileName,data:S.data})}else{const R=S.communicationType||S.type,Q=await C.addActivity(s.value,{type:R,user:"You",action:S.action,content:S.content,fileName:S.fileName,data:S.data});u.value.push({id:Q.id,type:R==="email"||R==="whatsapp"||R==="sms"?"communication":R,action:S.action,content:S.content,fileName:S.fileName,data:S.data,timestamp:Q.timestamp,activityId:Q.id})}p.value=null,m.value=null},k=()=>{p.value=null,m.value=null},b=S=>{m.value=S,p.value=S.type},h=async S=>{const V=u.value.findIndex(R=>R.id===S.id);V>-1&&u.value.splice(V,1),S.activityId&&await C.deleteActivity(s.value,S.activityId)};return me(i,()=>{p.value=null,m.value=null}),{activeTab:i,showInlineWidget:p,editingItem:m,communicationType:c,inlineContent:u,filteredInlineContent:o,handleAddNewAction:r,handleWidgetSave:f,handleWidgetCancel:k,handleEditItem:b,handleDeleteItem:h}}const Hl={class:"flex-1 flex flex-col overflow-hidden"},Ql={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Yl={class:"px-4 md:px-8 py-4 md:py-6"},Kl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Gl={class:"mb-4"},Jl={key:0,class:"mb-6"},Xl={key:1,class:"space-y-6 mb-6"},Zl={key:3},_l={key:4,class:"space-y-4 mb-6 px-1"},ea={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},ta={class:"p-6"},sa={class:"flex justify-between items-center mb-4"},oa={class:"text-sm font-bold text-slate-800"},la={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const C=t,s=N(()=>C.task.id),v=A(!1),a=A(null),i=A(!1),{activeTab:p,showInlineWidget:m,editingItem:c,communicationType:u,inlineContent:o,filteredInlineContent:r,handleAddNewAction:f,handleWidgetSave:k,handleWidgetCancel:b,handleEditItem:h,handleDeleteItem:S}=zl({store:C.storeAdapter,taskId:s,getTabForItemType:Wl,isOverviewModalAction:D=>p.value==="overview"&&C.addNewConfig.overviewActions.includes(D)}),V=D=>{const L=f(D);L&&L.modalAction&&(a.value=L.modalAction,v.value=!0)},R=()=>{v.value=!1,a.value=null},Q=async D=>{await k(D),R()},J=D=>{if(D==="appointment"&&C.type==="opportunity"){i.value=!i.value;return}const L={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",appointment:"overview"};if(["purchase-method","tradein"].includes(D))a.value=D,v.value=!0;else{const z=L[D];z?(p.value=z,setTimeout(()=>{V(D),setTimeout(()=>{const te=document.querySelector(".animate-fade-in");te&&te.scrollIntoView({behavior:"smooth",block:"start"})},100)},50)):V(D)}},ie=N(()=>{const D=[...C.storeAdapter.currentActivities.value,...o.value],L=D.length,z=D.filter(T=>["call","email","sms","whatsapp","communication"].includes(T.type)).length,te=D.filter(T=>T.type==="note").length,I=D.filter(T=>T.type==="attachment").length;return[{key:"overview",label:"Overview",count:L},{key:"note",label:"Notes",count:te},{key:"communication",label:"Communication",count:z},{key:"attachment",label:"Attachments",count:I}]}),re=N(()=>[...C.storeAdapter.currentActivities.value,...o.value]),w=D=>({email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"})[D]||"Send Message";return(D,L)=>(l(),n("div",Hl,[e("header",Ql,[e("div",Yl,[Y(Os,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","task-type":t.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:J},{tags:Z(()=>[(l(!0),n(G,null,ee(t.task.tags,z=>(l(),n("span",{key:z,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},y(z),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),e("main",Kl,[e("div",Gl,[Y(Ls,{modelValue:P(p),"onUpdate:modelValue":L[0]||(L[0]=z=>vt(p)?p.value=z:null),tabs:ie.value,class:"mb-0"},null,8,["modelValue","tabs"])]),P(p)==="overview"?(l(),n("div",Jl,[Y(Ws,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||""},null,8,["stage","owner","source"])])):g("",!0),P(p)==="overview"?(l(),n("div",Xl,[(l(),K(ft(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:re.value,"trigger-appointment-modal":t.type==="opportunity"?i.value:!1,onOpenPurchaseMethod:L[1]||(L[1]=()=>{a.value="purchase-method",v.value=!0}),onOpenTradeIn:L[2]||(L[2]=()=>{a.value="tradein",v.value=!0})},null,40,["lead","opportunity","activities","trigger-appointment-modal"])),t.addNewConfig.overviewActions.length?(l(),K(at,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":P(p),onAction:V},null,8,["actions","active-tab"])):g("",!0),ve(D.$slots,"pinned-extra",{task:t.task})])):g("",!0),P(p)!=="overview"?(l(),K(at,{key:2,actions:t.addNewConfig.tabActions,"active-tab":P(p),onAction:V},null,8,["actions","active-tab"])):g("",!0),P(p)!=="overview"?(l(),n("div",Zl,[P(m)==="communication"?(l(),K(Je,{key:0,title:w(P(u)),onClose:P(b)},{default:Z(()=>[Y(dl,{type:P(u),"task-type":t.type,"task-id":t.task.id,onSave:P(k),onCancel:P(b)},null,8,["type","task-type","task-id","onSave","onCancel"])]),_:1},8,["title","onClose"])):g("",!0),P(m)==="note"?(l(),K(Je,{key:1,title:P(c)?"Edit Note":"Add Note",onClose:P(b)},{default:Z(()=>[Y(ct,{item:P(c),"task-type":t.type,"task-id":t.task.id,onSave:P(k),onCancel:P(b)},null,8,["item","task-type","task-id","onSave","onCancel"])]),_:1},8,["title","onClose"])):g("",!0),P(m)==="attachment"?(l(),K(Je,{key:2,title:P(c)?"Edit Attachment":"Add Attachment",onClose:P(b)},{default:Z(()=>[Y(vl,{item:P(c),"task-type":t.type,"task-id":t.task.id,onSave:P(k),onCancel:P(b)},null,8,["item","task-type","task-id","onSave","onCancel"])]),_:1},8,["title","onClose"])):g("",!0)])):g("",!0),P(r).length>0?(l(),n("div",_l,[(l(!0),n(G,null,ee(P(r),z=>(l(),K(ol,{key:z.id,item:z,"task-type":t.type,"customer-initials":"SK",onEdit:P(h),onDelete:P(S)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):g("",!0)]),(l(),K(De,{to:"body"},[v.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:ae(R,["self"])},[a.value==="purchase-method"||a.value==="tradein"?(l(),n("div",ea,[e("div",ta,[e("div",sa,[e("h5",oa,y(a.value==="purchase-method"?"Add Purchase Method":"Add Trade-in"),1),e("button",{onClick:R,class:"text-gray-400 hover:text-gray-600"},[...L[3]||(L[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),a.value==="purchase-method"?(l(),K(Ll,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Q,onCancel:R},null,8,["task-type","task-id"])):g("",!0),a.value==="tradein"?(l(),K(Bl,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Q,onCancel:R},null,8,["task-type","task-id"])):g("",!0)])])):g("",!0)])):g("",!0)]))]))}},aa={key:0,class:"mb-8"},na={class:"flex items-center gap-2 mb-4"},ia={class:"font-bold text-gray-800 text-sm"},ra={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},da={class:"p-4"},ua={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},ca={class:"text-sm text-slate-700 leading-snug"},ma={class:"flex items-center justify-between"},pa={class:"flex items-center gap-4"},ya={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},ga=["src"],va={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},fa={class:"flex items-center gap-2"},ba={class:"font-bold text-slate-800 text-sm md:text-base"},xa={class:"mt-1.5"},ha={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},wa={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},ka={class:"flex items-center gap-4"},$a={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},Ca={key:1,class:"text-right"},Sa={class:"font-bold text-slate-800"},Aa={class:"border-t border-gray-200"},Da={class:"font-medium"},Ta={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Ia={class:"mb-6"},qa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Oa={key:0},Na={class:"font-medium text-slate-700"},Ma={key:1},Va={class:"font-medium text-slate-700"},La={key:2},ja={class:"font-medium text-slate-700"},Fa={class:"font-medium text-slate-700"},Ra={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ua={key:0},Ea={class:"font-medium text-slate-700"},Pa={key:1},Ba={class:"font-medium text-slate-700"},Wa={key:2},za={class:"font-medium text-slate-700"},Ha={key:3},Qa={class:"font-medium text-slate-700"},Ya={key:4},Ka={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Ga={key:5},Ja={class:"font-medium text-slate-700"},Xa={key:0,class:"mt-6 flex justify-end"},nt={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const C=A(!1),s=a=>new Intl.NumberFormat("en-US").format(a),v=a=>new Intl.NumberFormat("en-US").format(a);return(a,i)=>t.show?(l(),n("div",aa,[e("div",na,[i[1]||(i[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",ia,y(t.label),1)]),e("div",ra,[e("div",da,[t.requestMessage?(l(),n("div",ua,[i[2]||(i[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",ca,y(t.requestMessage),1)])):g("",!0),e("div",ma,[e("div",pa,[e("div",ya,[t.image?(l(),n("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ga)):(l(),n("i",va))]),e("div",null,[e("div",fa,[e("div",ba,y(t.brand)+" "+y(t.model)+" ("+y(t.year)+")",1)]),e("div",xa,[t.stockDays!==void 0&&t.stockDays!==null?(l(),n("div",ha,[i[3]||(i[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),F(" In stock ("+y(t.stockDays)+" days) ",1)])):(l(),n("div",wa,[...i[4]||(i[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),F(" Out of stock ",-1)])]))])])]),e("div",ka,[t.showOpenAd&&t.price?(l(),n("button",$a,[...i[5]||(i[5]=[F(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):g("",!0),t.price?(l(),n("div",Ca,[i[6]||(i[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",Sa,"€ "+y(s(t.price)),1)])):g("",!0)])])]),e("div",Aa,[e("button",{onClick:i[0]||(i[0]=p=>C.value=!C.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",Da,y(C.value?"Hide":"View")+" Details",1),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":C.value}])},null,2)])]),C.value?(l(),n("div",Ta,[e("div",Ia,[i[17]||(i[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",qa,[t.requestType?(l(),n("div",Oa,[i[7]||(i[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Na,y(t.requestType),1)])):g("",!0),t.source?(l(),n("div",Ma,[i[8]||(i[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Va,y(t.source),1)])):g("",!0),e("div",null,[i[9]||(i[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:j(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},y(t.sourceDetails||"--"),3)]),t.dealership?(l(),n("div",La,[i[10]||(i[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",ja,y(t.dealership),1)])):g("",!0),e("div",null,[i[11]||(i[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Fa,y(t.channel||"Email"),1)]),e("div",null,[i[12]||(i[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:j(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},y(t.adCampaign||"--"),3)]),e("div",null,[i[13]||(i[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:j(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},y(t.adMedium||"--"),3)]),e("div",null,[i[14]||(i[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:j(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},y(t.adSource||"--"),3)]),e("div",null,[i[15]||(i[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:j(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},y(t.expectedPurchaseDate||"--"),3)]),e("div",null,[i[16]||(i[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:j(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},y(t.fiscalEntity||"--"),3)])])]),i[26]||(i[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[i[25]||(i[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Ra,[t.registration?(l(),n("div",Ua,[i[18]||(i[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Ea,y(t.registration),1)])):g("",!0),t.kilometers!==void 0&&t.kilometers!==null?(l(),n("div",Pa,[i[19]||(i[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ba,y(v(t.kilometers))+" Km",1)])):g("",!0),t.fuelType?(l(),n("div",Wa,[i[20]||(i[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",za,y(t.fuelType),1)])):g("",!0),t.gearType?(l(),n("div",Ha,[i[21]||(i[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Qa,y(t.gearType),1)])):g("",!0),t.vin?(l(),n("div",Ya,[i[22]||(i[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Ka,y(t.vin),1)])):g("",!0),t.dealership?(l(),n("div",Ga,[i[23]||(i[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ja,y(t.dealership),1)])):g("",!0)]),t.showTechnicalSpecs?(l(),n("div",Xa,[...i[24]||(i[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),F(" View technical specs ")],-1)])])):g("",!0)])])):g("",!0)])])):g("",!0)}},Za={key:0,class:"space-y-4 animate-fade-in"},_a=["value"],en={key:0,class:"animate-fade-in"},tn={class:"grid grid-cols-4 gap-2"},sn=["onClick"],et={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:C}){const s=t,v=C,a=Ie(),i=ut(),p=A(""),m=A(null),c=A(""),u=A(!1),o=A(""),r=N(()=>i.assignableUsers);pe(()=>{var h;m.value=((h=a.currentUser)==null?void 0:h.id)||1}),me(()=>s.show,h=>{h||f()});const f=()=>{var h;p.value="",m.value=((h=a.currentUser)==null?void 0:h.id)||1,c.value="",u.value=!1,o.value=""},k=()=>{if(!p.value||!c.value||!o.value){alert("Please fill in all required fields: Type, Date, and Time");return}const h=i.getUserById(m.value),S=`${c.value}T${o.value}:00`;v("confirm",{type:p.value,assignee:(h==null?void 0:h.name)||"Unknown",assigneeId:m.value,date:c.value,time:o.value,datetime:S,location:"",notes:""}),f()},b=()=>{f(),v("cancel")};return(h,S)=>t.show?(l(),n("div",Za,[e("div",null,[S[5]||(S[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),O(e("select",{"onUpdate:modelValue":S[0]||(S[0]=V=>p.value=V),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...S[4]||(S[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[de,p.value]])]),e("div",null,[S[6]||(S[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),O(e("select",{"onUpdate:modelValue":S[1]||(S[1]=V=>m.value=V),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[(l(!0),n(G,null,ee(r.value,V=>{var R;return l(),n("option",{key:V.id,value:V.id},y(V.name)+y(V.id===((R=P(a).currentUser)==null?void 0:R.id)?" (Me)":""),9,_a)}),128))],512),[[de,m.value]])]),e("div",null,[S[7]||(S[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":S[2]||(S[2]=V=>c.value=V),onChange:S[3]||(S[3]=V=>u.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[U,c.value]])]),u.value?(l(),n("div",en,[S[8]||(S[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",tn,[(l(),n(G,null,ee(["09:00","10:30","11:00","14:30","15:00","16:30"],V=>e("button",{key:V,onClick:R=>o.value=V,class:j(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",o.value===V?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},y(V),11,sn)),64))])])):g("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:b,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:k,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...S[9]||(S[9]=[F(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):g("",!0)}},on={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},ln={key:0,class:"flex justify-between items-center mb-4"},an={class:"font-semibold text-slate-800 text-sm"},nn={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(C,s)=>(l(),n("div",on,[t.title?(l(),n("div",ln,[e("h5",an,y(t.title),1),t.showClose?(l(),n("button",{key:0,onClick:s[0]||(s[0]=v=>C.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):g("",!0)])):g("",!0),ve(C.$slots,"default")]))}},rn={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},dn={class:"flex justify-between items-start mb-3"},un={class:"text-xs text-gray-500 mt-0.5"},cn={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},mn={class:"text-xs text-blue-700"},pn={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},yn={class:"flex items-center justify-between"},gn={class:"flex items-center gap-2"},vn={class:"text-xs font-bold text-slate-800"},fn={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},bn={class:"flex gap-3 flex-wrap items-center mb-4"},xn={class:"flex items-center gap-2"},hn={class:"text-sm text-slate-700 font-medium"},wn=["disabled"],kn={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},$n=["disabled"],Cn={key:2,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Sn={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},An={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Dn={class:"flex items-center gap-2 text-red-400"},Tn={class:"text-xs font-mono"},In={class:"space-y-3 text-sm font-mono"},qn={class:"ml-2"},On={class:"ml-2"},Nn={key:0},Mn={class:"ml-2"},Vn={key:1},Ln={class:"ml-2"},jn={key:2},Fn={class:"ml-2"},Rn={class:"mt-4 pt-4 border-t border-slate-700"},Un={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},En={key:3,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},Pn={class:"grid grid-cols-3 gap-2"},Bn={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Wn={class:"grid grid-cols-4 gap-2"},zn=["onClick"],Hn={key:0},Qn={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Yn={class:"text-xs text-slate-700"},Kn={class:"grid grid-cols-3 gap-2"},Gn={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Jn={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Xn={class:"flex gap-4"},Zn={class:"flex items-center gap-2 cursor-pointer"},_n={class:"flex items-center gap-2 cursor-pointer"},ei={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},ti=["disabled"],si={key:2,class:"space-y-4"},oi={class:"bg-white border border-gray-200 rounded-lg p-4"},li={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ai=["value"],ni=["value"],ii=["value"],ri={class:"bg-white border border-gray-200 rounded-lg p-4"},di={class:"flex gap-2"},ui={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ci={class:"grid grid-cols-2 gap-3 text-sm mb-3"},mi={class:"ml-2 font-medium text-slate-800"},pi={class:"ml-2 font-medium text-slate-800"},yi={class:"ml-2 font-medium text-slate-800 capitalize"},gi={class:"ml-2 font-medium text-slate-800"},vi={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},fi={class:"space-y-2"},bi=["checked"],xi=["checked","disabled"],hi={class:"flex-1"},wi={class:"text-xs text-gray-500 mt-0.5"},ki={class:"space-y-3"},$i={class:"grid grid-cols-2 gap-3 text-sm"},Ci={class:"ml-2 font-medium text-slate-800"},Si={class:"ml-2 font-medium text-slate-800"},Ai={class:"ml-2 font-medium text-slate-800 capitalize"},Di={class:"ml-2 font-medium text-slate-800"},Ti={key:0,class:"text-sm"},Ii={class:"ml-2 font-medium text-slate-800"},qi={key:1,class:"text-sm"},Oi={class:"mt-1 text-slate-700"},Ni={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Mi={class:"p-6"},Vi={class:"flex justify-between items-center mb-4"},Li={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ji={class:"p-6"},Fi={class:"flex justify-between items-center mb-4"},Ri={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:C}){var Le,je,Fe;const s=t,v=C,a=ut(),i=Ie(),p=A(!1),m=A(!1),c=A(0),u=A(""),o=A(null),r=A(!1),f=A(null),k=A(!1),b=A(!1),h=A(!1),S=A(null),V=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],R=A("whatsapp"),Q=A("followup-1"),J=A("custom"),ie=A(""),re=A("09:00"),w=A("Not Interested"),D=A(""),L=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],z=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],te=N(()=>a.assignableUsers),I=N(()=>i.currentUser),T=A({dealership:((je=(Le=s.lead)==null?void 0:Le.requestedCar)==null?void 0:je.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Fe=I.value)==null?void 0:Fe.id)||1}),H=A({tradeIn:!1,financing:!1,contactAvailability:!1}),x=A({}),W=A(null),se={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},fe=N(()=>{const E=Math.floor(c.value/60),d=c.value%60;return`${E.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`}),ke=N(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),Re=N(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),Oe=N(()=>!!s.lead.scheduledAppointment),Ne=N(()=>Oe.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Re.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),ce=N(()=>{var E;return((E=s.lead.contactAttempts)==null?void 0:E.length)||0});N(()=>s.activities.filter(E=>E.type==="note"));const Ue={"followup-1":`Hi ${s.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}?`,"followup-2":`Hello ${s.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},Me=N(()=>Q.value==="custom"?"Type your custom message...":Ue[Q.value]),Ce=()=>{p.value=!0,c.value=0,m.value=!1,u.value="",o.value=setInterval(()=>{c.value++,c.value>=20&&Se()},1e3)},Se=()=>{o.value&&(clearInterval(o.value),o.value=null),p.value=!1,m.value=!0,x.value={duration:c.value,notes:u.value,transcription:se,channel:"phone"},r.value=!0},Ee=async()=>{try{await navigator.clipboard.writeText(s.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(E){console.error("Failed to copy:",E)}},Pe=()=>{W.value={tradeIn:se.leadLines.some(E=>E.toLowerCase().includes("trade")||E.toLowerCase().includes("exchange"))||!1,financing:se.leadLines.some(E=>E.toLowerCase().includes("financ")||E.toLowerCase().includes("payment")||E.toLowerCase().includes("loan"))||!1},W.value.tradeIn&&(H.value.tradeIn=!0),W.value.financing&&(H.value.financing=!0)},Be=async E=>{S.value=E,h.value=!0,b.value=!1,v("appointment-scheduled",E)},We=()=>{const E={timestamp:new Date().toISOString(),outcome:"interested",channel:x.value.channel||"phone",notes:x.value.notes||"",transcription:x.value.transcription||null};v("call-attempt-logged",E),v("validated",{scheduleFollowUp:!1}),v("qualified",{assignment:T.value,preferences:H.value,scheduleAppointment:h.value,appointmentData:S.value}),ye()},ze=()=>{const E={timestamp:new Date().toISOString(),outcome:"interested",channel:x.value.channel||"phone",notes:x.value.notes||"",transcription:x.value.transcription||null};v("call-attempt-logged",E),f.value="not-valid"},Ve=()=>{x.value={channel:"external",notes:"",transcription:null},r.value=!0},be=E=>{f.value=E,E==="interested"&&W.value&&(H.value.tradeIn=W.value.tradeIn||!1,H.value.financing=W.value.financing||!1)},ye=()=>{f.value=null,r.value=!1,h.value=!1,S.value=null},He=()=>{if(J.value==="tomorrow-9am"){const d=new Date;return d.setDate(d.getDate()+1),d.setHours(9,0,0,0),d.toISOString()}else if(J.value==="monday"){const d=new Date,M=(8-d.getDay())%7||7;return d.setDate(d.getDate()+M),d.setHours(9,0,0,0),d.toISOString()}else if(J.value==="custom"&&ie.value&&re.value)return new Date(`${ie.value}T${re.value}:00`).toISOString();const E=new Date;return E.setDate(E.getDate()+1),E.setHours(9,0,0,0),E.toISOString()},Qe=async()=>{const E={timestamp:new Date().toISOString(),outcome:"no-answer",channel:x.value.channel||"phone",notes:x.value.notes||"",transcription:x.value.transcription||null};v("call-attempt-logged",E),R.value&&R.value!=="dont-send"&&console.log("Sending follow-up:",R.value,Me.value);const d=He(),M=d.split("T")[0],ue=new Date(d).toTimeString().slice(0,5);v("postponed",{date:M,time:ue,createAppointment:!0}),ce.value+1>=5&&v("disqualified",{category:"Not Interested",reason:"Unreachable"}),ye()},Ye=()=>{const E={timestamp:new Date().toISOString(),outcome:"not-valid",channel:x.value.channel||"phone",notes:x.value.notes||"",transcription:x.value.transcription||null};v("call-attempt-logged",E),v("disqualified",{category:w.value,reason:D.value}),ye()},Ke=E=>{k.value=!1,v("note-saved",E)};return bt(()=>{o.value&&clearInterval(o.value)}),(E,d)=>(l(),n("div",rn,[e("div",dn,[e("div",null,[d[29]||(d[29]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",un,y(ke.value),1)]),e("div",{class:j(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",Ne.value.class])},y(Ne.value.text),3)]),Oe.value?(l(),n("div",cn,[d[30]||(d[30]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",mn,y(P($e)(t.lead.scheduledAppointment.start))+" at "+y(P(Ae)(t.lead.scheduledAppointment.start)),1)])):g("",!0),ce.value>0?(l(),n("div",pn,[e("div",yn,[e("div",gn,[d[31]||(d[31]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),d[32]||(d[32]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",vn,y(ce.value)+" / 5",1)]),ce.value>=4?(l(),n("div",fn,[...d[33]||(d[33]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),F(" One more attempt before auto-disqualification ",-1)])])):g("",!0)])])):g("",!0),e("div",bn,[e("div",xn,[e("span",hn,y(t.lead.customer.phone),1),e("button",{onClick:Ee,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...d[34]||(d[34]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("button",{onClick:Ce,disabled:p.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[d[35]||(d[35]=e("i",{class:"fa-solid fa-phone"},null,-1)),F(" "+y(ce.value>0?"Call Again":"Initiate Call")+" ",1),ce.value>0?(l(),n("span",kn,y(ce.value+1)+"/5 ",1)):g("",!0)],8,wn),e("button",{onClick:Ve,disabled:p.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...d[36]||(d[36]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),F(" Log Call Outcome ",-1)])],8,$n)]),p.value||m.value?(l(),n("div",Cn,[p.value?(l(),n("div",Sn,[e("div",An,[d[38]||(d[38]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Dn,[d[37]||(d[37]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Tn,"REC "+y(fe.value),1)])]),e("div",In,[e("div",null,[d[39]||(d[39]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",qn,y(se.leadLines[0]),1)]),e("div",null,[d[40]||(d[40]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",On,y(se.salesLines[0]),1)]),c.value>=5?(l(),n("div",Nn,[d[41]||(d[41]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Mn,y(se.leadLines[1]),1)])):g("",!0),c.value>=8?(l(),n("div",Vn,[d[42]||(d[42]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ln,y(se.salesLines[1]),1)])):g("",!0),c.value>=12?(l(),n("div",jn,[d[43]||(d[43]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Fn,y(se.leadLines[2]),1)])):g("",!0)]),e("div",Rn,[O(e("textarea",{"onUpdate:modelValue":d[0]||(d[0]=M=>u.value=M),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[U,u.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:Se,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...d[44]||(d[44]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),F(" End Call ",-1)])])])])):g("",!0),m.value&&!p.value?(l(),n("div",Un,[e("div",{class:"flex items-center justify-between"},[d[46]||(d[46]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:Pe,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...d[45]||(d[45]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),F(" Extract information ",-1)])])])])):g("",!0)])):g("",!0),r.value?(l(),n("div",En,[e("div",null,[d[50]||(d[50]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",Pn,[e("button",{onClick:d[1]||(d[1]=M=>be("no-answer")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",f.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...d[47]||(d[47]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:d[2]||(d[2]=M=>be("not-valid")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",f.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...d[48]||(d[48]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:d[3]||(d[3]=M=>be("interested")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",f.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...d[49]||(d[49]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),f.value==="no-answer"?(l(),n("div",Bn,[d[58]||(d[58]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",Wn,[(l(),n(G,null,ee(V,M=>e("button",{key:M.value,onClick:ue=>R.value=M.value,class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",R.value===M.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},y(M.label),11,zn)),64))]),R.value&&R.value!=="dont-send"?(l(),n("div",Hn,[d[53]||(d[53]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),O(e("select",{"onUpdate:modelValue":d[4]||(d[4]=M=>Q.value=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...d[51]||(d[51]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[de,Q.value]]),e("div",Qn,[d[52]||(d[52]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",Yn,y(Me.value),1)])])):g("",!0),e("div",null,[d[56]||(d[56]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",Kn,[e("button",{onClick:d[5]||(d[5]=M=>J.value="tomorrow-9am"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",J.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:d[6]||(d[6]=M=>J.value="monday"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",J.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:d[7]||(d[7]=M=>J.value="custom"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",J.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),J.value==="custom"?(l(),n("div",Gn,[e("div",null,[d[54]||(d[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":d[8]||(d[8]=M=>ie.value=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,ie.value]])]),e("div",null,[d[55]||(d[55]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),O(e("input",{type:"time","onUpdate:modelValue":d[9]||(d[9]=M=>re.value=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,re.value]])])])):g("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:ye,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:Qe,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...d[57]||(d[57]=[F(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):g("",!0),f.value==="not-valid"?(l(),n("div",Jn,[e("div",null,[d[61]||(d[61]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",Xn,[e("label",Zn,[O(e("input",{type:"radio","onUpdate:modelValue":d[10]||(d[10]=M=>w.value=M),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Te,w.value]]),d[59]||(d[59]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",_n,[O(e("input",{type:"radio","onUpdate:modelValue":d[11]||(d[11]=M=>w.value=M),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Te,w.value]]),d[60]||(d[60]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[d[63]||(d[63]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),O(e("select",{"onUpdate:modelValue":d[12]||(d[12]=M=>D.value=M),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...d[62]||(d[62]=[ot('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[de,D.value]])]),e("div",ei,[e("button",{onClick:ye,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:Ye,disabled:!w.value||!D.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,ti)])])):g("",!0),f.value==="interested"?(l(),n("div",si,[e("div",oi,[d[67]||(d[67]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",li,[e("div",null,[d[64]||(d[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),O(e("select",{"onUpdate:modelValue":d[13]||(d[13]=M=>T.value.dealership=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(l(),n(G,null,ee(L,M=>e("option",{key:M,value:M},y(M),9,ai)),64))],512),[[de,T.value.dealership]])]),e("div",null,[d[65]||(d[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),O(e("select",{"onUpdate:modelValue":d[14]||(d[14]=M=>T.value.team=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(l(),n(G,null,ee(z,M=>e("option",{key:M,value:M},y(M),9,ni)),64))],512),[[de,T.value.team]])]),e("div",null,[d[66]||(d[66]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),O(e("select",{"onUpdate:modelValue":d[15]||(d[15]=M=>T.value.assigneeId=M),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(l(!0),n(G,null,ee(te.value,M=>(l(),n("option",{key:M.id,value:M.id},y(M.name)+y(M.id===I.value.id?" (Me)":""),9,ii))),128))],512),[[de,T.value.assigneeId]])])])]),e("div",ri,[d[71]||(d[71]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",di,[e("button",{onClick:d[16]||(d[16]=M=>v("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...d[68]||(d[68]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add purchase method ",-1)])]),e("button",{onClick:d[17]||(d[17]=M=>v("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...d[69]||(d[69]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add trade-in ",-1)])]),e("button",{onClick:d[18]||(d[18]=M=>k.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...d[70]||(d[70]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add note ",-1)])])])]),E.hasExistingAppointment&&!h.value?(l(),n("div",ui,[d[77]||(d[77]=ot('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",ci,[e("div",null,[d[72]||(d[72]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",mi,y(P($e)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[d[73]||(d[73]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",pi,y(P(Ae)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[d[74]||(d[74]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",yi,y(t.lead.scheduledAppointment.type),1)]),e("div",null,[d[75]||(d[75]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",gi,y(t.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:d[19]||(d[19]=M=>b.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...d[76]||(d[76]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),F(" Reschedule Appointment ",-1)])])])):g("",!0),E.hasExistingAppointment?g("",!0):(l(),n("div",vi,[d[80]||(d[80]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",fi,[e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!h.value}])},[e("input",{type:"radio",checked:!h.value,onChange:d[20]||(d[20]=()=>{h.value=!1,S.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,bi),d[78]||(d[78]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":h.value}]),onClick:d[22]||(d[22]=M=>!h.value&&(b.value=!0))},[e("input",{type:"radio",checked:h.value,disabled:!h.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,xi),e("div",hi,[d[79]||(d[79]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",wi,y(h.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),h.value?(l(),n("button",{key:0,onClick:d[21]||(d[21]=ae(M=>b.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):g("",!0)],2)])])),h.value?(l(),K(nn,{key:2,title:"Scheduled Appointment","show-close":!1},{default:Z(()=>[e("div",ki,[e("div",$i,[e("div",null,[d[81]||(d[81]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Ci,y(P($e)(S.value.datetime)),1)]),e("div",null,[d[82]||(d[82]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Si,y(S.value.time),1)]),e("div",null,[d[83]||(d[83]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Ai,y(S.value.type),1)]),e("div",null,[d[84]||(d[84]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Di,y(S.value.assignee),1)])]),S.value.location?(l(),n("div",Ti,[d[85]||(d[85]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",Ii,y(S.value.location),1)])):g("",!0),S.value.notes?(l(),n("div",qi,[d[86]||(d[86]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",Oi,y(S.value.notes),1)])):g("",!0)])]),_:1})):g("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:ye,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:ze,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...d[87]||(d[87]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),F(" Disqualify ",-1)])]),e("button",{onClick:We,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...d[88]||(d[88]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),F(" Qualify ",-1)])])])])])):g("",!0)])):g("",!0),(l(),K(De,{to:"body"},[k.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:d[25]||(d[25]=ae(M=>k.value=!1,["self"]))},[e("div",Ni,[e("div",Mi,[e("div",Vi,[d[90]||(d[90]=e("h5",{class:"text-sm font-bold text-slate-800"},"Add Note",-1)),e("button",{onClick:d[23]||(d[23]=M=>k.value=!1),class:"text-gray-400 hover:text-gray-600"},[...d[89]||(d[89]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),Y(ct,{item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,onSave:Ke,onCancel:d[24]||(d[24]=M=>k.value=!1)},null,8,["task-id"])])])])):g("",!0)])),(l(),K(De,{to:"body"},[b.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:d[28]||(d[28]=ae(M=>b.value=!1,["self"]))},[e("div",Li,[e("div",ji,[e("div",Fi,[d[92]||(d[92]=e("h5",{class:"text-sm font-bold text-slate-800"},"Schedule Appointment",-1)),e("button",{onClick:d[26]||(d[26]=M=>b.value=!1),class:"text-gray-400 hover:text-gray-600"},[...d[91]||(d[91]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),Y(et,{show:!0,onConfirm:Be,onCancel:d[27]||(d[27]=M=>b.value=!1)})])])])):g("",!0)]))]))}},Ui={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Ei={class:"grid grid-cols-3 gap-3 mb-4"},Pi={class:"flex gap-3 mb-4"},Ze={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:C}){const s=C,v=A(null),a=A(""),i=A(""),p=u=>{v.value=u;const o=new Date;if(u==="later-today"){const r=new Date(o.getTime()+72e5);a.value=r.toISOString().split("T")[0],i.value=r.toTimeString().slice(0,5)}else if(u==="tomorrow"){const r=new Date(o);r.setDate(r.getDate()+1),a.value=r.toISOString().split("T")[0],i.value="09:00"}else if(u==="next-week"){const r=new Date(o);r.setDate(r.getDate()+(7-r.getDay()+1)),a.value=r.toISOString().split("T")[0],i.value="09:00"}},m=()=>{s("confirm",{date:a.value,time:i.value,option:v.value}),s("close"),v.value=null,a.value="",i.value=""},c=()=>{s("close"),v.value=null,a.value="",i.value=""};return(u,o)=>t.show?(l(),n("div",Ui,[e("div",Ei,[e("button",{onClick:o[0]||(o[0]=r=>p("later-today")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":v.value==="later-today"}])},[...o[5]||(o[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:o[1]||(o[1]=r=>p("tomorrow")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":v.value==="tomorrow"}])},[...o[6]||(o[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:o[2]||(o[2]=r=>p("next-week")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":v.value==="next-week"}])},[...o[7]||(o[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",Pi,[O(e("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>a.value=r),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[U,a.value]]),O(e("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>i.value=r),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[U,i.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:c,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:m,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):g("",!0)}},Bi={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},Wi={class:"p-5 space-y-6"},zi={class:"bg-white border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},Hi={key:0,class:"pt-4 space-y-4 border-t border-gray-200 mt-4"},Qi={class:"space-y-2"},Yi={key:0},Ki={key:1},Gi={key:2,class:"pt-3 border-t border-gray-200"},Ji={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:C}){const s=t,v=C,a=_e(),i=it(),p=Ie(),m=A(!1),c=A(null),u=A(!1),o=A(null),r=N(()=>i.currentLeadActivities||[]),f=async w=>{o.value=w},k=async w=>{var D;try{const L=`${w.date}T${w.time}:00`,z=new Date(L);z.setHours(z.getHours()+1);const te={type:"appointment",user:((D=p.currentUser)==null?void 0:D.name)||"You",action:"scheduled an appointment",content:`Appointment scheduled: ${w.type} on ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,assigneeId:w.assigneeId,date:w.date,time:w.time,datetime:L,status:"scheduled"},timestamp:new Date().toISOString()};await i.addActivity(s.lead.id,te);const I={title:`${w.type} - ${s.lead.customer.name}`,start:L,end:z.toISOString(),type:w.type.toLowerCase().replace(" ","-"),customer:s.lead.customer.name,vehicle:`${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}`,assignee:w.assignee,assigneeId:w.assigneeId,dealership:s.lead.requestedCar.dealership||"Main",team:"Sales (New)",status:"confirmed",leadId:s.lead.id};await Xe(I),await i.modifyLead(s.lead.id,{scheduledAppointment:{id:Date.now(),start:L,end:z.toISOString(),title:w.type,type:w.type}}),o.value=w,u.value=!0,await i.loadLeadById(s.lead.id)}catch(L){console.error("Failed to schedule appointment:",L)}},b=async()=>{var w;try{c.value==="qualify-without"&&o.value&&await R(o.value);const D=await i.convertLeadToOpportunity(s.lead.id,{assigneeId:((w=p.currentUser)==null?void 0:w.id)||1,preferences:{}});p.canAccessOpportunities()?a.push({path:`/tasks/${D}`,query:{type:"opportunity"}}):a.push("/tasks/1")}catch(D){console.error("Failed to qualify lead:",D)}},h=()=>{v("open-purchase-method")},S=()=>{v("open-trade-in")},V=async w=>{var D;try{const L=`${w.date}T${w.time}:00`,z=new Date(L);z.setHours(z.getHours()+1),await i.modifyLead(s.lead.id,{scheduledAppointment:{id:Date.now(),title:`${w.type} - ${s.lead.customer.name}`,start:L,end:z.toISOString(),type:w.type,assignee:w.assignee,assigneeId:w.assigneeId,status:"scheduled",location:w.location||"",notes:w.notes||""}}),await i.addActivity(s.lead.id,{type:"appointment",user:((D=p.currentUser)==null?void 0:D.name)||"You",action:"scheduled an appointment",content:`${w.type} scheduled for ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,assigneeId:w.assigneeId,date:w.date,time:w.time,datetime:L,location:w.location||"",notes:w.notes||"",status:"scheduled"},timestamp:new Date().toISOString()}),await Xe({title:`${w.type} - ${s.lead.customer.name}`,start:L,end:z.toISOString(),type:w.type,customer:s.lead.customer.name,vehicle:`${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}`,assignee:w.assignee,assigneeId:w.assigneeId,dealership:s.lead.requestedCar.dealership||"Main",team:"Sales (New)",status:"confirmed",location:w.location||"",notes:w.notes||"",leadId:s.lead.id}),await i.loadLeadById(s.lead.id)}catch(L){console.error("Failed to schedule appointment:",L)}},R=async w=>{var D,L,z,te,I;try{const T=new Date(`${w.date}T${w.time}:00`),H=T.toISOString();if(await i.modifyLead(s.lead.id,{nextActionDue:H}),w.createAppointment){const x=new Date(T);x.setHours(x.getHours()+1);const W={type:"appointment",user:((D=p.currentUser)==null?void 0:D.name)||"You",action:"scheduled callback appointment",content:`Callback scheduled for ${$e(T)} at ${Ae(T)}`,data:{type:"Callback",assignee:s.lead.assignee||((L=p.currentUser)==null?void 0:L.name),assigneeId:s.lead.assigneeId||((z=p.currentUser)==null?void 0:z.id)||1,date:w.date,time:w.time,datetime:H,status:"scheduled"},timestamp:new Date().toISOString()};await i.addActivity(s.lead.id,W);const{createCalendarEvent:se}=await xt(async()=>{const{createCalendarEvent:ke}=await import("./calendar-DiXbb47i.js");return{createCalendarEvent:ke}},__vite__mapDeps([0,1,2])),fe={title:`Callback - ${s.lead.customer.name}`,start:H,end:x.toISOString(),type:"callback",customer:s.lead.customer.name,vehicle:`${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}`,assignee:s.lead.assignee||((te=p.currentUser)==null?void 0:te.name),assigneeId:s.lead.assigneeId||((I=p.currentUser)==null?void 0:I.id)||1,dealership:s.lead.requestedCar.dealership||"Main",team:"Sales (New)",status:"confirmed",leadId:s.lead.id};await se(fe),await i.modifyLead(s.lead.id,{scheduledAppointment:{id:Date.now(),start:H,end:x.toISOString(),title:"Callback",type:"Callback"}})}else await i.addActivity(s.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${$e(T)} at ${Ae(T)}`});await i.loadLeadById(s.lead.id)}catch(T){console.error("Failed to postpone lead task:",T)}},Q=async w=>{try{if(await i.modifyLead(s.lead.id,{stage:"Validated"}),await i.addActivity(s.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),w.scheduleFollowUp&&w.appointmentData){const D=new Date(`${w.appointmentData.date}T${w.appointmentData.time}:00`);await i.scheduleFollowUp(s.lead.id,{dateTime:D.toISOString(),assignee:w.appointmentData.assignee||s.lead.assignee,assigneeId:w.appointmentData.assigneeId||1}),await i.addActivity(s.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${$e(D)} at ${Ae(D)}`})}await i.loadLeadById(s.lead.id)}catch(D){console.error("Failed to validate lead:",D)}},J=async w=>{var D;try{w!=null&&w.assignment&&await i.modifyLead(s.lead.id,{assignee:w.assignment.assigneeId,customerPreferences:w.preferences});const L=await i.convertLeadToOpportunity(s.lead.id,{assigneeId:(D=w==null?void 0:w.assignment)==null?void 0:D.assigneeId,preferences:w==null?void 0:w.preferences});w!=null&&w.scheduleAppointment,p.canAccessOpportunities()?a.push({path:`/tasks/${L}`,query:{type:"opportunity"}}):a.push("/tasks/1")}catch(L){console.error("Failed to qualify lead:",L)}},ie=async w=>{try{const D=s.lead.contactAttempts||[];await i.modifyLead(s.lead.id,{contactAttempts:[...D,w],lastContactAttempt:w.timestamp,totalContactAttempts:D.length+1}),await i.addActivity(s.lead.id,{type:"call",user:"You",action:`logged call attempt - ${w.outcome}`,content:w.notes||`Call attempt via ${w.channel}`,data:{outcome:w.outcome,channel:w.channel,duration:w.duration}}),await i.loadLeadById(s.lead.id)}catch(D){console.error("Failed to log call attempt:",D)}},re=async w=>{try{await i.modifyLead(s.lead.id,{isDisqualified:!0,disqualifyReason:w.reason,status:"Disqualified"}),await i.addActivity(s.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${w.category}, Reason: ${w.reason}`}),a.push("/tasks")}catch(D){console.error("Failed to disqualify lead:",D)}};return(w,D)=>t.lead?(l(),n("div",Bi,[D[9]||(D[9]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")])],-1)),e("div",Wi,[Y(Ri,{lead:t.lead,activities:r.value,onPostponed:R,onValidated:Q,onQualified:J,onDisqualified:re,onCallAttemptLogged:ie,onNoteSaved:w.handleNoteSaved,onOpenPurchaseMethod:h,onOpenTradeIn:S,onAppointmentScheduled:V},null,8,["lead","activities","onNoteSaved"]),e("div",zi,[D[8]||(D[8]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Postpone Task"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," Reschedule the lead qualification task to a later date. ")])],-1)),e("button",{onClick:D[0]||(D[0]=L=>m.value=!m.value),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...D[4]||(D[4]=[e("i",{class:"fa-regular fa-clock text-xs"},null,-1),F(" Postpone Task ",-1)])]),m.value?(l(),n("div",Hi,[e("div",null,[D[7]||(D[7]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Next Step",-1)),e("div",Qi,[e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":c.value==="qualify-without"}])},[O(e("input",{type:"radio","onUpdate:modelValue":D[1]||(D[1]=L=>c.value=L),value:"qualify-without",class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Te,c.value]]),D[5]||(D[5]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":c.value==="schedule-appointment"}])},[O(e("input",{type:"radio","onUpdate:modelValue":D[2]||(D[2]=L=>c.value=L),value:"schedule-appointment",class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Te,c.value]]),D[6]||(D[6]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Book a meeting or test drive")],-1))],2)])]),c.value==="qualify-without"?(l(),n("div",Yi,[Y(Ze,{show:!0,onConfirm:f})])):g("",!0),c.value==="schedule-appointment"?(l(),n("div",Ki,[Y(et,{show:!0,onConfirm:k,onCancel:D[3]||(D[3]=L=>c.value=null)})])):g("",!0),c.value&&(c.value==="qualify-without"||u.value)?(l(),n("div",Gi,[e("button",{onClick:b,class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors shadow-sm"}," Qualify ")])):g("",!0)])):g("",!0)])])])):g("",!0)}},Xi={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:C}){const s=C,v=()=>{s("close")};return(a,i)=>(l(),K(qe,{show:t.show,title:t.title,onCancel:v},{footer:Z(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:v,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:Z(()=>[i[0]||(i[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},Zi={class:"space-y-4"},_i=["disabled"],er={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(""),i=A("");me(()=>s.show,c=>{c&&(a.value="",i.value="")});const p=()=>{a.value&&v("confirm",{reason:a.value,notes:i.value})},m=()=>{v("cancel")};return(c,u)=>(l(),K(qe,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:m},{actions:Z(()=>[e("button",{onClick:p,disabled:!a.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,_i)]),default:Z(()=>[e("div",Zi,[e("div",null,[u[3]||(u[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),O(e("select",{"onUpdate:modelValue":u[0]||(u[0]=o=>a.value=o),class:"input"},[...u[2]||(u[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[de,a.value]])]),e("div",null,[u[4]||(u[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),O(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=o=>i.value=o),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[U,i.value]])])])]),_:1},8,["show"]))}},tr={class:"space-y-4"},sr=["max"],or=["disabled"],lr={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(""),i=A(""),p=A(""),m=N(()=>new Date().toISOString().split("T")[0]);me(()=>s.show,o=>{if(o){const r=new Date;a.value=r.toISOString().split("T")[0],i.value=r.toTimeString().slice(0,5),p.value=""}});const c=()=>{if(!a.value)return;const o=i.value?`${a.value}T${i.value}:00`:`${a.value}T12:00:00`;v("confirm",{contractDate:o,notes:p.value})},u=()=>{v("cancel")};return(o,r)=>(l(),K(qe,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:u},{actions:Z(()=>[e("button",{onClick:c,disabled:!a.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,or)]),default:Z(()=>[e("div",tr,[e("div",null,[r[3]||(r[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":r[0]||(r[0]=f=>a.value=f),max:m.value,class:"input"},null,8,sr),[[U,a.value]])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),O(e("input",{type:"time","onUpdate:modelValue":r[1]||(r[1]=f=>i.value=f),class:"input"},null,512),[[U,i.value]])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),O(e("textarea",{"onUpdate:modelValue":r[2]||(r[2]=f=>p.value=f),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[U,p.value]])])])]),_:1},8,["show"]))}},ar={class:"space-y-4"},nr=["max"],ir=["disabled"],rr={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(""),i=A(""),p=A(""),m=A(""),c=N(()=>new Date().toISOString().split("T")[0]);me(()=>s.show,r=>{if(r){const f=new Date;a.value=f.toISOString().split("T")[0],i.value=f.toTimeString().slice(0,5),p.value="",m.value=""}});const u=()=>{if(!a.value||!p.value)return;const r=i.value?`${a.value}T${i.value}:00`:`${a.value}T12:00:00`;v("confirm",{deliveryDate:r,location:p.value,notes:m.value})},o=()=>{v("cancel")};return(r,f)=>(l(),K(qe,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:o},{actions:Z(()=>[e("button",{onClick:u,disabled:!a.value||!p.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,ir)]),default:Z(()=>[e("div",ar,[e("div",null,[f[4]||(f[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":f[0]||(f[0]=k=>a.value=k),max:c.value,class:"input"},null,8,nr),[[U,a.value]])]),e("div",null,[f[5]||(f[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),O(e("input",{type:"time","onUpdate:modelValue":f[1]||(f[1]=k=>i.value=k),class:"input"},null,512),[[U,i.value]])]),e("div",null,[f[7]||(f[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),O(e("select",{"onUpdate:modelValue":f[2]||(f[2]=k=>p.value=k),class:"input"},[...f[6]||(f[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[de,p.value]])]),e("div",null,[f[8]||(f[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),O(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=k=>m.value=k),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[U,m.value]])])])]),_:1},8,["show"]))}},dr={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(C,s)=>(l(),K(qe,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=v=>C.$emit("cancel"))},{header:Z(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:Z(()=>[e("button",{onClick:s[0]||(s[0]=v=>C.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:Z(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),F(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage, probability, and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),F(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),F(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},ur={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},cr={class:"flex justify-between items-center mb-4"},mr={class:"text-sm font-bold text-slate-800"},pr={key:0,class:"mb-4"},yr={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},gr={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},vr=["src"],fr={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},br={class:"flex-1 min-w-0"},xr={class:"flex items-center gap-2 flex-wrap"},hr={class:"font-bold text-sm text-gray-800 truncate"},wr={class:"text-xs text-gray-500"},kr={key:0,class:"text-[10px] text-green-600 mt-0.5"},$r={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Cr=["onClick"],Sr={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Ar=["src"],Dr={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Tr={class:"flex-1 min-w-0"},Ir={class:"flex items-center gap-2 flex-wrap"},qr={class:"font-bold text-sm text-gray-800 truncate"},Or={class:"text-xs text-gray-500"},Nr={key:0,class:"text-[10px] text-green-600 mt-0.5"},Mr={key:1,class:"text-center py-4 text-gray-400 text-sm"},Vr={class:"mb-4"},Lr={key:0,class:"flex items-center gap-2 mb-2"},jr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fr={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Rr={class:"mt-4"},Ur={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Er=["disabled"],Pr={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:C}){const s=t,v=C,a=A(null),i=A(null),p=A({brand:"",model:"",year:"",price:"",image:""});pe(()=>{s.item&&s.item.data&&(p.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const m=r=>{if(a.value=r,s.requestedCar){const f=r.id&&s.requestedCar.id&&r.id===s.requestedCar.id||r.brand===s.requestedCar.brand&&r.model===s.requestedCar.model&&r.year===s.requestedCar.year;i.value=f?"requested":"recommended"}else i.value="recommended";p.value={brand:r.brand||"",model:r.model||"",year:r.year||new Date().getFullYear(),price:r.price||"",image:r.image||""}},c=N(()=>a.value||p.value.brand&&p.value.model&&p.value.price),u=r=>new Intl.NumberFormat("en-US").format(r),o=()=>{var f,k;const r=a.value||p.value;v("save",{id:((f=s.item)==null?void 0:f.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:r.brand,model:r.model,year:r.year||new Date().getFullYear(),price:r.price,image:r.image||"",isMainOffer:!1},timestamp:((k=s.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(r,f)=>{var k,b;return l(),n("div",ur,[e("div",cr,[e("h5",mr,y(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:f[0]||(f[0]=h=>r.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...f[8]||(f[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?g("",!0):(l(),n("div",pr,[f[11]||(f[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",yr,[t.requestedCar?(l(),n("div",{key:0,onClick:f[1]||(f[1]=h=>m(t.requestedCar)),class:j(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((k=a.value)==null?void 0:k.id)===t.requestedCar.id}])},[e("div",gr,[t.requestedCar.image?(l(),n("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,vr)):(l(),n("i",fr))]),e("div",br,[e("div",xr,[e("h4",hr,y(t.requestedCar.brand)+" "+y(t.requestedCar.model)+" ("+y(t.requestedCar.year)+")",1),e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((b=a.value)==null?void 0:b.id)===t.requestedCar.id&&i.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",wr,"€ "+y(u(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(l(),n("div",kr," In stock ("+y(t.requestedCar.stockDays)+" days) ",1)):(l(),n("div",$r," Out of stock "))]),f[9]||(f[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):g("",!0),(l(!0),n(G,null,ee(t.recommendedCars,h=>{var S,V;return l(),n("div",{key:h.id,onClick:R=>m(h),class:j(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((S=a.value)==null?void 0:S.id)===h.id}])},[e("div",Sr,[h.image?(l(),n("img",{key:0,src:h.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Ar)):(l(),n("i",Dr))]),e("div",Tr,[e("div",Ir,[e("h4",qr,y(h.brand)+" "+y(h.model)+" ("+y(h.year)+")",1),e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((V=a.value)==null?void 0:V.id)===h.id&&i.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",Or,"€ "+y(u(h.price)),1),h.stockDays!==null&&h.stockDays!==void 0?(l(),n("div",Nr," In stock ("+y(h.stockDays)+" days) ",1)):g("",!0)]),f[10]||(f[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Cr)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(l(),n("div",Mr," No vehicles available ")):g("",!0)])])),e("div",Vr,[t.requestedCar||t.recommendedCars.length>0?(l(),n("div",Lr,[...f[12]||(f[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):g("",!0),e("div",jr,[e("div",null,[f[13]||(f[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),O(e("input",{type:"text","onUpdate:modelValue":f[2]||(f[2]=h=>p.value.brand=h),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,p.value.brand]])]),e("div",null,[f[14]||(f[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),O(e("input",{type:"text","onUpdate:modelValue":f[3]||(f[3]=h=>p.value.model=h),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,p.value.model]])])]),e("div",Fr,[e("div",null,[f[15]||(f[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),O(e("input",{type:"number","onUpdate:modelValue":f[4]||(f[4]=h=>p.value.year=h),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,p.value.year]])]),e("div",null,[f[16]||(f[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":f[5]||(f[5]=h=>p.value.price=h),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,p.value.price]])])]),e("div",Rr,[f[17]||(f[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),O(e("input",{type:"text","onUpdate:modelValue":f[6]||(f[6]=h=>p.value.image=h),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[U,p.value.image]])])]),e("div",Ur,[e("button",{onClick:f[7]||(f[7]=h=>r.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:o,disabled:!c.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Er)])])}}},Br={key:0,class:"mb-8"},Wr={class:"relative"},zr={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},Hr={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},Qr=["src"],Yr={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},Kr={class:"p-4"},Gr={class:"font-bold text-gray-800 text-sm mb-1"},Jr={class:"text-xs text-gray-500 mb-2"},Xr={key:0,class:"flex items-center justify-between"},Zr={class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},_r=["onClick"],ed={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:C}){const s=A([]);pe(()=>{s.value=rt.filter(a=>a.stockDays!==null&&a.stockDays!==void 0).slice(0,5)});const v=a=>new Intl.NumberFormat("en-US").format(a);return(a,i)=>s.value.length>0?(l(),n("div",Br,[i[2]||(i[2]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",Wr,[e("div",zr,[(l(!0),n(G,null,ee(s.value,p=>(l(),n("div",{key:p.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",Hr,[p.image?(l(),n("img",{key:0,src:p.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Qr)):(l(),n("i",Yr))]),e("div",Kr,[e("h4",Gr,y(p.brand)+" "+y(p.model)+" ("+y(p.year)+")",1),e("p",Jr,"€ "+y(v(p.price)),1),p.stockDays!==null&&p.stockDays!==void 0?(l(),n("div",Xr,[e("div",Zr,[i[0]||(i[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),F(" In stock ("+y(p.stockDays)+" days) ",1)]),e("button",{onClick:m=>a.$emit("add-to-opportunity",p),class:"w-6 h-6 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-sm transition-colors",title:"Create offer with this car"},[...i[1]||(i[1]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1)])],8,_r)])):g("",!0)])]))),128))])])])):g("",!0)}},td=ht(ed,[["__scopeId","data-v-51a0f4a2"]]),sd={class:"mt-1.5 border-t border-gray-200 pt-1.5"},od={key:1},ld={class:"flex items-center justify-between mb-1.5"},ad={class:"space-y-1.5"},nd={class:"block label-upper mb-1"},id=["onUpdate:modelValue","placeholder"],rd=["onUpdate:modelValue"],dd=["value"],ud={key:2,class:"space-y-0.5"},cd=["onUpdate:modelValue","value"],we={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=A(!1),i=A({});me(()=>s.questions,o=>{const r={};o.forEach(f=>{r[f.key]=""}),i.value=r},{immediate:!0});const p=()=>{v("survey-completed",{...i.value}),u()},m=()=>{v("survey-refused"),u()},c=()=>{v("not-responding"),u()},u=()=>{a.value=!1;const o={};s.questions.forEach(r=>{o[r.key]=""}),i.value=o};return(o,r)=>(l(),n("div",sd,[a.value?(l(),n("div",od,[e("div",ld,[r[4]||(r[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:r[1]||(r[1]=f=>a.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...r[3]||(r[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",ad,[(l(!0),n(G,null,ee(t.questions,(f,k)=>(l(),n("div",{key:k,class:"bg-gray-50 rounded-md p-1.5"},[e("label",nd,y(f.label),1),f.type==="text"?O((l(),n("textarea",{key:0,"onUpdate:modelValue":b=>i.value[f.key]=b,placeholder:f.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,id)),[[U,i.value[f.key]]]):f.type==="select"?O((l(),n("select",{key:1,"onUpdate:modelValue":b=>i.value[f.key]=b,class:"input text-xs py-1 px-2"},[r[5]||(r[5]=e("option",{value:""},"Select an option...",-1)),(l(!0),n(G,null,ee(f.options,b=>(l(),n("option",{key:b,value:b},y(b),9,dd))),128))],8,rd)),[[de,i.value[f.key]]]):f.type==="radio"?(l(),n("div",ud,[(l(!0),n(G,null,ee(f.options,b=>(l(),n("label",{key:b,class:"flex items-center text-xs"},[O(e("input",{type:"radio","onUpdate:modelValue":h=>i.value[f.key]=h,value:b,class:"mr-1"},null,8,cd),[[Te,i.value[f.key]]]),F(" "+y(b),1)]))),128))])):g("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:c,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(l(),n("button",{key:0,onClick:r[0]||(r[0]=f=>a.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...r[2]||(r[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},md={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},pd={class:"flex justify-between items-start mb-3"},yd={class:"text-xs text-gray-500 mt-0.5"},gd={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],i=N(()=>{if(!s.opportunity.createdAt)return 0;const r=new Date(s.opportunity.createdAt),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),p=()=>{v("create-offer",s.opportunity)},m=()=>{v("review",s.opportunity)},c=r=>{v("survey-completed",{opportunity:s.opportunity,responses:r})},u=()=>{v("survey-refused",{opportunity:s.opportunity})},o=()=>{v("not-responding",{opportunity:s.opportunity})};return(r,f)=>(l(),n("div",md,[e("div",pd,[e("div",null,[f[0]||(f[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",yd,"This opportunity has been open for "+y(i.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),Y(we,{questions:a,onSurveyCompleted:c,onSurveyRefused:u,onNotResponding:o})]))}},vd={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},fd={class:"flex justify-between items-start mb-3"},bd={class:"text-xs text-gray-500 mt-0.5"},xd={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],i=N(()=>{if(!s.opportunity.createdAt)return 0;const o=new Date(s.opportunity.createdAt),f=Math.abs(new Date-o);return Math.ceil(f/(1e3*60*60*24))}),p=()=>{v("create-offer",s.opportunity)},m=o=>{v("survey-completed",{opportunity:s.opportunity,responses:o})},c=()=>{v("survey-refused",{opportunity:s.opportunity})},u=()=>{v("not-responding",{opportunity:s.opportunity})};return(o,r)=>(l(),n("div",vd,[e("div",fd,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",bd,"This opportunity has been open for "+y(i.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),Y(we,{questions:a,onSurveyCompleted:m,onSurveyRefused:c,onNotResponding:u})]))}},hd={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},wd={class:"flex justify-between items-start mb-3"},kd={class:"text-xs text-gray-500 mt-0.5"},$d={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],i=N(()=>{const o=s.opportunity.lastActivity||s.opportunity.createdAt;if(!o)return 0;const r=new Date(o),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),p=()=>{v("create-contract",s.opportunity)},m=o=>{v("survey-completed",{opportunity:s.opportunity,responses:o})},c=()=>{v("survey-refused",{opportunity:s.opportunity})},u=()=>{v("not-responding",{opportunity:s.opportunity})};return(o,r)=>(l(),n("div",hd,[e("div",wd,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",kd,"This opportunity has been in negotiation for "+y(i.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),Y(we,{questions:a,onSurveyCompleted:m,onSurveyRefused:c,onNotResponding:u})]))}},Cd={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Sd={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],i=()=>{v("schedule-closing",s.opportunity)},p=u=>{v("survey-completed",{opportunity:s.opportunity,responses:u})},m=()=>{v("survey-refused",{opportunity:s.opportunity})},c=()=>{v("not-responding",{opportunity:s.opportunity})};return(u,o)=>(l(),n("div",Cd,[o[0]||(o[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:i,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),Y(we,{questions:a,onSurveyCompleted:p,onSurveyRefused:m,onNotResponding:c})]))}},Ad={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Dd={class:"flex justify-between items-start mb-3"},Td={class:"font-bold text-slate-800 text-sm"},Id={class:"text-xs text-gray-500 mt-0.5"},qd={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:C}){const s=t,v=C,a=N(()=>{var b;return((b=s.scheduledAppointment)==null?void 0:b.noShowCount)||0}),i=N(()=>{const b=a.value;return b===0?"No-Show Follow-up":b>=3?`No-Show #${b} - Final Warning`:`No-Show #${b} Follow-up`}),p=N(()=>{const b=a.value;return b>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":b>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),m=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],c=N(()=>{var h;return(h=s.scheduledAppointment)!=null&&h.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),u=()=>{v("contact-customer",s.opportunity)},o=()=>{a.value>=3?v("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${a.value} no-shows`}):v("reschedule",s.opportunity)},r=b=>{v("survey-completed",{opportunity:s.opportunity,responses:b})},f=()=>{v("survey-refused",{opportunity:s.opportunity})},k=()=>{v("not-responding",{opportunity:s.opportunity})};return(b,h)=>(l(),n("div",Ad,[e("div",Dd,[e("div",null,[e("h4",Td,y(i.value),1),e("p",Id,"Appointment was scheduled for "+y(c.value)+" but customer did not show up. "+y(p.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:o,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...h[0]||(h[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),F(" Book Another Appointment ",-1)])]),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...h[1]||(h[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),F(" Contact Customer ",-1)])])]),Y(we,{questions:m,onSurveyCompleted:r,onSurveyRefused:f,onNotResponding:k})]))}},Od={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Nd={class:"flex justify-between items-start mb-3"},Md={class:"text-xs text-gray-500 mt-0.5"},Vd={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],i=N(()=>{var b;if(!((b=s.opportunity)!=null&&b.contractDate))return 0;const r=new Date(s.opportunity.contractDate),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),p=()=>{v("prepare-delivery",s.opportunity)},m=()=>{v("pre-delivery-checklist",s.opportunity)},c=r=>{v("survey-completed",{opportunity:s.opportunity,responses:r})},u=()=>{v("survey-refused",{opportunity:s.opportunity})},o=()=>{v("not-responding",{opportunity:s.opportunity})};return(r,f)=>(l(),n("div",Od,[e("div",Nd,[e("div",null,[f[0]||(f[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Md,"Contract was signed "+y(i.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),Y(we,{questions:a,onSurveyCompleted:c,onSurveyRefused:u,onNotResponding:o})]))}},Ld={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},jd={class:"flex justify-between items-start mb-3"},Fd={class:"text-xs text-gray-500 mt-0.5"},Rd={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const s=t,v=C,a=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],i=N(()=>{const o=s.activities.find(b=>{var h;return b.type==="delivery"||((h=b.action)==null?void 0:h.toLowerCase().includes("delivered"))});if(!o||!o.timestamp)return 0;const r=new Date(o.timestamp),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),p=()=>{v("delivery-feedback",s.opportunity)},m=o=>{v("survey-completed",{opportunity:s.opportunity,responses:o})},c=()=>{v("survey-refused",{opportunity:s.opportunity})},u=()=>{v("not-responding",{opportunity:s.opportunity})};return(o,r)=>(l(),n("div",Ld,[e("div",jd,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Fd,"Vehicle was delivered "+y(i.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),Y(we,{questions:a,onSurveyCompleted:m,onSurveyRefused:c,onNotResponding:u})]))}},Ud={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},Ed={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:C}){const s=t,v=C,a=()=>{v("close-won",s.opportunity)},i=()=>{v("close-lost",s.opportunity)};return(p,m)=>(l(),n("div",Ud,[m[2]||(m[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:a,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...m[0]||(m[0]=[F(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:i,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...m[1]||(m[1]=[F(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},Pd={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Bd={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},Wd={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},zd={class:"p-5 space-y-6"},Hd={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Qd={class:"flex gap-3"},Yd={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},Kd={class:"flex items-start gap-3"},Gd={class:"flex-1"},Jd={class:"font-bold text-slate-800 text-sm mb-1"},Xd={key:0},Zd={key:1},_d={class:"text-xs text-gray-600"},eu={key:0},tu={key:1},su={key:2},ou={class:"flex justify-between items-start mb-3"},lu={class:"font-bold text-slate-800 text-sm"},au={key:0},nu={key:1},iu={class:"text-xs text-gray-500 mt-0.5"},ru={key:0},du={key:1},uu={key:0,class:"mt-4"},cu={class:"[&>div]:mb-0"},mu={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},pu={class:"flex justify-between items-start mb-3"},yu={class:"text-xs text-gray-500 mt-0.5"},gu={key:0,class:"pt-4"},vu={key:10,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},fu={key:12,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},bu={class:"flex justify-between items-start mb-3"},xu={class:"text-xs text-gray-500 mt-0.5"},hu={class:"flex gap-3"},wu={key:0,class:"pt-4"},ku={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},$u={class:"p-6"},Cu={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Su={class:"p-6"},Au={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},triggerAppointmentModal:{type:Boolean,default:!1}},emits:["add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:C}){const s=t,v=C,a=N(()=>{var $,q,B;return(($=s.opportunity)==null?void 0:$.stage)==="Closed"||((q=s.opportunity)==null?void 0:q.stage)==="Closed Lost"||((B=s.opportunity)==null?void 0:B.stage)==="Registration"}),i=A(!1),p=A(!1),m=A(null),c=A(!1),u=A(""),o=A(!1),r=A(!1),f=A(!1),k=A(!1),b=A(!1),h=A([]);me(()=>s.triggerAppointmentModal,$=>{$&&(p.value=!0,m.value="contact-info")});const S=_e(),V=dt(),R=Ie();pe(()=>{h.value=rt.filter($=>$.stockDays!==null&&$.stockDays!==void 0).slice(0,5).map($=>({id:$.id,brand:$.brand,model:$.model,year:$.year,price:$.price,image:$.image||"",stockDays:$.stockDays}))});const Q=$=>{u.value=$,c.value=!0},J=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",ie=$=>$?new Date($).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",re=()=>{i.value=!i.value},w=$=>{i.value=!1},D=N(()=>{var _;if(!((_=s.opportunity)!=null&&_.createdAt))return 0;const $=new Date(s.opportunity.createdAt),B=Math.abs(new Date-$);return Math.ceil(B/(1e3*60*60*24))}),L=N(()=>{var q,B;return s.activities.some(_=>_.type==="offer")||((q=s.opportunity)==null?void 0:q.stage)==="In Negotiation"||((B=s.opportunity)==null?void 0:B.stage)==="Closed"}),z=N(()=>s.activities.some($=>$.type==="appointment")),te=N(()=>{var B,_,X,oe;const $=((B=s.opportunity)==null?void 0:B.contractDate)!==null&&((_=s.opportunity)==null?void 0:_.contractDate)!==void 0,q=s.activities.some(le=>{var ne,ge;return((ne=le.action)==null?void 0:ne.toLowerCase().includes("won"))||((ge=le.action)==null?void 0:ge.toLowerCase().includes("contract"))});return $||q||((X=s.opportunity)==null?void 0:X.stage)==="Closed"&&((oe=s.opportunity)==null?void 0:oe.probability)===100}),I=N(()=>s.activities.some($=>{var q,B;return $.type==="delivery"||((q=$.action)==null?void 0:q.toLowerCase().includes("delivered"))||((B=$.action)==null?void 0:B.toLowerCase().includes("delivery"))})),T=N(()=>{var q;if(((q=s.opportunity)==null?void 0:q.stage)!=="Qualified"||L.value||s.scheduledAppointment||z.value)return!1;const $=D.value;return $>=7&&$<14}),H=N(()=>{var q;return((q=s.opportunity)==null?void 0:q.stage)!=="Qualified"||L.value||s.scheduledAppointment||z.value?!1:D.value>=14}),x=N(()=>{var q;return((q=s.opportunity)==null?void 0:q.stage)!=="Qualified"||L.value||!s.scheduledAppointment?!1:D.value>=7}),W=N(()=>{const $=D.value;return $>=14?"high":$>=7?"medium":null}),se=N(()=>{var X;if(((X=s.opportunity)==null?void 0:X.stage)!=="In Negotiation")return!1;const $=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),B=Math.abs(new Date-$),_=Math.ceil(B/(1e3*60*60*24));return L.value&&!te.value&&_>=5}),fe=N(()=>{var ne,ge,tt;if(((ne=s.opportunity)==null?void 0:ne.stage)!=="In Negotiation")return!1;const $=((ge=s.opportunity)==null?void 0:ge.contractDate)!==null&&((tt=s.opportunity)==null?void 0:tt.contractDate)!==void 0,q=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||z.value&&s.activities.some(Ge=>{var st;return Ge.type==="appointment"&&((st=Ge.data)!=null&&st.datetime)?new Date(Ge.data.datetime)>new Date:!1}),B=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),X=Math.abs(new Date-B);return Math.ceil(X/(1e3*60*60*24))>=5&&!$&&!q}),ke=N(()=>{var le,ne,ge;if(((le=s.opportunity)==null?void 0:le.stage)!=="Closed"&&((ne=s.opportunity)==null?void 0:ne.stage)!=="Registration")return!1;const $=(ge=s.opportunity)==null?void 0:ge.contractDate;if(!$||I.value)return!1;const q=new Date($),_=Math.abs(new Date-q);return Math.ceil(_/(1e3*60*60*24))>=7}),Re=N(()=>{const $=s.activities.find(le=>{var ne;return le.type==="delivery"||((ne=le.action)==null?void 0:ne.toLowerCase().includes("delivered"))});if(!$)return!1;const q=new Date($.timestamp),_=Math.abs(new Date-q);return Math.ceil(_/(1e3*60*60*24))>=3}),Oe=N(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const B=s.activities.some(X=>{var oe,le,ne;return X.type==="appointment"&&(((oe=X.data)==null?void 0:oe.status)==="completed"||((le=X.action)==null?void 0:le.toLowerCase().includes("completed")))&&((ne=X.data)==null?void 0:ne.appointmentId)===s.scheduledAppointment.id}),_=s.scheduledAppointment.status==="no-show";return!B&&!_}),Ne=N(()=>!a.value),ce=N(()=>{var X,oe,le;if(((X=s.opportunity)==null?void 0:X.stage)!=="Closed"||!((oe=s.opportunity)!=null&&oe.contractDate)||I.value||((le=s.opportunity)==null?void 0:le.stage)==="Registration")return!1;const $=new Date(s.opportunity.contractDate),B=Math.abs(new Date-$);return Math.ceil(B/(1e3*60*60*24))>=7}),Ue=()=>{Q("Add Vehicle from Stock")},Me=()=>{Q("Configure Vehicle")},Ce=()=>{o.value=!0},Se=()=>{o.value=!1},Ee=$=>{o.value=!1,v("create-offer",{opportunity:s.opportunity,offerData:$})},Pe=$=>{v("add-to-opportunity",$)},Be=$=>{Q("Review Opportunity")},We=$=>{f.value=!0},ze=$=>{f.value=!1},Ve=$=>{p.value=!0,m.value=$},be=()=>{p.value=!1,m.value=null},ye=$=>{Ve("nfu")},He=async $=>{var X;be();const q=`${$.date}T${$.time}:00`,B=new Date(q);B.setHours(B.getHours()+1);const _={type:"appointment",user:((X=R.currentUser)==null?void 0:X.name)||"You",action:"scheduled an appointment",content:`Appointment scheduled: ${$.type} on ${$.date} at ${$.time}`,data:{type:$.type,assignee:$.assignee,date:$.date,time:$.time,datetime:q,status:"scheduled"},timestamp:new Date().toISOString()};try{await V.addActivity(s.opportunity.id,_);const oe={title:`${$.type} - ${s.opportunity.customer.name}`,start:q,end:B.toISOString(),type:$.type.toLowerCase().replace(" ","-"),customer:s.opportunity.customer.name,vehicle:`${s.opportunity.vehicle.brand} ${s.opportunity.vehicle.model}`,assignee:$.assignee,assigneeId:$.assigneeId,dealership:s.opportunity.vehicle.dealership||"Main",team:"Sales (New)",status:"confirmed",opportunityId:s.opportunity.id};await Xe(oe),await V.loadOpportunityById(s.opportunity.id)}catch(oe){console.error("Failed to schedule appointment:",oe)}},Qe=$=>{k.value=!0},Ye=$=>{Q("Pre-Delivery Checklist")},Ke=$=>{k.value=!1},Le=$=>{Q("Delivery Feedback")},je=()=>{gt()},Fe=()=>{r.value=!0},E=$=>{},d=$=>{r.value=!1},M=()=>{Q("Contact Customer")},ue=$=>{},xe=$=>{},he=$=>{},mt=async()=>{try{await V.reopenOpportunity(s.opportunity.id),await V.loadOpportunityById(s.opportunity.id)}catch($){console.error("Failed to reopen opportunity:",$)}},pt=async()=>{try{b.value=!1;const $=await V.convertOpportunityToLead(s.opportunity.id);R.canAccessLeads()?S.push({path:`/tasks/${$}`,query:{type:"lead"}}):S.push("/tasks/1")}catch($){console.error("Failed to convert opportunity to lead:",$),b.value=!1}},yt=async()=>{try{await V.markAsRegistration(s.opportunity.id),await V.loadOpportunityById(s.opportunity.id)}catch($){console.error("Failed to mark as registration:",$)}},gt=async()=>{try{await V.markAsClosedWon(s.opportunity.id),await V.loadOpportunityById(s.opportunity.id)}catch($){console.error("Failed to mark as closed won:",$)}};return($,q)=>t.opportunity?(l(),n("div",Pd,[e("div",Bd,[q[9]||(q[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")],-1)),e("span",Wd,y(a.value?"Closed":"Active"),1)]),e("div",zd,[a.value?(l(),n("div",Hd,[q[12]||(q[12]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",Qd,[e("button",{onClick:mt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...q[10]||(q[10]=[F(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:q[0]||(q[0]=B=>b.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...q[11]||(q[11]=[F(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):g("",!0),x.value?(l(),n("div",Yd,[e("div",Kd,[q[13]||(q[13]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",Gd,[e("h4",Jd,[W.value==="high"?(l(),n("span",Xd,"High Risk")):(l(),n("span",Zd,"At Risk"))]),e("p",_d,[W.value==="high"?(l(),n("span",eu," This opportunity has been open for "+y(D.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(l(),n("span",tu," This opportunity has been open for "+y(D.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):g("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(l(),n("div",su,[e("div",{class:j([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",ou,[e("div",null,[e("h4",lu,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(l(),n("span",au," Vehicle Actions ")):(l(),n("span",nu," Find Alternative Vehicle "))]),e("p",iu,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(l(),n("span",ru," The requested vehicle is available. Create an offer or explore other options. ")):(l(),n("span",du," The requested vehicle is currently out of stock. Explore alternatives. "))])])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:Ue,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:Me,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:Ce,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(l(),n("div",uu,[e("div",cu,[Y(td,{onAddToOpportunity:Pe})])])):g("",!0)],2)])):g("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(l(),n("div",mu,[e("div",pu,[e("div",null,[q[14]||(q[14]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",yu,y(t.scheduledAppointment.title)+" on "+y(J(t.scheduledAppointment.start))+" at "+y(ie(t.scheduledAppointment.start)),1)])]),e("button",{onClick:re,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),i.value?(l(),n("div",gu,[Y(Ze,{show:i.value,onClose:q[1]||(q[1]=B=>i.value=!1),onConfirm:w},null,8,["show"])])):g("",!0)])):g("",!0),Oe.value?(l(),K(qd,{key:4,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:M,onReschedule:$.openRescheduleModal,onAutoCloseLost:E,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity","scheduled-appointment","onReschedule"])):g("",!0),H.value?(l(),K(xd,{key:5,opportunity:t.opportunity,onCreateOffer:Ce,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):g("",!0),T.value?(l(),K(gd,{key:6,opportunity:t.opportunity,onCreateOffer:Ce,onReview:Be,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):g("",!0),fe.value?(l(),K(Sd,{key:7,opportunity:t.opportunity,onScheduleClosing:ye,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):g("",!0),se.value?(l(),K($d,{key:8,opportunity:t.opportunity,onCreateContract:We,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):g("",!0),ke.value?(l(),K(Vd,{key:9,opportunity:t.opportunity,onPrepareDelivery:Qe,onPreDeliveryChecklist:Ye,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):g("",!0),ce.value?(l(),n("div",vu,[q[16]||(q[16]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:yt,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...q[15]||(q[15]=[F(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):g("",!0),Re.value?(l(),K(Rd,{key:11,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:Le,onSurveyCompleted:ue,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity","activities"])):g("",!0),a.value?g("",!0):(l(),n("div",fu,[e("div",bu,[e("div",null,[q[17]||(q[17]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Schedule Appointment",-1)),e("p",xu,y(t.scheduledAppointment?"Reschedule or book a new appointment with the customer.":"Schedule an appointment with the customer to move forward."),1)])]),e("div",hu,[e("button",{onClick:q[2]||(q[2]=B=>Ve("general")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},y(t.scheduledAppointment?"Schedule New Appointment":"Schedule Appointment"),1),t.scheduledAppointment?(l(),n("button",{key:0,onClick:re,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Reschedule Existing ")):g("",!0)]),i.value?(l(),n("div",wu,[Y(Ze,{show:i.value,onClose:q[3]||(q[3]=B=>i.value=!1),onConfirm:w},null,8,["show"])])):g("",!0)])),Ne.value?(l(),K(Ed,{key:13,opportunity:t.opportunity,onCloseWon:je,onCloseLost:Fe},null,8,["opportunity"])):g("",!0)]),Y(Xi,{show:c.value,title:u.value,onClose:q[4]||(q[4]=B=>c.value=!1)},null,8,["show","title"]),Y(er,{show:r.value,onConfirm:d,onCancel:q[5]||(q[5]=B=>r.value=!1)},null,8,["show"]),Y(dr,{show:b.value,onConfirm:pt,onCancel:q[6]||(q[6]=B=>b.value=!1)},null,8,["show"]),Y(lr,{show:f.value,onConfirm:ze,onCancel:q[7]||(q[7]=B=>f.value=!1)},null,8,["show"]),Y(rr,{show:k.value,onConfirm:Ke,onCancel:q[8]||(q[8]=B=>k.value=!1)},null,8,["show"]),(l(),K(De,{to:"body"},[o.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ae(Se,["self"])},[e("div",ku,[e("div",$u,[Y(Pr,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":h.value,onSave:Ee,onCancel:Se},null,8,["task-id","requested-car","recommended-cars"])])])])):g("",!0)])),(l(),K(De,{to:"body"},[p.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ae(be,["self"])},[e("div",Cu,[e("div",Su,[Y(et,{show:p.value,onConfirm:He,onCancel:be},null,8,["show"])])])])):g("",!0)]))])):g("",!0)}},Du={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},Tu={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},Iu={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},qu={class:"text-[10px] font-bold uppercase tracking-wide"},Ou={key:1,class:"text-right"},Nu={class:"text-sm font-bold text-gray-900"},Mu=["onClick"],Vu=["onClick"],Lu=["onClick"],ju={class:"flex-1 flex flex-col overflow-hidden"},Fu={class:"lg:hidden xl:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},Ru={key:0,class:"flex-1 flex items-center justify-center"},Uu={key:0,class:"xl:hidden fixed inset-0 z-[60] bg-white"},Qu={__name:"Tasks",setup(t){const C=wt(),s=_e(),v=it(),a=dt(),i=Ie(),p=A("all"),m=A(null),c=A(!1),u=A(!1),o=N(()=>{const T=v.leads.filter(W=>!W.isDisqualified).map(W=>({...W,type:"lead",compositeId:`lead-${W.id}`})),H=a.opportunities.map(W=>({...W,type:"opportunity",compositeId:`opportunity-${W.id}`}));let x=[];return i.isOperator()?x=T:i.isSalesman()?x=H:x=[...T,...H],x.sort((W,se)=>{const fe=new Date(W.lastActivity||W.createdAt||0);return new Date(se.lastActivity||se.createdAt||0)-fe})}),r=N(()=>p.value==="all"?o.value:o.value.filter(I=>I.type===p.value)),f=N(()=>{const I=o.value.some(H=>H.type==="lead"),T=o.value.some(H=>H.type==="opportunity");return I&&T}),k=N(()=>{const I=parseInt(C.params.id),T=C.query.type;if(T)return o.value.find(W=>W.id===I&&W.type===T)||null;const x=(p.value!=="all"?o.value.filter(W=>W.type===p.value):o.value).find(W=>W.id===I);return x||o.value.find(W=>W.id===I)||null}),b=N(()=>k.value?k.value.type==="lead"?v.currentLeadActivities:a.currentOpportunityActivities:[]),h=N(()=>k.value?k.value.type==="lead"?Ji:Au:null),S=N(()=>k.value?k.value.type==="lead"?{currentActivities:N(()=>v.currentLeadActivities),addActivity:(I,T)=>v.addActivity(I,T),updateActivity:(I,T,H)=>v.updateActivity(I,T,H),deleteActivity:(I,T)=>v.deleteActivity(I,T)}:{currentActivities:N(()=>a.currentOpportunityActivities),addActivity:(I,T)=>a.addActivity(I,T),updateActivity:(I,T,H)=>a.updateActivity(I,T,H),deleteActivity:(I,T)=>a.deleteActivity(I,T)}:null),V=N(()=>k.value?k.value.type==="lead"?{overviewActions:["purchase-method","tradein"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["purchase-method","tradein"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),R=N(()=>I=>I.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"),Q=I=>I.scheduledAppointment?new Date(I.scheduledAppointment.start)<new Date:!1;pe(()=>{v.loadLeads(),a.loadOpportunities();const I=C.params.id;I?ie(I):J()});const J=()=>{const I=r.value[0];I&&s.replace({path:`/tasks/${I.id}`,query:{type:I.type}})};me(()=>C.params.id,I=>{I?ie(I):J()}),me(k,I=>{I&&(I.type==="lead"?v.loadLeadById(I.id):a.loadOpportunityById(I.id))},{immediate:!0});const ie=I=>{const T=parseInt(I),H=o.value.find(x=>x.id===T);H&&(H.type==="lead"?v.loadLeadById(T):a.loadOpportunityById(T))},re=I=>{const[T,H]=I.split("-");s.push({path:`/tasks/${H}`,query:{type:T}}),c.value=!1},w=I=>{m.value=m.value===I?null:I},D=I=>{m.value=null},L=async I=>{m.value=null,I.type==="lead"?await v.modifyLead(I.id,{priority:"Hot"}):I.type==="opportunity"&&await a.modifyOpportunity(I.id,{priority:"Hot"})},z=async I=>{m.value=null,I.type==="lead"?await v.modifyLead(I.id,{priority:"Normal"}):I.type==="opportunity"&&await a.modifyOpportunity(I.id,{priority:"Normal"})},te=I=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[I]||"bg-gray-100 text-gray-700 border-gray-200";return(I,T)=>{var H;return l(),n("div",Du,[e("div",{class:j(["lg:relative lg:block",c.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[Y(Ht,{title:"My Tasks",items:r.value,"selected-id":(H=k.value)==null?void 0:H.compositeId,"type-filter":p.value,"selected-class":x=>x.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":R.value,"open-menu-id":m.value,getName:x=>x.customer.name,getInitials:x=>x.customer.initials,getVehicleInfo:x=>x.type==="lead"?`${x.requestedCar.brand} ${x.requestedCar.model}`:`${x.vehicle.brand} ${x.vehicle.model}`,avatarClass:x=>x.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:re,onMenuClick:w,onMenuClose:T[0]||(T[0]=x=>m.value=null),onClose:T[1]||(T[1]=x=>c.value=!1),"show-type-filter":f.value,onFilterChange:T[2]||(T[2]=x=>p.value=x)},{badges:Z(({item:x})=>[e("span",{class:j(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",x.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},y(x.type==="lead"?"Lead":"Opportunity"),3),x.type==="lead"?(l(),n(G,{key:0},[e("span",Tu,y(x.status),1),x.priority==="Hot"?(l(),n("span",Iu,[...T[6]||(T[6]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),F(" Hot ",-1)])])):g("",!0)],64)):(l(),n("span",{key:1,class:j(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",te(x.stage)])},y(x.stage),3))]),meta:Z(({item:x})=>[x.type==="lead"?(l(),n("div",{key:0,class:j(["flex items-center gap-1.5",Q(x)?"text-red-500":x.priority==="Hot"?"text-orange-500":"text-gray-400"])},[e("i",{class:j(["text-[10px]",Q(x)?"fa-solid fa-exclamation-triangle":"fa-solid fa-clock"])},null,2),e("span",qu,y(Q(x)?"overdue":x.nextActionDue?`Due in ${P(kt)(x.nextActionDue)}`:"Pending"),1)],2)):(l(),n("div",Ou,[e("div",Nu,"€"+y(P($t)(x.value)),1)]))]),menu:Z(({item:x})=>[e("button",{onClick:ae(W=>D(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...T[7]||(T[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),F(" Reassign ",-1)])],8,Mu),x.priority!=="Hot"?(l(),n("button",{key:0,onClick:ae(W=>L(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...T[8]||(T[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),F(" Mark as hot ",-1)])],8,Vu)):(l(),n("button",{key:1,onClick:ae(W=>z(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...T[9]||(T[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),F(" Unmark as hot ",-1)])],8,Lu))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),e("div",ju,[e("div",Fu,[k.value?(l(),n("button",{key:0,onClick:T[3]||(T[3]=x=>u.value=!u.value),class:"w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-all hover:scale-110",title:"Activity"},[...T[10]||(T[10]=[e("i",{class:"fa-solid fa-clock-rotate-left text-lg"},null,-1)])])):g("",!0),e("button",{onClick:T[4]||(T[4]=x=>c.value=!c.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...T[11]||(T[11]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])]),k.value?(l(),K(la,{key:1,task:k.value,type:k.value.type,"management-widget":h.value,"store-adapter":S.value,"add-new-config":V.value},{"pinned-extra":Z(({task:x})=>[x.type==="lead"&&x.requestedCar?(l(),K(nt,{key:0,brand:x.requestedCar.brand,model:x.requestedCar.model,year:x.requestedCar.year,image:x.requestedCar.image||"",price:x.requestedCar.price||null,"request-message":x.requestedCar.requestMessage||"","request-type":x.requestedCar.requestType||"",source:x.source||"",dealership:x.requestedCar.dealership||"",registration:x.requestedCar.registration||"",kilometers:x.requestedCar.kilometers||null,"fuel-type":x.requestedCar.fuelType||"","gear-type":x.requestedCar.gearType||"",vin:x.requestedCar.vin||"","stock-days":x.requestedCar.stockDays!==void 0?x.requestedCar.stockDays:null,channel:x.requestedCar.channel||"Email","ad-campaign":x.requestedCar.adCampaign||"","expected-purchase-date":x.requestedCar.expectedPurchaseDate||"","fiscal-entity":x.requestedCar.fiscalEntity||"","source-details":x.requestedCar.sourceDetails||"","ad-medium":x.requestedCar.adMedium||"","ad-source":x.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):g("",!0),x.type==="opportunity"&&x.vehicle?(l(),K(nt,{key:1,brand:x.vehicle.brand,model:x.vehicle.model,year:x.vehicle.year,image:x.vehicle.image||"",price:x.vehicle.price||null,"request-message":x.vehicle.requestMessage||"","request-type":x.vehicle.requestType||"",source:x.source||"",dealership:x.vehicle.dealership||"",registration:x.vehicle.registration||"",kilometers:x.vehicle.kilometers||null,"fuel-type":x.vehicle.fuelType||"","gear-type":x.vehicle.gearType||"",vin:x.vehicle.vin||"","stock-days":x.vehicle.stockDays!==void 0?x.vehicle.stockDays:null,channel:x.vehicle.channel||"Email","ad-campaign":x.vehicle.adCampaign||"","expected-purchase-date":x.vehicle.expectedPurchaseDate||"","fiscal-entity":x.vehicle.fiscalEntity||"","source-details":x.vehicle.sourceDetails||"","ad-medium":x.vehicle.adMedium||"","ad-source":x.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):g("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(l(),n("div",Ru,[...T[12]||(T[12]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),u.value&&k.value?(l(),n("div",Uu,[Y(lt,{title:"Activity summary",activities:b.value,collapsed:!1,"show-collapse":!1,show:!0,"mobile-fullscreen":!0,onClose:T[5]||(T[5]=x=>u.value=!1),class:"flex w-full h-full"},null,8,["activities"])])):g("",!0),Y(lt,{title:"Activity summary",activities:b.value,collapsed:!1,"show-collapse":!1,show:!!k.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{Qu as default};
