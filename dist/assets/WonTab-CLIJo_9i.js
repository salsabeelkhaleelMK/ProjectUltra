import{h as U,r as a,c as T,m as $,d as B,o as I,s as M,D as q,e as o,y as n}from"./index-BZwEnuDT.js";import{y as R}from"./components-BBuk30SU.js";import{a as W}from"./opportunities-D5y9S6Q1.js";import{g as V,c as z,f as E}from"./formatters-B1RFjlNy.js";import{u as G}from"./useCustomersTable-BoEow86_.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D2e1bD8Q.js";const K={class:"table-wrapper w-full"},X={__name:"WonTab",setup(L){const w=U(),i=W(),r=a({pageIndex:0,pageSize:10}),l=a(""),u=a([]),c=a([]),d=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",m=T(()=>i.opportunities.filter(t=>t.stage==="Closed Won").map(t=>{var s,p,f,y,v,b,D,x,k,C,F,h;const e=((s=t.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${t.id}`,stageKey:"won",customer:((p=t.customer)==null?void 0:p.name)||"Unknown",email:((f=t.customer)==null?void 0:f.email)||"",initials:((y=t.customer)==null?void 0:y.initials)||((b=(v=t.customer)==null?void 0:v.name)==null?void 0:b.slice(0,2).toUpperCase())||"?",nextAction:E(t.expectedCloseDate)||"No due date",nextActionFull:z(t.expectedCloseDate),deadlineStatus:V(t.expectedCloseDate),car:`${((D=t.vehicle)==null?void 0:D.brand)||""} ${((x=t.vehicle)==null?void 0:x.model)||""}`.trim()||"N/A",carStatus:((k=t.vehicle)==null?void 0:k.stockDays)!==void 0&&((C=t.vehicle)==null?void 0:C.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((F=t.vehicle)==null?void 0:F.stockDays)!==void 0&&((h=t.vehicle)==null?void 0:h.stockDays)!==null?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body",requestType:t.requestType||"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:d(t.createdAt),lastAppointment:e?d(e):"N/A",status:t.stage,statusClass:"bg-green-100 text-green-700",priority:t.priority||"Normal"}})),g=t=>{if(t.id.startsWith("opp-")){const e=t.id.match(/-(\d+)$/),s=e?e[1]:t.id.replace("opp-","");w.push({path:`/tasks/${s}`,query:{type:"opportunity"}})}},A=a("won"),{columns:S,filterDefinitions:O,tableMeta:N}=G(A,g);return $(async()=>{await i.fetchOpportunities()}),(t,e)=>(I(),B("div",K,[M(n(R),{data:m.value,columns:n(S),meta:n(N),onRowClick:g,columnFiltersOptions:{filterDefs:n(O)},pagination:r.value,"onUpdate:pagination":e[0]||(e[0]=s=>r.value=s),globalFilter:l.value,"onUpdate:globalFilter":e[1]||(e[1]=s=>l.value=s),sorting:u.value,"onUpdate:sorting":e[2]||(e[2]=s=>u.value=s),columnFilters:c.value,"onUpdate:columnFilters":e[3]||(e[3]=s=>c.value=s),paginationOptions:{rowCount:m.value.length},globalFilterOptions:{debounce:300}},{"empty-state":q(()=>[...e[4]||(e[4]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{X as default};
