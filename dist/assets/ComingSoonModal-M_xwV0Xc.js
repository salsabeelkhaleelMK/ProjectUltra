import{r as O,R as at,h as Be,c as $,H as Fe,d as o,o as a,e,y,n as I,w as X,t as c,F as R,i as P,p as N,g as p,s as C,P as Ue,a4 as pt,G as nt,x as j,z as Oe,k as V,v as ge,j as ve,J as L,Q as F,l as ie,m as xe,D as M,a5 as bt,Z as yt,V as vt,I as gt,X as Ke,O as Y,N as oe,K as te}from"./index-GeQorrw7.js";import{_ as xt}from"./ReassignUserModal-Ek3V9cSB.js";import{_ as ht}from"./CreateEventModal-CzOLmeqM.js";import{z as he,F as ke,L as we,H as Ce,j as $e,K as We,C as Se,W as Ae}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-T4S5wbX9.js";import{u as kt}from"./opportunities-BMFR2tyk.js";const wt={class:"w-full p-3 md:px-8 md:py-3.5 border-b border-black/5 shadow-xs",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ct={class:"flex items-center justify-between gap-4"},$t={class:"flex items-center gap-2 flex-1 min-w-0"},St={class:"flex items-center gap-3 min-w-0 flex-1"},At={class:"min-w-0 flex-1"},Tt={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},Dt={class:"flex flex-col gap-1.5 mt-1"},qt={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},Et={class:"flex items-center gap-1.5 group"},Ot={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},It={class:"flex items-center gap-1.5 group"},Nt={class:"text-xs text-heading font-medium whitespace-nowrap"},Mt={class:"flex items-center gap-1.5"},jt={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},Lt={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},Vt={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},Bt={class:"flex flex-wrap items-center gap-1.5"},Ft={class:"shrink-0"},Ut={class:"relative"},Wt={key:0,class:"absolute top-full right-0 mt-2 z-50 shadow-xl"},Rt={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]}},emits:["action","add-tag"],setup(t,{emit:r}){const n=t,d=r,m=O(!1),s=at(),b=Be(),f=$(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...n.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(T=>({...T,onClick:()=>l(T.key)}))),l=E=>{m.value=!1,d("action",E)},i=async(E,T)=>{try{await navigator.clipboard.writeText(E),s.pushToast("success",`${T==="email"?"Email":"Phone"} copied!`)}catch{s.pushToast("error","Failed to copy")}},u=()=>d("add-tag"),k=()=>{n.customerId&&b.push(`/customer/${n.customerId}`)};return(E,T)=>{const A=Fe("click-outside");return a(),o("div",wt,[e("div",Ct,[e("div",$t,[e("button",{onClick:T[0]||(T[0]=x=>y(b).push("/customers")),class:"w-7 h-7 flex items-center justify-center text-sub hover:text-brand-dark transition-colors shrink-0 -ml-1","aria-label":"Back to customers"},[...T[4]||(T[4]=[e("i",{class:"fa-solid fa-arrow-left text-xs"},null,-1)])]),e("div",St,[e("button",{onClick:X(k,["stop"]),class:I(["w-20 h-20 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...T[5]||(T[5]=[e("i",{class:"fa-solid fa-user text-3xl text-white"},null,-1)])],2),e("div",At,[e("h1",Tt,c(t.name),1),e("div",Dt,[e("div",qt,[e("div",Et,[T[7]||(T[7]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",Ot,c(t.email),1),e("button",{onClick:T[1]||(T[1]=X(x=>i(t.email,"email"),["stop"])),class:"transition-all"},[...T[6]||(T[6]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",It,[T[9]||(T[9]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",Nt,c(t.phone),1),e("button",{onClick:T[2]||(T[2]=X(x=>i(t.phone,"phone"),["stop"])),class:"transition-all"},[...T[8]||(T[8]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",Mt,[t.thirdFieldLabel.toLowerCase().includes("address")?(a(),o("i",jt)):(a(),o("i",Lt)),e("span",Vt,c(t.thirdFieldValue),1)])]),e("div",Bt,[(a(!0),o(R,null,P(t.tags,x=>(a(),o("span",{key:x,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},c(x),1))),128)),e("button",{onClick:X(u,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...T[10]||(T[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])])]),e("div",Ft,[e("div",Ut,[e("button",{onClick:T[3]||(T[3]=X(x=>m.value=!m.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...T[11]||(T[11]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),m.value?N((a(),o("div",Wt,[C(y(Ue),{items:f.value,className:"w-48"},null,8,["items"])])),[[A,()=>m.value=!1]]):p("",!0)])])])])}}},Pt={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},zt=["onClick"],Ge={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const r={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-thumbtack",manage:"fa-solid fa-gear",data:"fa-solid fa-database",notes:"fa-solid fa-note-sticky"},n=d=>r[d]||"fa-solid fa-circle";return(d,m)=>(a(),o("div",Pt,[(a(!0),o(R,null,P(t.tabs,s=>(a(),o("div",{key:s.key,onClick:b=>d.$emit("update:modelValue",s.key),class:I(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===s.key?"border-brand-dark text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:I([n(s.key),"text-sm md:text-sm",t.modelValue===s.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:I(["hidden md:inline whitespace-nowrap",t.modelValue===s.key?"text-brand-darkDarker":""])},c(s.label),3)],10,zt))),128))]))}},Qt={class:"w-full mb-6"},Ht={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},Yt={class:"px-4 md:px-6 py-3 border-b border-black/5"},Kt={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},Gt={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},Jt={class:"flex items-center gap-1.5"},Xt={key:1},Zt={class:"flex items-center gap-2"},_t={key:0,class:"p-4 md:p-6"},es={key:0,class:"space-y-4"},ts={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ss={class:"flex items-center gap-4"},as={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},ns=["src"],ls={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},is={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},os={class:"flex items-center gap-2 flex-wrap"},ds={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},rs={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},us={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},cs={class:"text-fluid-xs font-bold text-heading"},ms={key:0,class:"text-right"},fs={class:"font-bold text-heading text-fluid-lg"},ps={key:0,class:"pt-2"},bs={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},ys={class:"text-fluid-sm text-body leading-relaxed"},vs={key:1,class:"space-y-3"},gs={key:0,class:"flex items-center gap-2"},xs={class:"text-fluid-sm font-semibold text-heading"},hs={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},ks={class:"text-fluid-sm text-body leading-relaxed"},ws={key:1,class:"border-t border-black/5"},Cs={class:"font-medium"},$s={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},Ss={class:"mb-6"},As={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ts={key:0},Ds={class:"font-medium text-body"},qs={key:1},Es={class:"font-medium text-body"},Os={key:2},Is={class:"font-medium text-body"},Ns={class:"font-medium text-body"},Ms={key:0},js={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ls={key:0},Vs={class:"font-medium text-body"},Bs={key:1},Fs={class:"font-medium text-body"},Us={key:2},Ws={class:"font-medium text-body"},Rs={key:3},Ps={class:"font-medium text-body"},zs={key:4},Qs={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},Hs={key:5},Ys={class:"font-medium text-body"},Ks={key:0,class:"mt-6 flex justify-end"},Gs={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const r=t,n=O(!1);$(()=>r.deliverySubstatus?pt(r.deliverySubstatus):"");const d=$(()=>r.deliverySubstatus?r.deliverySubstatus==="Delivered"?"green":r.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),m=$(()=>nt(r.stage,r.entityType));function s(w){return!w||w.length===0?null:w.filter(J=>J.type==="offer").sort((J,ae)=>new Date(ae.timestamp)-new Date(J.timestamp))[0]||null}function b(w){if(!w)return 0;const g=new Date(w),ae=Math.abs(new Date-g);return Math.ceil(ae/(1e3*60*60*24))}const f=$(()=>{if(r.stage!=="In Negotiation")return null;const w=s(r.activities);if(!w)return null;const g=b(w.timestamp);return g<1?{label:"New Offer",theme:"orange"}:g<3?{label:"Active",theme:"yellow"}:null}),l=$(()=>r.requestedCar&&r.requestedCar.brand&&r.requestedCar.model),i=$(()=>r.requestType||r.requestMessage||l.value),u=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.brand)||""}),k=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.model)||""}),E=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.year)||""}),T=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.image)||""}),A=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.price)||null}),x=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.stockDays)!==void 0?r.requestedCar.stockDays:null}),D=$(()=>{var w,g;return((w=r.requestedCar)==null?void 0:w.dealership)||((g=r.task)==null?void 0:g.dealership)||""}),q=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.registration)||""}),B=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.kilometers)!==void 0?r.requestedCar.kilometers:null}),U=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.fuelType)||""}),de=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.gearType)||""}),Te=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.vin)||""}),Ie=$(()=>"Email"),fe=$(()=>{var w,g;return((w=r.task)==null?void 0:w.sourceDetails)||((g=r.requestedCar)==null?void 0:g.adCampaign)||""}),_=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.expectedPurchaseDate)||""}),pe=$(()=>{var w;return((w=r.task)==null?void 0:w.fiscalEntity)||""}),be=$(()=>{var w;return((w=r.task)==null?void 0:w.sourceDetails)||""}),re=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.adMedium)||""}),ye=$(()=>{var w;return((w=r.requestedCar)==null?void 0:w.adSource)||""});$(()=>!0);const G=$(()=>!0),z=$(()=>l.value||r.requestType||r.source||be.value||fe.value||_.value||pe.value||re.value||ye.value),se=w=>new Intl.NumberFormat("en-US").format(w),ue=w=>new Intl.NumberFormat("en-US").format(w);return(w,g)=>(a(),o("div",Qt,[e("div",Ht,[e("div",Yt,[e("div",Kt,[i.value?(a(),o("div",Gt,[g[2]||(g[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",Jt,[e("span",{class:I(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-0.5 rounded text-fluid-xs font-medium border",m.value])},c(t.stage),3),t.deliverySubstatus?(a(),j(y(Oe),{key:0,text:t.deliverySubstatus,size:"small",theme:d.value},null,8,["text","theme"])):p("",!0),f.value?(a(),j(y(Oe),{key:1,text:f.value.label,size:"small",theme:f.value.theme},null,8,["text","theme"])):p("",!0)])])):(a(),o("div",Xt)),e("div",Zt,[g[3]||(g[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:g[0]||(g[0]=J=>w.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},c(t.owner),1)])])]),i.value?(a(),o("div",_t,[l.value?(a(),o("div",es,[e("div",ts,[e("div",ss,[e("div",as,[T.value?(a(),o("img",{key:0,src:T.value,alt:"Car",class:"w-full h-full object-cover"},null,8,ns)):(a(),o("i",ls))]),e("div",null,[e("div",is,c(u.value)+" "+c(k.value)+" ("+c(E.value)+")",1),e("div",os,[x.value!==void 0&&x.value!==null?(a(),o("div",ds,[g[4]||(g[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+c(x.value)+" days) ",1)])):l.value?(a(),o("div",rs,[...g[5]||(g[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])])):p("",!0),t.source?(a(),o("div",us,[g[6]||(g[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",cs,c(t.source),1)])):p("",!0)])])]),A.value?(a(),o("div",ms,[g[7]||(g[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",fs,"€ "+c(se(A.value)),1)])):p("",!0)]),t.requestMessage?(a(),o("div",ps,[g[8]||(g[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",bs,[e("p",ys,c(t.requestMessage),1)])])):p("",!0)])):(a(),o("div",vs,[t.requestType?(a(),o("div",gs,[g[9]||(g[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",xs,c(t.requestType),1)])):p("",!0),t.requestMessage?(a(),o("div",hs,[g[10]||(g[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",ks,c(t.requestMessage),1)])):p("",!0)]))])):p("",!0),z.value?(a(),o("div",ws,[e("button",{onClick:g[1]||(g[1]=J=>n.value=!n.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Cs,c(n.value?"Hide":"View")+" Details",1),e("i",{class:I(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":n.value}])},null,2)])])):p("",!0),n.value&&z.value?(a(),o("div",$s,[e("div",Ss,[g[21]||(g[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",As,[t.requestType?(a(),o("div",Ts,[g[11]||(g[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",Ds,c(t.requestType),1)])):p("",!0),t.source?(a(),o("div",qs,[g[12]||(g[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",Es,c(t.source),1)])):p("",!0),e("div",null,[g[13]||(g[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:I(["font-medium",be.value?"text-body":"text-sub"])},c(be.value||"--"),3)]),D.value?(a(),o("div",Os,[g[14]||(g[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Is,c(D.value),1)])):p("",!0),e("div",null,[g[15]||(g[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",Ns,c(Ie.value||"Email"),1)]),e("div",null,[g[16]||(g[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:I(["font-medium",fe.value?"text-body":"text-sub"])},c(fe.value||"--"),3)]),e("div",null,[g[17]||(g[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:I(["font-medium",re.value?"text-body":"text-sub"])},c(re.value||"--"),3)]),e("div",null,[g[18]||(g[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:I(["font-medium",ye.value?"text-body":"text-sub"])},c(ye.value||"--"),3)]),e("div",null,[g[19]||(g[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:I(["font-medium",_.value?"text-body":"text-sub"])},c(_.value||"--"),3)]),e("div",null,[g[20]||(g[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:I(["font-medium",pe.value?"text-body":"text-sub"])},c(pe.value||"--"),3)])])]),l.value?(a(),o("div",Ms,[g[30]||(g[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[g[29]||(g[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",js,[q.value?(a(),o("div",Ls,[g[22]||(g[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Vs,c(q.value),1)])):p("",!0),B.value!==void 0&&B.value!==null?(a(),o("div",Bs,[g[23]||(g[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",Fs,c(ue(B.value))+" Km",1)])):p("",!0),U.value?(a(),o("div",Us,[g[24]||(g[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Ws,c(U.value),1)])):p("",!0),de.value?(a(),o("div",Rs,[g[25]||(g[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Ps,c(de.value),1)])):p("",!0),Te.value?(a(),o("div",zs,[g[26]||(g[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Qs,c(Te.value),1)])):p("",!0),D.value?(a(),o("div",Hs,[g[27]||(g[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Ys,c(D.value),1)])):p("",!0)]),G.value?(a(),o("div",Ks,[...g[28]||(g[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),V(" View technical specs ")],-1)])])):p("",!0)])])):p("",!0)])):p("",!0)])]))}},Js={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Xs={class:"px-4 py-4 flex items-center justify-between shrink-0"},Zs={class:"flex items-center gap-2"},_s={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},ea={class:"flex items-center gap-2 flex-wrap mb-3"},ta={key:0,class:"space-y-3"},sa={class:"flex items-center gap-3"},aa={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},na=["src"],la={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},ia={class:"flex-1 min-w-0"},oa={class:"font-bold text-heading text-fluid-sm mb-1"},da={class:"flex items-center gap-2 flex-wrap"},ra={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},ua={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},ca={key:0,class:"text-right"},ma={class:"font-bold text-heading text-fluid-sm"},fa={class:"mt-3 pt-3 space-y-2"},pa={key:0,class:"flex items-center justify-between text-fluid-xs"},ba={class:"text-heading font-medium"},ya={key:1,class:"flex items-center justify-between text-fluid-xs"},va={class:"text-heading font-medium"},ga={key:2,class:"pt-2"},xa={class:"bg-surfaceSecondary rounded-lg p-2"},ha={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},ka={__name:"RequestCard",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const r=t,n=$(()=>r.task.requestedCar&&r.task.requestedCar.brand&&r.task.requestedCar.model),d=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.brand)||""}),m=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.model)||""}),s=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.year)||""}),b=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.image)||""}),f=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.price)||null}),l=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.stockDays)!==void 0?r.task.requestedCar.stockDays:null}),i=$(()=>{var D;return((D=r.task.requestedCar)==null?void 0:D.requestMessage)||""}),u=$(()=>nt(r.task.displayStage||r.task.stage,r.entityType)),k=$(()=>r.task.deliverySubstatus?r.task.deliverySubstatus==="Delivered"?"green":r.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function E(D){return!D||D.length===0?null:D.filter(B=>B.type==="offer").sort((B,U)=>new Date(U.timestamp)-new Date(B.timestamp))[0]||null}function T(D){if(!D)return 0;const q=new Date(D),U=Math.abs(new Date-q);return Math.ceil(U/(1e3*60*60*24))}const A=$(()=>{if((r.task.displayStage||r.task.stage)!=="In Negotiation")return null;const D=E(r.activities);if(!D)return null;const q=T(D.timestamp);return q<1?{label:"New Offer",theme:"orange"}:q<3?{label:"Active",theme:"yellow"}:null}),x=D=>new Intl.NumberFormat("en-US").format(D);return(D,q)=>{var B,U;return a(),o("div",Js,[e("div",Xs,[q[2]||(q[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Request")],-1)),e("div",Zs,[q[1]||(q[1]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:q[0]||(q[0]=de=>D.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},c(t.task.assignee),1)])]),e("div",_s,[e("div",ea,[e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",u.value])},c(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(a(),j(y(Oe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:k.value},null,8,["text","theme"])):p("",!0),A.value?(a(),j(y(Oe),{key:1,text:A.value.label,size:"small",theme:A.value.theme},null,8,["text","theme"])):p("",!0)]),n.value?(a(),o("div",ta,[e("div",sa,[e("div",aa,[b.value?(a(),o("img",{key:0,src:b.value,alt:"Car",class:"w-full h-full object-cover"},null,8,na)):(a(),o("i",la))]),e("div",ia,[e("div",oa,c(d.value)+" "+c(m.value)+" ("+c(s.value)+")",1),e("div",da,[l.value!==void 0&&l.value!==null?(a(),o("div",ra,[q[3]||(q[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+c(l.value)+" days) ",1)])):(a(),o("div",ua,[...q[4]||(q[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])]))])]),f.value?(a(),o("div",ca,[q[5]||(q[5]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",ma,"€ "+c(x(f.value)),1)])):p("",!0)])])):p("",!0),e("div",fa,[t.task.source?(a(),o("div",pa,[q[6]||(q[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",ba,c(t.task.source),1)])):p("",!0),t.task.requestType||(B=t.task.requestedCar)!=null&&B.requestType?(a(),o("div",ya,[q[7]||(q[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",va,c(t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)),1)])):p("",!0),i.value?(a(),o("div",ga,[q[8]||(q[8]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",xa,[e("p",ha,c(i.value),1)])])):p("",!0)])])])}}},wa={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ca={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},$a={class:"flex items-center mb-3"},Sa={class:"flex items-center gap-3 flex-1 min-w-0"},Aa=["aria-label"],Ta={class:"flex-1 min-w-0"},Da={class:"flex items-center gap-2"},qa={class:"text-fluid-sm font-bold uppercase text-brand-dark truncate"},Ea={class:"space-y-3 pt-3"},Oa={class:"flex items-center gap-2"},Ia={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},Na={class:"flex items-center gap-2"},Ma={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},ja={class:"flex items-center gap-2"},La={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},Va={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:r}){const n=t,d=at(),m=Be(),s=async(l,i)=>{try{await navigator.clipboard.writeText(l),d.pushToast("success",`${i==="email"?"Email":"Phone"} copied!`)}catch{d.pushToast("error","Failed to copy")}},b=()=>{n.customerId&&m.push(`/customer/${n.customerId}`)},f=()=>{n.customerId&&m.push(`/customer/${n.customerId}`)};return(l,i)=>{var u,k,E,T;return a(),o("div",wa,[i[9]||(i[9]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-user text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Contact")])],-1)),e("div",Ca,[e("div",$a,[e("div",Sa,[e("button",{onClick:X(b,["stop"]),class:I(["w-12 h-12 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-user text-lg"},null,-1)])],10,Aa),e("div",Ta,[e("div",Da,[e("h3",qa,c(((u=t.task.customer)==null?void 0:u.name)||"Unknown"),1),e("button",{onClick:f,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])])])])]),e("div",Ea,[e("div",Oa,[i[5]||(i[5]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-sm"})],-1)),e("span",Ia,c(((k=t.task.customer)==null?void 0:k.email)||""),1),e("button",{onClick:i[0]||(i[0]=X(A=>{var x;return s(((x=t.task.customer)==null?void 0:x.email)||"","email")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...i[4]||(i[4]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Na,[i[7]||(i[7]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-sm"})],-1)),e("span",Ma,c(((E=t.task.customer)==null?void 0:E.phone)||""),1),e("button",{onClick:i[1]||(i[1]=X(A=>{var x;return s(((x=t.task.customer)==null?void 0:x.phone)||"","phone")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...i[6]||(i[6]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",ja,[i[8]||(i[8]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-map-marker-alt text-sub text-sm"})],-1)),e("span",La,c(((T=t.task.customer)==null?void 0:T.address)||""),1)])])])])}}},Ba={key:0,class:"flex-grow border-t border"},Fa={key:0,class:"ml-1.5 text-body"},Ua={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Wa={key:1,class:"flex-grow border-t border"},Ra={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:r}){const n=t,d=r,m=O(!1),s={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},b=$(()=>{if(!n.activeTab||n.activeTab==="overview")return n.actions.filter(x=>!s[x]);const A=Object.entries(s).filter(([,x])=>x===n.activeTab).map(([x])=>x);return n.actions.filter(x=>A.includes(x))}),f=$(()=>n.activeTab==="communication"?!0:b.value.length===1),l=$(()=>{if(n.activeTab==="communication")return"add communication";if(!f.value||b.value.length!==1)return"";const A=b.value[0];return{note:"add note",attachment:"add attachment"}[A]||""}),i=$(()=>n.activeTab==="communication"?!1:b.value.length>1),u=$(()=>{const A={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return b.value.map(x=>({key:x,label:A[x]||x,onClick:()=>E(x)}))}),k=$(()=>{if(n.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const A="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return f.value?`${A} px-4 py-2 h-9`:`${A} w-9 h-9`});$(()=>b.value.some(A=>["email","whatsapp","sms"].includes(A))),$(()=>b.value.some(A=>["addVehicle","configureVehicle"].includes(A))),$(()=>b.value.some(A=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(A)));const E=A=>{m.value=!1,d("action",A)},T=()=>{if(n.activeTab==="communication"){E("call");return}f.value&&b.value.length===1?E(b.value[0]):m.value=!m.value};return(A,x)=>{const D=Fe("click-outside");return t.show?(a(),o("div",{key:0,class:I(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?p("",!0):(a(),o("div",Ba)),e("div",{class:I(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:X(T,["stop"]),class:I(k.value)},[x[0]||(x[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),f.value?(a(),o("span",Fa,c(l.value),1)):p("",!0)],2),m.value&&i.value?N((a(),o("div",Ua,[C(y(Ue),{items:u.value,className:"w-48"},null,8,["items"])])),[[D,()=>m.value=!1]]):p("",!0)],2),t.inline?p("",!0):(a(),o("div",Wa))],2)):p("",!0)}}},Pa={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},za={class:"flex items-start gap-3"},Qa={class:"flex-1 min-w-0"},Ha={class:"font-bold text-sm text-heading mb-2"},Ya={class:"space-y-1.5 text-xs text-gray-600"},Ka={class:"flex items-center gap-2"},Ga={class:"flex items-center gap-2"},Ja={class:"flex items-center gap-2"},Xa={key:0,class:"mt-2"},Za={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const r=t,n=$(()=>r.appointmentData.date?new Date(r.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),d=$(()=>r.appointmentData.time?r.appointmentData.time:""),m=s=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[s==null?void 0:s.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(s,b)=>(a(),o("div",Pa,[e("div",za,[b[3]||(b[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Qa,[e("h4",Ha,c(t.appointmentData.type),1),e("div",Ya,[e("div",Ka,[b[0]||(b[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,c(n.value),1)]),e("div",Ga,[b[1]||(b[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,c(d.value),1)]),e("div",Ja,[b[2]||(b[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,c(t.appointmentData.assignee),1)])]),t.appointmentData.status?(a(),o("div",Xa,[e("span",{class:I(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",m(t.appointmentData.status)])},c(t.appointmentData.status),3)])):p("",!0)])])]))}},_a={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},en={class:"flex-1"},tn={class:"flex items-center gap-2 mb-1"},sn={class:"text-meta-bold text-heading"},an={class:"text-meta"},nn={class:"text-meta"},ln={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},on={class:"ml-auto relative"},dn={key:0,class:"absolute right-0 top-full mt-1 z-10"},rn={key:0,class:"text-content text-body"},un={key:1,class:"text-content text-body flex items-center gap-2"},cn={key:2,class:"mt-2"},mn={key:0},fn={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},pn={key:0},bn={class:"text-content font-bold text-heading"},yn={key:0,class:"text-meta mt-0.5"},vn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},gn={key:0},xn={key:1},hn={key:2},kn={key:3},wn={key:4},Cn={key:1},$n={class:"text-content font-bold text-heading mb-2"},Sn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},An={key:0},Tn={class:"text-body font-medium ml-1"},Dn={key:1},qn={class:"text-body font-medium ml-1"},En={key:2},On={class:"text-body font-medium ml-1"},In={key:3},Nn={class:"text-body font-medium ml-1"},Mn={key:4},jn={class:"text-body font-medium ml-1"},Ln={key:5},Vn={class:"text-body font-medium ml-1"},Bn={key:2,class:"flex items-center gap-3"},Fn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Un=["src"],Wn={class:"flex-1"},Rn={class:"text-content font-bold text-heading"},Pn={class:"text-meta"},zn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Qn={key:3,class:"flex items-center gap-3"},Hn={class:"flex-1"},Yn={class:"text-content font-bold text-heading"},Kn={class:"text-meta"},Gn={key:0,class:"text-meta mt-1"},Jn={key:1,class:"text-meta mt-1"},Je={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const n=t,d=r,m=O(!1),s=$(()=>[{key:"edit",label:"Edit",onClick:k},{key:"delete",label:"Delete",onClick:E}]),b=T=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[T]||"fa-solid fa-circle",f=T=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[T]||"bg-surfaceSecondary text-body border",l=T=>{if(!T)return"Just now";const A=new Date(T),D=new Date-A,q=Math.floor(D/6e4),B=Math.floor(q/60),U=Math.floor(B/24);return q<1?"Just now":q<60?`${q} minutes ago`:B<24?`${B} hours ago`:U===1?"Yesterday":U<7?`${U} days ago`:A.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},i=T=>T?new Intl.NumberFormat("en-US").format(T):"0",u=T=>T?new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",k=()=>{m.value=!1,d("edit",n.item)},E=()=>{m.value=!1,confirm("Are you sure you want to delete this item?")&&d("delete",n.item)};return(T,A)=>{const x=Fe("click-outside");return a(),o("div",_a,[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",f(t.item.type)])},[e("i",{class:I([b(t.item.type),"text-sm"])},null,2)],2),e("div",en,[e("div",tn,[e("span",sn,c(t.customerInitials),1),e("span",an,c(t.item.action||"added"),1),e("span",nn,"• "+c(l(t.item.timestamp)),1),t.item.autoDetected?(a(),o("span",ln,"Auto-detected")):p("",!0),e("div",on,[e("button",{onClick:A[0]||(A[0]=X(D=>m.value=!m.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...A[1]||(A[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),m.value?N((a(),o("div",dn,[C(y(Ue),{items:s.value,className:"w-32"},null,8,["items"])])),[[x,()=>m.value=!1]]):p("",!0)])]),t.item.content?(a(),o("div",rn,c(t.item.content),1)):p("",!0),t.item.fileName?(a(),o("div",un,[A[2]||(A[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,c(t.item.fileName),1)])):p("",!0),t.item.data?(a(),o("div",cn,[t.item.type==="appointment"?(a(),o("div",mn,[C(Za,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(a(),o("div",fn,[t.item.type==="tradein"?(a(),o("div",pn,[e("h4",bn,c(t.item.data.brand)+" "+c(t.item.data.model),1),t.item.data.version?(a(),o("p",yn,c(t.item.data.version),1)):p("",!0),e("div",vn,[t.item.data.year?(a(),o("div",gn,[A[3]||(A[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),V(c(t.item.data.year),1)])):p("",!0),t.item.data.km?(a(),o("div",xn,[A[4]||(A[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),V(c(t.item.data.km)+" km ",1)])):p("",!0),t.item.data.plate?(a(),o("div",hn,[A[5]||(A[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),V(c(t.item.data.plate),1)])):p("",!0),t.item.data.date?(a(),o("div",kn,[A[6]||(A[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),V(c(u(t.item.data.date)),1)])):p("",!0),t.item.data.class?(a(),o("div",wn,[A[7]||(A[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),V(c(t.item.data.class),1)])):p("",!0)])])):t.item.type==="financing"?(a(),o("div",Cn,[e("h4",$n,c(t.item.data.product),1),e("div",Sn,[t.item.data.provider?(a(),o("div",An,[A[8]||(A[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Tn,c(t.item.data.provider),1)])):p("",!0),t.item.data.total?(a(),o("div",Dn,[A[9]||(A[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",qn,"€"+c(i(t.item.data.total)),1)])):p("",!0),t.item.data.monthly?(a(),o("div",En,[A[10]||(A[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",On,"€"+c(i(t.item.data.monthly)),1)])):p("",!0),t.item.data.deposit?(a(),o("div",In,[A[11]||(A[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Nn,"€"+c(i(t.item.data.deposit)),1)])):p("",!0),t.item.data.startDate?(a(),o("div",Mn,[A[12]||(A[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",jn,c(u(t.item.data.startDate)),1)])):p("",!0),t.item.data.expDate?(a(),o("div",Ln,[A[13]||(A[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Vn,c(u(t.item.data.expDate)),1)])):p("",!0)])])):t.item.type==="offer"?(a(),o("div",Bn,[t.item.data.image?(a(),o("div",Fn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Un)])):p("",!0),e("div",Wn,[e("h4",Rn,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Pn,"€ "+c(i(t.item.data.price)),1)]),t.item.data.isMainOffer?(a(),o("span",zn,"Main Offer")):p("",!0)])):t.item.type==="purchase"?(a(),o("div",Qn,[e("div",Hn,[e("h4",Yn,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Kn,"€ "+c(i(t.item.data.price)),1),t.item.data.purchaseDate?(a(),o("p",Gn,"Purchased: "+c(u(t.item.data.purchaseDate)),1)):p("",!0),t.item.data.notes?(a(),o("p",Jn,c(t.item.data.notes),1)):p("",!0)])])):p("",!0)]))])):p("",!0)])])}}},Xn={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Zn={class:"flex items-center gap-3"},_n=["title"],el={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},tl={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},sl={key:2,class:"font-bold text-fluid-lg text-heading"},al={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},nl={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},ll={key:1,class:"text-center py-8 text-sub relative z-10"},il={class:"text-fluid-sm"},ol={key:2,class:"space-y-6 relative z-10"},dl={key:0,class:"mb-4 pl-12"},rl={class:"text-fluid-sm font-semibold text-heading"},ul={class:"flex gap-4 relative mb-6"},cl={class:"flex-1 min-w-0"},ml={class:"text-fluid-sm text-slate-700 leading-snug"},fl={class:"font-bold"},pl={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},bl={class:"text-fluid-xs text-sub mt-1"},yl={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},vl={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},gl={key:1,class:"space-y-4 relative z-10"},xl=["title"],hl={key:2,class:"text-center py-8 text-sub relative z-10"},kl={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:r}){const n=t,d=l=>{const i={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return i[l]||i.default},m=l=>{const i={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return i[l]||i.default},s=l=>{if(!l)return"";const i=new Date(l),u=new Date,k=new Date(u);return k.setDate(k.getDate()-1),i.toDateString()===u.toDateString()?"Today":i.toDateString()===k.toDateString()?"Yesterday":i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},b=l=>l?new Date(l).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",f=(l,i)=>{if(l===0)return!0;const u=n.activities[l-1];if(!u)return!0;const k=new Date(i.timestamp).toDateString(),E=new Date(u.timestamp).toDateString();return k!==E};return(l,i)=>t.show?(a(),o("div",{key:0,class:I(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Xn,[e("div",Zn,[t.mobileFullscreen?(a(),o("button",{key:0,onClick:i[0]||(i[0]=u=>l.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(a(),o("button",{key:1,onClick:i[1]||(i[1]=u=>l.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(a(),o("i",el)):(a(),o("i",tl))],8,_n)):p("",!0),t.collapsed?p("",!0):(a(),o("h2",sl,c(t.title),1))])]),t.collapsed?(a(),o("div",yl,[t.activities.length>0?(a(),o("div",vl)):p("",!0),t.activities.length>0?(a(),o("div",gl,[(a(!0),o(R,null,P(t.activities,u=>(a(),o("div",{key:u.id,class:"relative"},[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",m(u.type)]),title:`${u.user} ${u.action}`},[e("i",{class:I([d(u.type),"text-fluid-xs"])},null,2)],10,xl)]))),128))])):(a(),o("div",hl,[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(a(),o("div",al,[t.activities.length>0?(a(),o("div",nl)):p("",!0),t.activities.length===0?(a(),o("div",ll,[i[3]||(i[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",il,c(t.emptyMessage),1)])):(a(),o("div",ol,[(a(!0),o(R,null,P(t.activities,(u,k)=>(a(),o(R,{key:u.id},[f(k,u)?(a(),o("div",dl,[e("h3",rl,c(s(u.timestamp)),1)])):p("",!0),e("div",ul,[e("div",{class:I(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",m(u.type)])},[e("i",{class:I([d(u.type),"text-fluid-sm"])},null,2)],2),e("div",cl,[e("div",ml,[e("span",fl,c(u.user),1),V(" "+c(u.action),1)]),u.content?(a(),o("div",pl,c(u.content),1)):p("",!0),e("div",bl,c(b(u.timestamp)),1)])])],64))),128))]))]))],2)):p("",!0)}},wl={class:"space-y-3"},Cl={class:"flex justify-end gap-2"},Xe={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=O(n.initialTemplate),s=O(""),b=O(n.initialMessage),f={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},l=()=>{m.value&&f[m.value]&&(s.value=f[m.value].subject,b.value=f[m.value].message)},i=()=>{b.value.trim()&&d("send",{type:"email",template:m.value,subject:s.value,message:b.value})};return(u,k)=>(a(),o("div",wl,[e("div",null,[k[5]||(k[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),N(e("select",{"onUpdate:modelValue":k[0]||(k[0]=E=>m.value=E),onChange:l,class:"input"},[...k[4]||(k[4]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[k[6]||(k[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),N(e("input",{"onUpdate:modelValue":k[1]||(k[1]=E=>s.value=E),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[L,s.value]])]),e("div",null,[k[7]||(k[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),N(e("textarea",{"onUpdate:modelValue":k[2]||(k[2]=E=>b.value=E),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[L,b.value]])]),e("div",Cl,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:k[3]||(k[3]=E=>u.$emit("cancel"))}),C(y(F),{label:"Send Email",variant:"primary",size:"small",onClick:i})])]))}},$l={class:"space-y-3"},Sl={class:"text-fluid-xs text-sub mt-1"},Al={class:"flex justify-end gap-2"},Ze={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=O(n.initialTemplate),s=O(n.initialMessage),b={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},f=()=>{m.value&&b[m.value]&&(s.value=b[m.value])},l=()=>{s.value.trim()&&d("send",{type:"sms",template:m.value,message:s.value})};return(i,u)=>(a(),o("div",$l,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),N(e("select",{"onUpdate:modelValue":u[0]||(u[0]=k=>m.value=k),onChange:f,class:"input"},[...u[3]||(u[3]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),N(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=k=>s.value=k),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[L,s.value]]),e("p",Sl,c(s.value.length)+"/160 characters",1)]),e("div",Al,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:u[2]||(u[2]=k=>i.$emit("cancel"))}),C(y(F),{label:"Send SMS",variant:"primary",size:"small",onClick:l})])]))}},Tl={class:"space-y-3"},Dl={class:"flex justify-end gap-2"},_e={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=O(n.initialTemplate),s=O(n.initialMessage),b={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},f=()=>{m.value&&b[m.value]&&(s.value=b[m.value])},l=()=>{s.value.trim()&&d("send",{type:"whatsapp",template:m.value,message:s.value})};return(i,u)=>(a(),o("div",Tl,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),N(e("select",{"onUpdate:modelValue":u[0]||(u[0]=k=>m.value=k),onChange:f,class:"input"},[...u[3]||(u[3]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),N(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=k=>s.value=k),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[L,s.value]])]),e("div",Dl,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:u[2]||(u[2]=k=>i.$emit("cancel"))}),C(y(F),{label:"Send WhatsApp",variant:"primary",size:"small",onClick:l})])]))}},ql={class:"space-y-3"},El={class:"space-y-2"},Ol={class:"flex-1"},Il={class:"text-xs text-sub uppercase"},Nl={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},et={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:r}){const n=t,d=r,m=O(""),s=b=>{b==="copy"&&navigator.clipboard.writeText(n.phoneNumber),d("call",{type:"call",option:b,phoneNumber:n.phoneNumber,notes:m.value})};return(b,f)=>(a(),o("div",ql,[e("div",El,[f[10]||(f[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:f[0]||(f[0]=l=>s("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...f[5]||(f[5]=[ve('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:f[1]||(f[1]=l=>s("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...f[6]||(f[6]=[ve('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:f[2]||(f[2]=l=>s("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[f[8]||(f[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Ol,[f[7]||(f[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",Il,c(t.phoneNumber),1)]),f[9]||(f[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[f[11]||(f[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),N(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=l=>m.value=l),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[L,m.value]])]),e("div",Nl,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:f[4]||(f[4]=l=>b.$emit("cancel"))})])]))}},Ml={key:0,class:"space-y-4"},jl={class:"grid grid-cols-4 gap-2"},Ll=["onClick"],Vl={class:"text-xs font-bold uppercase tracking-wider"},Bl={key:1,class:"space-y-4"},Fl={class:"grid grid-cols-4 gap-2"},Ul=["onClick"],Wl={class:"text-xs font-bold uppercase tracking-wider"},Rl={key:0},tt={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:r}){const n=t,d=r,m=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],s=O(n.type);ie(()=>n.type,u=>{u?s.value=u:s.value=null}),ie(()=>n.taskId,()=>{s.value=null});const b=$(()=>u=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${s.value===u?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),f=u=>{d("save",{type:"communication",action:`sent via ${u.type}`,content:u.message,communicationType:u.type,template:u.template,subject:u.subject}),d("send",u)},l=u=>{d("save",{type:"communication",action:`called via ${u.option}`,content:u.notes||"Call attempt logged",communicationType:"call",callOption:u.option}),d("send",{type:"call",option:u.option,phoneNumber:u.phoneNumber,notes:u.notes})},i=()=>{s.value=null,d("cancel")};return(u,k)=>t.inline?(a(),o("div",Bl,[e("div",Fl,[(a(),o(R,null,P(m,E=>e("button",{key:E.id,onClick:T=>s.value=E.id,class:I(b.value(E.id))},[e("i",{class:I([E.icon,"text-sm"])},null,2),e("span",Wl,c(E.label),1)],10,Ul)),64))]),s.value?(a(),o("div",Rl,[s.value==="email"?(a(),j(Xe,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="sms"?(a(),j(Ze,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="whatsapp"?(a(),j(_e,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="call"?(a(),j(et,{key:3,"phone-number":t.phoneNumber,onCall:l,onCancel:i},null,8,["phone-number"])):p("",!0)])):p("",!0)])):(a(),o("div",Ml,[e("div",jl,[(a(),o(R,null,P(m,E=>e("button",{key:E.id,onClick:T=>s.value=E.id,class:I(b.value(E.id))},[e("i",{class:I([E.icon,"text-sm"])},null,2),e("span",Vl,c(E.label),1)],10,Ll)),64))]),e("div",null,[s.value==="email"?(a(),j(Xe,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="sms"?(a(),j(Ze,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="whatsapp"?(a(),j(_e,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:f,onCancel:i},null,8,["initial-template","initial-message"])):s.value==="call"?(a(),j(et,{key:3,"phone-number":t.phoneNumber,onCall:l,onCancel:i},null,8,["phone-number"])):p("",!0)])]))}},Pl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},zl={key:1,class:"flex justify-between items-center mb-4"},Ql={class:"text-fluid-sm font-semibold text-heading"},Hl={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Yl={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,s=O("");xe(()=>{d.item&&(s.value=d.item.content||"")});const b=()=>{var f,l;s.value.trim()&&m("save",{id:((f=d.item)==null?void 0:f.id)||Date.now(),type:"note",action:d.item?"updated a note":"added a note",content:s.value,timestamp:((l=d.item)==null?void 0:l.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,canSubmit:()=>!!s.value.trim()}),(f,l)=>(a(),o("div",{class:I(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?p("",!0):(a(),o("div",Pl)),t.hideHeader?p("",!0):(a(),o("div",zl,[e("h5",Ql,c(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:l[0]||(l[0]=i=>f.$emit("cancel")),class:"text-sub hover:text-body"},[...l[3]||(l[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[l[4]||(l[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),N(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=i=>s.value=i),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[L,s.value]])]),t.hideActions?p("",!0):(a(),o("div",Hl,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:l[2]||(l[2]=i=>f.$emit("cancel"))}),C(y(F),{label:"Save",variant:"primary",size:"small",onClick:b})]))],2))}},Kl={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Gl={class:"flex justify-between items-center mb-4"},Jl={class:"text-fluid-sm font-semibold text-heading"},Xl={class:"flex items-center gap-3"},Zl={key:0,class:"text-fluid-sm text-slate-600"},_l={key:1,class:"text-fluid-sm text-sub"},ei={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},ti={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:r}){const n=t,d=r,m=O(null),s=O("");xe(()=>{n.item&&(s.value=n.item.fileName||"")});const b=l=>{const i=l.target.files[0];i&&(m.value=i,s.value=i.name)},f=()=>{var l,i;!m.value&&!n.item||d("save",{id:((l=n.item)==null?void 0:l.id)||Date.now(),type:"attachment",action:n.item?"updated an attachment":"added an attachment",fileName:s.value,timestamp:((i=n.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return(l,i)=>(a(),o("div",Kl,[i[5]||(i[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Gl,[e("h5",Jl,c(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:i[0]||(i[0]=u=>l.$emit("cancel")),class:"text-sub hover:text-body"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[i[4]||(i[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Xl,[e("input",{type:"file",onChange:b,ref:"fileInput",class:"hidden"},null,544),C(y(F),{label:"Choose File",variant:"outline",size:"small",onClick:i[1]||(i[1]=u=>l.$refs.fileInput.click())}),s.value?(a(),o("span",Zl,c(s.value),1)):(a(),o("span",_l,"No file selected"))])]),e("div",ei,[C(y(F),{label:"Cancel",variant:"outline",size:"small",onClick:i[2]||(i[2]=u=>l.$emit("cancel"))}),C(y(F),{label:"Save",variant:"primary",size:"small",disabled:!m.value,onClick:f},null,8,["disabled"])])]))}},si={class:"animate-fade-in"},ai={class:"space-y-4"},ni={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},li={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ii={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},oi=["disabled"],di={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,s=O({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});xe(()=>{d.item&&d.item.data&&(s.value={startDate:d.item.data.startDate||"",expDate:d.item.data.expDate||"",productName:d.item.data.product||d.item.data.productName||"",deposit:d.item.data.deposit||"",loanAmount:d.item.data.total||d.item.data.loanAmount||""})});const b=()=>{var f,l;s.value.productName&&m("save",{id:((f=d.item)==null?void 0:f.id)||Date.now(),type:"financing",action:d.item?"updated a financing proposal":"added a financing proposal",data:{product:s.value.productName,provider:"Audi Financial",total:s.value.loanAmount||"0",monthly:Math.round(parseFloat(s.value.loanAmount||0)/36).toString(),startDate:s.value.startDate,expDate:s.value.expDate,deposit:s.value.deposit},timestamp:((l=d.item)==null?void 0:l.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,isValid:$(()=>!!s.value.productName)}),(f,l)=>(a(),o("div",si,[e("div",ai,[e("div",ni,[e("div",null,[l[6]||(l[6]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),N(e("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=i=>s.value.startDate=i),class:"input"},null,512),[[L,s.value.startDate]])]),e("div",null,[l[7]||(l[7]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=i=>s.value.expDate=i),class:"input"},null,512),[[L,s.value.expDate]])])]),e("div",null,[l[8]||(l[8]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),N(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=i=>s.value.productName=i),class:"input"},null,512),[[L,s.value.productName]])]),e("div",li,[e("div",null,[l[9]||(l[9]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),N(e("input",{type:"number","onUpdate:modelValue":l[3]||(l[3]=i=>s.value.deposit=i),class:"input"},null,512),[[L,s.value.deposit]])]),e("div",null,[l[10]||(l[10]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),N(e("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=i=>s.value.loanAmount=i),class:"input"},null,512),[[L,s.value.loanAmount]])])])]),t.hideActions?p("",!0):(a(),o("div",ii,[e("button",{onClick:l[5]||(l[5]=i=>f.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!s.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,oi)]))]))}},ri={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=O(null),m=$(()=>{var l;return((l=d.value)==null?void 0:l.isValid)||!1}),s=()=>{var l;(l=d.value)==null||l.submit()},b=l=>{l||n("close")},f=l=>{n("save",l),n("close")};return(l,i)=>(a(),j(y(Ae),{open:t.show,"onUpdate:open":b},{default:M(()=>[C(y(he),null,{default:M(()=>[C(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),C(y(we),{class:"w-full sm:max-w-lg"},{default:M(()=>[C(y(Ce),null,{default:M(()=>[C(y($e),null,{default:M(()=>[...i[2]||(i[2]=[V("Add Financing",-1)])]),_:1}),C(y(We),null,{default:M(()=>[...i[3]||(i[3]=[V("Record financing details for this customer",-1)])]),_:1})]),_:1}),C(di,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:f,onCancel:i[0]||(i[0]=u=>l.$emit("close"))},null,8,["item","task-type","task-id"]),C(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:M(()=>[C(y(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[1]||(i[1]=u=>l.$emit("close"))}),C(y(F),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ui={class:"animate-fade-in"},ci={class:"space-y-4"},mi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pi={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},bi=["disabled"],yi={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,s=O({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});xe(()=>{d.item&&d.item.data&&(s.value={class:d.item.data.class||"Car",brand:d.item.data.brand||"",model:d.item.data.model||"",version:d.item.data.version||"",km:d.item.data.km||"",plate:d.item.data.plate||"",date:d.item.data.date||""})});const b=()=>{var f,l;s.value.brand&&m("save",{id:((f=d.item)==null?void 0:f.id)||Date.now(),type:"tradein",action:d.item?"updated a trade-in":"added a trade-in",data:{class:s.value.class,brand:s.value.brand,model:s.value.model||"Unknown Model",year:s.value.date?new Date(s.value.date).getFullYear():"Unknown Year",km:s.value.km||"0",plate:s.value.plate||"",date:s.value.date||""},timestamp:((l=d.item)==null?void 0:l.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,isValid:$(()=>!!s.value.brand)}),(f,l)=>(a(),o("div",ui,[e("div",ci,[e("div",null,[l[9]||(l[9]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Class",-1)),N(e("select",{"onUpdate:modelValue":l[0]||(l[0]=i=>s.value.class=i),class:"input"},[...l[8]||(l[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[ge,s.value.class]])]),e("div",mi,[e("div",null,[l[10]||(l[10]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Brand",-1)),N(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=i=>s.value.brand=i),class:"input"},null,512),[[L,s.value.brand]])]),e("div",null,[l[11]||(l[11]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Model",-1)),N(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=i=>s.value.model=i),class:"input"},null,512),[[L,s.value.model]])])]),e("div",null,[l[12]||(l[12]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Version",-1)),N(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=i=>s.value.version=i),class:"input"},null,512),[[L,s.value.version]])]),e("div",fi,[e("div",null,[l[13]||(l[13]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Km",-1)),N(e("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=i=>s.value.km=i),class:"input"},null,512),[[L,s.value.km]])]),e("div",null,[l[14]||(l[14]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Plate",-1)),N(e("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=i=>s.value.plate=i),class:"input"},null,512),[[L,s.value.plate]])])]),e("div",null,[l[15]||(l[15]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":l[6]||(l[6]=i=>s.value.date=i),class:"input"},null,512),[[L,s.value.date]])])]),t.hideActions?p("",!0):(a(),o("div",pi,[e("button",{onClick:l[7]||(l[7]=i=>f.$emit("cancel")),class:"text-fluid-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!s.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-fluid-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,bi)]))]))}},vi={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=O(null),m=$(()=>{var l;return((l=d.value)==null?void 0:l.isValid)||!1}),s=()=>{var l;(l=d.value)==null||l.submit()},b=l=>{l||n("close")},f=l=>{n("save",l),n("close")};return(l,i)=>(a(),j(y(Ae),{open:t.show,"onUpdate:open":b},{default:M(()=>[C(y(he),null,{default:M(()=>[C(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),C(y(we),{class:"w-full sm:max-w-lg"},{default:M(()=>[C(y(Ce),null,{default:M(()=>[C(y($e),null,{default:M(()=>[...i[2]||(i[2]=[V("Add Trade-In Vehicle",-1)])]),_:1}),C(y(We),null,{default:M(()=>[...i[3]||(i[3]=[V("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),C(yi,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:f,onCancel:i[0]||(i[0]=u=>l.$emit("close"))},null,8,["item","task-type","task-id"]),C(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:M(()=>[C(y(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[1]||(i[1]=u=>l.$emit("close"))}),C(y(F),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},gi={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},xi={key:0,class:"flex justify-between items-center mb-4"},hi={class:"text-sm font-bold text-heading"},ki={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},wi={class:"flex items-center gap-3"},Ci={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},$i=["src"],Si={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Ai={class:"font-bold text-sm text-heading"},Ti={class:"text-xs text-sub"},Di={class:"space-y-4"},qi={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ei={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Oi=["disabled"],Ii={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,s=O({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});xe(()=>{if(d.selectedVehicle){s.value.price=d.selectedVehicle.price||0,s.value.brand=d.selectedVehicle.brand||"",s.value.model=d.selectedVehicle.model||"",s.value.year=d.selectedVehicle.year||"",s.value.image=d.selectedVehicle.image||"";const i=new Date;i.setDate(i.getDate()+30),s.value.validUntil=i.toISOString().split("T")[0]}d.item&&d.item.data&&(s.value={...s.value,...d.item.data,price:d.item.data.price||d.item.data.total||0,financingType:d.item.data.financingType||d.item.data.paymentMethod||"",notes:d.item.data.notes||d.item.data.description||""})}),ie(()=>d.selectedVehicle,i=>{i&&!d.item&&(s.value.price=i.price||0,s.value.brand=i.brand||"",s.value.model=i.model||"",s.value.year=i.year||"",s.value.image=i.image||"")});const b=$(()=>s.value.price>0&&s.value.financingType!==""),f=i=>i?i.toLocaleString("en-US"):"0",l=()=>{var u,k;if(!b.value)return;const i={id:((u=d.item)==null?void 0:u.id)||Date.now(),type:"offer",action:d.item?"updated an offer":"created an offer",data:{brand:s.value.brand,model:s.value.model,year:s.value.year,price:s.value.price,total:s.value.price,paymentMethod:s.value.financingType,financingType:s.value.financingType,downPayment:s.value.downPayment,monthlyPayment:s.value.monthlyPayment,term:s.value.term,interestRate:s.value.interestRate,deliveryDate:s.value.deliveryDate,validUntil:s.value.validUntil,notes:s.value.notes,description:s.value.notes,image:s.value.image},timestamp:((k=d.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!d.item};m("save",i)};return r({submit:l,isValid:b,offerData:s}),(i,u)=>(a(),o("div",gi,[t.hideHeader?p("",!0):(a(),o("div",xi,[e("h5",hi,c(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:u[0]||(u[0]=k=>i.$emit("cancel")),class:"text-sub hover:text-body"},[...u[11]||(u[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(a(),o("div",ki,[u[12]||(u[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",wi,[e("div",Ci,[t.selectedVehicle.image?(a(),o("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,$i)):(a(),o("i",Si))]),e("div",null,[e("h4",Ai,c(t.selectedVehicle.brand)+" "+c(t.selectedVehicle.model)+" ("+c(t.selectedVehicle.year)+") ",1),e("p",Ti,"Base Price: € "+c(f(t.selectedVehicle.price)),1)])])])):p("",!0),e("div",Di,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[V(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),N(e("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=k=>s.value.price=k),class:"input",placeholder:"Enter offer price"},null,512),[[L,s.value.price]])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[V(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),N(e("select",{"onUpdate:modelValue":u[2]||(u[2]=k=>s.value.financingType=k),class:"input"},[...u[14]||(u[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[ge,s.value.financingType]])]),s.value.financingType==="finance"||s.value.financingType==="lease"?(a(),o("div",qi,[e("div",null,[u[16]||(u[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=k=>s.value.downPayment=k),class:"input",placeholder:"0"},null,512),[[L,s.value.downPayment]])]),e("div",null,[u[17]||(u[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=k=>s.value.monthlyPayment=k),class:"input",placeholder:"Calculated automatically"},null,512),[[L,s.value.monthlyPayment]])]),e("div",null,[u[18]||(u[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=k=>s.value.term=k),class:"input",placeholder:"36"},null,512),[[L,s.value.term]])]),e("div",null,[u[19]||(u[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),N(e("input",{type:"number",step:"0.1","onUpdate:modelValue":u[6]||(u[6]=k=>s.value.interestRate=k),class:"input",placeholder:"3.5"},null,512),[[L,s.value.interestRate]])])])):p("",!0),e("div",null,[u[20]||(u[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":u[7]||(u[7]=k=>s.value.deliveryDate=k),class:"input"},null,512),[[L,s.value.deliveryDate]])]),e("div",null,[u[21]||(u[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),N(e("input",{type:"date","onUpdate:modelValue":u[8]||(u[8]=k=>s.value.validUntil=k),class:"input"},null,512),[[L,s.value.validUntil]])]),e("div",null,[u[22]||(u[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),N(e("textarea",{"onUpdate:modelValue":u[9]||(u[9]=k=>s.value.notes=k),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[L,s.value.notes]])])]),t.hideActions?p("",!0):(a(),o("div",Ei,[e("button",{onClick:u[10]||(u[10]=k=>i.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:l,disabled:!b.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},c(t.item?"Update Offer":"Create Offer"),9,Oi)]))]))}},Ni={class:"p-6"},Mi={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=O(null),m=$(()=>{var l;return((l=d.value)==null?void 0:l.isValid)||!1}),s=()=>{var l;(l=d.value)==null||l.submit()},b=l=>{l||n("close")},f=l=>{n("save",l),n("close")};return(l,i)=>(a(),j(y(Ae),{open:t.show,"onUpdate:open":b},{default:M(()=>[C(y(he),null,{default:M(()=>[C(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),C(y(we),{class:"w-full sm:max-w-2xl p-0"},{default:M(()=>[C(y(Ce),{class:"p-6 pb-4 border-b border"},{default:M(()=>[C(y($e),null,{default:M(()=>[...i[2]||(i[2]=[V("Create Offer",-1)])]),_:1}),C(y(We),null,{default:M(()=>[...i[3]||(i[3]=[V("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Ni,[C(Ii,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:f,onCancel:i[0]||(i[0]=u=>l.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),C(y(Se),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:M(()=>[C(y(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[1]||(i[1]=u=>l.$emit("close"))}),C(y(F),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ji={class:"space-y-4"},Li={key:0},Vi={class:"flex flex-wrap gap-2"},Bi=["onClick"],Fi={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:r}){const n=t,d=r,m=O(""),s=f=>{f||d("close")};ie(()=>n.show,f=>{f&&(m.value="")});const b=()=>{const f=m.value.trim();f&&(n.existingTags.includes(f)||(d("add",f),m.value=""))};return(f,l)=>(a(),j(y(Ae),{open:t.show,"onUpdate:open":s},{default:M(()=>[C(y(he),null,{default:M(()=>[C(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),C(y(we),{class:"w-full sm:max-w-md"},{default:M(()=>[C(y(Ce),null,{default:M(()=>[C(y($e),null,{default:M(()=>[...l[2]||(l[2]=[V("Add Tag",-1)])]),_:1})]),_:1}),e("div",ji,[e("div",null,[l[3]||(l[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),N(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>m.value=i),onKeyup:bt(b,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[L,m.value]])]),t.existingTags.length>0?(a(),o("div",Li,[l[4]||(l[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Vi,[(a(!0),o(R,null,P(t.existingTags,i=>(a(),o("button",{key:i,onClick:u=>m.value=i,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},c(i),9,Bi))),128))])])):p("",!0)]),C(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:M(()=>[C(y(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:l[1]||(l[1]=i=>f.$emit("close"))}),C(y(F),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value.trim(),onClick:b},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Le={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Ui(t){if(!t)return Le.default;const r=t.toLowerCase().trim();return Le[r]||Le.default}function Wi({store:t,taskId:r,getTabForItemType:n,isOverviewModalAction:d}){const m=O(null),s=O(null),b=O("overview"),f=O(null),l=O([]);ie(b,()=>{m.value=null,s.value=null});const i=$(()=>[...t.currentActivities.value,...l.value.filter(D=>!D.activityId)].filter(D=>{const q=n(D.type);return b.value==="overview"?q==="overview":q===b.value}).sort((D,q)=>{const B=new Date(D.timestamp||0);return new Date(q.timestamp||0)-B})),u=x=>(s.value=null,b.value==="overview"&&d&&d(x)?{type:"overview-modal",action:x}:(["email","sms","whatsapp","call"].includes(x)?(f.value=x,m.value="communication"):m.value=x,null)),k=async x=>{var D;if(x.isEdit){const q=l.value.findIndex(B=>B.id===x.id);q>-1&&(l.value[q]={...l.value[q],...x}),(D=s.value)!=null&&D.activityId&&await t.updateActivity(r.value,s.value.activityId,{type:x.communicationType||x.type,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}else{const q=x.communicationType||x.type,B=await t.addActivity(r.value,{type:q,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data});l.value.push({id:B.id,type:q==="email"||q==="whatsapp"||q==="sms"?"communication":q,action:x.action,content:x.content,fileName:x.fileName,data:x.data,timestamp:B.timestamp,activityId:B.id})}m.value=null,s.value=null},E=()=>{m.value=null,s.value=null},T=x=>{n(x.type)&&(m.value=x.type==="email"||x.type==="whatsapp"||x.type==="sms"||x.type==="communication"?"communication":x.type,s.value=x)},A=async x=>{try{await t.deleteActivity(r.value,x)}catch(D){throw console.error("Error deleting item:",D),D}};return{activeTab:b,showInlineWidget:m,inlineWidgetType:$(()=>m.value),editingItem:s,isEditing:$(()=>s.value!==null),communicationType:f,inlineContent:l,filteredInlineContent:i,handleAddNewAction:u,handleWidgetSave:k,handleWidgetCancel:E,handleEditItem:T,handleDeleteItem:A}}const Ri={class:"flex-1 flex flex-col overflow-hidden h-full"},Pi={class:"bg-surface border-b border-black/5 shrink-0"},zi={key:0},Qi={key:0,class:"flex-1 flex flex-row overflow-hidden"},Hi={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Yi={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Ki={class:"mb-4"},Gi={key:0},Ji={key:0},Xi={key:1,class:"mb-6"},Zi={key:2,class:"space-y-4 mb-6 px-1"},_i={key:1},eo={key:0,class:"space-y-4 mb-6 px-1"},to={key:1,class:"flex-1 flex flex-row overflow-hidden"},so={class:"flex-1 flex flex-col overflow-hidden min-w-0"},ao={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},no={key:0,class:"space-y-6"},lo={key:0},io={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},oo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},ro={key:0,class:"mt-6 pt-6 border-t border"},uo={class:"space-y-2 max-h-52 overflow-y-auto"},co={class:"flex items-center gap-2 mb-1"},mo={class:"text-fluid-xs font-semibold text-heading"},fo={class:"text-fluid-xs text-sub"},po={class:"text-fluid-sm text-body"},bo={key:1,class:"space-y-6"},yo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},vo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},go={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},xo={class:"relative"},ho={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},ko={key:1,class:"text-center py-6 text-sub"},wo={key:2,class:"space-y-6 max-h-96 overflow-y-auto pr-2"},Co={class:"flex-1 min-w-0"},$o={class:"text-fluid-sm text-slate-700 leading-snug"},So={class:"font-bold"},Ao={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},To={class:"text-fluid-xs text-sub mt-1"},Do={key:2,class:"space-y-6"},qo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Eo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Oo={class:"space-y-2 max-h-80 overflow-y-auto"},Io={key:0,class:"text-center py-6 text-sub text-fluid-sm"},No={class:"text-fluid-xs text-sub mb-1"},Mo={class:"text-fluid-sm text-body"},jo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Lo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Vo={class:"space-y-2 max-h-80 overflow-y-auto"},Bo={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Fo={class:"flex-1 min-w-0"},Uo={class:"text-fluid-sm font-medium text-heading truncate"},Wo={class:"text-fluid-xs text-sub"},Ro={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Po={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},zo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Qo={class:"space-y-2 max-h-80 overflow-y-auto"},Ho={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Yo={class:"flex items-center justify-between mb-1"},Ko={class:"text-fluid-xs text-sub"},Go={key:0,class:"text-fluid-sm font-medium text-heading"},Jo={key:0},Xo={key:1,class:"grid grid-cols-2 gap-2 mt-2 text-fluid-xs text-body"},Zo={key:0},_o={key:1},ed={key:2,class:"text-fluid-sm text-body mt-2"},td={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},sd={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},ad={class:"space-y-2 max-h-80 overflow-y-auto"},nd={key:0,class:"text-center py-6 text-sub text-fluid-sm"},ld={class:"flex items-center justify-between mb-1"},id={class:"text-fluid-xs text-sub"},od={key:0,class:"text-fluid-sm font-medium text-heading"},dd={key:0},rd={key:1,class:"text-fluid-sm text-body mt-1"},ud={key:2,class:"text-fluid-sm text-body mt-2"},yd={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated"],setup(t,{emit:r}){const n=t,d=r,m=yt(),s=Be(),b=kt(),f=$(()=>n.task.id),l=$(()=>m.path.startsWith("/tasks")&&!m.path.startsWith("/customer")),i=O("manage"),u=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Data"}],k=O(!1),E=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="note"):[]),T=$(()=>n.task.activities?n.task.activities.filter(S=>["email","call","sms","whatsapp"].includes(S.type)):[]),A=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="attachment"):[]),x=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="purchase"):[]),D=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="tradein"):[]),q=()=>{z.value="purchase",G.value=!0},B=()=>{z.value="tradein",G.value=!0},U=S=>{if(!S)return"";const v=new Date(S),W=new Date-v,H=Math.floor(W/6e4),K=Math.floor(W/36e5),ee=Math.floor(W/864e5);return H<1?"Just now":H<60?`${H}m ago`:K<24?`${K}h ago`:ee<7?`${ee}d ago`:v.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},de=S=>S?new Intl.NumberFormat("en-US").format(S):"0",Te=S=>S?new Intl.NumberFormat("en-US").format(S):"0",Ie=async S=>{await n.storeAdapter.addActivity(n.task.id,{type:S.communicationType||S.type,content:S.content||S.message||"Communication logged",subject:S.subject,template:S.template,timestamp:new Date().toISOString()}),k.value=!1},fe=$(()=>n.type==="contact"?"bg-blue-100 text-blue-600":n.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),_=O(m.path.startsWith("/tasks")&&!m.path.startsWith("/customer"));ie(()=>m.path,S=>{_.value=S.startsWith("/tasks")&&!S.startsWith("/customer")});const pe=()=>{s.push({path:`/customer/${n.task.id}`,query:{type:n.type}})};function be(S){se.value=!1}const re=()=>{ue.value=!0},ye=async S=>{var Q,W,H,K;const v=S.name;n.type==="lead"?await((W=(Q=n.storeAdapter).updateLead)==null?void 0:W.call(Q,n.task.id,{assignee:v,assigneeType:S.type,teamId:S.type==="team"?S.id:null})):n.type==="opportunity"&&await((K=(H=n.storeAdapter).updateOpportunity)==null?void 0:K.call(H,n.task.id,{assignee:v,assigneeType:S.type,teamId:S.type==="team"?S.id:null})),ue.value=!1},G=O(!1),z=O(null),se=O(!1),ue=O(!1),w=O(!1),{activeTab:g,showInlineWidget:J,editingItem:ae,communicationType:it,inlineContent:ot,filteredInlineContent:De,handleAddNewAction:dt,handleWidgetSave:qe,handleWidgetCancel:Ne,handleEditItem:Pe,handleDeleteItem:ze}=Wi({store:n.storeAdapter,taskId:f,getTabForItemType:Ui,isOverviewModalAction:S=>g.value==="overview"&&n.addNewConfig.overviewActions.includes(S)});ie(()=>n.task.id,()=>{g.value="overview"});const Me=S=>{const v=dt(S);v&&v.modalAction&&(z.value=v.modalAction,G.value=!0)},Qe=S=>{if(S==="appointment"){se.value=!0;return}const v={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(S))z.value=S,G.value=!0;else{const Q=v[S];Q?(g.value=Q,setTimeout(()=>{Me(S),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Me(S)}},Ee=()=>{G.value=!1,z.value=null},je=async S=>{await qe(S),Ee()},rt=$(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Notes"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),ce=$(()=>[...n.storeAdapter.currentActivities.value,...ot.value]);$(()=>z.value==="financing"?"Add Financing":z.value==="tradein"?"Add Trade-in":z.value==="purchase"?"Create Purchase Offer":"");const He=async S=>{if(n.type==="opportunity")try{await n.storeAdapter.addVehicle(n.task.id,S.vehicleData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(v){console.error("Error selecting vehicle:",v)}},Ye=async S=>{if(n.type==="opportunity")try{await n.storeAdapter.createOffer(n.task.id,S.offerData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(v){console.error("Error creating offer:",v)}},ut=async S=>{var W,H,K,ee;const v=n.task.tags||[];if(v.includes(S)){w.value=!1;return}const Q=[...v,S];try{if(n.type==="lead")await((H=(W=n.storeAdapter).updateLead)==null?void 0:H.call(W,n.task.id,{tags:Q})),n.storeAdapter.loadLeadById&&await n.storeAdapter.loadLeadById(n.task.id);else if(n.type==="opportunity")await((ee=(K=n.storeAdapter).updateOpportunity)==null?void 0:ee.call(K,n.task.id,{tags:Q})),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id);else if(n.type==="contact"){const ne=m.query.type==="account"?"account":"contact";await b.updateCustomer(n.task.id,{tags:Q},ne),await b.fetchCustomerById(n.task.id,ne),d("tag-updated")}w.value=!1}catch(ne){console.error("Error adding tag:",ne)}},ct=S=>{const v={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return v[S]||v.default},mt=S=>{const v={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return v[S]||v.default},ft=S=>S?new Date(S).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(S,v)=>{var Q,W,H,K,ee,ne;return a(),o("div",Ri,[e("header",Pi,[l.value?p("",!0):(a(),o("div",zi,[C(Rt,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":fe.value,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Qe,onAddTag:v[0]||(v[0]=h=>w.value=!0)},{"name-action":M(()=>[l.value?(a(),o("button",{key:0,onClick:pe,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...v[15]||(v[15]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):p("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags"])]))]),l.value?l.value?(a(),o("div",to,[e("div",so,[e("div",ao,[C(Ge,{modelValue:i.value,"onUpdate:modelValue":v[6]||(v[6]=h=>i.value=h),tabs:u,class:"mb-6"},null,8,["modelValue"]),i.value==="manage"?(a(),o("div",no,[t.managementWidget?(a(),o("div",lo,[(a(),j(Ke(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ce.value,onCarAdded:v[7]||(v[7]=h=>S.$emit("car-added",h)),onConvertToLead:v[8]||(v[8]=h=>S.$emit("convert-to-lead")),onConvertToOpportunity:v[9]||(v[9]=h=>S.$emit("convert-to-opportunity")),onVehicleSelected:He,onCreateOffer:Ye},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),e("div",io,[v[16]||(v[16]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-comments text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Communicate")])],-1)),e("div",oo,[C(tt,{"task-type":t.type,"task-id":t.task.id,"phone-number":((ee=t.task.customer)==null?void 0:ee.phone)||"","show-arrow":!1,onSave:Ie,onCancel:v[10]||(v[10]=h=>k.value=!1)},null,8,["task-type","task-id","phone-number"]),T.value.length>0?(a(),o("div",ro,[e("div",uo,[(a(!0),o(R,null,P(T.value,h=>(a(),o("div",{key:h.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",co,[e("span",mo,c(h.type),1),e("span",fo,c(U(h.timestamp)),1)]),e("p",po,c(h.content),1)]))),128))])])):p("",!0)])])])):p("",!0),i.value==="request"?(a(),o("div",bo,[e("div",yo,[t.type!=="contact"?(a(),j(ka,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:re},null,8,["task","entity-type","activities"])):p("",!0),C(Va,{task:t.task,"task-type":t.type,"customer-id":((ne=t.task.customer)==null?void 0:ne.id)||t.task.customerId||t.task.id,onAction:Qe,onAddTag:v[11]||(v[11]=h=>w.value=!0)},null,8,["task","task-type","customer-id"])]),e("div",vo,[v[18]||(v[18]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",go,[e("div",xo,[ce.value.length>0?(a(),o("div",ho)):p("",!0),ce.value.length===0?(a(),o("div",ko,[...v[17]||(v[17]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(a(),o("div",wo,[(a(!0),o(R,null,P(ce.value,h=>(a(),o("div",{key:h.id,class:"flex gap-4 relative"},[e("div",{class:I(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",mt(h.type)])},[e("i",{class:I([ct(h.type),"text-fluid-sm"])},null,2)],2),e("div",Co,[e("div",$o,[e("span",So,c(h.user),1),V(" "+c(h.action),1)]),h.content?(a(),o("div",Ao,c(h.content),1)):p("",!0),e("div",To,c(ft(h.timestamp)),1)])]))),128))]))])])])])):p("",!0),i.value==="data"?(a(),o("div",Do,[e("div",qo,[v[20]||(v[20]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-note-sticky text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Notes")])],-1)),e("div",Eo,[e("div",Oo,[E.value.length===0?(a(),o("div",Io,[...v[19]||(v[19]=[e("i",{class:"fa-solid fa-note-sticky text-2xl mb-2"},null,-1),e("p",null,"No notes yet",-1)])])):p("",!0),(a(!0),o(R,null,P(E.value,h=>(a(),o("div",{key:h.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",No,c(U(h.timestamp)),1),e("p",Mo,c(h.content),1)]))),128))])])]),e("div",jo,[v[23]||(v[23]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-paperclip text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Attachments")])],-1)),e("div",Lo,[e("div",Vo,[A.value.length===0?(a(),o("div",Bo,[...v[21]||(v[21]=[e("i",{class:"fa-solid fa-paperclip text-2xl mb-2"},null,-1),e("p",null,"No attachments yet",-1)])])):p("",!0),(a(!0),o(R,null,P(A.value,h=>(a(),o("div",{key:h.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg flex items-center gap-3"},[v[22]||(v[22]=e("i",{class:"fa-solid fa-file text-sub text-lg"},null,-1)),e("div",Fo,[e("div",Uo,c(h.filename),1),e("div",Wo,c(U(h.timestamp)),1)])]))),128))])])]),e("div",Ro,[e("div",Po,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[v[25]||(v[25]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Trade-in")],-1)),e("button",{onClick:B,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...v[24]||(v[24]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",zo,[e("div",Qo,[D.value.length===0?(a(),o("div",Ho,[...v[26]||(v[26]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-2xl mb-2"},null,-1),e("p",null,"No trade-ins yet",-1)])])):p("",!0),(a(!0),o(R,null,P(D.value,h=>(a(),o("div",{key:h.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Yo,[e("div",Ko,c(U(h.timestamp)),1)]),h.data&&h.data.brand?(a(),o("div",Go,[V(c(h.data.brand)+" "+c(h.data.model)+" ",1),h.data.version?(a(),o("span",Jo,c(h.data.version),1)):p("",!0)])):p("",!0),h.data&&(h.data.kilometers||h.data.price)?(a(),o("div",Xo,[h.data.kilometers?(a(),o("div",Zo,[v[27]||(v[27]=e("span",{class:"text-sub"},"KM:",-1)),V(" "+c(Te(h.data.kilometers)),1)])):p("",!0),h.data.price?(a(),o("div",_o,[v[28]||(v[28]=e("span",{class:"text-sub"},"Price:",-1)),V(" € "+c(de(h.data.price)),1)])):p("",!0)])):p("",!0),h.content?(a(),o("div",ed,c(h.content),1)):p("",!0)]))),128))])])]),e("div",td,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[v[30]||(v[30]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-shopping-cart text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Purchase")],-1)),e("button",{onClick:q,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...v[29]||(v[29]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",sd,[e("div",ad,[x.value.length===0?(a(),o("div",nd,[...v[31]||(v[31]=[e("i",{class:"fa-solid fa-shopping-cart text-2xl mb-2"},null,-1),e("p",null,"No purchases yet",-1)])])):p("",!0),(a(!0),o(R,null,P(x.value,h=>(a(),o("div",{key:h.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",ld,[e("div",id,c(U(h.timestamp)),1)]),h.data&&h.data.brand?(a(),o("div",od,[V(c(h.data.brand)+" "+c(h.data.model)+" ",1),h.data.year?(a(),o("span",dd,"("+c(h.data.year)+")",1)):p("",!0)])):p("",!0),h.data&&h.data.price?(a(),o("div",rd," € "+c(de(h.data.price)),1)):p("",!0),h.content?(a(),o("div",ud,c(h.content),1)):p("",!0)]))),128))])])])])])):p("",!0)])])])):p("",!0):(a(),o("div",Qi,[e("div",Hi,[e("main",Yi,[e("div",Ki,[C(Ge,{modelValue:y(g),"onUpdate:modelValue":v[1]||(v[1]=h=>vt(g)?g.value=h:null),tabs:rt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),y(g)==="overview"?(a(),o("div",Gi,[t.type!=="contact"?(a(),o("div",Ji,[C(Gs,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((H=t.task.requestedCar)==null?void 0:H.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:re},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):p("",!0),gt(S.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(a(),o("div",Xi,[(a(),j(Ke(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ce.value,onCarAdded:v[2]||(v[2]=h=>S.$emit("car-added",h)),onConvertToLead:v[3]||(v[3]=h=>S.$emit("convert-to-lead")),onConvertToOpportunity:v[4]||(v[4]=h=>S.$emit("convert-to-opportunity")),onVehicleSelected:He,onCreateOffer:Ye},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),y(De).length>0?(a(),o("div",Zi,[(a(!0),o(R,null,P(y(De),h=>(a(),j(Je,{key:h.id,item:h,"task-type":t.type,"customer-initials":"SK",onEdit:y(Pe),onDelete:y(ze)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)])):(a(),o("div",_i,[C(Ra,{actions:t.addNewConfig.tabActions,"active-tab":y(g),onAction:Me},null,8,["actions","active-tab"]),e("div",null,[y(J)==="communication"?(a(),j(tt,{key:0,type:y(it),"task-type":t.type,"task-id":t.task.id,"phone-number":((K=t.task.customer)==null?void 0:K.phone)||"",item:y(ae),onSave:y(qe),onCancel:y(Ne)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):p("",!0),y(g)==="data"&&y(J)==="note"?(a(),j(Yl,{key:1,item:y(ae),"task-type":t.type,"task-id":t.task.id,onSave:y(qe),onCancel:y(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0),y(J)==="attachment"?(a(),j(ti,{key:2,item:y(ae),"task-type":t.type,"task-id":t.task.id,onSave:y(qe),onCancel:y(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0)]),y(De).length>0?(a(),o("div",eo,[(a(!0),o(R,null,P(y(De),h=>(a(),j(Je,{key:h.id,item:h,"task-type":t.type,"customer-initials":"SK",onEdit:y(Pe),onDelete:y(ze)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)]))])]),C(kl,{title:"Activity summary",activities:ce.value,collapsed:_.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:v[5]||(v[5]=h=>_.value=!_.value)},null,8,["activities","collapsed"])])),C(ri,{show:z.value==="financing"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:je,onClose:Ee},null,8,["show","task-type","task-id"]),C(vi,{show:z.value==="tradein"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:je,onClose:Ee},null,8,["show","task-type","task-id"]),C(Mi,{show:z.value==="purchase"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:je,onClose:Ee},null,8,["show","task-type","task-id","requested-car"]),C(xt,{show:ue.value,onClose:v[12]||(v[12]=h=>ue.value=!1),onConfirm:ye},null,8,["show"]),se.value?(a(),j(ht,{key:2,show:se.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:be,onCancel:v[13]||(v[13]=h=>se.value=!1)},null,8,["show","customer","assignee"])):p("",!0),C(Fi,{show:w.value,"existing-tags":t.task.tags||[],onClose:v[14]||(v[14]=h=>w.value=!1),onAdd:ut},null,8,["show","existing-tags"])])}}},Z={[Y.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[Y.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[Y.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[Y.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[Y.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[Y.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},st={toClosed:(t,r,n)=>{const d={isDisqualified:!0,disqualifyReason:(n==null?void 0:n.reason)||null,disqualifyCategory:(n==null?void 0:n.category)||null,scheduledAppointment:null,nextActionDue:null};(n==null?void 0:n.reason)==="Duplicate"?(d.isDuplicate=!0,d.stage="Closed Failed"):(n==null?void 0:n.category)==="Not Interested"?d.stage="Not Interested":d.stage="Not Valid",d.status="Disqualified";const m=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(n==null?void 0:n.category)||"Unknown"}, Reason: ${(n==null?void 0:n.reason)||"Unknown"}`}];return t.scheduledAppointment&&m.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:d,activities:m}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function vd(t,r){return r.startsWith("Closed")?st.toClosed:t.startsWith("Closed")&&!r.startsWith("Closed")?st.reopen:null}function gd(t){var s,b,f;const r=t.lead;if(!r)return null;const n=oe(r,"lead");if(!n)return((s=Z[Y.NEW])==null?void 0:s.primaryAction)||null;const d=Z[n];if(!d)return((b=Z[Y.NEW])==null?void 0:b.primaryAction)||null;if(!d.primaryAction)return((f=Z[Y.NEW])==null?void 0:f.primaryAction)||null;const m=d.primaryAction;return typeof m=="function"?m({lead:r,displayStage:n}):m}function xd(t){const r=t.lead;if(!r)return[];const n=oe(r,"lead"),d=Z[n];return d?d.secondaryActions||[]:[]}function lt(t){const r=t.lead;if(!r||!(r.isDisqualified===!0))return!1;const d=oe(r,"lead");return d===Y.CLOSED_INVALID||d===Y.CLOSED_NOT_INTERESTED||d===Y.CLOSED_DUPLICATE}function hd(t){const r=t.lead;if(!r||lt(t))return!1;const n=oe(r,"lead"),d=Z[n];return d?typeof d.showLQWidget=="function"?d.showLQWidget(r):d.showLQWidget??!1:!1}function kd(t){const r=t.lead;if(!r||lt(t))return!1;const n=oe(r,"lead"),d=Z[n];return d?d.showDeadlineBanner&&r.nextActionDue:!1}function wd(t){const r=t.lead;if(!r)return!1;const n=oe(r,"lead"),d=Z[n];return d?d.canPostpone??!1:!1}function Cd(t){const r=t.lead;if(!r)return"qualification";const n=oe(r,"lead"),d=Z[n];return d&&d.lqWidgetMode||"qualification"}const Re={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const r=t.deliverySubstatus;return r==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:r==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ve={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function le(t){if(!t)return 0;const r=new Date(t),d=Math.abs(new Date-r);return Math.ceil(d/(1e3*60*60*24))}const me={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const r=te(),n=r.getSetting("oofbMinDays"),d=r.getSetting("oofbMaxDays"),m=le(t.opportunity.createdAt);return m>=n&&m<d+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const n=te().getSetting("ufbDays");return le(t.opportunity.createdAt)>=n&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=te().getSetting("ofbDays");return le(t.opportunity.lastActivity||t.opportunity.createdAt)>=n&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=te().getSetting("nfuDays"),d=le(t.opportunity.lastActivity||t.opportunity.createdAt),m=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return d>=n&&!t.opportunity.contractDate&&!m&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var s;if(!t.opportunity.contractDate)return!1;const n=te().getSetting("cfbDays"),d=le(t.opportunity.contractDate),m=(s=t.activities)==null?void 0:s.some(b=>{var f;return b.type==="delivery"||((f=b.action)==null?void 0:f.toLowerCase().includes("delivered"))});return d>=n&&!m},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var s;const r=(s=t.activities)==null?void 0:s.find(b=>{var f;return b.type==="delivery"||((f=b.action)==null?void 0:f.toLowerCase().includes("delivered"))});if(!r)return!1;const d=te().getSetting("dfbDays");return le(r.timestamp)>=d},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const r=t.stage;return r==="Closed Won"||r==="Closed Lost"},"is-closed-with-task-widget":t=>me["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(me["is-closed"](t))return!1;const r=te(),n=r.getSetting("abandonedOpportunityDays");if(!r.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const m=t.opportunity.lastActivity||t.opportunity.createdAt;return le(m)>=n}};function $d(t,r){if(me["is-closed-with-task-widget"](r))return[Ve.reopen,Ve.requalify,Ve.closeLost];const n=Re[t];return!n||!n.secondaryActions?[]:n.secondaryActions.filter(d=>{if(!d.conditional)return!0;const m=me[d.conditional];return m?m(r):!0})}function Sd(t,r){const n=Re[t];if(!n||!n.taskWidgets)return null;const m=te().getSetting("autoCloseWidgetsOnClose"),s=me["is-closed"]({stage:t});for(const b of n.taskWidgets){if(m&&s&&(b.type==="NFU"||b.type==="OFB"))continue;const f=me[b.condition];if(f&&f(r))return b.type}return null}function Ad(t,r){const n=Re[t];if(!n||!n.primaryAction)return null;const d=n.primaryAction;return{...d,title:typeof d.title=="function"?d.title(r):d.title,description:typeof d.description=="function"?d.description(r):d.description,label:typeof d.label=="function"?d.label(r):d.label}}function Td(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function Dd(t){return t==="Closed Won"||t==="Closed Lost"}const qd={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:r}){const n=r,d=s=>{s||n("close")},m=()=>{n("close")};return(s,b)=>(a(),j(y(Ae),{open:t.show,"onUpdate:open":d},{default:M(()=>[C(y(he),null,{default:M(()=>[C(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),C(y(we),{class:"w-full sm:max-w-md"},{default:M(()=>[C(y(Ce),null,{default:M(()=>[C(y($e),null,{default:M(()=>[V(c(t.title),1)]),_:1})]),_:1}),b[0]||(b[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),C(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:M(()=>[C(y(F),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{yd as _,xd as a,kd as b,wd as c,Cd as d,vd as e,Xe as f,gd as g,Ze as h,lt as i,_e as j,Yl as k,Sd as l,Ad as m,$d as n,Dd as o,Td as p,Ii as q,qd as r,hd as s};
