import{C as _,r as y,d as w,s as u,e as b,D as C,h as O,o as S}from"./index-C3vqiHZ_.js";import{u as k,a as q}from"./opportunities-DwMYze2l.js";import{_ as A}from"./PageHeader-Cg1JQTpr.js";import{_ as N}from"./UnifiedAddForm-CjRnsaN2.js";const D={class:"page-container"},L={class:"p-4 md:p-8"},B={__name:"AddNew",setup(R){const i=O(),c=k(),d=_(),p=q(),o=y(null),m=async l=>{try{const{contactMode:a,selectedContact:f,contactData:r,vehicleData:e,markAsLead:h,markAsOpportunity:g}=l;let t=f;if(a==="new"&&(t=await c.addCustomer({...r,initials:r.name.split(" ").map(s=>s[0]).join("").toUpperCase(),source:"Direct",tags:[],company:r.company||null})),h){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},status:"Open",stage:"Open Lead",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:"",isDisqualified:!1,disqualifyReason:null,scheduledAppointment:null,contactAttempts:[]};e&&Object.keys(e).length>0&&(s.requestedCar=e);const n=await d.createLead(s);i.push({path:"/customers",query:{tab:"open-leads",highlight:`lead-${n.id}`}})}else if(g){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},stage:"Qualified",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:""};e&&Object.keys(e).length>0&&(s.vehicle=e);const n=await p.createOpportunity(s);i.push({path:"/customers",query:{tab:"open-opportunities",highlight:`opp-${n.id}`}})}else e&&Object.keys(e).length>0&&await c.addRequestedCar(t.id,e),i.push({path:"/customers",query:{tab:"contacts",highlight:`contact-${t.id}`}})}catch(a){console.error("Error saving data:",a),alert("Failed to save. Please try again."),o.value&&o.value.resetSubmitting()}};return(l,a)=>(S(),w("div",D,[u(A,{title:"Add New Customer"},{actions:C(()=>[...a[0]||(a[0]=[])]),_:1}),b("div",L,[u(N,{ref_key:"formRef",ref:o,onSubmit:m},null,512)])]))}};export{B as default};
