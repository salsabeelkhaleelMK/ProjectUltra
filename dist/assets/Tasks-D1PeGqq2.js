import{c as D,G as at,r as I,H as et,d as C,o as y,g as O,p as Q,e,w as Pe,x as j,y as n,P as tt,n as z,t as N,I as se,k as W,F as re,_ as it,s as S,E as $,T as rt,l as we,J as ie,i as fe,K as Se,L as J,j as Ee,M as ze,N as dt,h as st,D as je,u as Re,O as Fe,m as Qe,v as be,Q as P,R as It,S as Ot,U as Ve,V as Me,W as Ze,z as He,X as Nt,Y as qt,Z as Lt}from"./index-C1t3cTDZ.js";import{u as Ye}from"./opportunities-Bchn0rUS.js";import{u as Ke}from"./users-BNim1eq2.js";import{y as Mt}from"./components-CQ8n0SlM.js";import{_ as Ft,i as Vt,g as Ut,a as Rt,s as Bt,b as jt,c as Wt,d as zt,e as _e,f as Ht,h as Et,j as Pt,k as Qt,l as Yt,m as Kt,n as Gt,o as Jt}from"./ComingSoonModal-BykCJlXI.js";import{f as Ue,a as Be,g as ut,b as ct,c as pt,d as mt}from"./formatters-DjeI4Z8-.js";import{z as $e,F as Ae,L as De,H as Te,j as Ie,K as We,C as Oe,W as Ne}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DZxbj_nS.js";import{f as ft}from"./vehicles-fkVQf3Zx.js";import{_ as Xt}from"./CreateEventModal-DJUWCUS8.js";import{_ as Zt,a as _t}from"./EditEventModal-DV_5T8Yb.js";import{_ as es}from"./ReassignUserModal-BH2sTskf.js";const ts={key:1,class:"absolute right-3 top-8 z-50"},ss={class:"flex gap-2 mb-0.5"},ns={key:1,class:"px-2 py-0.5 rounded text-xs font-medium bg-red-50 text-red-700 border border-red-200"},os={class:"font-bold text-gray-900 text-content-bold line-clamp-2 pt-0.5"},ls={class:"flex gap-3 text-xs mt-0.5 mb-1"},as={class:"flex items-center gap-1.5"},is={class:"flex items-center gap-1.5"},rs={key:0,class:"text-xs text-gray-600 pb-3"},ds={key:2,class:"flex items-center justify-between pt-1 border-t border-gray-100"},us={class:"text-xs flex items-center gap-2"},cs={class:"rounded-full bg-black text-white font-medium flex items-center justify-center text-[6px] shrink-0 w-3 h-3"},ps={class:"text-gray-600 font-medium"},ms={key:1},fs={class:"text-xs font-medium"},ys={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:v}){const s=t,c=D(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),o=D(()=>s.selected),a=D(()=>o.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),u=D(()=>{const d=s.item.displayStage||s.item.stage;return d?at(d,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),r=d=>{if(!d)return"?";const l=d.split(" ");return l.length>=2?(l[0][0]+l[l.length-1][0]).toUpperCase():d.substring(0,2).toUpperCase()},g=I(null);return(d,l)=>{const i=et("click-outside");return y(),C("div",{ref_key:"cardRef",ref:g,onClick:l[1]||(l[1]=m=>d.$emit("select",c.value)),class:z(["bg-white rounded-lg p-2.5 min-h-32 flex flex-col justify-between hover:shadow-sm cursor-pointer relative",a.value])},[t.showMenu?(y(),C("button",{key:0,onClick:l[0]||(l[0]=Pe(m=>d.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-3 right-3 text-gray-300 hover:text-gray-600"},[...l[2]||(l[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):O("",!0),t.openMenuId===t.item.id&&t.showMenu?Q((y(),C("div",ts,[t.menuItems&&t.menuItems.length>0?(y(),j(n(tt),{key:0,items:t.menuItems,className:"w-40"},null,8,["items"])):O("",!0)])),[[i,()=>d.$emit("menu-close")]]):O("",!0),e("div",null,[e("div",ss,[e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},N(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(y(),C("span",{key:0,class:z(["px-2 py-0.5 rounded text-xs font-medium border",u.value])},N(t.item.displayStage||t.item.stage),3)):O("",!0),t.item.priority==="Hot"?(y(),C("span",ns," Hot ")):O("",!0)]),e("h3",os,N(t.getName(t.item)),1),e("div",ls,[e("span",as,[l[3]||(l[3]=e("i",{class:"fa-solid fa-location-dot text-xs"},null,-1)),se(d.$slots,"location",{item:t.item})]),e("span",is,[l[4]||(l[4]=e("i",{class:"fa-solid fa-globe text-xs"},null,-1)),se(d.$slots,"source",{item:t.item},()=>{var m;return[W(N(t.item.source||((m=t.item.customer)==null?void 0:m.source)||"Unknown"),1)]})])]),t.getVehicleInfo?(y(),C("p",rs,N(t.getVehicleInfo(t.item)),1)):O("",!0)]),d.$slots.owner||d.$slots.dates?(y(),C("div",ds,[e("div",us,[se(d.$slots,"owner",{item:t.item},()=>[t.item.assignee?(y(),C(re,{key:0},[e("div",cs,N(r(t.item.assignee)),1),e("span",ps,N(t.item.assignee),1)],64)):(y(),C("span",ms,"Unassigned"))])]),e("div",fs,[se(d.$slots,"dates",{item:t.item})])])):O("",!0)],2)}}},vs={class:"flex items-center gap-2"},gs={key:0,class:"flex gap-2"},bs={class:"relative ml-auto",ref:"sortContainer"},hs={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white",style:{"background-color":"var(--brand-red)"}},xs={key:0,class:"absolute right-0 mt-2 z-50 sort-dropdown-wrapper"},ws={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:v}){const s=t,c=v,o=I(!1),a=()=>{o.value=!o.value},u=g=>{o.value=!1,c("sort-change",g)},r=D(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>u("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>u("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>u("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>u("assigned-to-my-team")}].map(d=>({...d,className:d.key===s.sortOption?"sort-item-selected":""})));return(g,d)=>{const l=et("click-outside");return y(),C("div",vs,[t.showTypeFilter?(y(),C("div",gs,[e("button",{onClick:d[0]||(d[0]=i=>g.$emit("filter-change","all")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:d[1]||(d[1]=i=>g.$emit("filter-change","lead")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:d[2]||(d[2]=i=>g.$emit("filter-change","opportunity")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):O("",!0),e("div",bs,[e("button",{onClick:Pe(a,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[d[3]||(d[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(y(),C("span",hs)):O("",!0)]),S(rt,{name:"dropdown"},{default:$(()=>[o.value?Q((y(),C("div",xs,[S(n(tt),{items:r.value,className:"w-56"},null,8,["items"])])),[[l,()=>o.value=!1]]):O("",!0)]),_:1})],512)])}}},ks=it(ws,[["__scopeId","data-v-b1a2e14c"]]),Cs={class:"bg-surface border-r border flex flex-col shrink-0 w-full lg:w-80 h-full"},Ss={class:"page-header shrink-0"},$s={class:"page-header-main"},As={class:"page-header-content"},Ds={class:"page-header-title"},Ts={class:"flex items-center gap-1 bg-surfaceSecondary rounded-lg p-1"},Is={class:"px-5 py-3"},Os={class:"relative"},Ns=["placeholder"],qs={key:0,class:"px-5 pb-3"},Ls={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},typeFilter:{type:String,default:"all"},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:t=>t.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},showTypeFilter:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:v}){const s=t,c=v,o=I(s.initialSearchQuery),a=I(null),u=I("recent-first");we(()=>s.initialSearchQuery,l=>{o.value=l});const r=D(()=>{if(!o.value.trim())return s.items;const l=o.value.toLowerCase().trim();return s.items.filter(i=>{const m=s.getName(i).toLowerCase(),h=s.getVehicleInfo(i).toLowerCase();return m.includes(l)||h.includes(l)})}),g=l=>s.selectedId?(l.compositeId||`${l.type||"task"}-${l.id}`)===s.selectedId:!1,d=l=>{u.value=l,c("sort-change",l)};return(l,i)=>(y(),C("div",Cs,[e("header",Ss,[e("div",$s,[e("div",As,[e("div",null,[e("h1",Ds,N(t.title),1)]),e("div",Ts,[e("button",{onClick:i[0]||(i[0]=m=>l.$emit("view-change","card")),class:z(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",t.viewMode==="card"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"]),title:"Card View"},[...i[7]||(i[7]=[e("i",{class:"fa-solid fa-columns text-xs"},null,-1),e("span",null,"Card",-1)])],2),e("button",{onClick:i[1]||(i[1]=m=>l.$emit("view-change","table")),class:z(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",t.viewMode==="table"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"]),title:"Table View"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-table text-xs"},null,-1),e("span",null,"Table",-1)])],2)])])])]),e("div",Is,[e("div",Os,[i[9]||(i[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),Q(e("input",{"onUpdate:modelValue":i[2]||(i[2]=m=>o.value=m),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-surfaceSecondary border border rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ns),[[ie,o.value]])])]),t.showTypeFilter?(y(),C("div",qs,[S(ks,{"type-filter":t.typeFilter,"sort-option":u.value,"show-type-filter":!0,onFilterChange:i[3]||(i[3]=m=>l.$emit("filter-change",m)),onSortChange:d},null,8,["type-filter","sort-option"])])):O("",!0),e("div",{ref_key:"scrollContainer",ref:a,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(y(!0),C(re,null,fe(r.value,m=>(y(),j(ys,{key:m.compositeId||`${m.type||"task"}-${m.id}`,item:m,selected:g(m),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(m):null,onSelect:i[4]||(i[4]=h=>l.$emit("select",h)),onMenuClick:i[5]||(i[5]=h=>l.$emit("menu-click",h)),onMenuClose:i[6]||(i[6]=h=>l.$emit("menu-close"))},{location:$(({item:h})=>[se(l.$slots,"location",{item:h})]),source:$(({item:h})=>[se(l.$slots,"source",{item:h})]),owner:$(({item:h})=>[se(l.$slots,"owner",{item:h})]),dates:$(({item:h})=>[se(l.$slots,"dates",{item:h})]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}};function yt(t,v=[],s,c){const o=Se(),a=o.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},u=o.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},r=Ms(t,v),g=Fs(t,v),d=Vs(t),l=Us(t),i=a.intent+a.behavioral+a.temporal,m={intent:a.intent/i*100,behavioral:a.behavioral/i*100,temporal:a.temporal/i*100},h=r/40*m.intent,k=g/35*m.behavioral,q=d/25*m.temporal,M=Math.min(100,Math.max(0,h+k+q+l));let w="COLD";return M>=u.hot?w="HOT":M>=u.warm?w="WARM":M>=u.standard&&(w="STANDARD"),{score:Math.round(M*10)/10,level:w,breakdown:{intent:Math.round(r*10)/10,behavioral:Math.round(g*10)/10,temporal:Math.round(d*10)/10,quality:Math.round(l*10)/10,total:Math.round(M*10)/10}}}function Ms(t,v){var c;let s=0;return(t.requestType==="Test Drive"||((c=t.scheduledAppointment)==null?void 0:c.type)==="test-drive"||v.some(o=>o.type==="test-drive"||o.type==="appointment"))&&(s=Math.max(s,40)),v.some(o=>o.type==="financing")&&(s=Math.max(s,35)),v.some(o=>o.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||v.some(o=>{var a,u,r;return((a=o.content)==null?void 0:a.toLowerCase().includes("location"))||((u=o.content)==null?void 0:u.toLowerCase().includes("dealership"))||((r=o.content)==null?void 0:r.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||v.some(o=>{var a,u;return((a=o.content)==null?void 0:a.toLowerCase().includes("configur"))||o.type==="attachment"&&((u=o.fileName)==null?void 0:u.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),v.some(o=>{var u;const a=((u=o.content)==null?void 0:u.toLowerCase())||"";return a.includes("compare")||a.includes("versus")||a.includes("vs")||a.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function Fs(t,v){let s=0;const c=new Set(v.map(r=>{if(!r.timestamp)return null;const g=new Date(r.timestamp);return`${g.getFullYear()}-${g.getMonth()}-${g.getDate()}`}).filter(Boolean)),o=Math.min(c.size*10,35);s+=o,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const a=v.reduce((r,g)=>{var d;return r+(((d=g.content)==null?void 0:d.length)||0)},0),u=Math.min(Math.floor(a/50),25);return s+=u,v.some(r=>{var g,d,l;return r.type==="attachment"&&(((g=r.fileName)==null?void 0:g.toLowerCase().includes("brochure"))||((d=r.fileName)==null?void 0:d.toLowerCase().includes("spec"))||((l=r.fileName)==null?void 0:l.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function Vs(t){let v=0;if(!t.createdAt)return 0;const s=new Date,c=new Date(t.createdAt),o=(s.getTime()-c.getTime())/(1e3*60*60);o<2?v+=25:o<24?v+=15:o<48?v+=5:v-=10;const a=c.getDay(),u=c.getHours();if((a===0||a===6||u<9||u>17)&&(v+=10),t.contactAttempts&&t.contactAttempts.length===3&&(v+=50),t.lastActivity){const r=new Date(t.lastActivity);(s.getTime()-r.getTime())/(1e3*60*60*24)>3&&(v+=20)}return Math.min(Math.max(v,0),25)}function Us(t){var s,c,o,a,u,r,g;let v=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(v+=10),(c=t.customer)!=null&&c.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(v+=10),(o=t.customer)!=null&&o.name&&((a=t.customer)!=null&&a.email)&&((u=t.customer)!=null&&u.phone)&&((r=t.customer)!=null&&r.address)&&(v+=5),(t.isDuplicate||t.isDisqualified||!((g=t.customer)!=null&&g.name))&&(v-=20),v}function vt(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function gt(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Rs({typeFilter:t,showTypeFilter:v,tasks:s}){return{filterDefinitions:D(()=>{const o=[];v.value&&o.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),o.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),o.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&o.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),o.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const a=[...new Set(s.value.map(r=>r.assignee).filter(Boolean))];a.length>0&&o.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:a.map(r=>({value:r,label:r})),aiHint:"Person assigned to the task",pinned:!0});const u=[...new Set(s.value.map(r=>{const g=r.type==="lead"?r.requestedCar:r.vehicle;return g==null?void 0:g.brand}).filter(Boolean))];return u.length>0&&o.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:u.map(r=>({value:r,label:r})),aiHint:"Car brand requested by customer"}),o.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),o})}}const Bs={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},js={class:"page-header shrink-0"},Ws={class:"page-header-main"},zs={class:"page-header-content"},Hs={class:"flex items-center gap-3"},Es={class:"flex items-center gap-1 bg-surfaceSecondary rounded-lg p-1"},Ps={class:"flex-1 overflow-y-auto p-4 md:p-8"},Qs={class:"table-wrapper w-full"},Ys={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close"],setup(t,{emit:v}){const s=t,c=v,o=Se();I("");const a=I({pageIndex:0,pageSize:10}),u=I(""),r=I([]),g=I([{id:"status",value:["Valid","Qualified","Open Lead"],operator:"in"},{id:"type",value:"lead",operator:"eq"},{id:"source",value:["Marketing","Website"],operator:"in"},{id:"assignee",value:void 0},{id:"urgencyLevel",value:void 0}]);I({});const{filterDefinitions:d}=Rs({typeFilter:D(()=>s.typeFilter),showTypeFilter:D(()=>s.showTypeFilter),tasks:D(()=>s.tasks)}),l=D(()=>s.tasks),i=x=>x.compositeId===s.currentTaskId||x.compositeId===s.highlightId,m=x=>{if(x.type==="lead")return x.requestedCar?`${x.requestedCar.brand} ${x.requestedCar.model}`:"No vehicle specified";const f=x.vehicle||x.requestedCar;return f?`${f.brand} ${f.model}`:"No vehicle specified"},h=x=>{const f=x.type==="lead"?x.requestedCar:x.vehicle;if(!f)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const p=f.stockDays!==void 0&&f.stockDays!==null;return{status:p?"In Stock":"Out of Stock",class:p?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},k=x=>{var f;return x.type==="lead"?((f=x.requestedCar)==null?void 0:f.requestType)||x.requestType||"N/A":x.requestType||"Opportunity"},q=D(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:x=>M(x.original)},cell:({row:x})=>{const f=x.original,p=f.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${p}`},f.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:x})=>{const f=x.original;return J("div",{class:"flex items-center gap-2 md:gap-3"},[J("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${f.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},f.customer.initials),J("div",{class:"min-w-0"},[J("div",{class:"text-content font-semibold text-heading truncate max-w-[7.5rem] md:max-w-none"},f.customer.name),J("div",{class:"text-meta truncate hidden sm:block"},f.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:x})=>{const f=x.original,p=m(f);return p==="No vehicle specified"?J("span",{class:"text-meta"},"N/A"):J("div",{class:"flex items-center gap-2"},[J("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),J("span",{class:"text-content font-medium text-heading truncate max-w-[7.5rem]"},p)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:x})=>{const f=x.original,p=h(f);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${p.class}`},p.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:x})=>{const f=x.original,p=k(f);return J("span",{class:"text-meta"},p)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:x})=>{const f=x.original;return J("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},f.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:x})=>{const f=x.original,p=s.getOwnerInfo(f);return J("div",{class:"flex items-center gap-2"},[J("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},p.initials),J("span",{class:"text-meta truncate max-w-20"},p.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:x})=>{const f=x.original,p=f.type==="lead"?f.status:f.displayStage||f.stage,A=s.getStageBadgeClass(p);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${A}`},p)}},...s.typeFilter==="lead"&&o.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:x})=>{const f=x.original;if(f.type!=="lead")return J("span",{class:"text-meta"},"â€”");let p=f.urgencyLevel;p||(p=yt(f).level);const A=gt(p),U=vt(p);return J("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${A}`},[J("span",{},U),J("span",{},p)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:x})=>{const f=x.original;return J("button",{class:"text-sub hover:text-body",onClick:p=>{p.stopPropagation(),c("menu-click",f.id)}},[J("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),M=x=>{u.value=String(x.id),c("select",x.compositeId)},w=D(()=>({class:{tr:x=>{const f="cursor-pointer hover:bg-surfaceSecondary transition-colors",p=x.original;return i(p)?`${f} bg-blue-50 border-l-4 border-l-blue-500`:f}}}));return(x,f)=>(y(),C("div",Bs,[e("header",js,[e("div",Ws,[e("div",zs,[f[10]||(f[10]=e("div",null,[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Hs,[e("div",Es,[e("button",{onClick:f[0]||(f[0]=p=>x.$emit("view-change","card")),class:z(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",x.viewMode==="card"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"]),title:"Card View"},[...f[7]||(f[7]=[e("i",{class:"fa-solid fa-columns text-xs"},null,-1),e("span",null,"Card",-1)])],2),e("button",{onClick:f[1]||(f[1]=p=>x.$emit("view-change","table")),class:z(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",x.viewMode==="table"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"]),title:"Table View"},[...f[8]||(f[8]=[e("i",{class:"fa-solid fa-table text-xs"},null,-1),e("span",null,"Table",-1)])],2)]),e("button",{onClick:f[2]||(f[2]=p=>x.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border px-4 py-2 text-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...f[9]||(f[9]=[e("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),e("div",Ps,[e("div",Qs,[S(n(Mt),{data:l.value,columns:q.value,meta:w.value,onRowClick:M,columnFiltersOptions:{filterDefs:n(d)},pagination:a.value,"onUpdate:pagination":f[3]||(f[3]=p=>a.value=p),globalFilter:u.value,"onUpdate:globalFilter":f[4]||(f[4]=p=>u.value=p),sorting:r.value,"onUpdate:sorting":f[5]||(f[5]=p=>r.value=p),columnFilters:g.value,"onUpdate:columnFilters":f[6]||(f[6]=p=>g.value=p),paginationOptions:{rowCount:l.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{toolbar:$(()=>[...f[11]||(f[11]=[e("div",{class:"flex justify-end"},[e("button",{class:"group flex items-center gap-2 rounded-2xl border border px-4 py-2 text-sm font-medium text-body hover:border-purple-100 hover:bg-purple-50 hover:text-purple-600 transition-all"},[e("i",{class:"fa-solid fa-arrow-left text-sub group-hover:text-purple-500"}),e("span",{class:"hidden sm:inline"},"Switch back to old design")])],-1)])]),"empty-state":$(()=>[...f[12]||(f[12]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Ks={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border bg-surface"},Gs={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border bg-surface"},ot={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){return(v,s)=>t.task?(y(),C("div",Ks,[S(Ft,{task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},null,8,["task","type","management-widget","store-adapter","add-new-config"])])):(y(),C("div",Gs,[...s[0]||(s[0]=[Ee('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-sub"></i></div><h3 class="text-base font-semibold text-heading mb-2">No task selected</h3><p class="text-meta">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},Js={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},Xs={class:"px-4 py-3 flex items-center justify-between gap-3"},Zs=["aria-label"],_s={key:0,class:"flex-1 flex items-center justify-center"},en={key:1,class:"flex items-center gap-2"},tn={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:v}){const s=v,c=()=>{s("back")};return(o,a)=>t.show?(y(),C("div",Js,[e("div",Xs,[e("button",{onClick:c,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...a[0]||(a[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Zs),o.$slots.title?(y(),C("div",_s,[se(o.$slots,"title")])):O("",!0),o.$slots.actions?(y(),C("div",en,[se(o.$slots,"actions")])):O("",!0)])])):O("",!0)}};function bt(t,v={}){const s=Se(),c=D(()=>{const M=typeof t=="function"?t():ze(t);return{lead:M,displayStage:M?dt(M,"lead"):null}}),o=D(()=>c.value.displayStage||"New"),a=D(()=>{const M=c.value;return Vt(M)}),u=D(()=>{const M=c.value,w=Ut(M);if(!w)return null;const x=v[w.key];return{...w,handler:x||(()=>console.warn(`No handler for action: ${w.key}`))}}),r=D(()=>{const M=c.value;return Rt(M).map(x=>{const f=v[x.key];return{...x,handler:f||(()=>console.warn(`No handler for action: ${x.key}`))}})}),g=D(()=>{const M=c.value;return Bt(M)}),d=D(()=>{const M=c.value;return jt(M)}),l=D(()=>{const M=c.value;return Wt(M)}),i=D(()=>{const M=c.value;return zt(M)}),m=D(()=>{const w=c.value.lead;return((w==null?void 0:w.contactAttempts)||[]).length||0}),h=D(()=>s.getSetting("maxContactAttempts")),k=D(()=>m.value+1>=h.value),q=D(()=>!0);return{displayStage:o,isClosed:a,primaryAction:u,secondaryActions:r,showLQWidget:g,showDeadlineBanner:d,canPostpone:l,canReassign:q,lqWidgetMode:i,contactAttempts:m,maxContactAttempts:h,shouldShowAutoDisqualifyWarning:k}}function sn({getLead:t,leadState:v,emit:s}){const c=st(),o=je(),a=Re();async function u(w){var f;const x=t();if(x){if(!v.canPostpone.value){console.warn("Cannot postpone in current state");return}try{const p=new Date(`${w.date}T${w.time}:00`),A=p.toISOString(),U={nextActionDue:A};if((w.assigneeId||w.teamId)&&(U.assignee=w.assignee||null,U.assigneeId=w.assigneeId||null,U.assigneeType=w.assigneeType||"user",U.teamId=w.teamId||null,U.team=w.team||null),await o.updateLead(x.id,U),w.createAppointment){const E=new Date(p);E.setHours(E.getHours()+1),await o.updateLead(x.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${x.customer.name}`,start:A,end:E.toISOString(),type:"Call",assignee:w.assignee||x.assignee,assigneeId:w.assigneeId||x.assigneeId,assigneeType:w.assigneeType||x.assigneeType||"user",teamId:w.teamId||x.teamId,team:w.team||x.team,status:"scheduled"}}),await o.addActivity(x.id,{type:"appointment",user:((f=a.currentUser)==null?void 0:f.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ue(p)} at ${Be(p)}`,data:{type:"Call",date:w.date,time:w.time,assignee:w.assignee||x.assignee}})}await o.addActivity(x.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ue(p)} at ${Be(p)}${w.assignee?` and reassigned to ${w.assignee}`:""}`}),await o.fetchLeadById(x.id)}catch(p){console.error("Failed to postpone lead task:",p)}}}async function r(w){const x=t();if(x)try{if(await o.updateLead(x.id,{stage:"Validated"}),await o.addActivity(x.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),w.scheduleFollowUp&&w.appointmentData){const f=new Date(`${w.appointmentData.date}T${w.appointmentData.time}:00`);await o.scheduleFollowUp(x.id,{dateTime:f.toISOString(),assignee:w.appointmentData.assignee||x.assignee,assigneeId:w.appointmentData.assigneeId||null,assigneeType:w.appointmentData.assigneeType||"user",teamId:w.appointmentData.teamId||null,team:w.appointmentData.team||null}),await o.addActivity(x.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ue(f)} at ${Be(f)}`})}await o.fetchLeadById(x.id)}catch(f){console.error("Failed to validate lead:",f)}}async function g(){const w=t();if(w)try{const x=await o.convertLeadToOpportunity(w.id);a.canAccessOpportunities()?c.push({path:`/tasks/${x}`,query:{type:"opportunity"}}):c.push("/tasks")}catch(x){console.error("Failed to qualify lead:",x)}}async function d(w){const x=t();if(x)try{const f=x.contactAttempts||[];await o.updateLead(x.id,{contactAttempts:[...f,w],lastContactAttempt:w.timestamp,totalContactAttempts:f.length+1}),await o.addActivity(x.id,{type:"call",user:"You",action:`logged call attempt - ${w.outcome}`,content:w.notes||`Call attempt via ${w.channel}`,data:{outcome:w.outcome,channel:w.channel,duration:w.duration}}),await o.fetchLeadById(x.id)}catch(f){console.error("Failed to log call attempt:",f)}}async function l(w){const x=t();if(x)try{await o.addActivity(x.id,{type:"note",user:"You",action:"added a note",content:w.content||w.text||"",data:w}),await o.fetchLeadById(x.id)}catch(f){console.error("Failed to save note:",f)}}function i(){s("open-purchase-method")}function m(){s("open-trade-in")}async function h(w){var f;const x=t();if(x)try{const p=`${w.date}T${w.time}:00`,A=new Date(p);A.setHours(A.getHours()+1),await o.updateLead(x.id,{scheduledAppointment:{id:Date.now(),title:`${w.type} - ${x.customer.name}`,start:p,end:A.toISOString(),type:w.type,assignee:w.assignee,assigneeId:w.assigneeId,status:"scheduled",location:w.location||"",notes:w.notes||""}}),await o.addActivity(x.id,{type:"appointment",user:((f=a.currentUser)==null?void 0:f.name)||"You",action:"scheduled an appointment",content:`${w.type} scheduled for ${w.date} at ${w.time}`,data:{type:w.type,date:w.date,time:w.time,assignee:w.assignee}}),await o.fetchLeadById(x.id)}catch(p){console.error("Failed to schedule appointment:",p)}}async function k(w){const x=t();if(x){if(v.isClosed.value&&!w.force){console.warn("Lead already closed");return}try{const f=v.displayStage.value,p=w.reason==="Duplicate"?Fe.CLOSED_DUPLICATE:w.category==="Not Interested"?Fe.CLOSED_NOT_INTERESTED:Fe.CLOSED_INVALID,A=_e(f,p);if(A){const{updates:U,activities:E}=A(x,p,w);await o.updateLead(x.id,U);for(const X of E)await o.addActivity(x.id,X)}else{const U=w.reason==="Duplicate";await o.updateLead(x.id,{isDisqualified:!0,disqualifyReason:w.reason,isDuplicate:U,stage:U?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await o.addActivity(x.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${w.category}, Reason: ${w.reason}`})}c.push("/tasks")}catch(f){console.error("Failed to disqualify lead:",f)}}}async function q(){const w=t();if(w)try{const x=v.displayStage.value,f=Fe.NEW,p=_e(x,f);if(p){const{updates:A,activities:U}=p(w);await o.updateLead(w.id,A);for(const E of U)await o.addActivity(w.id,E)}else await o.updateLead(w.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await o.addActivity(w.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await o.fetchLeadById(w.id)}catch(x){console.error("Failed to reopen lead:",x)}}function M(){const w=t();w&&w.opportunityId&&c.push({path:`/tasks/${w.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:u,handleValidated:r,handleQualified:g,handleCallAttemptLogged:d,handleNoteSaved:l,handleOpenPurchaseMethod:i,handleOpenTradeIn:m,handleAppointmentScheduled:h,handleDisqualified:k,handleReopen:q,viewOpportunity:M}}const nn={class:"p-5 space-y-6"},ht={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(v,s)=>t.task?(y(),C("div",{key:0,class:z(["bg-white border border-gray-200 rounded-xl shadow-sm",t.containerClass])},[s[0]||(s[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Manage next steps")])],-1)),se(v.$slots,"deadline-banner"),e("div",nn,[se(v.$slots,"primary-action"),se(v.$slots,"task-widgets"),se(v.$slots,"closed-state"),se(v.$slots,"secondary-actions")])],2)):O("",!0)}},on={class:"flex justify-between items-start mb-3"},ln={class:"font-bold text-gray-900 text-sm"},an={class:"text-xs text-gray-500 mt-0.5"},rn={class:"flex gap-3 flex-wrap"},xt={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(v,s)=>(y(),C("div",{class:z(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",on,[e("div",null,[e("h4",ln,N(t.action.title),1),e("p",an,N(t.action.description),1)])]),e("div",rn,[e("button",{onClick:s[0]||(s[0]=c=>v.$emit("action-clicked")),class:z([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:z(t.action.icon)},null,2),W(" "+N(t.action.label),1)],2)])],2))}},dn={class:"flex items-center gap-3"},un={class:"flex-1"},cn={key:0,class:"text-xs font-normal opacity-75"},pn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:v}){const s=t,c=v,o=I(!1),a=D(()=>ut(s.nextActionDue)),u=D(()=>s.isClosed||!s.showDeadlineBanner||o.value?!1:a.value.type==="overdue"||a.value.type==="urgent"),r=()=>{o.value=!0,c("dismissed")};return(g,d)=>u.value?(y(),C("div",{key:0,class:z(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[a.value.bgClass,a.value.borderClass]])},[e("div",dn,[e("div",{class:z(["w-9 h-9 rounded-lg flex items-center justify-center",[a.value.bgClass,a.value.borderClass,"border"]])},[e("i",{class:z(["text-base",[`fa-solid ${a.value.icon}`,a.value.textClass]])},null,2)],2),e("div",un,[d[0]||(d[0]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:z(["text-sm font-bold",a.value.textClass])},[W(N(n(ct)(t.nextActionDue))+" ",1),a.value.type!=="overdue"?(y(),C("span",cn," ("+N(n(pt)(t.nextActionDue))+") ",1)):O("",!0)],2)]),a.value.type==="overdue"?(y(),C("div",{key:0,class:z(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[a.value.bgClass,a.value.textClass,a.value.borderClass,"border"]])},[...d[1]||(d[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),W(" Overdue ",-1)])],2)):a.value.type==="urgent"?(y(),C("div",{key:1,class:z(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[a.value.bgClass,a.value.textClass,a.value.borderClass,"border"]])},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),W(" Urgent ",-1)])],2)):O("",!0)]),e("button",{onClick:r,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):O("",!0)}},mn={class:"space-y-4"},fn={label:"Teams"},yn=["value"],vn={label:"Users"},gn=["value"],bn={key:0,class:"text-xs text-sub mt-1"},hn={key:0,class:"animate-fade-in"},xn={class:"grid grid-cols-4 gap-2"},wn=["onClick"],kn={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(t,{emit:v}){const s=t,c=v,o=Re(),a=Ke(),u=I(""),r=I(null),g=I(""),d=I(!1),l=I(""),i=D(()=>a.assignableUsers),m=D(()=>a.assignableTeams),h=D(()=>r.value&&r.value.startsWith("team-")),k=D(()=>!!(u.value&&g.value&&l.value&&r.value));Qe(()=>{var f;r.value=`user-${((f=o.currentUser)==null?void 0:f.id)||1}`}),we(()=>s.show,f=>{f||q()});const q=()=>{var f;u.value="",r.value=`user-${((f=o.currentUser)==null?void 0:f.id)||1}`,g.value="",d.value=!1,l.value=""},M=f=>{f||c("close")},w=()=>{if(!k.value)return;const f=r.value.startsWith("team-"),p=parseInt(r.value.split("-")[1]);let A={};if(f){const U=a.getTeamById(p);A={assigneeType:"team",teamId:p,team:(U==null?void 0:U.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const U=a.getUserById(p);A={assigneeType:"user",assigneeId:p,assignee:(U==null?void 0:U.name)||"Unknown",teamId:null,team:null}}c("confirm",{type:u.value,date:g.value,time:l.value,...A}),c("close")},x=()=>{c("close")};return(f,p)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":M},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...p[4]||(p[4]=[W("Schedule Appointment",-1)])]),_:1}),S(n(We),null,{default:$(()=>[...p[5]||(p[5]=[W("Book an appointment with the customer",-1)])]),_:1})]),_:1}),e("div",mn,[e("div",null,[p[7]||(p[7]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Appointment Type",-1)),Q(e("select",{"onUpdate:modelValue":p[0]||(p[0]=A=>u.value=A),class:"input"},[...p[6]||(p[6]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[be,u.value]])]),e("div",null,[p[9]||(p[9]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Assign to",-1)),Q(e("select",{"onUpdate:modelValue":p[1]||(p[1]=A=>r.value=A),class:"input"},[e("optgroup",fn,[(y(!0),C(re,null,fe(m.value,A=>(y(),C("option",{key:`team-${A.id}`,value:`team-${A.id}`},N(A.name)+" Team ",9,yn))),128))]),e("optgroup",vn,[(y(!0),C(re,null,fe(i.value,A=>{var U;return y(),C("option",{key:`user-${A.id}`,value:`user-${A.id}`},N(A.name)+N(A.id===((U=n(o).currentUser)==null?void 0:U.id)?" (Me)":""),9,gn)}),128))])],512),[[be,r.value]]),h.value?(y(),C("p",bn,[...p[8]||(p[8]=[e("i",{class:"fa-solid fa-users text-sub"},null,-1),W(" Any available team member will be assigned ",-1)])])):O("",!0)]),e("div",null,[p[10]||(p[10]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Select Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":p[2]||(p[2]=A=>g.value=A),onChange:p[3]||(p[3]=A=>d.value=!0),class:"input"},null,544),[[ie,g.value]])]),d.value?(y(),C("div",hn,[p[11]||(p[11]=e("label",{class:"block text-xs font-medium text-sub mb-2"},"Available Slots",-1)),e("div",xn,[(y(),C(re,null,fe(["09:00","10:30","11:00","14:30","15:00","16:30"],A=>e("button",{key:A,onClick:U=>l.value=A,class:z(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",l.value===A?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},N(A),11,wn)),64))])])):O("",!0)]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x}),S(n(P),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!k.value,onClick:w},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Cn={class:"bg-surface border border rounded-lg p-4 animate-fade-in"},Sn={key:0,class:"flex justify-between items-center mb-4"},$n={class:"font-semibold text-heading text-sm"},An={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(v,s)=>(y(),C("div",Cn,[t.title?(y(),C("div",Sn,[e("h5",$n,N(t.title),1),t.showClose?(y(),j(n(P),{key:0,label:"Close",variant:"outline",size:"small",onClick:s[0]||(s[0]=c=>v.$emit("close"))})):O("",!0)])):O("",!0),se(v.$slots,"default")]))}};function Dn(){const t=It(),v=I(!1),s=I(!1),c=I(0),o=I(""),a=I(null),u=I({}),r=I(null),g={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},d=D(()=>{const q=Math.floor(c.value/60),M=c.value%60;return`${q.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`}),l=()=>{v.value=!0,c.value=0,s.value=!1,o.value="",a.value=setInterval(()=>{c.value++,c.value>=20&&i()},1e3)},i=()=>{a.value&&(clearInterval(a.value),a.value=null),v.value=!1,s.value=!0,u.value={duration:c.value,notes:o.value,transcription:g,channel:"phone"}},m=async q=>{try{await navigator.clipboard.writeText(q),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},h=q=>(r.value={tradeIn:g.leadLines.some(M=>M.toLowerCase().includes("trade")||M.toLowerCase().includes("exchange"))||!1,financing:g.leadLines.some(M=>M.toLowerCase().includes("financ")||M.toLowerCase().includes("payment")||M.toLowerCase().includes("loan"))||!1},r.value.tradeIn&&q&&(q.value.tradeIn=!0),r.value.financing&&q&&(q.value.financing=!0),r.value),k=()=>{v.value=!1,s.value=!1,c.value=0,o.value="",u.value={},a.value&&(clearInterval(a.value),a.value=null)};return Ot(()=>{a.value&&clearInterval(a.value)}),{isCallActive:v,callEnded:s,callDuration:c,callNotes:o,callData:u,extractedData:r,mockTranscription:g,formattedCallDuration:d,startCall:l,endCall:i,copyNumber:m,extractInformation:h,resetCall:k}}function Tn(t,v,s,c,o,a){var ce,he,xe;const u=I(!1),r=I(null),g=I(!1),d=I(null),l=I(!1),i=I(!1),m=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],h=I("whatsapp"),k=I("followup-1"),q=I("custom"),M=I(""),w=I("09:00"),x=I("Not Interested"),f=I(""),p=I({dealership:((he=(ce=t.value)==null?void 0:ce.requestedCar)==null?void 0:he.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((xe=a==null?void 0:a.value)==null?void 0:xe.id)||null}),A=I({tradeIn:!1,financing:!1,contactAvailability:!1}),U=D(()=>{var pe,ve,ge,de,oe,B,V;const _=((ge=(ve=(pe=t.value)==null?void 0:pe.customer)==null?void 0:ve.name)==null?void 0:ge.split(" ")[0])||"",ee=((oe=(de=t.value)==null?void 0:de.requestedCar)==null?void 0:oe.brand)||"",ae=((V=(B=t.value)==null?void 0:B.requestedCar)==null?void 0:V.model)||"";return{"followup-1":`Hi ${_}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${ee} ${ae}?`,"followup-2":`Hello ${_}, this is regarding your inquiry about the ${ee} ${ae}. Please let me know when you're available for a call.`,custom:""}}),E=D(()=>k.value==="custom"?"Type your custom message...":U.value[k.value]||""),X=D(()=>{var _;return!!((_=t.value)!=null&&_.scheduledAppointment)});return{showOutcomeSelection:u,selectedOutcome:r,appointmentScheduled:g,scheduledAppointmentData:d,showNoteModal:l,showScheduleAppointmentModal:i,followupChannels:m,followupChannel:h,selectedTemplate:k,rescheduleTime:q,customDate:M,customTime:w,disqualifyCategory:x,disqualifyReason:f,assignment:p,preferences:A,messageTemplates:U,messagePreview:E,hasExistingAppointment:X,selectOutcome:_=>{r.value=_,_==="interested"&&(s!=null&&s.value)&&(A.value.tradeIn=s.value.tradeIn||!1,A.value.financing=s.value.financing||!1)},cancelOutcome:()=>{r.value=null,u.value=!1,g.value=!1,d.value=null},calculateNextCallDate:()=>{if(q.value==="tomorrow-9am"){const ee=new Date;return ee.setDate(ee.getDate()+1),ee.setHours(9,0,0,0),ee.toISOString()}else if(q.value==="monday"){const ee=new Date,ae=(8-ee.getDay())%7||7;return ee.setDate(ee.getDate()+ae),ee.setHours(9,0,0,0),ee.toISOString()}else if(q.value==="custom"&&M.value&&w.value)return new Date(`${M.value}T${w.value}:00`).toISOString();const _=new Date;return _.setDate(_.getDate()+1),_.setHours(9,0,0,0),_.toISOString()},resetOutcomeState:()=>{r.value=null,u.value=!1,g.value=!1,d.value=null,h.value="whatsapp",k.value="followup-1",q.value="custom",M.value="",w.value="09:00",x.value="Not Interested",f.value=""}}}function In(t,v,s,c,o,a){const{callData:u}=v,{showOutcomeSelection:r,selectedOutcome:g,appointmentScheduled:d,scheduledAppointmentData:l,assignment:i,preferences:m,cancelOutcome:h,calculateNextCallDate:k,showScheduleAppointmentModal:q}=s;return{logManualCall:()=>{u.value={channel:"external",notes:"",transcription:null},r.value=!0},handleScheduleAppointmentConfirm:async E=>{l.value=E,d.value=!0,q.value=!1,t("appointment-scheduled",E)},handleQualify:()=>{var X,ne,le;const E={timestamp:new Date().toISOString(),outcome:"interested",channel:((X=u.value)==null?void 0:X.channel)||"phone",notes:((ne=u.value)==null?void 0:ne.notes)||"",transcription:((le=u.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",E),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:i.value,preferences:m.value,scheduleAppointment:d.value,appointmentData:l.value}),h()},handleDisqualifyFromInterested:()=>{var X,ne,le;const E={timestamp:new Date().toISOString(),outcome:"interested",channel:((X=u.value)==null?void 0:X.channel)||"phone",notes:((ne=u.value)==null?void 0:ne.notes)||"",transcription:((le=u.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",E),g.value="not-valid"},handleNoAnswerConfirm:async()=>{var ye,Y,ce;const E={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((ye=u.value)==null?void 0:ye.channel)||"phone",notes:((Y=u.value)==null?void 0:Y.notes)||"",transcription:((ce=u.value)==null?void 0:ce.transcription)||null};t("call-attempt-logged",E);const X=k(),ne=X.split("T")[0],le=new Date(X).toTimeString().slice(0,5);t("postponed",{date:ne,time:le,createAppointment:!0}),(o==null?void 0:o.value)+1>=(a==null?void 0:a.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),h()},handleNotValidConfirm:()=>{var X,ne,le;const E={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((X=u.value)==null?void 0:X.channel)||"phone",notes:((ne=u.value)==null?void 0:ne.notes)||"",transcription:((le=u.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",E),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),h()},handleNoteSave:E=>{s.showNoteModal.value=!1,t("note-saved",E)}}}const On={key:0,class:"flex gap-2 items-center mb-4"},Nn=["disabled"],qn=["disabled"],Ln={key:1,class:"mb-4 space-y-4 border-t border pt-4"},Mn={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Fn={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Vn={class:"flex items-center gap-2 text-red-400"},Un={class:"text-xs font-mono"},Rn={class:"space-y-3 text-sm font-mono"},Bn={class:"ml-2"},jn={class:"ml-2"},Wn={key:0},zn={class:"ml-2"},Hn={key:1},En={class:"ml-2"},Pn={key:2},Qn={class:"ml-2"},Yn={class:"mt-4 pt-4 border-t border-slate-700"},Kn=["model-value"],Gn={class:"mt-4 flex justify-end"},Jn={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Xn={class:"flex items-center justify-between"},Zn={class:"flex gap-2"},_n={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(v,s)=>(y(),C("div",null,[!t.showOutcomeSelection&&!t.isCallActive&&!t.callEnded?(y(),C("div",On,[e("button",{disabled:t.isCallActive,onClick:s[0]||(s[0]=c=>v.$emit("start-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),W(" "+N(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],8,Nn),e("button",{disabled:t.isCallActive,onClick:s[1]||(s[1]=c=>v.$emit("log-manual-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),W(" Log Call Outcome ",-1)])],8,qn)])):O("",!0),t.isCallActive||t.callEnded?(y(),C("div",Ln,[t.isCallActive?(y(),C("div",Mn,[e("div",Fn,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Vn,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Un,"REC "+N(t.formattedCallDuration),1)])]),e("div",Rn,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Bn,N(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",jn,N(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(y(),C("div",Wn,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",zn,N(t.mockTranscription.leadLines[1]),1)])):O("",!0),t.callDuration>=8?(y(),C("div",Hn,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",En,N(t.mockTranscription.salesLines[1]),1)])):O("",!0),t.callDuration>=12?(y(),C("div",Pn,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Qn,N(t.mockTranscription.leadLines[2]),1)])):O("",!0)]),e("div",Yn,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=c=>v.$emit("update:call-notes",c)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Kn)]),e("div",Gn,[S(n(P),{label:"End Call",variant:"primary",size:"small",onClick:s[3]||(s[3]=c=>v.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):O("",!0),t.callEnded&&!t.isCallActive?(y(),C("div",Jn,[e("div",Xn,[s[15]||(s[15]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",Zn,[S(n(P),{label:"Extract information",variant:"primary",size:"small",onClick:s[4]||(s[4]=c=>v.$emit("extract-information")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Log outcome",variant:"outline",size:"small",onClick:s[5]||(s[5]=c=>v.$emit("log-manual-call"))})])])])):O("",!0)])):O("",!0)]))}},eo={class:"bg-surfaceSecondary/50 border border rounded-lg p-6 relative transition-all duration-300"},to={class:"flex justify-between items-start mb-3"},so={class:"font-bold text-heading text-content"},no={class:"text-meta mt-0.5"},oo={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},lo={class:"text-meta text-blue-700"},ao={key:1,class:"mb-3 bg-surfaceSecondary border border rounded-lg p-3"},io={class:"flex items-center justify-between"},ro={class:"flex items-center gap-2"},uo={class:"text-meta-bold text-heading"},co={key:0,class:"text-meta text-orange-600 font-medium flex items-center gap-1"},po={class:"flex items-center gap-2 mb-3"},mo={class:"text-content text-body font-medium"},fo={key:2,class:"mt-4 space-y-4 border-t border pt-4"},yo={class:"grid grid-cols-3 gap-2"},vo={key:0,class:"space-y-4 bg-surface border border rounded-lg p-6"},go={class:"grid grid-cols-4 gap-2"},bo=["onClick"],ho={key:0,class:"fa-brands fa-whatsapp text-xs"},xo={key:1,class:"fa-solid fa-message text-xs"},wo={key:2,class:"fa-solid fa-envelope text-xs"},ko={key:3,class:"fa-solid fa-xmark text-xs"},Co={key:0},So={class:"mt-2 p-3 bg-surfaceSecondary border border rounded-lg"},$o={class:"text-meta text-body"},Ao={class:"grid grid-cols-3 gap-2"},Do={key:0,class:"mt-3 grid grid-cols-2 gap-3"},To={class:"flex justify-end gap-2 pt-3 border-t border"},Io={key:1,class:"space-y-4 bg-surface border border rounded-lg p-6"},Oo={class:"flex gap-4"},No={class:"flex items-center gap-2 cursor-pointer"},qo={class:"flex items-center gap-2 cursor-pointer"},Lo={class:"flex justify-end gap-2 pt-3 border-t border"},Mo={key:2,class:"space-y-4"},Fo={class:"bg-surface border border rounded-lg p-6"},Vo={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Uo=["value"],Ro=["value"],Bo=["value"],jo={class:"bg-surface border border rounded-lg p-6"},Wo={class:"flex gap-2"},zo={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Ho={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Eo={class:"ml-2 font-medium text-heading"},Po={class:"ml-2 font-medium text-heading"},Qo={class:"ml-2 font-medium text-heading capitalize"},Yo={class:"ml-2 font-medium text-heading"},Ko={key:1,class:"bg-surface border border rounded-lg p-6"},Go={class:"space-y-2"},Jo=["checked"],Xo=["checked","disabled"],Zo={class:"flex-1"},_o={class:"text-xs text-gray-500 mt-0.5"},el={class:"space-y-3"},tl={class:"grid grid-cols-2 gap-3 text-sm"},sl={class:"ml-2 font-medium text-heading"},nl={class:"ml-2 font-medium text-heading"},ol={class:"ml-2 font-medium text-heading capitalize"},ll={class:"ml-2 font-medium text-heading"},al={key:0,class:"text-sm"},il={class:"ml-2 font-medium text-heading"},rl={key:1,class:"text-sm"},dl={class:"mt-1 text-body"},ul={class:"flex justify-between items-center pt-3 border-t border"},cl={class:"flex gap-2"},pl={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:v}){const s=t,c=ue=>{ue||(V.value=!1)},o=v,a=Ke(),u=Re();Se();const r=bt(()=>s.lead,{}),g=Dn(),{isCallActive:d,callEnded:l,callDuration:i,callNotes:m,callData:h,extractedData:k,mockTranscription:q,formattedCallDuration:M,startCall:w,endCall:x,copyNumber:f,extractInformation:p}=g,A=I(null),U=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],E=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],X=D(()=>a.assignableUsers),ne=D(()=>u.currentUser),le=()=>{w()},ye=()=>{f(s.lead.customer.phone)},Y=ue=>{m.value=ue},ce=D(()=>{var ue;return((ue=r.primaryAction.value)==null?void 0:ue.title)||"Call to Verify Contact Details"}),he=D(()=>{var ue;return((ue=r.primaryAction.value)==null?void 0:ue.description)||"Begin lead qualification by verifying customer contact information."}),xe=D(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),_=D(()=>!!s.lead.scheduledAppointment),ee=D(()=>_.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:xe.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${pt(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),ae=r.contactAttempts,pe=r.maxContactAttempts,ve=Tn(Ve(s,"lead"),h,k,ae,pe,ne),{showOutcomeSelection:ge,selectedOutcome:de,appointmentScheduled:oe,scheduledAppointmentData:B,showNoteModal:V,showScheduleAppointmentModal:K,followupChannels:Ge,followupChannel:qe,selectedTemplate:T,rescheduleTime:R,customDate:Z,customTime:te,disqualifyCategory:L,disqualifyReason:H,assignment:G,messagePreview:me,hasExistingAppointment:Le,selectOutcome:Je,cancelOutcome:Xe}=ve;D(()=>s.activities.filter(ue=>ue.type==="note"));const wt=In(o,g,ve,Ve(s,"lead"),ae,pe),{logManualCall:kt,handleScheduleAppointmentConfirm:Ct,handleQualify:St,handleDisqualifyFromInterested:$t,handleNoAnswerConfirm:At,handleNotValidConfirm:Dt,handleNoteSave:Tt}=wt;return(ue,b)=>(y(),C("div",eo,[e("div",to,[e("div",null,[e("h4",so,N(ce.value),1),e("p",no,N(he.value),1)]),e("div",{class:z(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",ee.value.class])},N(ee.value.text),3)]),_.value?(y(),C("div",oo,[b[25]||(b[25]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-meta-bold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",lo,N(n(Ue)(t.lead.scheduledAppointment.start))+" at "+N(n(Be)(t.lead.scheduledAppointment.start)),1)])):O("",!0),n(ae)>0?(y(),C("div",ao,[e("div",io,[e("div",ro,[b[26]||(b[26]=e("i",{class:"fa-solid fa-phone text-body text-xs"},null,-1)),b[27]||(b[27]=e("span",{class:"text-meta-bold text-body"},"Contact Attempts:",-1)),e("span",uo,N(n(ae))+" / "+N(n(pe)),1)]),n(ae)>=n(pe)-1?(y(),C("div",co,[...b[28]||(b[28]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),W(" One more attempt before auto-disqualification ",-1)])])):O("",!0)])])):O("",!0),e("div",po,[e("span",mo,N(t.lead.customer.phone),1),e("button",{onClick:ye,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-[21.6px] h-[21.6px]",title:"Copy phone number"},[...b[29]||(b[29]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),S(_n,{"is-call-active":n(d),"call-ended":n(l),"call-duration":n(i),"call-notes":n(m),"formatted-call-duration":n(M),"mock-transcription":n(q),"show-outcome-selection":n(ge),"contact-attempts":n(ae),"max-contact-attempts":n(pe),onStartCall:le,onEndCall:n(x),onLogManualCall:n(kt),onExtractInformation:n(p),"onUpdate:callNotes":Y,onCopyNumber:ye},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),n(ge)?(y(),C("div",fo,[e("div",null,[b[33]||(b[33]=e("h4",{class:"font-semibold text-heading mb-2 text-content"},"What's the outcome?",-1)),e("div",yo,[e("button",{onClick:b[0]||(b[0]=F=>n(Je)("no-answer")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(de)==="no-answer"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[30]||(b[30]=[e("i",{class:"fa-solid fa-phone-slash text-sm"},null,-1),e("span",null,"No answer",-1)])],2),e("button",{onClick:b[1]||(b[1]=F=>n(Je)("not-valid")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(de)==="not-valid"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[31]||(b[31]=[e("i",{class:"fa-solid fa-ban text-sm"},null,-1),e("span",null,"Not valid",-1)])],2),e("button",{onClick:b[2]||(b[2]=F=>n(Je)("interested")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(de)==="interested"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[32]||(b[32]=[e("i",{class:"fa-solid fa-check-circle text-sm"},null,-1),e("span",null,"Interested",-1)])],2)])]),n(de)==="no-answer"?(y(),C("div",vo,[b[40]||(b[40]=e("h5",{class:"font-semibold text-heading text-content"},"Send follow-up message",-1)),e("div",go,[(y(!0),C(re,null,fe(n(Ge),F=>(y(),C("button",{key:F.value,onClick:()=>{n(qe).value=F.value},class:z(["bg-surface border-2 rounded-lg h-10 flex items-center justify-center gap-2 text-sm font-medium transition-all",n(qe).value===F.value?"border-primary-700 bg-primary-50 text-primary-700":"border text-body hover:border-primary-300 hover:bg-primary-50/50"])},[F.value==="whatsapp"?(y(),C("i",ho)):F.value==="sms"?(y(),C("i",xo)):F.value==="email"?(y(),C("i",wo)):F.value==="dont-send"?(y(),C("i",ko)):O("",!0),e("span",null,N(F.label),1)],10,bo))),128))]),n(qe)&&n(qe)!=="dont-send"?(y(),C("div",Co,[b[36]||(b[36]=e("label",{class:"block text-meta-bold mb-1.5"},"Template",-1)),Q(e("select",{"onUpdate:modelValue":b[3]||(b[3]=F=>Me(T)?T.value=F:null),class:"input"},[...b[34]||(b[34]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[be,n(T)]]),e("div",So,[b[35]||(b[35]=e("p",{class:"text-meta-bold mb-1 uppercase"},"Message preview",-1)),e("p",$o,N(n(me)),1)])])):O("",!0),e("div",null,[b[39]||(b[39]=e("h5",{class:"font-semibold text-heading text-content mb-2"},"Next call attempt",-1)),e("div",Ao,[e("button",{onClick:b[4]||(b[4]=F=>R.value="tomorrow-9am"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(R)==="tomorrow-9am"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:b[5]||(b[5]=F=>R.value="monday"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(R)==="monday"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Monday ",2),e("button",{onClick:b[6]||(b[6]=F=>R.value="custom"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(R)==="custom"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Select time ",2)]),n(R)==="custom"?(y(),C("div",Do,[e("div",null,[b[37]||(b[37]=e("label",{class:"block text-meta-bold mb-1.5"},"Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":b[7]||(b[7]=F=>Me(Z)?Z.value=F:null),class:"input"},null,512),[[ie,n(Z)]])]),e("div",null,[b[38]||(b[38]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Time",-1)),Q(e("input",{type:"time","onUpdate:modelValue":b[8]||(b[8]=F=>Me(te)?te.value=F:null),class:"input"},null,512),[[ie,n(te)]])])])):O("",!0)]),e("div",To,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(Xe)},null,8,["onClick"]),S(n(P),{label:"Send and reschedule",variant:"primary",size:"small",onClick:n(At),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])):O("",!0),n(de)==="not-valid"?(y(),C("div",Io,[e("div",null,[b[43]||(b[43]=e("label",{class:"block text-meta-bold mb-2"},"Category",-1)),e("div",Oo,[e("label",No,[Q(e("input",{type:"radio","onUpdate:modelValue":b[9]||(b[9]=F=>Me(L)?L.value=F:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Ze,n(L)]]),b[41]||(b[41]=e("span",{class:"text-content text-body"},"Not Valid",-1))]),e("label",qo,[Q(e("input",{type:"radio","onUpdate:modelValue":b[10]||(b[10]=F=>Me(L)?L.value=F:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Ze,n(L)]]),b[42]||(b[42]=e("span",{class:"text-sm text-body"},"Not Interested",-1))])])]),e("div",null,[b[45]||(b[45]=e("label",{class:"block text-xs font-medium text-body mb-2"},"Failure Reason",-1)),Q(e("select",{"onUpdate:modelValue":b[11]||(b[11]=F=>Me(H)?H.value=F:null),class:"w-full bg-surface border-2 border-red-500 rounded-lg px-3 py-2 text-content text-body focus:outline-none focus:border-red-600"},[...b[44]||(b[44]=[Ee('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[be,n(H)]])]),e("div",Lo,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(Xe)},null,8,["onClick"]),S(n(P),{label:"Confirm Disqualification",variant:"primary",size:"small",disabled:!n(L)||!n(H),onClick:n(Dt),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"},null,8,["disabled","onClick"])])])):O("",!0),n(de)==="interested"?(y(),C("div",Mo,[e("div",Fo,[b[49]||(b[49]=e("h5",{class:"font-semibold text-heading text-content mb-3"},"Assign to salesman",-1)),e("div",Vo,[e("div",null,[b[46]||(b[46]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Dealership",-1)),Q(e("select",{"onUpdate:modelValue":b[12]||(b[12]=F=>n(G).dealership=F),class:"input"},[(y(),C(re,null,fe(U,F=>e("option",{key:F,value:F},N(F),9,Uo)),64))],512),[[be,n(G).dealership]])]),e("div",null,[b[47]||(b[47]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Team",-1)),Q(e("select",{"onUpdate:modelValue":b[13]||(b[13]=F=>n(G).team=F),class:"input"},[(y(),C(re,null,fe(E,F=>e("option",{key:F,value:F},N(F),9,Ro)),64))],512),[[be,n(G).team]])]),e("div",null,[b[48]||(b[48]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Assignee",-1)),Q(e("select",{"onUpdate:modelValue":b[14]||(b[14]=F=>n(G).assigneeId=F),class:"input"},[(y(!0),C(re,null,fe(X.value,F=>(y(),C("option",{key:F.id,value:F.id},N(F.name)+N(F.id===ne.value.id?" (Me)":""),9,Bo))),128))],512),[[be,n(G).assigneeId]])])])]),e("div",jo,[b[50]||(b[50]=e("h5",{class:"font-semibold text-heading text-content mb-3"},"Customer preferences",-1)),e("div",Wo,[S(n(P),{label:"Add purchase method",variant:"primary",size:"small",onClick:b[15]||(b[15]=F=>o("open-purchase-method")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Add trade-in",variant:"primary",size:"small",onClick:b[16]||(b[16]=F=>o("open-trade-in")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Add note",variant:"primary",size:"small",onClick:b[17]||(b[17]=F=>V.value=!0),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"})])]),n(Le)&&!n(oe)?(y(),C("div",zo,[b[55]||(b[55]=Ee('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="heading-sub">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Ho,[e("div",null,[b[51]||(b[51]=e("span",{class:"text-body"},"Date:",-1)),e("span",Eo,N(n(Ue)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[b[52]||(b[52]=e("span",{class:"text-body"},"Time:",-1)),e("span",Po,N(n(Be)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[b[53]||(b[53]=e("span",{class:"text-body"},"Type:",-1)),e("span",Qo,N(t.lead.scheduledAppointment.type),1)]),e("div",null,[b[54]||(b[54]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Yo,N(t.lead.scheduledAppointment.assignee),1)])]),S(n(P),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:b[18]||(b[18]=F=>K.value=!0)})])):O("",!0),n(Le)?O("",!0):(y(),C("div",Ko,[b[58]||(b[58]=e("h5",{class:"text-xs font-semibold text-body mb-3"},"Choose Next Step",-1)),e("div",Go,[e("label",{class:z(["flex items-start gap-3 p-3 border border rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!n(oe)}])},[e("input",{type:"radio",checked:!n(oe),onChange:b[19]||(b[19]=()=>{oe.value=!1,B.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Jo),b[56]||(b[56]=e("div",{class:"flex-1"},[e("div",{class:"heading-sub"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:z(["flex items-start gap-3 p-3 border border rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":n(oe)}]),onClick:b[21]||(b[21]=F=>!n(oe)&&(K.value=!0))},[e("input",{type:"radio",checked:n(oe),disabled:!n(oe),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Xo),e("div",Zo,[b[57]||(b[57]=e("div",{class:"heading-sub"},"Schedule Appointment",-1)),e("div",_o,N(n(oe)?"Appointment scheduled":"Book a meeting or test drive"),1)]),n(oe)?(y(),j(n(P),{key:0,label:"Reschedule",variant:"primary",size:"small",onClick:b[20]||(b[20]=Pe(F=>K.value=!0,["stop","prevent"])),class:"text-xs !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"})):O("",!0)],2)])])),n(oe)?(y(),j(An,{key:2,title:"Scheduled Appointment","show-close":!1},{default:$(()=>[e("div",el,[e("div",tl,[e("div",null,[b[59]||(b[59]=e("span",{class:"text-body"},"Date:",-1)),e("span",sl,N(n(Ue)(n(B).datetime)),1)]),e("div",null,[b[60]||(b[60]=e("span",{class:"text-body"},"Time:",-1)),e("span",nl,N(n(B).time),1)]),e("div",null,[b[61]||(b[61]=e("span",{class:"text-body"},"Type:",-1)),e("span",ol,N(n(B).type),1)]),e("div",null,[b[62]||(b[62]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",ll,N(n(B).assignee),1)])]),n(B).location?(y(),C("div",al,[b[63]||(b[63]=e("span",{class:"text-body"},"Location:",-1)),e("span",il,N(n(B).location),1)])):O("",!0),n(B).notes?(y(),C("div",rl,[b[64]||(b[64]=e("span",{class:"text-body"},"Notes:",-1)),e("p",dl,N(n(B).notes),1)])):O("",!0)])]),_:1})):O("",!0),e("div",ul,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(Xe)},null,8,["onClick"]),e("div",cl,[S(n(P),{label:"Disqualify",variant:"outline",size:"small",onClick:n($t)},null,8,["onClick"]),S(n(P),{label:"Qualify",variant:"primary",size:"small",onClick:n(St),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"},null,8,["onClick"])])])])):O("",!0)])):O("",!0),S(n(Ne),{open:n(V),"onUpdate:open":c},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-2xl"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...b[65]||(b[65]=[W("Add Note",-1)])]),_:1})]),_:1}),S(Ht,{ref_key:"noteWidgetRef",ref:A,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(Tt),onCancel:b[22]||(b[22]=F=>V.value=!1)},null,8,["task-id","onSave"]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>{var F,nt;return[S(n(P),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[23]||(b[23]=Qa=>V.value=!1)},{default:$(()=>[...b[66]||(b[66]=[W(" Cancel ",-1)])]),_:1}),S(n(P),{variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!((F=A.value)!=null&&F.canSubmit()),onClick:(nt=A.value)==null?void 0:nt.submit},{default:$(()=>[...b[67]||(b[67]=[W(" Save Note ",-1)])]),_:1},8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),S(kn,{show:n(K),onConfirm:n(Ct),onClose:b[24]||(b[24]=F=>K.value=!1)},null,8,["show","onConfirm"])]))}},ml={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},fl={class:"flex justify-between items-start mb-3"},yl={class:"text-xs text-gray-500 mt-0.5"},vl={key:0},gl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:v}){const s=t,c=v,o=je(),a=()=>{var f;const x=o.currentLead;return x&&x.id===((f=s.lead)==null?void 0:f.id)?x:s.lead},u={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},r=bt(Ve(s,"lead"),u),{handlePostponed:g,handleValidated:d,handleQualified:l,handleCallAttemptLogged:i,handleNoteSaved:m,handleOpenPurchaseMethod:h,handleOpenTradeIn:k,handleAppointmentScheduled:q,handleDisqualified:M,handleReopen:w}=sn({getLead:a,leadState:r,emit:c});return(x,f)=>(y(),j(ht,{task:t.lead},{"deadline-banner":$(()=>[S(pn,{"next-action-due":t.lead.nextActionDue,"is-closed":n(r).isClosed.value,"show-deadline-banner":n(r).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":$(()=>[!n(r).isClosed.value&&n(r).showLQWidget.value?(y(),j(pl,{key:t.lead.id,lead:t.lead,onPostponed:n(g),onValidated:n(d),onQualified:n(l),onDisqualified:n(M),onCallAttemptLogged:n(i),onNoteSaved:n(m),onOpenPurchaseMethod:n(h),onOpenTradeIn:n(k),onAppointmentScheduled:n(q)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(r).isClosed.value&&n(r).primaryAction.value?(y(),j(xt,{key:1,action:n(r).primaryAction.value,"color-scheme":n(r).primaryAction.value.colorScheme,onActionClicked:n(r).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):O("",!0)]),"task-widgets":$(()=>[...f[0]||(f[0]=[])]),"closed-state":$(()=>[n(r).isClosed.value?(y(),C("div",ml,[e("div",fl,[e("div",null,[f[1]||(f[1]=e("h4",{class:"font-bold text-gray-900 text-sm"},"Lead Closed",-1)),e("p",yl,[W(" Status: "+N(n(r).displayStage.value)+" ",1),t.lead.disqualifyReason?(y(),C("span",vl," - "+N(t.lead.disqualifyReason),1)):O("",!0)])])]),S(n(P),{variant:"primary",size:"small",onClick:n(w),class:"flex items-center gap-2"},{default:$(()=>[...f[2]||(f[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):O("",!0)]),_:1},8,["task"]))}},bl={class:"flex justify-between items-start mb-3"},hl={class:"font-bold text-gray-900 text-sm"},xl={class:"text-xs text-gray-500 mt-0.5"},wl={class:"flex gap-3 flex-wrap"},ke={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(v,s)=>(y(),C("div",{class:z(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",bl,[e("div",null,[e("h4",hl,N(t.title),1),e("p",xl,N(t.description),1)]),se(v.$slots,"badge")]),e("div",wl,[se(v.$slots,"actions")]),se(v.$slots,"survey"),se(v.$slots,"content")],2))}},kl={class:"mt-1.5 border-t border pt-1.5"},Cl={key:1},Sl={class:"flex items-center justify-between mb-1.5"},$l={class:"space-y-1.5"},Al={class:"block label-upper mb-1"},Dl=["onUpdate:modelValue","placeholder"],Tl=["onUpdate:modelValue"],Il=["value"],Ol={key:2,class:"space-y-0.5"},Nl=["onUpdate:modelValue","value"],Ce={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=I(!1),a=I({});we(()=>s.questions,l=>{const i={};l.forEach(m=>{i[m.key]=""}),a.value=i},{immediate:!0});const u=()=>{c("survey-completed",{...a.value}),d()},r=()=>{c("survey-refused"),d()},g=()=>{c("not-responding"),d()},d=()=>{o.value=!1;const l={};s.questions.forEach(i=>{l[i.key]=""}),a.value=l};return(l,i)=>(y(),C("div",kl,[o.value?(y(),C("div",Cl,[e("div",Sl,[i[4]||(i[4]=e("h5",{class:"text-xs font-semibold text-body"},"Survey / Feedback",-1)),e("button",{onClick:i[1]||(i[1]=m=>o.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-chevron-up text-xs"},null,-1)])])]),e("div",$l,[(y(!0),C(re,null,fe(t.questions,(m,h)=>(y(),C("div",{key:h,class:"bg-surfaceSecondary rounded-md p-1.5"},[e("label",Al,N(m.label),1),m.type==="text"?Q((y(),C("textarea",{key:0,"onUpdate:modelValue":k=>a.value[m.key]=k,placeholder:m.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Dl)),[[ie,a.value[m.key]]]):m.type==="select"?Q((y(),C("select",{key:1,"onUpdate:modelValue":k=>a.value[m.key]=k,class:"input text-xs py-1 px-2"},[i[5]||(i[5]=e("option",{value:""},"Select an option...",-1)),(y(!0),C(re,null,fe(m.options,k=>(y(),C("option",{key:k,value:k},N(k),9,Il))),128))],8,Tl)),[[be,a.value[m.key]]]):m.type==="radio"?(y(),C("div",Ol,[(y(!0),C(re,null,fe(m.options,k=>(y(),C("label",{key:k,class:"flex items-center text-xs"},[Q(e("input",{type:"radio","onUpdate:modelValue":q=>a.value[m.key]=q,value:k,class:"mr-1"},null,8,Nl),[[Ze,a.value[m.key]]]),W(" "+N(k),1)]))),128))])):O("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:u,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:r,class:"bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:g,class:"bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(y(),C("button",{key:0,onClick:i[0]||(i[0]=m=>o.value=!0),class:"w-full flex items-center justify-between text-xs text-sub hover:text-body py-0.5 transition-colors"},[...i[2]||(i[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1)])]))]))}},ql={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],a=D(()=>{if(!s.opportunity.createdAt)return 0;const i=new Date(s.opportunity.createdAt),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))}),u=()=>{c("create-offer",s.opportunity)},r=()=>{c("review",s.opportunity)},g=i=>{c("survey-completed",{opportunity:s.opportunity,responses:i})},d=()=>{c("survey-refused",{opportunity:s.opportunity})},l=()=>{c("not-responding",{opportunity:s.opportunity})};return(i,m)=>(y(),j(ke,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${a.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:r,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:g,onSurveyRefused:d,onNotResponding:l})]),_:1},8,["description"]))}},Ll={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],a=D(()=>{if(!s.opportunity.createdAt)return 0;const l=new Date(s.opportunity.createdAt),m=Math.abs(new Date-l);return Math.ceil(m/(1e3*60*60*24))}),u=()=>{c("create-offer",s.opportunity)},r=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},g=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,i)=>(y(),j(ke,{title:"Unsold Feedback",description:`This opportunity has been open for ${a.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:g,onNotResponding:d})]),_:1},8,["description"]))}},Ml={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],a=()=>{c("schedule-closing",s.opportunity)},u=d=>{c("survey-completed",{opportunity:s.opportunity,responses:d})},r=()=>{c("survey-refused",{opportunity:s.opportunity})},g=()=>{c("not-responding",{opportunity:s.opportunity})};return(d,l)=>(y(),j(ke,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:$(()=>[e("button",{onClick:a,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:u,onSurveyRefused:r,onNotResponding:g})]),_:1}))}},Fl={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],a=D(()=>{const l=s.opportunity.lastActivity||s.opportunity.createdAt;if(!l)return 0;const i=new Date(l),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))}),u=()=>{c("create-contract",s.opportunity)},r=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},g=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,i)=>(y(),j(ke,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${a.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:g,onNotResponding:d})]),_:1},8,["description"]))}},Vl={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],a=D(()=>{var k;if(!((k=s.opportunity)!=null&&k.contractDate))return 0;const i=new Date(s.opportunity.contractDate),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))}),u=()=>{c("prepare-delivery",s.opportunity)},r=()=>{c("pre-delivery-checklist",s.opportunity)},g=i=>{c("survey-completed",{opportunity:s.opportunity,responses:i})},d=()=>{c("survey-refused",{opportunity:s.opportunity})},l=()=>{c("not-responding",{opportunity:s.opportunity})};return(i,m)=>(y(),j(ke,{title:"Contract Feedback",description:`Contract was signed ${a.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:r,class:"bg-surface border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:g,onSurveyRefused:d,onNotResponding:l})]),_:1},8,["description"]))}},Ul={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v,o=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],a=D(()=>{const l=s.activities.find(k=>{var q;return k.type==="delivery"||((q=k.action)==null?void 0:q.toLowerCase().includes("delivered"))});if(!l||!l.timestamp)return 0;const i=new Date(l.timestamp),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))}),u=()=>{c("delivery-feedback",s.opportunity)},r=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},g=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,i)=>(y(),j(ke,{title:"Delivery Feedback",description:`Vehicle was delivered ${a.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:g,onNotResponding:d})]),_:1},8,["description"]))}},Rl={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:v}){const s=t,c=v,o=D(()=>{var k;return((k=s.scheduledAppointment)==null?void 0:k.noShowCount)||0}),a=D(()=>{const k=o.value;return k===0?"No-Show Follow-up":k>=3?`No-Show #${k} - Final Warning`:`No-Show #${k} Follow-up`}),u=D(()=>{const k=o.value;return k>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":k>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),r=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],g=D(()=>{var q;return(q=s.scheduledAppointment)!=null&&q.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),d=()=>{c("contact-customer",s.opportunity)},l=()=>{const k=o.value;if(k>=3)c("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${k} no-shows`});else if(k===1||k===2){const q=new Date;q.setDate(q.getDate()+2),c("set-callback",{opportunity:s.opportunity,callbackDate:q.toISOString()})}else c("reschedule",s.opportunity)},i=k=>{c("survey-completed",{opportunity:s.opportunity,responses:k})},m=()=>{c("survey-refused",{opportunity:s.opportunity})},h=()=>{c("not-responding",{opportunity:s.opportunity})};return(k,q)=>(y(),j(ke,{title:a.value,description:`Appointment was scheduled for ${g.value} but customer did not show up. ${u.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:$(()=>[e("button",{onClick:l,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...q[0]||(q[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),W(" Book Another Appointment ",-1)])]),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...q[1]||(q[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),W(" Contact Customer ",-1)])])]),survey:$(()=>[S(Ce,{questions:r,onSurveyCompleted:i,onSurveyRefused:m,onNotResponding:h})]),_:1},8,["title","description"]))}},Bl={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:v}){const s=t,c=v;Se();const o=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],a=D(()=>{const m=s.opportunity.lastActivity||s.opportunity.createdAt;if(!m)return 0;const h=new Date(m),q=Math.abs(new Date-h);return Math.ceil(q/(1e3*60*60*24))}),u=()=>{c("reopen",s.opportunity)},r=()=>{c("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},g=()=>{c("requalify",s.opportunity)},d=m=>{c("survey-completed",{opportunity:s.opportunity,responses:m})},l=()=>{c("survey-refused",{opportunity:s.opportunity})},i=()=>{c("not-responding",{opportunity:s.opportunity})};return(m,h)=>(y(),j(ke,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${a.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:$(()=>[e("button",{onClick:u,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...h[0]||(h[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),W(" Reopen Opportunity ",-1)])]),e("button",{onClick:r,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...h[1]||(h[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),W(" Close as Lost ",-1)])]),e("button",{onClick:g,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...h[2]||(h[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),W(" Requalify as Lead ",-1)])])]),survey:$(()=>[S(Ce,{questions:o,onSurveyCompleted:d,onSurveyRefused:l,onNotResponding:i})]),_:1},8,["description"]))}},jl={OOFB:ql,UFB:Ll,NFU:Ml,OFB:Fl,CFB:Vl,DFB:Ul,NS:Rl,ABANDONED:Bl};function Wl(t,v,s,c,o){const a=D(()=>{const m=ze(t),h=ze(v),k=ze(s);return{opportunity:m,scheduledAppointment:h,activities:k,hasOffers:(k==null?void 0:k.some(q=>q.type==="offer"))||!1,stage:m.displayStage||m.stage,deliverySubstatus:m.deliverySubstatus||null,formatDateTime:o,hasActiveTaskWidget:!1}}),u=D(()=>{const m=a.value,h=Et(m.stage,m);if(!h)return null;const k=jl[h];return k?{type:h,component:k,props:{opportunity:m.opportunity,appointment:m.scheduledAppointment,activities:m.activities}}:(console.warn(`No component found for widget type: ${h}`),null)}),r=D(()=>({...a.value,hasActiveTaskWidget:!!u.value})),g=D(()=>{const m=r.value,h=Pt(m.stage,m);if(!h)return null;const k=c[h.key];return{...h,handler:k||(()=>console.warn(`No handler for action: ${h.key}`))}}),d=D(()=>{const m=r.value;return Qt(m.stage,m).map(k=>{const q=c[k.key];return{...k,handler:q||(()=>console.warn(`No handler for action: ${k.key}`))}})}),l=D(()=>{const m=a.value;return Yt(m.stage)}),i=D(()=>!u.value||!u.value.type?"":Kt(u.value.type));return{primaryAction:g,secondaryActions:d,activeTaskWidget:u,taskWidgetTitle:i,isClosed:l}}const zl={class:"relative"},Hl=["disabled"],El={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-[9999]"},Pl={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:v}){const s=t,c=v,o=I(!1),a=()=>{o.value=!o.value},u=()=>{o.value=!1},r=d=>{d.disabled||(u(),c("action-selected",d),d.handler&&typeof d.handler=="function"&&d.handler())},g=D(()=>(s.actions||[]).map(d=>({key:d.key,label:d.label,disabled:!!d.disabled,onClick:()=>r(d)})));return(d,l)=>{const i=et("click-outside");return Q((y(),C("div",zl,[e("button",{onClick:a,class:"w-auto bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[l[0]||(l[0]=e("span",null,"More actions",-1)),e("i",{class:z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":o.value}])},null,2)],8,Hl),S(rt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:$(()=>[o.value?(y(),C("div",El,[S(n(tt),{items:g.value,className:"min-w-full"},null,8,["items"])])):O("",!0)]),_:1})])),[[i,u]])}}},Ql={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},Yl=["src","alt"],Kl={key:1,class:"w-full h-full flex items-center justify-center"},Gl={class:"flex items-center justify-between mb-1.5"},Jl={class:"text-sm font-bold text-heading"},Xl={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},Zl={class:"text-xs text-sub mb-1.5"},_l={key:0,class:"text-xs text-green-600 font-medium mb-2"},ea={key:1,class:"text-xs text-orange-600 font-medium mb-2"},lt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const v=t,s=D(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[v.badge]||"gray"),c=o=>o?o.toLocaleString("en-US"):"0";return(o,a)=>(y(),C("div",{onClick:a[1]||(a[1]=u=>o.$emit("select")),class:z(["border border rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",Ql,[t.vehicle.image?(y(),C("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Yl)):(y(),C("div",Kl,[...a[2]||(a[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",Gl,[S(n(He),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",Jl,"â‚¬"+N(c(t.vehicle.price)),1)]),e("h4",Xl,N(t.vehicle.brand)+" "+N(t.vehicle.model),1),e("p",Zl,N(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(y(),C("div",_l,[a[3]||(a[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),W(" In stock ("+N(t.stockDays)+" days) ",1)])):(y(),C("div",ea,[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),W(" Out of stock ",-1)])])),e("button",{onClick:a[0]||(a[0]=Pe(u=>o.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},ta={class:"space-y-6"},sa={key:0},na={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},oa={class:"mb-4"},la={class:"relative"},aa={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},ia={key:1,class:"text-center py-8 text-sub"},ra={class:"border border rounded-lg p-4 bg-surfaceSecondary"},da={key:0,class:"mt-4 space-y-3"},ua={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},ca={class:"flex justify-end"},pa=["disabled"],ma={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:v}){const s=t,c=v,o=f=>{f||c("close")},a=I(""),u=I(!1),r=I(null),g=I(null),d=I(null),l=I([]),i=I({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Qe(async()=>{try{const f=await ft({});l.value=f.data||[]}catch(f){console.error("Failed to load vehicles:",f),l.value=[]}});const m=D(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),h=D(()=>{const f=[];if(s.requestedVehicle&&m.value&&f.push({...s.requestedVehicle,isRequested:!0}),l.value&&l.value.length>0){const p=l.value.filter(U=>s.requestedVehicle?U.brand!==s.requestedVehicle.brand||U.model!==s.requestedVehicle.model:!0),A=s.requestedVehicle&&m.value?3:4;f.push(...p.slice(0,A))}return f}),k=D(()=>{if(!l.value||l.value.length===0)return[];let f=[...l.value];if(a.value){const p=a.value.toLowerCase();f=f.filter(A=>A.brand.toLowerCase().includes(p)||A.model.toLowerCase().includes(p)||A.year.toString().includes(p))}return f}),q=D(()=>i.value.brand&&i.value.model&&i.value.year&&i.value.price>0),M=(f,p)=>{r.value=f,g.value=f.id||`custom-${Date.now()}`,d.value=p},w=()=>{if(!q.value)return;const f={...i.value,id:`custom-${Date.now()}`,isCustom:!0};M(f,"custom")},x=()=>{r.value&&(c("vehicle-selected",{vehicle:r.value,type:d.value}),c("close"),r.value=null,g.value=null,d.value=null,a.value="",u.value=!1,i.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(f,p)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":o},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-6xl"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...p[7]||(p[7]=[W("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",ta,[h.value.length?(y(),C("div",sa,[p[8]||(p[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),W(" Recommended Vehicles ")],-1)),e("div",na,[(y(!0),C(re,null,fe(h.value,A=>(y(),j(lt,{key:A.id,vehicle:A,badge:A.isRequested?"Requested":"Recommended","stock-days":A.stockDays,selected:g.value===A.id,onSelect:U=>M(A,A.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):O("",!0),e("div",null,[p[11]||(p[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),W(" Browse Stock ")],-1)),e("div",oa,[e("div",la,[p[9]||(p[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),Q(e("input",{"onUpdate:modelValue":p[0]||(p[0]=A=>a.value=A),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ie,a.value]])])]),k.value.length?(y(),C("div",aa,[(y(!0),C(re,null,fe(k.value,A=>(y(),j(lt,{key:A.id,vehicle:A,badge:"In Stock","stock-days":A.stockDays,selected:g.value===A.id,onSelect:U=>M(A,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(y(),C("div",ia,[...p[10]||(p[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[p[19]||(p[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),W(" Configure Custom Vehicle ")],-1)),e("div",ra,[p[18]||(p[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:p[1]||(p[1]=A=>u.value=!u.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[p[12]||(p[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),W(" "+N(u.value?"Hide Configuration":"Build Custom Configuration"),1)]),u.value?(y(),C("div",da,[e("div",ua,[e("div",null,[p[13]||(p[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),Q(e("input",{"onUpdate:modelValue":p[2]||(p[2]=A=>i.value.brand=A),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ie,i.value.brand]])]),e("div",null,[p[14]||(p[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),Q(e("input",{"onUpdate:modelValue":p[3]||(p[3]=A=>i.value.model=A),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ie,i.value.model]])]),e("div",null,[p[15]||(p[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),Q(e("input",{"onUpdate:modelValue":p[4]||(p[4]=A=>i.value.year=A),type:"number",class:"input",placeholder:"2024"},null,512),[[ie,i.value.year]])]),e("div",null,[p[16]||(p[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (â‚¬)",-1)),Q(e("input",{"onUpdate:modelValue":p[5]||(p[5]=A=>i.value.price=A),type:"number",class:"input",placeholder:"98000"},null,512),[[ie,i.value.price]])])]),e("div",ca,[e("button",{onClick:w,disabled:!q.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...p[17]||(p[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),W(" Use Custom Configuration ",-1)])],8,pa)])])):O("",!0)])])]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:p[6]||(p[6]=A=>f.$emit("close"))}),r.value?(y(),j(n(P),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:x})):O("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},fa={class:"space-y-4"},ya=["max"],va={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:v}){const s=t,c=v,o=I(""),a=I(""),u=I(""),r=D(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,i=>{if(i){const m=new Date;o.value=m.toISOString().split("T")[0],a.value=m.toTimeString().slice(0,5),u.value=""}});const g=()=>{if(!o.value)return;const i=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;c("confirm",{contractDate:i,notes:u.value})},d=()=>{c("cancel")},l=i=>{i||d()};return(i,m)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":l},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...m[3]||(m[3]=[W("Set Contract Signing Date",-1)])]),_:1}),S(n(We),null,{default:$(()=>[...m[4]||(m[4]=[W("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",fa,[e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=h=>o.value=h),max:r.value,class:"input"},null,8,ya),[[ie,o.value]])]),e("div",null,[m[6]||(m[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=h=>a.value=h),class:"input"},null,512),[[ie,a.value]])]),e("div",null,[m[7]||(m[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),Q(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=h=>u.value=h),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ie,u.value]])])]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),S(n(P),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!o.value,onClick:g},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ga={class:"space-y-4"},ba=["max"],ha={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:v}){const s=t,c=v,o=I(""),a=I(""),u=I(""),r=I(""),g=D(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,m=>{if(m){const h=new Date;o.value=h.toISOString().split("T")[0],a.value=h.toTimeString().slice(0,5),u.value="",r.value=""}});const d=()=>{if(!o.value||!u.value)return;const m=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;c("confirm",{deliveryDate:m,location:u.value,notes:r.value})},l=()=>{c("cancel")},i=m=>{m||l()};return(m,h)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":i},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...h[4]||(h[4]=[W("Mark as Delivered",-1)])]),_:1}),S(n(We),null,{default:$(()=>[...h[5]||(h[5]=[W("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",ga,[e("div",null,[h[6]||(h[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":h[0]||(h[0]=k=>o.value=k),max:g.value,class:"input"},null,8,ba),[[ie,o.value]])]),e("div",null,[h[7]||(h[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":h[1]||(h[1]=k=>a.value=k),class:"input"},null,512),[[ie,a.value]])]),e("div",null,[h[9]||(h[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),Q(e("select",{"onUpdate:modelValue":h[2]||(h[2]=k=>u.value=k),class:"input"},[...h[8]||(h[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[be,u.value]])]),e("div",null,[h[10]||(h[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":h[3]||(h[3]=k=>r.value=k),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ie,r.value]])])]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:l}),S(n(P),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!o.value||!u.value,onClick:d},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},xa={class:"space-y-4"},wa={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:v}){const s=t,c=v,o=I(""),a=I("");we(()=>s.show,d=>{d&&(o.value="",a.value="")});const u=()=>{o.value&&c("confirm",{reason:o.value,notes:a.value})},r=()=>{c("cancel")},g=d=>{d||r()};return(d,l)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":g},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...l[2]||(l[2]=[W("Close as Lost",-1)])]),_:1}),S(n(We),null,{default:$(()=>[...l[3]||(l[3]=[W("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",xa,[e("div",null,[l[5]||(l[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),Q(e("select",{"onUpdate:modelValue":l[0]||(l[0]=i=>o.value=i),class:"input"},[...l[4]||(l[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[be,o.value]])]),e("div",null,[l[6]||(l[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=i=>a.value=i),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ie,a.value]])])]),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:r}),S(n(P),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!o.value,onClick:u},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ka={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:v}){const s=v,c=o=>{o||s("cancel")};return(o,a)=>(y(),j(n(Ne),{open:t.show,"onUpdate:open":c},{default:$(()=>[S(n($e),null,{default:$(()=>[S(n(Ae),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(De),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),null,{default:$(()=>[...a[2]||(a[2]=[W("Requalify as Lead",-1)])]),_:1}),S(n(We),null,{default:$(()=>[...a[3]||(a[3]=[W("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),a[4]||(a[4]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),W(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),W(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),W(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),S(n(Oe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[0]||(a[0]=u=>o.$emit("cancel"))}),S(n(P),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:a[1]||(a[1]=u=>o.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ca={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},Sa={class:"flex gap-3"},$a={key:0,class:"space-y-3"},Aa={class:"flex items-center gap-2 pb-2 border-b border"},Da={class:"font-semibold text-heading text-sm"},Ta={key:0,class:"flex justify-end"},Ia={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:v}){const s=t,c=v,o=st(),a=Ye(),u=I(!1),r=I(!1),g=I(!1),d=I(!1),l=I(!1),i=I(!1),m=I(!1),h=I(!1),k=I(!1),q=I(!1),M=I([]),w=D(()=>{var B,V;return((B=s.opportunity)==null?void 0:B.displayStage)||((V=s.opportunity)==null?void 0:V.stage)||"Qualified"});D(()=>at(w.value,"opportunity"));function x(B){return B?new Date(B).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const f={"schedule-appointment":()=>{u.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?k.value=!0:u.value=!0},"select-vehicle":()=>{m.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?m.value=!0:r.value=!0},"call-prospect":()=>{h.value=!0},"follow-up-offer":()=>{h.value=!0},"request-decision":()=>{h.value=!0},"finalize-contract":()=>{d.value=!0},"schedule-delivery":()=>{l.value=!0},"confirm-delivery":()=>{l.value=!0},"collect-feedback":()=>{h.value=!0},reschedule:()=>{q.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&he()},"close-won":()=>{d.value=!0},"add-offer":()=>{r.value=!0},"add-contract":()=>{d.value=!0},"extend-deadline":()=>{h.value=!0},"close-lost":()=>{g.value=!0},reopen:()=>{ae()},requalify:()=>{i.value=!0}},{primaryAction:p,secondaryActions:A,activeTaskWidget:U,taskWidgetTitle:E,isClosed:X}=Wl(Ve(s,"opportunity"),Ve(s,"scheduledAppointment"),Ve(s,"activities"),f,x);function ne(B){}function le(){}function ye(B){m.value=!1,c("vehicle-selected",B),setTimeout(()=>{r.value=!0},300)}function Y(B){r.value=!1,c("offer-created",B)}function ce(B){u.value=!1,c("appointment-scheduled",{...B,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function he(){s.scheduledAppointment&&c("appointment-cancelled",s.scheduledAppointment.id)}function xe(B){d.value=!1,a.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:B.contractDate})}function _(B){l.value=!1,a.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:B})}function ee(B){g.value=!1,a.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:B})}function ae(){a.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function pe(B){i.value=!1,o.push(`/customer/${B.id}?type=lead`)}function ve(B){k.value=!1}function ge(B){q.value=!1}function de(B){a.updateOpportunity(s.opportunity.id,{callbackDate:B.callbackDate})}function oe(B){a.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:B.reason||"Multiple no-shows (NS3)"})}return Qe(async()=>{try{const V=(await ft({})).data||[];M.value=V.filter(K=>K.stockDays!==null&&K.stockDays!==void 0).slice(0,5)}catch(B){console.error("Failed to load recommended cars:",B),M.value=[]}}),(B,V)=>(y(),C(re,null,[S(ht,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":$(()=>[n(X)&&!n(U)?(y(),C("div",Ca,[V[15]||(V[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-heading text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Sa,[S(n(P),{variant:"primary",size:"small",onClick:ae,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700"},{default:$(()=>[...V[13]||(V[13]=[e("span",null,"Reopen",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}),S(n(P),{variant:"outline",size:"small",onClick:V[0]||(V[0]=K=>i.value=!0),class:"flex items-center gap-2 bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300"},{default:$(()=>[...V[14]||(V[14]=[e("span",null,"Requalify as Lead",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])]),_:1})])])):O("",!0)]),"primary-action":$(()=>[!n(X)&&n(p)?(y(),j(xt,{key:0,action:n(p),"color-scheme":n(p).colorScheme,onActionClicked:V[1]||(V[1]=K=>n(p).handler())},null,8,["action","color-scheme"])):O("",!0)]),"task-widgets":$(()=>[n(U)&&n(U).component?(y(),C("div",$a,[e("div",Aa,[V[16]||(V[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Da,N(n(E)),1)]),(y(),j(Nt(n(U).component),qt(n(U).props,{onClose:le,onSetCallback:de,onAutoCloseLost:oe}),null,16))])):O("",!0)]),"secondary-actions":$(()=>[n(A).length>0?(y(),C("div",Ta,[S(Pl,{actions:n(A),onActionSelected:ne},null,8,["actions"])])):O("",!0)]),_:1},8,["task"]),u.value?(y(),j(Xt,{key:0,show:u.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:ce,onCancel:V[2]||(V[2]=K=>u.value=!1)},null,8,["show","customer","assignee"])):O("",!0),m.value?(y(),j(ma,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":M.value,onVehicleSelected:ye,onClose:V[3]||(V[3]=K=>m.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):O("",!0),r.value?(y(),j(Gt,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:Y,onClose:V[4]||(V[4]=K=>r.value=!1)},null,8,["opportunity","vehicle"])):O("",!0),d.value?(y(),j(va,{key:3,opportunity:t.opportunity,onContractSet:xe,onClose:V[5]||(V[5]=K=>d.value=!1)},null,8,["opportunity"])):O("",!0),l.value?(y(),j(ha,{key:4,opportunity:t.opportunity,onDelivered:_,onClose:V[6]||(V[6]=K=>l.value=!1)},null,8,["opportunity"])):O("",!0),g.value?(y(),j(wa,{key:5,opportunity:t.opportunity,onClosed:ee,onClose:V[7]||(V[7]=K=>g.value=!1)},null,8,["opportunity"])):O("",!0),i.value?(y(),j(ka,{key:6,opportunity:t.opportunity,onRequalified:pe,onClose:V[8]||(V[8]=K=>i.value=!1)},null,8,["opportunity"])):O("",!0),h.value?(y(),j(Jt,{key:7,onClose:V[9]||(V[9]=K=>h.value=!1)})):O("",!0),k.value&&t.scheduledAppointment?(y(),j(Zt,{key:8,show:k.value,event:t.scheduledAppointment,onClose:V[10]||(V[10]=K=>k.value=!1),onEdit:V[11]||(V[11]=K=>{k.value=!1,q.value=!0}),onDelete:ve},null,8,["show","event"])):O("",!0),q.value&&t.scheduledAppointment?(y(),j(_t,{key:9,show:q.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:ge,onCancel:V[12]||(V[12]=K=>q.value=!1)},null,8,["show","event","customer"])):O("",!0)],64))}};function Oa(t){const v=je(),s=Ye(),c=D(()=>t.value?t.value.type==="lead"?gl:Ia:null),o=D(()=>t.value?t.value.type==="lead"?{currentActivities:D(()=>v.currentLeadActivities),addActivity:(u,r)=>v.addActivity(u,r),updateActivity:(u,r,g)=>v.updateActivity(u,r,g),deleteActivity:(u,r)=>v.deleteActivity(u,r),updateLead:(u,r)=>v.updateLead(u,r),loadLeadById:u=>v.fetchLeadById(u)}:{currentActivities:D(()=>s.currentOpportunityActivities),addActivity:(u,r)=>s.addActivity(u,r),updateActivity:(u,r,g)=>s.updateActivity(u,r,g),deleteActivity:(u,r)=>s.deleteActivity(u,r),addVehicle:(u,r)=>s.addVehicle(u,r),createOffer:(u,r)=>s.createOffer(u,r),updateOpportunity:(u,r)=>s.updateOpportunity(u,r),loadOpportunityById:u=>s.fetchOpportunityById(u)}:null),a=D(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:c,storeAdapter:o,addNewConfig:a}}function Na(){const t=l=>{if(!l)return"No deadline";const i=ut(l);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:ct(l)},v=l=>{const i=l.type==="lead"?l.requestedCar:l.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},s=l=>l?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[l.type]||"bg-gray-50 text-gray-700":"",c=l=>{if(!l||!l.assignee)return{name:"Unassigned",initials:"?"};const i=l.assigneeInitials||l.assignee.split(" ").map(m=>m[0]).join("");return{name:l.assignee,initials:i}},o=l=>{if(!l||!l.customer||!l.customer.address)return null;const m=l.customer.address.split(",");return m.length>1&&m[m.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:v,getVehicleTypeBadgeClass:s,getOwnerInfo:c,getCustomerCity:o,getLocationDisplay:l=>{const i=o(l),m=l.source||"Unknown";return i?`${i} â€¢ ${m}`:m},getAssigneeInitials:l=>{if(!l)return"?";const i=l.split(" ");return i.length>=2?(i[0][0]+i[i.length-1][0]).toUpperCase():l.substring(0,2).toUpperCase()},getVehicleStatusDisplay:l=>{const i=l.type==="lead"?l.requestedCar:l.vehicle;if(!i)return"No vehicle";const m=v(l),h=m?m.label:i.type||"Unknown";let k="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?k=`${(i.kilometers/1e3).toFixed(0)}k`:k=`${i.kilometers}`),k?`${h} / ${k}`:h},getTaskStatusDisplay:l=>l.type==="lead"?l.status||"Unknown":l.stage||"Unknown",getStageBadgeClass:mt,getUnselectedClass:l=>l.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function qa(t){const v=je(),s=Ye(),c=Re(),o=D(()=>{const g=(t.value?v.leads:v.leads.filter(i=>!i.isDisqualified)).map(i=>{const m=dt(i,"lead"),h={...i,type:"lead",compositeId:`lead-${i.id}`,displayStage:m};return!h.customer&&i.customer&&(h.customer=i.customer),h}),d=s.opportunities.map(i=>{const m={...i,type:"opportunity",compositeId:`opportunity-${i.id}`};return!m.customer&&i.customer&&(m.customer=i.customer),m});let l=[];return c.isOperator()?l=g:c.isSalesman()?l=d:l=[...g,...d],l}),a=(r,g)=>g==="all"?r:r.filter(d=>d.type===g),u=D(()=>{const r=o.value.some(d=>d.type==="lead"),g=o.value.some(d=>d.type==="opportunity");return r&&g});return{allTasks:o,filterByType:a,shouldShowTypeFilter:u}}function La(){const t=Re(),v=Ke(),s=Se();return{sortTasks:(o,a)=>{if(a==="none")return[...o].sort((u,r)=>{const g=new Date(u.lastActivity||u.createdAt||0);return new Date(r.lastActivity||r.createdAt||0)-g});if(a==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...o.map(g=>{if(g.type==="lead"&&!g.urgencyScore){const d=yt(g);return{...g,urgencyScore:d.score,urgencyLevel:d.level}}return g})].sort((g,d)=>{if(g.type==="lead"&&d.type==="lead"){const m=g.urgencyScore||0,h=d.urgencyScore||0;if(m!==h)return h-m;const k=new Date(g.createdAt||0);return new Date(d.createdAt||0)-k}if(g.type==="lead"&&d.type==="opportunity")return-1;if(g.type==="opportunity"&&d.type==="lead")return 1;if(g.priority==="Hot"&&d.priority!=="Hot")return-1;if(g.priority!=="Hot"&&d.priority==="Hot")return 1;const l=new Date(g.lastActivity||g.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-l}):[...o].sort((r,g)=>{if(r.priority==="Hot"&&g.priority!=="Hot")return-1;if(r.priority!=="Hot"&&g.priority==="Hot")return 1;const d=new Date(r.lastActivity||r.createdAt||0);return new Date(g.lastActivity||g.createdAt||0)-d});if(a==="assigned-to-me"){const u=t.currentUser.name;return[...o.filter(g=>g.assignee===u)].sort((g,d)=>{const l=new Date(g.lastActivity||g.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-l})}if(a==="assigned-to-my-team"){const u=t.currentUser;let r=[];return u.role==="manager"?r=v.users.map(d=>d.name):u.role==="salesman"?r=v.users.filter(d=>d.role==="salesman").map(d=>d.name):u.role==="operator"&&(r=v.users.filter(d=>d.role==="operator").map(d=>d.name)),[...o.filter(d=>r.includes(d.assignee))].sort((d,l)=>{const i=new Date(d.lastActivity||d.createdAt||0);return new Date(l.lastActivity||l.createdAt||0)-i})}return o}}}const Ma={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Fa={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Va={key:0,class:"flex items-center gap-2"},Ua={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-[6px] shrink-0"},Ra={class:"text-gray-600 font-medium"},Ba={key:1},ja={key:0},Wa={key:1},za={key:2},Ha={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Ea={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Pa={__name:"Tasks",setup(t){const v=Lt(),s=st(),c=je(),o=Ye();Re(),Ke();const a=Se(),{getDateDisplay:u,getVehicleType:r,getVehicleTypeBadgeClass:g,getOwnerInfo:d,getCustomerCity:l,getAssigneeInitials:i,getUnselectedClass:m}=Na(),h=I(localStorage.getItem("tasksViewMode")||"table"),k=I(""),q=D(()=>v.query.highlight||null);we(h,T=>{localStorage.setItem("tasksViewMode",T)});const M=(T,R="")=>{h.value;const Z=Y.value;if(h.value=T,T==="card"&&R&&(k.value=R),T==="table"&&Z)k.value="",s.push({path:"/tasks",query:{highlight:Z.compositeId}});else if(T==="card"&&q.value){const[te,L]=q.value.split("-");s.push({path:`/tasks/${L}`,query:{type:te}})}else T==="card"&&!q.value&&!Y.value&&s.push({path:"/tasks"})},w=I("all"),x=I("none"),f=I(!1),p=I(null);I(!1);const A=I(!1),U=I(null),{allTasks:E,filterByType:X,shouldShowTypeFilter:ne}=qa(f),{sortTasks:le}=La(),ye=D(()=>{let T=X(E.value,w.value);return T=le(T,x.value),T}),Y=D(()=>{if(!v.params.id)return null;const T=parseInt(v.params.id);if(isNaN(T))return null;const R=v.query.type;if(R){const G=`${R}-${T}`;return E.value.find(me=>me.compositeId===G)||null}const Z=w.value!=="all"?E.value.filter(G=>G.type===w.value):E.value,te=`lead-${T}`,L=`opportunity-${T}`,H=Z.find(G=>G.compositeId===te||G.compositeId===L);return H||E.value.find(G=>G.compositeId===te||G.compositeId===L)||null});D(()=>Y.value?Y.value.type==="lead"?c.currentLeadActivities:o.currentOpportunityActivities:[]);const ce=Oa(Y),he=ce.managementWidget,xe=ce.storeAdapter,_=ce.addNewConfig,ee=m;Qe(()=>{c.fetchLeads(),o.fetchOpportunities();const T=v.params.id;T&&ae(T)}),we(()=>v.params.id,T=>{T&&ae(T)}),we(Y,T=>{T&&(T.type==="lead"?c.fetchLeadById(T.id):o.fetchOpportunityById(T.id))},{immediate:!0});const ae=T=>{const R=parseInt(T),Z=E.value.find(te=>te.id===R);Z&&(Z.type==="lead"?c.fetchLeadById(R):o.fetchOpportunityById(R))},pe=T=>{const[R,Z]=T.split("-"),te=E.value.find(L=>L.compositeId===T);h.value="card",te&&te.customer&&te.customer.name?k.value=te.customer.name:k.value=Z,s.push({path:`/tasks/${Z}`,query:{type:R}})},ve=()=>{s.push({path:"/tasks"})},ge=T=>{p.value=p.value===T?null:T},de=T=>{U.value=T,A.value=!0,p.value=null},oe=T=>{x.value=T},B=async T=>{if(!U.value)return;const R=U.value,Z=T.name;R.type==="lead"?await c.updateLead(R.id,{assignee:Z,assigneeType:T.type,teamId:T.type==="team"?T.id:null}):R.type==="opportunity"&&await o.updateOpportunity(R.id,{assignee:Z,assigneeType:T.type,teamId:T.type==="team"?T.id:null}),A.value=!1,U.value=null},V=async T=>{p.value=null,T.type==="lead"?await c.updateLead(T.id,{priority:"Hot"}):T.type==="opportunity"&&await o.updateOpportunity(T.id,{priority:"Hot"})},K=async T=>{p.value=null,T.type==="lead"?await c.updateLead(T.id,{priority:"Normal"}):T.type==="opportunity"&&await o.updateOpportunity(T.id,{priority:"Normal"})},Ge=async T=>{if(p.value=null,T.type==="lead")try{const R=T.displayStage||T.stage||Fe.NEW,Z=Fe.NEW,te=_e(R,Z);if(te){const{updates:L,activities:H}=te(T);await c.updateLead(T.id,L);for(const G of H)await c.addActivity(T.id,G)}else await c.updateLead(T.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await c.addActivity(T.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await c.fetchLeadById(T.id)}catch(R){console.error("Failed to reopen lead:",R)}},qe=T=>{const R=[];return T.type==="lead"&&T.isDisqualified===!0&&R.push({key:"reopen",label:"Reopen Lead",onClick:()=>Ge(T)}),R.push({key:"reassign",label:"Reassign",onClick:()=>de(T)}),T.priority!=="Hot"?R.push({key:"mark-hot",label:"Mark as hot",onClick:()=>V(T)}):R.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>K(T)}),R};return(T,R)=>{var Z,te;return y(),C("div",Ma,[S(tn,{show:!!Y.value,"back-label":"Back to task list",onBack:ve},null,8,["show"]),h.value==="card"?(y(),C("div",Fa,[e("div",{class:z(["flex flex-col overflow-hidden",Y.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[S(Ls,{title:"Tasks",items:ye.value,"selected-id":(Z=Y.value)==null?void 0:Z.compositeId,"type-filter":w.value,"view-mode":h.value,"initial-search-query":k.value,onViewChange:M,"selected-class":L=>L.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":n(ee),"open-menu-id":p.value,getName:L=>{const H=L.customer;return H&&H.name?H.name:H&&!H.name&&H.email&&H.email.split("@")[0]||"Unknown"},getInitials:L=>{const H=L.customer;return H&&H.initials?H.initials:H&&H.name&&H.name.split(" ").map(me=>me[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:L=>{if(L.type==="lead"){if(!L.requestedCar)return"No vehicle specified";const me=L.requestedCar,Le=[`${me.brand} ${me.model}`];return me.kilometers!==void 0&&me.kilometers!==null&&Le.push(`${me.kilometers} km`),me.status&&Le.push(me.status),Le.join(" â€¢ ")}const H=L.vehicle||L.requestedCar;if(!H)return"No vehicle specified";const G=[`${H.brand} ${H.model}`];return H.kilometers!==void 0&&H.kilometers!==null&&G.push(`${H.kilometers} km`),H.status&&G.push(H.status),G.join(" â€¢ ")},avatarClass:L=>L.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":qe,"show-mobile-close":!1,onSelect:pe,onMenuClick:ge,onMenuClose:R[0]||(R[0]=L=>p.value=null),onClose:ve,"show-type-filter":n(ne),onFilterChange:R[1]||(R[1]=L=>w.value=L),onSortChange:oe},{badges:$(({item:L})=>[L&&L.type?(y(),j(n(He),{key:0,text:L.type==="lead"?"Lead":"Opportunity",size:"small",theme:L.type==="lead"?"blue":"gray"},null,8,["text","theme"])):O("",!0),L&&L.type==="lead"&&n(a).getSetting("urgencyEnabled")!==!1&&L.urgencyLevel?(y(),j(n(He),{key:1,text:`${n(vt)(L.urgencyLevel)} ${L.urgencyLevel}`,size:"small",class:z(n(gt)(L.urgencyLevel))},null,8,["text","class"])):O("",!0),L&&L.priority==="Hot"&&(n(a).getSetting("urgencyEnabled")===!1||L.type!=="lead")?(y(),j(n(He),{key:2,text:"HOT",size:"small",theme:"red"})):O("",!0)]),location:$(({item:L})=>[W(N(n(l)(L)||"Unknown"),1)]),source:$(({item:L})=>{var H;return[W(N(L.source||((H=L.customer)==null?void 0:H.source)||"Unknown"),1)]}),owner:$(({item:L})=>[L.assignee?(y(),C("div",Va,[e("div",Ua,N(n(i)(L.assignee)),1),e("span",Ra,N(L.assignee),1)])):(y(),C("span",Ba,"Unassigned"))]),dates:$(({item:L})=>[L.type==="lead"&&L.nextActionDue?(y(),C("span",ja,"Due: "+N(n(u)(L.nextActionDue)),1)):L.type==="opportunity"&&L.nextActionDue?(y(),C("span",Wa,"Due: "+N(n(u)(L.nextActionDue)),1)):(y(),C("span",za,"Due: No deadline"))]),_:1},8,["items","selected-id","type-filter","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),Y.value?(y(),j(ot,{key:0,task:Y.value,"management-widget":n(he),"store-adapter":n(xe),"add-new-config":n(_)},null,8,["task","management-widget","store-adapter","add-new-config"])):O("",!0),Y.value?O("",!0):(y(),C("div",Ha,[...R[6]||(R[6]=[Ee('<div class="flex-1 flex items-center justify-center p-8" data-v-74c8e906><div class="text-center max-w-sm" data-v-74c8e906><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center" data-v-74c8e906><i class="fa-solid fa-tasks text-2xl text-sub" data-v-74c8e906></i></div><h3 class="text-content-bold mb-2" data-v-74c8e906>No task selected</h3><p class="text-meta" data-v-74c8e906>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):O("",!0),h.value==="table"?(y(),C("div",Ea,[S(Ys,{tasks:ye.value,"current-task-id":(te=Y.value)==null?void 0:te.compositeId,"highlight-id":q.value,"type-filter":w.value,"sort-option":x.value,"show-type-filter":n(ne),"show-closed":f.value,"show-mobile-close":!1,"open-menu-id":p.value,"get-vehicle-type":n(r),"get-vehicle-type-badge-class":n(g),"get-owner-info":n(d),"get-stage-badge-class":n(mt),"view-mode":h.value,onSelect:pe,onMenuClick:ge,onMenuClose:R[2]||(R[2]=L=>p.value=null),onFilterChange:R[3]||(R[3]=L=>w.value=L),onSortChange:oe,onToggleClosed:R[4]||(R[4]=L=>f.value=L),onReassign:de,onClose:ve,onViewChange:M,class:z(Y.value?"hidden lg:flex shrink-0":"flex-1 w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode","class"]),Y.value?(y(),j(ot,{key:0,task:Y.value,"management-widget":n(he),"store-adapter":n(xe),"add-new-config":n(_)},null,8,["task","management-widget","store-adapter","add-new-config"])):O("",!0)])):O("",!0),S(es,{show:A.value,onClose:R[5]||(R[5]=L=>A.value=!1),onConfirm:B},null,8,["show"])])}}},oi=it(Pa,[["__scopeId","data-v-74c8e906"]]);export{oi as default};
