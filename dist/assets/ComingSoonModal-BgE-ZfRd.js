import{E as ze,Y as te,r as q,$ as yt,h as He,c as A,J as Ye,d as r,o as i,e,y as $,n as R,w as ee,t as b,F as Y,i as K,p as C,g,s as D,P as Qe,aa as Dt,I as bt,x as j,z as Oe,k as N,_ as gt,v as X,j as ye,K as O,Q as z,l as re,m as be,Z as xt,ab as le,ac as Et,ad as Vt,u as Lt,D as U,ae as Pt,af as Mt,ag as Ot,ah as Rt,ai as qt,a4 as Ft,a2 as Bt,L as Ut,R as nt,G as ge,M as ue}from"./index-DmX4Eg8G.js";import{_ as Nt}from"./ReassignUserModal-DFvSPDBS.js";import{_ as jt}from"./CreateEventModal-CyvGeC8X.js";import{a as Ce,F as Se,L as Ae,H as De,j as Ee,K as Ge,C as Ve,W as Le}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-B0oMcpqR.js";import{e as Ue}from"./formatters-B1RFjlNy.js";import{u as Wt}from"./vehicles-zB6Q3ssr.js";import{u as zt}from"./opportunities-XVgMwMKa.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=ze("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=ze("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ze("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),oe={[te.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[te.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[te.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[te.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[te.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[te.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},it={toClosed:(t,o,l)=>{const s={isDisqualified:!0,disqualifyReason:(l==null?void 0:l.reason)||null,disqualifyCategory:(l==null?void 0:l.category)||null,scheduledAppointment:null,nextActionDue:null};(l==null?void 0:l.reason)==="Duplicate"?(s.isDuplicate=!0,s.stage="Closed Failed"):(l==null?void 0:l.category)==="Not Interested"?s.stage="Not Interested":s.stage="Not Valid",s.status="Disqualified";const m=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(l==null?void 0:l.category)||"Unknown"}, Reason: ${(l==null?void 0:l.reason)||"Unknown"}`}];return t.scheduledAppointment&&m.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:s,activities:m}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Eu(t,o){return o.startsWith("Closed")?it.toClosed:t.startsWith("Closed")&&!o.startsWith("Closed")?it.reopen:null}const Ke={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const o=t.deliverySubstatus;return o==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:o==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ne={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},Qt={class:"w-full card-container p-3 md:px-8 md:py-3.5"},Gt={class:"flex items-center justify-between gap-4"},Kt={class:"flex items-center gap-2 flex-1 min-w-0"},Jt={class:"flex items-center gap-3 min-w-0 flex-1"},Xt={class:"min-w-0 flex-1"},Zt={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},_t={class:"flex flex-col gap-1.5 mt-1"},el={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},tl={class:"flex items-center gap-1.5 group"},ll={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},al={class:"flex items-center gap-1.5 group"},nl={class:"text-xs text-heading font-medium whitespace-nowrap"},sl={class:"flex items-center gap-1.5"},il={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},ol={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},rl={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},dl={class:"flex flex-wrap items-center gap-1.5"},ul={class:"shrink-0"},cl={class:"relative"},ml={key:0,class:"absolute top-full right-0 mt-2 z-50 shadow-xl"},fl={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]}},emits:["action","add-tag"],setup(t,{emit:o}){const l=t,s=o,m=q(!1),d=yt(),p=He(),n=A(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...l.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(I=>({...I,onClick:()=>v(I.key)}))),v=k=>{m.value=!1,s("action",k)},c=async(k,I)=>{try{await navigator.clipboard.writeText(k),d.pushToast("success",`${I==="email"?"Email":"Phone"} copied!`)}catch{d.pushToast("error","Failed to copy")}},a=()=>s("add-tag"),f=()=>{l.customerId&&p.push(`/customer/${l.customerId}`)};return(k,I)=>{const w=Ye("click-outside");return i(),r("div",Qt,[e("div",Gt,[e("div",Kt,[e("button",{onClick:I[0]||(I[0]=u=>$(p).push("/customers")),class:"w-7 h-7 flex items-center justify-center text-sub hover:text-brand-dark transition-colors shrink-0 -ml-1","aria-label":"Back to customers"},[...I[4]||(I[4]=[e("i",{class:"fa-solid fa-arrow-left text-xs"},null,-1)])]),e("div",Jt,[e("button",{onClick:ee(f,["stop"]),class:R(["w-20 h-20 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...I[5]||(I[5]=[e("i",{class:"fa-solid fa-user text-3xl text-white"},null,-1)])],2),e("div",Xt,[e("h1",Zt,b(t.name),1),e("div",_t,[e("div",el,[e("div",tl,[I[7]||(I[7]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",ll,b(t.email),1),e("button",{onClick:I[1]||(I[1]=ee(u=>c(t.email,"email"),["stop"])),class:"transition-all"},[...I[6]||(I[6]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",al,[I[9]||(I[9]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",nl,b(t.phone),1),e("button",{onClick:I[2]||(I[2]=ee(u=>c(t.phone,"phone"),["stop"])),class:"transition-all"},[...I[8]||(I[8]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",sl,[t.thirdFieldLabel.toLowerCase().includes("address")?(i(),r("i",il)):(i(),r("i",ol)),e("span",rl,b(t.thirdFieldValue),1)])]),e("div",dl,[(i(!0),r(Y,null,K(t.tags,u=>(i(),r("span",{key:u,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},b(u),1))),128)),e("button",{onClick:ee(a,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...I[10]||(I[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])])]),e("div",ul,[e("div",cl,[e("button",{onClick:I[3]||(I[3]=ee(u=>m.value=!m.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...I[11]||(I[11]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),m.value?C((i(),r("div",ml,[D($(Qe),{items:n.value,className:"w-48"},null,8,["items"])])),[[w,()=>m.value=!1]]):g("",!0)])])])])}}},pl={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},vl=["onClick"],ot={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const o={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},l=s=>o[s]||"fa-solid fa-circle";return(s,m)=>(i(),r("div",pl,[(i(!0),r(Y,null,K(t.tabs,d=>(i(),r("div",{key:d.key,onClick:p=>s.$emit("update:modelValue",d.key),class:R(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===d.key?"border-brand-dark text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:R([l(d.key),"text-sm md:text-sm",t.modelValue===d.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:R(["hidden md:inline whitespace-nowrap",t.modelValue===d.key?"text-brand-darkDarker":""])},b(d.label),3)],10,vl))),128))]))}},yl={class:"w-full mb-6"},bl={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},gl={class:"px-4 md:px-6 py-3 border-b border-black/5"},xl={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},hl={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},kl={class:"flex items-center gap-1.5"},wl={key:1},$l={class:"flex items-center gap-2"},Il={key:0,class:"p-4 md:p-6"},Tl={key:0,class:"space-y-4"},Cl={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Sl={class:"flex items-center gap-4"},Al={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},Dl=["src"],El={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},Vl={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},Ll={class:"flex items-center gap-2 flex-wrap"},Pl={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},Ml={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},Ol={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},Rl={class:"text-fluid-xs font-bold text-heading"},ql={key:0,class:"text-right"},Fl={class:"font-bold text-heading text-fluid-lg"},Bl={key:0,class:"pt-2"},Ul={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Nl={class:"text-fluid-sm text-body leading-relaxed"},jl={key:1,class:"space-y-3"},Wl={key:0,class:"flex items-center gap-2"},zl={class:"text-fluid-sm font-semibold text-heading"},Hl={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Yl={class:"text-fluid-sm text-body leading-relaxed"},Ql={key:1,class:"border-t border-black/5"},Gl={class:"font-medium"},Kl={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},Jl={class:"mb-6"},Xl={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Zl={key:0},_l={class:"font-medium text-body"},ea={key:1},ta={class:"font-medium text-body"},la={key:2},aa={class:"font-medium text-body"},na={class:"font-medium text-body"},sa={key:0},ia={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},oa={key:0},ra={class:"font-medium text-body"},da={key:1},ua={class:"font-medium text-body"},ca={key:2},ma={class:"font-medium text-body"},fa={key:3},pa={class:"font-medium text-body"},va={key:4},ya={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},ba={key:5},ga={class:"font-medium text-body"},xa={key:0,class:"mt-6 flex justify-end"},ha={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const o=t,l=q(!1);A(()=>o.deliverySubstatus?Dt(o.deliverySubstatus):"");const s=A(()=>o.deliverySubstatus?o.deliverySubstatus==="Delivered"?"green":o.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),m=A(()=>bt(o.stage,o.entityType));function d(P){return!P||P.length===0?null:P.filter(G=>G.type==="offer").sort((G,fe)=>new Date(fe.timestamp)-new Date(G.timestamp))[0]||null}function p(P){if(!P)return 0;const V=new Date(P),fe=Math.abs(new Date-V);return Math.ceil(fe/(1e3*60*60*24))}const n=A(()=>{if(o.stage!=="In Negotiation")return null;const P=d(o.activities);if(!P)return null;const V=p(P.timestamp);return V<1?{label:"New Offer",theme:"orange"}:V<3?{label:"Active",theme:"yellow"}:null}),v=A(()=>o.requestedCar&&o.requestedCar.brand&&o.requestedCar.model),c=A(()=>o.requestType||o.requestMessage||v.value),a=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.brand)||""}),f=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.model)||""}),k=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.year)||""}),I=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.image)||""}),w=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.price)||null}),u=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.stockDays)!==void 0?o.requestedCar.stockDays:null}),h=A(()=>{var P,V;return((P=o.requestedCar)==null?void 0:P.dealership)||((V=o.task)==null?void 0:V.dealership)||""}),S=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.registration)||""}),x=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.kilometers)!==void 0?o.requestedCar.kilometers:null}),M=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.fuelType)||""}),Z=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.gearType)||""}),ae=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.vin)||""}),de=A(()=>"Email"),B=A(()=>{var P,V;return((P=o.task)==null?void 0:P.sourceDetails)||((V=o.requestedCar)==null?void 0:V.adCampaign)||""}),y=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.expectedPurchaseDate)||""}),L=A(()=>{var P;return((P=o.task)==null?void 0:P.fiscalEntity)||""}),ne=A(()=>{var P;return((P=o.task)==null?void 0:P.sourceDetails)||""}),ce=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.adMedium)||""}),xe=A(()=>{var P;return((P=o.requestedCar)==null?void 0:P.adSource)||""});A(()=>!0);const Re=A(()=>!0),se=A(()=>v.value||o.requestType||o.source||ne.value||B.value||y.value||L.value||ce.value||xe.value),_=P=>new Intl.NumberFormat("en-US").format(P),me=P=>new Intl.NumberFormat("en-US").format(P);return(P,V)=>(i(),r("div",yl,[e("div",bl,[e("div",gl,[e("div",xl,[c.value?(i(),r("div",hl,[V[2]||(V[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",kl,[e("span",{class:R(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},b(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:R(["px-2 py-0.5 rounded text-fluid-xs font-medium border",m.value])},b(t.stage),3),t.deliverySubstatus?(i(),j($(Oe),{key:0,text:t.deliverySubstatus,size:"small",theme:s.value},null,8,["text","theme"])):g("",!0),n.value?(i(),j($(Oe),{key:1,text:n.value.label,size:"small",theme:n.value.theme},null,8,["text","theme"])):g("",!0)])])):(i(),r("div",wl)),e("div",$l,[V[3]||(V[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:V[0]||(V[0]=G=>P.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},b(t.owner),1)])])]),c.value?(i(),r("div",Il,[v.value?(i(),r("div",Tl,[e("div",Cl,[e("div",Sl,[e("div",Al,[I.value?(i(),r("img",{key:0,src:I.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Dl)):(i(),r("i",El))]),e("div",null,[e("div",Vl,b(a.value)+" "+b(f.value)+" ("+b(k.value)+")",1),e("div",Ll,[u.value!==void 0&&u.value!==null?(i(),r("div",Pl,[V[4]||(V[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+b(u.value)+" days) ",1)])):v.value?(i(),r("div",Ml,[...V[5]||(V[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])):g("",!0),t.source?(i(),r("div",Ol,[V[6]||(V[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",Rl,b(t.source),1)])):g("",!0)])])]),w.value?(i(),r("div",ql,[V[7]||(V[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",Fl,"€ "+b(_(w.value)),1)])):g("",!0)]),t.requestMessage?(i(),r("div",Bl,[V[8]||(V[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",Ul,[e("p",Nl,b(t.requestMessage),1)])])):g("",!0)])):(i(),r("div",jl,[t.requestType?(i(),r("div",Wl,[V[9]||(V[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",zl,b(t.requestType),1)])):g("",!0),t.requestMessage?(i(),r("div",Hl,[V[10]||(V[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",Yl,b(t.requestMessage),1)])):g("",!0)]))])):g("",!0),se.value?(i(),r("div",Ql,[e("button",{onClick:V[1]||(V[1]=G=>l.value=!l.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Gl,b(l.value?"Hide":"View")+" Details",1),e("i",{class:R(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])):g("",!0),l.value&&se.value?(i(),r("div",Kl,[e("div",Jl,[V[21]||(V[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Xl,[t.requestType?(i(),r("div",Zl,[V[11]||(V[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",_l,b(t.requestType),1)])):g("",!0),t.source?(i(),r("div",ea,[V[12]||(V[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",ta,b(t.source),1)])):g("",!0),e("div",null,[V[13]||(V[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:R(["font-medium",ne.value?"text-body":"text-sub"])},b(ne.value||"--"),3)]),h.value?(i(),r("div",la,[V[14]||(V[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",aa,b(h.value),1)])):g("",!0),e("div",null,[V[15]||(V[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",na,b(de.value||"Email"),1)]),e("div",null,[V[16]||(V[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:R(["font-medium",B.value?"text-body":"text-sub"])},b(B.value||"--"),3)]),e("div",null,[V[17]||(V[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:R(["font-medium",ce.value?"text-body":"text-sub"])},b(ce.value||"--"),3)]),e("div",null,[V[18]||(V[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:R(["font-medium",xe.value?"text-body":"text-sub"])},b(xe.value||"--"),3)]),e("div",null,[V[19]||(V[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:R(["font-medium",y.value?"text-body":"text-sub"])},b(y.value||"--"),3)]),e("div",null,[V[20]||(V[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:R(["font-medium",L.value?"text-body":"text-sub"])},b(L.value||"--"),3)])])]),v.value?(i(),r("div",sa,[V[30]||(V[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[V[29]||(V[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",ia,[S.value?(i(),r("div",oa,[V[22]||(V[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",ra,b(S.value),1)])):g("",!0),x.value!==void 0&&x.value!==null?(i(),r("div",da,[V[23]||(V[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",ua,b(me(x.value))+" Km",1)])):g("",!0),M.value?(i(),r("div",ca,[V[24]||(V[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",ma,b(M.value),1)])):g("",!0),Z.value?(i(),r("div",fa,[V[25]||(V[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",pa,b(Z.value),1)])):g("",!0),ae.value?(i(),r("div",va,[V[26]||(V[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",ya,b(ae.value),1)])):g("",!0),h.value?(i(),r("div",ba,[V[27]||(V[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",ga,b(h.value),1)])):g("",!0)]),Re.value?(i(),r("div",xa,[...V[28]||(V[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):g("",!0)])])):g("",!0)])):g("",!0)])]))}},ka={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},wa={class:"px-4 py-4 flex items-center justify-between shrink-0"},$a={class:"flex items-center gap-2"},Ia={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ta={class:"flex items-center gap-2 flex-wrap mb-3"},Ca={key:0,class:"space-y-3"},Sa={class:"flex items-center gap-3"},Aa={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},Da=["src"],Ea={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},Va={class:"flex-1 min-w-0"},La={class:"font-bold text-heading text-fluid-sm mb-1"},Pa={class:"flex items-center gap-2 flex-wrap"},Ma={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},Oa={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},Ra={key:0,class:"text-right"},qa={class:"font-bold text-heading text-fluid-sm"},Fa={class:"mt-3 pt-3 space-y-2"},Ba={key:0,class:"flex items-center justify-between text-fluid-xs"},Ua={class:"text-heading font-medium"},Na={key:1,class:"flex items-center justify-between text-fluid-xs"},ja={class:"text-heading font-medium"},Wa={key:2,class:"pt-2"},za={class:"bg-surfaceSecondary rounded-lg p-2"},Ha={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},Ya={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const o=t,l=A(()=>o.task.requestedCar&&o.task.requestedCar.brand&&o.task.requestedCar.model),s=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.brand)||""}),m=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.model)||""}),d=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.year)||""}),p=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.image)||""}),n=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.price)||null}),v=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.stockDays)!==void 0?o.task.requestedCar.stockDays:null}),c=A(()=>{var h;return((h=o.task.requestedCar)==null?void 0:h.requestMessage)||""}),a=A(()=>bt(o.task.displayStage||o.task.stage,o.entityType)),f=A(()=>o.task.deliverySubstatus?o.task.deliverySubstatus==="Delivered"?"green":o.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function k(h){return!h||h.length===0?null:h.filter(x=>x.type==="offer").sort((x,M)=>new Date(M.timestamp)-new Date(x.timestamp))[0]||null}function I(h){if(!h)return 0;const S=new Date(h),M=Math.abs(new Date-S);return Math.ceil(M/(1e3*60*60*24))}const w=A(()=>{if((o.task.displayStage||o.task.stage)!=="In Negotiation")return null;const h=k(o.activities);if(!h)return null;const S=I(h.timestamp);return S<1?{label:"New Offer",theme:"orange"}:S<3?{label:"Active",theme:"yellow"}:null}),u=h=>new Intl.NumberFormat("en-US").format(h);return(h,S)=>{var x,M;return i(),r("div",ka,[e("div",wa,[S[2]||(S[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Request")],-1)),e("div",$a,[S[1]||(S[1]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:S[0]||(S[0]=Z=>h.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},b(t.task.assignee),1)])]),e("div",Ia,[e("div",Ta,[e("span",{class:R(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},b(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:R(["px-2 py-1 rounded text-xs font-medium border",a.value])},b(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(i(),j($(Oe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:f.value},null,8,["text","theme"])):g("",!0),w.value?(i(),j($(Oe),{key:1,text:w.value.label,size:"small",theme:w.value.theme},null,8,["text","theme"])):g("",!0)]),l.value?(i(),r("div",Ca,[e("div",Sa,[e("div",Aa,[p.value?(i(),r("img",{key:0,src:p.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Da)):(i(),r("i",Ea))]),e("div",Va,[e("div",La,b(s.value)+" "+b(m.value)+" ("+b(d.value)+")",1),e("div",Pa,[v.value!==void 0&&v.value!==null?(i(),r("div",Ma,[S[3]||(S[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+b(v.value)+" days) ",1)])):(i(),r("div",Oa,[...S[4]||(S[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])]))])]),n.value?(i(),r("div",Ra,[S[5]||(S[5]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",qa,"€ "+b(u(n.value)),1)])):g("",!0)])])):g("",!0),e("div",Fa,[t.task.source?(i(),r("div",Ba,[S[6]||(S[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",Ua,b(t.task.source),1)])):g("",!0),t.task.requestType||(x=t.task.requestedCar)!=null&&x.requestType?(i(),r("div",Na,[S[7]||(S[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",ja,b(t.task.requestType||((M=t.task.requestedCar)==null?void 0:M.requestType)),1)])):g("",!0),c.value?(i(),r("div",Wa,[S[8]||(S[8]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",za,[e("p",Ha,b(c.value),1)])])):g("",!0)])])])}}},Qa={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ga={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ka={class:"space-y-2 mb-4"},Ja={class:"flex justify-between gap-2 items-center"},Xa={class:"flex items-center gap-2 min-w-0"},Za={class:"text-sm font-medium text-greys-900 truncate"},_a={class:"flex justify-between gap-2 items-center"},en={class:"flex items-center gap-2 min-w-0"},tn={class:"text-sm font-medium text-greys-900 truncate"},ln={class:"flex justify-between gap-2 items-center"},an={class:"flex items-center gap-2 min-w-0"},nn={class:"text-sm font-medium text-greys-900 truncate"},sn={key:0,class:"flex justify-between gap-2 items-start"},on={class:"text-sm font-medium text-greys-900 text-right min-w-0"},rn={key:0,class:"rounded-btn p-3 flex items-center gap-2",style:{"background-color":"rgba(59, 130, 246, 0.1)"}},dn={class:"text-sm text-blue-900"},un={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(t){const o=t,l=yt(),s=He(),m=A(()=>o.task.negotiations||o.task.activeNegotiations||0),d=async(n,v)=>{if(n)try{await navigator.clipboard.writeText(n),l.pushToast("success",`${v==="email"?"Email":"Phone"} copied!`)}catch{l.pushToast("error","Failed to copy")}},p=()=>{o.customerId&&s.push(`/customer/${o.customerId}`)};return(n,v)=>{var c,a,f,k,I,w;return i(),r("div",Qa,[v[6]||(v[6]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Customer information")])],-1)),e("div",Ga,[e("div",Ka,[e("div",Ja,[v[2]||(v[2]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Customer",-1)),e("div",Xa,[e("p",Za,b(((c=t.task.customer)==null?void 0:c.name)||"Unknown"),1),t.customerId?(i(),r("button",{key:0,onClick:p,class:"w-5 h-5 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open customer profile"},[D($(Ht),{size:12})])):g("",!0)])]),e("div",_a,[v[3]||(v[3]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Email",-1)),e("div",en,[e("p",tn,b(((a=t.task.customer)==null?void 0:a.email)||"N/A"),1),(f=t.task.customer)!=null&&f.email?(i(),r("button",{key:0,onClick:v[0]||(v[0]=ee(u=>d(t.task.customer.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy email"},[D($(st),{size:12})])):g("",!0)])]),e("div",ln,[v[4]||(v[4]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Phone",-1)),e("div",an,[e("p",nn,b(((k=t.task.customer)==null?void 0:k.phone)||"N/A"),1),(I=t.task.customer)!=null&&I.phone?(i(),r("button",{key:0,onClick:v[1]||(v[1]=ee(u=>d(t.task.customer.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy phone"},[D($(st),{size:12})])):g("",!0)])]),(w=t.task.customer)!=null&&w.address?(i(),r("div",sn,[v[5]||(v[5]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Address",-1)),e("p",on,b(t.task.customer.address),1)])):g("",!0)]),m.value>0?(i(),r("div",rn,[D($(Yt),{size:16,class:"text-blue-600 shrink-0"}),e("p",dn,b(m.value)+" other negotiation"+b(m.value>1?"s":"")+" active ",1)])):g("",!0)])])}}},cn=gt(un,[["__scopeId","data-v-69f15425"]]),mn={key:0,class:"flex-grow border-t border"},fn={key:0,class:"ml-1.5 text-body"},pn={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},vn={key:1,class:"flex-grow border-t border"},rt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:o}){const l=t,s=o,m=q(!1),d={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},p=A(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(u=>!d[u]);const w=Object.entries(d).filter(([,u])=>u===l.activeTab).map(([u])=>u);return l.actions.filter(u=>w.includes(u))}),n=A(()=>l.activeTab==="communication"?!0:p.value.length===1),v=A(()=>{if(l.activeTab==="communication")return"add communication";if(!n.value||p.value.length!==1)return"";const w=p.value[0];return{note:"add note",attachment:"add attachment"}[w]||""}),c=A(()=>l.activeTab==="communication"?!1:p.value.length>1),a=A(()=>{const w={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return p.value.map(u=>({key:u,label:w[u]||u,onClick:()=>k(u)}))}),f=A(()=>{if(l.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const w="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return n.value?`${w} px-4 py-2 h-9`:`${w} w-9 h-9`});A(()=>p.value.some(w=>["email","whatsapp","sms"].includes(w))),A(()=>p.value.some(w=>["addVehicle","configureVehicle"].includes(w))),A(()=>p.value.some(w=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(w)));const k=w=>{m.value=!1,s("action",w)},I=()=>{if(l.activeTab==="communication"){k("call");return}n.value&&p.value.length===1?k(p.value[0]):m.value=!m.value};return(w,u)=>{const h=Ye("click-outside");return t.show?(i(),r("div",{key:0,class:R(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?g("",!0):(i(),r("div",mn)),e("div",{class:R(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:ee(I,["stop"]),class:R(f.value)},[u[0]||(u[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),n.value?(i(),r("span",fn,b(v.value),1)):g("",!0)],2),m.value&&c.value?C((i(),r("div",pn,[D($(Qe),{items:a.value,className:"w-48"},null,8,["items"])])),[[h,()=>m.value=!1]]):g("",!0)],2),t.inline?g("",!0):(i(),r("div",vn))],2)):g("",!0)}}},yn={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},bn={class:"flex items-start gap-3"},gn={class:"flex-1 min-w-0"},xn={class:"font-bold text-sm text-heading mb-2"},hn={class:"space-y-1.5 text-xs text-gray-600"},kn={class:"flex items-center gap-2"},wn={class:"flex items-center gap-2"},$n={class:"flex items-center gap-2"},In={key:0,class:"mt-2"},Tn={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const o=t,l=A(()=>o.appointmentData.date?new Date(o.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),s=A(()=>o.appointmentData.time?o.appointmentData.time:""),m=d=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[d==null?void 0:d.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(d,p)=>(i(),r("div",yn,[e("div",bn,[p[3]||(p[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",gn,[e("h4",xn,b(t.appointmentData.type),1),e("div",hn,[e("div",kn,[p[0]||(p[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,b(l.value),1)]),e("div",wn,[p[1]||(p[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,b(s.value),1)]),e("div",$n,[p[2]||(p[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,b(t.appointmentData.assignee),1)])]),t.appointmentData.status?(i(),r("div",In,[e("span",{class:R(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",m(t.appointmentData.status)])},b(t.appointmentData.status),3)])):g("",!0)])])]))}},Cn={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Sn={class:"flex-1"},An={class:"flex items-center gap-2 mb-1"},Dn={class:"text-meta-bold text-heading"},En={class:"text-meta"},Vn={class:"text-meta"},Ln={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},Pn={class:"ml-auto relative"},Mn={key:0,class:"absolute right-0 top-full mt-1 z-10"},On={key:0,class:"text-content text-body"},Rn={key:1,class:"text-content text-body flex items-center gap-2"},qn={key:2,class:"mt-2"},Fn={key:0},Bn={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},Un={key:0},Nn={class:"text-content font-bold text-heading"},jn={key:0,class:"text-meta mt-0.5"},Wn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},zn={key:0},Hn={key:1},Yn={key:2},Qn={key:3},Gn={key:4},Kn={key:1},Jn={class:"text-content font-bold text-heading mb-2"},Xn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},Zn={key:0},_n={class:"text-body font-medium ml-1"},es={key:1},ts={class:"text-body font-medium ml-1"},ls={key:2},as={class:"text-body font-medium ml-1"},ns={key:3},ss={class:"text-body font-medium ml-1"},is={key:4},os={class:"text-body font-medium ml-1"},rs={key:5},ds={class:"text-body font-medium ml-1"},us={key:2,class:"flex items-center gap-3"},cs={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},ms=["src"],fs={class:"flex-1"},ps={class:"text-content font-bold text-heading"},vs={class:"text-meta"},ys={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},bs={key:3,class:"flex items-center gap-3"},gs={class:"flex-1"},xs={class:"text-content font-bold text-heading"},hs={class:"text-meta"},ks={key:0,class:"text-meta mt-1"},ws={key:1,class:"text-meta mt-1"},$s={key:4},Is={class:"text-content font-bold text-heading mb-2"},Ts={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},Cs={key:0},Ss={class:"text-body font-medium ml-1"},As={key:1},Ds={class:"text-body font-medium ml-1"},Es={key:2},Vs={class:"text-body font-medium ml-1"},Ls={key:3},Ps={class:"text-body font-medium ml-1"},Ms={key:4},Os={class:"text-body font-medium ml-1"},Rs={key:5},qs={class:"text-body font-medium ml-1"},Fs={key:0,class:"flex flex-wrap gap-2 mt-2"},Bs={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Us={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},Ns={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},je={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:o}){const l=t,s=o,m=q(!1),d=A(()=>[{key:"edit",label:"Edit",onClick:f},{key:"delete",label:"Delete",onClick:k}]),p=I=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[I]||"fa-solid fa-circle",n=I=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[I]||"bg-surfaceSecondary text-body border",v=I=>{if(!I)return"Just now";const w=new Date(I),h=new Date-w,S=Math.floor(h/6e4),x=Math.floor(S/60),M=Math.floor(x/24);return S<1?"Just now":S<60?`${S} minutes ago`:x<24?`${x} hours ago`:M===1?"Yesterday":M<7?`${M} days ago`:w.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},c=I=>I?new Intl.NumberFormat("en-US").format(I):"0",a=I=>I?new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",f=()=>{m.value=!1,s("edit",l.item)},k=()=>{m.value=!1,confirm("Are you sure you want to delete this item?")&&s("delete",l.item)};return(I,w)=>{const u=Ye("click-outside");return i(),r("div",Cn,[e("div",{class:R(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",n(t.item.type)])},[e("i",{class:R([p(t.item.type),"text-sm"])},null,2)],2),e("div",Sn,[e("div",An,[e("span",Dn,b(t.customerInitials),1),e("span",En,b(t.item.action||"added"),1),e("span",Vn,"• "+b(v(t.item.timestamp)),1),t.item.autoDetected?(i(),r("span",Ln,"Auto-detected")):g("",!0),e("div",Pn,[e("button",{onClick:w[0]||(w[0]=ee(h=>m.value=!m.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),m.value?C((i(),r("div",Mn,[D($(Qe),{items:d.value,className:"w-32"},null,8,["items"])])),[[u,()=>m.value=!1]]):g("",!0)])]),t.item.content?(i(),r("div",On,b(t.item.content),1)):g("",!0),t.item.fileName?(i(),r("div",Rn,[w[2]||(w[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,b(t.item.fileName),1)])):g("",!0),t.item.data?(i(),r("div",qn,[t.item.type==="appointment"?(i(),r("div",Fn,[D(Tn,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(i(),r("div",Bn,[t.item.type==="tradein"?(i(),r("div",Un,[e("h4",Nn,b(t.item.data.brand)+" "+b(t.item.data.model),1),t.item.data.version?(i(),r("p",jn,b(t.item.data.version),1)):g("",!0),e("div",Wn,[t.item.data.year?(i(),r("div",zn,[w[3]||(w[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(b(t.item.data.year),1)])):g("",!0),t.item.data.km?(i(),r("div",Hn,[w[4]||(w[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(b(t.item.data.km)+" km ",1)])):g("",!0),t.item.data.plate?(i(),r("div",Yn,[w[5]||(w[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(b(t.item.data.plate),1)])):g("",!0),t.item.data.date?(i(),r("div",Qn,[w[6]||(w[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(b(a(t.item.data.date)),1)])):g("",!0),t.item.data.class?(i(),r("div",Gn,[w[7]||(w[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(b(t.item.data.class),1)])):g("",!0)])])):t.item.type==="financing"?(i(),r("div",Kn,[e("h4",Jn,b(t.item.data.product),1),e("div",Xn,[t.item.data.provider?(i(),r("div",Zn,[w[8]||(w[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",_n,b(t.item.data.provider),1)])):g("",!0),t.item.data.total?(i(),r("div",es,[w[9]||(w[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",ts,"€"+b(c(t.item.data.total)),1)])):g("",!0),t.item.data.monthly?(i(),r("div",ls,[w[10]||(w[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",as,"€"+b(c(t.item.data.monthly)),1)])):g("",!0),t.item.data.deposit?(i(),r("div",ns,[w[11]||(w[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",ss,"€"+b(c(t.item.data.deposit)),1)])):g("",!0),t.item.data.startDate?(i(),r("div",is,[w[12]||(w[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",os,b(a(t.item.data.startDate)),1)])):g("",!0),t.item.data.expDate?(i(),r("div",rs,[w[13]||(w[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",ds,b(a(t.item.data.expDate)),1)])):g("",!0)])])):t.item.type==="offer"?(i(),r("div",us,[t.item.data.image?(i(),r("div",cs,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ms)])):g("",!0),e("div",fs,[e("h4",ps,b(t.item.data.brand)+" "+b(t.item.data.model)+" ("+b(t.item.data.year)+")",1),e("p",vs,"€ "+b(c(t.item.data.price)),1)]),t.item.data.isMainOffer?(i(),r("span",ys,"Main Offer")):g("",!0)])):t.item.type==="purchase"?(i(),r("div",bs,[e("div",gs,[e("h4",xs,b(t.item.data.brand)+" "+b(t.item.data.model)+" ("+b(t.item.data.year)+")",1),e("p",hs,"€ "+b(c(t.item.data.price)),1),t.item.data.purchaseDate?(i(),r("p",ks,"Purchased: "+b(a(t.item.data.purchaseDate)),1)):g("",!0),t.item.data.notes?(i(),r("p",ws,b(t.item.data.notes),1)):g("",!0)])])):t.item.type==="purchase-method"?(i(),r("div",$s,[e("h4",Is,b(t.item.data.typeLabel||t.item.data.type),1),e("div",Ts,[t.item.data.monthlyInstalment?(i(),r("div",Cs,[w[14]||(w[14]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Ss,"€"+b(c(t.item.data.monthlyInstalment)),1)])):g("",!0),t.item.data.duration?(i(),r("div",As,[w[15]||(w[15]=e("span",{class:"text-gray-500"},"Duration:",-1)),e("span",Ds,b(t.item.data.duration)+" months",1)])):g("",!0),t.item.data.downPayment?(i(),r("div",Es,[w[16]||(w[16]=e("span",{class:"text-gray-500"},"Down Payment:",-1)),e("span",Vs,"€"+b(c(t.item.data.downPayment)),1)])):g("",!0),t.item.data.interestRate?(i(),r("div",Ls,[w[17]||(w[17]=e("span",{class:"text-gray-500"},"Interest Rate:",-1)),e("span",Ps,b(t.item.data.interestRate)+"%",1)])):g("",!0),t.item.data.mileageLimit?(i(),r("div",Ms,[w[18]||(w[18]=e("span",{class:"text-gray-500"},"Mileage Limit:",-1)),e("span",Os,b(c(t.item.data.mileageLimit))+" km/year",1)])):g("",!0),t.item.data.customerType?(i(),r("div",Rs,[w[19]||(w[19]=e("span",{class:"text-gray-500"},"Customer Type:",-1)),e("span",qs,b(t.item.data.customerType),1)])):g("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(i(),r("div",Fs,[t.item.data.insuranceIncluded?(i(),r("span",Bs,"Insurance")):g("",!0),t.item.data.maintenanceIncluded?(i(),r("span",Us,"Maintenance")):g("",!0),t.item.data.registrationTaxesIncluded?(i(),r("span",Ns,"Registration/Taxes")):g("",!0)])):g("",!0)])):g("",!0)]))])):g("",!0)])])}}},js={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Ws={class:"flex items-center gap-3"},zs=["title"],Hs={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},Ys={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},Qs={key:2,class:"font-bold text-fluid-lg text-heading"},Gs={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Ks={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},Js={key:1,class:"text-center py-8 text-sub relative z-10"},Xs={class:"text-fluid-sm"},Zs={key:2,class:"space-y-6 relative z-10"},_s={key:0,class:"mb-4 pl-12"},ei={class:"text-fluid-sm font-semibold text-heading"},ti={class:"flex gap-4 relative mb-6"},li={class:"flex-1 min-w-0"},ai={class:"text-fluid-sm text-slate-700 leading-snug"},ni={class:"font-bold"},si={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},ii={class:"text-fluid-xs text-sub mt-1"},oi={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},ri={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},di={key:1,class:"space-y-4 relative z-10"},ui=["title"],ci={key:2,class:"text-center py-8 text-sub relative z-10"},mi={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:o}){const l=t,s=v=>{const c={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return c[v]||c.default},m=v=>{const c={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return c[v]||c.default},d=v=>{if(!v)return"";const c=new Date(v),a=new Date,f=new Date(a);return f.setDate(f.getDate()-1),c.toDateString()===a.toDateString()?"Today":c.toDateString()===f.toDateString()?"Yesterday":c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=v=>v?new Date(v).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",n=(v,c)=>{if(v===0)return!0;const a=l.activities[v-1];if(!a)return!0;const f=new Date(c.timestamp).toDateString(),k=new Date(a.timestamp).toDateString();return f!==k};return(v,c)=>t.show?(i(),r("div",{key:0,class:R(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",js,[e("div",Ws,[t.mobileFullscreen?(i(),r("button",{key:0,onClick:c[0]||(c[0]=a=>v.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(i(),r("button",{key:1,onClick:c[1]||(c[1]=a=>v.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(i(),r("i",Hs)):(i(),r("i",Ys))],8,zs)):g("",!0),t.collapsed?g("",!0):(i(),r("h2",Qs,b(t.title),1))])]),t.collapsed?(i(),r("div",oi,[t.activities.length>0?(i(),r("div",ri)):g("",!0),t.activities.length>0?(i(),r("div",di,[(i(!0),r(Y,null,K(t.activities,a=>(i(),r("div",{key:a.id,class:"relative"},[e("div",{class:R(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",m(a.type)]),title:`${a.user} ${a.action}`},[e("i",{class:R([s(a.type),"text-fluid-xs"])},null,2)],10,ui)]))),128))])):(i(),r("div",ci,[...c[4]||(c[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(i(),r("div",Gs,[t.activities.length>0?(i(),r("div",Ks)):g("",!0),t.activities.length===0?(i(),r("div",Js,[c[3]||(c[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Xs,b(t.emptyMessage),1)])):(i(),r("div",Zs,[(i(!0),r(Y,null,K(t.activities,(a,f)=>(i(),r(Y,{key:a.id},[n(f,a)?(i(),r("div",_s,[e("h3",ei,b(d(a.timestamp)),1)])):g("",!0),e("div",ti,[e("div",{class:R(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",m(a.type)])},[e("i",{class:R([s(a.type),"text-fluid-sm"])},null,2)],2),e("div",li,[e("div",ai,[e("span",ni,b(a.user),1),N(" "+b(a.action),1)]),a.content?(i(),r("div",si,b(a.content),1)):g("",!0),e("div",ii,b(p(a.timestamp)),1)])])],64))),128))]))]))],2)):g("",!0)}},fi={class:"space-y-3"},pi={class:"flex justify-end gap-2"},dt={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,s=o,m=q(l.initialTemplate),d=q(""),p=q(l.initialMessage),n={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},v=()=>{m.value&&n[m.value]&&(d.value=n[m.value].subject,p.value=n[m.value].message)},c=()=>{p.value.trim()&&s("send",{type:"email",template:m.value,subject:d.value,message:p.value})};return(a,f)=>(i(),r("div",fi,[e("div",null,[f[5]||(f[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":f[0]||(f[0]=k=>m.value=k),onChange:v,class:"input"},[...f[4]||(f[4]=[ye('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[X,m.value]])]),e("div",null,[f[6]||(f[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),C(e("input",{"onUpdate:modelValue":f[1]||(f[1]=k=>d.value=k),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[O,d.value]])]),e("div",null,[f[7]||(f[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":f[2]||(f[2]=k=>p.value=k),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[O,p.value]])]),e("div",pi,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:f[3]||(f[3]=k=>a.$emit("cancel"))}),D($(z),{label:"Send Email",variant:"primary",size:"small",onClick:c})])]))}},vi={class:"space-y-3"},yi={class:"text-fluid-xs text-sub mt-1"},bi={class:"flex justify-end gap-2"},ut={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,s=o,m=q(l.initialTemplate),d=q(l.initialMessage),p={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},n=()=>{m.value&&p[m.value]&&(d.value=p[m.value])},v=()=>{d.value.trim()&&s("send",{type:"sms",template:m.value,message:d.value})};return(c,a)=>(i(),r("div",vi,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":a[0]||(a[0]=f=>m.value=f),onChange:n,class:"input"},[...a[3]||(a[3]=[ye('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[X,m.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=f=>d.value=f),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[O,d.value]]),e("p",yi,b(d.value.length)+"/160 characters",1)]),e("div",bi,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=f=>c.$emit("cancel"))}),D($(z),{label:"Send SMS",variant:"primary",size:"small",onClick:v})])]))}},gi={class:"space-y-3"},xi={class:"flex justify-end gap-2"},ct={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,s=o,m=q(l.initialTemplate),d=q(l.initialMessage),p={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},n=()=>{m.value&&p[m.value]&&(d.value=p[m.value])},v=()=>{d.value.trim()&&s("send",{type:"whatsapp",template:m.value,message:d.value})};return(c,a)=>(i(),r("div",gi,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":a[0]||(a[0]=f=>m.value=f),onChange:n,class:"input"},[...a[3]||(a[3]=[ye('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[X,m.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=f=>d.value=f),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[O,d.value]])]),e("div",xi,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=f=>c.$emit("cancel"))}),D($(z),{label:"Send WhatsApp",variant:"outline",size:"small",onClick:v})])]))}},hi={class:"space-y-3"},ki={class:"space-y-2"},wi={class:"flex-1"},$i={class:"text-xs text-sub uppercase"},Ii={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},mt={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:o}){const l=t,s=o,m=q(""),d=p=>{p==="copy"&&navigator.clipboard.writeText(l.phoneNumber),s("call",{type:"call",option:p,phoneNumber:l.phoneNumber,notes:m.value})};return(p,n)=>(i(),r("div",hi,[e("div",ki,[n[10]||(n[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:n[0]||(n[0]=v=>d("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...n[5]||(n[5]=[ye('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:n[1]||(n[1]=v=>d("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...n[6]||(n[6]=[ye('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:n[2]||(n[2]=v=>d("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[n[8]||(n[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",wi,[n[7]||(n[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",$i,b(t.phoneNumber),1)]),n[9]||(n[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),C(e("textarea",{"onUpdate:modelValue":n[3]||(n[3]=v=>m.value=v),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[O,m.value]])]),e("div",Ii,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:n[4]||(n[4]=v=>p.$emit("cancel"))})])]))}},Ti={key:0,class:"space-y-4"},Ci={class:"grid grid-cols-4 gap-2"},Si=["onClick"],Ai={class:"text-xs font-bold uppercase tracking-wider"},Di={key:1,class:"space-y-4"},Ei={class:"grid grid-cols-4 gap-2"},Vi=["onClick"],Li={class:"text-xs font-bold uppercase tracking-wider"},Pi={key:0},ft={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:o}){const l=t,s=o,m=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],d=q(l.type);re(()=>l.type,a=>{a?d.value=a:d.value=null}),re(()=>l.taskId,()=>{d.value=null});const p=A(()=>a=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${d.value===a?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),n=a=>{s("save",{type:"communication",action:`sent via ${a.type}`,content:a.message,communicationType:a.type,template:a.template,subject:a.subject}),s("send",a)},v=a=>{s("save",{type:"communication",action:`called via ${a.option}`,content:a.notes||"Call attempt logged",communicationType:"call",callOption:a.option}),s("send",{type:"call",option:a.option,phoneNumber:a.phoneNumber,notes:a.notes})},c=()=>{d.value=null,s("cancel")};return(a,f)=>t.inline?(i(),r("div",Di,[e("div",Ei,[(i(),r(Y,null,K(m,k=>e("button",{key:k.id,onClick:I=>d.value=k.id,class:R(p.value(k.id))},[e("i",{class:R([k.icon,"text-sm"])},null,2),e("span",Li,b(k.label),1)],10,Vi)),64))]),d.value?(i(),r("div",Pi,[d.value==="email"?(i(),j(dt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="sms"?(i(),j(ut,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="whatsapp"?(i(),j(ct,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="call"?(i(),j(mt,{key:3,"phone-number":t.phoneNumber,onCall:v,onCancel:c},null,8,["phone-number"])):g("",!0)])):g("",!0)])):(i(),r("div",Ti,[e("div",Ci,[(i(),r(Y,null,K(m,k=>e("button",{key:k.id,onClick:I=>d.value=k.id,class:R(p.value(k.id))},[e("i",{class:R([k.icon,"text-sm"])},null,2),e("span",Ai,b(k.label),1)],10,Si)),64))]),e("div",null,[d.value==="email"?(i(),j(dt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="sms"?(i(),j(ut,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="whatsapp"?(i(),j(ct,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:n,onCancel:c},null,8,["initial-template","initial-message"])):d.value==="call"?(i(),j(mt,{key:3,"phone-number":t.phoneNumber,onCall:v,onCancel:c},null,8,["phone-number"])):g("",!0)])]))}},Mi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Oi={key:1,class:"flex justify-between items-center mb-4"},Ri={class:"text-fluid-sm font-semibold text-heading"},qi={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},pt={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const s=t,m=l,d=q("");be(()=>{s.item&&(d.value=s.item.content||"")});const p=()=>{var n,v;d.value.trim()&&m("save",{id:((n=s.item)==null?void 0:n.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:d.value,timestamp:((v=s.item)==null?void 0:v.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return o({submit:p,canSubmit:()=>!!d.value.trim()}),(n,v)=>(i(),r("div",{class:R(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?g("",!0):(i(),r("div",Mi)),t.hideHeader?g("",!0):(i(),r("div",Oi,[e("h5",Ri,b(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:v[0]||(v[0]=c=>n.$emit("cancel")),class:"text-sub hover:text-body"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[v[4]||(v[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),C(e("textarea",{"onUpdate:modelValue":v[1]||(v[1]=c=>d.value=c),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[O,d.value]])]),t.hideActions?g("",!0):(i(),r("div",qi,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:v[2]||(v[2]=c=>n.$emit("cancel"))}),D($(z),{label:"Save",variant:"primary",size:"small",onClick:p})]))],2))}},Fi={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Bi={class:"flex justify-between items-center mb-4"},Ui={class:"text-fluid-sm font-semibold text-heading"},Ni={class:"flex items-center gap-3"},ji={key:0,class:"text-fluid-sm text-slate-600"},Wi={key:1,class:"text-fluid-sm text-sub"},zi={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},vt={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:o}){const l=t,s=o,m=q(null),d=q("");be(()=>{l.item&&(d.value=l.item.fileName||"")});const p=v=>{const c=v.target.files[0];c&&(m.value=c,d.value=c.name)},n=()=>{var v,c;!m.value&&!l.item||s("save",{id:((v=l.item)==null?void 0:v.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:d.value,timestamp:((c=l.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return(v,c)=>(i(),r("div",Fi,[c[5]||(c[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Bi,[e("h5",Ui,b(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:c[0]||(c[0]=a=>v.$emit("cancel")),class:"text-sub hover:text-body"},[...c[3]||(c[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[c[4]||(c[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Ni,[e("input",{type:"file",onChange:p,ref:"fileInput",class:"hidden"},null,544),D($(z),{label:"Choose File",variant:"outline",size:"small",onClick:c[1]||(c[1]=a=>v.$refs.fileInput.click())}),d.value?(i(),r("span",ji,b(d.value),1)):(i(),r("span",Wi,"No file selected"))])]),e("div",zi,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:c[2]||(c[2]=a=>v.$emit("cancel"))}),D($(z),{label:"Save",variant:"primary",size:"small",disabled:!m.value,onClick:n},null,8,["disabled"])])]))}},Hi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Yi={key:1,class:"flex justify-between items-center mb-4"},Qi={class:"text-fluid-sm font-semibold text-heading"},Gi={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ki=["max"],Ji={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xi={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Zi={class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},_i={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},eo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},to={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lo={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},ao={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const s=t,m=l,d=q(!1),p=q({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),n=q({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),v=A(()=>!!p.value.brand&&!!p.value.model&&!!p.value.year);be(()=>{s.item&&s.item.data&&(p.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",version:s.item.data.version||"",vin:s.item.data.vin||"",plates:s.item.data.plate||s.item.data.plates||"",fuelType:s.item.data.fuelType||"",gearType:s.item.data.gearType||"",kilometers:s.item.data.km||s.item.data.kilometers||"",registration:s.item.data.date||s.item.data.registration||""},s.item.data.tradeInPrice!==void 0&&(n.value={tradeInPrice:s.item.data.tradeInPrice||null,evaluationRangeLow:s.item.data.evaluationRangeLow||null,evaluationRangeHigh:s.item.data.evaluationRangeHigh||null,provider:s.item.data.provider||"",evaluationDate:s.item.data.evaluationDate||""},d.value=!0))});const c=()=>{var f,k;if(!v.value)return;const a={id:((f=s.item)==null?void 0:f.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",timestamp:((k=s.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!s.item,data:{brand:p.value.brand,model:p.value.model,year:parseInt(p.value.year)||null,version:p.value.version||null,vin:p.value.vin||null,plate:p.value.plates||null,plates:p.value.plates||null,fuelType:p.value.fuelType||null,gearType:p.value.gearType||null,km:parseInt(p.value.kilometers)||0,kilometers:parseInt(p.value.kilometers)||0,date:p.value.registration||null,registration:p.value.registration||null,tradeInPrice:n.value.tradeInPrice,evaluationRangeLow:n.value.evaluationRangeLow,evaluationRangeHigh:n.value.evaluationRangeHigh,provider:n.value.provider||null,evaluationDate:n.value.evaluationDate||null}};m("save",a)};return o({submit:c,canSubmit:()=>v.value}),(a,f)=>(i(),r("div",{class:R(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?g("",!0):(i(),r("div",Hi)),t.hideHeader?g("",!0):(i(),r("div",Yi,[e("h5",Qi,b(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:f[0]||(f[0]=k=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...f[18]||(f[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ee(c,["prevent"]),class:"space-y-4"},[e("div",Gi,[e("div",null,[f[19]||(f[19]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Brand "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("input",{"onUpdate:modelValue":f[1]||(f[1]=k=>p.value.brand=k),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[O,p.value.brand]])]),e("div",null,[f[20]||(f[20]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Model "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("input",{"onUpdate:modelValue":f[2]||(f[2]=k=>p.value.model=k),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[O,p.value.model]])]),e("div",null,[f[21]||(f[21]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Year "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("input",{"onUpdate:modelValue":f[3]||(f[3]=k=>p.value.year=k),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,Ki),[[O,p.value.year]])])]),e("div",null,[f[22]||(f[22]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Version/Trim",-1)),C(e("input",{"onUpdate:modelValue":f[4]||(f[4]=k=>p.value.version=k),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[O,p.value.version]])]),e("div",Ji,[e("div",null,[f[23]||(f[23]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"VIN",-1)),C(e("input",{"onUpdate:modelValue":f[5]||(f[5]=k=>p.value.vin=k),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[O,p.value.vin]])]),e("div",null,[f[24]||(f[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Plates",-1)),C(e("input",{"onUpdate:modelValue":f[6]||(f[6]=k=>p.value.plates=k),type:"text",placeholder:"License plate number",class:"input"},null,512),[[O,p.value.plates]])])]),e("div",Xi,[e("div",null,[f[26]||(f[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Fuel Type",-1)),C(e("select",{"onUpdate:modelValue":f[7]||(f[7]=k=>p.value.fuelType=k),class:"input"},[...f[25]||(f[25]=[ye('<option value="">Select fuel type...</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[X,p.value.fuelType]])]),e("div",null,[f[28]||(f[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Gear Type",-1)),C(e("select",{"onUpdate:modelValue":f[8]||(f[8]=k=>p.value.gearType=k),class:"input"},[...f[27]||(f[27]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[X,p.value.gearType]])]),e("div",null,[f[29]||(f[29]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage (km)",-1)),C(e("input",{"onUpdate:modelValue":f[9]||(f[9]=k=>p.value.kilometers=k),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[O,p.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[f[30]||(f[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Registration Year/Month",-1)),C(e("input",{"onUpdate:modelValue":f[10]||(f[10]=k=>p.value.registration=k),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[O,p.value.registration]])]),e("div",Zi,[e("button",{type:"button",onClick:f[11]||(f[11]=k=>d.value=!d.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-card"},[f[31]||(f[31]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:R(["fa-solid transition-transform duration-200 text-sub",d.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),d.value?(i(),r("div",_i,[e("div",null,[f[32]||(f[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Trade-In Price (€)",-1)),C(e("input",{"onUpdate:modelValue":f[12]||(f[12]=k=>n.value.tradeInPrice=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,n.value.tradeInPrice,void 0,{number:!0}]])]),e("div",eo,[e("div",null,[f[33]||(f[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - Low (€)",-1)),C(e("input",{"onUpdate:modelValue":f[13]||(f[13]=k=>n.value.evaluationRangeLow=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,n.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[f[34]||(f[34]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - High (€)",-1)),C(e("input",{"onUpdate:modelValue":f[14]||(f[14]=k=>n.value.evaluationRangeHigh=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,n.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",to,[e("div",null,[f[36]||(f[36]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Provider",-1)),C(e("select",{"onUpdate:modelValue":f[15]||(f[15]=k=>n.value.provider=k),class:"input"},[...f[35]||(f[35]=[ye('<option value="">Select provider...</option><option value="Eurotax">Eurotax</option><option value="Infocar">Infocar</option><option value="Manual">Manual</option><option value="Other">Other</option>',5)])],512),[[X,n.value.provider]])]),e("div",null,[f[37]||(f[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Date",-1)),C(e("input",{"onUpdate:modelValue":f[16]||(f[16]=k=>n.value.evaluationDate=k),type:"date",class:"input"},null,512),[[O,n.value.evaluationDate]])])])])):g("",!0)])],32),t.hideActions?g("",!0):(i(),r("div",lo,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:f[17]||(f[17]=k=>a.$emit("cancel"))}),D($(z),{label:"Save",variant:"primary",size:"small",disabled:!v.value,onClick:c},null,8,["disabled"])]))],2))}},no={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},so={key:1,class:"flex justify-between items-center mb-4"},io={class:"text-fluid-sm font-semibold text-heading"},oo={class:"flex gap-2"},ro=["value"],uo={key:0,class:"space-y-4"},co={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},mo={class:"relative"},fo={key:0,class:"text-xs text-red-600 mt-1"},po={class:"relative"},vo={key:0,class:"text-xs text-red-600 mt-1"},yo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo=["value"],go={key:0,class:"text-xs text-red-600 mt-1"},xo={key:0},ho={class:"relative"},ko={key:1},wo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$o={class:"relative"},Io={class:"relative"},To={class:"flex items-center gap-2"},Co={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},So={class:"relative"},Ao={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Do={class:"flex justify-between items-center"},Eo={class:"text-lg font-bold text-heading"},Vo={class:"flex flex-col gap-2"},Lo={class:"flex items-center gap-2"},Po={class:"flex items-center gap-2"},Mo={key:0,class:"text-xs text-red-600 mt-1"},Oo={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Ro={class:"flex justify-between items-center"},qo={class:"text-lg font-bold text-heading"},Fo={class:"flex flex-col gap-2"},Bo={class:"flex items-center gap-2"},Uo={class:"flex items-center gap-2"},No={class:"flex items-center gap-2"},jo={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Wo={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const s=t,m=l,d=q({}),p=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],n=q({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),v=A(()=>{if(n.value.type!=="LEA")return 0;const S=parseFloat(n.value.fields.monthlyInstalment)||0,x=parseInt(n.value.fields.duration)||0,M=parseFloat(n.value.fields.downPayment)||0,Z=parseFloat(n.value.fields.finalInstalment)||0;return S*x+M+Z}),c=A(()=>{if(n.value.type!=="LTR")return 0;const S=parseFloat(n.value.fields.monthlyInstalment)||0,x=parseInt(n.value.fields.duration)||0,M=parseFloat(n.value.fields.downPayment)||0;return S*x+M}),a=S=>S==="FIN"?[12,24,36,48,60]:S==="LEA"?[24,36,48,60]:S==="LTR"?[12,24,36,48,60]:[],f=S=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[S]||S,k=S=>S?new Intl.NumberFormat("en-US").format(S):"0",I=S=>{delete d.value[S]},w=A(()=>!n.value.type||!n.value.fields.monthlyInstalment||n.value.fields.monthlyInstalment<=0||n.value.fields.downPayment===null||n.value.fields.downPayment===void 0||n.value.fields.downPayment<0||!n.value.fields.duration||n.value.fields.duration<12||n.value.fields.duration>60||n.value.type==="LTR"&&!n.value.fields.customerType?!1:Object.keys(d.value).length===0),u=()=>{n.value.type!=="FIN"&&(n.value.fields.effectiveInterestRate=null,n.value.fields.gfv=null),n.value.type!=="LEA"&&(n.value.fields.finalInstalment=null),n.value.type!=="LTR"&&(n.value.fields.customerType="",n.value.fields.registrationTaxesIncluded=!1),n.value.type!=="LEA"&&n.value.type!=="LTR"&&(n.value.fields.mileageLimit=null,n.value.fields.maintenanceIncluded=!1),d.value={}};be(()=>{s.item&&s.item.data&&(n.value={type:s.item.data.type||"",fields:{monthlyInstalment:s.item.data.monthlyInstalment||null,downPayment:s.item.data.downPayment||null,duration:s.item.data.duration||null,interestRate:s.item.data.interestRate||null,effectiveInterestRate:s.item.data.effectiveInterestRate||null,gfv:s.item.data.gfv||null,mileageLimit:s.item.data.mileageLimit||null,finalInstalment:s.item.data.finalInstalment||null,customerType:s.item.data.customerType||"",insuranceIncluded:s.item.data.insuranceIncluded||!1,maintenanceIncluded:s.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:s.item.data.registrationTaxesIncluded||!1}})});const h=()=>{var ae,de;if(!w.value)return;const S=f(n.value.type),x=n.value.fields.monthlyInstalment||0,M=n.value.fields.duration||0,Z={id:((ae=s.item)==null?void 0:ae.id)||Date.now(),type:"purchase-method",action:s.item?"updated a purchase method":"added a purchase method",content:`${S}: €${k(x)}/month for ${M} months`,timestamp:((de=s.item)==null?void 0:de.timestamp)||new Date().toISOString(),isEdit:!!s.item,data:{type:n.value.type,typeLabel:S,monthlyInstalment:n.value.fields.monthlyInstalment,downPayment:n.value.fields.downPayment,duration:n.value.fields.duration,interestRate:n.value.fields.interestRate,effectiveInterestRate:n.value.fields.effectiveInterestRate,gfv:n.value.fields.gfv,mileageLimit:n.value.fields.mileageLimit,finalInstalment:n.value.fields.finalInstalment,customerType:n.value.fields.customerType,insuranceIncluded:n.value.fields.insuranceIncluded,maintenanceIncluded:n.value.fields.maintenanceIncluded,registrationTaxesIncluded:n.value.fields.registrationTaxesIncluded,totalLeasingAmount:v.value,totalRentalAmount:c.value}};m("save",Z)};return o({submit:h,canSubmit:()=>w.value}),(S,x)=>(i(),r("div",{class:R(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?g("",!0):(i(),r("div",no)),t.hideHeader?g("",!0):(i(),r("div",so,[e("h5",io,b(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:x[0]||(x[0]=M=>S.$emit("cancel")),class:"text-sub hover:text-body"},[...x[23]||(x[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ee(h,["prevent"]),class:"space-y-4"},[e("div",null,[x[24]||(x[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},[N("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",oo,[(i(),r(Y,null,K(p,M=>e("label",{key:M.value,class:"flex-1 cursor-pointer"},[C(e("input",{type:"radio",value:M.value,"onUpdate:modelValue":x[1]||(x[1]=Z=>n.value.type=Z),class:"sr-only",onChange:u},null,40,ro),[[xt,n.value.type]]),e("div",{class:R(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",n.value.type===M.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},b(M.label),3)])),64))])]),n.value.type?(i(),r("div",uo,[e("div",co,[e("div",null,[x[26]||(x[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",mo,[x[25]||(x[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":x[2]||(x[2]=M=>n.value.fields.monthlyInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:R(["input pl-8",{"border-red-500":d.value.monthlyInstalment}]),onInput:x[3]||(x[3]=M=>I("monthlyInstalment"))},null,34),[[O,n.value.fields.monthlyInstalment,void 0,{number:!0}]])]),d.value.monthlyInstalment?(i(),r("p",fo,b(d.value.monthlyInstalment),1)):g("",!0)]),e("div",null,[x[28]||(x[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",po,[x[27]||(x[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":x[4]||(x[4]=M=>n.value.fields.downPayment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:R(["input pl-8",{"border-red-500":d.value.downPayment}]),onInput:x[5]||(x[5]=M=>I("downPayment"))},null,34),[[O,n.value.fields.downPayment,void 0,{number:!0}]])]),d.value.downPayment?(i(),r("p",vo,b(d.value.downPayment),1)):g("",!0)])]),e("div",yo,[e("div",null,[x[30]||(x[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":x[6]||(x[6]=M=>n.value.fields.duration=M),class:R(["input",{"border-red-500":d.value.duration}]),onChange:x[7]||(x[7]=M=>I("duration"))},[x[29]||(x[29]=e("option",{value:""},"Select duration...",-1)),(i(!0),r(Y,null,K(a(n.value.type),M=>(i(),r("option",{key:M,value:M},b(M)+" months ",9,bo))),128))],34),[[X,n.value.fields.duration,void 0,{number:!0}]]),d.value.duration?(i(),r("p",go,b(d.value.duration),1)):g("",!0)]),n.value.type==="FIN"||n.value.type==="LEA"?(i(),r("div",xo,[x[32]||(x[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Interest Rate / APR (%)",-1)),e("div",ho,[C(e("input",{"onUpdate:modelValue":x[8]||(x[8]=M=>n.value.fields.interestRate=M),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:x[9]||(x[9]=M=>I("interestRate"))},null,544),[[O,n.value.fields.interestRate,void 0,{number:!0}]]),x[31]||(x[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])])):g("",!0),n.value.type==="LEA"||n.value.type==="LTR"?(i(),r("div",ko,[x[33]||(x[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage Limit (annual km)",-1)),C(e("input",{"onUpdate:modelValue":x[10]||(x[10]=M=>n.value.fields.mileageLimit=M),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[O,n.value.fields.mileageLimit,void 0,{number:!0}]])])):g("",!0)]),n.value.type==="FIN"?(i(),r(Y,{key:0},[e("div",wo,[e("div",null,[x[35]||(x[35]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",$o,[C(e("input",{"onUpdate:modelValue":x[11]||(x[11]=M=>n.value.fields.effectiveInterestRate=M),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[O,n.value.fields.effectiveInterestRate,void 0,{number:!0}]]),x[34]||(x[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])]),e("div",null,[x[37]||(x[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Io,[x[36]||(x[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":x[12]||(x[12]=M=>n.value.fields.gfv=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[O,n.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",To,[C(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":x[13]||(x[13]=M=>n.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.insuranceIncluded]]),x[38]||(x[38]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):g("",!0),n.value.type==="LEA"?(i(),r(Y,{key:1},[e("div",Co,[e("div",null,[x[40]||(x[40]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Final Instalment (€)",-1)),e("div",So,[x[39]||(x[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":x[14]||(x[14]=M=>n.value.fields.finalInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[O,n.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Ao,[e("div",Do,[x[41]||(x[41]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Eo,"€ "+b(k(v.value)),1)]),x[42]||(x[42]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Vo,[e("div",Lo,[C(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":x[15]||(x[15]=M=>n.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.insuranceIncluded]]),x[43]||(x[43]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Po,[C(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":x[16]||(x[16]=M=>n.value.fields.maintenanceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.maintenanceIncluded]]),x[44]||(x[44]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):g("",!0),n.value.type==="LTR"?(i(),r(Y,{key:2},[e("div",null,[x[46]||(x[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":x[17]||(x[17]=M=>n.value.fields.customerType=M),class:R(["input",{"border-red-500":d.value.customerType}]),onChange:x[18]||(x[18]=M=>I("customerType"))},[...x[45]||(x[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[X,n.value.fields.customerType]]),d.value.customerType?(i(),r("p",Mo,b(d.value.customerType),1)):g("",!0)]),e("div",Oo,[e("div",Ro,[x[47]||(x[47]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",qo,"€ "+b(k(c.value)),1)]),x[48]||(x[48]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Fo,[e("div",Bo,[C(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":x[19]||(x[19]=M=>n.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.insuranceIncluded]]),x[49]||(x[49]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Uo,[C(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":x[20]||(x[20]=M=>n.value.fields.maintenanceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.maintenanceIncluded]]),x[50]||(x[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",No,[C(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":x[21]||(x[21]=M=>n.value.fields.registrationTaxesIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,n.value.fields.registrationTaxesIncluded]]),x[51]||(x[51]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):g("",!0)])):g("",!0)],32),t.hideActions?g("",!0):(i(),r("div",jo,[D($(z),{label:"Cancel",variant:"outline",size:"small",onClick:x[22]||(x[22]=M=>S.$emit("cancel"))}),D($(z),{label:"Save",variant:"primary",size:"small",disabled:!w.value,onClick:h},null,8,["disabled"])]))],2))}};class zo extends Et{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(o={}){await new Promise(s=>setTimeout(s,300));let l=[...this.dataSource];return o.leadId!==void 0&&(l=l.filter(s=>s.leadId===parseInt(o.leadId))),o.opportunityId!==void 0&&(l=l.filter(s=>s.opportunityId===parseInt(o.opportunityId))),o.type&&(l=l.filter(s=>s.type===o.type)),o.offerId!==void 0&&(l=l.filter(s=>s.offerId===parseInt(o.offerId))),o.vehicleId!==void 0&&(l=l.filter(s=>s.vehicleId===parseInt(o.vehicleId))),l}async findAllByLeadId(o){return this.findAll({leadId:o})}async findAllByOpportunityId(o){return this.findAll({opportunityId:o})}async findById(o){return await new Promise(s=>setTimeout(s,300)),this.dataSource.find(s=>s.id===parseInt(o))||null}async create(o){await new Promise(m=>setTimeout(m,300));const s={id:this.dataSource.length>0?Math.max(...this.dataSource.map(m=>m.id))+1:1,type:o.type,leadId:o.leadId!==void 0?parseInt(o.leadId):void 0,opportunityId:o.opportunityId!==void 0?parseInt(o.opportunityId):void 0,offerId:o.offerId!==void 0?parseInt(o.offerId):void 0,vehicleId:o.vehicleId!==void 0?parseInt(o.vehicleId):void 0,fields:o.fields||{},currency:o.currency||"EUR",offerValidFrom:o.offerValidFrom||null,offerValidTo:o.offerValidTo||null,status:o.status||"active",createdAt:o.createdAt||new Date().toISOString(),createdBy:o.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(s),s}async update(o,l){await new Promise(m=>setTimeout(m,300));const s=this.dataSource.find(m=>m.id===parseInt(o));if(!s)throw new Error("Purchase method not found");return Object.assign(s,l,{updatedAt:new Date().toISOString()}),s}async delete(o){await new Promise(s=>setTimeout(s,300));const l=this.dataSource.findIndex(s=>s.id===parseInt(o));if(l===-1)throw new Error("Purchase method not found");return this.dataSource.splice(l,1),{success:!0}}}class Ho{constructor(){this.repository=new zo}calculateTotal(o){const{type:l,fields:s}=o;if(!s)return 0;const m=parseFloat(s.monthlyInstalment)||0,d=parseFloat(s.downPayment)||0,p=parseInt(s.duration)||0;switch(l){case"FIN":return m*p+d;case"LEA":const n=parseFloat(s.finalInstalment)||0;return m*p+d+n;case"LTR":return m*p+d;default:return 0}}validate(o){const l=[],{type:s,fields:m}=o;if((!s||!["FIN","LEA","LTR"].includes(s))&&l.push("Purchase method type is required and must be FIN, LEA, or LTR"),!m)return l.push("Purchase method fields are required"),{isValid:!1,errors:l};const d=parseFloat(m.monthlyInstalment);(!d||d<=0)&&l.push("Monthly Instalment must be greater than 0");const p=parseFloat(m.downPayment);(p==null||p<0)&&l.push("Down Payment must be greater than or equal to 0");const n=parseInt(m.duration);if((!n||n<12||n>60)&&l.push("Duration must be between 12 and 60 months"),s==="FIN"){const v=parseFloat(m.interestRate);v!=null&&(v<0||v>99.99)&&l.push("Interest Rate must be between 0 and 99.99%");const c=parseFloat(m.effectiveInterestRate);c!=null&&(c<0||c>99.99)&&l.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(s==="LEA"){const v=parseFloat(m.mileageLimit);v!=null&&v<=0&&l.push("Mileage Limit must be greater than 0 if provided");const c=parseFloat(m.finalInstalment);c!=null&&c<0&&l.push("Final Instalment must be greater than or equal to 0");const a=parseFloat(m.interestRate);a!=null&&(a<0||a>99.99)&&l.push("Interest Rate must be between 0 and 99.99%")}if(s==="LTR"){const v=parseFloat(m.mileageLimit);v!=null&&v<=0&&l.push("Mileage Limit must be greater than 0 if provided"),(!m.customerType||!["Private","Business","Fleet"].includes(m.customerType))&&l.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:l.length===0,errors:l}}async findAll(o={}){return await this.repository.findAll(o)}async findById(o){return await this.repository.findById(o)}async create(o){const l=this.validate(o);if(!l.isValid)throw new Error(`Validation failed: ${l.errors.join(", ")}`);const s=await this.repository.create(o),m=this.calculateTotal(s);return s.fields={...s.fields,totalAmount:m},await this.repository.update(s.id,{fields:s.fields})}async update(o,l){const s=await this.repository.findById(o);if(!s)throw new Error("Purchase method not found");const m={...s,...l,fields:{...s.fields,...l.fields}},d=this.validate(m);if(!d.isValid)throw new Error(`Validation failed: ${d.errors.join(", ")}`);const p=this.calculateTotal(m);return m.fields.totalAmount=p,await this.repository.update(o,{...l,fields:m.fields})}async delete(o){return await this.repository.delete(o)}}const Ie=new Ho,Pe=(t=300)=>new Promise(o=>setTimeout(o,t)),Yo=async(t={})=>(await Pe(),await Ie.findAll(t)),Qo=async t=>(await Pe(),await Ie.findById(t)),Go=async t=>(await Pe(),await Ie.create(t)),Ko=async(t,o)=>(await Pe(),await Ie.update(t,o)),Jo=async t=>(await Pe(),await Ie.delete(t)),Xo=Vt("purchaseMethods",()=>{const t=q([]),o=q(null),l=q(!1),s=q(null),m=A(()=>k=>t.value.filter(I=>I.type===k)),d=A(()=>k=>t.value.filter(I=>I.leadId===parseInt(k))),p=A(()=>k=>t.value.filter(I=>I.opportunityId===parseInt(k)));return{purchaseMethods:t,currentPurchaseMethod:o,loading:l,error:s,purchaseMethodsByType:m,purchaseMethodsByLead:d,purchaseMethodsByOpportunity:p,fetchPurchaseMethods:async(k={})=>{l.value=!0,s.value=null;try{const I=await Yo(k);return t.value=I,I}catch(I){throw s.value=I.message,I}finally{l.value=!1}},fetchPurchaseMethodById:async k=>{l.value=!0,s.value=null;try{return o.value=await Qo(k),o.value}catch(I){throw s.value=I.message,I}finally{l.value=!1}},createPurchaseMethod:async k=>{l.value=!0,s.value=null;try{const I=await Go(k);return t.value.push(I),I}catch(I){throw s.value=I.message,I}finally{l.value=!1}},updatePurchaseMethod:async(k,I)=>{var w;l.value=!0,s.value=null;try{const u=await Ko(k,I),h=t.value.findIndex(S=>S.id===k);return h!==-1&&(t.value[h]=u),((w=o.value)==null?void 0:w.id)===k&&(o.value=u),u}catch(u){throw s.value=u.message,u}finally{l.value=!1}},deletePurchaseMethod:async k=>{var I;l.value=!0,s.value=null;try{await Jo(k),t.value=t.value.filter(w=>w.id!==k),((I=o.value)==null?void 0:I.id)===k&&(o.value=null)}catch(w){throw s.value=w.message,w}finally{l.value=!1}}}}),Zo={class:"flex gap-2"},_o=["value"],er={key:0,class:"space-y-4"},tr={class:"text-h3-card text-heading mb-4"},lr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ar={class:"relative"},nr={key:0,class:"text-xs text-red-600 mt-1"},sr={class:"relative"},ir={key:0,class:"text-xs text-red-600 mt-1"},or={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rr=["value"],dr={key:0,class:"text-xs text-red-600 mt-1"},ur={key:0},cr={class:"relative"},mr={key:0,class:"text-xs text-red-600 mt-1"},fr={key:1},pr={key:0,class:"text-xs text-red-600 mt-1"},vr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yr={class:"relative"},br={key:0,class:"text-xs text-red-600 mt-1"},gr={class:"relative"},xr={class:"flex items-center gap-2"},hr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kr={class:"relative"},wr={key:0,class:"text-xs text-red-600 mt-1"},$r={class:"relative"},Ir={key:0,class:"text-xs text-red-600 mt-1"},Tr={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Cr={class:"flex justify-between items-center"},Sr={class:"text-lg font-bold text-heading"},Ar={class:"flex flex-col gap-2"},Dr={class:"flex items-center gap-2"},Er={class:"flex items-center gap-2"},Vr={key:0,class:"text-xs text-red-600 mt-1"},Lr={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Pr={class:"flex justify-between items-center"},Mr={class:"text-lg font-bold text-heading"},Or={class:"flex flex-col gap-2"},Rr={class:"flex items-center gap-2"},qr={class:"flex items-center gap-2"},Fr={class:"flex items-center gap-2"},Br={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},Ur={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},Nr={class:"list-disc list-inside text-sm text-red-700 space-y-1"},jr={key:0},Wr={key:1},zr={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:t=>["lead","opportunity"].includes(t)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,s=o,m=Xo(),d=Lt(),p=q(!1),n=q({}),v=q([]),c=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],a=q({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),f=A(()=>!!l.purchaseMethod),k=A(()=>{if(a.value.type!=="LEA")return 0;const B=parseFloat(a.value.fields.monthlyInstalment)||0,y=parseInt(a.value.fields.duration)||0,L=parseFloat(a.value.fields.downPayment)||0,ne=parseFloat(a.value.fields.finalInstalment)||0;return B*y+L+ne}),I=A(()=>{if(a.value.type!=="LTR")return 0;const B=parseFloat(a.value.fields.monthlyInstalment)||0,y=parseInt(a.value.fields.duration)||0,L=parseFloat(a.value.fields.downPayment)||0;return B*y+L}),w=B=>B==="FIN"?[12,24,36,48,60]:B==="LEA"?[24,36,48,60]:B==="LTR"?[12,24,36,48,60]:[],u=B=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[B]||B,h=B=>{const y=a.value.fields[B];switch(B){case"monthlyInstalment":!y||y<=0?n.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete n.value.monthlyInstalment;break;case"downPayment":y==null||y<0?n.value.downPayment="Down Payment must be greater than or equal to 0":delete n.value.downPayment;break;case"duration":!y||y<12||y>60?n.value.duration="Duration must be between 12 and 60 months":delete n.value.duration;break;case"customerType":a.value.type==="LTR"&&(!y||!["Private","Business","Fleet"].includes(y))?n.value.customerType="Customer Type is required":delete n.value.customerType;break}},S=B=>{delete n.value[B]},x=()=>{v.value=[],n.value={};const B=Ie.validate({type:a.value.type,fields:a.value.fields});return B.isValid||(v.value=B.errors,B.errors.forEach(y=>{y.includes("Monthly Instalment")?n.value.monthlyInstalment=y:y.includes("Down Payment")?n.value.downPayment=y:y.includes("Duration")?n.value.duration=y:y.includes("Customer Type")&&(n.value.customerType=y)})),B.isValid},M=A(()=>!a.value.type||!a.value.fields.monthlyInstalment||a.value.fields.monthlyInstalment<=0||a.value.fields.downPayment===null||a.value.fields.downPayment===void 0||a.value.fields.downPayment<0||!a.value.fields.duration||a.value.fields.duration<12||a.value.fields.duration>60||a.value.type==="LTR"&&!a.value.fields.customerType?!1:Object.keys(n.value).length===0),Z=()=>{a.value.type!=="FIN"&&(a.value.fields.effectiveInterestRate=null,a.value.fields.gfv=null),a.value.type!=="LEA"&&(a.value.fields.finalInstalment=null),a.value.type!=="LTR"&&(a.value.fields.customerType="",a.value.fields.registrationTaxesIncluded=!1),a.value.type!=="LEA"&&a.value.type!=="LTR"&&(a.value.fields.mileageLimit=null,a.value.fields.maintenanceIncluded=!1),n.value={},v.value=[]},ae=async()=>{var B;if(x()){p.value=!0;try{const y={type:a.value.type,fields:{...a.value.fields},currency:a.value.currency,offerValidFrom:a.value.offerValidFrom||null,offerValidTo:a.value.offerValidTo||null,createdBy:((B=d.currentUser)==null?void 0:B.id)||null};l.taskType==="lead"?y.leadId=parseInt(l.taskId):l.taskType==="opportunity"&&(y.opportunityId=parseInt(l.taskId)),l.vehicleId&&(y.vehicleId=parseInt(l.vehicleId)),l.offerId&&(y.offerId=parseInt(l.offerId));let L;f.value?L=await m.updatePurchaseMethod(l.purchaseMethod.id,y):L=await m.createPurchaseMethod(y);const ne=u(L.type),ce=Ue(L.fields.monthlyInstalment||0);s("save",{...L,successMessage:`Purchase Method Added: ${ne} - €${ce}/month`}),s("close")}catch(y){v.value=[y.message||"Failed to save purchase method"]}finally{p.value=!1}}},de=B=>{B||s("close")};return be(()=>{l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null})}),re(()=>l.show,B=>{B?l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null}):setTimeout(()=>{a.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},n.value={},v.value=[],p.value=!1},300)}),(B,y)=>(i(),j($(Le),{open:t.show,"onUpdate:open":de},{default:U(()=>[D($(Ce),null,{default:U(()=>[D($(Se),{class:"fixed inset-0 z-50 bg-black/50"}),D($(Ae),{class:"w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto"},{default:U(()=>[D($(De),null,{default:U(()=>[D($(Ee),null,{default:U(()=>[N(b(f.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1}),D($(Ge),null,{default:U(()=>[N(b(f.value?"Update purchase method details":"Select purchase method type and fill in the details"),1)]),_:1})]),_:1}),e("form",{onSubmit:ee(ae,["prevent"]),class:"space-y-6"},[e("div",null,[y[31]||(y[31]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",Zo,[(i(),r(Y,null,K(c,L=>e("label",{key:L.value,class:"flex-1 cursor-pointer"},[C(e("input",{type:"radio",value:L.value,"onUpdate:modelValue":y[0]||(y[0]=ne=>a.value.type=ne),class:"sr-only",onChange:Z},null,40,_o),[[xt,a.value.type]]),e("div",{class:R(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",a.value.type===L.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},b(L.label),3)])),64))])]),a.value.type?(i(),r("div",er,[e("h3",tr,b(u(a.value.type))+" Details ",1),e("div",lr,[e("div",null,[y[33]||(y[33]=e("label",{class:"block label-upper mb-2"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",ar,[y[32]||(y[32]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":y[1]||(y[1]=L=>a.value.fields.monthlyInstalment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:R(["input pl-8",{"border-red-500":n.value.monthlyInstalment}]),onInput:y[2]||(y[2]=L=>S("monthlyInstalment")),onBlur:y[3]||(y[3]=L=>h("monthlyInstalment"))},null,34),[[O,a.value.fields.monthlyInstalment,void 0,{number:!0}]])]),n.value.monthlyInstalment?(i(),r("p",nr,b(n.value.monthlyInstalment),1)):g("",!0)]),e("div",null,[y[35]||(y[35]=e("label",{class:"block label-upper mb-2"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",sr,[y[34]||(y[34]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":y[4]||(y[4]=L=>a.value.fields.downPayment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:R(["input pl-8",{"border-red-500":n.value.downPayment}]),onInput:y[5]||(y[5]=L=>S("downPayment")),onBlur:y[6]||(y[6]=L=>h("downPayment"))},null,34),[[O,a.value.fields.downPayment,void 0,{number:!0}]])]),n.value.downPayment?(i(),r("p",ir,b(n.value.downPayment),1)):g("",!0)])]),e("div",or,[e("div",null,[y[37]||(y[37]=e("label",{class:"block label-upper mb-2"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":y[7]||(y[7]=L=>a.value.fields.duration=L),class:R(["input",{"border-red-500":n.value.duration}]),onChange:y[8]||(y[8]=L=>S("duration"))},[y[36]||(y[36]=e("option",{value:""},"Select duration...",-1)),(i(!0),r(Y,null,K(w(a.value.type),L=>(i(),r("option",{key:L,value:L},b(L)+" months ",9,rr))),128))],34),[[X,a.value.fields.duration,void 0,{number:!0}]]),n.value.duration?(i(),r("p",dr,b(n.value.duration),1)):g("",!0)]),a.value.type==="FIN"?(i(),r("div",ur,[y[39]||(y[39]=e("label",{class:"block label-upper mb-2"},"Interest Rate / APR (%)",-1)),e("div",cr,[C(e("input",{"onUpdate:modelValue":y[9]||(y[9]=L=>a.value.fields.interestRate=L),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:R(["input pr-8",{"border-red-500":n.value.interestRate}]),onInput:y[10]||(y[10]=L=>S("interestRate"))},null,34),[[O,a.value.fields.interestRate,void 0,{number:!0}]]),y[38]||(y[38]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),n.value.interestRate?(i(),r("p",mr,b(n.value.interestRate),1)):g("",!0)])):g("",!0),a.value.type==="LEA"||a.value.type==="LTR"?(i(),r("div",fr,[y[40]||(y[40]=e("label",{class:"block label-upper mb-2"},"Mileage Limit (annual km)",-1)),C(e("input",{"onUpdate:modelValue":y[11]||(y[11]=L=>a.value.fields.mileageLimit=L),type:"number",min:"0",placeholder:"0",class:R(["input",{"border-red-500":n.value.mileageLimit}]),onInput:y[12]||(y[12]=L=>S("mileageLimit"))},null,34),[[O,a.value.fields.mileageLimit,void 0,{number:!0}]]),n.value.mileageLimit?(i(),r("p",pr,b(n.value.mileageLimit),1)):g("",!0)])):g("",!0)]),a.value.type==="FIN"?(i(),r(Y,{key:0},[e("div",vr,[e("div",null,[y[42]||(y[42]=e("label",{class:"block label-upper mb-2"},"Effective Interest Rate / TAEG (%)",-1)),e("div",yr,[C(e("input",{"onUpdate:modelValue":y[13]||(y[13]=L=>a.value.fields.effectiveInterestRate=L),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:R(["input pr-8",{"border-red-500":n.value.effectiveInterestRate}]),onInput:y[14]||(y[14]=L=>S("effectiveInterestRate"))},null,34),[[O,a.value.fields.effectiveInterestRate,void 0,{number:!0}]]),y[41]||(y[41]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),n.value.effectiveInterestRate?(i(),r("p",br,b(n.value.effectiveInterestRate),1)):g("",!0)]),e("div",null,[y[44]||(y[44]=e("label",{class:"block label-upper mb-2"},"Guaranteed Future Value / GFV (€)",-1)),e("div",gr,[y[43]||(y[43]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":y[15]||(y[15]=L=>a.value.fields.gfv=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[O,a.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",xr,[C(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":y[16]||(y[16]=L=>a.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.insuranceIncluded]]),y[45]||(y[45]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):g("",!0),a.value.type==="LEA"?(i(),r(Y,{key:1},[e("div",hr,[e("div",null,[y[47]||(y[47]=e("label",{class:"block label-upper mb-2"},"Interest Rate / APR (%)",-1)),e("div",kr,[C(e("input",{"onUpdate:modelValue":y[17]||(y[17]=L=>a.value.fields.interestRate=L),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:R(["input pr-8",{"border-red-500":n.value.interestRate}]),onInput:y[18]||(y[18]=L=>S("interestRate"))},null,34),[[O,a.value.fields.interestRate,void 0,{number:!0}]]),y[46]||(y[46]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),n.value.interestRate?(i(),r("p",wr,b(n.value.interestRate),1)):g("",!0)]),e("div",null,[y[49]||(y[49]=e("label",{class:"block label-upper mb-2"},"Final Instalment (€)",-1)),e("div",$r,[y[48]||(y[48]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":y[19]||(y[19]=L=>a.value.fields.finalInstalment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:R(["input pl-8",{"border-red-500":n.value.finalInstalment}]),onInput:y[20]||(y[20]=L=>S("finalInstalment"))},null,34),[[O,a.value.fields.finalInstalment,void 0,{number:!0}]])]),n.value.finalInstalment?(i(),r("p",Ir,b(n.value.finalInstalment),1)):g("",!0)])]),e("div",Tr,[e("div",Cr,[y[50]||(y[50]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Sr,"€ "+b($(Ue)(k.value)),1)]),y[51]||(y[51]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Ar,[e("div",Dr,[C(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":y[21]||(y[21]=L=>a.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.insuranceIncluded]]),y[52]||(y[52]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Er,[C(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":y[22]||(y[22]=L=>a.value.fields.maintenanceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.maintenanceIncluded]]),y[53]||(y[53]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):g("",!0),a.value.type==="LTR"?(i(),r(Y,{key:2},[e("div",null,[y[55]||(y[55]=e("label",{class:"block label-upper mb-2"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":y[23]||(y[23]=L=>a.value.fields.customerType=L),class:R(["input",{"border-red-500":n.value.customerType}]),onChange:y[24]||(y[24]=L=>S("customerType"))},[...y[54]||(y[54]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[X,a.value.fields.customerType]]),n.value.customerType?(i(),r("p",Vr,b(n.value.customerType),1)):g("",!0)]),e("div",Lr,[e("div",Pr,[y[56]||(y[56]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",Mr,"€ "+b($(Ue)(I.value)),1)]),y[57]||(y[57]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Or,[e("div",Rr,[C(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":y[25]||(y[25]=L=>a.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.insuranceIncluded]]),y[58]||(y[58]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",qr,[C(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":y[26]||(y[26]=L=>a.value.fields.maintenanceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.maintenanceIncluded]]),y[59]||(y[59]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Fr,[C(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":y[27]||(y[27]=L=>a.value.fields.registrationTaxesIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[le,a.value.fields.registrationTaxesIncluded]]),y[60]||(y[60]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):g("",!0),e("div",Br,[e("div",null,[y[61]||(y[61]=e("label",{class:"block label-upper mb-2"},"Offer Valid From",-1)),C(e("input",{"onUpdate:modelValue":y[28]||(y[28]=L=>a.value.offerValidFrom=L),type:"date",class:"input"},null,512),[[O,a.value.offerValidFrom]])]),e("div",null,[y[62]||(y[62]=e("label",{class:"block label-upper mb-2"},"Offer Valid To",-1)),C(e("input",{"onUpdate:modelValue":y[29]||(y[29]=L=>a.value.offerValidTo=L),type:"date",class:"input"},null,512),[[O,a.value.offerValidTo]])])])])):g("",!0),v.value.length>0?(i(),r("div",Ur,[y[63]||(y[63]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Nr,[(i(!0),r(Y,null,K(v.value,L=>(i(),r("li",{key:L},b(L),1))),128))])])):g("",!0)],32),D($(Ve),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[D($(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[30]||(y[30]=L=>B.$emit("close"))}),D($(z),{label:f.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!M.value||p.value,onClick:ae},{default:U(()=>[p.value?(i(),r("span",jr,"Saving...")):(i(),r("span",Wr,b(f.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Hr=gt(zr,[["__scopeId","data-v-cefe6d3a"]]),Yr={key:0,class:"space-y-4 py-4"},Qr={class:"grid grid-cols-1 gap-3"},Gr={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Kr=["max"],Jr={key:0},Xr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Zr={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},_r={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ed={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},td={key:2,class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},ld={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},ad={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},sd={class:"pt-2 border-t border-E5E7EB"},id={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},od={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},rd={class:"mt-4"},dd={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:t=>["vehicle","tradein"].includes(t)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,s=o,m=q(null),d=q(!1),p=A(()=>l.mode==="tradein"||m.value==="tradein"),n=()=>l.mode==="tradein"||m.value==="tradein"?"Add Trade-In Vehicle":m.value==="drove"?"Add Drove Vehicle":m.value==="requested"?"Add Requested Vehicle":"Add Vehicle",v=()=>l.mode==="tradein"||m.value==="tradein"?"Record details of the customer's trade-in vehicle":m.value==="drove"?"Record details of a vehicle the customer drove":m.value==="requested"?"Record details of a vehicle the customer requested":"Fill in the details for the new vehicle",c=q({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",stockDays:null}),a=q({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:"",priceToBuy:null,priceToSell:null,priceOfVehicle:null,priceOfOptionals:null,listOfOptionals:""});be(()=>{l.item&&l.item.data&&(c.value={brand:l.item.data.brand||"",model:l.item.data.model||"",year:l.item.data.year||"",version:l.item.data.version||"",vin:l.item.data.vin||"",plates:l.item.data.plate||l.item.data.plates||"",fuelType:l.item.data.fuelType||"",gearType:l.item.data.gearType||"",kilometers:l.item.data.km||l.item.data.kilometers||"",registration:l.item.data.date||l.item.data.registration||"",owner:l.item.data.owner||"",ownershipType:l.item.data.ownershipType||"",ownedSince:l.item.data.ownedSince||"",warrantyInfo:l.item.data.warrantyInfo||"",stockDays:null},l.item.data.tradeInPrice!==void 0&&(a.value={tradeInPrice:l.item.data.tradeInPrice||null,evaluationRangeLow:l.item.data.evaluationRangeLow||null,evaluationRangeHigh:l.item.data.evaluationRangeHigh||null,provider:l.item.data.provider||"",evaluationDate:l.item.data.evaluationDate||"",priceToBuy:l.item.data.priceToBuy||null,priceToSell:l.item.data.priceToSell||null,priceOfVehicle:l.item.data.priceOfVehicle||null,priceOfOptionals:l.item.data.priceOfOptionals||null,listOfOptionals:l.item.data.listOfOptionals||""},d.value=!0))}),re(()=>l.show,w=>{w||(m.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",stockDays:null},a.value={tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:"",priceToBuy:null,priceToSell:null,priceOfVehicle:null,priceOfOptionals:null,listOfOptionals:""},d.value=!1)});const f=A(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),k=w=>{w||s("close")},I=()=>{if(!f.value)return;const w={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,stockDays:null,status:"Available"}};m.value&&(w.vehicleType=m.value),p.value&&(w.valuation={tradeInPrice:a.value.tradeInPrice,evaluationRangeLow:a.value.evaluationRangeLow,evaluationRangeHigh:a.value.evaluationRangeHigh,provider:a.value.provider||null,evaluationDate:a.value.evaluationDate||null,priceToBuy:a.value.priceToBuy,priceToSell:a.value.priceToSell,priceOfVehicle:a.value.priceOfVehicle,priceOfOptionals:a.value.priceOfOptionals,listOfOptionals:a.value.listOfOptionals||null}),l.item&&(w.id=l.item.id,w.isEdit=!0,w.timestamp=l.item.timestamp||new Date().toISOString()),s("save",w)};return(w,u)=>(i(),j($(Le),{open:t.show,"onUpdate:open":k},{default:U(()=>[D($(Ce),null,{default:U(()=>[D($(Se),{class:"fixed inset-0 z-50 bg-black/50"}),D($(Ae),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:U(()=>[D($(De),null,{default:U(()=>[D($(Ee),null,{default:U(()=>[N(b(n()),1)]),_:1}),D($(Ge),null,{default:U(()=>[N(b(v()),1)]),_:1})]),_:1}),t.mode==="vehicle"&&!t.item&&!m.value?(i(),r("div",Yr,[u[29]||(u[29]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Qr,[D($(z),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[0]||(u[0]=h=>m.value="drove")}),D($(z),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[1]||(u[1]=h=>m.value="requested")}),D($(z),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[2]||(u[2]=h=>m.value="tradein")})])])):(i(),r("form",{key:1,onSubmit:ee(I,["prevent"]),class:"space-y-4"},[e("div",Gr,[e("div",null,[u[30]||(u[30]=e("label",{class:"block label-upper mb-2"},"Brand",-1)),C(e("input",{"onUpdate:modelValue":u[3]||(u[3]=h=>c.value.brand=h),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[O,c.value.brand]])]),e("div",null,[u[31]||(u[31]=e("label",{class:"block label-upper mb-2"},"Model",-1)),C(e("input",{"onUpdate:modelValue":u[4]||(u[4]=h=>c.value.model=h),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[O,c.value.model]])]),e("div",null,[u[32]||(u[32]=e("label",{class:"block label-upper mb-2"},"Year",-1)),C(e("input",{"onUpdate:modelValue":u[5]||(u[5]=h=>c.value.year=h),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,Kr),[[O,c.value.year]])])]),p.value?(i(),r("div",Jr,[u[33]||(u[33]=e("label",{class:"block label-upper mb-2"},"Version/Trim",-1)),C(e("input",{"onUpdate:modelValue":u[6]||(u[6]=h=>c.value.version=h),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[O,c.value.version]])])):g("",!0),e("div",Xr,[e("div",null,[u[34]||(u[34]=e("label",{class:"block label-upper mb-2"},"VIN",-1)),C(e("input",{"onUpdate:modelValue":u[7]||(u[7]=h=>c.value.vin=h),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[O,c.value.vin]])]),e("div",null,[u[35]||(u[35]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),C(e("input",{"onUpdate:modelValue":u[8]||(u[8]=h=>c.value.plates=h),type:"text",placeholder:"License plate number",class:"input"},null,512),[[O,c.value.plates]])])]),e("div",Zr,[e("div",null,[u[37]||(u[37]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),C(e("select",{"onUpdate:modelValue":u[9]||(u[9]=h=>c.value.fuelType=h),class:"input"},[...u[36]||(u[36]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[X,c.value.fuelType]])]),e("div",null,[u[39]||(u[39]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),C(e("select",{"onUpdate:modelValue":u[10]||(u[10]=h=>c.value.gearType=h),class:"input"},[...u[38]||(u[38]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[X,c.value.gearType]])]),e("div",null,[u[40]||(u[40]=e("label",{class:"block label-upper mb-2"},"Mileage (km)",-1)),C(e("input",{"onUpdate:modelValue":u[11]||(u[11]=h=>c.value.kilometers=h),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[O,c.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[u[41]||(u[41]=e("label",{class:"block label-upper mb-2"},"Registration Year/Month",-1)),C(e("input",{"onUpdate:modelValue":u[12]||(u[12]=h=>c.value.registration=h),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[O,c.value.registration]])]),t.mode==="vehicle"&&m.value!=="tradein"?(i(),r(Y,{key:1},[e("div",_r,[e("div",null,[u[42]||(u[42]=e("label",{class:"block label-upper mb-2"},"Owned Since",-1)),C(e("input",{"onUpdate:modelValue":u[13]||(u[13]=h=>c.value.ownedSince=h),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[O,c.value.ownedSince]])]),e("div",null,[u[43]||(u[43]=e("label",{class:"block label-upper mb-2"},"Owner",-1)),C(e("input",{"onUpdate:modelValue":u[14]||(u[14]=h=>c.value.owner=h),type:"text",placeholder:"Owner name",class:"input"},null,512),[[O,c.value.owner]])])]),e("div",ed,[e("div",null,[u[45]||(u[45]=e("label",{class:"block label-upper mb-2"},"Ownership Type",-1)),C(e("select",{"onUpdate:modelValue":u[15]||(u[15]=h=>c.value.ownershipType=h),class:"input"},[...u[44]||(u[44]=[e("option",{value:""},"Select ownership type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Company"},"Company",-1),e("option",{value:"Lease"},"Lease",-1),e("option",{value:"Fleet"},"Fleet",-1)])],512),[[X,c.value.ownershipType]])])]),e("div",null,[u[46]||(u[46]=e("label",{class:"block label-upper mb-2"},"Warranty Info",-1)),C(e("textarea",{"onUpdate:modelValue":u[16]||(u[16]=h=>c.value.warrantyInfo=h),rows:"3",placeholder:"Warranty information...",class:"input"},null,512),[[O,c.value.warrantyInfo]])])],64)):g("",!0),p.value?(i(),r("div",td,[e("button",{type:"button",onClick:u[17]||(u[17]=h=>d.value=!d.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors"},[u[47]||(u[47]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:R(["fa-solid transition-transform duration-200 text-sub",d.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),d.value?(i(),r("div",ld,[e("div",null,[u[48]||(u[48]=e("label",{class:"block label-upper mb-2"},"Trade-In Price (€)",-1)),C(e("input",{"onUpdate:modelValue":u[18]||(u[18]=h=>a.value.tradeInPrice=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.tradeInPrice,void 0,{number:!0}]])]),e("div",ad,[e("div",null,[u[49]||(u[49]=e("label",{class:"block label-upper mb-2"},"Evaluation Range - Low (€)",-1)),C(e("input",{"onUpdate:modelValue":u[19]||(u[19]=h=>a.value.evaluationRangeLow=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[u[50]||(u[50]=e("label",{class:"block label-upper mb-2"},"Evaluation Range - High (€)",-1)),C(e("input",{"onUpdate:modelValue":u[20]||(u[20]=h=>a.value.evaluationRangeHigh=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",nd,[e("div",null,[u[52]||(u[52]=e("label",{class:"block label-upper mb-2"},"Provider",-1)),C(e("select",{"onUpdate:modelValue":u[21]||(u[21]=h=>a.value.provider=h),class:"input"},[...u[51]||(u[51]=[e("option",{value:""},"Select provider...",-1),e("option",{value:"Eurotax"},"Eurotax",-1),e("option",{value:"Infocar"},"Infocar",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Other"},"Other",-1)])],512),[[X,a.value.provider]])]),e("div",null,[u[53]||(u[53]=e("label",{class:"block label-upper mb-2"},"Evaluation Date",-1)),C(e("input",{"onUpdate:modelValue":u[22]||(u[22]=h=>a.value.evaluationDate=h),type:"date",class:"input"},null,512),[[O,a.value.evaluationDate]])])]),e("div",sd,[u[59]||(u[59]=e("h4",{class:"text-fluid-xs font-medium text-heading mb-3"},"Optional Advanced Fields",-1)),e("div",id,[e("div",null,[u[54]||(u[54]=e("label",{class:"block label-upper mb-2"},"Price to Buy (€)",-1)),C(e("input",{"onUpdate:modelValue":u[23]||(u[23]=h=>a.value.priceToBuy=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.priceToBuy,void 0,{number:!0}]])]),e("div",null,[u[55]||(u[55]=e("label",{class:"block label-upper mb-2"},"Price to Sell (€)",-1)),C(e("input",{"onUpdate:modelValue":u[24]||(u[24]=h=>a.value.priceToSell=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.priceToSell,void 0,{number:!0}]])])]),e("div",od,[e("div",null,[u[56]||(u[56]=e("label",{class:"block label-upper mb-2"},"Price of Vehicle (€)",-1)),C(e("input",{"onUpdate:modelValue":u[25]||(u[25]=h=>a.value.priceOfVehicle=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.priceOfVehicle,void 0,{number:!0}]])]),e("div",null,[u[57]||(u[57]=e("label",{class:"block label-upper mb-2"},"Price of Optionals (€)",-1)),C(e("input",{"onUpdate:modelValue":u[26]||(u[26]=h=>a.value.priceOfOptionals=h),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[O,a.value.priceOfOptionals,void 0,{number:!0}]])])]),e("div",rd,[u[58]||(u[58]=e("label",{class:"block label-upper mb-2"},"List of Optionals",-1)),C(e("textarea",{"onUpdate:modelValue":u[27]||(u[27]=h=>a.value.listOfOptionals=h),rows:"3",placeholder:"List of equipment/features...",class:"input"},null,512),[[O,a.value.listOfOptionals]])])])])):g("",!0)])):g("",!0)],32)),D($(Ve),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[D($(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[28]||(u[28]=h=>w.$emit("close"))}),D($(z),{label:p.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:I},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ud={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},cd={key:0,class:"flex justify-between items-center mb-4"},md={class:"text-sm font-bold text-heading"},fd={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},pd={class:"flex items-center gap-3"},vd={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},yd=["src"],bd={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},gd={class:"font-bold text-sm text-heading"},xd={class:"text-xs text-sub"},hd={class:"space-y-4"},kd={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},$d=["disabled"],Id={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const s=t,m=l,d=q({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});be(()=>{if(s.selectedVehicle){d.value.price=s.selectedVehicle.price||0,d.value.brand=s.selectedVehicle.brand||"",d.value.model=s.selectedVehicle.model||"",d.value.year=s.selectedVehicle.year||"",d.value.image=s.selectedVehicle.image||"";const c=new Date;c.setDate(c.getDate()+30),d.value.validUntil=c.toISOString().split("T")[0]}s.item&&s.item.data&&(d.value={...d.value,...s.item.data,price:s.item.data.price||s.item.data.total||0,financingType:s.item.data.financingType||s.item.data.paymentMethod||"",notes:s.item.data.notes||s.item.data.description||""})}),re(()=>s.selectedVehicle,c=>{c&&!s.item&&(d.value.price=c.price||0,d.value.brand=c.brand||"",d.value.model=c.model||"",d.value.year=c.year||"",d.value.image=c.image||"")});const p=A(()=>d.value.price>0&&d.value.financingType!==""),n=c=>c?c.toLocaleString("en-US"):"0",v=()=>{var a,f;if(!p.value)return;const c={id:((a=s.item)==null?void 0:a.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"created an offer",data:{brand:d.value.brand,model:d.value.model,year:d.value.year,price:d.value.price,total:d.value.price,paymentMethod:d.value.financingType,financingType:d.value.financingType,downPayment:d.value.downPayment,monthlyPayment:d.value.monthlyPayment,term:d.value.term,interestRate:d.value.interestRate,deliveryDate:d.value.deliveryDate,validUntil:d.value.validUntil,notes:d.value.notes,description:d.value.notes,image:d.value.image},timestamp:((f=s.item)==null?void 0:f.timestamp)||new Date().toISOString(),isEdit:!!s.item};m("save",c)};return o({submit:v,isValid:p,offerData:d}),(c,a)=>(i(),r("div",ud,[t.hideHeader?g("",!0):(i(),r("div",cd,[e("h5",md,b(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:a[0]||(a[0]=f=>c.$emit("cancel")),class:"text-sub hover:text-body"},[...a[11]||(a[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(i(),r("div",fd,[a[12]||(a[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",pd,[e("div",vd,[t.selectedVehicle.image?(i(),r("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,yd)):(i(),r("i",bd))]),e("div",null,[e("h4",gd,b(t.selectedVehicle.brand)+" "+b(t.selectedVehicle.model)+" ("+b(t.selectedVehicle.year)+") ",1),e("p",xd,"Base Price: € "+b(n(t.selectedVehicle.price)),1)])])])):g("",!0),e("div",hd,[e("div",null,[a[13]||(a[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[N(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=f=>d.value.price=f),class:"input",placeholder:"Enter offer price"},null,512),[[O,d.value.price]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[N(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),C(e("select",{"onUpdate:modelValue":a[2]||(a[2]=f=>d.value.financingType=f),class:"input"},[...a[14]||(a[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[X,d.value.financingType]])]),d.value.financingType==="finance"||d.value.financingType==="lease"?(i(),r("div",kd,[e("div",null,[a[16]||(a[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),C(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=f=>d.value.downPayment=f),class:"input",placeholder:"0"},null,512),[[O,d.value.downPayment]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),C(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=f=>d.value.monthlyPayment=f),class:"input",placeholder:"Calculated automatically"},null,512),[[O,d.value.monthlyPayment]])]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),C(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=f=>d.value.term=f),class:"input",placeholder:"36"},null,512),[[O,d.value.term]])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),C(e("input",{type:"number",step:"0.1","onUpdate:modelValue":a[6]||(a[6]=f=>d.value.interestRate=f),class:"input",placeholder:"3.5"},null,512),[[O,d.value.interestRate]])])])):g("",!0),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),C(e("input",{type:"date","onUpdate:modelValue":a[7]||(a[7]=f=>d.value.deliveryDate=f),class:"input"},null,512),[[O,d.value.deliveryDate]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),C(e("input",{type:"date","onUpdate:modelValue":a[8]||(a[8]=f=>d.value.validUntil=f),class:"input"},null,512),[[O,d.value.validUntil]])]),e("div",null,[a[22]||(a[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),C(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=f=>d.value.notes=f),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[O,d.value.notes]])])]),t.hideActions?g("",!0):(i(),r("div",wd,[e("button",{onClick:a[10]||(a[10]=f=>c.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:v,disabled:!p.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},b(t.item?"Update Offer":"Create Offer"),9,$d)]))]))}},Td={class:"p-6"},Cd={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:o}){const l=o,s=q(null),m=A(()=>{var v;return((v=s.value)==null?void 0:v.isValid)||!1}),d=()=>{var v;(v=s.value)==null||v.submit()},p=v=>{v||l("close")},n=v=>{l("save",v),l("close")};return(v,c)=>(i(),j($(Le),{open:t.show,"onUpdate:open":p},{default:U(()=>[D($(Ce),null,{default:U(()=>[D($(Se),{class:"fixed inset-0 z-50 bg-black/50"}),D($(Ae),{class:"w-full sm:max-w-2xl p-0"},{default:U(()=>[D($(De),{class:"p-6 pb-4 border-b border"},{default:U(()=>[D($(Ee),null,{default:U(()=>[...c[2]||(c[2]=[N("Create Offer",-1)])]),_:1}),D($(Ge),null,{default:U(()=>[...c[3]||(c[3]=[N("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Td,[D(Id,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:s,onSave:n,onCancel:c[0]||(c[0]=a=>v.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),D($(Ve),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:U(()=>[D($(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c[1]||(c[1]=a=>v.$emit("close"))}),D($(z),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:d},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Sd={class:"space-y-4"},Ad={key:0},Dd={class:"flex flex-wrap gap-2"},Ed=["onClick"],Vd={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:o}){const l=t,s=o,m=q(""),d=n=>{n||s("close")};re(()=>l.show,n=>{n&&(m.value="")});const p=()=>{const n=m.value.trim();n&&(l.existingTags.includes(n)||(s("add",n),m.value=""))};return(n,v)=>(i(),j($(Le),{open:t.show,"onUpdate:open":d},{default:U(()=>[D($(Ce),null,{default:U(()=>[D($(Se),{class:"fixed inset-0 z-50 bg-black/50"}),D($(Ae),{class:"w-full sm:max-w-md"},{default:U(()=>[D($(De),null,{default:U(()=>[D($(Ee),null,{default:U(()=>[...v[2]||(v[2]=[N("Add Tag",-1)])]),_:1})]),_:1}),e("div",Sd,[e("div",null,[v[3]||(v[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),C(e("input",{"onUpdate:modelValue":v[0]||(v[0]=c=>m.value=c),onKeyup:Pt(p,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[O,m.value]])]),t.existingTags.length>0?(i(),r("div",Ad,[v[4]||(v[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Dd,[(i(!0),r(Y,null,K(t.existingTags,c=>(i(),r("button",{key:c,onClick:a=>m.value=c,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},b(c),9,Ed))),128))])])):g("",!0)]),D($(Ve),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[D($(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:v[1]||(v[1]=c=>n.$emit("close"))}),D($(z),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value.trim(),onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Ld(){const t=Wt();return{saveTradeInVehicle:async(s,m,d,p={})=>{try{const n=await t.addVehicle(d),v={type:"tradein",action:"added a trade-in",vehicleId:n.id,data:{brand:d.brand,model:d.model,version:d.version||null,year:d.year,kilometers:d.kilometers||0,plates:d.plates||null,registration:d.registration||null,vin:d.vin||null,fuelType:d.fuelType||null,gearType:d.gearType||null,tradeInPrice:p.tradeInPrice||null,evaluationRangeLow:p.evaluationRangeLow||null,evaluationRangeHigh:p.evaluationRangeHigh||null,provider:p.provider||null,evaluationDate:p.evaluationDate||null,priceToBuy:p.priceToBuy||null,priceToSell:p.priceToSell||null,priceOfVehicle:p.priceOfVehicle||null,priceOfOptionals:p.priceOfOptionals||null,listOfOptionals:p.listOfOptionals||null}};let c;if(s==="lead")c=await Rt(m,v);else if(s==="opportunity")c=await qt(m,v);else throw new Error(`Invalid taskType: ${s}`);return{vehicle:n,activity:c}}catch(n){throw console.error("Error saving trade-in vehicle:",n),n}},updateTradeInVehicle:async(s,m,d,p,n,v={})=>{try{const c=await t.modifyVehicle(d,n),a={data:{brand:n.brand,model:n.model,version:n.version||null,year:n.year,kilometers:n.kilometers||0,plates:n.plates||null,registration:n.registration||null,vin:n.vin||null,fuelType:n.fuelType||null,gearType:n.gearType||null,tradeInPrice:v.tradeInPrice||null,evaluationRangeLow:v.evaluationRangeLow||null,evaluationRangeHigh:v.evaluationRangeHigh||null,provider:v.provider||null,evaluationDate:v.evaluationDate||null,priceToBuy:v.priceToBuy||null,priceToSell:v.priceToSell||null,priceOfVehicle:v.priceOfVehicle||null,priceOfOptionals:v.priceOfOptionals||null,listOfOptionals:v.listOfOptionals||null}};let f;if(s==="lead")f=await Mt(m,p,a);else if(s==="opportunity")f=await Ot(m,p,a);else throw new Error(`Invalid taskType: ${s}`);return{vehicle:c,activity:f}}catch(c){throw console.error("Error updating trade-in vehicle:",c),c}}}}const We={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Pd(t){if(!t)return We.default;const o=t.toLowerCase().trim();return We[o]||We.default}function Md({store:t,taskId:o,getTabForItemType:l,isOverviewModalAction:s}){const m=q(null),d=q(null),p=q("overview"),n=q(null),v=q([]);re(p,()=>{m.value=null,d.value=null});const c=A(()=>[...t.currentActivities.value,...v.value.filter(h=>!h.activityId)].filter(h=>{const S=l(h.type);return p.value==="overview"?S==="overview":S===p.value}).sort((h,S)=>{const x=new Date(h.timestamp||0);return new Date(S.timestamp||0)-x})),a=u=>(d.value=null,p.value==="overview"&&s&&s(u)?{type:"overview-modal",action:u}:(["email","sms","whatsapp","call"].includes(u)?(n.value=u,m.value="communication"):m.value=u,null)),f=async u=>{var h;if(u.isEdit){const S=v.value.findIndex(x=>x.id===u.id);S>-1&&(v.value[S]={...v.value[S],...u}),(h=d.value)!=null&&h.activityId&&await t.updateActivity(o.value,d.value.activityId,{type:u.communicationType||u.type,user:"You",action:u.action,content:u.content,fileName:u.fileName,data:u.data})}else{const S=u.communicationType||u.type,x=await t.addActivity(o.value,{type:S,user:"You",action:u.action,content:u.content,fileName:u.fileName,data:u.data});v.value.push({id:x.id,type:S==="email"||S==="whatsapp"||S==="sms"?"communication":S,action:u.action,content:u.content,fileName:u.fileName,data:u.data,timestamp:x.timestamp,activityId:x.id})}m.value=null,d.value=null},k=()=>{m.value=null,d.value=null},I=u=>{l(u.type)&&(m.value=u.type==="email"||u.type==="whatsapp"||u.type==="sms"||u.type==="communication"?"communication":u.type,d.value=u)},w=async u=>{try{await t.deleteActivity(o.value,u)}catch(h){throw console.error("Error deleting item:",h),h}};return{activeTab:p,showInlineWidget:m,inlineWidgetType:A(()=>m.value),editingItem:d,isEditing:A(()=>d.value!==null),communicationType:n,inlineContent:v,filteredInlineContent:c,handleAddNewAction:a,handleWidgetSave:f,handleWidgetCancel:k,handleEditItem:I,handleDeleteItem:w}}const Od={class:"flex-1 flex flex-col overflow-hidden h-full"},Rd={class:"bg-surface border-b border-black/5 shrink-0"},qd={key:0},Fd={key:0,class:"flex-1 flex flex-row overflow-hidden"},Bd={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Ud={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Nd={class:"mb-4"},jd={key:0},Wd={key:0},zd={key:1,class:"mb-6"},Hd={key:2,class:"space-y-4 mb-6 px-1"},Yd={key:1},Qd={key:0,class:"space-y-4 mb-6 px-1"},Gd={key:1,class:"flex-1 flex flex-row overflow-hidden"},Kd={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Jd={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Xd={key:0,class:"space-y-6"},Zd={key:0},_d={key:1,class:"space-y-6"},eu={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},tu={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},lu={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},au={key:0,class:"mt-6 pt-6 border-t border"},nu={class:"space-y-2 max-h-52 overflow-y-auto"},su={class:"flex items-center gap-2 mb-1"},iu={class:"text-fluid-xs font-semibold text-heading"},ou={class:"text-fluid-xs text-sub"},ru={class:"text-fluid-sm text-body"},du={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},uu={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},cu={class:"relative"},mu={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},fu={key:1,class:"text-center py-6 text-sub"},pu={key:2,class:"space-y-6 max-h-96 overflow-y-auto pr-2"},vu={class:"flex-1 min-w-0"},yu={class:"text-fluid-sm text-slate-700 leading-snug"},bu={class:"font-bold"},gu={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},xu={class:"text-fluid-xs text-sub mt-1"},hu={key:2},ku={key:0,class:"space-y-4 mt-4"},wu={key:1,class:"text-center py-12 text-sub"},Vu={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated"],setup(t,{emit:o}){const l=t,s=o,m=Ft(),d=He(),p=zt(),n=A(()=>l.task.id),v=A(()=>m.path.startsWith("/tasks")&&!m.path.startsWith("/customer")),c=q("manage"),a=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Enrich"}],f=q(!1),k=q(null),I=q(null),w=["note","attachment","tradein","purchase"],u=A(()=>{const T=[];if(l.task.activities){const W=["note","attachment","tradein","purchase","purchase-method"],Q=l.task.activities.filter(J=>W.includes(J.type));T.push(...Q)}const E=["note","attachment","tradein","purchase","purchase-method"],H=he.value.filter(W=>E.includes(W.type));return T.push(...H),T.sort((W,Q)=>{const J=new Date(W.timestamp||0);return new Date(Q.timestamp||0)-J})}),h=T=>{I.value=null,k.value=T},S=async T=>{try{await l.storeAdapter.addActivity(l.task.id,{type:T.type,action:T.action,content:T.content,data:T.data,fileName:T.fileName,timestamp:T.timestamp||new Date().toISOString()}),he.value.push({id:T.id||Date.now(),type:T.type,action:T.action,content:T.content,data:T.data,fileName:T.fileName,timestamp:T.timestamp||new Date().toISOString()}),k.value=null,I.value=null}catch(E){console.error("Error saving enrich data:",E)}},x=()=>{k.value=null,I.value=null},M=T=>{I.value=T,k.value=T.type==="purchase-method"?"purchase":T.type},Z=async T=>{try{await l.storeAdapter.deleteActivity(l.task.id,T.id);const E=he.value.findIndex(H=>H.id===T.id);E!==-1&&he.value.splice(E,1)}catch(E){console.error("Error deleting enrich item:",E)}};A(()=>l.task.activities?l.task.activities.filter(T=>T.type==="note"):[]);const ae=A(()=>l.task.activities?l.task.activities.filter(T=>["email","call","sms","whatsapp"].includes(T.type)):[]);A(()=>l.task.activities?l.task.activities.filter(T=>T.type==="attachment"):[]),A(()=>l.task.activities?l.task.activities.filter(T=>T.type==="purchase"):[]),A(()=>l.task.activities?l.task.activities.filter(T=>T.type==="tradein"):[]);const de=T=>{if(!T)return"";const E=new Date(T),W=new Date-E,Q=Math.floor(W/6e4),J=Math.floor(W/36e5),ie=Math.floor(W/864e5);return Q<1?"Just now":Q<60?`${Q}m ago`:J<24?`${J}h ago`:ie<7?`${ie}d ago`:E.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},B=async T=>{await l.storeAdapter.addActivity(l.task.id,{type:T.communicationType||T.type,content:T.content||T.message||"Communication logged",subject:T.subject,template:T.template,timestamp:new Date().toISOString()}),f.value=!1},y=A(()=>l.type==="contact"?"bg-blue-100 text-blue-600":l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),L=q(m.path.startsWith("/tasks")&&!m.path.startsWith("/customer"));re(()=>m.path,T=>{L.value=T.startsWith("/tasks")&&!T.startsWith("/customer")});const ne=()=>{d.push({path:`/customer/${l.task.id}`,query:{type:l.type}})};function ce(T){me.value=!1}const xe=()=>{P.value=!0},Re=async T=>{var H,W,Q,J;const E=T.name;l.type==="lead"?await((W=(H=l.storeAdapter).updateLead)==null?void 0:W.call(H,l.task.id,{assignee:E,assigneeType:T.type,teamId:T.type==="team"?T.id:null})):l.type==="opportunity"&&await((J=(Q=l.storeAdapter).updateOpportunity)==null?void 0:J.call(Q,l.task.id,{assignee:E,assigneeType:T.type,teamId:T.type==="team"?T.id:null})),P.value=!1},se=q(!1),_=q(null),me=q(!1),P=q(!1),V=q(!1),{activeTab:G,showInlineWidget:fe,editingItem:qe,communicationType:kt,inlineContent:he,filteredInlineContent:Me,handleAddNewAction:wt,handleWidgetSave:Te,handleWidgetCancel:Fe,handleEditItem:Je,handleDeleteItem:Xe}=Md({store:l.storeAdapter,taskId:n,getTabForItemType:Pd,isOverviewModalAction:T=>G.value==="overview"&&l.addNewConfig.overviewActions.includes(T)});re(()=>l.task.id,()=>{G.value="overview"});const Ze=()=>{v.value?c.value="request":G.value="overview"},Be=T=>{const E=wt(T);E&&E.modalAction&&(_.value=E.modalAction,se.value=!0)},_e=T=>{if(T==="appointment"){me.value=!0;return}const E={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(T))_.value=T,se.value=!0;else{const H=E[T];H?(G.value=H,setTimeout(()=>{Be(T),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Be(T)}},ke=()=>{se.value=!1,_.value=null},$t=async T=>{var E,H;try{const W=T.type==="FIN"?"Captive Financing":T.type==="LEA"?"Leasing":"Long-Term Rental",Q=((E=T.fields)==null?void 0:E.monthlyInstalment)||0;await Te({type:"purchase-method",action:`added a ${W} purchase method`,content:`${W}: €${Q.toLocaleString()}/month for ${((H=T.fields)==null?void 0:H.duration)||0} months`,data:{purchaseMethodId:T.id,type:T.type,...T.fields}}),ke()}catch(W){console.error("Error saving purchase method:",W)}},et=async T=>{if(_.value==="tradein")try{const{saveTradeInVehicle:E}=Ld(),H=await E(l.type,l.task.id,T.vehicle,T.valuation||{});he.value.push({id:H.activity.id,type:"tradein",action:"added a trade-in",vehicleId:H.vehicle.id,data:H.activity.data,timestamp:H.activity.timestamp,activityId:H.activity.id}),ke()}catch(E){console.error("Error saving trade-in:",E)}else _.value==="purchase"&&(await Te(T),ke())},It=A(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Enrich"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),we=A(()=>[...l.storeAdapter.currentActivities.value,...he.value]);A(()=>_.value==="financing"?"Add Financing":_.value==="tradein"?"Add Trade-in":_.value==="purchase"?"Create Purchase Offer":"");const tt=async T=>{if(l.type==="opportunity")try{await l.storeAdapter.addVehicle(l.task.id,T.vehicleData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(E){console.error("Error selecting vehicle:",E)}},lt=async T=>{if(l.type==="opportunity")try{await l.storeAdapter.createOffer(l.task.id,T.offerData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(E){console.error("Error creating offer:",E)}},Tt=async T=>{var W,Q,J,ie;const E=l.task.tags||[];if(E.includes(T)){V.value=!1;return}const H=[...E,T];try{if(l.type==="lead")await((Q=(W=l.storeAdapter).updateLead)==null?void 0:Q.call(W,l.task.id,{tags:H})),l.storeAdapter.loadLeadById&&await l.storeAdapter.loadLeadById(l.task.id);else if(l.type==="opportunity")await((ie=(J=l.storeAdapter).updateOpportunity)==null?void 0:ie.call(J,l.task.id,{tags:H})),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id);else if(l.type==="contact"){const pe=m.query.type==="account"?"account":"contact";await p.updateCustomer(l.task.id,{tags:H},pe),await p.fetchCustomerById(l.task.id,pe),s("tag-updated")}V.value=!1}catch(pe){console.error("Error adding tag:",pe)}},Ct=T=>{const E={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return E[T]||E.default},St=T=>{const E={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return E[T]||E.default},At=T=>T?new Date(T).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(T,E)=>{var H,W,Q,J,ie,pe;return i(),r("div",Od,[e("header",Rd,[v.value?g("",!0):(i(),r("div",qd,[D(fl,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":y.value,"task-type":t.type,"customer-id":((H=t.task.customer)==null?void 0:H.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:_e,onAddTag:E[0]||(E[0]=F=>V.value=!0)},{"name-action":U(()=>[v.value?(i(),r("button",{key:0,onClick:ne,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...E[15]||(E[15]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):g("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags"])]))]),v.value?v.value?(i(),r("div",Gd,[e("div",Kd,[e("div",Jd,[D(ot,{modelValue:c.value,"onUpdate:modelValue":E[6]||(E[6]=F=>c.value=F),tabs:a,class:"mb-6"},null,8,["modelValue"]),c.value==="manage"?(i(),r("div",Xd,[t.managementWidget?(i(),r("div",Zd,[(i(),j(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:E[7]||(E[7]=F=>T.$emit("car-added",F)),onConvertToLead:E[8]||(E[8]=F=>T.$emit("convert-to-lead")),onConvertToOpportunity:E[9]||(E[9]=F=>T.$emit("convert-to-opportunity")),onVehicleSelected:tt,onCreateOffer:lt,onViewHistory:Ze},null,40,["lead","opportunity","contact","activities"]))])):g("",!0)])):g("",!0),c.value==="request"?(i(),r("div",_d,[e("div",eu,[t.type!=="contact"?(i(),j(Ya,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe},null,8,["task","entity-type","activities"])):g("",!0),D(cn,{task:t.task,"task-type":t.type,"customer-id":((ie=t.task.customer)==null?void 0:ie.id)||t.task.customerId||t.task.id,onAction:_e,onAddTag:E[10]||(E[10]=F=>V.value=!0)},null,8,["task","task-type","customer-id"])]),e("div",tu,[E[16]||(E[16]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-comments text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Communicate")])],-1)),e("div",lu,[D(ft,{"task-type":t.type,"task-id":t.task.id,"phone-number":((pe=t.task.customer)==null?void 0:pe.phone)||"","show-arrow":!1,onSave:B,onCancel:E[11]||(E[11]=F=>f.value=!1)},null,8,["task-type","task-id","phone-number"]),ae.value.length>0?(i(),r("div",au,[e("div",nu,[(i(!0),r(Y,null,K(ae.value,F=>(i(),r("div",{key:F.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",su,[e("span",iu,b(F.type),1),e("span",ou,b(de(F.timestamp)),1)]),e("p",ru,b(F.content),1)]))),128))])])):g("",!0)])]),e("div",du,[E[18]||(E[18]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",uu,[e("div",cu,[we.value.length>0?(i(),r("div",mu)):g("",!0),we.value.length===0?(i(),r("div",fu,[...E[17]||(E[17]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(i(),r("div",pu,[(i(!0),r(Y,null,K(we.value,F=>(i(),r("div",{key:F.id,class:"flex gap-4 relative"},[e("div",{class:R(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",St(F.type)])},[e("i",{class:R([Ct(F.type),"text-fluid-sm"])},null,2)],2),e("div",vu,[e("div",yu,[e("span",bu,b(F.user),1),N(" "+b(F.action),1)]),F.content?(i(),r("div",gu,b(F.content),1)):g("",!0),e("div",xu,b(At(F.timestamp)),1)])]))),128))]))])])])])):g("",!0),c.value==="data"?(i(),r("div",hu,[D(rt,{actions:w,"active-tab":"data",onAction:h}),e("div",null,[k.value==="note"?(i(),j(pt,{key:0,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:S,onCancel:x},null,8,["item","task-type","task-id"])):g("",!0),k.value==="attachment"?(i(),j(vt,{key:1,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:S,onCancel:x},null,8,["item","task-type","task-id"])):g("",!0),k.value==="tradein"?(i(),j(ao,{key:2,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:S,onCancel:x},null,8,["item","task-type","task-id"])):g("",!0),k.value==="purchase"?(i(),j(Wo,{key:3,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:S,onCancel:x},null,8,["item","task-type","task-id"])):g("",!0)]),u.value.length>0?(i(),r("div",ku,[(i(!0),r(Y,null,K(u.value,F=>{var at;return i(),j(je,{key:F.id,item:F,"task-type":t.type,"customer-initials":((at=t.task.customer)==null?void 0:at.initials)||"SK",onEdit:M,onDelete:Z},null,8,["item","task-type","customer-initials"])}),128))])):k.value?g("",!0):(i(),r("div",wu,[...E[19]||(E[19]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-fluid-sm"},"No enrichment data yet",-1),e("p",{class:"text-fluid-xs mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):g("",!0)])])])):g("",!0):(i(),r("div",Fd,[e("div",Bd,[e("main",Ud,[e("div",Nd,[D(ot,{modelValue:$(G),"onUpdate:modelValue":E[1]||(E[1]=F=>Bt(G)?G.value=F:null),tabs:It.value,class:"mb-0"},null,8,["modelValue","tabs"])]),$(G)==="overview"?(i(),r("div",jd,[t.type!=="contact"?(i(),r("div",Wd,[D(ha,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((Q=t.task.requestedCar)==null?void 0:Q.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:xe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):g("",!0),Ut(T.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(i(),r("div",zd,[(i(),j(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:E[2]||(E[2]=F=>T.$emit("car-added",F)),onConvertToLead:E[3]||(E[3]=F=>T.$emit("convert-to-lead")),onConvertToOpportunity:E[4]||(E[4]=F=>T.$emit("convert-to-opportunity")),onViewHistory:Ze,onVehicleSelected:tt,onCreateOffer:lt},null,40,["lead","opportunity","contact","activities"]))])):g("",!0),$(Me).length>0?(i(),r("div",Hd,[(i(!0),r(Y,null,K($(Me),F=>(i(),j(je,{key:F.id,item:F,"task-type":t.type,"customer-initials":"SK",onEdit:$(Je),onDelete:$(Xe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):g("",!0)])):(i(),r("div",Yd,[D(rt,{actions:t.addNewConfig.tabActions,"active-tab":$(G),onAction:Be},null,8,["actions","active-tab"]),e("div",null,[$(fe)==="communication"?(i(),j(ft,{key:0,type:$(kt),"task-type":t.type,"task-id":t.task.id,"phone-number":((J=t.task.customer)==null?void 0:J.phone)||"",item:$(qe),onSave:$(Te),onCancel:$(Fe)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):g("",!0),$(G)==="data"&&$(fe)==="note"?(i(),j(pt,{key:1,item:$(qe),"task-type":t.type,"task-id":t.task.id,onSave:$(Te),onCancel:$(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):g("",!0),$(fe)==="attachment"?(i(),j(vt,{key:2,item:$(qe),"task-type":t.type,"task-id":t.task.id,onSave:$(Te),onCancel:$(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):g("",!0)]),$(Me).length>0?(i(),r("div",Qd,[(i(!0),r(Y,null,K($(Me),F=>(i(),j(je,{key:F.id,item:F,"task-type":t.type,"customer-initials":"SK",onEdit:$(Je),onDelete:$(Xe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):g("",!0)]))])]),D(mi,{title:"Activity summary",activities:we.value,collapsed:L.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:E[5]||(E[5]=F=>L.value=!L.value)},null,8,["activities","collapsed"])])),D(Hr,{show:_.value==="financing"&&se.value,"task-type":t.type,"task-id":t.task.id,onSave:$t,onClose:ke},null,8,["show","task-type","task-id"]),D(dd,{show:_.value==="tradein"&&se.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:et,onClose:ke},null,8,["show","task-type","task-id"]),D(Cd,{show:_.value==="purchase"&&se.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:et,onClose:ke},null,8,["show","task-type","task-id","requested-car"]),D(Nt,{show:P.value,onClose:E[12]||(E[12]=F=>P.value=!1),onConfirm:Re},null,8,["show"]),me.value?(i(),j(jt,{key:2,show:me.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:ce,onCancel:E[13]||(E[13]=F=>me.value=!1)},null,8,["show","customer","assignee"])):g("",!0),D(Vd,{show:V.value,"existing-tags":t.task.tags||[],onClose:E[14]||(E[14]=F=>V.value=!1),onAdd:Tt},null,8,["show","existing-tags"])])}}};function Lu(t){var d,p,n;const o=t.lead;if(!o)return null;const l=ge(o,"lead");if(!l)return((d=oe[te.NEW])==null?void 0:d.primaryAction)||null;const s=oe[l];if(!s)return((p=oe[te.NEW])==null?void 0:p.primaryAction)||null;if(!s.primaryAction)return((n=oe[te.NEW])==null?void 0:n.primaryAction)||null;const m=s.primaryAction;return typeof m=="function"?m({lead:o,displayStage:l}):m}function Pu(t){const o=t.lead;if(!o)return[];const l=ge(o,"lead"),s=oe[l];return s?s.secondaryActions||[]:[]}function ht(t){const o=t.lead;if(!o||!(o.isDisqualified===!0))return!1;const s=ge(o,"lead");return s===te.CLOSED_INVALID||s===te.CLOSED_NOT_INTERESTED||s===te.CLOSED_DUPLICATE}function Mu(t){const o=t.lead;if(!o||ht(t))return!1;const l=ge(o,"lead"),s=oe[l];return s?typeof s.showLQWidget=="function"?s.showLQWidget(o):s.showLQWidget??!1:!1}function Ou(t){const o=t.lead;if(!o||ht(t))return!1;const l=ge(o,"lead"),s=oe[l];return s?s.showDeadlineBanner&&o.nextActionDue:!1}function Ru(t){const o=t.lead;if(!o)return!1;const l=ge(o,"lead"),s=oe[l];return s?s.canPostpone??!1:!1}function qu(t){const o=t.lead;if(!o)return"qualification";const l=ge(o,"lead"),s=oe[l];return s&&s.lqWidgetMode||"qualification"}function ve(t){if(!t)return 0;const o=new Date(t),s=Math.abs(new Date-o);return Math.ceil(s/(1e3*60*60*24))}const $e={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const o=ue(),l=o.getSetting("oofbMinDays"),s=o.getSetting("oofbMaxDays"),m=ve(t.opportunity.createdAt);return m>=l&&m<s+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const l=ue().getSetting("ufbDays");return ve(t.opportunity.createdAt)>=l&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=ue().getSetting("ofbDays");return ve(t.opportunity.lastActivity||t.opportunity.createdAt)>=l&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=ue().getSetting("nfuDays"),s=ve(t.opportunity.lastActivity||t.opportunity.createdAt),m=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return s>=l&&!t.opportunity.contractDate&&!m&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var d;if(!t.opportunity.contractDate)return!1;const l=ue().getSetting("cfbDays"),s=ve(t.opportunity.contractDate),m=(d=t.activities)==null?void 0:d.some(p=>{var n;return p.type==="delivery"||((n=p.action)==null?void 0:n.toLowerCase().includes("delivered"))});return s>=l&&!m},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var d;const o=(d=t.activities)==null?void 0:d.find(p=>{var n;return p.type==="delivery"||((n=p.action)==null?void 0:n.toLowerCase().includes("delivered"))});if(!o)return!1;const s=ue().getSetting("dfbDays");return ve(o.timestamp)>=s},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const o=t.stage;return o==="Closed Won"||o==="Closed Lost"},"is-closed-with-task-widget":t=>$e["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if($e["is-closed"](t))return!1;const o=ue(),l=o.getSetting("abandonedOpportunityDays");if(!o.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const m=t.opportunity.lastActivity||t.opportunity.createdAt;return ve(m)>=l}};function Fu(t,o){if($e["is-closed-with-task-widget"](o))return[Ne.reopen,Ne.requalify,Ne.closeLost];const l=Ke[t];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(s=>{if(!s.conditional)return!0;const m=$e[s.conditional];return m?m(o):!0})}function Bu(t,o){const l=Ke[t];if(!l||!l.taskWidgets)return null;const m=ue().getSetting("autoCloseWidgetsOnClose"),d=$e["is-closed"]({stage:t});for(const p of l.taskWidgets){if(m&&d&&(p.type==="NFU"||p.type==="OFB"))continue;const n=$e[p.condition];if(n&&n(o))return p.type}return null}function Uu(t,o){const l=Ke[t];if(!l||!l.primaryAction)return null;const s=l.primaryAction;return{...s,title:typeof s.title=="function"?s.title(o):s.title,description:typeof s.description=="function"?s.description(o):s.description,label:typeof s.label=="function"?s.label(o):s.label}}function Nu(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function ju(t){return t==="Closed Won"||t==="Closed Lost"}const Wu={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:o}){const l=o,s=d=>{d||l("close")},m=()=>{l("close")};return(d,p)=>(i(),j($(Le),{open:t.show,"onUpdate:open":s},{default:U(()=>[D($(Ce),null,{default:U(()=>[D($(Se),{class:"fixed inset-0 z-50 bg-black/50"}),D($(Ae),{class:"w-full sm:max-w-md"},{default:U(()=>[D($(De),null,{default:U(()=>[D($(Ee),null,{default:U(()=>[N(b(t.title),1)]),_:1})]),_:1}),p[0]||(p[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),D($(Ve),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[D($(z),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Ht as E,oe as L,Ke as O,Hr as P,cn as T,Vu as _,Pu as a,Ou as b,Ru as c,qu as d,Eu as e,dt as f,Lu as g,ut as h,ht as i,ct as j,pt as k,dd as l,Bu as m,Uu as n,Fu as o,ju as p,Nu as q,Id as r,Mu as s,Wu as t,Ld as u};
