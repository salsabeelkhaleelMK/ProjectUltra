import{H as le,R as ve,a4 as at,h as ot,C as nt,c as E,d as h,o as p,e as l,x as H,g as P,B as d,s as t,y as e,n as W,t as A,F as Z,i as X,I as Je,r as O,J as Xe,w as De,p as Oe,T as rt,k as y,ai as Ve,m as Me,l as de,K as it,aa as dt,D as ut,u as ct,a7 as ft,a9 as mt,ae as He,af as Qe,Z as Ye,W as Ae,au as pt,av as vt,aw as gt,ax as yt,M as fe,q as bt,ag as ht,ah as xt,Q as kt}from"./index-BrrG4Zms.js";import{u as et}from"./opportunities-BPg57aoi.js";import{n as L,$ as wt,f as ge,F as ye,L as be,g as he,h as xe,Q as I,o as Te,C as Pe,d as ke,W as oe,U as ne,H as re,j as B,G as ie,c as U,p as $e}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js";import{S as tt}from"./sparkles-CqcWxD2C.js";import{f as Ct,u as St}from"./vehicles-CI37T_a6.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=le("BadgePercentIcon",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 15h.01",key:"lqbp3k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=le("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=le("CheckCircle2Icon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=le("CheckCircleIcon",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=le("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=le("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=le("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=le("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=le("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=le("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=le("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=le("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=le("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=le("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=le("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function Pr(s){if(!s)return"";const i=new Date(s),o=new Date;if(i<o)return"OVERDUE";if(i.toDateString()===o.toDateString()){const u=i-o,v=Math.floor(u/(1e3*60*60)),b=Math.floor(u%(1e3*60*60)/(1e3*60));return v>0?`${v}h ${b}m`:`${b}m`}return i.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Lr(s){return(typeof s=="string"?new Date(s):s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Fr(s){return(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Ge(s){return(s==null?void 0:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function Or(s){if(!s)return"No deadline";const i=new Date(s);if(i<new Date)return"OVERDUE";const n=i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),u=i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${n}, ${u}`}function Ur(s){if(!s)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const i=new Date(s),o=new Date,n=(i-o)/(1e3*60*60);if(n<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(n<2){const u=Math.floor((i-o)/6e4),v=Math.floor(u/60),b=u%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:v>0?`${v}h ${b}m`:`${b}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(n<24){const u=Math.floor(n),v=Math.floor((n-u)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${u}h ${v}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const u=Math.ceil(n/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${u} day${u!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function Rr(s){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700"}function Nr(s){return s?new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const Le={[ve.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ve.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:s=>!!(s.callbackDate||s.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ve.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[ve.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ve.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ve.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Ze={toClosed:(s,i,o)=>{const n={isDisqualified:!0,disqualifyReason:(o==null?void 0:o.reason)||null,disqualifyCategory:(o==null?void 0:o.category)||null,scheduledAppointment:null,nextActionDue:null};(o==null?void 0:o.reason)==="Duplicate"?(n.isDuplicate=!0,n.stage="Closed Failed"):(o==null?void 0:o.category)==="Not Interested"?n.stage="Not Interested":n.stage="Not Valid",n.status="Disqualified";const u=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(o==null?void 0:o.category)||"Unknown"}, Reason: ${(o==null?void 0:o.reason)||"Unknown"}`}];return s.scheduledAppointment&&u.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:s.scheduledAppointment}}),{updates:n,activities:u}},reopen:s=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function zr(s,i){return i.startsWith("Closed")?Ze.toClosed:s.startsWith("Closed")&&!i.startsWith("Closed")?Ze.reopen:null}const je={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:s=>s.scheduledAppointment&&s.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:i=>{const o=new Date(i.scheduledAppointment.start);return`Appointment scheduled for ${i.formatDateTime?i.formatDateTime(i.scheduledAppointment.start):o.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"reschedule",title:"Reschedule Appointment",description:s=>s.scheduledAppointment&&s.scheduledAppointment.start?`Scheduled for ${s.formatDateTime?s.formatDateTime(s.scheduledAppointment.start):new Date(s.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:"Reschedule",icon:"fa-solid fa-calendar-days",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"In Negotiation":{primaryAction:s=>s.hasOffers?null:{key:"create-offer",title:"Create Offer",description:"Create initial offer to begin negotiation",label:"Create Offer",icon:"fa-solid fa-file-invoice-dollar",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"reassign",label:"Reassign",icon:"fa-solid fa-user-group",description:"Assign this opportunity to another sales rep"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"In Negotiation - Offer Sent":{primaryAction:null,secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation - Contract Pending":{primaryAction:s=>{const i=s.opportunity,o=!!i.deliveryDate,n=!!i.contractSigned||!!i.esignatureCollectedDate;return o&&!n?{key:"collect-esignatures",title:"Collect e-signatures",description:"Get the formal contract signed electronically by the customer",label:"Collect e-signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}}:o?null:{key:"set-delivery-date",title:"Set Delivery Date",description:"Schedule the delivery date for the vehicle",label:"Set Delivery Date",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-pending-5-plus-days"}]},"Closed Won":{primaryAction:s=>{const i=s.deliverySubstatus;return i==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback or complete delivery checklist",label:"Confirm Satisfaction",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:i==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Request Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered",description:"Collect customer feedback about delivery experience"},{key:"complete-checklist",label:"Complete Checklist",icon:"fa-solid fa-clipboard-check",conditional:"is-delivered",description:"Complete post-delivery checklist and documentation"},{key:"reschedule-delivery",label:"Reschedule",icon:"fa-solid fa-calendar-days",conditional:"is-awaiting-delivery",description:"Reschedule the delivery date"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"archive",label:"Archive",icon:"fa-solid fa-archive",conditional:"is-delivered",description:"Archive this completed opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"closed-won-contract-feedback"},{type:"DFB",condition:"delivery-delay-feedback-required"},{type:"DFB",condition:"delivery-feedback-required"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ee={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},Rt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},Nt={class:"flex items-center justify-between gap-2 mb-4"},zt={class:"flex flex-col"},Bt={class:"space-y-3"},qt={class:"flex items-start justify-between gap-2"},Et={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},jt={class:"flex items-start justify-between gap-2"},_t={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Wt={class:"flex items-center justify-between gap-2"},Ht={class:"flex items-center gap-1 min-w-0 flex-1 justify-end"},Qt={class:"text-sm font-medium text-foreground leading-5 text-right truncate min-w-0"},Yt={key:0,class:"flex items-start justify-between gap-2"},Gt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Zt={key:0,class:"mt-4 pt-4 border-t border-border"},Kt={class:"space-y-0.5"},Jt=["onClick"],Xt={class:"text-sm font-medium text-foreground truncate shrink-0 min-w-0"},el={class:"text-sm text-muted-foreground truncate flex-1 min-w-0"},tl={key:0,class:"text-sm font-bold text-foreground shrink-0"},ll={class:"text-sm text-muted-foreground shrink-0"},Br={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(s){const i=s,o=at(),n=ot(),u=nt(),v=et();E(()=>i.task.negotiations||i.task.activeNegotiations||0);const b=E(()=>{if(!i.task.customer)return[];const V=i.task.customer.email,M=i.task.customer.phone,_=i.task.compositeId;return[...(u.leads||[]).map(z=>({...z,type:"lead",compositeId:`lead-${z.id}`})),...(v.opportunities||[]).map(z=>({...z,type:"opportunity",compositeId:`opportunity-${z.id}`}))].filter(z=>z.compositeId===_||!z.customer?!1:z.customer.email===V||z.customer.phone===M).sort((z,F)=>new Date(F.createdAt||0)-new Date(z.createdAt||0)).slice(0,3)}),c=async(V,M)=>{if(V)try{await navigator.clipboard.writeText(V),o.pushToast("success",`${M==="email"?"Email":"Phone"} copied!`)}catch{o.pushToast("error","Failed to copy")}},k=()=>{var M;const V=((M=i.task.customer)==null?void 0:M.id)||i.customerId;if(V){const _=n.resolve(`/customer/${V}`).href;window.open(_,"_blank")}},S=V=>{const[M,_]=V.compositeId.split("-");n.push({path:`/tasks/${_}`,query:{type:M}})},m=V=>V.stage||V.currentStage||"Unknown",C=V=>{const M=V.createdAt||V.nextActionDue||V.updatedAt;if(!M)return"";try{return new Date(M).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},f=V=>{const M=V.requestedCar||V.vehicle;if(!M)return"No vehicle";const _=M.brand||"",K=M.model||"",z=M.year?`(${M.year})`:"";return`${_} ${K} ${z}`.trim()||"Vehicle info N/A"},x=V=>V?V>=1e3?"€"+(V/1e3).toFixed(0)+"k":"€"+V:"€0";return(V,M)=>{var _,K,z,F,D,Y;return p(),h("div",Rt,[l("div",Nt,[M[1]||(M[1]=l("h3",{class:"text-base font-medium text-foreground leading-6"},"Customer information",-1)),(_=s.task.customer)!=null&&_.id?(p(),H(e(L),{key:0,variant:"ghost",size:"icon",onClick:k,class:W("h-7 w-7"),title:"Open customer profile in new tab"},{default:d(()=>[t(e(Dt),{size:14,class:"text-muted-foreground"})]),_:1})):P("",!0)]),l("div",zt,[l("div",Bt,[l("div",qt,[M[2]||(M[2]=l("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Customer",-1)),l("p",Et,A(((K=s.task.customer)==null?void 0:K.name)||"Unknown"),1)]),l("div",jt,[M[3]||(M[3]=l("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Email",-1)),l("p",_t,A(((z=s.task.customer)==null?void 0:z.email)||"N/A"),1)]),l("div",Wt,[M[4]||(M[4]=l("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Phone",-1)),l("div",Ht,[l("p",Qt,A(((F=s.task.customer)==null?void 0:F.phone)||"N/A"),1),(D=s.task.customer)!=null&&D.phone?(p(),H(e(L),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 shrink-0 text-muted-foreground hover:text-foreground",title:"Copy phone number",onClick:M[0]||(M[0]=w=>c(s.task.customer.phone,"phone"))},{default:d(()=>[t(e(At),{size:14})]),_:1})):P("",!0)])]),(Y=s.task.customer)!=null&&Y.address?(p(),h("div",Yt,[M[5]||(M[5]=l("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Address",-1)),l("p",Gt,A(s.task.customer.address),1)])):P("",!0)]),b.value.length>0?(p(),h("div",Zt,[M[6]||(M[6]=l("h3",{class:"text-base font-medium text-foreground mb-4 leading-6"},"Other customer requests",-1)),l("div",Kt,[(p(!0),h(Z,null,X(b.value,w=>(p(),h("div",{key:w.compositeId,onClick:g=>S(w),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[l("span",{class:W(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",w.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},A(w.type==="lead"?"Lead":"Opp"),3),l("span",Xt,A(m(w)),1),l("span",el,A(f(w)),1),w.type==="opportunity"&&w.estimatedValue?(p(),h("span",tl,A(x(w.estimatedValue)),1)):P("",!0),l("span",ll,A(C(w)),1)],8,Jt))),128))])])):P("",!0)])])}}},sl={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},al={class:"mb-4"},ol={class:"flex items-center justify-between mb-2"},nl={class:"flex items-center gap-2 flex-wrap"},rl={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},il={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},dl={class:"relative"},ul={class:"space-y-6 flex-1 flex flex-col min-h-0"},cl={key:0,class:"flex-1 overflow-y-auto min-h-0"},fl={class:"flex flex-col items-start gap-1 mb-4"},ml={class:"text-sm font-normal text-muted-foreground leading-normal"},pl={class:"space-y-4"},vl=["onClick"],gl={class:"flex-1 min-w-0"},yl={class:"flex items-start justify-between gap-2"},bl={class:"text-sm text-foreground flex-1 wrap-break-word min-w-0 leading-normal"},hl={key:0,class:"text-muted-foreground"},xl={key:1,class:"text-muted-foreground"},kl={key:2,class:"text-muted-foreground"},wl={key:3,class:"text-muted-foreground"},Cl={key:4,class:"text-muted-foreground"},Sl={key:5,class:"text-muted-foreground"},$l={key:6,class:"text-muted-foreground"},Vl={class:"text-sm text-muted-foreground text-right shrink-0 w-14 leading-normal"},Il={key:0,class:"mt-2 bg-amber-50 rounded-lg p-4 backdrop-blur-sm"},Tl={class:"text-sm text-foreground wrap-break-word leading-normal"},Al={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},Dl={class:"text-sm text-foreground wrap-break-word leading-normal"},Ml={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},Pl={class:"text-sm text-foreground wrap-break-word leading-normal"},Ll={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},Fl={class:"text-sm text-foreground wrap-break-word leading-normal"},Ol={key:0,class:"flex items-center gap-2 flex-wrap"},Ul={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},Rl={class:"text-center"},Nl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(s,{emit:i}){const o=s,n=i,u=O(!1),v=O(!1),b=O(null),c=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],k=O([]),S=()=>{v.value=!v.value},m=F=>{v.value=!1;const D=k.value.indexOf(F);D>-1?k.value.splice(D,1):k.value.push(F)},C=F=>{const D=k.value.indexOf(F);D>-1&&k.value.splice(D,1)},f=F=>{const D=c.find(Y=>Y.value===F);return D?D.label:F},x=E(()=>c.map(F=>({key:F.value,label:F.label,onClick:()=>m(F.value),className:k.value.includes(F.value)?"filter-item-selected":""}))),V=F=>F.important||F.isImportant?"important":["email","sms","whatsapp","call"].includes(F.type)?"communications":F.type==="note"?"notes":F.type==="transcription"||F.transcription?"transcriptions":F.type==="system"||F.type==="created"||F.type==="status"?"system-updates":null,M=E(()=>{let F=[...o.activities];return k.value.length>0&&(F=F.filter(D=>{const Y=V(D);return Y&&k.value.includes(Y)})),F.sort((D,Y)=>{const w=new Date(D.timestamp||D.createdAt||0).getTime();return new Date(Y.timestamp||Y.createdAt||0).getTime()-w})}),_=F=>{if(!F||F.length===0)return"";const D=F[0],Y=D.timestamp||D.createdAt;if(!Y)return"Recent Activity";const w=new Date(Y),g=new Date,a=new Date(g);return a.setDate(a.getDate()-1),w.toDateString()===g.toDateString()?"Today":w.toDateString()===a.toDateString()?"Yesterday":w.toLocaleDateString("en-US",{month:"long",day:"numeric",year:w.getFullYear()!==g.getFullYear()?"numeric":void 0})},K=F=>{["note","email","whatsapp"].includes(F.type)&&n("activity-click",F)},z=F=>{u.value=!1,n("add-activity",F)};return(F,D)=>{const Y=Xe("click-outside");return p(),h("div",sl,[l("div",al,[l("div",ol,[D[17]||(D[17]=l("h3",{class:"text-base font-medium text-foreground leading-6"},"Activity",-1)),l("div",nl,[l("div",{class:"relative",ref_key:"filterContainer",ref:b},[t(e(L),{variant:"outline",size:"icon",onClick:De(S,["stop"]),class:"relative w-8 h-8"},{default:d(()=>[D[8]||(D[8]=l("i",{class:"fa-solid fa-filter text-sm"},null,-1)),k.value.length>0?(p(),h("span",rl)):P("",!0)]),_:1}),t(rt,{name:"dropdown"},{default:d(()=>[v.value?Oe((p(),h("div",il,[t(e(wt),{items:x.value,className:"w-56"},null,8,["items"])])),[[Y,()=>v.value=!1]]):P("",!0)]),_:1})],512),l("div",dl,[t(e(L),{variant:"default",size:"icon",onClick:D[0]||(D[0]=De(w=>u.value=!u.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:d(()=>[...D[9]||(D[9]=[l("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),u.value?Oe((p(),h("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1 z-50",onClick:D[7]||(D[7]=De(()=>{},["stop"]))},[l("button",{onClick:D[1]||(D[1]=w=>z("email")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[10]||(D[10]=[l("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),y(" Email ",-1)])]),l("button",{onClick:D[2]||(D[2]=w=>z("sms")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[11]||(D[11]=[l("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),y(" SMS ",-1)])]),l("button",{onClick:D[3]||(D[3]=w=>z("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[12]||(D[12]=[l("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),y(" WhatsApp ",-1)])]),l("button",{onClick:D[4]||(D[4]=w=>z("call")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[13]||(D[13]=[l("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),y(" Call ",-1)])]),D[16]||(D[16]=l("div",{class:"border-t border-black/10 my-1"},null,-1)),l("button",{onClick:D[5]||(D[5]=w=>z("note")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[14]||(D[14]=[l("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),y(" Note ",-1)])]),l("button",{onClick:D[6]||(D[6]=w=>z("attachment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...D[15]||(D[15]=[l("i",{class:"fa-solid fa-paperclip text-sm text-muted-foreground"},null,-1),y(" Attachment ",-1)])])])),[[Y,()=>u.value=!1]]):P("",!0)])])])]),l("div",ul,[M.value.length>0?(p(),h("div",cl,[l("div",fl,[l("h3",ml,A(_(M.value)),1)]),l("div",pl,[(p(!0),h(Z,null,X(M.value,w=>(p(),h("div",{key:w.id,class:"space-y-2"},[l("div",{class:W(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":w.type==="note"||w.type==="email"||w.type==="whatsapp"}]),onClick:g=>K(w)},[l("div",{class:W(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",w.type==="note"?"bg-orange-100":w.type==="call"?"bg-green-100":w.type==="ai-summary"?"bg-purple-100":w.type==="email"?"bg-blue-100":w.type==="whatsapp"?"bg-green-100":"bg-muted"])},[w.type==="note"?(p(),H(e(Ut),{key:0,size:16,class:"text-orange-600"})):w.type==="call"?(p(),H(e(Ot),{key:1,size:16,class:"text-green-600"})):w.type==="ai-summary"?(p(),H(e(tt),{key:2,size:16,class:"text-purple-600"})):w.type==="email"?(p(),H(e(Pt),{key:3,size:16,class:"text-blue-600"})):w.type==="whatsapp"?(p(),H(e(Lt),{key:4,size:16,class:"text-green-600"})):(p(),H(e(Mt),{key:5,size:16,class:"text-foreground"}))],2),l("div",gl,[l("div",yl,[l("p",bl,[l("span",{class:W(["font-normal",w.type==="ai-summary"?"font-medium":""])},A(w.type==="ai-summary"?"MotorKAI":w.user),3),w.type==="note"?(p(),h("span",hl," added a note")):w.type==="created"?(p(),h("span",xl,A(w.message||w.action),1)):w.type==="call"?(p(),h("span",kl,A(" "+(w.message||w.action)),1)):w.type==="ai-summary"?(p(),h("span",wl," summary")):w.type==="email"?(p(),h("span",Cl,A(" sent an email"))):w.type==="whatsapp"?(p(),h("span",Sl,A(" sent a WhatsApp message"))):(p(),h("span",$l,A(" "+(w.message||w.action)),1))]),l("p",Vl,A(w.time),1)]),w.type==="note"&&(w.message||w.content)?(p(),h("div",Il,[l("p",Tl,A(w.message||w.content),1)])):P("",!0),w.type==="email"&&w.content?(p(),h("div",Al,[l("p",Dl,A(w.content),1)])):P("",!0),w.type==="whatsapp"&&w.content?(p(),h("div",Ml,[l("p",Pl,A(w.content),1)])):P("",!0),w.type==="ai-summary"&&(w.message||w.content)?(p(),h("div",Ll,[l("p",Fl,A(w.message||w.content),1)])):P("",!0)])],10,vl)]))),128)),k.value.length>0?(p(),h("div",Ol,[(p(!0),h(Z,null,X(k.value,w=>(p(),h("div",{key:w,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-muted text-sm font-medium text-foreground border border-border"},[l("span",null,A(f(w)),1),t(e(L),{variant:"ghost",size:"icon",onClick:g=>C(w),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:d(()=>[...D[18]||(D[18]=[l("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):P("",!0)])])):(p(),h("div",Ul,[l("div",Rl,[t(e(lt),{size:32,class:"mx-auto text-muted-foreground mb-2"}),D[19]||(D[19]=l("p",{class:"text-sm text-muted-foreground"},"No activity yet",-1))])]))])])}}},qr=Je(Nl,[["__scopeId","data-v-8dec5396"]]),zl={class:"overflow-hidden rounded-lg bg-white shadow-nsc-card p-4 flex flex-col w-full"},Bl={key:0,class:"space-y-1.5"},ql={class:"font-medium text-foreground"},El={key:0,class:"text-muted-foreground shrink-0 text-xs"},jl={key:1,class:"text-sm text-muted-foreground py-2"},_l={class:"pt-3 mt-3 border-t border-border"},Er={__name:"TradeInsCard",props:{items:{type:Array,default:()=>[]}},emits:["open-add"],setup(s){function i(o){return o==null?"0":(typeof o=="string"?parseFloat(o):o).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}return(o,n)=>(p(),h("div",zl,[n[2]||(n[2]=l("h3",{class:"text-base font-medium text-foreground leading-6 mb-4"},"Trade-ins",-1)),s.items.length?(p(),h("ul",Bl,[(p(!0),h(Z,null,X(s.items,u=>(p(),h("li",{key:u.id,class:"flex items-center justify-between gap-2 py-1.5 px-2.5 rounded-lg border border-border bg-muted/50 text-sm"},[l("span",ql,A(u.label),1),u.valuation!=null?(p(),h("span",El,"€ "+A(i(u.valuation)),1)):P("",!0)]))),128))])):(p(),h("p",jl,"No trade-ins added yet")),l("div",_l,[t(e(L),{variant:"outline",size:"sm",class:"w-full gap-2",onClick:n[0]||(n[0]=u=>o.$emit("open-add"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),n[1]||(n[1]=y(" Add trade-in ",-1))]),_:1})])]))}},Wl={class:"overflow-hidden rounded-lg bg-white shadow-nsc-card p-4 flex flex-col w-full"},Hl={key:0,class:"space-y-1.5"},Ql={class:"font-medium text-foreground"},Yl={key:0,class:"text-muted-foreground shrink-0 text-xs"},Gl={key:1,class:"text-sm text-muted-foreground py-2"},Zl={class:"pt-3 mt-3 border-t border-border"},jr={__name:"FinancingOptionsCard",props:{items:{type:Array,default:()=>[]}},emits:["open-add"],setup(s){return(i,o)=>(p(),h("div",Wl,[o[2]||(o[2]=l("h3",{class:"text-base font-medium text-foreground leading-6 mb-4"},"Financing options",-1)),s.items.length?(p(),h("ul",Hl,[(p(!0),h(Z,null,X(s.items,n=>(p(),h("li",{key:n.id,class:"flex items-center justify-between gap-2 py-1.5 px-2.5 rounded-lg border border-border bg-muted/50 text-sm"},[l("span",Ql,A(n.label),1),n.termMonths?(p(),h("span",Yl,A(n.termMonths)+" months",1)):P("",!0)]))),128))])):(p(),h("p",Gl,"No financing options added yet")),l("div",Zl,[t(e(L),{variant:"outline",size:"sm",class:"w-full gap-2",onClick:o[0]||(o[0]=n=>i.$emit("open-add"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),o[1]||(o[1]=y(" Add financing option ",-1))]),_:1})])]))}},Kl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Jl={class:"space-y-2"},Xl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},es={key:1,class:"flex justify-between items-center mb-4"},ts={class:"text-sm font-semibold text-foreground"},ls={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},_r={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(s,{expose:i,emit:o}){const n=s,u=o,v=O(""),b=O(!1);Me(()=>{n.item&&(v.value=n.item.content||n.item.message||"")}),de(()=>n.item,m=>{m&&(v.value=m.content||m.message||"")},{deep:!0}),de(()=>n.show,m=>{n.modal&&!m&&setTimeout(()=>{v.value=n.item&&(n.item.content||n.item.message)||"",b.value=!1},300)});const c=async()=>{var m,C;if(v.value.trim()){b.value=!0;try{const f={id:((m=n.item)==null?void 0:m.id)||Date.now(),type:"note",action:n.item?"updated a note":"added a note",content:v.value,message:v.value,timestamp:((C=n.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!n.item};u("save",f),n.modal&&u("close")}finally{b.value=!1}}},k=()=>{u("cancel"),n.modal&&u("close")},S=m=>{m||u("close")};return i({submit:c,canSubmit:()=>!!v.value.trim()}),(m,C)=>s.modal?(p(),H(e(ke),{key:0,open:s.show,"onUpdate:open":S},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:d(()=>[t(e(he),{class:"flex-shrink-0"},{default:d(()=>[t(e(xe),null,{default:d(()=>[y(A(s.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),l("div",Kl,[l("div",Jl,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...C[2]||(C[2]=[y(" Note ",-1),l("span",{class:"text-brand-red"},"*",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":C[0]||(C[0]=f=>v.value=f),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),t(e(Pe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:d(()=>[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),t(e(L),{label:b.value?"Saving...":s.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value.trim()||b.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(p(),h("div",{key:1,class:W(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!s.hideHeader}])},[s.hideHeader?P("",!0):(p(),h("div",Xl)),s.hideHeader?P("",!0):(p(),h("div",es,[l("h5",ts,A(s.item?"Edit Note":"Add Note"),1),l("button",{onClick:k,class:"text-muted-foreground hover:text-muted-foreground"},[...C[3]||(C[3]=[l("i",{class:"fa-solid fa-xmark"},null,-1)])])])),l("div",null,[C[4]||(C[4]=l("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Note",-1)),Oe(l("textarea",{"onUpdate:modelValue":C[1]||(C[1]=f=>v.value=f),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[it,v.value]])]),s.hideActions?P("",!0):(p(),h("div",ls,[t(e(L),{label:"Cancel",variant:"outline",size:"small",onClick:k}),t(e(L),{label:"Save",variant:"primary",size:"small",onClick:c})]))],2))}},ss={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},as={class:"space-y-2"},os={class:"flex items-center gap-3"},ns={key:0,class:"text-sm text-muted-foreground truncate"},rs={key:1,class:"text-sm text-muted-foreground"},is={key:1,class:"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6 animate-fade-in relative"},ds={class:"flex justify-between items-center mb-4"},us={class:"text-sm font-semibold text-foreground"},cs={class:"flex items-center gap-3"},fs={key:0,class:"text-sm text-slate-600"},ms={key:1,class:"text-sm text-muted-foreground"},ps={class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Wr={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(s,{expose:i,emit:o}){const n=s,u=o,v=O(null),b=O(""),c=O(!1),k=O(null);Me(()=>{n.item&&(b.value=n.item.fileName||"")}),de(()=>n.item,x=>{x&&(b.value=x.fileName||"")},{deep:!0}),de(()=>n.show,x=>{n.modal&&!x&&setTimeout(()=>{v.value=null,b.value=n.item&&n.item.fileName||"",c.value=!1},300)});const S=x=>{const V=x.target.files[0];V&&(v.value=V,b.value=V.name)},m=async()=>{var x,V;if(!(!v.value&&!n.item)){c.value=!0;try{const M={id:((x=n.item)==null?void 0:x.id)||Date.now(),type:"attachment",action:n.item?"updated an attachment":"added an attachment",fileName:b.value,file:v.value,timestamp:((V=n.item)==null?void 0:V.timestamp)||new Date().toISOString(),isEdit:!!n.item};u("save",M),n.modal&&u("close")}finally{c.value=!1}}},C=()=>{u("cancel"),n.modal&&u("close")},f=x=>{x||u("close")};return i({submit:m,canSubmit:()=>!!v.value||!!n.item}),(x,V)=>s.modal?(p(),H(e(ke),{key:0,open:s.show,"onUpdate:open":f},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:d(()=>[t(e(he),{class:"flex-shrink-0"},{default:d(()=>[t(e(xe),null,{default:d(()=>[y(A(s.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),l("div",ss,[l("div",as,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...V[2]||(V[2]=[y(" File ",-1),l("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l("div",os,[l("input",{type:"file",onChange:S,ref_key:"fileInput",ref:k,class:"hidden"},null,544),t(e(L),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:V[0]||(V[0]=M=>{var _;return(_=k.value)==null?void 0:_.click()})}),b.value?(p(),h("span",ns,A(b.value),1)):(p(),h("span",rs,"No file selected"))])])]),t(e(Pe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:d(()=>[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:C}),t(e(L),{label:c.value?"Saving...":s.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value||c.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(p(),h("div",is,[V[5]||(V[5]=l("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),l("div",ds,[l("h5",us,A(s.item?"Edit Attachment":"Add Attachment"),1),l("button",{onClick:C,class:"text-muted-foreground hover:text-muted-foreground"},[...V[3]||(V[3]=[l("i",{class:"fa-solid fa-xmark"},null,-1)])])]),l("div",null,[V[4]||(V[4]=l("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),l("div",cs,[l("input",{type:"file",onChange:S,ref_key:"fileInput",ref:k,class:"hidden"},null,544),t(e(L),{label:"Choose File",variant:"outline",size:"small",onClick:V[1]||(V[1]=M=>x.$refs.fileInput.click())}),b.value?(p(),h("span",fs,A(b.value),1)):(p(),h("span",ms,"No file selected"))])]),l("div",ps,[t(e(L),{label:"Cancel",variant:"outline",size:"small",onClick:C}),t(e(L),{label:"Save",variant:"primary",size:"small",disabled:!v.value,onClick:m},null,8,["disabled"])])]))}},vs={class:"space-y-6"},gs={class:"space-y-2"},ys={class:"space-y-2"},bs={class:"flex justify-end gap-3"},hs={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const o=s,n=i,u=O(o.initialTemplate),v=O(o.initialMessage),b={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},c=()=>{u.value&&b[u.value]&&(v.value=b[u.value])},k=()=>{v.value.trim()&&n("send",{type:"whatsapp",template:u.value,message:v.value})};return(S,m)=>(p(),h("div",vs,[l("div",gs,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...m[3]||(m[3]=[y("Template",-1)])]),_:1}),t(e(ie),{modelValue:u.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>u.value=C),c]},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select a template..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Follow-up"},{default:d(()=>[...m[4]||(m[4]=[y("Follow-up",-1)])]),_:1}),t(e(B),{value:"Meeting Confirmation"},{default:d(()=>[...m[5]||(m[5]=[y("Meeting Confirmation",-1)])]),_:1}),t(e(B),{value:"Quote Proposal"},{default:d(()=>[...m[6]||(m[6]=[y("Quote Proposal",-1)])]),_:1}),t(e(B),{value:"Unable to Reach"},{default:d(()=>[...m[7]||(m[7]=[y("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",ys,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...m[8]||(m[8]=[y("Message",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),l("div",bs,[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>S.$emit("cancel"))}),t(e(L),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:k})])]))}},Hr={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const o=i,n=v=>{o("save",v),o("close")},u=v=>{v||o("close")};return(v,b)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":u},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:d(()=>[t(e(he),null,{default:d(()=>[t(e(xe),null,{default:d(()=>[...b[1]||(b[1]=[y("Send WhatsApp Message",-1)])]),_:1})]),_:1}),t(hs,{onSend:n,onCancel:b[0]||(b[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},xs={class:"space-y-6"},ks={class:"space-y-2"},ws={class:"space-y-2"},Cs={class:"text-xs text-muted-foreground mt-1"},Ss={class:"flex justify-end gap-3"},$s={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const o=s,n=i,u=O(o.initialTemplate),v=O(o.initialMessage),b={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},c=()=>{u.value&&b[u.value]&&(v.value=b[u.value])},k=()=>{v.value.trim()&&n("send",{type:"sms",template:u.value,message:v.value})};return(S,m)=>(p(),h("div",xs,[l("div",ks,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...m[3]||(m[3]=[y("Template",-1)])]),_:1}),t(e(ie),{modelValue:u.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>u.value=C),c]},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select a template..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Follow-up"},{default:d(()=>[...m[4]||(m[4]=[y("Follow-up",-1)])]),_:1}),t(e(B),{value:"Meeting Confirmation"},{default:d(()=>[...m[5]||(m[5]=[y("Meeting Confirmation",-1)])]),_:1}),t(e(B),{value:"Quote Proposal"},{default:d(()=>[...m[6]||(m[6]=[y("Quote Proposal",-1)])]),_:1}),t(e(B),{value:"Unable to Reach"},{default:d(()=>[...m[7]||(m[7]=[y("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",ws,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...m[8]||(m[8]=[y("Message",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),l("p",Cs,A(v.value.length)+"/160 characters",1)]),l("div",Ss,[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>S.$emit("cancel"))}),t(e(L),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:k})])]))}},Qr={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const o=i,n=v=>{o("save",v),o("close")},u=v=>{v||o("close")};return(v,b)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":u},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:d(()=>[t(e(he),null,{default:d(()=>[t(e(xe),null,{default:d(()=>[...b[1]||(b[1]=[y("Send SMS",-1)])]),_:1})]),_:1}),t($s,{onSend:n,onCancel:b[0]||(b[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Vs={class:"space-y-6"},Is={class:"space-y-2"},Ts={class:"space-y-2"},As={class:"space-y-2"},Ds={class:"flex justify-end gap-3"},Ms={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const o=s,n=i,u=O(o.initialTemplate),v=O(""),b=O(o.initialMessage),c={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},k=()=>{u.value&&c[u.value]&&(v.value=c[u.value].subject,b.value=c[u.value].message)},S=()=>{b.value.trim()&&n("send",{type:"email",template:u.value,subject:v.value,message:b.value})};return(m,C)=>(p(),h("div",Vs,[l("div",Is,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...C[4]||(C[4]=[y("Template",-1)])]),_:1}),t(e(ie),{modelValue:u.value,"onUpdate:modelValue":[C[0]||(C[0]=f=>u.value=f),k]},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select a template..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Follow-up"},{default:d(()=>[...C[5]||(C[5]=[y("Follow-up",-1)])]),_:1}),t(e(B),{value:"Meeting Confirmation"},{default:d(()=>[...C[6]||(C[6]=[y("Meeting Confirmation",-1)])]),_:1}),t(e(B),{value:"Quote Proposal"},{default:d(()=>[...C[7]||(C[7]=[y("Quote Proposal",-1)])]),_:1}),t(e(B),{value:"Unable to Reach"},{default:d(()=>[...C[8]||(C[8]=[y("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Ts,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...C[9]||(C[9]=[y("Subject",-1)])]),_:1}),t(e(U),{modelValue:v.value,"onUpdate:modelValue":C[1]||(C[1]=f=>v.value=f),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),l("div",As,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...C[10]||(C[10]=[y("Message",-1)])]),_:1}),t(e(Te),{modelValue:b.value,"onUpdate:modelValue":C[2]||(C[2]=f=>b.value=f),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),l("div",Ds,[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:C[3]||(C[3]=f=>m.$emit("cancel"))}),t(e(L),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:S})])]))}},Yr={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const o=i,n=v=>{o("save",v),o("close")},u=v=>{v||o("close")};return(v,b)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":u},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:d(()=>[t(e(he),null,{default:d(()=>[t(e(xe),null,{default:d(()=>[...b[1]||(b[1]=[y("Send Email",-1)])]),_:1})]),_:1}),t(Ms,{onSend:n,onCancel:b[0]||(b[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Gr={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(s,{emit:i}){const o=i,n=v=>{v||o("close")},u=()=>{o("close")};return(v,b)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":n},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:d(()=>[t(e(he),{class:"flex-shrink-0"},{default:d(()=>[t(e(xe),null,{default:d(()=>[y(A(s.title),1)]),_:1})]),_:1}),b[0]||(b[0]=l("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[l("div",{class:"flex items-center justify-center w-full"},[l("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),t(e(Pe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:d(()=>[t(e(L),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class Ps extends dt{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(i={}){await new Promise(n=>setTimeout(n,300));let o=[...this.dataSource];return i.leadId!==void 0&&(o=o.filter(n=>n.leadId===parseInt(i.leadId))),i.opportunityId!==void 0&&(o=o.filter(n=>n.opportunityId===parseInt(i.opportunityId))),i.type&&(o=o.filter(n=>n.type===i.type)),i.offerId!==void 0&&(o=o.filter(n=>n.offerId===parseInt(i.offerId))),i.vehicleId!==void 0&&(o=o.filter(n=>n.vehicleId===parseInt(i.vehicleId))),o}async findAllByLeadId(i){return this.findAll({leadId:i})}async findAllByOpportunityId(i){return this.findAll({opportunityId:i})}async findById(i){return await new Promise(n=>setTimeout(n,300)),this.dataSource.find(n=>n.id===parseInt(i))||null}async create(i){await new Promise(u=>setTimeout(u,300));const n={id:this.dataSource.length>0?Math.max(...this.dataSource.map(u=>u.id))+1:1,type:i.type,leadId:i.leadId!==void 0?parseInt(i.leadId):void 0,opportunityId:i.opportunityId!==void 0?parseInt(i.opportunityId):void 0,offerId:i.offerId!==void 0?parseInt(i.offerId):void 0,vehicleId:i.vehicleId!==void 0?parseInt(i.vehicleId):void 0,fields:i.fields||{},currency:i.currency||"EUR",offerValidFrom:i.offerValidFrom||null,offerValidTo:i.offerValidTo||null,status:i.status||"active",createdAt:i.createdAt||new Date().toISOString(),createdBy:i.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(n),n}async update(i,o){await new Promise(u=>setTimeout(u,300));const n=this.dataSource.find(u=>u.id===parseInt(i));if(!n)throw new Error("Purchase method not found");return Object.assign(n,o,{updatedAt:new Date().toISOString()}),n}async delete(i){await new Promise(n=>setTimeout(n,300));const o=this.dataSource.findIndex(n=>n.id===parseInt(i));if(o===-1)throw new Error("Purchase method not found");return this.dataSource.splice(o,1),{success:!0}}}class Ls{constructor(){this.repository=new Ps}calculateTotal(i){const{type:o,fields:n}=i;if(!n)return 0;const u=parseFloat(n.monthlyInstalment)||0,v=parseFloat(n.downPayment)||0,b=parseInt(n.duration)||0;switch(o){case"FIN":return u*b+v;case"LEA":const c=parseFloat(n.finalInstalment)||0;return u*b+v+c;case"LTR":return u*b+v;default:return 0}}validate(i){const o=[],{type:n,fields:u}=i;if((!n||!["FIN","LEA","LTR"].includes(n))&&o.push("Purchase method type is required and must be FIN, LEA, or LTR"),!u)return o.push("Purchase method fields are required"),{isValid:!1,errors:o};const v=parseFloat(u.monthlyInstalment);(!v||v<=0)&&o.push("Monthly Instalment must be greater than 0");const b=parseFloat(u.downPayment);(b==null||b<0)&&o.push("Down Payment must be greater than or equal to 0");const c=parseInt(u.duration);if((!c||c<12||c>60)&&o.push("Duration must be between 12 and 60 months"),n==="FIN"){const k=parseFloat(u.interestRate);k!=null&&(k<0||k>99.99)&&o.push("Interest Rate must be between 0 and 99.99%");const S=parseFloat(u.effectiveInterestRate);S!=null&&(S<0||S>99.99)&&o.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(n==="LEA"){const k=parseFloat(u.mileageLimit);k!=null&&k<=0&&o.push("Mileage Limit must be greater than 0 if provided");const S=parseFloat(u.finalInstalment);S!=null&&S<0&&o.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(u.interestRate);m!=null&&(m<0||m>99.99)&&o.push("Interest Rate must be between 0 and 99.99%")}if(n==="LTR"){const k=parseFloat(u.mileageLimit);k!=null&&k<=0&&o.push("Mileage Limit must be greater than 0 if provided"),(!u.customerType||!["Private","Business","Fleet"].includes(u.customerType))&&o.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:o.length===0,errors:o}}async findAll(i={}){return await this.repository.findAll(i)}async findById(i){return await this.repository.findById(i)}async create(i){const o=this.validate(i);if(!o.isValid)throw new Error(`Validation failed: ${o.errors.join(", ")}`);const n=await this.repository.create(i),u=this.calculateTotal(n);return n.fields={...n.fields,totalAmount:u},await this.repository.update(n.id,{fields:n.fields})}async update(i,o){const n=await this.repository.findById(i);if(!n)throw new Error("Purchase method not found");const u={...n,...o,fields:{...n.fields,...o.fields}},v=this.validate(u);if(!v.isValid)throw new Error(`Validation failed: ${v.errors.join(", ")}`);const b=this.calculateTotal(u);return u.fields.totalAmount=b,await this.repository.update(i,{...o,fields:u.fields})}async delete(i){return await this.repository.delete(i)}}const Fe=new Ls,Ue=(s=300)=>new Promise(i=>setTimeout(i,s)),Fs=async(s={})=>(await Ue(),await Fe.findAll(s)),Os=async s=>(await Ue(),await Fe.findById(s)),Us=async s=>(await Ue(),await Fe.create(s)),Rs=async(s,i)=>(await Ue(),await Fe.update(s,i)),Ns=async s=>(await Ue(),await Fe.delete(s)),zs=ut("purchaseMethods",()=>{const s=O([]),i=O(null),o=O(!1),n=O(null),u=E(()=>f=>s.value.filter(x=>x.type===f)),v=E(()=>f=>s.value.filter(x=>x.leadId===parseInt(f))),b=E(()=>f=>s.value.filter(x=>x.opportunityId===parseInt(f)));return{purchaseMethods:s,currentPurchaseMethod:i,loading:o,error:n,purchaseMethodsByType:u,purchaseMethodsByLead:v,purchaseMethodsByOpportunity:b,fetchPurchaseMethods:async(f={})=>{o.value=!0,n.value=null;try{const x=await Fs(f);return s.value=x,x}catch(x){throw n.value=x.message,x}finally{o.value=!1}},fetchPurchaseMethodById:async f=>{o.value=!0,n.value=null;try{return i.value=await Os(f),i.value}catch(x){throw n.value=x.message,x}finally{o.value=!1}},createPurchaseMethod:async f=>{o.value=!0,n.value=null;try{const x=await Us(f);return s.value.push(x),x}catch(x){throw n.value=x.message,x}finally{o.value=!1}},updatePurchaseMethod:async(f,x)=>{var V;o.value=!0,n.value=null;try{const M=await Rs(f,x),_=s.value.findIndex(K=>K.id===f);return _!==-1&&(s.value[_]=M),((V=i.value)==null?void 0:V.id)===f&&(i.value=M),M}catch(M){throw n.value=M.message,M}finally{o.value=!1}},deletePurchaseMethod:async f=>{var x;o.value=!0,n.value=null;try{await Ns(f),s.value=s.value.filter(V=>V.id!==f),((x=i.value)==null?void 0:x.id)===f&&(i.value=null)}catch(V){throw n.value=V.message,V}finally{o.value=!1}}}}),Bs={class:"flex-1 overflow-y-auto py-4 w-full space-y-6"},qs={class:"space-y-2"},Es={class:"space-y-3"},js=["value"],_s={class:"text-sm font-medium text-foreground"},Ws={key:0,class:"space-y-4"},Hs={class:"text-base font-medium text-foreground"},Qs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ys={class:"space-y-2"},Gs={class:"relative"},Zs={key:0,class:"text-xs text-destructive"},Ks={class:"space-y-2"},Js={class:"relative"},Xs={key:0,class:"text-xs text-destructive"},ea={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ta={class:"space-y-2"},la={key:0,class:"text-xs text-destructive"},sa={class:"space-y-2"},aa={key:0,class:"text-xs text-destructive"},oa={class:"space-y-2"},na={key:0,class:"text-xs text-destructive"},ra={class:"bg-muted p-4 rounded-lg border border-border"},ia={class:"flex justify-between items-center"},da={class:"text-lg font-bold text-foreground"},ua={class:"flex flex-col gap-3"},ca={class:"flex items-center gap-2"},fa={class:"flex items-center gap-2"},ma={class:"flex items-center gap-2"},pa={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-border"},va={class:"space-y-2"},ga={class:"space-y-2"},ya={key:1,class:"bg-destructive/10 border border-border rounded-lg p-4"},ba={class:"list-disc list-inside text-sm text-foreground space-y-1"},ha={key:0},xa={key:1},Zr={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:s=>["lead","opportunity"].includes(s)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(s,{emit:i}){const o=s,n=i,u=zs(),v=ct(),b=O(!1),c=O({}),k=O([]),S=[{value:"FIN",label:"Financing"},{value:"LEA",label:"Leasing"},{value:"LTR",label:"Long-Term Rental"}],m=O({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),C=E(()=>!!o.purchaseMethod);E(()=>{if(m.value.type!=="LEA")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,a=parseFloat(m.value.fields.downPayment)||0,G=parseFloat(m.value.fields.finalInstalment)||0;return w*g+a+G});const f=E(()=>{if(m.value.type!=="LTR")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,a=parseFloat(m.value.fields.downPayment)||0;return w*g+a}),x=w=>w==="FIN"?[12,24,36,48,60]:w==="LEA"?[24,36,48,60]:w==="LTR"?[12,24,36,48,60]:[],V=w=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[w]||w,M=w=>{const g=m.value.fields[w];switch(w){case"monthlyInstalment":!g||g<=0?c.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete c.value.monthlyInstalment;break;case"downPayment":g==null||g<0?c.value.downPayment="Down Payment must be greater than or equal to 0":delete c.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!g||g<12||g>60)?c.value.duration="Duration must be between 12 and 60 months":delete c.value.duration;break;case"customerType":m.value.type==="LTR"&&(!g||!["Private","Business","Fleet"].includes(g))?c.value.customerType="Customer Type is required":delete c.value.customerType;break}},_=w=>{delete c.value[w]},K=()=>{k.value=[],c.value={};const w=Fe.validate({type:m.value.type,fields:m.value.fields});return w.isValid||(k.value=w.errors,w.errors.forEach(g=>{g.includes("Monthly Instalment")?c.value.monthlyInstalment=g:g.includes("Down Payment")?c.value.downPayment=g:g.includes("Duration")?c.value.duration=g:g.includes("Customer Type")&&(c.value.customerType=g)})),w.isValid},z=E(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(c.value).length===0),F=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),c.value={},k.value=[]},D=async()=>{var w;if(K()){b.value=!0;try{const g={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((w=v.currentUser)==null?void 0:w.id)||null};o.taskType==="lead"?g.leadId=parseInt(o.taskId):o.taskType==="opportunity"&&(g.opportunityId=parseInt(o.taskId)),o.vehicleId&&(g.vehicleId=parseInt(o.vehicleId)),o.offerId&&(g.offerId=parseInt(o.offerId));let a;C.value?a=await u.updatePurchaseMethod(o.purchaseMethod.id,g):a=await u.createPurchaseMethod(g);const G=V(a.type),q=Ge(a.fields.monthlyInstalment||0);n("save",{...a,successMessage:`Purchase Method Added: ${G} - €${q}/month`}),n("close")}catch(g){k.value=[g.message||"Failed to save purchase method"]}finally{b.value=!1}}},Y=w=>{w||n("close")};return Me(()=>{o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null})}),de(()=>o.show,w=>{w?o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},c.value={},k.value=[],b.value=!1},300)}),(w,g)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":Y},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:d(()=>[t(e(he),{class:"flex-shrink-0"},{default:d(()=>[t(e(xe),null,{default:d(()=>[y(A(C.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),l("div",Bs,[l("div",qs,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[19]||(g[19]=[y("Purchase Method Type",-1)])]),_:1}),l("div",Es,[(p(),h(Z,null,X(S,a=>l("label",{key:a.value,class:"flex items-center gap-2 cursor-pointer"},[Oe(l("input",{type:"radio",value:a.value,"onUpdate:modelValue":g[0]||(g[0]=G=>m.value.type=G),class:"size-4 rounded-full border-2 border-border bg-background text-primary focus:ring-primary focus:ring-offset-0",onChange:F},null,40,js),[[ft,m.value.type]]),l("span",_s,A(a.label),1)])),64))])]),m.value.type?(p(),h("div",Ws,[l("h3",Hs,A(V(m.value.type))+" Details ",1),l("div",Qs,[l("div",Ys,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[20]||(g[20]=[y("Monthly Instalment ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),l("div",Gs,[g[21]||(g[21]=l("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),t(e(U),{modelValue:m.value.fields.monthlyInstalment,"onUpdate:modelValue":g[1]||(g[1]=a=>m.value.fields.monthlyInstalment=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",placeholder:"0.00",class:W(["w-full pl-8",{"border-destructive":c.value.monthlyInstalment}]),onInput:g[2]||(g[2]=a=>_("monthlyInstalment")),onBlur:g[3]||(g[3]=a=>M("monthlyInstalment"))},null,8,["modelValue","class"])]),c.value.monthlyInstalment?(p(),h("p",Zs,A(c.value.monthlyInstalment),1)):P("",!0),g[22]||(g[22]=l("p",{class:"text-xs text-muted-foreground"},"Customer's desired monthly payment amount",-1))]),l("div",Ks,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[23]||(g[23]=[y("Down Payment ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),l("div",Js,[g[24]||(g[24]=l("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),t(e(U),{modelValue:m.value.fields.downPayment,"onUpdate:modelValue":g[4]||(g[4]=a=>m.value.fields.downPayment=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",placeholder:"0.00",class:W(["w-full pl-8",{"border-destructive":c.value.downPayment}]),onInput:g[5]||(g[5]=a=>_("downPayment")),onBlur:g[6]||(g[6]=a=>M("downPayment"))},null,8,["modelValue","class"])]),c.value.downPayment?(p(),h("p",Xs,A(c.value.downPayment),1)):P("",!0),g[25]||(g[25]=l("p",{class:"text-xs text-muted-foreground"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(p(),h(Z,{key:0},[l("div",ea,[l("div",ta,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[26]||(g[26]=[y("Duration (months) ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(ie),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[g[7]||(g[7]=a=>m.value.fields.duration=a),g[8]||(g[8]=a=>_("duration"))]},{default:d(()=>[t(e(oe),{class:W(["w-full",{"border-destructive":c.value.duration}])},{default:d(()=>[t(e(ne),{placeholder:"Select duration..."})]),_:1},8,["class"]),t(e(re),null,{default:d(()=>[(p(!0),h(Z,null,X(x(m.value.type),a=>(p(),H(e(B),{key:a,value:a},{default:d(()=>[y(A(a)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c.value.duration?(p(),h("p",la,A(c.value.duration),1)):P("",!0)]),l("div",sa,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[27]||(g[27]=[y("Unlock Kilometers",-1)])]),_:1}),t(e(U),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":g[9]||(g[9]=a=>m.value.fields.mileageLimit=a),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:W(["w-full",{"border-destructive":c.value.mileageLimit}]),onInput:g[10]||(g[10]=a=>_("mileageLimit"))},null,8,["modelValue","class"]),c.value.mileageLimit?(p(),h("p",aa,A(c.value.mileageLimit),1)):P("",!0)])]),l("div",oa,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[28]||(g[28]=[y("Customer Type ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(ie),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[g[11]||(g[11]=a=>m.value.fields.customerType=a),g[12]||(g[12]=a=>_("customerType"))]},{default:d(()=>[t(e(oe),{class:W(["w-full",{"border-destructive":c.value.customerType}])},{default:d(()=>[t(e(ne),{placeholder:"Select customer type..."})]),_:1},8,["class"]),t(e(re),null,{default:d(()=>[t(e(B),{value:"Private"},{default:d(()=>[...g[29]||(g[29]=[y("Private",-1)])]),_:1}),t(e(B),{value:"Business"},{default:d(()=>[...g[30]||(g[30]=[y("Business",-1)])]),_:1}),t(e(B),{value:"Fleet"},{default:d(()=>[...g[31]||(g[31]=[y("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value.customerType?(p(),h("p",na,A(c.value.customerType),1)):P("",!0)]),l("div",ra,[l("div",ia,[g[32]||(g[32]=l("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),l("span",da,"€ "+A(e(Ge)(f.value)),1)]),g[33]||(g[33]=l("p",{class:"text-xs text-muted-foreground mt-1"},"(Monthly × Duration + Down Payment)",-1))]),l("div",ua,[l("div",ca,[t(e($e),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":g[13]||(g[13]=a=>m.value.fields.insuranceIncluded=a)},null,8,["checked"]),t(e(I),{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"},{default:d(()=>[...g[34]||(g[34]=[y("Insurance Included",-1)])]),_:1})]),l("div",fa,[t(e($e),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":g[14]||(g[14]=a=>m.value.fields.maintenanceIncluded=a)},null,8,["checked"]),t(e(I),{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"},{default:d(()=>[...g[35]||(g[35]=[y("Maintenance Included",-1)])]),_:1})]),l("div",ma,[t(e($e),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":g[15]||(g[15]=a=>m.value.fields.registrationTaxesIncluded=a)},null,8,["checked"]),t(e(I),{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"},{default:d(()=>[...g[36]||(g[36]=[y("Registration/Taxes Included",-1)])]),_:1})])])],64)):P("",!0),l("div",pa,[l("div",va,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[37]||(g[37]=[y("Offer Valid From",-1)])]),_:1}),t(e(U),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":g[16]||(g[16]=a=>m.value.offerValidFrom=a),type:"date",class:"w-full"},null,8,["modelValue"])]),l("div",ga,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...g[38]||(g[38]=[y("Offer Valid To",-1)])]),_:1}),t(e(U),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":g[17]||(g[17]=a=>m.value.offerValidTo=a),type:"date",class:"w-full"},null,8,["modelValue"])])])])):P("",!0),k.value.length>0?(p(),h("div",ya,[g[39]||(g[39]=l("h4",{class:"text-sm font-medium text-destructive mb-2"},"Please fix the following errors:",-1)),l("ul",ba,[(p(!0),h(Z,null,X(k.value,a=>(p(),h("li",{key:a},A(a),1))),128))])])):P("",!0)]),t(e(Pe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:d(()=>[t(e(L),{label:"Cancel",variant:"outline",size:"small",onClick:g[18]||(g[18]=a=>w.$emit("close"))}),t(e(L),{variant:"default",size:"small",disabled:!z.value||b.value,onClick:D},{default:d(()=>[b.value?(p(),h("span",ha,"Saving...")):(p(),h("span",xa,A(C.value?"Update":"Save"),1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ka={class:"flex-1 overflow-y-auto py-4 w-full"},wa={key:0,class:"space-y-4 py-4 w-full"},Ca={class:"grid grid-cols-1 gap-3"},Sa={key:1,class:"space-y-6 w-full"},$a={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Va={class:"space-y-2"},Ia={class:"space-y-2"},Ta={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Aa={class:"space-y-2"},Da={class:"space-y-2"},Ma={class:"space-y-2"},Pa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},La={class:"space-y-2"},Fa={class:"space-y-2"},Oa={class:"space-y-2"},Ua={class:"space-y-2"},Ra={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Na={class:"space-y-2"},za={class:"space-y-2"},Ba={class:"space-y-2"},qa={class:"space-y-2"},Ea={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ja={class:"space-y-2"},_a={class:"space-y-2"},Wa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ha={class:"space-y-2"},Qa={class:"space-y-2"},Ya={class:"space-y-2"},Ga={class:"space-y-2"},Za={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ka={class:"space-y-2"},Ja={class:"space-y-2"},Xa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},eo={class:"space-y-2"},to={class:"space-y-2"},Kr={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:s=>["vehicle","tradein"].includes(s)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(s,{emit:i}){const o=s,n=i,u=O(o.mode==="tradein"?"tradein":null);de(()=>o.mode,C=>{C==="tradein"?u.value="tradein":o.item||(u.value=null)});const v=E(()=>o.mode==="tradein"||u.value==="tradein"),b=()=>o.mode==="tradein"||u.value==="tradein"?"Add Trade-In Vehicle":u.value==="drove"?"Add Drove Vehicle":u.value==="requested"?"Add Requested Vehicle":"Add Vehicle",c=O({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null,valuation:null});Me(()=>{o.item&&o.item.data&&(c.value={brand:o.item.data.brand||"",model:o.item.data.model||"",year:o.item.data.year||"",version:o.item.data.version||"",vin:o.item.data.vin||"",plates:o.item.data.plate||o.item.data.plates||"",fuelType:o.item.data.fuelType||"",gearType:o.item.data.gearType||"",kilometers:o.item.data.km||o.item.data.kilometers||"",registration:o.item.data.date||o.item.data.registration||"",owner:o.item.data.owner||"",ownershipType:o.item.data.ownershipType||"",ownedSince:o.item.data.ownedSince||"",warrantyInfo:o.item.data.warrantyInfo||"",note:o.item.data.note||"",stockDays:null,valuation:o.item.data.tradeInPrice??null})}),de(()=>o.show,C=>{C||(u.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null,valuation:null})});const k=E(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),S=C=>{C||n("close")},m=()=>{if(!k.value)return;const C={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,note:c.value.note||null,stockDays:null,status:"Available"}};if(u.value&&(C.vehicleType=u.value),v.value){const f=c.value.valuation;C.valuation={tradeInPrice:f!=null&&f!==""?Number(f):null}}o.item&&(C.id=o.item.id,C.isEdit=!0,C.timestamp=o.item.timestamp||new Date().toISOString()),n("save",C)};return(C,f)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":S},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:d(()=>[t(e(he),{class:"flex-shrink-0"},{default:d(()=>[t(e(xe),null,{default:d(()=>[y(A(b()),1)]),_:1})]),_:1}),l("div",ka,[s.mode==="vehicle"&&!s.item&&!u.value?(p(),h("div",wa,[f[27]||(f[27]=l("p",{class:"text-muted-foreground text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),l("div",Ca,[t(e(L),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[0]||(f[0]=x=>u.value="drove")}),t(e(L),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[1]||(f[1]=x=>u.value="requested")}),t(e(L),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[2]||(f[2]=x=>u.value="tradein")})])])):(p(),h("div",Sa,[v.value?(p(),h(Z,{key:0},[l("div",$a,[l("div",Va,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[28]||(f[28]=[y("Brand ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(U),{modelValue:c.value.brand,"onUpdate:modelValue":f[3]||(f[3]=x=>c.value.brand=x),type:"text",placeholder:"e.g., Volkswagen",class:"w-full",required:""},null,8,["modelValue"])]),l("div",Ia,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[29]||(f[29]=[y("Model ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(U),{modelValue:c.value.model,"onUpdate:modelValue":f[4]||(f[4]=x=>c.value.model=x),type:"text",placeholder:"e.g., ID.4",class:"w-full",required:""},null,8,["modelValue"])])]),l("div",Ta,[l("div",Aa,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[30]||(f[30]=[y("Year (or registration year) ",-1),l("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(U),{modelValue:c.value.year,"onUpdate:modelValue":f[5]||(f[5]=x=>c.value.year=x),type:"number",placeholder:"e.g., 2024",class:"w-full",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),l("div",Da,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[31]||(f[31]=[y("Kilometers",-1)])]),_:1}),t(e(U),{modelValue:c.value.kilometers,"onUpdate:modelValue":f[6]||(f[6]=x=>c.value.kilometers=x),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full",min:"0"},null,8,["modelValue"])])]),l("div",Ma,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[32]||(f[32]=[y("Valuation (€)",-1)])]),_:1}),t(e(U),{modelValue:c.value.valuation,"onUpdate:modelValue":f[7]||(f[7]=x=>c.value.valuation=x),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full",min:"0",step:"1"},null,8,["modelValue"])]),l("div",Pa,[l("div",La,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[33]||(f[33]=[y("Fuel Type",-1)])]),_:1}),t(e(ie),{modelValue:c.value.fuelType,"onUpdate:modelValue":f[8]||(f[8]=x=>c.value.fuelType=x)},{default:d(()=>[t(e(oe),{class:"w-full"},{default:d(()=>[t(e(ne),{placeholder:"Select fuel type..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Petrol"},{default:d(()=>[...f[34]||(f[34]=[y("Petrol",-1)])]),_:1}),t(e(B),{value:"Diesel"},{default:d(()=>[...f[35]||(f[35]=[y("Diesel",-1)])]),_:1}),t(e(B),{value:"Electric"},{default:d(()=>[...f[36]||(f[36]=[y("Electric",-1)])]),_:1}),t(e(B),{value:"Hybrid"},{default:d(()=>[...f[37]||(f[37]=[y("Hybrid",-1)])]),_:1}),t(e(B),{value:"Plug-in Hybrid"},{default:d(()=>[...f[38]||(f[38]=[y("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Fa,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[39]||(f[39]=[y("Gear Type",-1)])]),_:1}),t(e(ie),{modelValue:c.value.gearType,"onUpdate:modelValue":f[9]||(f[9]=x=>c.value.gearType=x)},{default:d(()=>[t(e(oe),{class:"w-full"},{default:d(()=>[t(e(ne),{placeholder:"Select gear type..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Manual"},{default:d(()=>[...f[40]||(f[40]=[y("Manual",-1)])]),_:1}),t(e(B),{value:"Automatic"},{default:d(()=>[...f[41]||(f[41]=[y("Automatic",-1)])]),_:1}),t(e(B),{value:"CVT"},{default:d(()=>[...f[42]||(f[42]=[y("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),l("div",Oa,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[43]||(f[43]=[y("Plates",-1)])]),_:1}),t(e(U),{modelValue:c.value.plates,"onUpdate:modelValue":f[10]||(f[10]=x=>c.value.plates=x),type:"text",placeholder:"License plate number",class:"w-full"},null,8,["modelValue"]),f[44]||(f[44]=l("p",{class:"text-xs text-muted-foreground mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),l("div",Ua,[t(e(I),{class:"block text-sm font-medium text-foreground"},{default:d(()=>[...f[45]||(f[45]=[y("Note",-1)])]),_:1}),t(e(Te),{modelValue:c.value.note,"onUpdate:modelValue":f[11]||(f[11]=x=>c.value.note=x),rows:"3",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full resize-none"},null,8,["modelValue"])])],64)):(p(),h(Z,{key:1},[l("div",Ra,[l("div",Na,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[46]||(f[46]=[y("Brand",-1)])]),_:1}),t(e(U),{modelValue:c.value.brand,"onUpdate:modelValue":f[12]||(f[12]=x=>c.value.brand=x),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),l("div",za,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[47]||(f[47]=[y("Model",-1)])]),_:1}),t(e(U),{modelValue:c.value.model,"onUpdate:modelValue":f[13]||(f[13]=x=>c.value.model=x),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),l("div",Ba,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[48]||(f[48]=[y("Year",-1)])]),_:1}),t(e(U),{modelValue:c.value.year,"onUpdate:modelValue":f[14]||(f[14]=x=>c.value.year=x),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),l("div",qa,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[49]||(f[49]=[y("Version/Trim",-1)])]),_:1}),t(e(U),{modelValue:c.value.version,"onUpdate:modelValue":f[15]||(f[15]=x=>c.value.version=x),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),l("div",Ea,[l("div",ja,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[50]||(f[50]=[y("VIN",-1)])]),_:1}),t(e(U),{modelValue:c.value.vin,"onUpdate:modelValue":f[16]||(f[16]=x=>c.value.vin=x),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),l("div",_a,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[51]||(f[51]=[y("Plates",-1)])]),_:1}),t(e(U),{modelValue:c.value.plates,"onUpdate:modelValue":f[17]||(f[17]=x=>c.value.plates=x),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),l("div",Wa,[l("div",Ha,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[52]||(f[52]=[y("Fuel Type",-1)])]),_:1}),t(e(ie),{modelValue:c.value.fuelType,"onUpdate:modelValue":f[18]||(f[18]=x=>c.value.fuelType=x)},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select fuel type..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Petrol"},{default:d(()=>[...f[53]||(f[53]=[y("Petrol",-1)])]),_:1}),t(e(B),{value:"Diesel"},{default:d(()=>[...f[54]||(f[54]=[y("Diesel",-1)])]),_:1}),t(e(B),{value:"Electric"},{default:d(()=>[...f[55]||(f[55]=[y("Electric",-1)])]),_:1}),t(e(B),{value:"Hybrid"},{default:d(()=>[...f[56]||(f[56]=[y("Hybrid",-1)])]),_:1}),t(e(B),{value:"Plug-in Hybrid"},{default:d(()=>[...f[57]||(f[57]=[y("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Qa,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[58]||(f[58]=[y("Gear Type",-1)])]),_:1}),t(e(ie),{modelValue:c.value.gearType,"onUpdate:modelValue":f[19]||(f[19]=x=>c.value.gearType=x)},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select gear type..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Manual"},{default:d(()=>[...f[59]||(f[59]=[y("Manual",-1)])]),_:1}),t(e(B),{value:"Automatic"},{default:d(()=>[...f[60]||(f[60]=[y("Automatic",-1)])]),_:1}),t(e(B),{value:"CVT"},{default:d(()=>[...f[61]||(f[61]=[y("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Ya,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[62]||(f[62]=[y("Mileage (km)",-1)])]),_:1}),t(e(U),{modelValue:c.value.kilometers,"onUpdate:modelValue":f[20]||(f[20]=x=>c.value.kilometers=x),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),l("div",Ga,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[63]||(f[63]=[y("Registration Year/Month",-1)])]),_:1}),t(e(U),{modelValue:c.value.registration,"onUpdate:modelValue":f[21]||(f[21]=x=>c.value.registration=x),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),l("div",Za,[l("div",Ka,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[64]||(f[64]=[y("Owned Since",-1)])]),_:1}),t(e(U),{modelValue:c.value.ownedSince,"onUpdate:modelValue":f[22]||(f[22]=x=>c.value.ownedSince=x),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),l("div",Ja,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[65]||(f[65]=[y("Owner",-1)])]),_:1}),t(e(U),{modelValue:c.value.owner,"onUpdate:modelValue":f[23]||(f[23]=x=>c.value.owner=x),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),l("div",Xa,[l("div",eo,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[66]||(f[66]=[y("Ownership Type",-1)])]),_:1}),t(e(ie),{modelValue:c.value.ownershipType,"onUpdate:modelValue":f[24]||(f[24]=x=>c.value.ownershipType=x)},{default:d(()=>[t(e(oe),{class:"w-full h-10"},{default:d(()=>[t(e(ne),{placeholder:"Select ownership type..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Private"},{default:d(()=>[...f[67]||(f[67]=[y("Private",-1)])]),_:1}),t(e(B),{value:"Company"},{default:d(()=>[...f[68]||(f[68]=[y("Company",-1)])]),_:1}),t(e(B),{value:"Lease"},{default:d(()=>[...f[69]||(f[69]=[y("Lease",-1)])]),_:1}),t(e(B),{value:"Fleet"},{default:d(()=>[...f[70]||(f[70]=[y("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),l("div",to,[t(e(I),{class:"block text-sm font-semibold text-foreground"},{default:d(()=>[...f[71]||(f[71]=[y("Warranty Info",-1)])]),_:1}),t(e(Te),{modelValue:c.value.warrantyInfo,"onUpdate:modelValue":f[25]||(f[25]=x=>c.value.warrantyInfo=x),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),t(e(Pe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:d(()=>[t(e(L),{label:"Cancel",variant:"outline",size:"small",onClick:f[26]||(f[26]=x=>C.$emit("close"))}),t(e(L),{label:v.value?"Save Trade-In":"Add Vehicle",variant:"default",size:"small",disabled:!k.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},lo={class:"w-full h-16 bg-muted flex items-center justify-center overflow-hidden"},so=["src","alt"],ao={class:"flex flex-col p-2"},oo={class:"font-bold text-foreground leading-tight line-clamp-2 text-xs"},no={class:"font-bold text-foreground text-xs mt-0.5"},ro={key:0,class:"flex items-center gap-0.5 px-1 py-0.5 bg-green-50 text-green-700 text-[8px] font-bold rounded border border-green-100 uppercase tracking-tighter w-fit mt-1"},io={key:1,class:"flex items-center gap-0.5 px-1 py-0.5 bg-amber-50 text-amber-700 text-[8px] font-bold rounded border border-amber-100 uppercase tracking-tighter w-fit mt-1"},Ke={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1},hideSelectButton:{type:Boolean,default:!1}},emits:["select"],setup(s){const i=s,o=E(()=>({Requested:"bg-blue-600",Recommended:"bg-gray-600","In Stock":"bg-green-600",Custom:"bg-amber-600"})[i.badge]||"bg-gray-600");function n(u){return u?u.toLocaleString("en-US"):"0"}return(u,v)=>(p(),h("div",{onClick:v[1]||(v[1]=b=>u.$emit("select")),class:W(["bg-white border rounded-lg shadow-nsc-card overflow-hidden transition-shadow relative cursor-pointer",s.selected?"border-primary border-2":"border-border"])},[l("div",{class:W(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",o.value])},A(s.badge),3),l("div",lo,[s.vehicle.image?(p(),h("img",{key:0,src:s.vehicle.image,alt:`${s.vehicle.brand} ${s.vehicle.model}`,class:"w-full h-full object-cover"},null,8,so)):(p(),H(e(Vt),{key:1,class:"size-6 text-muted-foreground"}))]),l("div",ao,[l("h4",oo,A(s.vehicle.brand)+" "+A(s.vehicle.model)+" ("+A(s.vehicle.year)+") ",1),l("p",no,"€ "+A(n(s.vehicle.price)),1),s.stockDays!==null&&s.stockDays!==void 0?(p(),h("div",ro,[t(e(It),{class:"size-3"}),l("span",null,"In stock "+A(s.stockDays)+"d",1)])):(p(),h("div",io,[t(e(lt),{class:"size-3"}),v[2]||(v[2]=l("span",null,"Out",-1))])),s.hideSelectButton?P("",!0):(p(),H(e(L),{key:2,variant:"default",size:"small",class:"w-full mt-2",onClick:v[0]||(v[0]=De(b=>u.$emit("select"),["stop"]))},{default:d(()=>[...v[3]||(v[3]=[y(" Select ",-1)])]),_:1}))])],2))}},uo={class:"space-y-4"},co={key:0,class:"flex justify-start"},fo={key:0,class:"space-y-3"},mo={class:"text-sm font-bold text-foreground flex items-center gap-2"},po={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},vo={class:"space-y-3"},go={class:"relative"},yo={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},bo={key:1,class:"rounded-lg border border-border bg-muted py-8 text-center"},ho={key:2,class:"space-y-4"},xo={class:"text-sm font-bold text-foreground flex items-center gap-2"},ko={class:"rounded-lg border border-border bg-muted p-4 space-y-4"},wo={key:0,class:"flex justify-start"},Co={key:1,class:"space-y-4"},So={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},$o={class:"space-y-2"},Vo={class:"space-y-2"},Io={class:"space-y-2"},To={class:"space-y-2"},Ao={class:"flex flex-wrap gap-2"},Do={__name:"VehicleSelectionInline",props:{requestedVehicle:{type:Object,default:null},opportunityId:{type:[Number,String],default:null},mode:{type:String,default:"full"},showBack:{type:Boolean,default:!1},hideBack:{type:Boolean,default:!1}},emits:["vehicle-selected","back","selection-change"],setup(s,{expose:i,emit:o}){const n=s,u=o,v=E(()=>n.mode==="full"||n.mode==="stock"),b=E(()=>n.mode==="full"||n.mode==="configure"),c=O(""),k=O(n.mode==="configure"),S=O(null),m=O(null),C=O(null),f=O([]),x=O({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Me(async()=>{try{const g=await Ct({});f.value=g.data||[]}catch{f.value=[]}}),de(()=>n.mode,g=>{g==="configure"&&(k.value=!0)}),de(S,g=>{u("selection-change",{hasSelection:!!g})},{immediate:!0}),i({confirmSelection:Y});const V=E(()=>{const g=n.requestedVehicle;return g&&g.stockDays!=null}),M=E(()=>{var G;const g=n.requestedVehicle,a=[];if(g&&V.value&&a.push({...g,isRequested:!0}),(G=f.value)!=null&&G.length){const q=f.value.filter(ae=>g?ae.brand!==g.brand||ae.model!==g.model:!0),ue=g&&V.value?3:4;a.push(...q.slice(0,ue))}return a}),_=E(()=>{var a;if(!((a=f.value)!=null&&a.length))return[];let g=[...f.value];if(c.value.trim()){const G=c.value.toLowerCase().trim();g=g.filter(q=>{var ue,ae;return((ue=q.brand)==null?void 0:ue.toLowerCase().includes(G))||((ae=q.model)==null?void 0:ae.toLowerCase().includes(G))||String(q.year).includes(G)})}return g}),K=E(()=>new Set(M.value.map(g=>g.id).filter(Boolean))),z=E(()=>_.value.filter(g=>!K.value.has(g.id))),F=E(()=>x.value.brand&&x.value.model&&x.value.year&&x.value.price>0);function D(g,a){S.value=g,m.value=g.id||`custom-${Date.now()}`,C.value=a}function Y(){S.value&&u("vehicle-selected",{vehicle:S.value,type:C.value})}function w(){if(!F.value)return;const g={...x.value,id:`custom-${Date.now()}`,isCustom:!0};u("vehicle-selected",{vehicle:g,type:"custom"})}return(g,a)=>{const G=mt("Check");return p(),h("div",uo,[s.showBack&&!s.hideBack?(p(),h("div",co,[t(e(L),{variant:"ghost",size:"sm",class:"gap-2 text-muted-foreground",onClick:a[0]||(a[0]=q=>g.$emit("back"))},{default:d(()=>[t(e(Tt),{class:"size-4"}),a[9]||(a[9]=y(" Back ",-1))]),_:1})])):P("",!0),v.value?(p(),h(Z,{key:1},[M.value.length?(p(),h("div",fo,[l("h3",mo,[t(e(tt),{class:"size-4 text-primary"}),a[10]||(a[10]=y(" Recommended ",-1))]),l("div",po,[(p(!0),h(Z,null,X(M.value,q=>(p(),H(Ke,{key:q.id,vehicle:q,badge:q.isRequested?"Requested":"Recommended","stock-days":q.stockDays,selected:m.value===q.id,onSelect:ue=>D(q,q.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):P("",!0),l("div",vo,[l("div",go,[t(e(He),{class:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),t(e(U),{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=q=>c.value=q),type:"text",placeholder:"Search to find more...",class:"w-full pl-9 bg-background border-border"},null,8,["modelValue"])]),c.value.trim()?(p(),h(Z,{key:0},[z.value.length?(p(),h("div",yo,[(p(!0),h(Z,null,X(z.value,q=>(p(),H(Ke,{key:q.id,vehicle:q,badge:"In Stock","stock-days":q.stockDays,selected:m.value===q.id,onSelect:ue=>D(q,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(p(),h("div",bo,[t(e(He),{class:"mx-auto mb-2 size-8 text-muted-foreground"}),a[11]||(a[11]=l("p",{class:"text-sm font-medium text-foreground"},"No vehicles found",-1)),a[12]||(a[12]=l("p",{class:"text-xs text-muted-foreground mt-0.5"},"Try different keywords",-1))]))],64)):P("",!0)])],64)):P("",!0),b.value?(p(),h("div",ho,[l("h3",xo,[t(e(Qe),{class:"size-4 text-primary"}),a[13]||(a[13]=y(" Configure Custom Vehicle ",-1))]),l("div",ko,[a[22]||(a[22]=l("p",{class:"text-sm text-muted-foreground"}," Build a custom configuration with specific options and features. ",-1)),k.value?(p(),h("div",Co,[l("div",So,[l("div",$o,[t(e(I),{class:"text-sm font-medium text-foreground"},{default:d(()=>[...a[15]||(a[15]=[y("Brand",-1)])]),_:1}),t(e(U),{modelValue:x.value.brand,"onUpdate:modelValue":a[3]||(a[3]=q=>x.value.brand=q),type:"text",placeholder:"e.g., Audi",class:"w-full bg-background border-border"},null,8,["modelValue"])]),l("div",Vo,[t(e(I),{class:"text-sm font-medium text-foreground"},{default:d(()=>[...a[16]||(a[16]=[y("Model",-1)])]),_:1}),t(e(U),{modelValue:x.value.model,"onUpdate:modelValue":a[4]||(a[4]=q=>x.value.model=q),type:"text",placeholder:"e.g., e-tron GT",class:"w-full bg-background border-border"},null,8,["modelValue"])]),l("div",Io,[t(e(I),{class:"text-sm font-medium text-foreground"},{default:d(()=>[...a[17]||(a[17]=[y("Year",-1)])]),_:1}),t(e(U),{modelValue:x.value.year,"onUpdate:modelValue":a[5]||(a[5]=q=>x.value.year=q),type:"number",placeholder:"2024",class:"w-full bg-background border-border"},null,8,["modelValue"])]),l("div",To,[t(e(I),{class:"text-sm font-medium text-foreground"},{default:d(()=>[...a[18]||(a[18]=[y("Price (€)",-1)])]),_:1}),t(e(U),{modelValue:x.value.price,"onUpdate:modelValue":a[6]||(a[6]=q=>x.value.price=q),type:"number",placeholder:"98000",class:"w-full bg-background border-border"},null,8,["modelValue"])])]),l("div",Ao,[s.showBack&&!s.hideBack?(p(),H(e(L),{key:0,variant:"ghost",size:"sm",onClick:a[7]||(a[7]=q=>g.$emit("back"))},{default:d(()=>[...a[19]||(a[19]=[y(" Back ",-1)])]),_:1})):P("",!0),t(e(L),{variant:"secondary",size:"sm",onClick:a[8]||(a[8]=q=>k.value=!1)},{default:d(()=>[...a[20]||(a[20]=[y(" Hide ",-1)])]),_:1}),t(e(L),{variant:"default",size:"sm",class:"gap-2",disabled:!F.value,onClick:w},{default:d(()=>[t(G,{class:"size-4"}),a[21]||(a[21]=y(" Use Custom Configuration ",-1))]),_:1},8,["disabled"])])])):(p(),h("div",wo,[t(e(L),{variant:"default",size:"sm",class:"gap-2",onClick:a[2]||(a[2]=q=>k.value=!0)},{default:d(()=>[t(e(Qe),{class:"size-4"}),a[14]||(a[14]=y(" Build Custom Configuration ",-1))]),_:1})]))])])):P("",!0)])}}},Mo={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Po={key:0,class:"flex justify-between items-center mb-4"},Lo={class:"text-sm font-bold text-foreground"},Fo={key:1,class:"mb-6 space-y-4"},Oo={key:0,class:"rounded-lg border border-border bg-muted overflow-hidden p-6"},Uo={class:"space-y-3"},Ro={key:1,class:"rounded-lg border border-border bg-muted overflow-hidden p-6"},No={key:2,class:"mb-6 p-4 bg-muted rounded-lg border border-border"},zo={class:"flex items-center gap-3"},Bo={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},qo=["src"],Eo={key:1,class:"fa-solid fa-car text-muted-foreground w-full h-full flex items-center justify-center"},jo={class:"font-bold text-sm text-foreground"},_o={class:"text-xs text-muted-foreground"},Wo={key:3,class:"space-y-3"},Ho={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Qo={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Yo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Zo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ko={key:0,class:"border border-border rounded-lg bg-white shadow-nsc-card"},Jo={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},en={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},ln={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},sn={class:"space-y-3"},an={class:"flex items-center gap-2"},on={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted rounded-lg"},nn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},rn={class:"flex items-center gap-2"},dn={class:"text-xs text-muted-foreground"},un={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},cn={class:"flex justify-end"},fn={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},mn={class:"md:col-span-2"},pn={class:"flex justify-between items-end gap-2"},vn={class:"grid grid-cols-2 gap-3"},gn={class:"flex justify-end"},yn={class:"text-sm font-semibold text-foreground"},bn={key:0,class:"text-center py-6 text-muted-foreground text-xs"},hn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},xn={class:"flex items-center gap-2"},kn={class:"text-xs text-muted-foreground"},wn={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Cn={class:"flex justify-end"},Sn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},$n={class:"flex justify-between items-center"},Vn={key:0,class:"text-center py-6 text-muted-foreground text-xs"},In={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Tn={key:0,class:"px-4 pb-4 border-t border-border pt-4 space-y-3"},An={key:0,class:"space-y-3"},Dn={key:1,class:"flex flex-col items-center gap-2 py-2"},Mn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Pn={key:0,class:"px-4 pb-4 border-t border-border pt-4 space-y-3"},Ln={key:0,class:"space-y-3"},Fn={key:1,class:"flex flex-col items-center gap-2 py-2"},On={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Un={class:"flex items-center gap-2"},Rn={class:"text-xs text-muted-foreground"},Nn={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},zn={class:"flex justify-end"},Bn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},qn={class:"flex justify-between items-center"},En={key:0,class:"text-center py-6 text-muted-foreground text-xs"},jn={key:1,class:"bg-muted rounded-lg p-4 mt-4 space-y-2"},_n={class:"flex justify-between items-center"},Wn={class:"text-sm font-bold text-foreground"},Hn={class:"flex justify-between items-center"},Qn={class:"text-sm font-bold text-foreground"},Yn={key:0,class:"text-xs text-red-600"},Gn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Zn={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Kn={class:"space-y-3 pt-3 border-t border-border"},Jn={class:"flex items-start gap-2"},Xn={class:"flex items-start gap-2"},er={key:4,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},tr={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1},hideVehicleSelection:{type:Boolean,default:!1},initialVehicleStep:{type:String,default:"select"},tradeIns:{type:Array,default:()=>[]},financingOptions:{type:Array,default:()=>[]}},emits:["save","cancel","open-add-tradein","open-add-financing"],setup(s,{expose:i,emit:o}){const n=et(),u=s,v=o,b=O("select"),c=O("choice");function k({vehicle:T}){a.value.price=T.price||0,a.value.brand=T.brand||"",a.value.model=T.model||"",a.value.year=T.year||"",a.value.image=T.image||"",b.value="manual",c.value="choice"}const S=O(!1),m=O(!1),C=O(!1),f=O(!1),x=O(!1),V=O(!1),M=O(!1),_=O(!1),K=O(!1),z=E(()=>{const T=n.currentOpportunityActivities||[],r={tradeIns:(T.filter(N=>N.type==="tradein")||[]).map(N=>{var ce,we,Ce;return{id:N.id,...N.data||{},label:(ce=N.data)!=null&&ce.make&&((we=N.data)!=null&&we.model)?`${N.data.make} ${N.data.model} (${N.data.year||""}) - €${(N.data.value??0).toLocaleString()}`:((Ce=N.data)==null?void 0:Ce.label)||`Trade-in #${N.id}`}}),financingOptions:(T.filter(N=>N.type==="financing")||[]).map(N=>{var ce,we,Ce;return{id:N.id,...N.data||{},label:(ce=N.data)!=null&&ce.product||(we=N.data)!=null&&we.productName?`${N.data.product||N.data.productName} (${N.data.apr||N.data.interestRate}% APR, ${N.data.term}mo)`:((Ce=N.data)==null?void 0:Ce.label)||`Financing #${N.id}`}})},ee={tradeIns:(u.tradeIns||[]).map(N=>({id:N.id,label:N.label||"Trade-in",value:N.valuation??0})),financingOptions:(u.financingOptions||[]).map(N=>({id:N.id,label:N.termMonths?`${N.label} (${N.termMonths} mo)`:N.label||"Financing",term:N.termMonths??null}))};return{tradeIns:[...ee.tradeIns,...r.tradeIns.filter(N=>!ee.tradeIns.some(ce=>String(ce.id)===String(N.id)))],financingOptions:[...ee.financingOptions,...r.financingOptions.filter(N=>!ee.financingOptions.some(ce=>String(ce.id)===String(N.id)))]}});function F(T){const r=z.value.financingOptions.find(ee=>String(ee.id)===String(T));r&&(a.value.financingType="financing",a.value.term=r.term??a.value.term,a.value.interestRate=r.apr??r.interestRate??a.value.interestRate,a.value.downPayment=r.downPayment??r.deposit??a.value.downPayment,a.value.monthlyPayment=r.monthly??r.monthlyPayment??a.value.monthlyPayment,a.value.selectedFinancingId=r.id,a.value.selectedFinancingLabel=r.product??r.productName??r.label??"")}function D(T){const r=z.value.tradeIns.find(N=>String(N.id)===String(T));if(!r)return;a.value.tradeIn.valuation=r.value??r.valuation??0;const ee=r.make&&r.model?`${r.make} ${r.model} (${r.year||""}) - ${r.condition||""} condition, ${r.mileage??""}km`:r.label||"";a.value.tradeIn.notes=ee.trim()||a.value.tradeIn.notes,a.value.selectedTradeInId=r.id,a.value.selectedTradeInLabel=(r.make&&r.model?`${r.make} ${r.model}`:null)??r.label??""}function Y(T){if(!T||T==="none"){a.value.tradeIn.valuation=0,a.value.tradeIn.notes="",a.value.selectedTradeInId=null,a.value.selectedTradeInLabel="";return}D(T)}const w=E(()=>{const T=a.value.selectedFinancingId;return T!=null&&T!==""?String(T):"cash"});function g(T){if(T==="cash"||T==null||T===""){a.value.financingType="cash",a.value.selectedFinancingId=null,a.value.selectedFinancingLabel="",a.value.downPayment=0,a.value.monthlyPayment=0,a.value.term=36,a.value.interestRate=3.5;return}F(T)}const a=O({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"cash",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null,selectedTradeInId:null,selectedTradeInLabel:"",selectedFinancingId:null,selectedFinancingLabel:""}),G=E(()=>!!u.customer),q=E(()=>{let T=a.value.price||0;return a.value.quotationItems.forEach(r=>{T+=(r.price||0)*(r.quantity||1)}),a.value.showVat?T-ue.value:T}),ue=E(()=>{if(!a.value.showVat||!a.value.vatRate)return 0;let T=a.value.price||0;return a.value.quotationItems.forEach(r=>{T+=(r.price||0)*(r.quantity||1)}),T*a.value.vatRate/(100+a.value.vatRate)}),ae=E(()=>{let T=a.value.price||0;return a.value.quotationItems.forEach(r=>{T+=(r.price||0)*(r.quantity||1)}),a.value.discounts.forEach(r=>{T-=r.price||0}),a.value.tradeIn.valuation&&(T-=a.value.tradeIn.valuation),T}),R=E(()=>a.value.paymentMethods.reduce((T,r)=>T+(r.amount||0),0)),j=E(()=>a.value.paymentMethods.length===0?!0:Math.abs(R.value-ae.value)<.01),se=()=>{a.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},te=T=>{a.value.quotationItems.splice(T,1)},me=()=>{a.value.discounts.push({title:"",price:0,vatInclusive:!0})},Re=T=>{a.value.discounts.splice(T,1)},Ne=()=>{a.value.paymentMethods.push({description:"",amount:0,paid:!1})},ze=T=>{a.value.paymentMethods.splice(T,1)},pe=()=>{if(u.customer){const T=(u.customer.name||"").split(" ");a.value.firstName=T[0]||"",a.value.lastName=T.slice(1).join(" ")||"",a.value.email=u.customer.email||"",a.value.phone=u.customer.phone||"",a.value.address=u.customer.address||"",a.value.city=u.customer.city||"",a.value.zipCode=u.customer.zipCode||u.customer.postalCode||""}};Me(()=>{pe(),(u.item||u.selectedVehicle||u.hideVehicleSelection&&u.initialVehicleStep==="manual")&&(b.value="manual"),u.selectedVehicle&&(a.value.price=u.selectedVehicle.price||0,a.value.brand=u.selectedVehicle.brand||"",a.value.model=u.selectedVehicle.model||"",a.value.year=u.selectedVehicle.year||"",a.value.image=u.selectedVehicle.image||""),u.item&&u.item.data&&(a.value={...a.value,...u.item.data,price:u.item.data.price||u.item.data.total||0,financingType:u.item.data.financingType||u.item.data.paymentMethod||"cash",notes:u.item.data.notes||u.item.data.description||"",showVat:u.item.data.showVat||!1,vatRate:u.item.data.vatRate||21,quotationItems:u.item.data.quotationItems||[],discounts:u.item.data.discounts||[],tradeIn:u.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:u.item.data.paymentMethods||[],expirationDate:u.item.data.expirationDate||null,selectedTradeInId:u.item.data.selectedTradeInId||null,selectedTradeInLabel:u.item.data.selectedTradeInLabel||"",selectedFinancingId:u.item.data.selectedFinancingId||null,selectedFinancingLabel:u.item.data.selectedFinancingLabel||""})}),de(()=>u.selectedVehicle,T=>{T&&!u.item&&(b.value="manual",a.value.price=T.price||0,a.value.brand=T.brand||"",a.value.model=T.model||"",a.value.year=T.year||"",a.value.image=T.image||"")}),de(()=>u.customer,()=>{pe()}),de(()=>({hasTradeIns:z.value.tradeIns.length>0,hasFinancing:z.value.financingOptions.length>0}),({hasTradeIns:T,hasFinancing:r})=>{T&&(M.value=!0),r&&(V.value=!0)},{immediate:!0});const qe=E(()=>{const T=a.value.salutation!==""&&a.value.firstName!==""&&a.value.lastName!==""&&a.value.email!==""&&a.value.zipCode!==""&&a.value.price>0&&a.value.financingType!==""&&a.value.privacyConsent===!0,r=u.selectedVehicle||b.value==="manual",ee=j.value;return T&&r&&ee}),Be=T=>T?(typeof T=="string"?parseFloat(T):T).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",_e=()=>{var r,ee;if(!qe.value)return;const T={id:((r=u.item)==null?void 0:r.id)||Date.now(),type:"offer",action:u.item?"updated an offer":"created an offer",data:{salutation:a.value.salutation,firstName:a.value.firstName,lastName:a.value.lastName,email:a.value.email,phone:a.value.phone,zipCode:a.value.zipCode,address:a.value.address,city:a.value.city,brand:a.value.brand,model:a.value.model,year:a.value.year,image:a.value.image,price:a.value.price,total:ae.value,paymentMethod:a.value.financingType,financingType:a.value.financingType,downPayment:a.value.downPayment,monthlyPayment:a.value.monthlyPayment,term:a.value.term,interestRate:a.value.interestRate,notes:a.value.notes,description:a.value.notes,privacyConsent:a.value.privacyConsent,marketingConsent:a.value.marketingConsent,showVat:a.value.showVat,vatRate:a.value.vatRate,vatAmount:ue.value,subtotal:q.value,quotationItems:a.value.quotationItems,discounts:a.value.discounts,tradeIn:a.value.tradeIn,paymentMethods:a.value.paymentMethods,expirationDate:a.value.expirationDate,grandTotal:ae.value,selectedTradeInId:a.value.selectedTradeInId,selectedTradeInLabel:a.value.selectedTradeInLabel,selectedFinancingId:a.value.selectedFinancingId,selectedFinancingLabel:a.value.selectedFinancingLabel},timestamp:((ee=u.item)==null?void 0:ee.timestamp)||new Date().toISOString(),isEdit:!!u.item};v("save",T)};return i({submit:_e,isValid:qe,offerData:a}),(T,r)=>{var ee,N,ce,we,Ce,We;return p(),h("div",Mo,[s.hideHeader?P("",!0):(p(),h("div",Po,[l("h5",Lo,A(s.item?"Edit Offer":"Create Offer"),1),t(e(L),{variant:"ghost",size:"icon",onClick:r[0]||(r[0]=$=>T.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},{default:d(()=>[...r[38]||(r[38]=[l("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!s.hideVehicleSelection&&!s.selectedVehicle&&!s.item&&b.value==="select"?(p(),h("div",Fo,[c.value==="choice"?(p(),h("div",Oo,[r[42]||(r[42]=l("h6",{class:"text-sm font-semibold text-foreground mb-4"},"Select Vehicle",-1)),r[43]||(r[43]=l("p",{class:"text-sm text-muted-foreground mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),l("div",Uo,[t(e(L),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[1]||(r[1]=$=>c.value="stock")},{default:d(()=>[...r[39]||(r[39]=[l("i",{class:"fa-solid fa-warehouse"},null,-1),l("span",null,"Add from Stock — Search and select an existing vehicle from inventory",-1)])]),_:1}),t(e(L),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[2]||(r[2]=$=>c.value="configure")},{default:d(()=>[...r[40]||(r[40]=[l("i",{class:"fa-solid fa-cog"},null,-1),l("span",null,"Configure Vehicle — Build/customize a new vehicle",-1)])]),_:1}),t(e(L),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[3]||(r[3]=$=>b.value="manual")},{default:d(()=>[...r[41]||(r[41]=[l("i",{class:"fa-solid fa-pen-to-square"},null,-1),l("span",null,"Skip & Enter Manually — Create vehicle data from scratch",-1)])]),_:1})])])):(p(),h("div",Ro,[t(Do,{"requested-vehicle":s.selectedVehicle,"opportunity-id":s.taskId,mode:c.value,"show-back":"",onVehicleSelected:k,onBack:r[4]||(r[4]=$=>c.value="choice")},null,8,["requested-vehicle","opportunity-id","mode"])]))])):P("",!0),s.selectedVehicle||b.value==="manual"&&a.value.brand?(p(),h("div",No,[r[44]||(r[44]=l("p",{class:"text-xs text-muted-foreground mb-2"},"Creating offer for:",-1)),l("div",zo,[l("div",Bo,[(ee=s.selectedVehicle)!=null&&ee.image||a.value.image?(p(),h("img",{key:0,src:((N=s.selectedVehicle)==null?void 0:N.image)||a.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,qo)):(p(),h("i",Eo))]),l("div",null,[l("h4",jo,A(((ce=s.selectedVehicle)==null?void 0:ce.brand)||a.value.brand)+" "+A(((we=s.selectedVehicle)==null?void 0:we.model)||a.value.model)+" ("+A(((Ce=s.selectedVehicle)==null?void 0:Ce.year)||a.value.year)+") ",1),l("p",_o,"Base Price: € "+A(Be(((We=s.selectedVehicle)==null?void 0:We.price)||a.value.price)),1)])])])):P("",!0),s.selectedVehicle||b.value==="manual"||s.item?(p(),h("div",Wo,[l("div",Ho,[l("button",{type:"button",onClick:r[5]||(r[5]=$=>S.value=!S.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors rounded-t-lg"},[r[45]||(r[45]=l("div",{class:"flex items-center gap-2"},[l("h6",{class:"text-sm font-semibold text-foreground"},"Personal Information"),l("span",{class:"text-xs text-red-600"},"*Required")],-1)),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",S.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),S.value?(p(),h("div",Qo,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[46]||(r[46]=[y("Salutation ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(ie),{modelValue:a.value.salutation,"onUpdate:modelValue":r[6]||(r[6]=$=>a.value.salutation=$)},{default:d(()=>[t(e(oe),{class:"w-full"},{default:d(()=>[t(e(ne),{placeholder:"Select salutation"})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"Mr."},{default:d(()=>[...r[47]||(r[47]=[y("Mr.",-1)])]),_:1}),t(e(B),{value:"Mrs."},{default:d(()=>[...r[48]||(r[48]=[y("Mrs.",-1)])]),_:1}),t(e(B),{value:"Ms."},{default:d(()=>[...r[49]||(r[49]=[y("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Yo,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[50]||(r[50]=[y("First Name ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(U),{modelValue:a.value.firstName,"onUpdate:modelValue":r[7]||(r[7]=$=>a.value.firstName=$),placeholder:"Enter first name",disabled:G.value},null,8,["modelValue","disabled"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[51]||(r[51]=[y("Last Name ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(U),{modelValue:a.value.lastName,"onUpdate:modelValue":r[8]||(r[8]=$=>a.value.lastName=$),placeholder:"Enter last name",disabled:G.value},null,8,["modelValue","disabled"])])]),l("div",Go,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[52]||(r[52]=[y("Email ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(U),{type:"email",modelValue:a.value.email,"onUpdate:modelValue":r[9]||(r[9]=$=>a.value.email=$),placeholder:"email@example.com",disabled:G.value},null,8,["modelValue","disabled"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[53]||(r[53]=[y("Phone Number",-1)])]),_:1}),t(e(U),{type:"tel",modelValue:a.value.phone,"onUpdate:modelValue":r[10]||(r[10]=$=>a.value.phone=$),placeholder:"+1 (555) 000-0000",disabled:G.value},null,8,["modelValue","disabled"])])]),l("div",Zo,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[54]||(r[54]=[y("ZIP / Postal Code ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(U),{modelValue:a.value.zipCode,"onUpdate:modelValue":r[11]||(r[11]=$=>a.value.zipCode=$),placeholder:"Enter ZIP code",disabled:G.value},null,8,["modelValue","disabled"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[55]||(r[55]=[y("City",-1)])]),_:1}),t(e(U),{modelValue:a.value.city,"onUpdate:modelValue":r[12]||(r[12]=$=>a.value.city=$),placeholder:"Enter city",disabled:G.value},null,8,["modelValue","disabled"])])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[56]||(r[56]=[y("Address / Street",-1)])]),_:1}),t(e(U),{modelValue:a.value.address,"onUpdate:modelValue":r[13]||(r[13]=$=>a.value.address=$),placeholder:"Enter street address",disabled:G.value},null,8,["modelValue","disabled"])])])):P("",!0)]),b.value==="manual"&&!s.selectedVehicle?(p(),h("div",Ko,[l("button",{type:"button",onClick:r[14]||(r[14]=$=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[57]||(r[57]=l("h6",{class:"text-sm font-semibold text-foreground"},"Vehicle Details",-1)),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(p(),h("div",Jo,[l("div",Xo,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[58]||(r[58]=[y("Brand",-1)])]),_:1}),t(e(U),{modelValue:a.value.brand,"onUpdate:modelValue":r[15]||(r[15]=$=>a.value.brand=$),placeholder:"e.g., Audi"},null,8,["modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[59]||(r[59]=[y("Model",-1)])]),_:1}),t(e(U),{modelValue:a.value.model,"onUpdate:modelValue":r[16]||(r[16]=$=>a.value.model=$),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),l("div",en,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[60]||(r[60]=[y("Year",-1)])]),_:1}),t(e(U),{type:"number",modelValue:a.value.year,"onUpdate:modelValue":r[17]||(r[17]=$=>a.value.year=$),placeholder:"2024"},null,8,["modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[61]||(r[61]=[y("Image URL",-1)])]),_:1}),t(e(U),{modelValue:a.value.image,"onUpdate:modelValue":r[18]||(r[18]=$=>a.value.image=$),placeholder:"https://..."},null,8,["modelValue"])])])])):P("",!0)])):P("",!0),l("div",tn,[l("button",{type:"button",onClick:r[19]||(r[19]=$=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[62]||(r[62]=l("div",{class:"flex items-center gap-2"},[l("h6",{class:"text-sm font-semibold text-foreground"},"Pricing"),l("span",{class:"text-xs text-red-600"},"*Required")],-1)),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(p(),h("div",ln,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[63]||(r[63]=[y("Base Price (€) ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(U),{type:"number",modelValue:a.value.price,"onUpdate:modelValue":r[20]||(r[20]=$=>a.value.price=$),placeholder:"0"},null,8,["modelValue"])]),l("div",sn,[l("div",an,[t(e($e),{checked:a.value.showVat,"onUpdate:checked":r[21]||(r[21]=$=>a.value.showVat=$),id:"show-vat"},null,8,["checked"]),t(e(I),{for:"show-vat",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:d(()=>[...r[64]||(r[64]=[y("Show VAT breakdown",-1)])]),_:1})]),a.value.showVat?(p(),h("div",on,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[65]||(r[65]=[y("VAT %",-1)])]),_:1}),t(e(U),{type:"number",step:"0.1",modelValue:a.value.vatRate,"onUpdate:modelValue":r[22]||(r[22]=$=>a.value.vatRate=$),placeholder:"21"},null,8,["modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[66]||(r[66]=[y("VAT €",-1)])]),_:1}),t(e(U),{type:"number",value:ue.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[67]||(r[67]=[y("Subtotal €",-1)])]),_:1}),t(e(U),{type:"number",value:q.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):P("",!0)])])):P("",!0)]),l("div",nn,[l("button",{type:"button",onClick:r[23]||(r[23]=$=>f.value=!f.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[l("div",rn,[r[68]||(r[68]=l("h6",{class:"text-sm font-semibold text-foreground"},"Quotation Items",-1)),l("span",dn,"("+A(a.value.quotationItems.length)+" items)",1)]),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",f.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),f.value?(p(),h("div",un,[l("div",cn,[t(e(L),{variant:"outline",size:"small",onClick:se},{default:d(()=>[...r[69]||(r[69]=[l("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),y(" Add Item ",-1)])]),_:1})]),(p(!0),h(Z,null,X(a.value.quotationItems,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[l("div",fn,[l("div",mn,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[70]||(r[70]=[y("Item Name",-1)])]),_:1}),t(e(U),{modelValue:$.name,"onUpdate:modelValue":J=>$.name=J,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",pn,[t(e(L),{variant:"ghost",size:"icon",onClick:J=>te(Se),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:d(()=>[...r[71]||(r[71]=[l("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),l("div",vn,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[72]||(r[72]=[y("Price (€)",-1)])]),_:1}),t(e(U),{type:"number",modelValue:$.price,"onUpdate:modelValue":J=>$.price=J,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[73]||(r[73]=[y("Quantity",-1)])]),_:1}),t(e(U),{type:"number",modelValue:$.quantity,"onUpdate:modelValue":J=>$.quantity=J,placeholder:"1",value:$.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),l("div",gn,[l("span",yn,"Total: € "+A(Be(($.price||0)*($.quantity||1))),1)])]))),128)),a.value.quotationItems.length===0?(p(),h("div",bn," No quotation items added yet ")):P("",!0)])):P("",!0)]),l("div",hn,[l("button",{type:"button",onClick:r[24]||(r[24]=$=>x.value=!x.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[l("div",xn,[r[74]||(r[74]=l("h6",{class:"text-sm font-semibold text-foreground"},"Discounts",-1)),l("span",kn,"("+A(a.value.discounts.length)+" discounts)",1)]),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",x.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),x.value?(p(),h("div",wn,[l("div",Cn,[t(e(L),{variant:"outline",size:"small",onClick:me},{default:d(()=>[...r[75]||(r[75]=[l("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),y(" Add Discount ",-1)])]),_:1})]),(p(!0),h(Z,null,X(a.value.discounts,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[l("div",Sn,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[76]||(r[76]=[y("Discount Title",-1)])]),_:1}),t(e(U),{modelValue:$.title,"onUpdate:modelValue":J=>$.title=J,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[77]||(r[77]=[y("Amount (€)",-1)])]),_:1}),t(e(U),{type:"number",modelValue:$.price,"onUpdate:modelValue":J=>$.price=J,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),l("div",$n,[t(e(I),{class:"flex items-center gap-2 cursor-pointer"},{default:d(()=>[t(e($e),{checked:$.vatInclusive,"onUpdate:checked":J=>$.vatInclusive=J},null,8,["checked","onUpdate:checked"]),r[78]||(r[78]=l("span",{class:"text-xs text-muted-foreground"},"VAT inclusive",-1))]),_:2},1024),t(e(L),{variant:"ghost",size:"icon",onClick:J=>Re(Se),class:"text-red-600 hover:text-red-700"},{default:d(()=>[...r[79]||(r[79]=[l("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),a.value.discounts.length===0?(p(),h("div",Vn," No discounts added yet ")):P("",!0)])):P("",!0)]),l("div",In,[l("button",{type:"button",onClick:r[25]||(r[25]=$=>V.value=!V.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[80]||(r[80]=l("h6",{class:"text-sm font-semibold text-foreground"},"Financing",-1)),t(e(Ye),{class:W(["size-4 text-muted-foreground transition-transform duration-200",V.value&&"rotate-180"])},null,8,["class"])]),V.value?(p(),h("div",Tn,[z.value.financingOptions.length>0?(p(),h("div",An,[t(e(ie),{"model-value":w.value,"onUpdate:modelValue":g},{default:d(()=>[t(e(oe),{class:"w-full bg-muted/50 border-border h-9 text-xs"},{default:d(()=>[t(e(ne),{placeholder:"Pick a financing option or Cash..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"cash"},{default:d(()=>[...r[81]||(r[81]=[y("Cash",-1)])]),_:1}),(p(!0),h(Z,null,X(z.value.financingOptions,$=>(p(),H(e(B),{key:$.id,value:$.id.toString()},{default:d(()=>[y(A($.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),t(e(L),{variant:"outline",size:"sm",class:"gap-2 w-full sm:w-auto",onClick:r[26]||(r[26]=$=>T.$emit("open-add-financing"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),r[82]||(r[82]=y(" Add financing / purchase method ",-1))]),_:1})])):(p(),h("div",Dn,[r[84]||(r[84]=l("p",{class:"text-xs text-muted-foreground"},"No financing options yet",-1)),t(e(L),{variant:"outline",size:"sm",class:"gap-2",onClick:r[27]||(r[27]=$=>T.$emit("open-add-financing"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),r[83]||(r[83]=y(" Add financing / purchase method ",-1))]),_:1})]))])):P("",!0)]),l("div",Mn,[l("button",{type:"button",onClick:r[28]||(r[28]=$=>M.value=!M.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[85]||(r[85]=l("h6",{class:"text-sm font-semibold text-foreground"},"Trade-In",-1)),t(e(Ye),{class:W(["size-4 text-muted-foreground transition-transform duration-200",M.value&&"rotate-180"])},null,8,["class"])]),M.value?(p(),h("div",Pn,[z.value.tradeIns.length>0?(p(),h("div",Ln,[t(e(ie),{"model-value":a.value.selectedTradeInId!=null?String(a.value.selectedTradeInId):"none","onUpdate:modelValue":Y},{default:d(()=>[t(e(oe),{class:"w-full bg-muted/50 border-border h-9 text-xs"},{default:d(()=>[t(e(ne),{placeholder:"Pick a trade-in..."})]),_:1}),t(e(re),null,{default:d(()=>[t(e(B),{value:"none"},{default:d(()=>[...r[86]||(r[86]=[y("None",-1)])]),_:1}),(p(!0),h(Z,null,X(z.value.tradeIns,$=>(p(),H(e(B),{key:$.id,value:$.id.toString()},{default:d(()=>[y(A($.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),t(e(L),{variant:"outline",size:"sm",class:"gap-2 w-full sm:w-auto",onClick:r[29]||(r[29]=$=>T.$emit("open-add-tradein"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),r[87]||(r[87]=y(" Add trade-in ",-1))]),_:1})])):(p(),h("div",Fn,[r[89]||(r[89]=l("p",{class:"text-xs text-muted-foreground"},"No trade-ins yet",-1)),t(e(L),{variant:"outline",size:"sm",class:"gap-2",onClick:r[30]||(r[30]=$=>T.$emit("open-add-tradein"))},{default:d(()=>[t(e(Ve),{class:"size-4"}),r[88]||(r[88]=y(" Add trade-in ",-1))]),_:1})]))])):P("",!0)]),l("div",On,[l("button",{type:"button",onClick:r[31]||(r[31]=$=>_.value=!_.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[l("div",Un,[r[90]||(r[90]=l("h6",{class:"text-sm font-semibold text-foreground"},"Payment Methods",-1)),l("span",Rn,"("+A(a.value.paymentMethods.length)+" methods)",1)]),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",_.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),_.value?(p(),h("div",Nn,[l("div",zn,[t(e(L),{variant:"outline",size:"small",onClick:Ne},{default:d(()=>[...r[91]||(r[91]=[l("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),y(" Add Payment Method ",-1)])]),_:1})]),(p(!0),h(Z,null,X(a.value.paymentMethods,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[l("div",Bn,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[92]||(r[92]=[y("Description",-1)])]),_:1}),t(e(U),{modelValue:$.description,"onUpdate:modelValue":J=>$.description=J,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[93]||(r[93]=[y("Amount (€)",-1)])]),_:1}),t(e(U),{type:"number",modelValue:$.amount,"onUpdate:modelValue":J=>$.amount=J,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),l("div",qn,[t(e(I),{class:"flex items-center gap-2 cursor-pointer"},{default:d(()=>[t(e($e),{checked:$.paid,"onUpdate:checked":J=>$.paid=J},null,8,["checked","onUpdate:checked"]),r[94]||(r[94]=l("span",{class:"text-xs text-muted-foreground"},"PAID",-1))]),_:2},1024),t(e(L),{variant:"ghost",size:"icon",onClick:J=>ze(Se),class:"text-red-600 hover:text-red-700"},{default:d(()=>[...r[95]||(r[95]=[l("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),a.value.paymentMethods.length===0?(p(),h("div",En," No payment methods added yet ")):P("",!0),a.value.paymentMethods.length>0?(p(),h("div",jn,[l("div",_n,[r[96]||(r[96]=l("span",{class:"text-xs font-medium text-muted-foreground"},"Payment Methods Total:",-1)),l("span",Wn,"€ "+A(Be(R.value)),1)]),l("div",Hn,[r[97]||(r[97]=l("span",{class:"text-xs font-medium text-muted-foreground"},"Grand Total:",-1)),l("span",Qn,"€ "+A(Be(ae.value)),1)]),j.value?P("",!0):(p(),h("div",Yn," ⚠️ Payment methods must equal Grand Total "))])):P("",!0)])):P("",!0)]),l("div",Gn,[l("button",{type:"button",onClick:r[32]||(r[32]=$=>K.value=!K.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[98]||(r[98]=l("div",{class:"flex items-center gap-2"},[l("h6",{class:"text-sm font-semibold text-foreground"},"Terms & Conditions"),l("span",{class:"text-xs text-red-600"},"*Required")],-1)),l("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",K.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),K.value?(p(),h("div",Zn,[l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[99]||(r[99]=[y("Notes / Comments",-1)])]),_:1}),t(e(Te),{modelValue:a.value.notes,"onUpdate:modelValue":r[33]||(r[33]=$=>a.value.notes=$),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),l("div",null,[t(e(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:d(()=>[...r[100]||(r[100]=[y("Offer Expiration Date",-1)])]),_:1}),t(e(U),{type:"date",modelValue:a.value.expirationDate,"onUpdate:modelValue":r[34]||(r[34]=$=>a.value.expirationDate=$)},null,8,["modelValue"])]),l("div",Kn,[r[103]||(r[103]=l("h6",{class:"text-xs font-semibold text-foreground"},"Privacy & Consent",-1)),l("div",Jn,[t(e($e),{checked:a.value.privacyConsent,"onUpdate:checked":r[35]||(r[35]=$=>a.value.privacyConsent=$),id:"privacy-consent"},null,8,["checked"]),t(e(I),{for:"privacy-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:d(()=>[...r[101]||(r[101]=[y(" I agree to the privacy policy ",-1),l("span",{class:"text-red-500"},"*",-1)])]),_:1})]),l("div",Xn,[t(e($e),{checked:a.value.marketingConsent,"onUpdate:checked":r[36]||(r[36]=$=>a.value.marketingConsent=$),id:"marketing-consent"},null,8,["checked"]),t(e(I),{for:"marketing-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:d(()=>[...r[102]||(r[102]=[y(" I want to receive marketing communications ",-1)])]),_:1})])])])):P("",!0)])])):P("",!0),s.hideActions?P("",!0):(p(),h("div",er,[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:r[37]||(r[37]=$=>T.$emit("cancel"))}),t(e(L),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!qe.value,onClick:_e},null,8,["label","disabled"])]))])}}},lr={class:"flex-1 overflow-y-auto p-6 w-full"},Jr={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(s,{emit:i}){const o=i,n=O(null),u=E(()=>{var k;return((k=n.value)==null?void 0:k.isValid)||!1}),v=()=>{var k;(k=n.value)==null||k.submit()},b=k=>{k||o("close")},c=k=>{o("save",k),o("close")};return(k,S)=>(p(),H(e(ke),{open:s.show,"onUpdate:open":b},{default:d(()=>[t(e(ge),null,{default:d(()=>[t(e(ye),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(be),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:d(()=>[t(e(he),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:d(()=>[t(e(xe),null,{default:d(()=>[...S[2]||(S[2]=[y("Create Offer",-1)])]),_:1})]),_:1}),l("div",lr,[t(tr,{item:s.item,"task-type":s.taskType,"task-id":s.taskId,"selected-vehicle":s.requestedCar,customer:s.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:n,onSave:c,onCancel:S[0]||(S[0]=m=>k.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),t(e(Pe),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:d(()=>[t(e(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:S[1]||(S[1]=m=>k.$emit("close"))}),t(e(L),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!u.value,onClick:v},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Xr(s){const i=s.lead;if(!i)return null;const o=Ae(i,"lead");if(!o)return console.warn("No display stage calculated for lead"),null;const n=Le[o];if(!n)return console.warn(`No state config found for lead stage: ${o}`),null;if(!n.primaryAction)return console.warn(`No primary action found for lead stage: ${o}`),null;const u=n.primaryAction;if(typeof u=="function"){const v=u({lead:i,displayStage:o});return v||console.warn(`Primary action function returned null for lead stage: ${o}`),v}return u}function ei(s){const i=s.lead;if(!i)return[];const o=Ae(i,"lead"),n=Le[o];return n?n.secondaryActions||[]:[]}function st(s){const i=s.lead;if(!i||!(i.isDisqualified===!0))return!1;const n=Ae(i,"lead");return n===ve.CLOSED_INVALID||n===ve.CLOSED_NOT_INTERESTED||n===ve.CLOSED_DUPLICATE}function ti(s){const i=s.lead;if(!i||st(s))return!1;const o=Ae(i,"lead"),n=Le[o];return n?typeof n.showLQWidget=="function"?n.showLQWidget(i):n.showLQWidget??!1:!1}function li(s){const i=s.lead;if(!i||st(s))return!1;const o=Ae(i,"lead"),n=Le[o];return n?n.showDeadlineBanner&&i.nextActionDue:!1}function si(s){const i=s.lead;if(!i)return!1;const o=Ae(i,"lead"),n=Le[o];return n?n.canPostpone??!1:!1}function ai(s){const i=s.lead;if(!i)return"qualification";const o=Ae(i,"lead"),n=Le[o];return n&&n.lqWidgetMode||"qualification"}function oi(){const s=St();return{saveTradeInVehicle:async(n,u,v,b={})=>{try{const c=await s.addVehicle(v),k={type:"tradein",action:"added a trade-in",vehicleId:c.id,data:{brand:v.brand,model:v.model,version:v.version||null,year:v.year,kilometers:v.kilometers||0,plates:v.plates||null,registration:v.registration||null,vin:v.vin||null,fuelType:v.fuelType||null,gearType:v.gearType||null,tradeInPrice:b.tradeInPrice||null,evaluationRangeLow:b.evaluationRangeLow||null,evaluationRangeHigh:b.evaluationRangeHigh||null,provider:b.provider||null,evaluationDate:b.evaluationDate||null,priceToBuy:b.priceToBuy||null,priceToSell:b.priceToSell||null,priceOfVehicle:b.priceOfVehicle||null,priceOfOptionals:b.priceOfOptionals||null,listOfOptionals:b.listOfOptionals||null}};let S;if(n==="lead")S=await gt(u,k);else if(n==="opportunity")S=await yt(u,k);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:c,activity:S}}catch(c){throw console.error("Error saving trade-in vehicle:",c),c}},updateTradeInVehicle:async(n,u,v,b,c,k={})=>{try{const S=await s.modifyVehicle(v,c),m={data:{brand:c.brand,model:c.model,version:c.version||null,year:c.year,kilometers:c.kilometers||0,plates:c.plates||null,registration:c.registration||null,vin:c.vin||null,fuelType:c.fuelType||null,gearType:c.gearType||null,tradeInPrice:k.tradeInPrice||null,evaluationRangeLow:k.evaluationRangeLow||null,evaluationRangeHigh:k.evaluationRangeHigh||null,provider:k.provider||null,evaluationDate:k.evaluationDate||null,priceToBuy:k.priceToBuy||null,priceToSell:k.priceToSell||null,priceOfVehicle:k.priceOfVehicle||null,priceOfOptionals:k.priceOfOptionals||null,listOfOptionals:k.listOfOptionals||null}};let C;if(n==="lead")C=await pt(u,b,m);else if(n==="opportunity")C=await vt(u,b,m);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:S,activity:C}}catch(S){throw console.error("Error updating trade-in vehicle:",S),S}}}}function Q(s){if(!s)return 0;const i=new Date(s),n=Math.abs(new Date-i);return Math.ceil(n/(1e3*60*60*24))}const Ie={"no-appointment":s=>!s.scheduledAppointment,"has-appointment":s=>!!s.scheduledAppointment,"appointment-past-not-completed":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)<new Date&&s.scheduledAppointment.status!=="completed":!1,"has-future-appointment":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)>new Date:!1,"no-offers":s=>!s.hasOffers,"has-offers":s=>s.hasOffers,"qualified-no-offers-7-13-days":s=>{var b;const i=fe(),o=i.getSetting("oofbMinDays"),n=i.getSetting("oofbMaxDays"),u=(b=s.opportunity.postponedTasks)==null?void 0:b.oofb;if(u){const c=Q(u),k=i.getSetting("postponeTaskDays")||7;if(c<k)return!1;const S=Q(u);return S>=o&&S<n+1&&!s.hasOffers}const v=Q(s.opportunity.createdAt);return v>=o&&v<n+1&&!s.hasOffers},"qualified-no-offers-14-plus-days":s=>{var v;const i=fe(),o=i.getSetting("ufbDays"),n=(v=s.opportunity.postponedTasks)==null?void 0:v.ufb;if(n){const b=Q(n),c=i.getSetting("postponeTaskDays")||7;return b<c?!1:Q(n)>=o&&!s.hasOffers}return Q(s.opportunity.createdAt)>=o&&!s.hasOffers},"negotiation-offer-sent-substatus":s=>{var i;return((i=s.opportunity)==null?void 0:i.negotiationSubstatus)==="Offer Sent"},"negotiation-contract-pending-substatus":s=>{var i,o;return((i=s.opportunity)==null?void 0:i.contractDate)!==null&&((o=s.opportunity)==null?void 0:o.contractDate)!==void 0},"negotiation-offer-feedback-substatus":s=>{var i;return((i=s.opportunity)==null?void 0:i.negotiationSubstatus)==="Offer Feedback"},"negotiation-5-plus-days-no-contract-has-offers":s=>{var i;if(((i=s.opportunity)==null?void 0:i.id)===33){if(!s.hasOffers||s.opportunity.contractDate)return!1;const o=s.opportunity.lastActivity||s.opportunity.createdAt;return o?Q(o)>=5:!1}return!1},"contract-pending-5-plus-days":s=>{var k;const i=s.opportunity,o=S=>!!(S!=null&&S.contractSigned||S!=null&&S.esignatureCollectedDate);let n=!1,u=null;if(Array.isArray(i==null?void 0:i.contracts)&&i.contracts.length>0){const S=i.contracts.filter(o);n=S.length>0,n&&(u=S.reduce((C,f)=>{const x=f.esignatureCollectedDate||f.contractDate;return x?C?new Date(x)>new Date(C)?x:C:x:C},null))}else n=!!(i!=null&&i.contractSigned||i!=null&&i.esignatureCollectedDate),u=(i==null?void 0:i.contractDate)||(i==null?void 0:i.esignatureCollectedDate);if(!n||!u)return!1;const v=fe(),b=v.getSetting("cfbDays")||5,c=(k=i.postponedTasks)==null?void 0:k.cfb;if(c){const S=Q(c),m=v.getSetting("postponeTaskDays")||7;return S<m?!1:Q(c)>=b}try{const S=new Date(u);return isNaN(S.getTime())?!1:Q(S.toISOString())>=b}catch{return!1}},"closed-won-contract-feedback":s=>{var v,b;const i=(v=s.opportunity)==null?void 0:v.contractDate;if(!i||i===null||i===void 0||i==="")return!1;const o=fe(),n=o.getSetting("cfbDays")||5,u=(b=s.opportunity.postponedTasks)==null?void 0:b.cfb;if(u){const c=Q(u),k=o.getSetting("postponeTaskDays")||7;return c<k?!1:Q(u)>=n}try{const c=new Date(i);return isNaN(c.getTime())?!1:Q(c.toISOString())>=n}catch{return!1}},"negotiation-offer-feedback-5-plus-days-no-appointment":s=>{var b,c;if(((b=s.opportunity)==null?void 0:b.negotiationSubstatus)!=="Offer Feedback"||!s.hasOffers)return!1;const i=fe(),o=i.getSetting("nfuDays"),n=(c=s.opportunity.postponedTasks)==null?void 0:c.nfu;if(n){const k=Q(n),S=i.getSetting("postponeTaskDays")||7;if(k<S)return!1;const m=Q(n),C=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date;return m>=o&&!s.opportunity.contractDate&&!C}const u=Q(s.opportunity.lastActivity||s.opportunity.createdAt),v=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date;return u>=o&&!s.opportunity.contractDate&&!v},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":s=>Ie["negotiation-offer-feedback-5-plus-days-no-appointment"](s),"contract-7-plus-days-no-delivery":s=>{var b,c,k;if(!s.opportunity.contractDate)return!1;const i=fe(),o=i.getSetting("cfbDays"),n=(b=s.opportunity.postponedTasks)==null?void 0:b.cfb;if(n){const S=Q(n),m=i.getSetting("postponeTaskDays")||7;if(S<m)return!1;const C=Q(n),f=(c=s.activities)==null?void 0:c.some(x=>{var V;return x.type==="delivery"||((V=x.action)==null?void 0:V.toLowerCase().includes("delivered"))});return C>=o&&!f}const u=Q(s.opportunity.contractDate),v=(k=s.activities)==null?void 0:k.some(S=>{var m;return S.type==="delivery"||((m=S.action)==null?void 0:m.toLowerCase().includes("delivered"))});return u>=o&&!v},"delivery-delay-feedback-required":s=>{var b,c,k,S;if(s.deliverySubstatus!=="Awaiting Delivery"||!s.opportunity.deliveryDate||s.opportunity.actualDeliveryDate||((k=(c=(b=s.activities)==null?void 0:b.find(m=>{var C;return(C=m.data)==null?void 0:C.actualDeliveryDate}))==null?void 0:c.data)==null?void 0:k.actualDeliveryDate))return!1;const o=fe(),n=o.getSetting("dfbDays")||3,u=(S=s.opportunity.postponedTasks)==null?void 0:S.dfb;if(u){const m=Q(u),C=o.getSetting("postponeTaskDays")||7;return m<C?!1:Q(u)>=n}return Q(s.opportunity.deliveryDate)>=n},"delivery-feedback-required":s=>{var b,c,k,S,m,C,f;if(s.deliverySubstatus!=="Delivered")return!1;const i=s.opportunity.actualDeliveryDate||s.opportunity.deliveredDate||((k=(c=(b=s.activities)==null?void 0:b.find(x=>{var V;return(V=x.data)==null?void 0:V.actualDeliveryDate}))==null?void 0:c.data)==null?void 0:k.actualDeliveryDate)||((C=(m=(S=s.activities)==null?void 0:S.find(x=>{var V;return(V=x.data)==null?void 0:V.deliveredDate}))==null?void 0:m.data)==null?void 0:C.deliveredDate);if(!i)return!1;const o=fe(),n=o.getSetting("dfbDays")||3,u=(f=s.opportunity.postponedTasks)==null?void 0:f.dfb;if(u){const x=Q(u),V=o.getSetting("postponeTaskDays")||7;return x<V?!1:Q(u)>=n}return Q(i)>=n},"is-awaiting-delivery":s=>s.deliverySubstatus==="Awaiting Delivery","is-delivered":s=>s.deliverySubstatus==="Delivered","has-no-delivery":s=>!s.deliverySubstatus||s.deliverySubstatus===null,"is-closed":s=>{const i=s.stage;return i==="Closed Won"||i==="Closed Lost"},"is-closed-with-task-widget":s=>Ie["is-closed"](s)&&s.hasActiveTaskWidget,"opportunity-abandoned":s=>{if(Ie["is-closed"](s))return!1;const i=fe(),o=i.getSetting("abandonedOpportunityDays");if(!i.getSetting("abandonedEligibleStages").includes(s.stage))return!1;const u=s.opportunity.lastActivity||s.opportunity.createdAt;return Q(u)>=o}};function ni(s,i){if(Ie["is-closed-with-task-widget"](i))return[Ee.reopen,Ee.requalify,Ee.closeLost,{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}];const o=je[s];if(!o||!o.secondaryActions)return[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}];const n=o.secondaryActions.filter(v=>{if(!v.conditional)return!0;const b=Ie[v.conditional];return b?b(i):!0});return n.some(v=>v.key==="schedule-appointment")||n.push({key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}),n}function ri(s,i){const o=je[s];if(!o||!o.taskWidgets||i.opportunity.skipTaskReTrigger)return null;const u=fe().getSetting("autoCloseWidgetsOnClose"),v=Ie["is-closed"]({stage:s});for(const b of o.taskWidgets){if(u&&v&&(b.type==="NFU"||b.type==="OFB"))continue;const c=Ie[b.condition];if(c&&c(i))return b.type}return null}function ii(s,i){const o=je[s];if(!o||!o.primaryAction)return null;let n=o.primaryAction;return typeof n=="function"&&(n=n(i),!n)?null:{...n,title:typeof n.title=="function"?n.title(i):n.title,description:typeof n.description=="function"?n.description(i):n.description,label:typeof n.label=="function"?n.label(i):n.label}}function di(s){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Post-Delivery Customer Satisfaction Survey",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[s]||"Task"}function ui(s){return s==="Closed Won"||s==="Closed Lost"}const sr={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center rounded-lg"},ar={key:2,class:"absolute top-1 right-1 z-30"},or=["onClick"],nr=["src"],rr={key:1,class:"fa-solid fa-car text-base text-muted-foreground"},ir={class:"flex-1 space-y-1"},dr={class:"flex flex-wrap gap-1 mt-1"},ur=["title"],cr=["title"],fr={class:"mt-auto pt-1"},mr={key:4,class:"absolute bottom-0 left-0 right-0 z-10 bg-green-600/90 text-white text-[10px] font-medium px-2 py-1.5 flex items-center justify-between pointer-events-none"},pr={key:0,class:"opacity-90"},vr={__name:"OfferCard",props:{offer:{type:Object,required:!0},variant:{type:String,default:"carousel",validator:s=>["carousel","feed"].includes(s)},showStatusBadge:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showDate:{type:Boolean,default:!0},showAcceptanceInfo:{type:Boolean,default:!0},showAcceptanceBadge:{type:Boolean,default:!0},menuItems:{type:Array,default:()=>[]},containerClass:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["menu-action"],setup(s,{emit:i}){const o=s,n=O(null),u=O({}),v=O({}),b=E(()=>o.offer.status==="accepted"||o.offer.acceptance_status==="accepted"),c=E(()=>(o.variant==="carousel","h-16")),k=E(()=>o.variant==="carousel"?"p-2":"p-3"),S=E(()=>o.variant==="carousel"?"h-[105px]":""),m=E(()=>o.variant==="carousel"?"text-xs":"text-sm"),C=E(()=>o.variant==="carousel"?"text-xs":"text-sm"),f=E(()=>(o.variant==="carousel","text-xs")),x=(R,j)=>{j&&(u.value[R]=j)},V=()=>{if(o.menuItems.length===0)return 120;const R=document.createElement("span");R.style.visibility="hidden",R.style.position="absolute",R.style.fontSize="0.75rem",R.style.padding="0 12px",R.style.whiteSpace="nowrap",document.body.appendChild(R);let j=0;return o.menuItems.forEach(se=>{R.textContent=se.label;const te=R.offsetWidth;te>j&&(j=te)}),document.body.removeChild(R),Math.max(j+24,120)},M=R=>{const j=u.value[R];if(!j)return;const se=j.getBoundingClientRect(),te=V();v.value[R]={top:se.bottom+4,left:se.right-te,width:te}},_=async R=>{n.value===R?(n.value=null,delete v.value[R]):(n.value=R,await kt(),M(R))},K=()=>{n.value=null,v.value={}};let z=null,F=null;de(n,R=>{if(z&&(window.removeEventListener("scroll",z,!0),window.removeEventListener("resize",F),z=null,F=null),R){const j=()=>{R&&u.value[R]&&M(R)};z=j,F=j,window.addEventListener("scroll",z,!0),window.addEventListener("resize",F)}});const D=R=>R?new Intl.NumberFormat("en-US").format(R):"0",Y=R=>{if(!R)return"";const j=new Date(R),te=Math.abs(new Date-j),me=Math.ceil(te/(1e3*60*60*24));return me===0?"today":me===1?"yesterday":me<7?`${me} days ago`:j.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},w=R=>({active:"Active",accepted:"Accepted",archived:"Archived"})[R]||"Active",g=R=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[R]||"bg-gray-600",a=R=>b.value?"border-green-500 border-2":"border-border",G=R=>R.status==="archived"?"opacity-60":"",q=R=>{const j=R.vehicleBrand||"",se=R.vehicleModel||"",te=R.vehicleYear||"";return j&&se&&te?`${j} ${se} (${te})`:j&&se?`${j} ${se}`:"Vehicle"},ue=R=>R.price||0,ae=()=>o.offer.acceptance_date||o.offer.acceptedAt||o.offer.accepted_at||null;return(R,j)=>{var te,me,Re,Ne,ze;const se=Xe("click-outside");return p(),h("div",{class:W(["bg-white border rounded-lg shadow-nsc-card overflow-visible transition-shadow relative",a(s.offer),G(s.offer),s.containerClass,{"pointer-events-none opacity-60":s.loading}])},[s.loading?(p(),h("div",sr,[...j[2]||(j[2]=[l("div",{class:"flex flex-col items-center gap-2"},[l("div",{class:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),l("span",{class:"text-xs text-muted-foreground"},"Updating...")],-1)])])):P("",!0),s.showStatusBadge&&!(b.value&&s.showAcceptanceBadge)?(p(),h("div",{key:1,class:W(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",g(s.offer.status)])},A(w(s.offer.status)),3)):P("",!0),s.showMenu?(p(),h("div",ar,[l("button",{ref:pe=>x(s.offer.id,pe),onClick:j[0]||(j[0]=De(pe=>_(s.offer.id),["stop"])),title:"Offer actions",class:"relative z-30 w-6 h-6 flex items-center justify-center text-foreground hover:bg-black/10 bg-white/60 backdrop-blur-sm rounded-md transition-colors shadow-sm border border-black/5"},[t(e(Ft),{size:14})],512)])):P("",!0),s.showMenu?(p(),H(ht,{key:3,to:"body"},[n.value===s.offer.id&&v.value[s.offer.id]?Oe((p(),h("div",{key:0,class:"fixed z-[9999] bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",style:bt({top:`${v.value[s.offer.id].top}px`,left:`${v.value[s.offer.id].left}px`,width:`${v.value[s.offer.id].width}px`,minWidth:"120px"}),onClick:j[1]||(j[1]=De(()=>{},["stop"]))},[(p(!0),h(Z,null,X(s.menuItems,pe=>(p(),h("button",{key:pe.key,onClick:()=>{pe.onClick(),K()},class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2",style:{"font-size":"0.75rem","line-height":"1.5"}},A(pe.label),9,or))),128))],4)),[[se,K]]):P("",!0)])):P("",!0),l("div",{class:W(["w-full bg-muted flex items-center justify-center overflow-hidden",c.value])},[(te=s.offer.data)!=null&&te.image||s.offer.image?(p(),h("img",{key:0,src:((me=s.offer.data)==null?void 0:me.image)||s.offer.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,nr)):(p(),h("i",rr))],2),l("div",{class:W(["flex flex-col",k.value,S.value,{"pb-10":b.value}])},[l("div",ir,[l("h4",{class:W(["font-bold text-foreground leading-tight line-clamp-2",m.value])},A(q(s.offer)),3),l("p",{class:W(["font-bold text-foreground",C.value])},"€ "+A(D(ue(s.offer))),3),l("div",dr,[(Re=s.offer.data)!=null&&Re.selectedFinancingLabel?(p(),h("div",{key:0,class:"flex items-center gap-0.5 px-1 py-0.5 bg-purple-50 text-purple-700 text-[8px] font-bold rounded border border-purple-100 uppercase tracking-tighter",title:s.offer.data.selectedFinancingLabel},[t(e($t),{size:8}),j[3]||(j[3]=l("span",null,"Financing",-1))],8,ur)):P("",!0),((ze=(Ne=s.offer.data)==null?void 0:Ne.tradeIn)==null?void 0:ze.valuation)>0?(p(),h("div",{key:1,class:"flex items-center gap-0.5 px-1 py-0.5 bg-blue-50 text-blue-700 text-[8px] font-bold rounded border border-blue-100 uppercase tracking-tighter",title:s.offer.data.selectedTradeInLabel||"Trade-in"},[t(e(xt),{size:8}),j[4]||(j[4]=l("span",null,"Trade-in",-1))],8,cr)):P("",!0)])]),l("div",fr,[s.showDate&&s.offer.createdAt&&!(b.value&&s.showAcceptanceBadge)?(p(),h("p",{key:0,class:W(["text-muted-foreground",f.value])},A(Y(s.offer.createdAt)),3)):P("",!0)])],2),s.showAcceptanceBadge&&b.value?(p(),h("div",mr,[j[5]||(j[5]=l("span",{class:"flex items-center gap-1"},[l("i",{class:"fa-solid fa-check-circle"}),y(" Accepted ")],-1)),ae()?(p(),h("span",pr,A(Y(ae())),1)):P("",!0)])):P("",!0)],2)}}},gr={key:0},yr={class:"flex items-center justify-between mb-2"},br={class:"flex items-center gap-2"},hr={class:"font-semibold text-foreground text-sm"},xr={class:"relative"},kr={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},wr={class:"w-8 h-8 rounded-full bg-background border border-border flex items-center justify-center text-muted-foreground group-hover:text-foreground transition-colors shadow-sm"},Cr={key:1,class:"text-center py-6 px-3 bg-muted border border-border rounded-lg"},Sr={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted","generate-pdf","offer-activated","add"],setup(s,{expose:i,emit:o}){const n=o,u=O(new Set),v=(c,k)=>{k?u.value.add(c):u.value.delete(c)},b=c=>{const k=[],S=c.status==="accepted"||c.acceptance_status==="accepted";return c.status!=="active"&&k.push({key:"set-active",label:"Set active",onClick:()=>{v(c.id,!0),n("offer-activated",c)}}),S?k.push({key:"remove-accepted",label:"Remove acceptance",onClick:()=>{v(c.id,!0),n("offer-accepted",c,!0)}}):k.push({key:"set-accepted",label:"Set accepted",onClick:()=>{v(c.id,!0),n("offer-accepted",c)}}),k.push({key:"send-offer-pdf",label:"Send Offer PDF",onClick:()=>{n("generate-pdf",c)}}),k};return i({setOfferLoading:v}),(c,k)=>s.offers&&s.offers.length>0?(p(),h("div",gr,[l("div",yr,[l("div",br,[l("h3",hr,"Offers ("+A(s.offers.length)+")",1)])]),l("div",xr,[l("div",kr,[(p(!0),h(Z,null,X(s.offers,S=>(p(),H(vr,{key:`offer-${S.id}-${S.status}-${S.acceptance_status||"none"}`,offer:S,variant:"carousel","menu-items":b(S),loading:u.value.has(S.id),"container-class":"flex-none w-36 snap-start"},null,8,["offer","menu-items","loading"]))),128)),l("button",{class:"flex-none w-36 h-[171px] snap-start bg-muted/50 border-2 border-dashed border-border rounded-lg flex flex-col items-center justify-center gap-2 hover:bg-muted/80 transition-colors group",onClick:k[0]||(k[0]=S=>c.$emit("add"))},[l("div",wr,[t(e(Ve),{size:20})]),k[1]||(k[1]=l("span",{class:"text-[10px] font-medium text-muted-foreground group-hover:text-foreground uppercase tracking-wider"},"New Offer",-1))])])])])):(p(),h("div",Cr,[...k[2]||(k[2]=[l("i",{class:"fa-solid fa-file-invoice text-2xl text-muted-foreground mb-2"},null,-1),l("p",{class:"text-xs font-medium text-muted-foreground"},"No offers created yet",-1),l("p",{class:"text-xs text-muted-foreground mt-0.5"},"Create an offer to start negotiations",-1)])]))}},ci=Je(Sr,[["__scopeId","data-v-aefed0c9"]]);export{lt as $,ai as A,Fr as B,Dr as C,oi as D,Dt as E,ri as F,ii as G,ni as H,Mr as I,ui as J,di as K,Le as L,Ft as M,Ke as N,je as O,Ot as P,$t as Q,Nr as R,Ie as S,qr as T,Do as U,tr as V,ci as W,Ms as X,$s as Y,hs as Z,Br as _,Ge as a,Lt as a0,Pt as a1,At as a2,Mt as a3,Lr as b,Or as c,Rr as d,zr as e,Pr as f,Ur as g,Tt as h,Vt as i,Er as j,jr as k,_r as l,Wr as m,Hr as n,Qr as o,Yr as p,Gr as q,Zr as r,Kr as s,Jr as t,st as u,Xr as v,ei as w,ti as x,li as y,si as z};
