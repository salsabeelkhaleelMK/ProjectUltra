import{y as G}from"./components-WJKgpbNX.js";import{n as O}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{u as K}from"./opportunities-C7VMVq_4.js";import{g as j,c as W,f as H}from"./opportunityRules-DVPgyxsv.js";import{u as J}from"./useCustomersTable-CT-fT-ee.js";import{K as P,r as n,c as Q,I as X,m as Y,d as T,o as U,e as o,s as c,B as a,g as Z,y as i,t as tt,k as I,G as et}from"./index-BSxt259F.js";import{u as st}from"./useTableRowSelection-Bs49OKi4.js";import"./sparkles-ByigpcXa.js";import"./vehicles-sZbJG44U.js";const ot={class:"mb-8"},it={class:"bg-white"},nt={key:0,class:"flex items-center gap-2"},at={class:"flex items-center gap-2 mr-1"},lt={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},rt={__name:"LostTab",emits:["row-click"],setup(ut,{emit:B}){const l=K(),{rowSelection:r,selectedCount:R,hasSelection:_,getSelectedRows:$,clearSelection:d}=st(t=>t.id),m=n({pageIndex:0,pageSize:10}),f=n(""),g=n([]),p=n([]),y=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",u=Q(()=>l.opportunities.filter(t=>t.stage==="Closed Lost").map(t=>{var s,x,w,b,k,D,C,S,h,F,A,N;const e=((s=t.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${t.id}`,stageKey:"lost",customer:((x=t.customer)==null?void 0:x.name)||"Unknown",email:((w=t.customer)==null?void 0:w.email)||"",initials:((b=t.customer)==null?void 0:b.initials)||((D=(k=t.customer)==null?void 0:k.name)==null?void 0:D.slice(0,2).toUpperCase())||"?",nextAction:H(t.expectedCloseDate)||"No due date",nextActionFull:W(t.expectedCloseDate),deadlineStatus:j(t.expectedCloseDate),car:`${((C=t.vehicle)==null?void 0:C.brand)||""} ${((S=t.vehicle)==null?void 0:S.model)||""}`.trim()||"N/A",carStatus:((h=t.vehicle)==null?void 0:h.stockDays)!==void 0&&((F=t.vehicle)==null?void 0:F.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((A=t.vehicle)==null?void 0:A.stockDays)!==void 0&&((N=t.vehicle)==null?void 0:N.stockDays)!==null?"bg-green-100 text-green-700":"bg-muted text-muted-foreground",requestType:t.requestType||"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:y(t.createdAt),lastAppointment:e?y(e):"N/A",status:X(t,"opportunity"),statusClass:"bg-red-100 text-red-700",priority:t.priority||"Normal"}})),L=B,v=t=>{t.id.startsWith("opp-")&&L("row-click",t)},V=n("lost"),{columns:z,filterDefinitions:M,tableMeta:q}=J(V,v),E=()=>{const t=$(u.value);t.length!==0&&confirm(`Are you sure you want to delete ${t.length} ${t.length===1?"opportunity":"opportunities"}?`)&&(t.forEach(e=>{const s=e.id.replace("opp-","");l.deleteOpportunity(s)}),d())};return Y(async()=>{await l.fetchOpportunities()}),(t,e)=>(U(),T("div",ot,[o("div",it,[c(i(G),{data:u.value,columns:i(z),meta:i(q),onRowClick:v,columnFiltersOptions:{filterDefs:i(M)},pagination:m.value,"onUpdate:pagination":e[0]||(e[0]=s=>m.value=s),globalFilter:f.value,"onUpdate:globalFilter":e[1]||(e[1]=s=>f.value=s),sorting:g.value,"onUpdate:sorting":e[2]||(e[2]=s=>g.value=s),columnFilters:p.value,"onUpdate:columnFilters":e[3]||(e[3]=s=>p.value=s),rowSelection:i(r),"onUpdate:rowSelection":e[4]||(e[4]=s=>et(r)?r.value=s:null),paginationOptions:{rowCount:u.value.length},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":a(()=>[...e[5]||(e[5]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":a(()=>[i(_)?(U(),T("div",nt,[o("div",at,[o("div",lt,tt(i(R)),1),e[6]||(e[6]=o("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),e[9]||(e[9]=o("div",{class:"h-4 w-px bg-greys-700"},null,-1)),c(i(O),{variant:"ghost",size:"sm",onClick:E},{default:a(()=>[...e[7]||(e[7]=[o("i",{class:"fa-solid fa-trash mr-2"},null,-1),I(" Delete ",-1)])]),_:1}),c(i(O),{variant:"ghost",size:"sm",onClick:i(d)},{default:a(()=>[...e[8]||(e[8]=[o("i",{class:"fa-solid fa-x mr-2"},null,-1),I(" Close ",-1)])]),_:1},8,["onClick"])])):Z("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])]))}},wt=P(rt,[["__scopeId","data-v-899c3f01"]]);export{wt as default};
