import{d as j,c as _,m as C,r as D,u as Q,a as d,o as a,b as e,n as R,t as h,e as q,F as I,w as H,f as V,g as T,h as B,i as L,j as O,k as E,l as b,p as z,q as F,s as J,v as P}from"./index-CqTpMCq7.js";import{_ as G}from"./ModalShell-CemGwFh-.js";const Y=j("users",()=>{const m=_(()=>C),g=_(()=>C.filter(r=>r.role==="salesman")),n=_(()=>C.filter(r=>r.role==="operator")),p=_(()=>C.filter(r=>r.role==="manager")),c=r=>C.find(f=>f.id===r),u=r=>C.find(f=>f.name===r),y=_(()=>C);return{allUsers:m,salespeople:g,operators:n,managers:p,assignableUsers:y,getUserById:c,getUserByName:u}}),W={class:"flex items-center gap-2 mb-2"},K={class:"text-[10px] text-gray-400"},X={class:"text-[10px] text-gray-500"},Z={class:"ml-auto flex items-center gap-2"},ee={key:1,class:"bg-white border border-gray-200 rounded-lg shadow-lg p-1.5 flex items-center gap-1.5 z-10"},te=["innerHTML"],se={class:"flex gap-2 flex-wrap justify-end px-2"},oe={__name:"ActionableQuestionCard",props:{question:{type:Object,required:!0}},emits:["answer-yes","answer-no","reassign","view-task","dismiss"],setup(m,{emit:g}){const n=m,p=g,c=D(!1),u=D(!1),y=Q();Y();const r=()=>{var o,w,$;const t=((o=n.question.opportunity)==null?void 0:o.assignee)||((w=n.question.lead)==null?void 0:w.assignee);return t?t===(($=y.currentUser)==null?void 0:$.name)?"me":t:"Unknown"},f=()=>{const t=n.question.customer.name,o=n.question.question,w=`<a href="#" class="font-bold text-primary-600 hover:text-primary-700 hover:underline" onclick="event.preventDefault()">${t}</a>`;return o.replace(new RegExp(t,"g"),w)},v=t=>t===1?"bg-red-50 text-red-600 border-red-100":t<=3?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100",i=t=>t===1?"CRITICAL":t<=3?"HIGH":"MEDIUM",x=()=>{if(!n.question.createdAt&&!n.question.appointmentDate)return"Just now";const t=new Date(n.question.createdAt||n.question.appointmentDate),w=new Date-t,$=Math.floor(w/6e4),S=Math.floor($/60),A=Math.floor(S/24);return $<1?"Just now":$<60?`${$} min ago`:S<24?`${S} hours ago`:A===1?"1 day ago":A<7?`${A} days ago`:`${Math.floor(A/7)} weeks ago`},l=()=>p("answer-yes",n.question),k=()=>p("answer-no",n.question),N=()=>p("reassign",n.question),U=()=>p("view-task",n.question),M=t=>{t.target.tagName==="A"&&(t.preventDefault(),U())},s=()=>{u.value=!0,setTimeout(()=>{p("dismiss",n.question)},200)};return(t,o)=>(a(),d("div",{class:R(["bg-white border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm hover:shadow transition-colors duration-200 mb-3",u.value?"opacity-50":""])},[e("div",W,[e("span",{class:R(["px-2 py-0.5 rounded text-[10px] font-bold uppercase border whitespace-nowrap",v(m.question.priority)])},h(i(m.question.priority)),3),e("span",K,h(x()),1),e("span",X,"• Owner: "+h(r()),1),e("div",Z,[c.value?(a(),d("div",ee,[o[3]||(o[3]=e("span",{class:"text-[10px] text-gray-600 whitespace-nowrap"},"Dismiss?",-1)),e("button",{onClick:s,class:"px-2 py-0.5 text-[10px] font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded transition-colors"}," Yes "),e("button",{onClick:o[1]||(o[1]=w=>c.value=!1),class:"px-2 py-0.5 text-[10px] font-medium text-gray-600 hover:text-gray-800 transition-colors"}," No ")])):(a(),d("button",{key:0,onClick:o[0]||(o[0]=w=>c.value=!0),class:"w-7 h-7 flex items-center justify-center rounded text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"Dismiss"},[...o[2]||(o[2]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]))])]),e("div",{class:"pt-4 pb-2 mb-3 px-2",onClick:M},[e("p",{class:"text-base text-slate-700 leading-relaxed",innerHTML:f()},null,8,te)]),e("div",se,[m.question.type==="appointment-followup"?(a(),d(I,{key:0},[e("button",{onClick:l,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:k,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No ")],64)):m.question.type==="ns-followup"?(a(),d(I,{key:1},[e("button",{onClick:l,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:k,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):m.question.type==="offer-followup"?(a(),d("button",{key:2,onClick:U,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors"}," View Opportunity ")):m.question.type==="stuck-opportunity"?(a(),d(I,{key:3},[e("button",{onClick:l,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:k,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):m.question.type==="lead-qualification-urgency"?(a(),d(I,{key:4},[e("button",{onClick:l,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:k,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):q("",!0)])],2))}},re={class:"space-y-2 max-h-96 overflow-y-auto mb-4"},ne=["onClick"],ae={class:"flex-1"},ie={class:"font-medium text-slate-800"},le={class:"text-xs text-gray-500 capitalize"},de={key:0,class:"fa-solid fa-check text-primary-600"},ue={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},me=["disabled"],pe={__name:"ReassignUserModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(m,{emit:g}){const n=m,p=g,c=Y(),u=D(null),y=_(()=>c.assignableUsers),r=i=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[i]||"bg-gray-100 text-gray-700";H(()=>n.show,i=>{i||(u.value=null)});const f=i=>{u.value=i},v=()=>{u.value&&(p("confirm",u.value),u.value=null)};return(i,x)=>(a(),V(G,{show:m.show,onClose:x[1]||(x[1]=l=>i.$emit("close")),title:"Reassign"},{footer:T(()=>[e("div",ue,[e("button",{onClick:x[0]||(x[0]=l=>i.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:v,disabled:!u.value,class:"px-4 py-2 text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Reassign ",8,me)])]),default:T(()=>[x[2]||(x[2]=e("p",{class:"text-sm text-gray-600 mb-4"}," Select a user to reassign: ",-1)),e("div",re,[(a(!0),d(I,null,B(y.value,l=>(a(),d("button",{key:l.id,onClick:k=>f(l.id),class:R(["w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-primary-300 transition-colors text-left",{"bg-primary-50 border-primary-400":u.value===l.id}])},[e("div",{class:R(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm",r(l.role)])},h(l.initials),3),e("div",ae,[e("p",ie,h(l.name),1),e("p",le,h(l.role)+" • "+h(l.email),1)]),u.value===l.id?(a(),d("i",de)):q("",!0)],10,ne))),128))])]),_:1},8,["show"]))}},ce={class:"h-full overflow-y-auto bg-gray-50"},xe={class:"max-w-4xl mx-auto p-6 space-y-6"},ge={class:"mb-6"},ye={class:"text-xs text-gray-500"},fe={key:0,class:"flex items-center justify-center py-12"},be={key:1,class:"bg-white border border-gray-200 rounded-xl shadow-sm p-12 text-center"},he={key:2},ve={key:0,class:"text-center pt-4"},we={class:"text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"},Ce={__name:"ActionItems",setup(m){const g=z(),n=Q(),{questions:p,totalQuestionsCount:c,loading:u,loadQuestions:y,dismissQuestion:r,addFollowUpQuestion:f}=L(),v=D(!1),i=D(null);O(async()=>{await y()});const x=async s=>{s.type==="appointment-followup"?(r(s.id),f({id:`offer-followup-${s.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${s.customer.name}?`,customer:s.customer,opportunityId:s.opportunityId,opportunity:s.opportunity,createdAt:new Date().toISOString()})):(s.type==="ns-followup"||s.type==="stuck-opportunity"||s.type==="lead-qualification-urgency")&&r(s.id)},l=async s=>{var t;if(s.type==="appointment-followup")try{const o=(t=n.currentUser)==null?void 0:t.id;o&&(await P(s.opportunityId,o),r(s.id),await y())}catch(o){console.error("Error creating NS task:",o)}else s.type==="ns-followup"?r(s.id):s.type==="stuck-opportunity"?g.push(`/tasks/${s.opportunityId}?type=opportunity`):s.type==="lead-qualification-urgency"&&g.push(`/tasks/${s.leadId}?type=lead`)},k=s=>{i.value=s,v.value=!0},N=async s=>{if(i.value)try{const t=i.value.opportunityId||i.value.leadId;i.value.opportunityId&&await F(t,s),r(i.value.id),v.value=!1,i.value=null,await y()}catch(t){console.error("Error reassigning:",t)}},U=s=>{s.opportunityId?g.push(`/tasks/${s.opportunityId}?type=opportunity`):s.leadId&&g.push(`/tasks/${s.leadId}?type=lead`)},M=s=>{n.currentUser&&J(s.id,n.currentUser.id),r(s.id)};return(s,t)=>(a(),d("div",ce,[e("div",xe,[e("div",ge,[t[2]||(t[2]=e("h1",{class:"text-xl font-bold text-slate-800 mb-1"},"Action Items",-1)),e("p",ye,h(b(c)>0?`Showing ${Math.min(b(p).length,5)} of ${b(c)} urgent items`:"No urgent items require your attention"),1)]),b(u)?(a(),d("div",fe,[...t[3]||(t[3]=[e("div",{class:"text-gray-500"},"Loading questions...",-1)])])):!b(u)&&b(p).length===0?(a(),d("div",be,[t[4]||(t[4]=e("i",{class:"fa-solid fa-check-circle text-6xl text-emerald-400 mb-4"},null,-1)),t[5]||(t[5]=e("h3",{class:"text-xl font-semibold text-slate-800 mb-2"},"All caught up!",-1)),t[6]||(t[6]=e("p",{class:"text-sm text-gray-600 mb-6"},"No urgent items require your attention right now.",-1)),e("button",{onClick:t[0]||(t[0]=o=>s.$router.push("/tasks")),class:"px-4 py-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])):(a(),d("div",he,[(a(!0),d(I,null,B(b(p),o=>(a(),V(oe,{key:o.id,question:o,onAnswerYes:x,onAnswerNo:l,onReassign:k,onViewTask:U,onDismiss:M},null,8,["question"]))),128)),b(c)>5?(a(),d("div",ve,[e("button",we," View all items ("+h(b(c))+") → ",1)])):q("",!0)]))]),E(pe,{show:v.value,onClose:t[1]||(t[1]=o=>v.value=!1),onConfirm:N},null,8,["show"])]))}};export{Ce as default};
