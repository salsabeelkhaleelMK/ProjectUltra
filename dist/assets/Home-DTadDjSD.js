import{u as Q,r as _,c as v,d as H,m as I,a as g,o as u,b as e,n as A,t as w,e as q,F as S,w as L,f as V,g as O,h as Y,i as F,j as J,k as h,l as z}from"./index-aIgEv3db.js";import{f as G,u as P,c as K}from"./opportunities-P1PvtTvZ.js";import{_ as W}from"./ModalShell-DJ-4EQvF.js";const B="actionable-questions-dismissals";function E(){try{const r=localStorage.getItem(B);return r?JSON.parse(r):[]}catch{return[]}}function X(r,a){const n=E();n.some(p=>p.questionId===r&&p.userId===a)||(n.push({id:`dismissed-${r}-user-${a}`,questionId:r,userId:a,dismissedAt:new Date().toISOString()}),localStorage.setItem(B,JSON.stringify(n)))}function T(r,a){return E().some(i=>i.questionId===r&&i.userId===a)}function Z(){const r=Q(),a=_([]),n=_(!1),i=v(()=>r.currentUser),p=v(()=>{var o;return(o=r.currentUser)==null?void 0:o.role}),c=v(()=>i.value?a.value.filter(x=>!T(x.id,i.value.id)).slice(0,5):[]),f=v(()=>i.value?a.value.filter(o=>!T(o.id,i.value.id)).length:0);async function l(){if(!i.value){a.value=[];return}if(!r.isSalesman()&&!r.isManager()&&!r.isOperator()){a.value=[];return}n.value=!0;try{const o=await G(i.value.id,p.value);a.value=o}catch(o){console.error("Error loading actionable questions:",o),a.value=[]}finally{n.value=!1}}function y(o){a.value=a.value.filter(x=>x.id!==o)}function b(o){a.value.unshift(o)}return{questions:c,totalQuestionsCount:f,loading:n,loadQuestions:l,dismissQuestion:y,addFollowUpQuestion:b}}const j=H("users",()=>{const r=v(()=>I),a=v(()=>I.filter(l=>l.role==="salesman")),n=v(()=>I.filter(l=>l.role==="operator")),i=v(()=>I.filter(l=>l.role==="manager")),p=l=>I.find(y=>y.id===l),c=l=>I.find(y=>y.name===l),f=v(()=>I);return{allUsers:r,salespeople:a,operators:n,managers:i,assignableUsers:f,getUserById:p,getUserByName:c}}),ee={class:"flex items-center gap-2 mb-2"},te={class:"text-[10px] text-gray-400"},se={class:"text-[10px] text-gray-500"},oe={class:"ml-auto flex items-center gap-2"},re={key:1,class:"bg-white border border-gray-200 rounded-lg shadow-lg p-1.5 flex items-center gap-1.5 z-10"},ne=["innerHTML"],ae={class:"flex gap-2 flex-wrap justify-end px-2"},ie={__name:"ActionableQuestionCard",props:{question:{type:Object,required:!0}},emits:["answer-yes","answer-no","reassign","view-task","dismiss"],setup(r,{emit:a}){const n=r,i=a,p=_(!1),c=_(!1),f=Q();j();const l=()=>{var d,k,C;const t=((d=n.question.opportunity)==null?void 0:d.assignee)||((k=n.question.lead)==null?void 0:k.assignee);return t?t===((C=f.currentUser)==null?void 0:C.name)?"me":t:"Unknown"},y=()=>{const t=n.question.customer.name,d=n.question.question,k=`<a href="#" class="font-bold text-primary-600 hover:text-primary-700 hover:underline" onclick="event.preventDefault()">${t}</a>`;return d.replace(new RegExp(t,"g"),k)},b=t=>t===1?"bg-red-50 text-red-600 border-red-100":t<=3?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100",o=t=>t===1?"CRITICAL":t<=3?"HIGH":"MEDIUM",x=()=>{if(!n.question.createdAt&&!n.question.appointmentDate)return"Just now";const t=new Date(n.question.createdAt||n.question.appointmentDate),k=new Date-t,C=Math.floor(k/6e4),M=Math.floor(C/60),D=Math.floor(M/24);return C<1?"Just now":C<60?`${C} min ago`:M<24?`${M} hours ago`:D===1?"1 day ago":D<7?`${D} days ago`:`${Math.floor(D/7)} weeks ago`},m=()=>i("answer-yes",n.question),$=()=>i("answer-no",n.question),N=()=>i("reassign",n.question),U=()=>i("view-task",n.question),R=t=>{t.target.tagName==="A"&&(t.preventDefault(),U())},s=()=>{c.value=!0,setTimeout(()=>{i("dismiss",n.question)},200)};return(t,d)=>(u(),g("div",{class:A(["bg-white border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm hover:shadow transition-colors duration-200 mb-3",c.value?"opacity-50":""])},[e("div",ee,[e("span",{class:A(["px-2 py-0.5 rounded text-[10px] font-bold uppercase border whitespace-nowrap",b(r.question.priority)])},w(o(r.question.priority)),3),e("span",te,w(x()),1),e("span",se,"• Owner: "+w(l()),1),e("div",oe,[p.value?(u(),g("div",re,[d[3]||(d[3]=e("span",{class:"text-[10px] text-gray-600 whitespace-nowrap"},"Dismiss?",-1)),e("button",{onClick:s,class:"px-2 py-0.5 text-[10px] font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded transition-colors"}," Yes "),e("button",{onClick:d[1]||(d[1]=k=>p.value=!1),class:"px-2 py-0.5 text-[10px] font-medium text-gray-600 hover:text-gray-800 transition-colors"}," No ")])):(u(),g("button",{key:0,onClick:d[0]||(d[0]=k=>p.value=!0),class:"w-7 h-7 flex items-center justify-center rounded text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"Dismiss"},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]))])]),e("div",{class:"pt-4 pb-2 mb-3 px-2",onClick:R},[e("p",{class:"text-base text-slate-700 leading-relaxed",innerHTML:y()},null,8,ne)]),e("div",ae,[r.question.type==="appointment-followup"?(u(),g(S,{key:0},[e("button",{onClick:m,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:$,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No ")],64)):r.question.type==="ns-followup"?(u(),g(S,{key:1},[e("button",{onClick:m,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:$,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):r.question.type==="offer-followup"?(u(),g("button",{key:2,onClick:U,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors"}," View Opportunity ")):r.question.type==="stuck-opportunity"?(u(),g(S,{key:3},[e("button",{onClick:m,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:$,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):r.question.type==="lead-qualification-urgency"?(u(),g(S,{key:4},[e("button",{onClick:m,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:$,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):q("",!0)])],2))}},le={class:"space-y-2 max-h-96 overflow-y-auto mb-4"},de=["onClick"],ue={class:"flex-1"},ce={class:"font-medium text-slate-800"},me={class:"text-xs text-gray-500 capitalize"},pe={key:0,class:"fa-solid fa-check text-primary-600"},ge={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},xe=["disabled"],fe={__name:"ReassignUserModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(r,{emit:a}){const n=r,i=a,p=j(),c=_(null),f=v(()=>p.assignableUsers),l=o=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[o]||"bg-gray-100 text-gray-700";L(()=>n.show,o=>{o||(c.value=null)});const y=o=>{c.value=o},b=()=>{c.value&&(i("confirm",c.value),c.value=null)};return(o,x)=>(u(),V(W,{show:r.show,onClose:x[1]||(x[1]=m=>o.$emit("close")),title:"Reassign"},{footer:O(()=>[e("div",ge,[e("button",{onClick:x[0]||(x[0]=m=>o.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:b,disabled:!c.value,class:"px-4 py-2 text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Reassign ",8,xe)])]),default:O(()=>[x[2]||(x[2]=e("p",{class:"text-sm text-gray-600 mb-4"}," Select a user to reassign: ",-1)),e("div",le,[(u(!0),g(S,null,Y(f.value,m=>(u(),g("button",{key:m.id,onClick:$=>y(m.id),class:A(["w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-primary-300 transition-colors text-left",{"bg-primary-50 border-primary-400":c.value===m.id}])},[e("div",{class:A(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm",l(m.role)])},w(m.initials),3),e("div",ue,[e("p",ce,w(m.name),1),e("p",me,w(m.role)+" • "+w(m.email),1)]),c.value===m.id?(u(),g("i",pe)):q("",!0)],10,de))),128))])]),_:1},8,["show"]))}},ye={class:"h-full overflow-y-auto bg-gray-50"},be={class:"max-w-4xl mx-auto p-6 space-y-6"},ve={class:"mb-6"},he={class:"text-xs text-gray-500"},we={key:0,class:"flex items-center justify-center py-12"},ke={key:1,class:"bg-white border border-gray-200 rounded-xl shadow-sm p-12 text-center"},$e={key:2},Ce={key:0,class:"text-center pt-4"},Ie={class:"text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"},Ue={__name:"Home",setup(r){const a=z(),n=Q(),{questions:i,totalQuestionsCount:p,loading:c,loadQuestions:f,dismissQuestion:l,addFollowUpQuestion:y}=Z(),b=_(!1),o=_(null);F(async()=>{await f()});const x=async s=>{s.type==="appointment-followup"?(l(s.id),y({id:`offer-followup-${s.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${s.customer.name}?`,customer:s.customer,opportunityId:s.opportunityId,opportunity:s.opportunity,createdAt:new Date().toISOString()})):(s.type==="ns-followup"||s.type==="stuck-opportunity"||s.type==="lead-qualification-urgency")&&l(s.id)},m=async s=>{var t;if(s.type==="appointment-followup")try{const d=(t=n.currentUser)==null?void 0:t.id;d&&(await K(s.opportunityId,d),l(s.id),await f())}catch(d){console.error("Error creating NS task:",d)}else s.type==="ns-followup"?l(s.id):s.type==="stuck-opportunity"?a.push(`/tasks/${s.opportunityId}?type=opportunity`):s.type==="lead-qualification-urgency"&&a.push(`/tasks/${s.leadId}?type=lead`)},$=s=>{o.value=s,b.value=!0},N=async s=>{if(o.value)try{const t=o.value.opportunityId||o.value.leadId;o.value.opportunityId&&await P(t,s),l(o.value.id),b.value=!1,o.value=null,await f()}catch(t){console.error("Error reassigning:",t)}},U=s=>{s.opportunityId?a.push(`/tasks/${s.opportunityId}?type=opportunity`):s.leadId&&a.push(`/tasks/${s.leadId}?type=lead`)},R=s=>{n.currentUser&&X(s.id,n.currentUser.id),l(s.id)};return(s,t)=>(u(),g("div",ye,[e("div",be,[e("div",ve,[t[2]||(t[2]=e("h1",{class:"text-xl font-bold text-slate-800 mb-1"},"Action Items",-1)),e("p",he,w(h(p)>0?`Showing ${Math.min(h(i).length,5)} of ${h(p)} urgent items`:"No urgent items require your attention"),1)]),h(c)?(u(),g("div",we,[...t[3]||(t[3]=[e("div",{class:"text-gray-500"},"Loading questions...",-1)])])):!h(c)&&h(i).length===0?(u(),g("div",ke,[t[4]||(t[4]=e("i",{class:"fa-solid fa-check-circle text-6xl text-emerald-400 mb-4"},null,-1)),t[5]||(t[5]=e("h3",{class:"text-xl font-semibold text-slate-800 mb-2"},"All caught up!",-1)),t[6]||(t[6]=e("p",{class:"text-sm text-gray-600 mb-6"},"No urgent items require your attention right now.",-1)),e("button",{onClick:t[0]||(t[0]=d=>s.$router.push("/tasks")),class:"px-4 py-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])):(u(),g("div",$e,[(u(!0),g(S,null,Y(h(i),d=>(u(),V(ie,{key:d.id,question:d,onAnswerYes:x,onAnswerNo:m,onReassign:$,onViewTask:U,onDismiss:R},null,8,["question"]))),128)),h(p)>5?(u(),g("div",Ce,[e("button",Ie," View all items ("+w(h(p))+") → ",1)])):q("",!0)]))]),J(fe,{show:b.value,onClose:t[1]||(t[1]=d=>b.value=!1),onConfirm:N},null,8,["show"])]))}};export{Ue as default};
