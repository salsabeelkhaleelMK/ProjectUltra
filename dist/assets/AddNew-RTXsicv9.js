import{C as _,r as y,d as w,s as p,e as b,D as C,h as O,o as S}from"./index-4t0q-YoU.js";import{u as k}from"./customers-DNroEOnp.js";import{u as q}from"./opportunities-DBOjrln3.js";import{_ as A}from"./PageHeader-27gL1xgJ.js";import{_ as N}from"./UnifiedAddForm-lag-MeuZ.js";import"./settings-Buo-UMP2.js";import"./index-B_XAiWWB.js";import"./index-Ct-3v9pQ-BMtYOyzV.js";const D={class:"page-container"},L={class:"p-4 md:p-8"},F={__name:"AddNew",setup(R){const o=O(),c=k(),u=_(),d=q(),i=y(null),m=async l=>{try{const{contactMode:a,selectedContact:f,contactData:r,vehicleData:e,markAsLead:h,markAsOpportunity:g}=l;let t=f;if(a==="new"&&(t=await c.addCustomer({...r,initials:r.name.split(" ").map(s=>s[0]).join("").toUpperCase(),source:"Direct",tags:[],company:r.company||null})),h){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},status:"Open",stage:"Open Lead",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:"",isDisqualified:!1,disqualifyReason:null,scheduledAppointment:null,contactAttempts:[]};e&&Object.keys(e).length>0&&(s.requestedCar=e);const n=await u.createLead(s);o.push({path:"/customers",query:{tab:"open-leads",highlight:`lead-${n.id}`}})}else if(g){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},stage:"Qualified",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:""};e&&Object.keys(e).length>0&&(s.vehicle=e);const n=await d.createOpportunity(s);o.push({path:"/customers",query:{tab:"open-opportunities",highlight:`opp-${n.id}`}})}else e&&Object.keys(e).length>0&&await c.addRequestedCar(t.id,e),o.push({path:"/customers",query:{tab:"contacts",highlight:`contact-${t.id}`}})}catch(a){console.error("Error saving data:",a),alert("Failed to save. Please try again."),i.value&&i.value.resetSubmitting()}};return(l,a)=>(S(),w("div",D,[p(A,{title:"Add New Customer"},{actions:C(()=>[...a[0]||(a[0]=[])]),_:1}),b("div",L,[p(N,{ref_key:"formRef",ref:i,onSubmit:m},null,512)])]))}};export{F as default};
