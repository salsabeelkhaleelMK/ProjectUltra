import{r as k,x as E,k as K,y as J,c as L,e as d,o as p,h as t,z as i,A as P,g as f,B as b,F as X,i as Z,t as g,j as C,C as U,D as F,n as T,E as j,w as _,G as ee,l as N,d as te}from"./index-Be589Dcd.js";import{u as $}from"./contacts-Db2R-Zq2.js";import{u as le}from"./opportunities-BEKDyPzK.js";import{_ as se}from"./PageHeader-DBtxXtqo.js";const ae={class:"bg-white border border-gray-200 rounded-lg p-6 mb-6"},oe={class:"flex gap-6 mb-6"},ne={class:"flex items-center gap-2 cursor-pointer"},ie={class:"flex items-center gap-2 cursor-pointer"},re={key:0,class:"space-y-4"},ue={class:"relative"},de={class:"relative"},pe={key:0,class:"absolute z-50 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-80 overflow-y-auto"},me=["onClick"],be={class:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold shrink-0"},ce={class:"flex-1 min-w-0"},ve={class:"font-semibold text-gray-800 truncate"},ge={class:"text-sm text-gray-500 truncate"},ye={key:0,class:"text-xs text-gray-400 truncate"},fe={key:1,class:"absolute z-50 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg p-4"},xe={class:"text-center text-gray-500"},ke={class:"text-sm"},we={key:0,class:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4"},he={class:"flex items-center justify-between"},Ce={class:"flex items-center gap-3"},Se={class:"w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold"},De={class:"font-bold text-gray-800"},Ve={class:"text-sm text-gray-600"},qe={key:0,class:"text-xs text-gray-500"},Ue={key:1,class:"space-y-4"},Me=["required"],Te={key:0,class:"text-red-500 text-xs mt-1"},Ae=["required"],Oe={key:0,class:"text-red-500 text-xs mt-1"},Ee={class:"bg-white border border-gray-200 rounded-lg p-6 mb-6"},Le={class:"mb-6"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re=["max"],Pe={class:"md:col-span-2"},je={class:"mb-6"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={class:"bg-gray-50 border border-gray-200 rounded-lg p-6 mb-6"},Be={class:"space-y-3"},We=["disabled"],Ye=["disabled"],ze={key:0,class:"mt-3 flex items-start gap-2 text-xs text-orange-600 bg-orange-50 border border-orange-200 rounded-lg p-3"},He={key:1,class:"text-xs text-gray-500 mt-3 italic"},Qe={class:"flex justify-end gap-3"},Ge=["disabled"],Ke={key:0},Je={key:1},Xe={__name:"UnifiedAddForm",emits:["submit"],setup(I,{expose:V,emit:M}){const A=M,S=$(),m=k("existing"),c=k(""),v=k(!1),u=k(null),o=E({name:"",email:"",phone:"",company:""}),s=E({brand:"",model:"",year:new Date().getFullYear(),price:null,requestMessage:"",requestType:"",source:"",dealership:"",channel:"Email",fuelType:"",gearType:"",kilometers:null,stockDays:null}),r=k(!1),w=k(!1),D=k(!1),a=E({name:"",email:""});let y=null;K(()=>{S.contacts.length===0&&S.loadContacts(),document.addEventListener("click",R)}),J(()=>{document.removeEventListener("click",R)});const h=L(()=>{if(!c.value.trim())return S.contacts.slice(0,10);const n=c.value.toLowerCase();return S.contacts.filter(e=>e.name.toLowerCase().includes(n)||e.email.toLowerCase().includes(n)||e.company&&e.company.toLowerCase().includes(n)).slice(0,10)}),x=L(()=>!!(s.brand||s.model||s.year!==new Date().getFullYear()||s.price||s.requestMessage||s.requestType||s.source||s.dealership||s.fuelType||s.gearType||s.kilometers||s.stockDays)),B=L(()=>m.value==="existing"?!!u.value:!!(o.name&&o.email)),W=()=>{clearTimeout(y),y=setTimeout(()=>{v.value=!0},300)},Y=n=>{u.value=n,c.value=n.name,v.value=!1},z=()=>{u.value=null,c.value="",v.value=!1},R=n=>{n.target.closest("form")||(v.value=!1)},H=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),Q=()=>{m.value="existing",u.value=null,c.value="",v.value=!1,o.name="",o.email="",o.phone="",o.company="",Object.keys(s).forEach(n=>{n==="year"?s[n]=new Date().getFullYear():n==="channel"?s[n]="Email":typeof s[n]=="number"?s[n]=null:s[n]=""}),r.value=!1,w.value=!1,a.name="",a.email=""},G=()=>{if(a.name="",a.email="",m.value==="new"){let l=!0;if(o.name.trim()||(a.name="Contact name is required",l=!1),o.email.trim()?H(o.email)||(a.email="Please enter a valid email address",l=!1):(a.email="Email is required",l=!1),!l)return}else if(!u.value)return;D.value=!0;const n=Object.entries(s).reduce((l,[O,q])=>{if(q!==null&&q!==""&&q!==void 0){if(O==="year"&&q===new Date().getFullYear())return l;l[O]=q}return l},{}),e=m.value==="new"?{name:o.name.trim(),email:o.email.trim(),phone:o.phone.trim(),company:o.company.trim()}:null;A("submit",{contactMode:m.value,selectedContact:u.value,contactData:e,vehicleData:Object.keys(n).length>0?n:null,markAsLead:r.value,markAsOpportunity:w.value})};return V({resetSubmitting:()=>{D.value=!1}}),(n,e)=>(p(),d("form",{onSubmit:_(G,["prevent"]),class:"max-w-4xl mx-auto"},[t("div",ae,[e[35]||(e[35]=t("h3",{class:"font-bold text-gray-800 mb-4"},"Contact Information",-1)),t("div",oe,[t("label",ne,[i(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),value:"existing",class:"w-4 h-4 text-blue-600"},null,512),[[P,m.value]]),e[23]||(e[23]=t("span",{class:"text-sm font-medium text-gray-700"},"Existing Contact",-1))]),t("label",ie,[i(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),value:"new",class:"w-4 h-4 text-blue-600"},null,512),[[P,m.value]]),e[24]||(e[24]=t("span",{class:"text-sm font-medium text-gray-700"},"New Contact",-1))])]),m.value==="existing"?(p(),d("div",re,[t("div",ue,[e[28]||(e[28]=t("label",{class:"block label-upper mb-2"},"Search Contact",-1)),t("div",de,[e[25]||(e[25]=t("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),onInput:W,onFocus:e[3]||(e[3]=l=>v.value=!0),type:"text",placeholder:"Search by name, email, or company...",class:"input pl-10"},null,544),[[b,c.value]])]),v.value&&h.value.length>0?(p(),d("div",pe,[(p(!0),d(X,null,Z(h.value,l=>(p(),d("div",{key:l.id,onClick:O=>Y(l),class:"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer transition-colors border-b border-gray-100 last:border-b-0"},[t("div",be,g(l.initials),1),t("div",ce,[t("div",ve,g(l.name),1),t("div",ge,g(l.email),1),l.company?(p(),d("div",ye,g(l.company),1)):f("",!0)]),e[26]||(e[26]=t("i",{class:"fa-solid fa-chevron-right text-gray-400 text-sm"},null,-1))],8,me))),128))])):f("",!0),v.value&&c.value&&h.value.length===0?(p(),d("div",fe,[t("div",xe,[e[27]||(e[27]=t("i",{class:"fa-solid fa-search text-2xl mb-2"},null,-1)),t("p",ke,'No contacts found matching "'+g(c.value)+'"',1)])])):f("",!0)]),u.value?(p(),d("div",we,[t("div",he,[t("div",Ce,[t("div",Se,g(u.value.initials),1),t("div",null,[t("div",De,g(u.value.name),1),t("div",Ve,g(u.value.email),1),u.value.company?(p(),d("div",qe,g(u.value.company),1)):f("",!0)])]),t("button",{type:"button",onClick:z,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...e[29]||(e[29]=[t("i",{class:"fa-solid fa-xmark text-xl"},null,-1)])])])])):f("",!0)])):(p(),d("div",Ue,[t("div",null,[e[30]||(e[30]=t("label",{class:"block label-upper mb-2"},[C(" Contact Name "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.name=l),type:"text",placeholder:"Enter contact name...",class:"input",required:m.value==="new"},null,8,Me),[[b,o.name]]),a.name?(p(),d("p",Te,g(a.name),1)):f("",!0)]),t("div",null,[e[31]||(e[31]=t("label",{class:"block label-upper mb-2"},[C(" Email "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.email=l),type:"email",placeholder:"contact@example.com",class:"input",required:m.value==="new"},null,8,Ae),[[b,o.email]]),a.email?(p(),d("p",Oe,g(a.email),1)):f("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block label-upper mb-2"},"Phone",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.phone=l),type:"tel",placeholder:"+49...",class:"input"},null,512),[[b,o.phone]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block label-upper mb-2"},"Company (optional)",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.company=l),type:"text",placeholder:"Company name...",class:"input"},null,512),[[b,o.company]]),e[34]||(e[34]=t("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty for individual contacts",-1))])]))]),t("div",Ee,[e[58]||(e[58]=t("h3",{class:"font-bold text-gray-800 mb-4"},[C(" Vehicle Details "),t("span",{class:"text-sm text-gray-500 font-normal"},"(Optional)")],-1)),t("div",Le,[e[41]||(e[41]=t("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Basic Information",-1)),t("div",Fe,[t("div",null,[e[36]||(e[36]=t("label",{class:"block label-upper mb-2"},"Brand",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.brand=l),type:"text",placeholder:"e.g., Volkswagen",class:"input"},null,512),[[b,s.brand]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block label-upper mb-2"},"Model",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.model=l),type:"text",placeholder:"e.g., ID.4",class:"input"},null,512),[[b,s.model]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block label-upper mb-2"},"Year",-1)),i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.year=l),type:"number",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"input"},null,8,Re),[[b,s.year]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block label-upper mb-2"},"Price",-1)),i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.price=l),type:"number",min:"0",placeholder:"e.g., 45000",class:"input"},null,512),[[b,s.price]])]),t("div",Pe,[e[40]||(e[40]=t("label",{class:"block label-upper mb-2"},"Request Message",-1)),i(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=l=>s.requestMessage=l),rows:"3",placeholder:"Customer's message or notes...",class:"input resize-none"},null,512),[[b,s.requestMessage]])])])]),t("div",je,[e[49]||(e[49]=t("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Request Details",-1)),t("div",Ne,[t("div",null,[e[43]||(e[43]=t("label",{class:"block label-upper mb-2"},"Request Type",-1)),i(t("select",{"onUpdate:modelValue":e[13]||(e[13]=l=>s.requestType=l),class:"input"},[...e[42]||(e[42]=[F('<option value="">Select type</option><option value="Quotation">Quotation</option><option value="Test Drive">Test Drive</option><option value="Information">Information</option><option value="Purchase">Purchase</option>',5)])],512),[[U,s.requestType]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block label-upper mb-2"},"Source",-1)),i(t("select",{"onUpdate:modelValue":e[14]||(e[14]=l=>s.source=l),class:"input"},[...e[44]||(e[44]=[F('<option value="">Select source</option><option value="Marketing">Marketing</option><option value="Website">Website</option><option value="Phone">Phone</option><option value="Walk-in">Walk-in</option><option value="Referral">Referral</option>',6)])],512),[[U,s.source]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block label-upper mb-2"},"Dealership",-1)),i(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>s.dealership=l),type:"text",placeholder:"e.g., Berlin Mitte",class:"input"},null,512),[[b,s.dealership]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block label-upper mb-2"},"Channel",-1)),i(t("select",{"onUpdate:modelValue":e[16]||(e[16]=l=>s.channel=l),class:"input"},[...e[47]||(e[47]=[t("option",{value:"Email"},"Email",-1),t("option",{value:"Phone"},"Phone",-1),t("option",{value:"WhatsApp"},"WhatsApp",-1),t("option",{value:"SMS"},"SMS",-1)])],512),[[U,s.channel]])])])]),t("div",null,[e[57]||(e[57]=t("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Vehicle Details",-1)),t("div",$e,[t("div",null,[e[51]||(e[51]=t("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),i(t("select",{"onUpdate:modelValue":e[17]||(e[17]=l=>s.fuelType=l),class:"input"},[...e[50]||(e[50]=[F('<option value="">Select fuel type</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[U,s.fuelType]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block label-upper mb-2"},"Gear Type",-1)),i(t("select",{"onUpdate:modelValue":e[18]||(e[18]=l=>s.gearType=l),class:"input"},[...e[52]||(e[52]=[t("option",{value:""},"Select gear type",-1),t("option",{value:"Manual"},"Manual",-1),t("option",{value:"Automatic"},"Automatic",-1),t("option",{value:"Semi-Automatic"},"Semi-Automatic",-1)])],512),[[U,s.gearType]])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block label-upper mb-2"},"Kilometers",-1)),i(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>s.kilometers=l),type:"number",min:"0",placeholder:"e.g., 50000",class:"input"},null,512),[[b,s.kilometers]])]),t("div",null,[e[55]||(e[55]=t("label",{class:"block label-upper mb-2"},"Stock Days",-1)),i(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>s.stockDays=l),type:"number",min:"0",placeholder:"Days in stock",class:"input"},null,512),[[b,s.stockDays]]),e[56]||(e[56]=t("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty if out of stock",-1))])])])]),t("div",Ie,[e[63]||(e[63]=t("h3",{class:"font-bold text-gray-800 mb-4"},"Create Task (Optional)",-1)),e[64]||(e[64]=t("p",{class:"text-sm text-gray-600 mb-4"},[C(" Convert this contact to a lead or opportunity. "),t("span",{class:"font-semibold"},"Requires vehicle details to be filled.")],-1)),t("div",Be,[t("label",{class:T(["flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg transition-all",x.value?"cursor-pointer hover:bg-blue-50 hover:border-blue-300":"cursor-not-allowed opacity-60"])},[i(t("input",{type:"checkbox","onUpdate:modelValue":e[21]||(e[21]=l=>r.value=l),disabled:!x.value,class:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,We),[[j,r.value]]),t("div",null,[t("span",{class:T(["font-medium",x.value?"text-gray-800":"text-gray-400"])}," Mark as Lead ",2),e[59]||(e[59]=t("p",{class:"text-xs text-gray-500"},"Create a new lead task with vehicle details",-1))])],2),t("label",{class:T(["flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg transition-all",x.value?"cursor-pointer hover:bg-purple-50 hover:border-purple-300":"cursor-not-allowed opacity-60"])},[i(t("input",{type:"checkbox","onUpdate:modelValue":e[22]||(e[22]=l=>w.value=l),disabled:!x.value,class:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Ye),[[j,w.value]]),t("div",null,[t("span",{class:T(["font-medium",x.value?"text-gray-800":"text-gray-400"])}," Mark as Opportunity ",2),e[60]||(e[60]=t("p",{class:"text-xs text-gray-500"},"Create a new opportunity task with vehicle details",-1))])],2)]),x.value?f("",!0):(p(),d("div",ze,[...e[61]||(e[61]=[t("i",{class:"fa-solid fa-exclamation-triangle mt-0.5"},null,-1),t("span",null,"Fill in vehicle details above to enable lead/opportunity creation",-1)])])),!r.value&&!w.value&&x.value?(p(),d("p",He,[...e[62]||(e[62]=[t("i",{class:"fa-solid fa-info-circle mr-1"},null,-1),C(" If neither is selected, only the contact and vehicle information will be saved ",-1)])])):f("",!0)]),t("div",Qe,[t("button",{type:"button",onClick:Q,class:"btn-secondary"}," Clear Form "),t("button",{type:"submit",class:"btn-primary",disabled:D.value||!B.value},[D.value?(p(),d("span",Ke,[...e[65]||(e[65]=[t("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1),C(" Saving... ",-1)])])):(p(),d("span",Je,[...e[66]||(e[66]=[C(" Save ",-1),t("i",{class:"fa-solid fa-check ml-2"},null,-1)])]))],8,Ge)])],32))}},Ze={class:"page-container"},_e={class:"p-4 md:p-8"},at={__name:"AddNew",setup(I){const V=te(),M=$(),A=ee(),S=le(),m=k(null),c=async v=>{try{const{contactMode:u,selectedContact:o,contactData:s,vehicleData:r,markAsLead:w,markAsOpportunity:D}=v;let a=o;if(u==="new"&&(a=await M.addContact({...s,initials:s.name.split(" ").map(y=>y[0]).join("").toUpperCase(),source:"Direct",tags:[]})),w){const y={customer:{id:a.id,name:a.name,initials:a.initials,email:a.email,phone:a.phone,address:a.address||""},status:"Open",stage:"Open Lead",priority:"Normal",source:(r==null?void 0:r.source)||"Direct",assignee:null,assigneeInitials:"",isDisqualified:!1,disqualifyReason:null,scheduledAppointment:null,contactAttempts:[]};r&&Object.keys(r).length>0&&(y.requestedCar=r);const h=await A.createLead(y);V.push({path:"/customers",query:{tab:"open-leads",highlight:`lead-${h.id}`}})}else if(D){const y={customer:{id:a.id,name:a.name,initials:a.initials,email:a.email,phone:a.phone,address:a.address||""},stage:"Qualified",priority:"Normal",source:(r==null?void 0:r.source)||"Direct",assignee:null,assigneeInitials:""};r&&Object.keys(r).length>0&&(y.vehicle=r);const h=await S.createOpportunity(y);V.push({path:"/customers",query:{tab:"open-opportunities",highlight:`opp-${h.id}`}})}else r&&Object.keys(r).length>0&&await M.addRequestedCarToContact(a.id,r),V.push({path:"/customers",query:{tab:"contacts",highlight:`contact-${a.id}`}})}catch(u){console.error("Error saving data:",u),alert("Failed to save. Please try again."),m.value&&m.value.resetSubmitting()}};return(v,u)=>(p(),d("div",Ze,[N(se,{title:"Add New Customer",subtitle:"Create contacts, leads, or opportunities"}),t("div",_e,[N(Xe,{ref_key:"formRef",ref:m,onSubmit:c},null,512)])]))}};export{at as default};
