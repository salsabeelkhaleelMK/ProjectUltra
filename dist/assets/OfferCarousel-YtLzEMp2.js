import{H as le,R as ke,r as L,l as ae,x as _,o as p,B as i,s as t,y as e,e as s,k as b,d as h,g as D,E as st,F as K,i as J,t as T,a5 as at,h as ot,n as j,I as Je,c as E,J as Xe,w as Me,p as Oe,T as nt,$ as Ve,m as Pe,K as rt,ab as it,D as dt,u as ut,a8 as ct,aa as ft,af as He,ag as Qe,a0 as Ye,W as Ae,au as mt,av as pt,aw as vt,ax as gt,M as fe,q as yt,ah as bt,ai as ht,Q as xt}from"./index-D-GV69Dn.js";import{f as me,F as pe,L as ve,g as ge,h as ye,Q as V,c as F,C as De,n as M,d as be,$ as kt,o as Te,W as ne,U as re,H as ie,j as N,G as de,p as $e}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-3RNqBGno.js";import{S as et}from"./sparkles-DqOgHrLF.js";import{u as wt}from"./opportunities-D_EVVSI9.js";import{f as Ct,u as St}from"./vehicles-CLPlMvEC.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=le("BadgePercentIcon",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 15h.01",key:"lqbp3k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=le("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=le("CheckCircle2Icon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=le("CheckCircleIcon",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=le("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=le("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=le("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=le("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=le("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=le("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=le("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=le("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=le("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=le("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=le("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function Dr(l){if(!l)return"";const u=new Date(l),o=new Date;if(u<o)return"OVERDUE";if(u.toDateString()===o.toDateString()){const d=u-o,v=Math.floor(d/(1e3*60*60)),y=Math.floor(d%(1e3*60*60)/(1e3*60));return v>0?`${v}h ${y}m`:`${y}m`}return u.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Mr(l){return(typeof l=="string"?new Date(l):l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Pr(l){return(typeof l=="string"?new Date(l):l).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Ge(l){return(l==null?void 0:l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function Lr(l){if(!l)return"No deadline";const u=new Date(l);if(u<new Date)return"OVERDUE";const n=u.toLocaleDateString("en-US",{month:"short",day:"numeric"}),d=u.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${n}, ${d}`}function Fr(l){if(!l)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const u=new Date(l),o=new Date,n=(u-o)/(1e3*60*60);if(n<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(n<2){const d=Math.floor((u-o)/6e4),v=Math.floor(d/60),y=d%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:v>0?`${v}h ${y}m`:`${y}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(n<24){const d=Math.floor(n),v=Math.floor((n-d)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${d}h ${v}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const d=Math.ceil(n/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${d} day${d!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function Or(l){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[l]||"bg-gray-100 text-gray-700"}function Ur(l){return l?new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const Le={[ke.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ke.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:l=>!!(l.callbackDate||l.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ke.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[ke.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ke.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ke.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Ke={toClosed:(l,u,o)=>{const n={isDisqualified:!0,disqualifyReason:(o==null?void 0:o.reason)||null,disqualifyCategory:(o==null?void 0:o.category)||null,scheduledAppointment:null,nextActionDue:null};(o==null?void 0:o.reason)==="Duplicate"?(n.isDuplicate=!0,n.stage="Closed Failed"):(o==null?void 0:o.category)==="Not Interested"?n.stage="Not Interested":n.stage="Not Valid",n.status="Disqualified";const d=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(o==null?void 0:o.category)||"Unknown"}, Reason: ${(o==null?void 0:o.reason)||"Unknown"}`}];return l.scheduledAppointment&&d.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:l.scheduledAppointment}}),{updates:n,activities:d}},reopen:l=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Rr(l,u){return u.startsWith("Closed")?Ke.toClosed:l.startsWith("Closed")&&!u.startsWith("Closed")?Ke.reopen:null}const je={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:l=>l.scheduledAppointment&&l.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:u=>{const o=new Date(u.scheduledAppointment.start);return`Appointment scheduled for ${u.formatDateTime?u.formatDateTime(u.scheduledAppointment.start):o.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"reschedule",title:"Reschedule Appointment",description:l=>l.scheduledAppointment&&l.scheduledAppointment.start?`Scheduled for ${l.formatDateTime?l.formatDateTime(l.scheduledAppointment.start):new Date(l.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:"Reschedule",icon:"fa-solid fa-calendar-days",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"In Negotiation":{primaryAction:l=>l.hasOffers?null:{key:"create-offer",title:"Create Offer",description:"Create initial offer to begin negotiation",label:"Create Offer",icon:"fa-solid fa-file-invoice-dollar",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"reassign",label:"Reassign",icon:"fa-solid fa-user-group",description:"Assign this opportunity to another sales rep"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"In Negotiation - Offer Sent":{primaryAction:null,secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation - Contract Pending":{primaryAction:l=>{const u=l.opportunity,o=!!u.deliveryDate,n=!!u.contractSigned||!!u.esignatureCollectedDate;return o&&!n?{key:"collect-esignatures",title:"Collect e-signatures",description:"Get the formal contract signed electronically by the customer",label:"Collect e-signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}}:o?null:{key:"set-delivery-date",title:"Set Delivery Date",description:"Schedule the delivery date for the vehicle",label:"Set Delivery Date",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-pending-5-plus-days"}]},"Closed Won":{primaryAction:l=>{const u=l.deliverySubstatus;return u==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback or complete delivery checklist",label:"Confirm Satisfaction",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:u==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Request Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered",description:"Collect customer feedback about delivery experience"},{key:"complete-checklist",label:"Complete Checklist",icon:"fa-solid fa-clipboard-check",conditional:"is-delivered",description:"Complete post-delivery checklist and documentation"},{key:"reschedule-delivery",label:"Reschedule",icon:"fa-solid fa-calendar-days",conditional:"is-awaiting-delivery",description:"Reschedule the delivery date"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"archive",label:"Archive",icon:"fa-solid fa-archive",conditional:"is-delivered",description:"Archive this completed opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"closed-won-contract-feedback"},{type:"DFB",condition:"delivery-delay-feedback-required"},{type:"DFB",condition:"delivery-feedback-required"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},qe={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},Rt={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Nt={class:"space-y-2"},zt={key:0,class:"space-y-2"},Bt={class:"flex flex-wrap gap-2"},Et=["onClick"],Nr={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(l,{emit:u}){const o=l,n=u,d=L(""),v=c=>{c||n("close")};ae(()=>o.show,c=>{c&&(d.value="")});const y=()=>{const c=d.value.trim();c&&(o.existingTags.includes(c)||(n("add",c),d.value=""))};return(c,x)=>(p(),_(e(be),{open:l.show,"onUpdate:open":v},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[...x[2]||(x[2]=[b("Add Tag",-1)])]),_:1})]),_:1}),s("div",Rt,[s("div",Nt,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...x[3]||(x[3]=[b("Tag Name",-1)])]),_:1}),t(e(F),{modelValue:d.value,"onUpdate:modelValue":x[0]||(x[0]=w=>d.value=w),onKeyup:st(y,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full h-10",autofocus:""},null,8,["modelValue"])]),l.existingTags.length>0?(p(),h("div",zt,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...x[4]||(x[4]=[b("Existing Tags",-1)])]),_:1}),s("div",Bt,[(p(!0),h(K,null,J(l.existingTags,w=>(p(),h("button",{key:w,onClick:m=>d.value=w,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},T(w),9,Et))),128))])])):D("",!0)]),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x[1]||(x[1]=w=>c.$emit("close"))}),t(e(M),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!d.value.trim(),onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},qt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},jt={class:"flex items-center justify-between gap-2 mb-4"},_t={class:"flex flex-col"},Wt={class:"space-y-3"},Ht={class:"flex items-start justify-between gap-2"},Qt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Yt={class:"flex items-start justify-between gap-2"},Gt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Kt={class:"flex items-center justify-between gap-2"},Zt={class:"flex items-center gap-1 min-w-0 flex-1 justify-end"},Jt={class:"text-sm font-medium text-foreground leading-5 text-right truncate min-w-0"},Xt={key:0,class:"flex items-start justify-between gap-2"},el={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},zr={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(l){const u=l,o=at(),n=ot(),d=async(y,c)=>{if(y)try{await navigator.clipboard.writeText(y),o.pushToast("success",`${c==="email"?"Email":"Phone"} copied!`)}catch{o.pushToast("error","Failed to copy")}},v=()=>{var c;const y=((c=u.task.customer)==null?void 0:c.id)||u.customerId;if(y){const x=n.resolve(`/customer/${y}`).href;window.open(x,"_blank")}};return(y,c)=>{var x,w,m,C,f,k;return p(),h("div",qt,[s("div",jt,[c[1]||(c[1]=s("h3",{class:"text-base font-medium text-foreground leading-6"},"Customer information",-1)),(x=l.task.customer)!=null&&x.id?(p(),_(e(M),{key:0,variant:"ghost",size:"icon",onClick:v,class:j("h-7 w-7"),title:"Open customer profile in new tab"},{default:i(()=>[t(e(Dt),{size:14,class:"text-muted-foreground"})]),_:1})):D("",!0)]),s("div",_t,[s("div",Wt,[s("div",Ht,[c[2]||(c[2]=s("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Customer",-1)),s("p",Qt,T(((w=l.task.customer)==null?void 0:w.name)||"Unknown"),1)]),s("div",Yt,[c[3]||(c[3]=s("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Email",-1)),s("p",Gt,T(((m=l.task.customer)==null?void 0:m.email)||"N/A"),1)]),s("div",Kt,[c[4]||(c[4]=s("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Phone",-1)),s("div",Zt,[s("p",Jt,T(((C=l.task.customer)==null?void 0:C.phone)||"N/A"),1),(f=l.task.customer)!=null&&f.phone?(p(),_(e(M),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 shrink-0 text-muted-foreground hover:text-foreground",title:"Copy phone number",onClick:c[0]||(c[0]=P=>d(l.task.customer.phone,"phone"))},{default:i(()=>[t(e(At),{size:14})]),_:1})):D("",!0)])]),(k=l.task.customer)!=null&&k.address?(p(),h("div",Xt,[c[5]||(c[5]=s("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Address",-1)),s("p",el,T(l.task.customer.address),1)])):D("",!0)])])])}}},tl={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},ll={class:"mb-4"},sl={class:"flex items-center justify-between mb-2"},al={class:"flex items-center gap-2 flex-wrap"},ol={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},nl={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},rl={class:"relative"},il={class:"space-y-6 flex-1 flex flex-col min-h-0"},dl={key:0,class:"flex-1 overflow-y-auto min-h-0"},ul={class:"flex flex-col items-start gap-1 mb-4"},cl={class:"text-sm font-normal text-muted-foreground leading-normal"},fl={class:"space-y-4"},ml=["onClick"],pl={class:"flex-1 min-w-0"},vl={class:"flex items-start justify-between gap-2"},gl={class:"text-sm text-foreground flex-1 wrap-break-word min-w-0 leading-normal"},yl={key:0,class:"text-muted-foreground"},bl={key:1,class:"text-muted-foreground"},hl={key:2,class:"text-muted-foreground"},xl={key:3,class:"text-muted-foreground"},kl={key:4,class:"text-muted-foreground"},wl={key:5,class:"text-muted-foreground"},Cl={key:6,class:"text-muted-foreground"},Sl={class:"text-sm text-muted-foreground text-right shrink-0 w-14 leading-normal"},$l={key:0,class:"mt-2 bg-amber-50 rounded-lg p-4 backdrop-blur-sm"},Vl={class:"text-sm text-foreground wrap-break-word leading-normal"},Il={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},Tl={class:"text-sm text-foreground wrap-break-word leading-normal"},Al={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},Dl={class:"text-sm text-foreground wrap-break-word leading-normal"},Ml={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},Pl={class:"text-sm text-foreground wrap-break-word leading-normal"},Ll={key:0,class:"flex items-center gap-2 flex-wrap"},Fl={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},Ol={class:"text-center"},Ul={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(l,{emit:u}){const o=l,n=u,d=L(!1),v=L(!1),y=L(null),c=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],x=L([]),w=()=>{v.value=!v.value},m=O=>{v.value=!1;const A=x.value.indexOf(O);A>-1?x.value.splice(A,1):x.value.push(O)},C=O=>{const A=x.value.indexOf(O);A>-1&&x.value.splice(A,1)},f=O=>{const A=c.find(G=>G.value===O);return A?A.label:O},k=E(()=>c.map(O=>({key:O.value,label:O.label,onClick:()=>m(O.value),className:x.value.includes(O.value)?"filter-item-selected":""}))),P=O=>O.important||O.isImportant?"important":["email","sms","whatsapp","call"].includes(O.type)?"communications":O.type==="note"?"notes":O.type==="transcription"||O.transcription?"transcriptions":O.type==="system"||O.type==="created"||O.type==="status"?"system-updates":null,q=E(()=>{let O=[...o.activities];return x.value.length>0&&(O=O.filter(A=>{const G=P(A);return G&&x.value.includes(G)})),O.sort((A,G)=>{const S=new Date(A.timestamp||A.createdAt||0).getTime();return new Date(G.timestamp||G.createdAt||0).getTime()-S})}),Y=O=>{if(!O||O.length===0)return"";const A=O[0],G=A.timestamp||A.createdAt;if(!G)return"Recent Activity";const S=new Date(G),g=new Date,a=new Date(g);return a.setDate(a.getDate()-1),S.toDateString()===g.toDateString()?"Today":S.toDateString()===a.toDateString()?"Yesterday":S.toLocaleDateString("en-US",{month:"long",day:"numeric",year:S.getFullYear()!==g.getFullYear()?"numeric":void 0})},ee=O=>{["note","email","whatsapp"].includes(O.type)&&n("activity-click",O)},W=O=>{d.value=!1,n("add-activity",O)};return(O,A)=>{const G=Xe("click-outside");return p(),h("div",tl,[s("div",ll,[s("div",sl,[A[17]||(A[17]=s("h3",{class:"text-base font-medium text-foreground leading-6"},"Activity",-1)),s("div",al,[s("div",{class:"relative",ref_key:"filterContainer",ref:y},[t(e(M),{variant:"outline",size:"icon",onClick:Me(w,["stop"]),class:"relative w-8 h-8"},{default:i(()=>[A[8]||(A[8]=s("i",{class:"fa-solid fa-filter text-sm"},null,-1)),x.value.length>0?(p(),h("span",ol)):D("",!0)]),_:1}),t(nt,{name:"dropdown"},{default:i(()=>[v.value?Oe((p(),h("div",nl,[t(e(kt),{items:k.value,className:"w-56"},null,8,["items"])])),[[G,()=>v.value=!1]]):D("",!0)]),_:1})],512),s("div",rl,[t(e(M),{variant:"default",size:"icon",onClick:A[0]||(A[0]=Me(S=>d.value=!d.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:i(()=>[...A[9]||(A[9]=[s("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),d.value?Oe((p(),h("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1 z-50",onClick:A[7]||(A[7]=Me(()=>{},["stop"]))},[s("button",{onClick:A[1]||(A[1]=S=>W("email")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[10]||(A[10]=[s("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),b(" Email ",-1)])]),s("button",{onClick:A[2]||(A[2]=S=>W("sms")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[11]||(A[11]=[s("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),b(" SMS ",-1)])]),s("button",{onClick:A[3]||(A[3]=S=>W("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[12]||(A[12]=[s("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),b(" WhatsApp ",-1)])]),s("button",{onClick:A[4]||(A[4]=S=>W("call")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[13]||(A[13]=[s("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),b(" Call ",-1)])]),A[16]||(A[16]=s("div",{class:"border-t border-black/10 my-1"},null,-1)),s("button",{onClick:A[5]||(A[5]=S=>W("note")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[14]||(A[14]=[s("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),b(" Note ",-1)])]),s("button",{onClick:A[6]||(A[6]=S=>W("attachment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...A[15]||(A[15]=[s("i",{class:"fa-solid fa-paperclip text-sm text-muted-foreground"},null,-1),b(" Attachment ",-1)])])])),[[G,()=>d.value=!1]]):D("",!0)])])])]),s("div",il,[q.value.length>0?(p(),h("div",dl,[s("div",ul,[s("h3",cl,T(Y(q.value)),1)]),s("div",fl,[(p(!0),h(K,null,J(q.value,S=>(p(),h("div",{key:S.id,class:"space-y-2"},[s("div",{class:j(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":S.type==="note"||S.type==="email"||S.type==="whatsapp"}]),onClick:g=>ee(S)},[s("div",{class:j(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",S.type==="note"?"bg-orange-100":S.type==="call"?"bg-green-100":S.type==="ai-summary"?"bg-purple-100":S.type==="email"?"bg-blue-100":S.type==="whatsapp"?"bg-green-100":"bg-muted"])},[S.type==="note"?(p(),_(e(Ut),{key:0,size:16,class:"text-orange-600"})):S.type==="call"?(p(),_(e(Ot),{key:1,size:16,class:"text-green-600"})):S.type==="ai-summary"?(p(),_(e(et),{key:2,size:16,class:"text-purple-600"})):S.type==="email"?(p(),_(e(Pt),{key:3,size:16,class:"text-blue-600"})):S.type==="whatsapp"?(p(),_(e(Lt),{key:4,size:16,class:"text-green-600"})):(p(),_(e(Mt),{key:5,size:16,class:"text-foreground"}))],2),s("div",pl,[s("div",vl,[s("p",gl,[s("span",{class:j(["font-normal",S.type==="ai-summary"?"font-medium":""])},T(S.type==="ai-summary"?"MotorKAI":S.user),3),S.type==="note"?(p(),h("span",yl," added a note")):S.type==="created"?(p(),h("span",bl,T(S.message||S.action),1)):S.type==="call"?(p(),h("span",hl,T(" "+(S.message||S.action)),1)):S.type==="ai-summary"?(p(),h("span",xl," summary")):S.type==="email"?(p(),h("span",kl,T(" sent an email"))):S.type==="whatsapp"?(p(),h("span",wl,T(" sent a WhatsApp message"))):(p(),h("span",Cl,T(" "+(S.message||S.action)),1))]),s("p",Sl,T(S.time),1)]),S.type==="note"&&(S.message||S.content)?(p(),h("div",$l,[s("p",Vl,T(S.message||S.content),1)])):D("",!0),S.type==="email"&&S.content?(p(),h("div",Il,[s("p",Tl,T(S.content),1)])):D("",!0),S.type==="whatsapp"&&S.content?(p(),h("div",Al,[s("p",Dl,T(S.content),1)])):D("",!0),S.type==="ai-summary"&&(S.message||S.content)?(p(),h("div",Ml,[s("p",Pl,T(S.message||S.content),1)])):D("",!0)])],10,ml)]))),128)),x.value.length>0?(p(),h("div",Ll,[(p(!0),h(K,null,J(x.value,S=>(p(),h("div",{key:S,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-muted text-sm font-medium text-foreground border border-border"},[s("span",null,T(f(S)),1),t(e(M),{variant:"ghost",size:"icon",onClick:g=>C(S),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:i(()=>[...A[18]||(A[18]=[s("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):D("",!0)])])):(p(),h("div",Fl,[s("div",Ol,[t(e(tt),{size:32,class:"mx-auto text-muted-foreground mb-2"}),A[19]||(A[19]=s("p",{class:"text-sm text-muted-foreground"},"No activity yet",-1))])]))])])}}},Br=Je(Ul,[["__scopeId","data-v-8dec5396"]]),Rl={class:"overflow-hidden rounded-lg bg-white shadow-nsc-card p-4 flex flex-col w-full"},Nl={key:0,class:"space-y-1.5"},zl={class:"font-medium text-foreground"},Bl={key:0,class:"text-muted-foreground shrink-0 text-xs"},El={key:1,class:"text-sm text-muted-foreground py-2"},ql={class:"pt-3 mt-3 border-t border-border"},Er={__name:"TradeInsCard",props:{items:{type:Array,default:()=>[]}},emits:["open-add"],setup(l){function u(o){return o==null?"0":(typeof o=="string"?parseFloat(o):o).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}return(o,n)=>(p(),h("div",Rl,[n[2]||(n[2]=s("h3",{class:"text-base font-medium text-foreground leading-6 mb-4"},"Trade-ins",-1)),l.items.length?(p(),h("ul",Nl,[(p(!0),h(K,null,J(l.items,d=>(p(),h("li",{key:d.id,class:"flex items-center justify-between gap-2 py-1.5 px-2.5 rounded-lg border border-border bg-muted/50 text-sm"},[s("span",zl,T(d.label),1),d.valuation!=null?(p(),h("span",Bl,"â‚¬ "+T(u(d.valuation)),1)):D("",!0)]))),128))])):(p(),h("p",El,"No trade-ins added yet")),s("div",ql,[t(e(M),{variant:"outline",size:"sm",class:"w-full gap-2",onClick:n[0]||(n[0]=d=>o.$emit("open-add"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),n[1]||(n[1]=b(" Add trade-in ",-1))]),_:1})])]))}},jl={class:"overflow-hidden rounded-lg bg-white shadow-nsc-card p-4 flex flex-col w-full"},_l={key:0,class:"space-y-1.5"},Wl={class:"font-medium text-foreground"},Hl={key:0,class:"text-muted-foreground shrink-0 text-xs"},Ql={key:1,class:"text-sm text-muted-foreground py-2"},Yl={class:"pt-3 mt-3 border-t border-border"},qr={__name:"FinancingOptionsCard",props:{items:{type:Array,default:()=>[]}},emits:["open-add"],setup(l){return(u,o)=>(p(),h("div",jl,[o[2]||(o[2]=s("h3",{class:"text-base font-medium text-foreground leading-6 mb-4"},"Financing options",-1)),l.items.length?(p(),h("ul",_l,[(p(!0),h(K,null,J(l.items,n=>(p(),h("li",{key:n.id,class:"flex items-center justify-between gap-2 py-1.5 px-2.5 rounded-lg border border-border bg-muted/50 text-sm"},[s("span",Wl,T(n.label),1),n.termMonths?(p(),h("span",Hl,T(n.termMonths)+" months",1)):D("",!0)]))),128))])):(p(),h("p",Ql,"No financing options added yet")),s("div",Yl,[t(e(M),{variant:"outline",size:"sm",class:"w-full gap-2",onClick:o[0]||(o[0]=n=>u.$emit("open-add"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),o[1]||(o[1]=b(" Add financing option ",-1))]),_:1})])]))}},Gl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Kl={class:"space-y-2"},Zl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},Jl={key:1,class:"flex justify-between items-center mb-4"},Xl={class:"text-sm font-semibold text-foreground"},es={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},jr={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(l,{expose:u,emit:o}){const n=l,d=o,v=L(""),y=L(!1);Pe(()=>{n.item&&(v.value=n.item.content||n.item.message||"")}),ae(()=>n.item,m=>{m&&(v.value=m.content||m.message||"")},{deep:!0}),ae(()=>n.show,m=>{n.modal&&!m&&setTimeout(()=>{v.value=n.item&&(n.item.content||n.item.message)||"",y.value=!1},300)});const c=async()=>{var m,C;if(v.value.trim()){y.value=!0;try{const f={id:((m=n.item)==null?void 0:m.id)||Date.now(),type:"note",action:n.item?"updated a note":"added a note",content:v.value,message:v.value,timestamp:((C=n.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!n.item};d("save",f),n.modal&&d("close")}finally{y.value=!1}}},x=()=>{d("cancel"),n.modal&&d("close")},w=m=>{m||d("close")};return u({submit:c,canSubmit:()=>!!v.value.trim()}),(m,C)=>l.modal?(p(),_(e(be),{key:0,open:l.show,"onUpdate:open":w},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[b(T(l.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),s("div",Gl,[s("div",Kl,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...C[2]||(C[2]=[b(" Note ",-1),s("span",{class:"text-brand-red"},"*",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":C[0]||(C[0]=f=>v.value=f),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x}),t(e(M),{label:y.value?"Saving...":l.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value.trim()||y.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(p(),h("div",{key:1,class:j(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!l.hideHeader}])},[l.hideHeader?D("",!0):(p(),h("div",Zl)),l.hideHeader?D("",!0):(p(),h("div",Jl,[s("h5",Xl,T(l.item?"Edit Note":"Add Note"),1),s("button",{onClick:x,class:"text-muted-foreground hover:text-muted-foreground"},[...C[3]||(C[3]=[s("i",{class:"fa-solid fa-xmark"},null,-1)])])])),s("div",null,[C[4]||(C[4]=s("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Note",-1)),Oe(s("textarea",{"onUpdate:modelValue":C[1]||(C[1]=f=>v.value=f),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[rt,v.value]])]),l.hideActions?D("",!0):(p(),h("div",es,[t(e(M),{label:"Cancel",variant:"outline",size:"small",onClick:x}),t(e(M),{label:"Save",variant:"primary",size:"small",onClick:c})]))],2))}},ts={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ls={class:"space-y-2"},ss={class:"flex items-center gap-3"},as={key:0,class:"text-sm text-muted-foreground truncate"},os={key:1,class:"text-sm text-muted-foreground"},ns={key:1,class:"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6 animate-fade-in relative"},rs={class:"flex justify-between items-center mb-4"},is={class:"text-sm font-semibold text-foreground"},ds={class:"flex items-center gap-3"},us={key:0,class:"text-sm text-slate-600"},cs={key:1,class:"text-sm text-muted-foreground"},fs={class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},_r={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(l,{expose:u,emit:o}){const n=l,d=o,v=L(null),y=L(""),c=L(!1),x=L(null);Pe(()=>{n.item&&(y.value=n.item.fileName||"")}),ae(()=>n.item,k=>{k&&(y.value=k.fileName||"")},{deep:!0}),ae(()=>n.show,k=>{n.modal&&!k&&setTimeout(()=>{v.value=null,y.value=n.item&&n.item.fileName||"",c.value=!1},300)});const w=k=>{const P=k.target.files[0];P&&(v.value=P,y.value=P.name)},m=async()=>{var k,P;if(!(!v.value&&!n.item)){c.value=!0;try{const q={id:((k=n.item)==null?void 0:k.id)||Date.now(),type:"attachment",action:n.item?"updated an attachment":"added an attachment",fileName:y.value,file:v.value,timestamp:((P=n.item)==null?void 0:P.timestamp)||new Date().toISOString(),isEdit:!!n.item};d("save",q),n.modal&&d("close")}finally{c.value=!1}}},C=()=>{d("cancel"),n.modal&&d("close")},f=k=>{k||d("close")};return u({submit:m,canSubmit:()=>!!v.value||!!n.item}),(k,P)=>l.modal?(p(),_(e(be),{key:0,open:l.show,"onUpdate:open":f},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[b(T(l.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),s("div",ts,[s("div",ls,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...P[2]||(P[2]=[b(" File ",-1),s("span",{class:"text-brand-red"},"*",-1)])]),_:1}),s("div",ss,[s("input",{type:"file",onChange:w,ref_key:"fileInput",ref:x,class:"hidden"},null,544),t(e(M),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:P[0]||(P[0]=q=>{var Y;return(Y=x.value)==null?void 0:Y.click()})}),y.value?(p(),h("span",as,T(y.value),1)):(p(),h("span",os,"No file selected"))])])]),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:C}),t(e(M),{label:c.value?"Saving...":l.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value||c.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(p(),h("div",ns,[P[5]||(P[5]=s("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),s("div",rs,[s("h5",is,T(l.item?"Edit Attachment":"Add Attachment"),1),s("button",{onClick:C,class:"text-muted-foreground hover:text-muted-foreground"},[...P[3]||(P[3]=[s("i",{class:"fa-solid fa-xmark"},null,-1)])])]),s("div",null,[P[4]||(P[4]=s("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),s("div",ds,[s("input",{type:"file",onChange:w,ref_key:"fileInput",ref:x,class:"hidden"},null,544),t(e(M),{label:"Choose File",variant:"outline",size:"small",onClick:P[1]||(P[1]=q=>k.$refs.fileInput.click())}),y.value?(p(),h("span",us,T(y.value),1)):(p(),h("span",cs,"No file selected"))])]),s("div",fs,[t(e(M),{label:"Cancel",variant:"outline",size:"small",onClick:C}),t(e(M),{label:"Save",variant:"primary",size:"small",disabled:!v.value,onClick:m},null,8,["disabled"])])]))}},ms={class:"space-y-6"},ps={class:"space-y-2"},vs={class:"space-y-2"},gs={class:"flex justify-end gap-3"},ys={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:u}){const o=l,n=u,d=L(o.initialTemplate),v=L(o.initialMessage),y={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},c=()=>{d.value&&y[d.value]&&(v.value=y[d.value])},x=()=>{v.value.trim()&&n("send",{type:"whatsapp",template:d.value,message:v.value})};return(w,m)=>(p(),h("div",ms,[s("div",ps,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[3]||(m[3]=[b("Template",-1)])]),_:1}),t(e(de),{modelValue:d.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>d.value=C),c]},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select a template..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[b("Follow-up",-1)])]),_:1}),t(e(N),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[b("Meeting Confirmation",-1)])]),_:1}),t(e(N),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[b("Quote Proposal",-1)])]),_:1}),t(e(N),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[b("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",vs,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[8]||(m[8]=[b("Message",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),s("div",gs,[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>w.$emit("cancel"))}),t(e(M),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:x})])]))}},Wr={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:u}){const o=u,n=v=>{o("save",v),o("close")},d=v=>{v||o("close")};return(v,y)=>(p(),_(e(be),{open:l.show,"onUpdate:open":d},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[t(e(ge),null,{default:i(()=>[t(e(ye),null,{default:i(()=>[...y[1]||(y[1]=[b("Send WhatsApp Message",-1)])]),_:1})]),_:1}),t(ys,{onSend:n,onCancel:y[0]||(y[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},bs={class:"space-y-6"},hs={class:"space-y-2"},xs={class:"space-y-2"},ks={class:"text-xs text-muted-foreground mt-1"},ws={class:"flex justify-end gap-3"},Cs={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:u}){const o=l,n=u,d=L(o.initialTemplate),v=L(o.initialMessage),y={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},c=()=>{d.value&&y[d.value]&&(v.value=y[d.value])},x=()=>{v.value.trim()&&n("send",{type:"sms",template:d.value,message:v.value})};return(w,m)=>(p(),h("div",bs,[s("div",hs,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[3]||(m[3]=[b("Template",-1)])]),_:1}),t(e(de),{modelValue:d.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>d.value=C),c]},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select a template..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[b("Follow-up",-1)])]),_:1}),t(e(N),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[b("Meeting Confirmation",-1)])]),_:1}),t(e(N),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[b("Quote Proposal",-1)])]),_:1}),t(e(N),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[b("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",xs,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[8]||(m[8]=[b("Message",-1)])]),_:1}),t(e(Te),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),s("p",ks,T(v.value.length)+"/160 characters",1)]),s("div",ws,[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>w.$emit("cancel"))}),t(e(M),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:x})])]))}},Hr={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:u}){const o=u,n=v=>{o("save",v),o("close")},d=v=>{v||o("close")};return(v,y)=>(p(),_(e(be),{open:l.show,"onUpdate:open":d},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[t(e(ge),null,{default:i(()=>[t(e(ye),null,{default:i(()=>[...y[1]||(y[1]=[b("Send SMS",-1)])]),_:1})]),_:1}),t(Cs,{onSend:n,onCancel:y[0]||(y[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ss={class:"space-y-6"},$s={class:"space-y-2"},Vs={class:"space-y-2"},Is={class:"space-y-2"},Ts={class:"flex justify-end gap-3"},As={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:u}){const o=l,n=u,d=L(o.initialTemplate),v=L(""),y=L(o.initialMessage),c={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},x=()=>{d.value&&c[d.value]&&(v.value=c[d.value].subject,y.value=c[d.value].message)},w=()=>{y.value.trim()&&n("send",{type:"email",template:d.value,subject:v.value,message:y.value})};return(m,C)=>(p(),h("div",Ss,[s("div",$s,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...C[4]||(C[4]=[b("Template",-1)])]),_:1}),t(e(de),{modelValue:d.value,"onUpdate:modelValue":[C[0]||(C[0]=f=>d.value=f),x]},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select a template..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Follow-up"},{default:i(()=>[...C[5]||(C[5]=[b("Follow-up",-1)])]),_:1}),t(e(N),{value:"Meeting Confirmation"},{default:i(()=>[...C[6]||(C[6]=[b("Meeting Confirmation",-1)])]),_:1}),t(e(N),{value:"Quote Proposal"},{default:i(()=>[...C[7]||(C[7]=[b("Quote Proposal",-1)])]),_:1}),t(e(N),{value:"Unable to Reach"},{default:i(()=>[...C[8]||(C[8]=[b("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Vs,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...C[9]||(C[9]=[b("Subject",-1)])]),_:1}),t(e(F),{modelValue:v.value,"onUpdate:modelValue":C[1]||(C[1]=f=>v.value=f),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),s("div",Is,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...C[10]||(C[10]=[b("Message",-1)])]),_:1}),t(e(Te),{modelValue:y.value,"onUpdate:modelValue":C[2]||(C[2]=f=>y.value=f),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),s("div",Ts,[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:C[3]||(C[3]=f=>m.$emit("cancel"))}),t(e(M),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:w})])]))}},Qr={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:u}){const o=u,n=v=>{o("save",v),o("close")},d=v=>{v||o("close")};return(v,y)=>(p(),_(e(be),{open:l.show,"onUpdate:open":d},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[t(e(ge),null,{default:i(()=>[t(e(ye),null,{default:i(()=>[...y[1]||(y[1]=[b("Send Email",-1)])]),_:1})]),_:1}),t(As,{onSend:n,onCancel:y[0]||(y[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Yr={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(l,{emit:u}){const o=u,n=v=>{v||o("close")},d=()=>{o("close")};return(v,y)=>(p(),_(e(be),{open:l.show,"onUpdate:open":n},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[b(T(l.title),1)]),_:1})]),_:1}),y[0]||(y[0]=s("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[s("div",{class:"flex items-center justify-center w-full"},[s("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class Ds extends it{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(u={}){await new Promise(n=>setTimeout(n,300));let o=[...this.dataSource];return u.leadId!==void 0&&(o=o.filter(n=>n.leadId===parseInt(u.leadId))),u.opportunityId!==void 0&&(o=o.filter(n=>n.opportunityId===parseInt(u.opportunityId))),u.type&&(o=o.filter(n=>n.type===u.type)),u.offerId!==void 0&&(o=o.filter(n=>n.offerId===parseInt(u.offerId))),u.vehicleId!==void 0&&(o=o.filter(n=>n.vehicleId===parseInt(u.vehicleId))),o}async findAllByLeadId(u){return this.findAll({leadId:u})}async findAllByOpportunityId(u){return this.findAll({opportunityId:u})}async findById(u){return await new Promise(n=>setTimeout(n,300)),this.dataSource.find(n=>n.id===parseInt(u))||null}async create(u){await new Promise(d=>setTimeout(d,300));const n={id:this.dataSource.length>0?Math.max(...this.dataSource.map(d=>d.id))+1:1,type:u.type,leadId:u.leadId!==void 0?parseInt(u.leadId):void 0,opportunityId:u.opportunityId!==void 0?parseInt(u.opportunityId):void 0,offerId:u.offerId!==void 0?parseInt(u.offerId):void 0,vehicleId:u.vehicleId!==void 0?parseInt(u.vehicleId):void 0,fields:u.fields||{},currency:u.currency||"EUR",offerValidFrom:u.offerValidFrom||null,offerValidTo:u.offerValidTo||null,status:u.status||"active",createdAt:u.createdAt||new Date().toISOString(),createdBy:u.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(n),n}async update(u,o){await new Promise(d=>setTimeout(d,300));const n=this.dataSource.find(d=>d.id===parseInt(u));if(!n)throw new Error("Purchase method not found");return Object.assign(n,o,{updatedAt:new Date().toISOString()}),n}async delete(u){await new Promise(n=>setTimeout(n,300));const o=this.dataSource.findIndex(n=>n.id===parseInt(u));if(o===-1)throw new Error("Purchase method not found");return this.dataSource.splice(o,1),{success:!0}}}class Ms{constructor(){this.repository=new Ds}calculateTotal(u){const{type:o,fields:n}=u;if(!n)return 0;const d=parseFloat(n.monthlyInstalment)||0,v=parseFloat(n.downPayment)||0,y=parseInt(n.duration)||0;switch(o){case"FIN":return d*y+v;case"LEA":const c=parseFloat(n.finalInstalment)||0;return d*y+v+c;case"LTR":return d*y+v;default:return 0}}validate(u){const o=[],{type:n,fields:d}=u;if((!n||!["FIN","LEA","LTR"].includes(n))&&o.push("Purchase method type is required and must be FIN, LEA, or LTR"),!d)return o.push("Purchase method fields are required"),{isValid:!1,errors:o};const v=parseFloat(d.monthlyInstalment);(!v||v<=0)&&o.push("Monthly Instalment must be greater than 0");const y=parseFloat(d.downPayment);(y==null||y<0)&&o.push("Down Payment must be greater than or equal to 0");const c=parseInt(d.duration);if((!c||c<12||c>60)&&o.push("Duration must be between 12 and 60 months"),n==="FIN"){const x=parseFloat(d.interestRate);x!=null&&(x<0||x>99.99)&&o.push("Interest Rate must be between 0 and 99.99%");const w=parseFloat(d.effectiveInterestRate);w!=null&&(w<0||w>99.99)&&o.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(n==="LEA"){const x=parseFloat(d.mileageLimit);x!=null&&x<=0&&o.push("Mileage Limit must be greater than 0 if provided");const w=parseFloat(d.finalInstalment);w!=null&&w<0&&o.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(d.interestRate);m!=null&&(m<0||m>99.99)&&o.push("Interest Rate must be between 0 and 99.99%")}if(n==="LTR"){const x=parseFloat(d.mileageLimit);x!=null&&x<=0&&o.push("Mileage Limit must be greater than 0 if provided"),(!d.customerType||!["Private","Business","Fleet"].includes(d.customerType))&&o.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:o.length===0,errors:o}}async findAll(u={}){return await this.repository.findAll(u)}async findById(u){return await this.repository.findById(u)}async create(u){const o=this.validate(u);if(!o.isValid)throw new Error(`Validation failed: ${o.errors.join(", ")}`);const n=await this.repository.create(u),d=this.calculateTotal(n);return n.fields={...n.fields,totalAmount:d},await this.repository.update(n.id,{fields:n.fields})}async update(u,o){const n=await this.repository.findById(u);if(!n)throw new Error("Purchase method not found");const d={...n,...o,fields:{...n.fields,...o.fields}},v=this.validate(d);if(!v.isValid)throw new Error(`Validation failed: ${v.errors.join(", ")}`);const y=this.calculateTotal(d);return d.fields.totalAmount=y,await this.repository.update(u,{...o,fields:d.fields})}async delete(u){return await this.repository.delete(u)}}const Fe=new Ms,Ue=(l=300)=>new Promise(u=>setTimeout(u,l)),Ps=async(l={})=>(await Ue(),await Fe.findAll(l)),Ls=async l=>(await Ue(),await Fe.findById(l)),Fs=async l=>(await Ue(),await Fe.create(l)),Os=async(l,u)=>(await Ue(),await Fe.update(l,u)),Us=async l=>(await Ue(),await Fe.delete(l)),Rs=dt("purchaseMethods",()=>{const l=L([]),u=L(null),o=L(!1),n=L(null),d=E(()=>f=>l.value.filter(k=>k.type===f)),v=E(()=>f=>l.value.filter(k=>k.leadId===parseInt(f))),y=E(()=>f=>l.value.filter(k=>k.opportunityId===parseInt(f)));return{purchaseMethods:l,currentPurchaseMethod:u,loading:o,error:n,purchaseMethodsByType:d,purchaseMethodsByLead:v,purchaseMethodsByOpportunity:y,fetchPurchaseMethods:async(f={})=>{o.value=!0,n.value=null;try{const k=await Ps(f);return l.value=k,k}catch(k){throw n.value=k.message,k}finally{o.value=!1}},fetchPurchaseMethodById:async f=>{o.value=!0,n.value=null;try{return u.value=await Ls(f),u.value}catch(k){throw n.value=k.message,k}finally{o.value=!1}},createPurchaseMethod:async f=>{o.value=!0,n.value=null;try{const k=await Fs(f);return l.value.push(k),k}catch(k){throw n.value=k.message,k}finally{o.value=!1}},updatePurchaseMethod:async(f,k)=>{var P;o.value=!0,n.value=null;try{const q=await Os(f,k),Y=l.value.findIndex(ee=>ee.id===f);return Y!==-1&&(l.value[Y]=q),((P=u.value)==null?void 0:P.id)===f&&(u.value=q),q}catch(q){throw n.value=q.message,q}finally{o.value=!1}},deletePurchaseMethod:async f=>{var k;o.value=!0,n.value=null;try{await Us(f),l.value=l.value.filter(P=>P.id!==f),((k=u.value)==null?void 0:k.id)===f&&(u.value=null)}catch(P){throw n.value=P.message,P}finally{o.value=!1}}}}),Ns={class:"flex-1 overflow-y-auto py-4 w-full space-y-6"},zs={class:"space-y-2"},Bs={class:"space-y-3"},Es=["value"],qs={class:"text-sm font-medium text-foreground"},js={key:0,class:"space-y-4"},_s={class:"text-base font-medium text-foreground"},Ws={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Hs={class:"space-y-2"},Qs={class:"relative"},Ys={key:0,class:"text-xs text-destructive"},Gs={class:"space-y-2"},Ks={class:"relative"},Zs={key:0,class:"text-xs text-destructive"},Js={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xs={class:"space-y-2"},ea={key:0,class:"text-xs text-destructive"},ta={class:"space-y-2"},la={key:0,class:"text-xs text-destructive"},sa={class:"space-y-2"},aa={key:0,class:"text-xs text-destructive"},oa={class:"bg-muted p-4 rounded-lg border border-border"},na={class:"flex justify-between items-center"},ra={class:"text-lg font-bold text-foreground"},ia={class:"flex flex-col gap-3"},da={class:"flex items-center gap-2"},ua={class:"flex items-center gap-2"},ca={class:"flex items-center gap-2"},fa={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-border"},ma={class:"space-y-2"},pa={class:"space-y-2"},va={key:1,class:"bg-destructive/10 border border-border rounded-lg p-4"},ga={class:"list-disc list-inside text-sm text-foreground space-y-1"},ya={key:0},ba={key:1},Gr={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:l=>["lead","opportunity"].includes(l)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(l,{emit:u}){const o=l,n=u,d=Rs(),v=ut(),y=L(!1),c=L({}),x=L([]),w=[{value:"FIN",label:"Financing"},{value:"LEA",label:"Leasing"},{value:"LTR",label:"Long-Term Rental"}],m=L({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),C=E(()=>!!o.purchaseMethod);E(()=>{if(m.value.type!=="LEA")return 0;const S=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,a=parseFloat(m.value.fields.downPayment)||0,Q=parseFloat(m.value.fields.finalInstalment)||0;return S*g+a+Q});const f=E(()=>{if(m.value.type!=="LTR")return 0;const S=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,a=parseFloat(m.value.fields.downPayment)||0;return S*g+a}),k=S=>S==="FIN"?[12,24,36,48,60]:S==="LEA"?[24,36,48,60]:S==="LTR"?[12,24,36,48,60]:[],P=S=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[S]||S,q=S=>{const g=m.value.fields[S];switch(S){case"monthlyInstalment":!g||g<=0?c.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete c.value.monthlyInstalment;break;case"downPayment":g==null||g<0?c.value.downPayment="Down Payment must be greater than or equal to 0":delete c.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!g||g<12||g>60)?c.value.duration="Duration must be between 12 and 60 months":delete c.value.duration;break;case"customerType":m.value.type==="LTR"&&(!g||!["Private","Business","Fleet"].includes(g))?c.value.customerType="Customer Type is required":delete c.value.customerType;break}},Y=S=>{delete c.value[S]},ee=()=>{x.value=[],c.value={};const S=Fe.validate({type:m.value.type,fields:m.value.fields});return S.isValid||(x.value=S.errors,S.errors.forEach(g=>{g.includes("Monthly Instalment")?c.value.monthlyInstalment=g:g.includes("Down Payment")?c.value.downPayment=g:g.includes("Duration")?c.value.duration=g:g.includes("Customer Type")&&(c.value.customerType=g)})),S.isValid},W=E(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(c.value).length===0),O=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),c.value={},x.value=[]},A=async()=>{var S;if(ee()){y.value=!0;try{const g={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((S=v.currentUser)==null?void 0:S.id)||null};o.taskType==="lead"?g.leadId=parseInt(o.taskId):o.taskType==="opportunity"&&(g.opportunityId=parseInt(o.taskId)),o.vehicleId&&(g.vehicleId=parseInt(o.vehicleId)),o.offerId&&(g.offerId=parseInt(o.offerId));let a;C.value?a=await d.updatePurchaseMethod(o.purchaseMethod.id,g):a=await d.createPurchaseMethod(g);const Q=P(a.type),z=Ge(a.fields.monthlyInstalment||0);n("save",{...a,successMessage:`Purchase Method Added: ${Q} - â‚¬${z}/month`}),n("close")}catch(g){x.value=[g.message||"Failed to save purchase method"]}finally{y.value=!1}}},G=S=>{S||n("close")};return Pe(()=>{o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null})}),ae(()=>o.show,S=>{S?o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},c.value={},x.value=[],y.value=!1},300)}),(S,g)=>(p(),_(e(be),{open:l.show,"onUpdate:open":G},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[b(T(C.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),s("div",Ns,[s("div",zs,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[19]||(g[19]=[b("Purchase Method Type",-1)])]),_:1}),s("div",Bs,[(p(),h(K,null,J(w,a=>s("label",{key:a.value,class:"flex items-center gap-2 cursor-pointer"},[Oe(s("input",{type:"radio",value:a.value,"onUpdate:modelValue":g[0]||(g[0]=Q=>m.value.type=Q),class:"size-4 rounded-full border-2 border-border bg-background text-primary focus:ring-primary focus:ring-offset-0",onChange:O},null,40,Es),[[ct,m.value.type]]),s("span",qs,T(a.label),1)])),64))])]),m.value.type?(p(),h("div",js,[s("h3",_s,T(P(m.value.type))+" Details ",1),s("div",Ws,[s("div",Hs,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[20]||(g[20]=[b("Monthly Instalment ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),s("div",Qs,[g[21]||(g[21]=s("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"â‚¬",-1)),t(e(F),{modelValue:m.value.fields.monthlyInstalment,"onUpdate:modelValue":g[1]||(g[1]=a=>m.value.fields.monthlyInstalment=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["w-full pl-8",{"border-destructive":c.value.monthlyInstalment}]),onInput:g[2]||(g[2]=a=>Y("monthlyInstalment")),onBlur:g[3]||(g[3]=a=>q("monthlyInstalment"))},null,8,["modelValue","class"])]),c.value.monthlyInstalment?(p(),h("p",Ys,T(c.value.monthlyInstalment),1)):D("",!0),g[22]||(g[22]=s("p",{class:"text-xs text-muted-foreground"},"Customer's desired monthly payment amount",-1))]),s("div",Gs,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[23]||(g[23]=[b("Down Payment ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),s("div",Ks,[g[24]||(g[24]=s("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"â‚¬",-1)),t(e(F),{modelValue:m.value.fields.downPayment,"onUpdate:modelValue":g[4]||(g[4]=a=>m.value.fields.downPayment=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["w-full pl-8",{"border-destructive":c.value.downPayment}]),onInput:g[5]||(g[5]=a=>Y("downPayment")),onBlur:g[6]||(g[6]=a=>q("downPayment"))},null,8,["modelValue","class"])]),c.value.downPayment?(p(),h("p",Zs,T(c.value.downPayment),1)):D("",!0),g[25]||(g[25]=s("p",{class:"text-xs text-muted-foreground"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(p(),h(K,{key:0},[s("div",Js,[s("div",Xs,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[26]||(g[26]=[b("Duration (months) ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(de),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[g[7]||(g[7]=a=>m.value.fields.duration=a),g[8]||(g[8]=a=>Y("duration"))]},{default:i(()=>[t(e(ne),{class:j(["w-full",{"border-destructive":c.value.duration}])},{default:i(()=>[t(e(re),{placeholder:"Select duration..."})]),_:1},8,["class"]),t(e(ie),null,{default:i(()=>[(p(!0),h(K,null,J(k(m.value.type),a=>(p(),_(e(N),{key:a,value:a},{default:i(()=>[b(T(a)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c.value.duration?(p(),h("p",ea,T(c.value.duration),1)):D("",!0)]),s("div",ta,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[27]||(g[27]=[b("Unlock Kilometers",-1)])]),_:1}),t(e(F),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":g[9]||(g[9]=a=>m.value.fields.mileageLimit=a),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:j(["w-full",{"border-destructive":c.value.mileageLimit}]),onInput:g[10]||(g[10]=a=>Y("mileageLimit"))},null,8,["modelValue","class"]),c.value.mileageLimit?(p(),h("p",la,T(c.value.mileageLimit),1)):D("",!0)])]),s("div",sa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[28]||(g[28]=[b("Customer Type ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(de),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[g[11]||(g[11]=a=>m.value.fields.customerType=a),g[12]||(g[12]=a=>Y("customerType"))]},{default:i(()=>[t(e(ne),{class:j(["w-full",{"border-destructive":c.value.customerType}])},{default:i(()=>[t(e(re),{placeholder:"Select customer type..."})]),_:1},8,["class"]),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Private"},{default:i(()=>[...g[29]||(g[29]=[b("Private",-1)])]),_:1}),t(e(N),{value:"Business"},{default:i(()=>[...g[30]||(g[30]=[b("Business",-1)])]),_:1}),t(e(N),{value:"Fleet"},{default:i(()=>[...g[31]||(g[31]=[b("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value.customerType?(p(),h("p",aa,T(c.value.customerType),1)):D("",!0)]),s("div",oa,[s("div",na,[g[32]||(g[32]=s("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),s("span",ra,"â‚¬ "+T(e(Ge)(f.value)),1)]),g[33]||(g[33]=s("p",{class:"text-xs text-muted-foreground mt-1"},"(Monthly Ã— Duration + Down Payment)",-1))]),s("div",ia,[s("div",da,[t(e($e),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":g[13]||(g[13]=a=>m.value.fields.insuranceIncluded=a)},null,8,["checked"]),t(e(V),{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...g[34]||(g[34]=[b("Insurance Included",-1)])]),_:1})]),s("div",ua,[t(e($e),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":g[14]||(g[14]=a=>m.value.fields.maintenanceIncluded=a)},null,8,["checked"]),t(e(V),{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...g[35]||(g[35]=[b("Maintenance Included",-1)])]),_:1})]),s("div",ca,[t(e($e),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":g[15]||(g[15]=a=>m.value.fields.registrationTaxesIncluded=a)},null,8,["checked"]),t(e(V),{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...g[36]||(g[36]=[b("Registration/Taxes Included",-1)])]),_:1})])])],64)):D("",!0),s("div",fa,[s("div",ma,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[37]||(g[37]=[b("Offer Valid From",-1)])]),_:1}),t(e(F),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":g[16]||(g[16]=a=>m.value.offerValidFrom=a),type:"date",class:"w-full"},null,8,["modelValue"])]),s("div",pa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...g[38]||(g[38]=[b("Offer Valid To",-1)])]),_:1}),t(e(F),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":g[17]||(g[17]=a=>m.value.offerValidTo=a),type:"date",class:"w-full"},null,8,["modelValue"])])])])):D("",!0),x.value.length>0?(p(),h("div",va,[g[39]||(g[39]=s("h4",{class:"text-sm font-medium text-destructive mb-2"},"Please fix the following errors:",-1)),s("ul",ga,[(p(!0),h(K,null,J(x.value,a=>(p(),h("li",{key:a},T(a),1))),128))])])):D("",!0)]),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",onClick:g[18]||(g[18]=a=>S.$emit("close"))}),t(e(M),{variant:"default",size:"small",disabled:!W.value||y.value,onClick:A},{default:i(()=>[y.value?(p(),h("span",ya,"Saving...")):(p(),h("span",ba,T(C.value?"Update":"Save"),1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ha={class:"flex-1 overflow-y-auto py-4 w-full"},xa={key:0,class:"space-y-4 py-4 w-full"},ka={class:"grid grid-cols-1 gap-3"},wa={key:1,class:"space-y-6 w-full"},Ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Sa={class:"space-y-2"},$a={class:"space-y-2"},Va={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ia={class:"space-y-2"},Ta={class:"space-y-2"},Aa={class:"space-y-2"},Da={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ma={class:"space-y-2"},Pa={class:"space-y-2"},La={class:"space-y-2"},Fa={class:"space-y-2"},Oa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ua={class:"space-y-2"},Ra={class:"space-y-2"},Na={class:"space-y-2"},za={class:"space-y-2"},Ba={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ea={class:"space-y-2"},qa={class:"space-y-2"},ja={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},_a={class:"space-y-2"},Wa={class:"space-y-2"},Ha={class:"space-y-2"},Qa={class:"space-y-2"},Ya={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ga={class:"space-y-2"},Ka={class:"space-y-2"},Za={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ja={class:"space-y-2"},Xa={class:"space-y-2"},Kr={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:l=>["vehicle","tradein"].includes(l)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(l,{emit:u}){const o=l,n=u,d=L(o.mode==="tradein"?"tradein":null);ae(()=>o.mode,C=>{C==="tradein"?d.value="tradein":o.item||(d.value=null)});const v=E(()=>o.mode==="tradein"||d.value==="tradein"),y=()=>o.mode==="tradein"||d.value==="tradein"?"Add Trade-In Vehicle":d.value==="drove"?"Add Drove Vehicle":d.value==="requested"?"Add Requested Vehicle":"Add Vehicle",c=L({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null,valuation:null});Pe(()=>{o.item&&o.item.data&&(c.value={brand:o.item.data.brand||"",model:o.item.data.model||"",year:o.item.data.year||"",version:o.item.data.version||"",vin:o.item.data.vin||"",plates:o.item.data.plate||o.item.data.plates||"",fuelType:o.item.data.fuelType||"",gearType:o.item.data.gearType||"",kilometers:o.item.data.km||o.item.data.kilometers||"",registration:o.item.data.date||o.item.data.registration||"",owner:o.item.data.owner||"",ownershipType:o.item.data.ownershipType||"",ownedSince:o.item.data.ownedSince||"",warrantyInfo:o.item.data.warrantyInfo||"",note:o.item.data.note||"",stockDays:null,valuation:o.item.data.tradeInPrice??null})}),ae(()=>o.show,C=>{C||(d.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null,valuation:null})});const x=E(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),w=C=>{C||n("close")},m=()=>{if(!x.value)return;const C={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,note:c.value.note||null,stockDays:null,status:"Available"}};if(d.value&&(C.vehicleType=d.value),v.value){const f=c.value.valuation;C.valuation={tradeInPrice:f!=null&&f!==""?Number(f):null}}o.item&&(C.id=o.item.id,C.isEdit=!0,C.timestamp=o.item.timestamp||new Date().toISOString()),n("save",C)};return(C,f)=>(p(),_(e(be),{open:l.show,"onUpdate:open":w},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0"},{default:i(()=>[t(e(ye),null,{default:i(()=>[b(T(y()),1)]),_:1})]),_:1}),s("div",ha,[l.mode==="vehicle"&&!l.item&&!d.value?(p(),h("div",xa,[f[27]||(f[27]=s("p",{class:"text-muted-foreground text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),s("div",ka,[t(e(M),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[0]||(f[0]=k=>d.value="drove")}),t(e(M),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[1]||(f[1]=k=>d.value="requested")}),t(e(M),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start",onClick:f[2]||(f[2]=k=>d.value="tradein")})])])):(p(),h("div",wa,[v.value?(p(),h(K,{key:0},[s("div",Ca,[s("div",Sa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[28]||(f[28]=[b("Brand ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(F),{modelValue:c.value.brand,"onUpdate:modelValue":f[3]||(f[3]=k=>c.value.brand=k),type:"text",placeholder:"e.g., Volkswagen",class:"w-full",required:""},null,8,["modelValue"])]),s("div",$a,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[29]||(f[29]=[b("Model ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(F),{modelValue:c.value.model,"onUpdate:modelValue":f[4]||(f[4]=k=>c.value.model=k),type:"text",placeholder:"e.g., ID.4",class:"w-full",required:""},null,8,["modelValue"])])]),s("div",Va,[s("div",Ia,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[30]||(f[30]=[b("Year (or registration year) ",-1),s("span",{class:"text-muted-foreground"},"*",-1)])]),_:1}),t(e(F),{modelValue:c.value.year,"onUpdate:modelValue":f[5]||(f[5]=k=>c.value.year=k),type:"number",placeholder:"e.g., 2024",class:"w-full",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),s("div",Ta,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[31]||(f[31]=[b("Kilometers",-1)])]),_:1}),t(e(F),{modelValue:c.value.kilometers,"onUpdate:modelValue":f[6]||(f[6]=k=>c.value.kilometers=k),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full",min:"0"},null,8,["modelValue"])])]),s("div",Aa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[32]||(f[32]=[b("Valuation (â‚¬)",-1)])]),_:1}),t(e(F),{modelValue:c.value.valuation,"onUpdate:modelValue":f[7]||(f[7]=k=>c.value.valuation=k),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full",min:"0",step:"1"},null,8,["modelValue"])]),s("div",Da,[s("div",Ma,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[33]||(f[33]=[b("Fuel Type",-1)])]),_:1}),t(e(de),{modelValue:c.value.fuelType,"onUpdate:modelValue":f[8]||(f[8]=k=>c.value.fuelType=k)},{default:i(()=>[t(e(ne),{class:"w-full"},{default:i(()=>[t(e(re),{placeholder:"Select fuel type..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Petrol"},{default:i(()=>[...f[34]||(f[34]=[b("Petrol",-1)])]),_:1}),t(e(N),{value:"Diesel"},{default:i(()=>[...f[35]||(f[35]=[b("Diesel",-1)])]),_:1}),t(e(N),{value:"Electric"},{default:i(()=>[...f[36]||(f[36]=[b("Electric",-1)])]),_:1}),t(e(N),{value:"Hybrid"},{default:i(()=>[...f[37]||(f[37]=[b("Hybrid",-1)])]),_:1}),t(e(N),{value:"Plug-in Hybrid"},{default:i(()=>[...f[38]||(f[38]=[b("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Pa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[39]||(f[39]=[b("Gear Type",-1)])]),_:1}),t(e(de),{modelValue:c.value.gearType,"onUpdate:modelValue":f[9]||(f[9]=k=>c.value.gearType=k)},{default:i(()=>[t(e(ne),{class:"w-full"},{default:i(()=>[t(e(re),{placeholder:"Select gear type..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Manual"},{default:i(()=>[...f[40]||(f[40]=[b("Manual",-1)])]),_:1}),t(e(N),{value:"Automatic"},{default:i(()=>[...f[41]||(f[41]=[b("Automatic",-1)])]),_:1}),t(e(N),{value:"CVT"},{default:i(()=>[...f[42]||(f[42]=[b("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",La,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[43]||(f[43]=[b("Plates",-1)])]),_:1}),t(e(F),{modelValue:c.value.plates,"onUpdate:modelValue":f[10]||(f[10]=k=>c.value.plates=k),type:"text",placeholder:"License plate number",class:"w-full"},null,8,["modelValue"]),f[44]||(f[44]=s("p",{class:"text-xs text-muted-foreground mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),s("div",Fa,[t(e(V),{class:"block text-sm font-medium text-foreground"},{default:i(()=>[...f[45]||(f[45]=[b("Note",-1)])]),_:1}),t(e(Te),{modelValue:c.value.note,"onUpdate:modelValue":f[11]||(f[11]=k=>c.value.note=k),rows:"3",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full resize-none"},null,8,["modelValue"])])],64)):(p(),h(K,{key:1},[s("div",Oa,[s("div",Ua,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[46]||(f[46]=[b("Brand",-1)])]),_:1}),t(e(F),{modelValue:c.value.brand,"onUpdate:modelValue":f[12]||(f[12]=k=>c.value.brand=k),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),s("div",Ra,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[47]||(f[47]=[b("Model",-1)])]),_:1}),t(e(F),{modelValue:c.value.model,"onUpdate:modelValue":f[13]||(f[13]=k=>c.value.model=k),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),s("div",Na,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[48]||(f[48]=[b("Year",-1)])]),_:1}),t(e(F),{modelValue:c.value.year,"onUpdate:modelValue":f[14]||(f[14]=k=>c.value.year=k),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),s("div",za,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[49]||(f[49]=[b("Version/Trim",-1)])]),_:1}),t(e(F),{modelValue:c.value.version,"onUpdate:modelValue":f[15]||(f[15]=k=>c.value.version=k),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),s("div",Ba,[s("div",Ea,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[50]||(f[50]=[b("VIN",-1)])]),_:1}),t(e(F),{modelValue:c.value.vin,"onUpdate:modelValue":f[16]||(f[16]=k=>c.value.vin=k),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),s("div",qa,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[51]||(f[51]=[b("Plates",-1)])]),_:1}),t(e(F),{modelValue:c.value.plates,"onUpdate:modelValue":f[17]||(f[17]=k=>c.value.plates=k),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),s("div",ja,[s("div",_a,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[52]||(f[52]=[b("Fuel Type",-1)])]),_:1}),t(e(de),{modelValue:c.value.fuelType,"onUpdate:modelValue":f[18]||(f[18]=k=>c.value.fuelType=k)},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select fuel type..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Petrol"},{default:i(()=>[...f[53]||(f[53]=[b("Petrol",-1)])]),_:1}),t(e(N),{value:"Diesel"},{default:i(()=>[...f[54]||(f[54]=[b("Diesel",-1)])]),_:1}),t(e(N),{value:"Electric"},{default:i(()=>[...f[55]||(f[55]=[b("Electric",-1)])]),_:1}),t(e(N),{value:"Hybrid"},{default:i(()=>[...f[56]||(f[56]=[b("Hybrid",-1)])]),_:1}),t(e(N),{value:"Plug-in Hybrid"},{default:i(()=>[...f[57]||(f[57]=[b("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Wa,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[58]||(f[58]=[b("Gear Type",-1)])]),_:1}),t(e(de),{modelValue:c.value.gearType,"onUpdate:modelValue":f[19]||(f[19]=k=>c.value.gearType=k)},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select gear type..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Manual"},{default:i(()=>[...f[59]||(f[59]=[b("Manual",-1)])]),_:1}),t(e(N),{value:"Automatic"},{default:i(()=>[...f[60]||(f[60]=[b("Automatic",-1)])]),_:1}),t(e(N),{value:"CVT"},{default:i(()=>[...f[61]||(f[61]=[b("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Ha,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[62]||(f[62]=[b("Mileage (km)",-1)])]),_:1}),t(e(F),{modelValue:c.value.kilometers,"onUpdate:modelValue":f[20]||(f[20]=k=>c.value.kilometers=k),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),s("div",Qa,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[63]||(f[63]=[b("Registration Year/Month",-1)])]),_:1}),t(e(F),{modelValue:c.value.registration,"onUpdate:modelValue":f[21]||(f[21]=k=>c.value.registration=k),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),s("div",Ya,[s("div",Ga,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[64]||(f[64]=[b("Owned Since",-1)])]),_:1}),t(e(F),{modelValue:c.value.ownedSince,"onUpdate:modelValue":f[22]||(f[22]=k=>c.value.ownedSince=k),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),s("div",Ka,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[65]||(f[65]=[b("Owner",-1)])]),_:1}),t(e(F),{modelValue:c.value.owner,"onUpdate:modelValue":f[23]||(f[23]=k=>c.value.owner=k),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),s("div",Za,[s("div",Ja,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[66]||(f[66]=[b("Ownership Type",-1)])]),_:1}),t(e(de),{modelValue:c.value.ownershipType,"onUpdate:modelValue":f[24]||(f[24]=k=>c.value.ownershipType=k)},{default:i(()=>[t(e(ne),{class:"w-full h-10"},{default:i(()=>[t(e(re),{placeholder:"Select ownership type..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Private"},{default:i(()=>[...f[67]||(f[67]=[b("Private",-1)])]),_:1}),t(e(N),{value:"Company"},{default:i(()=>[...f[68]||(f[68]=[b("Company",-1)])]),_:1}),t(e(N),{value:"Lease"},{default:i(()=>[...f[69]||(f[69]=[b("Lease",-1)])]),_:1}),t(e(N),{value:"Fleet"},{default:i(()=>[...f[70]||(f[70]=[b("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Xa,[t(e(V),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...f[71]||(f[71]=[b("Warranty Info",-1)])]),_:1}),t(e(Te),{modelValue:c.value.warrantyInfo,"onUpdate:modelValue":f[25]||(f[25]=k=>c.value.warrantyInfo=k),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),t(e(De),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",onClick:f[26]||(f[26]=k=>C.$emit("close"))}),t(e(M),{label:v.value?"Save Trade-In":"Add Vehicle",variant:"default",size:"small",disabled:!x.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},eo={class:"w-full h-16 bg-muted flex items-center justify-center overflow-hidden"},to=["src","alt"],lo={class:"flex flex-col p-2"},so={class:"font-bold text-foreground leading-tight line-clamp-2 text-xs"},ao={class:"font-bold text-foreground text-xs mt-0.5"},oo={key:0,class:"flex items-center gap-0.5 px-1 py-0.5 bg-green-50 text-green-700 text-[8px] font-bold rounded border border-green-100 uppercase tracking-tighter w-fit mt-1"},no={key:1,class:"flex items-center gap-0.5 px-1 py-0.5 bg-amber-50 text-amber-700 text-[8px] font-bold rounded border border-amber-100 uppercase tracking-tighter w-fit mt-1"},Ze={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1},hideSelectButton:{type:Boolean,default:!1}},emits:["select"],setup(l){const u=l,o=E(()=>({Requested:"bg-blue-600",Recommended:"bg-gray-600","In Stock":"bg-green-600",Custom:"bg-amber-600"})[u.badge]||"bg-gray-600");function n(d){return d?d.toLocaleString("en-US"):"0"}return(d,v)=>(p(),h("div",{onClick:v[1]||(v[1]=y=>d.$emit("select")),class:j(["bg-white border rounded-lg shadow-nsc-card overflow-hidden transition-shadow relative cursor-pointer",l.selected?"border-primary border-2":"border-border"])},[s("div",{class:j(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",o.value])},T(l.badge),3),s("div",eo,[l.vehicle.image?(p(),h("img",{key:0,src:l.vehicle.image,alt:`${l.vehicle.brand} ${l.vehicle.model}`,class:"w-full h-full object-cover"},null,8,to)):(p(),_(e(Vt),{key:1,class:"size-6 text-muted-foreground"}))]),s("div",lo,[s("h4",so,T(l.vehicle.brand)+" "+T(l.vehicle.model)+" ("+T(l.vehicle.year)+") ",1),s("p",ao,"â‚¬ "+T(n(l.vehicle.price)),1),l.stockDays!==null&&l.stockDays!==void 0?(p(),h("div",oo,[t(e(It),{class:"size-3"}),s("span",null,"In stock "+T(l.stockDays)+"d",1)])):(p(),h("div",no,[t(e(tt),{class:"size-3"}),v[2]||(v[2]=s("span",null,"Out",-1))])),l.hideSelectButton?D("",!0):(p(),_(e(M),{key:2,variant:"default",size:"small",class:"w-full mt-2",onClick:v[0]||(v[0]=Me(y=>d.$emit("select"),["stop"]))},{default:i(()=>[...v[3]||(v[3]=[b(" Select ",-1)])]),_:1}))])],2))}},ro={class:"space-y-4"},io={key:0,class:"flex justify-start"},uo={key:0,class:"space-y-3"},co={class:"text-sm font-bold text-foreground flex items-center gap-2"},fo={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},mo={class:"space-y-3"},po={class:"relative"},vo={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},go={key:1,class:"rounded-lg border border-border bg-muted py-8 text-center"},yo={key:2,class:"space-y-4"},bo={class:"text-sm font-bold text-foreground flex items-center gap-2"},ho={class:"rounded-lg border border-border bg-muted p-4 space-y-4"},xo={key:0,class:"flex justify-start"},ko={key:1,class:"space-y-4"},wo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Co={class:"space-y-2"},So={class:"space-y-2"},$o={class:"space-y-2"},Vo={class:"space-y-2"},Io={class:"flex flex-wrap gap-2"},To={__name:"VehicleSelectionInline",props:{requestedVehicle:{type:Object,default:null},opportunityId:{type:[Number,String],default:null},mode:{type:String,default:"full"},showBack:{type:Boolean,default:!1},hideBack:{type:Boolean,default:!1}},emits:["vehicle-selected","back","selection-change"],setup(l,{expose:u,emit:o}){const n=l,d=o,v=E(()=>n.mode==="full"||n.mode==="stock"),y=E(()=>n.mode==="full"||n.mode==="configure"),c=L(""),x=L(n.mode==="configure"),w=L(null),m=L(null),C=L(null),f=L([]),k=L({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Pe(async()=>{try{const g=await Ct({});f.value=g.data||[]}catch{f.value=[]}}),ae(()=>n.mode,g=>{g==="configure"&&(x.value=!0)}),ae(w,g=>{d("selection-change",{hasSelection:!!g})},{immediate:!0}),u({confirmSelection:G});const P=E(()=>{const g=n.requestedVehicle;return g&&g.stockDays!=null}),q=E(()=>{var Q;const g=n.requestedVehicle,a=[];if(g&&P.value&&a.push({...g,isRequested:!0}),(Q=f.value)!=null&&Q.length){const z=f.value.filter(oe=>g?oe.brand!==g.brand||oe.model!==g.model:!0),ue=g&&P.value?3:4;a.push(...z.slice(0,ue))}return a}),Y=E(()=>{var a;if(!((a=f.value)!=null&&a.length))return[];let g=[...f.value];if(c.value.trim()){const Q=c.value.toLowerCase().trim();g=g.filter(z=>{var ue,oe;return((ue=z.brand)==null?void 0:ue.toLowerCase().includes(Q))||((oe=z.model)==null?void 0:oe.toLowerCase().includes(Q))||String(z.year).includes(Q)})}return g}),ee=E(()=>new Set(q.value.map(g=>g.id).filter(Boolean))),W=E(()=>Y.value.filter(g=>!ee.value.has(g.id))),O=E(()=>k.value.brand&&k.value.model&&k.value.year&&k.value.price>0);function A(g,a){w.value=g,m.value=g.id||`custom-${Date.now()}`,C.value=a}function G(){w.value&&d("vehicle-selected",{vehicle:w.value,type:C.value})}function S(){if(!O.value)return;const g={...k.value,id:`custom-${Date.now()}`,isCustom:!0};d("vehicle-selected",{vehicle:g,type:"custom"})}return(g,a)=>{const Q=ft("Check");return p(),h("div",ro,[l.showBack&&!l.hideBack?(p(),h("div",io,[t(e(M),{variant:"ghost",size:"sm",class:"gap-2 text-muted-foreground",onClick:a[0]||(a[0]=z=>g.$emit("back"))},{default:i(()=>[t(e(Tt),{class:"size-4"}),a[9]||(a[9]=b(" Back ",-1))]),_:1})])):D("",!0),v.value?(p(),h(K,{key:1},[q.value.length?(p(),h("div",uo,[s("h3",co,[t(e(et),{class:"size-4 text-primary"}),a[10]||(a[10]=b(" Recommended ",-1))]),s("div",fo,[(p(!0),h(K,null,J(q.value,z=>(p(),_(Ze,{key:z.id,vehicle:z,badge:z.isRequested?"Requested":"Recommended","stock-days":z.stockDays,selected:m.value===z.id,onSelect:ue=>A(z,z.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):D("",!0),s("div",mo,[s("div",po,[t(e(He),{class:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),t(e(F),{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=z=>c.value=z),type:"text",placeholder:"Search to find more...",class:"w-full pl-9 bg-background border-border"},null,8,["modelValue"])]),c.value.trim()?(p(),h(K,{key:0},[W.value.length?(p(),h("div",vo,[(p(!0),h(K,null,J(W.value,z=>(p(),_(Ze,{key:z.id,vehicle:z,badge:"In Stock","stock-days":z.stockDays,selected:m.value===z.id,onSelect:ue=>A(z,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(p(),h("div",go,[t(e(He),{class:"mx-auto mb-2 size-8 text-muted-foreground"}),a[11]||(a[11]=s("p",{class:"text-sm font-medium text-foreground"},"No vehicles found",-1)),a[12]||(a[12]=s("p",{class:"text-xs text-muted-foreground mt-0.5"},"Try different keywords",-1))]))],64)):D("",!0)])],64)):D("",!0),y.value?(p(),h("div",yo,[s("h3",bo,[t(e(Qe),{class:"size-4 text-primary"}),a[13]||(a[13]=b(" Configure Custom Vehicle ",-1))]),s("div",ho,[a[22]||(a[22]=s("p",{class:"text-sm text-muted-foreground"}," Build a custom configuration with specific options and features. ",-1)),x.value?(p(),h("div",ko,[s("div",wo,[s("div",Co,[t(e(V),{class:"text-sm font-medium text-foreground"},{default:i(()=>[...a[15]||(a[15]=[b("Brand",-1)])]),_:1}),t(e(F),{modelValue:k.value.brand,"onUpdate:modelValue":a[3]||(a[3]=z=>k.value.brand=z),type:"text",placeholder:"e.g., Audi",class:"w-full bg-background border-border"},null,8,["modelValue"])]),s("div",So,[t(e(V),{class:"text-sm font-medium text-foreground"},{default:i(()=>[...a[16]||(a[16]=[b("Model",-1)])]),_:1}),t(e(F),{modelValue:k.value.model,"onUpdate:modelValue":a[4]||(a[4]=z=>k.value.model=z),type:"text",placeholder:"e.g., e-tron GT",class:"w-full bg-background border-border"},null,8,["modelValue"])]),s("div",$o,[t(e(V),{class:"text-sm font-medium text-foreground"},{default:i(()=>[...a[17]||(a[17]=[b("Year",-1)])]),_:1}),t(e(F),{modelValue:k.value.year,"onUpdate:modelValue":a[5]||(a[5]=z=>k.value.year=z),type:"number",placeholder:"2024",class:"w-full bg-background border-border"},null,8,["modelValue"])]),s("div",Vo,[t(e(V),{class:"text-sm font-medium text-foreground"},{default:i(()=>[...a[18]||(a[18]=[b("Price (â‚¬)",-1)])]),_:1}),t(e(F),{modelValue:k.value.price,"onUpdate:modelValue":a[6]||(a[6]=z=>k.value.price=z),type:"number",placeholder:"98000",class:"w-full bg-background border-border"},null,8,["modelValue"])])]),s("div",Io,[l.showBack&&!l.hideBack?(p(),_(e(M),{key:0,variant:"ghost",size:"sm",onClick:a[7]||(a[7]=z=>g.$emit("back"))},{default:i(()=>[...a[19]||(a[19]=[b(" Back ",-1)])]),_:1})):D("",!0),t(e(M),{variant:"secondary",size:"sm",onClick:a[8]||(a[8]=z=>x.value=!1)},{default:i(()=>[...a[20]||(a[20]=[b(" Hide ",-1)])]),_:1}),t(e(M),{variant:"default",size:"sm",class:"gap-2",disabled:!O.value,onClick:S},{default:i(()=>[t(Q,{class:"size-4"}),a[21]||(a[21]=b(" Use Custom Configuration ",-1))]),_:1},8,["disabled"])])])):(p(),h("div",xo,[t(e(M),{variant:"default",size:"sm",class:"gap-2",onClick:a[2]||(a[2]=z=>x.value=!0)},{default:i(()=>[t(e(Qe),{class:"size-4"}),a[14]||(a[14]=b(" Build Custom Configuration ",-1))]),_:1})]))])])):D("",!0)])}}},Ao={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Do={key:0,class:"flex justify-between items-center mb-4"},Mo={class:"text-sm font-bold text-foreground"},Po={key:1,class:"mb-6 space-y-4"},Lo={key:0,class:"rounded-lg border border-border bg-muted overflow-hidden p-6"},Fo={class:"space-y-3"},Oo={key:1,class:"rounded-lg border border-border bg-muted overflow-hidden p-6"},Uo={key:2,class:"mb-6 p-4 bg-muted rounded-lg border border-border"},Ro={class:"flex items-center gap-3"},No={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},zo=["src"],Bo={key:1,class:"fa-solid fa-car text-muted-foreground w-full h-full flex items-center justify-center"},Eo={class:"font-bold text-sm text-foreground"},qo={class:"text-xs text-muted-foreground"},jo={key:3,class:"space-y-3"},_o={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Wo={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Ho={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Yo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Go={key:0,class:"border border-border rounded-lg bg-white shadow-nsc-card"},Ko={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Zo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Jo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xo={class:"border border-border rounded-lg bg-white shadow-nsc-card"},en={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},tn={class:"space-y-3"},ln={class:"flex items-center gap-2"},sn={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted rounded-lg"},an={class:"border border-border rounded-lg bg-white shadow-nsc-card"},on={class:"flex items-center gap-2"},nn={class:"text-xs text-muted-foreground"},rn={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},dn={class:"flex justify-end"},un={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},cn={class:"md:col-span-2"},fn={class:"flex justify-between items-end gap-2"},mn={class:"grid grid-cols-2 gap-3"},pn={class:"flex justify-end"},vn={class:"text-sm font-semibold text-foreground"},gn={key:0,class:"text-center py-6 text-muted-foreground text-xs"},yn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},bn={class:"flex items-center gap-2"},hn={class:"text-xs text-muted-foreground"},xn={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},kn={class:"flex justify-end"},wn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Cn={class:"flex justify-between items-center"},Sn={key:0,class:"text-center py-6 text-muted-foreground text-xs"},$n={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Vn={key:0,class:"px-4 pb-4 border-t border-border pt-4 space-y-3"},In={key:0,class:"space-y-3"},Tn={key:1,class:"flex flex-col items-center gap-2 py-2"},An={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Dn={key:0,class:"px-4 pb-4 border-t border-border pt-4 space-y-3"},Mn={key:0,class:"space-y-3"},Pn={key:1,class:"flex flex-col items-center gap-2 py-2"},Ln={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Fn={class:"flex items-center gap-2"},On={class:"text-xs text-muted-foreground"},Un={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Rn={class:"flex justify-end"},Nn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},zn={class:"flex justify-between items-center"},Bn={key:0,class:"text-center py-6 text-muted-foreground text-xs"},En={key:1,class:"bg-muted rounded-lg p-4 mt-4 space-y-2"},qn={class:"flex justify-between items-center"},jn={class:"text-sm font-bold text-foreground"},_n={class:"flex justify-between items-center"},Wn={class:"text-sm font-bold text-foreground"},Hn={key:0,class:"text-xs text-red-600"},Qn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Yn={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Gn={class:"space-y-3 pt-3 border-t border-border"},Kn={class:"flex items-start gap-2"},Zn={class:"flex items-start gap-2"},Jn={key:4,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Xn={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1},hideVehicleSelection:{type:Boolean,default:!1},initialVehicleStep:{type:String,default:"select"},tradeIns:{type:Array,default:()=>[]},financingOptions:{type:Array,default:()=>[]}},emits:["save","cancel","open-add-tradein","open-add-financing"],setup(l,{expose:u,emit:o}){const n=wt(),d=l,v=o,y=L("select"),c=L("choice");function x({vehicle:I}){a.value.price=I.price||0,a.value.brand=I.brand||"",a.value.model=I.model||"",a.value.year=I.year||"",a.value.image=I.image||"",y.value="manual",c.value="choice"}const w=L(!1),m=L(!1),C=L(!1),f=L(!1),k=L(!1),P=L(!1),q=L(!1),Y=L(!1),ee=L(!1),W=E(()=>{const I=n.currentOpportunityActivities||[],r={tradeIns:(I.filter(R=>R.type==="tradein")||[]).map(R=>{var ce,we,Ce;return{id:R.id,...R.data||{},label:(ce=R.data)!=null&&ce.make&&((we=R.data)!=null&&we.model)?`${R.data.make} ${R.data.model} (${R.data.year||""}) - â‚¬${(R.data.value??0).toLocaleString()}`:((Ce=R.data)==null?void 0:Ce.label)||`Trade-in #${R.id}`}}),financingOptions:(I.filter(R=>R.type==="financing")||[]).map(R=>{var ce,we,Ce;return{id:R.id,...R.data||{},label:(ce=R.data)!=null&&ce.product||(we=R.data)!=null&&we.productName?`${R.data.product||R.data.productName} (${R.data.apr||R.data.interestRate}% APR, ${R.data.term}mo)`:((Ce=R.data)==null?void 0:Ce.label)||`Financing #${R.id}`}})},X={tradeIns:(d.tradeIns||[]).map(R=>({id:R.id,label:R.label||"Trade-in",value:R.valuation??0})),financingOptions:(d.financingOptions||[]).map(R=>({id:R.id,label:R.termMonths?`${R.label} (${R.termMonths} mo)`:R.label||"Financing",term:R.termMonths??null}))};return{tradeIns:[...X.tradeIns,...r.tradeIns.filter(R=>!X.tradeIns.some(ce=>String(ce.id)===String(R.id)))],financingOptions:[...X.financingOptions,...r.financingOptions.filter(R=>!X.financingOptions.some(ce=>String(ce.id)===String(R.id)))]}});function O(I){const r=W.value.financingOptions.find(X=>String(X.id)===String(I));r&&(a.value.financingType="financing",a.value.term=r.term??a.value.term,a.value.interestRate=r.apr??r.interestRate??a.value.interestRate,a.value.downPayment=r.downPayment??r.deposit??a.value.downPayment,a.value.monthlyPayment=r.monthly??r.monthlyPayment??a.value.monthlyPayment,a.value.selectedFinancingId=r.id,a.value.selectedFinancingLabel=r.product??r.productName??r.label??"")}function A(I){const r=W.value.tradeIns.find(R=>String(R.id)===String(I));if(!r)return;a.value.tradeIn.valuation=r.value??r.valuation??0;const X=r.make&&r.model?`${r.make} ${r.model} (${r.year||""}) - ${r.condition||""} condition, ${r.mileage??""}km`:r.label||"";a.value.tradeIn.notes=X.trim()||a.value.tradeIn.notes,a.value.selectedTradeInId=r.id,a.value.selectedTradeInLabel=(r.make&&r.model?`${r.make} ${r.model}`:null)??r.label??""}function G(I){if(!I||I==="none"){a.value.tradeIn.valuation=0,a.value.tradeIn.notes="",a.value.selectedTradeInId=null,a.value.selectedTradeInLabel="";return}A(I)}const S=E(()=>{const I=a.value.selectedFinancingId;return I!=null&&I!==""?String(I):"cash"});function g(I){if(I==="cash"||I==null||I===""){a.value.financingType="cash",a.value.selectedFinancingId=null,a.value.selectedFinancingLabel="",a.value.downPayment=0,a.value.monthlyPayment=0,a.value.term=36,a.value.interestRate=3.5;return}O(I)}const a=L({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"cash",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null,selectedTradeInId:null,selectedTradeInLabel:"",selectedFinancingId:null,selectedFinancingLabel:""}),Q=E(()=>!!d.customer),z=E(()=>{let I=a.value.price||0;return a.value.quotationItems.forEach(r=>{I+=(r.price||0)*(r.quantity||1)}),a.value.showVat?I-ue.value:I}),ue=E(()=>{if(!a.value.showVat||!a.value.vatRate)return 0;let I=a.value.price||0;return a.value.quotationItems.forEach(r=>{I+=(r.price||0)*(r.quantity||1)}),I*a.value.vatRate/(100+a.value.vatRate)}),oe=E(()=>{let I=a.value.price||0;return a.value.quotationItems.forEach(r=>{I+=(r.price||0)*(r.quantity||1)}),a.value.discounts.forEach(r=>{I-=r.price||0}),a.value.tradeIn.valuation&&(I-=a.value.tradeIn.valuation),I}),U=E(()=>a.value.paymentMethods.reduce((I,r)=>I+(r.amount||0),0)),B=E(()=>a.value.paymentMethods.length===0?!0:Math.abs(U.value-oe.value)<.01),se=()=>{a.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},te=I=>{a.value.quotationItems.splice(I,1)},he=()=>{a.value.discounts.push({title:"",price:0,vatInclusive:!0})},Re=I=>{a.value.discounts.splice(I,1)},Ne=()=>{a.value.paymentMethods.push({description:"",amount:0,paid:!1})},ze=I=>{a.value.paymentMethods.splice(I,1)},xe=()=>{if(d.customer){const I=(d.customer.name||"").split(" ");a.value.firstName=I[0]||"",a.value.lastName=I.slice(1).join(" ")||"",a.value.email=d.customer.email||"",a.value.phone=d.customer.phone||"",a.value.address=d.customer.address||"",a.value.city=d.customer.city||"",a.value.zipCode=d.customer.zipCode||d.customer.postalCode||""}};Pe(()=>{xe(),(d.item||d.selectedVehicle||d.hideVehicleSelection&&d.initialVehicleStep==="manual")&&(y.value="manual"),d.selectedVehicle&&(a.value.price=d.selectedVehicle.price||0,a.value.brand=d.selectedVehicle.brand||"",a.value.model=d.selectedVehicle.model||"",a.value.year=d.selectedVehicle.year||"",a.value.image=d.selectedVehicle.image||""),d.item&&d.item.data&&(a.value={...a.value,...d.item.data,price:d.item.data.price||d.item.data.total||0,financingType:d.item.data.financingType||d.item.data.paymentMethod||"cash",notes:d.item.data.notes||d.item.data.description||"",showVat:d.item.data.showVat||!1,vatRate:d.item.data.vatRate||21,quotationItems:d.item.data.quotationItems||[],discounts:d.item.data.discounts||[],tradeIn:d.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:d.item.data.paymentMethods||[],expirationDate:d.item.data.expirationDate||null,selectedTradeInId:d.item.data.selectedTradeInId||null,selectedTradeInLabel:d.item.data.selectedTradeInLabel||"",selectedFinancingId:d.item.data.selectedFinancingId||null,selectedFinancingLabel:d.item.data.selectedFinancingLabel||""})}),ae(()=>d.selectedVehicle,I=>{I&&!d.item&&(y.value="manual",a.value.price=I.price||0,a.value.brand=I.brand||"",a.value.model=I.model||"",a.value.year=I.year||"",a.value.image=I.image||"")}),ae(()=>d.customer,()=>{xe()}),ae(()=>({hasTradeIns:W.value.tradeIns.length>0,hasFinancing:W.value.financingOptions.length>0}),({hasTradeIns:I,hasFinancing:r})=>{I&&(q.value=!0),r&&(P.value=!0)},{immediate:!0});const Ee=E(()=>{const I=a.value.salutation!==""&&a.value.firstName!==""&&a.value.lastName!==""&&a.value.email!==""&&a.value.zipCode!==""&&a.value.price>0&&a.value.financingType!==""&&a.value.privacyConsent===!0,r=d.selectedVehicle||y.value==="manual",X=B.value;return I&&r&&X}),Be=I=>I?(typeof I=="string"?parseFloat(I):I).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",_e=()=>{var r,X;if(!Ee.value)return;const I={id:((r=d.item)==null?void 0:r.id)||Date.now(),type:"offer",action:d.item?"updated an offer":"created an offer",data:{salutation:a.value.salutation,firstName:a.value.firstName,lastName:a.value.lastName,email:a.value.email,phone:a.value.phone,zipCode:a.value.zipCode,address:a.value.address,city:a.value.city,brand:a.value.brand,model:a.value.model,year:a.value.year,image:a.value.image,price:a.value.price,total:oe.value,paymentMethod:a.value.financingType,financingType:a.value.financingType,downPayment:a.value.downPayment,monthlyPayment:a.value.monthlyPayment,term:a.value.term,interestRate:a.value.interestRate,notes:a.value.notes,description:a.value.notes,privacyConsent:a.value.privacyConsent,marketingConsent:a.value.marketingConsent,showVat:a.value.showVat,vatRate:a.value.vatRate,vatAmount:ue.value,subtotal:z.value,quotationItems:a.value.quotationItems,discounts:a.value.discounts,tradeIn:a.value.tradeIn,paymentMethods:a.value.paymentMethods,expirationDate:a.value.expirationDate,grandTotal:oe.value,selectedTradeInId:a.value.selectedTradeInId,selectedTradeInLabel:a.value.selectedTradeInLabel,selectedFinancingId:a.value.selectedFinancingId,selectedFinancingLabel:a.value.selectedFinancingLabel},timestamp:((X=d.item)==null?void 0:X.timestamp)||new Date().toISOString(),isEdit:!!d.item};v("save",I)};return u({submit:_e,isValid:Ee,offerData:a}),(I,r)=>{var X,R,ce,we,Ce,We;return p(),h("div",Ao,[l.hideHeader?D("",!0):(p(),h("div",Do,[s("h5",Mo,T(l.item?"Edit Offer":"Create Offer"),1),t(e(M),{variant:"ghost",size:"icon",onClick:r[0]||(r[0]=$=>I.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},{default:i(()=>[...r[38]||(r[38]=[s("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!l.hideVehicleSelection&&!l.selectedVehicle&&!l.item&&y.value==="select"?(p(),h("div",Po,[c.value==="choice"?(p(),h("div",Lo,[r[42]||(r[42]=s("h6",{class:"text-sm font-semibold text-foreground mb-4"},"Select Vehicle",-1)),r[43]||(r[43]=s("p",{class:"text-sm text-muted-foreground mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),s("div",Fo,[t(e(M),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[1]||(r[1]=$=>c.value="stock")},{default:i(()=>[...r[39]||(r[39]=[s("i",{class:"fa-solid fa-warehouse"},null,-1),s("span",null,"Add from Stock â€” Search and select an existing vehicle from inventory",-1)])]),_:1}),t(e(M),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[2]||(r[2]=$=>c.value="configure")},{default:i(()=>[...r[40]||(r[40]=[s("i",{class:"fa-solid fa-cog"},null,-1),s("span",null,"Configure Vehicle â€” Build/customize a new vehicle",-1)])]),_:1}),t(e(M),{variant:"outline",class:"w-full justify-start gap-2",onClick:r[3]||(r[3]=$=>y.value="manual")},{default:i(()=>[...r[41]||(r[41]=[s("i",{class:"fa-solid fa-pen-to-square"},null,-1),s("span",null,"Skip & Enter Manually â€” Create vehicle data from scratch",-1)])]),_:1})])])):(p(),h("div",Oo,[t(To,{"requested-vehicle":l.selectedVehicle,"opportunity-id":l.taskId,mode:c.value,"show-back":"",onVehicleSelected:x,onBack:r[4]||(r[4]=$=>c.value="choice")},null,8,["requested-vehicle","opportunity-id","mode"])]))])):D("",!0),l.selectedVehicle||y.value==="manual"&&a.value.brand?(p(),h("div",Uo,[r[44]||(r[44]=s("p",{class:"text-xs text-muted-foreground mb-2"},"Creating offer for:",-1)),s("div",Ro,[s("div",No,[(X=l.selectedVehicle)!=null&&X.image||a.value.image?(p(),h("img",{key:0,src:((R=l.selectedVehicle)==null?void 0:R.image)||a.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,zo)):(p(),h("i",Bo))]),s("div",null,[s("h4",Eo,T(((ce=l.selectedVehicle)==null?void 0:ce.brand)||a.value.brand)+" "+T(((we=l.selectedVehicle)==null?void 0:we.model)||a.value.model)+" ("+T(((Ce=l.selectedVehicle)==null?void 0:Ce.year)||a.value.year)+") ",1),s("p",qo,"Base Price: â‚¬ "+T(Be(((We=l.selectedVehicle)==null?void 0:We.price)||a.value.price)),1)])])])):D("",!0),l.selectedVehicle||y.value==="manual"||l.item?(p(),h("div",jo,[s("div",_o,[s("button",{type:"button",onClick:r[5]||(r[5]=$=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors rounded-t-lg"},[r[45]||(r[45]=s("div",{class:"flex items-center gap-2"},[s("h6",{class:"text-sm font-semibold text-foreground"},"Personal Information"),s("span",{class:"text-xs text-red-600"},"*Required")],-1)),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(p(),h("div",Wo,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[46]||(r[46]=[b("Salutation ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(de),{modelValue:a.value.salutation,"onUpdate:modelValue":r[6]||(r[6]=$=>a.value.salutation=$)},{default:i(()=>[t(e(ne),{class:"w-full"},{default:i(()=>[t(e(re),{placeholder:"Select salutation"})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"Mr."},{default:i(()=>[...r[47]||(r[47]=[b("Mr.",-1)])]),_:1}),t(e(N),{value:"Mrs."},{default:i(()=>[...r[48]||(r[48]=[b("Mrs.",-1)])]),_:1}),t(e(N),{value:"Ms."},{default:i(()=>[...r[49]||(r[49]=[b("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Ho,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[50]||(r[50]=[b("First Name ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(F),{modelValue:a.value.firstName,"onUpdate:modelValue":r[7]||(r[7]=$=>a.value.firstName=$),placeholder:"Enter first name",disabled:Q.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[51]||(r[51]=[b("Last Name ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(F),{modelValue:a.value.lastName,"onUpdate:modelValue":r[8]||(r[8]=$=>a.value.lastName=$),placeholder:"Enter last name",disabled:Q.value},null,8,["modelValue","disabled"])])]),s("div",Qo,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[52]||(r[52]=[b("Email ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(F),{type:"email",modelValue:a.value.email,"onUpdate:modelValue":r[9]||(r[9]=$=>a.value.email=$),placeholder:"email@example.com",disabled:Q.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[53]||(r[53]=[b("Phone Number",-1)])]),_:1}),t(e(F),{type:"tel",modelValue:a.value.phone,"onUpdate:modelValue":r[10]||(r[10]=$=>a.value.phone=$),placeholder:"+1 (555) 000-0000",disabled:Q.value},null,8,["modelValue","disabled"])])]),s("div",Yo,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[54]||(r[54]=[b("ZIP / Postal Code ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(F),{modelValue:a.value.zipCode,"onUpdate:modelValue":r[11]||(r[11]=$=>a.value.zipCode=$),placeholder:"Enter ZIP code",disabled:Q.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[55]||(r[55]=[b("City",-1)])]),_:1}),t(e(F),{modelValue:a.value.city,"onUpdate:modelValue":r[12]||(r[12]=$=>a.value.city=$),placeholder:"Enter city",disabled:Q.value},null,8,["modelValue","disabled"])])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[56]||(r[56]=[b("Address / Street",-1)])]),_:1}),t(e(F),{modelValue:a.value.address,"onUpdate:modelValue":r[13]||(r[13]=$=>a.value.address=$),placeholder:"Enter street address",disabled:Q.value},null,8,["modelValue","disabled"])])])):D("",!0)]),y.value==="manual"&&!l.selectedVehicle?(p(),h("div",Go,[s("button",{type:"button",onClick:r[14]||(r[14]=$=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[57]||(r[57]=s("h6",{class:"text-sm font-semibold text-foreground"},"Vehicle Details",-1)),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(p(),h("div",Ko,[s("div",Zo,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[58]||(r[58]=[b("Brand",-1)])]),_:1}),t(e(F),{modelValue:a.value.brand,"onUpdate:modelValue":r[15]||(r[15]=$=>a.value.brand=$),placeholder:"e.g., Audi"},null,8,["modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[59]||(r[59]=[b("Model",-1)])]),_:1}),t(e(F),{modelValue:a.value.model,"onUpdate:modelValue":r[16]||(r[16]=$=>a.value.model=$),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),s("div",Jo,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[60]||(r[60]=[b("Year",-1)])]),_:1}),t(e(F),{type:"number",modelValue:a.value.year,"onUpdate:modelValue":r[17]||(r[17]=$=>a.value.year=$),placeholder:"2024"},null,8,["modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[61]||(r[61]=[b("Image URL",-1)])]),_:1}),t(e(F),{modelValue:a.value.image,"onUpdate:modelValue":r[18]||(r[18]=$=>a.value.image=$),placeholder:"https://..."},null,8,["modelValue"])])])])):D("",!0)])):D("",!0),s("div",Xo,[s("button",{type:"button",onClick:r[19]||(r[19]=$=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[62]||(r[62]=s("div",{class:"flex items-center gap-2"},[s("h6",{class:"text-sm font-semibold text-foreground"},"Pricing"),s("span",{class:"text-xs text-red-600"},"*Required")],-1)),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(p(),h("div",en,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[63]||(r[63]=[b("Base Price (â‚¬) ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1}),t(e(F),{type:"number",modelValue:a.value.price,"onUpdate:modelValue":r[20]||(r[20]=$=>a.value.price=$),placeholder:"0"},null,8,["modelValue"])]),s("div",tn,[s("div",ln,[t(e($e),{checked:a.value.showVat,"onUpdate:checked":r[21]||(r[21]=$=>a.value.showVat=$),id:"show-vat"},null,8,["checked"]),t(e(V),{for:"show-vat",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:i(()=>[...r[64]||(r[64]=[b("Show VAT breakdown",-1)])]),_:1})]),a.value.showVat?(p(),h("div",sn,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[65]||(r[65]=[b("VAT %",-1)])]),_:1}),t(e(F),{type:"number",step:"0.1",modelValue:a.value.vatRate,"onUpdate:modelValue":r[22]||(r[22]=$=>a.value.vatRate=$),placeholder:"21"},null,8,["modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[66]||(r[66]=[b("VAT â‚¬",-1)])]),_:1}),t(e(F),{type:"number",value:ue.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[67]||(r[67]=[b("Subtotal â‚¬",-1)])]),_:1}),t(e(F),{type:"number",value:z.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):D("",!0)])])):D("",!0)]),s("div",an,[s("button",{type:"button",onClick:r[23]||(r[23]=$=>f.value=!f.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[s("div",on,[r[68]||(r[68]=s("h6",{class:"text-sm font-semibold text-foreground"},"Quotation Items",-1)),s("span",nn,"("+T(a.value.quotationItems.length)+" items)",1)]),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",f.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),f.value?(p(),h("div",rn,[s("div",dn,[t(e(M),{variant:"outline",size:"small",onClick:se},{default:i(()=>[...r[69]||(r[69]=[s("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),b(" Add Item ",-1)])]),_:1})]),(p(!0),h(K,null,J(a.value.quotationItems,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[s("div",un,[s("div",cn,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[70]||(r[70]=[b("Item Name",-1)])]),_:1}),t(e(F),{modelValue:$.name,"onUpdate:modelValue":Z=>$.name=Z,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",fn,[t(e(M),{variant:"ghost",size:"icon",onClick:Z=>te(Se),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:i(()=>[...r[71]||(r[71]=[s("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),s("div",mn,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[72]||(r[72]=[b("Price (â‚¬)",-1)])]),_:1}),t(e(F),{type:"number",modelValue:$.price,"onUpdate:modelValue":Z=>$.price=Z,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[73]||(r[73]=[b("Quantity",-1)])]),_:1}),t(e(F),{type:"number",modelValue:$.quantity,"onUpdate:modelValue":Z=>$.quantity=Z,placeholder:"1",value:$.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),s("div",pn,[s("span",vn,"Total: â‚¬ "+T(Be(($.price||0)*($.quantity||1))),1)])]))),128)),a.value.quotationItems.length===0?(p(),h("div",gn," No quotation items added yet ")):D("",!0)])):D("",!0)]),s("div",yn,[s("button",{type:"button",onClick:r[24]||(r[24]=$=>k.value=!k.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[s("div",bn,[r[74]||(r[74]=s("h6",{class:"text-sm font-semibold text-foreground"},"Discounts",-1)),s("span",hn,"("+T(a.value.discounts.length)+" discounts)",1)]),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",k.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),k.value?(p(),h("div",xn,[s("div",kn,[t(e(M),{variant:"outline",size:"small",onClick:he},{default:i(()=>[...r[75]||(r[75]=[s("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),b(" Add Discount ",-1)])]),_:1})]),(p(!0),h(K,null,J(a.value.discounts,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[s("div",wn,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[76]||(r[76]=[b("Discount Title",-1)])]),_:1}),t(e(F),{modelValue:$.title,"onUpdate:modelValue":Z=>$.title=Z,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[77]||(r[77]=[b("Amount (â‚¬)",-1)])]),_:1}),t(e(F),{type:"number",modelValue:$.price,"onUpdate:modelValue":Z=>$.price=Z,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),s("div",Cn,[t(e(V),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[t(e($e),{checked:$.vatInclusive,"onUpdate:checked":Z=>$.vatInclusive=Z},null,8,["checked","onUpdate:checked"]),r[78]||(r[78]=s("span",{class:"text-xs text-muted-foreground"},"VAT inclusive",-1))]),_:2},1024),t(e(M),{variant:"ghost",size:"icon",onClick:Z=>Re(Se),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...r[79]||(r[79]=[s("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),a.value.discounts.length===0?(p(),h("div",Sn," No discounts added yet ")):D("",!0)])):D("",!0)]),s("div",$n,[s("button",{type:"button",onClick:r[25]||(r[25]=$=>P.value=!P.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[80]||(r[80]=s("h6",{class:"text-sm font-semibold text-foreground"},"Financing",-1)),t(e(Ye),{class:j(["size-4 text-muted-foreground transition-transform duration-200",P.value&&"rotate-180"])},null,8,["class"])]),P.value?(p(),h("div",Vn,[W.value.financingOptions.length>0?(p(),h("div",In,[t(e(de),{"model-value":S.value,"onUpdate:modelValue":g},{default:i(()=>[t(e(ne),{class:"w-full bg-muted/50 border-border h-9 text-xs"},{default:i(()=>[t(e(re),{placeholder:"Pick a financing option or Cash..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"cash"},{default:i(()=>[...r[81]||(r[81]=[b("Cash",-1)])]),_:1}),(p(!0),h(K,null,J(W.value.financingOptions,$=>(p(),_(e(N),{key:$.id,value:$.id.toString()},{default:i(()=>[b(T($.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),t(e(M),{variant:"outline",size:"sm",class:"gap-2 w-full sm:w-auto",onClick:r[26]||(r[26]=$=>I.$emit("open-add-financing"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),r[82]||(r[82]=b(" Add financing / purchase method ",-1))]),_:1})])):(p(),h("div",Tn,[r[84]||(r[84]=s("p",{class:"text-xs text-muted-foreground"},"No financing options yet",-1)),t(e(M),{variant:"outline",size:"sm",class:"gap-2",onClick:r[27]||(r[27]=$=>I.$emit("open-add-financing"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),r[83]||(r[83]=b(" Add financing / purchase method ",-1))]),_:1})]))])):D("",!0)]),s("div",An,[s("button",{type:"button",onClick:r[28]||(r[28]=$=>q.value=!q.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[85]||(r[85]=s("h6",{class:"text-sm font-semibold text-foreground"},"Trade-In",-1)),t(e(Ye),{class:j(["size-4 text-muted-foreground transition-transform duration-200",q.value&&"rotate-180"])},null,8,["class"])]),q.value?(p(),h("div",Dn,[W.value.tradeIns.length>0?(p(),h("div",Mn,[t(e(de),{"model-value":a.value.selectedTradeInId!=null?String(a.value.selectedTradeInId):"none","onUpdate:modelValue":G},{default:i(()=>[t(e(ne),{class:"w-full bg-muted/50 border-border h-9 text-xs"},{default:i(()=>[t(e(re),{placeholder:"Pick a trade-in..."})]),_:1}),t(e(ie),null,{default:i(()=>[t(e(N),{value:"none"},{default:i(()=>[...r[86]||(r[86]=[b("None",-1)])]),_:1}),(p(!0),h(K,null,J(W.value.tradeIns,$=>(p(),_(e(N),{key:$.id,value:$.id.toString()},{default:i(()=>[b(T($.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),t(e(M),{variant:"outline",size:"sm",class:"gap-2 w-full sm:w-auto",onClick:r[29]||(r[29]=$=>I.$emit("open-add-tradein"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),r[87]||(r[87]=b(" Add trade-in ",-1))]),_:1})])):(p(),h("div",Pn,[r[89]||(r[89]=s("p",{class:"text-xs text-muted-foreground"},"No trade-ins yet",-1)),t(e(M),{variant:"outline",size:"sm",class:"gap-2",onClick:r[30]||(r[30]=$=>I.$emit("open-add-tradein"))},{default:i(()=>[t(e(Ve),{class:"size-4"}),r[88]||(r[88]=b(" Add trade-in ",-1))]),_:1})]))])):D("",!0)]),s("div",Ln,[s("button",{type:"button",onClick:r[31]||(r[31]=$=>Y.value=!Y.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[s("div",Fn,[r[90]||(r[90]=s("h6",{class:"text-sm font-semibold text-foreground"},"Payment Methods",-1)),s("span",On,"("+T(a.value.paymentMethods.length)+" methods)",1)]),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",Y.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),Y.value?(p(),h("div",Un,[s("div",Rn,[t(e(M),{variant:"outline",size:"small",onClick:Ne},{default:i(()=>[...r[91]||(r[91]=[s("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),b(" Add Payment Method ",-1)])]),_:1})]),(p(!0),h(K,null,J(a.value.paymentMethods,($,Se)=>(p(),h("div",{key:Se,class:"border border-border rounded-lg p-3 space-y-3"},[s("div",Nn,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[92]||(r[92]=[b("Description",-1)])]),_:1}),t(e(F),{modelValue:$.description,"onUpdate:modelValue":Z=>$.description=Z,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[93]||(r[93]=[b("Amount (â‚¬)",-1)])]),_:1}),t(e(F),{type:"number",modelValue:$.amount,"onUpdate:modelValue":Z=>$.amount=Z,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),s("div",zn,[t(e(V),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[t(e($e),{checked:$.paid,"onUpdate:checked":Z=>$.paid=Z},null,8,["checked","onUpdate:checked"]),r[94]||(r[94]=s("span",{class:"text-xs text-muted-foreground"},"PAID",-1))]),_:2},1024),t(e(M),{variant:"ghost",size:"icon",onClick:Z=>ze(Se),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...r[95]||(r[95]=[s("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),a.value.paymentMethods.length===0?(p(),h("div",Bn," No payment methods added yet ")):D("",!0),a.value.paymentMethods.length>0?(p(),h("div",En,[s("div",qn,[r[96]||(r[96]=s("span",{class:"text-xs font-medium text-muted-foreground"},"Payment Methods Total:",-1)),s("span",jn,"â‚¬ "+T(Be(U.value)),1)]),s("div",_n,[r[97]||(r[97]=s("span",{class:"text-xs font-medium text-muted-foreground"},"Grand Total:",-1)),s("span",Wn,"â‚¬ "+T(Be(oe.value)),1)]),B.value?D("",!0):(p(),h("div",Hn," âš ï¸ Payment methods must equal Grand Total "))])):D("",!0)])):D("",!0)]),s("div",Qn,[s("button",{type:"button",onClick:r[32]||(r[32]=$=>ee.value=!ee.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[98]||(r[98]=s("div",{class:"flex items-center gap-2"},[s("h6",{class:"text-sm font-semibold text-foreground"},"Terms & Conditions"),s("span",{class:"text-xs text-red-600"},"*Required")],-1)),s("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",ee.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ee.value?(p(),h("div",Yn,[s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[99]||(r[99]=[b("Notes / Comments",-1)])]),_:1}),t(e(Te),{modelValue:a.value.notes,"onUpdate:modelValue":r[33]||(r[33]=$=>a.value.notes=$),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),s("div",null,[t(e(V),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[100]||(r[100]=[b("Offer Expiration Date",-1)])]),_:1}),t(e(F),{type:"date",modelValue:a.value.expirationDate,"onUpdate:modelValue":r[34]||(r[34]=$=>a.value.expirationDate=$)},null,8,["modelValue"])]),s("div",Gn,[r[103]||(r[103]=s("h6",{class:"text-xs font-semibold text-foreground"},"Privacy & Consent",-1)),s("div",Kn,[t(e($e),{checked:a.value.privacyConsent,"onUpdate:checked":r[35]||(r[35]=$=>a.value.privacyConsent=$),id:"privacy-consent"},null,8,["checked"]),t(e(V),{for:"privacy-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:i(()=>[...r[101]||(r[101]=[b(" I agree to the privacy policy ",-1),s("span",{class:"text-red-500"},"*",-1)])]),_:1})]),s("div",Zn,[t(e($e),{checked:a.value.marketingConsent,"onUpdate:checked":r[36]||(r[36]=$=>a.value.marketingConsent=$),id:"marketing-consent"},null,8,["checked"]),t(e(V),{for:"marketing-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:i(()=>[...r[102]||(r[102]=[b(" I want to receive marketing communications ",-1)])]),_:1})])])])):D("",!0)])])):D("",!0),l.hideActions?D("",!0):(p(),h("div",Jn,[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:r[37]||(r[37]=$=>I.$emit("cancel"))}),t(e(M),{label:l.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!Ee.value,onClick:_e},null,8,["label","disabled"])]))])}}},er={class:"flex-1 overflow-y-auto p-6 w-full"},Zr={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(l,{emit:u}){const o=u,n=L(null),d=E(()=>{var x;return((x=n.value)==null?void 0:x.isValid)||!1}),v=()=>{var x;(x=n.value)==null||x.submit()},y=x=>{x||o("close")},c=x=>{o("save",x),o("close")};return(x,w)=>(p(),_(e(be),{open:l.show,"onUpdate:open":y},{default:i(()=>[t(e(me),null,{default:i(()=>[t(e(pe),{class:"fixed inset-0 z-50 bg-black/50"}),t(e(ve),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:i(()=>[t(e(ge),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:i(()=>[t(e(ye),null,{default:i(()=>[...w[2]||(w[2]=[b("Create Offer",-1)])]),_:1})]),_:1}),s("div",er,[t(Xn,{item:l.item,"task-type":l.taskType,"task-id":l.taskId,"selected-vehicle":l.requestedCar,customer:l.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:n,onSave:c,onCancel:w[0]||(w[0]=m=>x.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),t(e(De),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:i(()=>[t(e(M),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:w[1]||(w[1]=m=>x.$emit("close"))}),t(e(M),{label:l.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!d.value,onClick:v},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Jr(l){const u=l.lead;if(!u)return null;const o=Ae(u,"lead");if(!o)return console.warn("No display stage calculated for lead"),null;const n=Le[o];if(!n)return console.warn(`No state config found for lead stage: ${o}`),null;if(!n.primaryAction)return console.warn(`No primary action found for lead stage: ${o}`),null;const d=n.primaryAction;if(typeof d=="function"){const v=d({lead:u,displayStage:o});return v||console.warn(`Primary action function returned null for lead stage: ${o}`),v}return d}function Xr(l){const u=l.lead;if(!u)return[];const o=Ae(u,"lead"),n=Le[o];return n?n.secondaryActions||[]:[]}function lt(l){const u=l.lead;if(!u||!(u.isDisqualified===!0))return!1;const n=Ae(u,"lead");return n===ke.CLOSED_INVALID||n===ke.CLOSED_NOT_INTERESTED||n===ke.CLOSED_DUPLICATE}function ei(l){const u=l.lead;if(!u||lt(l))return!1;const o=Ae(u,"lead"),n=Le[o];return n?typeof n.showLQWidget=="function"?n.showLQWidget(u):n.showLQWidget??!1:!1}function ti(l){const u=l.lead;if(!u||lt(l))return!1;const o=Ae(u,"lead"),n=Le[o];return n?n.showDeadlineBanner&&u.nextActionDue:!1}function li(l){const u=l.lead;if(!u)return!1;const o=Ae(u,"lead"),n=Le[o];return n?n.canPostpone??!1:!1}function si(l){const u=l.lead;if(!u)return"qualification";const o=Ae(u,"lead"),n=Le[o];return n&&n.lqWidgetMode||"qualification"}function ai(){const l=St();return{saveTradeInVehicle:async(n,d,v,y={})=>{try{const c=await l.addVehicle(v),x={type:"tradein",action:"added a trade-in",vehicleId:c.id,data:{brand:v.brand,model:v.model,version:v.version||null,year:v.year,kilometers:v.kilometers||0,plates:v.plates||null,registration:v.registration||null,vin:v.vin||null,fuelType:v.fuelType||null,gearType:v.gearType||null,tradeInPrice:y.tradeInPrice||null,evaluationRangeLow:y.evaluationRangeLow||null,evaluationRangeHigh:y.evaluationRangeHigh||null,provider:y.provider||null,evaluationDate:y.evaluationDate||null,priceToBuy:y.priceToBuy||null,priceToSell:y.priceToSell||null,priceOfVehicle:y.priceOfVehicle||null,priceOfOptionals:y.priceOfOptionals||null,listOfOptionals:y.listOfOptionals||null}};let w;if(n==="lead")w=await vt(d,x);else if(n==="opportunity")w=await gt(d,x);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:c,activity:w}}catch(c){throw console.error("Error saving trade-in vehicle:",c),c}},updateTradeInVehicle:async(n,d,v,y,c,x={})=>{try{const w=await l.modifyVehicle(v,c),m={data:{brand:c.brand,model:c.model,version:c.version||null,year:c.year,kilometers:c.kilometers||0,plates:c.plates||null,registration:c.registration||null,vin:c.vin||null,fuelType:c.fuelType||null,gearType:c.gearType||null,tradeInPrice:x.tradeInPrice||null,evaluationRangeLow:x.evaluationRangeLow||null,evaluationRangeHigh:x.evaluationRangeHigh||null,provider:x.provider||null,evaluationDate:x.evaluationDate||null,priceToBuy:x.priceToBuy||null,priceToSell:x.priceToSell||null,priceOfVehicle:x.priceOfVehicle||null,priceOfOptionals:x.priceOfOptionals||null,listOfOptionals:x.listOfOptionals||null}};let C;if(n==="lead")C=await mt(d,y,m);else if(n==="opportunity")C=await pt(d,y,m);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:w,activity:C}}catch(w){throw console.error("Error updating trade-in vehicle:",w),w}}}}function H(l){if(!l)return 0;const u=new Date(l),n=Math.abs(new Date-u);return Math.ceil(n/(1e3*60*60*24))}const Ie={"no-appointment":l=>!l.scheduledAppointment,"has-appointment":l=>!!l.scheduledAppointment,"appointment-past-not-completed":l=>l.scheduledAppointment?new Date(l.scheduledAppointment.start)<new Date&&l.scheduledAppointment.status!=="completed":!1,"has-future-appointment":l=>l.scheduledAppointment?new Date(l.scheduledAppointment.start)>new Date:!1,"no-offers":l=>!l.hasOffers,"has-offers":l=>l.hasOffers,"qualified-no-offers-7-13-days":l=>{var y;const u=fe(),o=u.getSetting("oofbMinDays"),n=u.getSetting("oofbMaxDays"),d=(y=l.opportunity.postponedTasks)==null?void 0:y.oofb;if(d){const c=H(d),x=u.getSetting("postponeTaskDays")||7;if(c<x)return!1;const w=H(d);return w>=o&&w<n+1&&!l.hasOffers}const v=H(l.opportunity.createdAt);return v>=o&&v<n+1&&!l.hasOffers},"qualified-no-offers-14-plus-days":l=>{var v;const u=fe(),o=u.getSetting("ufbDays"),n=(v=l.opportunity.postponedTasks)==null?void 0:v.ufb;if(n){const y=H(n),c=u.getSetting("postponeTaskDays")||7;return y<c?!1:H(n)>=o&&!l.hasOffers}return H(l.opportunity.createdAt)>=o&&!l.hasOffers},"negotiation-offer-sent-substatus":l=>{var u;return((u=l.opportunity)==null?void 0:u.negotiationSubstatus)==="Offer Sent"},"negotiation-contract-pending-substatus":l=>{var u,o;return((u=l.opportunity)==null?void 0:u.contractDate)!==null&&((o=l.opportunity)==null?void 0:o.contractDate)!==void 0},"negotiation-offer-feedback-substatus":l=>{var u;return((u=l.opportunity)==null?void 0:u.negotiationSubstatus)==="Offer Feedback"},"negotiation-5-plus-days-no-contract-has-offers":l=>{var u;if(((u=l.opportunity)==null?void 0:u.id)===33){if(!l.hasOffers||l.opportunity.contractDate)return!1;const o=l.opportunity.lastActivity||l.opportunity.createdAt;return o?H(o)>=5:!1}return!1},"contract-pending-5-plus-days":l=>{var x;const u=l.opportunity,o=w=>!!(w!=null&&w.contractSigned||w!=null&&w.esignatureCollectedDate);let n=!1,d=null;if(Array.isArray(u==null?void 0:u.contracts)&&u.contracts.length>0){const w=u.contracts.filter(o);n=w.length>0,n&&(d=w.reduce((C,f)=>{const k=f.esignatureCollectedDate||f.contractDate;return k?C?new Date(k)>new Date(C)?k:C:k:C},null))}else n=!!(u!=null&&u.contractSigned||u!=null&&u.esignatureCollectedDate),d=(u==null?void 0:u.contractDate)||(u==null?void 0:u.esignatureCollectedDate);if(!n||!d)return!1;const v=fe(),y=v.getSetting("cfbDays")||5,c=(x=u.postponedTasks)==null?void 0:x.cfb;if(c){const w=H(c),m=v.getSetting("postponeTaskDays")||7;return w<m?!1:H(c)>=y}try{const w=new Date(d);return isNaN(w.getTime())?!1:H(w.toISOString())>=y}catch{return!1}},"closed-won-contract-feedback":l=>{var v,y;const u=(v=l.opportunity)==null?void 0:v.contractDate;if(!u||u===null||u===void 0||u==="")return!1;const o=fe(),n=o.getSetting("cfbDays")||5,d=(y=l.opportunity.postponedTasks)==null?void 0:y.cfb;if(d){const c=H(d),x=o.getSetting("postponeTaskDays")||7;return c<x?!1:H(d)>=n}try{const c=new Date(u);return isNaN(c.getTime())?!1:H(c.toISOString())>=n}catch{return!1}},"negotiation-offer-feedback-5-plus-days-no-appointment":l=>{var y,c;if(((y=l.opportunity)==null?void 0:y.negotiationSubstatus)!=="Offer Feedback"||!l.hasOffers)return!1;const u=fe(),o=u.getSetting("nfuDays"),n=(c=l.opportunity.postponedTasks)==null?void 0:c.nfu;if(n){const x=H(n),w=u.getSetting("postponeTaskDays")||7;if(x<w)return!1;const m=H(n),C=l.scheduledAppointment&&new Date(l.scheduledAppointment.start)>new Date;return m>=o&&!l.opportunity.contractDate&&!C}const d=H(l.opportunity.lastActivity||l.opportunity.createdAt),v=l.scheduledAppointment&&new Date(l.scheduledAppointment.start)>new Date;return d>=o&&!l.opportunity.contractDate&&!v},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":l=>Ie["negotiation-offer-feedback-5-plus-days-no-appointment"](l),"contract-7-plus-days-no-delivery":l=>{var y,c,x;if(!l.opportunity.contractDate)return!1;const u=fe(),o=u.getSetting("cfbDays"),n=(y=l.opportunity.postponedTasks)==null?void 0:y.cfb;if(n){const w=H(n),m=u.getSetting("postponeTaskDays")||7;if(w<m)return!1;const C=H(n),f=(c=l.activities)==null?void 0:c.some(k=>{var P;return k.type==="delivery"||((P=k.action)==null?void 0:P.toLowerCase().includes("delivered"))});return C>=o&&!f}const d=H(l.opportunity.contractDate),v=(x=l.activities)==null?void 0:x.some(w=>{var m;return w.type==="delivery"||((m=w.action)==null?void 0:m.toLowerCase().includes("delivered"))});return d>=o&&!v},"delivery-delay-feedback-required":l=>{var y,c,x,w;if(l.deliverySubstatus!=="Awaiting Delivery"||!l.opportunity.deliveryDate||l.opportunity.actualDeliveryDate||((x=(c=(y=l.activities)==null?void 0:y.find(m=>{var C;return(C=m.data)==null?void 0:C.actualDeliveryDate}))==null?void 0:c.data)==null?void 0:x.actualDeliveryDate))return!1;const o=fe(),n=o.getSetting("dfbDays")||3,d=(w=l.opportunity.postponedTasks)==null?void 0:w.dfb;if(d){const m=H(d),C=o.getSetting("postponeTaskDays")||7;return m<C?!1:H(d)>=n}return H(l.opportunity.deliveryDate)>=n},"delivery-feedback-required":l=>{var y,c,x,w,m,C,f;if(l.deliverySubstatus!=="Delivered")return!1;const u=l.opportunity.actualDeliveryDate||l.opportunity.deliveredDate||((x=(c=(y=l.activities)==null?void 0:y.find(k=>{var P;return(P=k.data)==null?void 0:P.actualDeliveryDate}))==null?void 0:c.data)==null?void 0:x.actualDeliveryDate)||((C=(m=(w=l.activities)==null?void 0:w.find(k=>{var P;return(P=k.data)==null?void 0:P.deliveredDate}))==null?void 0:m.data)==null?void 0:C.deliveredDate);if(!u)return!1;const o=fe(),n=o.getSetting("dfbDays")||3,d=(f=l.opportunity.postponedTasks)==null?void 0:f.dfb;if(d){const k=H(d),P=o.getSetting("postponeTaskDays")||7;return k<P?!1:H(d)>=n}return H(u)>=n},"is-awaiting-delivery":l=>l.deliverySubstatus==="Awaiting Delivery","is-delivered":l=>l.deliverySubstatus==="Delivered","has-no-delivery":l=>!l.deliverySubstatus||l.deliverySubstatus===null,"is-closed":l=>{const u=l.stage;return u==="Closed Won"||u==="Closed Lost"},"is-closed-with-task-widget":l=>Ie["is-closed"](l)&&l.hasActiveTaskWidget,"opportunity-abandoned":l=>{if(Ie["is-closed"](l))return!1;const u=fe(),o=u.getSetting("abandonedOpportunityDays");if(!u.getSetting("abandonedEligibleStages").includes(l.stage))return!1;const d=l.opportunity.lastActivity||l.opportunity.createdAt;return H(d)>=o}};function oi(l,u){if(Ie["is-closed-with-task-widget"](u))return[qe.reopen,qe.requalify,qe.closeLost,{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}];const o=je[l];if(!o||!o.secondaryActions)return[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}];const n=o.secondaryActions.filter(v=>{if(!v.conditional)return!0;const y=Ie[v.conditional];return y?y(u):!0});return n.some(v=>v.key==="schedule-appointment")||n.push({key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",description:"Schedule a new appointment"}),n}function ni(l,u){const o=je[l];if(!o||!o.taskWidgets||u.opportunity.skipTaskReTrigger)return null;const d=fe().getSetting("autoCloseWidgetsOnClose"),v=Ie["is-closed"]({stage:l});for(const y of o.taskWidgets){if(d&&v&&(y.type==="NFU"||y.type==="OFB"))continue;const c=Ie[y.condition];if(c&&c(u))return y.type}return null}function ri(l,u){const o=je[l];if(!o||!o.primaryAction)return null;let n=o.primaryAction;return typeof n=="function"&&(n=n(u),!n)?null:{...n,title:typeof n.title=="function"?n.title(u):n.title,description:typeof n.description=="function"?n.description(u):n.description,label:typeof n.label=="function"?n.label(u):n.label}}function ii(l){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Post-Delivery Customer Satisfaction Survey",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[l]||"Task"}function di(l){return l==="Closed Won"||l==="Closed Lost"}const tr={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center rounded-lg"},lr={key:2,class:"absolute top-1 right-1 z-30"},sr=["onClick"],ar=["src"],or={key:1,class:"fa-solid fa-car text-base text-muted-foreground"},nr={class:"flex-1 space-y-1"},rr={class:"flex flex-wrap gap-1 mt-1"},ir=["title"],dr=["title"],ur={class:"mt-auto pt-1"},cr={key:4,class:"absolute bottom-0 left-0 right-0 z-10 bg-green-600/90 text-white text-[10px] font-medium px-2 py-1.5 flex items-center justify-between pointer-events-none"},fr={key:0,class:"opacity-90"},mr={__name:"OfferCard",props:{offer:{type:Object,required:!0},variant:{type:String,default:"carousel",validator:l=>["carousel","feed"].includes(l)},showStatusBadge:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showDate:{type:Boolean,default:!0},showAcceptanceInfo:{type:Boolean,default:!0},showAcceptanceBadge:{type:Boolean,default:!0},menuItems:{type:Array,default:()=>[]},containerClass:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["menu-action"],setup(l,{emit:u}){const o=l,n=L(null),d=L({}),v=L({}),y=E(()=>o.offer.status==="accepted"||o.offer.acceptance_status==="accepted"),c=E(()=>(o.variant==="carousel","h-16")),x=E(()=>o.variant==="carousel"?"p-2":"p-3"),w=E(()=>o.variant==="carousel"?"h-[105px]":""),m=E(()=>o.variant==="carousel"?"text-xs":"text-sm"),C=E(()=>o.variant==="carousel"?"text-xs":"text-sm"),f=E(()=>(o.variant==="carousel","text-xs")),k=(U,B)=>{B&&(d.value[U]=B)},P=()=>{if(o.menuItems.length===0)return 120;const U=document.createElement("span");U.style.visibility="hidden",U.style.position="absolute",U.style.fontSize="0.75rem",U.style.padding="0 12px",U.style.whiteSpace="nowrap",document.body.appendChild(U);let B=0;return o.menuItems.forEach(se=>{U.textContent=se.label;const te=U.offsetWidth;te>B&&(B=te)}),document.body.removeChild(U),Math.max(B+24,120)},q=U=>{const B=d.value[U];if(!B)return;const se=B.getBoundingClientRect(),te=P();v.value[U]={top:se.bottom+4,left:se.right-te,width:te}},Y=async U=>{n.value===U?(n.value=null,delete v.value[U]):(n.value=U,await xt(),q(U))},ee=()=>{n.value=null,v.value={}};let W=null,O=null;ae(n,U=>{if(W&&(window.removeEventListener("scroll",W,!0),window.removeEventListener("resize",O),W=null,O=null),U){const B=()=>{U&&d.value[U]&&q(U)};W=B,O=B,window.addEventListener("scroll",W,!0),window.addEventListener("resize",O)}});const A=U=>U?new Intl.NumberFormat("en-US").format(U):"0",G=U=>{if(!U)return"";const B=new Date(U),te=Math.abs(new Date-B),he=Math.ceil(te/(1e3*60*60*24));return he===0?"today":he===1?"yesterday":he<7?`${he} days ago`:B.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},S=U=>({active:"Active",accepted:"Accepted",archived:"Archived"})[U]||"Active",g=U=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[U]||"bg-gray-600",a=U=>y.value?"border-green-500 border-2":"border-border",Q=U=>U.status==="archived"?"opacity-60":"",z=U=>{const B=U.vehicleBrand||"",se=U.vehicleModel||"",te=U.vehicleYear||"";return B&&se&&te?`${B} ${se} (${te})`:B&&se?`${B} ${se}`:"Vehicle"},ue=U=>U.price||0,oe=()=>o.offer.acceptance_date||o.offer.acceptedAt||o.offer.accepted_at||null;return(U,B)=>{var te,he,Re,Ne,ze;const se=Xe("click-outside");return p(),h("div",{class:j(["bg-white border rounded-lg shadow-nsc-card overflow-visible transition-shadow relative",a(l.offer),Q(l.offer),l.containerClass,{"pointer-events-none opacity-60":l.loading}])},[l.loading?(p(),h("div",tr,[...B[2]||(B[2]=[s("div",{class:"flex flex-col items-center gap-2"},[s("div",{class:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),s("span",{class:"text-xs text-muted-foreground"},"Updating...")],-1)])])):D("",!0),l.showStatusBadge&&!(y.value&&l.showAcceptanceBadge)?(p(),h("div",{key:1,class:j(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",g(l.offer.status)])},T(S(l.offer.status)),3)):D("",!0),l.showMenu?(p(),h("div",lr,[s("button",{ref:xe=>k(l.offer.id,xe),onClick:B[0]||(B[0]=Me(xe=>Y(l.offer.id),["stop"])),title:"Offer actions",class:"relative z-30 w-6 h-6 flex items-center justify-center text-foreground hover:bg-black/10 bg-white/60 backdrop-blur-sm rounded-md transition-colors shadow-sm border border-black/5"},[t(e(Ft),{size:14})],512)])):D("",!0),l.showMenu?(p(),_(bt,{key:3,to:"body"},[n.value===l.offer.id&&v.value[l.offer.id]?Oe((p(),h("div",{key:0,class:"fixed z-[9999] bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",style:yt({top:`${v.value[l.offer.id].top}px`,left:`${v.value[l.offer.id].left}px`,width:`${v.value[l.offer.id].width}px`,minWidth:"120px"}),onClick:B[1]||(B[1]=Me(()=>{},["stop"]))},[(p(!0),h(K,null,J(l.menuItems,xe=>(p(),h("button",{key:xe.key,onClick:()=>{xe.onClick(),ee()},class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2",style:{"font-size":"0.75rem","line-height":"1.5"}},T(xe.label),9,sr))),128))],4)),[[se,ee]]):D("",!0)])):D("",!0),s("div",{class:j(["w-full bg-muted flex items-center justify-center overflow-hidden",c.value])},[(te=l.offer.data)!=null&&te.image||l.offer.image?(p(),h("img",{key:0,src:((he=l.offer.data)==null?void 0:he.image)||l.offer.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,ar)):(p(),h("i",or))],2),s("div",{class:j(["flex flex-col",x.value,w.value,{"pb-10":y.value}])},[s("div",nr,[s("h4",{class:j(["font-bold text-foreground leading-tight line-clamp-2",m.value])},T(z(l.offer)),3),s("p",{class:j(["font-bold text-foreground",C.value])},"â‚¬ "+T(A(ue(l.offer))),3),s("div",rr,[(Re=l.offer.data)!=null&&Re.selectedFinancingLabel?(p(),h("div",{key:0,class:"flex items-center gap-0.5 px-1 py-0.5 bg-purple-50 text-purple-700 text-[8px] font-bold rounded border border-purple-100 uppercase tracking-tighter",title:l.offer.data.selectedFinancingLabel},[t(e($t),{size:8}),B[3]||(B[3]=s("span",null,"Financing",-1))],8,ir)):D("",!0),((ze=(Ne=l.offer.data)==null?void 0:Ne.tradeIn)==null?void 0:ze.valuation)>0?(p(),h("div",{key:1,class:"flex items-center gap-0.5 px-1 py-0.5 bg-blue-50 text-blue-700 text-[8px] font-bold rounded border border-blue-100 uppercase tracking-tighter",title:l.offer.data.selectedTradeInLabel||"Trade-in"},[t(e(ht),{size:8}),B[4]||(B[4]=s("span",null,"Trade-in",-1))],8,dr)):D("",!0)])]),s("div",ur,[l.showDate&&l.offer.createdAt&&!(y.value&&l.showAcceptanceBadge)?(p(),h("p",{key:0,class:j(["text-muted-foreground",f.value])},T(G(l.offer.createdAt)),3)):D("",!0)])],2),l.showAcceptanceBadge&&y.value?(p(),h("div",cr,[B[5]||(B[5]=s("span",{class:"flex items-center gap-1"},[s("i",{class:"fa-solid fa-check-circle"}),b(" Accepted ")],-1)),oe()?(p(),h("span",fr,T(G(oe())),1)):D("",!0)])):D("",!0)],2)}}},pr={key:0},vr={class:"flex items-center justify-between mb-2"},gr={class:"flex items-center gap-2"},yr={class:"font-semibold text-foreground text-sm"},br={class:"relative"},hr={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},xr={class:"w-8 h-8 rounded-full bg-background border border-border flex items-center justify-center text-muted-foreground group-hover:text-foreground transition-colors shadow-sm"},kr={key:1,class:"text-center py-6 px-3 bg-muted border border-border rounded-lg"},wr={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted","generate-pdf","offer-activated","add"],setup(l,{expose:u,emit:o}){const n=o,d=L(new Set),v=(c,x)=>{x?d.value.add(c):d.value.delete(c)},y=c=>{const x=[],w=c.status==="accepted"||c.acceptance_status==="accepted";return c.status!=="active"&&x.push({key:"set-active",label:"Set active",onClick:()=>{v(c.id,!0),n("offer-activated",c)}}),w?x.push({key:"remove-accepted",label:"Remove acceptance",onClick:()=>{v(c.id,!0),n("offer-accepted",c,!0)}}):x.push({key:"set-accepted",label:"Set accepted",onClick:()=>{v(c.id,!0),n("offer-accepted",c)}}),x.push({key:"send-offer-pdf",label:"Send Offer PDF",onClick:()=>{n("generate-pdf",c)}}),x};return u({setOfferLoading:v}),(c,x)=>l.offers&&l.offers.length>0?(p(),h("div",pr,[s("div",vr,[s("div",gr,[s("h3",yr,"Offers ("+T(l.offers.length)+")",1)])]),s("div",br,[s("div",hr,[(p(!0),h(K,null,J(l.offers,w=>(p(),_(mr,{key:`offer-${w.id}-${w.status}-${w.acceptance_status||"none"}`,offer:w,variant:"carousel","menu-items":y(w),loading:d.value.has(w.id),"container-class":"flex-none w-36 snap-start"},null,8,["offer","menu-items","loading"]))),128)),s("button",{class:"flex-none w-36 h-[171px] snap-start bg-muted/50 border-2 border-dashed border-border rounded-lg flex flex-col items-center justify-center gap-2 hover:bg-muted/80 transition-colors group",onClick:x[0]||(x[0]=w=>c.$emit("add"))},[s("div",xr,[t(e(Ve),{size:20})]),x[1]||(x[1]=s("span",{class:"text-[10px] font-medium text-muted-foreground group-hover:text-foreground uppercase tracking-wider"},"New Offer",-1))])])])])):(p(),h("div",kr,[...x[2]||(x[2]=[s("i",{class:"fa-solid fa-file-invoice text-2xl text-muted-foreground mb-2"},null,-1),s("p",{class:"text-xs font-medium text-muted-foreground"},"No offers created yet",-1),s("p",{class:"text-xs text-muted-foreground mt-0.5"},"Create an offer to start negotiations",-1)])]))}},ui=Je(wr,[["__scopeId","data-v-aefed0c9"]]);export{ys as $,li as A,si as B,Tr as C,Pr as D,Dt as E,ai as F,ni as G,ri as H,Ar as I,oi as J,di as K,Le as L,Ft as M,ii as N,je as O,Ot as P,Ze as Q,$t as R,Ur as S,Br as T,Ie as U,To as V,Xn as W,ui as X,As as Y,Cs as Z,Nr as _,Ge as a,tt as a0,Lt as a1,Pt as a2,At as a3,Mt as a4,Mr as b,Lr as c,Or as d,Rr as e,Dr as f,Fr as g,Tt as h,Vt as i,zr as j,Er as k,qr as l,jr as m,_r as n,Wr as o,Hr as p,Qr as q,Yr as r,Gr as s,Kr as t,Zr as u,lt as v,Jr as w,Xr as x,ei as y,ti as z};
