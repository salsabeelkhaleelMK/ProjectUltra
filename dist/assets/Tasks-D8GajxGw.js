const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/opportunities-XVgMwMKa.js","assets/index-DmX4Eg8G.js","assets/index-Dr28XGEp.css"])))=>i.map(i=>d[i]);
import{E as ke,G as xt,H as ds,c as A,I as Lt,r as D,J as wt,d as v,o as u,g as T,p as re,e,w as at,x as P,y as n,P as kt,t as N,n as U,_ as De,s as C,D as O,T as ft,l as we,K as ge,F as ye,i as ve,L as xe,M as Le,N as pe,O as it,j as lt,k as _,R as rt,q as Tt,U as us,S as cs,V as ps,W as ms,X as pt,h as Ct,C as Je,u as Fe,Y as Qe,Z as ot,v as Ge,Q as ne,$ as fs,a0 as ys,a1 as _e,a2 as tt,a3 as gs,z as mt,m as St,a4 as vs}from"./index-DmX4Eg8G.js";import{a as yt}from"./opportunities-XVgMwMKa.js";import{u as dt}from"./users-dEiHtx0c.js";import{g as $t,f as At,a as Ye,b as st,c as Bt,d as Ft}from"./formatters-B1RFjlNy.js";import{L as It,O as Ot,_ as bs,E as hs,T as xs,i as ws,g as ks,a as Cs,s as Ss,b as $s,c as As,d as Ds,e as bt,f as Ts,h as Is,j as Os,u as Ns,k as Ms,P as qs,l as Es,m as Ls,n as Bs,o as Fs,p as Rs,q as js,r as Vs,t as Us}from"./ComingSoonModal-BgE-ZfRd.js";import{y as Ws}from"./components-NGMN9vly.js";import{n as Ee,V as zs,R as Hs,z as Ps,a as Re,F as je,L as Ve,H as Ue,j as We,C as ze,W as He,K as gt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-B0oMcpqR.js";import{_ as Rt}from"./ReassignUserModal-DFvSPDBS.js";import{f as jt}from"./vehicles-zB6Q3ssr.js";import{_ as Qs}from"./CreateEventModal-CyvGeC8X.js";import{_ as _s,a as Ys}from"./EditEventModal-BCl8NtYK.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=ke("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=ke("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=ke("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=ke("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=ke("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=ke("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ke("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ke("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=ke("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=ke("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=ke("PaperclipIcon",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=ke("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ke("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=ke("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=ke("TagIcon",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function an(t){if(!t)return"Action Required";if(t.title)return t.title;const m=t.type||(t.customer?"opportunity":"lead"),s=xt(t,m);if(m==="lead"){const a=(It[s]||It.New).primaryAction;if(a){const i=typeof a=="function"?a({lead:t,displayStage:s}):a;return i.label||i.title||"Follow up"}}if(m==="opportunity"){const a=(Ot[s]||Ot.Qualified).primaryAction;if(a){const i=typeof a=="function"?a({deliverySubstatus:t.deliverySubstatus||ds(t,t.activities||[]),hasOffers:!!(t.offers&&t.offers.length>0)||!!(t.activities&&t.activities.some(l=>l.type==="offer")),scheduledAppointment:t.scheduledAppointment,formatDateTime:l=>new Date(l).toLocaleDateString()}):a;return i.label||i.title||"Update Opportunity"}}return"Action Required"}const ln={key:1,class:"absolute right-2 top-7 z-50"},on={class:"flex flex-col min-w-0 pr-4"},rn={class:"font-bold text-heading text-fluid-base truncate mb-0.5"},dn={class:"flex items-center gap-2 overflow-hidden"},un={class:"text-sub text-fluid-sm truncate"},cn={class:"flex flex-wrap gap-2 mt-2"},pn={key:1,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},mn={key:2,class:"shrink-0 ml-auto self-start mt-1"},fn={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:m}){const s=t,r=A(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),a=A(()=>s.selected),i=A(()=>a.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),l=A(()=>{const c=s.item.displayStage||s.item.stage;return c?Lt(c,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),o=A(()=>an(s.item)),d=A(()=>{const c=s.item.nextActionDue||s.item.dueDate;if(!c)return null;const f=$t(c);return{text:At(c),status:f}}),p=D(null);return(c,f)=>{const y=wt("click-outside");return u(),v("div",{ref_key:"cardRef",ref:p,onClick:f[1]||(f[1]=x=>c.$emit("select",r.value)),class:U(["bg-white rounded-xl p-4 flex items-center justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-all border group",i.value])},[t.showMenu?(u(),v("button",{key:0,onClick:f[0]||(f[0]=at(x=>c.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity z-10"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):T("",!0),t.openMenuId===t.item.id&&t.showMenu?re((u(),v("div",ln,[t.menuItems&&t.menuItems.length>0?(u(),P(n(kt),{key:0,items:t.menuItems,className:"w-40 text-xs"},null,8,["items"])):T("",!0)])),[[y,()=>c.$emit("menu-close")]]):T("",!0),e("div",on,[e("h3",rn,N(o.value),1),e("div",dn,[e("span",un,N(t.getName(t.item)),1)]),e("div",cn,[e("span",{class:U(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},N(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(u(),v("span",{key:0,class:U(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",l.value])},N(t.item.displayStage||t.item.stage),3)):T("",!0),t.item.priority==="Hot"?(u(),v("span",pn," Hot ")):T("",!0)])]),d.value?(u(),v("div",mn,[e("span",{class:U(["px-3 py-1 rounded-lg text-[11px] font-bold border whitespace-nowrap",[d.value.status.bgClass,d.value.status.textClass,d.value.status.borderClass]])},N(d.value.text),3)])):T("",!0)],2)}}},yn={class:"flex items-center gap-2"},gn={key:0,class:"flex gap-2"},vn={class:"relative ml-auto",ref:"sortContainer"},bn={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-brand-dark"},hn={key:0,class:"absolute right-0 mt-2 z-50 sort-dropdown-wrapper"},xn={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:m}){const s=t,r=m,a=D(!1),i=()=>{a.value=!a.value},l=d=>{a.value=!1,r("sort-change",d)},o=A(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>l("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>l("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>l("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>l("assigned-to-my-team")}].map(p=>({...p,className:p.key===s.sortOption?"sort-item-selected":""})));return(d,p)=>{const c=wt("click-outside");return u(),v("div",yn,[t.showTypeFilter?(u(),v("div",gn,[e("button",{onClick:p[0]||(p[0]=f=>d.$emit("filter-change","all")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:p[1]||(p[1]=f=>d.$emit("filter-change","lead")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:p[2]||(p[2]=f=>d.$emit("filter-change","opportunity")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):T("",!0),e("div",vn,[e("button",{onClick:at(i,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[p[3]||(p[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(u(),v("span",bn)):T("",!0)]),C(ft,{name:"dropdown"},{default:O(()=>[a.value?re((u(),v("div",hn,[C(n(kt),{items:o.value,className:"w-56"},null,8,["items"])])),[[c,()=>a.value=!1]]):T("",!0)]),_:1})],512)])}}},wn=De(xn,[["__scopeId","data-v-dba5cff9"]]),kn={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},Cn={class:"page-header shrink-0"},Sn={class:"page-header-main"},$n={class:"page-header-content"},An={class:"page-header-title-container"},Dn={class:"page-header-title"},Tn={class:"page-header-actions"},In={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},On={class:"px-5 py-3"},Nn={class:"relative"},Mn=["placeholder"],qn={key:0,class:"px-5 pb-3"},En={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},typeFilter:{type:String,default:"all"},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:t=>t.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},showTypeFilter:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:m}){const s=t,r=m,a=D(s.initialSearchQuery),i=D(null),l=D("recent-first");we(()=>s.initialSearchQuery,c=>{a.value=c});const o=A(()=>{if(!a.value.trim())return s.items;const c=a.value.toLowerCase().trim();return s.items.filter(f=>{const y=s.getName(f).toLowerCase(),x=s.getVehicleInfo(f).toLowerCase();return y.includes(c)||x.includes(c)})}),d=c=>s.selectedId?(c.compositeId||`${c.type||"task"}-${c.id}`)===s.selectedId:!1,p=c=>{l.value=c,r("sort-change",c)};return(c,f)=>(u(),v("div",kn,[e("header",Cn,[e("div",Sn,[e("div",$n,[e("div",An,[e("h1",Dn,N(t.title),1)]),e("div",Tn,[e("div",In,[e("button",{onClick:f[0]||(f[0]=y=>c.$emit("view-change","table")),class:U(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[C(n(Wt),{size:14})],2),e("button",{onClick:f[1]||(f[1]=y=>c.$emit("view-change","card")),class:U(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[C(n(Vt),{size:14})],2)])])])])]),e("div",On,[e("div",Nn,[f[7]||(f[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),re(e("input",{"onUpdate:modelValue":f[2]||(f[2]=y=>a.value=y),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,Mn),[[ge,a.value]])])]),t.showTypeFilter?(u(),v("div",qn,[C(wn,{"type-filter":t.typeFilter,"sort-option":l.value,"show-type-filter":!0,onFilterChange:f[3]||(f[3]=y=>c.$emit("filter-change",y)),onSortChange:p},null,8,["type-filter","sort-option"])])):T("",!0),e("div",{ref_key:"scrollContainer",ref:i,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(u(!0),v(ye,null,ve(o.value,y=>(u(),P(fn,{key:y.compositeId||`${y.type||"task"}-${y.id}`,item:y,selected:d(y),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(y):null,onSelect:f[4]||(f[4]=x=>c.$emit("select",x)),onMenuClick:f[5]||(f[5]=x=>c.$emit("menu-click",x)),onMenuClose:f[6]||(f[6]=x=>c.$emit("menu-close"))},{location:O(({item:x})=>[xe(c.$slots,"location",{item:x},void 0,!0)]),source:O(({item:x})=>[xe(c.$slots,"source",{item:x},void 0,!0)]),owner:O(({item:x})=>[xe(c.$slots,"owner",{item:x},void 0,!0)]),dates:O(({item:x})=>[xe(c.$slots,"dates",{item:x},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},Ln=De(En,[["__scopeId","data-v-659cd328"]]);function zt(t,m=[],s,r){const a=Le(),i=a.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},l=a.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},o=Bn(t,m),d=Fn(t,m),p=Rn(t),c=jn(t),f=i.intent+i.behavioral+i.temporal,y={intent:i.intent/f*100,behavioral:i.behavioral/f*100,temporal:i.temporal/f*100},x=o/40*y.intent,w=d/35*y.behavioral,$=p/25*y.temporal,q=Math.min(100,Math.max(0,x+w+$+c));let g="COLD";return q>=l.hot?g="HOT":q>=l.warm?g="WARM":q>=l.standard&&(g="STANDARD"),{score:Math.round(q*10)/10,level:g,breakdown:{intent:Math.round(o*10)/10,behavioral:Math.round(d*10)/10,temporal:Math.round(p*10)/10,quality:Math.round(c*10)/10,total:Math.round(q*10)/10}}}function Bn(t,m){var r;let s=0;return(t.requestType==="Test Drive"||((r=t.scheduledAppointment)==null?void 0:r.type)==="test-drive"||m.some(a=>a.type==="test-drive"||a.type==="appointment"))&&(s=Math.max(s,40)),m.some(a=>a.type==="financing")&&(s=Math.max(s,35)),m.some(a=>a.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||m.some(a=>{var i,l,o;return((i=a.content)==null?void 0:i.toLowerCase().includes("location"))||((l=a.content)==null?void 0:l.toLowerCase().includes("dealership"))||((o=a.content)==null?void 0:o.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||m.some(a=>{var i,l;return((i=a.content)==null?void 0:i.toLowerCase().includes("configur"))||a.type==="attachment"&&((l=a.fileName)==null?void 0:l.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),m.some(a=>{var l;const i=((l=a.content)==null?void 0:l.toLowerCase())||"";return i.includes("compare")||i.includes("versus")||i.includes("vs")||i.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function Fn(t,m){let s=0;const r=new Set(m.map(o=>{if(!o.timestamp)return null;const d=new Date(o.timestamp);return`${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`}).filter(Boolean)),a=Math.min(r.size*10,35);s+=a,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const i=m.reduce((o,d)=>{var p;return o+(((p=d.content)==null?void 0:p.length)||0)},0),l=Math.min(Math.floor(i/50),25);return s+=l,m.some(o=>{var d,p,c;return o.type==="attachment"&&(((d=o.fileName)==null?void 0:d.toLowerCase().includes("brochure"))||((p=o.fileName)==null?void 0:p.toLowerCase().includes("spec"))||((c=o.fileName)==null?void 0:c.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function Rn(t){let m=0;if(!t.createdAt)return 0;const s=new Date,r=new Date(t.createdAt),a=(s.getTime()-r.getTime())/(1e3*60*60);a<2?m+=25:a<24?m+=15:a<48?m+=5:m-=10;const i=r.getDay(),l=r.getHours();if((i===0||i===6||l<9||l>17)&&(m+=10),t.contactAttempts&&t.contactAttempts.length===3&&(m+=50),t.lastActivity){const o=new Date(t.lastActivity);(s.getTime()-o.getTime())/(1e3*60*60*24)>3&&(m+=20)}return Math.min(Math.max(m,0),25)}function jn(t){var s,r,a,i,l,o,d;let m=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(m+=10),(r=t.customer)!=null&&r.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(m+=10),(a=t.customer)!=null&&a.name&&((i=t.customer)!=null&&i.email)&&((l=t.customer)!=null&&l.phone)&&((o=t.customer)!=null&&o.address)&&(m+=5),(t.isDuplicate||t.isDisqualified||!((d=t.customer)!=null&&d.name))&&(m-=20),m}function Ht(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Pt(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Vn({typeFilter:t,showTypeFilter:m,tasks:s}){return{filterDefinitions:A(()=>{const a=[];m.value&&a.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),a.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),a.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&a.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),a.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const i=[...new Set(s.value.map(o=>o.assignee).filter(Boolean))];i.length>0&&a.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:i.map(o=>({value:o,label:o})),aiHint:"Person assigned to the task",pinned:!0});const l=[...new Set(s.value.map(o=>{const d=o.type==="lead"?o.requestedCar:o.vehicle;return d==null?void 0:d.brand}).filter(Boolean))];return l.length>0&&a.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:l.map(o=>({value:o,label:o})),aiHint:"Car brand requested by customer"}),a.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),a})}}const Un={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},Wn={class:"page-header shrink-0"},zn={class:"page-header-main"},Hn={class:"page-header-content"},Pn={class:"page-header-actions"},Qn={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},_n={class:"flex-1 overflow-y-auto p-4 md:p-8"},Yn={class:"table-wrapper w-full"},Jn={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:m}){const s=t,r=m,a=Le();D("");const i=D({pageIndex:0,pageSize:10}),l=D(""),o=D([]),d=D([]);D({});const{filterDefinitions:p}=Vn({typeFilter:A(()=>s.typeFilter),showTypeFilter:A(()=>s.showTypeFilter),tasks:A(()=>s.tasks)}),c=A(()=>s.tasks),f=b=>b.compositeId===s.currentTaskId||b.compositeId===s.highlightId,y=b=>{if(b.type==="lead")return b.requestedCar?`${b.requestedCar.brand} ${b.requestedCar.model}`:"No vehicle specified";const h=b.vehicle||b.requestedCar;return h?`${h.brand} ${h.model}`:"No vehicle specified"},x=b=>{const h=b.type==="lead"?b.requestedCar:b.vehicle;if(!h)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const S=h.stockDays!==void 0&&h.stockDays!==null;return{status:S?"In Stock":"Out of Stock",class:S?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},w=b=>{var h;return b.type==="lead"?((h=b.requestedCar)==null?void 0:h.requestType)||b.requestType||"N/A":b.requestType||"Opportunity"},$=A(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:b=>q(b.original)},cell:({row:b})=>{const h=b.original,S=h.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${S}`},h.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:b})=>{const h=b.original;return pe("div",{class:"flex items-center gap-2 md:gap-3"},[pe("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${h.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},h.customer.initials),pe("div",{class:"min-w-0"},[pe("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},h.customer.name),pe("div",{class:"text-meta truncate hidden sm:block"},h.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:b})=>{const h=b.original,S=y(h);return S==="No vehicle specified"?pe("span",{class:"text-meta"},"N/A"):pe("div",{class:"flex items-center gap-2"},[pe("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),pe("span",{class:"text-content font-medium text-heading truncate max-w-32"},S)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:b})=>{const h=b.original,S=x(h);return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${S.class}`},S.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:b})=>{const h=b.original,S=w(h);return pe("span",{class:"text-meta"},S)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:b})=>{const h=b.original;return pe("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},h.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:b})=>{const h=b.original,S=s.getOwnerInfo(h);return pe("div",{class:"flex items-center gap-2"},[pe("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},S.initials),pe("span",{class:"text-meta truncate max-w-20"},S.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:b})=>{const h=b.original,S=h.type==="lead"?h.status:h.displayStage||h.stage,F=s.getStageBadgeClass(S);return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${F}`},S)}},...s.typeFilter==="lead"&&a.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:b})=>{const h=b.original;if(h.type!=="lead")return pe("span",{class:"text-meta"},"â€”");let S=h.urgencyLevel;S||(S=zt(h).level);const F=Pt(S),H=Ht(S);return pe("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${F}`},[pe("span",{},H),pe("span",{},S)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:b})=>{const h=b.original;return pe("button",{class:"text-sub hover:text-body",onClick:S=>{S.stopPropagation(),r("menu-click",h.id)}},[pe("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),q=b=>{l.value=String(b.id),r("select",b.compositeId)},g=A(()=>({class:{tr:b=>{const h="cursor-pointer hover:bg-surfaceSecondary transition-colors",S=b.original;return f(S)?`${h} bg-blue-50 border-l-4 border-l-blue-500`:h}}}));return(b,h)=>(u(),v("div",Un,[e("header",Wn,[e("div",zn,[e("div",Hn,[h[8]||(h[8]=e("div",{class:"page-header-title-container"},[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Pn,[e("div",Qn,[e("button",{onClick:h[0]||(h[0]=S=>b.$emit("view-change","table")),class:U(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[C(n(Wt),{size:14})],2),e("button",{onClick:h[1]||(h[1]=S=>b.$emit("view-change","card")),class:U(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[C(n(Vt),{size:14})],2)]),e("button",{onClick:h[2]||(h[2]=S=>b.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...h[7]||(h[7]=[e("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),e("div",_n,[e("div",Yn,[C(n(Ws),{data:c.value,columns:$.value,meta:g.value,onRowClick:q,columnFiltersOptions:{filterDefs:n(p)},pagination:i.value,"onUpdate:pagination":h[3]||(h[3]=S=>i.value=S),globalFilter:l.value,"onUpdate:globalFilter":h[4]||(h[4]=S=>l.value=S),sorting:o.value,"onUpdate:sorting":h[5]||(h[5]=S=>o.value=S),columnFilters:d.value,"onUpdate:columnFilters":h[6]||(h[6]=S=>d.value=S),paginationOptions:{rowCount:c.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{"empty-state":O(()=>[...h[9]||(h[9]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Gn=De(Jn,[["__scopeId","data-v-20f2a5ef"]]),Kn={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border bg-surface"},Zn={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-black/5 bg-surface"},Xn={__name:"TaskDetailViewCompact",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},setup(t){return(m,s)=>t.task?(u(),v("div",Kn,[C(bs,it({task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},m.$attrs),null,16,["task","type","management-widget","store-adapter","add-new-config"])])):(u(),v("div",Zn,[...s[0]||(s[0]=[lt('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-sub"></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2">No task selected</h3><p class="text-fluid-sm text-sub">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},ea={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},ta={class:"flex items-center justify-between gap-4 w-full h-full"},sa={class:"flex flex-col gap-0.5 min-w-0"},na={class:"text-fluid-lg font-medium text-greys-900"},aa={key:0,class:"text-fluid-sm text-greys-500 truncate"},la={key:1,class:"text-fluid-sm text-greys-500"},oa={class:"flex items-center gap-2 shrink-0"},ia={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]}},emits:["previous","next"],setup(t){const m=t,s=A(()=>!m.task||!m.filteredTasks.length?!1:m.filteredTasks.findIndex(o=>{const d=m.task.compositeId||m.task.id;return(o.compositeId||o.id)===d})>0),r=A(()=>{if(!m.task||!m.filteredTasks.length)return!1;const l=m.filteredTasks.findIndex(o=>{const d=m.task.compositeId||m.task.id;return(o.compositeId||o.id)===d});return l>=0&&l<m.filteredTasks.length-1}),a=l=>l?l.type==="lead"?"Lead Qualification Task":l.type==="opportunity"?"Opportunity Management Task":"Task Details":"",i=l=>{var d;if(!l)return"";const o=[];if(l.vehicle||l.requestedCar){const p=l.vehicle||l.requestedCar;p.brand&&p.model?o.push(`${p.brand} ${p.model} (${p.year||"N/A"})`):p.model&&o.push(`${p.model} (${p.year||"N/A"})`)}return l.source&&o.push(l.source),(d=l.customer)!=null&&d.name?o.push(l.customer.name):l.customerName&&o.push(l.customerName),o.join(" â€¢ ")};return(l,o)=>(u(),v("div",ea,[e("div",ta,[e("div",sa,[e("h2",na,N(a(t.task)),1),t.task?(u(),v("p",aa,N(i(t.task)),1)):(u(),v("p",la," Select a task to view details "))]),e("div",oa,[C(n(Ee),{variant:"secondary",size:"icon",onClick:o[0]||(o[0]=d=>l.$emit("previous")),disabled:!s.value},{default:O(()=>[C(n(Gs),{size:16})]),_:1},8,["disabled"]),C(n(Ee),{variant:"secondary",size:"icon",onClick:o[1]||(o[1]=d=>l.$emit("next")),disabled:!r.value},{default:O(()=>[C(n(Ks),{size:16})]),_:1},8,["disabled"])])])]))}},ra=De(ia,[["__scopeId","data-v-8eea4260"]]),da={class:"grid grid-cols-3 gap-4"},ua={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},ca={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},pa={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},ma={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},fa={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},ya={class:"flex items-center gap-2 min-w-0 flex-1 justify-end"},ga={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0"},va={__name:"TaskInfoCards",props:{task:{type:Object,required:!0},type:{type:String,required:!0}},setup(t){const m=t,s=A(()=>m.task.displayStage?m.task.displayStage:m.task.stage?m.task.stage.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"N/A"),r=A(()=>m.task.assignee||m.task.owner||m.task.assignedTo||""),a=i=>{if(!i)return"U";const l=i.trim().split(" ");return l.length>=2?`${l[0][0]}${l[1][0]}`.toUpperCase():i.substring(0,2).toUpperCase()};return(i,l)=>(u(),v("div",da,[e("div",ua,[l[0]||(l[0]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Stage",-1)),e("p",ca,N(s.value),1)]),e("div",pa,[l[1]||(l[1]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Source",-1)),e("p",ma,N(t.task.source||"N/A"),1)]),e("div",fa,[l[2]||(l[2]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Owner",-1)),e("div",ya,[r.value?(u(),P(n(Hs),{key:0,class:"h-5 w-5 shrink-0"},{default:O(()=>[C(n(zs),{class:"bg-orange-500 text-white text-xs"},{default:O(()=>[_(N(a(r.value)),1)]),_:1})]),_:1})):T("",!0),e("p",ga,N(r.value||"Unassigned"),1)])])]))}},ba=De(va,[["__scopeId","data-v-abff1c03"]]),ha=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:t=>["lead","opportunity"].includes(t)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(t){return(m,s)=>(u(),v("div",null,[t.managementWidget?(u(),P(rt(t.managementWidget),it({key:0,lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:t.activities},m.$attrs),null,16,["lead","opportunity","activities"])):T("",!0)]))}}),xa=De(ha,[["__scopeId","data-v-f5db9491"]]),wa={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},ka={key:0,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100"},Ca=["src","alt"],Sa={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},$a={class:"space-y-2 mb-4"},Aa={class:"flex justify-between items-start gap-2"},Da={class:"min-w-0 flex-1"},Ta={class:"text-sm font-medium text-greys-900 truncate"},Ia={key:0,class:"text-xs text-greys-500"},Oa={key:0,class:"text-sm font-semibold text-greys-900 shrink-0"},Na={key:0,class:"flex gap-3 text-xs text-greys-500"},Ma={key:0},qa={key:1},Ea={key:2,class:"mb-4"},La={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ba={class:"text-sm text-greys-900"},Fa={class:"flex gap-2 pt-4 border-t border-black/5"},Ra={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(t){const m=t,s=D(!1),r=A(()=>{const o=[];return m.vehicle.brand&&o.push(m.vehicle.brand),m.vehicle.model&&o.push(m.vehicle.model),m.vehicle.variant&&o.push(m.vehicle.variant),o.join(" ")||"Vehicle Details"}),a=o=>{if(!o)return"0";const d=typeof o=="string"?parseFloat(o):o;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(d)},i=o=>{if(!o)return"0";const d=typeof o=="string"?parseFloat(o):o;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(d)},l=()=>{s.value=!0};return(o,d)=>(u(),v("div",wa,[d[4]||(d[4]=e("h3",{class:"text-base font-medium mb-4 text-greys-900 -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),t.imageUrl?(u(),v("div",ka,[e("img",{src:t.imageUrl,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover",onError:l},null,40,Ca)])):(u(),v("div",Sa,[C(n(Js),{size:48,class:"text-gray-400"})])),e("div",$a,[e("div",Aa,[e("div",Da,[e("p",Ta,N(r.value),1),t.vehicle.year?(u(),v("p",Ia,N(t.vehicle.year),1)):T("",!0)]),t.vehicle.price?(u(),v("p",Oa," â‚¬"+N(a(t.vehicle.price)),1)):T("",!0)]),t.vehicle.mileage||t.vehicle.fuelType?(u(),v("div",Na,[t.vehicle.mileage?(u(),v("span",Ma,N(i(t.vehicle.mileage))+" km",1)):T("",!0),t.vehicle.fuelType?(u(),v("span",qa,N(t.vehicle.fuelType),1)):T("",!0)])):T("",!0)]),t.source?(u(),v("div",Ea,[C(n(Ps),{variant:"secondary",class:"text-xs"},{default:O(()=>[_(N(t.source),1)]),_:1})])):T("",!0),t.requestMessage?(u(),v("div",La,[d[2]||(d[2]=e("p",{class:"text-xs text-greys-500 mb-1"},"Request message",-1)),e("p",Ba,N(t.requestMessage),1)])):T("",!0),e("div",Fa,[C(n(Ee),{variant:"secondary",size:"sm",class:"flex-1",onClick:d[0]||(d[0]=p=>o.$emit("open-ad"))},{default:O(()=>[C(n(hs),{size:16}),d[3]||(d[3]=e("span",null,"Open Ad",-1))]),_:1}),C(n(Ee),{variant:"secondary",size:"icon-sm",onClick:d[1]||(d[1]=p=>o.$emit("more-actions"))},{default:O(()=>[C(n(en),{size:16})]),_:1})])]))}},ja=De(Ra,[["__scopeId","data-v-86c6d8c5"]]),Va={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},Ua={key:0,class:"space-y-6"},Wa={class:"text-sm text-greys-500 font-medium"},za={class:"space-y-4"},Ha=["onClick"],Pa={class:"flex-1 min-w-0"},Qa={class:"text-sm leading-5"},_a={class:"font-normal text-greys-900"},Ya={class:"text-greys-500"},Ja=["onClick"],Ga=["onClick"],Ka={class:"text-xs text-greys-500 mt-1"},Za={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Xa={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded"],setup(t,{emit:m}){const s=t,r=m,a=A(()=>[...s.activities].sort(($,q)=>{const g=new Date($.timestamp||$.createdAt||0).getTime();return new Date(q.timestamp||q.createdAt||0).getTime()-g})),i=$=>({note:ht,email:Ut,whatsapp:nt,sms:nt,call:sn,meeting:cs,task:Nt,status_change:nn,assignment:us,survey:Zs})[$]||Nt,l=$=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;",sms:"background-color: #f3e8ff;",call:"background-color: #dbeafe;",meeting:"background-color: #e0e7ff;",task:"background-color: #f5f5f5;",status_change:"background-color: #fef3c7;",assignment:"background-color: #e5e7eb;",survey:"background-color: #f0f9ff;"})[$]||"background-color: #f5f5f5;",o=$=>({note:"text-orange-600",email:"text-blue-600",whatsapp:"text-green-600",sms:"text-purple-600",call:"text-blue-500",meeting:"text-indigo-600",task:"text-gray-600",status_change:"text-yellow-600",assignment:"text-gray-500",survey:"text-blue-600"})[$]||"text-gray-600",d=$=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;",survey:"background-color: #f0f9ff;"})[$]||"background-color: #f5f5f5;",p=$=>["note","email","whatsapp","survey"].includes($.type)&&$.content,c=$=>{if(!$.content)return"";if($.type==="survey")try{const q=typeof $.content=="string"?JSON.parse($.content):$.content,b=Object.entries(q).filter(([h,S])=>S&&S!=="").map(([h,S])=>`${h.replace(/([A-Z])/g," $1").replace(/^./,H=>H.toUpperCase()).trim()}: ${S}`).join(`
`)||$.content;return s.expandedSummaries[$.id]?b:b.length>100?b.substring(0,100)+"...":b}catch{const g=$.content;return s.expandedSummaries[$.id]?g:g.length>100?g.substring(0,100)+"...":g}return s.expandedSummaries[$.id]?$.content:$.content.length>100?$.content.substring(0,100)+"...":$.content},f=$=>{if(!$||$.length===0)return"";const q=$[0],g=q.timestamp||q.createdAt;if(!g)return"Recent Activity";const b=new Date(g),h=new Date,S=new Date(h);return S.setDate(S.getDate()-1),b.toDateString()===h.toDateString()?"Today":b.toDateString()===S.toDateString()?"Yesterday":b.toLocaleDateString("en-US",{month:"long",day:"numeric",year:b.getFullYear()!==h.getFullYear()?"numeric":void 0})},y=$=>{["note","email","whatsapp","survey"].includes($.type)&&r("activity-click",$)},x=$=>{r("toggle-summary-expanded",$)},w=$=>{if(!$.content)return 0;if($.type==="survey")try{const q=typeof $.content=="string"?JSON.parse($.content):$.content;return Object.entries(q).filter(([b,h])=>h&&h!=="").map(([b,h])=>`${b.replace(/([A-Z])/g," $1").replace(/^./,F=>F.toUpperCase()).trim()}: ${h}`).join(`
`).length||$.content.length}catch{return $.content.length}return $.content.length};return($,q)=>(u(),v("div",Va,[q[1]||(q[1]=e("h3",{class:"text-base font-medium mb-4 text-greys-900 -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Activity",-1)),a.value.length>0?(u(),v("div",Ua,[e("h3",Wa,N(f(a.value)),1),e("div",za,[(u(!0),v(ye,null,ve(a.value,g=>(u(),v("div",{key:g.id,class:U(["flex gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":g.type==="note"||g.type==="email"||g.type==="whatsapp"||g.type==="survey"}]),onClick:b=>y(g)},[e("div",{class:"size-8 rounded-btn flex items-center justify-center shrink-0",style:Tt(l(g.type))},[(u(),P(rt(i(g.type)),{size:16,class:U(o(g.type))},null,8,["class"]))],4),e("div",Pa,[e("p",Qa,[e("span",_a,N(g.user),1),e("span",Ya,N(g.action),1)]),g.content&&p(g)?(u(),v("div",{key:0,class:"mt-2 rounded-card p-4",style:Tt(d(g.type))},[e("p",{class:U(["text-sm text-greys-900",{"whitespace-pre-line":g.type==="survey"}])},N(c(g)),3),w(g)>100&&!t.expandedSummaries[g.id]?(u(),v("button",{key:0,onClick:at(b=>x(g.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show more ",8,Ja)):w(g)>100&&t.expandedSummaries[g.id]?(u(),v("button",{key:1,onClick:at(b=>x(g.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show less ",8,Ga)):T("",!0)],4)):T("",!0),e("p",Ka,N(g.time),1)])],10,Ha))),128))])])):(u(),v("div",Za,[C(n(Xs),{size:32,class:"text-greys-400 mb-2"}),q[0]||(q[0]=e("p",{class:"text-sm text-greys-500"},"No activity yet",-1))]))]))}},el=De(Xa,[["__scopeId","data-v-aba69c31"]]),tl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},sl={class:"flex flex-1 overflow-hidden"},nl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},al={class:"px-6 py-0 shrink-0"},ll={class:"flex items-stretch h-12 gap-4 border-b border-black/5"},ol=["onClick"],il={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"},rl={class:"flex-1 overflow-y-auto"},dl={key:0,class:"p-6 space-y-4"},ul={key:1,class:"p-6 space-y-4"},cl={class:"px-4 py-2 flex items-center justify-between rounded-t-card -mx-1 -mt-1"},pl={class:"flex items-center gap-2"},ml={class:"text-base font-medium text-greys-500"},fl={class:"text-sm text-greys-500"},yl={class:"p-4 overflow-hidden rounded-card bg-white shadow-nsc-card"},gl={class:"text-sm font-medium text-greys-900"},vl={class:"text-sm mt-1 text-greys-700"},bl={key:0,class:"flex justify-end mt-4"},hl={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},xl={key:2,class:"p-6 space-y-4"},wl={class:"px-4 py-2 flex items-center justify-between rounded-t-card -mx-1 -mt-1"},kl={class:"flex items-center gap-2"},Cl={class:"text-base font-medium text-greys-500"},Sl={class:"text-sm text-greys-500"},$l={class:"p-4 overflow-hidden rounded-card bg-white shadow-nsc-card"},Al={class:"text-sm text-greys-900"},Dl={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},Tl={key:3,class:"p-6"},Il={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},Ol={class:"right-sidebar flex flex-col overflow-y-auto shrink-0 border-l border-black/5",style:{"background-color":"#F8F8F8"}},Nl={class:"space-y-2 p-2"},Ml={key:1,class:"flex-1 flex items-center justify-center bg-surface"},ql={__name:"TaskDetailViewTabbed",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t,{emit:m}){const s=t,r=m,a=D("overview"),i=D({}),l=[{key:"overview",label:"Overview"},{key:"communication",label:"Communication"},{key:"notes",label:"Notes"},{key:"attachments",label:"Attachments"}],o=A(()=>{var I;return((I=s.storeAdapter.currentActivities)==null?void 0:I.value)||[]}),d=A(()=>o.value.filter(I=>["email","whatsapp","sms","call"].includes(I.type))),p=A(()=>o.value.filter(I=>I.type==="note")),c=A(()=>o.value.filter(I=>I.type==="attachment")),f=I=>I==="overview"?1:I==="communication"?d.value.length:I==="notes"?p.value.length:I==="attachments"?c.value.length:0,y=()=>{r("task-navigate","previous")},x=()=>{r("task-navigate","next")},w=D(null),$=D({}),q=D({});let g=null;const b=I=>{g!==null&&(window.clearTimeout(g),g=null),w.value=I,I&&(g=window.setTimeout(()=>{w.value=null,g=null},900))},h=async()=>{if(w.value){if(await ms(),w.value.tab==="notes"&&a.value==="notes"){const I=$.value[w.value.id];I&&typeof I.scrollIntoView=="function"&&I.scrollIntoView({behavior:"smooth",block:"center"})}if(w.value.tab==="communication"&&a.value==="communication"){const I=q.value[w.value.id];I&&typeof I.scrollIntoView=="function"&&I.scrollIntoView({behavior:"smooth",block:"center"})}}},S=(I,L)=>{L?$.value[I]=L:delete $.value[I]},F=(I,L)=>{L?q.value[I]=L:delete q.value[I]},H=I=>w.value?w.value.tab==="notes"&&w.value.type==="note"&&w.value.id===I.id:!1,ae=I=>w.value?w.value.tab==="communication"&&(w.value.type==="email"||w.value.type==="whatsapp")&&w.value.id===I.id:!1;we(()=>[w.value,a.value],()=>{w.value&&h()}),ps(()=>{g!==null&&(window.clearTimeout(g),g=null)});const de=I=>{I.type==="note"?(a.value="notes",b({tab:"notes",type:"note",id:I.id})):["email","whatsapp","sms","call"].includes(I.type)?(a.value="communication",b({tab:"communication",type:I.type,id:I.id})):I.type==="attachment"&&(a.value="attachments",b(null))},ie=I=>{i.value[I]=!i.value[I]},le=I=>I==="email"?Ut:nt,fe=I=>I==="email"?"text-blue-600":I==="whatsapp"?"text-green-600":I==="sms"?"text-purple-600":"text-gray-600",be=I=>{const L=I.from==="lead"||I.direction==="incoming";return I.type==="whatsapp"?L?"Received WhatsApp message":"Sent WhatsApp message":I.type==="email"?L?"Received Email":"Sent Email":I.type==="sms"?L?"Received SMS":"Sent SMS":"Message"},Z=I=>I&&(I.image||I.imageUrl)||"",E=()=>{console.log("Open ad clicked")},B=()=>{console.log("More actions clicked")},te=I=>{console.log("Contact action:",I)};return(I,L)=>{var z,K;return t.task?(u(),v("div",tl,[C(ra,{task:t.task,"filtered-tasks":t.filteredTasks,onPrevious:y,onNext:x},null,8,["task","filtered-tasks"]),e("div",sl,[e("div",nl,[e("div",al,[e("div",ll,[(u(),v(ye,null,ve(l,R=>e("button",{key:R.key,onClick:J=>a.value=R.key,class:"relative flex items-center gap-1.5 px-0 h-full"},[e("span",{class:U(["text-sm font-medium",a.value===R.key?"text-greys-900":"text-greys-500"])},N(R.label),3),e("span",{class:U(["px-2 py-0.5 rounded-btn text-sm",a.value===R.key?"bg-blue-50 text-blue-600 font-bold":"bg-surfaceSecondary text-greys-600 font-medium"])},N(f(R.key)),3),a.value===R.key?(u(),v("span",il)):T("",!0)],8,ol)),64))])]),e("div",rl,[a.value==="overview"?(u(),v("div",dl,[C(ba,{task:t.task,type:t.task.type},null,8,["task","type"]),C(xa,it({task:t.task,type:t.task.type,"management-widget":t.managementWidget,activities:o.value},I.$attrs),null,16,["task","type","management-widget","activities"])])):T("",!0),a.value==="communication"?(u(),v("div",ul,[(u(!0),v(ye,null,ve(d.value,R=>(u(),v("div",{key:R.id,ref_for:!0,ref:J=>F(R.id,J),class:U(["bg-greys-100 rounded-card p-1",ae(R)&&R.type==="whatsapp"?"highlight-whatsapp":"",ae(R)&&R.type==="email"?"highlight-email":""]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[e("div",cl,[e("div",pl,[(u(),P(rt(le(R.type)),{size:18,class:U(fe(R.type))},null,8,["class"])),e("h3",ml,N(be(R)),1)]),e("span",fl,N(R.timestamp||R.time),1)]),e("div",yl,[e("p",gl,N(R.senderName||R.user),1),e("p",vl,N(R.content),1),R.from==="lead"||R.direction==="incoming"?(u(),v("div",bl,[C(n(Ee),{size:"sm"},{default:O(()=>[...L[0]||(L[0]=[_("Reply",-1)])]),_:1})])):T("",!0)])],2))),128)),d.value.length===0?(u(),v("div",hl,[C(n(nt),{size:48,class:"text-greys-400 mb-4"}),L[2]||(L[2]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No communication yet",-1)),L[3]||(L[3]=e("p",{class:"text-sm text-greys-500 mb-4"},"Start a conversation with the customer",-1)),C(n(Ee),null,{default:O(()=>[...L[1]||(L[1]=[_("Send message",-1)])]),_:1})])):T("",!0)])):T("",!0),a.value==="notes"?(u(),v("div",xl,[(u(!0),v(ye,null,ve(p.value,R=>(u(),v("div",{key:R.id,ref_for:!0,ref:J=>S(R.id,J),class:U(["bg-[#fef7ee] rounded-card p-1",H(R)?"highlight-note":""])},[e("div",wl,[e("div",kl,[C(n(ht),{size:18,class:"text-orange-600"}),e("h3",Cl,"Note by "+N(R.user),1)]),e("span",Sl,N(R.timestamp||R.time),1)]),e("div",$l,[e("p",Al,N(R.content),1)])],2))),128)),p.value.length===0?(u(),v("div",Dl,[C(n(ht),{size:48,class:"text-greys-400 mb-4"}),L[5]||(L[5]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No notes yet",-1)),L[6]||(L[6]=e("p",{class:"text-sm text-greys-500 mb-4"},"Add a note to keep track of important information",-1)),C(n(Ee),null,{default:O(()=>[...L[4]||(L[4]=[_("Add note",-1)])]),_:1})])):T("",!0)])):T("",!0),a.value==="attachments"?(u(),v("div",Tl,[c.value.length===0?(u(),v("div",Il,[C(n(tn),{size:48,class:"text-greys-400 mb-4"}),L[8]||(L[8]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No attachments yet",-1)),L[9]||(L[9]=e("p",{class:"text-sm text-greys-500 mb-4"},"Upload files related to this task",-1)),C(n(Ee),null,{default:O(()=>[...L[7]||(L[7]=[_("Add attachment",-1)])]),_:1})])):T("",!0)])):T("",!0)])]),e("div",Ol,[e("div",Nl,[C(xs,{task:t.task,"task-type":t.task.type,"customer-id":t.task.customerId||((z=t.task.customer)==null?void 0:z.id),onAction:te},null,8,["task","task-type","customer-id"]),t.task.requestedCar||t.task.vehicle?(u(),P(ja,{key:0,vehicle:t.task.requestedCar||t.task.vehicle,"request-message":t.task.requestMessage||((K=t.task.requestedCar)==null?void 0:K.requestMessage),source:t.task.source,"image-url":Z(t.task.requestedCar||t.task.vehicle),onOpenAd:E,onMoreActions:B},null,8,["vehicle","request-message","source","image-url"])):T("",!0),C(el,{activities:o.value,"expanded-summaries":i.value,onActivityClick:de,onToggleSummaryExpanded:ie},null,8,["activities","expanded-summaries"])])])])])):(u(),v("div",Ml,[...L[10]||(L[10]=[lt('<div class="text-center max-w-sm p-8" data-v-d5316e4e><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-d5316e4e><i class="fa-solid fa-tasks text-2xl text-sub" data-v-d5316e4e></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2" data-v-d5316e4e>No task selected</h3><p class="text-fluid-sm text-sub" data-v-d5316e4e>Select a task from the list to view its details and manage activities</p></div>',1)])]))}}},El=De(ql,[["__scopeId","data-v-d5316e4e"]]),Ll={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},Bl={key:0,class:"absolute top-3 right-[18px] z-50 flex items-center gap-1 bg-white border border-E5E7EB rounded-btn shadow-sm p-0.5"},Fl={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t){const m=Le(),s=A(()=>m.getSetting("taskDetailsViewMode")||"compact"),r=A(()=>s.value==="tabbed"?El:Xn),a=i=>{m.setSetting("taskDetailsViewMode",i)};return(i,l)=>(u(),v("div",Ll,[t.task?(u(),v("div",Bl,[e("button",{onClick:l[0]||(l[0]=o=>a("compact")),class:U(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="compact"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Compact View"},[...l[3]||(l[3]=[e("i",{class:"fa-solid fa-list text-[10px] mr-1"},null,-1),_(" Compact ",-1)])],2),e("button",{onClick:l[1]||(l[1]=o=>a("tabbed")),class:U(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="tabbed"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Tabbed View"},[...l[4]||(l[4]=[e("i",{class:"fa-solid fa-table-columns text-[10px] mr-1"},null,-1),_(" Tabbed ",-1)])],2)])):T("",!0),(u(),P(rt(r.value),it({task:t.task,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig,"filtered-tasks":t.filteredTasks},i.$attrs,{onTaskNavigate:l[2]||(l[2]=o=>i.$emit("task-navigate",o))}),null,16,["task","management-widget","store-adapter","add-new-config","filtered-tasks"]))]))}},Mt=De(Fl,[["__scopeId","data-v-86b0efed"]]),Rl={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},jl={class:"px-4 py-3 flex items-center justify-between gap-3"},Vl=["aria-label"],Ul={key:0,class:"flex-1 flex items-center justify-center"},Wl={key:1,class:"flex items-center gap-2"},zl={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:m}){const s=m,r=()=>{s("back")};return(a,i)=>t.show?(u(),v("div",Rl,[e("div",jl,[e("button",{onClick:r,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...i[0]||(i[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Vl),a.$slots.title?(u(),v("div",Ul,[xe(a.$slots,"title")])):T("",!0),a.$slots.actions?(u(),v("div",Wl,[xe(a.$slots,"actions")])):T("",!0)])])):T("",!0)}};function Qt(t,m={}){const s=Le(),r=A(()=>{const q=typeof t=="function"?t():pt(t);return{lead:q,displayStage:q?xt(q,"lead"):null}}),a=A(()=>r.value.displayStage||"New"),i=A(()=>{const q=r.value;return ws(q)}),l=A(()=>{const q=r.value,g=ks(q);if(!g)return null;const b=m[g.key];return{...g,handler:b||(()=>{})}}),o=A(()=>{const q=r.value;return Cs(q).map(b=>{const h=m[b.key];return{...b,handler:h||(()=>{})}})}),d=A(()=>{const q=r.value;return Ss(q)}),p=A(()=>{const q=r.value;return $s(q)}),c=A(()=>{const q=r.value;return As(q)}),f=A(()=>{const q=r.value;return Ds(q)}),y=A(()=>{const g=r.value.lead;return((g==null?void 0:g.contactAttempts)||[]).length||0}),x=A(()=>s.getSetting("maxContactAttempts")),w=A(()=>y.value+1>=x.value),$=A(()=>!0);return{displayStage:a,isClosed:i,primaryAction:l,secondaryActions:o,showLQWidget:d,showDeadlineBanner:p,canPostpone:c,canReassign:$,lqWidgetMode:f,contactAttempts:y,maxContactAttempts:x,shouldShowAutoDisqualifyWarning:w}}function Hl({getLead:t,leadState:m,emit:s}){const r=Ct(),a=Je(),i=Fe();async function l(g){var h;const b=t();if(b&&m.canPostpone.value)try{const S=new Date(`${g.date}T${g.time}:00`),F=S.toISOString(),H={nextActionDue:F};if((g.assigneeId||g.teamId)&&(H.assignee=g.assignee||null,H.assigneeId=g.assigneeId||null,H.assigneeType=g.assigneeType||"user",H.teamId=g.teamId||null,H.team=g.team||null),await a.updateLead(b.id,H),g.createAppointment){const ae=new Date(S);ae.setHours(ae.getHours()+1),await a.updateLead(b.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${b.customer.name}`,start:F,end:ae.toISOString(),type:"Call",assignee:g.assignee||b.assignee,assigneeId:g.assigneeId||b.assigneeId,assigneeType:g.assigneeType||b.assigneeType||"user",teamId:g.teamId||b.teamId,team:g.team||b.team,status:"scheduled"}}),await a.addActivity(b.id,{type:"appointment",user:((h=i.currentUser)==null?void 0:h.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ye(S)} at ${st(S)}`,data:{type:"Call",date:g.date,time:g.time,assignee:g.assignee||b.assignee}})}await a.addActivity(b.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ye(S)} at ${st(S)}${g.assignee?` and reassigned to ${g.assignee}`:""}`}),await a.fetchLeadById(b.id)}catch(S){console.error("Failed to postpone lead task:",S)}}async function o(g){const b=t();if(b)try{if(await a.updateLead(b.id,{stage:"Validated"}),await a.addActivity(b.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),g.scheduleFollowUp&&g.appointmentData){const h=new Date(`${g.appointmentData.date}T${g.appointmentData.time}:00`);await a.scheduleFollowUp(b.id,{dateTime:h.toISOString(),assignee:g.appointmentData.assignee||b.assignee,assigneeId:g.appointmentData.assigneeId||null,assigneeType:g.appointmentData.assigneeType||"user",teamId:g.appointmentData.teamId||null,team:g.appointmentData.team||null}),await a.addActivity(b.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ye(h)} at ${st(h)}`})}await a.fetchLeadById(b.id)}catch(h){console.error("Failed to validate lead:",h)}}async function d(){const g=t();if(g)try{const b=await a.convertLeadToOpportunity(g.id);i.canAccessOpportunities()?r.push({path:`/tasks/${b}`,query:{type:"opportunity"}}):r.push("/tasks")}catch(b){console.error("Failed to qualify lead:",b)}}async function p(g){const b=t();if(b)try{const h=b.contactAttempts||[];await a.updateLead(b.id,{contactAttempts:[...h,g],lastContactAttempt:g.timestamp,totalContactAttempts:h.length+1}),await a.addActivity(b.id,{type:"call",user:"You",action:`logged call attempt - ${g.outcome}`,content:g.notes||`Call attempt via ${g.channel}`,data:{outcome:g.outcome,channel:g.channel,duration:g.duration}}),await a.fetchLeadById(b.id)}catch(h){console.error("Failed to log call attempt:",h)}}async function c(g){const b=t();if(b)try{await a.addActivity(b.id,{type:"note",user:"You",action:"added a note",content:g.content||g.text||"",data:g}),await a.fetchLeadById(b.id)}catch(h){console.error("Failed to save note:",h)}}function f(){s("open-purchase-method")}function y(){s("open-trade-in")}async function x(g){var h;const b=t();if(b)try{const S=`${g.date}T${g.time}:00`,F=new Date(S);F.setHours(F.getHours()+1),await a.updateLead(b.id,{scheduledAppointment:{id:Date.now(),title:`${g.type} - ${b.customer.name}`,start:S,end:F.toISOString(),type:g.type,assignee:g.assignee,assigneeId:g.assigneeId,status:"scheduled",location:g.location||"",notes:g.notes||""}}),await a.addActivity(b.id,{type:"appointment",user:((h=i.currentUser)==null?void 0:h.name)||"You",action:"scheduled an appointment",content:`${g.type} scheduled for ${g.date} at ${g.time}`,data:{type:g.type,date:g.date,time:g.time,assignee:g.assignee}}),await a.fetchLeadById(b.id)}catch(S){console.error("Failed to schedule appointment:",S)}}async function w(g){const b=t();if(b&&!(m.isClosed.value&&!g.force))try{const h=m.displayStage.value,S=g.reason==="Duplicate"?Qe.CLOSED_DUPLICATE:g.category==="Not Interested"?Qe.CLOSED_NOT_INTERESTED:Qe.CLOSED_INVALID,F=bt(h,S);if(F){const{updates:H,activities:ae}=F(b,S,g);await a.updateLead(b.id,H);for(const de of ae)await a.addActivity(b.id,de)}else{const H=g.reason==="Duplicate";await a.updateLead(b.id,{isDisqualified:!0,disqualifyReason:g.reason,isDuplicate:H,stage:H?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await a.addActivity(b.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${g.category}, Reason: ${g.reason}`})}r.push("/tasks")}catch(h){console.error("Failed to disqualify lead:",h)}}async function $(){const g=t();if(g)try{const b=m.displayStage.value,h=Qe.NEW,S=bt(b,h);if(S){const{updates:F,activities:H}=S(g);await a.updateLead(g.id,F);for(const ae of H)await a.addActivity(g.id,ae)}else await a.updateLead(g.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await a.addActivity(g.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await a.fetchLeadById(g.id)}catch(b){console.error("Failed to reopen lead:",b)}}function q(){const g=t();g&&g.opportunityId&&r.push({path:`/tasks/${g.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:l,handleValidated:o,handleQualified:d,handleCallAttemptLogged:p,handleNoteSaved:c,handleOpenPurchaseMethod:f,handleOpenTradeIn:y,handleAppointmentScheduled:x,handleDisqualified:w,handleReopen:$,viewOpportunity:q}}const Pl={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ql={class:"space-y-6"},_t={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(m,s)=>t.task?(u(),v("div",{key:0,class:U(["rounded-lg flex flex-col",t.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[s[0]||(s[0]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")])],-1)),e("div",Pl,[xe(m.$slots,"deadline-banner"),e("div",Ql,[xe(m.$slots,"primary-action"),xe(m.$slots,"task-widgets"),xe(m.$slots,"closed-state"),xe(m.$slots,"secondary-actions")])])],2)):T("",!0)}},_l={class:"flex justify-between items-start mb-3"},Yl={class:"font-bold text-gray-900 text-fluid-sm"},Jl={class:"text-fluid-xs text-gray-500 mt-0.5"},Gl={class:"flex gap-3 flex-wrap"},Yt={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(m,s)=>(u(),v("div",{class:U(["rounded-card p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",_l,[e("div",null,[e("h4",Yl,N(t.action.title),1),e("p",Jl,N(t.action.description),1)])]),e("div",Gl,[e("button",{onClick:s[0]||(s[0]=r=>m.$emit("action-clicked")),class:U([t.action.buttonClass,"font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:U(t.action.icon)},null,2),_(" "+N(t.action.label),1)],2)])],2))}},Kl={class:"flex items-center gap-3"},Zl={class:"flex-1"},Xl={key:0,class:"text-fluid-xs font-normal opacity-75"},eo={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:m}){const s=t,r=m,a=D(!1),i=A(()=>$t(s.nextActionDue)),l=A(()=>s.isClosed||!s.showDeadlineBanner||a.value?!1:i.value.type==="overdue"||i.value.type==="urgent"),o=()=>{a.value=!0,r("dismissed")};return(d,p)=>l.value?(u(),v("div",{key:0,class:U(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[i.value.bgClass,i.value.borderClass]])},[e("div",Kl,[e("div",{class:U(["w-9 h-9 rounded-lg flex items-center justify-center",[i.value.bgClass,i.value.borderClass,"border"]])},[e("i",{class:U(["text-sm",[`fa-solid ${i.value.icon}`,i.value.textClass]])},null,2)],2),e("div",Zl,[p[0]||(p[0]=e("div",{class:"text-fluid-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:U(["text-fluid-sm font-bold",i.value.textClass])},[_(N(n(Bt)(t.nextActionDue))+" ",1),i.value.type!=="overdue"?(u(),v("span",Xl," ("+N(n(At)(t.nextActionDue))+") ",1)):T("",!0)],2)]),i.value.type==="overdue"?(u(),v("div",{key:0,class:U(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...p[1]||(p[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),_(" Overdue ",-1)])],2)):i.value.type==="urgent"?(u(),v("div",{key:1,class:U(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),_(" Urgent ",-1)])],2)):T("",!0)]),e("button",{onClick:o,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...p[3]||(p[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):T("",!0)}},vt=(t,m)=>{if(!t||!m)return[];const s=new Date(m).getDay();if(s===0||s===6)return[];const[a,i]=t.split("-"),l=parseInt(i);return a==="team"?so(l,m):a==="user"?to(l,m,s):[]},to=(t,m,s)=>{const r={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(r[t]||r[1])[s]||[]},so=(t,m)=>{const s=new Date(m).getDay(),r=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return t===1?s===1||s===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:t===2?r.filter((a,i)=>i%2===0):r},no=(t,m)=>{const s=vt(t,m);return s.length===0?"none":s.length<=3?"limited":"good"},ao=(t,m,s)=>{const r=[];return s.forEach(a=>{const i=`${a.type}-${a.id}`;if(i===t)return;const l=vt(i,m);l.length>0&&r.push({...a,assigneeId:i,availableSlots:l,slotCount:l.length})}),r.sort((a,i)=>i.slotCount-a.slotCount)},lo={class:"space-y-6"},oo={class:"space-y-3"},io={key:0,class:"space-y-4"},ro={class:"flex gap-2"},uo={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},co={class:"flex items-center justify-between mb-4"},po={class:"text-fluid-sm font-semibold text-heading"},mo={class:"grid grid-cols-7 gap-1 mb-2"},fo={class:"grid grid-cols-7 gap-1"},yo=["onClick"],go={class:"text-fluid-sm font-semibold text-heading mb-4"},vo={key:0,class:"space-y-2"},bo=["onClick"],ho={key:1,class:"text-fluid-sm text-sub py-4 text-center"},xo={key:2,class:"text-fluid-sm text-sub py-4 text-center"},wo={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(t,{emit:m}){const s=t,r=m,a=Fe(),i=dt(),l=D("assign-and-schedule"),o=D(""),d=D(null),p=D(""),c=D(""),f=D("30min"),y=D(new Date().getMonth()),x=D(new Date().getFullYear()),w=D(null);A(()=>i.assignableUsers),A(()=>i.assignableTeams);const $=A(()=>new Date(x.value,y.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),q=A(()=>{const Z=new Date(x.value,y.value,1),B=new Date(x.value,y.value+1,0).getDate(),te=Z.getDay(),I=[];for(let L=0;L<te;L++)I.push(null);for(let L=1;L<=B;L++)I.push(L);return I}),g=A(()=>{if(!w.value||!p.value)return"Select a date";const Z=new Date(p.value),E=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${E[Z.getDay()]}, ${B[Z.getMonth()]} ${Z.getDate()}`}),b=Z=>{if(!Z||!p.value)return!1;const E=new Date(p.value);return E.getDate()===Z&&E.getMonth()===y.value&&E.getFullYear()===x.value},h=Z=>{if(!Z)return;const E=new Date(x.value,y.value,Z);p.value=E.toISOString().split("T")[0],w.value=Z,c.value=""},S=()=>{y.value===0?(y.value=11,x.value--):y.value--},F=()=>{y.value===11?(y.value=0,x.value++):y.value++},H=A(()=>!p.value||!d.value?[]:vt(d.value,p.value)),ae=()=>{var Z;if(s.preselectedAssignee){const{type:E,id:B}=s.preselectedAssignee;d.value=`${E}-${B}`}else d.value=`user-${((Z=a.currentUser)==null?void 0:Z.id)||1}`};ae();const de=A(()=>l.value==="assign-only"?!0:!!(o.value&&p.value&&c.value&&d.value));we(()=>s.show,Z=>{Z?ae():ie()}),we(p,()=>{c.value=""});const ie=()=>{l.value="assign-and-schedule",o.value="",p.value="",c.value="",f.value="30min",w.value=null;const Z=new Date;y.value=Z.getMonth(),x.value=Z.getFullYear()},le=Z=>{Z||r("close")},fe=()=>{if(!de.value)return;const Z=d.value.startsWith("team-"),E=parseInt(d.value.split("-")[1]);let B={};if(Z){const I=i.getTeamById(E);B={assigneeType:"team",teamId:E,team:(I==null?void 0:I.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const I=i.getUserById(E);B={assigneeType:"user",assigneeId:E,assignee:(I==null?void 0:I.name)||"Unknown",teamId:null,team:null}}const te={...B};l.value==="assign-and-schedule"&&(te.type=o.value,te.date=p.value,te.time=c.value,te.duration=f.value),r("confirm",te),r("close")},be=()=>{r("close")};return(Z,E)=>(u(),P(n(He),{open:t.show,"onUpdate:open":le},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-4xl"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),{class:"text-fluid-lg"},{default:O(()=>[...E[6]||(E[6]=[_("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",lo,[e("div",oo,[e("label",{class:U(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",l.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[re(e("input",{type:"radio","onUpdate:modelValue":E[0]||(E[0]=B=>l.value=B),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ot,l.value]]),E[7]||(E[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:U(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",l.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[re(e("input",{type:"radio","onUpdate:modelValue":E[1]||(E[1]=B=>l.value=B),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ot,l.value]]),E[8]||(E[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),l.value==="assign-and-schedule"?(u(),v("div",io,[E[14]||(E[14]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Schedule",-1)),e("div",null,[E[10]||(E[10]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Event type",-1)),re(e("select",{"onUpdate:modelValue":E[2]||(E[2]=B=>o.value=B),class:"input text-fluid-sm w-full"},[...E[9]||(E[9]=[e("option",{value:"",disabled:""},"Select event type",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[Ge,o.value]])]),e("div",null,[E[11]||(E[11]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Duration",-1)),e("div",ro,[e("button",{onClick:E[3]||(E[3]=B=>f.value="30min"),class:U(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",f.value==="30min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 30min ",2),e("button",{onClick:E[4]||(E[4]=B=>f.value="60min"),class:U(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",f.value==="60min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 60min ",2),e("button",{onClick:E[5]||(E[5]=B=>f.value="custom"),class:U(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",f.value==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," Custom ",2)])]),e("div",uo,[e("div",null,[e("div",co,[e("button",{onClick:S,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...E[12]||(E[12]=[e("i",{class:"fa-solid fa-chevron-left text-fluid-sm text-body"},null,-1)])]),e("h6",po,N($.value),1),e("button",{onClick:F,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...E[13]||(E[13]=[e("i",{class:"fa-solid fa-chevron-right text-fluid-sm text-body"},null,-1)])])]),e("div",mo,[(u(),v(ye,null,ve(["SUN","MON","TUE","WED","THU","FRI","SAT"],B=>e("div",{key:B,class:"text-center text-fluid-xs font-medium text-sub py-2"},N(B),1)),64))]),e("div",fo,[(u(!0),v(ye,null,ve(q.value,(B,te)=>(u(),v("div",{key:te,onClick:I=>h(B),class:U(["aspect-square flex items-center justify-center text-fluid-sm font-medium rounded-lg cursor-pointer transition-all",b(B)?"bg-green-600 text-white":B?"text-body hover:bg-surfaceSecondary":"text-transparent"])},N(B),11,yo))),128))])]),e("div",null,[e("h6",go,N(g.value),1),p.value&&H.value.length>0?(u(),v("div",vo,[(u(!0),v(ye,null,ve(H.value,B=>(u(),v("button",{key:B,onClick:te=>c.value=B,class:U(["w-full py-2 px-4 border-2 rounded-lg text-fluid-sm font-medium text-left transition-all",c.value===B?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},N(B),11,bo))),128))])):p.value&&H.value.length===0?(u(),v("div",ho," No available time slots for this date ")):(u(),v("div",xo," Select a date to see available time slots "))])])])):T("",!0)]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:be}),C(n(ne),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!de.value,onClick:fe},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ko={class:"bg-surface border border-E5E7EB rounded-card p-6 space-y-4"},Co={key:0,class:"space-y-4"},So={class:"flex gap-2"},$o={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ao={class:"flex items-center justify-between mb-4"},Do={class:"text-fluid-sm font-semibold text-heading"},To={class:"grid grid-cols-7 gap-1 mb-2"},Io={class:"grid grid-cols-7 gap-1"},Oo=["onClick"],No={class:"text-fluid-sm font-semibold text-heading mb-4"},Mo={key:0,class:"space-y-2"},qo=["onClick"],Eo={key:1,class:"text-fluid-sm text-sub py-4 text-center"},Lo={key:2,class:"text-fluid-sm text-sub py-4 text-center"},Bo={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Fo={__name:"ScheduleAppointmentInline",props:{preselectedAssignee:{type:Object,default:null},canCancel:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:m}){var I;const s=t,r=m,a=Fe(),i=dt(),l=D(""),o=D(null),d=D(""),p=D(""),c=D(!1),f=D(!1),y=D("30min"),x=D(new Date().getMonth()),w=D(new Date().getFullYear()),$=D(null),q=D(!1),g=A(()=>i.assignableUsers),b=A(()=>i.assignableTeams);A(()=>new Date().toISOString().split("T")[0]);const h=A(()=>new Date(w.value,x.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),S=A(()=>{const L=new Date(w.value,x.value,1),K=new Date(w.value,x.value+1,0).getDate(),R=L.getDay(),J=[];for(let Y=0;Y<R;Y++)J.push(null);for(let Y=1;Y<=K;Y++)J.push(Y);return J}),F=A(()=>{if(!$.value||!d.value)return"Select a date";const L=new Date(d.value),z=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${z[L.getDay()]}, ${K[L.getMonth()]} ${L.getDate()}`}),H=L=>{if(!L||!d.value)return!1;const z=new Date(d.value);return z.getDate()===L&&z.getMonth()===x.value&&z.getFullYear()===w.value},ae=L=>{if(!L)return;const z=new Date(w.value,x.value,L);d.value=z.toISOString().split("T")[0],$.value=L,p.value=""},de=()=>{x.value===0?(x.value=11,w.value--):x.value--},ie=()=>{x.value===11?(x.value=0,w.value++):x.value++},le=A(()=>o.value||(s.preselectedAssignee?`${s.preselectedAssignee.type}-${s.preselectedAssignee.id}`:null));A(()=>{if(!le.value)return{};const[L,z]=le.value.split("-"),K=parseInt(z);if(L==="team"){const R=i.getTeamById(K);return{name:(R==null?void 0:R.name)||"Unknown Team",subtitle:"Team",avatarClass:"bg-green-100 text-green-700",initials:"",isTeam:!0}}else{const R=i.getUserById(K);return{name:(R==null?void 0:R.name)||"Unknown",subtitle:(R==null?void 0:R.role)||"User",avatarClass:B(R==null?void 0:R.role),initials:E(R==null?void 0:R.name),isTeam:!1}}});const fe=A(()=>!d.value||!le.value?[]:vt(le.value,d.value)),be=A(()=>!d.value||!le.value?null:no(le.value,d.value));A(()=>{if(!d.value||!le.value)return[];if(be.value!=="none")return[];const L=[...b.value.map(z=>({...z,type:"team"})),...g.value.map(z=>({...z,type:"user"}))];return ao(le.value,d.value,L)});const Z=A(()=>!!(l.value&&d.value&&p.value&&le.value)),E=L=>L?L.split(" ").map(z=>z[0]).join("").toUpperCase().substring(0,2):"?",B=L=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[L]||"bg-surfaceSecondary text-body";we(d,()=>{if(p.value="",f.value=!1,d.value){const L=new Date(d.value);$.value=L.getDate(),x.value=L.getMonth(),w.value=L.getFullYear()}}),we(()=>le.value,()=>{p.value="",f.value=!1}),s.preselectedAssignee?o.value=`${s.preselectedAssignee.type}-${s.preselectedAssignee.id}`:o.value=`user-${((I=a.currentUser)==null?void 0:I.id)||1}`,we(()=>s.preselectedAssignee,L=>{L&&(o.value=`${L.type}-${L.id}`)},{immediate:!0});const te=()=>{if(!Z.value)return;const[L,z]=le.value.split("-"),K=parseInt(z),R=L==="team";let J={};if(R){const Y=i.getTeamById(K);J={assigneeType:"team",teamId:K,team:(Y==null?void 0:Y.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const Y=i.getUserById(K);J={assigneeType:"user",assigneeId:K,assignee:(Y==null?void 0:Y.name)||"Unknown",teamId:null,team:null}}r("confirm",{type:l.value,date:d.value,time:p.value,duration:y.value,...J}),l.value="",d.value="",p.value="",c.value=!1,f.value=!1};return(L,z)=>(u(),v("div",ko,[e("button",{onClick:z[0]||(z[0]=K=>q.value=!q.value),class:"w-full flex items-center justify-between mb-2"},[z[5]||(z[5]=e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Schedule Appointment",-1)),e("i",{class:U(["fa-solid text-fluid-xs text-sub transition-transform",q.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),q.value?(u(),v("div",Co,[e("div",null,[z[7]||(z[7]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Event type",-1)),re(e("select",{"onUpdate:modelValue":z[1]||(z[1]=K=>l.value=K),class:"input text-fluid-sm w-full"},[...z[6]||(z[6]=[e("option",{value:"",disabled:""},"Select event type",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[Ge,l.value]])]),e("div",null,[z[8]||(z[8]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Duration",-1)),e("div",So,[e("button",{onClick:z[2]||(z[2]=K=>y.value="30min"),class:U(["px-4 py-2 border-2 rounded-btn text-fluid-sm font-medium transition-all",y.value==="30min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 30min ",2),e("button",{onClick:z[3]||(z[3]=K=>y.value="60min"),class:U(["px-4 py-2 border-2 rounded-btn text-fluid-sm font-medium transition-all",y.value==="60min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 60min ",2),e("button",{onClick:z[4]||(z[4]=K=>y.value="custom"),class:U(["px-4 py-2 border-2 rounded-btn text-fluid-sm font-medium transition-all",y.value==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," Custom ",2)])]),e("div",$o,[e("div",null,[e("div",Ao,[e("button",{onClick:de,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...z[9]||(z[9]=[e("i",{class:"fa-solid fa-chevron-left text-fluid-sm text-body"},null,-1)])]),e("h6",Do,N(h.value),1),e("button",{onClick:ie,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...z[10]||(z[10]=[e("i",{class:"fa-solid fa-chevron-right text-fluid-sm text-body"},null,-1)])])]),e("div",To,[(u(),v(ye,null,ve(["SUN","MON","TUE","WED","THU","FRI","SAT"],K=>e("div",{key:K,class:"text-center text-fluid-xs font-medium text-sub py-2"},N(K),1)),64))]),e("div",Io,[(u(!0),v(ye,null,ve(S.value,(K,R)=>(u(),v("div",{key:R,onClick:J=>ae(K),class:U(["aspect-square flex items-center justify-center text-fluid-sm font-medium rounded-btn cursor-pointer transition-all",H(K)?"bg-green-600 text-white":K?"text-body hover:bg-surfaceSecondary":"text-transparent"])},N(K),11,Oo))),128))])]),e("div",null,[e("h6",No,N(F.value),1),d.value&&fe.value.length>0?(u(),v("div",Mo,[(u(!0),v(ye,null,ve(fe.value,K=>(u(),v("button",{key:K,onClick:R=>p.value=K,class:U(["w-full py-2 px-4 border-2 rounded-btn text-fluid-sm font-medium text-left transition-all",p.value===K?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},N(K),11,qo))),128))])):d.value&&fe.value.length===0?(u(),v("div",Eo," No available time slots for this date ")):(u(),v("div",Lo," Select a date to see available time slots "))])]),e("div",Bo,[C(n(ne),{label:"Confirm Appointment",variant:"primary",size:"small",class:"text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!Z.value,onClick:te},null,8,["disabled"])])])):T("",!0)]))}},Ro={key:1,class:"space-y-4"},jo={class:"flex items-center justify-between"},Vo={class:"space-y-4"},Uo={class:"block text-fluid-sm font-medium text-body"},Wo=["onUpdate:modelValue","placeholder"],zo=["onUpdate:modelValue"],Ho=["value"],Po={key:2,class:"space-y-2"},Qo=["onUpdate:modelValue","value"],_o={class:"flex gap-2 flex-wrap justify-end pt-2"},Me={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=D(s.initialExpanded),i=D({});we(()=>s.questions,c=>{const f={};c.forEach(y=>{f[y.key]=""}),i.value=f},{immediate:!0});const l=()=>{r("survey-completed",{...i.value}),p()},o=()=>{r("survey-refused"),p()},d=()=>{r("not-responding"),p()},p=()=>{a.value=!1;const c={};s.questions.forEach(f=>{c[f.key]=""}),i.value=c};return(c,f)=>(u(),v("div",null,[a.value?(u(),v("div",Ro,[e("div",jo,[f[4]||(f[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:f[1]||(f[1]=y=>a.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...f[3]||(f[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",Vo,[(u(!0),v(ye,null,ve(t.questions,(y,x)=>(u(),v("div",{key:x,class:"space-y-2"},[e("label",Uo,N(y.label),1),y.type==="text"?re((u(),v("textarea",{key:0,"onUpdate:modelValue":w=>i.value[y.key]=w,placeholder:y.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,Wo)),[[ge,i.value[y.key]]]):y.type==="select"?re((u(),v("select",{key:1,"onUpdate:modelValue":w=>i.value[y.key]=w,class:"input text-fluid-sm py-2 px-3 w-full"},[f[5]||(f[5]=e("option",{value:""},"Select an option...",-1)),(u(!0),v(ye,null,ve(y.options,w=>(u(),v("option",{key:w,value:w},N(w),9,Ho))),128))],8,zo)),[[Ge,i.value[y.key]]]):y.type==="radio"?(u(),v("div",Po,[(u(!0),v(ye,null,ve(y.options,w=>(u(),v("label",{key:w,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[re(e("input",{type:"radio","onUpdate:modelValue":$=>i.value[y.key]=$,value:w,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,Qo),[[ot,i.value[y.key]]]),_(" "+N(w),1)]))),128))])):T("",!0)]))),128)),e("div",_o,[C(n(ne),{label:"Complete Survey",variant:"primary",size:"small",onClick:l,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),C(n(ne),{label:"Customer Refused",variant:"outline",size:"small",onClick:o}),C(n(ne),{label:"Not Responding",variant:"outline",size:"small",onClick:d})])])])):(u(),v("button",{key:0,onClick:f[0]||(f[0]=y=>a.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...f[2]||(f[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},Yo={class:"space-y-3"},Jo={class:"space-y-2"},Go={key:0,class:"font-semibold text-heading text-fluid-sm mb-2"},Ko={class:"grid grid-cols-4 gap-2"},Zo={key:0},Xo={__name:"CommunicationSelector",props:{title:{type:String,default:"Send follow-up message"},showEmail:{type:Boolean,default:!0},showSMS:{type:Boolean,default:!0},showWhatsApp:{type:Boolean,default:!0},showDontSend:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel","dont-send"],setup(t,{emit:m}){const s=m,r=D(null),a=o=>{o==="dont-send"?(r.value="dont-send",s("dont-send")):r.value=o},i=o=>{s("send",o),r.value=null},l=()=>{r.value=null,s("cancel")};return(o,d)=>(u(),v("div",Yo,[e("div",Jo,[t.title?(u(),v("h5",Go,N(t.title),1)):T("",!0),e("div",Ko,[t.showEmail?(u(),v("button",{key:0,onClick:d[0]||(d[0]=p=>a("email")),class:U(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="email"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])],2)):T("",!0),t.showSMS?(u(),v("button",{key:1,onClick:d[1]||(d[1]=p=>a("sms")),class:U(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="sms"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...d[5]||(d[5]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])],2)):T("",!0),t.showWhatsApp?(u(),v("button",{key:2,onClick:d[2]||(d[2]=p=>a("whatsapp")),class:U(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="whatsapp"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...d[6]||(d[6]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])],2)):T("",!0),t.showDontSend?(u(),v("button",{key:3,onClick:d[3]||(d[3]=p=>a("dont-send")),class:U(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="dont-send"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...d[7]||(d[7]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])],2)):T("",!0)])]),r.value&&r.value!=="dont-send"?(u(),v("div",Zo,[r.value==="email"?(u(),P(Ts,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:l},null,8,["initial-template","initial-message"])):r.value==="sms"?(u(),P(Is,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:l},null,8,["initial-template","initial-message"])):r.value==="whatsapp"?(u(),P(Os,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:l},null,8,["initial-template","initial-message"])):T("",!0)])):T("",!0)]))}};function ei(){const t=fs(),m=D(!1),s=D(!1),r=D(0),a=D(""),i=D(null),l=D({}),o=D(null),d={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},p=A(()=>{const $=Math.floor(r.value/60),q=r.value%60;return`${$.toString().padStart(2,"0")}:${q.toString().padStart(2,"0")}`}),c=()=>{m.value=!0,r.value=0,s.value=!1,a.value="",i.value=setInterval(()=>{r.value++,r.value>=20&&f()},1e3)},f=()=>{i.value&&(clearInterval(i.value),i.value=null),m.value=!1,s.value=!0,l.value={duration:r.value,notes:a.value,transcription:d,channel:"phone"}},y=async $=>{try{await navigator.clipboard.writeText($),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},x=$=>(o.value={tradeIn:d.leadLines.some(q=>q.toLowerCase().includes("trade")||q.toLowerCase().includes("exchange"))||!1,financing:d.leadLines.some(q=>q.toLowerCase().includes("financ")||q.toLowerCase().includes("payment")||q.toLowerCase().includes("loan"))||!1},o.value.tradeIn&&$&&($.value.tradeIn=!0),o.value.financing&&$&&($.value.financing=!0),o.value),w=()=>{m.value=!1,s.value=!1,r.value=0,a.value="",l.value={},i.value&&(clearInterval(i.value),i.value=null)};return ys(()=>{i.value&&clearInterval(i.value)}),{isCallActive:m,callEnded:s,callDuration:r,callNotes:a,callData:l,extractedData:o,mockTranscription:d,formattedCallDuration:p,startCall:c,endCall:f,copyNumber:y,extractInformation:x,resetCall:w}}function ti(t,m,s,r,a,i){var z,K,R;const l=D(!1),o=D(null),d=D(!1),p=D(null),c=D(!1),f=D(!1),y=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],x=D("whatsapp"),w=D("followup-1"),$=D(null),q=D(""),g=D("09:00"),b=D(null),h=D("Not Interested"),S=D(""),F=D({dealership:((K=(z=t.value)==null?void 0:z.requestedCar)==null?void 0:K.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((R=i==null?void 0:i.value)==null?void 0:R.id)||null}),H=D({tradeIn:!1,financing:!1,contactAvailability:!1}),ae=D(!1),de=D(null),ie=D(!0),le=A(()=>{var W,oe,ue,he,Ce,Se,qe;const J=((ue=(oe=(W=t.value)==null?void 0:W.customer)==null?void 0:oe.name)==null?void 0:ue.split(" ")[0])||"",Y=((Ce=(he=t.value)==null?void 0:he.requestedCar)==null?void 0:Ce.brand)||"",Q=((qe=(Se=t.value)==null?void 0:Se.requestedCar)==null?void 0:qe.model)||"";return{"followup-1":`Hi ${J}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${Y} ${Q}?`,"followup-2":`Hello ${J}, this is regarding your inquiry about the ${Y} ${Q}. Please let me know when you're available for a call.`,custom:""}}),fe=A(()=>w.value==="custom"?"Type your custom message...":le.value[w.value]||""),be=A(()=>{var J;return!!((J=t.value)!=null&&J.scheduledAppointment)}),Z=()=>{const J=new Date,Y=J.getHours(),Q=J.getDay();let W=new Date,oe="10:00",ue="";if(Q===5&&Y>=15)W.setDate(J.getDate()+3),oe="10:00",ue="Optimal time after weekend, customer likely refreshed";else if(Q===6||Q===0)W.setDate(J.getDate()+(Q===6?2:1)),oe="10:00",ue="Weekend follow-up avoided, better response rate on weekdays";else if(Y>=17)W.setDate(J.getDate()+1),oe="10:00",ue="Business hours preferred, higher engagement rate";else if(Y<9)W=new Date(J),W.setHours(10,0,0,0),oe="10:00",ue="Peak response time, customers more available mid-morning";else if(Y<14){W=new Date(J);const Se=Y+2;W.setHours(Se,0,0,0),oe=`${String(Se).padStart(2,"0")}:00`,ue="Follow-up within same day increases conversion likelihood"}else W.setDate(J.getDate()+1),W.setHours(10,0,0,0),oe="10:00",ue="Next morning follow-up maintains momentum";const he=W.toISOString().split("T")[0],Ce=`${he}T${oe}:00`;return{date:he,time:oe,dateTime:Ce,reason:ue,formattedDate:W.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:l,selectedOutcome:o,appointmentScheduled:d,scheduledAppointmentData:p,showNoteModal:c,showScheduleAppointmentModal:f,followupChannels:y,followupChannel:x,selectedTemplate:w,rescheduleTime:$,customDate:q,customTime:g,disqualifyCategory:h,disqualifyReason:S,assignment:F,preferences:H,surveyCompleted:ae,surveyResponses:de,showSurvey:ie,aiSuggestionData:b,messageTemplates:le,messagePreview:fe,hasExistingAppointment:be,selectOutcome:J=>{o.value=J,J==="interested"&&(ae.value=!1,de.value=null,ie.value=!0,s!=null&&s.value&&(H.value.tradeIn=s.value.tradeIn||!1,H.value.financing=s.value.financing||!1))},cancelOutcome:()=>{o.value=null,l.value=!1,d.value=!1,p.value=null},calculateNextCallDate:()=>{if($.value==="tomorrow-9am"){const Y=new Date;return Y.setDate(Y.getDate()+1),Y.setHours(9,0,0,0),Y.toISOString()}else if($.value==="monday"){if(b.value)return new Date(b.value.dateTime).toISOString();const Y=new Date,Q=(8-Y.getDay())%7||7;return Y.setDate(Y.getDate()+Q),Y.setHours(9,0,0,0),Y.toISOString()}else if($.value==="custom"&&q.value&&g.value)return new Date(`${q.value}T${g.value}:00`).toISOString();const J=new Date;return J.setDate(J.getDate()+1),J.setHours(9,0,0,0),J.toISOString()},calculateAISuggestion:Z,handleAISuggestionClick:()=>{$.value="monday",b.value=Z()},resetOutcomeState:()=>{o.value=null,l.value=!1,d.value=!1,p.value=null,x.value="whatsapp",w.value="followup-1",$.value=null,q.value="",g.value="09:00",h.value="Not Interested",S.value="",ae.value=!1,de.value=null,ie.value=!0,b.value=null}}}function si(t,m,s,r,a,i,l){const{callData:o}=m,{showOutcomeSelection:d,selectedOutcome:p,appointmentScheduled:c,scheduledAppointmentData:f,assignment:y,preferences:x,cancelOutcome:w,calculateNextCallDate:$,showScheduleAppointmentModal:q,surveyCompleted:g,surveyResponses:b,showSurvey:h}=s;return{logManualCall:()=>{o.value={channel:"external",notes:"",transcription:null},d.value=!0},handleScheduleAppointmentConfirm:async E=>{f.value=E,c.value=!0,q.value=!1,t("appointment-scheduled",E)},handleQualify:()=>{var B,te,I;const E={timestamp:new Date().toISOString(),outcome:"interested",channel:((B=o.value)==null?void 0:B.channel)||"phone",notes:((te=o.value)==null?void 0:te.notes)||"",transcription:((I=o.value)==null?void 0:I.transcription)||null};t("call-attempt-logged",E),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:y.value,preferences:x.value,scheduleAppointment:c.value,appointmentData:f.value,surveyData:g.value?b.value:null}),w()},handleDisqualifyFromInterested:()=>{var B,te,I;const E={timestamp:new Date().toISOString(),outcome:"interested",channel:((B=o.value)==null?void 0:B.channel)||"phone",notes:((te=o.value)==null?void 0:te.notes)||"",transcription:((I=o.value)==null?void 0:I.transcription)||null};t("call-attempt-logged",E),p.value="not-valid"},handleNoAnswerConfirm:async()=>{var L,z,K,R;const E={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((L=o.value)==null?void 0:L.channel)||"phone",notes:((z=o.value)==null?void 0:z.notes)||"",transcription:((K=o.value)==null?void 0:K.transcription)||null};t("call-attempt-logged",E);const B=$(),te=B.split("T")[0],I=new Date(B).toTimeString().slice(0,5);if(l&&((R=r.value)!=null&&R.id))try{await l.updateLead(r.value.id,{nextActionDue:B,status:"Pending"})}catch(J){console.error('Failed to update lead status to "to be called back":',J)}t("postponed",{date:te,time:I,createAppointment:!0}),(a==null?void 0:a.value)+1>=(i==null?void 0:i.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),w()},handleNotValidConfirm:()=>{var B,te,I;const E={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((B=o.value)==null?void 0:B.channel)||"phone",notes:((te=o.value)==null?void 0:te.notes)||"",transcription:((I=o.value)==null?void 0:I.transcription)||null};t("call-attempt-logged",E),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),w()},handleNoteSave:E=>{s.showNoteModal.value=!1,t("note-saved",E)},handleSurveyCompleted:async E=>{var B;if(b.value=E,g.value=!0,h.value=!1,l&&((B=r.value)!=null&&B.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(E),timestamp:new Date().toISOString()})}catch(te){console.error("Failed to save survey activity:",te)}t("survey-completed",{lead:r.value,responses:E})},handleSurveyRefused:async()=>{var E;if(h.value=!1,l&&((E=r.value)!=null&&E.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(B){console.error("Failed to save survey refusal activity:",B)}t("survey-refused",{lead:r.value})},handleNotResponding:async()=>{var E;if(h.value=!1,l&&((E=r.value)!=null&&E.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(B){console.error("Failed to save survey not responding activity:",B)}t("not-responding",{lead:r.value})}}}const ni={key:0,class:"flex gap-2 items-center mb-4"},ai={key:1,class:"mb-4 space-y-4 border-t border pt-4"},li={key:0,class:"bg-slate-900 text-white rounded-card p-4"},oi={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},ii={class:"flex items-center gap-2 text-red-400"},ri={class:"text-xs font-mono"},di={class:"space-y-3 text-sm font-mono"},ui={class:"ml-2"},ci={class:"ml-2"},pi={key:0},mi={class:"ml-2"},fi={key:1},yi={class:"ml-2"},gi={key:2},vi={class:"ml-2"},bi={class:"mt-4 pt-4 border-t border-slate-700"},hi=["model-value"],xi={class:"mt-4 flex justify-end"},wi={key:1,class:"bg-blue-50 border border-blue-200 rounded-card p-4"},ki={class:"flex items-center justify-between"},Ci={class:"flex gap-2"},Si={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(m,s)=>(u(),v("div",null,[t.showOutcomeSelection?T("",!0):(u(),v("div",ni,[e("button",{onClick:s[0]||(s[0]=r=>m.$emit("start-call")),class:U(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",t.isCallActive?"bg-brand-red text-white border-brand-red":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),_(" "+N(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],2),e("button",{onClick:s[1]||(s[1]=r=>m.$emit("log-manual-call")),class:U(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",t.callEnded&&!t.isCallActive?"bg-blue-50 border-blue-200 text-blue-700":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),_(" Log Call Outcome ",-1)])],2)])),t.isCallActive||t.callEnded?(u(),v("div",ai,[t.isCallActive?(u(),v("div",li,[e("div",oi,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",ii,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",ri,"REC "+N(t.formattedCallDuration),1)])]),e("div",di,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",ui,N(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",ci,N(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(u(),v("div",pi,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",mi,N(t.mockTranscription.leadLines[1]),1)])):T("",!0),t.callDuration>=8?(u(),v("div",fi,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",yi,N(t.mockTranscription.salesLines[1]),1)])):T("",!0),t.callDuration>=12?(u(),v("div",gi,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",vi,N(t.mockTranscription.leadLines[2]),1)])):T("",!0)]),e("div",bi,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=r=>m.$emit("update:call-notes",r)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,hi)]),e("div",xi,[C(n(ne),{label:"End Call",variant:"primary",size:"small",onClick:s[3]||(s[3]=r=>m.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):T("",!0),t.callEnded&&!t.isCallActive?(u(),v("div",wi,[e("div",ki,[s[15]||(s[15]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",Ci,[C(n(ne),{label:"Extract information",variant:"primary",size:"small",onClick:s[4]||(s[4]=r=>m.$emit("extract-information")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),C(n(ne),{label:"Log outcome",variant:"outline",size:"small",onClick:s[5]||(s[5]=r=>m.$emit("log-manual-call"))})])])])):T("",!0)])):T("",!0)]))}},$i={class:"bg-surfaceSecondary/50 rounded-lg p-6 relative transition-all duration-300"},Ai={class:"flex justify-between items-start mb-3"},Di={class:"font-bold text-heading text-fluid-sm"},Ti={class:"text-fluid-xs mt-0.5"},Ii={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},Oi={class:"text-fluid-xs text-blue-700"},Ni={key:1,class:"mb-3 bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},Mi={class:"flex items-center justify-between"},qi={class:"flex items-center gap-2"},Ei={class:"text-fluid-xs font-semibold text-heading"},Li={key:0,class:"text-fluid-xs text-orange-600 font-medium flex items-center gap-1"},Bi={class:"flex items-center gap-2 mb-3"},Fi={class:"text-fluid-sm text-body font-medium"},Ri={key:2,class:"mt-4 space-y-4 border-t border-E5E7EB pt-4"},ji={class:"grid grid-cols-3 gap-2"},Vi={key:0,class:"space-y-4"},Ui={class:"bg-surface border border-E5E7EB rounded-lg p-6"},Wi={class:"bg-surface border border-E5E7EB rounded-lg p-6"},zi={class:"grid grid-cols-3 gap-2"},Hi={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Pi={key:1,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Qi={class:"text-fluid-xs text-body"},_i={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Yi={key:1,class:"space-y-4 bg-surface border border-E5E7EB rounded-lg p-6"},Ji={class:"flex gap-4"},Gi={class:"flex items-center gap-2 cursor-pointer"},Ki={class:"flex items-center gap-2 cursor-pointer"},Zi={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Xi={key:2,class:"space-y-4"},er={class:"bg-surface border border-E5E7EB rounded-lg p-6"},tr={class:"flex gap-2 flex-wrap"},sr={key:0,class:"bg-surface border border-E5E7EB rounded-lg p-6"},nr={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-3"},ar={class:"bg-surface border border-E5E7EB rounded-lg p-6"},lr={class:"flex items-center justify-between mb-4"},or={key:0,class:"flex items-center gap-3 p-3 bg-surfaceSecondary rounded-lg border border-E5E7EB"},ir={key:0,class:"fa-solid fa-users text-fluid-sm"},rr={key:1},dr={class:"flex-1"},ur={class:"font-medium text-fluid-sm text-heading"},cr={class:"text-fluid-xs text-sub capitalize"},pr={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},mr={class:"grid grid-cols-2 gap-3 text-sm mb-3"},fr={class:"ml-2 font-medium text-heading"},yr={class:"ml-2 font-medium text-heading"},gr={class:"ml-2 font-medium text-heading capitalize"},vr={class:"ml-2 font-medium text-heading"},br={key:3},hr={key:5,class:"bg-green-50 border border-green-200 rounded-lg p-6"},xr={class:"flex items-start justify-between mb-3"},wr={class:"grid grid-cols-2 gap-3 text-fluid-sm"},kr={class:"ml-2 font-medium text-heading"},Cr={class:"ml-2 font-medium text-heading"},Sr={class:"ml-2 font-medium text-heading capitalize"},$r={class:"ml-2 font-medium text-heading"},Ar={class:"flex justify-between items-center pt-3 border-t border-E5E7EB"},Dr={class:"flex gap-2"},Tr={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=G=>{G||(Se.value=!1)},a=m,i=dt(),l=Fe();Le();const o=Je(),d=Qt(()=>s.lead,{}),p=ei(),{isCallActive:c,callEnded:f,callDuration:y,callNotes:x,callData:w,extractedData:$,mockTranscription:q,formattedCallDuration:g,startCall:b,endCall:h,copyNumber:S,extractInformation:F}=p,H=D(null),ae=D(!1),de=D(!1),ie=D(!1),le=D(!1);A(()=>i.assignableUsers);const fe=A(()=>l.currentUser),be=G=>G?G.split(" ").map(k=>k[0]).join("").toUpperCase().substring(0,2):"?",Z=G=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[G]||"bg-surfaceSecondary text-body",E=G=>{$e.value.assignee=G,ae.value=!1},B=()=>{b()},te=()=>{S(s.lead.customer.phone)},I=G=>{x.value=G},L=A(()=>{var G;return((G=d.primaryAction.value)==null?void 0:G.title)||"Call to Verify Contact Details"}),z=A(()=>{var G;return((G=d.primaryAction.value)==null?void 0:G.description)||"Begin lead qualification by verifying customer contact information."}),K=A(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),R=A(()=>!!s.lead.scheduledAppointment),J=A(()=>R.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:K.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${At(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),Y=d.contactAttempts,Q=d.maxContactAttempts,W=ti(_e(s,"lead"),w,$,Y,Q,fe),{showOutcomeSelection:oe,selectedOutcome:ue,appointmentScheduled:he,scheduledAppointmentData:Ce,showNoteModal:Se,showScheduleAppointmentModal:qe,followupChannel:Ke,selectedTemplate:ut,rescheduleTime:Te,customDate:Ze,customTime:Xe,disqualifyCategory:Ie,disqualifyReason:Pe,assignment:$e,preferences:ct,hasExistingAppointment:M,selectOutcome:j,cancelOutcome:ee,surveyCompleted:ce,showSurvey:V,aiSuggestionData:se,handleAISuggestionClick:me}=W;A(()=>s.activities.filter(G=>G.type==="note"));const Ae=si(a,p,W,_e(s,"lead"),Y,Q,o),{logManualCall:et,handleScheduleAppointmentConfirm:Dt,handleQualify:Jt,handleDisqualifyFromInterested:Gt,handleNoAnswerConfirm:Kt,handleNotValidConfirm:Zt,handleNoteSave:Xt,handleSurveyCompleted:es,handleSurveyRefused:ts,handleNotResponding:ss}=Ae,ns=[{key:"interestLevel",label:"Customer interest level?",type:"radio",options:["High","Medium","Low"]},{key:"purchaseTimeline",label:"Expected purchase timeline?",type:"select",options:["Immediate","Within 1 month","Within 3 months","Within 6 months","Just browsing"]},{key:"budgetRange",label:"Budget range (if discussed)?",type:"select",options:["Under â‚¬30k","â‚¬30k-â‚¬50k","â‚¬50k-â‚¬80k","â‚¬80k+","Not discussed"]},{key:"preferredContact",label:"Preferred contact method?",type:"radio",options:["Phone","Email","WhatsApp","SMS"]},{key:"additionalNotes",label:"Additional notes",type:"text",placeholder:"Any relevant information about customer interest or preferences..."}],{saveTradeInVehicle:as}=Ns(),ls=async G=>{var k,X,Oe;try{ie.value=!1,ct.value.financing=!0;const Ne=G.type==="FIN"?"Captive Financing":G.type==="LEA"?"Leasing":"Long-Term Rental",rs=((k=G.fields)==null?void 0:k.monthlyInstalment)||0;await o.addActivity(s.lead.id,{type:"purchase-method",user:((X=fe.value)==null?void 0:X.name)||"You",action:`added a ${Ne} purchase method`,content:`${Ne}: â‚¬${rs.toLocaleString()}/month for ${((Oe=G.fields)==null?void 0:Oe.duration)||0} months`,data:{purchaseMethodId:G.id,type:G.type,...G.fields},timestamp:new Date().toISOString()}),a("note-saved",{type:"purchase-method",...G})}catch(Ne){console.error("Error saving purchase method:",Ne)}},os=async G=>{try{if(le.value=!1,G.vehicleType==="tradein"||s.mode==="tradein"){const k=await as("lead",s.lead.id,G.vehicle,G.valuation||{});ct.value.tradeIn=!0,a("note-saved",{type:"tradein",id:k.activity.id,action:"added a trade-in",vehicleId:k.vehicle.id,data:k.activity.data,timestamp:k.activity.timestamp})}else{const{addVehicleToCustomer:k}=await gs(async()=>{const{addVehicleToCustomer:X}=await import("./opportunities-XVgMwMKa.js").then(Oe=>Oe.e);return{addVehicleToCustomer:X}},__vite__mapDeps([0,1,2]));await k(s.lead.customerId,G.vehicle),a("note-saved",{type:"vehicle",vehicleType:G.vehicleType,...G.vehicle})}}catch(k){console.error("Error saving vehicle:",k)}},is=async G=>{var k;try{Ke.value=G.type,ut.value=G.template||"";const X={email:"sent an email",sms:"sent an SMS",whatsapp:"sent a WhatsApp message"},Oe=((k=fe.value)==null?void 0:k.name)||"You";let Ne=G.message||"";G.type==="email"&&G.subject&&(Ne=`${G.subject}: ${Ne}`),await o.addActivity(s.lead.id,{type:G.type,user:Oe,action:X[G.type]||"sent a message",content:Ne,timestamp:new Date().toISOString()})}catch(X){console.error("Failed to save follow-up communication:",X)}};return(G,k)=>(u(),v("div",$i,[e("div",Ai,[e("div",null,[e("h4",Di,N(L.value),1),e("p",Ti,N(z.value),1)]),e("div",{class:U(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",J.value.class])},N(J.value.text),3)]),R.value?(u(),v("div",Ii,[k[28]||(k[28]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-fluid-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",Oi,N(n(Ye)(t.lead.scheduledAppointment.start))+" at "+N(n(st)(t.lead.scheduledAppointment.start)),1)])):T("",!0),n(Y)>0?(u(),v("div",Ni,[e("div",Mi,[e("div",qi,[k[29]||(k[29]=e("i",{class:"fa-solid fa-phone text-body text-xs"},null,-1)),k[30]||(k[30]=e("span",{class:"text-fluid-xs font-semibold text-body"},"Contact Attempts:",-1)),e("span",Ei,N(n(Y))+" / "+N(n(Q)),1)]),n(Y)>=n(Q)-1?(u(),v("div",Li,[...k[31]||(k[31]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),_(" One more attempt before auto-disqualification ",-1)])])):T("",!0)])])):T("",!0),e("div",Bi,[e("span",Fi,N(t.lead.customer.phone),1),e("button",{onClick:te,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...k[32]||(k[32]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),C(Si,{"is-call-active":n(c),"call-ended":n(f),"call-duration":n(y),"call-notes":n(x),"formatted-call-duration":n(g),"mock-transcription":n(q),"show-outcome-selection":n(oe),"contact-attempts":n(Y),"max-contact-attempts":n(Q),onStartCall:B,onEndCall:n(h),onLogManualCall:n(et),onExtractInformation:n(F),"onUpdate:callNotes":I,onCopyNumber:te},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),n(oe)?(u(),v("div",Ri,[e("div",null,[k[36]||(k[36]=e("h4",{class:"font-semibold text-heading mb-2 text-fluid-sm"},"What's the outcome?",-1)),e("div",ji,[e("button",{onClick:k[0]||(k[0]=X=>n(j)("no-answer")),class:U(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(ue)==="no-answer"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},[...k[33]||(k[33]=[e("i",{class:"fa-solid fa-phone-slash text-sm"},null,-1),e("span",null,"No answer",-1)])],2),e("button",{onClick:k[1]||(k[1]=X=>n(j)("not-valid")),class:U(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(ue)==="not-valid"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},[...k[34]||(k[34]=[e("i",{class:"fa-solid fa-ban text-sm"},null,-1),e("span",null,"Not valid",-1)])],2),e("button",{onClick:k[2]||(k[2]=X=>n(j)("interested")),class:U(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(ue)==="interested"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},[...k[35]||(k[35]=[e("i",{class:"fa-solid fa-check-circle text-sm"},null,-1),e("span",null,"Interested",-1)])],2)])]),n(ue)==="no-answer"?(u(),v("div",Vi,[e("div",Ui,[C(Xo,{title:"Send follow-up message","show-email":!0,"show-sms":!0,"show-whatsapp":!0,"show-dont-send":!0,onSend:is,onDontSend:k[3]||(k[3]=()=>{n(Ke).value="dont-send"}),onCancel:k[4]||(k[4]=()=>{n(ue).value=null})})]),e("div",Wi,[k[40]||(k[40]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-2"},"Next call attempt",-1)),e("div",zi,[e("button",{onClick:k[5]||(k[5]=X=>Te.value="tomorrow-9am"),class:U(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(Te)==="tomorrow-9am"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:k[6]||(k[6]=(...X)=>n(me)&&n(me)(...X)),class:U(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(Te)==="monday"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," AI suggestion ",2),e("button",{onClick:k[7]||(k[7]=X=>Te.value="custom"),class:U(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(Te)==="custom"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," Select time ",2)]),n(Te)==="custom"?(u(),v("div",Hi,[e("div",null,[k[37]||(k[37]=e("label",{class:"block text-fluid-xs font-semibold mb-1.5"},"Date",-1)),re(e("input",{type:"date","onUpdate:modelValue":k[8]||(k[8]=X=>tt(Ze)?Ze.value=X:null),class:"input"},null,512),[[ge,n(Ze)]])]),e("div",null,[k[38]||(k[38]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Time",-1)),re(e("input",{type:"time","onUpdate:modelValue":k[9]||(k[9]=X=>tt(Xe)?Xe.value=X:null),class:"input"},null,512),[[ge,n(Xe)]])])])):T("",!0),n(Te)==="monday"&&n(se)?(u(),v("div",Pi,[e("p",Qi,[k[39]||(k[39]=e("span",{class:"font-semibold text-heading"},"AI Suggestion:",-1)),_(" "+N(n(se).formattedDate)+" at "+N(n(se).time)+". "+N(n(se).reason),1)])])):T("",!0)]),e("div",_i,[C(n(ne),{label:"Cancel",variant:"outline",size:"small",onClick:n(ee)},null,8,["onClick"]),C(n(ne),{label:"Send and reschedule",variant:"primary",size:"small",onClick:n(Kt),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])):T("",!0),n(ue)==="not-valid"?(u(),v("div",Yi,[e("div",null,[k[43]||(k[43]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"Category",-1)),e("div",Ji,[e("label",Gi,[re(e("input",{type:"radio","onUpdate:modelValue":k[10]||(k[10]=X=>tt(Ie)?Ie.value=X:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[ot,n(Ie)]]),k[41]||(k[41]=e("span",{class:"text-fluid-sm text-body"},"Not Valid",-1))]),e("label",Ki,[re(e("input",{type:"radio","onUpdate:modelValue":k[11]||(k[11]=X=>tt(Ie)?Ie.value=X:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[ot,n(Ie)]]),k[42]||(k[42]=e("span",{class:"text-fluid-sm text-body"},"Not Interested",-1))])])]),e("div",null,[k[45]||(k[45]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Failure Reason",-1)),re(e("select",{"onUpdate:modelValue":k[12]||(k[12]=X=>tt(Pe)?Pe.value=X:null),class:"input"},[...k[44]||(k[44]=[lt('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[Ge,n(Pe)]])]),e("div",Zi,[C(n(ne),{label:"Cancel",variant:"outline",size:"small",onClick:n(ee)},null,8,["onClick"]),C(n(ne),{label:"Confirm Disqualification",variant:"primary",size:"small",disabled:!n(Ie)||!n(Pe),onClick:n(Zt),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"},null,8,["disabled","onClick"])])])):T("",!0),n(ue)==="interested"?(u(),v("div",Xi,[e("div",er,[k[46]||(k[46]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Customer data",-1)),e("div",tr,[C(n(ne),{label:"+ Add vehicle",variant:"primary",size:"small",onClick:k[13]||(k[13]=X=>le.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),C(n(ne),{label:"+ Add financing",variant:"primary",size:"small",onClick:k[14]||(k[14]=X=>ie.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),C(n(ne),{label:"+ Add note",variant:"primary",size:"small",onClick:k[15]||(k[15]=X=>Se.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"})])]),n(V)&&!n(ce)?(u(),v("div",sr,[C(Me,{questions:ns,"initial-expanded":!1,onSurveyCompleted:n(es),onSurveyRefused:n(ts),onNotResponding:n(ss)},null,8,["onSurveyCompleted","onSurveyRefused","onNotResponding"])])):T("",!0),n(ce)?(u(),v("div",nr,[...k[47]||(k[47]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle text-green-600 text-sm"}),e("span",{class:"text-fluid-xs font-semibold text-green-900"},"Survey completed")],-1)])])):T("",!0),e("div",ar,[e("div",lr,[k[48]||(k[48]=e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Assign to salesman",-1)),C(n(ne),{label:"Change",variant:"outline",size:"small",class:"text-fluid-xs",onClick:k[16]||(k[16]=X=>ae.value=!0)})]),n($e).assignee?(u(),v("div",or,[e("div",{class:U(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-fluid-sm",n($e).assignee.type==="team"?"bg-green-100 text-green-700":Z(n($e).assignee.role)])},[n($e).assignee.type==="team"?(u(),v("i",ir)):(u(),v("span",rr,N(be(n($e).assignee.name)),1))],2),e("div",dr,[e("p",ur,N(n($e).assignee.name),1),e("p",cr,N(n($e).assignee.type==="team"?"Team":n($e).assignee.role),1)])])):(u(),v("button",{key:1,onClick:k[17]||(k[17]=X=>ae.value=!0),class:"w-full p-4 border-2 border-dashed border-E5E7EB rounded-lg hover:border-brand-red hover:bg-red-50/50 transition-colors text-center"},[...k[49]||(k[49]=[e("i",{class:"fa-solid fa-user-plus text-2xl text-sub mb-2"},null,-1),e("p",{class:"text-fluid-sm font-medium text-body"},"Click to assign to salesman",-1)])]))]),n(M)&&!n(he)?(u(),v("div",pr,[k[54]||(k[54]=lt('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="heading-sub">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",mr,[e("div",null,[k[50]||(k[50]=e("span",{class:"text-body"},"Date:",-1)),e("span",fr,N(n(Ye)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[k[51]||(k[51]=e("span",{class:"text-body"},"Time:",-1)),e("span",yr,N(n(st)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[k[52]||(k[52]=e("span",{class:"text-body"},"Type:",-1)),e("span",gr,N(t.lead.scheduledAppointment.type),1)]),e("div",null,[k[53]||(k[53]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",vr,N(t.lead.scheduledAppointment.assignee),1)])]),C(n(ne),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:k[18]||(k[18]=X=>qe.value=!0)})])):T("",!0),!n(M)&&!de.value&&!n(he)?(u(),v("div",br,[e("button",{onClick:k[19]||(k[19]=X=>de.value=!0),class:"w-full p-4 border-2 border-dashed border-E5E7EB rounded-lg hover:border-blue-300 hover:bg-blue-50/50 transition-colors text-center"},[...k[55]||(k[55]=[e("i",{class:"fa-solid fa-calendar-plus text-2xl text-blue-600 mb-2"},null,-1),e("p",{class:"text-fluid-sm font-medium text-heading"},"Schedule Appointment",-1),e("p",{class:"text-fluid-xs text-sub mt-1"},"Book a meeting or test drive (optional)",-1)])])])):T("",!0),de.value&&!n(he)?(u(),P(Fo,{key:4,"preselected-assignee":n($e).assignee,"can-cancel":!0,onConfirm:n(Dt),onCancel:k[20]||(k[20]=X=>de.value=!1)},null,8,["preselected-assignee","onConfirm"])):T("",!0),n(he)?(u(),v("div",hr,[e("div",xr,[k[56]||(k[56]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-calendar-check text-green-600"}),e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Appointment Scheduled")],-1)),e("button",{onClick:k[21]||(k[21]=()=>{de.value=!0,he.value=!1}),class:"text-fluid-xs text-green-700 hover:underline font-medium"}," Reschedule ")]),e("div",wr,[e("div",null,[k[57]||(k[57]=e("span",{class:"text-body"},"Date:",-1)),e("span",kr,N(n(Ye)(n(Ce).datetime)),1)]),e("div",null,[k[58]||(k[58]=e("span",{class:"text-body"},"Time:",-1)),e("span",Cr,N(n(Ce).time),1)]),e("div",null,[k[59]||(k[59]=e("span",{class:"text-body"},"Type:",-1)),e("span",Sr,N(n(Ce).type),1)]),e("div",null,[k[60]||(k[60]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",$r,N(n(Ce).assignee),1)])])])):T("",!0),e("div",Ar,[C(n(ne),{label:"Cancel",variant:"outline",size:"small",onClick:n(ee)},null,8,["onClick"]),e("div",Dr,[C(n(ne),{label:"Disqualify",variant:"outline",size:"small",onClick:n(Gt)},null,8,["onClick"]),C(n(ne),{label:"Qualify",variant:"primary",size:"small",onClick:n(Jt),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"},null,8,["onClick"])])])])):T("",!0)])):T("",!0),C(n(He),{open:n(Se),"onUpdate:open":r},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-2xl"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...k[61]||(k[61]=[_("Add Note",-1)])]),_:1})]),_:1}),C(Ms,{ref_key:"noteWidgetRef",ref:H,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(Xt),onCancel:k[22]||(k[22]=X=>Se.value=!1)},null,8,["task-id","onSave"]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>{var X,Oe;return[C(n(ne),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k[23]||(k[23]=Ne=>Se.value=!1)},{default:O(()=>[...k[62]||(k[62]=[_(" Cancel ",-1)])]),_:1}),C(n(ne),{variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!((X=H.value)!=null&&X.canSubmit()),onClick:(Oe=H.value)==null?void 0:Oe.submit},{default:O(()=>[...k[63]||(k[63]=[_(" Save Note ",-1)])]),_:1},8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),C(wo,{show:n(qe),"preselected-assignee":n($e).assignee,onConfirm:n(Dt),onClose:k[24]||(k[24]=X=>qe.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),C(Rt,{show:ae.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:E,onClose:k[25]||(k[25]=X=>ae.value=!1)},null,8,["show"]),C(qs,{show:ie.value,"task-type":"lead","task-id":t.lead.id,onSave:ls,onClose:k[26]||(k[26]=X=>ie.value=!1)},null,8,["show","task-id"]),C(Es,{show:le.value,mode:"vehicle","task-type":"lead","task-id":t.lead.id,"customer-id":t.lead.customerId,onClose:k[27]||(k[27]=X=>le.value=!1),onSave:os},null,8,["show","task-id","customer-id"])]))}},Ir={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-card p-4"},Or={class:"flex justify-between items-start mb-3"},Nr={class:"text-fluid-xs text-gray-500 mt-0.5"},Mr={key:0},qr={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:m}){const s=t,r=m,a=Je(),i=()=>{var h;const b=a.currentLead;return b&&b.id===((h=s.lead)==null?void 0:h.id)?b:s.lead},l={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},o=Qt(_e(s,"lead"),l),{handlePostponed:d,handleValidated:p,handleQualified:c,handleCallAttemptLogged:f,handleNoteSaved:y,handleOpenPurchaseMethod:x,handleOpenTradeIn:w,handleAppointmentScheduled:$,handleDisqualified:q,handleReopen:g}=Hl({getLead:i,leadState:o,emit:r});return(b,h)=>(u(),P(_t,{task:t.lead},{"deadline-banner":O(()=>[C(eo,{"next-action-due":t.lead.nextActionDue,"is-closed":n(o).isClosed.value,"show-deadline-banner":n(o).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":O(()=>[!n(o).isClosed.value&&n(o).showLQWidget.value?(u(),P(Tr,{key:t.lead.id,lead:t.lead,onPostponed:n(d),onValidated:n(p),onQualified:n(c),onDisqualified:n(q),onCallAttemptLogged:n(f),onNoteSaved:n(y),onOpenPurchaseMethod:n(x),onOpenTradeIn:n(w),onAppointmentScheduled:n($)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(o).isClosed.value&&n(o).primaryAction.value?(u(),P(Yt,{key:1,action:n(o).primaryAction.value,"color-scheme":n(o).primaryAction.value.colorScheme,onActionClicked:n(o).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):T("",!0)]),"task-widgets":O(()=>[...h[0]||(h[0]=[])]),"closed-state":O(()=>[n(o).isClosed.value?(u(),v("div",Ir,[e("div",Or,[e("div",null,[h[1]||(h[1]=e("h4",{class:"font-bold text-gray-900 text-fluid-sm"},"Lead Closed",-1)),e("p",Nr,[_(" Status: "+N(n(o).displayStage.value)+" ",1),t.lead.disqualifyReason?(u(),v("span",Mr," - "+N(t.lead.disqualifyReason),1)):T("",!0)])])]),C(n(ne),{variant:"primary",size:"small",onClick:n(g),class:"flex items-center gap-2"},{default:O(()=>[...h[2]||(h[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):T("",!0)]),_:1},8,["task"]))}},Er={class:"flex justify-between items-start mb-3"},Lr={class:"font-bold text-heading text-fluid-sm"},Br={class:"text-fluid-xs text-sub mt-0.5"},Fr={class:"flex gap-3 flex-wrap"},Be={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(m,s)=>(u(),v("div",{class:U(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Er,[e("div",null,[e("h4",Lr,N(t.title),1),e("p",Br,N(t.description),1)]),xe(m.$slots,"badge")]),e("div",Fr,[xe(m.$slots,"actions")]),xe(m.$slots,"survey"),xe(m.$slots,"content")],2))}},Rr={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],i=A(()=>{if(!s.opportunity.createdAt)return 0;const f=new Date(s.opportunity.createdAt),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),l=()=>{r("create-offer",s.opportunity)},o=()=>{r("review",s.opportunity)},d=f=>{r("survey-completed",{opportunity:s.opportunity,responses:f})},p=()=>{r("survey-refused",{opportunity:s.opportunity})},c=()=>{r("not-responding",{opportunity:s.opportunity})};return(f,y)=>(u(),P(Be,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${i.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:o,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:d,onSurveyRefused:p,onNotResponding:c})]),_:1},8,["description"]))}},jr={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],i=A(()=>{if(!s.opportunity.createdAt)return 0;const c=new Date(s.opportunity.createdAt),y=Math.abs(new Date-c);return Math.ceil(y/(1e3*60*60*24))}),l=()=>{r("create-offer",s.opportunity)},o=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},d=()=>{r("survey-refused",{opportunity:s.opportunity})},p=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,f)=>(u(),P(Be,{title:"Unsold Feedback",description:`This opportunity has been open for ${i.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:o,onSurveyRefused:d,onNotResponding:p})]),_:1},8,["description"]))}},Vr={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],i=()=>{r("schedule-closing",s.opportunity)},l=p=>{r("survey-completed",{opportunity:s.opportunity,responses:p})},o=()=>{r("survey-refused",{opportunity:s.opportunity})},d=()=>{r("not-responding",{opportunity:s.opportunity})};return(p,c)=>(u(),P(Be,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:O(()=>[e("button",{onClick:i,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:l,onSurveyRefused:o,onNotResponding:d})]),_:1}))}},Ur={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],i=A(()=>{const c=s.opportunity.lastActivity||s.opportunity.createdAt;if(!c)return 0;const f=new Date(c),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),l=()=>{r("create-contract",s.opportunity)},o=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},d=()=>{r("survey-refused",{opportunity:s.opportunity})},p=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,f)=>(u(),P(Be,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${i.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:o,onSurveyRefused:d,onNotResponding:p})]),_:1},8,["description"]))}},Wr={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],i=A(()=>{var w;if(!((w=s.opportunity)!=null&&w.contractDate))return 0;const f=new Date(s.opportunity.contractDate),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),l=()=>{r("prepare-delivery",s.opportunity)},o=()=>{r("pre-delivery-checklist",s.opportunity)},d=f=>{r("survey-completed",{opportunity:s.opportunity,responses:f})},p=()=>{r("survey-refused",{opportunity:s.opportunity})},c=()=>{r("not-responding",{opportunity:s.opportunity})};return(f,y)=>(u(),P(Be,{title:"Contract Feedback",description:`Contract was signed ${i.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:o,class:"bg-surface border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:d,onSurveyRefused:p,onNotResponding:c})]),_:1},8,["description"]))}},zr={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],i=A(()=>{const c=s.activities.find(w=>{var $;return w.type==="delivery"||(($=w.action)==null?void 0:$.toLowerCase().includes("delivered"))});if(!c||!c.timestamp)return 0;const f=new Date(c.timestamp),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),l=()=>{r("delivery-feedback",s.opportunity)},o=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},d=()=>{r("survey-refused",{opportunity:s.opportunity})},p=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,f)=>(u(),P(Be,{title:"Delivery Feedback",description:`Vehicle was delivered ${i.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:o,onSurveyRefused:d,onNotResponding:p})]),_:1},8,["description"]))}},Hr={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:m}){const s=t,r=m,a=A(()=>{var w;return((w=s.scheduledAppointment)==null?void 0:w.noShowCount)||0}),i=A(()=>{const w=a.value;return w===0?"No-Show Follow-up":w>=3?`No-Show #${w} - Final Warning`:`No-Show #${w} Follow-up`}),l=A(()=>{const w=a.value;return w>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":w>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),o=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],d=A(()=>{var $;return($=s.scheduledAppointment)!=null&&$.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),p=()=>{r("contact-customer",s.opportunity)},c=()=>{const w=a.value;if(w>=3)r("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${w} no-shows`});else if(w===1||w===2){const $=new Date;$.setDate($.getDate()+2),r("set-callback",{opportunity:s.opportunity,callbackDate:$.toISOString()})}else r("reschedule",s.opportunity)},f=w=>{r("survey-completed",{opportunity:s.opportunity,responses:w})},y=()=>{r("survey-refused",{opportunity:s.opportunity})},x=()=>{r("not-responding",{opportunity:s.opportunity})};return(w,$)=>(u(),P(Be,{title:i.value,description:`Appointment was scheduled for ${d.value} but customer did not show up. ${l.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:O(()=>[e("button",{onClick:c,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...$[0]||($[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),_(" Book Another Appointment ",-1)])]),e("button",{onClick:p,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...$[1]||($[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),_(" Contact Customer ",-1)])])]),survey:O(()=>[C(Me,{questions:o,onSurveyCompleted:f,onSurveyRefused:y,onNotResponding:x})]),_:1},8,["title","description"]))}},Pr={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m;Le();const a=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],i=A(()=>{const y=s.opportunity.lastActivity||s.opportunity.createdAt;if(!y)return 0;const x=new Date(y),$=Math.abs(new Date-x);return Math.ceil($/(1e3*60*60*24))}),l=()=>{r("reopen",s.opportunity)},o=()=>{r("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},d=()=>{r("requalify",s.opportunity)},p=y=>{r("survey-completed",{opportunity:s.opportunity,responses:y})},c=()=>{r("survey-refused",{opportunity:s.opportunity})},f=()=>{r("not-responding",{opportunity:s.opportunity})};return(y,x)=>(u(),P(Be,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${i.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...x[0]||(x[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),_(" Reopen Opportunity ",-1)])]),e("button",{onClick:o,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...x[1]||(x[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),_(" Close as Lost ",-1)])]),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...x[2]||(x[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),_(" Requalify as Lead ",-1)])])]),survey:O(()=>[C(Me,{questions:a,onSurveyCompleted:p,onSurveyRefused:c,onNotResponding:f})]),_:1},8,["description"]))}},Qr={OOFB:Rr,UFB:jr,NFU:Vr,OFB:Ur,CFB:Wr,DFB:zr,NS:Hr,ABANDONED:Pr};function _r(t,m,s,r,a){const i=A(()=>{const y=pt(t),x=pt(m),w=pt(s);return{opportunity:y,scheduledAppointment:x,activities:w,hasOffers:(w==null?void 0:w.some($=>$.type==="offer"))||!1,stage:y.displayStage||y.stage,deliverySubstatus:y.deliverySubstatus||null,formatDateTime:a,hasActiveTaskWidget:!1}}),l=A(()=>{const y=i.value,x=Ls(y.stage,y);if(!x)return null;const w=Qr[x];return w?{type:x,component:w,props:{opportunity:y.opportunity,appointment:y.scheduledAppointment,activities:y.activities}}:null}),o=A(()=>({...i.value,hasActiveTaskWidget:!!l.value})),d=A(()=>{const y=o.value,x=Bs(y.stage,y);if(!x)return null;const w=r[x.key];return{...x,handler:w||(()=>{})}}),p=A(()=>{const y=o.value;return Fs(y.stage,y).map(w=>{const $=r[w.key];return{...w,handler:$||(()=>{})}})}),c=A(()=>{const y=i.value;return Rs(y.stage)}),f=A(()=>!l.value||!l.value.type?"":js(l.value.type));return{primaryAction:d,secondaryActions:p,activeTaskWidget:l,taskWidgetTitle:f,isClosed:c}}const Yr={class:"relative"},Jr=["disabled"],Gr={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-50 dropdown-menu-small"},Kr={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:m}){const s=t,r=m,a=D(!1),i=()=>{a.value=!a.value},l=()=>{a.value=!1},o=p=>{p.disabled||(l(),r("action-selected",p),p.handler&&typeof p.handler=="function"&&p.handler())},d=A(()=>(s.actions||[]).map(p=>({key:p.key,label:p.label,disabled:!!p.disabled,onClick:()=>o(p)})));return(p,c)=>{const f=wt("click-outside");return re((u(),v("div",Yr,[e("button",{onClick:i,class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[c[0]||(c[0]=e("span",null,"More actions",-1)),e("i",{class:U(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":a.value}])},null,2)],8,Jr),C(ft,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:O(()=>[a.value?(u(),v("div",Gr,[C(n(kt),{items:d.value,className:"min-w-full"},null,8,["items"])])):T("",!0)]),_:1})])),[[f,l]])}}},Zr={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},Xr=["src","alt"],ed={key:1,class:"w-full h-full flex items-center justify-center"},td={class:"flex items-center justify-between mb-1.5"},sd={class:"text-sm font-bold text-heading"},nd={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},ad={class:"text-xs text-sub mb-1.5"},ld={key:0,class:"text-xs text-green-600 font-medium mb-2"},od={key:1,class:"text-xs text-orange-600 font-medium mb-2"},qt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const m=t,s=A(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[m.badge]||"gray"),r=a=>a?a.toLocaleString("en-US"):"0";return(a,i)=>(u(),v("div",{onClick:i[1]||(i[1]=l=>a.$emit("select")),class:U(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",Zr,[t.vehicle.image?(u(),v("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Xr)):(u(),v("div",ed,[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",td,[C(n(mt),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",sd,"â‚¬"+N(r(t.vehicle.price)),1)]),e("h4",nd,N(t.vehicle.brand)+" "+N(t.vehicle.model),1),e("p",ad,N(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(u(),v("div",ld,[i[3]||(i[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),_(" In stock ("+N(t.stockDays)+" days) ",1)])):(u(),v("div",od,[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),_(" Out of stock ",-1)])])),e("button",{onClick:i[0]||(i[0]=at(l=>a.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},id={class:"space-y-6"},rd={key:0},dd={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},ud={class:"mb-4"},cd={class:"relative"},pd={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},md={key:1,class:"text-center py-8 text-sub"},fd={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},yd={key:0,class:"mt-4 space-y-3"},gd={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},vd={class:"flex justify-end"},bd=["disabled"],hd={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:m}){const s=t,r=m,a=h=>{h||r("close")},i=D(""),l=D(!1),o=D(null),d=D(null),p=D(null),c=D([]),f=D({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});St(async()=>{try{const h=await jt({});c.value=h.data||[]}catch(h){console.error("Failed to load vehicles:",h),c.value=[]}});const y=A(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),x=A(()=>{const h=[];if(s.requestedVehicle&&y.value&&h.push({...s.requestedVehicle,isRequested:!0}),c.value&&c.value.length>0){const S=c.value.filter(H=>s.requestedVehicle?H.brand!==s.requestedVehicle.brand||H.model!==s.requestedVehicle.model:!0),F=s.requestedVehicle&&y.value?3:4;h.push(...S.slice(0,F))}return h}),w=A(()=>{if(!c.value||c.value.length===0)return[];let h=[...c.value];if(i.value){const S=i.value.toLowerCase();h=h.filter(F=>F.brand.toLowerCase().includes(S)||F.model.toLowerCase().includes(S)||F.year.toString().includes(S))}return h}),$=A(()=>f.value.brand&&f.value.model&&f.value.year&&f.value.price>0),q=(h,S)=>{o.value=h,d.value=h.id||`custom-${Date.now()}`,p.value=S},g=()=>{if(!$.value)return;const h={...f.value,id:`custom-${Date.now()}`,isCustom:!0};q(h,"custom")},b=()=>{o.value&&(r("vehicle-selected",{vehicle:o.value,type:p.value}),r("close"),o.value=null,d.value=null,p.value=null,i.value="",l.value=!1,f.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(h,S)=>(u(),P(n(He),{open:t.show,"onUpdate:open":a},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-6xl"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...S[7]||(S[7]=[_("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",id,[x.value.length?(u(),v("div",rd,[S[8]||(S[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),_(" Recommended Vehicles ")],-1)),e("div",dd,[(u(!0),v(ye,null,ve(x.value,F=>(u(),P(qt,{key:F.id,vehicle:F,badge:F.isRequested?"Requested":"Recommended","stock-days":F.stockDays,selected:d.value===F.id,onSelect:H=>q(F,F.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):T("",!0),e("div",null,[S[11]||(S[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),_(" Browse Stock ")],-1)),e("div",ud,[e("div",cd,[S[9]||(S[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),re(e("input",{"onUpdate:modelValue":S[0]||(S[0]=F=>i.value=F),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ge,i.value]])])]),w.value.length?(u(),v("div",pd,[(u(!0),v(ye,null,ve(w.value,F=>(u(),P(qt,{key:F.id,vehicle:F,badge:"In Stock","stock-days":F.stockDays,selected:d.value===F.id,onSelect:H=>q(F,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(u(),v("div",md,[...S[10]||(S[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[S[19]||(S[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),_(" Configure Custom Vehicle ")],-1)),e("div",fd,[S[18]||(S[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:S[1]||(S[1]=F=>l.value=!l.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[S[12]||(S[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),_(" "+N(l.value?"Hide Configuration":"Build Custom Configuration"),1)]),l.value?(u(),v("div",yd,[e("div",gd,[e("div",null,[S[13]||(S[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),re(e("input",{"onUpdate:modelValue":S[2]||(S[2]=F=>f.value.brand=F),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ge,f.value.brand]])]),e("div",null,[S[14]||(S[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),re(e("input",{"onUpdate:modelValue":S[3]||(S[3]=F=>f.value.model=F),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ge,f.value.model]])]),e("div",null,[S[15]||(S[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),re(e("input",{"onUpdate:modelValue":S[4]||(S[4]=F=>f.value.year=F),type:"number",class:"input",placeholder:"2024"},null,512),[[ge,f.value.year]])]),e("div",null,[S[16]||(S[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (â‚¬)",-1)),re(e("input",{"onUpdate:modelValue":S[5]||(S[5]=F=>f.value.price=F),type:"number",class:"input",placeholder:"98000"},null,512),[[ge,f.value.price]])])]),e("div",vd,[e("button",{onClick:g,disabled:!$.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...S[17]||(S[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),_(" Use Custom Configuration ",-1)])],8,bd)])])):T("",!0)])])]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:S[6]||(S[6]=F=>h.$emit("close"))}),o.value?(u(),P(n(ne),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:b})):T("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},xd={class:"space-y-4"},wd=["max"],kd={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=D(""),i=D(""),l=D(""),o=A(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,f=>{if(f){const y=new Date;a.value=y.toISOString().split("T")[0],i.value=y.toTimeString().slice(0,5),l.value=""}});const d=()=>{if(!a.value)return;const f=i.value?`${a.value}T${i.value}:00`:`${a.value}T12:00:00`;r("confirm",{contractDate:f,notes:l.value})},p=()=>{r("cancel")},c=f=>{f||p()};return(f,y)=>(u(),P(n(He),{open:t.show,"onUpdate:open":c},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...y[3]||(y[3]=[_("Set Contract Signing Date",-1)])]),_:1}),C(n(gt),null,{default:O(()=>[...y[4]||(y[4]=[_("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",xd,[e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),re(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=x=>a.value=x),max:o.value,class:"input"},null,8,wd),[[ge,a.value]])]),e("div",null,[y[6]||(y[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),re(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=x=>i.value=x),class:"input"},null,512),[[ge,i.value]])]),e("div",null,[y[7]||(y[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),re(e("textarea",{"onUpdate:modelValue":y[2]||(y[2]=x=>l.value=x),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ge,l.value]])])]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:p}),C(n(ne),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value,onClick:d},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Cd={class:"space-y-4"},Sd=["max"],$d={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=D(""),i=D(""),l=D(""),o=D(""),d=A(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,y=>{if(y){const x=new Date;a.value=x.toISOString().split("T")[0],i.value=x.toTimeString().slice(0,5),l.value="",o.value=""}});const p=()=>{if(!a.value||!l.value)return;const y=i.value?`${a.value}T${i.value}:00`:`${a.value}T12:00:00`;r("confirm",{deliveryDate:y,location:l.value,notes:o.value})},c=()=>{r("cancel")},f=y=>{y||c()};return(y,x)=>(u(),P(n(He),{open:t.show,"onUpdate:open":f},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...x[4]||(x[4]=[_("Mark as Delivered",-1)])]),_:1}),C(n(gt),null,{default:O(()=>[...x[5]||(x[5]=[_("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",Cd,[e("div",null,[x[6]||(x[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),re(e("input",{type:"date","onUpdate:modelValue":x[0]||(x[0]=w=>a.value=w),max:d.value,class:"input"},null,8,Sd),[[ge,a.value]])]),e("div",null,[x[7]||(x[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),re(e("input",{type:"time","onUpdate:modelValue":x[1]||(x[1]=w=>i.value=w),class:"input"},null,512),[[ge,i.value]])]),e("div",null,[x[9]||(x[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),re(e("select",{"onUpdate:modelValue":x[2]||(x[2]=w=>l.value=w),class:"input"},[...x[8]||(x[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[Ge,l.value]])]),e("div",null,[x[10]||(x[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),re(e("textarea",{"onUpdate:modelValue":x[3]||(x[3]=w=>o.value=w),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ge,o.value]])])]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c}),C(n(ne),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value||!l.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ad={class:"space-y-4"},Dd={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=D(""),i=D("");we(()=>s.show,p=>{p&&(a.value="",i.value="")});const l=()=>{a.value&&r("confirm",{reason:a.value,notes:i.value})},o=()=>{r("cancel")},d=p=>{p||o()};return(p,c)=>(u(),P(n(He),{open:t.show,"onUpdate:open":d},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...c[2]||(c[2]=[_("Close as Lost",-1)])]),_:1}),C(n(gt),null,{default:O(()=>[...c[3]||(c[3]=[_("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",Ad,[e("div",null,[c[5]||(c[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),re(e("select",{"onUpdate:modelValue":c[0]||(c[0]=f=>a.value=f),class:"input"},[...c[4]||(c[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[Ge,a.value]])]),e("div",null,[c[6]||(c[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),re(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=f=>i.value=f),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ge,i.value]])])]),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:o}),C(n(ne),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!a.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Td={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=m,r=a=>{a||s("cancel")};return(a,i)=>(u(),P(n(He),{open:t.show,"onUpdate:open":r},{default:O(()=>[C(n(Re),null,{default:O(()=>[C(n(je),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Ue),null,{default:O(()=>[C(n(We),null,{default:O(()=>[...i[2]||(i[2]=[_("Requalify as Lead",-1)])]),_:1}),C(n(gt),null,{default:O(()=>[...i[3]||(i[3]=[_("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),i[4]||(i[4]=e("div",{class:"space-y-6 max-h-screen-60 overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),_(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),_(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),_(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),C(n(ze),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ne),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[0]||(i[0]=l=>a.$emit("cancel"))}),C(n(ne),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:i[1]||(i[1]=l=>a.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Id={key:0,class:"bg-green-50/50 border border-green-100 rounded-card p-4"},Od={class:"flex gap-3"},Nd={key:0,class:"space-y-3"},Md={class:"flex items-center gap-2 pb-2 border-b border"},qd={class:"font-semibold text-heading text-fluid-sm"},Ed={key:0,class:"flex justify-end"},Ld={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:m}){const s=t,r=m,a=Ct(),i=yt(),l=D(!1),o=D(!1),d=D(!1),p=D(!1),c=D(!1),f=D(!1),y=D(!1),x=D(!1),w=D(!1),$=D(!1),q=D([]),g=A(()=>{var Q,W;return((Q=s.opportunity)==null?void 0:Q.displayStage)||((W=s.opportunity)==null?void 0:W.stage)||"Qualified"});A(()=>Lt(g.value,"opportunity"));function b(Q){return Q?new Date(Q).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const h={"schedule-appointment":()=>{l.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?w.value=!0:l.value=!0},"select-vehicle":()=>{y.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?y.value=!0:o.value=!0},"call-prospect":()=>{x.value=!0},"follow-up-offer":()=>{x.value=!0},"request-decision":()=>{x.value=!0},"finalize-contract":()=>{p.value=!0},"schedule-delivery":()=>{c.value=!0},"confirm-delivery":()=>{c.value=!0},"collect-feedback":()=>{x.value=!0},reschedule:()=>{$.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&E()},"close-won":()=>{p.value=!0},"add-offer":()=>{o.value=!0},"add-contract":()=>{p.value=!0},"extend-deadline":()=>{x.value=!0},"close-lost":()=>{d.value=!0},reopen:()=>{L()},requalify:()=>{f.value=!0}},{primaryAction:S,secondaryActions:F,activeTaskWidget:H,taskWidgetTitle:ae,isClosed:de}=_r(_e(s,"opportunity"),_e(s,"scheduledAppointment"),_e(s,"activities"),h,b);function ie(Q){}function le(){}function fe(Q){y.value=!1,r("vehicle-selected",Q),setTimeout(()=>{o.value=!0},300)}function be(Q){o.value=!1,r("offer-created",Q)}function Z(Q){l.value=!1,r("appointment-scheduled",{...Q,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function E(){s.scheduledAppointment&&r("appointment-cancelled",s.scheduledAppointment.id)}function B(Q){p.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:Q.contractDate})}function te(Q){c.value=!1,i.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:Q})}function I(Q){d.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:Q})}function L(){i.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function z(Q){f.value=!1,a.push(`/customer/${Q.id}?type=lead`)}function K(Q){w.value=!1}function R(Q){$.value=!1}function J(Q){i.updateOpportunity(s.opportunity.id,{callbackDate:Q.callbackDate})}function Y(Q){i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:Q.reason||"Multiple no-shows (NS3)"})}return St(async()=>{try{const W=(await jt({})).data||[];q.value=W.filter(oe=>oe.stockDays!==null&&oe.stockDays!==void 0).slice(0,5)}catch(Q){console.error("Failed to load recommended cars:",Q),q.value=[]}}),(Q,W)=>(u(),v(ye,null,[C(_t,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":O(()=>[n(de)&&!n(H)?(u(),v("div",Id,[W[15]||(W[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed"),e("p",{class:"text-fluid-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Od,[C(n(ne),{variant:"primary",size:"small",onClick:L,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700"},{default:O(()=>[...W[13]||(W[13]=[e("span",null,"Reopen",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}),C(n(ne),{variant:"outline",size:"small",onClick:W[0]||(W[0]=oe=>f.value=!0),class:"flex items-center gap-2 bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300"},{default:O(()=>[...W[14]||(W[14]=[e("span",null,"Requalify as Lead",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])]),_:1})])])):T("",!0)]),"primary-action":O(()=>[!n(de)&&n(S)?(u(),P(Yt,{key:0,action:n(S),"color-scheme":n(S).colorScheme,onActionClicked:W[1]||(W[1]=oe=>n(S).handler())},null,8,["action","color-scheme"])):T("",!0)]),"task-widgets":O(()=>[n(H)&&n(H).component?(u(),v("div",Nd,[e("div",Md,[W[16]||(W[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",qd,N(n(ae)),1)]),(u(),P(rt(n(H).component),it(n(H).props,{onClose:le,onSetCallback:J,onAutoCloseLost:Y}),null,16))])):T("",!0)]),"secondary-actions":O(()=>[n(F).length>0?(u(),v("div",Ed,[C(Kr,{actions:n(F),onActionSelected:ie},null,8,["actions"])])):T("",!0)]),_:1},8,["task"]),l.value?(u(),P(Qs,{key:0,show:l.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:Z,onCancel:W[2]||(W[2]=oe=>l.value=!1)},null,8,["show","customer","assignee"])):T("",!0),y.value?(u(),P(hd,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":q.value,onVehicleSelected:fe,onClose:W[3]||(W[3]=oe=>y.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):T("",!0),o.value?(u(),P(Vs,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:be,onClose:W[4]||(W[4]=oe=>o.value=!1)},null,8,["opportunity","vehicle"])):T("",!0),p.value?(u(),P(kd,{key:3,opportunity:t.opportunity,onContractSet:B,onClose:W[5]||(W[5]=oe=>p.value=!1)},null,8,["opportunity"])):T("",!0),c.value?(u(),P($d,{key:4,opportunity:t.opportunity,onDelivered:te,onClose:W[6]||(W[6]=oe=>c.value=!1)},null,8,["opportunity"])):T("",!0),d.value?(u(),P(Dd,{key:5,opportunity:t.opportunity,onClosed:I,onClose:W[7]||(W[7]=oe=>d.value=!1)},null,8,["opportunity"])):T("",!0),f.value?(u(),P(Td,{key:6,opportunity:t.opportunity,onRequalified:z,onClose:W[8]||(W[8]=oe=>f.value=!1)},null,8,["opportunity"])):T("",!0),x.value?(u(),P(Us,{key:7,onClose:W[9]||(W[9]=oe=>x.value=!1)})):T("",!0),w.value&&t.scheduledAppointment?(u(),P(_s,{key:8,show:w.value,event:t.scheduledAppointment,onClose:W[10]||(W[10]=oe=>w.value=!1),onEdit:W[11]||(W[11]=oe=>{w.value=!1,$.value=!0}),onDelete:K},null,8,["show","event"])):T("",!0),$.value&&t.scheduledAppointment?(u(),P(Ys,{key:9,show:$.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:R,onCancel:W[12]||(W[12]=oe=>$.value=!1)},null,8,["show","event","customer"])):T("",!0)],64))}};function Et(t){const m=Je(),s=yt(),r=A(()=>t.value?t.value.type==="lead"?qr:Ld:null),a=A(()=>t.value?t.value.type==="lead"?{currentActivities:A(()=>m.currentLeadActivities),addActivity:(l,o)=>m.addActivity(l,o),updateActivity:(l,o,d)=>m.updateActivity(l,o,d),deleteActivity:(l,o)=>m.deleteActivity(l,o),updateLead:(l,o)=>m.updateLead(l,o),loadLeadById:l=>m.fetchLeadById(l)}:{currentActivities:A(()=>s.currentOpportunityActivities),addActivity:(l,o)=>s.addActivity(l,o),updateActivity:(l,o,d)=>s.updateActivity(l,o,d),deleteActivity:(l,o)=>s.deleteActivity(l,o),addVehicle:(l,o)=>s.addVehicle(l,o),createOffer:(l,o)=>s.createOffer(l,o),updateOpportunity:(l,o)=>s.updateOpportunity(l,o),loadOpportunityById:l=>s.fetchOpportunityById(l)}:null),i=A(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:r,storeAdapter:a,addNewConfig:i}}function Bd(){const t=c=>{if(!c)return"No deadline";const f=$t(c);return f.type==="overdue"?"OVERDUE":f.type==="today"||f.type==="urgent"?f.relativeTime:Bt(c)},m=c=>{const f=c.type==="lead"?c.requestedCar:c.vehicle;return!f||!f.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[f.type]||{type:f.type.toLowerCase(),label:f.type}},s=c=>c?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[c.type]||"bg-gray-50 text-gray-700":"",r=c=>{if(!c||!c.assignee)return{name:"Unassigned",initials:"?"};const f=c.assigneeInitials||c.assignee.split(" ").map(y=>y[0]).join("");return{name:c.assignee,initials:f}},a=c=>{if(!c||!c.customer||!c.customer.address)return null;const y=c.customer.address.split(",");return y.length>1&&y[y.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:m,getVehicleTypeBadgeClass:s,getOwnerInfo:r,getCustomerCity:a,getLocationDisplay:c=>{const f=a(c),y=c.source||"Unknown";return f?`${f} â€¢ ${y}`:y},getAssigneeInitials:c=>{if(!c)return"?";const f=c.split(" ");return f.length>=2?(f[0][0]+f[f.length-1][0]).toUpperCase():c.substring(0,2).toUpperCase()},getVehicleStatusDisplay:c=>{const f=c.type==="lead"?c.requestedCar:c.vehicle;if(!f)return"No vehicle";const y=m(c),x=y?y.label:f.type||"Unknown";let w="";return f.kilometers!==void 0&&f.kilometers!==null&&(f.kilometers>=1e3?w=`${(f.kilometers/1e3).toFixed(0)}k`:w=`${f.kilometers}`),w?`${x} / ${w}`:x},getTaskStatusDisplay:c=>c.type==="lead"?c.status||"Unknown":c.stage||"Unknown",getStageBadgeClass:Ft,getUnselectedClass:c=>c.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Fd(t){const m=Je(),s=yt(),r=Fe(),a=A(()=>{const d=(t.value?m.leads:m.leads.filter(f=>!f.isDisqualified)).map(f=>{const y=xt(f,"lead"),x={...f,type:"lead",compositeId:`lead-${f.id}`,displayStage:y};return!x.customer&&f.customer&&(x.customer=f.customer),x}),p=s.opportunities.map(f=>{const y={...f,type:"opportunity",compositeId:`opportunity-${f.id}`};return!y.customer&&f.customer&&(y.customer=f.customer),y});let c=[];return r.isOperator()?c=d:r.isSalesman()?c=p:c=[...d,...p],c}),i=(o,d)=>d==="all"?o:o.filter(p=>p.type===d),l=A(()=>{const o=a.value.some(p=>p.type==="lead"),d=a.value.some(p=>p.type==="opportunity");return o&&d});return{allTasks:a,filterByType:i,shouldShowTypeFilter:l}}function Rd(){const t=Fe(),m=dt(),s=Le();return{sortTasks:(a,i)=>{if(i==="none")return[...a].sort((l,o)=>{const d=new Date(l.lastActivity||l.createdAt||0);return new Date(o.lastActivity||o.createdAt||0)-d});if(i==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...a.map(d=>{if(d.type==="lead"&&!d.urgencyScore){const p=zt(d);return{...d,urgencyScore:p.score,urgencyLevel:p.level}}return d})].sort((d,p)=>{if(d.type==="lead"&&p.type==="lead"){const y=d.urgencyScore||0,x=p.urgencyScore||0;if(y!==x)return x-y;const w=new Date(d.createdAt||0);return new Date(p.createdAt||0)-w}if(d.type==="lead"&&p.type==="opportunity")return-1;if(d.type==="opportunity"&&p.type==="lead")return 1;if(d.priority==="Hot"&&p.priority!=="Hot")return-1;if(d.priority!=="Hot"&&p.priority==="Hot")return 1;const c=new Date(d.lastActivity||d.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-c}):[...a].sort((o,d)=>{if(o.priority==="Hot"&&d.priority!=="Hot")return-1;if(o.priority!=="Hot"&&d.priority==="Hot")return 1;const p=new Date(o.lastActivity||o.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-p});if(i==="assigned-to-me"){const l=t.currentUser.name;return[...a.filter(d=>d.assignee===l)].sort((d,p)=>{const c=new Date(d.lastActivity||d.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-c})}if(i==="assigned-to-my-team"){const l=t.currentUser;let o=[];return l.role==="manager"?o=m.users.map(p=>p.name):l.role==="salesman"?o=m.users.filter(p=>p.role==="salesman").map(p=>p.name):l.role==="operator"&&(o=m.users.filter(p=>p.role==="operator").map(p=>p.name)),[...a.filter(p=>o.includes(p.assignee))].sort((p,c)=>{const f=new Date(p.lastActivity||p.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-f})}return a}}}const jd={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Vd={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Ud={key:0,class:"flex items-center gap-2"},Wd={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},zd={class:"text-gray-600 font-medium"},Hd={key:1},Pd={key:0},Qd={key:1},_d={key:2},Yd={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Jd={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Gd={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},Kd={__name:"Tasks",setup(t){const m=vs(),s=Ct(),r=Je(),a=yt(),i=Fe();dt();const l=Le(),{getDateDisplay:o,getVehicleType:d,getVehicleTypeBadgeClass:p,getOwnerInfo:c,getCustomerCity:f,getAssigneeInitials:y,getUnselectedClass:x}=Bd(),w=D(localStorage.getItem("tasksViewMode")||"table"),$=D(""),q=A(()=>m.query.highlight||null);we(w,M=>{localStorage.setItem("tasksViewMode",M)});const g=(M,j="")=>{w.value;const ee=B.value;if(w.value=M,M==="card"&&j&&($.value=j),M==="table"&&ee)$.value="",s.push({path:"/tasks",query:{highlight:ee.compositeId}});else if(M==="card"&&q.value){const[ce,V]=q.value.split("-");s.push({path:`/tasks/${V}`,query:{type:ce}})}else M==="card"&&!q.value&&!B.value&&s.push({path:"/tasks"})},b=D("all"),h=D("none"),S=D(!1),F=D(null);D(!1);const H=D(!1),ae=D(null),de=D(!1),ie=D(null),{allTasks:le,filterByType:fe,shouldShowTypeFilter:be}=Fd(S),{sortTasks:Z}=Rd(),E=A(()=>{let M=fe(le.value,b.value);return M=Z(M,h.value),M}),B=A(()=>{if(!m.params.id)return null;const M=parseInt(m.params.id);if(isNaN(M))return null;const j=m.query.type;if(j){const me=`${j}-${M}`;return le.value.find(Ae=>Ae.compositeId===me)||null}const ee=b.value!=="all"?le.value.filter(me=>me.type===b.value):le.value,ce=`lead-${M}`,V=`opportunity-${M}`,se=ee.find(me=>me.compositeId===ce||me.compositeId===V);return se||le.value.find(me=>me.compositeId===ce||me.compositeId===V)||null});A(()=>B.value?B.value.type==="lead"?r.currentLeadActivities:a.currentOpportunityActivities:[]);const te=Et(B),I=te.managementWidget,L=te.storeAdapter,z=te.addNewConfig,K=A(()=>ie.value),R=Et(K),J=A(()=>R.managementWidget.value),Y=A(()=>R.storeAdapter.value),Q=A(()=>R.addNewConfig.value),W=x;St(()=>{r.fetchLeads(),a.fetchOpportunities();const M=m.params.id;M&&oe(M)}),we(()=>m.params.id,M=>{M&&oe(M)}),we(B,M=>{M&&(M.type==="lead"?r.fetchLeadById(M.id):a.fetchOpportunityById(M.id))},{immediate:!0}),we(ie,M=>{M&&(M.type==="lead"?r.fetchLeadById(M.id):a.fetchOpportunityById(M.id))},{immediate:!0});const oe=M=>{const j=parseInt(M),ee=le.value.find(ce=>ce.id===j);ee&&(ee.type==="lead"?r.fetchLeadById(j):a.fetchOpportunityById(j))},ue=M=>{const[j,ee]=M.split("-");if(w.value==="table"){const ce=le.value.find(V=>V.compositeId===M);ce&&(ie.value=ce,de.value=!0,ce.type==="lead"?r.fetchLeadById(ce.id):a.fetchOpportunityById(ce.id));return}w.value="card",s.push({path:`/tasks/${ee}`,query:{type:j}})},he=()=>{if(de.value){Ce();return}s.push({path:"/tasks"})},Ce=()=>{de.value=!1,ie.value=null},Se=M=>{if(!B.value)return;const j=E.value.findIndex(ee=>{const ce=B.value.compositeId||`${B.value.type}-${B.value.id}`;return(ee.compositeId||`${ee.type}-${ee.id}`)===ce});if(j!==-1){if(M==="previous"&&j>0){const ee=E.value[j-1];ue(ee.compositeId)}else if(M==="next"&&j<E.value.length-1){const ee=E.value[j+1];ue(ee.compositeId)}}},qe=M=>{if(!ie.value)return;const j=E.value.findIndex(ee=>{const ce=ie.value.compositeId||`${ie.value.type}-${ie.value.id}`;return(ee.compositeId||`${ee.type}-${ee.id}`)===ce});if(j!==-1){if(M==="previous"&&j>0){const ee=E.value[j-1];ue(ee.compositeId)}else if(M==="next"&&j<E.value.length-1){const ee=E.value[j+1];ue(ee.compositeId)}}},Ke=M=>{F.value=F.value===M?null:M},ut=M=>{ae.value=M,H.value=!0,F.value=null},Te=M=>{h.value=M},Ze=async M=>{if(!ae.value)return;const j=ae.value,ee=M.name;j.type==="lead"?await r.updateLead(j.id,{assignee:ee,assigneeType:M.type,teamId:M.type==="team"?M.id:null}):j.type==="opportunity"&&await a.updateOpportunity(j.id,{assignee:ee,assigneeType:M.type,teamId:M.type==="team"?M.id:null}),H.value=!1,ae.value=null},Xe=async M=>{F.value=null,M.type==="lead"?await r.updateLead(M.id,{priority:"Hot"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{priority:"Hot"})},Ie=async M=>{F.value=null,M.type==="lead"?await r.updateLead(M.id,{priority:"Normal"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{priority:"Normal"})},Pe=async M=>{F.value=null;const j=i.user;j&&(M.type==="lead"?await r.updateLead(M.id,{assignee:j.name,assigneeType:"user"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{assignee:j.name,assigneeType:"user"}))},$e=async M=>{if(F.value=null,M.type==="lead")try{const j=M.displayStage||M.stage||Qe.NEW,ee=Qe.NEW,ce=bt(j,ee);if(ce){const{updates:V,activities:se}=ce(M);await r.updateLead(M.id,V);for(const me of se)await r.addActivity(M.id,me)}else await r.updateLead(M.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await r.addActivity(M.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await r.fetchLeadById(M.id)}catch(j){console.error("Failed to reopen lead:",j)}},ct=M=>{var ee;const j=[];return M.type==="lead"&&M.isDisqualified===!0&&j.push({key:"reopen",label:"Reopen Lead",onClick:()=>$e(M)}),j.push({key:"reassign",label:"Reassign",onClick:()=>ut(M)}),M.assignee!==((ee=i.user)==null?void 0:ee.name)&&j.push({key:"assign-me",label:"Assign to me",onClick:()=>Pe(M)}),M.priority!=="Hot"?j.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Xe(M)}):j.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Ie(M)}),j};return(M,j)=>{var ee,ce;return u(),v("div",jd,[C(zl,{show:!!B.value||w.value==="table"&&!!ie.value,"back-label":"Back to task list",onBack:he},null,8,["show"]),w.value==="card"?(u(),v("div",Vd,[e("div",{class:U(["flex flex-col overflow-hidden",B.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[C(Ln,{title:"Tasks",items:E.value,"selected-id":(ee=B.value)==null?void 0:ee.compositeId,"type-filter":b.value,"view-mode":w.value,"initial-search-query":$.value,onViewChange:g,"selected-class":V=>V.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":n(W),"open-menu-id":F.value,getName:V=>{const se=V.customer;return se&&se.name?se.name:se&&!se.name&&se.email&&se.email.split("@")[0]||"Unknown"},getInitials:V=>{const se=V.customer;return se&&se.initials?se.initials:se&&se.name&&se.name.split(" ").map(Ae=>Ae[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:V=>{if(V.type==="lead"){if(!V.requestedCar)return"No vehicle specified";const Ae=V.requestedCar,et=[`${Ae.brand} ${Ae.model}`];return Ae.kilometers!==void 0&&Ae.kilometers!==null&&et.push(`${Ae.kilometers} km`),Ae.status&&et.push(Ae.status),et.join(" â€¢ ")}const se=V.vehicle||V.requestedCar;if(!se)return"No vehicle specified";const me=[`${se.brand} ${se.model}`];return se.kilometers!==void 0&&se.kilometers!==null&&me.push(`${se.kilometers} km`),se.status&&me.push(se.status),me.join(" â€¢ ")},avatarClass:V=>V.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":ct,"show-mobile-close":!1,onSelect:ue,onMenuClick:Ke,onMenuClose:j[0]||(j[0]=V=>F.value=null),onClose:he,"show-type-filter":n(be),onFilterChange:j[1]||(j[1]=V=>b.value=V),onSortChange:Te},{badges:O(({item:V})=>[V&&V.type?(u(),P(n(mt),{key:0,text:V.type==="lead"?"Lead":"Opportunity",size:"small",theme:V.type==="lead"?"blue":"gray"},null,8,["text","theme"])):T("",!0),V&&V.type==="lead"&&n(l).getSetting("urgencyEnabled")!==!1&&V.urgencyLevel?(u(),P(n(mt),{key:1,text:`${n(Ht)(V.urgencyLevel)} ${V.urgencyLevel}`,size:"small",class:U(n(Pt)(V.urgencyLevel))},null,8,["text","class"])):T("",!0),V&&V.priority==="Hot"&&(n(l).getSetting("urgencyEnabled")===!1||V.type!=="lead")?(u(),P(n(mt),{key:2,text:"HOT",size:"small",theme:"red"})):T("",!0)]),location:O(({item:V})=>[_(N(n(f)(V)||"Unknown"),1)]),source:O(({item:V})=>{var se;return[_(N(V.source||((se=V.customer)==null?void 0:se.source)||"Unknown"),1)]}),owner:O(({item:V})=>[V.assignee?(u(),v("div",Ud,[e("div",Wd,N(n(y)(V.assignee)),1),e("span",zd,N(V.assignee),1)])):(u(),v("span",Hd,"Unassigned"))]),dates:O(({item:V})=>[V.type==="lead"&&V.nextActionDue?(u(),v("span",Pd,"Due: "+N(n(o)(V.nextActionDue)),1)):V.type==="opportunity"&&V.nextActionDue?(u(),v("span",Qd,"Due: "+N(n(o)(V.nextActionDue)),1)):(u(),v("span",_d,"Due: No deadline"))]),_:1},8,["items","selected-id","type-filter","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),B.value?(u(),P(Mt,{key:0,task:B.value,"management-widget":n(I),"store-adapter":n(L),"add-new-config":n(z),"filtered-tasks":E.value,onTaskNavigate:Se},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):T("",!0),B.value?T("",!0):(u(),v("div",Yd,[...j[6]||(j[6]=[lt('<div class="flex-1 flex items-center justify-center p-8" data-v-f89586dd><div class="text-center max-w-sm" data-v-f89586dd><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-f89586dd><i class="fa-solid fa-tasks text-2xl text-sub" data-v-f89586dd></i></div><h3 class="text-content-bold mb-2" data-v-f89586dd>No task selected</h3><p class="text-meta" data-v-f89586dd>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):T("",!0),w.value==="table"?(u(),v("div",Jd,[C(Gn,{tasks:E.value,"current-task-id":(ce=ie.value)==null?void 0:ce.compositeId,"highlight-id":q.value,"type-filter":b.value,"sort-option":h.value,"show-type-filter":n(be),"show-closed":S.value,"show-mobile-close":!1,"open-menu-id":F.value,"get-vehicle-type":n(d),"get-vehicle-type-badge-class":n(p),"get-owner-info":n(c),"get-stage-badge-class":n(Ft),"view-mode":w.value,onSelect:ue,onMenuClick:Ke,onMenuClose:j[2]||(j[2]=V=>F.value=null),onFilterChange:j[3]||(j[3]=V=>b.value=V),onSortChange:Te,onToggleClosed:j[4]||(j[4]=V=>S.value=V),onReassign:ut,onClose:he,onViewChange:g,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):T("",!0),C(ft,{name:"fade"},{default:O(()=>[de.value&&w.value==="table"?(u(),v("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:Ce})):T("",!0)]),_:1}),C(ft,{name:"slide-right"},{default:O(()=>[de.value&&w.value==="table"?(u(),v("div",Gd,[e("div",{class:"sticky top-0 bg-white border-b border-E5E7EB p-4 flex items-center justify-between z-10"},[j[8]||(j[8]=e("h3",{class:"text-h3-card text-heading font-semibold"},"Task Details",-1)),e("button",{onClick:Ce,class:"w-8 h-8 flex items-center justify-center text-sub hover:text-body hover:bg-surfaceSecondary rounded transition-colors","aria-label":"Close task details"},[...j[7]||(j[7]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])]),ie.value&&J.value&&Y.value?(u(),P(Mt,{key:0,task:ie.value,"management-widget":J.value,"store-adapter":Y.value,"add-new-config":Q.value,"filtered-tasks":E.value,onTaskNavigate:qe},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):T("",!0)])):T("",!0)]),_:1}),C(Rt,{show:H.value,onClose:j[5]||(j[5]=V=>H.value=!1),onConfirm:Ze},null,8,["show"])])}}},du=De(Kd,[["__scopeId","data-v-f89586dd"]]);export{du as default};
