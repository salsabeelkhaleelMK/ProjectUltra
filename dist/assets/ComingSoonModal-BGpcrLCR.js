import{r as T,U as Ue,c as C,G as pe,d,o,e as t,g as b,s as x,y,a4 as qe,I as fe,t as v,w as K,p as D,P as ye,n as F,F as E,i as H,a5 as Be,H as je,x as q,z as Ce,k as U,v as ge,J as N,m as J,E as S,Q as W,l as Q,a6 as Me,$ as Ee,h as We,X as Le,Z as ze}from"./index-DqXOZZRa.js";import{_ as Pe}from"./ReassignUserModal-Da6cQ3cL.js";import{_ as Re}from"./CreateEventModal-CxP5T0Mk.js";import{z as G,F as X,L as Z,H as _,j as ee,K as ve,C as te,W as ae}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CzLkKHlp.js";import{u as z}from"./settings-B0uvb4uj.js";const He={class:"w-full bg-white"},Ke={class:"flex items-center justify-between gap-3 md:gap-4"},Ye={class:"flex items-center gap-3 md:gap-4 flex-1"},Qe={class:"min-w-0 flex-1"},Je={class:"flex items-center gap-2"},Ge={class:"heading-main truncate"},Xe={class:"flex flex-wrap items-center gap-2 mt-1"},Ze={class:"flex items-center gap-1 ml-2"},_e={class:"relative"},et={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-50 overflow-hidden flex flex-col p-1"},tt={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},at={class:"flex items-center gap-4"},st={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},nt={class:"flex items-center gap-2"},lt={class:"text-xs text-gray-900 font-medium"},it={class:"flex items-center gap-2"},ot={class:"text-xs text-gray-900 font-medium"},rt={class:"flex items-center gap-2"},dt={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},ut={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-xs"},ct={key:1,class:"fa-regular fa-calendar text-gray-500 text-xs"},mt={class:"text-xs text-gray-900 font-medium"},ft={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action","add-tag"],setup(e,{emit:m}){const l=e,i=m,c=T(!1),s=T(!1),p=Ue(),g=C(()=>{const f=l.name||"";return f.trim().split(/\s+/).filter(Boolean)[0]||f||"Customer"}),a=C(()=>{const u=(l.name||"").trim().split(/\s+/).filter(Boolean);return u.length>=2?u[u.length-1]:"Customer"}),n=C(()=>{const f=(l.avatarColorClass||"").toLowerCase();return f.includes("purple")?"purple":f.includes("blue")?"blue":f.includes("green")?"green":f.includes("red")?"red":f.includes("pink")?"pink":"yellow"}),r=C(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...l.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(u=>({...u,onClick:()=>k(u.key)}))),k=f=>{s.value=!1,i("action",f)},B=async(f,u)=>{try{await navigator.clipboard.writeText(f),p.pushToast("success",`${u==="email"?"Email":"Phone"} copied!`)}catch{p.pushToast("error","Failed to copy")}},O=()=>{i("add-tag")};return(f,u)=>{const I=pe("click-outside");return o(),d("div",He,[t("div",Ke,[t("div",Ye,[x(y(qe),{class:"w-14 h-14 rounded",name:g.value,surname:a.value,color:n.value},null,8,["name","surname","color"]),t("div",Qe,[t("div",Je,[t("h1",Ge,v(e.name),1),fe(f.$slots,"name-action")]),t("div",Xe,[fe(f.$slots,"tags"),t("button",{onClick:K(O,["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 font-medium hover:underline flex items-center gap-1"},[...u[4]||(u[4]=[t("i",{class:"fa-solid fa-plus text-xs"},null,-1),t("span",null,"add tag",-1)])])])])]),t("div",Ze,[t("div",_e,[t("button",{onClick:u[0]||(u[0]=K(A=>s.value=!s.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors","aria-label":"Quick actions"},[...u[5]||(u[5]=[t("i",{class:"fa-solid fa-plus text-base"},null,-1)])]),s.value?D((o(),d("div",et,[x(y(ye),{items:r.value,className:"w-full"},null,8,["items"])])),[[I,()=>s.value=!1]]):b("",!0)]),t("button",{onClick:u[1]||(u[1]=A=>c.value=!c.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[t("i",{class:F(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":c.value}])},null,2)])])]),c.value?(o(),d("div",tt,[t("div",at,[t("div",st,[t("div",nt,[u[7]||(u[7]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-regular fa-envelope text-gray-500 text-xs"})],-1)),t("span",lt,v(e.email),1),t("button",{onClick:u[2]||(u[2]=K(A=>B(e.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...u[6]||(u[6]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",it,[u[9]||(u[9]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-phone text-gray-500 text-xs"})],-1)),t("span",ot,v(e.phone),1),t("button",{onClick:u[3]||(u[3]=K(A=>B(e.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...u[8]||(u[8]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",rt,[t("div",dt,[e.thirdFieldLabel.toLowerCase().includes("address")?(o(),d("i",ut)):(o(),d("i",ct))]),t("span",mt,v(e.thirdFieldValue),1)])])])])):b("",!0)])}}},pt={class:"flex gap-0 md:gap-8 text-base font-medium text-gray-500 py-1"},yt=["onClick"],gt={class:"hidden md:inline whitespace-nowrap"},vt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(e){const m={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},l=i=>m[i]||"fa-solid fa-circle";return(i,c)=>(o(),d("div",pt,[(o(!0),d(E,null,H(e.tabs,s=>(o(),d("div",{key:s.key,onClick:p=>i.$emit("update:modelValue",s.key),class:F(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",e.modelValue===s.key?"border-blue-600 text-blue-600":"border-transparent hover:text-gray-700 hover:border-slate-200"])},[t("i",{class:F([l(s.key),"text-base md:text-base"])},null,2),t("span",gt,v(s.label),1),s.count!==void 0?(o(),d("span",{key:0,class:F(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",e.modelValue===s.key?"bg-blue-50 text-blue-700":"bg-gray-100 text-gray-500"])},v(s.count),3)):b("",!0)],10,yt))),128))]))}},bt={class:"metadata-bar w-full"},xt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ht={class:"flex items-center gap-1.5"},kt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},wt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},Ct={class:"text-xs font-bold text-gray-900"},St={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"}},emits:["reassign"],setup(e){const m=e;C(()=>m.deliverySubstatus?Be(m.deliverySubstatus):"");const l=C(()=>m.deliverySubstatus?m.deliverySubstatus==="Delivered"?"green":m.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),i=C(()=>je(m.stage,m.entityType));function c(g){return!g||g.length===0?null:g.filter(n=>n.type==="offer").sort((n,r)=>new Date(r.timestamp)-new Date(n.timestamp))[0]||null}function s(g){if(!g)return 0;const a=new Date(g),r=Math.abs(new Date-a);return Math.ceil(r/(1e3*60*60*24))}const p=C(()=>{if(m.stage!=="In Negotiation")return null;const g=c(m.activities);if(!g)return null;const a=s(g.timestamp);return a<1?{label:"New Offer",theme:"orange"}:a<3?{label:"Active",theme:"yellow"}:null});return(g,a)=>(o(),d("div",bt,[t("div",xt,[a[1]||(a[1]=t("span",{class:"label-upper"},"Stage",-1)),t("div",ht,[t("span",{class:F(["text-xs px-1.5 py-0.5 rounded font-semibold border",i.value])},v(e.stage),3),e.deliverySubstatus?(o(),q(y(Ce),{key:0,text:e.deliverySubstatus,size:"small",theme:l.value},null,8,["text","theme"])):b("",!0),p.value?(o(),q(y(Ce),{key:1,text:p.value.label,size:"small",theme:p.value.theme},null,8,["text","theme"])):b("",!0)])]),a[5]||(a[5]=t("div",{class:"metadata-divider"},null,-1)),t("div",kt,[a[2]||(a[2]=t("span",{class:"label-upper"},"Owner",-1)),t("button",{onClick:a[0]||(a[0]=n=>g.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},v(e.owner),1)]),e.source?(o(),d(E,{key:0},[a[4]||(a[4]=t("div",{class:"metadata-divider"},null,-1)),t("div",wt,[a[3]||(a[3]=t("span",{class:"label-upper"},"Source",-1)),t("span",Ct,v(e.source),1)])],64)):b("",!0)]))}},$t={key:0,class:"flex-grow border-t border-gray-200"},At={key:0,class:"ml-1.5"},Dt={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Tt={key:1,class:"flex-grow border-t border-gray-200"},Ot={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(e,{emit:m}){const l=e,i=m,c=T(!1),s={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},p=C(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(u=>!s[u]);const f=Object.entries(s).filter(([,u])=>u===l.activeTab).map(([u])=>u);return l.actions.filter(u=>f.includes(u))}),g=C(()=>l.activeTab==="communication"?!1:p.value.length===1),a=C(()=>{if(!g.value||p.value.length!==1)return"";const f=p.value[0];return{note:"add note",attachment:"add attachment"}[f]||""}),n=C(()=>l.activeTab==="communication"?!0:p.value.length>1),r=C(()=>{const f={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return p.value.map(u=>({key:u,label:f[u]||u,onClick:()=>B(u)}))}),k=C(()=>{if(l.inline)return"bg-blue-600 hover:bg-blue-700 text-white font-medium w-9 h-9 rounded-lg shadow-sm transition-all flex items-center justify-center z-20 relative";const f="bg-gray-50 hover:bg-white border border-gray-200 text-gray-700 font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative";return g.value?`${f} px-4 h-9`:`${f} w-9 h-9`});C(()=>p.value.some(f=>["email","whatsapp","sms"].includes(f))),C(()=>p.value.some(f=>["addVehicle","configureVehicle"].includes(f))),C(()=>p.value.some(f=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(f)));const B=f=>{c.value=!1,i("action",f)},O=()=>{g.value&&p.value.length===1?B(p.value[0]):c.value=!c.value};return(f,u)=>{const I=pe("click-outside");return e.show?(o(),d("div",{key:0,class:F(["relative flex items-center",e.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[e.inline?b("",!0):(o(),d("div",$t)),t("div",{class:F(["relative",e.inline?"mx-0":"mx-4"])},[t("button",{onClick:K(O,["stop"]),class:F(k.value)},[u[0]||(u[0]=t("i",{class:"fa-solid fa-plus text-xs"},null,-1)),g.value?(o(),d("span",At,v(a.value),1)):b("",!0)],2),c.value&&n.value?D((o(),d("div",Dt,[x(y(ye),{items:r.value,className:"w-full"},null,8,["items"])])),[[I,()=>c.value=!1]]):b("",!0)],2),e.inline?b("",!0):(o(),d("div",Tt))],2)):b("",!0)}}},It={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Nt={class:"flex items-start gap-3"},Vt={class:"flex-1 min-w-0"},Ft={class:"font-bold text-sm text-gray-900 mb-2"},Ut={class:"space-y-1.5 text-xs text-gray-600"},qt={class:"flex items-center gap-2"},Bt={class:"flex items-center gap-2"},jt={class:"flex items-center gap-2"},Mt={key:0,class:"mt-2"},Et={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(e){const m=e,l=C(()=>m.appointmentData.date?new Date(m.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),i=C(()=>m.appointmentData.time?m.appointmentData.time:""),c=s=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[s==null?void 0:s.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(s,p)=>(o(),d("div",It,[t("div",Nt,[p[3]||(p[3]=t("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-calendar text-sm"})],-1)),t("div",Vt,[t("h4",Ft,v(e.appointmentData.type),1),t("div",Ut,[t("div",qt,[p[0]||(p[0]=t("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),t("span",null,v(l.value),1)]),t("div",Bt,[p[1]||(p[1]=t("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),t("span",null,v(i.value),1)]),t("div",jt,[p[2]||(p[2]=t("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),t("span",null,v(e.appointmentData.assignee),1)])]),e.appointmentData.status?(o(),d("div",Mt,[t("span",{class:F(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",c(e.appointmentData.status)])},v(e.appointmentData.status),3)])):b("",!0)])])]))}},Wt={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Lt={class:"flex-1"},zt={class:"flex items-center gap-2 mb-1"},Pt={class:"text-xs font-bold text-gray-900"},Rt={class:"text-xs text-gray-400"},Ht={class:"text-xs text-gray-400"},Kt={key:0,class:"bg-blue-50 text-blue-600 text-xs px-1 py-0.5 rounded border border-blue-100"},Yt={class:"ml-auto relative"},Qt={key:0,class:"absolute right-0 top-full mt-1 z-10"},Jt={key:0,class:"text-sm text-gray-700"},Gt={key:1,class:"text-sm text-gray-700 flex items-center gap-2"},Xt={key:2,class:"mt-2"},Zt={key:0},_t={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},ea={key:0},ta={class:"text-sm font-bold text-gray-900"},aa={key:0,class:"text-xs text-gray-600 mt-0.5"},sa={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},na={key:0},la={key:1},ia={key:2},oa={key:3},ra={key:4},da={key:1},ua={class:"text-sm font-bold text-gray-900 mb-2"},ca={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},ma={key:0},fa={class:"text-gray-700 font-medium ml-1"},pa={key:1},ya={class:"text-gray-700 font-medium ml-1"},ga={key:2},va={class:"text-gray-700 font-medium ml-1"},ba={key:3},xa={class:"text-gray-700 font-medium ml-1"},ha={key:4},ka={class:"text-gray-700 font-medium ml-1"},wa={key:5},Ca={class:"text-gray-700 font-medium ml-1"},Sa={key:2,class:"flex items-center gap-3"},$a={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Aa=["src"],Da={class:"flex-1"},Ta={class:"text-sm font-bold text-gray-900"},Oa={class:"text-xs text-gray-500"},Ia={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Na={key:3,class:"flex items-center gap-3"},Va={class:"flex-1"},Fa={class:"text-sm font-bold text-gray-900"},Ua={class:"text-xs text-gray-500"},qa={key:0,class:"text-xs text-gray-400 mt-1"},Ba={key:1,class:"text-xs text-gray-600 mt-1"},Se={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(e,{emit:m}){const l=e,i=m,c=T(!1),s=C(()=>[{key:"edit",label:"Edit",onClick:k},{key:"delete",label:"Delete",onClick:B}]),p=O=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[O]||"fa-solid fa-circle",g=O=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[O]||"bg-gray-100 text-gray-600 border-gray-200",a=O=>{if(!O)return"Just now";const f=new Date(O),I=new Date-f,A=Math.floor(I/6e4),V=Math.floor(A/60),L=Math.floor(V/24);return A<1?"Just now":A<60?`${A} minutes ago`:V<24?`${V} hours ago`:L===1?"Yesterday":L<7?`${L} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},n=O=>O?new Intl.NumberFormat("en-US").format(O):"0",r=O=>O?new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",k=()=>{c.value=!1,i("edit",l.item)},B=()=>{c.value=!1,confirm("Are you sure you want to delete this item?")&&i("delete",l.item)};return(O,f)=>{const u=pe("click-outside");return o(),d("div",Wt,[t("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",g(e.item.type)])},[t("i",{class:F([p(e.item.type),"text-sm"])},null,2)],2),t("div",Lt,[t("div",zt,[t("span",Pt,v(e.customerInitials),1),t("span",Rt,v(e.item.action||"added"),1),t("span",Ht,"• "+v(a(e.item.timestamp)),1),e.item.autoDetected?(o(),d("span",Kt,"Auto-detected")):b("",!0),t("div",Yt,[t("button",{onClick:f[0]||(f[0]=K(I=>c.value=!c.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...f[1]||(f[1]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),c.value?D((o(),d("div",Qt,[x(y(ye),{items:s.value,className:"w-32"},null,8,["items"])])),[[u,()=>c.value=!1]]):b("",!0)])]),e.item.content?(o(),d("div",Jt,v(e.item.content),1)):b("",!0),e.item.fileName?(o(),d("div",Gt,[f[2]||(f[2]=t("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),t("span",null,v(e.item.fileName),1)])):b("",!0),e.item.data?(o(),d("div",Xt,[e.item.type==="appointment"?(o(),d("div",Zt,[x(Et,{"appointment-data":e.item.data},null,8,["appointment-data"])])):(o(),d("div",_t,[e.item.type==="tradein"?(o(),d("div",ea,[t("h4",ta,v(e.item.data.brand)+" "+v(e.item.data.model),1),e.item.data.version?(o(),d("p",aa,v(e.item.data.version),1)):b("",!0),t("div",sa,[e.item.data.year?(o(),d("div",na,[f[3]||(f[3]=t("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),U(v(e.item.data.year),1)])):b("",!0),e.item.data.km?(o(),d("div",la,[f[4]||(f[4]=t("i",{class:"fa-solid fa-road mr-1"},null,-1)),U(v(e.item.data.km)+" km ",1)])):b("",!0),e.item.data.plate?(o(),d("div",ia,[f[5]||(f[5]=t("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),U(v(e.item.data.plate),1)])):b("",!0),e.item.data.date?(o(),d("div",oa,[f[6]||(f[6]=t("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),U(v(r(e.item.data.date)),1)])):b("",!0),e.item.data.class?(o(),d("div",ra,[f[7]||(f[7]=t("i",{class:"fa-solid fa-car mr-1"},null,-1)),U(v(e.item.data.class),1)])):b("",!0)])])):e.item.type==="financing"?(o(),d("div",da,[t("h4",ua,v(e.item.data.product),1),t("div",ca,[e.item.data.provider?(o(),d("div",ma,[f[8]||(f[8]=t("span",{class:"text-gray-500"},"Provider:",-1)),t("span",fa,v(e.item.data.provider),1)])):b("",!0),e.item.data.total?(o(),d("div",pa,[f[9]||(f[9]=t("span",{class:"text-gray-500"},"Total:",-1)),t("span",ya,"€"+v(n(e.item.data.total)),1)])):b("",!0),e.item.data.monthly?(o(),d("div",ga,[f[10]||(f[10]=t("span",{class:"text-gray-500"},"Monthly:",-1)),t("span",va,"€"+v(n(e.item.data.monthly)),1)])):b("",!0),e.item.data.deposit?(o(),d("div",ba,[f[11]||(f[11]=t("span",{class:"text-gray-500"},"Deposit:",-1)),t("span",xa,"€"+v(n(e.item.data.deposit)),1)])):b("",!0),e.item.data.startDate?(o(),d("div",ha,[f[12]||(f[12]=t("span",{class:"text-gray-500"},"Start:",-1)),t("span",ka,v(r(e.item.data.startDate)),1)])):b("",!0),e.item.data.expDate?(o(),d("div",wa,[f[13]||(f[13]=t("span",{class:"text-gray-500"},"Expires:",-1)),t("span",Ca,v(r(e.item.data.expDate)),1)])):b("",!0)])])):e.item.type==="offer"?(o(),d("div",Sa,[e.item.data.image?(o(),d("div",$a,[t("img",{src:e.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Aa)])):b("",!0),t("div",Da,[t("h4",Ta,v(e.item.data.brand)+" "+v(e.item.data.model)+" ("+v(e.item.data.year)+")",1),t("p",Oa,"€ "+v(n(e.item.data.price)),1)]),e.item.data.isMainOffer?(o(),d("span",Ia,"Main Offer")):b("",!0)])):e.item.type==="purchase"?(o(),d("div",Na,[t("div",Va,[t("h4",Fa,v(e.item.data.brand)+" "+v(e.item.data.model)+" ("+v(e.item.data.year)+")",1),t("p",Ua,"€ "+v(n(e.item.data.price)),1),e.item.data.purchaseDate?(o(),d("p",qa,"Purchased: "+v(r(e.item.data.purchaseDate)),1)):b("",!0),e.item.data.notes?(o(),d("p",Ba,v(e.item.data.notes),1)):b("",!0)])])):b("",!0)]))])):b("",!0)])])}}},ja={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Ma={class:"flex items-center gap-3"},Ea=["title"],Wa={key:0,class:"fa-solid fa-arrow-left text-sm"},La={key:1,class:"fa-solid fa-arrow-right text-sm"},za={key:2,class:"font-bold text-lg text-gray-800"},Pa={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Ra={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Ha={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Ka={class:"text-sm"},Ya={key:2,class:"space-y-6 relative z-10"},Qa={key:0,class:"mb-4 pl-12"},Ja={class:"text-sm font-semibold text-gray-800"},Ga={class:"flex gap-4 relative mb-6"},Xa={class:"flex-1 min-w-0"},Za={class:"text-sm text-slate-700 leading-snug"},_a={class:"font-bold"},es={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},ts={class:"text-xs text-gray-400 mt-1"},as={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},ss={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 z-0"},ns={key:1,class:"space-y-4 relative z-10"},ls=["title"],is={key:2,class:"text-center py-8 text-gray-400 relative z-10"},os={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(e,{emit:m}){const l=e,i=a=>{const n={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return n[a]||n.default},c=a=>{const n={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return n[a]||n.default},s=a=>{if(!a)return"";const n=new Date(a),r=new Date,k=new Date(r);return k.setDate(k.getDate()-1),n.toDateString()===r.toDateString()?"Today":n.toDateString()===k.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",g=(a,n)=>{if(a===0)return!0;const r=l.activities[a-1];if(!r)return!0;const k=new Date(n.timestamp).toDateString(),B=new Date(r.timestamp).toDateString();return k!==B};return(a,n)=>e.show?(o(),d("div",{key:0,class:F(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[e.collapsed?"w-16":"w-80",e.mobileFullscreen?"xl:relative xl:border-l":""]])},[t("div",ja,[t("div",Ma,[e.mobileFullscreen?(o(),d("button",{key:0,onClick:n[0]||(n[0]=r=>a.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...n[2]||(n[2]=[t("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):e.showCollapse?(o(),d("button",{key:1,onClick:n[1]||(n[1]=r=>a.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:e.collapsed?"Expand sidebar":"Collapse sidebar"},[e.collapsed?(o(),d("i",Wa)):(o(),d("i",La))],8,Ea)):b("",!0),e.collapsed?b("",!0):(o(),d("h2",za,v(e.title),1))])]),e.collapsed?(o(),d("div",as,[e.activities.length>0?(o(),d("div",ss)):b("",!0),e.activities.length>0?(o(),d("div",ns,[(o(!0),d(E,null,H(e.activities,r=>(o(),d("div",{key:r.id,class:"relative"},[t("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white border-2 border-gray-200",c(r.type)]),title:`${r.user} ${r.action}`},[t("i",{class:F([i(r.type),"text-xs"])},null,2)],10,ls)]))),128))])):(o(),d("div",is,[...n[4]||(n[4]=[t("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(o(),d("div",Pa,[e.activities.length>0?(o(),d("div",Ra)):b("",!0),e.activities.length===0?(o(),d("div",Ha,[n[3]||(n[3]=t("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),t("p",Ka,v(e.emptyMessage),1)])):(o(),d("div",Ya,[(o(!0),d(E,null,H(e.activities,(r,k)=>(o(),d(E,{key:r.id},[g(k,r)?(o(),d("div",Qa,[t("h3",Ja,v(s(r.timestamp)),1)])):b("",!0),t("div",Ga,[t("div",{class:F(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",c(r.type)])},[t("i",{class:F([i(r.type),"text-sm"])},null,2)],2),t("div",Xa,[t("div",Za,[t("span",_a,v(r.user),1),U(" "+v(r.action),1)]),r.content?(o(),d("div",es,v(r.content),1)):b("",!0),t("div",ts,v(p(r.timestamp)),1)])])],64))),128))]))]))],2)):b("",!0)}},rs={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},ds={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},us={class:"mb-3"},cs={class:"flex justify-end gap-2"},ms={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const l=e,i=m,c=T(""),s=T(""),p=()=>{!c.value.trim()&&!s.value||i("save",{type:"communication",action:`sent via ${l.type}`,content:c.value||`Sent template: ${s.value}`,communicationType:l.type})};return(g,a)=>(o(),d("div",rs,[a[5]||(a[5]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("h5",ds,v(e.type==="email"?"Send Email":e.type==="whatsapp"?"Send WhatsApp":e.type==="sms"?"Send SMS":"Send Message"),1),t("div",us,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Template",-1)),D(t("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>s.value=n),class:"input"},[...a[3]||(a[3]=[t("option",{value:""},"Select a template...",-1),t("option",null,"Follow-up",-1),t("option",null,"Meeting Confirmation",-1),t("option",null,"Quote Proposal",-1),t("option",null,"Unable to Reach",-1)])],512),[[ge,s.value]])]),D(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>c.value=n),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[N,c.value]]),t("div",cs,[t("button",{onClick:a[2]||(a[2]=n=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},fs={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},ps={key:1,class:"flex justify-between items-center mb-4"},ys={class:"text-sm font-bold text-gray-900"},gs={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},vs={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:l}){const i=e,c=l,s=T("");J(()=>{i.item&&(s.value=i.item.content||"")});const p=()=>{var g,a;s.value.trim()&&c("save",{id:((g=i.item)==null?void 0:g.id)||Date.now(),type:"note",action:i.item?"updated a note":"added a note",content:s.value,timestamp:((a=i.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!i.item})};return m({submit:p,canSubmit:()=>!!s.value.trim()}),(g,a)=>(o(),d("div",{class:F(["animate-fade-in relative",{"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6":!e.hideHeader}])},[e.hideHeader?b("",!0):(o(),d("div",fs)),e.hideHeader?b("",!0):(o(),d("div",ps,[t("h5",ys,v(e.item?"Edit Note":"Add Note"),1),t("button",{onClick:a[0]||(a[0]=n=>g.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...a[3]||(a[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t("div",null,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Note",-1)),D(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>s.value=n),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[N,s.value]])]),e.hideActions?b("",!0):(o(),d("div",gs,[t("button",{onClick:a[2]||(a[2]=n=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")]))],2))}},bs={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},xs={class:"flex justify-between items-center mb-4"},hs={class:"text-sm font-bold text-gray-900"},ks={class:"flex items-center gap-3"},ws={key:0,class:"text-sm text-slate-600"},Cs={key:1,class:"text-sm text-gray-400"},Ss={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},$s=["disabled"],As={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const l=e,i=m,c=T(null),s=T("");J(()=>{l.item&&(s.value=l.item.fileName||"")});const p=a=>{const n=a.target.files[0];n&&(c.value=n,s.value=n.name)},g=()=>{var a,n;!c.value&&!l.item||i("save",{id:((a=l.item)==null?void 0:a.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:s.value,timestamp:((n=l.item)==null?void 0:n.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return(a,n)=>(o(),d("div",bs,[n[6]||(n[6]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("div",xs,[t("h5",hs,v(e.item?"Edit Attachment":"Add Attachment"),1),t("button",{onClick:n[0]||(n[0]=r=>a.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...n[3]||(n[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t("div",null,[n[5]||(n[5]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),t("div",ks,[t("input",{type:"file",onChange:p,ref:"fileInput",class:"hidden"},null,544),t("button",{onClick:n[1]||(n[1]=r=>a.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...n[4]||(n[4]=[t("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),U("Choose File ",-1)])]),s.value?(o(),d("span",ws,v(s.value),1)):(o(),d("span",Cs,"No file selected"))])]),t("div",Ss,[t("button",{onClick:n[2]||(n[2]=r=>a.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:g,disabled:!c.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,$s)])]))}},Ds={class:"animate-fade-in"},Ts={class:"space-y-4"},Os={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Is={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ns={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Vs=["disabled"],Fs={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:l}){const i=e,c=l,s=T({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});J(()=>{i.item&&i.item.data&&(s.value={startDate:i.item.data.startDate||"",expDate:i.item.data.expDate||"",productName:i.item.data.product||i.item.data.productName||"",deposit:i.item.data.deposit||"",loanAmount:i.item.data.total||i.item.data.loanAmount||""})});const p=()=>{var g,a;s.value.productName&&c("save",{id:((g=i.item)==null?void 0:g.id)||Date.now(),type:"financing",action:i.item?"updated a financing proposal":"added a financing proposal",data:{product:s.value.productName,provider:"Audi Financial",total:s.value.loanAmount||"0",monthly:Math.round(parseFloat(s.value.loanAmount||0)/36).toString(),startDate:s.value.startDate,expDate:s.value.expDate,deposit:s.value.deposit},timestamp:((a=i.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!i.item})};return m({submit:p,isValid:C(()=>!!s.value.productName)}),(g,a)=>(o(),d("div",Ds,[t("div",Ts,[t("div",Os,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Start date",-1)),D(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=n=>s.value.startDate=n),class:"input"},null,512),[[N,s.value.startDate]])]),t("div",null,[a[7]||(a[7]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Expiration date",-1)),D(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=n=>s.value.expDate=n),class:"input"},null,512),[[N,s.value.expDate]])])]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Financial product name",-1)),D(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=n=>s.value.productName=n),class:"input"},null,512),[[N,s.value.productName]])]),t("div",Is,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Deposit",-1)),D(t("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=n=>s.value.deposit=n),class:"input"},null,512),[[N,s.value.deposit]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Total loan amount",-1)),D(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=n=>s.value.loanAmount=n),class:"input"},null,512),[[N,s.value.loanAmount]])])])]),e.hideActions?b("",!0):(o(),d("div",Ns,[t("button",{onClick:a[5]||(a[5]=n=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,disabled:!s.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Vs)]))]))}},Us={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const l=m,i=T(null),c=C(()=>{var a;return((a=i.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=i.value)==null||a.submit()},p=a=>{a||l("close")},g=a=>{l("save",a),l("close")};return(a,n)=>(o(),q(y(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[x(y(G),null,{default:S(()=>[x(y(X),{class:"fixed inset-0 z-50 bg-black/50"}),x(y(Z),{class:"w-full sm:max-w-lg"},{default:S(()=>[x(y(_),null,{default:S(()=>[x(y(ee),null,{default:S(()=>[...n[2]||(n[2]=[U("Add Financing",-1)])]),_:1}),x(y(ve),null,{default:S(()=>[...n[3]||(n[3]=[U("Record financing details for this customer",-1)])]),_:1})]),_:1}),x(Fs,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:i,onSave:g,onCancel:n[0]||(n[0]=r=>a.$emit("close"))},null,8,["item","task-type","task-id"]),x(y(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[x(y(W),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=r=>a.$emit("close"))}),x(y(W),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!c.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},qs={class:"animate-fade-in"},Bs={class:"space-y-4"},js={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Es={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ws=["disabled"],Ls={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:l}){const i=e,c=l,s=T({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});J(()=>{i.item&&i.item.data&&(s.value={class:i.item.data.class||"Car",brand:i.item.data.brand||"",model:i.item.data.model||"",version:i.item.data.version||"",km:i.item.data.km||"",plate:i.item.data.plate||"",date:i.item.data.date||""})});const p=()=>{var g,a;s.value.brand&&c("save",{id:((g=i.item)==null?void 0:g.id)||Date.now(),type:"tradein",action:i.item?"updated a trade-in":"added a trade-in",data:{class:s.value.class,brand:s.value.brand,model:s.value.model||"Unknown Model",year:s.value.date?new Date(s.value.date).getFullYear():"Unknown Year",km:s.value.km||"0",plate:s.value.plate||"",date:s.value.date||""},timestamp:((a=i.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!i.item})};return m({submit:p,isValid:C(()=>!!s.value.brand)}),(g,a)=>(o(),d("div",qs,[t("div",Bs,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),D(t("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>s.value.class=n),class:"input"},[...a[8]||(a[8]=[t("option",{value:"Car"},"Car",-1),t("option",{value:"Motorcycle"},"Motorcycle",-1),t("option",{value:"Truck"},"Truck",-1)])],512),[[ge,s.value.class]])]),t("div",js,[t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),D(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=n=>s.value.brand=n),class:"input"},null,512),[[N,s.value.brand]])]),t("div",null,[a[11]||(a[11]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),D(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=n=>s.value.model=n),class:"input"},null,512),[[N,s.value.model]])])]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),D(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=n=>s.value.version=n),class:"input"},null,512),[[N,s.value.version]])]),t("div",Ms,[t("div",null,[a[13]||(a[13]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),D(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=n=>s.value.km=n),class:"input"},null,512),[[N,s.value.km]])]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),D(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=n=>s.value.plate=n),class:"input"},null,512),[[N,s.value.plate]])])]),t("div",null,[a[15]||(a[15]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),D(t("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=n=>s.value.date=n),class:"input"},null,512),[[N,s.value.date]])])]),e.hideActions?b("",!0):(o(),d("div",Es,[t("button",{onClick:a[7]||(a[7]=n=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,disabled:!s.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Ws)]))]))}},zs={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const l=m,i=T(null),c=C(()=>{var a;return((a=i.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=i.value)==null||a.submit()},p=a=>{a||l("close")},g=a=>{l("save",a),l("close")};return(a,n)=>(o(),q(y(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[x(y(G),null,{default:S(()=>[x(y(X),{class:"fixed inset-0 z-50 bg-black/50"}),x(y(Z),{class:"w-full sm:max-w-lg"},{default:S(()=>[x(y(_),null,{default:S(()=>[x(y(ee),null,{default:S(()=>[...n[2]||(n[2]=[U("Add Trade-In Vehicle",-1)])]),_:1}),x(y(ve),null,{default:S(()=>[...n[3]||(n[3]=[U("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),x(Ls,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:i,onSave:g,onCancel:n[0]||(n[0]=r=>a.$emit("close"))},null,8,["item","task-type","task-id"]),x(y(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[x(y(W),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=r=>a.$emit("close"))}),x(y(W),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!c.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ps={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Rs={key:0,class:"flex justify-between items-center mb-4"},Hs={class:"text-sm font-bold text-gray-900"},Ks={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ys={class:"flex items-center gap-3"},Qs={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Js=["src"],Gs={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Xs={class:"font-bold text-sm text-gray-900"},Zs={class:"text-xs text-gray-500"},_s={class:"space-y-4"},en={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tn={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},an=["disabled"],sn={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:l}){const i=e,c=l,s=T({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});J(()=>{if(i.selectedVehicle){s.value.price=i.selectedVehicle.price||0,s.value.brand=i.selectedVehicle.brand||"",s.value.model=i.selectedVehicle.model||"",s.value.year=i.selectedVehicle.year||"",s.value.image=i.selectedVehicle.image||"";const n=new Date;n.setDate(n.getDate()+30),s.value.validUntil=n.toISOString().split("T")[0]}i.item&&i.item.data&&(s.value={...s.value,...i.item.data,price:i.item.data.price||i.item.data.total||0,financingType:i.item.data.financingType||i.item.data.paymentMethod||"",notes:i.item.data.notes||i.item.data.description||""})}),Q(()=>i.selectedVehicle,n=>{n&&!i.item&&(s.value.price=n.price||0,s.value.brand=n.brand||"",s.value.model=n.model||"",s.value.year=n.year||"",s.value.image=n.image||"")});const p=C(()=>s.value.price>0&&s.value.financingType!==""),g=n=>n?n.toLocaleString("en-US"):"0",a=()=>{var r,k;if(!p.value)return;const n={id:((r=i.item)==null?void 0:r.id)||Date.now(),type:"offer",action:i.item?"updated an offer":"created an offer",data:{brand:s.value.brand,model:s.value.model,year:s.value.year,price:s.value.price,total:s.value.price,paymentMethod:s.value.financingType,financingType:s.value.financingType,downPayment:s.value.downPayment,monthlyPayment:s.value.monthlyPayment,term:s.value.term,interestRate:s.value.interestRate,deliveryDate:s.value.deliveryDate,validUntil:s.value.validUntil,notes:s.value.notes,description:s.value.notes,image:s.value.image},timestamp:((k=i.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!i.item};c("save",n)};return m({submit:a,isValid:p,offerData:s}),(n,r)=>(o(),d("div",Ps,[e.hideHeader?b("",!0):(o(),d("div",Rs,[t("h5",Hs,v(e.item?"Edit Offer":"Create Offer"),1),t("button",{onClick:r[0]||(r[0]=k=>n.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...r[11]||(r[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e.selectedVehicle?(o(),d("div",Ks,[r[12]||(r[12]=t("p",{class:"text-xs text-gray-500 mb-2"},"Creating offer for:",-1)),t("div",Ys,[t("div",Qs,[e.selectedVehicle.image?(o(),d("img",{key:0,src:e.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Js)):(o(),d("i",Gs))]),t("div",null,[t("h4",Xs,v(e.selectedVehicle.brand)+" "+v(e.selectedVehicle.model)+" ("+v(e.selectedVehicle.year)+") ",1),t("p",Zs,"Base Price: € "+v(g(e.selectedVehicle.price)),1)])])])):b("",!0),t("div",_s,[t("div",null,[r[13]||(r[13]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[U(" Offer Price (€) "),t("span",{class:"text-red-500"},"*")],-1)),D(t("input",{type:"number","onUpdate:modelValue":r[1]||(r[1]=k=>s.value.price=k),class:"input",placeholder:"Enter offer price"},null,512),[[N,s.value.price]])]),t("div",null,[r[15]||(r[15]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[U(" Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),D(t("select",{"onUpdate:modelValue":r[2]||(r[2]=k=>s.value.financingType=k),class:"input"},[...r[14]||(r[14]=[t("option",{value:""},"Select payment method",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"finance"},"Finance",-1),t("option",{value:"lease"},"Lease",-1)])],512),[[ge,s.value.financingType]])]),s.value.financingType==="finance"||s.value.financingType==="lease"?(o(),d("div",en,[t("div",null,[r[16]||(r[16]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Down Payment (€)",-1)),D(t("input",{type:"number","onUpdate:modelValue":r[3]||(r[3]=k=>s.value.downPayment=k),class:"input",placeholder:"0"},null,512),[[N,s.value.downPayment]])]),t("div",null,[r[17]||(r[17]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Monthly Payment (€)",-1)),D(t("input",{type:"number","onUpdate:modelValue":r[4]||(r[4]=k=>s.value.monthlyPayment=k),class:"input",placeholder:"Calculated automatically"},null,512),[[N,s.value.monthlyPayment]])]),t("div",null,[r[18]||(r[18]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Term (months)",-1)),D(t("input",{type:"number","onUpdate:modelValue":r[5]||(r[5]=k=>s.value.term=k),class:"input",placeholder:"36"},null,512),[[N,s.value.term]])]),t("div",null,[r[19]||(r[19]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Interest Rate (%)",-1)),D(t("input",{type:"number",step:"0.1","onUpdate:modelValue":r[6]||(r[6]=k=>s.value.interestRate=k),class:"input",placeholder:"3.5"},null,512),[[N,s.value.interestRate]])])])):b("",!0),t("div",null,[r[20]||(r[20]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Expected Delivery Date",-1)),D(t("input",{type:"date","onUpdate:modelValue":r[7]||(r[7]=k=>s.value.deliveryDate=k),class:"input"},null,512),[[N,s.value.deliveryDate]])]),t("div",null,[r[21]||(r[21]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Offer Valid Until",-1)),D(t("input",{type:"date","onUpdate:modelValue":r[8]||(r[8]=k=>s.value.validUntil=k),class:"input"},null,512),[[N,s.value.validUntil]])]),t("div",null,[r[22]||(r[22]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Notes / Special Terms",-1)),D(t("textarea",{"onUpdate:modelValue":r[9]||(r[9]=k=>s.value.notes=k),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[N,s.value.notes]])])]),e.hideActions?b("",!0):(o(),d("div",tn,[t("button",{onClick:r[10]||(r[10]=k=>n.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),t("button",{onClick:a,disabled:!p.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},v(e.item?"Update Offer":"Create Offer"),9,an)]))]))}},nn={class:"p-6"},ln={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(e,{emit:m}){const l=m,i=T(null),c=C(()=>{var a;return((a=i.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=i.value)==null||a.submit()},p=a=>{a||l("close")},g=a=>{l("save",a),l("close")};return(a,n)=>(o(),q(y(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[x(y(G),null,{default:S(()=>[x(y(X),{class:"fixed inset-0 z-50 bg-black/50"}),x(y(Z),{class:"w-full sm:max-w-2xl p-0"},{default:S(()=>[x(y(_),{class:"p-6 pb-4 border-b border-gray-100"},{default:S(()=>[x(y(ee),null,{default:S(()=>[...n[2]||(n[2]=[U("Create Offer",-1)])]),_:1}),x(y(ve),null,{default:S(()=>[...n[3]||(n[3]=[U("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),t("div",nn,[x(sn,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"requested-car":e.requestedCar,"recommended-cars":e.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:i,onSave:g,onCancel:n[0]||(n[0]=r=>a.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),x(y(te),{class:"p-6 pt-4 bg-gray-50 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border-gray-100"},{default:S(()=>[x(y(W),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=r=>a.$emit("close"))}),x(y(W),{label:e.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!c.value,onClick:s},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},on={class:"space-y-4"},rn={key:0},dn={class:"flex flex-wrap gap-2"},un=["onClick"],cn={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(e,{emit:m}){const l=e,i=m,c=T(""),s=g=>{g||i("close")};Q(()=>l.show,g=>{g&&(c.value="")});const p=()=>{const g=c.value.trim();g&&(l.existingTags.includes(g)||(i("add",g),c.value=""))};return(g,a)=>(o(),q(y(ae),{open:e.show,"onUpdate:open":s},{default:S(()=>[x(y(G),null,{default:S(()=>[x(y(X),{class:"fixed inset-0 z-50 bg-black/50"}),x(y(Z),{class:"w-full sm:max-w-md"},{default:S(()=>[x(y(_),null,{default:S(()=>[x(y(ee),null,{default:S(()=>[...a[2]||(a[2]=[U("Add Tag",-1)])]),_:1})]),_:1}),t("div",on,[t("div",null,[a[3]||(a[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Tag Name ",-1)),D(t("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>c.value=n),onKeyup:Me(p,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[N,c.value]])]),e.existingTags.length>0?(o(),d("div",rn,[a[4]||(a[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Existing Tags ",-1)),t("div",dn,[(o(!0),d(E,null,H(e.existingTags,n=>(o(),d("button",{key:n,onClick:r=>c.value=n,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},v(n),9,un))),128))])])):b("",!0)]),x(y(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[x(y(W),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=n=>g.$emit("close"))}),x(y(W),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!c.value.trim(),onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ce={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function $e(e){if(!e)return ce.default;const m=e.toLowerCase().trim();return ce[m]||ce.default}function mn({store:e,taskId:m,getTabForItemType:l,isOverviewModalAction:i}){const c=T(null),s=T(null),p=T("overview"),g=T("email"),a=T([]);Q(p,()=>{c.value=null,s.value=null});const n=C(()=>[...e.currentActivities.value,...a.value.filter(I=>!I.activityId)].filter(I=>{const A=l(I.type);return p.value==="overview"?A==="overview":A===p.value}).sort((I,A)=>{const V=new Date(I.timestamp||0);return new Date(A.timestamp||0)-V})),r=u=>(s.value=null,p.value==="overview"&&i&&i(u)?{type:"overview-modal",action:u}:(["email","sms","whatsapp","call"].includes(u)?(g.value=u,c.value="communication"):c.value=u,null)),k=async u=>{var I;if(u.isEdit){const A=a.value.findIndex(V=>V.id===u.id);A>-1&&(a.value[A]={...a.value[A],...u}),(I=s.value)!=null&&I.activityId&&await e.updateActivity(m.value,s.value.activityId,{type:u.communicationType||u.type,user:"You",action:u.action,content:u.content,fileName:u.fileName,data:u.data})}else{const A=u.communicationType||u.type,V=await e.addActivity(m.value,{type:A,user:"You",action:u.action,content:u.content,fileName:u.fileName,data:u.data});a.value.push({id:V.id,type:A==="email"||A==="whatsapp"||A==="sms"?"communication":A,action:u.action,content:u.content,fileName:u.fileName,data:u.data,timestamp:V.timestamp,activityId:V.id})}c.value=null,s.value=null},B=()=>{c.value=null,s.value=null},O=u=>{l(u.type)&&(c.value=u.type==="email"||u.type==="whatsapp"||u.type==="sms"||u.type==="communication"?"communication":u.type,s.value=u)},f=async u=>{try{await e.deleteActivity(m.value,u)}catch(I){throw console.error("Error deleting item:",I),I}};return{activeTab:p,showInlineWidget:c,inlineWidgetType:C(()=>c.value),editingItem:s,isEditing:C(()=>s.value!==null),communicationType:g,inlineContent:a,filteredInlineContent:n,handleAddNewAction:r,handleWidgetSave:k,handleWidgetCancel:B,handleEditItem:O,handleDeleteItem:f}}const fn={class:"flex-1 flex flex-col overflow-hidden h-full"},pn={class:"bg-white border-b border-gray-200 shrink-0"},yn={class:"px-4 md:px-8 py-3 md:py-4"},gn={class:"flex-1 flex flex-row overflow-hidden"},vn={class:"flex-1 flex flex-col overflow-hidden min-w-0"},bn={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},xn={class:"mb-4"},hn={key:0},kn={key:0,class:"mb-6"},wn={class:"space-y-6 mb-6"},Cn={key:1,class:"mb-6"},Sn={key:2,class:"space-y-4 mb-6 px-1"},$n={key:1},An={key:0,class:"space-y-4 mb-6 px-1"},Vn={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(e,{emit:m}){const l=e,i=Ee(),c=We(),s=C(()=>l.task.id),p=C(()=>l.type==="contact"?"bg-blue-100 text-blue-600":l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),g=C(()=>i.path.startsWith("/tasks")&&!i.path.startsWith("/customer")),a=T(i.path.startsWith("/tasks")&&!i.path.startsWith("/customer"));Q(()=>i.path,h=>{a.value=h.startsWith("/tasks")&&!h.startsWith("/customer")});const n=()=>{c.push({path:`/customer/${l.task.id}`,query:{type:l.type}})};function r(h){u.value=!1}const k=()=>{I.value=!0},B=async h=>{var $,M,P,j;const w=h.name;l.type==="lead"?await((M=($=l.storeAdapter).updateLead)==null?void 0:M.call($,l.task.id,{assignee:w,assigneeType:h.type,teamId:h.type==="team"?h.id:null})):l.type==="opportunity"&&await((j=(P=l.storeAdapter).updateOpportunity)==null?void 0:j.call(P,l.task.id,{assignee:w,assigneeType:h.type,teamId:h.type==="team"?h.id:null})),I.value=!1},O=T(!1),f=T(null),u=T(!1),I=T(!1),A=T(!1),{activeTab:V,showInlineWidget:L,editingItem:ie,communicationType:Ae,inlineContent:xe,filteredInlineContent:se,handleAddNewAction:De,handleWidgetSave:ne,handleWidgetCancel:oe,handleEditItem:he,handleDeleteItem:ke}=mn({store:l.storeAdapter,taskId:s,getTabForItemType:$e,isOverviewModalAction:h=>V.value==="overview"&&l.addNewConfig.overviewActions.includes(h)});Q(()=>l.task.id,()=>{V.value="overview"});const re=h=>{const w=De(h);w&&w.modalAction&&(f.value=w.modalAction,O.value=!0)},Te=h=>{if(h==="appointment"){u.value=!0;return}const w={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(h))f.value=h,O.value=!0;else{const $=w[h];$?(V.value=$,setTimeout(()=>{re(h),setTimeout(()=>{try{const M=document.querySelector(".animate-fade-in");M&&M.parentNode&&M.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):re(h)}},le=()=>{O.value=!1,f.value=null},de=async h=>{await ne(h),le()},Oe=C(()=>{const h=[...l.storeAdapter.currentActivities.value,...xe.value],w=h.filter(j=>$e(j.type)==="overview").length,$=h.filter(j=>["call","email","sms","whatsapp","communication"].includes(j.type)).length,M=h.filter(j=>j.type==="note").length,P=h.filter(j=>j.type==="attachment").length;return[{key:"overview",label:"Overview",count:w},{key:"note",label:"Notes",count:M},{key:"communication",label:"Communication",count:$},{key:"attachment",label:"Attachments",count:P}]}),we=C(()=>[...l.storeAdapter.currentActivities.value,...xe.value]);C(()=>f.value==="financing"?"Add Financing":f.value==="tradein"?"Add Trade-in":f.value==="purchase"?"Create Purchase Offer":"");const Ie=async h=>{if(l.type==="opportunity")try{await l.storeAdapter.addVehicle(l.task.id,h.vehicleData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(w){console.error("Error selecting vehicle:",w)}},Ne=async h=>{if(l.type==="opportunity")try{await l.storeAdapter.createOffer(l.task.id,h.offerData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(w){console.error("Error creating offer:",w)}},Ve=async h=>{var M,P,j,ue;const w=l.task.tags||[];if(w.includes(h)){A.value=!1;return}const $=[...w,h];try{l.type==="lead"?await((P=(M=l.storeAdapter).updateLead)==null?void 0:P.call(M,l.task.id,{tags:$})):l.type==="opportunity"&&await((ue=(j=l.storeAdapter).updateOpportunity)==null?void 0:ue.call(j,l.task.id,{tags:$})),l.type==="lead"&&l.storeAdapter.loadLeadById?await l.storeAdapter.loadLeadById(l.task.id):l.type==="opportunity"&&l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id),A.value=!1}catch(Fe){console.error("Error adding tag:",Fe)}};return(h,w)=>(o(),d("div",fn,[t("header",pn,[t("div",yn,[x(ft,{initials:e.task.customer.initials,name:e.task.customer.name,email:e.task.customer.email,phone:e.task.customer.phone,"third-field-value":e.task.customer.address,"avatar-color-class":p.value,"task-type":e.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Te,onAddTag:w[0]||(w[0]=$=>A.value=!0)},{tags:S(()=>[(o(!0),d(E,null,H(e.task.tags,$=>(o(),d("span",{key:$,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},v($),1))),128))]),"name-action":S(()=>[g.value?(o(),d("button",{key:0,onClick:n,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...w[9]||(w[9]=[t("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):b("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),t("div",gn,[t("div",vn,[t("main",bn,[t("div",xn,[x(vt,{modelValue:y(V),"onUpdate:modelValue":w[1]||(w[1]=$=>Le(V)?V.value=$:null),tabs:Oe.value,class:"mb-0"},null,8,["modelValue","tabs"])]),y(V)==="overview"?(o(),d("div",hn,[e.type!=="contact"?(o(),d("div",kn,[x(St,{stage:e.task.displayStage||e.task.stage,owner:e.task.assignee,source:e.task.source||"","delivery-substatus":e.task.deliverySubstatus,activities:e.task.activities||[],"entity-type":e.type,onReassign:k},null,8,["stage","owner","source","delivery-substatus","activities","entity-type"])])):b("",!0),t("div",wn,[fe(h.$slots,"pinned-extra",{task:e.task})]),e.managementWidget?(o(),d("div",Cn,[(o(),q(ze(e.managementWidget),{lead:e.type==="lead"?e.task:void 0,opportunity:e.type==="opportunity"?e.task:void 0,contact:e.type==="contact"?e.task:void 0,activities:we.value,onCarAdded:w[2]||(w[2]=$=>h.$emit("car-added",$)),onConvertToLead:w[3]||(w[3]=$=>h.$emit("convert-to-lead")),onConvertToOpportunity:w[4]||(w[4]=$=>h.$emit("convert-to-opportunity")),onVehicleSelected:Ie,onCreateOffer:Ne},null,40,["lead","opportunity","contact","activities"]))])):b("",!0),y(se).length>0?(o(),d("div",Sn,[(o(!0),d(E,null,H(y(se),$=>(o(),q(Se,{key:$.id,item:$,"task-type":e.type,"customer-initials":"SK",onEdit:y(he),onDelete:y(ke)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):b("",!0)])):(o(),d("div",$n,[x(Ot,{actions:e.addNewConfig.tabActions,"active-tab":y(V),onAction:re},null,8,["actions","active-tab"]),t("div",null,[y(L)==="communication"?(o(),q(ms,{key:0,type:y(Ae),"task-type":e.type,"task-id":e.task.id,item:y(ie),onSave:y(ne),onCancel:y(oe)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):b("",!0),y(L)==="note"?(o(),q(vs,{key:1,item:y(ie),"task-type":e.type,"task-id":e.task.id,onSave:y(ne),onCancel:y(oe)},null,8,["item","task-type","task-id","onSave","onCancel"])):b("",!0),y(L)==="attachment"?(o(),q(As,{key:2,item:y(ie),"task-type":e.type,"task-id":e.task.id,onSave:y(ne),onCancel:y(oe)},null,8,["item","task-type","task-id","onSave","onCancel"])):b("",!0)]),y(se).length>0?(o(),d("div",An,[(o(!0),d(E,null,H(y(se),$=>(o(),q(Se,{key:$.id,item:$,"task-type":e.type,"customer-initials":"SK",onEdit:y(he),onDelete:y(ke)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):b("",!0)]))])]),x(os,{title:"Activity summary",activities:we.value,collapsed:a.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:w[5]||(w[5]=$=>a.value=!a.value)},null,8,["activities","collapsed"])]),x(Us,{show:f.value==="financing"&&O.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:de,onClose:le},null,8,["show","task-type","task-id"]),x(zs,{show:f.value==="tradein"&&O.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:de,onClose:le},null,8,["show","task-type","task-id"]),x(ln,{show:f.value==="purchase"&&O.value,item:null,"task-type":e.type,"task-id":e.task.id,"requested-car":e.type==="lead"?e.task.requestedCar:null,"recommended-cars":[],onSave:de,onClose:le},null,8,["show","task-type","task-id","requested-car"]),x(Pe,{show:I.value,onClose:w[6]||(w[6]=$=>I.value=!1),onConfirm:B},null,8,["show"]),u.value?(o(),q(Re,{key:0,show:u.value,customer:e.task.customer,assignee:e.task.assignee,"disabled-fields":["customer"],onCreate:r,onCancel:w[7]||(w[7]=$=>u.value=!1)},null,8,["show","customer","assignee"])):b("",!0),x(cn,{show:A.value,"existing-tags":e.task.tags||[],onClose:w[8]||(w[8]=$=>A.value=!1),onAdd:Ve},null,8,["show","existing-tags"])]))}},be={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:e=>e.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:e=>e.scheduledAppointment?`Scheduled for ${e.formatDateTime(e.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:e=>e.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:e=>e.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:e=>e.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:e=>{const m=e.deliverySubstatus;return m==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:m==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},me={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function R(e){if(!e)return 0;const m=new Date(e),i=Math.abs(new Date-m);return Math.ceil(i/(1e3*60*60*24))}const Y={"no-appointment":e=>!e.scheduledAppointment,"has-appointment":e=>!!e.scheduledAppointment,"appointment-past-not-completed":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)<new Date&&e.scheduledAppointment.status!=="completed":!1,"has-future-appointment":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)>new Date:!1,"no-offers":e=>!e.hasOffers,"has-offers":e=>e.hasOffers,"qualified-no-offers-7-13-days":e=>{const m=z(),l=m.getSetting("oofbMinDays"),i=m.getSetting("oofbMaxDays"),c=R(e.opportunity.createdAt);return c>=l&&c<i+1&&!e.hasOffers},"qualified-no-offers-14-plus-days":e=>{const l=z().getSetting("ufbDays");return R(e.opportunity.createdAt)>=l&&!e.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const l=z().getSetting("ofbDays");return R(e.opportunity.lastActivity||e.opportunity.createdAt)>=l&&!e.opportunity.contractDate&&e.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const l=z().getSetting("nfuDays"),i=R(e.opportunity.lastActivity||e.opportunity.createdAt),c=e.scheduledAppointment&&new Date(e.scheduledAppointment.start)>new Date;return i>=l&&!e.opportunity.contractDate&&!c&&e.hasOffers},"contract-7-plus-days-no-delivery":e=>{var s;if(!e.opportunity.contractDate)return!1;const l=z().getSetting("cfbDays"),i=R(e.opportunity.contractDate),c=(s=e.activities)==null?void 0:s.some(p=>{var g;return p.type==="delivery"||((g=p.action)==null?void 0:g.toLowerCase().includes("delivered"))});return i>=l&&!c},"delivery-date-set":e=>!!e.opportunity.deliveryDate,"delivery-3-plus-days":e=>{var s;const m=(s=e.activities)==null?void 0:s.find(p=>{var g;return p.type==="delivery"||((g=p.action)==null?void 0:g.toLowerCase().includes("delivered"))});if(!m)return!1;const i=z().getSetting("dfbDays");return R(m.timestamp)>=i},"is-awaiting-delivery":e=>e.deliverySubstatus==="Awaiting Delivery","is-delivered":e=>e.deliverySubstatus==="Delivered","has-no-delivery":e=>!e.deliverySubstatus||e.deliverySubstatus===null,"is-closed":e=>{const m=e.stage;return m==="Closed Won"||m==="Closed Lost"},"is-closed-with-task-widget":e=>Y["is-closed"](e)&&e.hasActiveTaskWidget,"opportunity-abandoned":e=>{if(Y["is-closed"](e))return!1;const m=z(),l=m.getSetting("abandonedOpportunityDays");if(!m.getSetting("abandonedEligibleStages").includes(e.stage))return!1;const c=e.opportunity.lastActivity||e.opportunity.createdAt;return R(c)>=l}};function Fn(e,m){if(Y["is-closed-with-task-widget"](m))return[me.reopen,me.requalify,me.closeLost];const l=be[e];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(i=>{if(!i.conditional)return!0;const c=Y[i.conditional];return c?c(m):!0})}function Un(e,m){const l=be[e];if(!l||!l.taskWidgets)return null;const c=z().getSetting("autoCloseWidgetsOnClose"),s=Y["is-closed"]({stage:e});for(const p of l.taskWidgets){if(c&&s&&(p.type==="NFU"||p.type==="OFB"))continue;const g=Y[p.condition];if(g&&g(m))return p.type}return null}function qn(e,m){const l=be[e];if(!l||!l.primaryAction)return null;const i=l.primaryAction;return{...i,title:typeof i.title=="function"?i.title(m):i.title,description:typeof i.description=="function"?i.description(m):i.description,label:typeof i.label=="function"?i.label(m):i.label}}function Bn(e){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[e]||"Task"}function jn(e){return e==="Closed Won"||e==="Closed Lost"}const Mn={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(e,{emit:m}){const l=m,i=s=>{s||l("close")},c=()=>{l("close")};return(s,p)=>(o(),q(y(ae),{open:e.show,"onUpdate:open":i},{default:S(()=>[x(y(G),null,{default:S(()=>[x(y(X),{class:"fixed inset-0 z-50 bg-black/50"}),x(y(Z),{class:"w-full sm:max-w-md"},{default:S(()=>[x(y(_),null,{default:S(()=>[x(y(ee),null,{default:S(()=>[U(v(e.title),1)]),_:1})]),_:1}),p[0]||(p[0]=t("div",{class:"py-8 flex items-center justify-center"},[t("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),x(y(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[x(y(W),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Vn as _,vs as a,qn as b,Fn as c,Bn as d,sn as e,Mn as f,Un as g,jn as i};
