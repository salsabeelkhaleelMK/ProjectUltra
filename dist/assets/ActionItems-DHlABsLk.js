import{r as I,u as q,c as l,o as n,a as e,n as A,t as y,b as S,F as $,d as Y,w as j,e as T,f as U,g as Q,h as B,i as H,j as L,k as g,l as O,m as E,s as z,p as F}from"./index-DOihZbFy.js";import{u as V}from"./users-D6SY3KFZ.js";import{_ as J}from"./ModalShell-C5oPwjwM.js";const P={class:"flex items-center gap-2 mb-2"},G={class:"text-[10px] text-gray-400"},W={class:"text-[10px] text-gray-500"},K={class:"ml-auto flex items-center gap-2"},X={key:1,class:"bg-white border border-gray-200 rounded-lg shadow-lg p-1.5 flex items-center gap-1.5 z-10"},Z=["innerHTML"],ee={class:"flex gap-2 flex-wrap justify-end px-2"},te={__name:"ActionableQuestionCard",props:{question:{type:Object,required:!0}},emits:["answer-yes","answer-no","reassign","view-task","dismiss"],setup(u,{emit:b}){const r=u,p=b,x=I(!1),d=I(!1),v=q();V();const m=()=>{var o,h,k;const t=((o=r.question.opportunity)==null?void 0:o.assignee)||((h=r.question.lead)==null?void 0:h.assignee);return t?t===((k=v.currentUser)==null?void 0:k.name)?"me":t:"Unknown"},C=()=>{const t=r.question.customer.name,o=r.question.question,h=`<a href="#" class="font-bold text-primary-600 hover:text-primary-700 hover:underline" onclick="event.preventDefault()">${t}</a>`;return o.replace(new RegExp(t,"g"),h)},f=t=>t===1?"bg-red-50 text-red-600 border-red-100":t<=3?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100",a=t=>t===1?"CRITICAL":t<=3?"HIGH":"MEDIUM",c=()=>{if(!r.question.createdAt&&!r.question.appointmentDate)return"Just now";const t=new Date(r.question.createdAt||r.question.appointmentDate),h=new Date-t,k=Math.floor(h/6e4),M=Math.floor(k/60),D=Math.floor(M/24);return k<1?"Just now":k<60?`${k} min ago`:M<24?`${M} hours ago`:D===1?"1 day ago":D<7?`${D} days ago`:`${Math.floor(D/7)} weeks ago`},i=()=>p("answer-yes",r.question),w=()=>p("answer-no",r.question),_=()=>p("reassign",r.question),N=()=>p("view-task",r.question),R=t=>{t.target.tagName==="A"&&(t.preventDefault(),N())},s=()=>{d.value=!0,setTimeout(()=>{p("dismiss",r.question)},200)};return(t,o)=>(n(),l("div",{class:A(["bg-white border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm hover:shadow transition-colors duration-200 mb-3",d.value?"opacity-50":""])},[e("div",P,[e("span",{class:A(["px-2 py-0.5 rounded text-[10px] font-bold uppercase border whitespace-nowrap",f(u.question.priority)])},y(a(u.question.priority)),3),e("span",G,y(c()),1),e("span",W,"• Owner: "+y(m()),1),e("div",K,[x.value?(n(),l("div",X,[o[3]||(o[3]=e("span",{class:"text-[10px] text-gray-600 whitespace-nowrap"},"Dismiss?",-1)),e("button",{onClick:s,class:"px-2 py-0.5 text-[10px] font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded transition-colors"}," Yes "),e("button",{onClick:o[1]||(o[1]=h=>x.value=!1),class:"px-2 py-0.5 text-[10px] font-medium text-gray-600 hover:text-gray-800 transition-colors"}," No ")])):(n(),l("button",{key:0,onClick:o[0]||(o[0]=h=>x.value=!0),class:"w-7 h-7 flex items-center justify-center rounded text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"Dismiss"},[...o[2]||(o[2]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]))])]),e("div",{class:"pt-4 pb-2 mb-3 px-2",onClick:R},[e("p",{class:"text-base text-slate-700 leading-relaxed",innerHTML:C()},null,8,Z)]),e("div",ee,[u.question.type==="appointment-followup"?(n(),l($,{key:0},[e("button",{onClick:i,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:w,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No ")],64)):u.question.type==="ns-followup"?(n(),l($,{key:1},[e("button",{onClick:i,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:w,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:_,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):u.question.type==="offer-followup"?(n(),l("button",{key:2,onClick:N,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors"}," View Opportunity ")):u.question.type==="stuck-opportunity"?(n(),l($,{key:3},[e("button",{onClick:i,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:w,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:_,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):u.question.type==="lead-qualification-urgency"?(n(),l($,{key:4},[e("button",{onClick:i,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:w,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:_,class:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):S("",!0)])],2))}},se={class:"space-y-2 max-h-96 overflow-y-auto mb-4"},oe=["onClick"],re={class:"flex-1"},ne={class:"font-medium text-slate-800"},ae={class:"text-xs text-gray-500 capitalize"},ie={key:0,class:"fa-solid fa-check text-primary-600"},le={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},de=["disabled"],ue={__name:"ReassignUserModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(u,{emit:b}){const r=u,p=b,x=V(),d=I(null),v=Y(()=>x.assignableUsers),m=a=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[a]||"bg-gray-100 text-gray-700";j(()=>r.show,a=>{a||(d.value=null)});const C=a=>{d.value=a},f=()=>{d.value&&(p("confirm",d.value),d.value=null)};return(a,c)=>(n(),T(J,{show:u.show,onClose:c[1]||(c[1]=i=>a.$emit("close")),title:"Reassign"},{footer:U(()=>[e("div",le,[e("button",{onClick:c[0]||(c[0]=i=>a.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:f,disabled:!d.value,class:"px-4 py-2 text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Reassign ",8,de)])]),default:U(()=>[c[2]||(c[2]=e("p",{class:"text-sm text-gray-600 mb-4"}," Select a user to reassign: ",-1)),e("div",se,[(n(!0),l($,null,Q(v.value,i=>(n(),l("button",{key:i.id,onClick:w=>C(i.id),class:A(["w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-primary-300 transition-colors text-left",{"bg-primary-50 border-primary-400":d.value===i.id}])},[e("div",{class:A(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm",m(i.role)])},y(i.initials),3),e("div",re,[e("p",ne,y(i.name),1),e("p",ae,y(i.role)+" • "+y(i.email),1)]),d.value===i.id?(n(),l("i",ie)):S("",!0)],10,oe))),128))])]),_:1},8,["show"]))}},me={class:"h-full overflow-y-auto bg-gray-50"},pe={class:"max-w-4xl mx-auto p-6 space-y-6"},ce={class:"mb-6"},xe={class:"text-xs text-gray-500"},ge={key:0,class:"flex items-center justify-center py-12"},ye={key:1,class:"bg-white border border-gray-200 rounded-xl shadow-sm p-12 text-center"},be={key:2},fe={key:0,class:"text-center pt-4"},he={class:"text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"},$e={__name:"ActionItems",setup(u){const b=O(),r=q(),{questions:p,totalQuestionsCount:x,loading:d,loadQuestions:v,dismissQuestion:m,addFollowUpQuestion:C}=B(),f=I(!1),a=I(null);H(async()=>{await v()});const c=async s=>{s.type==="appointment-followup"?(m(s.id),C({id:`offer-followup-${s.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${s.customer.name}?`,customer:s.customer,opportunityId:s.opportunityId,opportunity:s.opportunity,createdAt:new Date().toISOString()})):(s.type==="ns-followup"||s.type==="stuck-opportunity"||s.type==="lead-qualification-urgency")&&m(s.id)},i=async s=>{var t;if(s.type==="appointment-followup")try{const o=(t=r.currentUser)==null?void 0:t.id;o&&(await F(s.opportunityId,o),m(s.id),await v())}catch(o){console.error("Error creating NS task:",o)}else s.type==="ns-followup"?m(s.id):s.type==="stuck-opportunity"?b.push(`/tasks/${s.opportunityId}?type=opportunity`):s.type==="lead-qualification-urgency"&&b.push(`/tasks/${s.leadId}?type=lead`)},w=s=>{a.value=s,f.value=!0},_=async s=>{if(a.value)try{const t=a.value.opportunityId||a.value.leadId;a.value.opportunityId&&await E(t,s),m(a.value.id),f.value=!1,a.value=null,await v()}catch(t){console.error("Error reassigning:",t)}},N=s=>{s.opportunityId?b.push(`/tasks/${s.opportunityId}?type=opportunity`):s.leadId&&b.push(`/tasks/${s.leadId}?type=lead`)},R=s=>{r.currentUser&&z(s.id,r.currentUser.id),m(s.id)};return(s,t)=>(n(),l("div",me,[e("div",pe,[e("div",ce,[t[2]||(t[2]=e("h1",{class:"text-xl font-bold text-slate-800 mb-1"},"Action Items",-1)),e("p",xe,y(g(x)>0?`Showing ${Math.min(g(p).length,5)} of ${g(x)} urgent items`:"No urgent items require your attention"),1)]),g(d)?(n(),l("div",ge,[...t[3]||(t[3]=[e("div",{class:"text-gray-500"},"Loading questions...",-1)])])):!g(d)&&g(p).length===0?(n(),l("div",ye,[t[4]||(t[4]=e("i",{class:"fa-solid fa-check-circle text-6xl text-emerald-400 mb-4"},null,-1)),t[5]||(t[5]=e("h3",{class:"text-xl font-semibold text-slate-800 mb-2"},"All caught up!",-1)),t[6]||(t[6]=e("p",{class:"text-sm text-gray-600 mb-6"},"No urgent items require your attention right now.",-1)),e("button",{onClick:t[0]||(t[0]=o=>s.$router.push("/tasks")),class:"px-4 py-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])):(n(),l("div",be,[(n(!0),l($,null,Q(g(p),o=>(n(),T(te,{key:o.id,question:o,onAnswerYes:c,onAnswerNo:i,onReassign:w,onViewTask:N,onDismiss:R},null,8,["question"]))),128)),g(x)>5?(n(),l("div",fe,[e("button",he," View all items ("+y(g(x))+") → ",1)])):S("",!0)]))]),L(ue,{show:f.value,onClose:t[1]||(t[1]=o=>f.value=!1),onConfirm:_},null,8,["show"])]))}};export{$e as default};
