import{r as q,R as _e,h as Fe,c as S,H as Ue,d as i,o,e,g as p,n as O,w as X,I as Ve,t as c,p as j,s as A,y as v,P as We,F as R,i as z,a4 as ut,G as et,x as V,z as qe,k as I,v as fe,j as ue,J as L,D as E,Q as F,l as ce,m as ge,a5 as ct,Z as mt,V as ft,X as Ge,O as K,N as ne,K as te}from"./index-Bh03WcOC.js";import{_ as pt}from"./ReassignUserModal-Ccn5hxL3.js";import{_ as bt}from"./CreateEventModal-CDTj2y2Y.js";import{z as xe,F as he,L as ke,H as we,j as Ce,K as Pe,C as $e,W as Se}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DA4kdAII.js";const yt={class:"w-full bg-surface"},vt={class:"flex items-center justify-between gap-3 md:gap-4"},gt={class:"flex items-center gap-3 md:gap-4 flex-1"},xt=["aria-label"],ht={class:"min-w-0 flex-1"},kt={class:"flex items-center gap-2"},wt={class:"text-fluid-xl font-bold uppercase text-brand-dark truncate leading-tight"},Ct={class:"flex flex-wrap items-center gap-2 mt-1"},$t={class:"flex items-center gap-1 ml-2"},St={class:"relative"},At={key:0,class:"absolute top-full right-0 mt-2 z-50"},Tt={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},Dt={class:"flex items-center gap-4"},Et={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},qt={class:"flex items-center gap-2"},Ot={class:"text-fluid-sm text-heading font-medium"},It={class:"flex items-center gap-2"},Nt={class:"text-fluid-sm text-heading font-medium"},jt={class:"flex items-center gap-2"},Mt={class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},Lt={key:0,class:"fa-solid fa-map-marker-alt text-sub text-fluid-xs"},Bt={key:1,class:"fa-regular fa-calendar text-sub text-fluid-xs"},Vt={class:"text-fluid-sm text-heading font-medium"},Ft={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:r}){const n=t,d=r,m=q(!1),l=q(!1),b=_e(),g=Fe(),s=S(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...n.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(y=>({...y,onClick:()=>a(y.key)}))),a=N=>{l.value=!1,d("action",N)},u=async(N,y)=>{try{await navigator.clipboard.writeText(N),b.pushToast("success",`${y==="email"?"Email":"Phone"} copied!`)}catch{b.pushToast("error","Failed to copy")}},h=()=>{d("add-tag")},M=()=>{n.customerId&&g.push(`/customer/${n.customerId}`)};return(N,y)=>{const w=Ue("click-outside");return o(),i("div",yt,[e("div",vt,[e("div",gt,[e("button",{onClick:X(M,["stop"]),class:O(["w-14 h-14 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...y[4]||(y[4]=[e("i",{class:"fa-solid fa-user text-xl"},null,-1)])],10,xt),e("div",ht,[e("div",kt,[e("h1",wt,c(t.name),1),Ve(N.$slots,"name-action")]),e("div",Ct,[Ve(N.$slots,"tags"),e("button",{onClick:X(h,["stop"]),class:"text-fluid-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...y[5]||(y[5]=[e("i",{class:"fa-solid fa-plus text-fluid-xs"},null,-1),e("span",null,"add tag",-1)])])])])]),e("div",$t,[e("div",St,[e("button",{onClick:y[0]||(y[0]=X(T=>l.value=!l.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-surface border border-black/5 rounded-lg hover:bg-surfaceSecondary shrink-0","aria-label":"Quick actions"},[...y[6]||(y[6]=[e("i",{class:"fa-solid fa-plus text-fluid-base text-body"},null,-1)])]),l.value?j((o(),i("div",At,[A(v(We),{items:s.value,className:"w-48"},null,8,["items"])])),[[w,()=>l.value=!1]]):p("",!0)]),e("button",{onClick:y[1]||(y[1]=T=>m.value=!m.value),class:"w-9 h-9 flex items-center justify-center bg-surface border border-black/5 rounded-lg hover:bg-surfaceSecondary shrink-0"},[e("i",{class:O(["fa-solid fa-chevron-up text-fluid-sm transition-transform duration-200",{"rotate-180":m.value}])},null,2)])])]),m.value?(o(),i("div",Tt,[e("div",Dt,[e("div",Et,[e("div",qt,[y[8]||(y[8]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-fluid-xs"})],-1)),e("span",Ot,c(t.email),1),e("button",{onClick:y[2]||(y[2]=X(T=>u(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...y[7]||(y[7]=[e("i",{class:"fa-regular fa-copy text-fluid-xs"},null,-1)])])]),e("div",It,[y[10]||(y[10]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-fluid-xs"})],-1)),e("span",Nt,c(t.phone),1),e("button",{onClick:y[3]||(y[3]=X(T=>u(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...y[9]||(y[9]=[e("i",{class:"fa-regular fa-copy text-fluid-xs"},null,-1)])])]),e("div",jt,[e("div",Mt,[t.thirdFieldLabel.toLowerCase().includes("address")?(o(),i("i",Lt)):(o(),i("i",Bt))]),e("span",Vt,c(t.thirdFieldValue),1)])])])])):p("",!0)])}}},Ut={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},Wt=["onClick"],Je={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const r={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-thumbtack",manage:"fa-solid fa-gear",data:"fa-solid fa-database",notes:"fa-solid fa-note-sticky"},n=d=>r[d]||"fa-solid fa-circle";return(d,m)=>(o(),i("div",Ut,[(o(!0),i(R,null,z(t.tabs,l=>(o(),i("div",{key:l.key,onClick:b=>d.$emit("update:modelValue",l.key),class:O(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===l.key?"border-brand-red text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:O([n(l.key),"text-sm md:text-sm",t.modelValue===l.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:O(["hidden md:inline whitespace-nowrap",t.modelValue===l.key?"text-brand-darkDarker":""])},c(l.label),3)],10,Wt))),128))]))}},Pt={class:"w-full mb-6"},Rt={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},zt={class:"px-4 md:px-6 py-3 border-b border-black/5"},Qt={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},Ht={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},Yt={class:"flex items-center gap-1.5"},Kt={key:1},Gt={class:"flex items-center gap-2"},Jt={key:0,class:"p-4 md:p-6"},Xt={key:0,class:"space-y-4"},Zt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},_t={class:"flex items-center gap-4"},es={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},ts=["src"],ss={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},as={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},ls={class:"flex items-center gap-2 flex-wrap"},ns={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},os={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},is={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},ds={class:"text-fluid-xs font-bold text-heading"},rs={key:0,class:"text-right"},us={class:"font-bold text-heading text-fluid-lg"},cs={key:0,class:"pt-2"},ms={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},fs={class:"text-fluid-sm text-body leading-relaxed"},ps={key:1,class:"space-y-3"},bs={key:0,class:"flex items-center gap-2"},ys={class:"text-fluid-sm font-semibold text-heading"},vs={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},gs={class:"text-fluid-sm text-body leading-relaxed"},xs={key:1,class:"border-t border-black/5"},hs={class:"font-medium"},ks={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},ws={class:"mb-6"},Cs={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},$s={key:0},Ss={class:"font-medium text-body"},As={key:1},Ts={class:"font-medium text-body"},Ds={key:2},Es={class:"font-medium text-body"},qs={class:"font-medium text-body"},Os={key:0},Is={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ns={key:0},js={class:"font-medium text-body"},Ms={key:1},Ls={class:"font-medium text-body"},Bs={key:2},Vs={class:"font-medium text-body"},Fs={key:3},Us={class:"font-medium text-body"},Ws={key:4},Ps={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},Rs={key:5},zs={class:"font-medium text-body"},Qs={key:0,class:"mt-6 flex justify-end"},Hs={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const r=t,n=q(!1);S(()=>r.deliverySubstatus?ut(r.deliverySubstatus):"");const d=S(()=>r.deliverySubstatus?r.deliverySubstatus==="Delivered"?"green":r.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),m=S(()=>et(r.stage,r.entityType));function l(C){return!C||C.length===0?null:C.filter(P=>P.type==="offer").sort((P,ae)=>new Date(ae.timestamp)-new Date(P.timestamp))[0]||null}function b(C){if(!C)return 0;const k=new Date(C),ae=Math.abs(new Date-k);return Math.ceil(ae/(1e3*60*60*24))}const g=S(()=>{if(r.stage!=="In Negotiation")return null;const C=l(r.activities);if(!C)return null;const k=b(C.timestamp);return k<1?{label:"New Offer",theme:"orange"}:k<3?{label:"Active",theme:"yellow"}:null}),s=S(()=>r.requestedCar&&r.requestedCar.brand&&r.requestedCar.model),a=S(()=>r.requestType||r.requestMessage||s.value),u=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.brand)||""}),h=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.model)||""}),M=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.year)||""}),N=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.image)||""}),y=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.price)||null}),w=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.stockDays)!==void 0?r.requestedCar.stockDays:null}),T=S(()=>{var C,k;return((C=r.requestedCar)==null?void 0:C.dealership)||((k=r.task)==null?void 0:k.dealership)||""}),D=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.registration)||""}),B=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.kilometers)!==void 0?r.requestedCar.kilometers:null}),U=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.fuelType)||""}),oe=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.gearType)||""}),Ae=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.vin)||""}),ie=S(()=>"Email"),pe=S(()=>{var C,k;return((C=r.task)==null?void 0:C.sourceDetails)||((k=r.requestedCar)==null?void 0:k.adCampaign)||""}),be=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.expectedPurchaseDate)||""}),_=S(()=>{var C;return((C=r.task)==null?void 0:C.fiscalEntity)||""}),ye=S(()=>{var C;return((C=r.task)==null?void 0:C.sourceDetails)||""}),ve=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.adMedium)||""}),de=S(()=>{var C;return((C=r.requestedCar)==null?void 0:C.adSource)||""});S(()=>!0);const Oe=S(()=>!0),G=S(()=>s.value||r.requestType||r.source||ye.value||pe.value||be.value||_.value||ve.value||de.value),Q=C=>new Intl.NumberFormat("en-US").format(C),se=C=>new Intl.NumberFormat("en-US").format(C);return(C,k)=>(o(),i("div",Pt,[e("div",Rt,[e("div",zt,[e("div",Qt,[a.value?(o(),i("div",Ht,[k[2]||(k[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",Yt,[e("span",{class:O(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:O(["px-2 py-0.5 rounded text-fluid-xs font-medium border",m.value])},c(t.stage),3),t.deliverySubstatus?(o(),V(v(qe),{key:0,text:t.deliverySubstatus,size:"small",theme:d.value},null,8,["text","theme"])):p("",!0),g.value?(o(),V(v(qe),{key:1,text:g.value.label,size:"small",theme:g.value.theme},null,8,["text","theme"])):p("",!0)])])):(o(),i("div",Kt)),e("div",Gt,[k[3]||(k[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:k[0]||(k[0]=P=>C.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},c(t.owner),1)])])]),a.value?(o(),i("div",Jt,[s.value?(o(),i("div",Xt,[e("div",Zt,[e("div",_t,[e("div",es,[N.value?(o(),i("img",{key:0,src:N.value,alt:"Car",class:"w-full h-full object-cover"},null,8,ts)):(o(),i("i",ss))]),e("div",null,[e("div",as,c(u.value)+" "+c(h.value)+" ("+c(M.value)+")",1),e("div",ls,[w.value!==void 0&&w.value!==null?(o(),i("div",ns,[k[4]||(k[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),I(" In stock ("+c(w.value)+" days) ",1)])):s.value?(o(),i("div",os,[...k[5]||(k[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),I(" Out of stock ",-1)])])):p("",!0),t.source?(o(),i("div",is,[k[6]||(k[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",ds,c(t.source),1)])):p("",!0)])])]),y.value?(o(),i("div",rs,[k[7]||(k[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",us,"€ "+c(Q(y.value)),1)])):p("",!0)]),t.requestMessage?(o(),i("div",cs,[k[8]||(k[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",ms,[e("p",fs,c(t.requestMessage),1)])])):p("",!0)])):(o(),i("div",ps,[t.requestType?(o(),i("div",bs,[k[9]||(k[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",ys,c(t.requestType),1)])):p("",!0),t.requestMessage?(o(),i("div",vs,[k[10]||(k[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",gs,c(t.requestMessage),1)])):p("",!0)]))])):p("",!0),G.value?(o(),i("div",xs,[e("button",{onClick:k[1]||(k[1]=P=>n.value=!n.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",hs,c(n.value?"Hide":"View")+" Details",1),e("i",{class:O(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":n.value}])},null,2)])])):p("",!0),n.value&&G.value?(o(),i("div",ks,[e("div",ws,[k[21]||(k[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Cs,[t.requestType?(o(),i("div",$s,[k[11]||(k[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",Ss,c(t.requestType),1)])):p("",!0),t.source?(o(),i("div",As,[k[12]||(k[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",Ts,c(t.source),1)])):p("",!0),e("div",null,[k[13]||(k[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:O(["font-medium",ye.value?"text-body":"text-sub"])},c(ye.value||"--"),3)]),T.value?(o(),i("div",Ds,[k[14]||(k[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Es,c(T.value),1)])):p("",!0),e("div",null,[k[15]||(k[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",qs,c(ie.value||"Email"),1)]),e("div",null,[k[16]||(k[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:O(["font-medium",pe.value?"text-body":"text-sub"])},c(pe.value||"--"),3)]),e("div",null,[k[17]||(k[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:O(["font-medium",ve.value?"text-body":"text-sub"])},c(ve.value||"--"),3)]),e("div",null,[k[18]||(k[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:O(["font-medium",de.value?"text-body":"text-sub"])},c(de.value||"--"),3)]),e("div",null,[k[19]||(k[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:O(["font-medium",be.value?"text-body":"text-sub"])},c(be.value||"--"),3)]),e("div",null,[k[20]||(k[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:O(["font-medium",_.value?"text-body":"text-sub"])},c(_.value||"--"),3)])])]),s.value?(o(),i("div",Os,[k[30]||(k[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[k[29]||(k[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Is,[D.value?(o(),i("div",Ns,[k[22]||(k[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",js,c(D.value),1)])):p("",!0),B.value!==void 0&&B.value!==null?(o(),i("div",Ms,[k[23]||(k[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",Ls,c(se(B.value))+" Km",1)])):p("",!0),U.value?(o(),i("div",Bs,[k[24]||(k[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Vs,c(U.value),1)])):p("",!0),oe.value?(o(),i("div",Fs,[k[25]||(k[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Us,c(oe.value),1)])):p("",!0),Ae.value?(o(),i("div",Ws,[k[26]||(k[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Ps,c(Ae.value),1)])):p("",!0),T.value?(o(),i("div",Rs,[k[27]||(k[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",zs,c(T.value),1)])):p("",!0)]),Oe.value?(o(),i("div",Qs,[...k[28]||(k[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),I(" View technical specs ")],-1)])])):p("",!0)])])):p("",!0)])):p("",!0)])]))}},Ys={class:"rounded-[12px] flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ks={class:"px-4 py-4 flex items-center justify-between shrink-0"},Gs={class:"flex items-center gap-2"},Js={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},Xs={class:"flex items-center gap-2 flex-wrap mb-3"},Zs={key:0,class:"space-y-3"},_s={class:"flex items-center gap-3"},ea={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},ta=["src"],sa={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},aa={class:"flex-1 min-w-0"},la={class:"font-bold text-heading text-fluid-sm mb-1"},na={class:"flex items-center gap-2 flex-wrap"},oa={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},ia={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},da={key:0,class:"text-right"},ra={class:"font-bold text-heading text-fluid-sm"},ua={class:"mt-3 pt-3 space-y-2"},ca={key:0,class:"flex items-center justify-between text-fluid-xs"},ma={class:"text-heading font-medium"},fa={key:1,class:"flex items-center justify-between text-fluid-xs"},pa={class:"text-heading font-medium"},ba={key:2,class:"pt-2"},ya={class:"bg-surfaceSecondary rounded-lg p-2"},va={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},ga={__name:"RequestCard",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const r=t,n=S(()=>r.task.requestedCar&&r.task.requestedCar.brand&&r.task.requestedCar.model),d=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.brand)||""}),m=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.model)||""}),l=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.year)||""}),b=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.image)||""}),g=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.price)||null}),s=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.stockDays)!==void 0?r.task.requestedCar.stockDays:null}),a=S(()=>{var T;return((T=r.task.requestedCar)==null?void 0:T.requestMessage)||""}),u=S(()=>et(r.task.displayStage||r.task.stage,r.entityType)),h=S(()=>r.task.deliverySubstatus?r.task.deliverySubstatus==="Delivered"?"green":r.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function M(T){return!T||T.length===0?null:T.filter(B=>B.type==="offer").sort((B,U)=>new Date(U.timestamp)-new Date(B.timestamp))[0]||null}function N(T){if(!T)return 0;const D=new Date(T),U=Math.abs(new Date-D);return Math.ceil(U/(1e3*60*60*24))}const y=S(()=>{if((r.task.displayStage||r.task.stage)!=="In Negotiation")return null;const T=M(r.activities);if(!T)return null;const D=N(T.timestamp);return D<1?{label:"New Offer",theme:"orange"}:D<3?{label:"Active",theme:"yellow"}:null}),w=T=>new Intl.NumberFormat("en-US").format(T);return(T,D)=>{var B,U;return o(),i("div",Ys,[e("div",Ks,[D[2]||(D[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Request")],-1)),e("div",Gs,[D[1]||(D[1]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:D[0]||(D[0]=oe=>T.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},c(t.task.assignee),1)])]),e("div",Js,[e("div",Xs,[e("span",{class:O(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:O(["px-2 py-1 rounded text-xs font-medium border",u.value])},c(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(o(),V(v(qe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:h.value},null,8,["text","theme"])):p("",!0),y.value?(o(),V(v(qe),{key:1,text:y.value.label,size:"small",theme:y.value.theme},null,8,["text","theme"])):p("",!0)]),n.value?(o(),i("div",Zs,[e("div",_s,[e("div",ea,[b.value?(o(),i("img",{key:0,src:b.value,alt:"Car",class:"w-full h-full object-cover"},null,8,ta)):(o(),i("i",sa))]),e("div",aa,[e("div",la,c(d.value)+" "+c(m.value)+" ("+c(l.value)+")",1),e("div",na,[s.value!==void 0&&s.value!==null?(o(),i("div",oa,[D[3]||(D[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),I(" In stock ("+c(s.value)+" days) ",1)])):(o(),i("div",ia,[...D[4]||(D[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),I(" Out of stock ",-1)])]))])]),g.value?(o(),i("div",da,[D[5]||(D[5]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",ra,"€ "+c(w(g.value)),1)])):p("",!0)])])):p("",!0),e("div",ua,[t.task.source?(o(),i("div",ca,[D[6]||(D[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",ma,c(t.task.source),1)])):p("",!0),t.task.requestType||(B=t.task.requestedCar)!=null&&B.requestType?(o(),i("div",fa,[D[7]||(D[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",pa,c(t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)),1)])):p("",!0),a.value?(o(),i("div",ba,[D[8]||(D[8]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",ya,[e("p",va,c(a.value),1)])])):p("",!0)])])])}}},xa={class:"rounded-[12px] flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ha={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},ka={class:"flex items-center mb-3"},wa={class:"flex items-center gap-3 flex-1 min-w-0"},Ca=["aria-label"],$a={class:"flex-1 min-w-0"},Sa={class:"flex items-center gap-2"},Aa={class:"text-fluid-sm font-bold uppercase text-brand-dark truncate"},Ta={class:"flex flex-wrap items-center gap-1.5 mt-1"},Da={class:"space-y-3 pt-3"},Ea={class:"flex items-center gap-2"},qa={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},Oa={class:"flex items-center gap-2"},Ia={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},Na={class:"flex items-center gap-2"},ja={class:"text-fluid-sm text-heading font-medium flex-1 min-w-0 truncate"},Ma={__name:"ContactInfoCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:r}){const n=t,d=_e(),m=Fe(),l=async(s,a)=>{try{await navigator.clipboard.writeText(s),d.pushToast("success",`${a==="email"?"Email":"Phone"} copied!`)}catch{d.pushToast("error","Failed to copy")}},b=()=>{n.customerId&&m.push(`/customer/${n.customerId}`)},g=()=>{n.customerId&&m.push(`/customer/${n.customerId}`)};return(s,a)=>{var u,h,M,N;return o(),i("div",xa,[a[11]||(a[11]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-user text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Contact")])],-1)),e("div",ha,[e("div",ka,[e("div",wa,[e("button",{onClick:X(b,["stop"]),class:O(["w-12 h-12 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-user text-lg"},null,-1)])],10,Ca),e("div",$a,[e("div",Sa,[e("h3",Aa,c(((u=t.task.customer)==null?void 0:u.name)||"Unknown"),1),e("button",{onClick:g,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])]),e("div",Ta,[(o(!0),i(R,null,z(t.task.tags,y=>(o(),i("span",{key:y,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},c(y),1))),128)),e("button",{onClick:a[0]||(a[0]=X(y=>s.$emit("add-tag"),["stop"])),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...a[5]||(a[5]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])]),e("div",Da,[e("div",Ea,[a[7]||(a[7]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-sm"})],-1)),e("span",qa,c(((h=t.task.customer)==null?void 0:h.email)||""),1),e("button",{onClick:a[1]||(a[1]=X(y=>{var w;return l(((w=t.task.customer)==null?void 0:w.email)||"","email")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...a[6]||(a[6]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Oa,[a[9]||(a[9]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-sm"})],-1)),e("span",Ia,c(((M=t.task.customer)==null?void 0:M.phone)||""),1),e("button",{onClick:a[2]||(a[2]=X(y=>{var w;return l(((w=t.task.customer)==null?void 0:w.phone)||"","phone")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...a[8]||(a[8]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Na,[a[10]||(a[10]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-map-marker-alt text-sub text-sm"})],-1)),e("span",ja,c(((N=t.task.customer)==null?void 0:N.address)||""),1)])])])])}}},La={key:0,class:"flex-grow border-t border"},Ba={key:0,class:"ml-1.5 text-body"},Va={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Fa={key:1,class:"flex-grow border-t border"},Ua={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:r}){const n=t,d=r,m=q(!1),l={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},b=S(()=>{if(!n.activeTab||n.activeTab==="overview")return n.actions.filter(w=>!l[w]);const y=Object.entries(l).filter(([,w])=>w===n.activeTab).map(([w])=>w);return n.actions.filter(w=>y.includes(w))}),g=S(()=>n.activeTab==="communication"?!0:b.value.length===1),s=S(()=>{if(n.activeTab==="communication")return"add communication";if(!g.value||b.value.length!==1)return"";const y=b.value[0];return{note:"add note",attachment:"add attachment"}[y]||""}),a=S(()=>n.activeTab==="communication"?!0:b.value.length>1),u=S(()=>{const y={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return b.value.map(w=>({key:w,label:y[w]||w,onClick:()=>M(w)}))}),h=S(()=>{if(n.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const y="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return g.value?`${y} px-4 py-2 h-9`:`${y} w-9 h-9`});S(()=>b.value.some(y=>["email","whatsapp","sms"].includes(y))),S(()=>b.value.some(y=>["addVehicle","configureVehicle"].includes(y))),S(()=>b.value.some(y=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(y)));const M=y=>{m.value=!1,d("action",y)},N=()=>{g.value&&b.value.length===1&&n.activeTab!=="communication"?M(b.value[0]):m.value=!m.value};return(y,w)=>{const T=Ue("click-outside");return t.show?(o(),i("div",{key:0,class:O(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?p("",!0):(o(),i("div",La)),e("div",{class:O(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:X(N,["stop"]),class:O(h.value)},[w[0]||(w[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),g.value?(o(),i("span",Ba,c(s.value),1)):p("",!0)],2),m.value&&a.value?j((o(),i("div",Va,[A(v(We),{items:u.value,className:"w-48"},null,8,["items"])])),[[T,()=>m.value=!1]]):p("",!0)],2),t.inline?p("",!0):(o(),i("div",Fa))],2)):p("",!0)}}},Wa={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Pa={class:"flex items-start gap-3"},Ra={class:"flex-1 min-w-0"},za={class:"font-bold text-sm text-heading mb-2"},Qa={class:"space-y-1.5 text-xs text-gray-600"},Ha={class:"flex items-center gap-2"},Ya={class:"flex items-center gap-2"},Ka={class:"flex items-center gap-2"},Ga={key:0,class:"mt-2"},Ja={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const r=t,n=S(()=>r.appointmentData.date?new Date(r.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),d=S(()=>r.appointmentData.time?r.appointmentData.time:""),m=l=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[l==null?void 0:l.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(l,b)=>(o(),i("div",Wa,[e("div",Pa,[b[3]||(b[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Ra,[e("h4",za,c(t.appointmentData.type),1),e("div",Qa,[e("div",Ha,[b[0]||(b[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,c(n.value),1)]),e("div",Ya,[b[1]||(b[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,c(d.value),1)]),e("div",Ka,[b[2]||(b[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,c(t.appointmentData.assignee),1)])]),t.appointmentData.status?(o(),i("div",Ga,[e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",m(t.appointmentData.status)])},c(t.appointmentData.status),3)])):p("",!0)])])]))}},Xa={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Za={class:"flex-1"},_a={class:"flex items-center gap-2 mb-1"},el={class:"text-meta-bold text-heading"},tl={class:"text-meta"},sl={class:"text-meta"},al={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},ll={class:"ml-auto relative"},nl={key:0,class:"absolute right-0 top-full mt-1 z-10"},ol={key:0,class:"text-content text-body"},il={key:1,class:"text-content text-body flex items-center gap-2"},dl={key:2,class:"mt-2"},rl={key:0},ul={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},cl={key:0},ml={class:"text-content font-bold text-heading"},fl={key:0,class:"text-meta mt-0.5"},pl={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},bl={key:0},yl={key:1},vl={key:2},gl={key:3},xl={key:4},hl={key:1},kl={class:"text-content font-bold text-heading mb-2"},wl={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},Cl={key:0},$l={class:"text-body font-medium ml-1"},Sl={key:1},Al={class:"text-body font-medium ml-1"},Tl={key:2},Dl={class:"text-body font-medium ml-1"},El={key:3},ql={class:"text-body font-medium ml-1"},Ol={key:4},Il={class:"text-body font-medium ml-1"},Nl={key:5},jl={class:"text-body font-medium ml-1"},Ml={key:2,class:"flex items-center gap-3"},Ll={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Bl=["src"],Vl={class:"flex-1"},Fl={class:"text-content font-bold text-heading"},Ul={class:"text-meta"},Wl={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Pl={key:3,class:"flex items-center gap-3"},Rl={class:"flex-1"},zl={class:"text-content font-bold text-heading"},Ql={class:"text-meta"},Hl={key:0,class:"text-meta mt-1"},Yl={key:1,class:"text-meta mt-1"},Xe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const n=t,d=r,m=q(!1),l=S(()=>[{key:"edit",label:"Edit",onClick:h},{key:"delete",label:"Delete",onClick:M}]),b=N=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[N]||"fa-solid fa-circle",g=N=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[N]||"bg-surfaceSecondary text-body border",s=N=>{if(!N)return"Just now";const y=new Date(N),T=new Date-y,D=Math.floor(T/6e4),B=Math.floor(D/60),U=Math.floor(B/24);return D<1?"Just now":D<60?`${D} minutes ago`:B<24?`${B} hours ago`:U===1?"Yesterday":U<7?`${U} days ago`:y.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},a=N=>N?new Intl.NumberFormat("en-US").format(N):"0",u=N=>N?new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",h=()=>{m.value=!1,d("edit",n.item)},M=()=>{m.value=!1,confirm("Are you sure you want to delete this item?")&&d("delete",n.item)};return(N,y)=>{const w=Ue("click-outside");return o(),i("div",Xa,[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",g(t.item.type)])},[e("i",{class:O([b(t.item.type),"text-sm"])},null,2)],2),e("div",Za,[e("div",_a,[e("span",el,c(t.customerInitials),1),e("span",tl,c(t.item.action||"added"),1),e("span",sl,"• "+c(s(t.item.timestamp)),1),t.item.autoDetected?(o(),i("span",al,"Auto-detected")):p("",!0),e("div",ll,[e("button",{onClick:y[0]||(y[0]=X(T=>m.value=!m.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...y[1]||(y[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),m.value?j((o(),i("div",nl,[A(v(We),{items:l.value,className:"w-32"},null,8,["items"])])),[[w,()=>m.value=!1]]):p("",!0)])]),t.item.content?(o(),i("div",ol,c(t.item.content),1)):p("",!0),t.item.fileName?(o(),i("div",il,[y[2]||(y[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,c(t.item.fileName),1)])):p("",!0),t.item.data?(o(),i("div",dl,[t.item.type==="appointment"?(o(),i("div",rl,[A(Ja,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(o(),i("div",ul,[t.item.type==="tradein"?(o(),i("div",cl,[e("h4",ml,c(t.item.data.brand)+" "+c(t.item.data.model),1),t.item.data.version?(o(),i("p",fl,c(t.item.data.version),1)):p("",!0),e("div",pl,[t.item.data.year?(o(),i("div",bl,[y[3]||(y[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),I(c(t.item.data.year),1)])):p("",!0),t.item.data.km?(o(),i("div",yl,[y[4]||(y[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),I(c(t.item.data.km)+" km ",1)])):p("",!0),t.item.data.plate?(o(),i("div",vl,[y[5]||(y[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),I(c(t.item.data.plate),1)])):p("",!0),t.item.data.date?(o(),i("div",gl,[y[6]||(y[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),I(c(u(t.item.data.date)),1)])):p("",!0),t.item.data.class?(o(),i("div",xl,[y[7]||(y[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),I(c(t.item.data.class),1)])):p("",!0)])])):t.item.type==="financing"?(o(),i("div",hl,[e("h4",kl,c(t.item.data.product),1),e("div",wl,[t.item.data.provider?(o(),i("div",Cl,[y[8]||(y[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",$l,c(t.item.data.provider),1)])):p("",!0),t.item.data.total?(o(),i("div",Sl,[y[9]||(y[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Al,"€"+c(a(t.item.data.total)),1)])):p("",!0),t.item.data.monthly?(o(),i("div",Tl,[y[10]||(y[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Dl,"€"+c(a(t.item.data.monthly)),1)])):p("",!0),t.item.data.deposit?(o(),i("div",El,[y[11]||(y[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",ql,"€"+c(a(t.item.data.deposit)),1)])):p("",!0),t.item.data.startDate?(o(),i("div",Ol,[y[12]||(y[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Il,c(u(t.item.data.startDate)),1)])):p("",!0),t.item.data.expDate?(o(),i("div",Nl,[y[13]||(y[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",jl,c(u(t.item.data.expDate)),1)])):p("",!0)])])):t.item.type==="offer"?(o(),i("div",Ml,[t.item.data.image?(o(),i("div",Ll,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Bl)])):p("",!0),e("div",Vl,[e("h4",Fl,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Ul,"€ "+c(a(t.item.data.price)),1)]),t.item.data.isMainOffer?(o(),i("span",Wl,"Main Offer")):p("",!0)])):t.item.type==="purchase"?(o(),i("div",Pl,[e("div",Rl,[e("h4",zl,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Ql,"€ "+c(a(t.item.data.price)),1),t.item.data.purchaseDate?(o(),i("p",Hl,"Purchased: "+c(u(t.item.data.purchaseDate)),1)):p("",!0),t.item.data.notes?(o(),i("p",Yl,c(t.item.data.notes),1)):p("",!0)])])):p("",!0)]))])):p("",!0)])])}}},Kl={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Gl={class:"flex items-center gap-3"},Jl=["title"],Xl={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},Zl={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},_l={key:2,class:"font-bold text-fluid-lg text-heading"},en={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},tn={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},sn={key:1,class:"text-center py-8 text-sub relative z-10"},an={class:"text-fluid-sm"},ln={key:2,class:"space-y-6 relative z-10"},nn={key:0,class:"mb-4 pl-12"},on={class:"text-fluid-sm font-semibold text-heading"},dn={class:"flex gap-4 relative mb-6"},rn={class:"flex-1 min-w-0"},un={class:"text-fluid-sm text-slate-700 leading-snug"},cn={class:"font-bold"},mn={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},fn={class:"text-fluid-xs text-sub mt-1"},pn={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},bn={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},yn={key:1,class:"space-y-4 relative z-10"},vn=["title"],gn={key:2,class:"text-center py-8 text-sub relative z-10"},xn={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:r}){const n=t,d=s=>{const a={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return a[s]||a.default},m=s=>{const a={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return a[s]||a.default},l=s=>{if(!s)return"";const a=new Date(s),u=new Date,h=new Date(u);return h.setDate(h.getDate()-1),a.toDateString()===u.toDateString()?"Today":a.toDateString()===h.toDateString()?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},b=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",g=(s,a)=>{if(s===0)return!0;const u=n.activities[s-1];if(!u)return!0;const h=new Date(a.timestamp).toDateString(),M=new Date(u.timestamp).toDateString();return h!==M};return(s,a)=>t.show?(o(),i("div",{key:0,class:O(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Kl,[e("div",Gl,[t.mobileFullscreen?(o(),i("button",{key:0,onClick:a[0]||(a[0]=u=>s.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...a[2]||(a[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(o(),i("button",{key:1,onClick:a[1]||(a[1]=u=>s.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(o(),i("i",Xl)):(o(),i("i",Zl))],8,Jl)):p("",!0),t.collapsed?p("",!0):(o(),i("h2",_l,c(t.title),1))])]),t.collapsed?(o(),i("div",pn,[t.activities.length>0?(o(),i("div",bn)):p("",!0),t.activities.length>0?(o(),i("div",yn,[(o(!0),i(R,null,z(t.activities,u=>(o(),i("div",{key:u.id,class:"relative"},[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",m(u.type)]),title:`${u.user} ${u.action}`},[e("i",{class:O([d(u.type),"text-fluid-xs"])},null,2)],10,vn)]))),128))])):(o(),i("div",gn,[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(o(),i("div",en,[t.activities.length>0?(o(),i("div",tn)):p("",!0),t.activities.length===0?(o(),i("div",sn,[a[3]||(a[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",an,c(t.emptyMessage),1)])):(o(),i("div",ln,[(o(!0),i(R,null,z(t.activities,(u,h)=>(o(),i(R,{key:u.id},[g(h,u)?(o(),i("div",nn,[e("h3",on,c(l(u.timestamp)),1)])):p("",!0),e("div",dn,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",m(u.type)])},[e("i",{class:O([d(u.type),"text-fluid-sm"])},null,2)],2),e("div",rn,[e("div",un,[e("span",cn,c(u.user),1),I(" "+c(u.action),1)]),u.content?(o(),i("div",mn,c(u.content),1)):p("",!0),e("div",fn,c(b(u.timestamp)),1)])])],64))),128))]))]))],2)):p("",!0)}},hn={class:"space-y-3"},kn={class:"flex justify-end gap-2"},wn={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(n.initialTemplate),l=q(""),b=q(n.initialMessage),g={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},s=()=>{m.value&&g[m.value]&&(l.value=g[m.value].subject,b.value=g[m.value].message)},a=()=>{b.value.trim()&&d("send",{type:"email",template:m.value,subject:l.value,message:b.value})};return(u,h)=>(o(),i("div",hn,[e("div",null,[h[5]||(h[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),j(e("select",{"onUpdate:modelValue":h[0]||(h[0]=M=>m.value=M),onChange:s,class:"input"},[...h[4]||(h[4]=[ue('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[fe,m.value]])]),e("div",null,[h[6]||(h[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),j(e("input",{"onUpdate:modelValue":h[1]||(h[1]=M=>l.value=M),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[L,l.value]])]),e("div",null,[h[7]||(h[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),j(e("textarea",{"onUpdate:modelValue":h[2]||(h[2]=M=>b.value=M),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[L,b.value]])]),e("div",kn,[A(v(F),{variant:"outline",size:"small",onClick:h[3]||(h[3]=M=>u.$emit("cancel"))},{default:E(()=>[...h[8]||(h[8]=[I(" Cancel ",-1)])]),_:1}),A(v(F),{variant:"primary",size:"small",onClick:a},{default:E(()=>[...h[9]||(h[9]=[I(" Send Email ",-1)])]),_:1})])]))}},Cn={class:"space-y-3"},$n={class:"text-fluid-xs text-sub mt-1"},Sn={class:"flex justify-end gap-2"},An={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(n.initialTemplate),l=q(n.initialMessage),b={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},g=()=>{m.value&&b[m.value]&&(l.value=b[m.value])},s=()=>{l.value.trim()&&d("send",{type:"sms",template:m.value,message:l.value})};return(a,u)=>(o(),i("div",Cn,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),j(e("select",{"onUpdate:modelValue":u[0]||(u[0]=h=>m.value=h),onChange:g,class:"input"},[...u[3]||(u[3]=[ue('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[fe,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),j(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=h=>l.value=h),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[L,l.value]]),e("p",$n,c(l.value.length)+"/160 characters",1)]),e("div",Sn,[A(v(F),{variant:"outline",size:"small",onClick:u[2]||(u[2]=h=>a.$emit("cancel"))},{default:E(()=>[...u[6]||(u[6]=[I(" Cancel ",-1)])]),_:1}),A(v(F),{variant:"primary",size:"small",onClick:s},{default:E(()=>[...u[7]||(u[7]=[I(" Send SMS ",-1)])]),_:1})])]))}},Tn={class:"space-y-3"},Dn={class:"flex justify-end gap-2"},En={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(n.initialTemplate),l=q(n.initialMessage),b={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},g=()=>{m.value&&b[m.value]&&(l.value=b[m.value])},s=()=>{l.value.trim()&&d("send",{type:"whatsapp",template:m.value,message:l.value})};return(a,u)=>(o(),i("div",Tn,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),j(e("select",{"onUpdate:modelValue":u[0]||(u[0]=h=>m.value=h),onChange:g,class:"input"},[...u[3]||(u[3]=[ue('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[fe,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),j(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=h=>l.value=h),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[L,l.value]])]),e("div",Dn,[A(v(F),{variant:"outline",size:"small",onClick:u[2]||(u[2]=h=>a.$emit("cancel"))},{default:E(()=>[...u[6]||(u[6]=[I(" Cancel ",-1)])]),_:1}),A(v(F),{variant:"primary",size:"small",onClick:s,class:"!bg-green-600 !hover:bg-green-700 !border-green-600"},{default:E(()=>[...u[7]||(u[7]=[e("i",{class:"fa-brands fa-whatsapp mr-2"},null,-1),I(" Send WhatsApp ",-1)])]),_:1})])]))}},qn={class:"space-y-3"},On={class:"flex items-center gap-2"},In=["value"],Nn={class:"space-y-2"},jn={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Mn={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(""),l=()=>{navigator.clipboard.writeText(n.phoneNumber)},b=g=>{d("call",{type:"call",option:g,phoneNumber:n.phoneNumber,notes:m.value})};return(g,s)=>(o(),i("div",qn,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Phone Number",-1)),e("div",On,[e("input",{value:t.phoneNumber,type:"text",class:"input flex-1",readonly:""},null,8,In),e("button",{onClick:l,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-10 h-10 border border-E5E7EB",title:"Copy phone number"},[...s[5]||(s[5]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),j(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>m.value=a),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[L,m.value]])]),e("div",Nn,[s[11]||(s[11]=e("label",{class:"block text-fluid-xs font-medium text-body"},"How would you like to call?",-1)),e("button",{onClick:s[1]||(s[1]=a=>b("outbound")),class:"w-full px-4 py-3 text-left border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors flex items-center gap-3"},[...s[8]||(s[8]=[ue('<div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center"><i class="fa-solid fa-phone text-blue-600"></i></div><div class="flex-1"><p class="font-medium text-fluid-sm text-heading">Call with Outbound</p><p class="text-fluid-xs text-sub">Use external calling system</p></div>',2)])]),e("button",{onClick:s[2]||(s[2]=a=>b("pbx")),class:"w-full px-4 py-3 text-left border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors flex items-center gap-3"},[...s[9]||(s[9]=[ue('<div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center"><i class="fa-solid fa-phone-volume text-purple-600"></i></div><div class="flex-1"><p class="font-medium text-fluid-sm text-heading">Call with PBX</p><p class="text-fluid-xs text-sub">Use internal phone system</p></div>',2)])]),e("button",{onClick:s[3]||(s[3]=a=>b("copy")),class:"w-full px-4 py-3 text-left border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors flex items-center gap-3"},[...s[10]||(s[10]=[ue('<div class="w-10 h-10 rounded-lg bg-gray-50 flex items-center justify-center"><i class="fa-solid fa-copy text-gray-600"></i></div><div class="flex-1"><p class="font-medium text-fluid-sm text-heading">Copy Number</p><p class="text-fluid-xs text-sub">Copy to dial manually</p></div>',2)])])]),e("div",jn,[A(v(F),{variant:"outline",size:"small",onClick:s[4]||(s[4]=a=>g.$emit("cancel"))},{default:E(()=>[...s[12]||(s[12]=[I(" Cancel ",-1)])]),_:1})])]))}},Ln={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Bn={class:"grid grid-cols-4 gap-2 mb-4"},Vn={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},phoneNumber:{type:String,default:""}},emits:["save","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(n.type);ce(()=>n.type,s=>{m.value=s});const l=S(()=>s=>`bg-surface border-2 rounded-lg h-10 flex items-center justify-center gap-2 text-fluid-xs font-medium transition-all ${m.value===s?"border-brand-red bg-red-50 text-brand-red":"border-E5E7EB text-body hover:border-red-300 hover:bg-red-50/50"}`),b=s=>{d("save",{type:"communication",action:`sent via ${s.type}`,content:s.message,communicationType:s.type,template:s.template,subject:s.subject})},g=s=>{switch(s.option){case"outbound":console.log("Initiating outbound call...");break;case"pbx":console.log("Initiating PBX call...");break;case"copy":navigator.clipboard.writeText(s.phoneNumber),console.log("Number copied to clipboard");break}d("save",{type:"communication",action:`called via ${s.option}`,content:s.notes||"Call attempt logged",communicationType:"call",callOption:s.option})};return(s,a)=>(o(),i("div",Ln,[a[12]||(a[12]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Bn,[e("button",{onClick:a[0]||(a[0]=u=>m.value="email"),class:O(l.value("email"))},[...a[8]||(a[8]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])],2),e("button",{onClick:a[1]||(a[1]=u=>m.value="sms"),class:O(l.value("sms"))},[...a[9]||(a[9]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])],2),e("button",{onClick:a[2]||(a[2]=u=>m.value="whatsapp"),class:O(l.value("whatsapp"))},[...a[10]||(a[10]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])],2),e("button",{onClick:a[3]||(a[3]=u=>m.value="call"),class:O(l.value("call"))},[...a[11]||(a[11]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])],2)]),m.value==="email"?(o(),V(wn,{key:0,onSend:b,onCancel:a[4]||(a[4]=u=>s.$emit("cancel"))})):m.value==="sms"?(o(),V(An,{key:1,onSend:b,onCancel:a[5]||(a[5]=u=>s.$emit("cancel"))})):m.value==="whatsapp"?(o(),V(En,{key:2,onSend:b,onCancel:a[6]||(a[6]=u=>s.$emit("cancel"))})):m.value==="call"?(o(),V(Mn,{key:3,"phone-number":t.phoneNumber,onCall:g,onCancel:a[7]||(a[7]=u=>s.$emit("cancel"))},null,8,["phone-number"])):p("",!0)]))}},Fn={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Un={key:1,class:"flex justify-between items-center mb-4"},Wn={class:"text-fluid-sm font-semibold text-heading"},Pn={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Rn={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,l=q("");ge(()=>{d.item&&(l.value=d.item.content||"")});const b=()=>{var g,s;l.value.trim()&&m("save",{id:((g=d.item)==null?void 0:g.id)||Date.now(),type:"note",action:d.item?"updated a note":"added a note",content:l.value,timestamp:((s=d.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,canSubmit:()=>!!l.value.trim()}),(g,s)=>(o(),i("div",{class:O(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?p("",!0):(o(),i("div",Fn)),t.hideHeader?p("",!0):(o(),i("div",Un,[e("h5",Wn,c(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:s[0]||(s[0]=a=>g.$emit("cancel")),class:"text-sub hover:text-body"},[...s[3]||(s[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),j(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>l.value=a),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[L,l.value]])]),t.hideActions?p("",!0):(o(),i("div",Pn,[A(v(F),{variant:"outline",size:"small",onClick:s[2]||(s[2]=a=>g.$emit("cancel"))},{default:E(()=>[...s[5]||(s[5]=[I(" Cancel ",-1)])]),_:1}),A(v(F),{variant:"primary",size:"small",onClick:b},{default:E(()=>[...s[6]||(s[6]=[I(" Save ",-1)])]),_:1})]))],2))}},zn={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Qn={class:"flex justify-between items-center mb-4"},Hn={class:"text-fluid-sm font-semibold text-heading"},Yn={class:"flex items-center gap-3"},Kn={key:0,class:"text-fluid-sm text-slate-600"},Gn={key:1,class:"text-fluid-sm text-sub"},Jn={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Xn={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:r}){const n=t,d=r,m=q(null),l=q("");ge(()=>{n.item&&(l.value=n.item.fileName||"")});const b=s=>{const a=s.target.files[0];a&&(m.value=a,l.value=a.name)},g=()=>{var s,a;!m.value&&!n.item||d("save",{id:((s=n.item)==null?void 0:s.id)||Date.now(),type:"attachment",action:n.item?"updated an attachment":"added an attachment",fileName:l.value,timestamp:((a=n.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return(s,a)=>(o(),i("div",zn,[a[8]||(a[8]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Qn,[e("h5",Hn,c(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:a[0]||(a[0]=u=>s.$emit("cancel")),class:"text-sub hover:text-body"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Yn,[e("input",{type:"file",onChange:b,ref:"fileInput",class:"hidden"},null,544),A(v(F),{variant:"outline",size:"small",onClick:a[1]||(a[1]=u=>s.$refs.fileInput.click()),class:"flex items-center gap-2"},{default:E(()=>[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-paperclip"},null,-1),e("span",null,"Choose File",-1)])]),_:1}),l.value?(o(),i("span",Kn,c(l.value),1)):(o(),i("span",Gn,"No file selected"))])]),e("div",Jn,[A(v(F),{variant:"outline",size:"small",onClick:a[2]||(a[2]=u=>s.$emit("cancel"))},{default:E(()=>[...a[6]||(a[6]=[I(" Cancel ",-1)])]),_:1}),A(v(F),{variant:"primary",size:"small",disabled:!m.value,onClick:g},{default:E(()=>[...a[7]||(a[7]=[I(" Save ",-1)])]),_:1},8,["disabled"])])]))}},Zn={class:"animate-fade-in"},_n={class:"space-y-4"},eo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},to={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},so={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ao=["disabled"],lo={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,l=q({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ge(()=>{d.item&&d.item.data&&(l.value={startDate:d.item.data.startDate||"",expDate:d.item.data.expDate||"",productName:d.item.data.product||d.item.data.productName||"",deposit:d.item.data.deposit||"",loanAmount:d.item.data.total||d.item.data.loanAmount||""})});const b=()=>{var g,s;l.value.productName&&m("save",{id:((g=d.item)==null?void 0:g.id)||Date.now(),type:"financing",action:d.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((s=d.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,isValid:S(()=>!!l.value.productName)}),(g,s)=>(o(),i("div",Zn,[e("div",_n,[e("div",eo,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=a=>l.value.startDate=a),class:"input"},null,512),[[L,l.value.startDate]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=a=>l.value.expDate=a),class:"input"},null,512),[[L,l.value.expDate]])])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>l.value.productName=a),class:"input"},null,512),[[L,l.value.productName]])]),e("div",to,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=a=>l.value.deposit=a),class:"input"},null,512),[[L,l.value.deposit]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>l.value.loanAmount=a),class:"input"},null,512),[[L,l.value.loanAmount]])])])]),t.hideActions?p("",!0):(o(),i("div",so,[e("button",{onClick:s[5]||(s[5]=a=>g.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ao)]))]))}},no={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=q(null),m=S(()=>{var s;return((s=d.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=d.value)==null||s.submit()},b=s=>{s||n("close")},g=s=>{n("save",s),n("close")};return(s,a)=>(o(),V(v(Se),{open:t.show,"onUpdate:open":b},{default:E(()=>[A(v(xe),null,{default:E(()=>[A(v(he),{class:"fixed inset-0 z-50 bg-black/50"}),A(v(ke),{class:"w-full sm:max-w-lg"},{default:E(()=>[A(v(we),null,{default:E(()=>[A(v(Ce),null,{default:E(()=>[...a[2]||(a[2]=[I("Add Financing",-1)])]),_:1}),A(v(Pe),null,{default:E(()=>[...a[3]||(a[3]=[I("Record financing details for this customer",-1)])]),_:1})]),_:1}),A(lo,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:g,onCancel:a[0]||(a[0]=u=>s.$emit("close"))},null,8,["item","task-type","task-id"]),A(v($e),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:E(()=>[A(v(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=u=>s.$emit("close"))}),A(v(F),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},oo={class:"animate-fade-in"},io={class:"space-y-4"},ro={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},co={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},mo=["disabled"],fo={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,l=q({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ge(()=>{d.item&&d.item.data&&(l.value={class:d.item.data.class||"Car",brand:d.item.data.brand||"",model:d.item.data.model||"",version:d.item.data.version||"",km:d.item.data.km||"",plate:d.item.data.plate||"",date:d.item.data.date||""})});const b=()=>{var g,s;l.value.brand&&m("save",{id:((g=d.item)==null?void 0:g.id)||Date.now(),type:"tradein",action:d.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((s=d.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return r({submit:b,isValid:S(()=>!!l.value.brand)}),(g,s)=>(o(),i("div",oo,[e("div",io,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Class",-1)),j(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>l.value.class=a),class:"input"},[...s[8]||(s[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[fe,l.value.class]])]),e("div",ro,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Brand",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>l.value.brand=a),class:"input"},null,512),[[L,l.value.brand]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Model",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>l.value.model=a),class:"input"},null,512),[[L,l.value.model]])])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Version",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=a=>l.value.version=a),class:"input"},null,512),[[L,l.value.version]])]),e("div",uo,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Km",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>l.value.km=a),class:"input"},null,512),[[L,l.value.km]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Plate",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=a=>l.value.plate=a),class:"input"},null,512),[[L,l.value.plate]])])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[6]||(s[6]=a=>l.value.date=a),class:"input"},null,512),[[L,l.value.date]])])]),t.hideActions?p("",!0):(o(),i("div",co,[e("button",{onClick:s[7]||(s[7]=a=>g.$emit("cancel")),class:"text-fluid-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-fluid-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,mo)]))]))}},po={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=q(null),m=S(()=>{var s;return((s=d.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=d.value)==null||s.submit()},b=s=>{s||n("close")},g=s=>{n("save",s),n("close")};return(s,a)=>(o(),V(v(Se),{open:t.show,"onUpdate:open":b},{default:E(()=>[A(v(xe),null,{default:E(()=>[A(v(he),{class:"fixed inset-0 z-50 bg-black/50"}),A(v(ke),{class:"w-full sm:max-w-lg"},{default:E(()=>[A(v(we),null,{default:E(()=>[A(v(Ce),null,{default:E(()=>[...a[2]||(a[2]=[I("Add Trade-In Vehicle",-1)])]),_:1}),A(v(Pe),null,{default:E(()=>[...a[3]||(a[3]=[I("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),A(fo,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:g,onCancel:a[0]||(a[0]=u=>s.$emit("close"))},null,8,["item","task-type","task-id"]),A(v($e),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:E(()=>[A(v(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=u=>s.$emit("close"))}),A(v(F),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},bo={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},yo={key:0,class:"flex justify-between items-center mb-4"},vo={class:"text-sm font-bold text-heading"},go={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},xo={class:"flex items-center gap-3"},ho={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},ko=["src"],wo={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Co={class:"font-bold text-sm text-heading"},$o={class:"text-xs text-sub"},So={class:"space-y-4"},Ao={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},To={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Do=["disabled"],Eo={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:r,emit:n}){const d=t,m=n,l=q({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});ge(()=>{if(d.selectedVehicle){l.value.price=d.selectedVehicle.price||0,l.value.brand=d.selectedVehicle.brand||"",l.value.model=d.selectedVehicle.model||"",l.value.year=d.selectedVehicle.year||"",l.value.image=d.selectedVehicle.image||"";const a=new Date;a.setDate(a.getDate()+30),l.value.validUntil=a.toISOString().split("T")[0]}d.item&&d.item.data&&(l.value={...l.value,...d.item.data,price:d.item.data.price||d.item.data.total||0,financingType:d.item.data.financingType||d.item.data.paymentMethod||"",notes:d.item.data.notes||d.item.data.description||""})}),ce(()=>d.selectedVehicle,a=>{a&&!d.item&&(l.value.price=a.price||0,l.value.brand=a.brand||"",l.value.model=a.model||"",l.value.year=a.year||"",l.value.image=a.image||"")});const b=S(()=>l.value.price>0&&l.value.financingType!==""),g=a=>a?a.toLocaleString("en-US"):"0",s=()=>{var u,h;if(!b.value)return;const a={id:((u=d.item)==null?void 0:u.id)||Date.now(),type:"offer",action:d.item?"updated an offer":"created an offer",data:{brand:l.value.brand,model:l.value.model,year:l.value.year,price:l.value.price,total:l.value.price,paymentMethod:l.value.financingType,financingType:l.value.financingType,downPayment:l.value.downPayment,monthlyPayment:l.value.monthlyPayment,term:l.value.term,interestRate:l.value.interestRate,deliveryDate:l.value.deliveryDate,validUntil:l.value.validUntil,notes:l.value.notes,description:l.value.notes,image:l.value.image},timestamp:((h=d.item)==null?void 0:h.timestamp)||new Date().toISOString(),isEdit:!!d.item};m("save",a)};return r({submit:s,isValid:b,offerData:l}),(a,u)=>(o(),i("div",bo,[t.hideHeader?p("",!0):(o(),i("div",yo,[e("h5",vo,c(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:u[0]||(u[0]=h=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...u[11]||(u[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(o(),i("div",go,[u[12]||(u[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",xo,[e("div",ho,[t.selectedVehicle.image?(o(),i("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,ko)):(o(),i("i",wo))]),e("div",null,[e("h4",Co,c(t.selectedVehicle.brand)+" "+c(t.selectedVehicle.model)+" ("+c(t.selectedVehicle.year)+") ",1),e("p",$o,"Base Price: € "+c(g(t.selectedVehicle.price)),1)])])])):p("",!0),e("div",So,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[I(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=h=>l.value.price=h),class:"input",placeholder:"Enter offer price"},null,512),[[L,l.value.price]])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[I(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":u[2]||(u[2]=h=>l.value.financingType=h),class:"input"},[...u[14]||(u[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[fe,l.value.financingType]])]),l.value.financingType==="finance"||l.value.financingType==="lease"?(o(),i("div",Ao,[e("div",null,[u[16]||(u[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),j(e("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=h=>l.value.downPayment=h),class:"input",placeholder:"0"},null,512),[[L,l.value.downPayment]])]),e("div",null,[u[17]||(u[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),j(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=h=>l.value.monthlyPayment=h),class:"input",placeholder:"Calculated automatically"},null,512),[[L,l.value.monthlyPayment]])]),e("div",null,[u[18]||(u[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),j(e("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=h=>l.value.term=h),class:"input",placeholder:"36"},null,512),[[L,l.value.term]])]),e("div",null,[u[19]||(u[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),j(e("input",{type:"number",step:"0.1","onUpdate:modelValue":u[6]||(u[6]=h=>l.value.interestRate=h),class:"input",placeholder:"3.5"},null,512),[[L,l.value.interestRate]])])])):p("",!0),e("div",null,[u[20]||(u[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),j(e("input",{type:"date","onUpdate:modelValue":u[7]||(u[7]=h=>l.value.deliveryDate=h),class:"input"},null,512),[[L,l.value.deliveryDate]])]),e("div",null,[u[21]||(u[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),j(e("input",{type:"date","onUpdate:modelValue":u[8]||(u[8]=h=>l.value.validUntil=h),class:"input"},null,512),[[L,l.value.validUntil]])]),e("div",null,[u[22]||(u[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),j(e("textarea",{"onUpdate:modelValue":u[9]||(u[9]=h=>l.value.notes=h),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[L,l.value.notes]])])]),t.hideActions?p("",!0):(o(),i("div",To,[e("button",{onClick:u[10]||(u[10]=h=>a.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:s,disabled:!b.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},c(t.item?"Update Offer":"Create Offer"),9,Do)]))]))}},qo={class:"p-6"},Oo={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:r}){const n=r,d=q(null),m=S(()=>{var s;return((s=d.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=d.value)==null||s.submit()},b=s=>{s||n("close")},g=s=>{n("save",s),n("close")};return(s,a)=>(o(),V(v(Se),{open:t.show,"onUpdate:open":b},{default:E(()=>[A(v(xe),null,{default:E(()=>[A(v(he),{class:"fixed inset-0 z-50 bg-black/50"}),A(v(ke),{class:"w-full sm:max-w-2xl p-0"},{default:E(()=>[A(v(we),{class:"p-6 pb-4 border-b border"},{default:E(()=>[A(v(Ce),null,{default:E(()=>[...a[2]||(a[2]=[I("Create Offer",-1)])]),_:1}),A(v(Pe),null,{default:E(()=>[...a[3]||(a[3]=[I("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",qo,[A(Eo,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:d,onSave:g,onCancel:a[0]||(a[0]=u=>s.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),A(v($e),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:E(()=>[A(v(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=u=>s.$emit("close"))}),A(v(F),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:l},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Io={class:"space-y-4"},No={key:0},jo={class:"flex flex-wrap gap-2"},Mo=["onClick"],Lo={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:r}){const n=t,d=r,m=q(""),l=g=>{g||d("close")};ce(()=>n.show,g=>{g&&(m.value="")});const b=()=>{const g=m.value.trim();g&&(n.existingTags.includes(g)||(d("add",g),m.value=""))};return(g,s)=>(o(),V(v(Se),{open:t.show,"onUpdate:open":l},{default:E(()=>[A(v(xe),null,{default:E(()=>[A(v(he),{class:"fixed inset-0 z-50 bg-black/50"}),A(v(ke),{class:"w-full sm:max-w-md"},{default:E(()=>[A(v(we),null,{default:E(()=>[A(v(Ce),null,{default:E(()=>[...s[2]||(s[2]=[I("Add Tag",-1)])]),_:1})]),_:1}),e("div",Io,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),j(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>m.value=a),onKeyup:ct(b,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[L,m.value]])]),t.existingTags.length>0?(o(),i("div",No,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",jo,[(o(!0),i(R,null,z(t.existingTags,a=>(o(),i("button",{key:a,onClick:u=>m.value=a,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},c(a),9,Mo))),128))])])):p("",!0)]),A(v($e),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:E(()=>[A(v(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=a=>g.$emit("close"))}),A(v(F),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value.trim(),onClick:b},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Le={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Bo(t){if(!t)return Le.default;const r=t.toLowerCase().trim();return Le[r]||Le.default}function Vo({store:t,taskId:r,getTabForItemType:n,isOverviewModalAction:d}){const m=q(null),l=q(null),b=q("overview"),g=q("email"),s=q([]);ce(b,()=>{m.value=null,l.value=null});const a=S(()=>[...t.currentActivities.value,...s.value.filter(T=>!T.activityId)].filter(T=>{const D=n(T.type);return b.value==="overview"?D==="overview":D===b.value}).sort((T,D)=>{const B=new Date(T.timestamp||0);return new Date(D.timestamp||0)-B})),u=w=>(l.value=null,b.value==="overview"&&d&&d(w)?{type:"overview-modal",action:w}:(["email","sms","whatsapp","call"].includes(w)?(g.value=w,m.value="communication"):m.value=w,null)),h=async w=>{var T;if(w.isEdit){const D=s.value.findIndex(B=>B.id===w.id);D>-1&&(s.value[D]={...s.value[D],...w}),(T=l.value)!=null&&T.activityId&&await t.updateActivity(r.value,l.value.activityId,{type:w.communicationType||w.type,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data})}else{const D=w.communicationType||w.type,B=await t.addActivity(r.value,{type:D,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data});s.value.push({id:B.id,type:D==="email"||D==="whatsapp"||D==="sms"?"communication":D,action:w.action,content:w.content,fileName:w.fileName,data:w.data,timestamp:B.timestamp,activityId:B.id})}m.value=null,l.value=null},M=()=>{m.value=null,l.value=null},N=w=>{n(w.type)&&(m.value=w.type==="email"||w.type==="whatsapp"||w.type==="sms"||w.type==="communication"?"communication":w.type,l.value=w)},y=async w=>{try{await t.deleteActivity(r.value,w)}catch(T){throw console.error("Error deleting item:",T),T}};return{activeTab:b,showInlineWidget:m,inlineWidgetType:S(()=>m.value),editingItem:l,isEditing:S(()=>l.value!==null),communicationType:g,inlineContent:s,filteredInlineContent:a,handleAddNewAction:u,handleWidgetSave:h,handleWidgetCancel:M,handleEditItem:N,handleDeleteItem:y}}const Fo={class:"flex-1 flex flex-col overflow-hidden h-full"},Uo={class:"bg-surface border-b border-black/5 shrink-0"},Wo={key:0,class:"px-4 md:px-8 py-3 md:py-4"},Po={key:0,class:"flex-1 flex flex-row overflow-hidden"},Ro={class:"flex-1 flex flex-col overflow-hidden min-w-0"},zo={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Qo={class:"mb-4"},Ho={key:0},Yo={key:0},Ko={key:1,class:"mb-6"},Go={key:2,class:"space-y-4 mb-6 px-1"},Jo={key:1},Xo={key:0,class:"space-y-4 mb-6 px-1"},Zo={key:1,class:"flex-1 flex flex-row overflow-hidden"},_o={class:"flex-1 flex flex-col overflow-hidden min-w-0"},ei={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},ti={key:0,class:"space-y-6"},si={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ai={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},li={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},ni={class:"relative"},oi={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},ii={key:1,class:"text-center py-6 text-sub"},di={key:2,class:"space-y-6 max-h-96 overflow-y-auto pr-2"},ri={class:"flex-1 min-w-0"},ui={class:"text-fluid-sm text-slate-700 leading-snug"},ci={class:"font-bold"},mi={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},fi={class:"text-fluid-xs text-sub mt-1"},pi={key:1,class:"space-y-6"},bi={key:0},yi={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},vi={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},gi={class:"grid grid-cols-4 gap-2 mb-4"},xi={key:0,class:"space-y-3"},hi={key:0,class:"space-y-2"},ki={key:1,class:"mt-6 pt-6 border-t border"},wi={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ci={class:"flex items-center gap-2 mb-1"},$i={class:"text-fluid-xs font-semibold text-heading"},Si={class:"text-fluid-xs text-sub"},Ai={class:"text-fluid-sm text-body"},Ti={key:2,class:"space-y-6"},Di={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ei={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},qi={class:"space-y-2 max-h-[300px] overflow-y-auto"},Oi={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Ii={class:"text-fluid-xs text-sub mb-1"},Ni={class:"text-fluid-sm text-body"},ji={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Mi={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Li={class:"space-y-2 max-h-[300px] overflow-y-auto"},Bi={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Vi={class:"flex-1 min-w-0"},Fi={class:"text-fluid-sm font-medium text-heading truncate"},Ui={class:"text-fluid-xs text-sub"},Wi={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Pi={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ri={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},zi={class:"space-y-2 max-h-[300px] overflow-y-auto"},Qi={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Hi={class:"flex items-center justify-between mb-1"},Yi={class:"text-fluid-xs text-sub"},Ki={key:0,class:"text-fluid-sm font-medium text-heading"},Gi={key:0},Ji={key:1,class:"grid grid-cols-2 gap-2 mt-2 text-fluid-xs text-body"},Xi={key:0},Zi={key:1},_i={key:2,class:"text-fluid-sm text-body mt-2"},ed={class:"rounded-[12px] flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},td={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},sd={class:"space-y-2 max-h-[300px] overflow-y-auto"},ad={key:0,class:"text-center py-6 text-sub text-fluid-sm"},ld={class:"flex items-center justify-between mb-1"},nd={class:"text-fluid-xs text-sub"},od={key:0,class:"text-fluid-sm font-medium text-heading"},id={key:0},dd={key:1,class:"text-fluid-sm text-body mt-1"},rd={key:2,class:"text-fluid-sm text-body mt-2"},pd={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(t,{emit:r}){const n=t,d=mt(),m=Fe(),l=S(()=>n.task.id),b=S(()=>d.path.startsWith("/tasks")&&!d.path.startsWith("/customer")),g=q("request"),s=[{key:"request",label:"Request"},{key:"manage",label:"Manage"},{key:"data",label:"Data"}],a=q(null),u=q(""),h=q(""),M=S(()=>n.task.activities?n.task.activities.filter($=>$.type==="note"):[]),N=S(()=>n.task.activities?n.task.activities.filter($=>["email","call","sms","whatsapp"].includes($.type)):[]),y=S(()=>n.task.activities?n.task.activities.filter($=>$.type==="attachment"):[]),w=S(()=>n.task.activities?n.task.activities.filter($=>$.type==="purchase"):[]),T=S(()=>n.task.activities?n.task.activities.filter($=>$.type==="tradein"):[]),D=()=>{Q.value="purchase",G.value=!0},B=()=>{Q.value="tradein",G.value=!0},U=$=>{if(!$)return"";const f=new Date($),W=new Date-f,Y=Math.floor(W/6e4),J=Math.floor(W/36e5),ee=Math.floor(W/864e5);return Y<1?"Just now":Y<60?`${Y}m ago`:J<24?`${J}h ago`:ee<7?`${ee}d ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},oe=$=>$?new Intl.NumberFormat("en-US").format($):"0",Ae=$=>$?new Intl.NumberFormat("en-US").format($):"0",ie=$=>{a.value=a.value===$?null:$,u.value="",h.value=""},pe=async()=>{if(!a.value)return;let $=a.value;if($==="call"){await n.storeAdapter.addActivity(n.task.id,{type:"call",content:"Call logged",timestamp:new Date().toISOString()}),a.value=null;return}if(["whatsapp","sms","email"].includes($)){if(!h.value)return;const f=$==="whatsapp"?"whatsapp":$==="sms"?"sms":"email";await n.storeAdapter.addActivity(n.task.id,{type:f,content:`Template: ${h.value}`,timestamp:new Date().toISOString()}),a.value=null,h.value=""}},be=S(()=>n.type==="contact"?"bg-blue-100 text-blue-600":n.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),_=q(d.path.startsWith("/tasks")&&!d.path.startsWith("/customer"));ce(()=>d.path,$=>{_.value=$.startsWith("/tasks")&&!$.startsWith("/customer")});const ye=()=>{m.push({path:`/customer/${n.task.id}`,query:{type:n.type}})};function ve($){se.value=!1}const de=()=>{C.value=!0},Oe=async $=>{var H,W,Y,J;const f=$.name;n.type==="lead"?await((W=(H=n.storeAdapter).updateLead)==null?void 0:W.call(H,n.task.id,{assignee:f,assigneeType:$.type,teamId:$.type==="team"?$.id:null})):n.type==="opportunity"&&await((J=(Y=n.storeAdapter).updateOpportunity)==null?void 0:J.call(Y,n.task.id,{assignee:f,assigneeType:$.type,teamId:$.type==="team"?$.id:null})),C.value=!1},G=q(!1),Q=q(null),se=q(!1),C=q(!1),k=q(!1),{activeTab:P,showInlineWidget:ae,editingItem:Ie,communicationType:st,inlineContent:at,filteredInlineContent:Te,handleAddNewAction:lt,handleWidgetSave:De,handleWidgetCancel:Ne,handleEditItem:ze,handleDeleteItem:Qe}=Vo({store:n.storeAdapter,taskId:l,getTabForItemType:Bo,isOverviewModalAction:$=>P.value==="overview"&&n.addNewConfig.overviewActions.includes($)});ce(()=>n.task.id,()=>{P.value="overview"});const je=$=>{const f=lt($);f&&f.modalAction&&(Q.value=f.modalAction,G.value=!0)},He=$=>{if($==="appointment"){se.value=!0;return}const f={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes($))Q.value=$,G.value=!0;else{const H=f[$];H?(P.value=H,setTimeout(()=>{je($),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):je($)}},Ee=()=>{G.value=!1,Q.value=null},Me=async $=>{await De($),Ee()},nt=S(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Data"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),re=S(()=>[...n.storeAdapter.currentActivities.value,...at.value]);S(()=>Q.value==="financing"?"Add Financing":Q.value==="tradein"?"Add Trade-in":Q.value==="purchase"?"Create Purchase Offer":"");const Ye=async $=>{if(n.type==="opportunity")try{await n.storeAdapter.addVehicle(n.task.id,$.vehicleData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(f){console.error("Error selecting vehicle:",f)}},Ke=async $=>{if(n.type==="opportunity")try{await n.storeAdapter.createOffer(n.task.id,$.offerData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(f){console.error("Error creating offer:",f)}},ot=async $=>{var W,Y,J,ee;const f=n.task.tags||[];if(f.includes($)){k.value=!1;return}const H=[...f,$];try{n.type==="lead"?await((Y=(W=n.storeAdapter).updateLead)==null?void 0:Y.call(W,n.task.id,{tags:H})):n.type==="opportunity"&&await((ee=(J=n.storeAdapter).updateOpportunity)==null?void 0:ee.call(J,n.task.id,{tags:H})),n.type==="lead"&&n.storeAdapter.loadLeadById?await n.storeAdapter.loadLeadById(n.task.id):n.type==="opportunity"&&n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id),k.value=!1}catch(x){console.error("Error adding tag:",x)}},it=$=>{const f={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return f[$]||f.default},dt=$=>{const f={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return f[$]||f.default},rt=$=>$?new Date($).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return($,f)=>{var H,W,Y,J,ee;return o(),i("div",Fo,[e("header",Uo,[b.value?p("",!0):(o(),i("div",Wo,[A(Ft,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":be.value,"task-type":t.type,"customer-id":((H=t.task.customer)==null?void 0:H.id)||t.task.customerId||t.task.id,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:He,onAddTag:f[0]||(f[0]=x=>k.value=!0)},{tags:E(()=>[(o(!0),i(R,null,z(t.task.tags,x=>(o(),i("span",{key:x,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},c(x),1))),128))]),"name-action":E(()=>[b.value?(o(),i("button",{key:0,onClick:ye,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...f[19]||(f[19]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):p("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id"])]))]),b.value?b.value?(o(),i("div",Zo,[e("div",_o,[e("div",ei,[A(Je,{modelValue:g.value,"onUpdate:modelValue":f[6]||(f[6]=x=>g.value=x),tabs:s,class:"mb-6"},null,8,["modelValue"]),g.value==="request"?(o(),i("div",ti,[e("div",si,[t.type!=="contact"?(o(),V(ga,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:de},null,8,["task","entity-type","activities"])):p("",!0),A(Ma,{task:t.task,"task-type":t.type,"customer-id":((ee=t.task.customer)==null?void 0:ee.id)||t.task.customerId||t.task.id,onAction:He,onAddTag:f[7]||(f[7]=x=>k.value=!0)},null,8,["task","task-type","customer-id"])]),e("div",ai,[f[21]||(f[21]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",li,[e("div",ni,[re.value.length>0?(o(),i("div",oi)):p("",!0),re.value.length===0?(o(),i("div",ii,[...f[20]||(f[20]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(o(),i("div",di,[(o(!0),i(R,null,z(re.value,x=>(o(),i("div",{key:x.id,class:"flex gap-4 relative"},[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",dt(x.type)])},[e("i",{class:O([it(x.type),"text-fluid-sm"])},null,2)],2),e("div",ri,[e("div",ui,[e("span",ci,c(x.user),1),I(" "+c(x.action),1)]),x.content?(o(),i("div",mi,c(x.content),1)):p("",!0),e("div",fi,c(rt(x.timestamp)),1)])]))),128))]))])])])])):p("",!0),g.value==="manage"?(o(),i("div",pi,[t.managementWidget?(o(),i("div",bi,[(o(),V(Ge(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:re.value,onCarAdded:f[8]||(f[8]=x=>$.$emit("car-added",x)),onConvertToLead:f[9]||(f[9]=x=>$.$emit("convert-to-lead")),onConvertToOpportunity:f[10]||(f[10]=x=>$.$emit("convert-to-opportunity")),onVehicleSelected:Ye,onCreateOffer:Ke},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),e("div",yi,[f[28]||(f[28]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-comments text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Communicate")])],-1)),e("div",vi,[e("div",null,[e("div",gi,[e("button",{onClick:f[11]||(f[11]=x=>ie("call")),class:O(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="call"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[22]||(f[22]=[e("i",{class:"fa-solid fa-phone text-sm"},null,-1),e("span",{class:"text-fluid-xs"},"Call",-1)])],2),e("button",{onClick:f[12]||(f[12]=x=>ie("whatsapp")),class:O(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="whatsapp"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[23]||(f[23]=[e("i",{class:"fa-brands fa-whatsapp text-sm"},null,-1),e("span",{class:"text-fluid-xs"},"WhatsApp",-1)])],2),e("button",{onClick:f[13]||(f[13]=x=>ie("sms")),class:O(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="sms"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[24]||(f[24]=[e("i",{class:"fa-solid fa-message text-sm"},null,-1),e("span",{class:"text-fluid-xs"},"SMS",-1)])],2),e("button",{onClick:f[14]||(f[14]=x=>ie("email")),class:O(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="email"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[25]||(f[25]=[e("i",{class:"fa-solid fa-envelope text-sm"},null,-1),e("span",{class:"text-fluid-xs"},"Email",-1)])],2)]),a.value?(o(),i("div",xi,[["whatsapp","sms","email"].includes(a.value)?(o(),i("div",hi,[f[27]||(f[27]=e("label",{class:"block text-fluid-xs font-medium text-body"},"Select Template",-1)),j(e("select",{"onUpdate:modelValue":f[15]||(f[15]=x=>h.value=x),class:"w-full bg-surface border border-E5E7EB rounded-lg px-3 py-2 text-fluid-sm text-body focus:outline-none focus:border-brand-red"},[...f[26]||(f[26]=[e("option",{value:""},"Select a template...",-1),e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[fe,h.value]]),e("button",{onClick:pe,class:"px-4 py-2 text-fluid-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors"}," Send "+c(a.value==="whatsapp"?"WhatsApp":a.value==="sms"?"SMS":"Email"),1)])):p("",!0)])):p("",!0),N.value.length>0?(o(),i("div",ki,[e("div",wi,[(o(!0),i(R,null,z(N.value,x=>(o(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Ci,[e("span",$i,c(x.type),1),e("span",Si,c(U(x.timestamp)),1)]),e("p",Ai,c(x.content),1)]))),128))])])):p("",!0)])])])])):p("",!0),g.value==="data"?(o(),i("div",Ti,[e("div",Di,[f[30]||(f[30]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-note-sticky text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Notes")])],-1)),e("div",Ei,[e("div",qi,[M.value.length===0?(o(),i("div",Oi,[...f[29]||(f[29]=[e("i",{class:"fa-solid fa-note-sticky text-2xl mb-2"},null,-1),e("p",null,"No notes yet",-1)])])):p("",!0),(o(!0),i(R,null,z(M.value,x=>(o(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Ii,c(U(x.timestamp)),1),e("p",Ni,c(x.content),1)]))),128))])])]),e("div",ji,[f[33]||(f[33]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-paperclip text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Attachments")])],-1)),e("div",Mi,[e("div",Li,[y.value.length===0?(o(),i("div",Bi,[...f[31]||(f[31]=[e("i",{class:"fa-solid fa-paperclip text-2xl mb-2"},null,-1),e("p",null,"No attachments yet",-1)])])):p("",!0),(o(!0),i(R,null,z(y.value,x=>(o(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg flex items-center gap-3"},[f[32]||(f[32]=e("i",{class:"fa-solid fa-file text-sub text-lg"},null,-1)),e("div",Vi,[e("div",Fi,c(x.filename),1),e("div",Ui,c(U(x.timestamp)),1)])]))),128))])])]),e("div",Wi,[e("div",Pi,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[f[35]||(f[35]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Trade-in")],-1)),e("button",{onClick:B,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...f[34]||(f[34]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",Ri,[e("div",zi,[T.value.length===0?(o(),i("div",Qi,[...f[36]||(f[36]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-2xl mb-2"},null,-1),e("p",null,"No trade-ins yet",-1)])])):p("",!0),(o(!0),i(R,null,z(T.value,x=>(o(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Hi,[e("div",Yi,c(U(x.timestamp)),1)]),x.data&&x.data.brand?(o(),i("div",Ki,[I(c(x.data.brand)+" "+c(x.data.model)+" ",1),x.data.version?(o(),i("span",Gi,c(x.data.version),1)):p("",!0)])):p("",!0),x.data&&(x.data.kilometers||x.data.price)?(o(),i("div",Ji,[x.data.kilometers?(o(),i("div",Xi,[f[37]||(f[37]=e("span",{class:"text-sub"},"KM:",-1)),I(" "+c(Ae(x.data.kilometers)),1)])):p("",!0),x.data.price?(o(),i("div",Zi,[f[38]||(f[38]=e("span",{class:"text-sub"},"Price:",-1)),I(" € "+c(oe(x.data.price)),1)])):p("",!0)])):p("",!0),x.content?(o(),i("div",_i,c(x.content),1)):p("",!0)]))),128))])])]),e("div",ed,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[f[40]||(f[40]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-shopping-cart text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Purchase")],-1)),e("button",{onClick:D,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...f[39]||(f[39]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",td,[e("div",sd,[w.value.length===0?(o(),i("div",ad,[...f[41]||(f[41]=[e("i",{class:"fa-solid fa-shopping-cart text-2xl mb-2"},null,-1),e("p",null,"No purchases yet",-1)])])):p("",!0),(o(!0),i(R,null,z(w.value,x=>(o(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",ld,[e("div",nd,c(U(x.timestamp)),1)]),x.data&&x.data.brand?(o(),i("div",od,[I(c(x.data.brand)+" "+c(x.data.model)+" ",1),x.data.year?(o(),i("span",id,"("+c(x.data.year)+")",1)):p("",!0)])):p("",!0),x.data&&x.data.price?(o(),i("div",dd," € "+c(oe(x.data.price)),1)):p("",!0),x.content?(o(),i("div",rd,c(x.content),1)):p("",!0)]))),128))])])])])])):p("",!0)])])])):p("",!0):(o(),i("div",Po,[e("div",Ro,[e("main",zo,[e("div",Qo,[A(Je,{modelValue:v(P),"onUpdate:modelValue":f[1]||(f[1]=x=>ft(P)?P.value=x:null),tabs:nt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),v(P)==="overview"?(o(),i("div",Ho,[t.type!=="contact"?(o(),i("div",Yo,[A(Hs,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((Y=t.task.requestedCar)==null?void 0:Y.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:de},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):p("",!0),Ve($.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(o(),i("div",Ko,[(o(),V(Ge(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:re.value,onCarAdded:f[2]||(f[2]=x=>$.$emit("car-added",x)),onConvertToLead:f[3]||(f[3]=x=>$.$emit("convert-to-lead")),onConvertToOpportunity:f[4]||(f[4]=x=>$.$emit("convert-to-opportunity")),onVehicleSelected:Ye,onCreateOffer:Ke},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),v(Te).length>0?(o(),i("div",Go,[(o(!0),i(R,null,z(v(Te),x=>(o(),V(Xe,{key:x.id,item:x,"task-type":t.type,"customer-initials":"SK",onEdit:v(ze),onDelete:v(Qe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)])):(o(),i("div",Jo,[A(Ua,{actions:t.addNewConfig.tabActions,"active-tab":v(P),onAction:je},null,8,["actions","active-tab"]),e("div",null,[v(ae)==="communication"?(o(),V(Vn,{key:0,type:v(st),"task-type":t.type,"task-id":t.task.id,"phone-number":((J=t.task.customer)==null?void 0:J.phone)||"",item:v(Ie),onSave:v(De),onCancel:v(Ne)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):p("",!0),v(P)==="data"&&v(ae)==="note"?(o(),V(Rn,{key:1,item:v(Ie),"task-type":t.type,"task-id":t.task.id,onSave:v(De),onCancel:v(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0),v(ae)==="attachment"?(o(),V(Xn,{key:2,item:v(Ie),"task-type":t.type,"task-id":t.task.id,onSave:v(De),onCancel:v(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0)]),v(Te).length>0?(o(),i("div",Xo,[(o(!0),i(R,null,z(v(Te),x=>(o(),V(Xe,{key:x.id,item:x,"task-type":t.type,"customer-initials":"SK",onEdit:v(ze),onDelete:v(Qe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)]))])]),A(xn,{title:"Activity summary",activities:re.value,collapsed:_.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:f[5]||(f[5]=x=>_.value=!_.value)},null,8,["activities","collapsed"])])),A(no,{show:Q.value==="financing"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Me,onClose:Ee},null,8,["show","task-type","task-id"]),A(po,{show:Q.value==="tradein"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Me,onClose:Ee},null,8,["show","task-type","task-id"]),A(Oo,{show:Q.value==="purchase"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:Me,onClose:Ee},null,8,["show","task-type","task-id","requested-car"]),A(pt,{show:C.value,onClose:f[16]||(f[16]=x=>C.value=!1),onConfirm:Oe},null,8,["show"]),se.value?(o(),V(bt,{key:2,show:se.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:ve,onCancel:f[17]||(f[17]=x=>se.value=!1)},null,8,["show","customer","assignee"])):p("",!0),A(Lo,{show:k.value,"existing-tags":t.task.tags||[],onClose:f[18]||(f[18]=x=>k.value=!1),onAdd:ot},null,8,["show","existing-tags"])])}}},Z={[K.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[K.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[K.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[K.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[K.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[K.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Ze={toClosed:(t,r,n)=>{const d={isDisqualified:!0,disqualifyReason:(n==null?void 0:n.reason)||null,disqualifyCategory:(n==null?void 0:n.category)||null,scheduledAppointment:null,nextActionDue:null};(n==null?void 0:n.reason)==="Duplicate"?(d.isDuplicate=!0,d.stage="Closed Failed"):(n==null?void 0:n.category)==="Not Interested"?d.stage="Not Interested":d.stage="Not Valid",d.status="Disqualified";const m=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(n==null?void 0:n.category)||"Unknown"}, Reason: ${(n==null?void 0:n.reason)||"Unknown"}`}];return t.scheduledAppointment&&m.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:d,activities:m}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function bd(t,r){return r.startsWith("Closed")?Ze.toClosed:t.startsWith("Closed")&&!r.startsWith("Closed")?Ze.reopen:null}function yd(t){var l,b,g;const r=t.lead;if(!r)return null;const n=ne(r,"lead");if(!n)return((l=Z[K.NEW])==null?void 0:l.primaryAction)||null;const d=Z[n];if(!d)return((b=Z[K.NEW])==null?void 0:b.primaryAction)||null;if(!d.primaryAction)return((g=Z[K.NEW])==null?void 0:g.primaryAction)||null;const m=d.primaryAction;return typeof m=="function"?m({lead:r,displayStage:n}):m}function vd(t){const r=t.lead;if(!r)return[];const n=ne(r,"lead"),d=Z[n];return d?d.secondaryActions||[]:[]}function tt(t){const r=t.lead;if(!r||!(r.isDisqualified===!0))return!1;const d=ne(r,"lead");return d===K.CLOSED_INVALID||d===K.CLOSED_NOT_INTERESTED||d===K.CLOSED_DUPLICATE}function gd(t){const r=t.lead;if(!r||tt(t))return!1;const n=ne(r,"lead"),d=Z[n];return d?typeof d.showLQWidget=="function"?d.showLQWidget(r):d.showLQWidget??!1:!1}function xd(t){const r=t.lead;if(!r||tt(t))return!1;const n=ne(r,"lead"),d=Z[n];return d?d.showDeadlineBanner&&r.nextActionDue:!1}function hd(t){const r=t.lead;if(!r)return!1;const n=ne(r,"lead"),d=Z[n];return d?d.canPostpone??!1:!1}function kd(t){const r=t.lead;if(!r)return"qualification";const n=ne(r,"lead"),d=Z[n];return d&&d.lqWidgetMode||"qualification"}const Re={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const r=t.deliverySubstatus;return r==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:r==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Be={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function le(t){if(!t)return 0;const r=new Date(t),d=Math.abs(new Date-r);return Math.ceil(d/(1e3*60*60*24))}const me={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const r=te(),n=r.getSetting("oofbMinDays"),d=r.getSetting("oofbMaxDays"),m=le(t.opportunity.createdAt);return m>=n&&m<d+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const n=te().getSetting("ufbDays");return le(t.opportunity.createdAt)>=n&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=te().getSetting("ofbDays");return le(t.opportunity.lastActivity||t.opportunity.createdAt)>=n&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=te().getSetting("nfuDays"),d=le(t.opportunity.lastActivity||t.opportunity.createdAt),m=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return d>=n&&!t.opportunity.contractDate&&!m&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var l;if(!t.opportunity.contractDate)return!1;const n=te().getSetting("cfbDays"),d=le(t.opportunity.contractDate),m=(l=t.activities)==null?void 0:l.some(b=>{var g;return b.type==="delivery"||((g=b.action)==null?void 0:g.toLowerCase().includes("delivered"))});return d>=n&&!m},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var l;const r=(l=t.activities)==null?void 0:l.find(b=>{var g;return b.type==="delivery"||((g=b.action)==null?void 0:g.toLowerCase().includes("delivered"))});if(!r)return!1;const d=te().getSetting("dfbDays");return le(r.timestamp)>=d},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const r=t.stage;return r==="Closed Won"||r==="Closed Lost"},"is-closed-with-task-widget":t=>me["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(me["is-closed"](t))return!1;const r=te(),n=r.getSetting("abandonedOpportunityDays");if(!r.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const m=t.opportunity.lastActivity||t.opportunity.createdAt;return le(m)>=n}};function wd(t,r){if(me["is-closed-with-task-widget"](r))return[Be.reopen,Be.requalify,Be.closeLost];const n=Re[t];return!n||!n.secondaryActions?[]:n.secondaryActions.filter(d=>{if(!d.conditional)return!0;const m=me[d.conditional];return m?m(r):!0})}function Cd(t,r){const n=Re[t];if(!n||!n.taskWidgets)return null;const m=te().getSetting("autoCloseWidgetsOnClose"),l=me["is-closed"]({stage:t});for(const b of n.taskWidgets){if(m&&l&&(b.type==="NFU"||b.type==="OFB"))continue;const g=me[b.condition];if(g&&g(r))return b.type}return null}function $d(t,r){const n=Re[t];if(!n||!n.primaryAction)return null;const d=n.primaryAction;return{...d,title:typeof d.title=="function"?d.title(r):d.title,description:typeof d.description=="function"?d.description(r):d.description,label:typeof d.label=="function"?d.label(r):d.label}}function Sd(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function Ad(t){return t==="Closed Won"||t==="Closed Lost"}const Td={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:r}){const n=r,d=l=>{l||n("close")},m=()=>{n("close")};return(l,b)=>(o(),V(v(Se),{open:t.show,"onUpdate:open":d},{default:E(()=>[A(v(xe),null,{default:E(()=>[A(v(he),{class:"fixed inset-0 z-50 bg-black/50"}),A(v(ke),{class:"w-full sm:max-w-md"},{default:E(()=>[A(v(we),null,{default:E(()=>[A(v(Ce),null,{default:E(()=>[I(c(t.title),1)]),_:1})]),_:1}),b[0]||(b[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),A(v($e),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:E(()=>[A(v(F),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{pd as _,vd as a,xd as b,hd as c,kd as d,bd as e,wn as f,yd as g,An as h,tt as i,En as j,Rn as k,Cd as l,$d as m,wd as n,Ad as o,Sd as p,Eo as q,Td as r,gd as s};
