import{y as j}from"./components-BwvyhyyO.js";import{n as N}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-Oem9_7mP.js";import{I as K,C as W,r as i,c as H,m as J,d as O,o as T,e as o,s as d,B as r,g as P,y as a,t as X,k as U,G as Y}from"./index-BcuDIK-O.js";import{g as Z,c as ee,f as te}from"./OfferCarousel-CZ6ElooH.js";import{u as se}from"./useCustomersTable-7cFK38Jb.js";import{u as oe}from"./useTableRowSelection-BnCoVVaq.js";import"./opportunities-Bp4brFAh.js";import"./sparkles-DCtJyGxr.js";import"./vehicles-C-_b7mCD.js";const ae={class:"mb-8"},ie={class:"bg-white"},ne={key:0,class:"flex items-center gap-2"},re={class:"flex items-center gap-2 mr-1"},le={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},ue={__name:"OpenLeadsTab",emits:["row-click"],setup(de,{emit:I}){const n=W(),L=i(!1),{rowSelection:l,selectedCount:B,hasSelection:R,getSelectedRows:_,clearSelection:c}=oe(t=>t.id),m=i({pageIndex:0,pageSize:10}),p=i(""),f=i([]),g=i([]),x=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",M=t=>({Valid:"bg-green-100 text-green-700","Not valid":"bg-red-100 text-red-700",Qualified:"bg-muted text-muted-foreground","Not interested":"bg-red-100 text-red-700",Open:"bg-blue-100 text-blue-700"})[t]||"bg-muted text-muted-foreground",u=H(()=>{let t=n.leads;return L.value?t=n.leads.filter(e=>e.isDisqualified===!0):t=n.leads.filter(e=>!e.isDisqualified),t.map(e=>{var s,v,y,w,C,D,k,S,F,q,A,h;return{id:`lead-${e.id}`,stageKey:"open-leads",customer:((s=e.customer)==null?void 0:s.name)||"Unknown",email:((v=e.customer)==null?void 0:v.email)||"",initials:((y=e.customer)==null?void 0:y.initials)||((C=(w=e.customer)==null?void 0:w.name)==null?void 0:C.slice(0,2).toUpperCase())||"?",nextAction:te(e.nextActionDue)||"No due date",nextActionFull:ee(e.nextActionDue),deadlineStatus:Z(e.nextActionDue),car:`${((D=e.requestedCar)==null?void 0:D.brand)||""} ${((k=e.requestedCar)==null?void 0:k.model)||""}`.trim()||"N/A",carStatus:((S=e.requestedCar)==null?void 0:S.stockDays)!==void 0&&((F=e.requestedCar)==null?void 0:F.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((q=e.requestedCar)==null?void 0:q.stockDays)!==void 0&&((A=e.requestedCar)==null?void 0:A.stockDays)!==null?"bg-green-100 text-green-700":"bg-muted text-muted-foreground",requestType:((h=e.requestedCar)==null?void 0:h.requestType)||"Quotation",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:x(e.createdAt),lastActivity:x(e.lastActivity),status:e.status,statusClass:M(e.status),priority:e.priority||"Normal"}})}),V=I,b=t=>{t.id.startsWith("lead-")&&V("row-click",t)},$=i("open-leads"),{columns:z,filterDefinitions:E,tableMeta:G}=se($,b),Q=()=>{const t=_(u.value);t.length!==0&&confirm(`Are you sure you want to delete ${t.length} ${t.length===1?"lead":"leads"}?`)&&(t.forEach(e=>{const s=e.id.replace("lead-","");n.deleteLead(s)}),c())};return J(async()=>{await n.fetchLeads()}),(t,e)=>(T(),O("div",ae,[o("div",ie,[d(a(j),{data:u.value,columns:a(z),meta:a(G),onRowClick:b,columnFiltersOptions:{filterDefs:a(E)},pagination:m.value,"onUpdate:pagination":e[0]||(e[0]=s=>m.value=s),globalFilter:p.value,"onUpdate:globalFilter":e[1]||(e[1]=s=>p.value=s),sorting:f.value,"onUpdate:sorting":e[2]||(e[2]=s=>f.value=s),columnFilters:g.value,"onUpdate:columnFilters":e[3]||(e[3]=s=>g.value=s),rowSelection:a(l),"onUpdate:rowSelection":e[4]||(e[4]=s=>Y(l)?l.value=s:null),paginationOptions:{rowCount:u.value.length},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":r(()=>[...e[5]||(e[5]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":r(()=>[a(R)?(T(),O("div",ne,[o("div",re,[o("div",le,X(a(B)),1),e[6]||(e[6]=o("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),e[9]||(e[9]=o("div",{class:"h-4 w-px bg-greys-700"},null,-1)),d(a(N),{variant:"ghost",size:"sm",onClick:Q},{default:r(()=>[...e[7]||(e[7]=[o("i",{class:"fa-solid fa-trash mr-2"},null,-1),U(" Delete ",-1)])]),_:1}),d(a(N),{variant:"ghost",size:"sm",onClick:a(c)},{default:r(()=>[...e[8]||(e[8]=[o("i",{class:"fa-solid fa-x mr-2"},null,-1),U(" Close ",-1)])]),_:1},8,["onClick"])])):P("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])]))}},we=K(ue,[["__scopeId","data-v-a725cdf6"]]);export{we as default};
