import{r as N,R as Qe,h as Ve,c as $,G as Fe,d as o,o as n,e,g as m,n as I,w as J,I as je,t as u,p as j,s as C,y as g,P as Ue,F as L,i as H,a3 as at,H as Je,x as B,z as Se,k as M,v as Ae,J as F,E as q,Q as R,m as ue,l as ae,a4 as nt,Z as lt,V as ot,X as He,K as _}from"./index-tu1CT0Iz.js";import{_ as it}from"./ReassignUserModal-Qyaee-ZO.js";import{_ as rt}from"./CreateEventModal-DuoYTNPE.js";import{z as ce,F as me,L as fe,H as be,j as pe,K as Ee,C as ye,W as ve}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BPomdMSh.js";const dt={class:"w-full bg-surface"},ut={class:"flex items-center justify-between gap-3 md:gap-4"},ct={class:"flex items-center gap-3 md:gap-4 flex-1"},mt=["aria-label"],ft={class:"min-w-0 flex-1"},bt={class:"flex items-center gap-2"},pt={class:"text-xl font-bold uppercase text-brand-dark truncate leading-tight"},yt={class:"flex flex-wrap items-center gap-2 mt-1"},vt={class:"flex items-center gap-1 ml-2"},gt={class:"relative"},xt={key:0,class:"absolute top-full right-0 mt-2 z-50"},ht={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},kt={class:"flex items-center gap-4"},wt={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},$t={class:"flex items-center gap-2"},Ct={class:"text-meta text-heading font-medium"},St={class:"flex items-center gap-2"},At={class:"text-meta text-heading font-medium"},Dt={class:"flex items-center gap-2"},Tt={class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},qt={key:0,class:"fa-solid fa-map-marker-alt text-sub text-xs"},Ot={key:1,class:"fa-regular fa-calendar text-sub text-xs"},It={class:"text-meta text-heading font-medium"},Nt={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:d}){const i=t,r=d,p=N(!1),l=N(!1),y=Qe(),h=Ve(),s=$(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...i.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(b=>({...b,onClick:()=>a(b.key)}))),a=O=>{l.value=!1,r("action",O)},f=async(O,b)=>{try{await navigator.clipboard.writeText(O),y.pushToast("success",`${b==="email"?"Email":"Phone"} copied!`)}catch{y.pushToast("error","Failed to copy")}},D=()=>{r("add-tag")},U=()=>{i.customerId&&h.push(`/customer/${i.customerId}`)};return(O,b)=>{const w=Fe("click-outside");return n(),o("div",dt,[e("div",ut,[e("div",ct,[e("button",{onClick:J(U,["stop"]),class:I(["w-14 h-14 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...b[4]||(b[4]=[e("i",{class:"fa-solid fa-user text-xl"},null,-1)])],10,mt),e("div",ft,[e("div",bt,[e("h1",pt,u(t.name),1),je(O.$slots,"name-action")]),e("div",yt,[je(O.$slots,"tags"),e("button",{onClick:J(D,["stop"]),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...b[5]||(b[5]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])]),e("div",vt,[e("div",gt,[e("button",{onClick:b[0]||(b[0]=J(A=>l.value=!l.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0","aria-label":"Quick actions"},[...b[6]||(b[6]=[e("i",{class:"fa-solid fa-plus text-base text-body"},null,-1)])]),l.value?j((n(),o("div",xt,[C(g(Ue),{items:s.value,className:"w-48"},null,8,["items"])])),[[w,()=>l.value=!1]]):m("",!0)]),e("button",{onClick:b[1]||(b[1]=A=>p.value=!p.value),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0"},[e("i",{class:I(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":p.value}])},null,2)])])]),p.value?(n(),o("div",ht,[e("div",kt,[e("div",wt,[e("div",$t,[b[8]||(b[8]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-xs"})],-1)),e("span",Ct,u(t.email),1),e("button",{onClick:b[2]||(b[2]=J(A=>f(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...b[7]||(b[7]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",St,[b[10]||(b[10]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-xs"})],-1)),e("span",At,u(t.phone),1),e("button",{onClick:b[3]||(b[3]=J(A=>f(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...b[9]||(b[9]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Dt,[e("div",Tt,[t.thirdFieldLabel.toLowerCase().includes("address")?(n(),o("i",qt)):(n(),o("i",Ot))]),e("span",It,u(t.thirdFieldValue),1)])])])])):m("",!0)])}}},Mt={class:"flex gap-0 md:gap-8 text-content font-medium text-sub py-1"},jt=["onClick"],Ke={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const d={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-thumbtack",manage:"fa-solid fa-gear",data:"fa-solid fa-database",notes:"fa-solid fa-note-sticky"},i=r=>d[r]||"fa-solid fa-circle";return(r,p)=>(n(),o("div",Mt,[(n(!0),o(L,null,H(t.tabs,l=>(n(),o("div",{key:l.key,onClick:y=>r.$emit("update:modelValue",l.key),class:I(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===l.key?"border-brand-red text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:I([i(l.key),"text-base md:text-base",t.modelValue===l.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:I(["hidden md:inline whitespace-nowrap",t.modelValue===l.key?"text-brand-darkDarker":""])},u(l.label),3)],10,jt))),128))]))}},Vt={class:"w-full mb-6"},Ft={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Ut={class:"px-4 md:px-6 py-3 border-b border"},Et={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},Bt={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},Wt={class:"flex items-center gap-1.5"},Rt={key:1},Lt={class:"flex items-center gap-2"},Pt={key:0,class:"p-4 md:p-6"},zt={key:0,class:"space-y-4"},Ht={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Kt={class:"flex items-center gap-4"},Yt={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border"},Gt=["src"],Qt={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},Jt={class:"font-bold text-heading text-base md:text-lg mb-2"},Xt={class:"flex items-center gap-2 flex-wrap"},Zt={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},_t={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},es={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border text-body text-xs font-semibold rounded-md"},ts={class:"text-xs font-bold text-heading"},ss={key:0,class:"text-right"},as={class:"font-bold text-heading text-lg"},ns={key:0,class:"pt-2"},ls={class:"bg-surfaceSecondary border border rounded-lg p-3"},os={class:"text-sm text-body leading-relaxed"},is={key:1,class:"space-y-3"},rs={key:0,class:"flex items-center gap-2"},ds={class:"text-sm font-semibold text-heading"},us={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},cs={class:"text-sm text-body leading-relaxed"},ms={key:1,class:"border-t border"},fs={class:"font-medium"},bs={key:2,class:"border-t border p-6 bg-surfaceSecondary/30 text-sm animate-fade-in"},ps={class:"mb-6"},ys={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},vs={key:0},gs={class:"font-medium text-body"},xs={key:1},hs={class:"font-medium text-body"},ks={key:2},ws={class:"font-medium text-body"},$s={class:"font-medium text-body"},Cs={key:0},Ss={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},As={key:0},Ds={class:"font-medium text-body"},Ts={key:1},qs={class:"font-medium text-body"},Os={key:2},Is={class:"font-medium text-body"},Ns={key:3},Ms={class:"font-medium text-body"},js={key:4},Vs={class:"font-mono text-xs bg-surface border border px-2 py-1 rounded inline-block text-body"},Fs={key:5},Us={class:"font-medium text-body"},Es={key:0,class:"mt-6 flex justify-end"},Bs={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const d=t,i=N(!1);$(()=>d.deliverySubstatus?at(d.deliverySubstatus):"");const r=$(()=>d.deliverySubstatus?d.deliverySubstatus==="Delivered"?"green":d.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),p=$(()=>Je(d.stage,d.entityType));function l(k){return!k||k.length===0?null:k.filter(z=>z.type==="offer").sort((z,K)=>new Date(K.timestamp)-new Date(z.timestamp))[0]||null}function y(k){if(!k)return 0;const x=new Date(k),K=Math.abs(new Date-x);return Math.ceil(K/(1e3*60*60*24))}const h=$(()=>{if(d.stage!=="In Negotiation")return null;const k=l(d.activities);if(!k)return null;const x=y(k.timestamp);return x<1?{label:"New Offer",theme:"orange"}:x<3?{label:"Active",theme:"yellow"}:null}),s=$(()=>d.requestedCar&&d.requestedCar.brand&&d.requestedCar.model),a=$(()=>d.requestType||d.requestMessage||s.value),f=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.brand)||""}),D=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.model)||""}),U=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.year)||""}),O=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.image)||""}),b=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.price)||null}),w=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.stockDays)!==void 0?d.requestedCar.stockDays:null}),A=$(()=>{var k,x;return((k=d.requestedCar)==null?void 0:k.dealership)||((x=d.task)==null?void 0:x.dealership)||""}),T=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.registration)||""}),V=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.kilometers)!==void 0?d.requestedCar.kilometers:null}),E=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.fuelType)||""}),te=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.gearType)||""}),ge=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.vin)||""}),se=$(()=>"Email"),le=$(()=>{var k,x;return((k=d.task)==null?void 0:k.sourceDetails)||((x=d.requestedCar)==null?void 0:x.adCampaign)||""}),oe=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.expectedPurchaseDate)||""}),ie=$(()=>{var k;return((k=d.task)==null?void 0:k.fiscalEntity)||""}),Z=$(()=>{var k;return((k=d.task)==null?void 0:k.sourceDetails)||""}),re=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.adMedium)||""}),de=$(()=>{var k;return((k=d.requestedCar)==null?void 0:k.adSource)||""});$(()=>!0);const xe=$(()=>!0),he=$(()=>s.value||d.requestType||d.source||Z.value||le.value||oe.value||ie.value||re.value||de.value),X=k=>new Intl.NumberFormat("en-US").format(k),P=k=>new Intl.NumberFormat("en-US").format(k);return(k,x)=>(n(),o("div",Vt,[e("div",Ft,[e("div",Ut,[e("div",Et,[a.value?(n(),o("div",Bt,[x[2]||(x[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),e("h3",{class:"font-bold text-heading text-sm"},"Request")],-1)),e("div",Wt,[e("span",{class:I(["px-2 py-0.5 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-0.5 rounded text-xs font-medium border",p.value])},u(t.stage),3),t.deliverySubstatus?(n(),B(g(Se),{key:0,text:t.deliverySubstatus,size:"small",theme:r.value},null,8,["text","theme"])):m("",!0),h.value?(n(),B(g(Se),{key:1,text:h.value.label,size:"small",theme:h.value.theme},null,8,["text","theme"])):m("",!0)])])):(n(),o("div",Rt)),e("div",Lt,[x[3]||(x[3]=e("span",{class:"hidden md:inline text-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:x[0]||(x[0]=z=>k.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},u(t.owner),1)])])]),a.value?(n(),o("div",Pt,[s.value?(n(),o("div",zt,[e("div",Ht,[e("div",Kt,[e("div",Yt,[O.value?(n(),o("img",{key:0,src:O.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Gt)):(n(),o("i",Qt))]),e("div",null,[e("div",Jt,u(f.value)+" "+u(D.value)+" ("+u(U.value)+")",1),e("div",Xt,[w.value!==void 0&&w.value!==null?(n(),o("div",Zt,[x[4]||(x[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+u(w.value)+" days) ",1)])):s.value?(n(),o("div",_t,[...x[5]||(x[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])])):m("",!0),t.source?(n(),o("div",es,[x[6]||(x[6]=e("span",{class:"text-xs text-sub font-medium"},"Source:",-1)),e("span",ts,u(t.source),1)])):m("",!0)])])]),b.value?(n(),o("div",ss,[x[7]||(x[7]=e("div",{class:"text-xs text-sub font-medium mb-1"},"Price",-1)),e("div",as,"€ "+u(X(b.value)),1)])):m("",!0)]),t.requestMessage?(n(),o("div",ns,[x[8]||(x[8]=e("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",ls,[e("p",os,u(t.requestMessage),1)])])):m("",!0)])):(n(),o("div",is,[t.requestType?(n(),o("div",rs,[x[9]||(x[9]=e("span",{class:"text-xs text-sub font-medium"},"Request Type:",-1)),e("span",ds,u(t.requestType),1)])):m("",!0),t.requestMessage?(n(),o("div",us,[x[10]||(x[10]=e("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",cs,u(t.requestMessage),1)])):m("",!0)]))])):m("",!0),he.value?(n(),o("div",ms,[e("button",{onClick:x[1]||(x[1]=z=>i.value=!i.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",fs,u(i.value?"Hide":"View")+" Details",1),e("i",{class:I(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":i.value}])},null,2)])])):m("",!0),i.value&&he.value?(n(),o("div",bs,[e("div",ps,[x[21]||(x[21]=e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",ys,[t.requestType?(n(),o("div",vs,[x[11]||(x[11]=e("div",{class:"text-xs text-sub mb-1"},"Request type",-1)),e("div",gs,u(t.requestType),1)])):m("",!0),t.source?(n(),o("div",xs,[x[12]||(x[12]=e("div",{class:"text-xs text-sub mb-1"},"Source",-1)),e("div",hs,u(t.source),1)])):m("",!0),e("div",null,[x[13]||(x[13]=e("div",{class:"text-xs text-sub mb-1"},"Source details",-1)),e("div",{class:I(["font-medium",Z.value?"text-body":"text-sub"])},u(Z.value||"--"),3)]),A.value?(n(),o("div",ks,[x[14]||(x[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",ws,u(A.value),1)])):m("",!0),e("div",null,[x[15]||(x[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",$s,u(se.value||"Email"),1)]),e("div",null,[x[16]||(x[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:I(["font-medium",le.value?"text-body":"text-sub"])},u(le.value||"--"),3)]),e("div",null,[x[17]||(x[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:I(["font-medium",re.value?"text-body":"text-sub"])},u(re.value||"--"),3)]),e("div",null,[x[18]||(x[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:I(["font-medium",de.value?"text-body":"text-sub"])},u(de.value||"--"),3)]),e("div",null,[x[19]||(x[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:I(["font-medium",oe.value?"text-body":"text-sub"])},u(oe.value||"--"),3)]),e("div",null,[x[20]||(x[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:I(["font-medium",ie.value?"text-body":"text-sub"])},u(ie.value||"--"),3)])])]),s.value?(n(),o("div",Cs,[x[30]||(x[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[x[29]||(x[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Ss,[T.value?(n(),o("div",As,[x[22]||(x[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Ds,u(T.value),1)])):m("",!0),V.value!==void 0&&V.value!==null?(n(),o("div",Ts,[x[23]||(x[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",qs,u(P(V.value))+" Km",1)])):m("",!0),E.value?(n(),o("div",Os,[x[24]||(x[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Is,u(E.value),1)])):m("",!0),te.value?(n(),o("div",Ns,[x[25]||(x[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Ms,u(te.value),1)])):m("",!0),ge.value?(n(),o("div",js,[x[26]||(x[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Vs,u(ge.value),1)])):m("",!0),A.value?(n(),o("div",Fs,[x[27]||(x[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Us,u(A.value),1)])):m("",!0)]),xe.value?(n(),o("div",Es,[...x[28]||(x[28]=[e("button",{class:"bg-surface border border text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),M(" View technical specs ")],-1)])])):m("",!0)])])):m("",!0)])):m("",!0)])]))}},Ws={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden h-full"},Rs={class:"p-6"},Ls={class:"flex items-center justify-between mb-4"},Ps={class:"flex items-center gap-2"},zs={class:"flex items-center gap-2 flex-wrap mb-4"},Hs={key:0,class:"space-y-3"},Ks={class:"flex items-center gap-3"},Ys={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border"},Gs=["src"],Qs={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},Js={class:"flex-1 min-w-0"},Xs={class:"font-bold text-heading text-sm mb-1"},Zs={class:"flex items-center gap-2 flex-wrap"},_s={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded"},ea={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded"},ta={key:0,class:"text-right"},sa={class:"font-bold text-heading text-base"},aa={class:"mt-4 pt-4 border-t border space-y-2"},na={key:0,class:"flex items-center justify-between text-xs"},la={class:"text-heading font-medium"},oa={key:1,class:"flex items-center justify-between text-xs"},ia={class:"text-heading font-medium"},ra={key:2,class:"pt-2"},da={class:"bg-surfaceSecondary border border rounded-lg p-2"},ua={class:"text-xs text-body leading-relaxed line-clamp-3"},ca={__name:"RequestCard",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const d=t,i=$(()=>d.task.requestedCar&&d.task.requestedCar.brand&&d.task.requestedCar.model),r=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.brand)||""}),p=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.model)||""}),l=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.year)||""}),y=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.image)||""}),h=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.price)||null}),s=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.stockDays)!==void 0?d.task.requestedCar.stockDays:null}),a=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.requestMessage)||""}),f=$(()=>Je(d.task.displayStage||d.task.stage,d.entityType)),D=$(()=>d.task.deliverySubstatus?d.task.deliverySubstatus==="Delivered"?"green":d.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function U(A){return!A||A.length===0?null:A.filter(V=>V.type==="offer").sort((V,E)=>new Date(E.timestamp)-new Date(V.timestamp))[0]||null}function O(A){if(!A)return 0;const T=new Date(A),E=Math.abs(new Date-T);return Math.ceil(E/(1e3*60*60*24))}const b=$(()=>{if((d.task.displayStage||d.task.stage)!=="In Negotiation")return null;const A=U(d.activities);if(!A)return null;const T=O(A.timestamp);return T<1?{label:"New Offer",theme:"orange"}:T<3?{label:"Active",theme:"yellow"}:null}),w=A=>new Intl.NumberFormat("en-US").format(A);return(A,T)=>{var V,E;return n(),o("div",Ws,[e("div",Rs,[e("div",Ls,[T[2]||(T[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Request")],-1)),e("div",Ps,[T[1]||(T[1]=e("span",{class:"text-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:T[0]||(T[0]=te=>A.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},u(t.task.assignee),1)])]),e("div",zs,[e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",f.value])},u(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(n(),B(g(Se),{key:0,text:t.task.deliverySubstatus,size:"small",theme:D.value},null,8,["text","theme"])):m("",!0),b.value?(n(),B(g(Se),{key:1,text:b.value.label,size:"small",theme:b.value.theme},null,8,["text","theme"])):m("",!0)]),i.value?(n(),o("div",Hs,[e("div",Ks,[e("div",Ys,[y.value?(n(),o("img",{key:0,src:y.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Gs)):(n(),o("i",Qs))]),e("div",Js,[e("div",Xs,u(r.value)+" "+u(p.value)+" ("+u(l.value)+")",1),e("div",Zs,[s.value!==void 0&&s.value!==null?(n(),o("div",_s,[T[3]||(T[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+u(s.value)+" days) ",1)])):(n(),o("div",ea,[...T[4]||(T[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])]))])]),h.value?(n(),o("div",ta,[T[5]||(T[5]=e("div",{class:"text-xs text-sub font-medium"},"Price",-1)),e("div",sa,"€ "+u(w(h.value)),1)])):m("",!0)])])):m("",!0),e("div",aa,[t.task.source?(n(),o("div",na,[T[6]||(T[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",la,u(t.task.source),1)])):m("",!0),t.task.requestType||(V=t.task.requestedCar)!=null&&V.requestType?(n(),o("div",oa,[T[7]||(T[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",ia,u(t.task.requestType||((E=t.task.requestedCar)==null?void 0:E.requestType)),1)])):m("",!0),a.value?(n(),o("div",ra,[T[8]||(T[8]=e("div",{class:"text-xs text-sub mb-1"},"Message",-1)),e("div",da,[e("p",ua,u(a.value),1)])])):m("",!0)])])])}}},ma={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden h-full"},fa={class:"p-6"},ba={class:"flex items-center mb-4"},pa={class:"flex items-center gap-3 flex-1 min-w-0"},ya=["aria-label"],va={class:"flex-1 min-w-0"},ga={class:"flex items-center gap-2"},xa={class:"text-lg font-bold uppercase text-brand-dark truncate"},ha={class:"flex flex-wrap items-center gap-1.5 mt-1"},ka={class:"space-y-3 pt-4 border-t border"},wa={class:"flex items-center gap-2"},$a={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},Ca={class:"flex items-center gap-2"},Sa={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},Aa={class:"flex items-center gap-2"},Da={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},Ta={__name:"ContactInfoCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:d}){const i=t,r=Qe(),p=Ve(),l=async(s,a)=>{try{await navigator.clipboard.writeText(s),r.pushToast("success",`${a==="email"?"Email":"Phone"} copied!`)}catch{r.pushToast("error","Failed to copy")}},y=()=>{i.customerId&&p.push(`/customer/${i.customerId}`)},h=()=>{i.customerId&&p.push(`/customer/${i.customerId}`)};return(s,a)=>{var f,D,U,O;return n(),o("div",ma,[e("div",fa,[e("div",ba,[e("div",pa,[e("button",{onClick:J(y,["stop"]),class:I(["w-12 h-12 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-user text-lg"},null,-1)])],10,ya),e("div",va,[e("div",ga,[e("h3",xa,u(((f=t.task.customer)==null?void 0:f.name)||"Unknown"),1),e("button",{onClick:h,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])]),e("div",ha,[(n(!0),o(L,null,H(t.task.tags,b=>(n(),o("span",{key:b,class:"px-2 py-0.5 text-xs bg-blue-50 border border-blue-100 text-blue-700 font-semibold rounded"},u(b),1))),128)),e("button",{onClick:a[0]||(a[0]=J(b=>s.$emit("add-tag"),["stop"])),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...a[5]||(a[5]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])]),e("div",ka,[e("div",wa,[a[7]||(a[7]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-sm"})],-1)),e("span",$a,u(((D=t.task.customer)==null?void 0:D.email)||""),1),e("button",{onClick:a[1]||(a[1]=J(b=>{var w;return l(((w=t.task.customer)==null?void 0:w.email)||"","email")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...a[6]||(a[6]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Ca,[a[9]||(a[9]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-sm"})],-1)),e("span",Sa,u(((U=t.task.customer)==null?void 0:U.phone)||""),1),e("button",{onClick:a[2]||(a[2]=J(b=>{var w;return l(((w=t.task.customer)==null?void 0:w.phone)||"","phone")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...a[8]||(a[8]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Aa,[a[10]||(a[10]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-map-marker-alt text-sub text-sm"})],-1)),e("span",Da,u(((O=t.task.customer)==null?void 0:O.address)||""),1)])])])])}}},qa={key:0,class:"flex-grow border-t border"},Oa={key:0,class:"ml-1.5 text-body"},Ia={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Na={key:1,class:"flex-grow border-t border"},Ma={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:d}){const i=t,r=d,p=N(!1),l={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},y=$(()=>{if(!i.activeTab||i.activeTab==="overview")return i.actions.filter(w=>!l[w]);const b=Object.entries(l).filter(([,w])=>w===i.activeTab).map(([w])=>w);return i.actions.filter(w=>b.includes(w))}),h=$(()=>i.activeTab==="communication"?!0:y.value.length===1),s=$(()=>{if(i.activeTab==="communication")return"add communication";if(!h.value||y.value.length!==1)return"";const b=y.value[0];return{note:"add note",attachment:"add attachment"}[b]||""}),a=$(()=>i.activeTab==="communication"?!0:y.value.length>1),f=$(()=>{const b={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return y.value.map(w=>({key:w,label:b[w]||w,onClick:()=>U(w)}))}),D=$(()=>{if(i.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border";const b="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border";return h.value?`${b} px-4 py-2 h-9`:`${b} w-9 h-9`});$(()=>y.value.some(b=>["email","whatsapp","sms"].includes(b))),$(()=>y.value.some(b=>["addVehicle","configureVehicle"].includes(b))),$(()=>y.value.some(b=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(b)));const U=b=>{p.value=!1,r("action",b)},O=()=>{h.value&&y.value.length===1&&i.activeTab!=="communication"?U(y.value[0]):p.value=!p.value};return(b,w)=>{const A=Fe("click-outside");return t.show?(n(),o("div",{key:0,class:I(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?m("",!0):(n(),o("div",qa)),e("div",{class:I(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:J(O,["stop"]),class:I(D.value)},[w[0]||(w[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),h.value?(n(),o("span",Oa,u(s.value),1)):m("",!0)],2),p.value&&a.value?j((n(),o("div",Ia,[C(g(Ue),{items:f.value,className:"w-48"},null,8,["items"])])),[[A,()=>p.value=!1]]):m("",!0)],2),t.inline?m("",!0):(n(),o("div",Na))],2)):m("",!0)}}},ja={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Va={class:"flex items-start gap-3"},Fa={class:"flex-1 min-w-0"},Ua={class:"font-bold text-sm text-heading mb-2"},Ea={class:"space-y-1.5 text-xs text-gray-600"},Ba={class:"flex items-center gap-2"},Wa={class:"flex items-center gap-2"},Ra={class:"flex items-center gap-2"},La={key:0,class:"mt-2"},Pa={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const d=t,i=$(()=>d.appointmentData.date?new Date(d.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),r=$(()=>d.appointmentData.time?d.appointmentData.time:""),p=l=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[l==null?void 0:l.toLowerCase()]||"bg-surfaceSecondary text-body border border";return(l,y)=>(n(),o("div",ja,[e("div",Va,[y[3]||(y[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Fa,[e("h4",Ua,u(t.appointmentData.type),1),e("div",Ea,[e("div",Ba,[y[0]||(y[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,u(i.value),1)]),e("div",Wa,[y[1]||(y[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,u(r.value),1)]),e("div",Ra,[y[2]||(y[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,u(t.appointmentData.assignee),1)])]),t.appointmentData.status?(n(),o("div",La,[e("span",{class:I(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",p(t.appointmentData.status)])},u(t.appointmentData.status),3)])):m("",!0)])])]))}},za={class:"bg-surface border border rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Ha={class:"flex-1"},Ka={class:"flex items-center gap-2 mb-1"},Ya={class:"text-meta-bold text-heading"},Ga={class:"text-meta"},Qa={class:"text-meta"},Ja={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},Xa={class:"ml-auto relative"},Za={key:0,class:"absolute right-0 top-full mt-1 z-10"},_a={key:0,class:"text-content text-body"},en={key:1,class:"text-content text-body flex items-center gap-2"},tn={key:2,class:"mt-2"},sn={key:0},an={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},nn={key:0},ln={class:"text-content font-bold text-heading"},on={key:0,class:"text-meta mt-0.5"},rn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},dn={key:0},un={key:1},cn={key:2},mn={key:3},fn={key:4},bn={key:1},pn={class:"text-content font-bold text-heading mb-2"},yn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},vn={key:0},gn={class:"text-body font-medium ml-1"},xn={key:1},hn={class:"text-body font-medium ml-1"},kn={key:2},wn={class:"text-body font-medium ml-1"},$n={key:3},Cn={class:"text-body font-medium ml-1"},Sn={key:4},An={class:"text-body font-medium ml-1"},Dn={key:5},Tn={class:"text-body font-medium ml-1"},qn={key:2,class:"flex items-center gap-3"},On={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},In=["src"],Nn={class:"flex-1"},Mn={class:"text-content font-bold text-heading"},jn={class:"text-meta"},Vn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Fn={key:3,class:"flex items-center gap-3"},Un={class:"flex-1"},En={class:"text-content font-bold text-heading"},Bn={class:"text-meta"},Wn={key:0,class:"text-meta mt-1"},Rn={key:1,class:"text-meta mt-1"},Ye={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:d}){const i=t,r=d,p=N(!1),l=$(()=>[{key:"edit",label:"Edit",onClick:D},{key:"delete",label:"Delete",onClick:U}]),y=O=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[O]||"fa-solid fa-circle",h=O=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[O]||"bg-surfaceSecondary text-body border",s=O=>{if(!O)return"Just now";const b=new Date(O),A=new Date-b,T=Math.floor(A/6e4),V=Math.floor(T/60),E=Math.floor(V/24);return T<1?"Just now":T<60?`${T} minutes ago`:V<24?`${V} hours ago`:E===1?"Yesterday":E<7?`${E} days ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},a=O=>O?new Intl.NumberFormat("en-US").format(O):"0",f=O=>O?new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",D=()=>{p.value=!1,r("edit",i.item)},U=()=>{p.value=!1,confirm("Are you sure you want to delete this item?")&&r("delete",i.item)};return(O,b)=>{const w=Fe("click-outside");return n(),o("div",za,[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",h(t.item.type)])},[e("i",{class:I([y(t.item.type),"text-sm"])},null,2)],2),e("div",Ha,[e("div",Ka,[e("span",Ya,u(t.customerInitials),1),e("span",Ga,u(t.item.action||"added"),1),e("span",Qa,"• "+u(s(t.item.timestamp)),1),t.item.autoDetected?(n(),o("span",Ja,"Auto-detected")):m("",!0),e("div",Xa,[e("button",{onClick:b[0]||(b[0]=J(A=>p.value=!p.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),p.value?j((n(),o("div",Za,[C(g(Ue),{items:l.value,className:"w-32"},null,8,["items"])])),[[w,()=>p.value=!1]]):m("",!0)])]),t.item.content?(n(),o("div",_a,u(t.item.content),1)):m("",!0),t.item.fileName?(n(),o("div",en,[b[2]||(b[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,u(t.item.fileName),1)])):m("",!0),t.item.data?(n(),o("div",tn,[t.item.type==="appointment"?(n(),o("div",sn,[C(Pa,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(n(),o("div",an,[t.item.type==="tradein"?(n(),o("div",nn,[e("h4",ln,u(t.item.data.brand)+" "+u(t.item.data.model),1),t.item.data.version?(n(),o("p",on,u(t.item.data.version),1)):m("",!0),e("div",rn,[t.item.data.year?(n(),o("div",dn,[b[3]||(b[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),M(u(t.item.data.year),1)])):m("",!0),t.item.data.km?(n(),o("div",un,[b[4]||(b[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),M(u(t.item.data.km)+" km ",1)])):m("",!0),t.item.data.plate?(n(),o("div",cn,[b[5]||(b[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),M(u(t.item.data.plate),1)])):m("",!0),t.item.data.date?(n(),o("div",mn,[b[6]||(b[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),M(u(f(t.item.data.date)),1)])):m("",!0),t.item.data.class?(n(),o("div",fn,[b[7]||(b[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),M(u(t.item.data.class),1)])):m("",!0)])])):t.item.type==="financing"?(n(),o("div",bn,[e("h4",pn,u(t.item.data.product),1),e("div",yn,[t.item.data.provider?(n(),o("div",vn,[b[8]||(b[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",gn,u(t.item.data.provider),1)])):m("",!0),t.item.data.total?(n(),o("div",xn,[b[9]||(b[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",hn,"€"+u(a(t.item.data.total)),1)])):m("",!0),t.item.data.monthly?(n(),o("div",kn,[b[10]||(b[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",wn,"€"+u(a(t.item.data.monthly)),1)])):m("",!0),t.item.data.deposit?(n(),o("div",$n,[b[11]||(b[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Cn,"€"+u(a(t.item.data.deposit)),1)])):m("",!0),t.item.data.startDate?(n(),o("div",Sn,[b[12]||(b[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",An,u(f(t.item.data.startDate)),1)])):m("",!0),t.item.data.expDate?(n(),o("div",Dn,[b[13]||(b[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Tn,u(f(t.item.data.expDate)),1)])):m("",!0)])])):t.item.type==="offer"?(n(),o("div",qn,[t.item.data.image?(n(),o("div",On,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,In)])):m("",!0),e("div",Nn,[e("h4",Mn,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",jn,"€ "+u(a(t.item.data.price)),1)]),t.item.data.isMainOffer?(n(),o("span",Vn,"Main Offer")):m("",!0)])):t.item.type==="purchase"?(n(),o("div",Fn,[e("div",Un,[e("h4",En,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",Bn,"€ "+u(a(t.item.data.price)),1),t.item.data.purchaseDate?(n(),o("p",Wn,"Purchased: "+u(f(t.item.data.purchaseDate)),1)):m("",!0),t.item.data.notes?(n(),o("p",Rn,u(t.item.data.notes),1)):m("",!0)])])):m("",!0)]))])):m("",!0)])])}}},Ln={class:"h-16 px-5 border-b border bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Pn={class:"flex items-center gap-3"},zn=["title"],Hn={key:0,class:"fa-solid fa-arrow-left text-sm"},Kn={key:1,class:"fa-solid fa-arrow-right text-sm"},Yn={key:2,class:"font-bold text-lg text-heading"},Gn={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Qn={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},Jn={key:1,class:"text-center py-8 text-sub relative z-10"},Xn={class:"text-sm"},Zn={key:2,class:"space-y-6 relative z-10"},_n={key:0,class:"mb-4 pl-12"},el={class:"text-sm font-semibold text-heading"},tl={class:"flex gap-4 relative mb-6"},sl={class:"flex-1 min-w-0"},al={class:"text-sm text-slate-700 leading-snug"},nl={class:"font-bold"},ll={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-body"},ol={class:"text-xs text-sub mt-1"},il={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},rl={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},dl={key:1,class:"space-y-4 relative z-10"},ul=["title"],cl={key:2,class:"text-center py-8 text-sub relative z-10"},Ge={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:d}){const i=t,r=s=>{const a={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return a[s]||a.default},p=s=>{const a={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return a[s]||a.default},l=s=>{if(!s)return"";const a=new Date(s),f=new Date,D=new Date(f);return D.setDate(D.getDate()-1),a.toDateString()===f.toDateString()?"Today":a.toDateString()===D.toDateString()?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},y=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",h=(s,a)=>{if(s===0)return!0;const f=i.activities[s-1];if(!f)return!0;const D=new Date(a.timestamp).toDateString(),U=new Date(f.timestamp).toDateString();return D!==U};return(s,a)=>t.show?(n(),o("div",{key:0,class:I(["bg-surface border-l border shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Ln,[e("div",Pn,[t.mobileFullscreen?(n(),o("button",{key:0,onClick:a[0]||(a[0]=f=>s.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...a[2]||(a[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(n(),o("button",{key:1,onClick:a[1]||(a[1]=f=>s.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(n(),o("i",Hn)):(n(),o("i",Kn))],8,zn)):m("",!0),t.collapsed?m("",!0):(n(),o("h2",Yn,u(t.title),1))])]),t.collapsed?(n(),o("div",il,[t.activities.length>0?(n(),o("div",rl)):m("",!0),t.activities.length>0?(n(),o("div",dl,[(n(!0),o(L,null,H(t.activities,f=>(n(),o("div",{key:f.id,class:"relative"},[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border",p(f.type)]),title:`${f.user} ${f.action}`},[e("i",{class:I([r(f.type),"text-xs"])},null,2)],10,ul)]))),128))])):(n(),o("div",cl,[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(n(),o("div",Gn,[t.activities.length>0?(n(),o("div",Qn)):m("",!0),t.activities.length===0?(n(),o("div",Jn,[a[3]||(a[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Xn,u(t.emptyMessage),1)])):(n(),o("div",Zn,[(n(!0),o(L,null,H(t.activities,(f,D)=>(n(),o(L,{key:f.id},[h(D,f)?(n(),o("div",_n,[e("h3",el,u(l(f.timestamp)),1)])):m("",!0),e("div",tl,[e("div",{class:I(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",p(f.type)])},[e("i",{class:I([r(f.type),"text-sm"])},null,2)],2),e("div",sl,[e("div",al,[e("span",nl,u(f.user),1),M(" "+u(f.action),1)]),f.content?(n(),o("div",ll,u(f.content),1)):m("",!0),e("div",ol,u(y(f.timestamp)),1)])])],64))),128))]))]))],2)):m("",!0)}},ml={class:"bg-surface border border rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},fl={class:"heading-sub mb-3"},bl={class:"mb-3"},pl={class:"flex justify-end gap-2"},yl={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:d}){const i=t,r=d,p=N(""),l=N(""),y=()=>{!p.value.trim()&&!l.value||r("save",{type:"communication",action:`sent via ${i.type}`,content:p.value||`Sent template: ${l.value}`,communicationType:i.type})};return(h,s)=>(n(),o("div",ml,[s[7]||(s[7]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),e("h5",fl,u(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",bl,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Template",-1)),j(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>l.value=a),class:"input"},[...s[3]||(s[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[Ae,l.value]])]),j(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>p.value=a),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[F,p.value]]),e("div",pl,[C(g(R),{variant:"outline",size:"small",onClick:s[2]||(s[2]=a=>h.$emit("cancel"))},{default:q(()=>[...s[5]||(s[5]=[M(" Cancel ",-1)])]),_:1}),C(g(R),{variant:"primary",size:"small",onClick:y},{default:q(()=>[...s[6]||(s[6]=[M(" Send ",-1)])]),_:1})])]))}},vl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},gl={key:1,class:"flex justify-between items-center mb-4"},xl={class:"heading-sub"},hl={key:2,class:"flex justify-end gap-2 mt-6 border-t border pt-4"},kl={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:i}){const r=t,p=i,l=N("");ue(()=>{r.item&&(l.value=r.item.content||"")});const y=()=>{var h,s;l.value.trim()&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"note",action:r.item?"updated a note":"added a note",content:l.value,timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,canSubmit:()=>!!l.value.trim()}),(h,s)=>(n(),o("div",{class:I(["animate-fade-in relative",{"bg-surface border border rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?m("",!0):(n(),o("div",vl)),t.hideHeader?m("",!0):(n(),o("div",gl,[e("h5",xl,u(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:s[0]||(s[0]=a=>h.$emit("cancel")),class:"text-sub hover:text-body"},[...s[3]||(s[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Note",-1)),j(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>l.value=a),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[F,l.value]])]),t.hideActions?m("",!0):(n(),o("div",hl,[C(g(R),{variant:"outline",size:"small",onClick:s[2]||(s[2]=a=>h.$emit("cancel"))},{default:q(()=>[...s[5]||(s[5]=[M(" Cancel ",-1)])]),_:1}),C(g(R),{variant:"primary",size:"small",onClick:y},{default:q(()=>[...s[6]||(s[6]=[M(" Save ",-1)])]),_:1})]))],2))}},wl={class:"bg-surface border border rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},$l={class:"flex justify-between items-center mb-4"},Cl={class:"heading-sub"},Sl={class:"flex items-center gap-3"},Al={key:0,class:"text-sm text-slate-600"},Dl={key:1,class:"text-sm text-sub"},Tl={class:"flex justify-end gap-2 mt-6 border-t border pt-4"},ql={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:d}){const i=t,r=d,p=N(null),l=N("");ue(()=>{i.item&&(l.value=i.item.fileName||"")});const y=s=>{const a=s.target.files[0];a&&(p.value=a,l.value=a.name)},h=()=>{var s,a;!p.value&&!i.item||r("save",{id:((s=i.item)==null?void 0:s.id)||Date.now(),type:"attachment",action:i.item?"updated an attachment":"added an attachment",fileName:l.value,timestamp:((a=i.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!i.item})};return(s,a)=>(n(),o("div",wl,[a[8]||(a[8]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),e("div",$l,[e("h5",Cl,u(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:a[0]||(a[0]=f=>s.$emit("cancel")),class:"text-sub hover:text-body"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Sl,[e("input",{type:"file",onChange:y,ref:"fileInput",class:"hidden"},null,544),C(g(R),{variant:"outline",size:"small",onClick:a[1]||(a[1]=f=>s.$refs.fileInput.click()),class:"flex items-center gap-2"},{default:q(()=>[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-paperclip"},null,-1),e("span",null,"Choose File",-1)])]),_:1}),l.value?(n(),o("span",Al,u(l.value),1)):(n(),o("span",Dl,"No file selected"))])]),e("div",Tl,[C(g(R),{variant:"outline",size:"small",onClick:a[2]||(a[2]=f=>s.$emit("cancel"))},{default:q(()=>[...a[6]||(a[6]=[M(" Cancel ",-1)])]),_:1}),C(g(R),{variant:"primary",size:"small",disabled:!p.value,onClick:h},{default:q(()=>[...a[7]||(a[7]=[M(" Save ",-1)])]),_:1},8,["disabled"])])]))}},Ol={class:"animate-fade-in"},Il={class:"space-y-4"},Nl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ml={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},jl={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Vl=["disabled"],Fl={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:i}){const r=t,p=i,l=N({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ue(()=>{r.item&&r.item.data&&(l.value={startDate:r.item.data.startDate||"",expDate:r.item.data.expDate||"",productName:r.item.data.product||r.item.data.productName||"",deposit:r.item.data.deposit||"",loanAmount:r.item.data.total||r.item.data.loanAmount||""})});const y=()=>{var h,s;l.value.productName&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"financing",action:r.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,isValid:$(()=>!!l.value.productName)}),(h,s)=>(n(),o("div",Ol,[e("div",Il,[e("div",Nl,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=a=>l.value.startDate=a),class:"input"},null,512),[[F,l.value.startDate]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=a=>l.value.expDate=a),class:"input"},null,512),[[F,l.value.expDate]])])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>l.value.productName=a),class:"input"},null,512),[[F,l.value.productName]])]),e("div",Ml,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=a=>l.value.deposit=a),class:"input"},null,512),[[F,l.value.deposit]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>l.value.loanAmount=a),class:"input"},null,512),[[F,l.value.loanAmount]])])])]),t.hideActions?m("",!0):(n(),o("div",jl,[e("button",{onClick:s[5]||(s[5]=a=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Vl)]))]))}},Ul={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:d}){const i=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||i("close")},h=s=>{i("save",s),i("close")};return(s,a)=>(n(),B(g(ve),{open:t.show,"onUpdate:open":y},{default:q(()=>[C(g(ce),null,{default:q(()=>[C(g(me),{class:"fixed inset-0 z-50 bg-black/50"}),C(g(fe),{class:"w-full sm:max-w-lg"},{default:q(()=>[C(g(be),null,{default:q(()=>[C(g(pe),null,{default:q(()=>[...a[2]||(a[2]=[M("Add Financing",-1)])]),_:1}),C(g(Ee),null,{default:q(()=>[...a[3]||(a[3]=[M("Record financing details for this customer",-1)])]),_:1})]),_:1}),C(Fl,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=f=>s.$emit("close"))},null,8,["item","task-type","task-id"]),C(g(ye),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:q(()=>[C(g(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=f=>s.$emit("close"))}),C(g(R),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},El={class:"animate-fade-in"},Bl={class:"space-y-4"},Wl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ll={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Pl=["disabled"],zl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:i}){const r=t,p=i,l=N({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ue(()=>{r.item&&r.item.data&&(l.value={class:r.item.data.class||"Car",brand:r.item.data.brand||"",model:r.item.data.model||"",version:r.item.data.version||"",km:r.item.data.km||"",plate:r.item.data.plate||"",date:r.item.data.date||""})});const y=()=>{var h,s;l.value.brand&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"tradein",action:r.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,isValid:$(()=>!!l.value.brand)}),(h,s)=>(n(),o("div",El,[e("div",Bl,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),j(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>l.value.class=a),class:"input"},[...s[8]||(s[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[Ae,l.value.class]])]),e("div",Wl,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>l.value.brand=a),class:"input"},null,512),[[F,l.value.brand]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>l.value.model=a),class:"input"},null,512),[[F,l.value.model]])])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=a=>l.value.version=a),class:"input"},null,512),[[F,l.value.version]])]),e("div",Rl,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),j(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>l.value.km=a),class:"input"},null,512),[[F,l.value.km]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),j(e("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=a=>l.value.plate=a),class:"input"},null,512),[[F,l.value.plate]])])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),j(e("input",{type:"date","onUpdate:modelValue":s[6]||(s[6]=a=>l.value.date=a),class:"input"},null,512),[[F,l.value.date]])])]),t.hideActions?m("",!0):(n(),o("div",Ll,[e("button",{onClick:s[7]||(s[7]=a=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Pl)]))]))}},Hl={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:d}){const i=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||i("close")},h=s=>{i("save",s),i("close")};return(s,a)=>(n(),B(g(ve),{open:t.show,"onUpdate:open":y},{default:q(()=>[C(g(ce),null,{default:q(()=>[C(g(me),{class:"fixed inset-0 z-50 bg-black/50"}),C(g(fe),{class:"w-full sm:max-w-lg"},{default:q(()=>[C(g(be),null,{default:q(()=>[C(g(pe),null,{default:q(()=>[...a[2]||(a[2]=[M("Add Trade-In Vehicle",-1)])]),_:1}),C(g(Ee),null,{default:q(()=>[...a[3]||(a[3]=[M("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),C(zl,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=f=>s.$emit("close"))},null,8,["item","task-type","task-id"]),C(g(ye),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:q(()=>[C(g(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=f=>s.$emit("close"))}),C(g(R),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Kl={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Yl={key:0,class:"flex justify-between items-center mb-4"},Gl={class:"text-sm font-bold text-heading"},Ql={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border"},Jl={class:"flex items-center gap-3"},Xl={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},Zl=["src"],_l={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},eo={class:"font-bold text-sm text-heading"},to={class:"text-xs text-sub"},so={class:"space-y-4"},ao={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},no={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},lo=["disabled"],oo={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:i}){const r=t,p=i,l=N({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});ue(()=>{if(r.selectedVehicle){l.value.price=r.selectedVehicle.price||0,l.value.brand=r.selectedVehicle.brand||"",l.value.model=r.selectedVehicle.model||"",l.value.year=r.selectedVehicle.year||"",l.value.image=r.selectedVehicle.image||"";const a=new Date;a.setDate(a.getDate()+30),l.value.validUntil=a.toISOString().split("T")[0]}r.item&&r.item.data&&(l.value={...l.value,...r.item.data,price:r.item.data.price||r.item.data.total||0,financingType:r.item.data.financingType||r.item.data.paymentMethod||"",notes:r.item.data.notes||r.item.data.description||""})}),ae(()=>r.selectedVehicle,a=>{a&&!r.item&&(l.value.price=a.price||0,l.value.brand=a.brand||"",l.value.model=a.model||"",l.value.year=a.year||"",l.value.image=a.image||"")});const y=$(()=>l.value.price>0&&l.value.financingType!==""),h=a=>a?a.toLocaleString("en-US"):"0",s=()=>{var f,D;if(!y.value)return;const a={id:((f=r.item)==null?void 0:f.id)||Date.now(),type:"offer",action:r.item?"updated an offer":"created an offer",data:{brand:l.value.brand,model:l.value.model,year:l.value.year,price:l.value.price,total:l.value.price,paymentMethod:l.value.financingType,financingType:l.value.financingType,downPayment:l.value.downPayment,monthlyPayment:l.value.monthlyPayment,term:l.value.term,interestRate:l.value.interestRate,deliveryDate:l.value.deliveryDate,validUntil:l.value.validUntil,notes:l.value.notes,description:l.value.notes,image:l.value.image},timestamp:((D=r.item)==null?void 0:D.timestamp)||new Date().toISOString(),isEdit:!!r.item};p("save",a)};return d({submit:s,isValid:y,offerData:l}),(a,f)=>(n(),o("div",Kl,[t.hideHeader?m("",!0):(n(),o("div",Yl,[e("h5",Gl,u(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:f[0]||(f[0]=D=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...f[11]||(f[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(n(),o("div",Ql,[f[12]||(f[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",Jl,[e("div",Xl,[t.selectedVehicle.image?(n(),o("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Zl)):(n(),o("i",_l))]),e("div",null,[e("h4",eo,u(t.selectedVehicle.brand)+" "+u(t.selectedVehicle.model)+" ("+u(t.selectedVehicle.year)+") ",1),e("p",to,"Base Price: € "+u(h(t.selectedVehicle.price)),1)])])])):m("",!0),e("div",so,[e("div",null,[f[13]||(f[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[M(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{type:"number","onUpdate:modelValue":f[1]||(f[1]=D=>l.value.price=D),class:"input",placeholder:"Enter offer price"},null,512),[[F,l.value.price]])]),e("div",null,[f[15]||(f[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[M(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":f[2]||(f[2]=D=>l.value.financingType=D),class:"input"},[...f[14]||(f[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[Ae,l.value.financingType]])]),l.value.financingType==="finance"||l.value.financingType==="lease"?(n(),o("div",ao,[e("div",null,[f[16]||(f[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),j(e("input",{type:"number","onUpdate:modelValue":f[3]||(f[3]=D=>l.value.downPayment=D),class:"input",placeholder:"0"},null,512),[[F,l.value.downPayment]])]),e("div",null,[f[17]||(f[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),j(e("input",{type:"number","onUpdate:modelValue":f[4]||(f[4]=D=>l.value.monthlyPayment=D),class:"input",placeholder:"Calculated automatically"},null,512),[[F,l.value.monthlyPayment]])]),e("div",null,[f[18]||(f[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),j(e("input",{type:"number","onUpdate:modelValue":f[5]||(f[5]=D=>l.value.term=D),class:"input",placeholder:"36"},null,512),[[F,l.value.term]])]),e("div",null,[f[19]||(f[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),j(e("input",{type:"number",step:"0.1","onUpdate:modelValue":f[6]||(f[6]=D=>l.value.interestRate=D),class:"input",placeholder:"3.5"},null,512),[[F,l.value.interestRate]])])])):m("",!0),e("div",null,[f[20]||(f[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),j(e("input",{type:"date","onUpdate:modelValue":f[7]||(f[7]=D=>l.value.deliveryDate=D),class:"input"},null,512),[[F,l.value.deliveryDate]])]),e("div",null,[f[21]||(f[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),j(e("input",{type:"date","onUpdate:modelValue":f[8]||(f[8]=D=>l.value.validUntil=D),class:"input"},null,512),[[F,l.value.validUntil]])]),e("div",null,[f[22]||(f[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),j(e("textarea",{"onUpdate:modelValue":f[9]||(f[9]=D=>l.value.notes=D),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[F,l.value.notes]])])]),t.hideActions?m("",!0):(n(),o("div",no,[e("button",{onClick:f[10]||(f[10]=D=>a.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:s,disabled:!y.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},u(t.item?"Update Offer":"Create Offer"),9,lo)]))]))}},io={class:"p-6"},ro={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:d}){const i=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),l=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||i("close")},h=s=>{i("save",s),i("close")};return(s,a)=>(n(),B(g(ve),{open:t.show,"onUpdate:open":y},{default:q(()=>[C(g(ce),null,{default:q(()=>[C(g(me),{class:"fixed inset-0 z-50 bg-black/50"}),C(g(fe),{class:"w-full sm:max-w-2xl p-0"},{default:q(()=>[C(g(be),{class:"p-6 pb-4 border-b border"},{default:q(()=>[C(g(pe),null,{default:q(()=>[...a[2]||(a[2]=[M("Create Offer",-1)])]),_:1}),C(g(Ee),null,{default:q(()=>[...a[3]||(a[3]=[M("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",io,[C(oo,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=f=>s.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),C(g(ye),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:q(()=>[C(g(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=f=>s.$emit("close"))}),C(g(R),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:l},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},uo={class:"space-y-4"},co={key:0},mo={class:"flex flex-wrap gap-2"},fo=["onClick"],bo={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:d}){const i=t,r=d,p=N(""),l=h=>{h||r("close")};ae(()=>i.show,h=>{h&&(p.value="")});const y=()=>{const h=p.value.trim();h&&(i.existingTags.includes(h)||(r("add",h),p.value=""))};return(h,s)=>(n(),B(g(ve),{open:t.show,"onUpdate:open":l},{default:q(()=>[C(g(ce),null,{default:q(()=>[C(g(me),{class:"fixed inset-0 z-50 bg-black/50"}),C(g(fe),{class:"w-full sm:max-w-md"},{default:q(()=>[C(g(be),null,{default:q(()=>[C(g(pe),null,{default:q(()=>[...s[2]||(s[2]=[M("Add Tag",-1)])]),_:1})]),_:1}),e("div",uo,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),j(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>p.value=a),onKeyup:nt(y,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[F,p.value]])]),t.existingTags.length>0?(n(),o("div",co,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",mo,[(n(!0),o(L,null,H(t.existingTags,a=>(n(),o("button",{key:a,onClick:f=>p.value=a,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},u(a),9,fo))),128))])])):m("",!0)]),C(g(ye),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:q(()=>[C(g(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=a=>h.$emit("close"))}),C(g(R),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value.trim(),onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ne={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function po(t){if(!t)return Ne.default;const d=t.toLowerCase().trim();return Ne[d]||Ne.default}function yo({store:t,taskId:d,getTabForItemType:i,isOverviewModalAction:r}){const p=N(null),l=N(null),y=N("overview"),h=N("email"),s=N([]);ae(y,()=>{p.value=null,l.value=null});const a=$(()=>[...t.currentActivities.value,...s.value.filter(A=>!A.activityId)].filter(A=>{const T=i(A.type);return y.value==="overview"?T==="overview":T===y.value}).sort((A,T)=>{const V=new Date(A.timestamp||0);return new Date(T.timestamp||0)-V})),f=w=>(l.value=null,y.value==="overview"&&r&&r(w)?{type:"overview-modal",action:w}:(["email","sms","whatsapp","call"].includes(w)?(h.value=w,p.value="communication"):p.value=w,null)),D=async w=>{var A;if(w.isEdit){const T=s.value.findIndex(V=>V.id===w.id);T>-1&&(s.value[T]={...s.value[T],...w}),(A=l.value)!=null&&A.activityId&&await t.updateActivity(d.value,l.value.activityId,{type:w.communicationType||w.type,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data})}else{const T=w.communicationType||w.type,V=await t.addActivity(d.value,{type:T,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data});s.value.push({id:V.id,type:T==="email"||T==="whatsapp"||T==="sms"?"communication":T,action:w.action,content:w.content,fileName:w.fileName,data:w.data,timestamp:V.timestamp,activityId:V.id})}p.value=null,l.value=null},U=()=>{p.value=null,l.value=null},O=w=>{i(w.type)&&(p.value=w.type==="email"||w.type==="whatsapp"||w.type==="sms"||w.type==="communication"?"communication":w.type,l.value=w)},b=async w=>{try{await t.deleteActivity(d.value,w)}catch(A){throw console.error("Error deleting item:",A),A}};return{activeTab:y,showInlineWidget:p,inlineWidgetType:$(()=>p.value),editingItem:l,isEditing:$(()=>l.value!==null),communicationType:h,inlineContent:s,filteredInlineContent:a,handleAddNewAction:f,handleWidgetSave:D,handleWidgetCancel:U,handleEditItem:O,handleDeleteItem:b}}const vo={class:"flex-1 flex flex-col overflow-hidden h-full"},go={class:"bg-surface border-b border shrink-0"},xo={class:"px-4 md:px-8 py-2 border-b border flex items-center justify-between"},ho={class:"flex items-center gap-2"},ko={class:"flex items-center gap-1 bg-surfaceSecondary rounded-lg p-1"},wo={key:0,class:"px-4 md:px-8 py-3 md:py-4"},$o={key:0,class:"flex-1 flex flex-row overflow-hidden"},Co={class:"flex-1 flex flex-col overflow-hidden min-w-0"},So={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Ao={class:"mb-4"},Do={key:0},To={key:0},qo={key:1,class:"mb-6"},Oo={key:2,class:"space-y-4 mb-6 px-1"},Io={key:1},No={key:0,class:"space-y-4 mb-6 px-1"},Mo={key:1,class:"flex-1 flex flex-col overflow-hidden"},jo={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Vo={key:0,class:"space-y-6"},Fo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Uo={key:1,class:"space-y-6"},Eo={key:0},Bo={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Wo={class:"p-6"},Ro={class:"grid grid-cols-4 gap-2 mb-4"},Lo={key:0,class:"space-y-3"},Po={key:0,class:"space-y-2"},zo={key:1,class:"mt-6 pt-6 border-t border"},Ho={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ko={class:"flex items-center gap-2 mb-1"},Yo={class:"text-xs font-semibold text-heading"},Go={class:"text-xs text-sub"},Qo={class:"text-sm text-body"},Jo={key:2,class:"space-y-6"},Xo={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Zo={class:"p-6"},_o={class:"space-y-2 max-h-[300px] overflow-y-auto"},ei={key:0,class:"text-center py-6 text-sub text-sm"},ti={class:"flex-1 min-w-0"},si={class:"text-sm font-medium text-heading truncate"},ai={class:"text-xs text-sub"},ni={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},li={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},oi={class:"p-6"},ii={class:"space-y-2 max-h-[300px] overflow-y-auto"},ri={key:0,class:"text-center py-6 text-sub text-sm"},di={class:"flex items-center justify-between mb-1"},ui={class:"text-xs text-sub"},ci={key:0,class:"text-sm font-medium text-heading"},mi={key:0},fi={key:1,class:"grid grid-cols-2 gap-2 mt-2 text-xs text-body"},bi={key:0},pi={key:1},yi={key:2,class:"text-xs text-body mt-2"},vi={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},gi={class:"p-6"},xi={class:"space-y-2 max-h-[300px] overflow-y-auto"},hi={key:0,class:"text-center py-6 text-sub text-sm"},ki={class:"flex items-center justify-between mb-1"},wi={class:"text-xs text-sub"},$i={key:0,class:"text-sm font-medium text-heading"},Ci={key:0},Si={key:1,class:"text-sm text-body mt-1"},Ai={key:2,class:"text-xs text-body mt-2"},Di={key:3,class:"space-y-6"},Ti={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},qi={class:"p-6"},Oi={class:"space-y-2 max-h-[600px] overflow-y-auto"},Ii={key:0,class:"text-center py-8 text-sub text-sm"},Ni={class:"text-xs text-sub mb-1"},Mi={class:"text-sm text-body"},Ei={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(t,{emit:d}){const i=t,r=lt(),p=Ve(),l=$(()=>i.task.id),y=N(localStorage.getItem("taskDetailViewMode")||"default");ae(y,S=>{localStorage.setItem("taskDetailViewMode",S)});const h=N("request"),s=[{key:"request",label:"Request"},{key:"manage",label:"Manage"},{key:"data",label:"Data"},{key:"notes",label:"Notes"}],a=N(null),f=N(""),D=N(""),U=$(()=>i.task.activities?i.task.activities.filter(S=>S.type==="note"):[]),O=$(()=>i.task.activities?i.task.activities.filter(S=>["email","call","sms","whatsapp"].includes(S.type)):[]),b=$(()=>i.task.activities?i.task.activities.filter(S=>S.type==="attachment"):[]),w=$(()=>i.task.activities?i.task.activities.filter(S=>S.type==="purchase"):[]),A=$(()=>i.task.activities?i.task.activities.filter(S=>S.type==="tradein"):[]),T=()=>{P.value="purchase",X.value=!0},V=()=>{P.value="tradein",X.value=!0},E=S=>{if(!S)return"";const c=new Date(S),W=new Date-c,G=Math.floor(W/6e4),Q=Math.floor(W/36e5),v=Math.floor(W/864e5);return G<1?"Just now":G<60?`${G}m ago`:Q<24?`${Q}h ago`:v<7?`${v}d ago`:c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},te=S=>S?new Intl.NumberFormat("en-US").format(S):"0",ge=S=>S?new Intl.NumberFormat("en-US").format(S):"0",se=S=>{a.value=a.value===S?null:S,f.value="",D.value=""},le=async()=>{if(!a.value)return;let S=a.value;if(S==="call"){await i.storeAdapter.addActivity(i.task.id,{type:"call",content:"Call logged",timestamp:new Date().toISOString()}),a.value=null;return}if(["whatsapp","sms","email"].includes(S)){if(!D.value)return;const c=S==="whatsapp"?"whatsapp":S==="sms"?"sms":"email";await i.storeAdapter.addActivity(i.task.id,{type:c,content:`Template: ${D.value}`,timestamp:new Date().toISOString()}),a.value=null,D.value=""}},oe=$(()=>i.type==="contact"?"bg-blue-100 text-blue-600":i.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),ie=$(()=>r.path.startsWith("/tasks")&&!r.path.startsWith("/customer")),Z=N(r.path.startsWith("/tasks")&&!r.path.startsWith("/customer"));ae(()=>r.path,S=>{Z.value=S.startsWith("/tasks")&&!S.startsWith("/customer")});const re=()=>{p.push({path:`/customer/${i.task.id}`,query:{type:i.type}})};function de(S){k.value=!1}const xe=()=>{x.value=!0},he=async S=>{var Y,W,G,Q;const c=S.name;i.type==="lead"?await((W=(Y=i.storeAdapter).updateLead)==null?void 0:W.call(Y,i.task.id,{assignee:c,assigneeType:S.type,teamId:S.type==="team"?S.id:null})):i.type==="opportunity"&&await((Q=(G=i.storeAdapter).updateOpportunity)==null?void 0:Q.call(G,i.task.id,{assignee:c,assigneeType:S.type,teamId:S.type==="team"?S.id:null})),x.value=!1},X=N(!1),P=N(null),k=N(!1),x=N(!1),z=N(!1),{activeTab:K,showInlineWidget:De,editingItem:Te,communicationType:Xe,inlineContent:Ze,filteredInlineContent:ke,handleAddNewAction:_e,handleWidgetSave:we,handleWidgetCancel:qe,handleEditItem:We,handleDeleteItem:Re}=yo({store:i.storeAdapter,taskId:l,getTabForItemType:po,isOverviewModalAction:S=>K.value==="overview"&&i.addNewConfig.overviewActions.includes(S)});ae(()=>i.task.id,()=>{K.value="overview"});const Oe=S=>{const c=_e(S);c&&c.modalAction&&(P.value=c.modalAction,X.value=!0)},Le=S=>{if(S==="appointment"){k.value=!0;return}const c={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(S))P.value=S,X.value=!0;else{const Y=c[S];Y?(K.value=Y,setTimeout(()=>{Oe(S),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Oe(S)}},$e=()=>{X.value=!1,P.value=null},Ie=async S=>{await we(S),$e()},et=$(()=>[{key:"overview",label:"Overview"},{key:"note",label:"Notes"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),Ce=$(()=>[...i.storeAdapter.currentActivities.value,...Ze.value]);$(()=>P.value==="financing"?"Add Financing":P.value==="tradein"?"Add Trade-in":P.value==="purchase"?"Create Purchase Offer":"");const Pe=async S=>{if(i.type==="opportunity")try{await i.storeAdapter.addVehicle(i.task.id,S.vehicleData),i.storeAdapter.loadOpportunityById&&await i.storeAdapter.loadOpportunityById(i.task.id)}catch(c){console.error("Error selecting vehicle:",c)}},ze=async S=>{if(i.type==="opportunity")try{await i.storeAdapter.createOffer(i.task.id,S.offerData),i.storeAdapter.loadOpportunityById&&await i.storeAdapter.loadOpportunityById(i.task.id)}catch(c){console.error("Error creating offer:",c)}},tt=async S=>{var W,G,Q,v;const c=i.task.tags||[];if(c.includes(S)){z.value=!1;return}const Y=[...c,S];try{i.type==="lead"?await((G=(W=i.storeAdapter).updateLead)==null?void 0:G.call(W,i.task.id,{tags:Y})):i.type==="opportunity"&&await((v=(Q=i.storeAdapter).updateOpportunity)==null?void 0:v.call(Q,i.task.id,{tags:Y})),i.type==="lead"&&i.storeAdapter.loadLeadById?await i.storeAdapter.loadLeadById(i.task.id):i.type==="opportunity"&&i.storeAdapter.loadOpportunityById&&await i.storeAdapter.loadOpportunityById(i.task.id),z.value=!1}catch(st){console.error("Error adding tag:",st)}};return(S,c)=>{var Y,W,G,Q;return n(),o("div",vo,[e("header",go,[e("div",xo,[e("div",ho,[c[23]||(c[23]=e("span",{class:"text-xs text-sub font-medium"},"View:",-1)),e("div",ko,[e("button",{onClick:c[0]||(c[0]=v=>y.value="default"),class:I(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",y.value==="default"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"])},[...c[21]||(c[21]=[e("i",{class:"fa-solid fa-align-left text-xs"},null,-1),e("span",null,"Default",-1)])],2),e("button",{onClick:c[1]||(c[1]=v=>y.value="grid"),class:I(["px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5",y.value==="grid"?"bg-surface text-heading shadow-sm":"text-sub hover:text-body"])},[...c[22]||(c[22]=[e("i",{class:"fa-solid fa-grip text-xs"},null,-1),e("span",null,"Grid",-1)])],2)])])]),y.value==="default"?(n(),o("div",wo,[C(Nt,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":oe.value,"task-type":t.type,"customer-id":((Y=t.task.customer)==null?void 0:Y.id)||t.task.customerId||t.task.id,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Le,onAddTag:c[2]||(c[2]=v=>z.value=!0)},{tags:q(()=>[(n(!0),o(L,null,H(t.task.tags,v=>(n(),o("span",{key:v,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},u(v),1))),128))]),"name-action":q(()=>[ie.value?(n(),o("button",{key:0,onClick:re,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...c[24]||(c[24]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):m("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id"])])):m("",!0)]),y.value==="default"?(n(),o("div",$o,[e("div",Co,[e("main",So,[e("div",Ao,[C(Ke,{modelValue:g(K),"onUpdate:modelValue":c[3]||(c[3]=v=>ot(K)?K.value=v:null),tabs:et.value,class:"mb-0"},null,8,["modelValue","tabs"])]),g(K)==="overview"?(n(),o("div",Do,[t.type!=="contact"?(n(),o("div",To,[C(Bs,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((G=t.task.requestedCar)==null?void 0:G.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:xe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):m("",!0),je(S.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(n(),o("div",qo,[(n(),B(He(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ce.value,onCarAdded:c[4]||(c[4]=v=>S.$emit("car-added",v)),onConvertToLead:c[5]||(c[5]=v=>S.$emit("convert-to-lead")),onConvertToOpportunity:c[6]||(c[6]=v=>S.$emit("convert-to-opportunity")),onVehicleSelected:Pe,onCreateOffer:ze},null,40,["lead","opportunity","contact","activities"]))])):m("",!0),g(ke).length>0?(n(),o("div",Oo,[(n(!0),o(L,null,H(g(ke),v=>(n(),B(Ye,{key:v.id,item:v,"task-type":t.type,"customer-initials":"SK",onEdit:g(We),onDelete:g(Re)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):m("",!0)])):(n(),o("div",Io,[C(Ma,{actions:t.addNewConfig.tabActions,"active-tab":g(K),onAction:Oe},null,8,["actions","active-tab"]),e("div",null,[g(De)==="communication"?(n(),B(yl,{key:0,type:g(Xe),"task-type":t.type,"task-id":t.task.id,item:g(Te),onSave:g(we),onCancel:g(qe)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):m("",!0),g(De)==="note"?(n(),B(kl,{key:1,item:g(Te),"task-type":t.type,"task-id":t.task.id,onSave:g(we),onCancel:g(qe)},null,8,["item","task-type","task-id","onSave","onCancel"])):m("",!0),g(De)==="attachment"?(n(),B(ql,{key:2,item:g(Te),"task-type":t.type,"task-id":t.task.id,onSave:g(we),onCancel:g(qe)},null,8,["item","task-type","task-id","onSave","onCancel"])):m("",!0)]),g(ke).length>0?(n(),o("div",No,[(n(!0),o(L,null,H(g(ke),v=>(n(),B(Ye,{key:v.id,item:v,"task-type":t.type,"customer-initials":"SK",onEdit:g(We),onDelete:g(Re)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):m("",!0)]))])]),C(Ge,{title:"Activity summary",activities:Ce.value,collapsed:Z.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:c[7]||(c[7]=v=>Z.value=!Z.value)},null,8,["activities","collapsed"])])):y.value==="grid"?(n(),o("div",Mo,[e("div",jo,[C(Ke,{modelValue:h.value,"onUpdate:modelValue":c[8]||(c[8]=v=>h.value=v),tabs:s,class:"mb-6"},null,8,["modelValue"]),h.value==="request"?(n(),o("div",Vo,[e("div",Fo,[t.type!=="contact"?(n(),B(ca,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe},null,8,["task","entity-type","activities"])):m("",!0),C(Ta,{task:t.task,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,onAction:Le,onAddTag:c[9]||(c[9]=v=>z.value=!0)},null,8,["task","task-type","customer-id"])]),C(Ge,{title:"Activity summary",activities:Ce.value,collapsed:!1,"show-collapse":!1,show:!0,class:"!w-full border border rounded-xl shadow-sm"},null,8,["activities"])])):m("",!0),h.value==="manage"?(n(),o("div",Uo,[t.managementWidget?(n(),o("div",Eo,[(n(),B(He(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ce.value,onCarAdded:c[10]||(c[10]=v=>S.$emit("car-added",v)),onConvertToLead:c[11]||(c[11]=v=>S.$emit("convert-to-lead")),onConvertToOpportunity:c[12]||(c[12]=v=>S.$emit("convert-to-opportunity")),onVehicleSelected:Pe,onCreateOffer:ze},null,40,["lead","opportunity","contact","activities"]))])):m("",!0),e("div",Bo,[e("div",Wo,[c[31]||(c[31]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-comments text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Communicate")],-1)),e("div",Ro,[e("button",{onClick:c[13]||(c[13]=v=>se("call")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="call"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...c[25]||(c[25]=[e("i",{class:"fa-solid fa-phone text-base"},null,-1),e("span",{class:"text-xs"},"Call",-1)])],2),e("button",{onClick:c[14]||(c[14]=v=>se("whatsapp")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="whatsapp"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...c[26]||(c[26]=[e("i",{class:"fa-brands fa-whatsapp text-base"},null,-1),e("span",{class:"text-xs"},"WhatsApp",-1)])],2),e("button",{onClick:c[15]||(c[15]=v=>se("sms")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="sms"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...c[27]||(c[27]=[e("i",{class:"fa-solid fa-message text-base"},null,-1),e("span",{class:"text-xs"},"SMS",-1)])],2),e("button",{onClick:c[16]||(c[16]=v=>se("email")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="email"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...c[28]||(c[28]=[e("i",{class:"fa-solid fa-envelope text-base"},null,-1),e("span",{class:"text-xs"},"Email",-1)])],2)]),a.value?(n(),o("div",Lo,[["whatsapp","sms","email"].includes(a.value)?(n(),o("div",Po,[c[30]||(c[30]=e("label",{class:"block text-xs font-medium text-body"},"Select Template",-1)),j(e("select",{"onUpdate:modelValue":c[17]||(c[17]=v=>D.value=v),class:"w-full bg-surface border border rounded-lg px-3 py-2 text-sm text-body focus:outline-none focus:border-brand-red"},[...c[29]||(c[29]=[e("option",{value:""},"Select a template...",-1),e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[Ae,D.value]]),e("button",{onClick:le,class:"px-4 py-2 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors"}," Send "+u(a.value==="whatsapp"?"WhatsApp":a.value==="sms"?"SMS":"Email"),1)])):m("",!0)])):m("",!0),O.value.length>0?(n(),o("div",zo,[e("div",Ho,[(n(!0),o(L,null,H(O.value,v=>(n(),o("div",{key:v.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",Ko,[e("span",Yo,u(v.type),1),e("span",Go,u(E(v.timestamp)),1)]),e("p",Qo,u(v.content),1)]))),128))])])):m("",!0)])])])):m("",!0),h.value==="data"?(n(),o("div",Jo,[e("div",Xo,[e("div",Zo,[c[34]||(c[34]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-paperclip text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Attachments")],-1)),e("div",_o,[b.value.length===0?(n(),o("div",ei,[...c[32]||(c[32]=[e("i",{class:"fa-solid fa-paperclip text-2xl mb-2"},null,-1),e("p",null,"No attachments yet",-1)])])):m("",!0),(n(!0),o(L,null,H(b.value,v=>(n(),o("div",{key:v.id,class:"p-3 bg-surfaceSecondary border border rounded-lg flex items-center gap-3"},[c[33]||(c[33]=e("i",{class:"fa-solid fa-file text-sub text-lg"},null,-1)),e("div",ti,[e("div",si,u(v.filename),1),e("div",ai,u(E(v.timestamp)),1)])]))),128))])])]),e("div",ni,[e("div",li,[e("div",oi,[e("div",{class:"flex items-center justify-between mb-4"},[c[36]||(c[36]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Trade-in")],-1)),e("button",{onClick:V,class:"px-3 py-1.5 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors flex items-center gap-1.5"},[...c[35]||(c[35]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",ii,[A.value.length===0?(n(),o("div",ri,[...c[37]||(c[37]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-2xl mb-2"},null,-1),e("p",null,"No trade-ins yet",-1)])])):m("",!0),(n(!0),o(L,null,H(A.value,v=>(n(),o("div",{key:v.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",di,[e("div",ui,u(E(v.timestamp)),1)]),v.data&&v.data.brand?(n(),o("div",ci,[M(u(v.data.brand)+" "+u(v.data.model)+" ",1),v.data.version?(n(),o("span",mi,u(v.data.version),1)):m("",!0)])):m("",!0),v.data&&(v.data.kilometers||v.data.price)?(n(),o("div",fi,[v.data.kilometers?(n(),o("div",bi,[c[38]||(c[38]=e("span",{class:"text-sub"},"KM:",-1)),M(" "+u(ge(v.data.kilometers)),1)])):m("",!0),v.data.price?(n(),o("div",pi,[c[39]||(c[39]=e("span",{class:"text-sub"},"Price:",-1)),M(" € "+u(te(v.data.price)),1)])):m("",!0)])):m("",!0),v.content?(n(),o("div",yi,u(v.content),1)):m("",!0)]))),128))])])]),e("div",vi,[e("div",gi,[e("div",{class:"flex items-center justify-between mb-4"},[c[41]||(c[41]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-shopping-cart text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Purchase")],-1)),e("button",{onClick:T,class:"px-3 py-1.5 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors flex items-center gap-1.5"},[...c[40]||(c[40]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",xi,[w.value.length===0?(n(),o("div",hi,[...c[42]||(c[42]=[e("i",{class:"fa-solid fa-shopping-cart text-2xl mb-2"},null,-1),e("p",null,"No purchases yet",-1)])])):m("",!0),(n(!0),o(L,null,H(w.value,v=>(n(),o("div",{key:v.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",ki,[e("div",wi,u(E(v.timestamp)),1)]),v.data&&v.data.brand?(n(),o("div",$i,[M(u(v.data.brand)+" "+u(v.data.model)+" ",1),v.data.year?(n(),o("span",Ci,"("+u(v.data.year)+")",1)):m("",!0)])):m("",!0),v.data&&v.data.price?(n(),o("div",Si," € "+u(te(v.data.price)),1)):m("",!0),v.content?(n(),o("div",Ai,u(v.content),1)):m("",!0)]))),128))])])])])])):m("",!0),h.value==="notes"?(n(),o("div",Di,[e("div",Ti,[e("div",qi,[c[44]||(c[44]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-note-sticky text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Notes")],-1)),e("div",Oi,[U.value.length===0?(n(),o("div",Ii,[...c[43]||(c[43]=[e("i",{class:"fa-solid fa-note-sticky text-2xl mb-2"},null,-1),e("p",null,"No notes yet",-1)])])):m("",!0),(n(!0),o(L,null,H(U.value,v=>(n(),o("div",{key:v.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",Ni,u(E(v.timestamp)),1),e("p",Mi,u(v.content),1)]))),128))])])])])):m("",!0)])])):m("",!0),C(Ul,{show:P.value==="financing"&&X.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Ie,onClose:$e},null,8,["show","task-type","task-id"]),C(Hl,{show:P.value==="tradein"&&X.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Ie,onClose:$e},null,8,["show","task-type","task-id"]),C(ro,{show:P.value==="purchase"&&X.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:Ie,onClose:$e},null,8,["show","task-type","task-id","requested-car"]),C(it,{show:x.value,onClose:c[18]||(c[18]=v=>x.value=!1),onConfirm:he},null,8,["show"]),k.value?(n(),B(rt,{key:2,show:k.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:de,onCancel:c[19]||(c[19]=v=>k.value=!1)},null,8,["show","customer","assignee"])):m("",!0),C(bo,{show:z.value,"existing-tags":t.task.tags||[],onClose:c[20]||(c[20]=v=>z.value=!1),onAdd:tt},null,8,["show","existing-tags"])])}}},Be={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const d=t.deliverySubstatus;return d==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:d==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Me={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function ee(t){if(!t)return 0;const d=new Date(t),r=Math.abs(new Date-d);return Math.ceil(r/(1e3*60*60*24))}const ne={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const d=_(),i=d.getSetting("oofbMinDays"),r=d.getSetting("oofbMaxDays"),p=ee(t.opportunity.createdAt);return p>=i&&p<r+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const i=_().getSetting("ufbDays");return ee(t.opportunity.createdAt)>=i&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const i=_().getSetting("ofbDays");return ee(t.opportunity.lastActivity||t.opportunity.createdAt)>=i&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const i=_().getSetting("nfuDays"),r=ee(t.opportunity.lastActivity||t.opportunity.createdAt),p=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return r>=i&&!t.opportunity.contractDate&&!p&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var l;if(!t.opportunity.contractDate)return!1;const i=_().getSetting("cfbDays"),r=ee(t.opportunity.contractDate),p=(l=t.activities)==null?void 0:l.some(y=>{var h;return y.type==="delivery"||((h=y.action)==null?void 0:h.toLowerCase().includes("delivered"))});return r>=i&&!p},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var l;const d=(l=t.activities)==null?void 0:l.find(y=>{var h;return y.type==="delivery"||((h=y.action)==null?void 0:h.toLowerCase().includes("delivered"))});if(!d)return!1;const r=_().getSetting("dfbDays");return ee(d.timestamp)>=r},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const d=t.stage;return d==="Closed Won"||d==="Closed Lost"},"is-closed-with-task-widget":t=>ne["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(ne["is-closed"](t))return!1;const d=_(),i=d.getSetting("abandonedOpportunityDays");if(!d.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const p=t.opportunity.lastActivity||t.opportunity.createdAt;return ee(p)>=i}};function Bi(t,d){if(ne["is-closed-with-task-widget"](d))return[Me.reopen,Me.requalify,Me.closeLost];const i=Be[t];return!i||!i.secondaryActions?[]:i.secondaryActions.filter(r=>{if(!r.conditional)return!0;const p=ne[r.conditional];return p?p(d):!0})}function Wi(t,d){const i=Be[t];if(!i||!i.taskWidgets)return null;const p=_().getSetting("autoCloseWidgetsOnClose"),l=ne["is-closed"]({stage:t});for(const y of i.taskWidgets){if(p&&l&&(y.type==="NFU"||y.type==="OFB"))continue;const h=ne[y.condition];if(h&&h(d))return y.type}return null}function Ri(t,d){const i=Be[t];if(!i||!i.primaryAction)return null;const r=i.primaryAction;return{...r,title:typeof r.title=="function"?r.title(d):r.title,description:typeof r.description=="function"?r.description(d):r.description,label:typeof r.label=="function"?r.label(d):r.label}}function Li(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function Pi(t){return t==="Closed Won"||t==="Closed Lost"}const zi={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:d}){const i=d,r=l=>{l||i("close")},p=()=>{i("close")};return(l,y)=>(n(),B(g(ve),{open:t.show,"onUpdate:open":r},{default:q(()=>[C(g(ce),null,{default:q(()=>[C(g(me),{class:"fixed inset-0 z-50 bg-black/50"}),C(g(fe),{class:"w-full sm:max-w-md"},{default:q(()=>[C(g(be),null,{default:q(()=>[C(g(pe),null,{default:q(()=>[M(u(t.title),1)]),_:1})]),_:1}),y[0]||(y[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),C(g(ye),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:q(()=>[C(g(R),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:p})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Ei as _,kl as a,Ri as b,Bi as c,Li as d,oo as e,zi as f,Wi as g,Pi as i};
