const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CNXtwH7T.js","assets/index-i7KKwmF7.css"])))=>i.map(i=>d[i]);
import{a2 as C,a3 as m,a4 as D,a5 as i,W as _,a6 as T,a7 as I,a0 as k,r as h,c as x}from"./index-CNXtwH7T.js";const l=(a=300)=>new Promise(e=>setTimeout(e,a)),A=async(a={})=>{await l();let e=[...i];if(a.search){const t=a.search.toLowerCase();e=e.filter(n=>{var c;return n.name.toLowerCase().includes(t)||n.email.toLowerCase().includes(t)||((c=n.company)==null?void 0:c.toLowerCase().includes(t))})}return{data:e,total:e.length}},S=async a=>{await l();const e=i.find(t=>t.id===parseInt(a));if(!e)throw new Error("Contact not found");return e},B=async a=>{await l();const e={id:i.length+1,...a,createdAt:new Date().toISOString()};return i.push(e),e},$=async(a,e)=>{await l();const t=i.findIndex(n=>n.id===parseInt(a));if(t===-1)throw new Error("Contact not found");return i[t]={...i[t],...e},i[t]},P=async a=>{await l();const e=i.findIndex(t=>t.id===parseInt(a));if(e===-1)throw new Error("Contact not found");return i.splice(e,1),{success:!0}},R=async(a,e)=>{await l();const t=i.find(n=>n.id===parseInt(a));if(!t)throw new Error("Contact not found");return t.requestedCar={...e,id:Date.now()},{...t}},Q=async a=>{await l();const e=i.find(c=>c.id===parseInt(a));if(!e)throw new Error("Contact not found");if(!e.requestedCar)throw new Error("Contact must have requested car");const{createLead:t}=await I(async()=>{const{createLead:c}=await import("./index-CNXtwH7T.js").then(f=>f.aY);return{createLead:c}},__vite__mapDeps([0,1]));return await t({customerId:e.customerId,requestedCar:e.requestedCar,source:e.source||"Direct",tags:e.tags||[],stage:"Open Lead",status:"Open",priority:"Normal"})},b=async a=>{await l();const e=i.find(c=>c.id===parseInt(a));if(!e)throw new Error("Contact not found");if(!e.requestedCar)throw new Error("Contact must have requested car");const{createOpportunity:t}=await I(async()=>{const{createOpportunity:c}=await import("./index-CNXtwH7T.js").then(f=>f.aZ);return{createOpportunity:c}},__vite__mapDeps([0,1]));return await t({customerId:e.customerId,vehicle:e.requestedCar,source:e.source||"Direct",tags:e.tags||[],stage:"Qualified",value:e.requestedCar.price||0})},W=async a=>{await l();const e=C.filter(t=>t.customerId===parseInt(a));return{data:e,total:e.length}},j=async a=>{await l();const e=m.filter(t=>t.customerId===parseInt(a));return{data:e,total:e.length}},N=async a=>{await l();const e=[],t=i.find(r=>r.customerId===parseInt(a));t!=null&&t.id,C.filter(r=>r.customerId===parseInt(a)).forEach(r=>{r.requestedCar&&e.push({...r.requestedCar,id:`requested-${r.id}`,type:"requested",leadId:r.id,leadStage:r.stage})}),t!=null&&t.requestedCar&&e.push({...t.requestedCar,id:`requested-contact-${t.id}`,type:"requested",contactId:t.id});const c=m.filter(r=>r.customerId===parseInt(a));return c.forEach(r=>{_.filter(d=>d.opportunityId===r.id&&d.type==="offer").forEach(d=>{var w;(w=d.data)!=null&&w.vehicle&&e.push({...d.data.vehicle,id:`offered-${d.id}`,type:"offered",opportunityId:r.id,opportunityStage:r.stage,offerDate:d.timestamp})})}),T.filter(r=>r.customerId===parseInt(a)&&r.type==="test-drive").forEach(r=>{r.vehicle&&e.push({brand:r.vehicle.split(" ")[0]||"",model:r.vehicle.split(" ").slice(1).join(" ")||"",id:`drove-${r.id}`,type:"drove",eventId:r.id,testDriveDate:r.start,vehicle:r.vehicle})}),c.forEach(r=>{r.stage==="Closed Won"&&r.vehicle&&e.push({...r.vehicle,id:`purchased-${r.id}`,type:"purchased",opportunityId:r.id,purchaseDate:r.contractDate||r.lastActivity})}),{data:e,total:e.length}},Y=async a=>{await l();const e=D.filter(t=>t.customerId===parseInt(a));return{data:e,total:e.length}},Z=k("contacts",()=>{const a=h([]),e=h(null),t=h(!1),n=h(null),c=h(""),f=x(()=>a.value.length);async function r(){t.value=!0,n.value=null;try{const o=await A({search:c.value});a.value=o.data}catch(o){n.value=o.message}finally{t.value=!1}}async function p(o){t.value=!0,n.value=null;try{return e.value=await S(o),e.value}catch(s){throw n.value=s.message,s}finally{t.value=!1}}async function d(o){t.value=!0,n.value=null;try{const s=await B(o);return a.value.unshift(s),s}catch(s){throw n.value=s.message,s}finally{t.value=!1}}async function w(o,s){t.value=!0,n.value=null;try{const u=await $(o,s),v=a.value.findIndex(y=>y.id===o);return v!==-1&&(a.value[v]=u),u}catch(u){throw n.value=u.message,u}finally{t.value=!1}}async function g(o){t.value=!0,n.value=null;try{await P(o),a.value=a.value.filter(s=>s.id!==o)}catch(s){throw n.value=s.message,s}finally{t.value=!1}}function E(o){c.value=o,r()}async function q(o,s){t.value=!0,n.value=null;try{const u=await R(o,s),v=a.value.findIndex(y=>y.id===o);return v!==-1&&(a.value[v]=u),e.value&&e.value.id===o&&(e.value=u),u}catch(u){throw n.value=u.message,u}finally{t.value=!1}}async function L(o){t.value=!0,n.value=null;try{const s=await Q(o);return a.value=a.value.filter(u=>u.id!==o),e.value=null,s}catch(s){throw n.value=s.message,s}finally{t.value=!1}}async function O(o){t.value=!0,n.value=null;try{const s=await b(o);return a.value=a.value.filter(u=>u.id!==o),e.value=null,s}catch(s){throw n.value=s.message,s}finally{t.value=!1}}return{contacts:a,currentContact:e,loading:t,error:n,searchQuery:c,totalContacts:f,loadContacts:r,loadContactById:p,addContact:d,modifyContact:w,removeContact:g,setSearchQuery:E,addRequestedCar:q,convertToLead:L,convertToOpportunity:O}});export{j as a,Y as b,N as c,W as f,Z as u};
