import{H as $e,I as Ae,J as _e,K as re,c as N,r as B,L as Te,d as S,o as C,g as F,p as ne,e as f,w as ae,F as J,i as X,t as U,n as P,k as fe,M as et,s as W,B as z,T as xe,l as te,y as M,N as tt,x as Z,O as ee,P as oe,Q as L,u as De,C as st,R as nt,m as at,j as lt,h as rt,S as we}from"./index-DqWyOYoU.js";import{u as ot}from"./opportunities-Cr-mXogK.js";import{u as Ie}from"./users-CkqXh-gx.js";import{n as le,z as pe}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-SVS8Zwad-DVNwBQcn.js";import{L as it,O as ut,g as ge,f as ct,a as dt,b as pt,c as Le,d as Me,e as ft}from"./opportunityRules-BaC5nmNU.js";import{R as gt}from"./components-4J0anYM3.js";import{u as yt,a as ke,T as Ce,D as mt}from"./useTaskFilters-C8u1sOq-.js";import{_ as vt}from"./ReassignUserModal-Bfeq1bLz.js";import"./sparkles-C-JQGf45.js";import"./vehicles-BiOUVEQF.js";import"./CreateEventModal-JUBstLnD.js";import"./EditEventModal-CNPRdaMu.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=$e("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=$e("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function bt(e){if(!e)return null;if(e.title)return e.title;const v=e.type||(e.customer?"opportunity":"lead"),s=Ae(e,v);if(v==="lead"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const x=it[s];if(!x||!x.primaryAction)return null;const a=x.primaryAction,m={lead:e,displayStage:s},p=typeof a=="function"?a(m):a;if(!p)return null;const c=typeof p.label=="function"?p.label(m):p.label,d=typeof p.title=="function"?p.title(m):p.title;return c||d||null}if(v==="opportunity"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const x=ut[s];if(!x||!x.primaryAction)return null;const a=x.primaryAction,m={deliverySubstatus:e.deliverySubstatus||_e(e,e.activities||[]),hasOffers:!!(e.offers&&e.offers.length>0)||!!(e.activities&&e.activities.some(y=>y.type==="offer")),scheduledAppointment:e.scheduledAppointment,opportunity:e,formatDateTime:y=>new Date(y).toLocaleDateString()},p=typeof a=="function"?a(m):a;if(!p)return null;const c=typeof p.label=="function"?p.label(m):p.label,d=typeof p.title=="function"?p.title(m):p.title;return c||d||null}return null}const ht=["onClick"],xt={class:"flex flex-col min-w-0 flex-1 pr-4"},wt={class:"flex items-center gap-1 mb-0.5"},kt={key:0,class:"font-bold text-heading text-fluid-base truncate"},Ct={class:"flex items-center gap-2 overflow-hidden"},St={class:"text-sub text-fluid-sm truncate"},$t={class:"flex flex-wrap items-center gap-2 mt-2"},At={key:1,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},Tt={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(e,{emit:v}){const s=e,x=N(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),a=N(()=>s.selected),m=N(()=>a.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),p=N(()=>{var n;return a.value?((n=s.item)==null?void 0:n.type)==="opportunity"?"task-card-selected task-card-selected-opportunity":"task-card-selected":""}),c=n=>n?n.stage||n.currentStage||"New":"",d=n=>{if(!n||n.type!=="opportunity")return null;try{return Ae(n,"opportunity")}catch{return n.displayStage||n.stage||null}},y=n=>{if(!n)return"";if(n.type==="opportunity"){const $=d(n)||n.stage||n.currentStage||"New";c(n);const i=g(n);return i&&i!==$?i:$}return n.stage||n.currentStage||n.displayStage||"New"},g=n=>{if(!n||n.type!=="opportunity")return"";const $=c(n),i=d(n);if(!i||!$)return i||"";const O=$.toLowerCase().trim();if(i.toLowerCase().trim().startsWith(O+" - ")){const l=$+" - ";if(i.startsWith(l))return i.substring(l.length)}return i},o=(n,$="opportunity")=>{if(!n)return"bg-gray-50 text-gray-700 border-gray-200";try{const i=et(n,$);return i.includes("blue")?i+" border-blue-200":i.includes("purple")?i+" border-purple-200":i.includes("yellow")?i+" border-yellow-200":i.includes("pink")?i+" border-pink-200":i.includes("indigo")?i+" border-indigo-200":i.includes("emerald")?i+" border-emerald-200":i.includes("green")?i+" border-green-200":i.includes("red")?i+" border-red-200":(i.includes("gray"),i+" border-gray-200")}catch{const O=n.toLowerCase();return O.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":O.includes("qualif")?"bg-green-50 text-green-600 border-green-200":O.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":O.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}},w=N(()=>{const n=s.item;if(!n)return"bg-gray-50 text-gray-700 border-gray-200";if(n.type==="opportunity"){const i=d(n)||c(n);return o(i,"opportunity")}const $=y(n).toLowerCase();return $.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":$.includes("qualif")?"bg-green-50 text-green-600 border-green-200":$.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":$.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"}),A=N(()=>bt(s.item)),b=N(()=>{const n=s.item.nextActionDue||s.item.dueDate;if(!n)return null;const $=ge(n);return{text:ct(n),status:$}}),j=N(()=>b.value?b.value.status.textClass.replace("text-","bg-"):""),I=B(null);return(n,$)=>{const i=Te("click-outside");return C(),S("div",{ref_key:"cardRef",ref:I,class:P(["task-card bg-white rounded-xl p-4 flex items-center justify-between cursor-pointer relative transition-all border group",[m.value,p.value]]),onClick:$[2]||($[2]=O=>n.$emit("select",x.value))},[e.showMenu?(C(),S("button",{key:0,onClick:$[0]||($[0]=ae(O=>n.$emit("menu-click",e.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 z-10"},[...$[3]||($[3]=[f("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):F("",!0),e.openMenuId===e.item.id&&e.showMenu?ne((C(),S("div",{key:1,class:"absolute right-2 top-7 z-50 w-40 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:$[1]||($[1]=ae(()=>{},["stop"]))},[(C(!0),S(J,null,X(e.menuItems,O=>(C(),S("button",{key:O.key,onClick:O.onClick,class:"w-full px-3 py-2 text-left text-xs text-heading hover:bg-surfaceSecondary flex items-center gap-2"},U(O.label),9,ht))),128))])),[[i,()=>n.$emit("menu-close")]]):F("",!0),f("div",xt,[f("div",wt,[A.value?(C(),S("h3",kt,U(A.value),1)):F("",!0),b.value?(C(),S("span",{key:1,class:P(["flex items-center gap-1 text-[10px] font-bold uppercase leading-none shrink-0",b.value.status.textClass])},[f("span",{class:P(["w-1.5 h-1.5 rounded-full",j.value])},null,2),fe(" "+U(b.value.text),1)],2)):F("",!0)]),f("div",Ct,[f("span",St,U(e.getName(e.item)),1)]),f("div",$t,[f("span",{class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",e.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},U(e.item.type==="lead"?"Lead":"Opportunity"),3),y(e.item)?(C(),S("span",{key:0,class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",w.value])},U(y(e.item)),3)):F("",!0),e.item.priority==="Hot"?(C(),S("span",At," Hot ")):F("",!0)])])],2)}}},Dt=re(Tt,[["__scopeId","data-v-83b800f6"]]),It={key:0,class:"flex flex-col gap-2"},Lt={class:"flex items-center gap-1.5 flex-wrap"},Mt={class:"relative",ref:"filterContainer"},Nt={key:0,class:"filter-indicator"},Ft=["onClick"],Ot=["onClick"],qt={key:0,class:"flex items-center gap-1.5 flex-wrap"},Bt=["onClick"],Ut={key:0,class:"task-filter-badge"},Rt={key:1,class:"relative",ref:"filterContainer"},Ht={key:0,class:"filter-indicator"},Vt=["onClick"],Wt=["onClick"],zt={key:2,class:"flex items-center gap-1.5 flex-wrap"},Et=["onClick"],jt={key:0,class:"task-filter-badge"},Se={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:""},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(e,{emit:v}){const s=e,x=v,a=B(!1),m=()=>{a.value=!a.value},p=()=>{a.value=!1},c=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],d=I=>{const n=c.find($=>$.key===I);return n?n.label:I},y=I=>{a.value=!1;const n=[...s.activeFilters],$=n.indexOf(I);$>-1?n.splice($,1):n.push(I),x("filter-change",n)},g=I=>{const n=[...s.activeFilters],$=n.indexOf(I);$>-1&&(n.splice($,1),x("filter-change",n))},o=I=>{a.value=!1,x("sort-change",I)},w=()=>{x("sort-change","")},A=N(()=>{const I=s.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First"},...I?[{key:"urgent-first",label:"Urgent first"}]:[],{key:"assigned-to-me",label:"Assigned to me"},{key:"assigned-to-my-team",label:"Assigned to my team"}]}),b=N(()=>s.sortOption&&s.sortOption!==""&&s.sortOption!=="none"),j=N(()=>{const I=A.value.find(n=>n.key===s.sortOption);return I?I.label:s.sortOption});return(I,n)=>{const $=Te("click-outside");return!e.buttonOnly&&!e.chipsOnly?(C(),S("div",It,[f("div",Lt,[ne((C(),S("div",Mt,[f("button",{onClick:m,class:"filter-dropdown-button"},[n[2]||(n[2]=f("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(C(),S("span",Nt)):F("",!0)]),W(xe,{name:"dropdown-fade"},{default:z(()=>[a.value?(C(),S("div",{key:0,class:"absolute left-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:n[0]||(n[0]=ae(()=>{},["stop"]))},[(C(),S(J,null,X(c,i=>f("button",{key:i.key,onClick:O=>y(i.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes(i.key)}])},[f("span",null,U(i.label),1)],10,Ft)),64)),n[3]||(n[3]=f("div",{class:"border-t border-black/10 my-1"},null,-1)),(C(!0),S(J,null,X(A.value,i=>(C(),S("button",{key:i.key,onClick:O=>o(i.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":i.key===e.sortOption}])},[f("span",null,U(i.label),1)],10,Ot))),128))])):F("",!0)]),_:1})])),[[$,p]]),e.activeFilters.length>0||b.value?(C(),S("div",qt,[(C(!0),S(J,null,X(e.activeFilters,i=>(C(),S("div",{key:i,class:"task-filter-badge"},[f("span",null,U(d(i)),1),f("button",{onClick:O=>g(i),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...n[4]||(n[4]=[f("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Bt)]))),128)),b.value?(C(),S("div",Ut,[f("span",null,U(j.value),1),f("button",{onClick:w,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...n[5]||(n[5]=[f("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)])])):e.buttonOnly?ne((C(),S("div",Rt,[f("button",{onClick:m,class:"filter-dropdown-button"},[n[6]||(n[6]=f("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(C(),S("span",Ht)):F("",!0)]),W(xe,{name:"dropdown-fade"},{default:z(()=>[a.value?(C(),S("div",{key:0,class:"absolute right-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:n[1]||(n[1]=ae(()=>{},["stop"]))},[(C(),S(J,null,X(c,i=>f("button",{key:i.key,onClick:O=>y(i.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes(i.key)}])},[f("span",null,U(i.label),1)],10,Vt)),64)),n[7]||(n[7]=f("div",{class:"border-t border-black/10 my-1"},null,-1)),(C(!0),S(J,null,X(A.value,i=>(C(),S("button",{key:i.key,onClick:O=>o(i.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":i.key===e.sortOption}])},[f("span",null,U(i.label),1)],10,Wt))),128))])):F("",!0)]),_:1})])),[[$,p]]):e.chipsOnly&&(e.activeFilters.length>0||b.value)?(C(),S("div",zt,[(C(!0),S(J,null,X(e.activeFilters,i=>(C(),S("div",{key:i,class:"task-filter-badge"},[f("span",null,U(d(i)),1),f("button",{onClick:O=>g(i),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...n[8]||(n[8]=[f("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Et)]))),128)),b.value?(C(),S("div",jt,[f("span",null,U(j.value),1),f("button",{onClick:w,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...n[9]||(n[9]=[f("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)}}},Pt={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},Qt={class:"page-header shrink-0"},Kt={class:"page-header-main"},Yt={class:"page-header-content"},Gt={class:"page-header-title-container"},Jt={class:"page-header-title"},Xt={class:"page-header-actions"},Zt={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},_t={class:"px-5 py-3"},es={class:"flex items-center gap-2"},ts={class:"relative flex-1"},ss=["placeholder"],ns={key:0,class:"mt-2"},as={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:e=>e.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(e,{emit:v}){const s=e,x=v,a=B(s.initialSearchQuery),m=B(null),p=B(""),c=N(()=>typeof s.title=="string"?s.title:typeof s.title=="function"?(console.warn("TasksList: title prop received a function instead of a string. Using default title."),"Tasks"):s.title||"Tasks");te(()=>s.initialSearchQuery,o=>{a.value=o});const d=N(()=>{let o=s.items;const w=s.activeFilters.filter(b=>b==="lead"||b==="opportunity");if(w.length>0&&(o=o.filter(b=>!!(b.type&&w.includes(b.type)))),!a.value.trim())return o;const A=a.value.toLowerCase().trim();return o.filter(b=>{const j=s.getName(b).toLowerCase(),I=s.getVehicleInfo(b).toLowerCase();return j.includes(A)||I.includes(A)})}),y=o=>{if(!s.selectedId)return!1;const w=o.compositeId||`${o.type||"task"}-${o.id}`;return String(w)===String(s.selectedId)},g=o=>{p.value=o,x("sort-change",o)};return(o,w)=>(C(),S("div",Pt,[f("header",Qt,[f("div",Kt,[f("div",Yt,[f("div",Gt,[f("h1",Jt,U(c.value),1)]),f("div",Xt,[f("div",Zt,[W(M(le),{variant:"secondary",size:"icon",onClick:w[0]||(w[0]=A=>o.$emit("view-change","card")),class:P(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:z(()=>[W(M(Ne),{size:14})]),_:1},8,["class","aria-pressed"]),W(M(le),{variant:"secondary",size:"icon",onClick:w[1]||(w[1]=A=>o.$emit("view-change","table")),class:P(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:z(()=>[W(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"])])])])])]),f("div",_t,[f("div",es,[f("div",ts,[w[8]||(w[8]=f("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),ne(f("input",{"onUpdate:modelValue":w[2]||(w[2]=A=>a.value=A),type:"text",placeholder:e.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,ss),[[tt,a.value]])]),W(Se,{"active-filters":e.activeFilters,"sort-option":p.value,"button-only":!0,onFilterChange:w[3]||(w[3]=A=>o.$emit("filter-change",A)),onSortChange:g},null,8,["active-filters","sort-option"])]),e.activeFilters.length>0?(C(),S("div",ns,[W(Se,{"active-filters":e.activeFilters,"sort-option":p.value,"chips-only":!0,onFilterChange:w[4]||(w[4]=A=>o.$emit("filter-change",A)),onSortChange:g},null,8,["active-filters","sort-option"])])):F("",!0)]),f("div",{ref_key:"scrollContainer",ref:m,class:"task-list-cards flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(C(!0),S(J,null,X(d.value,A=>(C(),Z(Dt,{key:A.compositeId||`${A.type||"task"}-${A.id}`,item:A,selected:y(A),"selected-class":e.selectedClass,"unselected-class":e.unselectedClass,"show-menu":e.showMenu,"open-menu-id":e.openMenuId,getName:e.getName,getVehicleInfo:e.getVehicleInfo,"menu-items":e.getMenuItems?e.getMenuItems(A):null,onSelect:w[5]||(w[5]=b=>o.$emit("select",b)),onMenuClick:w[6]||(w[6]=b=>o.$emit("menu-click",b)),onMenuClose:w[7]||(w[7]=b=>o.$emit("menu-close"))},{location:z(({item:b})=>[ee(o.$slots,"location",{item:b},void 0,!0)]),source:z(({item:b})=>[ee(o.$slots,"source",{item:b},void 0,!0)]),owner:z(({item:b})=>[ee(o.$slots,"owner",{item:b},void 0,!0)]),dates:z(({item:b})=>[ee(o.$slots,"dates",{item:b},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},ls=re(as,[["__scopeId","data-v-4ba4adbe"]]);function Oe(e,v=[],s,x){const a=oe(),m=a.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},p=a.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},c=rs(e,v),d=os(e,v),y=is(e),g=us(e),o=m.intent+m.behavioral+m.temporal,w={intent:m.intent/o*100,behavioral:m.behavioral/o*100,temporal:m.temporal/o*100},A=c/40*w.intent,b=d/35*w.behavioral,j=y/25*w.temporal,I=Math.min(100,Math.max(0,A+b+j+g));let n="COLD";return I>=p.hot?n="HOT":I>=p.warm?n="WARM":I>=p.standard&&(n="STANDARD"),{score:Math.round(I*10)/10,level:n,breakdown:{intent:Math.round(c*10)/10,behavioral:Math.round(d*10)/10,temporal:Math.round(y*10)/10,quality:Math.round(g*10)/10,total:Math.round(I*10)/10}}}function rs(e,v){var x;let s=0;return(e.requestType==="Test Drive"||((x=e.scheduledAppointment)==null?void 0:x.type)==="test-drive"||v.some(a=>a.type==="test-drive"||a.type==="appointment"))&&(s=Math.max(s,40)),v.some(a=>a.type==="financing")&&(s=Math.max(s,35)),v.some(a=>a.type==="tradein")&&(s=Math.max(s,30)),(e.source==="Walk-in"||v.some(a=>{var m,p,c;return((m=a.content)==null?void 0:m.toLowerCase().includes("location"))||((p=a.content)==null?void 0:p.toLowerCase().includes("dealership"))||((c=a.content)==null?void 0:c.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),e.requestedCar&&(e.requestedCar.requestMessage||v.some(a=>{var m,p;return((m=a.content)==null?void 0:m.toLowerCase().includes("configur"))||a.type==="attachment"&&((p=a.fileName)==null?void 0:p.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),v.some(a=>{var p;const m=((p=a.content)==null?void 0:p.toLowerCase())||"";return m.includes("compare")||m.includes("versus")||m.includes("vs")||m.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function os(e,v){let s=0;const x=new Set(v.map(c=>{if(!c.timestamp)return null;const d=new Date(c.timestamp);return`${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`}).filter(Boolean)),a=Math.min(x.size*10,35);s+=a,e.contactAttempts&&e.contactAttempts.length>1&&(s+=20);const m=v.reduce((c,d)=>{var y;return c+(((y=d.content)==null?void 0:y.length)||0)},0),p=Math.min(Math.floor(m/50),25);return s+=p,v.some(c=>{var d,y,g;return c.type==="attachment"&&(((d=c.fileName)==null?void 0:d.toLowerCase().includes("brochure"))||((y=c.fileName)==null?void 0:y.toLowerCase().includes("spec"))||((g=c.fileName)==null?void 0:g.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function is(e){let v=0;if(!e.createdAt)return 0;const s=new Date,x=new Date(e.createdAt),a=(s.getTime()-x.getTime())/(1e3*60*60);a<2?v+=25:a<24?v+=15:a<48?v+=5:v-=10;const m=x.getDay(),p=x.getHours();if((m===0||m===6||p<9||p>17)&&(v+=10),e.contactAttempts&&e.contactAttempts.length===3&&(v+=50),e.lastActivity){const c=new Date(e.lastActivity);(s.getTime()-c.getTime())/(1e3*60*60*24)>3&&(v+=20)}return Math.min(Math.max(v,0),25)}function us(e){var s,x,a,m,p,c,d;let v=0;return(s=e.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer.email)&&(v+=10),(x=e.customer)!=null&&x.phone&&/^\+?[\d\s\-()]+$/.test(e.customer.phone)&&e.customer.phone.length>=10&&(v+=10),(a=e.customer)!=null&&a.name&&((m=e.customer)!=null&&m.email)&&((p=e.customer)!=null&&p.phone)&&((c=e.customer)!=null&&c.address)&&(v+=5),(e.isDuplicate||e.isDisqualified||!((d=e.customer)!=null&&d.name))&&(v-=20),v}function qe(e){switch(e){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Be(e){switch(e){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function cs({typeFilter:e,showTypeFilter:v,tasks:s}){return{filterDefinitions:N(()=>{const a=[];v.value&&a.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),a.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),a.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),e.value==="lead"&&a.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),a.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const m=[...new Set(s.value.map(c=>c.assignee).filter(Boolean))];m.length>0&&a.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:m.map(c=>({value:c,label:c})),aiHint:"Person assigned to the task",pinned:!0});const p=[...new Set(s.value.map(c=>{const d=c.type==="lead"?c.requestedCar:c.vehicle;return d==null?void 0:d.brand}).filter(Boolean))];return p.length>0&&a.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:p.map(c=>({value:c,label:c})),aiHint:"Car brand requested by customer"}),a.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),a})}}const ds={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},ps={class:"page-header shrink-0"},fs={class:"page-header-main"},gs={class:"page-header-content"},ys={class:"page-header-actions"},ms={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},vs={class:"flex-1 overflow-y-auto p-4 md:p-8"},bs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","toggle-closed","reassign","close","view-change"],setup(e,{emit:v}){const s=e,x=v,a=oe();B("");const m=B({pageIndex:0,pageSize:10}),p=B(""),c=B([]),d=B([]),y=B({}),{filterDefinitions:g}=cs({typeFilter:N(()=>"all"),showTypeFilter:N(()=>!0),tasks:N(()=>s.tasks)}),o=N(()=>s.tasks),w=r=>r.compositeId===s.currentTaskId||r.compositeId===s.highlightId,A=r=>{if(r.type==="lead")return r.requestedCar?`${r.requestedCar.brand} ${r.requestedCar.model}`:"No vehicle specified";const l=r.vehicle||r.requestedCar;return l?`${l.brand} ${l.model}`:"No vehicle specified"},b=r=>{if(!r)return"Not set";const l=new Date,k=new Date(r),R=new Date(l.getFullYear(),l.getMonth(),l.getDate()),q=new Date(k.getFullYear(),k.getMonth(),k.getDate())-R,Q=Math.ceil(q/(1e3*60*60*24));return Q===0?"Today":Q===1?"Tomorrow":Q===-1?"Yesterday":Q>1&&Q<=7?`In ${Q} days`:Q<-1&&Q>=-7?`${Math.abs(Q)} days ago`:Le(r)},j=r=>{const l=r.type==="lead"?r.requestedCar:r.vehicle;if(!l)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const k=l.stockDays!==void 0&&l.stockDays!==null;return{status:k?"In Stock":"Out of Stock",class:k?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},I=r=>{var l;return r.type==="lead"?((l=r.requestedCar)==null?void 0:l.requestType)||r.requestType||"N/A":r.requestType||"Opportunity"},n=r=>{const l=r.type==="lead"?r.requestedCar:r.vehicle||r.requestedCar;return l==null?void 0:l.price},$=N(()=>[{id:"type",accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:r=>i(r.original)},cell:({row:r})=>{const l=r.original,k=l.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return L("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${k}`},l.type==="lead"?"Lead":"Opportunity")}},{id:"customer",accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:r})=>{const l=r.original;return L("div",{class:"flex items-center gap-2 md:gap-3"},[L("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},l.customer.initials),L("div",{class:"min-w-0"},[L("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},l.customer.name),L("div",{class:"text-meta truncate hidden sm:block"},l.customer.phone||"N/A")])])}},{id:"carInfo",accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:r})=>{const l=r.original,k=A(l),R=j(l),H=I(l),q=l.type==="lead"?l.requestedCar:l.vehicle||l.requestedCar;if(k==="No vehicle specified")return L("span",{class:"text-meta"},"N/A");const Q=q!=null&&q.condition?q.condition.charAt(0).toUpperCase()+q.condition.slice(1).toLowerCase():null,se=q!=null&&q.kilometers?`${q.kilometers.toLocaleString()} km`:null,Y=l.quotationNumber||l.quotation||null,V=H&&H!=="N/A"&&(H!=="Quotation"||Y);return L("div",{class:"flex flex-col gap-1"},[L("div",{class:"flex items-center gap-2"},[L("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),L("span",{class:"text-content font-medium text-heading truncate max-w-32"},k)]),L("div",{class:"flex items-center gap-2 flex-wrap"},[L("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${R.class}`},R.status),Q&&L("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},Q),se&&L("span",{class:"text-meta text-xs"},se),V&&L("span",{class:"text-meta text-xs"},H)])])}},{id:"dueDate",accessorKey:"nextActionDue",header:"Due Date",meta:{title:"Due Date"},cell:({row:r})=>{const k=r.original.nextActionDue;if(!k)return L("span",{class:"text-meta"},"Not set");const R=ge(k);return L("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${R.bgClass} ${R.textClass} ${R.borderClass}`},b(k))}},{id:"price",accessorKey:"price",accessorFn:r=>n(r)??0,header:"Price",meta:{title:"Price"},cell:({row:r})=>{const l=r.original,k=n(l);return k==null||k===""?L("span",{class:"text-meta"},"â€”"):L("span",{class:"text-content font-medium text-heading"},`â‚¬ ${dt(k)}`)}},{id:"source",accessorKey:"source",header:"Lead Source",meta:{title:"Lead Source"},cell:({row:r})=>{const l=r.original;return L("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},l.source||"N/A")}},{id:"contactAttempts",accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:r})=>{var R;const k=((R=r.original.contactAttempts)==null?void 0:R.length)||0;return L("span",{class:"text-content font-medium text-heading"},k)}},{id:"assignee",accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:r})=>{const l=r.original,k=s.getOwnerInfo(l);return L("div",{class:"flex items-center gap-2"},[L("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},k.initials),L("span",{class:"text-meta truncate max-w-20"},k.name)])}},{id:"createdAt",accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:r})=>{const l=r.original;return l.createdAt?L("span",{class:"text-meta"},pt(l.createdAt)):L("span",{class:"text-meta"},"N/A")}},{id:"status",accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:r})=>{const l=r.original,k=l.type==="lead"?l.status:l.displayStage||l.stage,R=s.getStageBadgeClass(k);return L("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${R}`},k)}},...a.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:r})=>{const l=r.original;if(l.type!=="lead")return L("span",{class:"text-meta"},"â€”");let k=l.urgencyLevel;k||(k=Oe(l).level);const R=Be(k),H=qe(k);return L("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${R}`},[L("span",{},H),L("span",{},k)])}}]:[]]),i=r=>{p.value=String(r.id),x("select",r.compositeId)},O=N(()=>({class:{tr:r=>{const l="cursor-pointer hover:bg-surfaceSecondary transition-colors",k=r.original;return w(k)?`${l} bg-blue-50 border-l-4 border-l-blue-500`:l}}}));return(r,l)=>(C(),S("div",ds,[f("header",ps,[f("div",fs,[f("div",gs,[l[9]||(l[9]=f("div",{class:"page-header-title-container"},[f("h1",{class:"page-header-title"},"Tasks")],-1)),f("div",ys,[f("div",ms,[W(M(le),{variant:"secondary",size:"icon",onClick:l[0]||(l[0]=k=>r.$emit("view-change","card")),class:P(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:z(()=>[W(M(Ne),{size:14})]),_:1},8,["class","aria-pressed"]),W(M(le),{variant:"secondary",size:"icon",onClick:l[1]||(l[1]=k=>r.$emit("view-change","table")),class:P(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:z(()=>[W(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"])]),f("button",{onClick:l[2]||(l[2]=k=>r.$emit("toggle-closed",!e.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...l[8]||(l[8]=[f("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),f("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),f("div",vs,[W(M(gt),{data:o.value,columns:$.value,meta:O.value,onRowClick:i,columnFiltersOptions:{filterDefs:M(g)},pagination:m.value,"onUpdate:pagination":l[3]||(l[3]=k=>m.value=k),globalFilter:p.value,"onUpdate:globalFilter":l[4]||(l[4]=k=>p.value=k),sorting:c.value,"onUpdate:sorting":l[5]||(l[5]=k=>c.value=k),columnFilters:d.value,"onUpdate:columnFilters":l[6]||(l[6]=k=>d.value=k),columnVisibility:y.value,"onUpdate:columnVisibility":l[7]||(l[7]=k=>y.value=k),paginationOptions:{rowCount:o.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!1},class:"h-full"},{"empty-state":z(()=>[...l[10]||(l[10]=[f("div",{class:"empty-state"},[f("i",{class:"fa-solid fa-tasks empty-state-icon"}),f("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","columnVisibility","paginationOptions"])])]))}},hs=re(bs,[["__scopeId","data-v-29cab866"]]),xs={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},ws={class:"px-4 py-3 flex items-center justify-between gap-3"},ks=["aria-label"],Cs={key:0,class:"flex-1 flex items-center justify-center"},Ss={key:1,class:"flex items-center gap-2"},$s={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(e,{emit:v}){const s=v,x=()=>{s("back")};return(a,m)=>e.show?(C(),S("div",xs,[f("div",ws,[f("button",{onClick:x,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":e.backLabel},[...m[0]||(m[0]=[f("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,ks),a.$slots.title?(C(),S("div",Cs,[ee(a.$slots,"title")])):F("",!0),a.$slots.actions?(C(),S("div",Ss,[ee(a.$slots,"actions")])):F("",!0)])])):F("",!0)}};function As(){const e=g=>{if(!g)return"No deadline";const o=ge(g);return o.type==="overdue"?"OVERDUE":o.type==="today"||o.type==="urgent"?o.relativeTime:Le(g)},v=g=>{const o=g.type==="lead"?g.requestedCar:g.vehicle;return!o||!o.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[o.type]||{type:o.type.toLowerCase(),label:o.type}},s=g=>g?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[g.type]||"bg-gray-50 text-gray-700":"",x=g=>{if(!g||!g.assignee)return{name:"Unassigned",initials:"?"};const o=g.assigneeInitials||g.assignee.split(" ").map(w=>w[0]).join("");return{name:g.assignee,initials:o}},a=g=>{if(!g||!g.customer||!g.customer.address)return null;const w=g.customer.address.split(",");return w.length>1&&w[w.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:e,getVehicleType:v,getVehicleTypeBadgeClass:s,getOwnerInfo:x,getCustomerCity:a,getLocationDisplay:g=>{const o=a(g),w=g.source||"Unknown";return o?`${o} â€¢ ${w}`:w},getAssigneeInitials:g=>{if(!g)return"?";const o=g.split(" ");return o.length>=2?(o[0][0]+o[o.length-1][0]).toUpperCase():g.substring(0,2).toUpperCase()},getVehicleStatusDisplay:g=>{const o=g.type==="lead"?g.requestedCar:g.vehicle;if(!o)return"No vehicle";const w=v(g),A=w?w.label:o.type||"Unknown";let b="";return o.kilometers!==void 0&&o.kilometers!==null&&(o.kilometers>=1e3?b=`${(o.kilometers/1e3).toFixed(0)}k`:b=`${o.kilometers}`),b?`${A} / ${b}`:A},getTaskStatusDisplay:g=>g.type==="lead"?g.status||"Unknown":g.stage||"Unknown",getStageBadgeClass:Me,getUnselectedClass:g=>g.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Ts(){const e=De(),v=Ie(),s=oe();return{sortTasks:(a,m)=>{if(!m||m===""||m==="none")return a;if(m==="recent-first")return[...a].sort((p,c)=>{const d=new Date(p.lastActivity||p.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-d});if(m==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...a.map(d=>{if(d.type==="lead"&&!d.urgencyScore){const y=Oe(d);return{...d,urgencyScore:y.score,urgencyLevel:y.level}}return d})].sort((d,y)=>{if(d.type==="lead"&&y.type==="lead"){const w=d.urgencyScore||0,A=y.urgencyScore||0;if(w!==A)return A-w;const b=new Date(d.createdAt||0);return new Date(y.createdAt||0)-b}if(d.type==="lead"&&y.type==="opportunity")return-1;if(d.type==="opportunity"&&y.type==="lead")return 1;if(d.priority==="Hot"&&y.priority!=="Hot")return-1;if(d.priority!=="Hot"&&y.priority==="Hot")return 1;const g=new Date(d.lastActivity||d.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-g}):[...a].sort((c,d)=>{if(c.priority==="Hot"&&d.priority!=="Hot")return-1;if(c.priority!=="Hot"&&d.priority==="Hot")return 1;const y=new Date(c.lastActivity||c.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-y});if(m==="assigned-to-me"){const p=e.currentUser.name;return[...a.filter(d=>d.assignee===p)].sort((d,y)=>{const g=new Date(d.lastActivity||d.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-g})}if(m==="assigned-to-my-team"){const p=e.currentUser;let c=[];return p.role==="manager"?c=v.users.map(y=>y.name):p.role==="salesman"?c=v.users.filter(y=>y.role==="salesman").map(y=>y.name):p.role==="operator"&&(c=v.users.filter(y=>y.role==="operator").map(y=>y.name)),[...a.filter(y=>c.includes(y.assignee))].sort((y,g)=>{const o=new Date(y.lastActivity||y.createdAt||0);return new Date(g.lastActivity||g.createdAt||0)-o})}return a}}}const Ds={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Is={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Ls={key:0,class:"flex items-center gap-2"},Ms={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Ns={class:"text-gray-600 font-medium"},Fs={key:1},Os={key:0},qs={key:1},Bs={key:2},Us={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Rs={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Hs={__name:"Tasks",setup(e){const v=nt(),s=rt(),x=st(),a=ot(),m=De();Ie();const p=oe(),{getDateDisplay:c,getVehicleType:d,getVehicleTypeBadgeClass:y,getOwnerInfo:g,getCustomerCity:o,getAssigneeInitials:w,getUnselectedClass:A}=As(),b=B(localStorage.getItem("tasksViewMode")||"table"),j=B(""),I=N(()=>v.query.highlight||null);te(b,t=>{localStorage.setItem("tasksViewMode",t)});const n=(t,h="")=>{b.value;const T=V.value;if(b.value=t,t==="card"&&h&&(j.value=h),t==="table"&&T)j.value="",s.push({path:"/tasks",query:{highlight:T.compositeId}});else if(t==="card"&&I.value){const[u,D]=I.value.split("-");s.push({path:`/tasks/${D}`,query:{type:u}})}else t==="card"&&!I.value&&!V.value&&s.push({path:"/tasks"})},$=B([]),i=B(""),O=B(!1),r=B(null);B(!1);const l=B(!1),k=B(null),R=B(!1),H=B(null),{allTasks:q,applyFilters:Q}=yt(O),{sortTasks:se}=Ts(),Y=N(()=>{let t=Q(q.value,$.value);return t=se(t,i.value),t}),V=N(()=>{if(!v.params.id)return null;const t=parseInt(v.params.id);if(isNaN(t))return null;const h=v.query.type;if(h){const E=`${h}-${t}`;return q.value.find(Ze=>Ze.compositeId===E)||null}const T=$.value.filter(E=>E==="lead"||E==="opportunity"),u=T.length>0?q.value.filter(E=>T.includes(E.type)):q.value,D=`lead-${t}`,G=`opportunity-${t}`,K=u.find(E=>E.compositeId===D||E.compositeId===G);return K||q.value.find(E=>E.compositeId===D||E.compositeId===G)||null});N(()=>V.value?V.value.type==="lead"?x.currentLeadActivities:a.currentOpportunityActivities:[]);const ie=ke(V),Ue=ie.managementWidget,Re=ie.storeAdapter,He=ie.addNewConfig,Ve=N(()=>H.value),ue=ke(Ve),ye=N(()=>ue.managementWidget.value),me=N(()=>ue.storeAdapter.value),We=N(()=>ue.addNewConfig.value),ze=A;at(()=>{x.fetchLeads(),a.fetchOpportunities();const t=v.params.id;t&&ve(t)}),te(()=>v.params.id,t=>{t&&ve(t)}),te(V,t=>{t&&(t.type==="lead"?x.fetchLeadById(t.id):a.fetchOpportunityById(t.id))},{immediate:!0}),te(H,t=>{t&&(t.type==="lead"?x.fetchLeadById(t.id):a.fetchOpportunityById(t.id))},{immediate:!0});const ve=t=>{const h=parseInt(t),T=q.value.find(u=>u.id===h);T&&(T.type==="lead"?x.fetchLeadById(h):a.fetchOpportunityById(h))},_=t=>{const[h,T]=t.split("-");if(b.value==="table"){const u=q.value.find(D=>D.compositeId===t);u&&(H.value=u,R.value=!0,u.type==="lead"?x.fetchLeadById(u.id):a.fetchOpportunityById(u.id));return}b.value="card",s.push({path:`/tasks/${T}`,query:{type:h}})},ce=()=>{if(R.value){de();return}s.push({path:"/tasks"})},de=()=>{R.value=!1,H.value=null},Ee=t=>{if(!V.value)return;const h=Y.value.findIndex(T=>{const u=V.value.compositeId||`${V.value.type}-${V.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===u});if(h!==-1){if(t==="previous"&&h>0){const T=Y.value[h-1];_(T.compositeId)}else if(t==="next"&&h<Y.value.length-1){const T=Y.value[h+1];_(T.compositeId)}}},je=t=>{if(!H.value)return;const h=Y.value.findIndex(T=>{const u=H.value.compositeId||`${H.value.type}-${H.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===u});if(h!==-1){if(t==="previous"&&h>0){const T=Y.value[h-1];_(T.compositeId)}else if(t==="next"&&h<Y.value.length-1){const T=Y.value[h+1];_(T.compositeId)}}},be=t=>{r.value=r.value===t?null:t},he=t=>{k.value=t,l.value=!0,r.value=null},Pe=t=>{i.value=t},Qe=async t=>{if(!k.value)return;const h=k.value,T=t.name;h.type==="lead"?await x.updateLead(h.id,{assignee:T,assigneeType:t.type,teamId:t.type==="team"?t.id:null}):h.type==="opportunity"&&await a.updateOpportunity(h.id,{assignee:T,assigneeType:t.type,teamId:t.type==="team"?t.id:null}),l.value=!1,k.value=null},Ke=async t=>{r.value=null,t.type==="lead"?await x.updateLead(t.id,{priority:"Hot"}):t.type==="opportunity"&&await a.updateOpportunity(t.id,{priority:"Hot"})},Ye=async t=>{r.value=null,t.type==="lead"?await x.updateLead(t.id,{priority:"Normal"}):t.type==="opportunity"&&await a.updateOpportunity(t.id,{priority:"Normal"})},Ge=async t=>{r.value=null;const h=m.user;h&&(t.type==="lead"?await x.updateLead(t.id,{assignee:h.name,assigneeType:"user"}):t.type==="opportunity"&&await a.updateOpportunity(t.id,{assignee:h.name,assigneeType:"user"}))},Je=async t=>{if(r.value=null,t.type==="lead")try{const h=t.displayStage||t.stage||we.NEW,T=we.NEW,u=ft(h,T);if(u){const{updates:D,activities:G}=u(t);await x.updateLead(t.id,D);for(const K of G)await x.addActivity(t.id,K)}else await x.updateLead(t.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await x.addActivity(t.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await x.fetchLeadById(t.id)}catch(h){console.error("Failed to reopen lead:",h)}},Xe=t=>{var T;const h=[];return t.type==="lead"&&t.isDisqualified===!0&&h.push({key:"reopen",label:"Reopen Lead",onClick:()=>Je(t)}),h.push({key:"reassign",label:"Reassign",onClick:()=>he(t)}),t.assignee!==((T=m.user)==null?void 0:T.name)&&h.push({key:"assign-me",label:"Assign to me",onClick:()=>Ge(t)}),t.priority!=="Hot"?h.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Ke(t)}):h.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Ye(t)}),h};return(t,h)=>{var T;return C(),S("div",Ds,[W($s,{show:!!V.value||b.value==="table"&&!!H.value,"back-label":"Back to task list",onBack:ce},null,8,["show"]),b.value==="card"?(C(),S("div",Is,[f("div",{class:P(["flex flex-col overflow-hidden",V.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[W(ls,{title:"Tasks",items:Y.value,"selected-id":V.value?String(V.value.compositeId):null,"view-mode":b.value,"initial-search-query":j.value,onViewChange:n,"selected-class":u=>u.type==="lead"?"bg-surface border-2 border-blue-500":"bg-surface border-2 border-purple-500","unselected-class":M(ze),"open-menu-id":r.value,getName:u=>{const D=u.customer;return D&&D.name?D.name:D&&!D.name&&D.email&&D.email.split("@")[0]||"Unknown"},getInitials:u=>{const D=u.customer;return D&&D.initials?D.initials:D&&D.name&&D.name.split(" ").map(K=>K[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:u=>{if(u.type==="lead"){if(!u.requestedCar)return"No vehicle specified";const K=u.requestedCar,E=[`${K.brand} ${K.model}`];return K.kilometers!==void 0&&K.kilometers!==null&&E.push(`${K.kilometers} km`),K.status&&E.push(K.status),E.join(" â€¢ ")}const D=u.vehicle||u.requestedCar;if(!D)return"No vehicle specified";const G=[`${D.brand} ${D.model}`];return D.kilometers!==void 0&&D.kilometers!==null&&G.push(`${D.kilometers} km`),D.status&&G.push(D.status),G.join(" â€¢ ")},avatarClass:u=>u.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":Xe,"show-mobile-close":!1,onSelect:_,onMenuClick:be,onMenuClose:h[0]||(h[0]=u=>r.value=null),onClose:ce,"active-filters":$.value,onFilterChange:h[1]||(h[1]=u=>$.value=u),onSortChange:Pe},{badges:z(({item:u})=>[u&&u.type?(C(),Z(M(pe),{key:0,text:u.type==="lead"?"Lead":"Opportunity",size:"small",theme:u.type==="lead"?"blue":"gray"},null,8,["text","theme"])):F("",!0),u&&u.type==="lead"&&M(p).getSetting("urgencyEnabled")!==!1&&u.urgencyLevel?(C(),Z(M(pe),{key:1,text:`${M(qe)(u.urgencyLevel)} ${u.urgencyLevel}`,size:"small",class:P(M(Be)(u.urgencyLevel))},null,8,["text","class"])):F("",!0),u&&u.priority==="Hot"&&(M(p).getSetting("urgencyEnabled")===!1||u.type!=="lead")?(C(),Z(M(pe),{key:2,text:"HOT",size:"small",theme:"red"})):F("",!0)]),location:z(({item:u})=>[fe(U(M(o)(u)||"Unknown"),1)]),source:z(({item:u})=>{var D;return[fe(U(u.source||((D=u.customer)==null?void 0:D.source)||"Unknown"),1)]}),owner:z(({item:u})=>[u.assignee?(C(),S("div",Ls,[f("div",Ms,U(M(w)(u.assignee)),1),f("span",Ns,U(u.assignee),1)])):(C(),S("span",Fs,"Unassigned"))]),dates:z(({item:u})=>[u.type==="lead"&&u.nextActionDue?(C(),S("span",Os,"Due: "+U(M(c)(u.nextActionDue)),1)):u.type==="opportunity"&&u.nextActionDue?(C(),S("span",qs,"Due: "+U(M(c)(u.nextActionDue)),1)):(C(),S("span",Bs,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),V.value?(C(),Z(Ce,{key:0,task:V.value,"management-widget":M(Ue),"store-adapter":M(Re),"add-new-config":M(He),"filtered-tasks":Y.value,onTaskNavigate:Ee},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0),V.value?F("",!0):(C(),S("div",Us,[...h[5]||(h[5]=[lt('<div class="flex-1 flex items-center justify-center p-8" data-v-700beed7><div class="text-center max-w-sm" data-v-700beed7><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-700beed7><i class="fa-solid fa-tasks text-2xl text-sub" data-v-700beed7></i></div><h3 class="text-content-bold mb-2" data-v-700beed7>No task selected</h3><p class="text-meta" data-v-700beed7>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):F("",!0),b.value==="table"?(C(),S("div",Rs,[W(hs,{tasks:M(q),"current-task-id":(T=H.value)==null?void 0:T.compositeId,"highlight-id":I.value,"show-closed":O.value,"show-mobile-close":!1,"open-menu-id":r.value,"get-vehicle-type":M(d),"get-vehicle-type-badge-class":M(y),"get-owner-info":M(g),"get-stage-badge-class":M(Me),"view-mode":b.value,onSelect:_,onMenuClick:be,onMenuClose:h[2]||(h[2]=u=>r.value=null),onToggleClosed:h[3]||(h[3]=u=>O.value=u),onReassign:he,onClose:ce,onViewChange:n,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):F("",!0),b.value==="table"?(C(),Z(mt,{key:2,show:R.value,onClose:de},{default:z(()=>[H.value&&ye.value&&me.value?(C(),Z(Ce,{key:0,task:H.value,"management-widget":ye.value,"store-adapter":me.value,"add-new-config":We.value,"filtered-tasks":M(q),"is-drawer-view":!0,onTaskNavigate:je,onClose:de},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0)]),_:1},8,["show"])):F("",!0),W(vt,{show:l.value,onClose:h[4]||(h[4]=u=>l.value=!1),onConfirm:Qe},null,8,["show"])])}}},Zs=re(Hs,[["__scopeId","data-v-700beed7"]]);export{Zs as default};
