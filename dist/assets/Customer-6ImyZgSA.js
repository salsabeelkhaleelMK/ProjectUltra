import{r as h,I as D,c as q,p as T,o as p,H as k,h as e,w as U,z as m,B as f,C as A,e as x,g as M,j as $,n as j,t as C,l as F,G as I,M as N,k as P,d as z}from"./index-Be589Dcd.js";import{u as Q}from"./opportunities-BEKDyPzK.js";import{u as Y}from"./contacts-Db2R-Zq2.js";import{u as G,_ as W,a as O}from"./useTaskShell-C8GzfPgZ.js";import{_ as H}from"./ModalShell-BDXG1RnS.js";import"./ReassignUserModal-CCRTMl9B.js";import"./formatters-Br5TsDxy.js";const K=["max"],J={class:"relative"},X={class:"border-t border-gray-200 pt-4"},Z={key:0,class:"mt-4 space-y-4"},_={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},ee=["disabled"],te={__name:"RequestedCarModal",props:{show:{type:Boolean,default:!1},contact:{type:Object,default:null}},emits:["close","saved"],setup(i,{emit:y}){const g=i,b=y,u=h(!1),a=h({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});D(()=>g.show,n=>{var t;if(n&&((t=g.contact)!=null&&t.requestedCar)){const r=g.contact.requestedCar;a.value={brand:r.brand||"",model:r.model||"",year:r.year||new Date().getFullYear(),price:r.price||null,requestType:r.requestType||"Quotation",requestMessage:r.requestMessage||"",image:r.image||"",dealership:r.dealership||"",fuelType:r.fuelType||"",gearType:r.gearType||"",kilometers:r.kilometers||null}}else n&&(a.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const c=q(()=>a.value.brand.trim()&&a.value.model.trim()&&a.value.year>1900),d=()=>{if(!c.value)return;const n={brand:a.value.brand.trim(),model:a.value.model.trim(),year:a.value.year,requestType:a.value.requestType};a.value.price&&(n.price=a.value.price),a.value.requestMessage&&(n.requestMessage=a.value.requestMessage.trim()),a.value.image&&(n.image=a.value.image.trim()),a.value.dealership&&(n.dealership=a.value.dealership.trim()),a.value.fuelType&&(n.fuelType=a.value.fuelType),a.value.gearType&&(n.gearType=a.value.gearType),a.value.kilometers!==null&&(n.kilometers=a.value.kilometers),b("saved",n)};return(n,t)=>{var r;return p(),T(H,{show:i.show,title:(r=i.contact)!=null&&r.requestedCar?"Edit Requested Car":"Add Requested Car",size:"2xl","show-close-button":!0,onClose:t[13]||(t[13]=o=>n.$emit("close")),onCancel:t[14]||(t[14]=o=>n.$emit("close"))},{footer:k(()=>{var o;return[e("div",_,[e("button",{type:"button",onClick:t[12]||(t[12]=S=>n.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:d,disabled:!c.value,class:"btn-primary"},C((o=i.contact)!=null&&o.requestedCar?"Update Car":"Add Car"),9,ee)])]}),default:k(()=>[e("form",{onSubmit:U(d,["prevent"]),class:"space-y-4"},[e("div",null,[t[15]||(t[15]=e("label",{class:"block label-upper mb-2"},"Brand *",-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.brand=o),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"input"},null,512),[[f,a.value.brand]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block label-upper mb-2"},"Model *",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.model=o),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"input"},null,512),[[f,a.value.model]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block label-upper mb-2"},"Year *",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.year=o),type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"input"},null,8,K),[[f,a.value.year,void 0,{number:!0}]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block label-upper mb-2"},"Price (Optional)",-1)),e("div",J,[t[18]||(t[18]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"â‚¬",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.price=o),type:"number",min:"0",step:"1000",placeholder:"45000",class:"input pl-8"},null,512),[[f,a.value.price,void 0,{number:!0}]])])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block label-upper mb-2"},"Request Type",-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.requestType=o),class:"input"},[...t[20]||(t[20]=[e("option",{value:"Quotation"},"Quotation",-1),e("option",{value:"Test Drive"},"Test Drive",-1),e("option",{value:"Generic Sales"},"Generic Sales",-1)])],512),[[A,a.value.requestType]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block label-upper mb-2"},"Request Message (Optional)",-1)),m(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.requestMessage=o),rows:"4",placeholder:"Customer's message or notes about the vehicle request...",class:"input resize-none"},null,512),[[f,a.value.requestMessage]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block label-upper mb-2"},"Image URL (Optional)",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.image=o),type:"url",placeholder:"https://example.com/car-image.jpg",class:"input"},null,512),[[f,a.value.image]]),t[24]||(t[24]=e("p",{class:"text-xs text-gray-500 mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",X,[e("button",{type:"button",onClick:t[7]||(t[7]=o=>u.value=!u.value),class:"flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors"},[e("i",{class:j(["fa-solid",u.value?"fa-chevron-down":"fa-chevron-right"])},null,2),t[25]||(t[25]=$(" Advanced Details (Optional) ",-1))]),u.value?(p(),x("div",Z,[e("div",null,[t[26]||(t[26]=e("label",{class:"block label-upper mb-2"},"Dealership",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.dealership=o),type:"text",placeholder:"e.g., Milano, Berlin",class:"input"},null,512),[[f,a.value.dealership]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),m(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>a.value.fuelType=o),class:"input"},[...t[27]||(t[27]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1)])],512),[[A,a.value.fuelType]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),m(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>a.value.gearType=o),class:"input"},[...t[29]||(t[29]=[e("option",{value:""},"Select gear type",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1)])],512),[[A,a.value.gearType]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block label-upper mb-2"},"Kilometers",-1)),m(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>a.value.kilometers=o),type:"number",min:"0",placeholder:"e.g., 50000",class:"input"},null,512),[[f,a.value.kilometers,void 0,{number:!0}]])])])):M("",!0)])],32)]),_:1},8,["show","title"])}}},ae={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},le={class:"p-5 space-y-4"},re={key:0,class:"bg-orange-50 border border-orange-200 rounded-lg p-4 flex items-start gap-3"},se={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3"},oe={class:"flex-1"},ne={class:"text-xs text-green-700"},ie={class:"space-y-3"},ue={class:"flex gap-3"},de=["disabled","title"],ce=["disabled","title"],pe={__name:"ContactManagementWidget",props:{contact:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(i,{emit:y}){const g=i,b=y,u=h(!1),a=h(!1),c=t=>{b("car-added",t),u.value=!1},d=()=>{!g.contact.requestedCar||a.value||(a.value=!0,b("convert-to-lead"))},n=()=>{!g.contact.requestedCar||a.value||(a.value=!0,b("convert-to-opportunity"))};return(t,r)=>i.contact?(p(),x("div",ae,[r[8]||(r[8]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-user-circle text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")])],-1)),e("div",le,[i.contact.requestedCar?(p(),x("div",se,[r[4]||(r[4]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg mt-0.5"},null,-1)),e("div",oe,[r[3]||(r[3]=e("p",{class:"text-sm font-semibold text-green-900 mb-1"},"Requested Car Added",-1)),e("p",ne,C(i.contact.requestedCar.brand)+" "+C(i.contact.requestedCar.model)+" ("+C(i.contact.requestedCar.year)+") ",1)])])):(p(),x("div",re,[...r[2]||(r[2]=[e("i",{class:"fa-solid fa-exclamation-triangle text-orange-600 text-lg mt-0.5"},null,-1),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-semibold text-orange-900 mb-1"},"No Requested Car"),e("p",{class:"text-xs text-orange-700"}," Add a requested car to this contact before converting to a lead or opportunity. ")],-1)])])),e("div",ie,[e("button",{onClick:r[0]||(r[0]=o=>u.value=!0),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-3 rounded-lg text-sm flex items-center justify-center gap-2 transition-colors shadow-sm"},[r[5]||(r[5]=e("i",{class:"fa-solid fa-car"},null,-1)),$(" "+C(i.contact.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]),e("div",ue,[e("button",{onClick:d,disabled:!i.contact.requestedCar||a.value,title:i.contact.requestedCar?"":"Add a requested car first",class:"flex-1 bg-white hover:bg-gray-50 border-2 border-blue-600 text-blue-600 font-medium px-4 py-3 rounded-lg text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300 disabled:text-gray-400"},[...r[6]||(r[6]=[e("i",{class:"fa-solid fa-user-plus"},null,-1),$(" Convert to Lead ",-1)])],8,de),e("button",{onClick:n,disabled:!i.contact.requestedCar||a.value,title:i.contact.requestedCar?"":"Add a requested car first",class:"flex-1 bg-white hover:bg-gray-50 border-2 border-purple-600 text-purple-600 font-medium px-4 py-3 rounded-lg text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300 disabled:text-gray-400"},[...r[7]||(r[7]=[e("i",{class:"fa-solid fa-briefcase"},null,-1),$(" Convert to Opportunity ",-1)])],8,ce)])])]),F(te,{show:u.value,contact:i.contact,onClose:r[1]||(r[1]=o=>u.value=!1),onSaved:c},null,8,["show","contact"])])):M("",!0)}},ve={class:"h-full flex flex-col overflow-hidden bg-gray-50"},me={key:0,class:"flex-1 flex items-center justify-center"},ye={key:1,class:"flex-1 flex items-center justify-center"},ge={class:"text-center"},be={class:"text-gray-500 mb-2"},fe={key:3,class:"flex-1 flex items-center justify-center"},Me={__name:"Customer",setup(i){const y=N(),g=z(),b=I(),u=Q(),a=Y(),c=h(!1),d=h(null),n=q(()=>parseInt(y.params.id)),t=q(()=>y.query.type||y.query.stage||"lead"),r=q(()=>{if(t.value==="contact"){const s=a.currentContact;return s?{...s,type:"contact",customer:{name:s.name,email:s.email,phone:s.phone,address:s.address||"",initials:s.initials},source:s.source||"Direct",tags:s.tags||[],stage:"Contact",assignee:null,assigneeId:null}:null}else if(t.value==="lead"){const s=b.currentLead;return s?{...s,type:"lead"}:null}else{const s=u.currentOpportunity;return s?{...s,type:"opportunity"}:null}}),o=G(r),S=q(()=>t.value==="contact"?pe:o.managementWidget.value),V=q(()=>t.value==="contact"?{currentActivities:q(()=>[]),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}}:o.storeAdapter.value),R=q(()=>t.value==="contact"?{overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]}:o.addNewConfig.value),w=async()=>{if(!n.value){d.value="No task ID provided";return}c.value=!0,d.value=null;try{t.value==="contact"?await a.loadContactById(n.value):t.value==="lead"?await b.loadLeadById(n.value):await u.loadOpportunityById(n.value)}catch(s){d.value=s.message||"Failed to load task",console.error("Error loading task:",s)}finally{c.value=!1}},B=async s=>{try{await a.addRequestedCar(n.value,s),await w()}catch(v){console.error("Error adding car to contact:",v),d.value=v.message||"Failed to add car"}},E=async()=>{try{c.value=!0;const s=await a.convertToLead(n.value);g.replace({path:`/customer/${s.id}`,query:{type:"lead"}})}catch(s){console.error("Error converting to lead:",s),d.value=s.message||"Failed to convert to lead",c.value=!1}},L=async()=>{try{c.value=!0;const s=await a.convertToOpportunity(n.value);g.replace({path:`/customer/${s.id}`,query:{type:"opportunity"}})}catch(s){console.error("Error converting to opportunity:",s),d.value=s.message||"Failed to convert to opportunity",c.value=!1}};return P(async()=>{t.value==="contact"?await a.loadContacts():t.value==="lead"?await b.loadLeads():await u.loadOpportunities(),await w()}),D(()=>y.params.id,s=>{s&&w()}),D(()=>[y.query.stage,y.query.type],()=>{n.value&&w()}),(s,v)=>(p(),x("div",ve,[c.value?(p(),x("div",me,[...v[1]||(v[1]=[e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),e("p",{class:"text-gray-500"},"Loading...")],-1)])])):d.value||!r.value?(p(),x("div",ye,[e("div",ge,[v[2]||(v[2]=e("i",{class:"fa-solid fa-exclamation-circle text-6xl text-gray-300 mb-4"},null,-1)),e("p",be,C(d.value||"Task not found"),1),e("button",{onClick:v[0]||(v[0]=l=>s.$router.push("/customers")),class:"px-4 py-2 text-sm font-medium bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"}," Back to Customers ")])])):r.value&&r.value.id===n.value?(p(),T(W,{key:2,task:r.value,type:t.value,"management-widget":S.value,"store-adapter":V.value,"add-new-config":R.value,onCarAdded:B,onConvertToLead:E,onConvertToOpportunity:L},{"pinned-extra":k(({task:l})=>[(l.type==="contact"||l.type==="lead")&&l.requestedCar?(p(),T(O,{key:0,brand:l.requestedCar.brand,model:l.requestedCar.model,year:l.requestedCar.year,image:l.requestedCar.image||"",price:l.requestedCar.price||null,"request-message":l.requestedCar.requestMessage||"","request-type":l.requestedCar.requestType||"",source:l.source||"",dealership:l.requestedCar.dealership||"",registration:l.requestedCar.registration||"",kilometers:l.requestedCar.kilometers||null,"fuel-type":l.requestedCar.fuelType||"","gear-type":l.requestedCar.gearType||"",vin:l.requestedCar.vin||"","stock-days":l.requestedCar.stockDays!==void 0?l.requestedCar.stockDays:null,channel:l.requestedCar.channel||"Email","ad-campaign":l.requestedCar.adCampaign||"","expected-purchase-date":l.requestedCar.expectedPurchaseDate||"","fiscal-entity":l.requestedCar.fiscalEntity||"","source-details":l.requestedCar.sourceDetails||"","ad-medium":l.requestedCar.adMedium||"","ad-source":l.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):M("",!0),l.type==="opportunity"&&l.vehicle?(p(),T(O,{key:1,brand:l.vehicle.brand,model:l.vehicle.model,year:l.vehicle.year,image:l.vehicle.image||"",price:l.vehicle.price||null,"request-message":l.vehicle.requestMessage||"","request-type":l.vehicle.requestType||"",source:l.source||"",dealership:l.vehicle.dealership||"",registration:l.vehicle.registration||"",kilometers:l.vehicle.kilometers||null,"fuel-type":l.vehicle.fuelType||"","gear-type":l.vehicle.gearType||"",vin:l.vehicle.vin||"","stock-days":l.vehicle.stockDays!==void 0?l.vehicle.stockDays:null,channel:l.vehicle.channel||"Email","ad-campaign":l.vehicle.adCampaign||"","expected-purchase-date":l.vehicle.expectedPurchaseDate||"","fiscal-entity":l.vehicle.fiscalEntity||"","source-details":l.vehicle.sourceDetails||"","ad-medium":l.vehicle.adMedium||"","ad-source":l.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):M("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(p(),x("div",fe,[...v[3]||(v[3]=[e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),e("p",{class:"text-gray-500"},"Loading...")],-1)])]))]))}};export{Me as default};
