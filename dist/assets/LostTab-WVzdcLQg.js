import{y as h}from"./components-Y9EE84YM.js";import{u as B}from"./opportunities-D1cnNxBd.js";import{g as I,c as L,f as M}from"./opportunityRules-DnV0W7Tj.js";import{u as _}from"./useCustomersTable-CnldMHbY.js";import{M as $,r as a,c as q,I as R,m as z,x as G,o as K,B as V,e as o,y as i}from"./index-D8nDSNmq.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import"./sparkles-BOzuQ2gU.js";import"./vehicles-CxdEy1So.js";const W={__name:"LostTab",emits:["row-click"],setup(j,{emit:A}){const n=B(),l=a({pageIndex:0,pageSize:10}),r=a(""),u=a([]),c=a([]),m=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",d=q(()=>n.opportunities.filter(t=>t.stage==="Closed Lost").map(t=>{var s,f,p,y,v,b,D,x,k,C,F,S;const e=((s=t.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${t.id}`,stageKey:"lost",customer:((f=t.customer)==null?void 0:f.name)||"Unknown",email:((p=t.customer)==null?void 0:p.email)||"",initials:((y=t.customer)==null?void 0:y.initials)||((b=(v=t.customer)==null?void 0:v.name)==null?void 0:b.slice(0,2).toUpperCase())||"?",nextAction:M(t.expectedCloseDate)||"No due date",nextActionFull:L(t.expectedCloseDate),deadlineStatus:I(t.expectedCloseDate),car:`${((D=t.vehicle)==null?void 0:D.brand)||""} ${((x=t.vehicle)==null?void 0:x.model)||""}`.trim()||"N/A",carStatus:((k=t.vehicle)==null?void 0:k.stockDays)!==void 0&&((C=t.vehicle)==null?void 0:C.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((F=t.vehicle)==null?void 0:F.stockDays)!==void 0&&((S=t.vehicle)==null?void 0:S.stockDays)!==null?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body",requestType:t.requestType||"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:m(t.createdAt),lastAppointment:e?m(e):"N/A",status:R(t,"opportunity"),statusClass:"bg-red-100 text-red-700",priority:t.priority||"Normal"}})),w=A,g=t=>{t.id.startsWith("opp-")&&w("row-click",t)},O=a("lost"),{columns:N,filterDefinitions:U,tableMeta:T}=_(O,g);return z(async()=>{await n.fetchOpportunities()}),(t,e)=>(K(),G(i(h),{data:d.value,columns:i(N),meta:i(T),onRowClick:g,columnFiltersOptions:{filterDefs:i(U)},pagination:l.value,"onUpdate:pagination":e[0]||(e[0]=s=>l.value=s),globalFilter:r.value,"onUpdate:globalFilter":e[1]||(e[1]=s=>r.value=s),sorting:u.value,"onUpdate:sorting":e[2]||(e[2]=s=>u.value=s),columnFilters:c.value,"onUpdate:columnFilters":e[3]||(e[3]=s=>c.value=s),paginationOptions:{rowCount:d.value.length},globalFilterOptions:{debounce:300},class:"h-full"},{"empty-state":V(()=>[...e[4]||(e[4]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"]))}},tt=$(W,[["__scopeId","data-v-e9b1a955"]]);export{tt as default};
