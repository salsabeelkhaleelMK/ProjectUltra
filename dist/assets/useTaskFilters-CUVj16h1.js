const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-BPIU2ljN.js","assets/index-Db_3peLd.js","assets/index-B085vE-V.css"])))=>i.map(i=>d[i]);
import{n as j,z as ys,b as _s,Z as ds,X as us,a as en,f as vt,F as ft,L as yt,g as gt,h as bt,C as ht,d as xt,i as Kt,Q as Z,c as Xe,W as at,U as ot,H as it,j as me,G as rt,o as cs,$ as tn,K as jt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import{H as He,M as Ot,c as T,d as $,o as u,e,g as L,t as V,n as J,s as a,x as Y,B as o,y as s,X as gs,Y as es,V as ts,r as O,k as I,C as dt,j as bs,T as Xt,O as Ge,F as Ce,P as ss,Z as Bt,I as ns,h as hs,u as qt,S as Ut,q as Se,i as Fe,l as he,p as oe,$ as Je,v as Wt,a0 as sn,a1 as nn,a2 as pt,G as qe,a3 as ln,_ as an,N as Ee,L as on,w as rn,m as xs}from"./index-Db_3peLd.js";import{u as Vt}from"./opportunities-CySWWyzd.js";import{_ as dn,T as un,e as ws,h as cn,i as mn,j as pn,k as vn,l as fn,m as yn,n as gn,s as bn,o as hn,p as xn,q as wn,d as ms,a as st,r as It,g as kn,c as Sn,f as Cn,u as $n,P as An,t as Dn,v as Tn,w as In,x as On,y as qn,z as Vn,A as Nn,B as Ln}from"./ComingSoonModal-ClD5EuQ6.js";import{_ as ks}from"./ReassignUserModal-Jtm4D-75.js";import{u as ls}from"./users-Dyw3oNPt.js";import{S as mt}from"./components-Ci9ddle2.js";import{S as Mn}from"./sparkles-CCfcFWX8.js";import{f as Ss}from"./vehicles-ygxbygEI.js";import{_ as En}from"./CreateEventModal-Y_RNkacC.js";import{_ as Fn,a as Rn}from"./EditEventModal-LuRwpSnI.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=He("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=He("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=He("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=He("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=He("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=He("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=He("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=He("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=He("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=He("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=He("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Jn={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Gn={class:"flex items-center justify-between gap-4 w-full h-full"},Zn={class:"flex flex-col min-w-0"},Kn={class:"flex items-center gap-2 min-w-0"},Xn={key:0,class:"text-fluid-lg font-medium text-heading truncate"},_n={key:1,class:"text-fluid-lg font-medium text-heading"},el={key:2,class:"flex items-center gap-1.5 shrink-0"},tl={class:"px-1.5 py-0.5 rounded bg-surfaceSecondary text-body text-sm font-bold uppercase border border-black/5"},sl={key:0,class:"text-sm text-sub truncate leading-normal mt-0.5"},nl={key:1,class:"text-fluid-sm text-sub"},ll={class:"flex items-center gap-2 shrink-0"},al={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close"],setup(n){const C=n,l=T(()=>!C.task||!C.filteredTasks.length?!1:C.filteredTasks.findIndex(g=>{const x=C.task.compositeId||C.task.id;return(g.compositeId||g.id)===x})>0),i=T(()=>{if(!C.task||!C.filteredTasks.length)return!1;const h=C.filteredTasks.findIndex(g=>{const x=C.task.compositeId||C.task.id;return(g.compositeId||g.id)===x});return h>=0&&h<C.filteredTasks.length-1}),c=h=>h?h.type==="lead"?"Lead Qualification Task":h.type==="opportunity"?"Opportunity Management Task":"Task Details":"No task selected",d=h=>{var x;if(!h)return"";const g=[];if(h.vehicle||h.requestedCar){const k=h.vehicle||h.requestedCar;k.brand&&k.model?g.push(`${k.brand} ${k.model} (${k.year||"N/A"})`):k.model&&g.push(`${k.model} (${k.year||"N/A"})`)}return(x=h.customer)!=null&&x.name?g.push(h.customer.name):h.customerName&&g.push(h.customerName),g.join(" • ")},r=h=>h?h.stage||h.currentStage||"New":"",f=h=>{const g=r(h).toLowerCase();return g.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":g.includes("qualif")?"bg-green-50 text-green-600 border-green-200":g.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":g.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"};return(h,g)=>(u(),$("div",Jn,[e("div",Gn,[e("div",Zn,[e("div",Kn,[n.task?(u(),$("h2",Xn,V(c(n.task)),1)):(u(),$("h2",_n," No task selected ")),n.task?(u(),$("div",el,[e("span",{class:J(["px-1.5 py-0.5 rounded text-sm font-bold uppercase border border-transparent",f(n.task)])},V(r(n.task)),3),e("span",tl,V(n.task.source||"N/A"),1)])):L("",!0)]),n.task?(u(),$("p",sl,V(d(n.task)),1)):(u(),$("p",nl," Select a task to view details "))]),e("div",ll,[a(s(j),{variant:"secondary",size:"icon",onClick:g[0]||(g[0]=x=>h.$emit("previous")),disabled:!l.value},{default:o(()=>[a(s(Bn),{size:16,class:"text-body"})]),_:1},8,["disabled"]),a(s(j),{variant:"secondary",size:"icon",onClick:g[1]||(g[1]=x=>h.$emit("next")),disabled:!i.value},{default:o(()=>[a(s(jn),{size:16,class:"text-body"})]),_:1},8,["disabled"]),n.isDrawerView?(u(),Y(s(j),{key:0,variant:"secondary",size:"icon",onClick:g[2]||(g[2]=x=>h.$emit("close")),class:"ml-1"},{default:o(()=>[a(s(gs),{size:16,class:"text-body"})]),_:1})):L("",!0)])])]))}},ol=Ot(al,[["__scopeId","data-v-cf7c1030"]]),il=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:n=>["lead","opportunity"].includes(n)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(n){return(C,l)=>(u(),$("div",null,[n.managementWidget?(u(),Y(ts(n.managementWidget),es({key:0,lead:n.type==="lead"?n.task:void 0,opportunity:n.type==="opportunity"?n.task:void 0,activities:n.activities},C.$attrs),null,16,["lead","opportunity","activities"])):L("",!0)]))}}),rl=Ot(il,[["__scopeId","data-v-f5db9491"]]),dl={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},ul={key:0,class:"w-full h-20 rounded-btn overflow-hidden mb-4 bg-gray-100"},cl=["src","alt"],ml={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},pl={class:"space-y-2 mb-4"},vl={class:"flex justify-between items-start gap-2"},fl={class:"min-w-0 flex-1"},yl={class:"text-sm font-medium text-heading truncate"},gl={key:0,class:"text-sm text-sub"},bl={key:0,class:"text-sm font-semibold text-heading shrink-0"},hl={key:0,class:"flex gap-3 text-sm text-sub"},xl={key:0},wl={key:1},kl={key:2,class:"mb-4"},Sl={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Cl={class:"text-sm text-heading"},$l={class:"flex gap-2 pt-4 border-t border-black/5"},Al={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(n){const C=n,l=O(!1),i=T(()=>{const f=[];return C.vehicle.brand&&f.push(C.vehicle.brand),C.vehicle.model&&f.push(C.vehicle.model),C.vehicle.variant&&f.push(C.vehicle.variant),f.join(" ")||"Vehicle Details"}),c=f=>{if(!f)return"0";const h=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(h)},d=f=>{if(!f)return"0";const h=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(h)},r=()=>{l.value=!0};return(f,h)=>(u(),$("div",dl,[h[4]||(h[4]=e("h3",{class:"text-base font-medium mb-4 text-heading -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),n.imageUrl?(u(),$("div",ul,[e("img",{src:n.imageUrl,alt:`${n.vehicle.brand} ${n.vehicle.model}`,class:"w-full h-full object-cover",onError:r},null,40,cl)])):(u(),$("div",ml,[a(s(Un),{size:48,class:"text-gray-400"})])),e("div",pl,[e("div",vl,[e("div",fl,[e("p",yl,V(i.value),1),n.vehicle.year?(u(),$("p",gl,V(n.vehicle.year),1)):L("",!0)]),n.vehicle.price?(u(),$("p",bl," €"+V(c(n.vehicle.price)),1)):L("",!0)]),n.vehicle.mileage||n.vehicle.fuelType?(u(),$("div",hl,[n.vehicle.mileage?(u(),$("span",xl,V(d(n.vehicle.mileage))+" km",1)):L("",!0),n.vehicle.fuelType?(u(),$("span",wl,V(n.vehicle.fuelType),1)):L("",!0)])):L("",!0)]),n.source?(u(),$("div",kl,[a(s(ys),{variant:"secondary",class:"text-sm"},{default:o(()=>[I(V(n.source),1)]),_:1})])):L("",!0),n.requestMessage?(u(),$("div",Sl,[h[2]||(h[2]=e("p",{class:"text-sm text-sub mb-1"},"Request message",-1)),e("p",Cl,V(n.requestMessage),1)])):L("",!0),e("div",$l,[a(s(j),{variant:"secondary",size:"sm",class:"flex-1",onClick:h[0]||(h[0]=g=>f.$emit("open-ad"))},{default:o(()=>[a(s(Wn),{size:16}),h[3]||(h[3]=e("span",null,"Open Ad",-1))]),_:1}),a(s(j),{variant:"secondary",size:"icon-sm",onClick:h[1]||(h[1]=g=>f.$emit("more-actions"))},{default:o(()=>[a(s(zn),{size:16})]),_:1})])]))}},Dl={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},Tl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},Il={class:"flex flex-1 overflow-hidden"},Ol={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},ql={class:"flex-1 overflow-y-auto"},Vl={class:"p-2"},Nl={class:"right-sidebar flex flex-col overflow-hidden shrink-0 border-l border-black/5 bg-surface"},Ll={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},Ml={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},El={class:"flex-1 overflow-y-auto bg-[#F8F8F8]"},Fl={key:1,class:"flex-1 flex items-center justify-center bg-surface"},Rl={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close"],setup(n,{emit:C}){const l=n,i=C,c=dt(),d=Vt(),r=O("request"),f=O({}),h=O(!1),g=O(!1),x=O(!1),k=O(!1),m=O(!1),b=T(()=>{var A;return((A=l.storeAdapter.currentActivities)==null?void 0:A.value)||[]}),S=T(()=>b.value.length),E=T(()=>{var re;if(!((re=l.task)!=null&&re.customer))return 0;const A=l.task.customer.email,N=l.task.customer.phone,de=l.task.compositeId||`${l.task.type}-${l.task.id}`;return[...(c.leads||[]).map(_=>({..._,type:"lead",compositeId:`lead-${_.id}`})),...(d.opportunities||[]).map(_=>({..._,type:"opportunity",compositeId:`opportunity-${_.id}`}))].filter(_=>_.compositeId===de||!_.customer?!1:_.customer.email===A||_.customer.phone===N).length}),M=()=>{i("task-navigate","previous")},p=()=>{i("task-navigate","next")},q=A=>{r.value!=="activity"&&(r.value="activity"),console.log("Activity clicked:",A)},D=A=>{f.value[A]=!f.value[A]},v=A=>A&&(A.image||A.imageUrl)||"",F=()=>{console.log("Open ad clicked")},P=()=>{console.log("More actions clicked")},W=A=>{console.log("Contact action:",A)},ie=A=>{A==="note"?h.value=!0:A==="attachment"?g.value=!0:A==="whatsapp"?x.value=!0:A==="sms"?k.value=!0:A==="email"&&(m.value=!0)},fe=async A=>{try{await l.storeAdapter.addActivity(l.task.id,{type:"note",content:A.content||A.message,message:A.content||A.message,timestamp:new Date().toISOString()}),h.value=!1}catch(N){console.error("Error saving note:",N)}},ue=async A=>{try{await l.storeAdapter.addActivity(l.task.id,{type:"attachment",fileName:A.fileName,file:A.file,content:`Attachment: ${A.fileName}`,timestamp:new Date().toISOString()}),g.value=!1}catch(N){console.error("Error saving attachment:",N)}},$e=async A=>{try{await l.storeAdapter.addActivity(l.task.id,{type:"whatsapp",message:A.message,content:A.message,template:A.template,timestamp:new Date().toISOString()}),x.value=!1}catch(N){console.error("Error saving WhatsApp:",N)}},G=async A=>{try{await l.storeAdapter.addActivity(l.task.id,{type:"sms",message:A.message,content:A.message,template:A.template,timestamp:new Date().toISOString()}),k.value=!1}catch(N){console.error("Error saving SMS:",N)}},z=async A=>{try{await l.storeAdapter.addActivity(l.task.id,{type:"email",subject:A.subject,message:A.message,content:A.message,template:A.template,timestamp:new Date().toISOString()}),m.value=!1}catch(N){console.error("Error saving email:",N)}};return(A,N)=>{var de,se,te,re;return u(),$("div",Dl,[n.task?(u(),$("div",Tl,[a(ol,{task:n.task,"filtered-tasks":n.filteredTasks,"is-drawer-view":n.isDrawerView,onPrevious:M,onNext:p,onClose:N[0]||(N[0]=_=>A.$emit("close"))},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",Il,[e("div",Ol,[e("div",ql,[e("div",Vl,[a(rl,es({task:n.task,type:n.task.type,"management-widget":n.managementWidget,activities:b.value},A.$attrs),null,16,["task","type","management-widget","activities"])])])]),e("div",Nl,[a(s(en),{modelValue:r.value,"onUpdate:modelValue":N[1]||(N[1]=_=>r.value=_),class:"flex flex-col flex-1 overflow-hidden"},{default:o(()=>[a(s(_s),{class:"flex border-b border-black/5 bg-white rounded-none w-full relative h-full"},{default:o(()=>[a(s(ds),{value:"request",class:J(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",r.value==="request"?"text-heading":"text-sub hover:text-body"])},{default:o(()=>[N[7]||(N[7]=e("span",null,"Request",-1)),E.value>0?(u(),$("span",{key:0,class:J(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",r.value==="request"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},V(E.value),3)):L("",!0),r.value==="request"?(u(),$("span",Ll)):L("",!0)]),_:1},8,["class"]),a(s(ds),{value:"activity",class:J(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",r.value==="activity"?"text-heading":"text-sub hover:text-body"])},{default:o(()=>[N[8]||(N[8]=e("span",null,"Activity",-1)),S.value>0?(u(),$("span",{key:0,class:J(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",r.value==="activity"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},V(S.value),3)):L("",!0),r.value==="activity"?(u(),$("span",Ml)):L("",!0)]),_:1},8,["class"])]),_:1}),e("div",El,[a(s(us),{value:"request",class:"space-y-2 p-2 mt-0"},{default:o(()=>{var _,B;return[a(dn,{task:n.task,"task-type":n.task.type,"customer-id":n.task.customerId||((_=n.task.customer)==null?void 0:_.id),onAction:W},null,8,["task","task-type","customer-id"]),n.task.requestedCar||n.task.vehicle?(u(),Y(Al,{key:0,vehicle:n.task.requestedCar||n.task.vehicle,"request-message":n.task.requestMessage||((B=n.task.requestedCar)==null?void 0:B.requestMessage),source:n.task.source,"image-url":v(n.task.requestedCar||n.task.vehicle),onOpenAd:F,onMoreActions:P},null,8,["vehicle","request-message","source","image-url"])):L("",!0)]}),_:1}),a(s(us),{value:"activity",class:"p-2 flex-1 overflow-hidden h-full flex flex-col mt-0"},{default:o(()=>[a(un,{activities:b.value,"expanded-summaries":f.value,onActivityClick:q,onToggleSummaryExpanded:D,onAddActivity:ie},null,8,["activities","expanded-summaries"])]),_:1})])]),_:1},8,["modelValue"])])])])):(u(),$("div",Fl,[...N[9]||(N[9]=[bs('<div class="text-center max-w-sm p-8" data-v-69e3734b><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-69e3734b><i class="fa-solid fa-tasks text-2xl text-sub" data-v-69e3734b></i></div><h3 class="text-fluid-lg font-bold text-heading mb-2" data-v-69e3734b>No task selected</h3><p class="text-fluid-sm text-sub" data-v-69e3734b>Select a task from the list to view its details and manage activities</p></div>',1)])])),a(ws,{modal:"",show:h.value,"task-type":((de=n.task)==null?void 0:de.type)||"lead","task-id":(se=n.task)==null?void 0:se.id,onSave:fe,onClose:N[2]||(N[2]=_=>h.value=!1)},null,8,["show","task-type","task-id"]),a(cn,{modal:"",show:g.value,"task-type":((te=n.task)==null?void 0:te.type)||"lead","task-id":(re=n.task)==null?void 0:re.id,onSave:ue,onClose:N[3]||(N[3]=_=>g.value=!1)},null,8,["show","task-type","task-id"]),a(mn,{show:x.value,onSave:$e,onClose:N[4]||(N[4]=_=>x.value=!1)},null,8,["show"]),a(pn,{show:k.value,onSave:G,onClose:N[5]||(N[5]=_=>k.value=!1)},null,8,["show"]),a(vn,{show:m.value,onSave:z,onClose:N[6]||(N[6]=_=>m.value=!1)},null,8,["show"])])}}},Ad=Ot(Rl,[["__scopeId","data-v-69e3734b"]]),Ul={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},Bl={__name:"DrawerContainer",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(n,{emit:C}){const l=C,i=()=>{l("close")};return(c,d)=>(u(),$(Ce,null,[a(Xt,{name:"fade"},{default:o(()=>[n.show?(u(),$("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:i})):L("",!0)]),_:1}),a(Xt,{name:"slide-right"},{default:o(()=>[n.show?(u(),$("div",Ul,[Ge(c.$slots,"default",{},void 0,!0)])):L("",!0)]),_:3})],64))}},Dd=Ot(Bl,[["__scopeId","data-v-6c60a3d5"]]);function Cs(n,C={}){const l=ss(),i=T(()=>{const M=typeof n=="function"?n():Bt(n);return{lead:M,displayStage:M?ns(M,"lead"):null}}),c=T(()=>i.value.displayStage||"New"),d=T(()=>{const M=i.value;return fn(M)}),r=T(()=>{const M=i.value,p=yn(M);if(!p)return null;const q=C[p.key];return{...p,handler:q||(()=>{})}}),f=T(()=>{const M=i.value;return gn(M).map(q=>{const D=C[q.key];return{...q,handler:D||(()=>{})}})}),h=T(()=>{const M=i.value;return bn(M)}),g=T(()=>{const M=i.value;return hn(M)}),x=T(()=>{const M=i.value;return xn(M)}),k=T(()=>{const M=i.value;return wn(M)}),m=T(()=>{const p=i.value.lead;return((p==null?void 0:p.contactAttempts)||[]).length||0}),b=T(()=>l.getSetting("maxContactAttempts")),S=T(()=>m.value+1>=b.value),E=T(()=>!0);return{displayStage:c,isClosed:d,primaryAction:r,secondaryActions:f,showLQWidget:h,showDeadlineBanner:g,canPostpone:x,canReassign:E,lqWidgetMode:k,contactAttempts:m,maxContactAttempts:b,shouldShowAutoDisqualifyWarning:S}}function jl({getLead:n,leadState:C,emit:l}){const i=hs(),c=dt(),d=qt();async function r(p){var D;const q=n();if(q&&C.canPostpone.value)try{const v=new Date(`${p.date}T${p.time}:00`),F=v.toISOString(),P={nextActionDue:F};if((p.assigneeId||p.teamId)&&(P.assignee=p.assignee||null,P.assigneeId=p.assigneeId||null,P.assigneeType=p.assigneeType||"user",P.teamId=p.teamId||null,P.team=p.team||null),await c.updateLead(q.id,P),p.createAppointment){const W=new Date(v);W.setHours(W.getHours()+1),await c.updateLead(q.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${q.customer.name}`,start:F,end:W.toISOString(),type:"Call",assignee:p.assignee||q.assignee,assigneeId:p.assigneeId||q.assigneeId,assigneeType:p.assigneeType||q.assigneeType||"user",teamId:p.teamId||q.teamId,team:p.team||q.team,status:"scheduled"}}),await c.addActivity(q.id,{type:"appointment",user:((D=d.currentUser)==null?void 0:D.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${st(v)} at ${It(v)}`,data:{type:"Call",date:p.date,time:p.time,assignee:p.assignee||q.assignee}})}await c.addActivity(q.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${st(v)} at ${It(v)}${p.assignee?` and reassigned to ${p.assignee}`:""}`}),await c.fetchLeadById(q.id)}catch(v){console.error("Failed to postpone lead task:",v)}}async function f(p){const q=n();if(q)try{if(await c.updateLead(q.id,{stage:"Validated"}),await c.addActivity(q.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),p.scheduleFollowUp&&p.appointmentData){const D=new Date(`${p.appointmentData.date}T${p.appointmentData.time}:00`);await c.scheduleFollowUp(q.id,{dateTime:D.toISOString(),assignee:p.appointmentData.assignee||q.assignee,assigneeId:p.appointmentData.assigneeId||null,assigneeType:p.appointmentData.assigneeType||"user",teamId:p.appointmentData.teamId||null,team:p.appointmentData.team||null}),await c.addActivity(q.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${st(D)} at ${It(D)}`})}await c.fetchLeadById(q.id)}catch(D){console.error("Failed to validate lead:",D)}}async function h(p){var D,v,F;const q=n();if(q)try{if((D=p==null?void 0:p.assignment)!=null&&D.assignee){const W=p.assignment.assignee,ie={assignee:W.name||W.label||null,assigneeId:W.id||null,assigneeType:W.type||"user"};W.type==="team"&&(ie.teamId=W.id||null,ie.team=W.name||null),p.assignment.salesperson&&(ie.assignee=p.assignment.salesperson.name||p.assignment.salesperson,ie.assigneeId=p.assignment.salesperson.id||null,ie.assigneeType="user",ie.teamId=W.id||null,ie.team=W.name||null),await c.updateLead(q.id,ie);const fe=((v=p.assignment.salesperson)==null?void 0:v.name)||W.name||"Unassigned";await c.addActivity(q.id,{type:"note",user:((F=d.currentUser)==null?void 0:F.name)||"You",action:"assigned lead",content:`Lead assigned to ${fe}${p.assignment.salesperson&&W.name?` (${W.name} team)`:""}`,timestamp:new Date().toISOString()})}const P=await c.convertLeadToOpportunity(q.id);d.canAccessOpportunities()?i.push({path:`/tasks/${P}`,query:{type:"opportunity"}}):i.push("/tasks")}catch(P){console.error("Failed to qualify lead:",P)}}async function g(p){const q=n();if(q)try{const D=q.contactAttempts||[];await c.updateLead(q.id,{contactAttempts:[...D,p],lastContactAttempt:p.timestamp,totalContactAttempts:D.length+1}),await c.addActivity(q.id,{type:"call",user:"You",action:`logged call attempt - ${p.outcome}`,content:p.notes||`Call attempt via ${p.channel}`,data:{outcome:p.outcome,channel:p.channel,duration:p.duration}}),await c.fetchLeadById(q.id)}catch(D){console.error("Failed to log call attempt:",D)}}async function x(p){const q=n();if(q)try{await c.addActivity(q.id,{type:"note",user:"You",action:"added a note",content:p.content||p.text||"",data:p}),await c.fetchLeadById(q.id)}catch(D){console.error("Failed to save note:",D)}}function k(){l("open-purchase-method")}function m(){l("open-trade-in")}async function b(p){var D;const q=n();if(q)try{const v=p.datetime?new Date(p.datetime).toISOString().split("T")[0]+"T"+p.time+":00":`${p.date}T${p.time}:00`,F=new Date(v),P=p.duration||60;F.setMinutes(F.getMinutes()+P);const W={scheduledAppointment:{id:Date.now(),title:`${p.type} - ${q.customer.name}`,start:v,end:F.toISOString(),type:p.type,assignee:p.assignee,assigneeId:p.assigneeId||p.salespersonId||p.teamId,assigneeType:p.assigneeType||(p.salespersonId?"user":"team"),teamId:p.teamId||null,team:p.team||null,salesperson:p.salesperson||null,salespersonId:p.salespersonId||null,status:"scheduled",location:p.location||"",notes:p.notes||""}};(p.assigneeId||p.salespersonId||p.teamId)&&(W.assignee=p.assignee||p.salesperson||p.team,W.assigneeId=p.assigneeId||p.salespersonId||p.teamId,W.assigneeType=p.assigneeType||(p.salespersonId?"user":"team"),p.teamId&&(W.teamId=p.teamId,W.team=p.team)),await c.updateLead(q.id,W),await c.addActivity(q.id,{type:"appointment",user:((D=d.currentUser)==null?void 0:D.name)||"You",action:"scheduled an appointment",content:`${p.type} scheduled for ${st(new Date(v))} at ${p.time}`,data:{type:p.type,date:p.date||st(new Date(v)),time:p.time,assignee:p.assignee,assigneeId:p.assigneeId,team:p.team,salesperson:p.salesperson}}),await c.fetchLeadById(q.id)}catch(v){console.error("Failed to schedule appointment:",v)}}async function S(p){const q=n();if(q&&!(C.isClosed.value&&!p.force))try{const D=C.displayStage.value,v=p.reason==="Duplicate"?Ut.CLOSED_DUPLICATE:p.category==="Not Interested"?Ut.CLOSED_NOT_INTERESTED:Ut.CLOSED_INVALID,F=ms(D,v);if(F){const{updates:P,activities:W}=F(q,v,p);await c.updateLead(q.id,P);for(const ie of W)await c.addActivity(q.id,ie)}else{const P=p.reason==="Duplicate";await c.updateLead(q.id,{isDisqualified:!0,disqualifyReason:p.reason,isDuplicate:P,stage:P?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await c.addActivity(q.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${p.category}, Reason: ${p.reason}`})}i.push("/tasks")}catch(D){console.error("Failed to disqualify lead:",D)}}async function E(){const p=n();if(p)try{const q=C.displayStage.value,D=Ut.NEW,v=ms(q,D);if(v){const{updates:F,activities:P}=v(p);await c.updateLead(p.id,F);for(const W of P)await c.addActivity(p.id,W)}else await c.updateLead(p.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await c.addActivity(p.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await c.fetchLeadById(p.id)}catch(q){console.error("Failed to reopen lead:",q)}}function M(){const p=n();p&&p.opportunityId&&i.push({path:`/tasks/${p.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:r,handleValidated:f,handleQualified:h,handleCallAttemptLogged:g,handleNoteSaved:x,handleOpenPurchaseMethod:k,handleOpenTradeIn:m,handleAppointmentScheduled:b,handleDisqualified:S,handleReopen:E,viewOpportunity:M}}const Wl={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},zl={class:"space-y-6"},$s={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(n){return(C,l)=>n.task?(u(),$("div",{key:0,class:J(["rounded-lg flex flex-col",n.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[n.hideTitle?L("",!0):(u(),$("div",Wl,[...l[0]||(l[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:J(["bg-white rounded-lg p-2 flex flex-col",n.hideBorder?"shadow-none":"shadow-sm"]),style:Se(n.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[Ge(C.$slots,"deadline-banner"),e("div",zl,[Ge(C.$slots,"primary-action"),Ge(C.$slots,"task-widgets"),Ge(C.$slots,"closed-state"),Ge(C.$slots,"secondary-actions")])],6)],2)):L("",!0)}},Pl={class:"flex justify-between items-start mb-3"},Hl={class:"font-bold text-gray-900 text-fluid-sm"},Ql={class:"text-fluid-xs text-gray-500 mt-0.5"},Yl={class:"flex gap-3 flex-wrap"},As={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(n){return(C,l)=>(u(),$("div",{class:J(["rounded-card p-4 relative transition-all duration-300 border",[n.colorScheme.background,n.colorScheme.border]])},[e("div",Pl,[e("div",null,[e("h4",Hl,V(n.action.title),1),e("p",Ql,V(n.action.description),1)])]),e("div",Yl,[e("button",{onClick:l[0]||(l[0]=i=>C.$emit("action-clicked")),class:J([n.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:J(n.action.icon)},null,2),I(" "+V(n.action.label),1)],2)])],2))}},Jl={class:"rounded-lg",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Gl={class:"bg-white rounded-lg px-3 py-2 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Zl={key:0,class:"flex items-center justify-between gap-2"},Kl={class:"flex items-center gap-2 min-w-0 flex-1"},Xl={class:"min-w-0 flex-1"},_l={class:"text-sm font-semibold text-greys-900 truncate leading-tight"},ea={class:"font-normal text-greys-500"},ta={class:"text-xs text-greys-500 truncate leading-tight"},sa={key:1,class:"space-y-2"},na={class:"flex items-center justify-between gap-2 flex-wrap"},la={class:"flex items-center gap-1.5 shrink-0"},aa={key:0,class:"flex gap-1.5 flex-wrap"},oa=["onClick"],ia={__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"}},emits:["reassigned"],setup(n,{emit:C}){const l=n,i=C,c=ls(),d=qt(),r=dt(),f=Vt(),h=O(!1),g=O(null),x=T(()=>d.currentUser),k=T(()=>!!(l.task.assignee||l.task.owner||l.task.assignedTo)),m=T(()=>{var F;const D=l.task.assignee||l.task.owner||l.task.assignedTo||"Unassigned",v=(F=c.allUsers)==null?void 0:F.find(P=>P.name===D);return{name:D,team:(v==null?void 0:v.team)||l.task.assigneeTeam||l.task.team||"No team",dealership:(v==null?void 0:v.dealership)||l.task.assigneeDealership||"MotorK Dealership",role:(v==null?void 0:v.role)||l.task.assigneeRole||"salesman"}});T(()=>!x.value||!k.value?!1:m.value.name===x.value.name);const b=T(()=>(c.assignableTeams||[]).slice(0,3)),S=D=>!D||D==="Unassigned"?"?":D.split(" ").map(v=>v[0]).join("").toUpperCase().substring(0,2),E=D=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[D]||"bg-surfaceSecondary text-body",M=async()=>{if(x.value)try{l.taskType==="lead"?await r.updateLead(l.task.id,{assignee:x.value.name,assigneeType:"user",assigneeTeam:x.value.team,assigneeDealership:x.value.dealership,assigneeRole:x.value.role}):l.taskType==="opportunity"&&await f.updateOpportunity(l.task.id,{assignee:x.value.name,assigneeType:"user",assigneeTeam:x.value.team,assigneeDealership:x.value.dealership,assigneeRole:x.value.role}),i("reassigned",x.value)}catch(D){console.error("Error assigning to self:",D)}},p=async D=>{g.value=D;try{l.taskType==="lead"?await r.updateLead(l.task.id,{assignee:D.name,assigneeType:"team",teamId:D.id,assigneeTeam:D.name}):l.taskType==="opportunity"&&await f.updateOpportunity(l.task.id,{assignee:D.name,assigneeType:"team",teamId:D.id,assigneeTeam:D.name}),i("reassigned",D)}catch(v){console.error("Error assigning to team:",v)}},q=async D=>{try{const v={assignee:D.name,assigneeType:D.type,assigneeTeam:D.team,assigneeDealership:D.dealership,assigneeRole:D.role};D.type==="team"&&(v.teamId=D.id),l.taskType==="lead"?await r.updateLead(l.task.id,v):l.taskType==="opportunity"&&await f.updateOpportunity(l.task.id,v),h.value=!1,i("reassigned",D)}catch(v){console.error("Error reassigning:",v)}};return(D,v)=>(u(),$(Ce,null,[e("div",Jl,[e("div",Gl,[k.value?(u(),$("div",Zl,[e("div",Kl,[e("div",{class:J(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",E(m.value.role)])},V(S(m.value.name)),3),e("div",Xl,[e("p",_l,[I(V(m.value.name)+" ",1),e("span",ea,"• "+V(m.value.team),1)]),e("p",ta,V(m.value.dealership),1)])]),a(s(j),{variant:"ghost",size:"sm",onClick:v[0]||(v[0]=F=>h.value=!0),class:"shrink-0 text-xs px-2 py-1"},{default:o(()=>[...v[3]||(v[3]=[I(" Change ",-1)])]),_:1})])):(u(),$("div",sa,[e("div",na,[v[6]||(v[6]=e("p",{class:"text-sm text-greys-500 font-medium"},"Unassigned",-1)),e("div",la,[a(s(j),{variant:"primary",size:"sm",onClick:M,class:"!bg-brand-red text-sm px-3 py-1"},{default:o(()=>[...v[4]||(v[4]=[I(" Assign to me ",-1)])]),_:1}),a(s(j),{variant:"outline",size:"sm",onClick:v[1]||(v[1]=F=>h.value=!0),class:"text-sm px-3 py-1 border-D1D5DB"},{default:o(()=>[...v[5]||(v[5]=[I(" Assign to someone ",-1)])]),_:1})])]),b.value.length>0?(u(),$("div",aa,[(u(!0),$(Ce,null,Fe(b.value,F=>{var P;return u(),$("button",{key:F.id,class:J(["inline-flex items-center gap-1 px-2 py-0.5 rounded-md border text-xs font-medium transition-all",((P=g.value)==null?void 0:P.id)===F.id?"border-brand-blue bg-blue-50 text-brand-blue":"border-E5E7EB hover:border-brand-blue/30 text-greys-600"]),onClick:W=>p(F)},[v[7]||(v[7]=e("i",{class:"fa-solid fa-users text-xs"},null,-1)),I(" "+V(F.name),1)],10,oa)}),128))])):L("",!0)]))])]),a(ks,{show:h.value,title:k.value?"Reassign task":"Assign task","confirm-label":k.value?"Reassign":"Assign",onClose:v[2]||(v[2]=F=>h.value=!1),onConfirm:q},null,8,["show","title","confirm-label"])],64))}},Ds=Ot(ia,[["__scopeId","data-v-8fbba5aa"]]),_t=(n,C)=>{if(!n||!C)return[];const l=new Date(C).getDay();if(l===0||l===6)return[];const[c,d]=n.split("-"),r=parseInt(d);return c==="team"?da(r,C):c==="user"?ra(r,C,l):[]},ra=(n,C,l)=>{const i={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(i[n]||i[1])[l]||[]},da=(n,C)=>{const l=new Date(C).getDay(),i=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return n===1?l===1||l===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:n===2?i.filter((c,d)=>d%2===0):i},ua={class:"space-y-6"},ca={class:"space-y-3"},ma={key:0,class:"space-y-4"},pa={class:"flex gap-2"},va={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fa={class:"flex items-center justify-between mb-4"},ya={class:"text-fluid-sm font-semibold text-heading"},ga={class:"grid grid-cols-7 gap-1 mb-2"},ba={class:"grid grid-cols-7 gap-1"},ha=["onClick"],xa={class:"text-fluid-sm font-semibold text-heading mb-4"},wa={key:0,class:"space-y-2"},ka=["onClick"],Sa={key:1,class:"text-fluid-sm text-sub py-4 text-center"},Ca={key:2,class:"text-fluid-sm text-sub py-4 text-center"},$a={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(n,{emit:C}){const l=n,i=C,c=qt(),d=ls(),r=O("assign-and-schedule"),f=O(""),h=O(null),g=O(""),x=O(""),k=O("30min"),m=O(new Date().getMonth()),b=O(new Date().getFullYear()),S=O(null);T(()=>d.assignableUsers),T(()=>d.assignableTeams);const E=T(()=>new Date(b.value,m.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),M=T(()=>{const z=new Date(b.value,m.value,1),N=new Date(b.value,m.value+1,0).getDate(),de=z.getDay(),se=[];for(let te=0;te<de;te++)se.push(null);for(let te=1;te<=N;te++)se.push(te);return se}),p=T(()=>{if(!S.value||!g.value)return"Select a date";const z=new Date(g.value),A=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${A[z.getDay()]}, ${N[z.getMonth()]} ${z.getDate()}`}),q=z=>{if(!z||!g.value)return!1;const A=new Date(g.value);return A.getDate()===z&&A.getMonth()===m.value&&A.getFullYear()===b.value},D=z=>{if(!z)return;const A=new Date(b.value,m.value,z);g.value=A.toISOString().split("T")[0],S.value=z,x.value=""},v=()=>{m.value===0?(m.value=11,b.value--):m.value--},F=()=>{m.value===11?(m.value=0,b.value++):m.value++},P=T(()=>!g.value||!h.value?[]:_t(h.value,g.value)),W=()=>{var z;if(l.preselectedAssignee){const{type:A,id:N}=l.preselectedAssignee;h.value=`${A}-${N}`}else h.value=`user-${((z=c.currentUser)==null?void 0:z.id)||1}`};W();const ie=T(()=>r.value==="assign-only"?!0:!!(f.value&&g.value&&x.value&&h.value));he(()=>l.show,z=>{z?W():fe()}),he(g,()=>{x.value=""});const fe=()=>{r.value="assign-and-schedule",f.value="",g.value="",x.value="",k.value="30min",S.value=null;const z=new Date;m.value=z.getMonth(),b.value=z.getFullYear()},ue=z=>{z||i("close")},$e=()=>{if(!ie.value)return;const z=h.value.startsWith("team-"),A=parseInt(h.value.split("-")[1]);let N={};if(z){const se=d.getTeamById(A);N={assigneeType:"team",teamId:A,team:(se==null?void 0:se.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const se=d.getUserById(A);N={assigneeType:"user",assigneeId:A,assignee:(se==null?void 0:se.name)||"Unknown",teamId:null,team:null}}const de={...N};r.value==="assign-and-schedule"&&(de.type=f.value,de.date=g.value,de.time=x.value,de.duration=k.value),i("confirm",de),i("close")},G=()=>{i("close")};return(z,A)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":ue},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-4xl"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),{class:"text-fluid-lg"},{default:o(()=>[...A[6]||(A[6]=[I("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",ua,[e("div",ca,[e("label",{class:J(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",r.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[oe(e("input",{type:"radio","onUpdate:modelValue":A[0]||(A[0]=N=>r.value=N),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[Je,r.value]]),A[7]||(A[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:J(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",r.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[oe(e("input",{type:"radio","onUpdate:modelValue":A[1]||(A[1]=N=>r.value=N),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[Je,r.value]]),A[8]||(A[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),r.value==="assign-and-schedule"?(u(),$("div",ma,[A[14]||(A[14]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Schedule",-1)),e("div",null,[A[10]||(A[10]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Event type",-1)),oe(e("select",{"onUpdate:modelValue":A[2]||(A[2]=N=>f.value=N),class:"input text-fluid-sm w-full"},[...A[9]||(A[9]=[e("option",{value:"",disabled:""},"Select event type",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[Wt,f.value]])]),e("div",null,[A[11]||(A[11]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Duration",-1)),e("div",pa,[e("button",{onClick:A[3]||(A[3]=N=>k.value="30min"),class:J(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",k.value==="30min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 30min ",2),e("button",{onClick:A[4]||(A[4]=N=>k.value="60min"),class:J(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",k.value==="60min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 60min ",2),e("button",{onClick:A[5]||(A[5]=N=>k.value="custom"),class:J(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",k.value==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," Custom ",2)])]),e("div",va,[e("div",null,[e("div",fa,[e("button",{onClick:v,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...A[12]||(A[12]=[e("i",{class:"fa-solid fa-chevron-left text-fluid-sm text-body"},null,-1)])]),e("h6",ya,V(E.value),1),e("button",{onClick:F,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...A[13]||(A[13]=[e("i",{class:"fa-solid fa-chevron-right text-fluid-sm text-body"},null,-1)])])]),e("div",ga,[(u(),$(Ce,null,Fe(["SUN","MON","TUE","WED","THU","FRI","SAT"],N=>e("div",{key:N,class:"text-center text-fluid-xs font-medium text-sub py-2"},V(N),1)),64))]),e("div",ba,[(u(!0),$(Ce,null,Fe(M.value,(N,de)=>(u(),$("div",{key:de,onClick:se=>D(N),class:J(["aspect-square flex items-center justify-center text-fluid-sm font-medium rounded-lg cursor-pointer transition-all",q(N)?"bg-green-600 text-white":N?"text-body hover:bg-surfaceSecondary":"text-transparent"])},V(N),11,ha))),128))])]),e("div",null,[e("h6",xa,V(p.value),1),g.value&&P.value.length>0?(u(),$("div",wa,[(u(!0),$(Ce,null,Fe(P.value,N=>(u(),$("button",{key:N,onClick:de=>x.value=N,class:J(["w-full py-2 px-4 border-2 rounded-lg text-fluid-sm font-medium text-left transition-all",x.value===N?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},V(N),11,ka))),128))])):g.value&&P.value.length===0?(u(),$("div",Sa," No available time slots for this date ")):(u(),$("div",Ca," Select a date to see available time slots "))])])])):L("",!0)]),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:G}),a(s(j),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!ie.value,onClick:$e},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Aa(){const n=sn(),C=O(!1),l=O(!1),i=O(0),c=O(""),d=O(null),r=O({}),f=O(null),h={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},g=T(()=>{const E=Math.floor(i.value/60),M=i.value%60;return`${E.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`}),x=()=>{C.value=!0,i.value=0,l.value=!1,c.value="",d.value=setInterval(()=>{i.value++,i.value>=20&&k()},1e3)},k=()=>{d.value&&(clearInterval(d.value),d.value=null),C.value=!1,l.value=!0,r.value={duration:i.value,notes:c.value,transcription:h,channel:"phone"}},m=async E=>{try{await navigator.clipboard.writeText(E),n.pushToast("success","Phone number copied to clipboard!")}catch{n.pushToast("error","Failed to copy phone number")}},b=E=>(f.value={tradeIn:h.leadLines.some(M=>M.toLowerCase().includes("trade")||M.toLowerCase().includes("exchange"))||!1,financing:h.leadLines.some(M=>M.toLowerCase().includes("financ")||M.toLowerCase().includes("payment")||M.toLowerCase().includes("loan"))||!1},f.value.tradeIn&&E&&(E.value.tradeIn=!0),f.value.financing&&E&&(E.value.financing=!0),f.value),S=()=>{C.value=!1,l.value=!1,i.value=0,c.value="",r.value={},d.value&&(clearInterval(d.value),d.value=null)};return nn(()=>{d.value&&clearInterval(d.value)}),{isCallActive:C,callEnded:l,callDuration:i,callNotes:c,callData:r,extractedData:f,mockTranscription:h,formattedCallDuration:g,startCall:x,endCall:k,copyNumber:m,extractInformation:b,resetCall:S}}function Da(n,C,l,i,c,d){var xe,Ue,De;const r=O(!0),f=O(null),h=O(!1),g=O(!1),x=O(!1),k=O(""),m=O(null),b=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],S=O("whatsapp"),E=O("followup-1"),M=O(null),p=O(""),q=O("09:00"),D=O(null),v=O("Not Interested"),F=O(""),P=O({dealership:((Ue=(xe=n.value)==null?void 0:xe.requestedCar)==null?void 0:Ue.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((De=d==null?void 0:d.value)==null?void 0:De.id)||null}),W=O(null),ie=O(null),fe=O({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),ue=T(()=>{var U,K;if(!((U=n.value)!=null&&U.requestedCar))return null;const Q=(K=n.value.requestedCar.condition)==null?void 0:K.toLowerCase();return Q==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:Q==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),$e=O({tradeIn:!1,financing:!1,contactAvailability:!1}),G=O(!1),z=O(null),A=O(!0),N=O(null),de=O(null),se=O(null),te=O(""),re=O(null),_=O(""),B=O(null),H=O(""),ge=O(""),wt=O(null),kt=O(""),Nt=T(()=>{const Q=[];for(let U=9*60;U<=18*60;U+=30){const K=String(Math.floor(U/60)).padStart(2,"0"),ee=String(U%60).padStart(2,"0");Q.push(`${K}:${ee}`)}return Q}),ut=T(()=>{if(re.value!=null)return re.value;const Q=parseInt(_.value,10);return Number.isFinite(Q)&&Q>0?Q:null}),St=T(()=>{if(!B.value)return[];const Q=[],U=new Date;if(U.setHours(0,0,0,0),B.value==="tomorrow"){const K=new Date(U);K.setDate(K.getDate()+1),K.getDay()!==0&&K.getDay()!==6&&Q.push(K)}else if(B.value==="this-week"){const K=U.getDay(),ee=new Date(U);ee.setDate(U.getDate()-(K===0?6:K-1));for(let X=0;X<5;X++){const ve=new Date(ee);ve.setDate(ee.getDate()+X),ve>=U&&Q.push(ve)}}else if(B.value==="custom"&&H.value&&ge.value){const K=new Date(H.value),ee=new Date(ge.value),X=new Date(K);for(;X<=ee;)X.getDay()!==0&&X.getDay()!==6&&Q.push(new Date(X)),X.setDate(X.getDate()+1)}return Q}),je=T(()=>{var ee,X,ve,Le,et,Ze,ct;const Q=((ve=(X=(ee=n.value)==null?void 0:ee.customer)==null?void 0:X.name)==null?void 0:ve.split(" ")[0])||"",U=((et=(Le=n.value)==null?void 0:Le.requestedCar)==null?void 0:et.brand)||"",K=((ct=(Ze=n.value)==null?void 0:Ze.requestedCar)==null?void 0:ct.model)||"";return{"followup-1":`Hi ${Q}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${U} ${K}?`,"followup-2":`Hello ${Q}, this is regarding your inquiry about the ${U} ${K}. Please let me know when you're available for a call.`,custom:""}}),_e=T(()=>E.value==="custom"?"Type your custom message...":je.value[E.value]||""),Ct=T(()=>{var Q;return!!((Q=n.value)!=null&&Q.scheduledAppointment)}),Lt=()=>{const Q=new Date,U=Q.getHours(),K=Q.getDay();let ee=new Date,X="10:00",ve="";if(K===5&&U>=15)ee.setDate(Q.getDate()+3),X="10:00",ve="Optimal time after weekend, customer likely refreshed";else if(K===6||K===0)ee.setDate(Q.getDate()+(K===6?2:1)),X="10:00",ve="Weekend follow-up avoided, better response rate on weekdays";else if(U>=17)ee.setDate(Q.getDate()+1),X="10:00",ve="Business hours preferred, higher engagement rate";else if(U<9)ee=new Date(Q),ee.setHours(10,0,0,0),X="10:00",ve="Peak response time, customers more available mid-morning";else if(U<14){ee=new Date(Q);const Ze=U+2;ee.setHours(Ze,0,0,0),X=`${String(Ze).padStart(2,"0")}:00`,ve="Follow-up within same day increases conversion likelihood"}else ee.setDate(Q.getDate()+1),ee.setHours(10,0,0,0),X="10:00",ve="Next morning follow-up maintains momentum";const Le=ee.toISOString().split("T")[0],et=`${Le}T${X}:00`;return{date:Le,time:X,dateTime:et,reason:ve,formattedDate:ee.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:r,selectedOutcome:f,showNoteModal:h,showScheduleAppointmentModal:g,followupChannels:b,followupChannel:S,selectedTemplate:E,rescheduleTime:M,customDate:p,customTime:q,disqualifyCategory:v,disqualifyReason:F,assignment:P,preferences:$e,surveyCompleted:G,surveyResponses:z,showSurvey:A,aiSuggestionData:D,showCallLogForm:x,callLogDateTime:k,callLogAssignee:m,qualificationSelectedTeam:W,qualificationSelectedSalesman:ie,suggestedTeam:ue,communicationPreferences:fe,messageTemplates:je,messagePreview:_e,hasExistingAppointment:Ct,selectOutcome:Q=>{if(f.value=Q,!k.value){const U=new Date,K=U.getFullYear(),ee=String(U.getMonth()+1).padStart(2,"0"),X=String(U.getDate()).padStart(2,"0"),ve=String(U.getHours()).padStart(2,"0"),Le=String(U.getMinutes()).padStart(2,"0");k.value=`${K}-${ee}-${X}T${ve}:${Le}`}!m.value&&(d!=null&&d.value)&&(m.value=d.value),Q==="interested"&&(G.value=!1,z.value=null,A.value=!0,l!=null&&l.value&&($e.value.tradeIn=l.value.tradeIn||!1,$e.value.financing=l.value.financing||!1))},cancelOutcome:()=>{f.value=null,x.value=!1},calculateNextCallDate:()=>{if(M.value==="tomorrow-9am"){const U=new Date;return U.setDate(U.getDate()+1),U.setHours(9,0,0,0),U.toISOString()}else if(M.value==="monday"){if(D.value)return new Date(D.value.dateTime).toISOString();const U=new Date,K=(8-U.getDay())%7||7;return U.setDate(U.getDate()+K),U.setHours(9,0,0,0),U.toISOString()}else if(M.value==="custom"&&p.value&&q.value)return new Date(`${p.value}T${q.value}:00`).toISOString();const Q=new Date;return Q.setDate(Q.getDate()+1),Q.setHours(9,0,0,0),Q.toISOString()},calculateAISuggestion:Lt,handleAISuggestionClick:()=>{M.value="monday",D.value=Lt()},resetOutcomeState:()=>{f.value=null,r.value=!0,S.value="whatsapp",E.value="followup-1",M.value=null,p.value="",q.value="09:00",v.value="Not Interested",F.value="",G.value=!1,z.value=null,A.value=!0,D.value=null,x.value=!1,k.value="",m.value=null,N.value=null,de.value=null,se.value="assign-only",te.value="",B.value=null,H.value="",ge.value="",wt.value=null,kt.value="",W.value=null,ie.value=null,re.value=null,_.value=""},initCallLogForm:(Q=!1)=>{if(N.value)return;const U=new Date,K=U.getFullYear(),ee=String(U.getMonth()+1).padStart(2,"0"),X=String(U.getDate()).padStart(2,"0"),ve=String(U.getHours()).padStart(2,"0"),Le=String(U.getMinutes()).padStart(2,"0");k.value=`${K}-${ee}-${X}T${ve}:${Le}`,d!=null&&d.value&&(m.value=d.value),x.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{x.value=!1,k.value="",m.value=null},clearSuccessState:()=>{N.value=null,de.value=null},successState:N,successPerformedAt:de,qualificationMethod:se,qualificationEventType:te,qualificationDurationMinutes:re,qualificationCustomDuration:_,qualificationDateRange:B,qualificationCustomDateStart:H,qualificationCustomDateEnd:ge,availableDatesForRange:St,qualificationSelectedDate:wt,qualificationSelectedSlot:kt,qualificationScheduleSlotOptions:Nt,qualificationDurationValue:ut}}function Ta(n,C,l,i,c,d,r,f,h=null){const{callData:g}=C,{showOutcomeSelection:x,selectedOutcome:k,assignment:m,preferences:b,cancelOutcome:S,calculateNextCallDate:E,showScheduleAppointmentModal:M,surveyCompleted:p,surveyResponses:q,showSurvey:D,initCallLogForm:v,callLogDateTime:F,callLogAssignee:P,successState:W,successPerformedAt:ie,rescheduleTime:fe,aiSuggestionData:ue,customDate:$e,customTime:G,qualificationMethod:z,qualificationEventType:A,qualificationDurationValue:N,qualificationSelectedDate:de,qualificationSelectedSlot:se,qualificationSelectedTeam:te,qualificationSelectedSalesman:re,communicationPreferences:_}=l,B=()=>{var ne;return((ne=f==null?void 0:f.value)==null?void 0:ne.name)||"Unknown"},H=()=>fe.value==="tomorrow-9am"?"Tomorrow 9:00 AM":fe.value==="monday"&&ue.value?`${ue.value.formattedDate} at ${ue.value.time}`:fe.value==="monday"?"Monday":fe.value==="custom"&&$e.value&&G.value?`${$e.value} ${G.value}`:"selected time";return{logManualCall:()=>{g.value={channel:"external",notes:"",transcription:null},v(!0)},handleScheduleAppointmentConfirm:async ne=>{M.value=!1,n("appointment-scheduled",ne)},handleQualify:async()=>{var xe,Ue,De,Q,U,K,ee,X,ve,Le,et,Ze,ct,zt,Pt,Be,Mt,Ht,Qt,$t,Te,At,Ie,Ne,tt;const ne={timestamp:new Date().toISOString(),outcome:"interested",channel:((xe=g.value)==null?void 0:xe.channel)||"phone",notes:((Ue=g.value)==null?void 0:Ue.notes)||"",transcription:((De=g.value)==null?void 0:De.transcription)||null};n("call-attempt-logged",ne),n("validated",{scheduleFollowUp:!1});let le="Unassigned";z.value==="assign-and-schedule"?re.value?le=re.value.name:te.value&&(le=te.value.name):le=((U=(Q=m.value)==null?void 0:Q.assignee)==null?void 0:U.name)||"Unassigned";let Ae=null,ae=!1,We=null;if(z.value==="assign-and-schedule"&&de.value&&se.value){const be=de.value,Yt=be.toLocaleDateString(void 0,{month:"long",day:"numeric"}),we={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[A.value]||A.value;ae=!0;const Qe=be.getFullYear(),Pe=String(be.getMonth()+1).padStart(2,"0"),Dt=String(be.getDate()).padStart(2,"0"),Tt=`${Qe}-${Pe}-${Dt}`;if(We={datetime:be,date:Tt,time:se.value,type:we,assignee:le,assigneeId:((K=re.value)==null?void 0:K.id)||((ee=te.value)==null?void 0:ee.id)||null,assigneeType:re.value?"user":"team",duration:N.value,team:((X=te.value)==null?void 0:X.name)||null,teamId:((ve=te.value)==null?void 0:ve.id)||null,salesperson:((Le=re.value)==null?void 0:Le.name)||null,salespersonId:((et=re.value)==null?void 0:et.id)||null},Ae={date:Yt,time:se.value,title:we,name:((ct=(Ze=i.value)==null?void 0:Ze.customer)==null?void 0:ct.name)||"",location:le},n("appointment-scheduled",We),_.value){const Oe=_.value;if((zt=Oe.immediateConfirmation)!=null&&zt.enabled&&((Be=(Pt=Oe.immediateConfirmation)==null?void 0:Pt.channels)==null?void 0:Be.length)>0){for(const Me of Oe.immediateConfirmation.channels)if(r&&((Mt=i.value)!=null&&Mt.id))try{await r.addActivity(i.value.id,{type:Me,user:B(),action:`sent ${Me} confirmation`,content:`Appointment confirmed: ${we} on ${Yt} at ${se.value}`,timestamp:new Date().toISOString()})}catch(Ke){console.error(`Failed to log ${Me} confirmation:`,Ke)}}if((Ht=Oe.reminder)!=null&&Ht.enabled&&(($t=(Qt=Oe.reminder)==null?void 0:Qt.channels)==null?void 0:$t.length)>0){const Me=new Date(be);Me.setDate(Me.getDate()-1);const Ke=Me.toISOString().split("T")[0];if(r&&((Te=i.value)!=null&&Te.id))try{await r.addActivity(i.value.id,{type:"reminder-scheduled",user:B(),action:"scheduled reminder",content:`Reminder scheduled for ${Ke} via ${Oe.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:Ke,channels:Oe.reminder.channels}})}catch(ye){console.error("Failed to schedule reminder:",ye)}}if((At=Oe.salespersonNotification)!=null&&At.enabled){const Me=((Ie=re.value)==null?void 0:Ie.name)||((Ne=te.value)==null?void 0:Ne.name)||"Team";if(r&&((tt=i.value)!=null&&tt.id))try{await r.addActivity(i.value.id,{type:"notification",user:B(),action:"sent notification",content:`Notification sent to ${Me} about appointment`,timestamp:new Date().toISOString()})}catch(Ke){console.error("Failed to send notification:",Ke)}}}}z.value==="assign-and-schedule"&&(re.value?m.value={...m.value,assignee:{...re.value,type:"user"},assigneeId:re.value.id,salesperson:re.value}:te.value&&(m.value={...m.value,assignee:{...te.value,type:"team"},team:te.value}));const Ve=z.value==="assign-and-schedule"?{assignee:re.value||te.value,salesperson:re.value||null,team:te.value||null}:m.value;let Re=null;if(h!=null&&h.value){const be=h.value;Re={interestLevel:be.interestLevel,purchaseTimeline:be.purchaseTimeline,budgetRange:be.budgetRange,hasTradeIn:be.hasTradeIn,tradeInModel:be.tradeInModel,financingOption:be.financingOption,additionalNotes:be.additionalNotes}}else p.value&&q.value&&(Re=q.value);n("qualified",{assignment:Ve,preferences:b.value,scheduleAppointment:ae,appointmentData:We,surveyData:Re});let ze=`Qualified - Assigned to ${le}`;Ae&&(ze=`Qualified - Assigned to ${le}, meeting on ${Ae.date} ${Ae.time}`),W.value={kind:"qualified",statusText:ze,meeting:Ae,actorName:B()},ie.value=new Date,S()},handleDisqualifyFromInterested:()=>{var le,Ae,ae;const ne={timestamp:new Date().toISOString(),outcome:"interested",channel:((le=g.value)==null?void 0:le.channel)||"phone",notes:((Ae=g.value)==null?void 0:Ae.notes)||"",transcription:((ae=g.value)==null?void 0:ae.transcription)||null};n("call-attempt-logged",ne),k.value="not-valid"},handleNoAnswerConfirm:async()=>{var Ve,Re,ze,xe;const ne={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Ve=g.value)==null?void 0:Ve.channel)||"phone",notes:((Re=g.value)==null?void 0:Re.notes)||"",transcription:((ze=g.value)==null?void 0:ze.transcription)||null};n("call-attempt-logged",ne);const le=E(),Ae=le.split("T")[0],ae=new Date(le).toTimeString().slice(0,5);if(r&&((xe=i.value)!=null&&xe.id))try{await r.updateLead(i.value.id,{nextActionDue:le,status:"Pending"})}catch(Ue){console.error('Failed to update lead status to "to be called back":',Ue)}n("postponed",{date:Ae,time:ae,createAppointment:!0}),(c==null?void 0:c.value)+1>=(d==null?void 0:d.value)&&n("disqualified",{category:"Not Interested",reason:"Unreachable"});const We=H();W.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${We}`,actorName:B()},ie.value=new Date,S()},handleNotValidConfirm:()=>{var le,Ae,ae;const ne={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((le=g.value)==null?void 0:le.channel)||"phone",notes:((Ae=g.value)==null?void 0:Ae.notes)||"",transcription:((ae=g.value)==null?void 0:ae.transcription)||null};n("call-attempt-logged",ne),n("disqualified",{category:l.disqualifyCategory.value,reason:l.disqualifyReason.value}),W.value={kind:"not-interested",statusText:"Closed - Not interested",actorName:B()},ie.value=new Date,S()},handleNoteSave:ne=>{l.showNoteModal.value=!1,n("note-saved",ne)},handleSurveyCompleted:async ne=>{var le;if(q.value=ne,p.value=!0,D.value=!1,r&&((le=i.value)!=null&&le.id))try{await r.addActivity(i.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ne),timestamp:new Date().toISOString()})}catch(Ae){console.error("Failed to save survey activity:",Ae)}n("survey-completed",{lead:i.value,responses:ne})},handleSurveyRefused:async()=>{var ne;if(D.value=!1,r&&((ne=i.value)!=null&&ne.id))try{await r.addActivity(i.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(le){console.error("Failed to save survey refusal activity:",le)}n("survey-refused",{lead:i.value})},handleNotResponding:async()=>{var ne;if(D.value=!1,r&&((ne=i.value)!=null&&ne.id))try{await r.addActivity(i.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(le){console.error("Failed to save survey not responding activity:",le)}n("not-responding",{lead:i.value})},handleReopen:()=>{l.clearSuccessState(),l.resetOutcomeState()}}}const Ia=["disabled"],Oa={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:n=>["small","medium"].includes(n)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(n){return(C,l)=>(u(),$("button",{class:J(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",n.size==="small"?"px-3 py-1.5 text-fluid-xs":"px-4 py-2 text-fluid-sm"]),disabled:n.disabled,style:{background:"linear-gradient(to right, #9333EA, #A855F7, #C084FC)"},onClick:l[0]||(l[0]=i=>C.$emit("click",i))},[a(s(Mn),{size:n.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,V(n.label),1)],10,Ia))}},qa={class:"flex gap-2 items-center mb-4"},Va={key:0,class:"mb-4 space-y-4 border-t border pt-4"},Na={key:0,class:"bg-slate-900 text-white rounded-card p-4"},La={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Ma={class:"flex items-center gap-2 text-red-400"},Ea={class:"text-xs font-mono"},Fa={class:"space-y-3 text-sm font-mono"},Ra={class:"ml-2"},Ua={class:"ml-2"},Ba={key:0},ja={class:"ml-2"},Wa={key:1},za={class:"ml-2"},Pa={key:2},Ha={class:"ml-2"},Qa={class:"mt-4 pt-4 border-t border-slate-700"},Ya=["model-value"],Ja={class:"mt-4 flex justify-end"},Ga={key:1,class:"bg-blue-50 border border-blue-200 rounded-card p-4"},Za={class:"flex items-center justify-between"},Ka={class:"flex gap-2"},Xa={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(n){return(C,l)=>(u(),$("div",null,[e("div",qa,[e("button",{onClick:l[0]||(l[0]=i=>C.$emit("start-call")),class:J(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",n.isCallActive?"bg-brand-red text-white border-brand-red":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[l[4]||(l[4]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),I(" "+V(n.contactAttempts>0?"Call Again":"Initiate Call"),1)],2)]),n.isCallActive||n.callEnded?(u(),$("div",Va,[n.isCallActive?(u(),$("div",Na,[e("div",La,[l[6]||(l[6]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Ma,[l[5]||(l[5]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ea,"REC "+V(n.formattedCallDuration),1)])]),e("div",Fa,[e("div",null,[l[7]||(l[7]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ra,V(n.mockTranscription.leadLines[0]),1)]),e("div",null,[l[8]||(l[8]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ua,V(n.mockTranscription.salesLines[0]),1)]),n.callDuration>=5?(u(),$("div",Ba,[l[9]||(l[9]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",ja,V(n.mockTranscription.leadLines[1]),1)])):L("",!0),n.callDuration>=8?(u(),$("div",Wa,[l[10]||(l[10]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",za,V(n.mockTranscription.salesLines[1]),1)])):L("",!0),n.callDuration>=12?(u(),$("div",Pa,[l[11]||(l[11]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ha,V(n.mockTranscription.leadLines[2]),1)])):L("",!0)]),e("div",Qa,[e("textarea",{"model-value":n.callNotes,"onUpdate:modelValue":l[1]||(l[1]=i=>C.$emit("update:call-notes",i)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Ya)]),e("div",Ja,[a(s(j),{label:"End Call",variant:"primary",size:"small",onClick:l[2]||(l[2]=i=>C.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):L("",!0),n.callEnded&&!n.isCallActive?(u(),$("div",Ga,[e("div",Za,[l[12]||(l[12]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",Ka,[a(Oa,{label:"Extract information",size:"small",onClick:l[3]||(l[3]=i=>C.$emit("extract-information"))})])])])):L("",!0)])):L("",!0)]))}},_a={class:"flex items-center gap-2.5 min-w-0"},eo={class:"flex items-center gap-2 min-w-0"},Ts={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(n,{emit:C}){const l=n,i=C,c=O(!1),d=T(()=>kn(l.nextActionDue)),r=T(()=>d.value.type==="overdue"?ps:d.value.type==="urgent"?Yn:ps),f=T(()=>l.isClosed||!l.showDeadlineBanner||c.value?!1:d.value.type==="overdue"||d.value.type==="urgent"),h=()=>{c.value=!0,i("dismissed")};return(g,x)=>f.value?(u(),$("div",{key:0,class:J(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[d.value.bgClass,d.value.borderClass]])},[e("div",_a,[e("div",{class:J(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",d.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(u(),Y(ts(r.value),{size:12,class:J(d.value.textClass)},null,8,["class"]))],2),e("div",eo,[e("span",{class:J(["text-[10px] font-bold uppercase tracking-wider",d.value.textClass])},V(d.value.type==="overdue"?"Overdue":"Urgent"),3),x[0]||(x[0]=e("span",{class:"text-fluid-xs text-sub opacity-30"},"•",-1)),e("span",{class:J(["text-fluid-xs font-medium truncate",d.value.textClass])}," Next Action: "+V(s(Sn)(n.nextActionDue)),3)])]),e("button",{onClick:h,class:J(["p-1 rounded-md transition-colors shrink-0",[d.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[a(s(gs),{size:14})],2)],2)):L("",!0)}},to={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},so={class:"space-y-4"},no={class:"flex items-center gap-3"},lo={class:"flex items-center gap-3"},ao={class:"text-fluid-sm font-medium text-heading"},oo={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(n,{emit:C}){const l=C,i=[{value:"email",label:"via Email"},{value:"sms",label:"via SMS"},{value:"whatsapp",label:"via WhatsApp"}],c=O({immediateConfirmationEnabled:!0,immediateConfirmationChannels:["email"],reminderEnabled:!0,reminderChannels:["email"],salespersonNotification:!0});return he(c,d=>{var f,h;const r={immediateConfirmation:{enabled:d.immediateConfirmationEnabled,channels:d.immediateConfirmationEnabled&&((f=d.immediateConfirmationChannels)==null?void 0:f.length)>0?d.immediateConfirmationChannels:[]},reminder:{enabled:d.reminderEnabled,channels:d.reminderEnabled&&((h=d.reminderChannels)==null?void 0:h.length)>0?d.reminderChannels:[]},salespersonNotification:{enabled:d.salespersonNotification}};l("update",r)},{deep:!0}),(d,r)=>(u(),$("div",to,[r[7]||(r[7]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Send confirmations and reminders",-1)),e("div",so,[e("div",no,[a(s(Z),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:o(()=>[a(s(Kt),{id:"immediate-confirmation",modelValue:c.value.immediateConfirmationEnabled,"onUpdate:modelValue":r[0]||(r[0]=f=>c.value.immediateConfirmationEnabled=f)},null,8,["modelValue"]),r[5]||(r[5]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation to customer",-1))]),_:1}),c.value.immediateConfirmationEnabled?(u(),Y(s(mt),{key:0,modelValue:c.value.immediateConfirmationChannels,"onUpdate:modelValue":r[1]||(r[1]=f=>c.value.immediateConfirmationChannels=f),items:i,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),e("div",lo,[a(s(Z),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:o(()=>[a(s(Kt),{id:"reminder",modelValue:c.value.reminderEnabled,"onUpdate:modelValue":r[2]||(r[2]=f=>c.value.reminderEnabled=f)},null,8,["modelValue"]),r[6]||(r[6]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder the day before appointment",-1))]),_:1}),c.value.reminderEnabled?(u(),Y(s(mt),{key:0,modelValue:c.value.reminderChannels,"onUpdate:modelValue":r[3]||(r[3]=f=>c.value.reminderChannels=f),items:i,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),a(s(Z),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},{default:o(()=>[a(s(Kt),{id:"salesperson-notification",modelValue:c.value.salespersonNotification,"onUpdate:modelValue":r[4]||(r[4]=f=>c.value.salespersonNotification=f)},null,8,["modelValue"]),e("span",ao," Notify "+V(n.salesperson?n.salesperson.name:n.team?n.team.name:"salesperson")+" about appointment ",1)]),_:1})])]))}},io={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ro={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},uo={class:"flex items-center gap-3"},co={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},mo={class:"text-sm font-medium text-heading flex-1 pr-10"},po={key:0,class:"mt-4 bg-white rounded-lg border border-black/5 overflow-hidden shadow-sm"},vo={class:"grid grid-cols-2 gap-3 p-4 text-sm"},fo={class:"ml-2 font-medium text-heading"},yo={class:"ml-2 font-medium text-heading"},go={class:"ml-2 font-medium text-heading capitalize"},bo={class:"ml-2 font-medium text-heading"},ho={class:"flex justify-end mt-4"},xo={class:"px-4 py-2 flex items-center justify-between text-sm text-sub"},wo={class:"tabular-nums"},ko={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},So={class:"p-4"},Co={class:"flex justify-between items-start mb-3"},$o={class:"font-bold text-heading text-sm"},Ao={class:"text-sm text-body mt-0.5"},Do={key:0,class:"mb-3 bg-surfaceSecondary border border-black/5 rounded-lg p-3"},To={class:"flex items-center justify-between gap-4 flex-wrap"},Io={key:0,class:"flex items-center gap-2"},Oo={class:"flex items-center gap-2"},qo={class:"text-sm text-body"},Vo={key:1,class:"flex items-center gap-2"},No={class:"text-sm font-semibold text-heading"},Lo={key:0,class:"text-sm text-orange-600 font-medium flex items-center gap-1 ml-2"},Mo={class:"flex items-center gap-2 mb-3"},Eo={class:"text-sm text-body font-medium"},Fo={class:"px-4 py-4 space-y-3"},Ro={key:0,class:"space-y-4"},Uo={class:"flex flex-wrap gap-3"},Bo={key:0,class:"space-y-4"},jo={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Wo={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},zo={class:"grid grid-cols-4 gap-2 mb-4"},Po={key:0,class:"space-y-3"},Ho=["value"],Qo={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Yo={class:"grid grid-cols-3 gap-2"},Jo={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Go={key:1,class:"space-y-4"},Zo={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ko={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Xo={class:"mb-4"},_o={class:"flex gap-4"},ei={key:2,class:"space-y-4"},ti={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},si={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},ni={class:"space-y-4"},li={class:"flex gap-4"},ai={class:"space-y-2"},oi={class:"flex items-center gap-2 cursor-pointer"},ii={class:"flex justify-end gap-2 mt-4"},ri={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},di={class:"space-y-2"},ui={key:0,class:"space-y-4"},ci={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mi={class:"space-y-4"},pi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},vi={class:"mb-4"},fi={class:"flex items-center gap-2"},yi={class:"text-sub"},gi={class:"font-medium text-heading"},bi={key:0},hi={class:"flex items-center gap-2"},xi={class:"font-medium text-heading"},wi={key:1,class:"space-y-4"},ki={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Si={key:0,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ci={class:"mb-4"},$i={class:"flex gap-2 items-center flex-wrap"},Ai={class:"mb-4"},Di={class:"flex gap-2 flex-wrap"},Ti={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Ii={key:1,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Oi={class:"mb-4"},qi={class:"flex items-center gap-2"},Vi={class:"text-sub"},Ni={class:"font-medium text-heading"},Li={key:0},Mi={class:"flex items-center gap-2"},Ei={class:"font-medium text-heading"},Fi={key:2,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ri={key:0,class:"mb-4"},Ui={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},Bi={key:1},ji={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},Wi={key:0,class:"text-sm text-sub text-center py-4"},zi={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Pi={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},Hi={class:"ml-2 font-medium text-heading"},Qi={class:"ml-2 font-medium text-heading"},Yi={class:"ml-2 font-medium text-heading capitalize"},Ji={class:"ml-2 font-medium text-heading"},Gi={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Zi={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=ls(),d=qt();ss();const r=dt(),f=Cs(()=>l.lead,{}),h=Aa(),{isCallActive:g,callEnded:x,callDuration:k,callNotes:m,callData:b,extractedData:S,mockTranscription:E,formattedCallDuration:M,startCall:p,endCall:q,copyNumber:D,extractInformation:v}=h,F=O(null),P=O(!1),W=O(!1),ie=O(!1),fe=T(()=>c.assignableUsers),ue=T(()=>c.assignableTeams),$e=T(()=>d.currentUser),G=O({interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}),z=O(""),A=O(""),N=O(""),de=O("");T(()=>{var t;const w=new Set;return(t=ue.value)==null||t.forEach(R=>{R.dealership&&w.add(R.dealership)}),Array.from(w).sort()}),T(()=>{var w;return z.value?((w=ue.value)==null?void 0:w.filter(t=>t.dealership===z.value))||[]:ue.value||[]}),T(()=>{var t,R;if(!A.value)return fe.value||[];const w=(t=ue.value)==null?void 0:t.find(y=>y.id===A.value);return w?((R=fe.value)==null?void 0:R.filter(y=>y.team===w.name||y.teamId===w.id))||[]:fe.value||[]});const se=w=>w?w.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"?",te=w=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[w]||"bg-surfaceSecondary text-body",re=w=>{De.value.assignee=w,w.type==="team"&&(Ye.value=null),P.value=!1};T(()=>!!Mt.value),T(()=>{if(Te.value)return Te.value.statusText;const w=l.activities.filter(t=>t.type==="call"||t.type==="outcome").sort((t,R)=>new Date(R.timestamp)-new Date(t.timestamp))[0];return w?w.outcome||w.content||"Outcome logged":null});const _=async()=>{var w;try{const t=G.value,R=[];if(t.interestLevel&&R.push(`Interest level: ${t.interestLevel}`),t.purchaseTimeline&&R.push(`Purchase timeline: ${t.purchaseTimeline}`),t.budgetRange&&R.push(`Budget range: ${t.budgetRange}`),t.hasTradeIn&&t.tradeInModel&&R.push(`Trade-in: ${t.tradeInModel}`),t.financingOption){const ke={FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"};R.push(`Financing: ${ke[t.financingOption]||t.financingOption}`)}t.additionalNotes&&R.push(t.additionalNotes);const y=R.join(`
`);if(y.trim()&&(await r.addActivity(l.lead.id,{type:"note",user:((w=$e.value)==null?void 0:w.name)||"You",action:"enriched lead information",content:y,timestamp:new Date().toISOString()}),i("note-saved",{type:"note",content:y,timestamp:new Date().toISOString(),enrichData:{...t}})),t.interestLevel||t.purchaseTimeline||t.budgetRange){const ke={interestLevel:t.interestLevel,purchaseTimeline:t.purchaseTimeline,budgetRange:t.budgetRange};await r.addActivity(l.lead.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ke),timestamp:new Date().toISOString()}),i("survey-completed",{lead:l.lead,responses:ke})}G.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}}catch(t){console.error("Error saving enriched lead data:",t)}},B=()=>{p(),$t(!1)},H=()=>{D(l.lead.customer.phone)},ge=w=>{m.value=w},wt=T(()=>{var w;return((w=f.primaryAction.value)==null?void 0:w.title)||"Call to Verify Contact Details"}),kt=T(()=>{var w;return((w=f.primaryAction.value)==null?void 0:w.description)||"Begin lead qualification by verifying customer contact information."}),Nt=T(()=>l.lead.scheduledAppointment?new Date(l.lead.scheduledAppointment.start)<new Date:!1),ut=T(()=>!!l.lead.scheduledAppointment),St=T(()=>ut.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Nt.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:l.lead.nextActionDue?`Task Pending - Due ${Cn(l.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),je=f.contactAttempts,_e=f.maxContactAttempts,Ct=Da(pt(l,"lead"),b,S,je,_e,$e),{showOutcomeSelection:Lt,selectedOutcome:pe,showNoteModal:ne,showScheduleAppointmentModal:le,followupChannels:Ae,followupChannel:ae,selectedTemplate:We,rescheduleTime:Ve,customDate:Re,customTime:ze,disqualifyCategory:xe,disqualifyReason:Ue,assignment:De,preferences:Q,messageTemplates:U,messagePreview:K,hasExistingAppointment:ee,selectOutcome:X,cancelOutcome:ve,calculateNextCallDate:Le,surveyCompleted:et,surveyResponses:Ze,showSurvey:ct,aiSuggestionData:zt,handleAISuggestionClick:Pt,callLogDateTime:Be,callLogAssignee:Mt,confirmCallLogForm:Ht,cancelCallLogForm:Qt,initCallLogForm:$t,successState:Te,successPerformedAt:At,qualificationMethod:Ie,qualificationEventType:Ne,qualificationDurationMinutes:tt,qualificationCustomDuration:be,qualificationCalendarMonth:Yt,qualificationSelectedDate:we,qualificationSelectedSlot:Qe,qualificationDateRange:Pe,qualificationCustomDateStart:Dt,qualificationCustomDateEnd:Tt,availableDatesForRange:Oe,qualificationScheduleSlotOptions:Me,qualificationDurationValue:Ke,qualificationSelectedTeam:ye,qualificationSelectedSalesman:Ye,suggestedTeam:Is,communicationPreferences:Os}=Ct,qs=w=>{Os.value=w},Vs=(w,t)=>!w||!t?!1:w.getFullYear()===t.getFullYear()&&w.getMonth()===t.getMonth()&&w.getDate()===t.getDate(),Jt=w=>{Pe.value=w,we.value=null,Qe.value="",(w==="tomorrow"&&Oe.value.length>0||w==="this-week"&&Oe.value.length>0)&&(we.value=Oe.value[0])},as=T(()=>{if(!we.value)return[];const w=we.value.toISOString().split("T")[0];if(Ye.value){const t=_t(`user-${Ye.value.id}`,w);return Me.value.filter(R=>t.includes(R))}if(ye.value){const t=_t(`team-${ye.value.id}`,w);return Me.value.filter(R=>t.includes(R))}return Me.value});T(()=>l.activities.filter(w=>w.type==="note"));const os=T(()=>(ue.value||[]).slice(0,3)),Ns=T(()=>{if(!ue.value)return[];const w=[...ue.value];if(ye.value){const t=w.findIndex(R=>R.id===ye.value.id);if(t>0){const R=w.splice(t,1)[0];w.unshift(R)}}return w}),is=T(()=>Ns.value.map(w=>({...w,label:`${w.dealership||"No location"} → ${w.name}`,value:w.id}))),Gt=T(()=>{var R;if(!ye.value)return[];const w=ye.value;return(((R=fe.value)==null?void 0:R.filter(y=>y.team===w.name||y.teamId===w.id))||[]).map(y=>({...y,label:y.name,value:y.id}))}),Et=T({get:()=>{var w;return((w=ye.value)==null?void 0:w.id)||null},set:w=>{var R;if(!w){ye.value=null;return}const t=(R=ue.value)==null?void 0:R.find(y=>y.id===w);ye.value=t||null}}),Ft=T({get:()=>{var w;return((w=Ye.value)==null?void 0:w.id)||null},set:w=>{if(!w){Ye.value=null;return}const t=Gt.value.find(R=>R.id===w);Ye.value=t||null}});he([Pe,Is,ue],([w,t,R])=>{if(w&&t&&R&&!ye.value){const y=R.find(ce=>ce.id===t.id);y&&(ye.value=y)}},{immediate:!0}),he([Pe,Oe],([w,t])=>{w&&t&&t.length>0&&!we.value&&(we.value=t[0])}),he(pe,w=>{var t,R,y;if(w==="interested"&&Ie.value==="assign-only"&&!((t=De.value)!=null&&t.assignee))if(l.lead.assignee){const ce=(R=fe.value)==null?void 0:R.find(Zt=>Zt.name===l.lead.assignee),ke=(y=ue.value)==null?void 0:y.find(Zt=>Zt.name===l.lead.assignee);ce?De.value={...De.value,assignee:{...ce,type:"user"}}:ke&&(De.value={...De.value,assignee:{...ke,type:"team"}})}else os.value.length>0&&(De.value={...De.value,assignee:{...os.value[0],type:"team"}})}),he(()=>{var w;return(w=De.value)==null?void 0:w.assignee},w=>{(w==null?void 0:w.type)!=="team"&&(Ye.value=null)}),he(ye,()=>{Ye.value=null}),he(we,()=>{Qe.value=""}),he(Ye,()=>{Qe.value=""});const Ls=T(()=>!(pe.value!=="no-answer"||!ae.value||ae.value!=="dont-send"&&!We.value||!Ve.value||Ve.value==="custom"&&(!Re.value||!ze.value)));he(pe,w=>{w!=="interested"&&(G.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""},z.value="",A.value="",N.value="")}),he(N,w=>{var t,R;if(w){const y=(t=fe.value)==null?void 0:t.find(ce=>ce.id===w);if(y){const ce=(R=ue.value)==null?void 0:R.find(ke=>ke.name===y.team||ke.id===y.teamId);ce&&(A.value=ce.id,ce.dealership&&(z.value=ce.dealership))}}}),he(A,w=>{var t,R;if(w&&N.value){const y=(t=fe.value)==null?void 0:t.find(ke=>ke.id===N.value),ce=(R=ue.value)==null?void 0:R.find(ke=>ke.id===w);y&&ce&&y.team!==ce.name&&y.teamId!==ce.id&&(N.value="")}}),he(z,w=>{var t;if(w&&A.value){const R=(t=ue.value)==null?void 0:t.find(y=>y.id===A.value);R&&R.dealership!==w&&(A.value="",N.value="")}}),he(x,w=>{w&&!Te.value&&$t(!1)});const rs=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],Ms={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},Rt=w=>{tt.value=w,be.value=""};he(Ne,w=>{if(!w)return;const t=Ms[w];t&&(t===30?Rt(30):t===60?Rt(60):(tt.value=null,be.value=t.toString()))});const Es=T(()=>Ie.value==="assign-only"?!!(Ne.value&&ye.value):!!(Ne.value&&Ke.value&&Pe.value&&we.value&&Qe.value&&ye.value)),Fs=T(()=>!!(xe.value&&Ue.value)),Rs=T(()=>pe.value==="no-answer"?ae.value==="dont-send"?"Postpone":"Send and postpone":pe.value==="not-valid"?xe.value?`Close as ${xe.value}`:"Close":pe.value==="interested"?"Schedule and qualify":""),Us=T(()=>pe.value==="no-answer"?Ls.value:pe.value==="not-valid"?Fs.value:pe.value==="interested"?Es.value:!1),Bs=()=>{pe.value==="no-answer"?Hs():pe.value==="not-valid"?Qs():pe.value==="interested"&&Ps()},js=Ta(i,h,Ct,pt(l,"lead"),je,_e,r,$e,G),{logManualCall:Ws,handleScheduleAppointmentConfirm:zs,handleQualify:Ps,handleNoAnswerConfirm:Hs,handleNotValidConfirm:Qs,handleNoteSave:Ys,handleReopen:Js}=js,Gs=T(()=>{if(!At.value)return"";const w=At.value,t=String(w.getDate()).padStart(2,"0"),R=String(w.getMonth()+1).padStart(2,"0"),y=String(w.getFullYear()),ce=String(w.getHours()).padStart(2,"0"),ke=String(w.getMinutes()).padStart(2,"0");return`${t}/${R}/${y} ${ce}:${ke}`}),{saveTradeInVehicle:Zs}=$n(),Ks=async w=>{var t,R,y;try{W.value=!1,Q.value.financing=!0;const ce=w.type==="FIN"?"Captive Financing":w.type==="LEA"?"Leasing":"Long-Term Rental",ke=((t=w.fields)==null?void 0:t.monthlyInstalment)||0;await r.addActivity(l.lead.id,{type:"purchase-method",user:((R=$e.value)==null?void 0:R.name)||"You",action:`added a ${ce} purchase method`,content:`${ce}: €${ke.toLocaleString()}/month for ${((y=w.fields)==null?void 0:y.duration)||0} months`,data:{purchaseMethodId:w.id,type:w.type,...w.fields},timestamp:new Date().toISOString()}),i("note-saved",{type:"purchase-method",...w})}catch(ce){console.error("Error saving purchase method:",ce)}},Xs=async w=>{try{if(ie.value=!1,w.vehicleType==="tradein"||l.mode==="tradein"){const t=await Zs("lead",l.lead.id,w.vehicle,w.valuation||{});Q.value.tradeIn=!0,i("note-saved",{type:"tradein",id:t.activity.id,action:"added a trade-in",vehicleId:t.vehicle.id,data:t.activity.data,timestamp:t.activity.timestamp})}else{const{addVehicleToCustomer:t}=await an(async()=>{const{addVehicleToCustomer:R}=await import("./contacts-BPIU2ljN.js");return{addVehicleToCustomer:R}},__vite__mapDeps([0,1,2]));await t(l.lead.customerId,w.vehicle),i("note-saved",{type:"vehicle",vehicleType:w.vehicleType,...w.vehicle})}}catch(t){console.error("Error saving vehicle:",t)}};return(w,t)=>{var R;return u(),$("div",io,[s(Te)?(u(),$(Ce,{key:0},[e("div",ro,[e("div",uo,[e("div",co,[a(s(vs),{size:16,class:"text-green-600"})]),e("p",mo,V(s(Te).statusText),1)]),s(Te).meeting?(u(),$("div",po,[e("div",vo,[e("div",null,[t[53]||(t[53]=e("span",{class:"text-body"},"Date:",-1)),e("span",fo,V(s(Te).meeting.date),1)]),e("div",null,[t[54]||(t[54]=e("span",{class:"text-body"},"Time:",-1)),e("span",yo,V(s(Te).meeting.time),1)]),e("div",null,[t[55]||(t[55]=e("span",{class:"text-body"},"Type:",-1)),e("span",go,V(s(Te).meeting.title),1)]),e("div",null,[t[56]||(t[56]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",bo,V(s(Te).meeting.location),1)])])])):L("",!0),e("div",ho,[a(s(j),{variant:"outline",size:"small",class:"flex items-center gap-2",onClick:s(Js)},{default:o(()=>[a(s(Hn),{size:14}),t[57]||(t[57]=I(" Re-open ",-1))]),_:1},8,["onClick"])])]),e("div",xo,[e("span",null,"Updated by "+V(s(Te).actorName||"Unknown"),1),e("span",wo,V(Gs.value),1)])],64)):(u(),$(Ce,{key:1},[e("div",ko,[a(Ts,{"next-action-due":n.lead.nextActionDue,"show-deadline-banner":n.showDeadlineBanner,"task-id":n.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",So,[e("div",Co,[e("div",null,[e("h4",$o,V(wt.value),1),e("p",Ao,V(kt.value),1)]),e("div",{class:J(["flex items-center gap-2 px-2 py-1 rounded-btn text-sm font-semibold",St.value.class])},V(St.value.text),3)]),ut.value||s(je)>0?(u(),$("div",Do,[e("div",To,[ut.value?(u(),$("div",Io,[t[59]||(t[59]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-sm"},null,-1)),e("div",Oo,[t[58]||(t[58]=e("span",{class:"text-sm font-semibold text-heading"},"Scheduled Follow-up Call:",-1)),e("span",qo,V(s(st)(n.lead.scheduledAppointment.start))+" at "+V(s(It)(n.lead.scheduledAppointment.start)),1)])])):L("",!0),s(je)>0?(u(),$("div",Vo,[t[61]||(t[61]=e("i",{class:"fa-solid fa-phone text-body text-sm"},null,-1)),t[62]||(t[62]=e("span",{class:"text-sm font-semibold text-body"},"Contact Attempts:",-1)),e("span",No,V(s(je))+" / "+V(s(_e)),1),s(je)>=s(_e)-1?(u(),$("div",Lo,[...t[60]||(t[60]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):L("",!0)])):L("",!0)])])):L("",!0),e("div",Mo,[e("span",Eo,V(n.lead.customer.phone),1),e("button",{onClick:H,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...t[63]||(t[63]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])]),a(Xa,{"is-call-active":s(g),"call-ended":s(x),"call-duration":s(k),"call-notes":s(m),"formatted-call-duration":s(M),"mock-transcription":s(E),"contact-attempts":s(je),"max-contact-attempts":s(_e),onStartCall:B,onEndCall:s(q),onLogManualCall:s(Ws),onExtractInformation:s(v),"onUpdate:callNotes":ge,onCopyNumber:H},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"])])]),e("div",Fo,[s(Te)?L("",!0):(u(),$("div",Ro,[e("div",null,[t[67]||(t[67]=e("p",{class:"text-sm font-medium text-heading leading-normal mb-3"},"Log what is happening?",-1)),e("div",Uo,[a(s(j),{variant:"outline",onClick:t[0]||(t[0]=y=>s(X)("no-answer")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Se(s(pe)==="no-answer"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[a(s(Pn),{size:18,class:"shrink-0",style:Se(s(pe)==="no-answer"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),t[64]||(t[64]=e("span",null,"No answer",-1))]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[1]||(t[1]=y=>s(X)("not-valid")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Se(s(pe)==="not-valid"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[a(s(Qn),{size:18,class:"shrink-0",style:Se(s(pe)==="not-valid"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),t[65]||(t[65]=e("span",null,"Not valid",-1))]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[2]||(t[2]=y=>s(X)("interested")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Se(s(pe)==="interested"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[a(s(vs),{size:18,class:"shrink-0",style:Se(s(pe)==="interested"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),t[66]||(t[66]=e("span",null,"Interested",-1))]),_:1},8,["style"])])]),s(pe)==="no-answer"?(u(),$("div",Bo,[e("div",jo,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[68]||(t[68]=[I("When did you call?",-1)])]),_:1}),a(s(Xe),{type:"datetime-local",modelValue:s(Be),"onUpdate:modelValue":t[3]||(t[3]=y=>qe(Be)?Be.value=y:null),class:"w-full"},null,8,["modelValue"])]),e("div",Wo,[t[77]||(t[77]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Send follow-up message",-1)),e("div",zo,[a(s(j),{variant:"outline",onClick:t[4]||(t[4]=y=>ae.value="whatsapp"),class:"flex items-center justify-center gap-2",style:Se(s(ae)==="whatsapp"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[e("i",{class:"fa-brands fa-whatsapp text-xs",style:Se(s(ae)==="whatsapp"?{color:"var(--brand-blue)"}:{})},null,4),t[69]||(t[69]=e("span",null,"WhatsApp",-1))]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[5]||(t[5]=y=>ae.value="sms"),class:"flex items-center justify-center gap-2",style:Se(s(ae)==="sms"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[e("i",{class:"fa-solid fa-message text-xs",style:Se(s(ae)==="sms"?{color:"var(--brand-blue)"}:{})},null,4),t[70]||(t[70]=e("span",null,"SMS",-1))]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[6]||(t[6]=y=>ae.value="email"),class:"flex items-center justify-center gap-2",style:Se(s(ae)==="email"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[e("i",{class:"fa-solid fa-envelope text-xs",style:Se(s(ae)==="email"?{color:"var(--brand-blue)"}:{})},null,4),t[71]||(t[71]=e("span",null,"Email",-1))]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[7]||(t[7]=y=>ae.value="dont-send"),class:"flex items-center justify-center gap-2",style:Se(s(ae)==="dont-send"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[e("i",{class:"fa-solid fa-xmark text-xs",style:Se(s(ae)==="dont-send"?{color:"var(--brand-blue)"}:{})},null,4),t[72]||(t[72]=e("span",null,"Don't send",-1))]),_:1},8,["style"])]),s(ae)&&s(ae)!=="dont-send"?(u(),$("div",Po,[e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[73]||(t[73]=[I("Template",-1)])]),_:1}),a(s(rt),{modelValue:s(We),"onUpdate:modelValue":t[8]||(t[8]=y=>qe(We)?We.value=y:null)},{default:o(()=>[a(s(at),{class:"w-full h-10 min-h-10"},{default:o(()=>[a(s(ot),{placeholder:"Select template"})]),_:1}),a(s(it),null,{default:o(()=>[a(s(me),{value:"followup-1"},{default:o(()=>[...t[74]||(t[74]=[I("Follow-up 1",-1)])]),_:1}),a(s(me),{value:"followup-2"},{default:o(()=>[...t[75]||(t[75]=[I("Follow-up 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[76]||(t[76]=[I("Message preview",-1)])]),_:1}),e("textarea",{value:s(K),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-body bg-white resize-none",readonly:""},null,8,Ho)])])):L("",!0)]),e("div",Qo,[t[83]||(t[83]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Next call attempt",-1)),e("div",Yo,[a(s(j),{variant:"outline",onClick:t[9]||(t[9]=y=>Ve.value="tomorrow-9am"),class:"px-4 py-2 text-sm font-medium",style:Se(s(Ve)==="tomorrow-9am"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[...t[78]||(t[78]=[I(" Tomorrow 9:00 AM ",-1)])]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[10]||(t[10]=y=>Ve.value="monday"),class:"px-4 py-2 text-sm font-medium",style:Se(s(Ve)==="monday"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[...t[79]||(t[79]=[I(" Monday ",-1)])]),_:1},8,["style"]),a(s(j),{variant:"outline",onClick:t[11]||(t[11]=y=>Ve.value="custom"),class:"px-4 py-2 text-sm font-medium",style:Se(s(Ve)==="custom"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:o(()=>[...t[80]||(t[80]=[I(" Select time ",-1)])]),_:1},8,["style"])]),s(Ve)==="custom"?(u(),$("div",Jo,[e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[81]||(t[81]=[I("Date",-1)])]),_:1}),a(s(Xe),{type:"date",modelValue:s(Re),"onUpdate:modelValue":t[12]||(t[12]=y=>qe(Re)?Re.value=y:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[82]||(t[82]=[I("Time",-1)])]),_:1}),a(s(Xe),{type:"time",modelValue:s(ze),"onUpdate:modelValue":t[13]||(t[13]=y=>qe(ze)?ze.value=y:null),class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0),s(pe)==="not-valid"?(u(),$("div",Go,[e("div",Zo,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[84]||(t[84]=[I("When did you call?",-1)])]),_:1}),a(s(Xe),{type:"datetime-local",modelValue:s(Be),"onUpdate:modelValue":t[14]||(t[14]=y=>qe(Be)?Be.value=y:null),class:"w-full"},null,8,["modelValue"])]),e("div",Ko,[e("div",Xo,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[85]||(t[85]=[I("Category",-1)])]),_:1}),e("div",_o,[a(s(Z),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[oe(e("input",{type:"radio","onUpdate:modelValue":t[15]||(t[15]=y=>qe(xe)?xe.value=y:null),value:"Not Valid",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Je,s(xe)]]),t[86]||(t[86]=e("span",{class:"text-sm text-body"},"Not Valid",-1))]),_:1}),a(s(Z),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[oe(e("input",{type:"radio","onUpdate:modelValue":t[16]||(t[16]=y=>qe(xe)?xe.value=y:null),value:"Not Interested",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Je,s(xe)]]),t[87]||(t[87]=e("span",{class:"text-sm text-body"},"Not Interested",-1))]),_:1})])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[88]||(t[88]=[I("Failure Reason",-1)])]),_:1}),a(s(rt),{modelValue:s(Ue),"onUpdate:modelValue":t[17]||(t[17]=y=>qe(Ue)?Ue.value=y:null)},{default:o(()=>[a(s(at),{class:"w-full"},{default:o(()=>[a(s(ot),{placeholder:"Select a reason..."})]),_:1}),a(s(it),null,{default:o(()=>[a(s(me),{value:"Data cleanup"},{default:o(()=>[...t[89]||(t[89]=[I("Data cleanup",-1)])]),_:1}),a(s(me),{value:"Unreachable"},{default:o(()=>[...t[90]||(t[90]=[I("Unreachable",-1)])]),_:1}),a(s(me),{value:"Purchase postponed"},{default:o(()=>[...t[91]||(t[91]=[I("Purchase postponed",-1)])]),_:1}),a(s(me),{value:"Vehicle sold"},{default:o(()=>[...t[92]||(t[92]=[I("Vehicle sold",-1)])]),_:1}),a(s(me),{value:"Out of budget"},{default:o(()=>[...t[93]||(t[93]=[I("Out of budget",-1)])]),_:1}),a(s(me),{value:"Financing rejected"},{default:o(()=>[...t[94]||(t[94]=[I("Financing rejected",-1)])]),_:1}),a(s(me),{value:"Duplicate"},{default:o(()=>[...t[95]||(t[95]=[I("Duplicate",-1)])]),_:1}),a(s(me),{value:"Bought elsewhere"},{default:o(()=>[...t[96]||(t[96]=[I("Bought elsewhere",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])):L("",!0),s(pe)==="interested"?(u(),$("div",ei,[e("div",ti,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[97]||(t[97]=[I("When did you call?",-1)])]),_:1}),a(s(Xe),{type:"datetime-local",modelValue:s(Be),"onUpdate:modelValue":t[18]||(t[18]=y=>qe(Be)?Be.value=y:null),class:"w-full"},null,8,["modelValue"])]),e("div",si,[t[120]||(t[120]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Enrich lead",-1)),e("div",ni,[e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[98]||(t[98]=[I("Customer interest level?",-1)])]),_:1}),e("div",li,[a(s(Z),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[oe(e("input",{type:"radio","onUpdate:modelValue":t[19]||(t[19]=y=>G.value.interestLevel=y),value:"High",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Je,G.value.interestLevel]]),t[99]||(t[99]=e("span",{class:"text-sm text-body"},"High",-1))]),_:1}),a(s(Z),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[oe(e("input",{type:"radio","onUpdate:modelValue":t[20]||(t[20]=y=>G.value.interestLevel=y),value:"Medium",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Je,G.value.interestLevel]]),t[100]||(t[100]=e("span",{class:"text-sm text-body"},"Medium",-1))]),_:1}),a(s(Z),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[oe(e("input",{type:"radio","onUpdate:modelValue":t[21]||(t[21]=y=>G.value.interestLevel=y),value:"Low",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Je,G.value.interestLevel]]),t[101]||(t[101]=e("span",{class:"text-sm text-body"},"Low",-1))]),_:1})])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[102]||(t[102]=[I("Expected purchase timeline?",-1)])]),_:1}),a(s(rt),{modelValue:G.value.purchaseTimeline,"onUpdate:modelValue":t[22]||(t[22]=y=>G.value.purchaseTimeline=y)},{default:o(()=>[a(s(at),{class:"w-full h-10 min-h-10"},{default:o(()=>[a(s(ot),{placeholder:"Select timeline"})]),_:1}),a(s(it),null,{default:o(()=>[a(s(me),{value:"Immediate"},{default:o(()=>[...t[103]||(t[103]=[I("Immediate",-1)])]),_:1}),a(s(me),{value:"Within 1 month"},{default:o(()=>[...t[104]||(t[104]=[I("Within 1 month",-1)])]),_:1}),a(s(me),{value:"Within 3 months"},{default:o(()=>[...t[105]||(t[105]=[I("Within 3 months",-1)])]),_:1}),a(s(me),{value:"Within 6 months"},{default:o(()=>[...t[106]||(t[106]=[I("Within 6 months",-1)])]),_:1}),a(s(me),{value:"Just browsing"},{default:o(()=>[...t[107]||(t[107]=[I("Just browsing",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[108]||(t[108]=[I("Budget range (if discussed)?",-1)])]),_:1}),a(s(rt),{modelValue:G.value.budgetRange,"onUpdate:modelValue":t[23]||(t[23]=y=>G.value.budgetRange=y)},{default:o(()=>[a(s(at),{class:"w-full h-10 min-h-10"},{default:o(()=>[a(s(ot),{placeholder:"Select budget range"})]),_:1}),a(s(it),null,{default:o(()=>[a(s(me),{value:"Under €30k"},{default:o(()=>[...t[109]||(t[109]=[I("Under €30k",-1)])]),_:1}),a(s(me),{value:"€30k-€50k"},{default:o(()=>[...t[110]||(t[110]=[I("€30k-€50k",-1)])]),_:1}),a(s(me),{value:"€50k-€80k"},{default:o(()=>[...t[111]||(t[111]=[I("€50k-€80k",-1)])]),_:1}),a(s(me),{value:"€80k+"},{default:o(()=>[...t[112]||(t[112]=[I("€80k+",-1)])]),_:1}),a(s(me),{value:"Not discussed"},{default:o(()=>[...t[113]||(t[113]=[I("Not discussed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ai,[e("label",oi,[oe(e("input",{type:"checkbox","onUpdate:modelValue":t[24]||(t[24]=y=>G.value.hasTradeIn=y),class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[ln,G.value.hasTradeIn]]),t[114]||(t[114]=e("span",{class:"text-sm font-medium text-body"},"Trade in?",-1))]),a(s(Xe),{modelValue:G.value.tradeInModel,"onUpdate:modelValue":t[25]||(t[25]=y=>G.value.tradeInModel=y),disabled:!G.value.hasTradeIn,placeholder:"Car brand and model",class:"w-full h-10 min-h-10"},null,8,["modelValue","disabled"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[115]||(t[115]=[I("Financing?",-1)])]),_:1}),a(s(rt),{modelValue:G.value.financingOption,"onUpdate:modelValue":t[26]||(t[26]=y=>G.value.financingOption=y)},{default:o(()=>[a(s(at),{class:"w-full h-10 min-h-10"},{default:o(()=>[a(s(ot),{placeholder:"Select financing option"})]),_:1}),a(s(it),null,{default:o(()=>[a(s(me),{value:"FIN"},{default:o(()=>[...t[116]||(t[116]=[I("Captive Financing",-1)])]),_:1}),a(s(me),{value:"LEA"},{default:o(()=>[...t[117]||(t[117]=[I("Leasing",-1)])]),_:1}),a(s(me),{value:"LTR"},{default:o(()=>[...t[118]||(t[118]=[I("Long-Term Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[119]||(t[119]=[I("Additional notes",-1)])]),_:1}),a(s(cs),{modelValue:G.value.additionalNotes,"onUpdate:modelValue":t[27]||(t[27]=y=>G.value.additionalNotes=y),rows:"4",class:"w-full",placeholder:"Any relevant information about customer interest or preferences..."},null,8,["modelValue"])])]),e("div",ii,[a(s(j),{label:"Save",variant:"primary",size:"small",onClick:_})])]),e("div",ri,[t[123]||(t[123]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},"Qualification method",-1)),e("div",di,[e("label",{class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",s(Ie)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[oe(e("input",{"onUpdate:modelValue":t[28]||(t[28]=y=>qe(Ie)?Ie.value=y:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[Je,s(Ie)]]),t[121]||(t[121]=e("span",{class:"text-sm text-heading"},"Assign only",-1))],2),e("label",{class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",s(Ie)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[oe(e("input",{"onUpdate:modelValue":t[29]||(t[29]=y=>qe(Ie)?Ie.value=y:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[Je,s(Ie)]]),t[122]||(t[122]=e("span",{class:"text-sm text-heading"},"Assign and schedule",-1))],2)])]),s(Ie)==="assign-only"?(u(),$("div",ui,[e("div",ci,[t[126]||(t[126]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Event type",-1)),e("div",mi,[e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[124]||(t[124]=[I("Select event type",-1)])]),_:1}),a(s(rt),{modelValue:s(Ne),"onUpdate:modelValue":t[30]||(t[30]=y=>qe(Ne)?Ne.value=y:null)},{default:o(()=>[a(s(at),{class:"w-full h-10 min-h-10"},{default:o(()=>[a(s(ot),{placeholder:"Select event type"})]),_:1}),a(s(it),null,{default:o(()=>[(u(),$(Ce,null,Fe(rs,y=>a(s(me),{key:y.value,value:y.value},{default:o(()=>[I(V(y.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[125]||(t[125]=[I("Note for sellers",-1)])]),_:1}),a(s(cs),{modelValue:de.value,"onUpdate:modelValue":t[31]||(t[31]=y=>de.value=y),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the sellers..."},null,8,["modelValue"])])])]),e("div",pi,[t[131]||(t[131]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to :",-1)),e("div",vi,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[127]||(t[127]=[I("Select Team",-1)])]),_:1}),a(s(mt),{modelValue:Et.value,"onUpdate:modelValue":t[32]||(t[32]=y=>Et.value=y),items:is.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:y})=>[e("div",fi,[e("span",yi,V(y.dealership||"No location"),1),t[128]||(t[128]=e("span",{class:"text-sub"},"→",-1)),e("span",gi,V(y.name),1)])]),_:1},8,["modelValue","items"])]),s(ye)?(u(),$("div",bi,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[129]||(t[129]=[I("Select Salesperson (Optional)",-1)])]),_:1}),t[130]||(t[130]=e("p",{class:"text-sm text-sub mb-2"},"You can proceed without selecting a salesperson - the appointment will be assigned to the team.",-1)),a(s(mt),{modelValue:Ft.value,"onUpdate:modelValue":t[33]||(t[33]=y=>Ft.value=y),items:Gt.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:y})=>[e("div",hi,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",te(y.role)])},V(se(y.name)),3),e("span",xi,V(y.name),1)])]),_:1},8,["modelValue","items"])])):L("",!0)])])):L("",!0),s(Ie)==="assign-and-schedule"?(u(),$("div",wi,[e("div",ki,[t[133]||(t[133]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},"Event Type",-1)),a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[132]||(t[132]=[I("Select event type",-1)])]),_:1}),a(s(rt),{modelValue:s(Ne),"onUpdate:modelValue":t[34]||(t[34]=y=>qe(Ne)?Ne.value=y:null)},{default:o(()=>[a(s(at),{class:"w-full"},{default:o(()=>[a(s(ot),{placeholder:"Select event type"})]),_:1}),a(s(it),null,{default:o(()=>[(u(),$(Ce,null,Fe(rs,y=>a(s(me),{key:y.value,value:y.value},{default:o(()=>[I(V(y.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),s(Ne)?(u(),$("div",Si,[t[143]||(t[143]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Schedule",-1)),e("div",Ci,[a(s(Z),{class:"block text-sm font-medium text-body mb-2"},{default:o(()=>[...t[134]||(t[134]=[I("Duration",-1)])]),_:1}),e("div",$i,[a(s(j),{variant:"outline",onClick:t[35]||(t[35]=y=>Rt(30)),class:J(["px-3 py-2 text-sm font-medium",s(tt)===30?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[...t[135]||(t[135]=[I(" 30min ",-1)])]),_:1},8,["class"]),a(s(j),{variant:"outline",onClick:t[36]||(t[36]=y=>Rt(60)),class:J(["px-3 py-2 text-sm font-medium",s(tt)===60?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[...t[136]||(t[136]=[I(" 60min ",-1)])]),_:1},8,["class"]),a(s(Xe),{modelValue:s(be),"onUpdate:modelValue":t[37]||(t[37]=y=>qe(be)?be.value=y:null),type:"number",min:"1",placeholder:"Custom",class:"w-24",onInput:t[38]||(t[38]=y=>tt.value=null)},null,8,["modelValue"])])]),e("div",Ai,[a(s(Z),{class:"block text-sm font-medium text-body mb-2"},{default:o(()=>[...t[137]||(t[137]=[I("Select Date Range",-1)])]),_:1}),e("div",Di,[a(s(j),{variant:"outline",onClick:t[39]||(t[39]=y=>Jt("tomorrow")),class:J(["px-4 py-2 text-sm font-medium",s(Pe)==="tomorrow"?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[...t[138]||(t[138]=[I(" Tomorrow ",-1)])]),_:1},8,["class"]),a(s(j),{variant:"outline",onClick:t[40]||(t[40]=y=>Jt("this-week")),class:J(["px-4 py-2 text-sm font-medium",s(Pe)==="this-week"?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[...t[139]||(t[139]=[I(" This Week ",-1)])]),_:1},8,["class"]),a(s(j),{variant:"outline",onClick:t[41]||(t[41]=y=>Jt("custom")),class:J(["px-4 py-2 text-sm font-medium",s(Pe)==="custom"?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[...t[140]||(t[140]=[I(" Custom ",-1)])]),_:1},8,["class"])]),s(Pe)==="custom"?(u(),$("div",Ti,[e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[141]||(t[141]=[I("Start Date",-1)])]),_:1}),a(s(Xe),{type:"date",modelValue:s(Dt),"onUpdate:modelValue":t[42]||(t[42]=y=>qe(Dt)?Dt.value=y:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[142]||(t[142]=[I("End Date",-1)])]),_:1}),a(s(Xe),{type:"date",modelValue:s(Tt),"onUpdate:modelValue":t[43]||(t[43]=y=>qe(Tt)?Tt.value=y:null),class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0),s(Ne)&&s(Pe)?(u(),$("div",Ii,[t[148]||(t[148]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to :",-1)),e("div",Oi,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[144]||(t[144]=[I("Select Team",-1)])]),_:1}),a(s(mt),{modelValue:Et.value,"onUpdate:modelValue":t[44]||(t[44]=y=>Et.value=y),items:is.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:y})=>[e("div",qi,[e("span",Vi,V(y.dealership||"No location"),1),t[145]||(t[145]=e("span",{class:"text-sub"},"→",-1)),e("span",Ni,V(y.name),1)])]),_:1},8,["modelValue","items"])]),s(ye)?(u(),$("div",Li,[a(s(Z),{class:"block text-sm font-medium text-body mb-1.5"},{default:o(()=>[...t[146]||(t[146]=[I("Select Salesperson (Optional)",-1)])]),_:1}),t[147]||(t[147]=e("p",{class:"text-sm text-sub mb-2"},"You can proceed without selecting a salesperson - the appointment will be assigned to the team.",-1)),a(s(mt),{modelValue:Ft.value,"onUpdate:modelValue":t[45]||(t[45]=y=>Ft.value=y),items:Gt.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:y})=>[e("div",Mi,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",te(y.role)])},V(se(y.name)),3),e("span",Ei,V(y.name),1)])]),_:1},8,["modelValue","items"])])):L("",!0)])):L("",!0),s(ye)?(u(),$("div",Fi,[t[151]||(t[151]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},"Select Date and Time Slot",-1)),s(Oe).length>0?(u(),$("div",Ri,[a(s(Z),{class:"block text-sm font-medium text-body mb-2"},{default:o(()=>[...t[149]||(t[149]=[I("Select Date",-1)])]),_:1}),e("div",Ui,[(u(!0),$(Ce,null,Fe(s(Oe),y=>(u(),Y(s(j),{key:y.getTime(),variant:"outline",onClick:ce=>{we.value=y,Qe.value=""},class:J(["px-3 py-2 text-sm font-medium whitespace-nowrap shrink-0",s(we)&&Vs(y,s(we))?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[I(V(s(st)(y)),1)]),_:2},1032,["onClick","class"]))),128))])])):L("",!0),s(we)?(u(),$("div",Bi,[a(s(Z),{class:"block text-sm font-medium text-body mb-2"},{default:o(()=>[...t[150]||(t[150]=[I("Select Time Slot",-1)])]),_:1}),e("div",ji,[(u(!0),$(Ce,null,Fe(as.value,y=>(u(),Y(s(j),{key:y,variant:"outline",onClick:ce=>Qe.value=y,class:J(["px-3 py-2 text-sm font-medium whitespace-nowrap shrink-0",s(Qe)===y?"border-2 border-[#0470e9] bg-surfaceSecondary text-heading":""])},{default:o(()=>[I(V(y),1)]),_:2},1032,["onClick","class"]))),128)),as.value.length===0?(u(),$("p",Wi," No available slots for this date ")):L("",!0)])])):L("",!0)])):L("",!0),a(oo,{appointment:{type:s(Ne),date:s(we),time:s(Qe),duration:s(Ke)},customer:n.lead.customer,salesperson:s(Ye),team:s(ye),dealership:(R=s(ye))!=null&&R.dealership?{name:s(ye).dealership}:null,onUpdate:qs},null,8,["appointment","customer","salesperson","team","dealership"])])):L("",!0),s(ee)&&s(Ie)==="assign-only"?(u(),$("div",zi,[t[156]||(t[156]=bs('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-sm">Existing Appointment</h5></div><span class="text-sm font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Pi,[e("div",null,[t[152]||(t[152]=e("span",{class:"text-body"},"Date:",-1)),e("span",Hi,V(s(st)(n.lead.scheduledAppointment.start)),1)]),e("div",null,[t[153]||(t[153]=e("span",{class:"text-body"},"Time:",-1)),e("span",Qi,V(s(It)(n.lead.scheduledAppointment.start)),1)]),e("div",null,[t[154]||(t[154]=e("span",{class:"text-body"},"Type:",-1)),e("span",Yi,V(n.lead.scheduledAppointment.type),1)]),e("div",null,[t[155]||(t[155]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Ji,V(n.lead.scheduledAppointment.assignee),1)])]),a(s(j),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:t[46]||(t[46]=y=>le.value=!0)})])):L("",!0)])):L("",!0)])),s(pe)&&!s(Te)?(u(),$("div",Gi,[a(s(j),{variant:"secondary",onClick:s(ve)},{default:o(()=>[...t[157]||(t[157]=[I(" Cancel ",-1)])]),_:1},8,["onClick"]),a(s(j),{variant:"primary",disabled:!Us.value,onClick:Bs,class:"bg-primary"},{default:o(()=>[I(V(Rs.value),1)]),_:1},8,["disabled"])])):L("",!0)])],64)),a(ws,{ref_key:"noteWidgetRef",ref:F,modal:"",show:s(ne),item:null,"task-type":"lead","task-id":n.lead.id,onSave:s(Ys),onClose:t[47]||(t[47]=y=>ne.value=!1),onCancel:t[48]||(t[48]=y=>ne.value=!1)},null,8,["show","task-id","onSave"]),a($a,{show:s(le),"preselected-assignee":s(De).assignee,onConfirm:s(zs),onClose:t[49]||(t[49]=y=>le.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),a(ks,{show:P.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:re,onClose:t[50]||(t[50]=y=>P.value=!1)},null,8,["show"]),a(An,{show:W.value,"task-type":"lead","task-id":n.lead.id,onSave:Ks,onClose:t[51]||(t[51]=y=>W.value=!1)},null,8,["show","task-id"]),a(Dn,{show:ie.value,mode:"tradein","task-type":"lead","task-id":n.lead.id,"customer-id":n.lead.customerId,onClose:t[52]||(t[52]=y=>ie.value=!1),onSave:Xs},null,8,["show","task-id","customer-id"])])}}},Ki={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},Xi={class:"flex justify-between items-start mb-3"},_i={class:"text-fluid-xs text-body mt-0.5"},er={key:0},tr={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(n,{emit:C}){const l=n,i=C,c=dt(),d=()=>{var v;const D=c.currentLead;return D&&D.id===((v=l.lead)==null?void 0:v.id)?D:l.lead},r={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},f=Cs(pt(l,"lead"),r),{handlePostponed:h,handleValidated:g,handleQualified:x,handleCallAttemptLogged:k,handleNoteSaved:m,handleOpenPurchaseMethod:b,handleOpenTradeIn:S,handleAppointmentScheduled:E,handleDisqualified:M,handleReopen:p}=jl({getLead:d,leadState:f,emit:i}),q=async D=>{var v;(v=l.lead)!=null&&v.id&&await c.loadLeadById(l.lead.id)};return(D,v)=>(u(),Y($s,{task:n.lead,"hide-title":"","hide-border":""},{"primary-action":o(()=>[s(f).isClosed.value?L("",!0):(u(),Y(Ds,{key:0,task:n.lead,"task-type":"lead",onReassigned:q,class:"mb-3"},null,8,["task"])),!s(f).isClosed.value&&s(f).showLQWidget.value?(u(),Y(Zi,{key:n.lead.id,lead:n.lead,"show-deadline-banner":s(f).showDeadlineBanner.value,onPostponed:s(h),onValidated:s(g),onQualified:s(x),onDisqualified:s(M),onCallAttemptLogged:s(k),onNoteSaved:s(m),onOpenPurchaseMethod:s(b),onOpenTradeIn:s(S),onAppointmentScheduled:s(E)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!s(f).isClosed.value&&s(f).primaryAction.value?(u(),Y(As,{key:2,action:s(f).primaryAction.value,"color-scheme":s(f).primaryAction.value.colorScheme,onActionClicked:s(f).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]),"task-widgets":o(()=>[...v[0]||(v[0]=[])]),"closed-state":o(()=>[s(f).isClosed.value?(u(),$("div",Ki,[e("div",Xi,[e("div",null,[v[1]||(v[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",_i,[I(" Status: "+V(s(f).displayStage.value)+" ",1),n.lead.disqualifyReason?(u(),$("span",er," - "+V(n.lead.disqualifyReason),1)):L("",!0)])])]),a(s(j),{variant:"primary",size:"small",onClick:s(p),class:"flex items-center gap-2"},{default:o(()=>[...v[2]||(v[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):L("",!0)]),_:1},8,["task"]))}},sr={class:"flex justify-between items-start mb-3"},nr={class:"font-bold text-heading text-fluid-sm"},lr={class:"text-fluid-xs text-sub mt-0.5"},ar={class:"flex gap-3 flex-wrap"},nt={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:n=>n.background&&n.border}},setup(n){return(C,l)=>(u(),$("div",{class:J(["rounded-lg p-3 relative transition-all duration-300 border",[n.colorScheme.background,n.colorScheme.border]])},[e("div",sr,[e("div",null,[e("h4",nr,V(n.title),1),e("p",lr,V(n.description),1)]),Ge(C.$slots,"badge")]),e("div",ar,[Ge(C.$slots,"actions")]),Ge(C.$slots,"survey"),Ge(C.$slots,"content")],2))}},or={key:1,class:"space-y-4"},ir={class:"flex items-center justify-between"},rr={class:"space-y-4"},dr={class:"block text-fluid-sm font-medium text-body"},ur=["onUpdate:modelValue","placeholder"],cr=["onUpdate:modelValue"],mr=["value"],pr={key:2,class:"space-y-2"},vr=["onUpdate:modelValue","value"],fr={class:"flex gap-2 flex-wrap justify-end pt-2"},lt={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=O(l.initialExpanded),d=O({});he(()=>l.questions,x=>{const k={};x.forEach(m=>{k[m.key]=""}),d.value=k},{immediate:!0});const r=()=>{i("survey-completed",{...d.value}),g()},f=()=>{i("survey-refused"),g()},h=()=>{i("not-responding"),g()},g=()=>{c.value=!1;const x={};l.questions.forEach(k=>{x[k.key]=""}),d.value=x};return(x,k)=>(u(),$("div",null,[c.value?(u(),$("div",or,[e("div",ir,[k[4]||(k[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:k[1]||(k[1]=m=>c.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...k[3]||(k[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",rr,[(u(!0),$(Ce,null,Fe(n.questions,(m,b)=>(u(),$("div",{key:b,class:"space-y-2"},[e("label",dr,V(m.label),1),m.type==="text"?oe((u(),$("textarea",{key:0,"onUpdate:modelValue":S=>d.value[m.key]=S,placeholder:m.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,ur)),[[Ee,d.value[m.key]]]):m.type==="select"?oe((u(),$("select",{key:1,"onUpdate:modelValue":S=>d.value[m.key]=S,class:"input text-fluid-sm py-2 px-3 w-full"},[k[5]||(k[5]=e("option",{value:""},"Select an option...",-1)),(u(!0),$(Ce,null,Fe(m.options,S=>(u(),$("option",{key:S,value:S},V(S),9,mr))),128))],8,cr)),[[Wt,d.value[m.key]]]):m.type==="radio"?(u(),$("div",pr,[(u(!0),$(Ce,null,Fe(m.options,S=>(u(),$("label",{key:S,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[oe(e("input",{type:"radio","onUpdate:modelValue":E=>d.value[m.key]=E,value:S,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,vr),[[Je,d.value[m.key]]]),I(" "+V(S),1)]))),128))])):L("",!0)]))),128)),e("div",fr,[a(s(j),{label:"Complete Survey",variant:"primary",size:"small",onClick:r,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),a(s(j),{label:"Customer Refused",variant:"outline",size:"small",onClick:f}),a(s(j),{label:"Not Responding",variant:"outline",size:"small",onClick:h})])])])):(u(),$("button",{key:0,onClick:k[0]||(k[0]=m=>c.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...k[2]||(k[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},yr={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],d=T(()=>{if(!l.opportunity.createdAt)return 0;const k=new Date(l.opportunity.createdAt),b=Math.abs(new Date-k);return Math.ceil(b/(1e3*60*60*24))}),r=()=>{i("create-offer",l.opportunity)},f=()=>{i("review",l.opportunity)},h=k=>{i("survey-completed",{opportunity:l.opportunity,responses:k})},g=()=>{i("survey-refused",{opportunity:l.opportunity})},x=()=>{i("not-responding",{opportunity:l.opportunity})};return(k,m)=>(u(),Y(nt,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${d.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Review Opportunity ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:h,onSurveyRefused:g,onNotResponding:x})]),_:1},8,["description"]))}},gr={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],d=T(()=>{if(!l.opportunity.createdAt)return 0;const x=new Date(l.opportunity.createdAt),m=Math.abs(new Date-x);return Math.ceil(m/(1e3*60*60*24))}),r=()=>{i("create-offer",l.opportunity)},f=x=>{i("survey-completed",{opportunity:l.opportunity,responses:x})},h=()=>{i("survey-refused",{opportunity:l.opportunity})},g=()=>{i("not-responding",{opportunity:l.opportunity})};return(x,k)=>(u(),Y(nt,{title:"Unsold Feedback",description:`This opportunity has been open for ${d.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:f,onSurveyRefused:h,onNotResponding:g})]),_:1},8,["description"]))}},br={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],d=()=>{i("schedule-closing",l.opportunity)},r=g=>{i("survey-completed",{opportunity:l.opportunity,responses:g})},f=()=>{i("survey-refused",{opportunity:l.opportunity})},h=()=>{i("not-responding",{opportunity:l.opportunity})};return(g,x)=>(u(),Y(nt,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:o(()=>[e("button",{onClick:d,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Schedule Closing Meeting ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:r,onSurveyRefused:f,onNotResponding:h})]),_:1}))}},hr={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],d=T(()=>{const x=l.opportunity.lastActivity||l.opportunity.createdAt;if(!x)return 0;const k=new Date(x),b=Math.abs(new Date-k);return Math.ceil(b/(1e3*60*60*24))}),r=()=>{i("create-contract",l.opportunity)},f=x=>{i("survey-completed",{opportunity:l.opportunity,responses:x})},h=()=>{i("survey-refused",{opportunity:l.opportunity})},g=()=>{i("not-responding",{opportunity:l.opportunity})};return(x,k)=>(u(),Y(nt,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${d.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Contract ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:f,onSurveyRefused:h,onNotResponding:g})]),_:1},8,["description"]))}},xr={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],d=T(()=>{var S;if(!((S=l.opportunity)!=null&&S.contractDate))return 0;const k=new Date(l.opportunity.contractDate),b=Math.abs(new Date-k);return Math.ceil(b/(1e3*60*60*24))}),r=()=>{i("prepare-delivery",l.opportunity)},f=()=>{i("pre-delivery-checklist",l.opportunity)},h=k=>{i("survey-completed",{opportunity:l.opportunity,responses:k})},g=()=>{i("survey-refused",{opportunity:l.opportunity})},x=()=>{i("not-responding",{opportunity:l.opportunity})};return(k,m)=>(u(),Y(nt,{title:"Contract Feedback",description:`Contract was signed ${d.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Prepare for Delivery "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:h,onSurveyRefused:g,onNotResponding:x})]),_:1},8,["description"]))}},wr={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C,c=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],d=T(()=>{const x=l.activities.find(S=>{var E;return S.type==="delivery"||((E=S.action)==null?void 0:E.toLowerCase().includes("delivered"))});if(!x||!x.timestamp)return 0;const k=new Date(x.timestamp),b=Math.abs(new Date-k);return Math.ceil(b/(1e3*60*60*24))}),r=()=>{i("delivery-feedback",l.opportunity)},f=x=>{i("survey-completed",{opportunity:l.opportunity,responses:x})},h=()=>{i("survey-refused",{opportunity:l.opportunity})},g=()=>{i("not-responding",{opportunity:l.opportunity})};return(x,k)=>(u(),Y(nt,{title:"Delivery Feedback",description:`Vehicle was delivered ${d.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Delivery Feedback ")]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:f,onSurveyRefused:h,onNotResponding:g})]),_:1},8,["description"]))}},kr={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(n,{emit:C}){const l=n,i=C,c=T(()=>{var S;return((S=l.scheduledAppointment)==null?void 0:S.noShowCount)||0}),d=T(()=>{const S=c.value;return S===0?"No-Show Follow-up":S>=3?`No-Show #${S} - Final Warning`:`No-Show #${S} Follow-up`}),r=T(()=>{const S=c.value;return S>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":S>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),f=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],h=T(()=>{var E;return(E=l.scheduledAppointment)!=null&&E.start?new Date(l.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),g=()=>{i("contact-customer",l.opportunity)},x=()=>{const S=c.value;if(S>=3)i("auto-close-lost",{opportunity:l.opportunity,reason:`Automatically closed after ${S} no-shows`});else if(S===1||S===2){const E=new Date;E.setDate(E.getDate()+2),i("set-callback",{opportunity:l.opportunity,callbackDate:E.toISOString()})}else i("reschedule",l.opportunity)},k=S=>{i("survey-completed",{opportunity:l.opportunity,responses:S})},m=()=>{i("survey-refused",{opportunity:l.opportunity})},b=()=>{i("not-responding",{opportunity:l.opportunity})};return(S,E)=>(u(),Y(nt,{title:d.value,description:`Appointment was scheduled for ${h.value} but customer did not show up. ${r.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:o(()=>[e("button",{onClick:x,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...E[0]||(E[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),I(" Book Another Appointment ",-1)])]),e("button",{onClick:g,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...E[1]||(E[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),I(" Contact Customer ",-1)])])]),survey:o(()=>[a(lt,{questions:f,onSurveyCompleted:k,onSurveyRefused:m,onNotResponding:b})]),_:1},8,["title","description"]))}},Sr={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(n,{emit:C}){const l=n,i=C;ss();const c=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],d=T(()=>{const m=l.opportunity.lastActivity||l.opportunity.createdAt;if(!m)return 0;const b=new Date(m),E=Math.abs(new Date-b);return Math.ceil(E/(1e3*60*60*24))}),r=()=>{i("reopen",l.opportunity)},f=()=>{i("close-lost",{opportunity:l.opportunity,reason:"Abandoned - no activity for extended period"})},h=()=>{i("requalify",l.opportunity)},g=m=>{i("survey-completed",{opportunity:l.opportunity,responses:m})},x=()=>{i("survey-refused",{opportunity:l.opportunity})},k=()=>{i("not-responding",{opportunity:l.opportunity})};return(m,b)=>(u(),Y(nt,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${d.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:o(()=>[e("button",{onClick:r,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...b[0]||(b[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),I(" Reopen Opportunity ",-1)])]),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),I(" Close as Lost ",-1)])]),e("button",{onClick:h,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...b[2]||(b[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),I(" Requalify as Lead ",-1)])])]),survey:o(()=>[a(lt,{questions:c,onSurveyCompleted:g,onSurveyRefused:x,onNotResponding:k})]),_:1},8,["description"]))}},Cr={OOFB:yr,UFB:gr,NFU:br,OFB:hr,CFB:xr,DFB:wr,NS:kr,ABANDONED:Sr};function $r(n,C,l,i,c){const d=T(()=>{const m=Bt(n),b=Bt(C),S=Bt(l);return{opportunity:m,scheduledAppointment:b,activities:S,hasOffers:(S==null?void 0:S.some(E=>E.type==="offer"))||!1,stage:m.displayStage||m.stage,deliverySubstatus:m.deliverySubstatus||null,formatDateTime:c,hasActiveTaskWidget:!1}}),r=T(()=>{const m=d.value,b=Tn(m.stage,m);if(!b)return null;const S=Cr[b];return S?{type:b,component:S,props:{opportunity:m.opportunity,appointment:m.scheduledAppointment,activities:m.activities}}:null}),f=T(()=>({...d.value,hasActiveTaskWidget:!!r.value})),h=T(()=>{const m=f.value,b=In(m.stage,m);if(!b)return null;const S=i[b.key];return{...b,handler:S||(()=>{})}}),g=T(()=>{const m=f.value;return On(m.stage,m).map(S=>{const E=i[S.key];return{...S,handler:E||(()=>{})}})}),x=T(()=>{const m=d.value;return qn(m.stage)}),k=T(()=>!r.value||!r.value.type?"":Vn(r.value.type));return{primaryAction:h,secondaryActions:g,activeTaskWidget:r,taskWidgetTitle:k,isClosed:x}}const Ar={class:"relative"},Dr=["disabled"],Tr={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-50 dropdown-menu-small"},Ir={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(n,{emit:C}){const l=n,i=C,c=O(!1),d=()=>{c.value=!c.value},r=()=>{c.value=!1},f=g=>{g.disabled||(r(),i("action-selected",g),g.handler&&typeof g.handler=="function"&&g.handler())},h=T(()=>(l.actions||[]).map(g=>({key:g.key,label:g.label,disabled:!!g.disabled,onClick:()=>f(g)})));return(g,x)=>{const k=on("click-outside");return oe((u(),$("div",Ar,[e("button",{onClick:d,class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!n.actions||n.actions.length===0},[x[0]||(x[0]=e("span",null,"More actions",-1)),e("i",{class:J(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":c.value}])},null,2)],8,Dr),a(Xt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:o(()=>[c.value?(u(),$("div",Tr,[a(s(tn),{items:h.value,className:"min-w-full"},null,8,["items"])])):L("",!0)]),_:1})])),[[k,r]])}}},Or={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},qr=["src","alt"],Vr={key:1,class:"w-full h-full flex items-center justify-center"},Nr={class:"flex items-center justify-between mb-1.5"},Lr={class:"text-sm font-bold text-heading"},Mr={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},Er={class:"text-xs text-sub mb-1.5"},Fr={key:0,class:"text-xs text-green-600 font-medium mb-2"},Rr={key:1,class:"text-xs text-orange-600 font-medium mb-2"},fs={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(n){const C=n,l=T(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[C.badge]||"gray"),i=c=>c?c.toLocaleString("en-US"):"0";return(c,d)=>(u(),$("div",{onClick:d[1]||(d[1]=r=>c.$emit("select")),class:J(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":n.selected}])},[e("div",Or,[n.vehicle.image?(u(),$("img",{key:0,src:n.vehicle.image,alt:`${n.vehicle.brand} ${n.vehicle.model}`,class:"w-full h-full object-cover"},null,8,qr)):(u(),$("div",Vr,[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",Nr,[a(s(ys),{text:n.badge,size:"small",theme:l.value},null,8,["text","theme"]),e("span",Lr,"€"+V(i(n.vehicle.price)),1)]),e("h4",Mr,V(n.vehicle.brand)+" "+V(n.vehicle.model),1),e("p",Er,V(n.vehicle.year),1),n.stockDays!==null&&n.stockDays!==void 0?(u(),$("div",Fr,[d[3]||(d[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),I(" In stock ("+V(n.stockDays)+" days) ",1)])):(u(),$("div",Rr,[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),I(" Out of stock ",-1)])])),e("button",{onClick:d[0]||(d[0]=rn(r=>c.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},Ur={class:"space-y-6"},Br={key:0},jr={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Wr={class:"mb-4"},zr={class:"relative"},Pr={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Hr={key:1,class:"text-center py-8 text-sub"},Qr={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},Yr={key:0,class:"mt-4 space-y-3"},Jr={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Gr={class:"flex justify-end"},Zr=["disabled"],Kr={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(n,{emit:C}){const l=n,i=C,c=D=>{D||i("close")},d=O(""),r=O(!1),f=O(null),h=O(null),g=O(null),x=O([]),k=O({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});xs(async()=>{try{const D=await Ss({});x.value=D.data||[]}catch(D){console.error("Failed to load vehicles:",D),x.value=[]}});const m=T(()=>l.requestedVehicle&&l.requestedVehicle.stockDays!==null&&l.requestedVehicle.stockDays!==void 0),b=T(()=>{const D=[];if(l.requestedVehicle&&m.value&&D.push({...l.requestedVehicle,isRequested:!0}),x.value&&x.value.length>0){const v=x.value.filter(P=>l.requestedVehicle?P.brand!==l.requestedVehicle.brand||P.model!==l.requestedVehicle.model:!0),F=l.requestedVehicle&&m.value?3:4;D.push(...v.slice(0,F))}return D}),S=T(()=>{if(!x.value||x.value.length===0)return[];let D=[...x.value];if(d.value){const v=d.value.toLowerCase();D=D.filter(F=>F.brand.toLowerCase().includes(v)||F.model.toLowerCase().includes(v)||F.year.toString().includes(v))}return D}),E=T(()=>k.value.brand&&k.value.model&&k.value.year&&k.value.price>0),M=(D,v)=>{f.value=D,h.value=D.id||`custom-${Date.now()}`,g.value=v},p=()=>{if(!E.value)return;const D={...k.value,id:`custom-${Date.now()}`,isCustom:!0};M(D,"custom")},q=()=>{f.value&&(i("vehicle-selected",{vehicle:f.value,type:g.value}),i("close"),f.value=null,h.value=null,g.value=null,d.value="",r.value=!1,k.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(D,v)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":c},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-6xl"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),null,{default:o(()=>[...v[7]||(v[7]=[I("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",Ur,[b.value.length?(u(),$("div",Br,[v[8]||(v[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),I(" Recommended Vehicles ")],-1)),e("div",jr,[(u(!0),$(Ce,null,Fe(b.value,F=>(u(),Y(fs,{key:F.id,vehicle:F,badge:F.isRequested?"Requested":"Recommended","stock-days":F.stockDays,selected:h.value===F.id,onSelect:P=>M(F,F.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):L("",!0),e("div",null,[v[11]||(v[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),I(" Browse Stock ")],-1)),e("div",Wr,[e("div",zr,[v[9]||(v[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),oe(e("input",{"onUpdate:modelValue":v[0]||(v[0]=F=>d.value=F),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Ee,d.value]])])]),S.value.length?(u(),$("div",Pr,[(u(!0),$(Ce,null,Fe(S.value,F=>(u(),Y(fs,{key:F.id,vehicle:F,badge:"In Stock","stock-days":F.stockDays,selected:h.value===F.id,onSelect:P=>M(F,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(u(),$("div",Hr,[...v[10]||(v[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[v[19]||(v[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),I(" Configure Custom Vehicle ")],-1)),e("div",Qr,[v[18]||(v[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:v[1]||(v[1]=F=>r.value=!r.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[v[12]||(v[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),I(" "+V(r.value?"Hide Configuration":"Build Custom Configuration"),1)]),r.value?(u(),$("div",Yr,[e("div",Jr,[e("div",null,[v[13]||(v[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),oe(e("input",{"onUpdate:modelValue":v[2]||(v[2]=F=>k.value.brand=F),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[Ee,k.value.brand]])]),e("div",null,[v[14]||(v[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),oe(e("input",{"onUpdate:modelValue":v[3]||(v[3]=F=>k.value.model=F),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[Ee,k.value.model]])]),e("div",null,[v[15]||(v[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),oe(e("input",{"onUpdate:modelValue":v[4]||(v[4]=F=>k.value.year=F),type:"number",class:"input",placeholder:"2024"},null,512),[[Ee,k.value.year]])]),e("div",null,[v[16]||(v[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (€)",-1)),oe(e("input",{"onUpdate:modelValue":v[5]||(v[5]=F=>k.value.price=F),type:"number",class:"input",placeholder:"98000"},null,512),[[Ee,k.value.price]])])]),e("div",Gr,[e("button",{onClick:p,disabled:!E.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...v[17]||(v[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),I(" Use Custom Configuration ",-1)])],8,Zr)])])):L("",!0)])])]),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:v[6]||(v[6]=F=>D.$emit("close"))}),f.value?(u(),Y(s(j),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:q})):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Xr={class:"space-y-4"},_r=["max"],ed={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:C}){const l=n,i=C,c=O(""),d=O(""),r=O(""),f=T(()=>new Date().toISOString().split("T")[0]);he(()=>l.show,k=>{if(k){const m=new Date;c.value=m.toISOString().split("T")[0],d.value=m.toTimeString().slice(0,5),r.value=""}});const h=()=>{if(!c.value)return;const k=d.value?`${c.value}T${d.value}:00`:`${c.value}T12:00:00`;i("confirm",{contractDate:k,notes:r.value})},g=()=>{i("cancel")},x=k=>{k||g()};return(k,m)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":x},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-lg"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),null,{default:o(()=>[...m[3]||(m[3]=[I("Set Contract Signing Date",-1)])]),_:1}),a(s(jt),null,{default:o(()=>[...m[4]||(m[4]=[I("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",Xr,[e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),oe(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=b=>c.value=b),max:f.value,class:"input"},null,8,_r),[[Ee,c.value]])]),e("div",null,[m[6]||(m[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),oe(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=b=>d.value=b),class:"input"},null,512),[[Ee,d.value]])]),e("div",null,[m[7]||(m[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),oe(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=b=>r.value=b),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[Ee,r.value]])])]),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:g}),a(s(j),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!c.value,onClick:h},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},td={class:"space-y-4"},sd=["max"],nd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:C}){const l=n,i=C,c=O(""),d=O(""),r=O(""),f=O(""),h=T(()=>new Date().toISOString().split("T")[0]);he(()=>l.show,m=>{if(m){const b=new Date;c.value=b.toISOString().split("T")[0],d.value=b.toTimeString().slice(0,5),r.value="",f.value=""}});const g=()=>{if(!c.value||!r.value)return;const m=d.value?`${c.value}T${d.value}:00`:`${c.value}T12:00:00`;i("confirm",{deliveryDate:m,location:r.value,notes:f.value})},x=()=>{i("cancel")},k=m=>{m||x()};return(m,b)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":k},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-lg"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),null,{default:o(()=>[...b[4]||(b[4]=[I("Mark as Delivered",-1)])]),_:1}),a(s(jt),null,{default:o(()=>[...b[5]||(b[5]=[I("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",td,[e("div",null,[b[6]||(b[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),oe(e("input",{type:"date","onUpdate:modelValue":b[0]||(b[0]=S=>c.value=S),max:h.value,class:"input"},null,8,sd),[[Ee,c.value]])]),e("div",null,[b[7]||(b[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),oe(e("input",{type:"time","onUpdate:modelValue":b[1]||(b[1]=S=>d.value=S),class:"input"},null,512),[[Ee,d.value]])]),e("div",null,[b[9]||(b[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),oe(e("select",{"onUpdate:modelValue":b[2]||(b[2]=S=>r.value=S),class:"input"},[...b[8]||(b[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[Wt,r.value]])]),e("div",null,[b[10]||(b[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),oe(e("textarea",{"onUpdate:modelValue":b[3]||(b[3]=S=>f.value=S),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[Ee,f.value]])])]),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x}),a(s(j),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!c.value||!r.value,onClick:g},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ld={class:"space-y-4"},ad={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:C}){const l=n,i=C,c=O(""),d=O("");he(()=>l.show,g=>{g&&(c.value="",d.value="")});const r=()=>{c.value&&i("confirm",{reason:c.value,notes:d.value})},f=()=>{i("cancel")},h=g=>{g||f()};return(g,x)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":h},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-lg"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),null,{default:o(()=>[...x[2]||(x[2]=[I("Close as Lost",-1)])]),_:1}),a(s(jt),null,{default:o(()=>[...x[3]||(x[3]=[I("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",ld,[e("div",null,[x[5]||(x[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),oe(e("select",{"onUpdate:modelValue":x[0]||(x[0]=k=>c.value=k),class:"input"},[...x[4]||(x[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[Wt,c.value]])]),e("div",null,[x[6]||(x[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),oe(e("textarea",{"onUpdate:modelValue":x[1]||(x[1]=k=>d.value=k),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[Ee,d.value]])])]),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f}),a(s(j),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!c.value,onClick:r},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},od={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:C}){const l=C,i=c=>{c||l("cancel")};return(c,d)=>(u(),Y(s(xt),{open:n.show,"onUpdate:open":i},{default:o(()=>[a(s(vt),null,{default:o(()=>[a(s(ft),{class:"fixed inset-0 z-50 bg-black/50"}),a(s(yt),{class:"w-full sm:max-w-lg"},{default:o(()=>[a(s(gt),null,{default:o(()=>[a(s(bt),null,{default:o(()=>[...d[2]||(d[2]=[I("Requalify as Lead",-1)])]),_:1}),a(s(jt),null,{default:o(()=>[...d[3]||(d[3]=[I("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),d[4]||(d[4]=e("div",{class:"space-y-6 max-h-screen-60 overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),I(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),I(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),I(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),a(s(ht),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[a(s(j),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[0]||(d[0]=r=>c.$emit("cancel"))}),a(s(j),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:d[1]||(d[1]=r=>c.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},id={key:0,class:"space-y-3"},rd={class:"flex items-center gap-2 pb-2 border-b border"},dd={class:"font-semibold text-heading text-fluid-sm"},ud={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},cd={class:"flex justify-between items-start mb-3"},md={class:"text-fluid-xs text-body mt-0.5"},pd={key:0},vd={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(n,{emit:C}){const l=n,i=C,c=hs(),d=Vt(),r=O(!1),f=O(!1),h=O(!1),g=O(!1),x=O(!1),k=O(!1),m=O(!1),b=O(!1),S=O(!1),E=O(!1),M=O([]);function p(B){return B?new Date(B).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const q={"schedule-appointment":()=>{r.value=!0},"view-or-schedule-appointment":()=>{l.scheduledAppointment?S.value=!0:r.value=!0},"select-vehicle":()=>{m.value=!0},"create-offer":()=>{!l.opportunity.selectedVehicle&&!l.opportunity.vehicle?m.value=!0:f.value=!0},"call-prospect":()=>{b.value=!0},"follow-up-offer":()=>{b.value=!0},"request-decision":()=>{b.value=!0},"finalize-contract":()=>{g.value=!0},"schedule-delivery":()=>{x.value=!0},"confirm-delivery":()=>{x.value=!0},"collect-feedback":()=>{b.value=!0},reschedule:()=>{E.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&ue()},"close-won":()=>{g.value=!0},"add-offer":()=>{f.value=!0},"add-contract":()=>{g.value=!0},"extend-deadline":()=>{b.value=!0},"close-lost":()=>{h.value=!0},reopen:()=>{A()},requalify:()=>{k.value=!0}},D=$r(pt(l,"opportunity"),pt(l,"scheduledAppointment"),pt(l,"activities"),q,p),v={isClosed:D.isClosed,primaryAction:D.primaryAction,secondaryActions:D.secondaryActions,activeTaskWidget:D.activeTaskWidget,taskWidgetTitle:D.taskWidgetTitle,displayStage:T(()=>ns(l.opportunity,"opportunity")||"Qualified"),showDeadlineBanner:T(()=>{var B;return!D.isClosed.value&&!!((B=l.opportunity)!=null&&B.nextActionDue)})},F=async B=>{var H;(H=l.opportunity)!=null&&H.id&&await d.fetchOpportunityById(l.opportunity.id)};function P(){}function W(B){m.value=!1,i("vehicle-selected",B),setTimeout(()=>{f.value=!0},300)}function ie(B){f.value=!1,i("offer-created",B)}function fe(B){r.value=!1,i("appointment-scheduled",{...B,opportunityId:l.opportunity.id,customer:l.opportunity.customer.name})}function ue(){l.scheduledAppointment&&i("appointment-cancelled",l.scheduledAppointment.id)}function $e(B){g.value=!1,d.updateOpportunity(l.opportunity.id,{stage:"Closed Won",contractDate:B.contractDate})}function G(B){x.value=!1,d.addActivity(l.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:B})}function z(B){h.value=!1,d.updateOpportunity(l.opportunity.id,{stage:"Closed Lost",lossReason:B})}function A(){d.updateOpportunity(l.opportunity.id,{stage:"Qualified"})}function N(B){k.value=!1,c.push(`/customer/${B.id}?type=lead`)}function de(B){S.value=!1}function se(B){E.value=!1}function te(B){d.updateOpportunity(l.opportunity.id,{callbackDate:B.callbackDate})}function re(B){d.updateOpportunity(l.opportunity.id,{stage:"Closed Lost",lossReason:B.reason||"Multiple no-shows (NS3)"})}function _(B){}return xs(async()=>{try{const H=(await Ss({})).data||[];M.value=H.filter(ge=>ge.stockDays!==null&&ge.stockDays!==void 0).slice(0,5)}catch(B){console.error("Failed to load recommended cars:",B),M.value=[]}}),(B,H)=>(u(),$(Ce,null,[a($s,{task:n.opportunity,"hide-title":"","hide-border":""},{"deadline-banner":o(()=>[v.isClosed.value?L("",!0):(u(),Y(Ts,{key:0,"next-action-due":n.opportunity.nextActionDue,"show-deadline-banner":v.showDeadlineBanner.value,"task-id":n.opportunity.id},null,8,["next-action-due","show-deadline-banner","task-id"]))]),"primary-action":o(()=>[v.isClosed.value?L("",!0):(u(),Y(Ds,{key:0,task:n.opportunity,"task-type":"opportunity",onReassigned:F,class:"mb-3"},null,8,["task"])),!v.isClosed.value&&v.primaryAction.value?(u(),Y(As,{key:1,action:v.primaryAction.value,"color-scheme":v.primaryAction.value.colorScheme,onActionClicked:v.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0),!v.isClosed.value&&v.secondaryActions.value&&v.secondaryActions.value.length>0?(u(),Y(Ir,{key:2,actions:v.secondaryActions.value,onActionSelected:_,class:"mt-3"},null,8,["actions"])):L("",!0)]),"task-widgets":o(()=>[v.activeTaskWidget.value&&v.activeTaskWidget.value.component?(u(),$("div",id,[e("div",rd,[H[11]||(H[11]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",dd,V(v.taskWidgetTitle.value),1)]),(u(),Y(ts(v.activeTaskWidget.value.component),es(v.activeTaskWidget.value.props,{onClose:P,onSetCallback:te,onAutoCloseLost:re}),null,16))])):L("",!0)]),"closed-state":o(()=>[v.isClosed.value?(u(),$("div",ud,[e("div",cd,[e("div",null,[H[12]||(H[12]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed",-1)),e("p",md,[I(" Status: "+V(v.displayStage.value)+" ",1),n.opportunity.lossReason?(u(),$("span",pd," - "+V(n.opportunity.lossReason),1)):L("",!0)])])]),a(s(j),{variant:"primary",size:"small",onClick:A,class:"flex items-center gap-2"},{default:o(()=>[...H[13]||(H[13]=[e("span",null,"Reopen Opportunity",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1})])):L("",!0)]),_:1},8,["task"]),r.value?(u(),Y(En,{key:0,show:r.value,customer:n.opportunity.customer,assignee:n.opportunity.assignee,"disabled-fields":["customer"],onCreate:fe,onCancel:H[0]||(H[0]=ge=>r.value=!1)},null,8,["show","customer","assignee"])):L("",!0),m.value?(u(),Y(Kr,{key:1,opportunity:n.opportunity,"requested-car":n.opportunity.requestedCar,"recommended-cars":M.value,onVehicleSelected:W,onClose:H[1]||(H[1]=ge=>m.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):L("",!0),f.value?(u(),Y(Nn,{key:2,opportunity:n.opportunity,vehicle:n.opportunity.selectedVehicle||n.opportunity.vehicle||n.opportunity.requestedCar,onOfferCreated:ie,onClose:H[2]||(H[2]=ge=>f.value=!1)},null,8,["opportunity","vehicle"])):L("",!0),g.value?(u(),Y(ed,{key:3,opportunity:n.opportunity,onContractSet:$e,onClose:H[3]||(H[3]=ge=>g.value=!1)},null,8,["opportunity"])):L("",!0),x.value?(u(),Y(nd,{key:4,opportunity:n.opportunity,onDelivered:G,onClose:H[4]||(H[4]=ge=>x.value=!1)},null,8,["opportunity"])):L("",!0),h.value?(u(),Y(ad,{key:5,opportunity:n.opportunity,onClosed:z,onClose:H[5]||(H[5]=ge=>h.value=!1)},null,8,["opportunity"])):L("",!0),k.value?(u(),Y(od,{key:6,opportunity:n.opportunity,onRequalified:N,onClose:H[6]||(H[6]=ge=>k.value=!1)},null,8,["opportunity"])):L("",!0),b.value?(u(),Y(Ln,{key:7,onClose:H[7]||(H[7]=ge=>b.value=!1)})):L("",!0),S.value&&n.scheduledAppointment?(u(),Y(Fn,{key:8,show:S.value,event:n.scheduledAppointment,onClose:H[8]||(H[8]=ge=>S.value=!1),onEdit:H[9]||(H[9]=ge=>{S.value=!1,E.value=!0}),onDelete:de},null,8,["show","event"])):L("",!0),E.value&&n.scheduledAppointment?(u(),Y(Rn,{key:9,show:E.value,event:n.scheduledAppointment,customer:n.opportunity.customer,"disabled-fields":["customer"],onSave:se,onCancel:H[10]||(H[10]=ge=>E.value=!1)},null,8,["show","event","customer"])):L("",!0)],64))}};function Td(n){const C=dt(),l=Vt(),i=T(()=>n.value?n.value.type==="lead"?tr:vd:null),c=T(()=>n.value?n.value.type==="lead"?{currentActivities:T(()=>C.currentLeadActivities),addActivity:(r,f)=>C.addActivity(r,f),updateActivity:(r,f,h)=>C.updateActivity(r,f,h),deleteActivity:(r,f)=>C.deleteActivity(r,f),updateLead:(r,f)=>C.updateLead(r,f),loadLeadById:r=>C.fetchLeadById(r)}:{currentActivities:T(()=>l.currentOpportunityActivities),addActivity:(r,f)=>l.addActivity(r,f),updateActivity:(r,f,h)=>l.updateActivity(r,f,h),deleteActivity:(r,f)=>l.deleteActivity(r,f),addVehicle:(r,f)=>l.addVehicle(r,f),createOffer:(r,f)=>l.createOffer(r,f),updateOpportunity:(r,f)=>l.updateOpportunity(r,f),loadOpportunityById:r=>l.fetchOpportunityById(r)}:null),d=T(()=>n.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:i,storeAdapter:c,addNewConfig:d}}function Id(n){const C=dt(),l=Vt(),i=qt(),c=T(()=>{const b=(n.value?C.leads:C.leads.filter(M=>!M.isDisqualified)).map(M=>{const p=ns(M,"lead"),q={...M,type:"lead",compositeId:`lead-${M.id}`,displayStage:p};return!q.customer&&M.customer&&(q.customer=M.customer),q}),S=l.opportunities.map(M=>{const p={...M,type:"opportunity",compositeId:`opportunity-${M.id}`};return!p.customer&&M.customer&&(p.customer=M.customer),p});let E=[];return i.isOperator()?E=b:i.isSalesman()?E=S:E=[...b,...S],E}),d=(m,b)=>!b||b.length===0?m:Array.isArray(b)?m.filter(S=>b.includes(S.type)):b==="all"?m:m.filter(S=>S.type===b),r=m=>{const b=new Date,S=new Date(b.getTime()+24*60*60*1e3);return m.filter(E=>{if(!E.nextActionDue)return!1;const M=new Date(E.nextActionDue);return M>=b&&M<=S})},f=m=>m.filter(b=>b.nextActionDue!=null),h=m=>{const b=new Date(Date.now()-36e5);return m.filter(S=>S.type!=="lead"||!S.createdAt?!1:new Date(S.createdAt)>=b)},g=m=>{var S;const b=(S=i.currentUser)==null?void 0:S.name;return b?m.filter(E=>E.assignee===b):[]},x=(m,b)=>{if(!b||b.length===0)return m;let S=[...m];const E=b.filter(M=>M==="lead"||M==="opportunity");return E.length>0&&(S=d(S,E)),b.forEach(M=>{switch(M){case"due-in-24h":S=r(S);break;case"to-be-called":S=f(S);break;case"leads-1h":S=h(S);break;case"assigned-to-me":S=g(S);break}}),S},k=T(()=>{const m=c.value.some(S=>S.type==="lead"),b=c.value.some(S=>S.type==="opportunity");return m&&b});return{allTasks:c,filterByType:d,filterByDueIn24Hours:r,filterByToBeCalled:f,filterByLeadsCreated1Hour:h,filterByAssignedToMe:g,applyFilters:x,shouldShowTypeFilter:k}}export{Dd as D,Ad as T,Td as a,Id as u};
