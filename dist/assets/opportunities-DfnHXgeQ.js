const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DdmLZORJ.js","assets/index-DC-wTrY8.css"])))=>i.map(i=>d[i]);
import{v as T,r as v,d as h,a6 as V,a7 as O,a8 as m,a9 as W,aa as $,ab as f,ac as D,ad as Q,ae as j,af as q,ag as z,_ as G}from"./index-DdmLZORJ.js";const J=T("opportunities",()=>{const i=v([]),s=v(null),o=v([]),r=v(!1),u=v(null),y=v({stage:null,assignee:null,search:""}),A=h(()=>i.value.length),x=h(()=>{const e={};return i.value.forEach(a=>{e[a.stage]||(e[a.stage]=[]),e[a.stage].push(a)}),e}),b=h(()=>i.value.reduce((e,a)=>e+a.value,0));async function w(){r.value=!0,u.value=null;try{const e=await V(y.value);i.value=e.data}catch(e){u.value=e.message}finally{r.value=!1}}async function L(e){r.value=!0,u.value=null;try{s.value=await O(e);const a=await m(e);o.value=W(a);const t=i.value.findIndex(n=>n.id===parseInt(e));t!==-1&&(i.value[t]=s.value)}catch(a){u.value=a.message}finally{r.value=!1}}async function I(e){r.value=!0,u.value=null;try{const a=await $(e);return i.value.unshift(a),a}catch(a){throw u.value=a.message,a}finally{r.value=!1}}async function _(e,a){r.value=!0,u.value=null;try{const t=await f(e,a),n=i.value.findIndex(l=>l.id===e);return n!==-1&&(i.value[n]=t),t}catch(t){throw u.value=t.message,t}finally{r.value=!1}}async function g(e){r.value=!0,u.value=null;try{await D(e),i.value=i.value.filter(a=>a.id!==e)}catch(a){throw u.value=a.message,a}finally{r.value=!1}}async function d(e,a){try{const t=await Q(e,a);return o.value.unshift(t),t}catch(t){throw u.value=t.message,t}}async function S(e,a,t){try{const n=await j(e,a,t),l=o.value.findIndex(c=>c.id===parseInt(a));return l!==-1&&(o.value[l]=n),n}catch(n){throw u.value=n.message,n}}async function k(e,a){try{return await q(e,a),o.value=o.value.filter(t=>t.id!==parseInt(a)),{success:!0}}catch(t){throw u.value=t.message,t}}function F(e){y.value={...y.value,...e},w()}async function R(e){var a;r.value=!0,u.value=null;try{const t=i.value.find(p=>p.id===e)||s.value,n={stage:"Qualified"};((t==null?void 0:t.probability)===0||(t==null?void 0:t.probability)===100)&&(n.probability=50);const l=await f(e,n),c=i.value.findIndex(p=>p.id===e);return c!==-1&&(i.value[c]=l),((a=s.value)==null?void 0:a.id)===e&&(s.value=l),await d(e,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${l.stage} stage`}),l}catch(t){throw u.value=t.message,t}finally{r.value=!1}}async function B(e){var a;r.value=!0,u.value=null;try{const t=await f(e,{stage:"Registration"}),n=i.value.findIndex(l=>l.id===e);return n!==-1&&(i.value[n]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),t}catch(t){throw u.value=t.message,t}finally{r.value=!1}}async function C(e){var a;r.value=!0,u.value=null;try{const t=await f(e,{stage:"Closed",probability:100}),n=i.value.findIndex(l=>l.id===e);return n!==-1&&(i.value[n]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),t}catch(t){throw u.value=t.message,t}finally{r.value=!1}}async function E(e,a,t={}){r.value=!0,u.value=null;try{const n=await z(e,a,t);return i.value.unshift(n),n}catch(n){throw u.value=n.message,n}finally{r.value=!1}}async function Y(e){r.value=!0,u.value=null;try{const a=await O(e),t=await m(e),{useLeadsStore:n}=await G(async()=>{const{useLeadsStore:p}=await import("./index-DdmLZORJ.js").then(P=>P.ah);return{useLeadsStore:p}},__vite__mapDeps([0,1])),c=await n().createLeadFromOpportunity(a,t);return await g(e),c.id}catch(a){throw u.value=a.message,a}finally{r.value=!1}}return{opportunities:i,currentOpportunity:s,currentOpportunityActivities:o,loading:r,error:u,filters:y,totalOpportunities:A,opportunitiesByStage:x,totalValue:b,loadOpportunities:w,loadOpportunityById:L,addOpportunity:I,modifyOpportunity:_,removeOpportunity:g,addActivity:d,updateActivity:S,deleteActivity:k,setFilters:F,reopenOpportunity:R,markAsRegistration:B,markAsClosedWon:C,createOpportunityFromLead:E,convertOpportunityToLead:Y}});export{J as useOpportunitiesStore};
