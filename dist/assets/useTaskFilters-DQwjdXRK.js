const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-Deg_Cdvm.js","assets/index-BcuDIK-O.js","assets/index-Ds1G7ZBR.css","assets/users-D37oaAzL.js"])))=>i.map(i=>d[i]);
import{n as _,$ as co,b as mo,Z as Ca,X as $a,a as fo,i as Da,u as Aa,k as Oa,l as po,m as vo,f as Ut,F as qt,L as Dt,g as At,h as Ot,Q as B,C as Lt,d as Tt,p as zt,W as kt,U as St,H as Ct,j as he,G as $t,q as Ue,c as qe,o as Xe,V as go,D as Ta,r as Ia,K as yo}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-Oem9_7mP.js";import{H as vn,W as fn,X as ja,c as C,d as S,o as p,e,g as q,t as F,n as se,Y as bo,I as Zt,r as T,J as hs,s as n,x as K,p as ke,w as pn,y as t,Z as Ba,F as be,i as Oe,B as o,$ as za,a0 as Wa,a1 as Hs,P as Qs,C as Sn,j as Ya,T as bs,L as Ft,M as xs,a2 as ys,h as Ha,u as Yt,R as vs,k as D,a3 as ts,K as Xn,q as Qa,l as ye,a4 as ut,a5 as ho,a6 as Ga,a7 as es,G as Kt,a8 as wt,Q as _a,_ as xn,a9 as xo,aa as wo,ab as ko,ac as So,ad as ws,D as Co,m as ns,ae as $o,af as Va,ag as gs,ah as Do}from"./index-BcuDIK-O.js";import{u as Xt}from"./opportunities-Bp4brFAh.js";import{L as Ao,O as Oo,f as Na,h as To,E as Io,M as Ja,_ as Vo,T as No,i as Ka,j as Fo,k as Uo,l as qo,m as Lo,n as Gs,P as Za,o as Xa,p as Po,q as Mo,r as Eo,s as Ro,t as jo,u as Bo,v as zo,w as Wo,e as Fa,b as wn,x as Zn,I as Yo,y as Ho,g as Qo,c as Go,z as _o,A as Jo,B as Ko,D as Zo,F as Xo,G as ei,H as ss,J as Fn,K as Ua,N as ti,Q as ni}from"./OfferCarousel-CZ6ElooH.js";import{_ as el}from"./CreateEventModal-BENhAlSk.js";import{u as gn,c as Bs}from"./users-D37oaAzL.js";import{S as vt}from"./components-BwvyhyyO.js";import{_ as si}from"./ReassignUserModal-Binh7mf4.js";import{S as ai}from"./sparkles-DCtJyGxr.js";import{f as li}from"./vehicles-C-_b7mCD.js";import{_ as oi,a as ii}from"./EditEventModal-h6MKVVNd.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=vn("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=vn("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=vn("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=vn("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const di=vn("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=vn("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=vn("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=vn("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function pi(s){if(!s)return null;if(s.title)return s.title;const $=s.type||(s.customer?"opportunity":"lead"),i=fn(s,$);if($==="lead"){if(s.scheduledAppointment&&s.scheduledAppointment.title)return s.scheduledAppointment.title;const l=Ao[i];if(!l||!l.primaryAction)return null;const a=l.primaryAction,m={lead:s,displayStage:i},d=typeof a=="function"?a(m):a;if(!d)return null;const x=typeof d.label=="function"?d.label(m):d.label,V=typeof d.title=="function"?d.title(m):d.title;return x||V||null}if($==="opportunity"){if(s.scheduledAppointment&&s.scheduledAppointment.title)return s.scheduledAppointment.title;const l=Oo[i];if(!l||!l.primaryAction)return null;const a=l.primaryAction,m={deliverySubstatus:s.deliverySubstatus||ja(s,s.activities||[]),hasOffers:!!(s.offers&&s.offers.length>0)||!!(s.activities&&s.activities.some(A=>A.type==="offer")),scheduledAppointment:s.scheduledAppointment,opportunity:s,formatDateTime:A=>new Date(A).toLocaleDateString()},d=typeof a=="function"?a(m):a;if(!d)return null;const x=typeof d.label=="function"?d.label(m):d.label,V=typeof d.title=="function"?d.title(m):d.title;return x||V||null}return null}const vi={class:"flex flex-wrap items-center gap-2"},gi={key:2,class:"px-1.5 py-0.5 rounded text-xs font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},yi={__name:"TaskBadges",props:{task:{type:Object,required:!0}},setup(s){const $=s,i=C(()=>$.task.type==="lead"?"Lead":"Opportunity"),l=C(()=>$.task.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"),a=v=>v?v.stage||v.currentStage||"New":"",m=v=>{if(!v||v.type!=="opportunity")return null;try{return fn(v,"opportunity")}catch{return v.displayStage||v.stage||null}},d=C(()=>!$.task||$.task.type!=="opportunity"?null:a($.task)),x=C(()=>$.task?$.task.type==="opportunity"?m($.task)||a($.task)||"New":$.task.stage||$.task.currentStage||$.task.displayStage||"New":""),V=C(()=>{if(!$.task||$.task.type!=="opportunity")return null;const v=d.value,b=x.value;if(!b||!v||b===v)return null;const k=v.toLowerCase().trim();if(b.toLowerCase().trim().startsWith(k+" - ")){const w=v+" - ";if(b.startsWith(w))return b.substring(w.length)}return null}),A=C(()=>!!V.value),h=C(()=>V.value||x.value),g=v=>{if(!v)return"bg-gray-50 text-gray-700 border-gray-200";if($.task.type==="opportunity")try{const k=bo(v,"opportunity");return k.includes("blue")?k+" border-blue-200":k.includes("purple")?k+" border-purple-200":k.includes("yellow")?k+" border-yellow-200":k.includes("pink")?k+" border-pink-200":k.includes("indigo")?k+" border-indigo-200":k.includes("emerald")?k+" border-emerald-200":k.includes("green")?k+" border-green-200":k.includes("red")?k+" border-red-200":(k.includes("gray"),k+" border-gray-200")}catch{}const b=v.toLowerCase();return b.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":b.includes("qualif")?"bg-green-50 text-green-600 border-green-200":b.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":b.includes("close")?"bg-muted text-muted-foreground border-border":"bg-gray-50 text-gray-700 border-gray-200"};return(v,b)=>(p(),S("div",vi,[e("span",{class:se(["px-1.5 py-0.5 rounded text-xs font-bold uppercase border leading-none",l.value])},F(i.value),3),d.value&&A.value?(p(),S("span",{key:0,class:se(["px-1.5 py-0.5 rounded text-xs font-bold uppercase border leading-none",g(d.value)])},F(d.value),3)):q("",!0),h.value?(p(),S("span",{key:1,class:se(["px-1.5 py-0.5 rounded text-xs font-bold uppercase border leading-none",g(h.value)])},F(h.value),3)):q("",!0),s.task.priority==="Hot"?(p(),S("span",gi," Hot ")):q("",!0)]))}},bi={class:"border-b border-border bg-white px-6 h-16 min-h-16 shrink-0"},hi={class:"flex items-center justify-between gap-4 w-full h-full"},xi={class:"flex flex-col min-w-0"},wi={class:"flex items-center gap-2 min-w-0"},ki={key:0,class:"text-lg font-medium text-foreground truncate"},Si={key:1,class:"text-lg font-medium text-foreground truncate"},Ci={key:2,class:"text-lg font-medium text-foreground"},$i={key:3,class:"shrink-0"},Di={key:0,class:"text-sm text-muted-foreground truncate leading-normal mt-0.5"},Ai={key:1,class:"text-sm text-muted-foreground"},Oi={class:"flex items-center gap-3 shrink-0"},Ti={key:0,class:"flex items-center gap-2"},Ii={class:"flex items-center gap-1.5 px-2 py-1 rounded-btn text-xs font-medium bg-muted text-muted-foreground"},Vi={key:1,class:"relative"},Ni=["aria-expanded"],Fi=["disabled","onClick"],Ui={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close","postpone-expected-close"],setup(s,{emit:$}){const i=s,l=$,a=T(!1),m=C(()=>{var w,r;return((w=i.task)==null?void 0:w.type)==="lead"&&((r=i.task)==null?void 0:r.nextActionDue)&&!h.value}),d=C(()=>"Due Date"),x=C(()=>{var w;return(w=i.task)!=null&&w.nextActionDue?Na(i.task.nextActionDue):""}),V=C(()=>{var w,r;return((w=i.task)==null?void 0:w.type)==="opportunity"&&((r=i.task)==null?void 0:r.expectedCloseDate)}),A=C(()=>{var w;return(w=i.task)!=null&&w.expectedCloseDate?Na(i.task.expectedCloseDate):""}),h=C(()=>{var w,r,O;return((w=i.task)==null?void 0:w.stage)==="Closed Won"||((r=i.task)==null?void 0:r.stage)==="Closed Lost"||((O=i.task)==null?void 0:O.isClosed)}),g=C(()=>{var w;return((w=i.task)==null?void 0:w.type)!=="opportunity"?[]:[{key:"postpone",label:"Postpone",onClick:()=>{a.value=!1,l("postpone-expected-close")}}]}),v=C(()=>!i.task||!i.filteredTasks.length?!1:i.filteredTasks.findIndex(r=>{const O=i.task.compositeId||i.task.id;return(r.compositeId||r.id)===O})>0),b=C(()=>{if(!i.task||!i.filteredTasks.length)return!1;const w=i.filteredTasks.findIndex(r=>{const O=i.task.compositeId||i.task.id;return(r.compositeId||r.id)===O});return w>=0&&w<i.filteredTasks.length-1}),k=C(()=>i.task?pi(i.task):null),y=w=>{var O;if(!w)return"";const r=[];if(w.vehicle||w.requestedCar){const N=w.vehicle||w.requestedCar;N.brand&&N.model?r.push(`${N.brand} ${N.model} (${N.year||"N/A"})`):N.model&&r.push(`${N.model} (${N.year||"N/A"})`)}return w.source&&r.push(w.source),(O=w.customer)!=null&&O.name?r.push(w.customer.name):w.customerName&&r.push(w.customerName),r.join(" • ")};return(w,r)=>{const O=hs("click-outside");return p(),S("div",bi,[e("div",hi,[e("div",xi,[e("div",wi,[s.task&&k.value?(p(),S("h2",ki,F(k.value),1)):s.task?(p(),S("h2",Si,F(s.task.type==="lead"?"Lead Qualification Task":"Opportunity Management Task"),1)):(p(),S("h2",Ci," No task selected ")),s.task?(p(),S("div",$i,[n(yi,{task:s.task},null,8,["task"])])):q("",!0)]),s.task?(p(),S("p",Di,F(y(s.task)),1)):(p(),S("p",Ai," Select a task to view details "))]),e("div",Oi,[m.value?(p(),S("div",Ti,[e("div",Ii,[r[5]||(r[5]=e("i",{class:"fa-solid fa-calendar-day text-xs"},null,-1)),e("span",null,F(d.value)+": "+F(x.value),1)])])):q("",!0),V.value?(p(),S("div",Vi,[e("button",{type:"button",class:se(["flex items-center gap-1.5 px-2 py-1 rounded-btn text-xs font-medium bg-muted text-muted-foreground hover:bg-muted/80 transition-colors",{"cursor-default":h.value}]),"aria-expanded":a.value&&!h.value,"aria-haspopup":"true","aria-label":"Expected close date",onClick:r[0]||(r[0]=pn(N=>!h.value&&(a.value=!a.value),["stop"]))},[r[6]||(r[6]=e("i",{class:"fa-solid fa-calendar-day text-xs"},null,-1)),e("span",null,"Expected Close: "+F(A.value),1),h.value?q("",!0):(p(),K(t(Ba),{key:0,size:12,"stroke-width":"2",class:se(["shrink-0 transition-transform ml-1 text-muted-foreground",{"rotate-180":a.value}])},null,8,["class"]))],10,Ni),a.value&&!h.value&&g.value.length>0?ke((p(),S("div",{key:0,class:"absolute right-0 top-full mt-2 z-50 w-56 bg-white border border-border rounded-lg shadow-nsc-card py-1",onClick:r[1]||(r[1]=pn(()=>{},["stop"]))},[(p(!0),S(be,null,Oe(g.value,N=>(p(),S("button",{key:N.key,type:"button",class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!!N.disabled,onClick:U=>N.onClick()},F(N.label),9,Fi))),128))])),[[O,()=>a.value=!1]]):q("",!0)])):q("",!0),n(t(_),{variant:"secondary",size:"icon",onClick:r[2]||(r[2]=N=>w.$emit("previous")),disabled:!v.value},{default:o(()=>[n(t(ri),{size:16,class:"text-muted-foreground"})]),_:1},8,["disabled"]),n(t(_),{variant:"secondary",size:"icon",onClick:r[3]||(r[3]=N=>w.$emit("next")),disabled:!b.value},{default:o(()=>[n(t(ui),{size:16,class:"text-muted-foreground"})]),_:1},8,["disabled"]),s.isDrawerView?(p(),K(t(_),{key:2,variant:"secondary",size:"icon",onClick:r[4]||(r[4]=N=>w.$emit("close")),class:"ml-1"},{default:o(()=>[n(t(za),{size:16,class:"text-muted-foreground"})]),_:1})):q("",!0)])])])}}},qi=Zt(Ui,[["__scopeId","data-v-1d37ed9f"]]),Li=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:s=>["lead","opportunity"].includes(s)},managementWidget:{type:Object,default:null},activities:{type:Array,default:()=>[]}},setup(s){const $=s,i=Wa(),l=C(()=>{const a={...i};return $.type==="opportunity"&&"lead"in a&&delete a.lead,a});return(a,m)=>(p(),S("div",null,[s.managementWidget?(p(),K(Qs(s.managementWidget),Hs({key:0,lead:s.type==="lead"?s.task:void 0,opportunity:s.type==="opportunity"?s.task:void 0,activities:s.activities},l.value),null,16,["lead","opportunity","activities"])):q("",!0)]))}}),Pi=Zt(Li,[["__scopeId","data-v-7d989f79"]]),Mi={class:"overflow-hidden p-4 rounded-lg bg-white shadow-nsc-card"},Ei={class:"flex gap-4"},Ri={class:"w-24 shrink-0 aspect-3/2 rounded-lg overflow-hidden bg-surfaceTertiary"},ji=["src","alt"],Bi={key:1,class:"w-full h-full flex items-center justify-center"},zi={class:"min-w-0 flex-1 flex flex-col justify-center"},Wi={class:"text-sm font-semibold text-foreground truncate"},Yi={key:0,class:"flex items-center gap-2 mt-1 text-sm text-foreground flex-wrap"},Hi={key:0,class:"font-semibold"},Qi={key:1,class:"h-3 w-px bg-border shrink-0","aria-hidden":"true"},Gi={key:2,class:"text-muted-foreground truncate"},_i={key:1,class:"flex gap-3 mt-0.5 text-xs text-muted-foreground"},Ji={key:0},Ki={key:1},Zi={key:0,class:"rounded-lg p-3 mt-3 bg-muted"},Xi={class:"text-sm text-foreground"},er={class:"flex gap-2 pt-3 mt-3 border-t border-border"},tr={class:"relative"},nr={key:0,class:"absolute right-0 top-full mt-1 z-50"},sr={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions","edit-vehicle","remove-vehicle"],setup(s,{emit:$}){const i=s,l=$,a=T(!1),m=T(!1),d=()=>{m.value=!m.value},x=()=>{m.value=!1},V=C(()=>[{key:"edit",label:"Edit vehicle",onClick:()=>{l("edit-vehicle"),x()}},{key:"remove",label:"Remove vehicle",onClick:()=>{l("remove-vehicle"),x()}}]),A=C(()=>{const k=[];return i.vehicle.brand&&k.push(i.vehicle.brand),i.vehicle.model&&k.push(i.vehicle.model),i.vehicle.variant&&k.push(i.vehicle.variant),k.join(" ")||"Vehicle Details"}),h=C(()=>{const k=A.value;return i.vehicle.year?`${k} (${i.vehicle.year})`:k}),g=k=>{if(!k)return"0";const y=typeof k=="string"?parseFloat(k):k;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(y)},v=k=>{if(!k)return"0";const y=typeof k=="string"?parseFloat(k):k;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(y)},b=()=>{a.value=!0};return(k,y)=>{const w=hs("click-outside");return p(),S("div",Mi,[y[3]||(y[3]=e("h3",{class:"text-base font-medium text-foreground leading-6 mb-4"},"Requested Car",-1)),e("div",Ei,[e("div",Ri,[s.imageUrl&&!a.value?(p(),S("img",{key:0,src:s.imageUrl,alt:`${s.vehicle.brand} ${s.vehicle.model}`,class:"w-full h-full object-cover",onError:b},null,40,ji)):(p(),S("div",Bi,[n(t(To),{size:32,class:"text-muted-foreground"})]))]),e("div",zi,[e("p",Wi,F(h.value),1),s.vehicle.price||s.source?(p(),S("div",Yi,[s.vehicle.price?(p(),S("span",Hi," €"+F(g(s.vehicle.price)),1)):q("",!0),s.vehicle.price&&s.source?(p(),S("span",Qi)):q("",!0),s.source?(p(),S("span",Gi,F(s.source),1)):q("",!0)])):q("",!0),s.vehicle.mileage||s.vehicle.fuelType?(p(),S("div",_i,[s.vehicle.mileage?(p(),S("span",Ji,F(v(s.vehicle.mileage))+" km",1)):q("",!0),s.vehicle.fuelType?(p(),S("span",Ki,F(s.vehicle.fuelType),1)):q("",!0)])):q("",!0)])]),s.requestMessage?(p(),S("div",Zi,[y[1]||(y[1]=e("p",{class:"text-xs text-muted-foreground mb-0.5"},"Request message",-1)),e("p",Xi,F(s.requestMessage),1)])):q("",!0),e("div",er,[n(t(_),{variant:"secondary",size:"sm",class:"flex-1",onClick:y[0]||(y[0]=r=>k.$emit("open-ad"))},{default:o(()=>[n(t(Io),{size:16}),y[2]||(y[2]=e("span",null,"Open Ad",-1))]),_:1}),e("div",tr,[n(t(_),{variant:"secondary",size:"icon-sm",onClick:pn(d,["stop"])},{default:o(()=>[n(t(Ja),{size:16})]),_:1}),m.value?ke((p(),S("div",nr,[n(t(co),{items:V.value,className:"w-48"},null,8,["items"])])),[[w,x]]):q("",!0)])])])}}},ar={class:"relative flex-1 flex flex-col min-h-0 min-w-0 overflow-hidden"},lr={key:0,class:"flex flex-col flex-1 min-h-0 min-w-0 overflow-hidden"},or={class:"flex flex-1 min-h-0 overflow-hidden"},ir={class:"flex-1 flex flex-col min-h-0 overflow-hidden bg-white min-w-0"},rr={class:"flex-1 min-h-0 overflow-y-auto"},ur={class:"p-2"},dr={class:"right-sidebar flex flex-col min-h-0 overflow-hidden shrink-0 border-l border-border bg-surface"},cr={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},mr={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},fr={class:"flex-1 min-h-0 flex flex-col overflow-y-auto bg-muted"},pr={key:1,class:"flex-1 flex items-center justify-center bg-surface"},vr={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,default:null},storeAdapter:{type:Object,default:null},addNewConfig:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close","postpone-expected-close"],setup(s,{emit:$}){const i=s,l=$,a=Sn(),m=Xt(),d=T("request"),x=T({}),V=T(!1),A=T(!1),h=T(!1),g=T(!1),v=T(!1),b=T(!1),k=T(!1),y=T(!1),w=T(!1),r=T(!1),O=T(null);function N(){l("postpone-expected-close",i.task)}const U=C(()=>{var Z;return i.storeAdapter?((Z=i.storeAdapter.currentActivities)==null?void 0:Z.value)||[]:[]}),M=C(()=>U.value.length),le=C(()=>{var H;if(!((H=i.task)!=null&&H.customer))return 0;const Z=i.task.customer.email,ue=i.task.customer.phone,nt=i.task.compositeId||`${i.task.type}-${i.task.id}`;return[...(a.leads||[]).map(Y=>({...Y,type:"lead",compositeId:`lead-${Y.id}`})),...(m.opportunities||[]).map(Y=>({...Y,type:"opportunity",compositeId:`opportunity-${Y.id}`}))].filter(Y=>Y.compositeId===nt||!Y.customer?!1:Y.customer.email===Z||Y.customer.phone===ue).length}),R=()=>{l("task-navigate","previous")},E=()=>{l("task-navigate","next")},G=Z=>{d.value!=="activity"&&(d.value="activity")},z=Z=>{x.value[Z]=!x.value[Z]},Q=Z=>Z&&(Z.image||Z.imageUrl)||"",de=()=>{},J=()=>{},W=()=>{},j=Z=>{Z==="note"?V.value=!0:Z==="attachment"?A.value=!0:Z==="whatsapp"?h.value=!0:Z==="sms"?g.value=!0:Z==="email"?v.value=!0:Z==="call"?b.value=!0:Z==="financing"?k.value=!0:Z==="tradein"?y.value=!0:Z==="purchase"?w.value=!0:Z==="appointment"&&(r.value=!0)},ee=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"note",content:Z.content||Z.message,message:Z.content||Z.message,timestamp:new Date().toISOString()}),V.value=!1}catch(ue){console.error("Error saving note:",ue)}},me=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"attachment",fileName:Z.fileName,file:Z.file,content:`Attachment: ${Z.fileName}`,timestamp:new Date().toISOString()}),A.value=!1}catch(ue){console.error("Error saving attachment:",ue)}},fe=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"whatsapp",message:Z.message,content:Z.message,template:Z.template,timestamp:new Date().toISOString()}),h.value=!1}catch(ue){console.error("Error saving WhatsApp:",ue)}},$e=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"sms",message:Z.message,content:Z.message,template:Z.template,timestamp:new Date().toISOString()}),g.value=!1}catch(ue){console.error("Error saving SMS:",ue)}},Re=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"email",subject:Z.subject,message:Z.message,content:Z.message,template:Z.template,timestamp:new Date().toISOString()}),v.value=!1}catch(ue){console.error("Error saving email:",ue)}},Pe=async Z=>{var ue;if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"financing",action:Z.action||"added a financing proposal",content:Z.content||`Financing: ${((ue=Z.data)==null?void 0:ue.product)||"Unknown"}`,data:Z.data,timestamp:new Date().toISOString()}),k.value=!1}catch(nt){console.error("Error saving financing:",nt)}},gt=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"tradein",action:"added a trade-in",content:Z.content||"Trade-in vehicle added",data:Z.data,timestamp:new Date().toISOString()}),y.value=!1}catch(ue){console.error("Error saving trade-in:",ue)}},ht=async Z=>{var ue;if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"offer",action:Z.action||"created an offer",content:Z.content||`Offer: €${((ue=Z.data)==null?void 0:ue.price)||0}`,data:Z.data,timestamp:new Date().toISOString()}),w.value=!1}catch(nt){console.error("Error saving offer:",nt)}},ct=async Z=>{if(!(!i.storeAdapter||!i.task))try{await i.storeAdapter.addActivity(i.task.id,{type:"appointment",action:"scheduled an appointment",content:`Appointment: ${Z.type||"Meeting"} on ${Z.date||""}`,data:Z,timestamp:new Date().toISOString()}),r.value=!1}catch(ue){console.error("Error saving appointment:",ue)}};return(Z,ue)=>{var nt,at,mt,H,Y,te,X,ie,ve,ge,Te,We,_e;return p(),S("div",ar,[s.task?(p(),S("div",lr,[n(qi,{task:s.task,"filtered-tasks":s.filteredTasks,"is-drawer-view":s.isDrawerView,onPrevious:R,onNext:E,onClose:ue[0]||(ue[0]=Se=>Z.$emit("close")),onPostponeExpectedClose:N},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",or,[e("div",ir,[e("div",rr,[e("div",ur,[s.managementWidget&&s.storeAdapter?(p(),K(Pi,Hs({key:0,ref_key:"managementCardRef",ref:O,task:s.task,type:s.task.type,"management-widget":s.managementWidget,activities:U.value},Z.$attrs),null,16,["task","type","management-widget","activities"])):q("",!0)])])]),e("div",dr,[n(t(fo),{modelValue:d.value,"onUpdate:modelValue":ue[1]||(ue[1]=Se=>d.value=Se),class:"flex flex-col flex-1 min-h-0 overflow-hidden"},{default:o(()=>[n(t(mo),{class:"flex shrink-0 border-b border-border bg-white rounded-none w-full relative h-full"},{default:o(()=>[n(t(Ca),{value:"request",class:se(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",d.value==="request"?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:o(()=>[ue[12]||(ue[12]=e("span",null,"Request",-1)),le.value>0?(p(),S("span",{key:0,class:se(["flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full text-xs font-bold leading-none",d.value==="request"?"bg-primary text-white":"bg-gray-200 text-foreground"])},F(le.value),3)):q("",!0),d.value==="request"?(p(),S("span",cr)):q("",!0)]),_:1},8,["class"]),n(t(Ca),{value:"activity",class:se(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",d.value==="activity"?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:o(()=>[ue[13]||(ue[13]=e("span",null,"Activity",-1)),M.value>0?(p(),S("span",{key:0,class:se(["flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full text-xs font-bold leading-none",d.value==="activity"?"bg-primary text-white":"bg-gray-200 text-foreground"])},F(M.value),3)):q("",!0),d.value==="activity"?(p(),S("span",mr)):q("",!0)]),_:1},8,["class"])]),_:1}),e("div",fr,[n(t($a),{value:"request",class:"space-y-2 p-2 mt-0 flex-1 min-h-full"},{default:o(()=>{var Se,He;return[n(Vo,{task:s.task,"task-type":s.task.type,"customer-id":s.task.customerId||((Se=s.task.customer)==null?void 0:Se.id),onAction:W},null,8,["task","task-type","customer-id"]),s.task.requestedCar||s.task.vehicle?(p(),K(sr,{key:0,vehicle:s.task.requestedCar||s.task.vehicle,"request-message":s.task.requestMessage||((He=s.task.requestedCar)==null?void 0:He.requestMessage),source:s.task.source,"image-url":Q(s.task.requestedCar||s.task.vehicle),onOpenAd:de,onMoreActions:J},null,8,["vehicle","request-message","source","image-url"])):q("",!0)]}),_:1}),n(t($a),{value:"activity",class:"p-2 flex-1 overflow-hidden h-full flex flex-col mt-0"},{default:o(()=>[n(No,{activities:U.value,"expanded-summaries":x.value,onActivityClick:G,onToggleSummaryExpanded:z,onAddActivity:j},null,8,["activities","expanded-summaries"])]),_:1})])]),_:1},8,["modelValue"])])])])):(p(),S("div",pr,[...ue[14]||(ue[14]=[Ya('<div class="text-center max-w-sm p-8" data-v-acc82f29><div class="w-16 h-16 mx-auto mb-4 rounded-lg bg-muted flex items-center justify-center" data-v-acc82f29><i class="fa-solid fa-tasks text-2xl text-muted-foreground" data-v-acc82f29></i></div><h3 class="text-lg font-bold text-foreground mb-2" data-v-acc82f29>No task selected</h3><p class="text-sm text-muted-foreground" data-v-acc82f29>Select a task from the list to view its details and manage activities</p></div>',1)])])),n(Ka,{modal:"",show:V.value,"task-type":((nt=s.task)==null?void 0:nt.type)||"lead","task-id":(at=s.task)==null?void 0:at.id,onSave:ee,onClose:ue[2]||(ue[2]=Se=>V.value=!1)},null,8,["show","task-type","task-id"]),n(Fo,{modal:"",show:A.value,"task-type":((mt=s.task)==null?void 0:mt.type)||"lead","task-id":(H=s.task)==null?void 0:H.id,onSave:me,onClose:ue[3]||(ue[3]=Se=>A.value=!1)},null,8,["show","task-type","task-id"]),n(Uo,{show:h.value,onSave:fe,onClose:ue[4]||(ue[4]=Se=>h.value=!1)},null,8,["show"]),n(qo,{show:g.value,onSave:$e,onClose:ue[5]||(ue[5]=Se=>g.value=!1)},null,8,["show"]),n(Lo,{show:v.value,onSave:Re,onClose:ue[6]||(ue[6]=Se=>v.value=!1)},null,8,["show"]),n(Gs,{show:b.value,title:"Call Feature",onClose:ue[7]||(ue[7]=Se=>b.value=!1)},null,8,["show"]),n(Za,{show:k.value,"task-type":((Y=s.task)==null?void 0:Y.type)||"lead","task-id":(te=s.task)==null?void 0:te.id,onSave:Pe,onClose:ue[8]||(ue[8]=Se=>k.value=!1)},null,8,["show","task-type","task-id"]),n(Xa,{show:y.value,mode:"tradein","task-type":((X=s.task)==null?void 0:X.type)||"lead","task-id":(ie=s.task)==null?void 0:ie.id,onSave:gt,onClose:ue[9]||(ue[9]=Se=>y.value=!1)},null,8,["show","task-type","task-id"]),n(Po,{show:w.value,"task-type":((ve=s.task)==null?void 0:ve.type)||"lead","task-id":(ge=s.task)==null?void 0:ge.id,customer:(Te=s.task)==null?void 0:Te.customer,onSave:ht,onClose:ue[10]||(ue[10]=Se=>w.value=!1)},null,8,["show","task-type","task-id","customer"]),n(el,{show:r.value,customer:(We=s.task)==null?void 0:We.customer,assignee:(_e=s.task)==null?void 0:_e.assignee,onCreate:ct,onCancel:ue[11]||(ue[11]=Se=>r.value=!1)},null,8,["show","customer","assignee"])])}}},bh=Zt(vr,[["__scopeId","data-v-acc82f29"]]),gr={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 shadow-xl flex flex-col overflow-hidden"},yr={class:"flex-1 min-h-0 flex flex-col overflow-hidden"},br={__name:"DrawerContainer",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(s,{emit:$}){const i=$,l=()=>{i("close")};return(a,m)=>(p(),S(be,null,[n(bs,{name:"fade"},{default:o(()=>[s.show?(p(),S("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:l})):q("",!0)]),_:1}),n(bs,{name:"slide-right"},{default:o(()=>[s.show?(p(),S("div",gr,[e("div",yr,[Ft(a.$slots,"default",{},void 0,!0)])])):q("",!0)]),_:3})],64))}},hh=Zt(br,[["__scopeId","data-v-ff23c65a"]]);function tl(s,$={}){const i=xs(),l=C(()=>{const w=typeof s=="function"?s():ys(s);return{lead:w,displayStage:w?fn(w,"lead"):null}}),a=C(()=>l.value.displayStage||"New"),m=C(()=>{const w=l.value;return Mo(w)}),d=C(()=>{const w=l.value,r=Eo(w);if(!r)return null;const O=$[r.key];return{...r,handler:O||(()=>{})}}),x=C(()=>{const w=l.value;return Ro(w).map(O=>{const N=$[O.key];return{...O,handler:N||(()=>{})}})}),V=C(()=>{const w=l.value;return jo(w)}),A=C(()=>{const w=l.value;return Bo(w)}),h=C(()=>{const w=l.value;return zo(w)}),g=C(()=>{const w=l.value;return Wo(w)}),v=C(()=>{const r=l.value.lead;return((r==null?void 0:r.contactAttempts)||[]).length||0}),b=C(()=>i.getSetting("maxContactAttempts")),k=C(()=>v.value+1>=b.value),y=C(()=>!0);return{displayStage:a,isClosed:m,primaryAction:d,secondaryActions:x,showLQWidget:V,showDeadlineBanner:A,canPostpone:h,canReassign:y,lqWidgetMode:g,contactAttempts:v,maxContactAttempts:b,shouldShowAutoDisqualifyWarning:k}}function hr({getLead:s,leadState:$,emit:i}){const l=Ha(),a=Sn(),m=Yt();async function d(r){var N;const O=s();if(O&&$.canPostpone.value)try{const U=new Date(`${r.date}T${r.time}:00`),M=U.toISOString(),le={nextActionDue:M};if((r.assigneeId||r.teamId)&&(le.assignee=r.assignee||null,le.assigneeId=r.assigneeId||null,le.assigneeType=r.assigneeType||"user",le.teamId=r.teamId||null,le.team=r.team||null),await a.updateLead(O.id,le),r.createAppointment){const R=new Date(U);R.setHours(R.getHours()+1),await a.updateLead(O.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${O.customer.name}`,start:M,end:R.toISOString(),type:"Call",assignee:r.assignee||O.assignee,assigneeId:r.assigneeId||O.assigneeId,assigneeType:r.assigneeType||O.assigneeType||"user",teamId:r.teamId||O.teamId,team:r.team||O.team,status:"scheduled"}}),await a.addActivity(O.id,{type:"appointment",user:((N=m.currentUser)==null?void 0:N.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${wn(U)} at ${Zn(U)}`,data:{type:"Call",date:r.date,time:r.time,assignee:r.assignee||O.assignee}})}await a.addActivity(O.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${wn(U)} at ${Zn(U)}${r.assignee?` and reassigned to ${r.assignee}`:""}`}),await a.fetchLeadById(O.id)}catch(U){console.error("Failed to postpone lead task:",U)}}async function x(r){const O=s();if(O)try{if(await a.updateLead(O.id,{stage:"Validated"}),await a.addActivity(O.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),r.scheduleFollowUp&&r.appointmentData){const N=new Date(`${r.appointmentData.date}T${r.appointmentData.time}:00`);await a.scheduleFollowUp(O.id,{dateTime:N.toISOString(),assignee:r.appointmentData.assignee||O.assignee,assigneeId:r.appointmentData.assigneeId||null,assigneeType:r.appointmentData.assigneeType||"user",teamId:r.appointmentData.teamId||null,team:r.appointmentData.team||null}),await a.addActivity(O.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${wn(N)} at ${Zn(N)}`})}await a.fetchLeadById(O.id)}catch(N){console.error("Failed to validate lead:",N)}}async function V(r){var N,U,M;const O=s();if(O)try{if((N=r==null?void 0:r.assignment)!=null&&N.assignee){const R=r.assignment.assignee,E={assignee:R.name||R.label||null,assigneeId:R.id||null,assigneeType:R.type||"user"};R.type==="team"&&(E.teamId=R.id||null,E.team=R.name||null),r.assignment.salesperson&&(E.assignee=r.assignment.salesperson.name||r.assignment.salesperson,E.assigneeId=r.assignment.salesperson.id||null,E.assigneeType="user",E.teamId=R.id||null,E.team=R.name||null),await a.updateLead(O.id,E);const G=((U=r.assignment.salesperson)==null?void 0:U.name)||R.name||"Unassigned";await a.addActivity(O.id,{type:"note",user:((M=m.currentUser)==null?void 0:M.name)||"You",action:"assigned lead",content:`Lead assigned to ${G}${r.assignment.salesperson&&R.name?` (${R.name} team)`:""}`,timestamp:new Date().toISOString()})}const le=await a.convertLeadToOpportunity(O.id);m.canAccessOpportunities()?l.push({path:`/tasks/${le}`,query:{type:"opportunity"}}):l.push("/tasks")}catch(le){console.error("Failed to qualify lead:",le)}}async function A(r){const O=s();if(O)try{const N=O.contactAttempts||[];await a.updateLead(O.id,{contactAttempts:[...N,r],lastContactAttempt:r.timestamp,totalContactAttempts:N.length+1}),await a.addActivity(O.id,{type:"call",user:"You",action:`logged call attempt - ${r.outcome}`,content:r.notes||`Call attempt via ${r.channel}`,data:{outcome:r.outcome,channel:r.channel,duration:r.duration}}),await a.fetchLeadById(O.id)}catch(N){console.error("Failed to log call attempt:",N)}}async function h(r){const O=s();if(O)try{await a.addActivity(O.id,{type:"note",user:"You",action:"added a note",content:r.content||r.text||"",data:r}),await a.fetchLeadById(O.id)}catch(N){console.error("Failed to save note:",N)}}function g(){i("open-purchase-method")}function v(){i("open-trade-in")}async function b(r){var N;const O=s();if(O)try{const U=r.datetime?new Date(r.datetime).toISOString().split("T")[0]+"T"+r.time+":00":`${r.date}T${r.time}:00`,M=new Date(U),le=r.duration||60;M.setMinutes(M.getMinutes()+le);const R={scheduledAppointment:{id:Date.now(),title:`${r.type} - ${O.customer.name}`,start:U,end:M.toISOString(),type:r.type,assignee:r.assignee,assigneeId:r.assigneeId||r.salespersonId||r.teamId,assigneeType:r.assigneeType||(r.salespersonId?"user":"team"),teamId:r.teamId||null,team:r.team||null,salesperson:r.salesperson||null,salespersonId:r.salespersonId||null,status:"scheduled",location:r.location||"",notes:r.notes||""}};(r.assigneeId||r.salespersonId||r.teamId)&&(R.assignee=r.assignee||r.salesperson||r.team,R.assigneeId=r.assigneeId||r.salespersonId||r.teamId,R.assigneeType=r.assigneeType||(r.salespersonId?"user":"team"),r.teamId&&(R.teamId=r.teamId,R.team=r.team)),await a.updateLead(O.id,R),await a.addActivity(O.id,{type:"appointment",user:((N=m.currentUser)==null?void 0:N.name)||"You",action:"scheduled an appointment",content:`${r.type} scheduled for ${wn(new Date(U))} at ${r.time}`,data:{type:r.type,date:r.date||wn(new Date(U)),time:r.time,assignee:r.assignee,assigneeId:r.assigneeId,team:r.team,salesperson:r.salesperson}}),await a.fetchLeadById(O.id)}catch(U){console.error("Failed to schedule appointment:",U)}}async function k(r){const O=s();if(O&&!($.isClosed.value&&!r.force))try{const N=$.displayStage.value,U=r.reason==="Duplicate"?vs.CLOSED_DUPLICATE:r.category==="Not Interested"?vs.CLOSED_NOT_INTERESTED:vs.CLOSED_INVALID,M=Fa(N,U);if(M){const{updates:le,activities:R}=M(O,U,r);await a.updateLead(O.id,le);for(const E of R)await a.addActivity(O.id,E)}else{const le=r.reason==="Duplicate";await a.updateLead(O.id,{isDisqualified:!0,disqualifyReason:r.reason,isDuplicate:le,stage:le?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await a.addActivity(O.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${r.category}, Reason: ${r.reason}`})}l.push("/tasks")}catch(N){console.error("Failed to disqualify lead:",N)}}async function y(){const r=s();if(r)try{const O=$.displayStage.value,N=vs.NEW,U=Fa(O,N);if(U){const{updates:M,activities:le}=U(r);await a.updateLead(r.id,M);for(const R of le)await a.addActivity(r.id,R)}else await a.updateLead(r.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open",status:"Open",nextActionDue:null,scheduledAppointment:null}),await a.addActivity(r.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await a.fetchLeadById(r.id)}catch(O){console.error("Failed to reopen lead:",O)}}function w(){const r=s();r&&r.opportunityId&&l.push({path:`/tasks/${r.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:d,handleValidated:x,handleQualified:V,handleCallAttemptLogged:A,handleNoteSaved:h,handleOpenPurchaseMethod:g,handleOpenTradeIn:v,handleAppointmentScheduled:b,handleDisqualified:k,handleReopen:y,viewOpportunity:w}}const xr={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},wr={class:"space-y-6"},nl={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(s){return($,i)=>s.task?(p(),S("div",{key:0,class:se(["rounded-lg flex flex-col bg-muted",s.containerClass])},[s.hideTitle?q("",!0):(p(),S("div",xr,[...i[0]||(i[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-foreground"}),e("h2",{class:"text-sm font-medium text-foreground leading-5"},"Manage next steps")],-1)])])),e("div",{class:se(["bg-white rounded-lg p-2 flex flex-col",s.hideBorder?"shadow-none":"shadow-nsc-card"])},[Ft($.$slots,"deadline-banner"),e("div",wr,[Ft($.$slots,"primary-action"),Ft($.$slots,"task-widgets"),Ft($.$slots,"closed-state"),Ft($.$slots,"secondary-actions")])],2)],2)):q("",!0)}},kr={class:"flex justify-between items-start mb-3"},Sr={class:"font-bold text-gray-900 text-sm"},Cr={class:"text-xs text-gray-500 mt-0.5"},$r={class:"flex gap-3 flex-wrap"},sl={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(s){return($,i)=>(p(),S("div",{class:se(["rounded-lg p-4 relative transition-all duration-300 border",[s.colorScheme.background,s.colorScheme.border]])},[e("div",kr,[e("div",null,[e("h4",Sr,F(s.action.title),1),e("p",Cr,F(s.action.description),1)])]),e("div",$r,[e("button",{onClick:i[0]||(i[0]=l=>$.$emit("action-clicked")),class:se([s.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:se(s.action.icon)},null,2),D(" "+F(s.action.label),1)],2)])],2))}},Dr={class:"flex flex-col min-w-64 max-w-sm w-full bg-white rounded-lg shadow-nsc-card overflow-hidden"},Ar={class:"p-2 border-b border-border shrink-0"},Or=["placeholder"],Tr={class:"max-h-96 overflow-y-auto p-2"},Ir={class:"text-xs font-medium text-muted-foreground uppercase tracking-wide px-2 py-1 mb-1"},Vr=["onClick"],Nr={key:0,class:"fa-solid fa-users text-xs"},Fr={key:1},Ur={class:"min-w-0 flex-1"},qr={class:"font-medium text-sm text-foreground truncate"},Lr={key:0,class:"text-xs text-muted-foreground truncate capitalize"},Pr={key:1,class:"text-center py-8"},Mr={class:"text-sm text-muted-foreground"},Pa={__name:"AssigneeDropdownContent",emits:["select"],setup(s,{emit:$}){const{t:i}=ts(),l=$,a=gn(),m=T(""),d=C(()=>a.assignableUsers||[]),x=C(()=>a.assignableTeams||[]),V=C(()=>{const y=x.value.map(O=>O.name),w=[...new Set(d.value.map(O=>O.team).filter(Boolean))],r=new Set(y);return w.forEach(O=>{r.has(O)||(r.add(O),y.push(O))}),y}),A=C(()=>{const y=[],w=x.value.map(r=>({...r,type:"team",team:r.name}));return w.length>0&&y.push({key:"teams",label:"Teams",items:w}),V.value.forEach(r=>{const O=d.value.filter(N=>N.team===r);O.length>0&&y.push({key:`team-${r}`,label:r,items:O.map(N=>({...N,type:"user"}))})}),y}),h=(y,w)=>{const r=w.toLowerCase(),O=(y.name||"").toLowerCase(),N=(y.email||"").toLowerCase(),U=(y.role||"").toLowerCase(),M=(y.team||"").toLowerCase();return O.includes(r)||N.includes(r)||U.includes(r)||M.includes(r)},g=C(()=>{const y=m.value.trim();return y?A.value.map(w=>({...w,items:w.items.filter(r=>h(r,y))})).filter(w=>w.items.length>0):A.value}),v=C(()=>g.value.some(y=>y.items.length>0));function b(y){return{manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"}[y]||"bg-muted text-muted-foreground"}function k(y){const w=y.type==="team"?{...y,team:y.name,role:void 0,email:void 0,initials:void 0}:y;l("select",w)}return(y,w)=>(p(),S("div",Dr,[e("div",Ar,[ke(e("input",{"onUpdate:modelValue":w[0]||(w[0]=r=>m.value=r),type:"text",placeholder:t(i)("common.assignee.searchPlaceholder"),class:"w-full h-10 min-h-10 px-3 border border-border rounded-lg text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-brand-dark focus:ring-2 focus:ring-brand-dark/15"},null,8,Or),[[Xn,m.value]])]),e("div",Tr,[v.value?(p(!0),S(be,{key:0},Oe(g.value,r=>(p(),S("div",{key:r.key,class:"mb-3 last:mb-0"},[e("p",Ir,F(r.label),1),(p(!0),S(be,null,Oe(r.items,O=>(p(),S("button",{key:`${O.type}-${O.id}`,type:"button",onClick:N=>k(O),class:"w-full flex items-center gap-3 p-2 rounded-lg border border-border hover:bg-muted hover:border-brand-dark/30 transition-colors text-left"},[e("div",{class:se(["w-8 h-8 rounded-full flex items-center justify-center font-semibold text-xs shrink-0",O.type==="team"?"bg-green-100 text-green-700":b(O.role)])},[O.type==="team"?(p(),S("i",Nr)):(p(),S("span",Fr,F(O.initials||"?"),1))],2),e("div",Ur,[e("p",qr,F(O.name),1),O.type==="user"?(p(),S("p",Lr,F(O.role)+" • "+F(O.email),1)):q("",!0)])],8,Vr))),128))]))),128)):(p(),S("div",Pr,[w[1]||(w[1]=e("i",{class:"fa-solid fa-search text-2xl text-muted-foreground mb-2"},null,-1)),e("p",Mr,F(t(i)("common.assignee.noAssigneesFound")),1)]))])]))}},Er={key:0,class:"flex items-center justify-between gap-2 w-full"},Rr={class:"flex items-center gap-2 min-w-0 flex-1"},jr={class:"min-w-0 flex-1"},Br={class:"text-sm font-semibold text-foreground truncate leading-tight"},zr={class:"font-normal text-muted-foreground"},Wr={class:"text-xs text-muted-foreground truncate leading-tight"},Yr={class:"flex items-center gap-2 min-w-0 flex-1"},Hr={class:"text-sm font-medium text-foreground"},Qr=Object.assign({inheritAttrs:!1},{__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},readonly:{type:Boolean,default:!1}},emits:["reassigned"],setup(s,{emit:$}){const{t:i}=ts(),l=Wa(),a=s,m=$,d=gn(),x=Yt(),V=Sn(),A=Xt(),h=T(!1),g=C(()=>x.currentUser),v=C(()=>!!(a.task.assignee||a.task.owner||a.task.assignedTo)),b=C(()=>{var M;const N=a.task.assignee||a.task.owner||a.task.assignedTo||"Unassigned",U=(M=d.users)==null?void 0:M.find(le=>le.name===N);return{name:N,team:(U==null?void 0:U.team)||a.task.assigneeTeam||a.task.team||"No team",dealership:(U==null?void 0:U.dealership)||a.task.assigneeDealership||"MotorK Dealership",role:(U==null?void 0:U.role)||a.task.assigneeRole||"salesman"}}),k=N=>!N||N==="Unassigned"?"?":N.split(" ").map(U=>U[0]).join("").toUpperCase().substring(0,2),y=N=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[N]||"bg-muted text-muted-foreground",w=async()=>{if(!(!g.value||a.readonly))try{a.taskType==="lead"?await V.updateLead(a.task.id,{assignee:g.value.name,assigneeType:"user",assigneeTeam:g.value.team,assigneeDealership:g.value.dealership,assigneeRole:g.value.role}):a.taskType==="opportunity"&&await A.updateOpportunity(a.task.id,{assignee:g.value.name,assigneeType:"user",assigneeTeam:g.value.team,assigneeDealership:g.value.dealership,assigneeRole:g.value.role}),m("reassigned",g.value)}catch(N){console.error("Error assigning to self:",N)}};async function r(N){if(a.readonly)return;const U={assignee:N.name,assigneeType:N.type,assigneeTeam:N.team??N.name,assigneeDealership:N.dealership,assigneeRole:N.role};N.type==="team"&&(U.teamId=N.id),a.taskType==="lead"?await V.updateLead(a.task.id,U):a.taskType==="opportunity"&&await A.updateOpportunity(a.task.id,U),m("reassigned",N)}function O(N){r(N).catch(U=>console.error("Error assigning:",U)),h.value=!1}return(N,U)=>(p(),S("div",{class:se(["rounded-lg",[v.value?"bg-muted":"bg-blue-50",t(l).class]]),style:Qa(v.value?void 0:{borderWidth:"1px",borderStyle:"solid",borderColor:"var(--brand-primary)"})},[e("div",{class:se(["rounded-lg px-3 py-2 shadow-nsc-card flex items-center justify-between gap-2 flex-wrap",v.value?"bg-white border border-border":"bg-transparent"])},[v.value?(p(),S("div",Er,[e("div",Rr,[e("div",{class:se(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",y(b.value.role)])},F(k(b.value.name)),3),e("div",jr,[e("p",Br,[D(F(b.value.name)+" ",1),e("span",zr,"• "+F(b.value.team),1)]),e("p",Wr,F(b.value.dealership),1)])]),n(t(Oa),{open:h.value,"onUpdate:open":U[0]||(U[0]=M=>h.value=M)},{default:o(()=>[n(t(Da),{"as-child":""},{default:o(()=>[s.readonly?q("",!0):(p(),K(t(_),{key:0,variant:"ghost",size:"sm",class:"shrink-0 text-xs px-2 py-1"},{default:o(()=>[...U[2]||(U[2]=[D(" Change ",-1)])]),_:1}))]),_:1}),n(t(Aa),{class:"w-auto p-0 border border-border rounded-lg shadow-nsc-card bg-white",side:"bottom",align:"end"},{default:o(()=>[n(Pa,{onSelect:O})]),_:1})]),_:1},8,["open"])])):(p(),S(be,{key:1},[e("div",Yr,[n(t(Yo),{size:14,class:"shrink-0","aria-hidden":"true","stroke-width":"2",style:{color:"var(--brand-primary)"}}),e("p",Hr,F(t(i)("common.assignee.taskUnassigned")),1)]),s.readonly?q("",!0):(p(),K(t(vo),{key:0,class:"assignee-button-group flex items-stretch gap-0 rounded-lg overflow-hidden"},{default:o(()=>[n(t(_),{variant:"default",size:"sm",class:"rounded-r-none border-r border-white/20 bg-primary",onClick:w},{default:o(()=>[D(F(t(i)("common.assignee.assignToMe")),1)]),_:1}),n(t(po)),n(t(Oa),{open:h.value,"onUpdate:open":U[1]||(U[1]=M=>h.value=M)},{default:o(()=>[n(t(Da),{"as-child":""},{default:o(()=>[n(t(_),{variant:"default",size:"icon-sm",class:"rounded-l-none border-0 bg-primary -ml-px","aria-label":t(i)("common.assignee.assignToSomeone")},{default:o(()=>[n(t(Ba),{size:14,"stroke-width":"2","aria-hidden":"true"})]),_:1},8,["aria-label"])]),_:1}),n(t(Aa),{class:"w-auto p-0 border border-border rounded-lg shadow-nsc-card bg-white",side:"bottom",align:"end"},{default:o(()=>[n(Pa,{onSelect:O})]),_:1})]),_:1},8,["open"])]),_:1}))],64))],2)],6))}}),al=Zt(Qr,[["__scopeId","data-v-98f04dba"]]),kn=(s,$)=>{if(!s||!$)return[];const i=new Date($).getDay();if(i===0||i===6)return[];const[a,m]=s.split("-"),d=parseInt(m);return a==="team"?_r(d,$):a==="user"?Gr(d,$,i):[]},Gr=(s,$,i)=>{const l={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(l[s]||l[1])[i]||[]},_r=(s,$)=>{const i=new Date($).getDay(),l=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return s===1?i===1||i===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:s===2?l.filter((a,m)=>m%2===0):l},Jr={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Kr={class:"space-y-3"},Zr={key:0,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Xr={class:"font-semibold text-foreground text-sm mb-4"},eu={class:"mb-4"},tu={class:"mb-4"},nu={class:"flex gap-2"},su={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},au={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lu={class:"flex items-center justify-between mb-4"},ou={class:"text-sm font-semibold text-foreground"},iu={class:"grid grid-cols-7 gap-1 mb-2"},ru={class:"grid grid-cols-7 gap-1"},uu=["onClick"],du={class:"text-sm font-semibold text-foreground mb-4"},cu={key:0,class:"space-y-2"},mu=["onClick"],fu={key:1,class:"text-sm text-muted-foreground py-4 text-center"},pu={key:2,class:"text-sm text-muted-foreground py-4 text-center"},vu={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(s,{emit:$}){const{t:i}=ts(),l=s,a=$,m=Yt(),d=gn(),x=T("assign-and-schedule"),V=T(""),A=T(null),h=T(""),g=T(""),v=T("30min"),b=T(new Date().getMonth()),k=T(new Date().getFullYear()),y=T(null);C(()=>d.assignableUsers),C(()=>d.assignableTeams);const w=C(()=>new Date(k.value,b.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),r=C(()=>{const ee=new Date(k.value,b.value,1),fe=new Date(k.value,b.value+1,0).getDate(),$e=ee.getDay()===0?6:ee.getDay()-1,Re=[];for(let Pe=0;Pe<$e;Pe++)Re.push(null);for(let Pe=1;Pe<=fe;Pe++)Re.push(Pe);return Re}),O=C(()=>[{value:"Showroom Visit",label:i("forms.schedule.eventType.options.showroomVisit")},{value:"Test Drive",label:i("forms.schedule.eventType.options.testDrive")},{value:"Video Call",label:i("forms.schedule.eventType.options.videoCall")},{value:"Home Visit",label:i("forms.schedule.eventType.options.homeVisit")},{value:"Closing Meeting",label:i("forms.schedule.eventType.options.closingMeeting")}]),N=["MON","TUE","WED","THU","FRI","SAT","SUN"],U=C(()=>{if(!y.value||!h.value)return i("forms.schedule.timeSlots.selectDate");const ee=new Date(h.value),me=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],fe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${me[ee.getDay()]}, ${fe[ee.getMonth()]} ${ee.getDate()}`}),M=ee=>{if(!ee||!h.value)return!1;const me=new Date(h.value);return me.getDate()===ee&&me.getMonth()===b.value&&me.getFullYear()===k.value},le=ee=>{if(!ee)return;const me=new Date(k.value,b.value,ee);h.value=me.toISOString().split("T")[0],y.value=ee,g.value=""},R=()=>{b.value===0?(b.value=11,k.value--):b.value--},E=()=>{b.value===11?(b.value=0,k.value++):b.value++},G=C(()=>!h.value||!A.value?[]:kn(A.value,h.value)),z=()=>{var ee;if(l.preselectedAssignee){const{type:me,id:fe}=l.preselectedAssignee;A.value=`${me}-${fe}`}else A.value=`user-${((ee=m.currentUser)==null?void 0:ee.id)||1}`};z();const Q=C(()=>x.value==="assign-only"?!0:!!(V.value&&h.value&&g.value&&A.value));ye(()=>l.show,ee=>{ee?z():de()}),ye(h,()=>{g.value=""});const de=()=>{x.value="assign-and-schedule",V.value="",h.value="",g.value="",v.value="30min",y.value=null;const ee=new Date;b.value=ee.getMonth(),k.value=ee.getFullYear()},J=ee=>{ee||a("close")},W=()=>{if(!Q.value)return;const ee=A.value.startsWith("team-"),me=parseInt(A.value.split("-")[1]);let fe={};if(ee){const Re=d.getTeamById(me);fe={assigneeType:"team",teamId:me,team:(Re==null?void 0:Re.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const Re=d.getUserById(me);fe={assigneeType:"user",assigneeId:me,assignee:(Re==null?void 0:Re.name)||"Unknown",teamId:null,team:null}}const $e={...fe};x.value==="assign-and-schedule"&&($e.type=V.value,$e.date=h.value,$e.time=g.value,$e.duration=v.value),a("confirm",$e),a("close")},j=()=>{a("close")};return(ee,me)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":J},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-4xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),{class:"text-lg"},{default:o(()=>[...me[6]||(me[6]=[D("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",Jr,[e("div",Kr,[e("label",{class:se(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",x.value==="assign-only"?"border-green-600 bg-green-50":"border-border hover:border-green-600/30"])},[ke(e("input",{type:"radio","onUpdate:modelValue":me[0]||(me[0]=fe=>x.value=fe),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ut,x.value]]),me[7]||(me[7]=e("span",{class:"text-sm font-medium text-foreground"},"Assign only",-1))],2),e("label",{class:se(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",x.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-border hover:border-green-600/30"])},[ke(e("input",{type:"radio","onUpdate:modelValue":me[1]||(me[1]=fe=>x.value=fe),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ut,x.value]]),me[8]||(me[8]=e("span",{class:"text-sm font-medium text-foreground"},"Assign and schedule",-1))],2)]),x.value==="assign-and-schedule"?(p(),S("div",Zr,[e("h5",Xr,F(t(i)("forms.schedule.title")),1),e("div",eu,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[D(F(t(i)("forms.schedule.eventType.label")),1)]),_:1}),n(t(vt),{modelValue:V.value,"onUpdate:modelValue":me[2]||(me[2]=fe=>V.value=fe),items:O.value,placeholder:t(i)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:o(({item:fe})=>[e("span",null,F(fe.label),1)]),_:1},8,["modelValue","items","placeholder"])]),e("div",tu,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[D(F(t(i)("forms.schedule.duration.label")),1)]),_:1}),e("div",nu,[e("button",{onClick:me[3]||(me[3]=fe=>v.value="30min"),class:se(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",v.value==="30min"?"border-primary bg-muted text-foreground":"border-border text-muted-foreground hover:border-primary/30"])},F(t(i)("forms.schedule.duration.30min")),3),e("button",{onClick:me[4]||(me[4]=fe=>v.value="60min"),class:se(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",v.value==="60min"?"border-primary bg-muted text-foreground":"border-border text-muted-foreground hover:border-primary/30"])},F(t(i)("forms.schedule.duration.60min")),3),e("button",{onClick:me[5]||(me[5]=fe=>v.value="custom"),class:se(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",v.value==="custom"?"border-primary bg-muted text-foreground":"border-border text-muted-foreground hover:border-primary/30"])},F(t(i)("forms.schedule.duration.custom")),3)])]),e("div",su,[e("div",au,[e("div",null,[e("div",lu,[e("button",{onClick:R,class:"p-1 hover:bg-muted rounded transition-colors"},[...me[9]||(me[9]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-muted-foreground"},null,-1)])]),e("h6",ou,F(w.value),1),e("button",{onClick:E,class:"p-1 hover:bg-muted rounded transition-colors"},[...me[10]||(me[10]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-muted-foreground"},null,-1)])])]),e("div",iu,[(p(),S(be,null,Oe(N,fe=>e("div",{key:fe,class:"text-center text-xs font-medium text-muted-foreground py-2"},F(fe),1)),64))]),e("div",ru,[(p(!0),S(be,null,Oe(r.value,(fe,$e)=>(p(),S("div",{key:$e,onClick:Re=>le(fe),class:se(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg cursor-pointer transition-all",M(fe)?"bg-primary text-white":fe?"text-muted-foreground hover:bg-muted":"text-transparent"])},F(fe),11,uu))),128))])]),e("div",null,[e("h6",du,F(U.value),1),h.value&&G.value.length>0?(p(),S("div",cu,[(p(!0),S(be,null,Oe(G.value,fe=>(p(),S("button",{key:fe,onClick:$e=>g.value=fe,class:se(["w-full py-2 px-4 bg-white border border-border rounded-lg shadow-sm text-sm font-medium text-center transition-all",g.value===fe?"border-primary bg-muted text-foreground":"text-muted-foreground hover:border-primary/30"])},F(fe),11,mu))),128))])):h.value&&G.value.length===0?(p(),S("div",fu,F(t(i)("forms.schedule.timeSlots.noSlots")),1)):(p(),S("div",pu,F(t(i)("forms.schedule.timeSlots.selectDate")),1))])])])])):q("",!0)]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-sm",onClick:j}),n(t(_),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!Q.value,onClick:W},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function ll(){const s=ho(),$=T(!1),i=T(!1),l=T(0),a=T(""),m=T(null),d=T({}),x=T(null),V={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},A=C(()=>{const y=Math.floor(l.value/60),w=l.value%60;return`${y.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`}),h=()=>{$.value=!0,l.value=0,i.value=!1,a.value="",m.value=setInterval(()=>{l.value++,l.value>=20&&g()},1e3)},g=()=>{m.value&&(clearInterval(m.value),m.value=null),$.value=!1,i.value=!0,d.value={duration:l.value,notes:a.value,transcription:V,channel:"phone"}},v=async y=>{try{await navigator.clipboard.writeText(y),s.pushToast("success","Phone number copied to clipboard!")}catch{s.pushToast("error","Failed to copy phone number")}},b=y=>(x.value={tradeIn:V.leadLines.some(w=>w.toLowerCase().includes("trade")||w.toLowerCase().includes("exchange"))||!1,financing:V.leadLines.some(w=>w.toLowerCase().includes("financ")||w.toLowerCase().includes("payment")||w.toLowerCase().includes("loan"))||!1},x.value.tradeIn&&y&&(y.value.tradeIn=!0),x.value.financing&&y&&(y.value.financing=!0),x.value),k=()=>{$.value=!1,i.value=!1,l.value=0,a.value="",d.value={},m.value&&(clearInterval(m.value),m.value=null)};return Ga(()=>{m.value&&clearInterval(m.value)}),{isCallActive:$,callEnded:i,callDuration:l,callNotes:a,callData:d,extractedData:x,mockTranscription:V,formattedCallDuration:A,startCall:h,endCall:g,copyNumber:v,extractInformation:b,resetCall:k}}function gu(s,$,i,l,a,m){var Ye,lt,st;const d=T(!0),x=T(null),V=T(!1),A=T(!1),h=T(!1),g=T(""),v=T(null),b=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],k=T("whatsapp"),y=T("followup-1"),w=T(null),r=T(""),O=T("09:00"),N=T(null),U=T("Not Interested"),M=T(""),le=T({dealership:((lt=(Ye=s.value)==null?void 0:Ye.requestedCar)==null?void 0:lt.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((st=m==null?void 0:m.value)==null?void 0:st.id)||null}),R=T(null),E=T(null),G=T({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),z=C(()=>{var re,xe;if(!((re=s.value)!=null&&re.requestedCar))return null;const pe=(xe=s.value.requestedCar.condition)==null?void 0:xe.toLowerCase();return pe==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:pe==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),Q=T({tradeIn:!1,financing:!1,contactAvailability:!1}),de=T(!1),J=T(null),W=T(!0),j=T(null),ee=T(null),me=T("assign-and-schedule"),fe=T(""),$e=T(null),Re=T(""),Pe=T(null),gt=T(""),ht=T(""),ct=T(null),Z=T(""),ue=pe=>{Z.value=pe},nt=C(()=>{const pe=[];for(let re=9*60;re<=18*60;re+=30){const xe=String(Math.floor(re/60)).padStart(2,"0"),we=String(re%60).padStart(2,"0");pe.push(`${xe}:${we}`)}return pe}),at=C(()=>{if($e.value!=null)return $e.value;const pe=parseInt(Re.value,10);return Number.isFinite(pe)&&pe>0?pe:null}),mt=C(()=>{if(!Pe.value)return[];const pe=[],re=new Date;if(re.setHours(0,0,0,0),Pe.value==="tomorrow"){const xe=new Date(re);xe.setDate(xe.getDate()+1),xe.getDay()!==0&&xe.getDay()!==6&&pe.push(xe)}else if(Pe.value==="this-week"){const xe=re.getDay(),we=new Date(re);we.setDate(re.getDate()-(xe===0?6:xe-1));for(let De=0;De<5;De++){const Me=new Date(we);Me.setDate(we.getDate()+De),Me>=re&&pe.push(Me)}}else if(Pe.value==="custom"&&gt.value&&ht.value){const xe=new Date(gt.value),we=new Date(ht.value),De=new Date(xe);for(;De<=we;)De.getDay()!==0&&De.getDay()!==6&&pe.push(new Date(De)),De.setDate(De.getDate()+1)}return pe}),H=C(()=>{var we,De,Me,dt,Fe,Ae,Ve;const pe=((Me=(De=(we=s.value)==null?void 0:we.customer)==null?void 0:De.name)==null?void 0:Me.split(" ")[0])||"",re=((Fe=(dt=s.value)==null?void 0:dt.requestedCar)==null?void 0:Fe.brand)||"",xe=((Ve=(Ae=s.value)==null?void 0:Ae.requestedCar)==null?void 0:Ve.model)||"";return{"followup-1":`Hi ${pe}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${re} ${xe}?`,"followup-2":`Hello ${pe}, this is regarding your inquiry about the ${re} ${xe}. Please let me know when you're available for a call.`,custom:""}}),Y=C(()=>y.value==="custom"?"Type your custom message...":H.value[y.value]||""),te=C(()=>{var pe;return!!((pe=s.value)!=null&&pe.scheduledAppointment)}),X=()=>{const pe=new Date,re=pe.getHours(),xe=pe.getDay();let we=new Date,De="10:00",Me="";if(xe===5&&re>=15)we.setDate(pe.getDate()+3),De="10:00",Me="Optimal time after weekend, customer likely refreshed";else if(xe===6||xe===0)we.setDate(pe.getDate()+(xe===6?2:1)),De="10:00",Me="Weekend follow-up avoided, better response rate on weekdays";else if(re>=17)we.setDate(pe.getDate()+1),De="10:00",Me="Business hours preferred, higher engagement rate";else if(re<9)we=new Date(pe),we.setHours(10,0,0,0),De="10:00",Me="Peak response time, customers more available mid-morning";else if(re<14){we=new Date(pe);const Ae=re+2;we.setHours(Ae,0,0,0),De=`${String(Ae).padStart(2,"0")}:00`,Me="Follow-up within same day increases conversion likelihood"}else we.setDate(pe.getDate()+1),we.setHours(10,0,0,0),De="10:00",Me="Next morning follow-up maintains momentum";const dt=we.toISOString().split("T")[0],Fe=`${dt}T${De}:00`;return{date:dt,time:De,dateTime:Fe,reason:Me,formattedDate:we.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:d,selectedOutcome:x,showNoteModal:V,showScheduleAppointmentModal:A,followupChannels:b,followupChannel:k,selectedTemplate:y,rescheduleTime:w,customDate:r,customTime:O,disqualifyCategory:U,disqualifyReason:M,assignment:le,preferences:Q,surveyCompleted:de,surveyResponses:J,showSurvey:W,aiSuggestionData:N,showCallLogForm:h,callLogDateTime:g,callLogAssignee:v,qualificationSelectedTeam:R,qualificationSelectedSalesman:E,suggestedTeam:z,communicationPreferences:G,messageTemplates:H,messagePreview:Y,hasExistingAppointment:te,selectOutcome:pe=>{if(x.value=pe,!g.value){const re=new Date,xe=re.getFullYear(),we=String(re.getMonth()+1).padStart(2,"0"),De=String(re.getDate()).padStart(2,"0"),Me=String(re.getHours()).padStart(2,"0"),dt=String(re.getMinutes()).padStart(2,"0");g.value=`${xe}-${we}-${De}T${Me}:${dt}`}!v.value&&(m!=null&&m.value)&&(v.value=m.value),pe==="interested"&&(de.value=!1,J.value=null,W.value=!0,i!=null&&i.value&&(Q.value.tradeIn=i.value.tradeIn||!1,Q.value.financing=i.value.financing||!1))},cancelOutcome:()=>{x.value=null,h.value=!1},calculateNextCallDate:()=>{if(w.value==="tomorrow-9am"){const re=new Date;return re.setDate(re.getDate()+1),re.setHours(9,0,0,0),re.toISOString()}else if(w.value==="monday"){if(N.value)return new Date(N.value.dateTime).toISOString();const re=new Date,xe=(8-re.getDay())%7||7;return re.setDate(re.getDate()+xe),re.setHours(9,0,0,0),re.toISOString()}else if(w.value==="custom"&&r.value&&O.value)return new Date(`${r.value}T${O.value}:00`).toISOString();const pe=new Date;return pe.setDate(pe.getDate()+1),pe.setHours(9,0,0,0),pe.toISOString()},calculateAISuggestion:X,handleAISuggestionClick:()=>{w.value="monday",N.value=X()},resetOutcomeState:()=>{x.value=null,d.value=!0,k.value="whatsapp",y.value="followup-1",w.value=null,r.value="",O.value="09:00",U.value="Not Interested",M.value="",de.value=!1,J.value=null,W.value=!0,N.value=null,h.value=!1,g.value="",v.value=null,j.value=null,ee.value=null,me.value="assign-only",fe.value="",Pe.value=null,gt.value="",ht.value="",ct.value=null,Z.value="",R.value=null,E.value=null,$e.value=null,Re.value=""},initCallLogForm:(pe=!1)=>{if(j.value)return;const re=new Date,xe=re.getFullYear(),we=String(re.getMonth()+1).padStart(2,"0"),De=String(re.getDate()).padStart(2,"0"),Me=String(re.getHours()).padStart(2,"0"),dt=String(re.getMinutes()).padStart(2,"0");g.value=`${xe}-${we}-${De}T${Me}:${dt}`,m!=null&&m.value&&(v.value=m.value),h.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{h.value=!1,g.value="",v.value=null},clearSuccessState:()=>{j.value=null,ee.value=null},successState:j,successPerformedAt:ee,qualificationMethod:me,qualificationEventType:fe,qualificationDurationMinutes:$e,qualificationCustomDuration:Re,qualificationDateRange:Pe,qualificationCustomDateStart:gt,qualificationCustomDateEnd:ht,availableDatesForRange:mt,qualificationSelectedDate:ct,qualificationSelectedSlot:Z,setQualificationSelectedSlot:ue,qualificationScheduleSlotOptions:nt,qualificationDurationValue:at}}function yu(s,$,i,l,a,m,d,x,V=null){const{callData:A}=$,{showOutcomeSelection:h,selectedOutcome:g,assignment:v,preferences:b,cancelOutcome:k,calculateNextCallDate:y,showScheduleAppointmentModal:w,surveyCompleted:r,surveyResponses:O,showSurvey:N,initCallLogForm:U,callLogDateTime:M,callLogAssignee:le,successState:R,successPerformedAt:E,rescheduleTime:G,aiSuggestionData:z,customDate:Q,customTime:de,qualificationMethod:J,qualificationEventType:W,qualificationDurationValue:j,qualificationSelectedDate:ee,qualificationSelectedSlot:me,qualificationSelectedTeam:fe,qualificationSelectedSalesman:$e,communicationPreferences:Re}=i,Pe=()=>{var ie;return((ie=x==null?void 0:x.value)==null?void 0:ie.name)||"Unknown"},gt=()=>G.value==="tomorrow-9am"?"Tomorrow 9:00 AM":G.value==="monday"&&z.value?`${z.value.formattedDate} at ${z.value.time}`:G.value==="monday"?"Monday":G.value==="custom"&&Q.value&&de.value?`${Q.value} ${de.value}`:"selected time";return{logManualCall:()=>{A.value={channel:"external",notes:"",transcription:null},U(!0)},handleScheduleAppointmentConfirm:async ie=>{w.value=!1,s("appointment-scheduled",ie)},handleQualify:async()=>{var Ke,Ye,lt,st,pe,re,xe,we,De,Me,dt,Fe,Ae,Ve,je,Pt,Ht,yt,Qt,et,yn,Ze,ot,en,tn;const ie={timestamp:new Date().toISOString(),outcome:"interested",channel:((Ke=A.value)==null?void 0:Ke.channel)||"phone",notes:((Ye=A.value)==null?void 0:Ye.notes)||"",transcription:((lt=A.value)==null?void 0:lt.transcription)||null};s("call-attempt-logged",ie),s("validated",{scheduleFollowUp:!1});let ve="Unassigned";J.value==="assign-and-schedule"?$e.value?ve=$e.value.name:fe.value&&(ve=fe.value.name):ve=((pe=(st=v.value)==null?void 0:st.assignee)==null?void 0:pe.name)||"Unassigned";let ge=null,Te=!1,We=null;if(J.value==="assign-and-schedule"&&ee.value&&me.value){const Ge=ee.value,Be=Ge.toLocaleDateString(void 0,{month:"long",day:"numeric"}),it={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[W.value]||W.value;Te=!0;const rt=Ge.getFullYear(),nn=String(Ge.getMonth()+1).padStart(2,"0"),qn=String(Ge.getDate()).padStart(2,"0"),as=`${rt}-${nn}-${qn}`;if(We={datetime:Ge,date:as,time:me.value,type:it,assignee:ve,assigneeId:((re=$e.value)==null?void 0:re.id)||((xe=fe.value)==null?void 0:xe.id)||null,assigneeType:$e.value?"user":"team",duration:j.value,team:((we=fe.value)==null?void 0:we.name)||null,teamId:((De=fe.value)==null?void 0:De.id)||null,salesperson:((Me=$e.value)==null?void 0:Me.name)||null,salespersonId:((dt=$e.value)==null?void 0:dt.id)||null},ge={date:Be,time:me.value,title:it,name:((Ae=(Fe=l.value)==null?void 0:Fe.customer)==null?void 0:Ae.name)||"",location:ve},s("appointment-scheduled",We),Re.value){const bt=Re.value;if((Ve=bt.immediateConfirmation)!=null&&Ve.enabled&&((Pt=(je=bt.immediateConfirmation)==null?void 0:je.channels)==null?void 0:Pt.length)>0){for(const ft of bt.immediateConfirmation.channels)if(d&&((Ht=l.value)!=null&&Ht.id))try{await d.addActivity(l.value.id,{type:ft,user:Pe(),action:`sent ${ft} confirmation`,content:`Appointment confirmed: ${it} on ${Be} at ${me.value}`,timestamp:new Date().toISOString()})}catch(Mt){console.error(`Failed to log ${ft} confirmation:`,Mt)}}if((yt=bt.reminder)!=null&&yt.enabled&&((et=(Qt=bt.reminder)==null?void 0:Qt.channels)==null?void 0:et.length)>0){const ft=new Date(Ge);ft.setDate(ft.getDate()-1);const Mt=ft.toISOString().split("T")[0];if(d&&((yn=l.value)!=null&&yn.id))try{await d.addActivity(l.value.id,{type:"reminder-scheduled",user:Pe(),action:"scheduled reminder",content:`Reminder scheduled for ${Mt} via ${bt.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:Mt,channels:bt.reminder.channels}})}catch(Ee){console.error("Failed to schedule reminder:",Ee)}}if((Ze=bt.salespersonNotification)!=null&&Ze.enabled){const ft=((ot=$e.value)==null?void 0:ot.name)||((en=fe.value)==null?void 0:en.name)||"Team";if(d&&((tn=l.value)!=null&&tn.id))try{await d.addActivity(l.value.id,{type:"notification",user:Pe(),action:"sent notification",content:`Notification sent to ${ft} about appointment`,timestamp:new Date().toISOString()})}catch(Mt){console.error("Failed to send notification:",Mt)}}}}J.value==="assign-and-schedule"&&($e.value?v.value={...v.value,assignee:{...$e.value,type:"user"},assigneeId:$e.value.id,salesperson:$e.value}:fe.value&&(v.value={...v.value,assignee:{...fe.value,type:"team"},team:fe.value}));const _e=J.value==="assign-and-schedule"?{assignee:$e.value||fe.value,salesperson:$e.value||null,team:fe.value||null}:v.value;let Se=null;if(V!=null&&V.value){const Ge=V.value;Se={interestLevel:Ge.interestLevel,purchaseTimeline:Ge.purchaseTimeline,budgetRange:Ge.budgetRange,hasTradeIn:Ge.hasTradeIn,tradeInModel:Ge.tradeInModel,financingOption:Ge.financingOption,additionalNotes:Ge.additionalNotes}}else r.value&&O.value&&(Se=O.value);s("qualified",{assignment:_e,preferences:b.value,scheduleAppointment:Te,appointmentData:We,surveyData:Se});let He=`Qualified - Assigned to ${ve}`;ge&&(He=`Qualified - Assigned to ${ve}, meeting on ${ge.date} ${ge.time}`),R.value={kind:"qualified",statusText:He,meeting:ge,actorName:Pe()},E.value=new Date,k()},handleDisqualifyFromInterested:()=>{var ve,ge,Te;const ie={timestamp:new Date().toISOString(),outcome:"interested",channel:((ve=A.value)==null?void 0:ve.channel)||"phone",notes:((ge=A.value)==null?void 0:ge.notes)||"",transcription:((Te=A.value)==null?void 0:Te.transcription)||null};s("call-attempt-logged",ie),g.value="not-valid"},handleNoAnswerConfirm:async()=>{var _e,Se,He,Ke;const ie={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((_e=A.value)==null?void 0:_e.channel)||"phone",notes:((Se=A.value)==null?void 0:Se.notes)||"",transcription:((He=A.value)==null?void 0:He.transcription)||null};s("call-attempt-logged",ie);const ve=y(),ge=ve.split("T")[0],Te=new Date(ve).toTimeString().slice(0,5);if(d&&((Ke=l.value)!=null&&Ke.id))try{await d.updateLead(l.value.id,{nextActionDue:ve,status:"Pending"})}catch(Ye){console.error('Failed to update lead status to "to be called back":',Ye)}s("postponed",{date:ge,time:Te,createAppointment:!0}),(a==null?void 0:a.value)+1>=(m==null?void 0:m.value)&&s("disqualified",{category:"Not Interested",reason:"Unreachable"});const We=gt();R.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${We}`,actorName:Pe()},E.value=new Date,k()},handleNotValidConfirm:()=>{var ve,ge,Te;const ie={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((ve=A.value)==null?void 0:ve.channel)||"phone",notes:((ge=A.value)==null?void 0:ge.notes)||"",transcription:((Te=A.value)==null?void 0:Te.transcription)||null};s("call-attempt-logged",ie),s("disqualified",{category:i.disqualifyCategory.value,reason:i.disqualifyReason.value}),R.value={kind:"not-interested",statusText:"Closed - Not interested",reason:i.disqualifyReason.value||null,actorName:Pe()},E.value=new Date,k()},handleNoteSave:ie=>{i.showNoteModal.value=!1,s("note-saved",ie)},handleSurveyCompleted:async ie=>{var ve;if(O.value=ie,r.value=!0,N.value=!1,d&&((ve=l.value)!=null&&ve.id))try{await d.addActivity(l.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ie),timestamp:new Date().toISOString()})}catch(ge){console.error("Failed to save survey activity:",ge)}s("survey-completed",{lead:l.value,responses:ie})},handleSurveyRefused:async()=>{var ie;if(N.value=!1,d&&((ie=l.value)!=null&&ie.id))try{await d.addActivity(l.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(ve){console.error("Failed to save survey refusal activity:",ve)}s("survey-refused",{lead:l.value})},handleNotResponding:async()=>{var ie;if(N.value=!1,d&&((ie=l.value)!=null&&ie.id))try{await d.addActivity(l.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(ve){console.error("Failed to save survey not responding activity:",ve)}s("not-responding",{lead:l.value})},handleReopen:()=>{i.clearSuccessState(),i.resetOutcomeState()}}}const bu=["disabled"],hu={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:s=>["small","medium"].includes(s)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(s){return($,i)=>(p(),S("button",{class:se(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",s.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",s.size==="small"?"px-3 py-1.5 text-xs":"px-4 py-2 text-sm"]),disabled:s.disabled,style:{background:"linear-gradient(135deg, #6B21A8, #9333EA, #A855F7)"},onClick:i[0]||(i[0]=l=>$.$emit("click",l))},[n(t(ai),{size:s.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,F(s.label),1)],10,bu))}},xu={key:0,class:"flex gap-2 items-center mb-4"},wu={key:1,class:"mb-4 space-y-4"},ku={key:0,class:"bg-slate-900 text-white rounded-lg"},Su={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},Cu={class:"flex items-center gap-2"},$u={class:"text-xs font-bold uppercase tracking-wider"},Du={class:"flex items-center gap-3"},Au={class:"flex items-center gap-2 text-red-400"},Ou={class:"text-xs font-mono"},Tu={class:"text-xs font-mono text-red-200"},Iu={key:0,class:"p-4 space-y-4"},Vu={key:0,class:"space-y-1"},Nu={class:"space-y-3 text-sm font-mono"},Fu={class:"ml-2"},Uu={class:"ml-2"},qu={key:0},Lu={class:"ml-2"},Pu={key:1},Mu={class:"ml-2"},Eu={key:2},Ru={class:"ml-2"},ju={key:1,class:"pt-4 border-t border-slate-700"},Bu=["model-value"],zu={key:1,class:"bg-blue-50 rounded-lg p-4"},Wu={class:"flex items-center justify-between"},Yu={class:"flex gap-2"},ol={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0},hideButton:{type:Boolean,default:!1}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(s){const $=s,i=T(!1);return ye(()=>$.isCallActive,(l,a)=>{if(l&&!a){i.value=!1;return}l||(i.value=!1)}),(l,a)=>(p(),S("div",null,[!s.hideButton&&!s.isCallActive?(p(),S("div",xu,[n(t(_),{variant:"default",disabled:s.isCallActive,class:"inline-flex items-center gap-2",onClick:a[0]||(a[0]=m=>l.$emit("start-call"))},{default:o(()=>[n(t(Ho),{size:16,class:"shrink-0","aria-hidden":"true"}),D(" "+F(s.contactAttempts>0?"Call Again":"Initiate Call"),1)]),_:1},8,["disabled"])])):q("",!0),s.isCallActive||s.callEnded?(p(),S("div",wu,[s.isCallActive||s.callEnded?(p(),S("div",ku,[e("div",Su,[e("div",Cu,[a[6]||(a[6]=e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"},null,-1)),e("span",$u,F(s.isCallActive?"TRANSCRIBING":"CALL SUMMARY"),1)]),e("div",Du,[s.isCallActive?(p(),S(be,{key:0},[e("div",Au,[a[7]||(a[7]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ou,"REC "+F(s.formattedCallDuration),1)]),e("button",{onClick:a[1]||(a[1]=m=>l.$emit("end-call")),class:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg flex items-center gap-2 transition-colors cursor-pointer"},[...a[8]||(a[8]=[e("i",{class:"fa-solid fa-stop text-xs cursor-pointer"},null,-1),D(" Stop Call ",-1)])]),e("button",{type:"button",class:"flex items-center justify-center px-3 h-8 rounded-btn border border-slate-600 bg-slate-800/80 hover:bg-slate-700 cursor-pointer",onClick:a[2]||(a[2]=m=>i.value=!i.value)},[e("i",{class:se(["fa-solid text-xs cursor-pointer",i.value?"fa-chevron-up":"fa-chevron-down"])},null,2)])],64)):(p(),S(be,{key:1},[e("span",Tu," Call duration "+F(s.formattedCallDuration),1),e("button",{type:"button",class:"px-3 h-8 rounded-btn border border-slate-600 bg-slate-800/80 hover:bg-slate-700 text-xs font-semibold cursor-pointer",onClick:a[3]||(a[3]=m=>i.value=!i.value)}," See transcription ")],64))])]),i.value?(p(),S("div",Iu,[s.callEnded&&!s.isCallActive?(p(),S("div",Vu,[...a[9]||(a[9]=[e("h4",{class:"text-xs font-bold uppercase tracking-wider text-slate-300"},"Summary",-1),e("p",{class:"text-sm text-slate-100"}," Lead confirmed their details and the call covered the main inquiry discussed in the transcript below. ",-1)])])):q("",!0),e("div",Nu,[e("div",null,[a[10]||(a[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Fu,F(s.mockTranscription.leadLines[0]),1)]),e("div",null,[a[11]||(a[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Uu,F(s.mockTranscription.salesLines[0]),1)]),s.callDuration>=5?(p(),S("div",qu,[a[12]||(a[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Lu,F(s.mockTranscription.leadLines[1]),1)])):q("",!0),s.callDuration>=8?(p(),S("div",Pu,[a[13]||(a[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Mu,F(s.mockTranscription.salesLines[1]),1)])):q("",!0),s.callDuration>=12?(p(),S("div",Eu,[a[14]||(a[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ru,F(s.mockTranscription.leadLines[2]),1)])):q("",!0)]),s.isCallActive?(p(),S("div",ju,[e("textarea",{"model-value":s.callNotes,"onUpdate:modelValue":a[4]||(a[4]=m=>l.$emit("update:call-notes",m)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Bu)])):q("",!0)])):q("",!0)])):q("",!0),s.callEnded&&!s.isCallActive?(p(),S("div",zu,[e("div",Wu,[a[15]||(a[15]=e("div",null,[e("h4",{class:"font-bold text-foreground mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",Yu,[n(hu,{label:"Extract information",size:"small",onClick:a[5]||(a[5]=m=>l.$emit("extract-information"))})])])])):q("",!0)])):q("",!0)]))}},Hu={class:"flex items-center gap-2.5 min-w-0"},Qu={class:"flex items-center gap-2 min-w-0"},il={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(s,{emit:$}){const i=s,l=$,a=T(!1),m=C(()=>Qo(i.nextActionDue)),d=C(()=>m.value.type==="overdue"?qa:m.value.type==="urgent"?fi:qa),x=C(()=>i.isClosed||!i.showDeadlineBanner||a.value?!1:m.value.type==="overdue"||m.value.type==="urgent"),V=()=>{a.value=!0,l("dismissed")};return(A,h)=>x.value?(p(),S("div",{key:0,class:se(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[m.value.bgClass,m.value.borderClass]])},[e("div",Hu,[e("div",{class:se(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",m.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(p(),K(Qs(d.value),{size:12,class:se(m.value.textClass)},null,8,["class"]))],2),e("div",Qu,[e("span",{class:se(["text-xs font-bold uppercase tracking-wider",m.value.textClass])},F(m.value.type==="overdue"?"Overdue":"Urgent"),3),h[0]||(h[0]=e("span",{class:"text-xs text-muted-foreground opacity-30"},"•",-1)),e("span",{class:se(["text-xs font-medium truncate",m.value.textClass])}," Next Action: "+F(t(Go)(s.nextActionDue)),3)])]),e("button",{onClick:V,class:se(["p-1 rounded-md transition-colors shrink-0",[m.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[n(t(za),{size:14})],2)],2)):q("",!0)}},Gu={class:"bg-white rounded-lg p-4 shadow-nsc-card"},_u={class:"space-y-4"},Ju={class:"flex items-center gap-3"},Ku={class:"flex items-center gap-3"},Zu={class:"text-sm font-medium text-foreground"},rl={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(s,{emit:$}){const i=$,l=[{value:"email",label:"via Email"},{value:"sms",label:"via SMS"},{value:"whatsapp",label:"via WhatsApp"}],a=T({immediateConfirmationEnabled:!0,immediateConfirmationChannels:["email"],reminderEnabled:!0,reminderChannels:["email"],salespersonNotification:!0});return ye(a,m=>{var x,V;const d={immediateConfirmation:{enabled:m.immediateConfirmationEnabled,channels:m.immediateConfirmationEnabled&&((x=m.immediateConfirmationChannels)==null?void 0:x.length)>0?m.immediateConfirmationChannels:[]},reminder:{enabled:m.reminderEnabled,channels:m.reminderEnabled&&((V=m.reminderChannels)==null?void 0:V.length)>0?m.reminderChannels:[]},salespersonNotification:{enabled:m.salespersonNotification}};i("update",d)},{deep:!0}),(m,d)=>(p(),S("div",Gu,[d[7]||(d[7]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Send confirmations and reminders",-1)),e("div",_u,[e("div",Ju,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"immediate-confirmation",modelValue:a.value.immediateConfirmationEnabled,"onUpdate:modelValue":d[0]||(d[0]=x=>a.value.immediateConfirmationEnabled=x)},null,8,["modelValue"]),d[5]||(d[5]=e("span",{class:"text-sm font-medium text-foreground"},"Send immediate confirmation to customer",-1))]),_:1}),a.value.immediateConfirmationEnabled?(p(),K(t(vt),{key:0,modelValue:a.value.immediateConfirmationChannels,"onUpdate:modelValue":d[1]||(d[1]=x=>a.value.immediateConfirmationChannels=x),items:l,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):q("",!0)]),e("div",Ku,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"reminder",modelValue:a.value.reminderEnabled,"onUpdate:modelValue":d[2]||(d[2]=x=>a.value.reminderEnabled=x)},null,8,["modelValue"]),d[6]||(d[6]=e("span",{class:"text-sm font-medium text-foreground"},"Send reminder the day before appointment",-1))]),_:1}),a.value.reminderEnabled?(p(),K(t(vt),{key:0,modelValue:a.value.reminderChannels,"onUpdate:modelValue":d[3]||(d[3]=x=>a.value.reminderChannels=x),items:l,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):q("",!0)]),n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors"},{default:o(()=>[n(t(zt),{id:"salesperson-notification",modelValue:a.value.salespersonNotification,"onUpdate:modelValue":d[4]||(d[4]=x=>a.value.salespersonNotification=x)},null,8,["modelValue"]),e("span",Zu," Notify "+F(s.salesperson?s.salesperson.name:s.team?s.team.name:"salesperson")+" about appointment ",1)]),_:1})]),Ft(m.$slots,"actions")]))}},Xu={class:"bg-white rounded-lg p-4 shadow-nsc-card"},ks={__name:"CloseAsLostForm",props:{showMultipleNoShows:{type:Boolean,default:!1},preselectedReason:{type:String,default:""},closeButtonLabel:{type:String,default:"Close"}},emits:["close","cancel","update:reason"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(l.preselectedReason||"");ye(()=>l.preselectedReason,V=>{V&&(m.value=V)}),ye(m,V=>{a("update:reason",V)});const d=C(()=>!!m.value);function x(){d.value&&a("close",m.value)}return $({reason:m,canSubmit:d,submit:x}),(V,A)=>(p(),S("div",Xu,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...A[1]||(A[1]=[D("Reason",-1)])]),_:1}),n(t($t),{modelValue:m.value,"onUpdate:modelValue":A[0]||(A[0]=h=>m.value=h)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select a reason..."})]),_:1}),n(t(Ct),null,{default:o(()=>[s.showMultipleNoShows?(p(),K(t(he),{key:0,value:"Multiple no shows"},{default:o(()=>[...A[2]||(A[2]=[D("Multiple no shows",-1)])]),_:1})):q("",!0),n(t(he),{value:"Data cleanup"},{default:o(()=>[...A[3]||(A[3]=[D("Data cleanup",-1)])]),_:1}),n(t(he),{value:"Unreachable"},{default:o(()=>[...A[4]||(A[4]=[D("Unreachable",-1)])]),_:1}),n(t(he),{value:"Purchase postponed"},{default:o(()=>[...A[5]||(A[5]=[D("Purchase postponed",-1)])]),_:1}),n(t(he),{value:"Vehicle sold"},{default:o(()=>[...A[6]||(A[6]=[D("Vehicle sold",-1)])]),_:1}),n(t(he),{value:"Out of budget"},{default:o(()=>[...A[7]||(A[7]=[D("Out of budget",-1)])]),_:1}),n(t(he),{value:"Financing rejected"},{default:o(()=>[...A[8]||(A[8]=[D("Financing rejected",-1)])]),_:1}),n(t(he),{value:"Duplicate"},{default:o(()=>[...A[9]||(A[9]=[D("Duplicate",-1)])]),_:1}),n(t(he),{value:"Bought elsewhere"},{default:o(()=>[...A[10]||(A[10]=[D("Bought elsewhere",-1)])]),_:1}),n(t(he),{value:"Not interested"},{default:o(()=>[...A[11]||(A[11]=[D("Not interested",-1)])]),_:1}),n(t(he),{value:"Budget constraints"},{default:o(()=>[...A[12]||(A[12]=[D("Budget constraints",-1)])]),_:1}),n(t(he),{value:"Found better price"},{default:o(()=>[...A[13]||(A[13]=[D("Found better price at competitor",-1)])]),_:1}),n(t(he),{value:"No response"},{default:o(()=>[...A[14]||(A[14]=[D("Customer not responding",-1)])]),_:1}),n(t(he),{value:"Wrong timing"},{default:o(()=>[...A[15]||(A[15]=[D("Timing not right",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...A[16]||(A[16]=[D("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}},ed={class:"rounded-lg flex flex-col bg-muted"},td={class:"pt-1 px-1"},nd={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative"},sd={class:"flex items-center gap-3"},ad={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},ld={class:"flex-1 pr-10 min-w-0"},od={class:"text-sm font-medium text-foreground"},id={key:0,class:"text-sm text-muted-foreground mt-1"},rd={key:0,class:"mt-4 bg-white rounded-lg shadow-nsc-card overflow-hidden"},ud={class:"grid grid-cols-2 gap-3 p-4 text-sm"},dd={class:"ml-2 font-medium text-foreground"},cd={class:"ml-2 font-medium text-foreground"},md={class:"ml-2 font-medium text-foreground capitalize"},fd={class:"ml-2 font-medium text-foreground"},pd={class:"flex justify-end mt-4"},vd={class:"px-4 py-2 flex items-center justify-between text-sm text-muted-foreground"},gd={class:"tabular-nums"},yd={class:"pt-1 px-1"},bd={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden"},hd={class:"p-4"},xd={class:"flex justify-between items-start mb-3"},wd={class:"text-base leading-normal font-medium text-foreground"},kd={class:"text-sm leading-normal font-normal text-muted-foreground mt-0.5"},Sd={key:0,class:"mb-3 bg-muted border border-border rounded-lg p-3"},Cd={class:"flex items-center justify-between gap-4 flex-wrap"},$d={key:0,class:"flex items-center gap-2"},Dd={class:"flex items-center gap-2"},Ad={class:"text-sm text-muted-foreground"},Od={key:1,class:"flex items-center gap-2"},Td={class:"text-sm font-semibold text-foreground"},Id={key:0,class:"text-sm text-orange-600 font-medium flex items-center gap-1 ml-2"},Vd={class:"px-4 py-4 space-y-3"},Nd={key:0,class:"space-y-4"},Fd={class:"outcome-toggle-group flex flex-wrap gap-3"},Ud={key:0,class:"space-y-4"},qd={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Ld={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Pd={class:"followup-channel-toggle-group flex flex-wrap gap-2 mb-4"},Md={key:0,class:"space-y-3"},Ed=["value"],Rd={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},jd={class:"reschedule-toggle-group flex flex-wrap gap-2"},Bd={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},zd={class:"flex items-start gap-2"},Wd={class:"flex-1"},Yd={class:"text-sm font-semibold text-foreground mb-1"},Hd={class:"text-xs text-muted-foreground"},Qd={key:1,class:"mt-3 grid grid-cols-2 gap-3"},Gd={key:1,class:"space-y-4"},_d={class:"bg-white rounded-lg p-4 shadow-nsc-card"},Jd={key:2,class:"space-y-4"},Kd={class:"bg-white rounded-lg p-4 shadow-nsc-card"},Zd={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Xd={class:"space-y-4"},ec={class:"flex gap-4"},tc={class:"space-y-2"},nc={class:"flex items-center gap-2 cursor-pointer"},sc={class:"flex justify-end gap-2 mt-4"},ac={class:"bg-white rounded-lg p-4 shadow-nsc-card"},lc={class:"space-y-2"},oc={key:0,class:"space-y-4"},ic={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},rc={class:"grid grid-cols-2 gap-4"},uc={class:"flex items-center gap-2"},dc={class:"text-muted-foreground"},cc={class:"font-medium text-foreground"},mc={class:"flex items-center gap-2"},fc={class:"font-medium text-foreground"},pc={key:1,class:"space-y-4"},vc={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},gc={key:0,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},yc={class:"grid grid-cols-2 gap-4"},bc={class:"flex items-center gap-2"},hc={class:"text-muted-foreground"},xc={class:"font-medium text-foreground"},wc={class:"flex items-center gap-2"},kc={class:"font-medium text-foreground"},Sc={key:1,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Cc={class:"font-semibold text-foreground text-sm mb-4"},$c={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden"},Dc={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},Ac={class:"p-6"},Oc={class:"flex items-center justify-between mb-4"},Tc={class:"text-sm font-semibold text-foreground"},Ic={class:"grid grid-cols-7 gap-1 mb-2"},Vc={class:"grid grid-cols-7 gap-1"},Nc=["onClick"],Fc={class:"p-6"},Uc={class:"text-sm font-semibold text-foreground mb-4"},qc={key:0,class:"schedule-slot-toggle-group flex flex-col gap-2 w-full space-y-2"},Lc={key:1,class:"text-sm text-muted-foreground py-4 text-center"},Pc={key:2,class:"text-sm text-muted-foreground py-4 text-center"},Mc={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Ec={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Rc={class:"ml-2 font-medium text-foreground"},jc={class:"ml-2 font-medium text-foreground"},Bc={class:"ml-2 font-medium text-foreground capitalize"},zc={class:"ml-2 font-medium text-foreground"},Wc={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Yc={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(s,{emit:$}){const{t:i}=ts(),l=s,a=$,m=gn(),d=Yt();xs();const x=Sn(),V=tl(()=>l.lead,{}),A=ll(),{isCallActive:h,callEnded:g,callDuration:v,callNotes:b,callData:k,extractedData:y,mockTranscription:w,formattedCallDuration:r,startCall:O,endCall:N,copyNumber:U}=A,M=T(null),le=T(!1),R=T(!1),E=T(!1),G=T(!1),z=C(()=>m.assignableUsers),Q=C(()=>m.assignableTeams),de=C(()=>d.currentUser),J=T({interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}),W=T(""),j=T(""),ee=T(""),me=T("");C(()=>{var f;const L=new Set;return(f=Q.value)==null||f.forEach(ae=>{ae.dealership&&L.add(ae.dealership)}),Array.from(L).sort()}),C(()=>{var L;return W.value?((L=Q.value)==null?void 0:L.filter(f=>f.dealership===W.value))||[]:Q.value||[]}),C(()=>{var f,ae;if(!j.value)return z.value||[];const L=(f=Q.value)==null?void 0:f.find(P=>P.id===j.value);return L?((ae=z.value)==null?void 0:ae.filter(P=>P.team===L.name||P.teamId===L.id))||[]:z.value||[]});const fe=L=>L?L.split(" ").map(f=>f[0]).join("").toUpperCase().substring(0,2):"?",$e=L=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[L]||"bg-muted text-muted-foreground",Re=L=>{Ye.value.assignee=L,L.type==="team"&&(It.value=null),le.value=!1};C(()=>!!Pt.value),C(()=>{if(et.value)return et.value.statusText;const L=l.activities.filter(f=>f.type==="call"||f.type==="outcome").sort((f,ae)=>new Date(ae.timestamp)-new Date(f.timestamp))[0];return L?L.outcome||L.content||"Outcome logged":null});const Pe=async()=>{var L;try{const f=J.value,ae=[];if(f.interestLevel&&ae.push(`Interest level: ${f.interestLevel}`),f.purchaseTimeline&&ae.push(`Purchase timeline: ${f.purchaseTimeline}`),f.budgetRange&&ae.push(`Budget range: ${f.budgetRange}`),f.hasTradeIn&&f.tradeInModel&&ae.push(`Trade-in: ${f.tradeInModel}`),f.financingOption){const Ne={FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"};ae.push(`Financing: ${Ne[f.financingOption]||f.financingOption}`)}f.additionalNotes&&ae.push(f.additionalNotes);const P=ae.join(`
`);if(P.trim()&&(await x.addActivity(l.lead.id,{type:"note",user:((L=de.value)==null?void 0:L.name)||"You",action:"enriched lead information",content:P,timestamp:new Date().toISOString()}),a("note-saved",{type:"note",content:P,timestamp:new Date().toISOString(),enrichData:{...f}})),f.interestLevel||f.purchaseTimeline||f.budgetRange){const Ne={interestLevel:f.interestLevel,purchaseTimeline:f.purchaseTimeline,budgetRange:f.budgetRange};await x.addActivity(l.lead.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(Ne),timestamp:new Date().toISOString()}),a("survey-completed",{lead:l.lead,responses:Ne})}J.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}}catch(f){console.error("Error saving enriched lead data:",f)}},gt=()=>{O(),Qt(!1)},ht=()=>{U(l.lead.customer.phone)},ct=L=>{b.value=L},Z=C(()=>{var L;return((L=V.primaryAction.value)==null?void 0:L.title)||"Call to Verify Contact Details"}),ue=C(()=>{var L;return((L=V.primaryAction.value)==null?void 0:L.description)||"Begin lead qualification by verifying customer contact information."});C(()=>l.lead.scheduledAppointment?new Date(l.lead.scheduledAppointment.start)<new Date:!1);const nt=C(()=>!!l.lead.scheduledAppointment),at=V.contactAttempts,mt=V.maxContactAttempts,H=gu(es(l,"lead"),k,y,at,mt,de),{showOutcomeSelection:Y,selectedOutcome:te,showNoteModal:X,showScheduleAppointmentModal:ie,followupChannels:ve,followupChannel:ge,selectedTemplate:Te,rescheduleTime:We,customDate:_e,customTime:Se,disqualifyCategory:He,disqualifyReason:Ke,assignment:Ye,preferences:lt,messageTemplates:st,messagePreview:pe,hasExistingAppointment:re,selectOutcome:xe,cancelOutcome:we,calculateNextCallDate:De,surveyCompleted:Me,surveyResponses:dt,showSurvey:Fe,aiSuggestionData:Ae,handleAISuggestionClick:Ve,callLogDateTime:je,callLogAssignee:Pt,confirmCallLogForm:Ht,cancelCallLogForm:yt,initCallLogForm:Qt,successState:et,successPerformedAt:yn,qualificationMethod:Ze,qualificationEventType:ot,qualificationDurationMinutes:en,qualificationCustomDuration:tn,qualificationCalendarMonth:Ge,qualificationSelectedDate:Be,qualificationSelectedSlot:it,setQualificationSelectedSlot:rt,qualificationDateRange:nn,qualificationCustomDateStart:qn,qualificationCustomDateEnd:as,availableDatesForRange:bt,qualificationScheduleSlotOptions:ft,qualificationDurationValue:Mt,qualificationSelectedTeam:Ee,qualificationSelectedSalesman:It,suggestedTeam:Ln,communicationPreferences:sn}=H;function an(L){ge.value=L}function ln(L){if(!L){We.value=null;return}L==="monday"?Ve():We.value=L}function bn(L){Ke.value=L}const jt=L=>{sn.value=L},Et=C(()=>{if(!Be.value)return[];const L=Be.value.toISOString().split("T")[0];if(It.value){const f=kn(`user-${It.value.id}`,L);return ft.value.filter(ae=>f.includes(ae))}if(Ee.value){const f=kn(`team-${Ee.value.id}`,L);return ft.value.filter(ae=>f.includes(ae))}return ft.value||[]});ye(Be,()=>{it.value=""}),C(()=>l.activities.filter(L=>L.type==="note"));const Bt=C(()=>(Q.value||[]).slice(0,3)),Pn=C(()=>{if(!Q.value)return[];const L=[...Q.value];if(Ee.value){const f=L.findIndex(ae=>ae.id===Ee.value.id);if(f>0){const ae=L.splice(f,1)[0];L.unshift(ae)}}return L}),Rt=C(()=>Pn.value.map(L=>({...L,label:`${L.dealership||"No location"} → ${L.name}`,value:L.id}))),on=C(()=>{var ae;if(!Ee.value)return[];const L=Ee.value;return(((ae=z.value)==null?void 0:ae.filter(P=>P.team===L.name||P.teamId===L.id))||[]).map(P=>({...P,label:P.name,value:P.id}))}),Gt=C({get:()=>{var L;return((L=Ee.value)==null?void 0:L.id)||null},set:L=>{var ae;if(!L){Ee.value=null;return}const f=(ae=Q.value)==null?void 0:ae.find(P=>P.id===L);Ee.value=f||null}}),Vt=C({get:()=>{var L;return((L=It.value)==null?void 0:L.id)||null},set:L=>{if(!L){It.value=null;return}const f=on.value.find(ae=>ae.id===L);It.value=f||null}});function rn(){if(!ot.value||Ee.value)return;const L=Q.value;if(!(L!=null&&L.length))return;const f=Ln.value;if(f){const ae=L.find(P=>P.id===f.id);if(ae){Ee.value=ae;return}}if(l.lead.assignee){const ae=L.find(P=>P.name===l.lead.assignee);ae&&(Ee.value=ae)}}ye(()=>[ot.value,Ln.value,(Q.value??[]).length,l.lead.assignee],()=>{rn()},{immediate:!0}),ye(()=>ot.value&&!Ee.value,L=>{L&&_a(rn)},{immediate:!0}),ye(ot,L=>{if(L&&!Be.value){const f=new Date;f.setHours(0,0,0,0),Be.value=f,pt.value=f.getMonth(),xt.value=f.getFullYear(),it.value=""}},{immediate:!0}),ye(te,L=>{var f,ae,P;if(L==="interested"&&Ze.value==="assign-only"&&!((f=Ye.value)!=null&&f.assignee))if(l.lead.assignee){const Ie=(ae=z.value)==null?void 0:ae.find(_t=>_t.name===l.lead.assignee),Ne=(P=Q.value)==null?void 0:P.find(_t=>_t.name===l.lead.assignee);Ie?Ye.value={...Ye.value,assignee:{...Ie,type:"user"}}:Ne&&(Ye.value={...Ye.value,assignee:{...Ne,type:"team"}})}else Bt.value.length>0&&(Ye.value={...Ye.value,assignee:{...Bt.value[0],type:"team"}})}),ye(()=>{var L;return(L=Ye.value)==null?void 0:L.assignee},L=>{(L==null?void 0:L.type)!=="team"&&(It.value=null)}),ye(Ee,L=>{It.value=null,L&&ot.value&&un(`team-${L.id}`)}),ye(It,L=>{L?un(`user-${L.id}`):Ee.value&&un(`team-${Ee.value.id}`)}),ye(Be,()=>{it.value=""});const un=L=>{const f=new Date;f.setHours(0,0,0,0);for(let ae=0;ae<30;ae++){const P=new Date(f);if(P.setDate(f.getDate()+ae),P.getDay()===0||P.getDay()===6)continue;const Ie=P.toISOString().split("T")[0],Ne=kn(L,Ie);if(Ne&&Ne.length>0){Be.value=P,pt.value=P.getMonth(),xt.value=P.getFullYear(),setTimeout(()=>{const _t=ft.value.filter(Us=>Ne.includes(Us));_t.length>0&&(it.value=_t[0])},0);break}}},$n=C(()=>!(te.value!=="no-answer"||!ge.value||ge.value!=="dont-send"&&!Te.value||!We.value||We.value==="custom"&&(!_e.value||!Se.value)));ye(te,L=>{L!=="interested"&&(J.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""},W.value="",j.value="",ee.value="")}),ye(ee,L=>{var f,ae;if(L){const P=(f=z.value)==null?void 0:f.find(Ie=>Ie.id===L);if(P){const Ie=(ae=Q.value)==null?void 0:ae.find(Ne=>Ne.name===P.team||Ne.id===P.teamId);Ie&&(j.value=Ie.id,Ie.dealership&&(W.value=Ie.dealership))}}}),ye(j,L=>{var f,ae;if(L&&ee.value){const P=(f=z.value)==null?void 0:f.find(Ne=>Ne.id===ee.value),Ie=(ae=Q.value)==null?void 0:ae.find(Ne=>Ne.id===L);P&&Ie&&P.team!==Ie.name&&P.teamId!==Ie.id&&(ee.value="")}}),ye(W,L=>{var f;if(L&&j.value){const ae=(f=Q.value)==null?void 0:f.find(P=>P.id===j.value);ae&&ae.dealership!==L&&(j.value="",ee.value="")}}),ye(g,L=>{L&&!et.value&&Qt(!1)});const Dn=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],Mn=C(()=>Dn.map(L=>({value:L.value,label:L.label}))),pt=T(new Date().getMonth()),xt=T(new Date().getFullYear()),En=["MON","TUE","WED","THU","FRI","SAT","SUN"],Rn=C(()=>new Date(xt.value,pt.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),dn=C(()=>{const L=new Date(xt.value,pt.value,1),ae=new Date(xt.value,pt.value+1,0).getDate(),P=L.getDay()===0?6:L.getDay()-1,Ie=[];for(let Ne=0;Ne<P;Ne++)Ie.push(null);for(let Ne=1;Ne<=ae;Ne++)Ie.push(Ne);return Ie}),ls=C(()=>{if(!Be.value)return i("forms.schedule.timeSlots.selectDate");const L=Be.value,f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${f[L.getDay()]}, ${ae[L.getMonth()]} ${L.getDate()}`}),os=L=>{if(!L||!Be.value)return!1;const f=Be.value;return f.getDate()===L&&f.getMonth()===pt.value&&f.getFullYear()===xt.value},is=L=>{if(!L)return;const f=new Date(xt.value,pt.value,L);Be.value=f,it.value=""},Cs=()=>{pt.value===0?(pt.value=11,xt.value--):pt.value--},rs=()=>{pt.value===11?(pt.value=0,xt.value++):pt.value++},Nt={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},Le=L=>{en.value=L,tn.value=""};ye(tn,L=>{L&&(en.value=null)}),ye(ot,L=>{if(!L)return;const f=Nt[L];f&&(f===15?Le(15):f===30?Le(30):f===60?Le(60):(en.value=null,tn.value=f.toString()))});const cn=C(()=>Ze.value==="assign-only"?!!(ot.value&&Ee.value):!!(ot.value&&Mt.value&&Be.value&&it.value&&Ee.value)),jn=C(()=>!!Ke.value);function An(L){Ke.value=L,He.value||(He.value="Not Valid"),cs()}const mn=C(()=>te.value==="no-answer"?ge.value==="dont-send"?"Postpone":"Send and postpone":te.value==="not-valid"?He.value?`Close as ${He.value}`:"Close":te.value==="interested"?"Schedule and qualify":""),$s=C(()=>te.value==="no-answer"?$n.value:te.value==="not-valid"?jn.value:te.value==="interested"?cn.value:!1),us=()=>{te.value==="no-answer"?Ts():te.value==="not-valid"?cs():te.value==="interested"&&ds()},Ds=yu(a,A,H,es(l,"lead"),at,mt,x,de,J),{logManualCall:As,handleScheduleAppointmentConfirm:Os,handleQualify:ds,handleNoAnswerConfirm:Ts,handleNotValidConfirm:cs,handleNoteSave:Is,handleReopen:Vs}=Ds,Ns=C(()=>{if(!yn.value)return"";const L=yn.value,f=String(L.getDate()).padStart(2,"0"),ae=String(L.getMonth()+1).padStart(2,"0"),P=String(L.getFullYear()),Ie=String(L.getHours()).padStart(2,"0"),Ne=String(L.getMinutes()).padStart(2,"0");return`${f}/${ae}/${P} ${Ie}:${Ne}`}),{saveTradeInVehicle:On}=_o(),Fs=async L=>{var f,ae,P;try{R.value=!1,lt.value.financing=!0;const Ie=L.type==="FIN"?"Captive Financing":L.type==="LEA"?"Leasing":"Long-Term Rental",Ne=((f=L.fields)==null?void 0:f.monthlyInstalment)||0;await x.addActivity(l.lead.id,{type:"purchase-method",user:((ae=de.value)==null?void 0:ae.name)||"You",action:`added a ${Ie} purchase method`,content:`${Ie}: €${Ne.toLocaleString()}/month for ${((P=L.fields)==null?void 0:P.duration)||0} months`,data:{purchaseMethodId:L.id,type:L.type,...L.fields},timestamp:new Date().toISOString()}),a("note-saved",{type:"purchase-method",...L})}catch(Ie){console.error("Error saving purchase method:",Ie)}},ms=async L=>{try{if(E.value=!1,L.vehicleType==="tradein"||l.mode==="tradein"){const f=await On("lead",l.lead.id,L.vehicle,L.valuation||{});lt.value.tradeIn=!0,a("note-saved",{type:"tradein",id:f.activity.id,action:"added a trade-in",vehicleId:f.vehicle.id,data:f.activity.data,timestamp:f.activity.timestamp})}else{const{addVehicleToCustomer:f}=await xn(async()=>{const{addVehicleToCustomer:ae}=await import("./contacts-Deg_Cdvm.js");return{addVehicleToCustomer:ae}},__vite__mapDeps([0,1,2]));await f(l.lead.customerId,L.vehicle),a("note-saved",{type:"vehicle",vehicleType:L.vehicleType,...L.vehicle})}}catch(f){console.error("Error saving vehicle:",f)}};return(L,f)=>{var ae;return p(),S("div",ed,[t(et)?(p(),S(be,{key:0},[e("div",td,[e("div",nd,[e("div",sd,[e("div",ad,[n(t(La),{size:16,class:"text-green-600"})]),e("div",ld,[e("p",od,F(t(et).statusText),1),t(et).reason?(p(),S("p",id,F(t(et).reason),1)):q("",!0)])]),t(et).meeting?(p(),S("div",rd,[e("div",ud,[e("div",null,[f[42]||(f[42]=e("span",{class:"text-muted-foreground"},"Date:",-1)),e("span",dd,F(t(et).meeting.date),1)]),e("div",null,[f[43]||(f[43]=e("span",{class:"text-muted-foreground"},"Time:",-1)),e("span",cd,F(t(et).meeting.time),1)]),e("div",null,[f[44]||(f[44]=e("span",{class:"text-muted-foreground"},"Type:",-1)),e("span",md,F(t(et).meeting.title),1)]),e("div",null,[f[45]||(f[45]=e("span",{class:"text-muted-foreground"},"Assigned to:",-1)),e("span",fd,F(t(et).meeting.location),1)])])])):q("",!0),e("div",pd,[n(t(_),{variant:"outline",size:"small",class:"flex items-center gap-2 cursor-pointer",onClick:t(Vs)},{default:o(()=>[n(t(ci),{size:14}),f[46]||(f[46]=D(" Re-open ",-1))]),_:1},8,["onClick"])])])]),e("div",vd,[e("span",null,"Updated by "+F(t(et).actorName||"Unknown"),1),e("span",gd,F(Ns.value),1)])],64)):(p(),S(be,{key:1},[e("div",yd,[e("div",bd,[n(il,{"next-action-due":s.lead.nextActionDue,"show-deadline-banner":s.showDeadlineBanner,"task-id":s.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",hd,[e("div",xd,[e("div",null,[e("h4",wd,F(Z.value),1),e("p",kd,F(ue.value),1)])]),nt.value||t(at)>0?(p(),S("div",Sd,[e("div",Cd,[nt.value?(p(),S("div",$d,[f[48]||(f[48]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-sm"},null,-1)),e("div",Dd,[f[47]||(f[47]=e("span",{class:"text-sm font-semibold text-foreground"},"Scheduled Follow-up Call:",-1)),e("span",Ad,F(t(wn)(s.lead.scheduledAppointment.start))+" at "+F(t(Zn)(s.lead.scheduledAppointment.start)),1)])])):q("",!0),t(at)>0?(p(),S("div",Od,[f[50]||(f[50]=e("i",{class:"fa-solid fa-phone text-muted-foreground text-sm"},null,-1)),f[51]||(f[51]=e("span",{class:"text-sm font-semibold text-muted-foreground"},"Contact Attempts:",-1)),e("span",Td,F(t(at))+" / "+F(t(mt)),1),t(at)>=t(mt)-1?(p(),S("div",Id,[...f[49]||(f[49]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):q("",!0)])):q("",!0)])])):q("",!0),n(ol,{"is-call-active":t(h),"call-ended":t(g),"call-duration":t(v),"call-notes":t(b),"formatted-call-duration":t(r),"mock-transcription":t(w),"contact-attempts":t(at),"max-contact-attempts":t(mt),onStartCall:gt,onEndCall:t(N),onLogManualCall:t(As),onExtractInformation:f[0]||(f[0]=P=>G.value=!0),"onUpdate:callNotes":ct,onCopyNumber:ht},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall"])])])]),e("div",Vd,[t(et)?q("",!0):(p(),S("div",Nd,[e("div",null,[f[55]||(f[55]=e("p",{class:"text-sm font-medium text-foreground leading-normal mb-3"},"Log what is happening?",-1)),e("div",Fd,[n(t(Ue),{variant:"outline","model-value":t(te)==="no-answer","onUpdate:modelValue":f[1]||(f[1]=P=>t(xe)(P?"no-answer":null)),class:"outcome-toggle-item"},{default:o(()=>[n(t(di),{size:18,class:"shrink-0"}),f[52]||(f[52]=e("span",null,"No answer",-1))]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(te)==="not-valid","onUpdate:modelValue":f[2]||(f[2]=P=>t(xe)(P?"not-valid":null)),class:"outcome-toggle-item"},{default:o(()=>[n(t(mi),{size:18,class:"shrink-0"}),f[53]||(f[53]=e("span",null,"Not valid",-1))]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(te)==="interested","onUpdate:modelValue":f[3]||(f[3]=P=>t(xe)(P?"interested":null)),class:"outcome-toggle-item"},{default:o(()=>[n(t(La),{size:18,class:"shrink-0"}),f[54]||(f[54]=e("span",null,"Interested",-1))]),_:1},8,["model-value"])])]),t(te)==="no-answer"?(p(),S("div",Ud,[e("div",qd,[n(t(B),{class:"form-label"},{default:o(()=>[...f[56]||(f[56]=[D("When did you call?",-1)])]),_:1}),n(t(qe),{type:"datetime-local",modelValue:t(je),"onUpdate:modelValue":f[4]||(f[4]=P=>Kt(je)?je.value=P:null),class:"w-full"},null,8,["modelValue"])]),e("div",Ld,[f[65]||(f[65]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Send follow-up message",-1)),e("div",Pd,[n(t(Ue),{variant:"outline","model-value":t(ge)==="whatsapp","onUpdate:modelValue":f[5]||(f[5]=P=>P&&an("whatsapp")),class:"followup-toggle-item"},{default:o(()=>[...f[57]||(f[57]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(ge)==="sms","onUpdate:modelValue":f[6]||(f[6]=P=>P&&an("sms")),class:"followup-toggle-item"},{default:o(()=>[...f[58]||(f[58]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(ge)==="email","onUpdate:modelValue":f[7]||(f[7]=P=>P&&an("email")),class:"followup-toggle-item"},{default:o(()=>[...f[59]||(f[59]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(ge)==="dont-send","onUpdate:modelValue":f[8]||(f[8]=P=>P&&an("dont-send")),class:"followup-toggle-item"},{default:o(()=>[...f[60]||(f[60]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])]),_:1},8,["model-value"])]),t(ge)&&t(ge)!=="dont-send"?(p(),S("div",Md,[e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[61]||(f[61]=[D("Template",-1)])]),_:1}),n(t($t),{modelValue:t(Te),"onUpdate:modelValue":f[9]||(f[9]=P=>Kt(Te)?Te.value=P:null)},{default:o(()=>[n(t(kt),{class:"w-full h-10 min-h-10"},{default:o(()=>[n(t(St),{placeholder:"Select template"})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"followup-1"},{default:o(()=>[...f[62]||(f[62]=[D("Follow-up 1",-1)])]),_:1}),n(t(he),{value:"followup-2"},{default:o(()=>[...f[63]||(f[63]=[D("Follow-up 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[64]||(f[64]=[D("Message preview",-1)])]),_:1}),e("textarea",{value:t(pe),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-muted-foreground bg-white resize-none",readonly:""},null,8,Ed)])])):q("",!0)]),e("div",Rd,[f[72]||(f[72]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Next call attempt",-1)),e("div",jd,[n(t(Ue),{variant:"outline","model-value":t(We)==="tomorrow-9am","onUpdate:modelValue":f[10]||(f[10]=P=>P&&ln("tomorrow-9am")),class:"followup-toggle-item"},{default:o(()=>[...f[66]||(f[66]=[D(" Tomorrow 9:00 AM ",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(We)==="monday","onUpdate:modelValue":f[11]||(f[11]=P=>P&&ln("monday")),class:"followup-toggle-item"},{default:o(()=>[...f[67]||(f[67]=[e("i",{class:"fa-solid fa-sparkles text-xs"},null,-1),D(" AI suggestion ",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":t(We)==="custom","onUpdate:modelValue":f[12]||(f[12]=P=>P&&ln("custom")),class:"followup-toggle-item"},{default:o(()=>[...f[68]||(f[68]=[D(" Select time ",-1)])]),_:1},8,["model-value"])]),t(We)==="monday"&&t(Ae)?(p(),S("div",Bd,[e("div",zd,[f[69]||(f[69]=e("i",{class:"fa-solid fa-lightbulb text-blue-600 text-sm mt-0.5"},null,-1)),e("div",Wd,[e("p",Yd,F(t(Ae).formattedDate)+" at "+F(t(Ae).time),1),e("p",Hd,F(t(Ae).reason),1)])])])):q("",!0),t(We)==="custom"?(p(),S("div",Qd,[e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[70]||(f[70]=[D("Date",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:t(_e),"onUpdate:modelValue":f[13]||(f[13]=P=>Kt(_e)?_e.value=P:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[71]||(f[71]=[D("Time",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:t(Se),"onUpdate:modelValue":f[14]||(f[14]=P=>Kt(Se)?Se.value=P:null),class:"w-full"},null,8,["modelValue"])])])):q("",!0)])])):q("",!0),t(te)==="not-valid"?(p(),S("div",Gd,[e("div",_d,[n(t(B),{class:"form-label"},{default:o(()=>[...f[73]||(f[73]=[D("When did you call?",-1)])]),_:1}),n(t(qe),{type:"datetime-local",modelValue:t(je),"onUpdate:modelValue":f[15]||(f[15]=P=>Kt(je)?je.value=P:null),class:"w-full"},null,8,["modelValue"])]),n(ks,{"preselected-reason":t(Ke),"close-button-label":"Close as not valid",onClose:An,onCancel:t(we),"onUpdate:reason":bn},null,8,["preselected-reason","onCancel"])])):q("",!0),t(te)==="interested"?(p(),S("div",Jd,[f[119]||(f[119]=e("div",{class:"text-xs text-muted-foreground px-2"},[e("span",{class:"text-red-600"},"*"),D(" Required fields ")],-1)),e("div",Kd,[n(t(B),{class:"form-label"},{default:o(()=>[...f[74]||(f[74]=[D("When did you call?",-1)])]),_:1}),n(t(qe),{type:"datetime-local",modelValue:t(je),"onUpdate:modelValue":f[16]||(f[16]=P=>Kt(je)?je.value=P:null),class:"w-full"},null,8,["modelValue"])]),e("div",Zd,[f[97]||(f[97]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Enrich lead",-1)),e("div",Xd,[e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[75]||(f[75]=[D("Customer interest level?",-1)])]),_:1}),e("div",ec,[n(t(B),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[ke(e("input",{type:"radio","onUpdate:modelValue":f[17]||(f[17]=P=>J.value.interestLevel=P),value:"High",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ut,J.value.interestLevel]]),f[76]||(f[76]=e("span",{class:"text-sm text-muted-foreground"},"High",-1))]),_:1}),n(t(B),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[ke(e("input",{type:"radio","onUpdate:modelValue":f[18]||(f[18]=P=>J.value.interestLevel=P),value:"Medium",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ut,J.value.interestLevel]]),f[77]||(f[77]=e("span",{class:"text-sm text-muted-foreground"},"Medium",-1))]),_:1}),n(t(B),{class:"flex items-center gap-2 cursor-pointer"},{default:o(()=>[ke(e("input",{type:"radio","onUpdate:modelValue":f[19]||(f[19]=P=>J.value.interestLevel=P),value:"Low",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ut,J.value.interestLevel]]),f[78]||(f[78]=e("span",{class:"text-sm text-muted-foreground"},"Low",-1))]),_:1})])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[79]||(f[79]=[D("Expected purchase timeline?",-1)])]),_:1}),n(t($t),{modelValue:J.value.purchaseTimeline,"onUpdate:modelValue":f[20]||(f[20]=P=>J.value.purchaseTimeline=P)},{default:o(()=>[n(t(kt),{class:"w-full h-10 min-h-10"},{default:o(()=>[n(t(St),{placeholder:"Select timeline"})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Immediate"},{default:o(()=>[...f[80]||(f[80]=[D("Immediate",-1)])]),_:1}),n(t(he),{value:"Within 1 month"},{default:o(()=>[...f[81]||(f[81]=[D("Within 1 month",-1)])]),_:1}),n(t(he),{value:"Within 3 months"},{default:o(()=>[...f[82]||(f[82]=[D("Within 3 months",-1)])]),_:1}),n(t(he),{value:"Within 6 months"},{default:o(()=>[...f[83]||(f[83]=[D("Within 6 months",-1)])]),_:1}),n(t(he),{value:"Just browsing"},{default:o(()=>[...f[84]||(f[84]=[D("Just browsing",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[85]||(f[85]=[D("Budget range (if discussed)?",-1)])]),_:1}),n(t($t),{modelValue:J.value.budgetRange,"onUpdate:modelValue":f[21]||(f[21]=P=>J.value.budgetRange=P)},{default:o(()=>[n(t(kt),{class:"w-full h-10 min-h-10"},{default:o(()=>[n(t(St),{placeholder:"Select budget range"})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Under €30k"},{default:o(()=>[...f[86]||(f[86]=[D("Under €30k",-1)])]),_:1}),n(t(he),{value:"€30k-€50k"},{default:o(()=>[...f[87]||(f[87]=[D("€30k-€50k",-1)])]),_:1}),n(t(he),{value:"€50k-€80k"},{default:o(()=>[...f[88]||(f[88]=[D("€50k-€80k",-1)])]),_:1}),n(t(he),{value:"€80k+"},{default:o(()=>[...f[89]||(f[89]=[D("€80k+",-1)])]),_:1}),n(t(he),{value:"Not discussed"},{default:o(()=>[...f[90]||(f[90]=[D("Not discussed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",tc,[e("label",nc,[ke(e("input",{type:"checkbox","onUpdate:modelValue":f[22]||(f[22]=P=>J.value.hasTradeIn=P),class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[wt,J.value.hasTradeIn]]),f[91]||(f[91]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Trade in?",-1))]),n(t(qe),{modelValue:J.value.tradeInModel,"onUpdate:modelValue":f[23]||(f[23]=P=>J.value.tradeInModel=P),disabled:!J.value.hasTradeIn,placeholder:"Car brand and model",class:"w-full h-10 min-h-10"},null,8,["modelValue","disabled"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[92]||(f[92]=[D("Financing?",-1)])]),_:1}),n(t($t),{modelValue:J.value.financingOption,"onUpdate:modelValue":f[24]||(f[24]=P=>J.value.financingOption=P)},{default:o(()=>[n(t(kt),{class:"w-full h-10 min-h-10"},{default:o(()=>[n(t(St),{placeholder:"Select financing option"})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"FIN"},{default:o(()=>[...f[93]||(f[93]=[D("Captive Financing",-1)])]),_:1}),n(t(he),{value:"LEA"},{default:o(()=>[...f[94]||(f[94]=[D("Leasing",-1)])]),_:1}),n(t(he),{value:"LTR"},{default:o(()=>[...f[95]||(f[95]=[D("Long-Term Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[96]||(f[96]=[D("Additional notes",-1)])]),_:1}),n(t(Xe),{modelValue:J.value.additionalNotes,"onUpdate:modelValue":f[25]||(f[25]=P=>J.value.additionalNotes=P),rows:"4",class:"w-full",placeholder:"Any relevant information about customer interest or preferences..."},null,8,["modelValue"])])]),e("div",sc,[n(t(_),{label:"Save",variant:"primary",size:"small",onClick:Pe})])]),e("div",ac,[f[100]||(f[100]=e("h5",{class:"font-semibold text-foreground text-sm mb-3"},[D("Qualification method "),e("span",{class:"text-red-600"},"*")],-1)),e("div",lc,[e("label",{class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(Ze)==="assign-only"?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":f[26]||(f[26]=P=>Kt(Ze)?Ze.value=P:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[ut,t(Ze)]]),f[98]||(f[98]=e("span",{class:"text-sm text-foreground"},"Assign only",-1))],2),e("label",{class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(Ze)==="assign-and-schedule"?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":f[27]||(f[27]=P=>Kt(Ze)?Ze.value=P:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[ut,t(Ze)]]),f[99]||(f[99]=e("span",{class:"text-sm text-foreground"},"Assign and schedule",-1))],2)])]),t(Ze)==="assign-only"?(p(),S("div",oc,[e("div",ic,[f[105]||(f[105]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Assign appointment to",-1)),e("div",rc,[e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[101]||(f[101]=[D("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(vt),{modelValue:Gt.value,"onUpdate:modelValue":f[28]||(f[28]=P=>Gt.value=P),items:Rt.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:P})=>[e("div",uc,[e("span",dc,F(P.dealership||"No location"),1),f[102]||(f[102]=e("span",{class:"text-muted-foreground"},"→",-1)),e("span",cc,F(P.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[103]||(f[103]=[D("Salesperson ",-1),e("span",{class:"optional"},"(optional)",-1)])]),_:1}),n(t(vt),{modelValue:Vt.value,"onUpdate:modelValue":f[29]||(f[29]=P=>Vt.value=P),items:on.value,disabled:!t(Ee),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:P})=>[e("div",mc,[e("div",{class:se(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",$e(P.role)])},F(fe(P.name)),3),e("span",fc,F(P.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[104]||(f[104]=[D("Notes for assignee",-1)])]),_:1}),n(t(Xe),{modelValue:me.value,"onUpdate:modelValue":f[30]||(f[30]=P=>me.value=P),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])])):q("",!0),t(Ze)==="assign-and-schedule"?(p(),S("div",pc,[e("div",vc,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...f[106]||(f[106]=[D("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(vt),{modelValue:t(ot),"onUpdate:modelValue":f[31]||(f[31]=P=>Kt(ot)?ot.value=P:null),items:Mn.value,placeholder:t(i)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:o(({item:P})=>[e("span",null,F(P.label),1)]),_:1},8,["modelValue","items","placeholder"])]),t(ot)?(p(),S("div",gc,[f[110]||(f[110]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Assign appointment to",-1)),e("div",yc,[e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[107]||(f[107]=[D("Team",-1)])]),_:1}),n(t(vt),{modelValue:Gt.value,"onUpdate:modelValue":f[32]||(f[32]=P=>Gt.value=P),items:Rt.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:P})=>[e("div",bc,[e("span",hc,F(P.dealership||"No location"),1),f[108]||(f[108]=e("span",{class:"text-muted-foreground"},"→",-1)),e("span",xc,F(P.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[n(t(B),{class:"form-label"},{default:o(()=>[...f[109]||(f[109]=[D("Salesperson ",-1),e("span",{class:"optional"},"(optional)",-1)])]),_:1}),n(t(vt),{modelValue:Vt.value,"onUpdate:modelValue":f[33]||(f[33]=P=>Vt.value=P),items:on.value,disabled:!t(Ee),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:P})=>[e("div",wc,[e("div",{class:se(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",$e(P.role)])},F(fe(P.name)),3),e("span",kc,F(P.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):q("",!0),t(ot)&&t(Ee)?(p(),S("div",Sc,[e("h5",Cc,[D(F(t(i)("forms.schedule.title"))+" ",1),f[111]||(f[111]=e("span",{class:"text-red-600"},"*",-1))]),e("div",$c,[e("div",Dc,[e("div",Ac,[e("div",Oc,[e("button",{onClick:Cs,class:"p-1 hover:bg-muted rounded transition-colors cursor-pointer"},[...f[112]||(f[112]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-muted-foreground"},null,-1)])]),e("h6",Tc,F(Rn.value),1),e("button",{onClick:rs,class:"p-1 hover:bg-muted rounded transition-colors cursor-pointer"},[...f[113]||(f[113]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-muted-foreground"},null,-1)])])]),e("div",Ic,[(p(),S(be,null,Oe(En,P=>e("div",{key:P,class:"text-center text-xs font-medium text-muted-foreground py-2"},F(P),1)),64))]),e("div",Vc,[(p(!0),S(be,null,Oe(dn.value,(P,Ie)=>(p(),S("div",{key:Ie,onClick:Ne=>is(P),class:se(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",os(P)?"bg-primary text-white cursor-pointer":P?"text-muted-foreground hover:bg-muted cursor-pointer":"text-transparent"])},F(P),11,Nc))),128))])]),e("div",Fc,[e("h6",Uc,F(ls.value),1),t(Be)&&Et.value.length>0?(p(),S("div",qc,[(p(!0),S(be,null,Oe(Et.value,P=>(p(),K(t(Ue),{key:P,variant:"outline","model-value":t(it)===P,"onUpdate:modelValue":Ie=>t(rt)(Ie?P:""),class:"schedule-slot-toggle-item"},{default:o(()=>[D(F(P),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))])):t(Be)&&Et.value.length===0?(p(),S("div",Lc,F(t(i)("forms.schedule.timeSlots.noSlots")),1)):(p(),S("div",Pc,F(t(i)("forms.schedule.timeSlots.selectDate")),1))])])])])):q("",!0),n(rl,{appointment:{type:t(ot),date:t(Be),time:t(it),duration:t(Mt)},customer:s.lead.customer,salesperson:t(It),team:t(Ee),dealership:(ae=t(Ee))!=null&&ae.dealership?{name:t(Ee).dealership}:null,onUpdate:jt},null,8,["appointment","customer","salesperson","team","dealership"])])):q("",!0),t(re)&&t(Ze)==="assign-only"?(p(),S("div",Mc,[f[118]||(f[118]=Ya('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-foreground text-sm">Existing Appointment</h5></div><span class="text-sm font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Ec,[e("div",null,[f[114]||(f[114]=e("span",{class:"text-muted-foreground"},"Date:",-1)),e("span",Rc,F(t(wn)(s.lead.scheduledAppointment.start)),1)]),e("div",null,[f[115]||(f[115]=e("span",{class:"text-muted-foreground"},"Time:",-1)),e("span",jc,F(t(Zn)(s.lead.scheduledAppointment.start)),1)]),e("div",null,[f[116]||(f[116]=e("span",{class:"text-muted-foreground"},"Type:",-1)),e("span",Bc,F(s.lead.scheduledAppointment.type),1)]),e("div",null,[f[117]||(f[117]=e("span",{class:"text-muted-foreground"},"Assigned to:",-1)),e("span",zc,F(s.lead.scheduledAppointment.assignee),1)])]),n(t(_),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:f[34]||(f[34]=P=>ie.value=!0)})])):q("",!0)])):q("",!0)])),t(te)&&!t(et)?(p(),S("div",Wc,[n(t(_),{variant:"secondary",onClick:t(we)},{default:o(()=>[...f[120]||(f[120]=[D(" Cancel ",-1)])]),_:1},8,["onClick"]),n(t(_),{variant:"primary",disabled:!$s.value,onClick:us,class:"bg-primary text-white"},{default:o(()=>[D(F(mn.value),1)]),_:1},8,["disabled"])])):q("",!0)])],64)),n(Ka,{ref_key:"noteWidgetRef",ref:M,modal:"",show:t(X),item:null,"task-type":"lead","task-id":s.lead.id,onSave:t(Is),onClose:f[35]||(f[35]=P=>X.value=!1),onCancel:f[36]||(f[36]=P=>X.value=!1)},null,8,["show","task-id","onSave"]),n(vu,{show:t(ie),"preselected-assignee":t(Ye).assignee,onConfirm:t(Os),onClose:f[37]||(f[37]=P=>ie.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),n(si,{show:le.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:Re,onClose:f[38]||(f[38]=P=>le.value=!1)},null,8,["show"]),n(Za,{show:R.value,"task-type":"lead","task-id":s.lead.id,onSave:Fs,onClose:f[39]||(f[39]=P=>R.value=!1)},null,8,["show","task-id"]),n(Xa,{show:E.value,mode:"tradein","task-type":"lead","task-id":s.lead.id,"customer-id":s.lead.customerId,onClose:f[40]||(f[40]=P=>E.value=!1),onSave:ms},null,8,["show","task-id","customer-id"]),n(Gs,{show:G.value,title:"AI Information Extraction",onClose:f[41]||(f[41]=P=>G.value=!1)},null,8,["show"])])}}},Hc={key:0,class:"bg-muted/50 border border-border rounded-lg p-4"},Qc={class:"flex justify-between items-start mb-3"},Gc={class:"text-xs text-muted-foreground mt-0.5"},_c={key:0},Jc={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(s,{emit:$}){const i=s,l=$,a=Sn(),m=()=>{var U;const N=a.currentLead;return N&&N.id===((U=i.lead)==null?void 0:U.id)?N:i.lead},d={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},x=tl(es(i,"lead"),d),{handlePostponed:V,handleValidated:A,handleQualified:h,handleCallAttemptLogged:g,handleNoteSaved:v,handleOpenPurchaseMethod:b,handleOpenTradeIn:k,handleAppointmentScheduled:y,handleDisqualified:w,handleReopen:r}=hr({getLead:m,leadState:x,emit:l}),O=async N=>{var U;(U=i.lead)!=null&&U.id&&await a.loadLeadById(i.lead.id)};return(N,U)=>(p(),K(nl,{task:s.lead,"hide-title":"","hide-border":""},{"primary-action":o(()=>[t(x).isClosed.value?q("",!0):(p(),K(al,{key:0,task:s.lead,"task-type":"lead",onReassigned:O,class:"mb-3"},null,8,["task"])),!t(x).isClosed.value&&t(x).showLQWidget.value?(p(),K(Yc,{key:s.lead.id,lead:s.lead,"show-deadline-banner":t(x).showDeadlineBanner.value,onPostponed:t(V),onValidated:t(A),onQualified:t(h),onDisqualified:t(w),onCallAttemptLogged:t(g),onNoteSaved:t(v),onOpenPurchaseMethod:t(b),onOpenTradeIn:t(k),onAppointmentScheduled:t(y)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!t(x).isClosed.value&&t(x).primaryAction.value?(p(),K(sl,{key:2,action:t(x).primaryAction.value,"color-scheme":t(x).primaryAction.value.colorScheme,onActionClicked:t(x).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):q("",!0)]),"task-widgets":o(()=>[...U[0]||(U[0]=[])]),"closed-state":o(()=>[t(x).isClosed.value?(p(),S("div",Hc,[e("div",Qc,[e("div",null,[U[1]||(U[1]=e("h4",{class:"font-bold text-foreground text-sm"},"Lead Closed",-1)),e("p",Gc,[D(" Status: "+F(t(x).displayStage.value)+" ",1),s.lead.disqualifyReason?(p(),S("span",_c," - "+F(s.lead.disqualifyReason),1)):q("",!0)])])]),n(t(_),{variant:"primary",size:"small",onClick:t(r),class:"flex items-center gap-2"},{default:o(()=>[...U[2]||(U[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):q("",!0)]),_:1},8,["task"]))}};function Kn(s,$,i=null){if(!s.value[$]){const l=new Date;s.value[$]=i||l.toISOString().split("T")[0]}}function zs(){return new Date().toISOString().split("T")[0]}const Kc={class:"rounded-lg flex flex-col bg-muted"},Zc={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden"},Xc={class:"p-4"},em={class:"flex justify-between items-start mb-3"},tm={class:"font-bold text-foreground text-sm"},nm={class:"text-xs text-muted-foreground mt-0.5"},sm={class:"flex gap-3 flex-wrap"},_s={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!1,default:()=>({background:"",border:""})},showPostpone:{type:Boolean,default:!0}},emits:["postpone"],setup(s){return($,i)=>(p(),S("div",Kc,[e("div",Zc,[e("div",Xc,[e("div",em,[e("div",null,[e("h4",tm,F(s.title),1),e("p",nm,F(s.description),1)]),Ft($.$slots,"badge")]),e("div",sm,[Ft($.$slots,"actions"),s.showPostpone?(p(),S("button",{key:0,onClick:i[0]||(i[0]=l=>$.$emit("postpone")),class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted"},[...i[1]||(i[1]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("span",null,"Postpone",-1)])])):q("",!0)]),Ft($.$slots,"survey"),Ft($.$slots,"content")])])]))}},am={key:1,class:"space-y-4"},lm={class:"flex items-center justify-between"},om={class:"space-y-4"},im={class:"block text-sm font-medium text-muted-foreground"},rm=["onUpdate:modelValue","placeholder"],um={key:2,class:"space-y-2"},dm=["onUpdate:modelValue","value"],cm={class:"flex gap-2 flex-wrap justify-end pt-2"},Js={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(s,{emit:$}){const i=s,l=$,a=T(i.initialExpanded),m=T({});ye(()=>i.questions,h=>{const g={};h.forEach(v=>{g[v.key]=""}),m.value=g},{immediate:!0});const d=()=>{l("survey-completed",{...m.value}),A()},x=()=>{l("survey-refused"),A()},V=()=>{l("not-responding"),A()},A=()=>{a.value=!1;const h={};i.questions.forEach(g=>{h[g.key]=""}),m.value=h};return(h,g)=>(p(),S("div",null,[a.value?(p(),S("div",am,[e("div",lm,[g[4]||(g[4]=e("h5",{class:"text-sm font-semibold text-foreground"},"Lead Qualification Survey",-1)),e("button",{onClick:g[1]||(g[1]=v=>a.value=!1),class:"text-xs text-muted-foreground hover:text-muted-foreground transition-colors"},[...g[3]||(g[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",om,[(p(!0),S(be,null,Oe(s.questions,(v,b)=>(p(),S("div",{key:b,class:"space-y-2"},[e("label",im,F(v.label),1),v.type==="text"?ke((p(),S("textarea",{key:0,"onUpdate:modelValue":k=>m.value[v.key]=k,placeholder:v.placeholder,rows:"3",class:"input resize-none text-sm py-2 px-3 w-full"},null,8,rm)),[[Xn,m.value[v.key]]]):v.type==="select"?(p(),K(t($t),{key:1,modelValue:m.value[v.key],"onUpdate:modelValue":k=>m.value[v.key]=k},{default:o(()=>[n(t(kt),{class:"w-full h-10 min-h-10"},{default:o(()=>[n(t(St),{placeholder:"Select an option..."})]),_:1}),n(t(Ct),null,{default:o(()=>[(p(!0),S(be,null,Oe(v.options,k=>(p(),K(t(he),{key:k,value:k},{default:o(()=>[D(F(k),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):v.type==="radio"?(p(),S("div",um,[(p(!0),S(be,null,Oe(v.options,k=>(p(),S("label",{key:k,class:"flex items-center text-sm text-muted-foreground cursor-pointer"},[ke(e("input",{type:"radio","onUpdate:modelValue":y=>m.value[v.key]=y,value:k,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,dm),[[ut,m.value[v.key]]]),D(" "+F(k),1)]))),128))])):q("",!0)]))),128)),e("div",cm,[n(t(_),{label:"Complete Survey",variant:"primary",size:"small",onClick:d,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),n(t(_),{label:"Customer Refused",variant:"outline",size:"small",onClick:x}),n(t(_),{label:"Not Responding",variant:"outline",size:"small",onClick:V})])])])):(p(),S("button",{key:0,onClick:g[0]||(g[0]=v=>a.value=!0),class:"w-full flex items-center justify-between text-sm text-muted-foreground hover:text-foreground py-2 transition-colors"},[...g[2]||(g[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-xs text-muted-foreground"},null,-1)])]))]))}},mm={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding","postpone"],setup(s,{emit:$}){const i=s,l=$,a=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],m=C(()=>{if(!i.opportunity.createdAt)return 0;const g=new Date(i.opportunity.createdAt),b=Math.abs(new Date-g);return Math.ceil(b/(1e3*60*60*24))}),d=()=>{l("create-offer",i.opportunity)},x=()=>{l("review",i.opportunity)},V=g=>{l("survey-completed",{opportunity:i.opportunity,responses:g})},A=()=>{l("survey-refused",{opportunity:i.opportunity})},h=()=>{l("not-responding",{opportunity:i.opportunity})};return(g,v)=>(p(),K(_s,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${m.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"},onPostpone:v[0]||(v[0]=b=>g.$emit("postpone","oofb"))},{actions:o(()=>[e("button",{onClick:d,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:x,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted"}," Review Opportunity ")]),survey:o(()=>[n(Js,{questions:a,onSurveyCompleted:V,onSurveyRefused:A,onNotResponding:h})]),_:1},8,["description"]))}},fm={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding","postpone"],setup(s,{emit:$}){const i=s,l=$,a=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],m=C(()=>{if(!i.opportunity.createdAt)return 0;const h=new Date(i.opportunity.createdAt),v=Math.abs(new Date-h);return Math.ceil(v/(1e3*60*60*24))}),d=()=>{l("create-offer",i.opportunity)},x=h=>{l("survey-completed",{opportunity:i.opportunity,responses:h})},V=()=>{l("survey-refused",{opportunity:i.opportunity})},A=()=>{l("not-responding",{opportunity:i.opportunity})};return(h,g)=>(p(),K(_s,{title:"Unsold Feedback",description:`This opportunity has been open for ${m.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"},onPostpone:g[0]||(g[0]=v=>h.$emit("postpone","ufb"))},{actions:o(()=>[e("button",{onClick:d,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:o(()=>[n(Js,{questions:a,onSurveyCompleted:x,onSurveyRefused:V,onNotResponding:A})]),_:1},8,["description"]))}},pm={class:"space-y-4"},vm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},gm={class:"flex justify-between items-start mb-1"},ym={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},bm={class:"flex flex-wrap gap-3"},hm={key:0,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},xm={key:1},wm={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["appointment-scheduled","close-as-lost","cancel","postpone"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=T(null),x=C(()=>{var h;return m.value==="schedule"?!1:m.value==="close-lost"&&((h=d.value)==null?void 0:h.canSubmit)||!1});async function V(){var h;m.value==="schedule"?a("appointment-scheduled",{opportunity:l.opportunity}):m.value==="close-lost"&&((h=d.value)==null||h.submit())}function A(h){a("close-as-lost",{opportunity:l.opportunity,reason:h.reason})}return $({canSubmit:x,submit:V}),(h,g)=>(p(),S("div",pm,[e("div",vm,[e("div",gm,[g[4]||(g[4]=e("div",{class:"flex-1"},[e("h4",{class:"font-bold text-foreground text-sm mb-1"},"No Follow-Up Task"),e("p",{class:"text-sm text-muted-foreground"}," 5+ days in negotiation with no future appointment scheduled. Schedule an appointment to move forward or close as lost. ")],-1)),e("button",{onClick:g[0]||(g[0]=v=>h.$emit("postpone","nfu")),class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted ml-4"},[...g[3]||(g[3]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("span",null,"Postpone",-1)])])])]),e("div",ym,[g[7]||(g[7]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Choose Action",-1)),e("div",bm,[n(t(_),{variant:"outline",onClick:g[1]||(g[1]=v=>m.value="schedule"),class:se(["flex-1",m.value==="schedule"?"border-purple-500 bg-purple-50 text-purple-700":""])},{default:o(()=>[...g[5]||(g[5]=[e("i",{class:"fa-solid fa-calendar-plus mr-2"},null,-1),D(" Schedule Appointment ",-1)])]),_:1},8,["class"]),n(t(_),{variant:"outline",onClick:g[2]||(g[2]=v=>m.value="close-lost"),class:se(["flex-1",m.value==="close-lost"?"border-red-500 bg-red-50 text-red-700":""])},{default:o(()=>[...g[6]||(g[6]=[e("i",{class:"fa-solid fa-xmark mr-2"},null,-1),D(" Close as Lost ",-1)])]),_:1},8,["class"])])]),m.value==="schedule"?(p(),S("div",hm,[...g[8]||(g[8]=[e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Schedule Appointment",-1),e("p",{class:"text-sm text-muted-foreground"}," This will reuse the full schedule appointment form from the Awaiting Appointment stage. ",-1)])])):q("",!0),m.value==="close-lost"?(p(),S("div",xm,[n(ks,{ref_key:"closeFormRef",ref:d,item:s.opportunity,"item-type":"opportunity",onClose:A},null,8,["item"])])):q("",!0)]))}},km={class:"space-y-6"},Sm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Cm={class:"space-y-6"},$m={class:"space-y-2"},Dm=["value"],Am={class:"text-sm text-foreground"},Om={class:"space-y-2"},Tm=["value"],Im={class:"text-sm text-foreground"},Vm={class:"space-y-2"},Nm=["value"],Fm={class:"text-sm text-foreground"},Um={key:0},qm={class:"space-y-2"},Lm=["value"],Pm={class:"text-sm text-foreground"},ul={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["submit","postpone","cancel"],setup(s,{expose:$,emit:i}){const l=i,a=T({q1:"",q2:"",q3:"",q4:"",q5:""}),m=[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"not-yet",label:"Not yet"}],d=[{value:"yes",label:"Yes"},{value:"no",label:"No"}],x=[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"maybe",label:"Maybe"}],V=[{value:"send-revised-offer",label:"Send revised offer"},{value:"close-opportunity",label:"Close this opportunity"},{value:"follow-up-later",label:"Follow up later"}],A=C(()=>a.value.q3==="no"),h=C(()=>!(!a.value.q1||!a.value.q2||!a.value.q3||!a.value.q5));return $({submit:()=>{if(!h.value)return;const v={responses:{...a.value},timestamp:new Date().toISOString()};l("submit",v)},isValid:h}),(v,b)=>(p(),S("div",km,[e("div",Sm,[b[10]||(b[10]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Questions to ask customer",-1)),e("div",Cm,[e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...b[5]||(b[5]=[D(" 1. Did you review the offer? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",$m,[(p(),S(be,null,Oe(m,k=>e("label",{key:k.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q1===k.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":b[0]||(b[0]=y=>a.value.q1=y),type:"radio",value:k.value,class:"shrink-0"},null,8,Dm),[[ut,a.value.q1]]),e("span",Am,F(k.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...b[6]||(b[6]=[D(" 2. Do you have questions about the offer? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Om,[(p(),S(be,null,Oe(d,k=>e("label",{key:k.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q2===k.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":b[1]||(b[1]=y=>a.value.q2=y),type:"radio",value:k.value,class:"shrink-0"},null,8,Tm),[[ut,a.value.q2]]),e("span",Im,F(k.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...b[7]||(b[7]=[D(" 3. Are you interested in this offer? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Vm,[(p(),S(be,null,Oe(x,k=>e("label",{key:k.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q3===k.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":b[2]||(b[2]=y=>a.value.q3=y),type:"radio",value:k.value,class:"shrink-0"},null,8,Nm),[[ut,a.value.q3]]),e("span",Fm,F(k.label),1)],2)),64))])]),A.value?(p(),S("div",Um,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...b[8]||(b[8]=[D(" 4. If no, why? ",-1),e("span",{class:"text-xs text-muted-foreground ml-1"},"(optional notes)",-1)])]),_:1}),n(t(Xe),{modelValue:a.value.q4,"onUpdate:modelValue":b[3]||(b[3]=k=>a.value.q4=k),rows:"4",placeholder:"Describe the reason...",class:"w-full"},null,8,["modelValue"])])):q("",!0),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...b[9]||(b[9]=[D(" 5. Next steps? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",qm,[(p(),S(be,null,Oe(V,k=>e("label",{key:k.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q5===k.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":b[4]||(b[4]=y=>a.value.q5=y),type:"radio",value:k.value,class:"shrink-0"},null,8,Lm),[[ut,a.value.q5]]),e("span",Pm,F(k.label),1)],2)),64))])])])])]))}},Mm={class:"border border-border rounded-lg overflow-hidden"},Em={class:"font-semibold text-foreground text-sm"},Rm={key:0,class:"px-4 pb-4"},jm={__name:"CollapsibleSection",props:{title:{type:String,required:!0},isExpanded:{type:Boolean,default:!1}},emits:["toggle"],setup(s){return($,i)=>(p(),S("div",Mm,[e("button",{onClick:i[0]||(i[0]=l=>$.$emit("toggle")),class:"w-full flex items-center justify-between px-4 py-3 bg-muted/30 hover:bg-muted/50 transition-colors"},[e("h6",Em,F(s.title),1),e("i",{class:se(["fa-solid fa-chevron-down text-xs text-muted-foreground transition-transform duration-200",{"rotate-180":s.isExpanded}])},null,2)]),n(bs,{name:"expand"},{default:o(()=>[s.isExpanded?(p(),S("div",Rm,[Ft($.$slots,"default",{},void 0,!0)])):q("",!0)]),_:3})]))}},Ws=Zt(jm,[["__scopeId","data-v-b43b0b36"]]),Bm={class:"space-y-6"},zm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Wm={class:"space-y-4"},Ym={class:"space-y-6 pt-4"},Hm={class:"space-y-2"},Qm=["value"],Gm={class:"text-sm text-foreground"},_m={class:"space-y-2"},Jm=["value"],Km={class:"text-sm text-foreground"},Zm={key:0},Xm={class:"space-y-2"},ef=["value"],tf={class:"text-sm text-foreground"},nf={class:"flex items-center gap-2 mt-2"},sf={class:"space-y-6 pt-4"},af={class:"flex items-center gap-2"},lf=["onClick"],of={key:0,class:"text-sm text-muted-foreground ml-2"},rf={class:"space-y-2"},uf=["value"],df={class:"text-sm text-foreground"},cf={class:"space-y-6 pt-4"},mf={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},ff={class:"space-y-4"},pf={class:"flex items-center gap-3"},vf={class:"flex items-center gap-3"},gf={class:"flex items-center gap-3"},yf={__name:"ContractFeedbackSurvey",props:{opportunity:{type:Object,required:!0}},emits:["submit","cancel"],setup(s,{expose:$,emit:i}){const l=i,a=T({contractExperience:!0,serviceQuality:!1,internalNotes:!1}),m=T({q1:"",q2:"",q3:[],q3Other:!1,q3OtherText:"",q5:null,q6:"",q7:""}),d=T({negativeSatisfaction:!1,documentClarity:!1,poorSupport:!1}),x=[{value:"very-satisfied",label:"Very Satisfied - smooth and quick process"},{value:"satisfied",label:"Satisfied - minor delays but resolved"},{value:"neutral",label:"Neutral - took longer than expected"},{value:"unsatisfied",label:"Unsatisfied - had concerns about terms"},{value:"very-unsatisfied",label:"Very Unsatisfied - significant issues with contract"}],V=[{value:"crystal-clear",label:"Yes, everything was crystal clear"},{value:"mostly-clear",label:"Mostly clear, had a few questions"},{value:"some-confusion",label:"Some confusion, needed clarification"},{value:"not-clear",label:"Not clear at all, had many questions"},{value:"didnt-review",label:"I didn't review it thoroughly"}],A=[{value:"pricing",label:"Pricing or final price discrepancies"},{value:"payment-terms",label:"Payment terms unclear"},{value:"warranty",label:"Warranty or insurance terms"},{value:"delivery-timeline",label:"Delivery timeline not specified"},{value:"trade-in",label:"Trade-in valuation"},{value:"additional-fees",label:"Additional fees or charges"}],h=[{value:"definitely",label:"Definitely (9-10) - Excellent experience"},{value:"probably",label:"Probably (7-8) - Good experience"},{value:"unsure",label:"Unsure (5-6) - Mixed experience"},{value:"unlikely",label:"Unlikely (3-4) - Poor experience"},{value:"not-at-all",label:"Not at all (0-2) - Very negative experience"}],g=C(()=>m.value.q1==="unsatisfied"||m.value.q1==="very-unsatisfied");ye(()=>m.value.q1,k=>{k==="very-unsatisfied"?d.value.negativeSatisfaction=!0:d.value.negativeSatisfaction=!1}),ye(()=>m.value.q2,k=>{k==="not-clear"?d.value.documentClarity=!0:d.value.documentClarity=!1}),ye(()=>m.value.q5,k=>{k===1?d.value.poorSupport=!0:d.value.poorSupport=!1});const v=C(()=>{var k;return!(!m.value.q1||!m.value.q2||g.value&&(!m.value.q3||m.value.q3.length===0)&&!m.value.q3Other||g.value&&m.value.q3Other&&!((k=m.value.q3OtherText)!=null&&k.trim()))});return $({submit:()=>{if(!v.value)return;const k={responses:{...m.value},triggerActions:{...d.value},timestamp:new Date().toISOString()};l("submit",k)},isValid:v}),(k,y)=>{const w=xo("Input");return p(),S("div",Bm,[e("div",zm,[y[20]||(y[20]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Post-Contract Customer Experience Survey",-1)),e("div",Wm,[n(Ws,{"is-expanded":a.value.contractExperience,onToggle:y[5]||(y[5]=r=>a.value.contractExperience=!a.value.contractExperience),title:"Contract Experience"},{default:o(()=>[e("div",Ym,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[13]||(y[13]=[D(" How satisfied are you with the contract signing process? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Hm,[(p(),S(be,null,Oe(x,r=>e("label",{key:r.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",m.value.q1===r.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[0]||(y[0]=O=>m.value.q1=O),type:"radio",value:r.value,class:"shrink-0"},null,8,Qm),[[ut,m.value.q1]]),e("span",Gm,F(r.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[14]||(y[14]=[D(" Were all contract terms and conditions clearly explained to you? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",_m,[(p(),S(be,null,Oe(V,r=>e("label",{key:r.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",m.value.q2===r.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[1]||(y[1]=O=>m.value.q2=O),type:"radio",value:r.value,class:"shrink-0"},null,8,Jm),[[ut,m.value.q2]]),e("span",Km,F(r.label),1)],2)),64))])]),g.value?(p(),S("div",Zm,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[15]||(y[15]=[D(" Which aspects of the contract concerned you? (Select all that apply) ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Xm,[(p(),S(be,null,Oe(A,r=>e("label",{key:r.value,class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors"},[ke(e("input",{"onUpdate:modelValue":y[2]||(y[2]=O=>m.value.q3=O),type:"checkbox",value:r.value,class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,8,ef),[[wt,m.value.q3]]),e("span",tf,F(r.label),1)])),64)),e("div",nf,[ke(e("input",{"onUpdate:modelValue":y[3]||(y[3]=r=>m.value.q3Other=r),type:"checkbox",class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[wt,m.value.q3Other]]),y[16]||(y[16]=e("span",{class:"text-sm text-foreground"},"Other:",-1)),m.value.q3Other?(p(),K(w,{key:0,modelValue:m.value.q3OtherText,"onUpdate:modelValue":y[4]||(y[4]=r=>m.value.q3OtherText=r),placeholder:"Specify other concern",class:"flex-1"},null,8,["modelValue"])):q("",!0)])])])):q("",!0)])]),_:1},8,["is-expanded"]),n(Ws,{"is-expanded":a.value.serviceQuality,onToggle:y[7]||(y[7]=r=>a.value.serviceQuality=!a.value.serviceQuality),title:"Service Quality"},{default:o(()=>[e("div",sf,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[17]||(y[17]=[D(" How well did your salesperson support you through the contract process? ",-1)])]),_:1}),e("div",af,[(p(),S(be,null,Oe(5,r=>e("button",{key:r,onClick:O=>m.value.q5=r,class:se(["text-2xl transition-colors",m.value.q5>=r?"text-yellow-500":"text-gray-300"])}," ⭐ ",10,lf)),64)),m.value.q5?(p(),S("span",of,F(m.value.q5)+" "+F(m.value.q5===1?"star":"stars"),1)):q("",!0)])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[18]||(y[18]=[D(" How likely are you to recommend our dealership to friends and family? ",-1)])]),_:1}),e("div",rf,[(p(),S(be,null,Oe(h,r=>e("label",{key:r.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",m.value.q6===r.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[6]||(y[6]=O=>m.value.q6=O),type:"radio",value:r.value,class:"shrink-0"},null,8,uf),[[ut,m.value.q6]]),e("span",df,F(r.label),1)],2)),64))])])])]),_:1},8,["is-expanded"]),n(Ws,{"is-expanded":a.value.internalNotes,onToggle:y[9]||(y[9]=r=>a.value.internalNotes=!a.value.internalNotes),title:"Internal Notes"},{default:o(()=>[e("div",cf,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...y[19]||(y[19]=[D(" Notes for follow-up actions: ",-1),e("span",{class:"text-xs text-muted-foreground ml-1"},"(Private - only for internal staff)",-1)])]),_:1}),n(t(Xe),{modelValue:m.value.q7,"onUpdate:modelValue":y[8]||(y[8]=r=>m.value.q7=r),rows:"4",placeholder:"Add any notes or instructions for follow-up actions...",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["is-expanded"])])]),e("div",mf,[y[27]||(y[27]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Trigger Actions (Email Notifications)",-1)),e("div",ff,[e("div",pf,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-negative-satisfaction",modelValue:d.value.negativeSatisfaction,"onUpdate:modelValue":y[10]||(y[10]=r=>d.value.negativeSatisfaction=r)},null,8,["modelValue"]),y[21]||(y[21]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Sales Manager + Regional Manager ",-1))]),_:1}),y[22]||(y[22]=e("span",{class:"text-xs text-muted-foreground"},"(Q1 = Very Unsatisfied)",-1))]),e("div",vf,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-document-clarity",modelValue:d.value.documentClarity,"onUpdate:modelValue":y[11]||(y[11]=r=>d.value.documentClarity=r)},null,8,["modelValue"]),y[23]||(y[23]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Compliance/Legal team ",-1))]),_:1}),y[24]||(y[24]=e("span",{class:"text-xs text-muted-foreground"},"(Q2 = Not clear at all)",-1))]),e("div",gf,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-poor-support",modelValue:d.value.poorSupport,"onUpdate:modelValue":y[12]||(y[12]=r=>d.value.poorSupport=r)},null,8,["modelValue"]),y[25]||(y[25]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Sales Manager for coaching ",-1))]),_:1}),y[26]||(y[26]=e("span",{class:"text-xs text-muted-foreground"},"(Q5 = 1 star)",-1))])])])])}}},bf={class:"rounded-lg flex flex-col bg-muted"},hf={class:"pt-1 px-1"},xf={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},wf={class:"p-6"},kf={class:"mb-3"},Sf={class:"flex justify-between items-start"},Cf={class:"flex-1"},$f={class:"text-sm text-muted-foreground mt-0.5"},Df={class:"flex flex-wrap gap-3 items-center"},Af={key:0,class:"px-4 py-4 space-y-4"},Of={class:"flex justify-between items-center pt-3"},Tf={class:"flex gap-2"},If={__name:"CFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["close","survey-submitted","survey-cancelled","postpone"],setup(s,{emit:$}){const i=s,l=$,a=Xt(),m=Yt(),d=T(!1),x=T(null),V=C(()=>{var k;return((k=x.value)==null?void 0:k.isValid)||!1}),A=C(()=>{var r;if(!((r=i.opportunity)!=null&&r.contractDate))return 0;const k=new Date(i.opportunity.contractDate),w=Math.abs(new Date-k);return Math.ceil(w/(1e3*60*60*24))}),h=async k=>{var y,w,r,O;try{const N=i.opportunity,{responses:U,triggerActions:M}=k;await a.addActivity(N.id,{type:"contract-feedback-survey",user:((y=m.currentUser)==null?void 0:y.name)||"You",action:"completed post-contract customer experience survey",content:"Post-Contract Customer Experience Survey completed",data:{responses:U,triggerActions:M,timestamp:k.timestamp},timestamp:k.timestamp});const le=[];M.negativeSatisfaction&&le.push(a.addActivity(N.id,{type:"survey-trigger",user:((w=m.currentUser)==null?void 0:w.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager + Regional Manager (Negative satisfaction)",data:{trigger:"negative-satisfaction",recipients:["Sales Manager","Regional Manager"],surveyResponse:U.q1},timestamp:new Date().toISOString()})),M.documentClarity&&le.push(a.addActivity(N.id,{type:"survey-trigger",user:((r=m.currentUser)==null?void 0:r.name)||"You",action:"triggered email notification",content:"Email sent to Compliance/Legal team (Document clarity issues)",data:{trigger:"document-clarity",recipients:["Compliance/Legal team"],surveyResponse:U.q2},timestamp:new Date().toISOString()})),M.poorSupport&&le.push(a.addActivity(N.id,{type:"survey-trigger",user:((O=m.currentUser)==null?void 0:O.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager for coaching (Poor salesperson support)",data:{trigger:"poor-support",recipients:["Sales Manager"],surveyResponse:U.q5},timestamp:new Date().toISOString()})),await Promise.all(le),d.value=!1,l("survey-submitted",{opportunity:N,surveyData:k})}catch(N){console.error("Failed to submit survey:",N)}},g=()=>{x.value&&x.value.submit()},v=()=>{d.value=!1,l("survey-cancelled",{opportunity:i.opportunity})},b=(k,y)=>{d.value=!1,y&&(d.value=!0)};return(k,y)=>(p(),S("div",bf,[e("div",hf,[e("div",xf,[e("div",wf,[e("div",kf,[e("div",Sf,[e("div",Cf,[y[2]||(y[2]=e("h4",{class:"font-bold text-foreground text-sm"},"Contract Feedback",-1)),e("p",$f," Contract was signed "+F(A.value)+" days ago. Follow up on delivery status and collect customer feedback. ",1)])])]),e("div",Df,[n(t(Ue),{variant:"outline","model-value":d.value,"onUpdate:modelValue":y[0]||(y[0]=w=>b("survey",w)),class:"outcome-toggle-item"},{default:o(()=>[...y[3]||(y[3]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["model-value"])])])])]),d.value?(p(),S("div",Af,[n(yf,{ref_key:"surveyRef",ref:x,opportunity:s.opportunity,onSubmit:h,onCancel:v},null,8,["opportunity"]),e("div",Of,[n(t(_),{variant:"secondary",onClick:y[1]||(y[1]=w=>k.$emit("postpone","cfb")),class:"flex items-center gap-2"},{default:o(()=>[...y[4]||(y[4]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("span",null,"Postpone",-1)])]),_:1}),e("div",Tf,[n(t(_),{variant:"secondary",onClick:v},{default:o(()=>[...y[5]||(y[5]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!V.value,onClick:g},{default:o(()=>[...y[6]||(y[6]=[D(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])])):q("",!0)]))}},Vf={class:"space-y-6"},Nf={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Ff={class:"space-y-6"},Uf={class:"space-y-2"},qf=["value"],Lf={class:"text-sm text-foreground"},Pf={class:"space-y-2"},Mf=["value"],Ef={class:"text-sm text-foreground"},Rf={key:0},jf={class:"space-y-2"},Bf=["value"],zf={class:"text-sm text-foreground"},Wf={class:"flex items-center gap-2"},Yf=["onClick"],Hf={key:0,class:"text-sm text-muted-foreground ml-2"},Qf={class:"space-y-2"},Gf=["value"],_f={class:"text-sm text-foreground"},Jf={class:"flex items-center gap-2 mt-2"},Kf={class:"space-y-2"},Zf=["value"],Xf={class:"text-sm text-foreground"},ep={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},tp={class:"space-y-4"},np={class:"flex items-center gap-3"},sp={class:"flex items-center gap-3"},ap={class:"flex items-center gap-3"},lp={class:"flex items-center gap-3"},op={__name:"PostDeliverySurvey",props:{opportunity:{type:Object,required:!0}},emits:["submit","cancel"],setup(s,{expose:$,emit:i}){const l=i,a=T({q1:"",q2:"",q3:"",q4:"",q5:null,q6:[],q6Other:!1,q6OtherText:"",q7:"",q8:""}),m=T({negativeSatisfaction:!1,issuesReported:!1,deliveryDelay:!1,highNPS:!1}),d=[{value:"very-satisfied",label:"Very Satisfied"},{value:"satisfied",label:"Satisfied"},{value:"neutral",label:"Neutral"},{value:"unsatisfied",label:"Unsatisfied"},{value:"very-unsatisfied",label:"Very Unsatisfied"}],x=[{value:"perfect",label:"Yes, perfect condition"},{value:"acceptable",label:"Yes, acceptable"},{value:"minor-issues",label:"There are minor issues"},{value:"major-issues",label:"There are major issues"}],V=[{value:"on-time",label:"Yes, on time"},{value:"early",label:"Yes, early"},{value:"delayed-minor",label:"No, delayed (minor - 1-3 days)"},{value:"delayed-major",label:"No, delayed (major - more than 3 days)"}],A=[{value:"keys",label:"Vehicle keys"},{value:"manual",label:"Owner's manual"},{value:"registration",label:"Registration documents"},{value:"warranty",label:"Service warranty information"},{value:"insurance",label:"Insurance documents"}],h=[{value:"definitely-yes",label:"Definitely Yes"},{value:"probably-yes",label:"Probably Yes"},{value:"not-sure",label:"Not Sure"},{value:"probably-not",label:"Probably Not"},{value:"definitely-not",label:"Definitely Not"}],g=C(()=>a.value.q2==="minor-issues"||a.value.q2==="major-issues");ye(()=>a.value.q1,k=>{k==="very-unsatisfied"||k==="unsatisfied"?m.value.negativeSatisfaction=!0:m.value.negativeSatisfaction=!1}),ye(()=>a.value.q3,k=>{k&&k.trim().length>0?m.value.issuesReported=!0:m.value.issuesReported=!1}),ye(()=>a.value.q4,k=>{k==="delayed-major"?m.value.deliveryDelay=!0:m.value.deliveryDelay=!1}),ye(()=>a.value.q7,k=>{k==="definitely-yes"?m.value.highNPS=!0:m.value.highNPS=!1});const v=C(()=>{var w,r;if(!a.value.q1||!a.value.q2||g.value&&!((w=a.value.q3)!=null&&w.trim()))return!1;const k=a.value.q6&&a.value.q6.length>0,y=a.value.q6Other&&((r=a.value.q6OtherText)==null?void 0:r.trim());return!(!k&&!y)});return $({submit:()=>{if(!v.value)return;const k={responses:{...a.value},triggerActions:{...m.value},timestamp:new Date().toISOString()};l("submit",k)},isValid:v}),(k,y)=>(p(),S("div",Vf,[e("div",Nf,[y[22]||(y[22]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Post-Delivery Customer Satisfaction Survey",-1)),e("div",Ff,[e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[13]||(y[13]=[D(" How satisfied are you with your new vehicle delivery experience? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Uf,[(p(),S(be,null,Oe(d,w=>e("label",{key:w.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q1===w.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[0]||(y[0]=r=>a.value.q1=r),type:"radio",value:w.value,class:"shrink-0"},null,8,qf),[[ut,a.value.q1]]),e("span",Lf,F(w.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[14]||(y[14]=[D(" Is the vehicle in the condition you expected? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Pf,[(p(),S(be,null,Oe(x,w=>e("label",{key:w.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q2===w.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[1]||(y[1]=r=>a.value.q2=r),type:"radio",value:w.value,class:"shrink-0"},null,8,Mf),[[ut,a.value.q2]]),e("span",Ef,F(w.label),1)],2)),64))])]),g.value?(p(),S("div",Rf,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[15]||(y[15]=[D(" Please describe the issues you found: ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(Xe),{modelValue:a.value.q3,"onUpdate:modelValue":y[2]||(y[2]=w=>a.value.q3=w),rows:"4",placeholder:"Describe the issues...",class:"w-full"},null,8,["modelValue"])])):q("",!0),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[16]||(y[16]=[D(" Was the vehicle delivered on the scheduled date? ",-1)])]),_:1}),e("div",jf,[(p(),S(be,null,Oe(V,w=>e("label",{key:w.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q4===w.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[3]||(y[3]=r=>a.value.q4=r),type:"radio",value:w.value,class:"shrink-0"},null,8,Bf),[[ut,a.value.q4]]),e("span",zf,F(w.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[17]||(y[17]=[D(" How would you rate the professionalism of our sales team during delivery? ",-1)])]),_:1}),e("div",Wf,[(p(),S(be,null,Oe(5,w=>e("button",{key:w,onClick:r=>a.value.q5=w,class:se(["text-2xl transition-colors",a.value.q5>=w?"text-yellow-500":"text-gray-300"])}," ⭐ ",10,Yf)),64)),a.value.q5?(p(),S("span",Hf,F(a.value.q5)+" "+F(a.value.q5===1?"star":"stars"),1)):q("",!0)])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[18]||(y[18]=[D(" Did you receive all the required items? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Qf,[(p(),S(be,null,Oe(A,w=>e("label",{key:w.value,class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors"},[ke(e("input",{"onUpdate:modelValue":y[4]||(y[4]=r=>a.value.q6=r),type:"checkbox",value:w.value,class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,8,Gf),[[wt,a.value.q6]]),e("span",_f,F(w.label),1)])),64)),e("div",Jf,[ke(e("input",{"onUpdate:modelValue":y[5]||(y[5]=w=>a.value.q6Other=w),type:"checkbox",class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[wt,a.value.q6Other]]),y[19]||(y[19]=e("span",{class:"text-sm text-foreground"},"Other:",-1)),a.value.q6Other?(p(),K(t(qe),{key:0,modelValue:a.value.q6OtherText,"onUpdate:modelValue":y[6]||(y[6]=w=>a.value.q6OtherText=w),placeholder:"Specify other item",class:"flex-1"},null,8,["modelValue"])):q("",!0)])])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[20]||(y[20]=[D(" Would you recommend our dealership to friends and family? ",-1)])]),_:1}),e("div",Kf,[(p(),S(be,null,Oe(h,w=>e("label",{key:w.value,class:se(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",a.value.q7===w.value?"border-2 border-brand-blue bg-muted/50":"border border-border hover:bg-muted/50"])},[ke(e("input",{"onUpdate:modelValue":y[7]||(y[7]=r=>a.value.q7=r),type:"radio",value:w.value,class:"shrink-0"},null,8,Zf),[[ut,a.value.q7]]),e("span",Xf,F(w.label),1)],2)),64))])]),e("div",null,[n(t(B),{class:"form-label mb-2"},{default:o(()=>[...y[21]||(y[21]=[D(" Internal notes for follow-up actions: ",-1),e("span",{class:"text-xs text-muted-foreground ml-1"},"(Private - only for internal staff)",-1)])]),_:1}),n(t(Xe),{modelValue:a.value.q8,"onUpdate:modelValue":y[8]||(y[8]=w=>a.value.q8=w),rows:"4",placeholder:"Add internal notes...",class:"w-full"},null,8,["modelValue"])])])]),e("div",ep,[y[31]||(y[31]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Trigger Actions (Email Notifications)",-1)),e("div",tp,[e("div",np,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-negative-satisfaction",modelValue:m.value.negativeSatisfaction,"onUpdate:modelValue":y[9]||(y[9]=w=>m.value.negativeSatisfaction=w)},null,8,["modelValue"]),y[23]||(y[23]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Sales Manager + Branch Manager ",-1))]),_:1}),y[24]||(y[24]=e("span",{class:"text-xs text-muted-foreground"},"(Q1 = Very Unsatisfied/Unsatisfied)",-1))]),e("div",sp,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-issues",modelValue:m.value.issuesReported,"onUpdate:modelValue":y[10]||(y[10]=w=>m.value.issuesReported=w)},null,8,["modelValue"]),y[25]||(y[25]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Service Department ",-1))]),_:1}),y[26]||(y[26]=e("span",{class:"text-xs text-muted-foreground"},"(Q3 = Issues reported)",-1))]),e("div",ap,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-delay",modelValue:m.value.deliveryDelay,"onUpdate:modelValue":y[11]||(y[11]=w=>m.value.deliveryDelay=w)},null,8,["modelValue"]),y[27]||(y[27]=e("span",{class:"text-sm font-medium text-foreground"}," ⚠️ Email to Delivery Coordinator ",-1))]),_:1}),y[28]||(y[28]=e("span",{class:"text-xs text-muted-foreground"},"(Q4 = Delayed major)",-1))]),e("div",lp,[n(t(B),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-muted/50 transition-colors flex-1"},{default:o(()=>[n(t(zt),{id:"trigger-nps",modelValue:m.value.highNPS,"onUpdate:modelValue":y[12]||(y[12]=w=>m.value.highNPS=w)},null,8,["modelValue"]),y[29]||(y[29]=e("span",{class:"text-sm font-medium text-foreground"}," ✅ Email to Marketing ",-1))]),_:1}),y[30]||(y[30]=e("span",{class:"text-xs text-muted-foreground"},"(Q7 = Definitely Yes)",-1))])])])]))}},ip={class:"rounded-lg flex flex-col bg-muted"},rp={class:"pt-1 px-1"},up={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},dp={class:"p-6"},cp={class:"mb-3"},mp={class:"flex justify-between items-start"},fp={class:"flex-1"},pp={class:"font-bold text-foreground text-sm"},vp={class:"text-sm text-muted-foreground mt-0.5"},gp={class:"flex flex-wrap gap-3 items-center"},yp={key:0,class:"px-4 py-4 space-y-4"},bp={class:"flex justify-end gap-2 pt-3"},hp={key:1,class:"px-4 py-4 space-y-4"},xp={class:"space-y-4"},wp=["min"],kp={class:"flex justify-end gap-2 pt-3"},Sp={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["close","survey-submitted","survey-cancelled","postpone","reschedule-delivery"],setup(s,{emit:$}){const i=s,l=$,a=Xt(),m=Yt(),d=T(!1),x=T(!1),V=T(null),A=C(()=>ja(i.opportunity,i.activities)),h=C(()=>A.value==="Awaiting Delivery"),g=C(()=>{var U;return((U=V.value)==null?void 0:U.isValid)||!1}),v=T({newDeliveryDate:"",reason:""}),b=C(()=>{const U=new Date;return U.setDate(U.getDate()+1),U.toISOString().split("T")[0]}),k=C(()=>!!v.value.newDeliveryDate),y=async U=>{var M,le,R,E,G;try{const z=i.opportunity,{responses:Q,triggerActions:de}=U;await a.addActivity(z.id,{type:"post-delivery-survey",user:((M=m.currentUser)==null?void 0:M.name)||"You",action:"completed post-delivery customer satisfaction survey",content:"Post-Delivery Customer Satisfaction Survey completed",data:{responses:Q,triggerActions:de,timestamp:U.timestamp},timestamp:U.timestamp});const J=[];de.negativeSatisfaction&&J.push(a.addActivity(z.id,{type:"survey-trigger",user:((le=m.currentUser)==null?void 0:le.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager + Branch Manager (Negative satisfaction)",data:{trigger:"negative-satisfaction",recipients:["Sales Manager","Branch Manager"],surveyResponse:Q.q1},timestamp:new Date().toISOString()})),de.issuesReported&&J.push(a.addActivity(z.id,{type:"survey-trigger",user:((R=m.currentUser)==null?void 0:R.name)||"You",action:"triggered email notification",content:"Email sent to Service Department (Issues reported)",data:{trigger:"issues-reported",recipients:["Service Department"],issueDescription:Q.q3},timestamp:new Date().toISOString()})),de.deliveryDelay&&J.push(a.addActivity(z.id,{type:"survey-trigger",user:((E=m.currentUser)==null?void 0:E.name)||"You",action:"triggered email notification",content:"Email sent to Delivery Coordinator (Major delivery delay)",data:{trigger:"delivery-delay",recipients:["Delivery Coordinator"],surveyResponse:Q.q4},timestamp:new Date().toISOString()})),de.highNPS&&J.push(a.addActivity(z.id,{type:"survey-trigger",user:((G=m.currentUser)==null?void 0:G.name)||"You",action:"triggered email notification",content:"Email sent to Marketing (High NPS - Definitely Yes)",data:{trigger:"high-nps",recipients:["Marketing"],surveyResponse:Q.q7},timestamp:new Date().toISOString()})),await Promise.all(J),d.value=!1,l("survey-submitted",{opportunity:z,surveyData:U})}catch(z){console.error("Failed to submit survey:",z)}},w=()=>{V.value&&V.value.submit()},r=()=>{d.value=!1,l("survey-cancelled",{opportunity:i.opportunity})},O=()=>{x.value=!1,v.value={newDeliveryDate:"",reason:""}},N=async()=>{try{l("reschedule-delivery",{opportunity:i.opportunity,newDeliveryDate:v.value.newDeliveryDate,reason:v.value.reason}),x.value=!1,v.value={newDeliveryDate:"",reason:""}}catch(U){console.error("Failed to reschedule delivery:",U)}};return(U,M)=>(p(),S("div",ip,[e("div",rp,[e("div",up,[e("div",dp,[e("div",cp,[e("div",mp,[e("div",fp,[e("h4",pp,F(h.value?"Delivery Delay Feedback":"Post-Delivery Customer Satisfaction Survey"),1),e("p",vp,F(h.value?"Get feedback on delivery delay and check progress":"Collect feedback from the customer about their delivery experience"),1)]),e("button",{onClick:M[0]||(M[0]=le=>U.$emit("postpone","dfb")),class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted ml-4"},[...M[5]||(M[5]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("span",null,"Postpone",-1)])])])]),e("div",gp,[n(t(Ue),{variant:"outline","model-value":d.value,"onUpdate:modelValue":M[1]||(M[1]=le=>d.value=le),class:"outcome-toggle-item"},{default:o(()=>[...M[6]||(M[6]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["model-value"]),h.value?(p(),K(t(Ue),{key:0,variant:"outline","model-value":x.value,"onUpdate:modelValue":M[2]||(M[2]=le=>x.value=le),class:"outcome-toggle-item"},{default:o(()=>[...M[7]||(M[7]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),e("span",null,"Reschedule Delivery",-1)])]),_:1},8,["model-value"])):q("",!0)])])])]),d.value?(p(),S("div",yp,[n(op,{ref_key:"surveyRef",ref:V,opportunity:s.opportunity,onSubmit:y,onCancel:r},null,8,["opportunity"]),e("div",bp,[n(t(_),{variant:"secondary",onClick:r},{default:o(()=>[...M[8]||(M[8]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!g.value,onClick:w},{default:o(()=>[...M[9]||(M[9]=[D(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])):q("",!0),x.value?(p(),S("div",hp,[e("div",xp,[e("div",null,[M[10]||(M[10]=e("label",{class:"block text-sm font-medium text-foreground mb-2"},"New Delivery Date",-1)),ke(e("input",{"onUpdate:modelValue":M[3]||(M[3]=le=>v.value.newDeliveryDate=le),type:"date",min:b.value,class:"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground"},null,8,wp),[[Xn,v.value.newDeliveryDate]])]),e("div",null,[M[11]||(M[11]=e("label",{class:"block text-sm font-medium text-foreground mb-2"},"Reason (Optional)",-1)),ke(e("textarea",{"onUpdate:modelValue":M[4]||(M[4]=le=>v.value.reason=le),rows:"3",class:"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground",placeholder:"Reason for rescheduling..."},null,512),[[Xn,v.value.reason]])])]),e("div",kp,[n(t(_),{variant:"secondary",onClick:O},{default:o(()=>[...M[12]||(M[12]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!k.value,onClick:N},{default:o(()=>[...M[13]||(M[13]=[D(" Reschedule Delivery ",-1)])]),_:1},8,["disabled"])])])):q("",!0)]))}},Cp={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(s,{emit:$}){const i=s,l=$;xs();const a=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],m=C(()=>{const v=i.opportunity.lastActivity||i.opportunity.createdAt;if(!v)return 0;const b=new Date(v),y=Math.abs(new Date-b);return Math.ceil(y/(1e3*60*60*24))}),d=()=>{l("reopen",i.opportunity)},x=()=>{l("close-lost",{opportunity:i.opportunity,reason:"Abandoned - no activity for extended period"})},V=()=>{l("requalify",i.opportunity)},A=v=>{l("survey-completed",{opportunity:i.opportunity,responses:v})},h=()=>{l("survey-refused",{opportunity:i.opportunity})},g=()=>{l("not-responding",{opportunity:i.opportunity})};return(v,b)=>(p(),K(_s,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${m.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-muted/50",border:"border"}},{actions:o(()=>[e("button",{onClick:d,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors"},[...b[0]||(b[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),D(" Reopen Opportunity ",-1)])]),e("button",{onClick:x,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),D(" Close as Lost ",-1)])]),e("button",{onClick:V,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-xs flex items-center gap-2 transition-colors hover:bg-muted"},[...b[2]||(b[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),D(" Requalify as Lead ",-1)])])]),survey:o(()=>[n(Js,{questions:a,onSurveyCompleted:A,onSurveyRefused:h,onNotResponding:g})]),_:1},8,["description"]))}},$p={OOFB:mm,UFB:fm,NFU:wm,OFB:ul,CFB:If,DFB:Sp,ABANDONED:Cp};function Dp(s,$,i,l,a){const m=C(()=>{const v=ys(s),b=ys($),k=ys(i);return{opportunity:v,scheduledAppointment:b,activities:k,hasOffers:v.offers&&v.offers.length>0||(k==null?void 0:k.some(y=>y.type==="offer"))||!1,stage:v.displayStage||v.stage,deliverySubstatus:v.deliverySubstatus||null,formatDateTime:a,hasActiveTaskWidget:!1}}),d=C(()=>{const v=m.value,b=Jo(v.stage,v);if(!b)return null;const k=$p[b];return k?{type:b,component:k,props:{opportunity:v.opportunity,appointment:v.scheduledAppointment,activities:v.activities}}:null}),x=C(()=>({...m.value,hasActiveTaskWidget:!!d.value})),V=C(()=>{const v=x.value,b=Ko(v.stage,v);if(!b)return null;const k=l[b.key];return{...b,handler:k||(()=>{})}}),A=C(()=>{var y;const v=x.value,b=Zo(v.stage,v),k=(y=V.value)==null?void 0:y.key;return b.filter(w=>w.key!==k).map(w=>{const r=l[w.key];return{...w,handler:r||(()=>{})}})}),h=C(()=>{const v=m.value;return Xo(v.stage)}),g=C(()=>!d.value||!d.value.type?"":ei(d.value.type));return{primaryAction:V,secondaryActions:A,activeTaskWidget:d,taskWidgetTitle:g,isClosed:h}}const Ap={name:"MotorK Dealership",address:{street:"123 Automotive Boulevard",city:"Berlin",postalCode:"10115",country:"Germany"},phone:"+49 30 12345678",email:"info@motork.de",vatNumber:"DE123456789",registrationNumber:"HRB 12345 B",website:"www.motork.de"},Op=[{id:"contract-classic",name:"Contract - Classic",type:"contract",style:"classic",description:"Detailed contract with comprehensive information and legal sections"},{id:"contract-express",name:"Contract - Express",type:"contract",style:"express",description:"Streamlined contract with essential information"},{id:"offer-classic",name:"Offer - Classic",type:"offer",style:"classic",description:"Detailed offer with VAT table, trade-in section, and vehicle images"},{id:"offer-express",name:"Offer - Express",type:"offer",style:"express",description:"Simplified offer with condensed layout for stock vehicles"}];function Ys(){const s=`%PDF-1.4
1 0 obj
<<
/Type /Catalog
/Pages 2 0 R
>>
endobj
2 0 obj
<<
/Type /Pages
/Kids [3 0 R]
/Count 1
>>
endobj
3 0 obj
<<
/Type /Page
/Parent 2 0 R
/MediaBox [0 0 612 792]
/Contents 4 0 R
/Resources <<
/Font <<
/F1 <<
/Type /Font
/Subtype /Type1
/BaseFont /Helvetica
>>
>>
>>
>>
endobj
4 0 obj
<<
/Length 44
>>
stream
BT
/F1 12 Tf
100 700 Td
(Mock PDF Document) Tj
ET
endstream
endobj
xref
0 5
0000000000 65535 f 
0000000009 00000 n 
0000000058 00000 n 
0000000115 00000 n 
0000000306 00000 n 
trailer
<<
/Size 5
/Root 1 0 R
>>
startxref
390
%%EOF`;return new Blob([s],{type:"application/pdf"})}class dl extends wo{constructor(){super([])}async generatePDF($){await new Promise(m=>setTimeout(m,1500));const i=`pdf-${Date.now()}`,l=Ys(),a=URL.createObjectURL(l);return{id:i,url:a,blob:l,template:$.template,language:$.language,generatedAt:new Date().toISOString(),expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()}}async previewPDF($){await new Promise(a=>setTimeout(a,1200));const i=Ys();return{previewUrl:URL.createObjectURL(i),blob:i,template:$.template,language:$.language,expiresAt:new Date(Date.now()+60*60*1e3).toISOString()}}async getTemplates(){return await new Promise($=>setTimeout($,300)),[...Op]}async sendPDFByEmail($,i){return await new Promise(l=>setTimeout(l,800)),{success:!0,pdfId:$,sentTo:i.to,sentAt:new Date().toISOString()}}async downloadPDF($){return await new Promise(i=>setTimeout(i,500)),Ys()}async getSellerInfo(){return await new Promise($=>setTimeout($,200)),{...Ap}}}const Tp=Object.freeze(Object.defineProperty({__proto__:null,ContractRepository:dl},Symbol.toStringTag,{value:"Module"})),Nn=new dl,Ma=new ko,Ea=new So;class Ip{async prepareContractData($,i={}){if(!$)throw new Error("Opportunity is required");const l=await Nn.getSellerInfo(),a=Ma.findByIdSync($.customerId);if(!a)throw new Error("Customer not found");const m=await Ea.findAllByOpportunityId($.id),d=m.find(b=>b.type==="trade-in"),x=m.find(b=>b.type==="financing"),V=$.selectedVehicle||$.vehicle||$.requestedCar,A=this.formatPricing($,null,d),h=this.formatPaymentTerms(x,$),g=this.getEquipment(V);return{seller:{name:l.name,address:l.address,phone:l.phone,email:l.email,vatNumber:l.vatNumber,registrationNumber:l.registrationNumber,website:l.website},buyer:{name:a.name,email:a.email,phone:a.phone,address:a.address||"",company:a.company||null},vehicle:V?{brand:V.brand,model:V.model,year:V.year,fuelType:V.fuelType,gearType:V.gearType,kilometers:V.kilometers||0,vin:V.vin||"",image:V.image||null,color:V.color||"",status:V.status||"New"}:null,pricing:A,paymentTerms:h,equipment:g,termsAndConditions:i.includeTermsAndConditions?this.getTermsAndConditions(i.language):null,contractDate:$.contractDate||new Date().toISOString().split("T")[0],signatureArea:!0}}async prepareOfferData($,i,l={}){if(!$)throw new Error("Opportunity is required");if(!i)throw new Error("Offer is required");const a=await Nn.getSellerInfo(),m=Ma.findByIdSync($.customerId);if(!m)throw new Error("Customer not found");const d=await Ea.findAllByOpportunityId($.id),x=d.find(k=>k.type==="trade-in"),V=d.find(k=>k.type==="financing"),A=i.data||i.vehicle||i,h=this.formatPricing($,i,x),g=this.formatPaymentTerms(V,$),v=this.getEquipment(A);return{seller:{name:a.name,address:a.address,phone:a.phone,email:a.email,vatNumber:a.vatNumber,registrationNumber:a.registrationNumber,website:a.website},buyer:{name:m.name,email:m.email,phone:m.phone,address:m.address||"",company:m.company||null},vehicle:{brand:A.brand,model:A.model,year:A.year,fuelType:A.fuelType,gearType:A.gearType,kilometers:A.kilometers||0,vin:A.vin||"",image:A.image||null,color:A.color||"",status:A.status||"New"},pricing:h,paymentTerms:g,equipment:v,termsAndConditions:l.includeTermsAndConditions?this.getTermsAndConditions(l.language):null,contractDate:null,signatureArea:!1}}formatPricing($,i=null,l=null){var h,g,v;const a=(i==null?void 0:i.price)||((h=i==null?void 0:i.data)==null?void 0:h.price)||$.value||0,m=.19,d=a*m,x=a+d,V=((g=l==null?void 0:l.data)==null?void 0:g.tradeInValue)||((v=l==null?void 0:l.data)==null?void 0:v.value)||0,A=x-V;return{basePrice:a,vatRate:m*100,vatAmount:d,totalWithVAT:x,tradeInValue:V,netAmount:A,currency:"EUR"}}formatPaymentTerms($=null,i=null){if(!$||!$.data)return{method:"cash",deposit:0,loanAmount:0,productName:null,startDate:null,expDate:null};const l=$.data;return{method:"financing",deposit:l.deposit||0,loanAmount:l.loanAmount||l.total||0,productName:l.productName||l.product||null,startDate:l.startDate||null,expDate:l.expDate||null}}getEquipment($){if(!$)return[];const i=[];return $.equipment&&Array.isArray($.equipment)?$.equipment:($.options&&Object.entries($.options).forEach(([l,a])=>{a&&i.push({name:l,value:a})}),i)}getTermsAndConditions($="en"){const i={en:"Terms and conditions apply. Please refer to the full contract for detailed terms.",de:"Es gelten die Allgemeinen Geschäftsbedingungen. Bitte beachten Sie den vollständigen Vertrag für detaillierte Bedingungen.",fr:"Les termes et conditions s'appliquent. Veuillez vous référer au contrat complet pour les termes détaillés.",it:"Si applicano i termini e le condizioni. Si prega di fare riferimento al contratto completo per i termini dettagliati.",nl:"Algemene voorwaarden zijn van toepassing. Raadpleeg het volledige contract voor gedetailleerde voorwaarden."};return i[$]||i.en}async generatePDF($,i,l){return await Nn.generatePDF({template:$,language:i,data:l})}async previewPDF($,i,l){return await Nn.previewPDF({template:$,language:i,data:l})}async getTemplates(){return await Nn.getTemplates()}async sendPDFByEmail($,i){return await Nn.sendPDFByEmail($,i)}}const Wt=new Ip,Cn=(s=300)=>new Promise($=>setTimeout($,s)),Vp=async(s,$={})=>{await Cn();const i=await ws.findById(s);if(!i)throw new Error("Opportunity not found");const l=await Wt.prepareContractData(i,$),a=`contract-${$.template||"classic"}`;return await Wt.generatePDF(a,$.language||"en",l)},Np=async(s,$,i={})=>{await Cn();const l=await ws.findById(s);if(!l)throw new Error("Opportunity not found");let a=null;if(l.offers&&Array.isArray(l.offers)&&(a=l.offers.find(x=>x.id===$||x.id===String($))),!a&&l.activities){const x=l.activities.find(V=>V.type==="offer"&&(V.id===$||V.id===String($)));x&&(a=x)}if(!a)throw new Error("Offer not found");const m=await Wt.prepareOfferData(l,a,i),d=`offer-${i.template||"classic"}`;return await Wt.generatePDF(d,i.language||"en",m)},Fp=async(s,$={})=>{await Cn();const i=await ws.findById(s);if(!i)throw new Error("Opportunity not found");const l=await Wt.prepareContractData(i,$),a=`contract-${$.template||"classic"}`;return await Wt.previewPDF(a,$.language||"en",l)},Up=async(s,$,i={})=>{await Cn();const l=await ws.findById(s);if(!l)throw new Error("Opportunity not found");let a=null;if(l.offers&&Array.isArray(l.offers)&&(a=l.offers.find(x=>x.id===$||x.id===String($))),!a&&l.activities){const x=l.activities.find(V=>V.type==="offer"&&(V.id===$||V.id===String($)));x&&(a=x)}if(!a)throw new Error("Offer not found");const m=await Wt.prepareOfferData(l,a,i),d=`offer-${i.template||"classic"}`;return await Wt.previewPDF(d,i.language||"en",m)},qp=async()=>(await Cn(),await Wt.getTemplates()),Lp=async(s,$)=>(await Cn(),await Wt.sendPDFByEmail(s,$)),Pp=async s=>{await Cn();const{ContractRepository:$}=await xn(async()=>{const{ContractRepository:l}=await Promise.resolve().then(()=>Tp);return{ContractRepository:l}},void 0);return await new $().downloadPDF(s)},Mp=Co("contracts",()=>{const s=T([]),$=T([]),i=T(!1),l=T(null),a=T(null),m=C(()=>$.value),d=C(()=>$.value.length>0),x=C(()=>i.value);return{generatedPDFs:s,templates:$,loading:i,error:l,previewPDF:a,availableTemplates:m,hasTemplates:d,isLoading:x,fetchTemplates:async()=>{i.value=!0,l.value=null;try{return $.value=await qp(),$.value}catch(r){throw l.value=r.message,r}finally{i.value=!1}},generateContractPDF:async(r,O={})=>{i.value=!0,l.value=null;try{const N=await Vp(r,O);return s.value.push({id:N.id,opportunityId:r,type:"contract",...N,options:O}),N}catch(N){throw l.value=N.message,N}finally{i.value=!1}},generateOfferPDF:async(r,O,N={})=>{i.value=!0,l.value=null;try{const U=await Np(r,O,N);return s.value.push({id:U.id,opportunityId:r,offerId:O,type:"offer",...U,options:N}),U}catch(U){throw l.value=U.message,U}finally{i.value=!1}},previewContractPDF:async(r,O={})=>{i.value=!0,l.value=null;try{const N=await Fp(r,O);return a.value={opportunityId:r,type:"contract",...N,options:O},N}catch(N){throw l.value=N.message,N}finally{i.value=!1}},previewOfferPDF:async(r,O,N={})=>{i.value=!0,l.value=null;try{const U=await Up(r,O,N);return a.value={opportunityId:r,offerId:O,type:"offer",...U,options:N},U}catch(U){throw l.value=U.message,U}finally{i.value=!1}},downloadPDF:async r=>{i.value=!0,l.value=null;try{const O=await Pp(r),N=URL.createObjectURL(O),U=document.createElement("a");U.href=N,U.download=`contract-${r}.pdf`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(N)}catch(O){throw l.value=O.message,O}finally{i.value=!1}},sendPDFByEmail:async(r,O)=>{i.value=!0,l.value=null;try{return await Lp(r,O)}catch(N){throw l.value=N.message,N}finally{i.value=!1}},clearPreview:()=>{var r;(r=a.value)!=null&&r.previewUrl&&URL.revokeObjectURL(a.value.previewUrl),a.value=null},clearError:()=>{l.value=null}}});function Ss(){const s=Mp(),$=xs(),i=T(!1),l=T(!1),a=T(null),m=()=>{const y=$.settings;return{template:y.defaultPDFTemplate||"classic",language:y.defaultPDFLanguage||"en",includeTermsAndConditions:y.defaultIncludeTermsAndConditions??!0,includeDisclaimerPage:y.defaultIncludeDisclaimerPage??!0}},d=async(y,w={})=>{i.value=!0,a.value=null;try{const r={...m(),...w};return await s.generateContractPDF(y,r)}catch(r){throw a.value=r.message,r}finally{i.value=!1}},x=async(y,w,r={})=>{i.value=!0,a.value=null;try{const O={...m(),...r,includeDisclaimerPage:!1};return await s.generateOfferPDF(y,w,O)}catch(O){throw a.value=O.message,O}finally{i.value=!1}},V=async(y,w={})=>{l.value=!0,a.value=null;try{const r={...m(),...w};return await s.previewContractPDF(y,r)}catch(r){throw a.value=r.message,r}finally{l.value=!1}},A=async(y,w,r={})=>{l.value=!0,a.value=null;try{const O={...m(),...r,includeDisclaimerPage:!1};return await s.previewOfferPDF(y,w,O)}catch(O){throw a.value=O.message,O}finally{l.value=!1}},h=async y=>{try{await s.downloadPDF(y)}catch(w){throw a.value=w.message,w}},g=async(y,w)=>{try{return await s.sendPDFByEmail(y,w)}catch(r){throw a.value=r.message,r}},v=()=>{a.value=null,s.clearError()},b=()=>{s.clearPreview()},k=async()=>{s.hasTemplates||await s.fetchTemplates()};return{isGenerating:C(()=>i.value),isPreviewing:C(()=>l.value),isLoading:C(()=>s.isLoading),error:C(()=>a.value||s.error),previewPDF:C(()=>s.previewPDF),templates:C(()=>s.availableTemplates),generateContractPDF:d,generateOfferPDF:x,previewContractPDF:V,previewOfferPDF:A,downloadPDF:h,sendPDFByEmail:g,clearError:v,clearPreview:b,ensureTemplatesLoaded:k,getDefaultOptions:m}}function cl(s="",$=""){const i=T(s),l=T($),a=T(null);function m(){var d;i.value="",l.value="",(d=a.value)==null||d.reset()}return{reason:i,notes:l,cardRef:a,reset:m}}const Ep={class:"relative"},Rp=["disabled"],jp=["onClick","disabled"],Un={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(s,{emit:$}){const i=s,l=$,a=T(!1),m=()=>{a.value=!a.value},d=()=>{a.value=!1},x=A=>{A.disabled||(d(),l("action-selected",A),A.handler&&typeof A.handler=="function"&&A.handler())},V=C(()=>(i.actions||[]).map(A=>({key:A.key,label:A.label,disabled:!!A.disabled,onClick:()=>x(A)})));return(A,h)=>{const g=hs("click-outside");return p(),S("div",Ep,[e("button",{onClick:pn(m,["stop"]),class:"w-auto bg-surface hover:bg-muted border border-border text-muted-foreground font-medium px-4 py-2 rounded-lg text-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!s.actions||s.actions.length===0},[h[1]||(h[1]=e("span",null,"More actions",-1)),e("i",{class:se(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":a.value}])},null,2)],8,Rp),a.value&&V.value.length>0?ke((p(),S("div",{key:0,class:"absolute right-0 top-full mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:h[0]||(h[0]=pn(()=>{},["stop"]))},[(p(!0),S(be,null,Oe(V.value,v=>(p(),S("button",{key:v.key,onClick:v.onClick,disabled:v.disabled,class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},F(v.label),9,jp))),128))])),[[g,d]]):q("",!0)])}}},Bp={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},zp={class:"space-y-2"},Wp={class:"space-y-2"},Yp={class:"space-y-2"},Hp={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=s,l=$,a=T(""),m=T(""),d=T(""),x=C(()=>new Date().toISOString().split("T")[0]);ye(()=>i.show,g=>{if(g){const v=new Date;a.value=v.toISOString().split("T")[0],m.value=v.toTimeString().slice(0,5),d.value=""}});const V=()=>{if(!a.value)return;const g=m.value?`${a.value}T${m.value}:00`:`${a.value}T12:00:00`;l("confirm",{contractDate:g,notes:d.value})},A=()=>{l("cancel")},h=g=>{g||A()};return(g,v)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":h},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...v[3]||(v[3]=[D("Set Contract Signing Date",-1)])]),_:1})]),_:1}),e("div",Bp,[e("div",zp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...v[4]||(v[4]=[D("Contract Date",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=b=>a.value=b),max:x.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Wp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...v[5]||(v[5]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=b=>m.value=b),class:"w-full h-10"},null,8,["modelValue"])]),e("div",Yp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...v[6]||(v[6]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=b=>d.value=b),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:A}),n(t(_),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value,onClick:V},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Qp={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Gp={class:"space-y-2"},_p={class:"space-y-2"},Jp={class:"space-y-2"},Kp={class:"space-y-2"},Zp={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=s,l=$,a=T(""),m=T(""),d=T(""),x=T(""),V=C(()=>new Date().toISOString().split("T")[0]);ye(()=>i.show,v=>{if(v){const b=new Date;a.value=b.toISOString().split("T")[0],m.value=b.toTimeString().slice(0,5),d.value="",x.value=""}});const A=()=>{if(!a.value||!d.value)return;const v=m.value?`${a.value}T${m.value}:00`:`${a.value}T12:00:00`;l("confirm",{deliveryDate:v,location:d.value,notes:x.value})},h=()=>{l("cancel")},g=v=>{v||h()};return(v,b)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":g},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...b[4]||(b[4]=[D("Mark as Delivered",-1)])]),_:1})]),_:1}),e("div",Qp,[e("div",Gp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...b[5]||(b[5]=[D("Delivery Date",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=k=>a.value=k),max:V.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",_p,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...b[6]||(b[6]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:m.value,"onUpdate:modelValue":b[1]||(b[1]=k=>m.value=k),class:"w-full h-10"},null,8,["modelValue"])]),e("div",Jp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...b[7]||(b[7]=[D("Delivery Location",-1)])]),_:1}),n(t($t),{modelValue:d.value,"onUpdate:modelValue":b[2]||(b[2]=k=>d.value=k)},{default:o(()=>[n(t(kt),{class:"w-full h-10"},{default:o(()=>[n(t(St),{placeholder:"Select location..."})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Dealership"},{default:o(()=>[...b[8]||(b[8]=[D("At Dealership",-1)])]),_:1}),n(t(he),{value:"Customer Address"},{default:o(()=>[...b[9]||(b[9]=[D("Customer Address",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...b[10]||(b[10]=[D("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Kp,[n(t(B),{class:"block text-sm font-semibold text-foreground"},{default:o(()=>[...b[11]||(b[11]=[D("Delivery Notes",-1)])]),_:1}),n(t(Xe),{modelValue:x.value,"onUpdate:modelValue":b[3]||(b[3]=k=>x.value=k),rows:"4",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:h}),n(t(_),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value||!d.value,onClick:A},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Xp={class:"space-y-4"},ev={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},tv={class:"space-y-4"},nv={class:"flex justify-end gap-2"},Ks={__name:"CloseAsLostCard",props:{preselectedReason:{type:String,default:""},preselectedNotes:{type:String,default:""}},emits:["cancel","confirm"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=T(l.preselectedReason||""),x=T(l.preselectedNotes||"");ye(()=>l.preselectedReason,v=>{v&&(d.value=v)}),ye(()=>l.preselectedNotes,v=>{v&&(x.value=v)});const V=C(()=>!!d.value);function A(){d.value="",x.value="",a("cancel")}function h(){V.value&&a("confirm",{reason:d.value,notes:x.value})}function g(){d.value="",x.value=""}return $({closeAsLostFormRef:m,reason:d,notes:x,canSubmit:V,reset:g}),(v,b)=>(p(),S("div",Xp,[e("div",ev,[b[3]||(b[3]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Close Opportunity as Lost",-1)),e("div",tv,[n(ks,{ref_key:"closeAsLostFormRef",ref:m,"preselected-reason":d.value,"onUpdate:reason":b[0]||(b[0]=k=>{d.value.value=k})},null,8,["preselected-reason"]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[2]||(b[2]=[D("Additional Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:x.value,"onUpdate:modelValue":b[1]||(b[1]=k=>x.value=k),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"w-full"},null,8,["modelValue"])])])]),e("div",nv,[n(t(_),{variant:"secondary",onClick:A},{default:o(()=>[...b[4]||(b[4]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!V.value,onClick:h,class:"!bg-red-600 !hover:bg-red-700 !text-white"},{default:o(()=>[...b[5]||(b[5]=[D(" Close as Lost ",-1)])]),_:1},8,["disabled"])])]))}},sv={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=$,l=a=>{a||i("cancel")};return(a,m)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":l},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...m[2]||(m[2]=[D("Requalify as Lead",-1)])]),_:1})]),_:1}),m[3]||(m[3]=e("div",{class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),D(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-muted-foreground"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),D(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-muted-foreground"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),D(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m[0]||(m[0]=d=>a.$emit("cancel"))}),n(t(_),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:m[1]||(m[1]=d=>a.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},av={class:"flex-1 overflow-y-auto p-6 w-full space-y-6"},lv={key:0,class:"bg-muted rounded-lg p-4 border border-border"},ov={class:"space-y-2 text-sm"},iv={class:"flex items-center gap-2"},rv={class:"text-foreground"},uv={key:0,class:"flex items-center gap-2"},dv={class:"text-foreground"},cv={key:1,class:"flex items-center gap-2"},mv={class:"text-foreground"},fv={key:1,class:"bg-muted rounded-lg p-4 border border-border"},pv={class:"space-y-2 text-sm"},vv={class:"flex items-center gap-2"},gv={class:"text-foreground"},yv={class:"flex items-center gap-2"},bv={class:"text-foreground font-semibold"},hv={key:0,class:"flex items-center gap-2"},xv={class:"text-foreground"},wv={class:"flex items-start gap-3"},kv=["id"],Sv=["for"],Cv={key:0},$v={class:"grid grid-cols-2 gap-3"},Dv={key:1},Av={class:"grid grid-cols-2 gap-3"},Ov={class:"space-y-4"},Tv={class:"flex items-start gap-3"},Iv=["id"],Vv=["for"],Nv={class:"flex items-start gap-3"},Fv=["id"],Uv=["for"],qv={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},Lv={class:"text-sm text-red-600"},Pv={__name:"PDFGenerationModal",props:{show:{type:Boolean,required:!0},opportunityId:{type:[String,Number],required:!0},documentType:{type:String,default:null,validator:s=>!s||["contract","offer"].includes(s)},offerId:{type:[String,Number],default:null},availableOffers:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","generate","preview","send"],setup(s,{emit:$}){var J;const i=s,l=$,{isGenerating:a,isPreviewing:m,error:d,getDefaultOptions:x,ensureTemplatesLoaded:V}=Ss(),A=C(()=>i.documentType!==null),h=T(i.documentType||"contract"),g=T(i.offerId),v=T(((J=i.customer)==null?void 0:J.email)||""),b=T(""),k=T(!1),y=T({template:"classic",language:"en",includeTermsAndConditions:!0,includeDisclaimerPage:!0}),w=C(()=>{var W;return h.value!=="offer"||!g.value?null:((W=i.availableOffers)==null?void 0:W.find(j=>j.id===g.value))||null});ye(()=>i.customer,W=>{W!=null&&W.email&&h.value==="offer"&&(v.value=W.email)},{immediate:!0});const r=C(()=>d.value);ns(async()=>{await V();const W=x();y.value={...W,...y.value}}),ye(()=>i.documentType,W=>{W&&(h.value=W)}),ye(()=>i.offerId,W=>{W&&(g.value=W)},{immediate:!0}),ye(()=>[i.availableOffers,h.value],([W,j])=>{j==="offer"&&W&&W.length===1&&!g.value&&(g.value=W[0].id)},{immediate:!0});const O=C(()=>h.value==="offer"?g.value!==null&&g.value!==void 0:!0),N=C(()=>h.value!=="offer"?!1:O.value&&v.value&&v.value.includes("@")),U=W=>{if(W.data){const j=W.data;return`${j.brand||""} ${j.model||""} (${j.year||""})`}return W.vehicleBrand?`${W.vehicleBrand} ${W.vehicleModel} (${W.vehicleYear})`:"Vehicle"},M=W=>{var j;return W.price||((j=W.data)==null?void 0:j.price)||0},le=W=>W?new Intl.NumberFormat("en-US").format(W):"0",R=W=>W?new Date(W).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",E=W=>{if(W.data){const j=W.data;return`${j.brand||""} ${j.model||""} (${j.year||""}) - €${(j.price||0).toLocaleString()}`}return W.vehicleBrand?`${W.vehicleBrand} ${W.vehicleModel} (${W.vehicleYear}) - €${(W.price||0).toLocaleString()}`:`Offer #${W.id}`},G=W=>{W||l("close")},z=async()=>{if(O.value)try{const W={...y.value,includeDisclaimerPage:h.value==="contract"?y.value.includeDisclaimerPage:!1};if(h.value==="contract")l("generate",{type:"contract",opportunityId:i.opportunityId,options:W});else{if(!g.value){r.value="Please select an offer";return}l("generate",{type:"offer",opportunityId:i.opportunityId,offerId:g.value,options:W})}}catch(W){console.error("Error generating PDF:",W)}},Q=async()=>{if(O.value)try{const W={...y.value,includeDisclaimerPage:h.value==="contract"?y.value.includeDisclaimerPage:!1};if(h.value==="contract")l("preview",{type:"contract",opportunityId:i.opportunityId,options:W});else{if(!g.value){r.value="Please select an offer";return}l("preview",{type:"offer",opportunityId:i.opportunityId,offerId:g.value,options:W})}}catch(W){console.error("Error previewing PDF:",W)}},de=async()=>{if(N.value){k.value=!0;try{const W={...y.value,includeDisclaimerPage:!1};if(!g.value){r.value="Please select an offer";return}l("send",{type:"offer",opportunityId:i.opportunityId,offerId:g.value,email:v.value,message:b.value,options:W})}catch(W){console.error("Error sending PDF:",W),r.value=W.message||"Failed to send PDF"}finally{k.value=!1}}};return(W,j)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":G},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:o(()=>[n(t(At),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[D(F(h.value==="contract"?"Generate Contract PDF":"Send Offer PDF"),1)]),_:1})]),_:1}),e("div",av,[h.value==="offer"?(p(),S(be,{key:0},[s.customer?(p(),S("div",lv,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[12]||(j[12]=[D("Customer Details",-1)])]),_:1}),e("div",ov,[e("div",iv,[j[13]||(j[13]=e("span",{class:"text-muted-foreground font-medium w-24"},"Name:",-1)),e("span",rv,F(s.customer.name||"N/A"),1)]),s.customer.phone?(p(),S("div",uv,[j[14]||(j[14]=e("span",{class:"text-muted-foreground font-medium w-24"},"Phone:",-1)),e("span",dv,F(s.customer.phone),1)])):q("",!0),s.customer.address?(p(),S("div",cv,[j[15]||(j[15]=e("span",{class:"text-muted-foreground font-medium w-24"},"Address:",-1)),e("span",mv,F(s.customer.address),1)])):q("",!0)])])):q("",!0),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-2 block"},{default:o(()=>[...j[16]||(j[16]=[D("Email Address ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{modelValue:v.value,"onUpdate:modelValue":j[0]||(j[0]=ee=>v.value=ee),type:"email",placeholder:"customer@example.com",class:"w-full"},null,8,["modelValue"])]),w.value?(p(),S("div",fv,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[17]||(j[17]=[D("Offer Details",-1)])]),_:1}),e("div",pv,[e("div",vv,[j[18]||(j[18]=e("span",{class:"text-muted-foreground font-medium w-24"},"Vehicle:",-1)),e("span",gv,F(U(w.value)),1)]),e("div",yv,[j[19]||(j[19]=e("span",{class:"text-muted-foreground font-medium w-24"},"Price:",-1)),e("span",bv,"€ "+F(le(M(w.value))),1)]),w.value.createdAt?(p(),S("div",hv,[j[20]||(j[20]=e("span",{class:"text-muted-foreground font-medium w-24"},"Created:",-1)),e("span",xv,F(R(w.value.createdAt)),1)])):q("",!0)])])):q("",!0),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-2 block"},{default:o(()=>[...j[21]||(j[21]=[D("Message (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:b.value,"onUpdate:modelValue":j[1]||(j[1]=ee=>b.value=ee),rows:"4",placeholder:"Add a personal message to accompany the offer...",class:"w-full"},null,8,["modelValue"])]),e("div",wv,[ke(e("input",{type:"checkbox",id:"terms-offer-"+W._uid,"onUpdate:modelValue":j[2]||(j[2]=ee=>y.value.includeTermsAndConditions=ee),class:"mt-1"},null,8,kv),[[wt,y.value.includeTermsAndConditions]]),e("label",{for:"terms-offer-"+W._uid,class:"text-sm text-foreground cursor-pointer"}," Include Terms & Conditions ",8,Sv)])],64)):(p(),S(be,{key:1},[A.value?q("",!0):(p(),S("div",Cv,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[22]||(j[22]=[D("Document Type",-1)])]),_:1}),e("div",$v,[e("button",{type:"button",class:se(["p-4 border-2 rounded-lg text-left transition-all",h.value==="contract"?"border-primary bg-primary/5":"border-border hover:border-primary/50"]),onClick:j[3]||(j[3]=ee=>h.value="contract")},[...j[23]||(j[23]=[e("div",{class:"font-semibold text-sm text-foreground mb-1"},"Contract",-1),e("div",{class:"text-xs text-muted-foreground"},"Formal contract with signature area",-1)])],2),e("button",{type:"button",class:se(["p-4 border-2 rounded-lg text-left transition-all",h.value==="offer"?"border-primary bg-primary/5":"border-border hover:border-primary/50"]),onClick:j[4]||(j[4]=ee=>h.value="offer")},[...j[24]||(j[24]=[e("div",{class:"font-semibold text-sm text-foreground mb-1"},"Offer",-1),e("div",{class:"text-xs text-muted-foreground"},"Purchase proposal for customer",-1)])],2)])])),h.value==="offer"&&s.availableOffers&&s.availableOffers.length>1?(p(),S("div",Dv,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[25]||(j[25]=[D("Select Offer",-1)])]),_:1}),n(t($t),{modelValue:g.value,"onUpdate:modelValue":j[5]||(j[5]=ee=>g.value=ee)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select an offer..."})]),_:1}),n(t(Ct),null,{default:o(()=>[(p(!0),S(be,null,Oe(s.availableOffers,ee=>(p(),K(t(he),{key:ee.id,value:ee.id},{default:o(()=>[D(F(E(ee)),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])):q("",!0),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[26]||(j[26]=[D("Language",-1)])]),_:1}),n(t($t),{modelValue:y.value.language,"onUpdate:modelValue":j[6]||(j[6]=ee=>y.value.language=ee)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St))]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"en"},{default:o(()=>[...j[27]||(j[27]=[D("English",-1)])]),_:1}),n(t(he),{value:"de"},{default:o(()=>[...j[28]||(j[28]=[D("Deutsch",-1)])]),_:1}),n(t(he),{value:"fr"},{default:o(()=>[...j[29]||(j[29]=[D("Français",-1)])]),_:1}),n(t(he),{value:"it"},{default:o(()=>[...j[30]||(j[30]=[D("Italiano",-1)])]),_:1}),n(t(he),{value:"nl"},{default:o(()=>[...j[31]||(j[31]=[D("Nederlands",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-3 block"},{default:o(()=>[...j[32]||(j[32]=[D("Template Style",-1)])]),_:1}),e("div",Av,[e("button",{type:"button",class:se(["p-4 border-2 rounded-lg text-left transition-all",y.value.template==="classic"?"border-primary bg-primary/5":"border-border hover:border-primary/50"]),onClick:j[7]||(j[7]=ee=>y.value.template="classic")},[...j[33]||(j[33]=[e("div",{class:"font-semibold text-sm text-foreground mb-1"},"Classic",-1),e("div",{class:"text-xs text-muted-foreground"}," Detailed with comprehensive information and legal sections ",-1)])],2),e("button",{type:"button",class:se(["p-4 border-2 rounded-lg text-left transition-all",y.value.template==="express"?"border-primary bg-primary/5":"border-border hover:border-primary/50"]),onClick:j[8]||(j[8]=ee=>y.value.template="express")},[...j[34]||(j[34]=[e("div",{class:"font-semibold text-sm text-foreground mb-1"},"Express",-1),e("div",{class:"text-xs text-muted-foreground"}," Streamlined with essential information ",-1)])],2)])]),e("div",Ov,[n(t(B),{class:"text-sm font-semibold text-foreground block"},{default:o(()=>[...j[35]||(j[35]=[D("Options",-1)])]),_:1}),e("div",Tv,[ke(e("input",{type:"checkbox",id:"terms-"+W._uid,"onUpdate:modelValue":j[9]||(j[9]=ee=>y.value.includeTermsAndConditions=ee),class:"mt-1"},null,8,Iv),[[wt,y.value.includeTermsAndConditions]]),e("label",{for:"terms-"+W._uid,class:"text-sm text-foreground cursor-pointer"}," Include Terms & Conditions ",8,Vv)]),e("div",Nv,[ke(e("input",{type:"checkbox",id:"disclaimer-"+W._uid,"onUpdate:modelValue":j[10]||(j[10]=ee=>y.value.includeDisclaimerPage=ee),class:"mt-1"},null,8,Fv),[[wt,y.value.includeDisclaimerPage]]),e("label",{for:"disclaimer-"+W._uid,class:"text-sm text-foreground cursor-pointer"}," Include Disclaimer Page (last page) ",8,Uv)])])],64)),r.value?(p(),S("div",qv,[e("p",Lv,F(r.value),1)])):q("",!0)]),n(t(Lt),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:t(a)||t(m)||k.value,onClick:j[11]||(j[11]=ee=>W.$emit("close"))},null,8,["disabled"]),h.value==="offer"?(p(),K(t(_),{key:0,label:"Send Offer PDF",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!N.value||t(a)||t(m)||k.value,onClick:de},{default:o(()=>[k.value?(p(),S(be,{key:0},[j[36]||(j[36]=e("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1)),j[37]||(j[37]=D(" Sending... ",-1))],64)):(p(),S(be,{key:1},[j[38]||(j[38]=e("i",{class:"fa-solid fa-paper-plane mr-2"},null,-1)),j[39]||(j[39]=D(" Send ",-1))],64))]),_:1},8,["disabled"])):(p(),S(be,{key:1},[n(t(_),{label:"Preview",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!O.value||t(a)||t(m),onClick:Q},null,8,["disabled"]),n(t(_),{label:"Generate PDF",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!O.value||t(a)||t(m),onClick:z},{default:o(()=>[t(a)?(p(),S(be,{key:0},[j[40]||(j[40]=e("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1)),j[41]||(j[41]=D(" Generating... ",-1))],64)):q("",!0)]),_:1},8,["disabled"])],64))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Mv={class:"flex-1 overflow-hidden flex flex-col"},Ev={class:"flex-1 overflow-auto bg-muted p-4"},Rv={key:0,class:"flex items-center justify-center h-full"},jv={key:1,class:"flex items-center justify-center h-full"},Bv={class:"text-center p-6 bg-red-50 border border-red-200 rounded-lg"},zv={class:"text-xs text-red-500"},Wv={key:2,class:"bg-white rounded-lg shadow-lg overflow-hidden"},Yv=["src"],Hv={key:3,class:"flex items-center justify-center h-full"},Qv={__name:"PDFPreviewModal",props:{show:{type:Boolean,required:!0},pdfUrl:{type:String,default:null},pdfId:{type:String,default:null},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["close","regenerate","download","email","print"],setup(s,{emit:$}){const i=s,l=$,{downloadPDF:a}=Ss(),m=h=>{h||l("close")},d=()=>{l("regenerate")},x=async()=>{if(i.pdfId)try{await a(i.pdfId),l("download",i.pdfId)}catch(h){console.error("Error downloading PDF:",h)}else if(i.pdfUrl){const h=document.createElement("a");h.href=i.pdfUrl,h.download="contract.pdf",document.body.appendChild(h),h.click(),document.body.removeChild(h),l("download",i.pdfUrl)}},V=()=>{l("email",{pdfId:i.pdfId,pdfUrl:i.pdfUrl})},A=()=>{if(i.pdfUrl){const h=window.open(i.pdfUrl,"_blank");h&&(h.onload=()=>{h.print()}),l("print",i.pdfUrl)}};return Ga(()=>{}),(h,g)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":m},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-6xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:o(()=>[n(t(At),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...g[0]||(g[0]=[D("PDF Preview",-1)])]),_:1})]),_:1}),e("div",Mv,[e("div",Ev,[s.loading?(p(),S("div",Rv,[...g[1]||(g[1]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-spinner fa-spin text-4xl text-muted-foreground mb-4"}),e("p",{class:"text-sm text-muted-foreground"},"Loading PDF preview...")],-1)])])):s.error?(p(),S("div",jv,[e("div",Bv,[g[2]||(g[2]=e("i",{class:"fa-solid fa-exclamation-circle text-4xl text-red-600 mb-4"},null,-1)),g[3]||(g[3]=e("p",{class:"text-sm text-red-600 font-semibold mb-2"},"Failed to load PDF",-1)),e("p",zv,F(s.error),1)])])):s.pdfUrl?(p(),S("div",Wv,[e("iframe",{src:s.pdfUrl,class:"w-full h-full min-h-[600px] border-0",title:"PDF Preview"},null,8,Yv)])):(p(),S("div",Hv,[...g[4]||(g[4]=[e("p",{class:"text-sm text-muted-foreground"},"No PDF to preview",-1)])]))])]),n(t(Lt),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:o(()=>[n(t(_),{label:"Regenerate",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:s.loading,onClick:d},null,8,["disabled"]),n(t(_),{label:"Print",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!s.pdfUrl||s.loading,onClick:A},{default:o(()=>[...g[5]||(g[5]=[e("i",{class:"fa-solid fa-print mr-2"},null,-1)])]),_:1},8,["disabled"]),n(t(_),{label:"Email",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!s.pdfUrl||s.loading,onClick:V},{default:o(()=>[...g[6]||(g[6]=[e("i",{class:"fa-solid fa-envelope mr-2"},null,-1)])]),_:1},8,["disabled"]),n(t(_),{label:"Download",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!s.pdfUrl||s.loading,onClick:x},{default:o(()=>[...g[7]||(g[7]=[e("i",{class:"fa-solid fa-download mr-2"},null,-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Gv={class:"flex-1 overflow-y-auto p-6 w-full space-y-4"},_v=["disabled"],Jv={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},Kv={class:"text-sm text-red-600"},Zv={key:1,class:"p-3 bg-green-50 border border-green-200 rounded-lg"},Xv={key:1,class:"fa-solid fa-envelope mr-2"},eg={__name:"EmailPDFModal",props:{show:{type:Boolean,required:!0},pdfId:{type:String,required:!0},recipientEmail:{type:String,default:""},defaultSubject:{type:String,default:"Contract/Offer Document"}},emits:["close","sent"],setup(s,{emit:$}){const i=s,l=$,{sendPDFByEmail:a}=Ss(),m=T({to:"",subject:"",message:""}),d=T(!1),x=T(null),V=T(!1),A=C(()=>m.value.to&&m.value.to.includes("@")&&m.value.subject);ye(()=>i.show,v=>{v&&(m.value={to:i.recipientEmail||"",subject:i.defaultSubject||"Contract/Offer Document",message:""},x.value=null,V.value=!1)});const h=v=>{v||l("close")},g=async()=>{if(A.value){d.value=!0,x.value=null,V.value=!1;try{await a(i.pdfId,{to:m.value.to,subject:m.value.subject,message:m.value.message||void 0}),V.value=!0,setTimeout(()=>{l("sent",{pdfId:i.pdfId,email:m.value.to}),l("close")},1500)}catch(v){x.value=v.message||"Failed to send email. Please try again."}finally{d.value=!1}}};return(v,b)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":h},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:o(()=>[n(t(At),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...b[4]||(b[4]=[D("Send PDF by Email",-1)])]),_:1})]),_:1}),e("div",Gv,[e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-2 block"},{default:o(()=>[...b[5]||(b[5]=[D(" Recipient Email ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),n(t(qe),{modelValue:m.value.to,"onUpdate:modelValue":b[0]||(b[0]=k=>m.value.to=k),type:"email",placeholder:"customer@example.com",required:"",disabled:d.value},null,8,["modelValue","disabled"])]),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-2 block"},{default:o(()=>[...b[6]||(b[6]=[D(" Subject ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),n(t(qe),{modelValue:m.value.subject,"onUpdate:modelValue":b[1]||(b[1]=k=>m.value.subject=k),type:"text",placeholder:"Contract/Offer Document",required:"",disabled:d.value},null,8,["modelValue","disabled"])]),e("div",null,[n(t(B),{class:"text-sm font-semibold text-foreground mb-2 block"},{default:o(()=>[...b[7]||(b[7]=[D(" Message (Optional) ",-1)])]),_:1}),ke(e("textarea",{"onUpdate:modelValue":b[2]||(b[2]=k=>m.value.message=k),class:"w-full min-h-[100px] px-3 py-2 border border-border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Add a personal message to the email...",disabled:d.value},null,8,_v),[[Xn,m.value.message]])]),x.value?(p(),S("div",Jv,[e("p",Kv,F(x.value),1)])):q("",!0),V.value?(p(),S("div",Zv,[...b[8]||(b[8]=[e("p",{class:"text-sm text-green-600"},[e("i",{class:"fa-solid fa-check-circle mr-2"}),D(" PDF sent successfully! ")],-1)])])):q("",!0)]),n(t(Lt),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:d.value,onClick:b[3]||(b[3]=k=>v.$emit("close"))},null,8,["disabled"]),n(t(_),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!A.value||d.value,onClick:g},{default:o(()=>[d.value?(p(),S(be,{key:0},[b[9]||(b[9]=e("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1)),b[10]||(b[10]=D(" Sending... ",-1))],64)):(p(),S("i",Xv))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},tg={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-4"},ng={__name:"PostponeTaskDialog",props:{show:{type:Boolean,default:!1},taskType:{type:String,required:!0}},emits:["close","confirm"],setup(s,{emit:$}){const i=s,l=$,a=T({date:"",time:"",reason:""}),m=C(()=>new Date().toISOString().split("T")[0]),d=C(()=>!!a.value.date);ye(()=>i.show,h=>{if(h){const g=new Date;a.value.date=g.toISOString().split("T")[0],a.value.time=g.toTimeString().slice(0,5),a.value.reason=""}});const x=h=>{h||l("close")},V=()=>{l("close")},A=()=>{if(!d.value)return;const h=a.value.time?`${a.value.date}T${a.value.time}:00`:`${a.value.date}T12:00:00`;l("confirm",{taskType:i.taskType,date:a.value.date,time:a.value.time||"12:00",dateTime:h,reason:a.value.reason}),l("close")};return(h,g)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":x},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...g[3]||(g[3]=[D("Postpone Task",-1)])]),_:1})]),_:1}),e("div",tg,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-foreground mb-2"},{default:o(()=>[...g[4]||(g[4]=[D("Postpone Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:a.value.date,"onUpdate:modelValue":g[0]||(g[0]=v=>a.value.date=v),min:m.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-foreground mb-2"},{default:o(()=>[...g[5]||(g[5]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:a.value.time,"onUpdate:modelValue":g[1]||(g[1]=v=>a.value.time=v),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-foreground mb-2"},{default:o(()=>[...g[6]||(g[6]=[D("Reason (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:a.value.reason,"onUpdate:modelValue":g[2]||(g[2]=v=>a.value.reason=v),rows:"3",placeholder:"Why are you postponing this task?",class:"w-full"},null,8,["modelValue"])])]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:V},{default:o(()=>[...g[7]||(g[7]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!d.value,onClick:A},{default:o(()=>[...g[8]||(g[8]=[D(" Postpone Task ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},sg={class:"flex-1 overflow-y-auto min-h-0"},ag={__name:"EditExpectedCloseDateModal",props:{show:{type:Boolean,default:!1},opportunity:{type:Object,required:!0}},emits:["close","confirm"],setup(s,{emit:$}){const i=s,l=$,a=T(""),m=T(""),d=C(()=>new Date().toISOString().split("T")[0]),x=C(()=>!!a.value);ye(()=>i.show,g=>{if(g){const v=i.opportunity.expectedCloseDate?new Date(i.opportunity.expectedCloseDate):new Date;if(v<new Date){const b=new Date;b.setDate(b.getDate()+1),a.value=b.toISOString().split("T")[0]}else a.value=v.toISOString().split("T")[0];m.value=""}});function V(g){g||l("close")}function A(){l("close")}function h(){x.value&&(l("confirm",{expectedCloseDate:a.value,reason:m.value}),l("close"))}return(g,v)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":V},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt)),n(t(Dt),{class:"flex flex-col max-h-screen w-full sm:max-w-md"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...v[2]||(v[2]=[D("Extend Expected Close Date",-1)])]),_:1})]),_:1}),e("div",sg,[n(t(go),{class:"gap-4"},{default:o(()=>[n(t(Ta),null,{default:o(()=>[n(t(Ia),{for:"extend-expected-close-date"},{default:o(()=>[...v[3]||(v[3]=[D("Expected Close Date",-1)])]),_:1}),n(t(qe),{id:"extend-expected-close-date",type:"date",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=b=>a.value=b),min:d.value},null,8,["modelValue","min"])]),_:1}),n(t(Ta),null,{default:o(()=>[n(t(Ia),{for:"extend-expected-close-reason"},{default:o(()=>[...v[4]||(v[4]=[D("Reason (optional)",-1)])]),_:1}),n(t(Xe),{id:"extend-expected-close-reason",modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=b=>m.value=b),rows:4,placeholder:"Why are you extending the expected close date?"},null,8,["modelValue"])]),_:1})]),_:1})]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end gap-3"},{default:o(()=>[n(t(_),{variant:"outline",size:"small",onClick:A},{default:o(()=>[...v[5]||(v[5]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",size:"small",disabled:!x.value,onClick:h},{default:o(()=>[...v[6]||(v[6]=[D(" Save ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},lg={class:"space-y-4"},og={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},ig={key:0,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},rg={class:"grid grid-cols-2 gap-4"},ug={class:"flex items-center gap-2"},dg={class:"text-muted-foreground"},cg={class:"font-medium text-foreground"},mg={class:"flex items-center gap-2"},fg={class:"font-medium text-foreground"},pg={key:1,class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},vg={class:"bg-white border border-border rounded-lg overflow-hidden"},gg={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},yg={class:"p-6"},bg={class:"flex items-center justify-between mb-4"},hg={class:"text-sm font-semibold text-foreground"},xg={class:"grid grid-cols-7 gap-1 mb-2"},wg={class:"grid grid-cols-7 gap-1"},kg=["onClick"],Sg={class:"p-6"},Cg={class:"text-sm font-semibold text-foreground mb-4"},$g={key:0,class:"space-y-2"},Dg=["onClick"],Ag={key:1,class:"text-sm text-muted-foreground py-4 text-center"},Og={key:2,class:"text-sm text-muted-foreground py-4 text-center"},Tg={class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Zs={__name:"OpportunityScheduleForm",props:{opportunity:{type:Object,required:!0},mode:{type:String,validator:s=>["schedule","reschedule"].includes(s),default:"schedule"},initialAppointment:{type:Object,default:null}},emits:["submit","cancel"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=gn(),d=T(""),x=T(null),V=T(""),A=T(null),h=T(null),g=T(null),v=T(""),b=T(new Date().getMonth()),k=T(new Date().getFullYear()),y=T({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),w=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],r={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},O=C(()=>w.map(H=>({value:H.value,label:H.label}))),N=C(()=>{const H=[];for(let Y=9*60;Y<=18*60;Y+=30){const te=String(Math.floor(Y/60)).padStart(2,"0"),X=String(Y%60).padStart(2,"0");H.push(`${te}:${X}`)}return H}),U=C(()=>{if(g.value!=null)return g.value;const H=parseInt(v.value,10);return Number.isFinite(H)&&H>0?H:null}),M=C(()=>l.mode==="reschedule"?"Reschedule and Save":"Schedule and Save"),le=C(()=>!!(d.value&&x.value&&V.value&&A.value)),R=["MON","TUE","WED","THU","FRI","SAT","SUN"],E=C(()=>new Date(k.value,b.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),G=C(()=>{const H=new Date(k.value,b.value,1),te=new Date(k.value,b.value+1,0).getDate(),X=H.getDay()===0?6:H.getDay()-1,ie=[];for(let ve=0;ve<X;ve++)ie.push(null);for(let ve=1;ve<=te;ve++)ie.push(ve);return ie}),z=C(()=>{if(!x.value)return"Select a date";const H=x.value,Y=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],te=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${Y[H.getDay()]}, ${te[H.getMonth()]} ${H.getDate()}`}),Q=C(()=>m.assignableUsers),de=C(()=>m.assignableTeams),J=C(()=>de.value.map(H=>({...H,label:`${H.dealership||"No location"} → ${H.name}`,value:H.id}))),W=C(()=>{var te;if(!A.value)return[];const H=A.value;return(((te=Q.value)==null?void 0:te.filter(X=>X.team===H.name||X.teamId===H.id))||[]).map(X=>({...X,label:X.name,value:X.id}))}),j=C({get:()=>{var H;return((H=A.value)==null?void 0:H.id)||null},set:H=>{var te;if(!H){A.value=null,h.value=null;return}const Y=(te=de.value)==null?void 0:te.find(X=>X.id===H);A.value=Y||null,Y&&ct(`team-${Y.id}`)}}),ee=C({get:()=>{var H;return((H=h.value)==null?void 0:H.id)||null},set:H=>{if(!H){h.value=null;return}const Y=W.value.find(te=>te.id===H);h.value=Y||null,Y&&ct(`user-${Y.id}`)}}),me=C(()=>{if(!x.value)return[];const H=x.value.toISOString().split("T")[0];if(h.value){const Y=kn(`user-${h.value.id}`,H);return N.value.filter(te=>Y.includes(te))}if(A.value){const Y=kn(`team-${A.value.id}`,H);return N.value.filter(te=>Y.includes(te))}return N.value||[]});function fe(H){return H?H.split(" ").map(Y=>Y[0]).join("").toUpperCase().substring(0,2):"?"}function $e(H){return{manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"}[H]||"bg-muted text-muted-foreground"}function Re(H){if(!H)return;const Y=new Date(k.value,b.value,H);x.value=Y,V.value=""}function Pe(H){if(!H||!x.value)return!1;const Y=x.value;return Y.getDate()===H&&Y.getMonth()===b.value&&Y.getFullYear()===k.value}function gt(){b.value===0?(b.value=11,k.value--):b.value--}function ht(){b.value===11?(b.value=0,k.value++):b.value++}function ct(H){const Y=new Date;Y.setHours(0,0,0,0);for(let te=0;te<30;te++){const X=new Date(Y);if(X.setDate(Y.getDate()+te),X.getDay()===0||X.getDay()===6)continue;const ie=X.toISOString().split("T")[0],ve=kn(H,ie);if(ve!=null&&ve.length){x.value=X,b.value=X.getMonth(),k.value=X.getFullYear();const ge=N.value.filter(Te=>ve.includes(Te));ge.length&&(V.value=ge[0]);break}}}function Z(H){y.value=H}function ue(){nt(),a("cancel")}function nt(){d.value="",x.value=null,V.value="",A.value=null,h.value=null,g.value=null,v.value="",y.value={immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}}function at(H){var Y,te,X;if(H){if(d.value=H.type||"",H.assignee){const ie=(Y=Q.value)==null?void 0:Y.find(ge=>ge.name===H.assignee),ve=(te=de.value)==null?void 0:te.find(ge=>ge.name===H.assignee);if(ie){const ge=(X=de.value)==null?void 0:X.find(Te=>Te.name===ie.team||Te.id===ie.teamId);ge&&(A.value=ge,h.value=ie)}else ve&&(A.value=ve)}if(H.start){const ie=new Date(H.start),ve=new Date(ie.getFullYear(),ie.getMonth(),ie.getDate());x.value=ve,b.value=ie.getMonth(),k.value=ie.getFullYear();const ge=ie.getHours(),Te=ie.getMinutes(),We=Te<15?0:Te<45?30:60,_e=We===60?ge+1:ge,Se=We===60?0:We,He=`${String(_e).padStart(2,"0")}:${String(Se).padStart(2,"0")}`;if(N.value.includes(He))V.value=He;else{const Ke=_e*60+Se,Ye=N.value.reduce((lt,st)=>{const[pe,re]=st.split(":").map(Number),xe=pe*60+re;if(!lt)return st;const[we,De]=lt.split(":").map(Number),Me=we*60+De;return Math.abs(xe-Ke)<Math.abs(Me-Ke)?st:lt},null);V.value=Ye||N.value[0]||""}}if(H.duration){const ie=H.duration;ie===15?g.value=15:ie===30?g.value=30:ie===60?g.value=60:(g.value=null,v.value=String(ie))}}}ye(d,H=>{if(!H)return;const Y=r[H];if(Y&&(Y===15?g.value=15:Y===30?g.value=30:Y===60?g.value=60:(g.value=null,v.value=String(Y)),!x.value)){const te=new Date;te.setHours(0,0,0,0),x.value=te,b.value=te.getMonth(),k.value=te.getFullYear()}}),ye(x,()=>{V.value=""}),ye(()=>l.opportunity.assignee,H=>{var X,ie,ve;if(!H||A.value||h.value)return;const Y=(X=Q.value)==null?void 0:X.find(ge=>ge.name===H),te=(ie=de.value)==null?void 0:ie.find(ge=>ge.name===H);if(Y){const ge=(ve=de.value)==null?void 0:ve.find(Te=>Te.name===Y.team||Te.id===Y.teamId);ge&&(A.value=ge,h.value=Y)}else te&&(A.value=te)},{immediate:!0}),ns(()=>{l.mode==="reschedule"&&l.initialAppointment&&at(l.initialAppointment)});function mt(){le.value&&a("submit",{eventType:d.value,selectedDate:x.value,selectedSlot:V.value,selectedTeam:A.value,selectedSalesman:h.value,durationValue:U.value,communicationPreferences:y.value})}return $({resetForm:nt}),(H,Y)=>{var te;return p(),S("div",lg,[e("div",og,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...Y[3]||(Y[3]=[D("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(vt),{modelValue:d.value,"onUpdate:modelValue":Y[0]||(Y[0]=X=>d.value=X),items:O.value,placeholder:"Select event type...","value-key":"value",class:"w-full"},{item:o(({item:X})=>[e("span",null,F(X.label),1)]),_:1},8,["modelValue","items"])]),d.value?(p(),S("div",ig,[Y[7]||(Y[7]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Assign appointment to",-1)),e("div",rg,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...Y[4]||(Y[4]=[D("Team",-1)])]),_:1}),n(t(vt),{modelValue:j.value,"onUpdate:modelValue":Y[1]||(Y[1]=X=>j.value=X),items:J.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:X})=>[e("div",ug,[e("span",dg,F(X.dealership||"No location"),1),Y[5]||(Y[5]=e("span",{class:"text-muted-foreground"},"→",-1)),e("span",cg,F(X.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...Y[6]||(Y[6]=[D("Salesperson (optional)",-1)])]),_:1}),n(t(vt),{modelValue:ee.value,"onUpdate:modelValue":Y[2]||(Y[2]=X=>ee.value=X),items:W.value,disabled:!A.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:X})=>[e("div",mg,[e("div",{class:se(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",$e(X.role)])},F(fe(X.name)),3),e("span",fg,F(X.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):q("",!0),d.value&&A.value?(p(),S("div",pg,[Y[10]||(Y[10]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},[D("Schedule "),e("span",{class:"text-red-600"},"*")],-1)),e("div",vg,[e("div",gg,[e("div",yg,[e("div",bg,[e("button",{type:"button",onClick:gt,class:"p-1 hover:bg-muted rounded transition-colors cursor-pointer"},[...Y[8]||(Y[8]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-muted-foreground"},null,-1)])]),e("h6",hg,F(E.value),1),e("button",{type:"button",onClick:ht,class:"p-1 hover:bg-muted rounded transition-colors cursor-pointer"},[...Y[9]||(Y[9]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-muted-foreground"},null,-1)])])]),e("div",xg,[(p(),S(be,null,Oe(R,X=>e("div",{key:X,class:"text-center text-xs font-semibold text-muted-foreground py-1"},F(X),1)),64))]),e("div",wg,[(p(!0),S(be,null,Oe(G.value,(X,ie)=>(p(),S("div",{key:ie,onClick:ve=>X&&Re(X),class:se(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Pe(X)?"bg-primary text-white cursor-pointer":X?"text-muted-foreground hover:bg-muted cursor-pointer":"text-transparent"])},F(X),11,kg))),128))])]),e("div",Sg,[e("h6",Cg,F(z.value),1),x.value&&me.value.length>0?(p(),S("div",$g,[(p(!0),S(be,null,Oe(me.value,X=>(p(),S("button",{key:X,type:"button",onClick:ie=>V.value=X,class:se(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",V.value===X?"border-primary bg-muted text-foreground":"border-border text-muted-foreground hover:border-primary/30"])},F(X),11,Dg))),128))])):x.value&&me.value.length===0?(p(),S("div",Ag," No available time slots for this date ")):(p(),S("div",Og," Select a date to see available time slots "))])])])])):q("",!0),d.value&&A.value?(p(),K(rl,{key:2,appointment:{type:d.value,date:x.value,time:V.value,duration:U.value},customer:s.opportunity.customer,salesperson:h.value,team:A.value,dealership:(te=A.value)!=null&&te.dealership?{name:A.value.dealership}:null,onUpdate:Z},null,8,["appointment","customer","salesperson","team","dealership"])):q("",!0),e("div",Tg,[n(t(_),{variant:"secondary",onClick:ue},{default:o(()=>[...Y[11]||(Y[11]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!le.value,onClick:mt},{default:o(()=>[D(F(M.value),1)]),_:1},8,["disabled"])])])}}},Ig={class:"space-y-4"},Vg={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Ng={class:"text-sm text-muted-foreground"},Fg={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Ug={class:"grid grid-cols-2 gap-4"},qg={class:"flex items-center gap-2"},Lg={class:"text-muted-foreground"},Pg={class:"font-medium text-foreground"},Mg={class:"flex items-center gap-2"},Eg={class:"font-medium text-foreground"},Rg={class:"mt-4"},jg={__name:"NS1Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=gn(),d=Yt(),x=Xt(),V=T(null),A=T(null),h=T(""),g=C(()=>m.assignableUsers),v=C(()=>m.assignableTeams),b=C(()=>v.value.map(R=>({...R,label:`${R.dealership||"No location"} → ${R.name}`,value:R.id}))),k=C(()=>{var G;if(!V.value)return[];const R=V.value;return(((G=g.value)==null?void 0:G.filter(z=>z.team===R.name||z.teamId===R.id))||[]).map(z=>({...z,label:z.name,value:z.id}))}),y=C({get:()=>{var R;return((R=V.value)==null?void 0:R.id)||null},set:R=>{var G;if(!R){V.value=null;return}const E=(G=v.value)==null?void 0:G.find(z=>z.id===R);V.value=E||null,E&&(A.value=null)}}),w=C({get:()=>{var R;return((R=A.value)==null?void 0:R.id)||null},set:R=>{if(!R){A.value=null;return}const E=k.value.find(G=>G.id===R);A.value=E||null}}),r=R=>R?R.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2):"?",O=R=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[R]||"bg-muted text-muted-foreground",N=C(()=>!!V.value);async function U(){var G,z,Q;if(!N.value)return;const R=((G=A.value)==null?void 0:G.name)||((z=V.value)==null?void 0:z.name),E={assignee:R};h.value&&(E.assignmentNote=h.value),await x.updateOpportunity(l.opportunity.id,E),await x.addActivity(l.opportunity.id,{type:"assignment",user:((Q=d.currentUser)==null?void 0:Q.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${R}${h.value?` with note: ${h.value}`:""}`,timestamp:new Date().toISOString()}),a("assigned",{opportunity:l.opportunity,assignee:R,note:h.value})}$({canSubmit:N,submit:U});const M=C(()=>"Follow up with customer to understand the situation and book another appointment."),le=C(()=>{var E;return(E=l.scheduledAppointment)!=null&&E.start?new Date(l.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ns(()=>{var R,E,G;if(l.opportunity.assignee&&!V.value&&!A.value){const z=(R=g.value)==null?void 0:R.find(de=>de.name===l.opportunity.assignee),Q=(E=v.value)==null?void 0:E.find(de=>de.name===l.opportunity.assignee);if(z){const de=(G=v.value)==null?void 0:G.find(J=>J.name===z.team||J.id===z.teamId);de&&(V.value=de,A.value=z)}else Q&&(V.value=Q)}l.opportunity.assignmentNote&&(h.value=l.opportunity.assignmentNote)}),ye(()=>l.opportunity.assignee,R=>{var E,G,z;if(R&&!V.value&&!A.value){const Q=(E=g.value)==null?void 0:E.find(J=>J.name===R),de=(G=v.value)==null?void 0:G.find(J=>J.name===R);if(Q){const J=(z=v.value)==null?void 0:z.find(W=>W.name===Q.team||W.id===Q.teamId);J&&(V.value=J,A.value=Q)}else de&&(V.value=de)}}),(R,E)=>(p(),S("div",Ig,[e("div",Vg,[E[3]||(E[3]=e("h4",{class:"font-bold text-foreground text-sm mb-1"},"1st No-Show Follow-up Task",-1)),e("p",Ng," Appointment was scheduled for "+F(le.value)+" but customer did not show up. "+F(M.value),1)]),e("div",Fg,[E[8]||(E[8]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Assign to",-1)),e("div",Ug,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[4]||(E[4]=[D("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(vt),{modelValue:y.value,"onUpdate:modelValue":E[0]||(E[0]=G=>y.value=G),items:b.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:G})=>[e("div",qg,[e("span",Lg,F(G.dealership||"No location"),1),E[5]||(E[5]=e("span",{class:"text-muted-foreground"},"→",-1)),e("span",Pg,F(G.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[6]||(E[6]=[D("Salesperson ",-1),e("span",{class:"text-muted-foreground text-xs"},"(optional)",-1)])]),_:1}),n(t(vt),{modelValue:w.value,"onUpdate:modelValue":E[1]||(E[1]=G=>w.value=G),items:k.value,disabled:!V.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:G})=>[e("div",Mg,[e("div",{class:se(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",O(G.role)])},F(r(G.name)),3),e("span",Eg,F(G.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",Rg,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[7]||(E[7]=[D("Notes for assignee",-1)])]),_:1}),n(t(Xe),{modelValue:h.value,"onUpdate:modelValue":E[2]||(E[2]=G=>h.value=G),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},Bg={class:"space-y-4"},zg={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Wg={class:"text-sm text-muted-foreground"},Yg={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Hg={class:"grid grid-cols-2 gap-4"},Qg={class:"flex items-center gap-2"},Gg={class:"text-muted-foreground"},_g={class:"font-medium text-foreground"},Jg={class:"flex items-center gap-2"},Kg={class:"font-medium text-foreground"},Zg={class:"mt-4"},Xg={__name:"NS2Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=gn(),d=Yt(),x=Xt(),V=T(null),A=T(null),h=T(""),g=C(()=>m.assignableUsers),v=C(()=>m.assignableTeams),b=C(()=>v.value.map(R=>({...R,label:`${R.dealership||"No location"} → ${R.name}`,value:R.id}))),k=C(()=>{var G;if(!V.value)return[];const R=V.value;return(((G=g.value)==null?void 0:G.filter(z=>z.team===R.name||z.teamId===R.id))||[]).map(z=>({...z,label:z.name,value:z.id}))}),y=C({get:()=>{var R;return((R=V.value)==null?void 0:R.id)||null},set:R=>{var G;if(!R){V.value=null;return}const E=(G=v.value)==null?void 0:G.find(z=>z.id===R);V.value=E||null,E&&(A.value=null)}}),w=C({get:()=>{var R;return((R=A.value)==null?void 0:R.id)||null},set:R=>{if(!R){A.value=null;return}const E=k.value.find(G=>G.id===R);A.value=E||null}}),r=R=>R?R.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2):"?",O=R=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[R]||"bg-muted text-muted-foreground",N=C(()=>!!V.value);async function U(){var G,z,Q;if(!N.value)return;const R=((G=A.value)==null?void 0:G.name)||((z=V.value)==null?void 0:z.name),E={assignee:R};h.value&&(E.assignmentNote=h.value),await x.updateOpportunity(l.opportunity.id,E),await x.addActivity(l.opportunity.id,{type:"assignment",user:((Q=d.currentUser)==null?void 0:Q.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${R}${h.value?` with note: ${h.value}`:""}`,timestamp:new Date().toISOString()}),a("assigned",{opportunity:l.opportunity,assignee:R,note:h.value})}$({canSubmit:N,submit:U});const M=C(()=>"This is the second no-show. Please make every effort to reach the customer and reschedule."),le=C(()=>{var E;return(E=l.scheduledAppointment)!=null&&E.start?new Date(l.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ns(()=>{var R,E,G;if(l.opportunity.assignee&&!V.value&&!A.value){const z=(R=g.value)==null?void 0:R.find(de=>de.name===l.opportunity.assignee),Q=(E=v.value)==null?void 0:E.find(de=>de.name===l.opportunity.assignee);if(z){const de=(G=v.value)==null?void 0:G.find(J=>J.name===z.team||J.id===z.teamId);de&&(V.value=de,A.value=z)}else Q&&(V.value=Q)}l.opportunity.assignmentNote&&(h.value=l.opportunity.assignmentNote)}),ye(()=>l.opportunity.assignee,R=>{var E,G,z;if(R&&!V.value&&!A.value){const Q=(E=g.value)==null?void 0:E.find(J=>J.name===R),de=(G=v.value)==null?void 0:G.find(J=>J.name===R);if(Q){const J=(z=v.value)==null?void 0:z.find(W=>W.name===Q.team||W.id===Q.teamId);J&&(V.value=J,A.value=Q)}else de&&(V.value=de)}}),(R,E)=>(p(),S("div",Bg,[e("div",zg,[E[3]||(E[3]=e("h4",{class:"font-bold text-foreground text-sm mb-1"},"2nd No-Show Follow-up Task",-1)),e("p",Wg," Appointment was scheduled for "+F(le.value)+" but customer did not show up. "+F(M.value),1)]),e("div",Yg,[E[8]||(E[8]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Assign to",-1)),e("div",Hg,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[4]||(E[4]=[D("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(vt),{modelValue:y.value,"onUpdate:modelValue":E[0]||(E[0]=G=>y.value=G),items:b.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:o(({item:G})=>[e("div",Qg,[e("span",Gg,F(G.dealership||"No location"),1),E[5]||(E[5]=e("span",{class:"text-muted-foreground"},"→",-1)),e("span",_g,F(G.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[6]||(E[6]=[D("Salesperson ",-1),e("span",{class:"text-muted-foreground text-xs"},"(optional)",-1)])]),_:1}),n(t(vt),{modelValue:w.value,"onUpdate:modelValue":E[1]||(E[1]=G=>w.value=G),items:k.value,disabled:!V.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:o(({item:G})=>[e("div",Jg,[e("div",{class:se(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",O(G.role)])},F(r(G.name)),3),e("span",Kg,F(G.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",Zg,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-1.5"},{default:o(()=>[...E[7]||(E[7]=[D("Notes for assignee",-1)])]),_:1}),n(t(Xe),{modelValue:h.value,"onUpdate:modelValue":E[2]||(E[2]=G=>h.value=G),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},ey={class:"space-y-4"},ty={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},ny={class:"text-sm text-muted-foreground"},sy={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},ay={__name:"NS3Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["close-as-lost","cancel"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=C(()=>"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed."),x=C(()=>{var v;return(v=l.scheduledAppointment)!=null&&v.start?new Date(l.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),V=C(()=>{var g;return((g=m.value)==null?void 0:g.canSubmit)||!1});function A(){var g;(g=m.value)==null||g.submit()}function h(g){a("close-as-lost",{opportunity:l.opportunity,reason:g})}return $({canSubmit:V,submit:A}),(g,v)=>(p(),S("div",ey,[e("div",ty,[v[0]||(v[0]=e("h4",{class:"font-bold text-foreground text-sm mb-1"},"3rd No-Show Follow-up Task",-1)),e("p",ny," Appointment was scheduled for "+F(x.value)+" but customer did not show up. "+F(d.value),1)]),e("div",sy,[v[1]||(v[1]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Close Opportunity as Lost",-1)),n(ks,{ref_key:"closeFormRef",ref:m,"show-multiple-no-shows":!0,"preselected-reason":"Multiple no shows","close-button-label":"Close as Lost",onClose:h},null,512)])]))}},ly={class:"space-y-4"},oy={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},iy={__name:"OfferAssignmentTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["offer-created","cancel"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=C(()=>l.opportunity.requestedCar||l.opportunity.vehicle||null),x=C(()=>{var h;return((h=m.value)==null?void 0:h.isValid)||!1});function V(){var h;(h=m.value)==null||h.submit()}function A(h){a("offer-created",{opportunity:l.opportunity,offerData:h})}return $({canSubmit:x,submit:V}),(h,g)=>(p(),S("div",ly,[g[0]||(g[0]=e("div",{class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},[e("h4",{class:"font-bold text-foreground text-sm mb-1"},"Create Offer"),e("p",{class:"text-sm text-muted-foreground"}," Customer showed up for the appointment. Create an offer to proceed with the opportunity. ")],-1)),e("div",oy,[n(ss,{item:null,"task-type":"opportunity","task-id":s.opportunity.id,"selected-vehicle":d.value,customer:s.opportunity.customer,"hide-header":!0,"hide-actions":!0,ref_key:"offerWidgetRef",ref:m,onSave:A},null,8,["task-id","selected-vehicle","customer"])])]))}},ry={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center rounded-lg"},uy={key:2,class:"absolute top-1 right-1 z-30"},dy=["onClick"],cy={class:"flex-1 space-y-1"},my={class:"flex flex-col"},fy={key:0,class:"text-[10px] text-muted-foreground line-clamp-2 mt-0.5 leading-tight"},py={class:"mt-auto pt-1"},vy={key:4,class:"absolute bottom-0 left-0 right-0 z-10 bg-green-600/90 text-white text-[10px] font-medium px-2 py-1.5 flex items-center justify-between pointer-events-none"},gy={key:0,class:"opacity-90"},yy={__name:"ContractCard",props:{contract:{type:Object,required:!0},variant:{type:String,default:"carousel",validator:s=>["carousel","feed"].includes(s)},showStatusBadge:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showDate:{type:Boolean,default:!0},showSignedBadge:{type:Boolean,default:!0},menuItems:{type:Array,default:()=>[]},containerClass:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["menu-action"],setup(s,{emit:$}){const i=s,l=C(()=>i.contract.id||i.contract.contractDate||`contract-${Math.random()}`),a=T(null),m=T({}),d=T({}),x=C(()=>i.contract.contractSigned||i.contract.esignatureCollectedDate),V=C(()=>(i.variant==="carousel","h-16")),A=C(()=>i.variant==="carousel"?"p-2":"p-3"),h=C(()=>i.variant==="carousel"?"h-[105px]":""),g=C(()=>i.variant==="carousel"?"text-xs":"text-sm"),v=C(()=>(i.variant==="carousel","text-xs")),b=(z,Q)=>{Q&&(m.value[z]=Q)},k=()=>{if(i.menuItems.length===0)return 120;const z=document.createElement("span");z.style.visibility="hidden",z.style.position="absolute",z.style.fontSize="0.75rem",z.style.padding="0 12px",z.style.whiteSpace="nowrap",document.body.appendChild(z);let Q=0;return i.menuItems.forEach(de=>{z.textContent=de.label;const J=z.offsetWidth;J>Q&&(Q=J)}),document.body.removeChild(z),Math.max(Q+24,120)},y=z=>{const Q=m.value[z];if(!Q)return;const de=Q.getBoundingClientRect(),J=k();d.value[z]={top:de.bottom+4,left:de.right-J,width:J}},w=async z=>{a.value===z?(a.value=null,delete d.value[z]):(a.value=z,await _a(),y(z))},r=()=>{a.value=null,d.value={}};let O=null,N=null;ye(a,z=>{if(O&&(window.removeEventListener("scroll",O,!0),window.removeEventListener("resize",N),O=null,N=null),z){const Q=()=>{z&&m.value[z]&&y(z)};O=Q,N=Q,window.addEventListener("scroll",O,!0),window.addEventListener("resize",N)}});const U=z=>{if(!z)return"";const Q=new Date(z),J=Math.abs(new Date-Q),W=Math.ceil(J/(1e3*60*60*24));return W===0?"today":W===1?"yesterday":W<7?`${W} days ago`:Q.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},M=z=>({active:"Active",signed:"Signed",draft:"Draft",archived:"Archived"})[z]||"Active",le=z=>({active:"bg-blue-600",signed:"bg-green-600",draft:"bg-gray-500",archived:"bg-gray-600"})[z]||"bg-gray-600",R=z=>x.value?"border-green-500 border-2":"border-border",E=z=>z.status==="archived"?"opacity-60":"",G=z=>z.version?`Contract v${z.version}`:z.contractDate?`Contract - ${new Date(z.contractDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})}`:"Contract";return(z,Q)=>{const de=hs("click-outside");return p(),S("div",{class:se(["bg-white border rounded-lg shadow-nsc-card overflow-visible transition-shadow relative",R(s.contract),E(s.contract),s.containerClass,{"pointer-events-none opacity-60":s.loading}])},[s.loading?(p(),S("div",ry,[...Q[2]||(Q[2]=[e("div",{class:"flex flex-col items-center gap-2"},[e("div",{class:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-xs text-muted-foreground"},"Updating...")],-1)])])):q("",!0),s.showStatusBadge&&!(x.value&&s.showSignedBadge)?(p(),S("div",{key:1,class:se(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",le(s.contract.status)])},F(M(s.contract.status)),3)):q("",!0),s.showMenu?(p(),S("div",uy,[e("button",{ref:J=>b(l.value,J),onClick:Q[0]||(Q[0]=pn(J=>w(l.value),["stop"])),title:"Contract actions",class:"relative z-30 w-6 h-6 flex items-center justify-center text-foreground hover:bg-black/10 bg-white/60 backdrop-blur-sm rounded-md transition-colors shadow-sm border border-black/5"},[n(t(Ja),{size:14})],512)])):q("",!0),s.showMenu?(p(),K($o,{key:3,to:"body"},[a.value===l.value&&d.value[l.value]?ke((p(),S("div",{key:0,class:"fixed z-[9999] bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",style:Qa({top:`${d.value[l.value].top}px`,left:`${d.value[l.value].left}px`,width:`${d.value[l.value].width}px`,minWidth:"120px"}),onClick:Q[1]||(Q[1]=pn(()=>{},["stop"]))},[(p(!0),S(be,null,Oe(s.menuItems,J=>(p(),S("button",{key:J.key,onClick:()=>{J.onClick(),r()},class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2",style:{"font-size":"0.75rem","line-height":"1.5"}},F(J.label),9,dy))),128))],4)),[[de,r]]):q("",!0)])):q("",!0),e("div",{class:se(["w-full bg-muted flex items-center justify-center overflow-hidden",V.value])},[...Q[3]||(Q[3]=[e("i",{class:"fa-solid fa-file-signature text-base text-muted-foreground"},null,-1)])],2),e("div",{class:se(["flex flex-col",A.value,h.value,{"pb-10":x.value}])},[e("div",cy,[e("h4",{class:se(["font-bold text-foreground leading-tight line-clamp-2",g.value])},F(G(s.contract)),3),e("div",my,[s.contract.contractNotes?(p(),S("p",fy,F(s.contract.contractNotes),1)):q("",!0)])]),e("div",py,[s.showDate&&s.contract.contractDate&&!(x.value&&s.showSignedBadge)?(p(),S("p",{key:0,class:se(["text-muted-foreground",v.value])},F(U(s.contract.contractDate)),3)):q("",!0)])],2),s.showSignedBadge&&x.value?(p(),S("div",vy,[Q[4]||(Q[4]=e("span",{class:"flex items-center gap-1"},[e("i",{class:"fa-solid fa-check-circle"}),D(" Signed ")],-1)),s.contract.esignatureCollectedDate?(p(),S("span",gy,F(U(s.contract.esignatureCollectedDate)),1)):q("",!0)])):q("",!0)],2)}}},by={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},hy={class:"space-y-4"},xy={__name:"CollectESignaturesModal",props:{show:{type:Boolean,required:!0},contract:{type:Object,default:null},maxContractDate:{type:String,default:""}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=s,l=$,a=T(""),m=T(""),d=T(""),x=C(()=>i.maxContractDate?i.maxContractDate:new Date().toISOString().split("T")[0]),V=C(()=>!!a.value);ye(()=>i.show,v=>{var b,k;if(v){const y=new Date;if(a.value=y.toISOString().split("T")[0],m.value=y.toTimeString().slice(0,5),d.value="",(b=i.contract)!=null&&b.contractDate){const w=new Date(i.contract.contractDate);if(a.value=w.toISOString().split("T")[0],w.getHours()||w.getMinutes()){const r=String(w.getHours()).padStart(2,"0"),O=String(w.getMinutes()).padStart(2,"0");m.value=`${r}:${O}`}}(k=i.contract)!=null&&k.contractNotes&&(d.value=i.contract.contractNotes)}});const A=()=>{if(!a.value)return;const v=m.value?`${a.value}T${m.value}:00`:`${a.value}T12:00:00`;l("confirm",{contractDate:v,contractTime:m.value,notes:d.value})},h=()=>{l("cancel")},g=v=>{v||h()};return(v,b)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":g},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...b[3]||(b[3]=[D("Collect e-signatures, finalize contract",-1)])]),_:1}),b[4]||(b[4]=e("p",{class:"text-sm text-muted-foreground mt-1"}," Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs. ",-1))]),_:1}),e("div",by,[e("div",hy,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[5]||(b[5]=[D("Contract Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=k=>a.value=k),max:x.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[6]||(b[6]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:m.value,"onUpdate:modelValue":b[1]||(b[1]=k=>m.value=k),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[7]||(b[7]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:d.value,"onUpdate:modelValue":b[2]||(b[2]=k=>d.value=k),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full"},null,8,["modelValue"])])])]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:h}),n(t(_),{label:"Collect e-signatures",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!V.value,onClick:A},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},wy={key:0},ky={class:"flex items-center justify-between mb-2"},Sy={class:"flex items-center gap-2"},Cy={class:"font-semibold text-foreground text-sm"},$y={class:"relative"},Dy={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Ay={class:"w-8 h-8 rounded-full bg-background border border-border flex items-center justify-center text-muted-foreground group-hover:text-foreground transition-colors shadow-sm"},Oy={key:1,class:"flex flex-col items-center justify-center py-6 px-3 bg-muted border border-border rounded-lg gap-3"},Ty={__name:"ContractCarousel",props:{contracts:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0},maxContractDate:{type:String,default:""}},emits:["generate-pdf","contract-activated","collect-esignatures","add"],setup(s,{expose:$,emit:i}){const l=i,a=T(new Set),m=T(!1),d=T(null),x=(g,v)=>{v?a.value.add(g):a.value.delete(g)},V=g=>{const v=[];return!g.contractSigned&&!g.esignatureCollectedDate&&v.push({key:"collect-esignatures",label:"Collect e-signatures",onClick:()=>{d.value=g,m.value=!0}}),v.push({key:"generate-contract-pdf",label:"Generate Contract PDF",onClick:()=>{l("generate-pdf",g)}}),v},A=g=>{d.value&&(x(d.value.id||d.value.contractDate,!0),l("collect-esignatures",{contract:d.value,formData:g})),m.value=!1,d.value=null},h=()=>{m.value=!1,d.value=null};return $({setContractLoading:x}),(g,v)=>(p(),S(be,null,[s.contracts&&s.contracts.length>0?(p(),S("div",wy,[e("div",ky,[e("div",Sy,[e("h3",Cy,"Contracts ("+F(s.contracts.length)+")",1)])]),e("div",$y,[e("div",Dy,[(p(!0),S(be,null,Oe(s.contracts,b=>(p(),K(yy,{key:`contract-${b.id||b.contractDate}-${b.version||"v1"}`,contract:b,variant:"carousel","menu-items":V(b),loading:a.value.has(b.id||b.contractDate),"container-class":"flex-none w-36 snap-start"},null,8,["contract","menu-items","loading"]))),128)),e("button",{class:"flex-none w-36 h-[171px] snap-start bg-muted/50 border-2 border-dashed border-border rounded-lg flex flex-col items-center justify-center gap-2 hover:bg-muted/80 transition-colors group",onClick:v[0]||(v[0]=b=>g.$emit("add"))},[e("div",Ay,[n(t(Va),{size:20})]),v[2]||(v[2]=e("span",{class:"text-[10px] font-medium text-muted-foreground group-hover:text-foreground uppercase tracking-wider"},"New Contract",-1))])])])])):(p(),S("div",Oy,[v[3]||(v[3]=e("i",{class:"fa-solid fa-file-contract text-2xl text-muted-foreground"},null,-1)),v[4]||(v[4]=e("p",{class:"text-xs font-medium text-muted-foreground"},"No contracts created yet",-1)),v[5]||(v[5]=e("p",{class:"text-xs text-muted-foreground"},"Create a contract to track versions",-1)),e("button",{class:"inline-flex items-center justify-center gap-2 w-10 h-10 rounded-full bg-background border-2 border-dashed border-border text-muted-foreground hover:border-foreground hover:text-foreground transition-colors",onClick:v[1]||(v[1]=b=>g.$emit("add")),title:"Add contract"},[n(t(Va),{size:20})])])),n(xy,{show:m.value,contract:d.value,"max-contract-date":s.maxContractDate,onConfirm:A,onCancel:h},null,8,["show","contract","max-contract-date"])],64))}},Ra=Zt(Ty,[["__scopeId","data-v-ca533735"]]),Iy={class:"rounded-lg flex flex-col bg-muted"},Vy={class:"pt-1 px-1"},Ny={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},Fy={class:"p-6"},Uy={class:"mb-3"},qy={class:"text-sm text-muted-foreground mt-0.5"},Ly={key:0,class:"ml-2"},Py=["href"],My={class:"flex flex-wrap gap-3 items-center"},Ey={class:"outcome-toggle-group flex flex-wrap gap-3"},Ry={class:"px-4 py-4 space-y-4"},jy={key:0},By={key:2},zy={key:3,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Wy={key:0,class:"mt-4"},Yy={key:4,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Hy={__name:"AppointmentManagementSection",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},showRescheduleSection:{type:Boolean,default:!1},showNsTaskSection:{type:Boolean,default:!1},showOfferAssignmentSection:{type:Boolean,default:!1},nsTaskCount:{type:Number,default:0},canSubmitNsTask:{type:Boolean,default:!1},nsTaskButtonLabel:{type:String,default:"Assign"},canCreateOffer:{type:Boolean,default:!1},secondaryActions:{type:Array,default:()=>[]},customerName:{type:String,default:""},customerProfileUrl:{type:String,default:""},isAppointmentToday:{type:Boolean,default:!1}},emits:["confirm-appointment","update:show-reschedule-section","update:show-ns-task-section","update:show-offer-assignment-section","mark-no-show","mark-showed-up","reschedule-submit","reschedule-cancel","ns-assigned","ns-cancel","ns-confirm","ns-close-as-lost","offer-assignment-created","offer-assignment-cancel","offer-assignment-confirm","secondary-action","customer-click","close-as-lost-confirmed"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=T(null),x=T(null),V=T(null),A=T(null),h=T(null),{reason:g,notes:v,cardRef:b,reset:k}=cl(),y=["close-lost"];function w(U){a("customer-click",U)}function r(U){y.includes(U.key)?h.value===U.key?h.value=null:(h.value=U.key,a("update:show-reschedule-section",!1),a("update:show-ns-task-section",!1),a("update:show-offer-assignment-section",!1),U.key==="close-lost"&&k()):a("secondary-action",U)}function O(){h.value=null,k()}function N(U){a("close-as-lost-confirmed",{reason:U.reason,notes:U.notes}),h.value=null,g.value="",v.value=""}return ye(()=>l.showRescheduleSection,U=>{U&&(h.value=null)}),ye(()=>l.showNsTaskSection,U=>{U&&(h.value=null)}),ye(()=>l.showOfferAssignmentSection,U=>{U&&(h.value=null)}),$({scheduleFormRef:m,ns1TaskRef:d,ns2TaskRef:x,ns3TaskRef:V,offerAssignmentTaskRef:A,closeAsLostCardRef:b}),(U,M)=>{var le,R;return p(),S("div",Iy,[e("div",Vy,[e("div",Ny,[e("div",Fy,[e("div",Uy,[M[19]||(M[19]=e("h4",{class:"font-bold text-foreground text-sm"},"Manage Appointment",-1)),e("p",qy,[D(" Appointment scheduled for "+F((le=s.scheduledAppointment)!=null&&le.start?t(Fn)(s.scheduledAppointment.start):"TBD")+" ",1),s.opportunity.customer||s.opportunity.customerId?(p(),S("span",Ly,[M[18]||(M[18]=D(" with ",-1)),e("a",{href:s.customerProfileUrl,target:"_blank",onClick:pn(w,["stop"]),class:"text-primary hover:underline font-medium"},F(s.customerName),9,Py)])):q("",!0)])]),e("div",My,[((R=s.scheduledAppointment)==null?void 0:R.status)==="pending_confirmation"?(p(),K(t(_),{key:0,variant:"outline",onClick:M[0]||(M[0]=E=>U.$emit("confirm-appointment")),class:"inline-flex items-center gap-2 cursor-pointer"},{default:o(()=>[...M[20]||(M[20]=[e("i",{class:"fa-solid fa-calendar-check"},null,-1),e("span",null,"Confirm appointment",-1)])]),_:1})):q("",!0),e("div",Ey,[s.isAppointmentToday?q("",!0):(p(),K(t(Ue),{key:0,variant:"outline","model-value":s.showRescheduleSection,"onUpdate:modelValue":M[1]||(M[1]=E=>{U.$emit("update:show-reschedule-section",E),E&&(U.$emit("update:show-ns-task-section",!1),U.$emit("update:show-offer-assignment-section",!1),h.value.value=null)}),class:"outcome-toggle-item"},{default:o(()=>[...M[21]||(M[21]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),e("span",null,"Reschedule",-1)])]),_:1},8,["model-value"])),s.isAppointmentToday?(p(),K(t(Ue),{key:1,variant:"outline","model-value":s.showNsTaskSection,"onUpdate:modelValue":M[2]||(M[2]=E=>{E?(U.$emit("mark-no-show"),h.value.value=null):U.$emit("update:show-ns-task-section",!1)}),class:"outcome-toggle-item"},{default:o(()=>[...M[22]||(M[22]=[e("i",{class:"fa-solid fa-user-slash"},null,-1),e("span",null,"Mark No-Show",-1)])]),_:1},8,["model-value"])):q("",!0),s.isAppointmentToday?(p(),K(t(Ue),{key:2,variant:"outline","model-value":s.showOfferAssignmentSection,"onUpdate:modelValue":M[3]||(M[3]=E=>{E?(U.$emit("mark-showed-up"),h.value.value=null):U.$emit("update:show-offer-assignment-section",!1)}),class:"outcome-toggle-item"},{default:o(()=>[...M[23]||(M[23]=[e("i",{class:"fa-solid fa-user-check"},null,-1),e("span",null,"Mark Showed Up",-1)])]),_:1},8,["model-value"])):q("",!0)]),s.secondaryActions&&s.secondaryActions.length>0?(p(),K(Un,{key:1,actions:s.secondaryActions,onActionSelected:r},null,8,["actions"])):q("",!0)])])])]),e("div",Ry,[s.showRescheduleSection?(p(),S("div",jy,[n(Zs,{ref_key:"scheduleFormRef",ref:m,opportunity:s.opportunity,mode:"reschedule","initial-appointment":s.scheduledAppointment,onSubmit:M[4]||(M[4]=E=>U.$emit("reschedule-submit",E)),onCancel:M[5]||(M[5]=E=>U.$emit("reschedule-cancel"))},null,8,["opportunity","initial-appointment"])])):q("",!0),h.value==="close-lost"?(p(),K(Ks,{key:1,ref_key:"closeAsLostCardRef",ref:b,"preselected-reason":t(g),"preselected-notes":t(v),onCancel:O,onConfirm:N},null,8,["preselected-reason","preselected-notes"])):q("",!0),s.showNsTaskSection?(p(),S("div",By,[s.nsTaskCount===1?(p(),K(jg,{key:0,ref_key:"ns1TaskRef",ref:d,opportunity:s.opportunity,"scheduled-appointment":s.scheduledAppointment,onAssigned:M[6]||(M[6]=E=>U.$emit("ns-assigned",E)),onCancel:M[7]||(M[7]=E=>U.$emit("ns-cancel"))},null,8,["opportunity","scheduled-appointment"])):s.nsTaskCount===2?(p(),K(Xg,{key:1,ref_key:"ns2TaskRef",ref:x,opportunity:s.opportunity,"scheduled-appointment":s.scheduledAppointment,onAssigned:M[8]||(M[8]=E=>U.$emit("ns-assigned",E)),onCancel:M[9]||(M[9]=E=>U.$emit("ns-cancel"))},null,8,["opportunity","scheduled-appointment"])):s.nsTaskCount>=3?(p(),K(ay,{key:2,ref_key:"ns3TaskRef",ref:V,opportunity:s.opportunity,"scheduled-appointment":s.scheduledAppointment,onCloseAsLost:M[10]||(M[10]=E=>U.$emit("ns-close-as-lost",E)),onCancel:M[11]||(M[11]=E=>U.$emit("ns-cancel"))},null,8,["opportunity","scheduled-appointment"])):q("",!0)])):q("",!0),s.showNsTaskSection?(p(),S("div",zy,[n(t(_),{variant:"secondary",onClick:M[12]||(M[12]=E=>U.$emit("ns-cancel"))},{default:o(()=>[...M[24]||(M[24]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"primary",disabled:!s.canSubmitNsTask,onClick:M[13]||(M[13]=E=>U.$emit("ns-confirm")),class:"bg-primary"},{default:o(()=>[D(F(s.nsTaskButtonLabel),1)]),_:1},8,["disabled"])])):q("",!0),n(bs,{name:"expand"},{default:o(()=>[s.showOfferAssignmentSection?(p(),S("div",Wy,[n(iy,{ref_key:"offerAssignmentTaskRef",ref:A,opportunity:s.opportunity,"scheduled-appointment":s.scheduledAppointment,onOfferCreated:M[14]||(M[14]=E=>U.$emit("offer-assignment-created",E)),onCancel:M[15]||(M[15]=E=>U.$emit("offer-assignment-cancel"))},null,8,["opportunity","scheduled-appointment"])])):q("",!0)]),_:1}),s.showOfferAssignmentSection?(p(),S("div",Yy,[n(t(_),{variant:"secondary",onClick:M[16]||(M[16]=E=>U.$emit("offer-assignment-cancel"))},{default:o(()=>[...M[25]||(M[25]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"primary",disabled:!s.canCreateOffer,onClick:M[17]||(M[17]=E=>U.$emit("offer-assignment-confirm")),class:"bg-primary"},{default:o(()=>[...M[26]||(M[26]=[D(" Create Offer ",-1)])]),_:1},8,["disabled"])])):q("",!0)])])}}},Qy=Zt(Hy,[["__scopeId","data-v-a28942d8"]]),Gy={class:"rounded-lg flex flex-col bg-muted"},_y={class:"pt-1 px-1"},Jy={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},Ky={class:"p-6"},Zy={class:"mb-3"},Xy={class:"text-sm text-muted-foreground mt-0.5"},e1={key:0,class:"mb-4 p-4 bg-muted rounded-lg"},t1={class:"flex flex-wrap gap-3 items-center"},n1={key:0,class:"outcome-toggle-group flex flex-wrap gap-3"},s1={key:1,class:"outcome-toggle-group flex flex-wrap gap-3"},a1={class:"px-4 py-4 space-y-4"},l1={key:0,class:"space-y-4"},o1={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},i1={class:"followup-channel-toggle-group flex flex-wrap gap-2 mb-4"},r1={key:0,class:"space-y-3"},u1={key:0},d1={class:"flex items-center justify-between gap-2"},c1={class:"text-muted-foreground text-xs"},m1={key:1,class:"flex justify-end gap-2 pt-3"},f1={key:2},p1={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},v1={key:3,class:"flex justify-end gap-2 pt-3"},g1={key:4,class:"space-y-4"},y1={class:"flex justify-between items-center pt-3"},b1={class:"flex gap-2"},h1={__name:"NegotiationManagementSection",props:{opportunity:{type:Object,required:!0},showNegotiationSection:{type:Boolean,default:!1},showAddOfferSection:{type:Boolean,default:!1},showSurveySection:{type:Boolean,default:!1},negotiationChannel:{type:String,default:null},negotiationMessage:{type:String,default:""},negotiationSelectedOfferId:{type:String,default:null},offerSelectOptions:{type:Array,default:()=>[]},canSendNegotiationMessage:{type:Boolean,default:!1},canCreateInlineOffer:{type:Boolean,default:!1},secondaryActions:{type:Array,default:()=>[]}},emits:["update:show-negotiation-section","update:show-add-offer-section","update:show-survey-section","update:negotiation-channel","update:negotiation-message","update:negotiation-selected-offer-id","reset-negotiation-form","send-negotiation-message","cancel-negotiation","offer-created","cancel-add-offer","confirm-add-offer","offer-accepted","mark-offer-accepted","secondary-action","ofb-postpone","survey-submitted","survey-cancelled"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=T(null),d=T(null);C(()=>{var w;return((w=l.opportunity)==null?void 0:w.offers)&&l.opportunity.offers.length>0});const x=C(()=>{const w=l.opportunity.lastActivity||l.opportunity.createdAt;if(!w)return 0;const r=new Date(w),N=Math.abs(new Date-r);return Math.ceil(N/(1e3*60*60*24))}),V=C(()=>{var w;return((w=d.value)==null?void 0:w.isValid)||!1}),A=()=>{d.value&&d.value.submit()},h=w=>{a("survey-submitted",{opportunity:l.opportunity,surveyData:w}),a("update:show-survey-section",!1)},g=()=>{a("update:show-survey-section",!1),a("survey-cancelled",{opportunity:l.opportunity})},v=w=>{a("ofb-postpone",w),a("update:show-survey-section",!1)},b=w=>{const r=["add-offer","create-offer"],O=["follow-up","request-feedback","collect-feedback","reassign","schedule-appointment","close-lost"];if(r.includes(w.key)){const N=!l.showAddOfferSection;a("update:show-add-offer-section",N),N&&(a("update:show-negotiation-section",!1),a("update:show-survey-section",!1))}else if(O.includes(w.key)){const N=!l.showNegotiationSection;a("update:show-negotiation-section",N),N?(a("update:show-add-offer-section",!1),a("update:show-survey-section",!1)):a("reset-negotiation-form")}else{const N=!l.showNegotiationSection;a("update:show-negotiation-section",N),N?(a("update:show-add-offer-section",!1),a("update:show-survey-section",!1)):a("reset-negotiation-form")}a("secondary-action",w)},k=C(()=>{var O,N;if(((O=l.opportunity)==null?void 0:O.negotiationSubstatus)!=="Offer Sent")return!1;const r={opportunity:l.opportunity,hasOffers:((N=l.opportunity)==null?void 0:N.offers)&&l.opportunity.offers.length>0,stage:"In Negotiation",activities:[]};return Ua["negotiation-5-plus-days-no-contract-has-offers"](r)});C(()=>{var N,U,M;if(!(((N=l.opportunity)==null?void 0:N.id)===33)&&!l.showNegotiationSection&&!l.showAddOfferSection||((U=l.opportunity)==null?void 0:U.negotiationSubstatus)!=="Offer Sent")return!1;const O={opportunity:l.opportunity,hasOffers:((M=l.opportunity)==null?void 0:M.offers)&&l.opportunity.offers.length>0,stage:"In Negotiation",activities:[]};return Ua["negotiation-5-plus-days-no-contract-has-offers"](O)});function y(w){return new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(w).replace("€","€")}return $({addOfferWidgetRef:m,ofbTaskRef:d}),(w,r)=>(p(),S("div",Gy,[e("div",_y,[e("div",Jy,[e("div",Ky,[e("div",Zy,[r[18]||(r[18]=e("h4",{class:"font-bold text-foreground text-sm"},"Manage Offers & Follow Up",-1)),e("p",Xy,[s.opportunity.offers&&s.opportunity.offers.length>0?(p(),S(be,{key:0},[k.value?(p(),S(be,{key:0},[D(" This opportunity has been in negotiation for "+F(x.value)+" days without a contract. Follow up with customer to get feedback and move forward. ",1)],64)):(p(),S(be,{key:1},[D(" Follow up with customer about offers ")],64))],64)):(p(),S(be,{key:1},[D(" Create an offer to continue negotiation ")],64))])]),!s.opportunity.offers||s.opportunity.offers.length===0?(p(),S("div",e1,[...r[19]||(r[19]=[e("p",{class:"text-sm text-muted-foreground"},"No offers yet. Create your first offer to continue.",-1)])])):q("",!0),e("div",t1,[s.opportunity.negotiationSubstatus==="Offer Sent"?(p(),S("div",n1,[n(t(Ue),{variant:"outline","model-value":s.showNegotiationSection,"onUpdate:modelValue":r[0]||(r[0]=O=>{w.$emit("update:show-negotiation-section",O),O?(w.$emit("update:show-add-offer-section",!1),w.$emit("update:show-survey-section",!1)):w.$emit("reset-negotiation-form")}),class:"outcome-toggle-item"},{default:o(()=>[...r[20]||(r[20]=[e("i",{class:"fa-solid fa-phone-volume"},null,-1),e("span",null,"Follow Up",-1)])]),_:1},8,["model-value"]),k.value?(p(),K(t(Ue),{key:0,variant:"outline","model-value":s.showSurveySection,"onUpdate:modelValue":r[1]||(r[1]=O=>{w.$emit("update:show-survey-section",O),O&&(w.$emit("update:show-negotiation-section",!1),w.$emit("update:show-add-offer-section",!1))}),class:"outcome-toggle-item"},{default:o(()=>[...r[21]||(r[21]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["model-value"])):q("",!0)])):(p(),S("div",s1,[n(t(Ue),{variant:"outline","model-value":s.showNegotiationSection,"onUpdate:modelValue":r[2]||(r[2]=O=>{w.$emit("update:show-negotiation-section",O),O?(w.$emit("update:show-add-offer-section",!1),w.$emit("update:show-survey-section",!1)):w.$emit("reset-negotiation-form")}),class:"outcome-toggle-item"},{default:o(()=>[r[22]||(r[22]=e("i",{class:"fa-solid fa-phone-volume"},null,-1)),e("span",null,F(s.opportunity.negotiationSubstatus==="Offer Feedback"?"Request Feedback":"Follow Up"),1)]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":s.showAddOfferSection,"onUpdate:modelValue":r[3]||(r[3]=O=>{w.$emit("update:show-add-offer-section",O),O&&(w.$emit("update:show-negotiation-section",!1),w.$emit("update:show-survey-section",!1))}),class:"outcome-toggle-item"},{default:o(()=>[...r[23]||(r[23]=[e("i",{class:"fa-solid fa-plus"},null,-1),e("span",null,"Add Offer",-1)])]),_:1},8,["model-value"]),k.value?(p(),K(t(Ue),{key:0,variant:"outline","model-value":s.showSurveySection,"onUpdate:modelValue":r[4]||(r[4]=O=>{w.$emit("update:show-survey-section",O),O&&(w.$emit("update:show-negotiation-section",!1),w.$emit("update:show-add-offer-section",!1))}),class:"outcome-toggle-item"},{default:o(()=>[...r[24]||(r[24]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["model-value"])):q("",!0)])),s.secondaryActions&&s.secondaryActions.length>0?(p(),K(Un,{key:2,actions:s.secondaryActions,onActionSelected:b},null,8,["actions"])):q("",!0)])])])]),e("div",a1,[s.showNegotiationSection?(p(),S("div",l1,[e("div",o1,[r[31]||(r[31]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Contact Customer",-1)),e("div",i1,[n(t(Ue),{variant:"outline","model-value":s.negotiationChannel==="call","onUpdate:modelValue":r[5]||(r[5]=O=>O&&w.$emit("update:negotiation-channel","call")),class:"followup-toggle-item"},{default:o(()=>[...r[25]||(r[25]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":s.negotiationChannel==="whatsapp","onUpdate:modelValue":r[6]||(r[6]=O=>O&&w.$emit("update:negotiation-channel","whatsapp")),class:"followup-toggle-item"},{default:o(()=>[...r[26]||(r[26]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":s.negotiationChannel==="sms","onUpdate:modelValue":r[7]||(r[7]=O=>O&&w.$emit("update:negotiation-channel","sms")),class:"followup-toggle-item"},{default:o(()=>[...r[27]||(r[27]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["model-value"]),n(t(Ue),{variant:"outline","model-value":s.negotiationChannel==="email","onUpdate:modelValue":r[8]||(r[8]=O=>O&&w.$emit("update:negotiation-channel","email")),class:"followup-toggle-item"},{default:o(()=>[...r[28]||(r[28]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["model-value"])]),s.negotiationChannel?(p(),S("div",r1,[s.offerSelectOptions.length>0?(p(),S("div",u1,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...r[29]||(r[29]=[D("Select offer to reference (Optional)",-1)])]),_:1}),n(t(vt),{"model-value":s.negotiationSelectedOfferId,"onUpdate:modelValue":r[9]||(r[9]=O=>w.$emit("update:negotiation-selected-offer-id",O)),items:s.offerSelectOptions,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:o(({item:O})=>[e("div",d1,[e("span",null,F(O.label),1),e("span",c1,"€ "+F(y(O.price)),1)])]),_:1},8,["model-value","items"])])):q("",!0),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...r[30]||(r[30]=[D("Message",-1)])]),_:1}),n(t(Xe),{"model-value":s.negotiationMessage,"onUpdate:modelValue":r[10]||(r[10]=O=>w.$emit("update:negotiation-message",O)),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["model-value"])])])):q("",!0)])])):q("",!0),s.showNegotiationSection?(p(),S("div",m1,[n(t(_),{variant:"secondary",onClick:r[11]||(r[11]=O=>w.$emit("cancel-negotiation"))},{default:o(()=>[...r[32]||(r[32]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!s.canSendNegotiationMessage,onClick:r[12]||(r[12]=O=>w.$emit("send-negotiation-message"))},{default:o(()=>[...r[33]||(r[33]=[D(" Send Message ",-1)])]),_:1},8,["disabled"])])):q("",!0),s.showAddOfferSection?(p(),S("div",f1,[e("div",p1,[n(ss,{ref_key:"addOfferWidgetRef",ref:m,"task-id":s.opportunity.id,"task-type":"opportunity",customer:s.opportunity.customer,"selected-vehicle":s.opportunity.selectedVehicle||s.opportunity.vehicle||s.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:r[13]||(r[13]=O=>w.$emit("offer-created",O)),onCancel:r[14]||(r[14]=O=>w.$emit("cancel-add-offer"))},null,8,["task-id","customer","selected-vehicle"])])])):q("",!0),s.showAddOfferSection?(p(),S("div",v1,[n(t(_),{variant:"secondary",onClick:r[15]||(r[15]=O=>w.$emit("cancel-add-offer"))},{default:o(()=>[...r[34]||(r[34]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!s.canCreateInlineOffer,onClick:r[16]||(r[16]=O=>w.$emit("confirm-add-offer"))},{default:o(()=>[...r[35]||(r[35]=[D(" Create Offer ",-1)])]),_:1},8,["disabled"])])):q("",!0),s.showSurveySection&&k.value?(p(),S("div",g1,[n(ul,{ref_key:"ofbTaskRef",ref:d,opportunity:s.opportunity,onSubmit:h,onPostpone:v},null,8,["opportunity"]),e("div",y1,[n(t(_),{variant:"secondary",onClick:r[17]||(r[17]=O=>w.$emit("ofb-postpone","ofb")),class:"flex items-center gap-2"},{default:o(()=>[...r[36]||(r[36]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("span",null,"Postpone",-1)])]),_:1}),e("div",b1,[n(t(_),{variant:"secondary",onClick:g},{default:o(()=>[...r[37]||(r[37]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!V.value,onClick:A},{default:o(()=>[...r[38]||(r[38]=[D(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])])):q("",!0)])]))}},x1={class:"rounded-lg flex flex-col bg-muted"},w1={class:"pt-1 px-1"},k1={key:0,class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},S1={class:"p-6"},C1={class:"flex flex-wrap gap-3 items-center"},$1={key:1,class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},D1={class:"p-6"},A1={class:"flex flex-wrap gap-3 items-center"},O1={class:"outcome-toggle-group flex flex-wrap gap-3"},T1={class:"px-4 py-4 space-y-4"},I1={key:0},V1={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},N1={key:1,class:"flex justify-end gap-2 pt-3"},F1={key:2},U1={key:3},q1={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},L1={class:"space-y-4"},P1={class:"flex justify-end gap-2 mt-4"},M1={key:4},E1={__name:"ContractPendingManagementSection",props:{opportunity:{type:Object,required:!0},hasContracts:{type:Boolean,default:!1},showAddOfferContractPendingSection:{type:Boolean,default:!1},showCloseAsLostSection:{type:Boolean,default:!1},showScheduleAppointmentContractPendingSection:{type:Boolean,default:!1},showSetDeliveryDateSection:{type:Boolean,default:!1},closeAsLostReason:{type:String,default:""},closeAsLostNotes:{type:String,default:""},deliveryDateForm:{type:Object,required:!0},hasDeliveryDate:{type:Boolean,default:!1},minDeliveryDate:{type:String,default:""},canSubmitSetDeliveryDate:{type:Boolean,default:!1},contractPendingActions:{type:Array,default:()=>[]},canCreateInlineOfferContractPending:{type:Boolean,default:!1}},emits:["update:show-add-offer-contract-pending-section","update:show-schedule-appointment-contract-pending-section","update:show-set-delivery-date-section","update:delivery-date-form","offer-created-contract-pending","cancel-add-offer-contract-pending","confirm-add-offer-contract-pending","confirm-set-delivery-date","cancel-set-delivery-date","schedule-appointment-contract-pending-submit","cancel-schedule-appointment-contract-pending","contract-pending-action","close-as-lost-cancel","close-as-lost-confirm"],setup(s,{expose:$}){const i=T(null),l=T(null),a=T(null);return $({addOfferContractPendingRef:i,scheduleAppointmentContractPendingFormRef:l,closeAsLostCardRef:a}),(m,d)=>(p(),S("div",x1,[e("div",w1,[s.hasContracts?(p(),S("div",$1,[e("div",D1,[d[19]||(d[19]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-foreground text-sm"},"Set Delivery Date"),e("p",{class:"text-sm text-muted-foreground mt-0.5"}," Schedule vehicle delivery with the customer. Set the delivery date, time, and location. ")],-1)),e("div",A1,[e("div",O1,[s.hasDeliveryDate?q("",!0):(p(),K(t(Ue),{key:0,variant:"outline","model-value":s.showSetDeliveryDateSection,"onUpdate:modelValue":d[1]||(d[1]=x=>m.$emit("update:show-set-delivery-date-section",x)),class:"outcome-toggle-item"},{default:o(()=>[...d[18]||(d[18]=[e("i",{class:"fa-solid fa-truck"},null,-1),e("span",null,"Set Delivery Date",-1)])]),_:1},8,["model-value"]))]),n(Un,{actions:s.contractPendingActions,onActionSelected:d[2]||(d[2]=x=>m.$emit("contract-pending-action",x))},null,8,["actions"])])])])):(p(),S("div",k1,[e("div",S1,[d[17]||(d[17]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-foreground text-sm"},"Add contract"),e("p",{class:"text-sm text-muted-foreground mt-0.5"}," Create a new contract to track versions. Use the + button on the carousel above to add a contract. ")],-1)),e("div",C1,[n(Un,{actions:s.contractPendingActions,onActionSelected:d[0]||(d[0]=x=>m.$emit("contract-pending-action",x))},null,8,["actions"])])])]))]),e("div",T1,[s.showAddOfferContractPendingSection?(p(),S("div",I1,[e("div",V1,[n(ss,{ref_key:"addOfferContractPendingRef",ref:i,"task-id":s.opportunity.id,"task-type":"opportunity",customer:s.opportunity.customer,"selected-vehicle":s.opportunity.selectedVehicle||s.opportunity.vehicle||s.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:d[3]||(d[3]=x=>m.$emit("offer-created-contract-pending",x)),onCancel:d[4]||(d[4]=x=>m.$emit("cancel-add-offer-contract-pending"))},null,8,["task-id","customer","selected-vehicle"])])])):q("",!0),s.showAddOfferContractPendingSection?(p(),S("div",N1,[n(t(_),{variant:"secondary",onClick:d[5]||(d[5]=x=>m.$emit("cancel-add-offer-contract-pending"))},{default:o(()=>[...d[20]||(d[20]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!s.canCreateInlineOfferContractPending,onClick:d[6]||(d[6]=x=>m.$emit("confirm-add-offer-contract-pending"))},{default:o(()=>[...d[21]||(d[21]=[D(" Create Offer ",-1)])]),_:1},8,["disabled"])])):q("",!0),s.showCloseAsLostSection?(p(),S("div",F1,[n(Ks,{ref_key:"closeAsLostCardRef",ref:a,"preselected-reason":s.closeAsLostReason,"preselected-notes":s.closeAsLostNotes,onCancel:d[7]||(d[7]=x=>m.$emit("close-as-lost-cancel")),onConfirm:d[8]||(d[8]=x=>m.$emit("close-as-lost-confirm",x))},null,8,["preselected-reason","preselected-notes"])])):q("",!0),s.showSetDeliveryDateSection?(p(),S("div",U1,[e("div",q1,[d[29]||(d[29]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Set Delivery Date",-1)),e("div",L1,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...d[22]||(d[22]=[D("Delivery Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date","model-value":s.deliveryDateForm.deliveryDate,"onUpdate:modelValue":d[9]||(d[9]=x=>m.$emit("update:delivery-date-form",{...s.deliveryDateForm,deliveryDate:x})),min:s.minDeliveryDate,class:"w-full"},null,8,["model-value","min"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...d[23]||(d[23]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time","model-value":s.deliveryDateForm.deliveryTime,"onUpdate:modelValue":d[10]||(d[10]=x=>m.$emit("update:delivery-date-form",{...s.deliveryDateForm,deliveryTime:x})),class:"w-full"},null,8,["model-value"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...d[24]||(d[24]=[D("Delivery Location",-1)])]),_:1}),n(t($t),{"model-value":s.deliveryDateForm.deliveryLocation,"onUpdate:modelValue":d[11]||(d[11]=x=>m.$emit("update:delivery-date-form",{...s.deliveryDateForm,deliveryLocation:x}))},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select location..."})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Dealership"},{default:o(()=>[...d[25]||(d[25]=[D("At Dealership",-1)])]),_:1}),n(t(he),{value:"Customer Address"},{default:o(()=>[...d[26]||(d[26]=[D("Customer Address",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...d[27]||(d[27]=[D("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["model-value"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...d[28]||(d[28]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{"model-value":s.deliveryDateForm.notes,"onUpdate:modelValue":d[12]||(d[12]=x=>m.$emit("update:delivery-date-form",{...s.deliveryDateForm,notes:x})),rows:"4",placeholder:"Add any relevant delivery details...",class:"w-full"},null,8,["model-value"])])])]),e("div",P1,[n(t(_),{variant:"secondary",onClick:d[13]||(d[13]=x=>m.$emit("cancel-set-delivery-date"))},{default:o(()=>[...d[30]||(d[30]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!s.canSubmitSetDeliveryDate,onClick:d[14]||(d[14]=x=>m.$emit("confirm-set-delivery-date"))},{default:o(()=>[...d[31]||(d[31]=[D(" Set Delivery Date ",-1)])]),_:1},8,["disabled"])])])):q("",!0),s.showScheduleAppointmentContractPendingSection?(p(),S("div",M1,[n(Zs,{ref_key:"scheduleAppointmentContractPendingFormRef",ref:l,opportunity:s.opportunity,mode:"schedule",onSubmit:d[15]||(d[15]=x=>m.$emit("schedule-appointment-contract-pending-submit",x)),onCancel:d[16]||(d[16]=x=>m.$emit("cancel-schedule-appointment-contract-pending"))},null,8,["opportunity"])])):q("",!0)])]))}},R1={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},j1={class:"space-y-4"},B1={__name:"CreateContractModal",props:{show:{type:Boolean,required:!0},maxContractDate:{type:String,default:""}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=s,l=$,a=T(""),m=T(""),d=T(""),x=C(()=>i.maxContractDate?i.maxContractDate:new Date().toISOString().split("T")[0]),V=C(()=>!!a.value);ye(()=>i.show,v=>{if(v){const b=new Date;a.value=b.toISOString().split("T")[0],m.value=b.toTimeString().slice(0,5),d.value=""}});function A(){V.value&&l("confirm",{contractDate:a.value,contractTime:m.value,notes:d.value})}function h(){l("cancel")}function g(v){v||h()}return(v,b)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":g},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:o(()=>[n(t(At),{class:"flex-shrink-0"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...b[3]||(b[3]=[D("Create contract",-1)])]),_:1}),b[4]||(b[4]=e("p",{class:"text-sm text-muted-foreground mt-1"}," Create a new contract to track versions. Set the contract date and optional notes. ",-1))]),_:1}),e("div",R1,[e("div",j1,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[5]||(b[5]=[D("Contract Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=k=>a.value=k),type:"date",max:x.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[6]||(b[6]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{modelValue:m.value,"onUpdate:modelValue":b[1]||(b[1]=k=>m.value=k),type:"time",class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...b[7]||(b[7]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:d.value,"onUpdate:modelValue":b[2]||(b[2]=k=>d.value=k),rows:"4",placeholder:"Add any relevant notes about the contract...",class:"w-full"},null,8,["modelValue"])])])]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:h}),n(t(_),{label:"Create contract",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!V.value,onClick:A},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},z1={class:"flex-1 overflow-y-auto px-6 py-4"},W1={__name:"CreateOfferModal",props:{show:{type:Boolean,required:!0},opportunity:{type:Object,default:null}},emits:["confirm","cancel"],setup(s,{emit:$}){const i=s,l=$,a=T(null),m=C(()=>{var h;return((h=a.value)==null?void 0:h.isValid)??!1});ye(()=>i.show,h=>{h||(a.value=null)});function d(){!m.value||!a.value||a.value.submit()}function x(h){l("confirm",h)}function V(){l("cancel")}function A(h){h||V()}return(h,g)=>(p(),K(t(Tt),{open:s.show,"onUpdate:open":A},{default:o(()=>[n(t(Ut),null,{default:o(()=>[n(t(qt),{class:"fixed inset-0 z-50 bg-black/50"}),n(t(Dt),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:o(()=>[n(t(At),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:o(()=>[n(t(Ot),null,{default:o(()=>[...g[0]||(g[0]=[D("Create offer",-1)])]),_:1}),g[1]||(g[1]=e("p",{class:"text-sm text-muted-foreground mt-1"}," Add a new offer to this opportunity. Select a vehicle and fill in the details. ",-1))]),_:1}),e("div",z1,[s.opportunity?(p(),K(ss,{key:0,ref_key:"offerWidgetRef",ref:a,"task-id":s.opportunity.id,"task-type":"opportunity",customer:s.opportunity.customer,"selected-vehicle":s.opportunity.selectedVehicle||s.opportunity.vehicle||s.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:x,onCancel:V},null,8,["task-id","customer","selected-vehicle"])):q("",!0)]),n(t(Lt),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 p-6 pt-4 border-t border"},{default:o(()=>[n(t(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:V}),n(t(_),{label:"Create offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!m.value,onClick:d},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Y1={class:"px-4 pt-4"},H1={key:1,class:"mt-4"},Q1={key:0,class:"mb-4"},G1={key:1,class:"space-y-4"},_1={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},J1={class:"flex items-start gap-3"},K1={class:"flex-1"},Z1={class:"text-sm text-muted-foreground whitespace-pre-wrap"},X1={class:"rounded-lg flex flex-col bg-muted"},eb={class:"pt-1 px-1"},tb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden"},nb={class:"p-6"},sb={class:"px-4 py-4"},ab={key:2,class:"rounded-lg flex flex-col bg-muted"},lb={class:"pt-1 px-1"},ob={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},ib={class:"p-6"},rb={class:"mb-3"},ub={class:"font-bold text-foreground text-sm"},db={class:"text-sm text-muted-foreground mt-0.5"},cb={class:"flex flex-wrap gap-3 items-center"},mb={class:"outcome-toggle-group flex flex-wrap gap-3"},fb={class:"px-4 py-4 space-y-4"},pb={key:0},vb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},gb={class:"space-y-4"},yb={class:"flex justify-end gap-2 mt-4"},bb={key:1},hb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},xb={class:"text-sm text-muted-foreground mb-4"},wb={class:"space-y-4"},kb={class:"flex justify-end gap-2 mt-4"},Sb={key:2},Cb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},$b={class:"text-sm text-muted-foreground mb-4"},Db={class:"space-y-4"},Ab={class:"flex justify-end gap-2 mt-4"},Ob={key:3,class:"px-4 py-4"},Tb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Ib={class:"space-y-4"},Vb={class:"space-y-3"},Nb={class:"flex items-center gap-3"},Fb={class:"flex items-center gap-3"},Ub={class:"flex items-center gap-3"},qb={class:"flex items-center gap-3"},Lb={class:"flex items-center gap-3"},Pb={class:"flex justify-end gap-2 mt-4"},Mb={key:3,class:"rounded-lg flex flex-col bg-muted"},Eb={class:"pt-1 px-1"},Rb={class:"bg-white rounded-lg shadow-nsc-card overflow-visible"},jb={class:"p-6"},Bb={class:"mb-3"},zb={class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},Wb={class:"flex items-start gap-2"},Yb={class:"flex-1"},Hb={class:"text-sm text-red-700 mt-1"},Qb={key:0,class:"text-sm text-red-600 mt-2"},Gb={class:"flex flex-wrap gap-3 items-center"},_b={class:"outcome-toggle-group flex flex-wrap gap-3"},Jb={class:"px-4 py-4 space-y-4"},Kb={key:0},Zb={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},Xb={class:"flex justify-end gap-2 pt-3"},eh={key:4,class:"space-y-4"},th={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden p-6"},nh={class:"flex justify-end gap-2"},sh={key:6,class:"space-y-3"},ah={class:"flex justify-end gap-2 mt-4"},lh={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled","appointment-cancelled","appointment-no-show"],setup(s,{expose:$,emit:i}){const l=s,a=i,m=Ha(),d=Xt();gn();const x=Yt(),{t:V}=ts(),A=()=>{var u;const c=d.currentOpportunity;return c&&c.id===((u=l.opportunity)==null?void 0:u.id)?c:l.opportunity},h=C(()=>A()),g=C(()=>{var c;return l.scheduledAppointment||((c=l.opportunity)==null?void 0:c.scheduledAppointment)||null}),v=C(()=>{if(g.value&&g.value.start)return!1;const c=Le.displayStage.value,u=c===gs.QUALIFIED,I=c===gs.AWAITING_APPOINTMENT;return(u||I)&&!Le.isClosed.value});C(()=>!g.value||!g.value.start?!1:new Date(g.value.start)<new Date&&g.value.status!=="completed");const b=C(()=>{if(!g.value||!g.value.start)return!1;const c=new Date(g.value.start),u=new Date;return c.getFullYear()===u.getFullYear()&&c.getMonth()===u.getMonth()&&c.getDate()===u.getDate()}),k=C(()=>l.opportunity.customer?typeof l.opportunity.customer=="string"?l.opportunity.customer:l.opportunity.customer.name:"Customer"),y=C(()=>{const c=l.opportunity.customerId||(l.opportunity.customer&&typeof l.opportunity.customer=="object"?l.opportunity.customer.id:null);return c?m.resolve(`/customer/${c}`).href:"#"}),w=c=>{c.preventDefault();const u=l.opportunity.customerId||(l.opportunity.customer&&typeof l.opportunity.customer=="object"?l.opportunity.customer.id:null);u&&window.open(m.resolve(`/customer/${u}`).href,"_blank")},r=C(()=>{const c=l.opportunity,u=Le.displayStage.value;return c.stage==="Closed Won"||u==="Closed Won"}),O=C(()=>{const c=l.opportunity;return Array.isArray(c.contracts)&&c.contracts.length>0?c.contracts:c.contractDate?[{id:c.id||`contract-${c.contractDate}`,contractDate:c.contractDate,contractNotes:c.contractNotes,contractSigned:c.contractSigned,esignatureCollectedDate:c.esignatureCollectedDate,version:c.contractVersion||1,status:c.contractSigned||c.esignatureCollectedDate?"signed":"active"}]:[]}),N=C(()=>{const c=l.opportunity,u=Le.displayStage.value;return c.stage==="Closed Lost"||u==="Closed Lost"}),U=C(()=>N.value||!r.value?!1:l.opportunity.deliverySubstatus!=="Delivered"),M=C(()=>!!l.opportunity.deliveryDate),le=C(()=>l.opportunity.deliverySubstatus==="Delivered"),R=C(()=>M.value?"Confirm Delivery":"Schedule Delivery"),E=C(()=>M.value?"Delivery scheduled. Confirm that the delivery has been completed":"Contract signed! Schedule vehicle delivery with the customer"),G=ll(),{isCallActive:z,callEnded:Q,callDuration:de,callNotes:J,mockTranscription:W,formattedCallDuration:j,startCall:ee,endCall:me,copyNumber:fe}=G,$e=()=>{ee()},Re=()=>{me()},Pe=()=>{var c;fe(((c=l.opportunity.customer)==null?void 0:c.phone)||"")},gt=c=>{J.value=c},ht=()=>{G.callData.value={channel:"external",notes:"",transcription:null}},ct=T(null),Z=C(()=>{var c;return(c=ct.value)==null?void 0:c.scheduleFormRef}),ue=()=>{Y.value=!1},nt=()=>{var c;(c=Z.value)==null||c.resetForm()};async function at(c,u){var Qn,Gn,Vn,_n,Jn;const{eventType:I,selectedDate:ne,selectedSlot:ce,selectedTeam:oe,selectedSalesman:Ce,durationValue:tt,communicationPreferences:Je}=c,ze=l.opportunity,Qe=ne,[Es,In]=ce.split(":").map(Number),Jt=new Date(Qe);Jt.setHours(Es,In,0,0);const hn=tt||30,zn=new Date(Jt.getTime()+hn*6e4),Wn=(Ce==null?void 0:Ce.name)||(oe==null?void 0:oe.name)||ze.assignee||"Unassigned",Yn=(Ce==null?void 0:Ce.id)||(oe==null?void 0:oe.id)||null,Hn=Ce?"user":"team";try{if(u==="reschedule"){const fs={title:`Appointment - ${((Qn=ze.customer)==null?void 0:Qn.name)||"Customer"}`,start:Jt.toISOString(),end:zn.toISOString(),type:I,assignee:Wn,customerId:ze.customerId,opportunityId:ze.id,duration:hn,status:"pending_confirmation"};let ps={...fs};if((Gn=g.value)!=null&&Gn.id){const{updateCalendarEvent:js}=await xn(async()=>{const{updateCalendarEvent:ro}=await import("./users-D37oaAzL.js").then(uo=>uo.i);return{updateCalendarEvent:ro}},__vite__mapDeps([3,1,2]));await js(g.value.id,{...fs,status:"pending_confirmation"}),ps.id=g.value.id}else{const js=await Bs({...fs,status:"pending_confirmation"});ps={...fs,id:js.id,status:"pending_confirmation"}}await d.updateOpportunity(ze.id,{scheduledAppointment:ps}),a("appointment-scheduled",ps),Y.value=!1;return}const Rs={customerId:ze.customerId||((Vn=ze.customer)==null?void 0:Vn.id),customer:((_n=ze.customer)==null?void 0:_n.name)||"Unknown",start:Jt.toISOString(),end:zn.toISOString(),type:I,title:`${I} - ${((Jn=ze.customer)==null?void 0:Jn.name)||"Customer"}`,assigneeId:Yn,assigneeType:Hn,teamId:(oe==null?void 0:oe.id)||null,team:(oe==null?void 0:oe.name)||null,salesperson:(Ce==null?void 0:Ce.name)||null,salespersonId:(Ce==null?void 0:Ce.id)||null,duration:hn,opportunityId:ze.id},ka=await Bs(Rs),Sa={id:ka.id,start:Jt.toISOString(),end:zn.toISOString(),type:I,assignee:Wn,assigneeId:Yn,assigneeType:Hn,duration:hn,team:(oe==null?void 0:oe.name)||null,teamId:(oe==null?void 0:oe.id)||null,salesperson:(Ce==null?void 0:Ce.name)||null,salespersonId:(Ce==null?void 0:Ce.id)||null,communications:Je,status:"confirmed"};await d.updateOpportunity(ze.id,{scheduledAppointment:Sa}),a("appointment-scheduled",{...Sa,calendarEventId:ka.id}),nt()}catch(Rs){console.error("Failed to schedule/reschedule appointment:",Rs)}}async function mt(){if(g.value)try{const c={...g.value,status:"confirmed"};if(g.value.id){const{updateCalendarEvent:u}=await xn(async()=>{const{updateCalendarEvent:I}=await import("./users-D37oaAzL.js").then(ne=>ne.i);return{updateCalendarEvent:I}},__vite__mapDeps([3,1,2]));await u(g.value.id,{status:"confirmed"})}await d.updateOpportunity(l.opportunity.id,{scheduledAppointment:c}),a("appointment-scheduled",c)}catch(c){console.error("Failed to confirm appointment:",c)}}const H=T(!1),Y=T(!1),te=T(!1),X=T(!1),ie=T(null),ve=T(null),ge=C(()=>{var c;return(c=ct.value)==null?void 0:c.ns1TaskRef}),Te=C(()=>{var c;return(c=ct.value)==null?void 0:c.ns2TaskRef}),We=C(()=>{var c;return(c=ct.value)==null?void 0:c.ns3TaskRef}),_e=C(()=>{var c;return(c=ct.value)==null?void 0:c.offerAssignmentTaskRef}),Se=C(()=>{var c;return(c=ie.value)==null?void 0:c.addOfferWidgetRef}),He=T(!1),Ke=T(!1),Ye=T(!1),lt=T(!1),st=T(null),pe=T(""),re=T(null),xe=T(!1),we=T(!1),De=T(!1),Me=T(!1),dt=T(!1),Fe=T({deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}),Ae=T({actualDeliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}),Ve=T({deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}),je=T({vehicleInspected:!1,documentsProvided:!1,paymentReceived:!1,warrantyExplained:!1,keysHandedOver:!1}),Pt=T(""),Ht=T(!1),yt=T(!1),{reason:Qt,notes:et,cardRef:yn,reset:Ze}=cl(),ot=T(!1),en=T(!1),tn=T(!1),Ge=T(!1),Be=T(!1),it=T(!1),rt=T({deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}),nn=C(()=>{var c;return(c=ve.value)==null?void 0:c.addOfferContractPendingRef});C(()=>{var c;return(c=ve.value)==null?void 0:c.scheduleAppointmentContractPendingFormRef});const qn=C(()=>{const c=[];return An.value||c.push({key:"add-offer",label:"Add offer",handler:()=>Ml()}),c.push({key:"close-as-lost",label:"Close as Lost",handler:()=>{Ge.value=!1,Be.value=!1,it.value=!1,yt.value=!0,Ze()}},{key:"schedule-appointment",label:"Schedule appointment",handler:()=>Bl()}),c});C(()=>(Le.secondaryActions.value||[]).map(c=>({key:c.key,label:c.label,disabled:!!c.disabled,onClick:()=>{ot.value=!1,en.value=!1,Bn(c)}}))),C(()=>(qn.value||[]).map(c=>({key:c.key,label:c.label,disabled:!!c.disabled,onClick:()=>{tn.value=!1,c.handler&&c.handler()}})));function as(c){}const bt=C(()=>{var u;const c=((u=g.value)==null?void 0:u.noShowCount)||0;return c===0&&te.value?1:c}),ft=C(()=>{var I;const u={1:ge,2:Te,3:We}[bt.value];return((I=u==null?void 0:u.value)==null?void 0:I.canSubmit)||!1}),Mt=C(()=>bt.value===3?"Close as Lost":"Assign and Save"),Ee=C(()=>{var c;return((c=_e==null?void 0:_e.value)==null?void 0:c.canSubmit)||!1}),It=C(()=>{const c=h.value;return!(c!=null&&c.offers)||c.offers.length===0?[]:c.offers.filter(u=>u.status==="active").map(u=>({id:u.id,label:`${u.vehicleBrand} ${u.vehicleModel} (${u.vehicleYear})`,price:u.price,value:u.id}))}),Ln=C(()=>st.value&&pe.value.trim().length>0),sn=T(!1),an=T(!1),ln=T(!1),bn=T(!1),jt=T(!1),Et=T(!1),Bt=T(!1),Pn=T([]),Rt=T(!1),on=T(!1),Gt=T(!1),Vt=T(!1),rn=T(!1),un=T(!1),$n=T(null),Dn=T(!1),Mn=T(null),pt=T(null),xt=T(null),En=T(null),Rn=T(!1),dn=T(null),ls=T(null),os=T(""),is=T("Contract/Offer Document");function Cs(){Dn.value=!0}$({openPostponeExpectedCloseModal:Cs});const rs={"schedule-appointment":()=>{H.value=!0},"manage-appointment":()=>{g.value&&(Et.value=!0)},"view-or-schedule-appointment":()=>{g.value?Et.value=!0:H.value=!0},reschedule:()=>{g.value&&(Bt.value=!0)},"cancel-appointment":()=>{P()},"mark-no-show":()=>{va()},"select-vehicle":()=>{bn.value=!0},"create-offer":()=>{!l.opportunity.selectedVehicle&&!l.opportunity.vehicle&&!l.opportunity.requestedCar?bn.value=!0:cn.value?(Ke.value=!0,He.value=!1,Ye.value=!1):lt.value=!0},"call-prospect":()=>{jt.value=!0},"follow-up-offer":()=>{jt.value=!0},"request-decision":()=>{jt.value=!0},"finalize-contract":()=>{sn.value=!0},"schedule-delivery":()=>{U.value&&(xe.value=!0,we.value=!1,Kn(Fe,"deliveryDate"))},"confirm-delivery":()=>{U.value&&(we.value=!0,xe.value=!1,Kn(Ae,"actualDeliveryDate"))},"collect-feedback":()=>{jt.value=!0},reschedule:()=>{Bt.value=!0},"cancel-appointment":()=>{P()},"close-won":()=>{sn.value=!0},"add-offer":()=>{cn.value?(Ke.value=!0,He.value=!1):lt.value=!0},"add-contract":()=>{sn.value=!0},"create-contract":()=>{da()},"extend-deadline":()=>{jt.value=!0},"close-lost":()=>{yt.value=!0,Ze()},reopen:()=>{Ls()},requalify:()=>{ln.value=!0},"reschedule-delivery":()=>{if(r.value&&M.value&&(De.value=!0,xe.value=!1,we.value=!1,l.opportunity.deliveryDate)){const c=new Date(l.opportunity.deliveryDate);Ve.value.deliveryDate=c.toISOString().split("T")[0],Ve.value.deliveryTime=c.toTimeString().slice(0,5),Ve.value.deliveryLocation=l.opportunity.deliveryLocation||"",Ve.value.notes=l.opportunity.deliveryNotes||""}},"complete-checklist":()=>{r.value&&le.value&&(Me.value=!0)},archive:()=>{r.value&&le.value&&(dt.value=!0)}},Nt=Dp(es(l,"opportunity"),g,es(l,"activities"),rs,Fn),Le={isClosed:Nt.isClosed,primaryAction:C(()=>v.value||g.value&&g.value.start&&(Le.displayStage.value===gs.APPOINTMENT_SCHEDULED||Le.displayStage.value===gs.AWAITING_APPOINTMENT)||Nt.isClosed.value?null:Nt.primaryAction.value),secondaryActions:C(()=>{const u=(Nt.secondaryActions.value||[]).filter(ne=>!(ne.key==="close-lost"&&N.value));return!u.some(ne=>ne.key==="close-lost")&&!N.value?[...u,{key:"close-lost",label:"Close as Lost",handler:()=>{yt.value=!0,Ze()}}]:u}),activeTaskWidget:C(()=>{if(v.value)return null;const c=Nt.activeTaskWidget.value;return c&&c.type==="NS"?null:c}),taskWidgetTitle:Nt.taskWidgetTitle,displayStage:C(()=>fn(l.opportunity,"opportunity")),showDeadlineBanner:C(()=>{var c;return!Nt.isClosed.value&&!!((c=l.opportunity)!=null&&c.nextActionDue)})},cn=C(()=>{const c=l.opportunity;return!(!c||Nt.isClosed.value||c.stage!=="In Negotiation"||Le.displayStage.value==="In Negotiation - Contract Pending")}),jn=C(()=>Le.displayStage.value==="In Negotiation - Contract Pending"),An=C(()=>{var c;return((c=l.opportunity)==null?void 0:c.offers)&&Array.isArray(l.opportunity.offers)&&l.opportunity.offers.length>0}),mn=C(()=>{const c=Le.secondaryActions.value||[];return An.value?c.filter(u=>u.key!=="add-offer"&&u.key!=="create-offer"):c}),$s=async c=>{var u;(u=l.opportunity)!=null&&u.id&&await d.fetchOpportunityById(l.opportunity.id)};function us(){}function Ds(c){}async function As(c){var u;try{const{opportunity:I,surveyData:ne}=c,{responses:ce}=ne;await d.addActivity(I.id,{type:"offer-feedback-survey",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"completed offer feedback survey",content:"Offer Feedback Survey completed",data:{responses:ce,timestamp:ne.timestamp},timestamp:ne.timestamp}),Ye.value=!1}catch(I){console.error("Failed to submit survey:",I)}}function Os(c){Ye.value=!1}async function ds(c){$n.value=c.toLowerCase(),un.value=!0}async function Ts(c){var u;try{const I=A(),ne=I.postponedTasks||{};ne[c.taskType]=c.dateTime,await d.updateOpportunity(I.id,{postponedTasks:ne}),await d.addActivity(I.id,{type:"task-postponed",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"postponed task",content:`Task ${c.taskType.toUpperCase()} postponed to ${new Date(c.dateTime).toLocaleString()}${c.reason?`: ${c.reason}`:""}`,data:{taskType:c.taskType,dateTime:c.dateTime,reason:c.reason},timestamp:new Date().toISOString()}),un.value=!1,$n.value=null}catch(I){console.error("Failed to postpone task:",I)}}function cs(){un.value=!1,$n.value=null}async function Is(c){var u;try{const I=A();await d.updateOpportunity(I.id,{expectedCloseDate:c.expectedCloseDate}),await d.addActivity(I.id,{type:"expected-close-date-extension",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"extended expected close date",content:`Expected close date extended to ${new Date(c.expectedCloseDate).toLocaleDateString()}${c.reason?`: ${c.reason}`:""}`,data:{expectedCloseDate:c.expectedCloseDate,reason:c.reason},timestamp:new Date().toISOString()}),Dn.value=!1}catch(I){console.error("Failed to extend expected close date:",I)}}function Vs(){Dn.value=!1}function Ns(c){bn.value=!1,a("vehicle-selected",c),setTimeout(()=>{cn.value?(Ke.value=!0,He.value=!1):lt.value=!0},300)}const On=T(null),Fs=C(()=>{var c;return((c=On.value)==null?void 0:c.isValid)||!1});function ms(){lt.value=!1}function L(){On.value&&On.value.submit()}async function f(c){var u,I,ne,ce,oe,Ce,tt,Je,ze;try{const Qe=h.value;await d.addOffer(Qe.id,{vehicleBrand:((u=c.data)==null?void 0:u.brand)||"",vehicleModel:((I=c.data)==null?void 0:I.model)||"",vehicleYear:((ne=c.data)==null?void 0:ne.year)||"",price:((ce=c.data)==null?void 0:ce.price)||0,data:c.data}),await d.addActivity(Qe.id,{type:"offer",user:((oe=x.currentUser)==null?void 0:oe.name)||"You",action:"created an offer",content:`Offer created: ${(Ce=c.data)==null?void 0:Ce.brand} ${(tt=c.data)==null?void 0:tt.model} (${(Je=c.data)==null?void 0:Je.year}) - € ${(((ze=c.data)==null?void 0:ze.price)||0).toLocaleString()}`,data:c.data,timestamp:new Date().toISOString()}),lt.value=!1,a("offer-created",c)}catch(Qe){console.error("Failed to create offer:",Qe)}}function ae(c){H.value=!1,a("appointment-scheduled",{...c,opportunityId:l.opportunity.id,customer:l.opportunity.customer.name})}async function P(){if(g.value&&confirm("Are you sure you want to cancel this appointment?"))try{if(g.value.id){const{deleteCalendarEvent:c}=await xn(async()=>{const{deleteCalendarEvent:u}=await import("./users-D37oaAzL.js").then(I=>I.i);return{deleteCalendarEvent:u}},__vite__mapDeps([3,1,2]));await c(g.value.id)}await d.updateOpportunity(l.opportunity.id,{scheduledAppointment:null}),a("appointment-cancelled",g.value.id)}catch(c){console.error("Failed to cancel appointment:",c)}}function Ie(c){sn.value=!1,d.updateOpportunity(l.opportunity.id,{stage:"Closed Won",contractDate:c.contractDate})}async function Ne(c){var u;an.value=!1;try{const I=A();await d.updateOpportunity(I.id,{deliveryDate:c.deliveryDate,deliverySubstatus:"Delivered",actualDeliveryDate:c.deliveryDate,deliveryLocation:c.location,deliveryNotes:c.notes}),await d.addActivity(I.id,{type:"delivery",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"marked as delivered",content:`Delivery confirmed on ${new Date(c.deliveryDate).toLocaleString()} at ${c.location||"N/A"}`,data:c,timestamp:new Date().toISOString()})}catch(I){console.error("Failed to mark as delivered:",I)}}function _t(){xe.value=!1,Fe.value={deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}}async function Us(){var c;if(oa.value)try{const u=A(),I=Fe.value.deliveryTime?`${Fe.value.deliveryDate}T${Fe.value.deliveryTime}:00`:`${Fe.value.deliveryDate}T12:00:00`,ne=fn(u,"opportunity")==="In Negotiation - Contract Pending",ce={deliveryDate:I,deliveryLocation:Fe.value.deliveryLocation,deliveryNotes:Fe.value.notes};ne&&!u.deliveryDateSetDate&&(ce.deliveryDateSetDate=new Date().toISOString()),u.stage==="Closed Won"&&(ce.deliverySubstatus="Awaiting Delivery"),await d.updateOpportunity(u.id,ce),await d.addActivity(u.id,{type:"delivery-scheduled",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:ne?"set delivery date (step 1 of 2)":"scheduled delivery",content:`Delivery scheduled for ${new Date(I).toLocaleString()} at ${Fe.value.deliveryLocation}`,data:{deliveryDate:I,location:Fe.value.deliveryLocation,notes:Fe.value.notes,step:ne?1:null,totalSteps:ne?2:null},timestamp:new Date().toISOString()}),_t()}catch(u){console.error("Failed to schedule delivery:",u)}}function Xs(){we.value=!1,Ae.value={actualDeliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}}function ea(){De.value=!1,Ve.value={deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}}async function ml(){var c;if(ra.value)try{const u=A(),I=Ve.value.deliveryTime?`${Ve.value.deliveryDate}T${Ve.value.deliveryTime}:00`:`${Ve.value.deliveryDate}T12:00:00`;await d.updateOpportunity(u.id,{deliveryDate:I,deliveryLocation:Ve.value.deliveryLocation,deliveryNotes:Ve.value.notes}),await d.addActivity(u.id,{type:"delivery",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:"rescheduled delivery",content:`Delivery rescheduled to ${new Date(I).toLocaleString()} at ${Ve.value.deliveryLocation}. Previous date: ${Fn(u.deliveryDate)}`,data:{newDeliveryDate:I,previousDeliveryDate:u.deliveryDate,location:Ve.value.deliveryLocation,notes:Ve.value.notes},timestamp:new Date().toISOString()}),ea()}catch(u){console.error("Failed to reschedule delivery:",u)}}function ta(){Me.value=!1,je.value={vehicleInspected:!1,documentsProvided:!1,paymentReceived:!1,warrantyExplained:!1,keysHandedOver:!1},Pt.value=""}async function fl(){var c;if(ua.value)try{const u=A();await d.addActivity(u.id,{type:"delivery",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:"completed delivery checklist",content:`Delivery checklist completed. Items checked: ${Object.values(je.value).filter(I=>I).length}/5${Pt.value?`. Notes: ${Pt.value}`:""}`,data:{checklistItems:je.value,notes:Pt.value,completedAt:new Date().toISOString()},timestamp:new Date().toISOString()}),ta()}catch(u){console.error("Failed to complete checklist:",u)}}async function pl(){var c;try{const u=A();await d.addActivity(u.id,{type:"note",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:"archived opportunity",content:"Opportunity archived after successful delivery completion",timestamp:new Date().toISOString()}),dt.value=!1}catch(u){console.error("Failed to archive opportunity:",u)}}async function vl(){var c;if(ia.value)try{const u=A(),I=Ae.value.deliveryTime?`${Ae.value.actualDeliveryDate}T${Ae.value.deliveryTime}:00`:`${Ae.value.actualDeliveryDate}T12:00:00`;await d.updateOpportunity(u.id,{deliveryDate:I,deliverySubstatus:"Delivered",actualDeliveryDate:I,deliveryLocation:Ae.value.deliveryLocation,deliveryNotes:Ae.value.notes}),await d.addActivity(u.id,{type:"delivery",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:"confirmed delivery",content:`Delivery confirmed on ${new Date(I).toLocaleString()} at ${Ae.value.deliveryLocation}`,data:{actualDeliveryDate:I,scheduledDeliveryDate:u.deliveryDate,location:Ae.value.deliveryLocation,notes:Ae.value.notes},timestamp:new Date().toISOString()}),Xs()}catch(u){console.error("Failed to confirm delivery:",u)}}function na(c){const u=typeof c=="string"?c:c.reason||c,I=typeof c=="object"?c.notes:"";d.updateOpportunity(l.opportunity.id,{stage:"Closed Lost",lossReason:u,lossNotes:I})}function qs(){yt.value=!1,Ze()}async function sa(c){var u;try{await na({reason:c.reason,notes:c.notes}),await d.addActivity(l.opportunity.id,{type:"close-lost",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${c.reason}${c.notes?`. Notes: ${c.notes}`:""}`,data:{reason:c.reason,notes:c.notes},timestamp:new Date().toISOString()}),qs()}catch(I){console.error("Failed to close opportunity as lost:",I)}}async function gl(c){var u;try{await na({reason:c.reason,notes:c.notes}),await d.addActivity(l.opportunity.id,{type:"close-lost",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${c.reason}${c.notes?`. Notes: ${c.notes}`:""}`,data:{reason:c.reason,notes:c.notes},timestamp:new Date().toISOString()})}catch(I){console.error("Failed to close opportunity as lost:",I)}}async function Ls(){const c=A(),u=c.stage==="Closed Won",I=c.offers&&c.offers.length>0;Ht.value=!1;let ne="Qualified",ce=null;I&&(ne="In Negotiation",c.offers.filter(oe=>oe.status==="active").sort((oe,Ce)=>new Date(Ce.createdAt)-new Date(oe.createdAt))[0],ce="Offer Sent"),u?(await d.updateOpportunity(c.id,{stage:ne,negotiationSubstatus:ce,skipTaskReTrigger:!0}),setTimeout(async()=>{await d.updateOpportunity(c.id,{skipTaskReTrigger:!1})},2e3)):await d.updateOpportunity(c.id,{stage:ne,negotiationSubstatus:ce})}function yl(c){ln.value=!1,m.push(`/customer/${c.id}?type=lead`)}function bl(c){Et.value=!1}function hl(c){Bt.value=!1}function xl({opportunity:c,assignee:u,note:I}){}function wl(){var I;const u={1:ge,2:Te,3:We}[bt.value];(I=u==null?void 0:u.value)==null||I.submit()}function kl(){te.value=!1}async function Sl({opportunity:c,offerData:u}){var I,ne,ce,oe,Ce;try{if((I=g.value)!=null&&I.id){const{updateCalendarEvent:Je}=await xn(async()=>{const{updateCalendarEvent:ze}=await import("./users-D37oaAzL.js").then(Qe=>Qe.i);return{updateCalendarEvent:ze}},__vite__mapDeps([3,1,2]));await Je(g.value.id,{status:"completed"})}const tt=c.value;await d.addOffer(tt.id,{vehicleBrand:((ne=u.data)==null?void 0:ne.brand)||"",vehicleModel:((ce=u.data)==null?void 0:ce.model)||"",vehicleYear:((oe=u.data)==null?void 0:oe.year)||"",price:((Ce=u.data)==null?void 0:Ce.price)||0,data:u.data}),X.value=!1}catch(tt){console.error("Failed to create offer:",tt)}}function Cl(){var c;(c=_e==null?void 0:_e.value)==null||c.submit()}function $l(){X.value=!1}const aa=T(null),Tn=T(null);async function Dl(c){var I;const u=A();try{await d.activateOffer(u.id,c.id),await d.addActivity(u.id,{type:"offer-activation",user:((I=x.currentUser)==null?void 0:I.name)||"You",action:"activated offer",content:`Offer activated: ${c.vehicleBrand} ${c.vehicleModel} (${c.vehicleYear})`,data:{offerId:c.id},timestamp:new Date().toISOString()})}catch(ne){console.error("Failed to activate offer:",ne),alert("Failed to activate offer. Please try again.")}finally{u.offers&&u.offers.forEach(ne=>{var ce;(ce=aa.value)==null||ce.setOfferLoading(ne.id,!1)})}}async function Al(){var c,u;if(Ln.value)try{const I=h.value,ne=(c=I==null?void 0:I.offers)==null?void 0:c.find(oe=>oe.id===re.value),ce=ne?`${ne.vehicleBrand} ${ne.vehicleModel} (€${ne.price.toLocaleString()})`:"offer";await d.addActivity(I.id,{type:st.value,user:((u=x.currentUser)==null?void 0:u.name)||"You",action:`sent ${st.value}`,content:pe.value,data:{channel:st.value,offerId:re.value,offerReference:ce},timestamp:new Date().toISOString()}),He.value=!1,st.value=null,pe.value="",re.value=null}catch(I){console.error("Failed to send negotiation message:",I)}}function Ol(){He.value=!1,st.value=null,pe.value="",re.value=null}const Tl=C(()=>{var c;return((c=Se==null?void 0:Se.value)==null?void 0:c.isValid)||!1});async function Il(c){var u,I,ne,ce,oe,Ce,tt,Je,ze;try{const Qe=h.value;await d.addOffer(Qe.id,{vehicleBrand:((u=c.data)==null?void 0:u.brand)||"",vehicleModel:((I=c.data)==null?void 0:I.model)||"",vehicleYear:((ne=c.data)==null?void 0:ne.year)||"",price:((ce=c.data)==null?void 0:ce.price)||0,data:c.data}),await d.addActivity(Qe.id,{type:"offer",user:((oe=x.currentUser)==null?void 0:oe.name)||"You",action:"created an offer",content:`Offer created: ${(Ce=c.data)==null?void 0:Ce.brand} ${(tt=c.data)==null?void 0:tt.model} (${(Je=c.data)==null?void 0:Je.year}) - € ${(((ze=c.data)==null?void 0:ze.price)||0).toLocaleString()}`,data:c.data,timestamp:new Date().toISOString()}),Ke.value=!1}catch(Qe){console.error("Failed to create offer:",Qe)}}function Vl(){Se!=null&&Se.value&&Se.value.submit()}function Nl(){Ke.value=!1,Se.value}const Ps=C(()=>zs()),la=C(()=>!!rt.value.deliveryDate&&!!rt.value.deliveryLocation),Fl=C(()=>{var c;return((c=nn.value)==null?void 0:c.isValid)||!1}),Ms=C(()=>zs()),Ul=C(()=>zs()),oa=C(()=>!!Fe.value.deliveryDate&&!!Fe.value.deliveryLocation),ia=C(()=>!!Ae.value.actualDeliveryDate&&!!Ae.value.deliveryLocation),ra=C(()=>!!Ve.value.deliveryDate&&!!Ve.value.deliveryLocation),ua=C(()=>Object.values(je.value).some(c=>c===!0));function da(){on.value=!0}function ca(){on.value=!1}function ql(){Gt.value=!0}function ma(){Gt.value=!1}async function Ll(c){var u,I,ne,ce,oe,Ce,tt,Je,ze;if(c!=null&&c.data)try{const Qe=h.value;await d.addOffer(Qe.id,{vehicleBrand:((u=c.data)==null?void 0:u.brand)||"",vehicleModel:((I=c.data)==null?void 0:I.model)||"",vehicleYear:((ne=c.data)==null?void 0:ne.year)||"",price:((ce=c.data)==null?void 0:ce.price)||0,data:c.data}),await d.addActivity(Qe.id,{type:"offer",user:((oe=x.currentUser)==null?void 0:oe.name)||"You",action:"created an offer",content:`Offer created: ${(Ce=c.data)==null?void 0:Ce.brand} ${(tt=c.data)==null?void 0:tt.model} (${(Je=c.data)==null?void 0:Je.year}) - € ${(((ze=c.data)==null?void 0:ze.price)||0).toLocaleString()}`,data:c.data,timestamp:new Date().toISOString()}),ma()}catch(Qe){console.error("Failed to create offer:",Qe)}}async function Pl(c){var u;if(c!=null&&c.contractDate)try{const I=A();await d.addContract(I.id,{contractDate:c.contractDate,contractTime:c.contractTime,notes:c.notes});const ne=c.contractTime?`${c.contractDate}T${c.contractTime}:00`:`${c.contractDate}T12:00:00`;await d.addActivity(I.id,{type:"contract",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"created a contract",content:`Contract created: ${new Date(ne).toLocaleString()}`,data:{contractDate:ne,notes:c.notes},timestamp:new Date().toISOString()}),ca()}catch(I){console.error("Failed to create contract:",I)}}function Ml(){yt.value=!1,Be.value=!1,it.value=!1,Ge.value=!Ge.value}function El(){Ge.value=!1}function Rl(){nn!=null&&nn.value&&nn.value.submit()}async function jl(c){var u,I,ne,ce,oe,Ce,tt,Je,ze;try{const Qe=A();await d.addOffer(Qe.id,{vehicleBrand:((u=c.data)==null?void 0:u.brand)||"",vehicleModel:((I=c.data)==null?void 0:I.model)||"",vehicleYear:((ne=c.data)==null?void 0:ne.year)||"",price:((ce=c.data)==null?void 0:ce.price)||0,data:c.data}),await d.addActivity(Qe.id,{type:"offer",user:((oe=x.currentUser)==null?void 0:oe.name)||"You",action:"created an offer",content:`Offer created: ${(Ce=c.data)==null?void 0:Ce.brand} ${(tt=c.data)==null?void 0:tt.model} (${(Je=c.data)==null?void 0:Je.year}) - € ${(((ze=c.data)==null?void 0:ze.price)||0).toLocaleString()}`,data:c.data,timestamp:new Date().toISOString()}),Ge.value=!1}catch(Qe){console.error("Failed to create offer:",Qe)}}function Bl(){Ge.value=!1,yt.value=!1,it.value=!1,Be.value=!Be.value}function fa(){it.value=!1,rt.value={deliveryDate:"",deliveryTime:"",deliveryLocation:"",notes:""}}async function zl(){var c;if(la.value)try{const u=A(),I=rt.value.deliveryTime?`${rt.value.deliveryDate}T${rt.value.deliveryTime}:00`:`${rt.value.deliveryDate}T12:00:00`,ne={deliveryDate:I,deliveryLocation:rt.value.deliveryLocation,deliveryNotes:rt.value.notes};u.deliveryDateSetDate||(ne.deliveryDateSetDate=new Date().toISOString()),await d.updateOpportunity(u.id,ne),await d.addActivity(u.id,{type:"delivery-scheduled",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:"set delivery date (step 1 of 2)",content:`Delivery scheduled for ${new Date(I).toLocaleString()} at ${rt.value.deliveryLocation}`,data:{deliveryDate:I,location:rt.value.deliveryLocation,notes:rt.value.notes,step:1,totalSteps:2},timestamp:new Date().toISOString()}),fa()}catch(u){console.error("Failed to set delivery date:",u)}}function pa(){Be.value=!1}async function Wl(c){var Hn,Qn,Gn;const{eventType:u,selectedDate:I,selectedSlot:ne,selectedTeam:ce,selectedSalesman:oe,durationValue:Ce,communicationPreferences:tt}=c,Je=A(),ze=I,[Qe,Es]=ne.split(":").map(Number),In=new Date(ze);In.setHours(Qe,Es,0,0);const Jt=Ce||30,hn=new Date(In.getTime()+Jt*6e4),zn=(oe==null?void 0:oe.name)||(ce==null?void 0:ce.name)||Je.assignee||"Unassigned",Wn=(oe==null?void 0:oe.id)||(ce==null?void 0:ce.id)||null,Yn=oe?"user":"team";try{const Vn={customerId:Je.customerId||((Hn=Je.customer)==null?void 0:Hn.id),customer:((Qn=Je.customer)==null?void 0:Qn.name)||"Unknown",start:In.toISOString(),end:hn.toISOString(),type:u,title:`${u} - ${((Gn=Je.customer)==null?void 0:Gn.name)||"Customer"}`,assigneeId:Wn,assigneeType:Yn,teamId:(ce==null?void 0:ce.id)||null,team:(ce==null?void 0:ce.name)||null,salesperson:(oe==null?void 0:oe.name)||null,salespersonId:(oe==null?void 0:oe.id)||null,duration:Jt,opportunityId:Je.id},_n=await Bs(Vn),Jn={id:_n.id,start:In.toISOString(),end:hn.toISOString(),type:u,assignee:zn,assigneeId:Wn,assigneeType:Yn,duration:Jt,team:(ce==null?void 0:ce.name)||null,teamId:(ce==null?void 0:ce.id)||null,salesperson:(oe==null?void 0:oe.name)||null,salespersonId:(oe==null?void 0:oe.id)||null,communications:tt,status:"confirmed"};await d.updateOpportunity(Je.id,{scheduledAppointment:Jn}),a("appointment-scheduled",{...Jn,calendarEventId:_n.id}),pa()}catch(Vn){console.error("Failed to schedule appointment:",Vn)}}function va(){g.value&&(Y.value=!1,X.value=!1,te.value=!0,g.value.status!=="no-show"&&Hl())}function Yl(){g.value&&(Y.value=!1,te.value=!1,X.value=!0)}async function Hl(){var c;if(g.value)try{const I=(g.value.noShowCount||0)+1,ne=I===1?"NS1":I===2?"NS2":"NS3";if(g.value.id){const{updateCalendarEvent:oe}=await xn(async()=>{const{updateCalendarEvent:Ce}=await import("./users-D37oaAzL.js").then(tt=>tt.i);return{updateCalendarEvent:Ce}},__vite__mapDeps([3,1,2]));await oe(g.value.id,{status:"no-show"})}const ce={...g.value,status:"no-show",noShowCount:I};await d.updateOpportunity(l.opportunity.id,{scheduledAppointment:ce}),await d.addActivity(l.opportunity.id,{type:"ns-task",user:((c=x.currentUser)==null?void 0:c.name)||"You",action:`${ne} - marked appointment as no-show`,content:`${ne}: Appointment on ${new Date(g.value.start).toLocaleString()} marked as no-show. This is the ${I===1?"first":I===2?"second":"third"} no-show.`,data:{appointmentId:g.value.id,noShowCount:I,nsLabel:ne},timestamp:new Date().toISOString()}),a("appointment-no-show",{appointmentId:g.value.id,noShowCount:I,nsLabel:ne})}catch(u){console.error("Failed to mark appointment as no-show:",u)}}function Ql({opportunity:c,reason:u}){yt.value=!0,Ze(),u&&(Qt.value=u)}async function Gl({opportunity:c,reason:u}){var I;te.value=!1,await d.updateOpportunity(c.id,{stage:"Closed Lost",lossReason:u}),await d.addActivity(c.id,{type:"close-lost",user:((I=x.currentUser)==null?void 0:I.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${u||"N/A"}`,data:{reason:u},timestamp:new Date().toISOString()})}function Bn(c){if(c&&c.handler)c.handler();else if(c&&c.key){const u=rs[c.key];u&&u()}}const{generateContractPDF:ga,generateOfferPDF:ya,previewContractPDF:_l,previewOfferPDF:Jl,downloadPDF:Kl,sendPDFByEmail:Zl}=Ss(),Xl=C(()=>{const c=h.value;return!(c!=null&&c.offers)||!Array.isArray(c.offers)?[]:c.offers.filter(u=>u.status==="active"||!u.status)});function ba(c=null,u=null){Mn.value=c,pt.value=u,Rt.value=!0}async function eo(c){try{let u;c.type==="contract"?u=await ga(c.opportunityId,c.options):u=await ya(c.opportunityId,c.offerId,c.options),xt.value=u.url,En.value=u.id,Rt.value=!1,Vt.value=!0}catch(u){console.error("Error generating PDF:",u),dn.value=u.message||"Failed to generate PDF"}}async function to(c){Rn.value=!0,dn.value=null;try{let u;c.type==="contract"?u=await _l(c.opportunityId,c.options):u=await Jl(c.opportunityId,c.offerId,c.options),xt.value=u.previewUrl,En.value=null,Rt.value=!1,Vt.value=!0}catch(u){console.error("Error previewing PDF:",u),dn.value=u.message||"Failed to preview PDF"}finally{Rn.value=!1}}async function no(c){var u;try{let I;c.type==="offer"?I=await ya(c.opportunityId,c.offerId,c.options):I=await ga(c.opportunityId,c.options),await Zl({pdfId:I.id,email:c.email,message:c.message||"",opportunityId:c.opportunityId}),Rt.value=!1,await d.addActivity(c.opportunityId,{type:"communication",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"sent offer PDF",content:`Offer PDF sent to ${c.email}${c.message?`. Message: ${c.message}`:""}`,data:{email:c.email,message:c.message,pdfId:I.id,offerId:c.offerId},timestamp:new Date().toISOString()})}catch(I){console.error("Error sending PDF:",I),dn.value=I.message||"Failed to send PDF"}}function so(){Vt.value=!1,Rt.value=!0}async function ao(c){if(c)try{await Kl(c)}catch(u){console.error("Error downloading PDF:",u),dn.value=u.message||"Failed to download PDF"}}function lo(c){var u,I;ls.value=c.pdfId,os.value=((I=(u=h.value)==null?void 0:u.customer)==null?void 0:I.email)||"",is.value=`${Mn.value==="contract"?"Contract":"Offer"} Document`,Vt.value=!1,rn.value=!0}function oo(){}function io(c){rn.value=!1}function ha(c){ba("offer",c.id)}function xa(c){ba("contract")}async function wa(c){var u;try{const I=l.opportunity,ne=c.contract||c,ce=c.formData||{},oe={contractSigned:!0};ce.contractDate&&(oe.contractDate=ce.contractDate),I.esignatureCollectedDate||(oe.esignatureCollectedDate=ce.contractDate||new Date().toISOString()),ce.notes&&(oe.contractNotes=ce.notes),await d.updateOpportunity(I.id,oe),await d.addActivity(I.id,{type:"contract",user:((u=x.currentUser)==null?void 0:u.name)||"You",action:"collected e-signatures",content:`E-signatures collected for contract${ne.version?` v${ne.version}`:""}`,data:{contractDate:ce.contractDate||ne.contractDate||I.contractDate,contractVersion:ne.version,esignatureCollectedDate:oe.esignatureCollectedDate,notes:ce.notes},timestamp:new Date().toISOString()}),Tn.value&&Tn.value.setContractLoading(ne.id||ne.contractDate,!1)}catch(I){console.error("Failed to collect e-signatures:",I);const ne=c.contract||c;Tn.value&&Tn.value.setContractLoading(ne.id||ne.contractDate,!1)}}return ns(async()=>{try{const u=(await li({})).data||[];Pn.value=u.filter(I=>I.stockDays!==null&&I.stockDays!==void 0).slice(0,5)}catch(c){console.error("Failed to load recommended cars:",c),Pn.value=[]}g.value&&g.value.status==="no-show"&&(te.value=!0)}),(c,u)=>(p(),S(be,null,[n(nl,{task:h.value,"hide-title":"","hide-border":""},{"deadline-banner":o(()=>[e("div",Y1,[Le.isClosed.value?q("",!0):(p(),K(il,{key:0,"next-action-due":h.value.nextActionDue,"show-deadline-banner":Le.showDeadlineBanner.value,"task-id":h.value.id},null,8,["next-action-due","show-deadline-banner","task-id"]))])]),"primary-action":o(()=>[n(al,{task:h.value,"task-type":"opportunity",readonly:Le.isClosed.value,onReassigned:$s,class:"mb-3"},null,8,["task","readonly"]),!Le.isClosed.value&&!cn.value&&!jn.value&&Le.primaryAction.value?(p(),K(sl,{key:0,action:Le.primaryAction.value,"color-scheme":Le.primaryAction.value.colorScheme,onActionClicked:Le.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):q("",!0),ke((p(),S("div",{class:"mt-4",key:`offers-wrapper-${h.value.id}`},[An.value?(p(),K(ti,{ref_key:"offerCarouselRef",ref:aa,key:`carousel-${h.value.id}`,offers:h.value.offers||[],"opportunity-id":h.value.id,onOfferActivated:Dl,onGeneratePdf:ha,onAdd:ql},null,8,["offers","opportunity-id"])):q("",!0)])),[[Do,An.value]]),jn.value&&!t(Nt).isClosed.value?(p(),S("div",H1,[n(Ra,{ref_key:"contractCarouselRef",ref:Tn,contracts:O.value,"opportunity-id":h.value.id,"max-contract-date":Ps.value,onGeneratePdf:xa,onCollectEsignatures:wa,onAdd:da},null,8,["contracts","opportunity-id","max-contract-date"])])):q("",!0),!t(Nt).isClosed.value&&h.value.stage==="In Negotiation"&&t(fn)(h.value,"opportunity")==="In Negotiation - Contract Pending"?(p(),K(E1,{key:2,ref_key:"contractPendingManagementSectionRef",ref:ve,opportunity:h.value,"has-contracts":O.value.length>0,"show-add-offer-contract-pending-section":Ge.value,"show-close-as-lost-section":yt.value,"show-schedule-appointment-contract-pending-section":Be.value,"show-set-delivery-date-section":it.value,"close-as-lost-reason":t(Qt),"close-as-lost-notes":t(et),"delivery-date-form":rt.value,"has-delivery-date":M.value,"contract-pending-actions":qn.value,"can-submit-set-delivery-date":la.value,"can-create-inline-offer-contract-pending":Fl.value,"min-delivery-date":Ms.value,"onUpdate:showScheduleAppointmentContractPendingSection":u[0]||(u[0]=I=>Be.value=I),"onUpdate:showSetDeliveryDateSection":u[1]||(u[1]=I=>{it.value.value=I,I&&(Ge.value.value=!1,yt.value.value=!1,t(Kn)(rt.value,"deliveryDate"))}),"onUpdate:deliveryDateForm":u[2]||(u[2]=I=>rt.value=I),onOfferCreatedContractPending:jl,onCancelAddOfferContractPending:El,onConfirmAddOfferContractPending:Rl,onConfirmSetDeliveryDate:zl,onCancelSetDeliveryDate:fa,onScheduleAppointmentContractPendingSubmit:Wl,onCancelScheduleAppointmentContractPending:pa,onContractPendingAction:as,onCloseAsLostCancel:qs,onCloseAsLostConfirm:sa,class:"mt-4"},null,8,["opportunity","has-contracts","show-add-offer-contract-pending-section","show-close-as-lost-section","show-schedule-appointment-contract-pending-section","show-set-delivery-date-section","close-as-lost-reason","close-as-lost-notes","delivery-date-form","has-delivery-date","contract-pending-actions","can-submit-set-delivery-date","can-create-inline-offer-contract-pending","min-delivery-date"])):q("",!0),cn.value?(p(),K(h1,{key:3,ref_key:"negotiationManagementSectionRef",ref:ie,opportunity:h.value,"show-negotiation-section":He.value,"show-add-offer-section":Ke.value,"show-survey-section":Ye.value,"negotiation-channel":st.value,"negotiation-message":pe.value,"negotiation-selected-offer-id":re.value,"offer-select-options":It.value,"can-send-negotiation-message":Ln.value,"can-create-inline-offer":Tl.value,"secondary-actions":mn.value,"onUpdate:showNegotiationSection":u[3]||(u[3]=I=>He.value=I),"onUpdate:showAddOfferSection":u[4]||(u[4]=I=>Ke.value=I),"onUpdate:showSurveySection":u[5]||(u[5]=I=>Ye.value=I),"onUpdate:negotiationChannel":u[6]||(u[6]=I=>st.value=I),"onUpdate:negotiationMessage":u[7]||(u[7]=I=>pe.value=I),"onUpdate:negotiationSelectedOfferId":u[8]||(u[8]=I=>re.value=I),onResetNegotiationForm:u[9]||(u[9]=I=>{st.value=null,pe.value="",re.value=null}),onSendNegotiationMessage:Al,onCancelNegotiation:Ol,onOfferCreated:Il,onCancelAddOffer:Nl,onConfirmAddOffer:Vl,onOfbPostpone:ds,onGeneratePdf:ha,onSecondaryAction:Bn,onSurveySubmitted:As,onSurveyCancelled:Os},null,8,["opportunity","show-negotiation-section","show-add-offer-section","show-survey-section","negotiation-channel","negotiation-message","negotiation-selected-offer-id","offer-select-options","can-send-negotiation-message","can-create-inline-offer","secondary-actions"])):q("",!0),!Le.isClosed.value&&g.value&&g.value.start?(p(),K(Qy,{key:4,ref_key:"appointmentManagementSectionRef",ref:ct,opportunity:h.value,"scheduled-appointment":g.value,"show-reschedule-section":Y.value,"show-ns-task-section":te.value,"show-offer-assignment-section":X.value,"ns-task-count":bt.value,"can-submit-ns-task":ft.value,"ns-task-button-label":Mt.value,"can-create-offer":Ee.value,"secondary-actions":mn.value,"customer-name":k.value,"customer-profile-url":y.value,"is-appointment-today":b.value,onConfirmAppointment:mt,"onUpdate:showRescheduleSection":u[10]||(u[10]=I=>Y.value=I),"onUpdate:showNsTaskSection":u[11]||(u[11]=I=>te.value=I),"onUpdate:showOfferAssignmentSection":u[12]||(u[12]=I=>X.value=I),onMarkNoShow:va,onMarkShowedUp:Yl,onRescheduleSubmit:u[13]||(u[13]=I=>at(I,"reschedule")),onRescheduleCancel:ue,onNsAssigned:xl,onNsCancel:kl,onNsConfirm:wl,onNsCloseAsLost:Gl,onOfferAssignmentCreated:Sl,onOfferAssignmentCancel:$l,onOfferAssignmentConfirm:Cl,onSecondaryAction:Bn,onCloseAsLostConfirmed:gl,onCustomerClick:w,class:"mt-4"},null,8,["opportunity","scheduled-appointment","show-reschedule-section","show-ns-task-section","show-offer-assignment-section","ns-task-count","can-submit-ns-task","ns-task-button-label","can-create-offer","secondary-actions","customer-name","customer-profile-url","is-appointment-today"])):q("",!0)]),"task-widgets":o(()=>[r.value&&O.value.length>0?(p(),S("div",Q1,[n(Ra,{ref_key:"contractCarouselRef",ref:Tn,contracts:O.value,"opportunity-id":h.value.id,"max-contract-date":Ps.value,onGeneratePdf:xa,onCollectEsignatures:wa},null,8,["contracts","opportunity-id","max-contract-date"])])):q("",!0),v.value?(p(),S("div",G1,[h.value.assignmentNote?(p(),S("div",_1,[e("div",J1,[u[52]||(u[52]=e("i",{class:"fa-solid fa-sticky-note text-blue-600 text-sm mt-0.5"},null,-1)),e("div",K1,[u[51]||(u[51]=e("h5",{class:"font-semibold text-foreground text-sm mb-1"},"Note from Assigner",-1)),e("p",Z1,F(h.value.assignmentNote),1)])])])):q("",!0),e("div",X1,[e("div",eb,[e("div",tb,[e("div",nb,[u[53]||(u[53]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-foreground text-sm"},"Call to Schedule Appointment"),e("p",{class:"text-sm text-muted-foreground mt-0.5"}," Contact the customer to schedule an appointment ")],-1)),n(ol,{"is-call-active":t(z),"call-ended":t(Q),"call-duration":t(de),"call-notes":t(J),"formatted-call-duration":t(j),"mock-transcription":t(W),"contact-attempts":0,"max-contact-attempts":3,onStartCall:$e,onEndCall:Re,onLogManualCall:ht,onExtractInformation:u[14]||(u[14]=I=>jt.value=!0),"onUpdate:callNotes":gt,onCopyNumber:Pe},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription"])])])]),e("div",sb,[n(Zs,{ref_key:"scheduleFormRef",ref:Z,opportunity:h.value,mode:"schedule",onSubmit:u[15]||(u[15]=I=>at(I,"schedule")),onCancel:nt},null,8,["opportunity"])])])])):q("",!0),U.value?(p(),S("div",ab,[e("div",lb,[e("div",ob,[e("div",ib,[e("div",rb,[e("h4",ub,F(R.value),1),e("p",db,F(E.value),1)]),e("div",cb,[e("div",mb,[M.value?q("",!0):(p(),K(t(Ue),{key:0,variant:"outline","model-value":xe.value,"onUpdate:modelValue":u[16]||(u[16]=I=>{xe.value=I,I&&(we.value=!1,t(Kn)(Fe.value,"deliveryDate"))}),class:"outcome-toggle-item"},{default:o(()=>[...u[54]||(u[54]=[e("i",{class:"fa-solid fa-truck"},null,-1),e("span",null,"Schedule Delivery",-1)])]),_:1},8,["model-value"])),M.value&&!le.value?(p(),K(t(Ue),{key:1,variant:"outline","model-value":we.value,"onUpdate:modelValue":u[17]||(u[17]=I=>{we.value=I,I&&(xe.value=!1,t(Kn)(Ae.value,"actualDeliveryDate"))}),class:"outcome-toggle-item"},{default:o(()=>[...u[55]||(u[55]=[e("i",{class:"fa-solid fa-calendar-check"},null,-1),e("span",null,"Confirm Delivery",-1)])]),_:1},8,["model-value"])):q("",!0)]),n(t(_),{variant:"outline",onClick:Ls,class:"inline-flex items-center gap-2 cursor-pointer"},{default:o(()=>[...u[56]||(u[56]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),e("span",null,"Reopen Opportunity",-1)])]),_:1}),mn.value.length>0?(p(),K(Un,{key:0,actions:mn.value,onActionSelected:Bn},null,8,["actions"])):q("",!0)])])])]),e("div",fb,[xe.value?(p(),S("div",pb,[e("div",vb,[u[64]||(u[64]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Schedule Delivery",-1)),e("div",gb,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[57]||(u[57]=[D("Delivery Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:Fe.value.deliveryDate,"onUpdate:modelValue":u[18]||(u[18]=I=>Fe.value.deliveryDate=I),min:Ms.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[58]||(u[58]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:Fe.value.deliveryTime,"onUpdate:modelValue":u[19]||(u[19]=I=>Fe.value.deliveryTime=I),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[59]||(u[59]=[D("Delivery Location",-1)])]),_:1}),n(t($t),{modelValue:Fe.value.deliveryLocation,"onUpdate:modelValue":u[20]||(u[20]=I=>Fe.value.deliveryLocation=I)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select location..."})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Dealership"},{default:o(()=>[...u[60]||(u[60]=[D("At Dealership",-1)])]),_:1}),n(t(he),{value:"Customer Address"},{default:o(()=>[...u[61]||(u[61]=[D("Customer Address",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...u[62]||(u[62]=[D("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[63]||(u[63]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:Fe.value.notes,"onUpdate:modelValue":u[21]||(u[21]=I=>Fe.value.notes=I),rows:"4",placeholder:"Add any relevant delivery details...",class:"w-full"},null,8,["modelValue"])])])]),e("div",yb,[n(t(_),{variant:"secondary",onClick:_t},{default:o(()=>[...u[65]||(u[65]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!oa.value,onClick:Us},{default:o(()=>[...u[66]||(u[66]=[D(" Schedule Delivery ",-1)])]),_:1},8,["disabled"])])])):q("",!0),we.value?(p(),S("div",bb,[e("div",hb,[u[75]||(u[75]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Confirm Delivery",-1)),e("p",xb," Delivery was scheduled for "+F(t(Fn)(h.value.deliveryDate))+". Confirm that the delivery has been completed. ",1),e("div",wb,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[67]||(u[67]=[D("Scheduled Delivery Date",-1)])]),_:1}),n(t(qe),{type:"text",value:t(Fn)(h.value.deliveryDate),disabled:"",class:"w-full"},null,8,["value"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[68]||(u[68]=[D("Actual Delivery Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:Ae.value.actualDeliveryDate,"onUpdate:modelValue":u[22]||(u[22]=I=>Ae.value.actualDeliveryDate=I),max:Ul.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[69]||(u[69]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:Ae.value.deliveryTime,"onUpdate:modelValue":u[23]||(u[23]=I=>Ae.value.deliveryTime=I),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[70]||(u[70]=[D("Delivery Location",-1)])]),_:1}),n(t($t),{modelValue:Ae.value.deliveryLocation,"onUpdate:modelValue":u[24]||(u[24]=I=>Ae.value.deliveryLocation=I)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select location..."})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Dealership"},{default:o(()=>[...u[71]||(u[71]=[D("At Dealership",-1)])]),_:1}),n(t(he),{value:"Customer Address"},{default:o(()=>[...u[72]||(u[72]=[D("Customer Address",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...u[73]||(u[73]=[D("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[74]||(u[74]=[D("Delivery Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:Ae.value.notes,"onUpdate:modelValue":u[25]||(u[25]=I=>Ae.value.notes=I),rows:"4",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"w-full"},null,8,["modelValue"])])])]),e("div",kb,[n(t(_),{variant:"secondary",onClick:Xs},{default:o(()=>[...u[76]||(u[76]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!ia.value,onClick:vl},{default:o(()=>[...u[77]||(u[77]=[D(" Mark as Delivered ",-1)])]),_:1},8,["disabled"])])])):q("",!0),De.value?(p(),S("div",Sb,[e("div",Cb,[u[85]||(u[85]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Reschedule Delivery",-1)),e("p",$b," Current delivery scheduled for "+F(t(Fn)(h.value.deliveryDate))+". Update the delivery date and time. ",1),e("div",Db,[e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[78]||(u[78]=[D("New Delivery Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),n(t(qe),{type:"date",modelValue:Ve.value.deliveryDate,"onUpdate:modelValue":u[26]||(u[26]=I=>Ve.value.deliveryDate=I),min:Ms.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[79]||(u[79]=[D("Time (Optional)",-1)])]),_:1}),n(t(qe),{type:"time",modelValue:Ve.value.deliveryTime,"onUpdate:modelValue":u[27]||(u[27]=I=>Ve.value.deliveryTime=I),class:"w-full"},null,8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[80]||(u[80]=[D("Delivery Location",-1)])]),_:1}),n(t($t),{modelValue:Ve.value.deliveryLocation,"onUpdate:modelValue":u[28]||(u[28]=I=>Ve.value.deliveryLocation=I)},{default:o(()=>[n(t(kt),{class:"w-full"},{default:o(()=>[n(t(St),{placeholder:"Select location..."})]),_:1}),n(t(Ct),null,{default:o(()=>[n(t(he),{value:"Dealership"},{default:o(()=>[...u[81]||(u[81]=[D("At Dealership",-1)])]),_:1}),n(t(he),{value:"Customer Address"},{default:o(()=>[...u[82]||(u[82]=[D("Customer Address",-1)])]),_:1}),n(t(he),{value:"Other"},{default:o(()=>[...u[83]||(u[83]=[D("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[84]||(u[84]=[D("Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:Ve.value.notes,"onUpdate:modelValue":u[29]||(u[29]=I=>Ve.value.notes=I),rows:"4",placeholder:"Add reason for rescheduling or any relevant details...",class:"w-full"},null,8,["modelValue"])])])]),e("div",Ab,[n(t(_),{variant:"secondary",onClick:ea},{default:o(()=>[...u[86]||(u[86]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!ra.value,onClick:ml},{default:o(()=>[...u[87]||(u[87]=[D(" Reschedule Delivery ",-1)])]),_:1},8,["disabled"])])])):q("",!0),Me.value?(p(),S("div",Ob,[e("div",Tb,[u[94]||(u[94]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Complete Delivery Checklist",-1)),u[95]||(u[95]=e("p",{class:"text-sm text-muted-foreground mb-4"}," Complete the post-delivery checklist to finalize the delivery process. ",-1)),e("div",Ib,[e("div",Vb,[e("div",Nb,[ke(e("input",{type:"checkbox",id:"checklist-vehicle","onUpdate:modelValue":u[30]||(u[30]=I=>je.value.vehicleInspected=I),class:"rounded border-gray-300"},null,512),[[wt,je.value.vehicleInspected]]),n(t(B),{for:"checklist-vehicle",class:"text-sm text-foreground cursor-pointer"},{default:o(()=>[...u[88]||(u[88]=[D("Vehicle inspected and in good condition",-1)])]),_:1})]),e("div",Fb,[ke(e("input",{type:"checkbox",id:"checklist-documents","onUpdate:modelValue":u[31]||(u[31]=I=>je.value.documentsProvided=I),class:"rounded border-gray-300"},null,512),[[wt,je.value.documentsProvided]]),n(t(B),{for:"checklist-documents",class:"text-sm text-foreground cursor-pointer"},{default:o(()=>[...u[89]||(u[89]=[D("All documents provided to customer",-1)])]),_:1})]),e("div",Ub,[ke(e("input",{type:"checkbox",id:"checklist-payment","onUpdate:modelValue":u[32]||(u[32]=I=>je.value.paymentReceived=I),class:"rounded border-gray-300"},null,512),[[wt,je.value.paymentReceived]]),n(t(B),{for:"checklist-payment",class:"text-sm text-foreground cursor-pointer"},{default:o(()=>[...u[90]||(u[90]=[D("Payment received and processed",-1)])]),_:1})]),e("div",qb,[ke(e("input",{type:"checkbox",id:"checklist-warranty","onUpdate:modelValue":u[33]||(u[33]=I=>je.value.warrantyExplained=I),class:"rounded border-gray-300"},null,512),[[wt,je.value.warrantyExplained]]),n(t(B),{for:"checklist-warranty",class:"text-sm text-foreground cursor-pointer"},{default:o(()=>[...u[91]||(u[91]=[D("Warranty and service information explained",-1)])]),_:1})]),e("div",Lb,[ke(e("input",{type:"checkbox",id:"checklist-keys","onUpdate:modelValue":u[34]||(u[34]=I=>je.value.keysHandedOver=I),class:"rounded border-gray-300"},null,512),[[wt,je.value.keysHandedOver]]),n(t(B),{for:"checklist-keys",class:"text-sm text-foreground cursor-pointer"},{default:o(()=>[...u[92]||(u[92]=[D("Keys and accessories handed over",-1)])]),_:1})])]),e("div",null,[n(t(B),{class:"block text-sm font-medium text-muted-foreground mb-2"},{default:o(()=>[...u[93]||(u[93]=[D("Additional Notes (Optional)",-1)])]),_:1}),n(t(Xe),{modelValue:Pt.value,"onUpdate:modelValue":u[35]||(u[35]=I=>Pt.value=I),rows:"4",placeholder:"Add any additional notes or observations...",class:"w-full"},null,8,["modelValue"])])])]),e("div",Pb,[n(t(_),{variant:"secondary",onClick:ta},{default:o(()=>[...u[96]||(u[96]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!ua.value,onClick:fl},{default:o(()=>[...u[97]||(u[97]=[D(" Complete Checklist ",-1)])]),_:1},8,["disabled"])])])):q("",!0)])])):q("",!0),N.value?(p(),S("div",Mb,[e("div",Eb,[e("div",Rb,[e("div",jb,[e("div",Bb,[u[100]||(u[100]=e("h4",{class:"font-bold text-foreground text-sm"},"Opportunity Closed as Lost",-1)),u[101]||(u[101]=e("p",{class:"text-sm text-muted-foreground mt-0.5"}," This opportunity was closed as lost. You can reopen it to continue the sales process or requalify it as a lead. ",-1)),e("div",zb,[e("div",Wb,[u[99]||(u[99]=e("i",{class:"fa-solid fa-info-circle text-red-600 text-sm mt-0.5"},null,-1)),e("div",Yb,[u[98]||(u[98]=e("p",{class:"text-sm font-medium text-red-900"},"Reason for Closing",-1)),e("p",Hb,F(h.value.lossReason||"No reason provided"),1),h.value.lossNotes?(p(),S("p",Qb,F(h.value.lossNotes),1)):q("",!0)])])])]),e("div",Gb,[e("div",_b,[n(t(Ue),{variant:"outline","model-value":Ht.value,"onUpdate:modelValue":u[36]||(u[36]=I=>Ht.value=I),class:"outcome-toggle-item"},{default:o(()=>[...u[102]||(u[102]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),e("span",null,"Reopen Opportunity",-1)])]),_:1},8,["model-value"])]),mn.value.length>0?(p(),K(Un,{key:0,actions:mn.value,onActionSelected:Bn},null,8,["actions"])):q("",!0)])])])]),e("div",Jb,[Ht.value?(p(),S("div",Kb,[e("div",Zb,[u[105]||(u[105]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Reopen Opportunity",-1)),u[106]||(u[106]=e("p",{class:"text-sm text-muted-foreground mb-4"},' Reopening this opportunity will restore it to an active state. The opportunity will return to the appropriate stage based on its current state (e.g., if it has offers, it will return to "In Negotiation"). ',-1)),e("div",Xb,[n(t(_),{variant:"secondary",onClick:u[37]||(u[37]=I=>Ht.value=!1)},{default:o(()=>[...u[103]||(u[103]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",onClick:Ls},{default:o(()=>[...u[104]||(u[104]=[D(" Reopen Opportunity ",-1)])]),_:1})])])])):q("",!0)])])):q("",!0),lt.value&&!cn.value&&!Le.isClosed.value?(p(),S("div",eh,[e("div",th,[u[107]||(u[107]=e("h5",{class:"font-semibold text-foreground text-sm mb-4"},"Create Offer",-1)),n(ss,{ref_key:"standaloneOfferWidgetRef",ref:On,"task-id":h.value.id,"task-type":"opportunity",customer:h.value.customer,"selected-vehicle":h.value.selectedVehicle||h.value.vehicle||h.value.requestedCar,"hide-header":"","hide-actions":"",onSave:f,onCancel:ms},null,8,["task-id","customer","selected-vehicle"])]),e("div",nh,[n(t(_),{variant:"secondary",onClick:ms},{default:o(()=>[...u[108]||(u[108]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",disabled:!Fs.value,onClick:L},{default:o(()=>[...u[109]||(u[109]=[D(" Create Offer ",-1)])]),_:1},8,["disabled"])])])):q("",!0),yt.value&&!Le.isClosed.value&&!(g.value&&g.value.start)&&!jn.value?(p(),K(Ks,{key:5,ref_key:"closeAsLostCardRef",ref:yn,"preselected-reason":t(Qt),"preselected-notes":t(et),onCancel:qs,onConfirm:sa},null,8,["preselected-reason","preselected-notes"])):Le.activeTaskWidget.value&&Le.activeTaskWidget.value.component?(p(),S("div",sh,[(p(),K(Qs(Le.activeTaskWidget.value.component),Hs(Le.activeTaskWidget.value.props,{onClose:us,onAutoCloseLost:Ql,onSurveySubmitted:Ds,onSurveyCancelled:us,onPostpone:ds,onRescheduleDelivery:c.handleRescheduleDeliveryFromTask}),null,16,["onRescheduleDelivery"]))])):q("",!0)]),"secondary-actions":o(()=>[...u[110]||(u[110]=[])]),_:1},8,["task"]),H.value?(p(),K(el,{key:0,show:H.value,customer:h.value.customer,assignee:h.value.assignee,"disabled-fields":["customer"],onCreate:ae,onCancel:u[38]||(u[38]=I=>H.value=!1)},null,8,["show","customer","assignee"])):q("",!0),bn.value?(p(),K(ni,{key:1,opportunity:h.value,"requested-car":h.value.requestedCar,"recommended-cars":Pn.value,onVehicleSelected:Ns,onClose:u[39]||(u[39]=I=>bn.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):q("",!0),sn.value?(p(),K(Hp,{key:2,opportunity:h.value,onContractSet:Ie,onClose:u[40]||(u[40]=I=>sn.value=!1)},null,8,["opportunity"])):q("",!0),an.value?(p(),K(Zp,{key:3,opportunity:h.value,onDelivered:Ne,onClose:u[41]||(u[41]=I=>an.value=!1)},null,8,["opportunity"])):q("",!0),ln.value?(p(),K(sv,{key:4,opportunity:h.value,onRequalified:yl,onClose:u[42]||(u[42]=I=>ln.value=!1)},null,8,["opportunity"])):q("",!0),jt.value?(p(),K(Gs,{key:5,onClose:u[43]||(u[43]=I=>jt.value=!1)})):q("",!0),Et.value&&g.value?(p(),K(oi,{key:6,show:Et.value,event:g.value,onClose:u[44]||(u[44]=I=>Et.value=!1),onEdit:u[45]||(u[45]=I=>{Et.value=!1,Bt.value=!0}),onDelete:bl},null,8,["show","event"])):q("",!0),Bt.value&&g.value?(p(),K(ii,{key:7,show:Bt.value,event:g.value,customer:h.value.customer,"disabled-fields":["customer"],onSave:hl,onCancel:u[46]||(u[46]=I=>Bt.value=!1)},null,8,["show","event","customer"])):q("",!0),Rt.value?(p(),K(Pv,{key:8,show:Rt.value,"opportunity-id":h.value.id,"document-type":Mn.value,"offer-id":pt.value,"available-offers":Xl.value,customer:h.value.customer,onClose:u[47]||(u[47]=I=>Rt.value=!1),onGenerate:eo,onPreview:to,onSend:no},null,8,["show","opportunity-id","document-type","offer-id","available-offers","customer"])):q("",!0),Vt.value?(p(),K(Qv,{key:9,show:Vt.value,"pdf-url":xt.value,"pdf-id":En.value,loading:Rn.value,error:dn.value,onClose:u[48]||(u[48]=I=>Vt.value=!1),onRegenerate:so,onDownload:ao,onEmail:lo,onPrint:oo},null,8,["show","pdf-url","pdf-id","loading","error"])):q("",!0),on.value?(p(),K(B1,{key:10,show:on.value,"max-contract-date":Ps.value,onConfirm:Pl,onCancel:ca},null,8,["show","max-contract-date"])):q("",!0),Gt.value?(p(),K(W1,{key:11,show:Gt.value,opportunity:h.value,onConfirm:Ll,onCancel:ma},null,8,["show","opportunity"])):q("",!0),n(ng,{show:un.value,"task-type":$n.value||"",onClose:cs,onConfirm:Ts},null,8,["show","task-type"]),n(ag,{show:Dn.value,opportunity:h.value,onClose:Vs,onConfirm:Is},null,8,["show","opportunity"]),rn.value?(p(),K(eg,{key:12,show:rn.value,"pdf-id":ls.value,"recipient-email":os.value,"default-subject":is.value,onClose:u[49]||(u[49]=I=>rn.value=!1),onSent:io},null,8,["show","pdf-id","recipient-email","default-subject"])):q("",!0),dt.value?(p(),K(t(Tt),{key:13},{default:o(()=>[n(t(Dt),null,{default:o(()=>[n(t(At),null,{default:o(()=>[n(t(Ot),null,{default:o(()=>[...u[111]||(u[111]=[D("Archive Opportunity",-1)])]),_:1}),n(t(yo),null,{default:o(()=>[...u[112]||(u[112]=[D(" Are you sure you want to archive this opportunity? This action will mark it as completed and archived. ",-1)])]),_:1})]),_:1}),e("div",ah,[n(t(_),{variant:"secondary",onClick:u[50]||(u[50]=I=>dt.value=!1)},{default:o(()=>[...u[113]||(u[113]=[D(" Cancel ",-1)])]),_:1}),n(t(_),{variant:"default",onClick:pl},{default:o(()=>[...u[114]||(u[114]=[D(" Archive ",-1)])]),_:1})])]),_:1})]),_:1})):q("",!0)],64))}},oh=Zt(lh,[["__scopeId","data-v-85a5aa9d"]]);function xh(s){const $=Sn(),i=Xt(),l=C(()=>s.value?s.value.type==="lead"?Jc:oh:null),a=C(()=>s.value?s.value.type==="lead"?{currentActivities:C(()=>$.currentLeadActivities),addActivity:(d,x)=>$.addActivity(d,x),updateActivity:(d,x,V)=>$.updateActivity(d,x,V),deleteActivity:(d,x)=>$.deleteActivity(d,x),updateLead:(d,x)=>$.updateLead(d,x),loadLeadById:d=>$.fetchLeadById(d)}:{currentActivities:C(()=>i.currentOpportunityActivities),addActivity:(d,x)=>i.addActivity(d,x),updateActivity:(d,x,V)=>i.updateActivity(d,x,V),deleteActivity:(d,x)=>i.deleteActivity(d,x),addVehicle:(d,x)=>i.addVehicle(d,x),createOffer:(d,x)=>i.createOffer(d,x),updateOpportunity:(d,x)=>i.updateOpportunity(d,x),loadOpportunityById:d=>i.fetchOpportunityById(d)}:null),m=C(()=>s.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:l,storeAdapter:a,addNewConfig:m}}function wh(s){const $=Sn(),i=Xt(),l=Yt(),a=C(()=>{const b=(s.value?$.leads:$.leads.filter(w=>!w.isDisqualified)).map(w=>{const r=fn(w,"lead"),O={...w,type:"lead",compositeId:`lead-${w.id}`,displayStage:r};return!O.customer&&w.customer&&(O.customer=w.customer),O}),k=i.opportunities.map(w=>{const r=fn(w,"opportunity"),O={...w,type:"opportunity",compositeId:`opportunity-${w.id}`,displayStage:r};return!O.customer&&w.customer&&(O.customer=w.customer),O});let y=[];return l.isOperator()?y=b:l.isSalesman()?y=k:y=[...b,...k],y}),m=(v,b)=>!b||b.length===0?v:Array.isArray(b)?v.filter(k=>b.includes(k.type)):b==="all"?v:v.filter(k=>k.type===b),d=v=>{const b=new Date,k=new Date(b.getTime()+24*60*60*1e3);return v.filter(y=>{if(!y.nextActionDue)return!1;const w=new Date(y.nextActionDue);return w>=b&&w<=k})},x=v=>v.filter(b=>b.nextActionDue!=null),V=v=>{const b=new Date(Date.now()-36e5);return v.filter(k=>k.type!=="lead"||!k.createdAt?!1:new Date(k.createdAt)>=b)},A=v=>{var k;const b=(k=l.currentUser)==null?void 0:k.name;return b?v.filter(y=>y.assignee===b):[]},h=(v,b)=>{if(!b||b.length===0)return v;let k=[...v];const y=b.filter(w=>w==="lead"||w==="opportunity");return y.length>0&&(k=m(k,y)),b.forEach(w=>{switch(w){case"due-in-24h":k=d(k);break;case"to-be-called":k=x(k);break;case"leads-1h":k=V(k);break;case"assigned-to-me":k=A(k);break}}),k},g=C(()=>{const v=a.value.some(k=>k.type==="lead"),b=a.value.some(k=>k.type==="opportunity");return v&&b});return{allTasks:a,filterByType:m,filterByDueIn24Hours:d,filterByToBeCalled:x,filterByLeadsCreated1Hour:V,filterByAssignedToMe:A,applyFilters:h,shouldShowTypeFilter:g}}export{hh as D,bh as T,yi as _,xh as a,pi as g,wh as u};
