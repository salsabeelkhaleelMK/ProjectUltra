import{r as j,a4 as Tt,h as ce,c as S,J as We,d as l,o as s,e,y as A,n as O,w as ee,t as u,F as U,i as W,p as M,g as p,s as E,P as He,a9 as St,I as Ye,x as B,z as Ce,k as N,Q as Y,C as It,l as se,m as we,j as Te,K as R,v as ne,a3 as At,a6 as xe,D as F,aa as Dt,O as qt,a8 as Et,L as Ue,Z as at,_ as Lt}from"./index-H5Cqf6fX.js";import{_ as lt,n as nt,o as it,y as Ot,p as ot,T as Mt,P as jt,q as Nt,u as Vt,r as Bt,z as Rt,e as Ft,t as Ut}from"./ComingSoonModal-DnKIG9sS.js";import{u as Pt}from"./opportunities-DEbYZ9Ha.js";import{_ as zt}from"./ReassignUserModal-DI-WnWzN.js";import{a as Wt,_ as Ht}from"./CreateEventModal-DnaL32CW.js";import{z as Se,F as Ie,L as Ae,H as De,j as qe,C as Ee,W as Le,K as pt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-1_jAZFgo.js";import{u as Yt,_ as Qt}from"./UnifiedAddForm-Dcy87xel.js";import{u as Kt}from"./users-C7jahJiq.js";import{c as Gt,d as Jt}from"./calendar-xvguvRl0.js";const Xt={class:"w-full card-container p-3 md:px-8 md:py-3.5"},Zt={class:"flex items-center justify-between gap-4"},_t={class:"flex items-center gap-2 flex-1 min-w-0"},es={class:"flex items-center gap-3 min-w-0 flex-1"},ts={class:"min-w-0 flex-1"},ss={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},as={class:"flex flex-col gap-1.5 mt-1"},ls={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},ns={class:"flex items-center gap-1.5 group"},is={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},os={class:"flex items-center gap-1.5 group"},rs={class:"text-xs text-heading font-medium whitespace-nowrap"},ds={class:"flex items-center gap-1.5"},us={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},cs={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},ms={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},fs={class:"flex flex-wrap items-center gap-1.5"},ps={class:"shrink-0"},bs={class:"relative"},vs={key:0,class:"absolute top-full right-0 mt-2 z-50 shadow-xl"},ys={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]}},emits:["action","add-tag"],setup(t,{emit:v}){const d=t,y=v,h=j(!1),g=Tt(),r=ce(),i=S(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Offer"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...d.taskType==="opportunity"||d.taskType==="contact"?[{key:"appointment",label:"Appointment"}]:[]].map(I=>({...I,onClick:()=>b(I.key)}))),b=k=>{h.value=!1,y("action",k)},n=async(k,I)=>{try{await navigator.clipboard.writeText(k),g.pushToast("success",`${I==="email"?"Email":"Phone"} copied!`)}catch{g.pushToast("error","Failed to copy")}},a=()=>y("add-tag"),o=()=>{d.customerId&&r.push(`/customer/${d.customerId}`)};return(k,I)=>{const C=We("click-outside");return s(),l("div",Xt,[e("div",Zt,[e("div",_t,[e("button",{onClick:I[0]||(I[0]=w=>A(r).push("/customers")),class:"w-7 h-7 flex items-center justify-center text-sub hover:text-brand-dark transition-colors shrink-0 -ml-1","aria-label":"Back to customers"},[...I[4]||(I[4]=[e("i",{class:"fa-solid fa-arrow-left text-xs"},null,-1)])]),e("div",es,[e("button",{onClick:ee(o,["stop"]),class:O(["w-20 h-20 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...I[5]||(I[5]=[e("i",{class:"fa-solid fa-user text-3xl text-white"},null,-1)])],2),e("div",ts,[e("h1",ss,u(t.name),1),e("div",as,[e("div",ls,[e("div",ns,[I[7]||(I[7]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",is,u(t.email),1),e("button",{onClick:I[1]||(I[1]=ee(w=>n(t.email,"email"),["stop"])),class:"transition-all"},[...I[6]||(I[6]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",os,[I[9]||(I[9]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",rs,u(t.phone),1),e("button",{onClick:I[2]||(I[2]=ee(w=>n(t.phone,"phone"),["stop"])),class:"transition-all"},[...I[8]||(I[8]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",ds,[t.thirdFieldLabel.toLowerCase().includes("address")?(s(),l("i",us)):(s(),l("i",cs)),e("span",ms,u(t.thirdFieldValue),1)])]),e("div",fs,[(s(!0),l(U,null,W(t.tags,w=>(s(),l("span",{key:w,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},u(w),1))),128)),e("button",{onClick:ee(a,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...I[10]||(I[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])])]),e("div",ps,[e("div",bs,[e("button",{onClick:I[3]||(I[3]=ee(w=>h.value=!h.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...I[11]||(I[11]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),h.value?M((s(),l("div",vs,[E(A(He),{items:i.value,className:"w-48"},null,8,["items"])])),[[C,()=>h.value=!1]]):p("",!0)])])])])}}},xs={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},gs=["onClick"],rt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const v={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},d=y=>v[y]||"fa-solid fa-circle";return(y,h)=>(s(),l("div",xs,[(s(!0),l(U,null,W(t.tabs,g=>(s(),l("div",{key:g.key,onClick:r=>y.$emit("update:modelValue",g.key),class:O(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===g.key?"border-brand-dark text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:O([d(g.key),"text-sm md:text-sm",t.modelValue===g.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:O(["hidden md:inline whitespace-nowrap",t.modelValue===g.key?"text-brand-darkDarker":""])},u(g.label),3)],10,gs))),128))]))}},hs={class:"w-full mb-6"},ks={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},ws={class:"px-4 md:px-6 py-3 border-b border-black/5"},$s={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},Cs={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},Ts={class:"flex items-center gap-1.5"},Ss={key:1},Is={class:"flex items-center gap-2"},As={key:0,class:"p-4 md:p-6"},Ds={key:0,class:"space-y-4"},qs={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Es={class:"flex items-center gap-4"},Ls={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},Os=["src"],Ms={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},js={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},Ns={class:"flex items-center gap-2 flex-wrap"},Vs={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},Bs={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},Rs={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},Fs={class:"text-fluid-xs font-bold text-heading"},Us={key:0,class:"text-right"},Ps={class:"font-bold text-heading text-fluid-lg"},zs={key:0,class:"pt-2"},Ws={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Hs={class:"text-fluid-sm text-body leading-relaxed"},Ys={key:1,class:"space-y-3"},Qs={key:0,class:"flex items-center gap-2"},Ks={class:"text-fluid-sm font-semibold text-heading"},Gs={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Js={class:"text-fluid-sm text-body leading-relaxed"},Xs={key:1,class:"border-t border-black/5"},Zs={class:"font-medium"},_s={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},ea={class:"mb-6"},ta={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},sa={key:0},aa={class:"font-medium text-body"},la={key:1},na={class:"font-medium text-body"},ia={key:2},oa={class:"font-medium text-body"},ra={class:"font-medium text-body"},da={key:0},ua={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ca={key:0},ma={class:"font-medium text-body"},fa={key:1},pa={class:"font-medium text-body"},ba={key:2},va={class:"font-medium text-body"},ya={key:3},xa={class:"font-medium text-body"},ga={key:4},ha={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},ka={key:5},wa={class:"font-medium text-body"},$a={key:0,class:"mt-6 flex justify-end"},Ca={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const v=t,d=j(!1);S(()=>v.deliverySubstatus?St(v.deliverySubstatus):"");const y=S(()=>v.deliverySubstatus?v.deliverySubstatus==="Delivered"?"green":v.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),h=S(()=>Ye(v.stage,v.entityType));function g(q){return!q||q.length===0?null:q.filter(_=>_.type==="offer").sort((_,re)=>new Date(re.timestamp)-new Date(_.timestamp))[0]||null}function r(q){if(!q)return 0;const D=new Date(q),re=Math.abs(new Date-D);return Math.ceil(re/(1e3*60*60*24))}const i=S(()=>{if(v.stage!=="In Negotiation")return null;const q=g(v.activities);if(!q)return null;const D=r(q.timestamp);return D<1?{label:"New Offer",theme:"orange"}:D<3?{label:"Active",theme:"yellow"}:null}),b=S(()=>v.requestedCar&&v.requestedCar.brand&&v.requestedCar.model),n=S(()=>v.requestType||v.requestMessage||b.value),a=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.brand)||""}),o=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.model)||""}),k=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.year)||""}),I=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.image)||""}),C=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.price)||null}),w=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.stockDays)!==void 0?v.requestedCar.stockDays:null}),f=S(()=>{var q,D;return((q=v.requestedCar)==null?void 0:q.dealership)||((D=v.task)==null?void 0:D.dealership)||""}),m=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.registration)||""}),c=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.kilometers)!==void 0?v.requestedCar.kilometers:null}),T=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.fuelType)||""}),P=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.gearType)||""}),Z=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.vin)||""}),X=S(()=>"Email"),ae=S(()=>{var q,D;return((q=v.task)==null?void 0:q.sourceDetails)||((D=v.requestedCar)==null?void 0:D.adCampaign)||""}),me=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.expectedPurchaseDate)||""}),ie=S(()=>{var q;return((q=v.task)==null?void 0:q.fiscalEntity)||""}),ge=S(()=>{var q;return((q=v.task)==null?void 0:q.sourceDetails)||""}),fe=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.adMedium)||""}),he=S(()=>{var q;return((q=v.requestedCar)==null?void 0:q.adSource)||""});S(()=>!0);const le=S(()=>!0),G=S(()=>b.value||v.requestType||v.source||ge.value||ae.value||me.value||ie.value||fe.value||he.value),oe=q=>new Intl.NumberFormat("en-US").format(q),te=q=>new Intl.NumberFormat("en-US").format(q);return(q,D)=>(s(),l("div",hs,[e("div",ks,[e("div",ws,[e("div",$s,[n.value?(s(),l("div",Cs,[D[2]||(D[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",Ts,[e("span",{class:O(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:O(["px-2 py-0.5 rounded text-fluid-xs font-medium border",h.value])},u(t.stage),3),t.deliverySubstatus?(s(),B(A(Ce),{key:0,text:t.deliverySubstatus,size:"small",theme:y.value},null,8,["text","theme"])):p("",!0),i.value?(s(),B(A(Ce),{key:1,text:i.value.label,size:"small",theme:i.value.theme},null,8,["text","theme"])):p("",!0)])])):(s(),l("div",Ss)),e("div",Is,[D[3]||(D[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:D[0]||(D[0]=_=>q.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},u(t.owner),1)])])]),n.value?(s(),l("div",As,[b.value?(s(),l("div",Ds,[e("div",qs,[e("div",Es,[e("div",Ls,[I.value?(s(),l("img",{key:0,src:I.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Os)):(s(),l("i",Ms))]),e("div",null,[e("div",js,u(a.value)+" "+u(o.value)+" ("+u(k.value)+")",1),e("div",Ns,[w.value!==void 0&&w.value!==null?(s(),l("div",Vs,[D[4]||(D[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+u(w.value)+" days) ",1)])):b.value?(s(),l("div",Bs,[...D[5]||(D[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])):p("",!0),t.source?(s(),l("div",Rs,[D[6]||(D[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",Fs,u(t.source),1)])):p("",!0)])])]),C.value?(s(),l("div",Us,[D[7]||(D[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",Ps,"€ "+u(oe(C.value)),1)])):p("",!0)]),t.requestMessage?(s(),l("div",zs,[D[8]||(D[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",Ws,[e("p",Hs,u(t.requestMessage),1)])])):p("",!0)])):(s(),l("div",Ys,[t.requestType?(s(),l("div",Qs,[D[9]||(D[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",Ks,u(t.requestType),1)])):p("",!0),t.requestMessage?(s(),l("div",Gs,[D[10]||(D[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",Js,u(t.requestMessage),1)])):p("",!0)]))])):p("",!0),G.value?(s(),l("div",Xs,[e("button",{onClick:D[1]||(D[1]=_=>d.value=!d.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Zs,u(d.value?"Hide":"View")+" Details",1),e("i",{class:O(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":d.value}])},null,2)])])):p("",!0),d.value&&G.value?(s(),l("div",_s,[e("div",ea,[D[21]||(D[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",ta,[t.requestType?(s(),l("div",sa,[D[11]||(D[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",aa,u(t.requestType),1)])):p("",!0),t.source?(s(),l("div",la,[D[12]||(D[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",na,u(t.source),1)])):p("",!0),e("div",null,[D[13]||(D[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:O(["font-medium",ge.value?"text-body":"text-sub"])},u(ge.value||"--"),3)]),f.value?(s(),l("div",ia,[D[14]||(D[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",oa,u(f.value),1)])):p("",!0),e("div",null,[D[15]||(D[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",ra,u(X.value||"Email"),1)]),e("div",null,[D[16]||(D[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:O(["font-medium",ae.value?"text-body":"text-sub"])},u(ae.value||"--"),3)]),e("div",null,[D[17]||(D[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:O(["font-medium",fe.value?"text-body":"text-sub"])},u(fe.value||"--"),3)]),e("div",null,[D[18]||(D[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:O(["font-medium",he.value?"text-body":"text-sub"])},u(he.value||"--"),3)]),e("div",null,[D[19]||(D[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:O(["font-medium",me.value?"text-body":"text-sub"])},u(me.value||"--"),3)]),e("div",null,[D[20]||(D[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:O(["font-medium",ie.value?"text-body":"text-sub"])},u(ie.value||"--"),3)])])]),b.value?(s(),l("div",da,[D[30]||(D[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[D[29]||(D[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",ua,[m.value?(s(),l("div",ca,[D[22]||(D[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",ma,u(m.value),1)])):p("",!0),c.value!==void 0&&c.value!==null?(s(),l("div",fa,[D[23]||(D[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",pa,u(te(c.value))+" Km",1)])):p("",!0),T.value?(s(),l("div",ba,[D[24]||(D[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",va,u(T.value),1)])):p("",!0),P.value?(s(),l("div",ya,[D[25]||(D[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",xa,u(P.value),1)])):p("",!0),Z.value?(s(),l("div",ga,[D[26]||(D[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",ha,u(Z.value),1)])):p("",!0),f.value?(s(),l("div",ka,[D[27]||(D[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",wa,u(f.value),1)])):p("",!0)]),le.value?(s(),l("div",$a,[...D[28]||(D[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):p("",!0)])])):p("",!0)])):p("",!0)])]))}},Ta={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Sa={class:"px-4 py-4 flex items-center justify-between shrink-0"},Ia={class:"flex items-center gap-2"},Aa={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},Da={class:"flex items-center gap-2 flex-wrap mb-3"},qa={key:0,class:"space-y-3"},Ea={class:"flex items-center gap-3"},La={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},Oa=["src"],Ma={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},ja={class:"flex-1 min-w-0"},Na={class:"font-bold text-heading text-fluid-sm mb-1"},Va={class:"flex items-center gap-2 flex-wrap"},Ba={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},Ra={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},Fa={key:0,class:"text-right"},Ua={class:"font-bold text-heading text-fluid-sm"},Pa={class:"flex justify-end pt-2"},za={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Wa={class:"mt-3 pt-3 space-y-2"},Ha={key:0,class:"flex items-center justify-between text-fluid-xs"},Ya={class:"text-heading font-medium"},Qa={key:1,class:"flex items-center justify-between text-fluid-xs"},Ka={class:"text-heading font-medium"},Ga={key:2,class:"pt-2"},Ja={class:"bg-surfaceSecondary rounded-lg p-2"},Xa={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},dt={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const v=t,d=S(()=>v.task.requestedCar&&v.task.requestedCar.brand&&v.task.requestedCar.model),y=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.brand)||""}),h=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.model)||""}),g=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.year)||""}),r=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.image)||""}),i=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.price)||null}),b=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.stockDays)!==void 0?v.task.requestedCar.stockDays:null}),n=S(()=>{var f;return((f=v.task.requestedCar)==null?void 0:f.requestMessage)||""}),a=S(()=>Ye(v.task.displayStage||v.task.stage,v.entityType)),o=S(()=>v.task.deliverySubstatus?v.task.deliverySubstatus==="Delivered"?"green":v.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function k(f){return!f||f.length===0?null:f.filter(c=>c.type==="offer").sort((c,T)=>new Date(T.timestamp)-new Date(c.timestamp))[0]||null}function I(f){if(!f)return 0;const m=new Date(f),T=Math.abs(new Date-m);return Math.ceil(T/(1e3*60*60*24))}const C=S(()=>{if((v.task.displayStage||v.task.stage)!=="In Negotiation")return null;const f=k(v.activities);if(!f)return null;const m=I(f.timestamp);return m<1?{label:"New Offer",theme:"orange"}:m<3?{label:"Active",theme:"yellow"}:null}),w=f=>new Intl.NumberFormat("en-US").format(f);return(f,m)=>{var c,T;return s(),l("div",Ta,[e("div",Sa,[m[4]||(m[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Requested Car")],-1)),e("div",Ia,[m[3]||(m[3]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:m[0]||(m[0]=P=>f.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},u(t.task.assignee),1)])]),e("div",Aa,[e("div",Da,[e("span",{class:O(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:O(["px-2 py-1 rounded text-xs font-medium border",a.value])},u(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(s(),B(A(Ce),{key:0,text:t.task.deliverySubstatus,size:"small",theme:o.value},null,8,["text","theme"])):p("",!0),C.value?(s(),B(A(Ce),{key:1,text:C.value.label,size:"small",theme:C.value.theme},null,8,["text","theme"])):p("",!0)]),d.value?(s(),l("div",qa,[e("div",Ea,[e("div",La,[r.value?(s(),l("img",{key:0,src:r.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Oa)):(s(),l("i",Ma))]),e("div",ja,[e("div",Na,u(y.value)+" "+u(h.value)+" ("+u(g.value)+")",1),e("div",Va,[b.value!==void 0&&b.value!==null?(s(),l("div",Ba,[m[5]||(m[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+u(b.value)+" days) ",1)])):(s(),l("div",Ra,[...m[6]||(m[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])]))])]),i.value?(s(),l("div",Fa,[m[7]||(m[7]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",Ua,"€ "+u(w(i.value)),1)])):p("",!0)]),e("div",Pa,[E(A(Y),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:m[1]||(m[1]=P=>f.$emit("add-requested-car")),class:"text-fluid-xs"},null,8,["label"])])])):(s(),l("div",za,[m[8]||(m[8]=e("i",{class:"fa-solid fa-car text-4xl text-sub mb-3"},null,-1)),m[9]||(m[9]=e("p",{class:"text-fluid-sm text-body mb-4"},"No requested car added yet",-1)),E(A(Y),{label:"+ Add or update",variant:"outline",size:"small",onClick:m[2]||(m[2]=P=>f.$emit("add-requested-car"))})])),e("div",Wa,[t.task.source?(s(),l("div",Ha,[m[10]||(m[10]=e("span",{class:"text-sub"},"Source",-1)),e("span",Ya,u(t.task.source),1)])):p("",!0),t.task.requestType||(c=t.task.requestedCar)!=null&&c.requestType?(s(),l("div",Qa,[m[11]||(m[11]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",Ka,u(t.task.requestType||((T=t.task.requestedCar)==null?void 0:T.requestType)),1)])):p("",!0),n.value?(s(),l("div",Ga,[m[12]||(m[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",Ja,[e("p",Xa,u(n.value),1)])])):p("",!0)])])])}}},Za={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},_a={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},el={class:"flex items-center gap-2"},tl={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},sl={class:"bg-white rounded-lg p-3 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},al={key:0,class:"text-center py-6 text-sub"},ll={key:1,class:"space-y-2 overflow-y-auto flex-1"},nl=["onClick"],il={class:"flex items-start justify-between gap-2"},ol={class:"flex-1 min-w-0"},rl={class:"flex items-center gap-2 mb-1 flex-wrap"},dl={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-sub"},ul={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},cl={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-sub"},ml={key:1,class:"flex items-center gap-1 text-xs text-sub"},fl={key:2,class:"flex items-center gap-1 text-xs text-sub"},pl={class:"truncate max-w-[150px]"},bl={key:3,class:"flex items-center gap-1 text-xs"},vl={class:"font-bold text-heading"},yl={key:2,class:"text-center py-8 text-sub"},ut={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const v=t,d=ce(),y=It(),h=Pt(),g=j(!1),r=j([]),i=j([]),b=S(()=>{var w;return v.task.customerId||((w=v.task.customer)==null?void 0:w.id)||null}),n=async()=>{if(b.value){g.value=!0;try{await Promise.all([y.fetchLeads(),h.fetchOpportunities()]),r.value=y.leads||[],i.value=h.opportunities||[]}catch(w){console.error("Error fetching related tasks:",w)}finally{g.value=!1}}},a=S(()=>{if(!b.value)return[];const w=[];return r.value.forEach(f=>{f.customerId===b.value&&!(f.id===v.task.id&&v.entityType==="lead")&&w.push({...f,type:"lead"})}),i.value.forEach(f=>{f.customerId===b.value&&!(f.id===v.task.id&&v.entityType==="opportunity")&&w.push({...f,type:"opportunity"})}),w.sort((f,m)=>{const c=new Date(f.createdAt||0);return new Date(m.createdAt||0)-c})}),o=w=>{const f=w.requestedCar||w.vehicle;return f&&f.brand&&f.model?`${f.brand} ${f.model}`:null},k=w=>w?new Intl.NumberFormat("en-US").format(w):"0",I=w=>{if(!w)return"";const f=new Date(w),c=new Date-f,T=Math.floor(c/(1e3*60*60*24));return T===0?"Today":T===1?"Yesterday":T<7?`${T} days ago`:T<30?`${Math.floor(T/7)} weeks ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},C=w=>{d.push({path:`/tasks/${w.id}`,query:{type:w.type}})};return se(()=>v.task.id,()=>{n()},{immediate:!0}),we(()=>{n()}),(w,f)=>(s(),l("div",Za,[e("div",_a,[e("div",el,[f[0]||(f[0]=e("i",{class:"fa-solid fa-list text-heading text-xs"},null,-1)),f[1]||(f[1]=e("h2",{class:"text-fluid-xs font-medium text-heading"},"Other Tasks for This Customer",-1)),a.value.length>0?(s(),l("span",tl,u(a.value.length),1)):p("",!0)])]),e("div",sl,[g.value?(s(),l("div",al,[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):a.value.length>0?(s(),l("div",ll,[(s(!0),l(U,null,W(a.value,m=>(s(),l("div",{key:`${m.type}-${m.id}`,class:"flex flex-col p-2 border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors cursor-pointer group",onClick:c=>C(m)},[e("div",il,[e("div",ol,[e("div",rl,[e("span",{class:O(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",m.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(m.type==="lead"?"Lead":"Opp"),3),e("span",{class:O(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",A(Ye)(m.displayStage||m.stage,m.type)])},u(m.displayStage||m.stage),3),m.createdAt?(s(),l("div",dl,[e("span",null,u(I(m.createdAt)),1)])):p("",!0)]),e("div",ul,[m.createdAt?(s(),l("div",cl,[f[3]||(f[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,u(I(m.createdAt)),1)])):p("",!0),m.assignee?(s(),l("div",ml,[f[4]||(f[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,u(m.assignee),1)])):p("",!0),o(m)?(s(),l("div",fl,[f[5]||(f[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",pl,u(o(m)),1)])):p("",!0),m.type==="opportunity"&&m.value?(s(),l("div",bl,[f[6]||(f[6]=e("i",{class:"fa-solid fa-tag text-sub opacity-70"},null,-1)),e("span",vl,"€ "+u(k(m.value)),1)])):p("",!0)])]),f[7]||(f[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,nl))),128))])):(s(),l("div",yl,[...f[8]||(f[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},xl={key:0,class:"flex-grow border-t border"},gl={key:0,class:"ml-1.5 text-body"},hl={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},kl={key:1,class:"flex-grow border-t border"},ct={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:v}){const d=t,y=v,h=j(!1),g={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},r=S(()=>{if(!d.activeTab||d.activeTab==="overview")return d.actions.filter(w=>!g[w]);const C=Object.entries(g).filter(([,w])=>w===d.activeTab).map(([w])=>w);return d.actions.filter(w=>C.includes(w))}),i=S(()=>d.activeTab==="communication"?!0:r.value.length===1),b=S(()=>{if(d.activeTab==="communication")return"add communication";if(!i.value||r.value.length!==1)return"";const C=r.value[0];return{note:"add note",attachment:"add attachment"}[C]||""}),n=S(()=>d.activeTab==="communication"?!1:r.value.length>1),a=S(()=>{const C={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return r.value.map(w=>({key:w,label:C[w]||w,onClick:()=>k(w)}))}),o=S(()=>{if(d.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const C="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return i.value?`${C} px-4 py-2 h-9`:`${C} w-9 h-9`});S(()=>r.value.some(C=>["email","whatsapp","sms"].includes(C))),S(()=>r.value.some(C=>["addVehicle","configureVehicle"].includes(C))),S(()=>r.value.some(C=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(C)));const k=C=>{h.value=!1,y("action",C)},I=()=>{if(d.activeTab==="communication"){k("call");return}i.value&&r.value.length===1?k(r.value[0]):h.value=!h.value};return(C,w)=>{const f=We("click-outside");return t.show?(s(),l("div",{key:0,class:O(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?p("",!0):(s(),l("div",xl)),e("div",{class:O(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:ee(I,["stop"]),class:O(o.value)},[w[0]||(w[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),i.value?(s(),l("span",gl,u(b.value),1)):p("",!0)],2),h.value&&n.value?M((s(),l("div",hl,[E(A(He),{items:a.value,className:"w-48"},null,8,["items"])])),[[f,()=>h.value=!1]]):p("",!0)],2),t.inline?p("",!0):(s(),l("div",kl))],2)):p("",!0)}}},wl={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},$l={class:"flex items-start gap-3"},Cl={class:"flex-1 min-w-0"},Tl={class:"font-bold text-sm text-heading mb-2"},Sl={class:"space-y-1.5 text-xs text-gray-600"},Il={class:"flex items-center gap-2"},Al={class:"flex items-center gap-2"},Dl={class:"flex items-center gap-2"},ql={key:0,class:"mt-2"},El={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const v=t,d=S(()=>v.appointmentData.date?new Date(v.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),y=S(()=>v.appointmentData.time?v.appointmentData.time:""),h=g=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[g==null?void 0:g.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(g,r)=>(s(),l("div",wl,[e("div",$l,[r[3]||(r[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Cl,[e("h4",Tl,u(t.appointmentData.type),1),e("div",Sl,[e("div",Il,[r[0]||(r[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,u(d.value),1)]),e("div",Al,[r[1]||(r[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,u(y.value),1)]),e("div",Dl,[r[2]||(r[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,u(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),l("div",ql,[e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",h(t.appointmentData.status)])},u(t.appointmentData.status),3)])):p("",!0)])])]))}},Ll={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Ol={class:"flex-1"},Ml={class:"flex items-center gap-2 mb-1"},jl={class:"text-meta-bold text-heading"},Nl={class:"text-meta"},Vl={class:"text-meta"},Bl={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},Rl={class:"ml-auto relative"},Fl={key:0,class:"absolute right-0 top-full mt-1 z-10"},Ul={key:0,class:"text-content text-body"},Pl={key:1,class:"text-content text-body flex items-center gap-2"},zl={key:2,class:"mt-2"},Wl={key:0},Hl={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},Yl={key:0},Ql={class:"text-content font-bold text-heading"},Kl={key:0,class:"text-meta mt-0.5"},Gl={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},Jl={key:0},Xl={key:1},Zl={key:2},_l={key:3},en={key:4},tn={key:1},sn={class:"text-content font-bold text-heading mb-2"},an={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},ln={key:0},nn={class:"text-body font-medium ml-1"},on={key:1},rn={class:"text-body font-medium ml-1"},dn={key:2},un={class:"text-body font-medium ml-1"},cn={key:3},mn={class:"text-body font-medium ml-1"},fn={key:4},pn={class:"text-body font-medium ml-1"},bn={key:5},vn={class:"text-body font-medium ml-1"},yn={key:2,class:"flex items-center gap-3"},xn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},gn=["src"],hn={class:"flex-1"},kn={class:"text-content font-bold text-heading"},wn={class:"text-meta"},$n={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Cn={key:3,class:"flex items-center gap-3"},Tn={class:"flex-1"},Sn={class:"text-content font-bold text-heading"},In={class:"text-meta"},An={key:0,class:"text-meta mt-1"},Dn={key:1,class:"text-meta mt-1"},qn={key:4},En={class:"text-content font-bold text-heading mb-2"},Ln={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},On={key:0},Mn={class:"text-body font-medium ml-1"},jn={key:1},Nn={class:"text-body font-medium ml-1"},Vn={key:2},Bn={class:"text-body font-medium ml-1"},Rn={key:3},Fn={class:"text-body font-medium ml-1"},Un={key:4},Pn={class:"text-body font-medium ml-1"},zn={key:5},Wn={class:"text-body font-medium ml-1"},Hn={key:0,class:"flex flex-wrap gap-2 mt-2"},Yn={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Qn={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},Kn={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},Pe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:v}){const d=t,y=v,h=j(!1),g=S(()=>[{key:"edit",label:"Edit",onClick:o},{key:"delete",label:"Delete",onClick:k}]),r=I=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[I]||"fa-solid fa-circle",i=I=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[I]||"bg-surfaceSecondary text-body border",b=I=>{if(!I)return"Just now";const C=new Date(I),f=new Date-C,m=Math.floor(f/6e4),c=Math.floor(m/60),T=Math.floor(c/24);return m<1?"Just now":m<60?`${m} minutes ago`:c<24?`${c} hours ago`:T===1?"Yesterday":T<7?`${T} days ago`:C.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},n=I=>I?new Intl.NumberFormat("en-US").format(I):"0",a=I=>I?new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",o=()=>{h.value=!1,y("edit",d.item)},k=()=>{h.value=!1,confirm("Are you sure you want to delete this item?")&&y("delete",d.item)};return(I,C)=>{const w=We("click-outside");return s(),l("div",Ll,[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",i(t.item.type)])},[e("i",{class:O([r(t.item.type),"text-sm"])},null,2)],2),e("div",Ol,[e("div",Ml,[e("span",jl,u(t.customerInitials),1),e("span",Nl,u(t.item.action||"added"),1),e("span",Vl,"• "+u(b(t.item.timestamp)),1),t.item.autoDetected?(s(),l("span",Bl,"Auto-detected")):p("",!0),e("div",Rl,[e("button",{onClick:C[0]||(C[0]=ee(f=>h.value=!h.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...C[1]||(C[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),h.value?M((s(),l("div",Fl,[E(A(He),{items:g.value,className:"w-32"},null,8,["items"])])),[[w,()=>h.value=!1]]):p("",!0)])]),t.item.content?(s(),l("div",Ul,u(t.item.content),1)):p("",!0),t.item.fileName?(s(),l("div",Pl,[C[2]||(C[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,u(t.item.fileName),1)])):p("",!0),t.item.data?(s(),l("div",zl,[t.item.type==="appointment"?(s(),l("div",Wl,[E(El,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),l("div",Hl,[t.item.type==="tradein"?(s(),l("div",Yl,[e("h4",Ql,u(t.item.data.brand)+" "+u(t.item.data.model),1),t.item.data.version?(s(),l("p",Kl,u(t.item.data.version),1)):p("",!0),e("div",Gl,[t.item.data.year?(s(),l("div",Jl,[C[3]||(C[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(u(t.item.data.year),1)])):p("",!0),t.item.data.km?(s(),l("div",Xl,[C[4]||(C[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(u(t.item.data.km)+" km ",1)])):p("",!0),t.item.data.plate?(s(),l("div",Zl,[C[5]||(C[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(u(t.item.data.plate),1)])):p("",!0),t.item.data.date?(s(),l("div",_l,[C[6]||(C[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(u(a(t.item.data.date)),1)])):p("",!0),t.item.data.class?(s(),l("div",en,[C[7]||(C[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(u(t.item.data.class),1)])):p("",!0)])])):t.item.type==="financing"?(s(),l("div",tn,[e("h4",sn,u(t.item.data.product),1),e("div",an,[t.item.data.provider?(s(),l("div",ln,[C[8]||(C[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",nn,u(t.item.data.provider),1)])):p("",!0),t.item.data.total?(s(),l("div",on,[C[9]||(C[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",rn,"€"+u(n(t.item.data.total)),1)])):p("",!0),t.item.data.monthly?(s(),l("div",dn,[C[10]||(C[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",un,"€"+u(n(t.item.data.monthly)),1)])):p("",!0),t.item.data.deposit?(s(),l("div",cn,[C[11]||(C[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",mn,"€"+u(n(t.item.data.deposit)),1)])):p("",!0),t.item.data.startDate?(s(),l("div",fn,[C[12]||(C[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",pn,u(a(t.item.data.startDate)),1)])):p("",!0),t.item.data.expDate?(s(),l("div",bn,[C[13]||(C[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",vn,u(a(t.item.data.expDate)),1)])):p("",!0)])])):t.item.type==="offer"?(s(),l("div",yn,[t.item.data.image?(s(),l("div",xn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,gn)])):p("",!0),e("div",hn,[e("h4",kn,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",wn,"€ "+u(n(t.item.data.price)),1)]),t.item.data.isMainOffer?(s(),l("span",$n,"Main Offer")):p("",!0)])):t.item.type==="purchase"?(s(),l("div",Cn,[e("div",Tn,[e("h4",Sn,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",In,"€ "+u(n(t.item.data.price)),1),t.item.data.purchaseDate?(s(),l("p",An,"Purchased: "+u(a(t.item.data.purchaseDate)),1)):p("",!0),t.item.data.notes?(s(),l("p",Dn,u(t.item.data.notes),1)):p("",!0)])])):t.item.type==="purchase-method"?(s(),l("div",qn,[e("h4",En,u(t.item.data.typeLabel||t.item.data.type),1),e("div",Ln,[t.item.data.monthlyInstalment?(s(),l("div",On,[C[14]||(C[14]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Mn,"€"+u(n(t.item.data.monthlyInstalment)),1)])):p("",!0),t.item.data.duration?(s(),l("div",jn,[C[15]||(C[15]=e("span",{class:"text-gray-500"},"Duration:",-1)),e("span",Nn,u(t.item.data.duration)+" months",1)])):p("",!0),t.item.data.downPayment?(s(),l("div",Vn,[C[16]||(C[16]=e("span",{class:"text-gray-500"},"Down Payment:",-1)),e("span",Bn,"€"+u(n(t.item.data.downPayment)),1)])):p("",!0),t.item.data.interestRate?(s(),l("div",Rn,[C[17]||(C[17]=e("span",{class:"text-gray-500"},"Interest Rate:",-1)),e("span",Fn,u(t.item.data.interestRate)+"%",1)])):p("",!0),t.item.data.mileageLimit?(s(),l("div",Un,[C[18]||(C[18]=e("span",{class:"text-gray-500"},"Mileage Limit:",-1)),e("span",Pn,u(n(t.item.data.mileageLimit))+" km/year",1)])):p("",!0),t.item.data.customerType?(s(),l("div",zn,[C[19]||(C[19]=e("span",{class:"text-gray-500"},"Customer Type:",-1)),e("span",Wn,u(t.item.data.customerType),1)])):p("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(s(),l("div",Hn,[t.item.data.insuranceIncluded?(s(),l("span",Yn,"Insurance")):p("",!0),t.item.data.maintenanceIncluded?(s(),l("span",Qn,"Maintenance")):p("",!0),t.item.data.registrationTaxesIncluded?(s(),l("span",Kn,"Registration/Taxes")):p("",!0)])):p("",!0)])):p("",!0)]))])):p("",!0)])])}}},Gn={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Jn={class:"flex items-center gap-3"},Xn=["title"],Zn={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},_n={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},ei={key:2,class:"font-bold text-fluid-lg text-heading"},ti={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},si={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},ai={key:1,class:"text-center py-8 text-sub relative z-10"},li={class:"text-fluid-sm"},ni={key:2,class:"space-y-6 relative z-10"},ii={key:0,class:"mb-4 pl-12"},oi={class:"text-fluid-sm font-semibold text-heading"},ri={class:"flex gap-4 relative mb-6"},di={class:"flex-1 min-w-0"},ui={class:"text-fluid-sm text-slate-700 leading-snug"},ci={class:"font-bold"},mi={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},fi={class:"text-fluid-xs text-sub mt-1"},pi={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},bi={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},vi={key:1,class:"space-y-4 relative z-10"},yi=["title"],xi={key:2,class:"text-center py-8 text-sub relative z-10"},gi={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:v}){const d=t,y=b=>{const n={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return n[b]||n.default},h=b=>{const n={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return n[b]||n.default},g=b=>{if(!b)return"";const n=new Date(b),a=new Date,o=new Date(a);return o.setDate(o.getDate()-1),n.toDateString()===a.toDateString()?"Today":n.toDateString()===o.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},r=b=>b?new Date(b).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",i=(b,n)=>{if(b===0)return!0;const a=d.activities[b-1];if(!a)return!0;const o=new Date(n.timestamp).toDateString(),k=new Date(a.timestamp).toDateString();return o!==k};return(b,n)=>t.show?(s(),l("div",{key:0,class:O(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Gn,[e("div",Jn,[t.mobileFullscreen?(s(),l("button",{key:0,onClick:n[0]||(n[0]=a=>b.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...n[2]||(n[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(s(),l("button",{key:1,onClick:n[1]||(n[1]=a=>b.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(s(),l("i",Zn)):(s(),l("i",_n))],8,Xn)):p("",!0),t.collapsed?p("",!0):(s(),l("h2",ei,u(t.title),1))])]),t.collapsed?(s(),l("div",pi,[t.activities.length>0?(s(),l("div",bi)):p("",!0),t.activities.length>0?(s(),l("div",vi,[(s(!0),l(U,null,W(t.activities,a=>(s(),l("div",{key:a.id,class:"relative"},[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",h(a.type)]),title:`${a.user} ${a.action}`},[e("i",{class:O([y(a.type),"text-fluid-xs"])},null,2)],10,yi)]))),128))])):(s(),l("div",xi,[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(s(),l("div",ti,[t.activities.length>0?(s(),l("div",si)):p("",!0),t.activities.length===0?(s(),l("div",ai,[n[3]||(n[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",li,u(t.emptyMessage),1)])):(s(),l("div",ni,[(s(!0),l(U,null,W(t.activities,(a,o)=>(s(),l(U,{key:a.id},[i(o,a)?(s(),l("div",ii,[e("h3",oi,u(g(a.timestamp)),1)])):p("",!0),e("div",ri,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",h(a.type)])},[e("i",{class:O([y(a.type),"text-fluid-sm"])},null,2)],2),e("div",di,[e("div",ui,[e("span",ci,u(a.user),1),N(" "+u(a.action),1)]),a.content?(s(),l("div",mi,u(a.content),1)):p("",!0),e("div",fi,u(r(a.timestamp)),1)])])],64))),128))]))]))],2)):p("",!0)}},hi={class:"space-y-3"},ki={class:"space-y-2"},wi={class:"flex-1"},$i={class:"text-xs text-sub uppercase"},Ci={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},mt={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:v}){const d=t,y=v,h=j(""),g=r=>{r==="copy"&&navigator.clipboard.writeText(d.phoneNumber),y("call",{type:"call",option:r,phoneNumber:d.phoneNumber,notes:h.value})};return(r,i)=>(s(),l("div",hi,[e("div",ki,[i[10]||(i[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:i[0]||(i[0]=b=>g("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[5]||(i[5]=[Te('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[1]||(i[1]=b=>g("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[6]||(i[6]=[Te('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[2]||(i[2]=b=>g("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[i[8]||(i[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",wi,[i[7]||(i[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",$i,u(t.phoneNumber),1)]),i[9]||(i[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[i[11]||(i[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),M(e("textarea",{"onUpdate:modelValue":i[3]||(i[3]=b=>h.value=b),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[R,h.value]])]),e("div",Ci,[E(A(Y),{label:"Cancel",variant:"outline",size:"small",onClick:i[4]||(i[4]=b=>r.$emit("cancel"))})])]))}},Ti={key:0,class:"space-y-4"},Si={class:"grid grid-cols-4 gap-2"},Ii=["onClick"],Ai={class:"text-xs font-bold uppercase tracking-wider"},Di={key:1,class:"space-y-4"},qi={class:"grid grid-cols-4 gap-2"},Ei=["onClick"],Li={class:"text-xs font-bold uppercase tracking-wider"},Oi={key:0},Mi={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:v}){const d=t,y=v,h=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],g=j(d.type);se(()=>d.type,a=>{a?g.value=a:g.value=null}),se(()=>d.taskId,()=>{g.value=null});const r=S(()=>a=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${g.value===a?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),i=a=>{y("save",{type:"communication",action:`sent via ${a.type}`,content:a.message,communicationType:a.type,template:a.template,subject:a.subject}),y("send",a)},b=a=>{y("save",{type:"communication",action:`called via ${a.option}`,content:a.notes||"Call attempt logged",communicationType:"call",callOption:a.option}),y("send",{type:"call",option:a.option,phoneNumber:a.phoneNumber,notes:a.notes})},n=()=>{g.value=null,y("cancel")};return(a,o)=>t.inline?(s(),l("div",Di,[e("div",qi,[(s(),l(U,null,W(h,k=>e("button",{key:k.id,onClick:I=>g.value=k.id,class:O(r.value(k.id))},[e("i",{class:O([k.icon,"text-sm"])},null,2),e("span",Li,u(k.label),1)],10,Ei)),64))]),g.value?(s(),l("div",Oi,[g.value==="email"?(s(),B(lt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="sms"?(s(),B(nt,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="whatsapp"?(s(),B(it,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="call"?(s(),B(mt,{key:3,"phone-number":t.phoneNumber,onCall:b,onCancel:n},null,8,["phone-number"])):p("",!0)])):p("",!0)])):(s(),l("div",Ti,[e("div",Si,[(s(),l(U,null,W(h,k=>e("button",{key:k.id,onClick:I=>g.value=k.id,class:O(r.value(k.id))},[e("i",{class:O([k.icon,"text-sm"])},null,2),e("span",Ai,u(k.label),1)],10,Ii)),64))]),e("div",null,[g.value==="email"?(s(),B(lt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="sms"?(s(),B(nt,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="whatsapp"?(s(),B(it,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:n},null,8,["initial-template","initial-message"])):g.value==="call"?(s(),B(mt,{key:3,"phone-number":t.phoneNumber,onCall:b,onCancel:n},null,8,["phone-number"])):p("",!0)])]))}},ji={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Ni={class:"flex justify-between items-center mb-4"},Vi={class:"text-fluid-sm font-semibold text-heading"},Bi={class:"flex items-center gap-3"},Ri={key:0,class:"text-fluid-sm text-slate-600"},Fi={key:1,class:"text-fluid-sm text-sub"},Ui={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},ft={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:v}){const d=t,y=v,h=j(null),g=j("");we(()=>{d.item&&(g.value=d.item.fileName||"")});const r=b=>{const n=b.target.files[0];n&&(h.value=n,g.value=n.name)},i=()=>{var b,n;!h.value&&!d.item||y("save",{id:((b=d.item)==null?void 0:b.id)||Date.now(),type:"attachment",action:d.item?"updated an attachment":"added an attachment",fileName:g.value,timestamp:((n=d.item)==null?void 0:n.timestamp)||new Date().toISOString(),isEdit:!!d.item})};return(b,n)=>(s(),l("div",ji,[n[5]||(n[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Ni,[e("h5",Vi,u(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:n[0]||(n[0]=a=>b.$emit("cancel")),class:"text-sub hover:text-body"},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[n[4]||(n[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Bi,[e("input",{type:"file",onChange:r,ref:"fileInput",class:"hidden"},null,544),E(A(Y),{label:"Choose File",variant:"outline",size:"small",onClick:n[1]||(n[1]=a=>b.$refs.fileInput.click())}),g.value?(s(),l("span",Ri,u(g.value),1)):(s(),l("span",Fi,"No file selected"))])]),e("div",Ui,[E(A(Y),{label:"Cancel",variant:"outline",size:"small",onClick:n[2]||(n[2]=a=>b.$emit("cancel"))}),E(A(Y),{label:"Save",variant:"primary",size:"small",disabled:!h.value,onClick:i},null,8,["disabled"])])]))}},Pi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},zi={key:1,class:"flex justify-between items-center mb-4"},Wi={class:"text-fluid-sm font-semibold text-heading"},Hi={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Yi=["max"],Qi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ki={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Gi={class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},Ji={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},Xi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Zi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_i={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},eo={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:v,emit:d}){const y=t,h=d,g=j(!1),r=j({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),i=j({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),b=S(()=>!!r.value.brand&&!!r.value.model&&!!r.value.year);we(()=>{y.item&&y.item.data&&(r.value={brand:y.item.data.brand||"",model:y.item.data.model||"",year:y.item.data.year||"",version:y.item.data.version||"",vin:y.item.data.vin||"",plates:y.item.data.plate||y.item.data.plates||"",fuelType:y.item.data.fuelType||"",gearType:y.item.data.gearType||"",kilometers:y.item.data.km||y.item.data.kilometers||"",registration:y.item.data.date||y.item.data.registration||""},y.item.data.tradeInPrice!==void 0&&(i.value={tradeInPrice:y.item.data.tradeInPrice||null,evaluationRangeLow:y.item.data.evaluationRangeLow||null,evaluationRangeHigh:y.item.data.evaluationRangeHigh||null,provider:y.item.data.provider||"",evaluationDate:y.item.data.evaluationDate||""},g.value=!0))});const n=()=>{var o,k;if(!b.value)return;const a={id:((o=y.item)==null?void 0:o.id)||Date.now(),type:"tradein",action:y.item?"updated a trade-in":"added a trade-in",timestamp:((k=y.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!y.item,data:{brand:r.value.brand,model:r.value.model,year:parseInt(r.value.year)||null,version:r.value.version||null,vin:r.value.vin||null,plate:r.value.plates||null,plates:r.value.plates||null,fuelType:r.value.fuelType||null,gearType:r.value.gearType||null,km:parseInt(r.value.kilometers)||0,kilometers:parseInt(r.value.kilometers)||0,date:r.value.registration||null,registration:r.value.registration||null,tradeInPrice:i.value.tradeInPrice,evaluationRangeLow:i.value.evaluationRangeLow,evaluationRangeHigh:i.value.evaluationRangeHigh,provider:i.value.provider||null,evaluationDate:i.value.evaluationDate||null}};h("save",a)};return v({submit:n,canSubmit:()=>b.value}),(a,o)=>(s(),l("div",{class:O(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?p("",!0):(s(),l("div",Pi)),t.hideHeader?p("",!0):(s(),l("div",zi,[e("h5",Wi,u(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:o[0]||(o[0]=k=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...o[18]||(o[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ee(n,["prevent"]),class:"space-y-4"},[e("div",Hi,[e("div",null,[o[19]||(o[19]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Brand "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":o[1]||(o[1]=k=>r.value.brand=k),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[R,r.value.brand]])]),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Model "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":o[2]||(o[2]=k=>r.value.model=k),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[R,r.value.model]])]),e("div",null,[o[21]||(o[21]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Year "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":o[3]||(o[3]=k=>r.value.year=k),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,Yi),[[R,r.value.year]])])]),e("div",null,[o[22]||(o[22]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Version/Trim",-1)),M(e("input",{"onUpdate:modelValue":o[4]||(o[4]=k=>r.value.version=k),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[R,r.value.version]])]),e("div",Qi,[e("div",null,[o[23]||(o[23]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"VIN",-1)),M(e("input",{"onUpdate:modelValue":o[5]||(o[5]=k=>r.value.vin=k),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[R,r.value.vin]])]),e("div",null,[o[24]||(o[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Plates",-1)),M(e("input",{"onUpdate:modelValue":o[6]||(o[6]=k=>r.value.plates=k),type:"text",placeholder:"License plate number",class:"input"},null,512),[[R,r.value.plates]])])]),e("div",Ki,[e("div",null,[o[26]||(o[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Fuel Type",-1)),M(e("select",{"onUpdate:modelValue":o[7]||(o[7]=k=>r.value.fuelType=k),class:"input"},[...o[25]||(o[25]=[Te('<option value="">Select fuel type...</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[ne,r.value.fuelType]])]),e("div",null,[o[28]||(o[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Gear Type",-1)),M(e("select",{"onUpdate:modelValue":o[8]||(o[8]=k=>r.value.gearType=k),class:"input"},[...o[27]||(o[27]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[ne,r.value.gearType]])]),e("div",null,[o[29]||(o[29]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage (km)",-1)),M(e("input",{"onUpdate:modelValue":o[9]||(o[9]=k=>r.value.kilometers=k),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[R,r.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[o[30]||(o[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Registration Year/Month",-1)),M(e("input",{"onUpdate:modelValue":o[10]||(o[10]=k=>r.value.registration=k),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[R,r.value.registration]])]),e("div",Gi,[e("button",{type:"button",onClick:o[11]||(o[11]=k=>g.value=!g.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-card"},[o[31]||(o[31]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:O(["fa-solid transition-transform duration-200 text-sub",g.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),g.value?(s(),l("div",Ji,[e("div",null,[o[32]||(o[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Trade-In Price (€)",-1)),M(e("input",{"onUpdate:modelValue":o[12]||(o[12]=k=>i.value.tradeInPrice=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[R,i.value.tradeInPrice,void 0,{number:!0}]])]),e("div",Xi,[e("div",null,[o[33]||(o[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - Low (€)",-1)),M(e("input",{"onUpdate:modelValue":o[13]||(o[13]=k=>i.value.evaluationRangeLow=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[R,i.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[o[34]||(o[34]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - High (€)",-1)),M(e("input",{"onUpdate:modelValue":o[14]||(o[14]=k=>i.value.evaluationRangeHigh=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[R,i.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",Zi,[e("div",null,[o[36]||(o[36]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Provider",-1)),M(e("select",{"onUpdate:modelValue":o[15]||(o[15]=k=>i.value.provider=k),class:"input"},[...o[35]||(o[35]=[Te('<option value="">Select provider...</option><option value="Eurotax">Eurotax</option><option value="Infocar">Infocar</option><option value="Manual">Manual</option><option value="Other">Other</option>',5)])],512),[[ne,i.value.provider]])]),e("div",null,[o[37]||(o[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Date",-1)),M(e("input",{"onUpdate:modelValue":o[16]||(o[16]=k=>i.value.evaluationDate=k),type:"date",class:"input"},null,512),[[R,i.value.evaluationDate]])])])])):p("",!0)])],32),t.hideActions?p("",!0):(s(),l("div",_i,[E(A(Y),{label:"Cancel",variant:"outline",size:"small",onClick:o[17]||(o[17]=k=>a.$emit("cancel"))}),E(A(Y),{label:"Save",variant:"primary",size:"small",disabled:!b.value,onClick:n},null,8,["disabled"])]))],2))}},to={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},so={key:1,class:"flex justify-between items-center mb-4"},ao={class:"text-fluid-sm font-semibold text-heading"},lo={class:"flex gap-2"},no=["value"],io={key:0,class:"space-y-4"},oo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ro={class:"relative"},uo={key:0,class:"text-xs text-red-600 mt-1"},co={class:"relative"},mo={key:0,class:"text-xs text-red-600 mt-1"},fo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},po=["value"],bo={key:0,class:"text-xs text-red-600 mt-1"},vo={key:0},yo={class:"relative"},xo={key:1},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ho={class:"relative"},ko={class:"relative"},wo={class:"flex items-center gap-2"},$o={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Co={class:"relative"},To={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},So={class:"flex justify-between items-center"},Io={class:"text-lg font-bold text-heading"},Ao={class:"flex flex-col gap-2"},Do={class:"flex items-center gap-2"},qo={class:"flex items-center gap-2"},Eo={key:0,class:"text-xs text-red-600 mt-1"},Lo={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Oo={class:"flex justify-between items-center"},Mo={class:"text-lg font-bold text-heading"},jo={class:"flex flex-col gap-2"},No={class:"flex items-center gap-2"},Vo={class:"flex items-center gap-2"},Bo={class:"flex items-center gap-2"},Ro={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Fo={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:v,emit:d}){const y=t,h=d,g=j({}),r=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],i=j({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),b=S(()=>{if(i.value.type!=="LEA")return 0;const m=parseFloat(i.value.fields.monthlyInstalment)||0,c=parseInt(i.value.fields.duration)||0,T=parseFloat(i.value.fields.downPayment)||0,P=parseFloat(i.value.fields.finalInstalment)||0;return m*c+T+P}),n=S(()=>{if(i.value.type!=="LTR")return 0;const m=parseFloat(i.value.fields.monthlyInstalment)||0,c=parseInt(i.value.fields.duration)||0,T=parseFloat(i.value.fields.downPayment)||0;return m*c+T}),a=m=>m==="FIN"?[12,24,36,48,60]:m==="LEA"?[24,36,48,60]:m==="LTR"?[12,24,36,48,60]:[],o=m=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[m]||m,k=m=>m?new Intl.NumberFormat("en-US").format(m):"0",I=m=>{delete g.value[m]},C=S(()=>!i.value.type||!i.value.fields.monthlyInstalment||i.value.fields.monthlyInstalment<=0||i.value.fields.downPayment===null||i.value.fields.downPayment===void 0||i.value.fields.downPayment<0||!i.value.fields.duration||i.value.fields.duration<12||i.value.fields.duration>60||i.value.type==="LTR"&&!i.value.fields.customerType?!1:Object.keys(g.value).length===0),w=()=>{i.value.type!=="FIN"&&(i.value.fields.effectiveInterestRate=null,i.value.fields.gfv=null),i.value.type!=="LEA"&&(i.value.fields.finalInstalment=null),i.value.type!=="LTR"&&(i.value.fields.customerType="",i.value.fields.registrationTaxesIncluded=!1),i.value.type!=="LEA"&&i.value.type!=="LTR"&&(i.value.fields.mileageLimit=null,i.value.fields.maintenanceIncluded=!1),g.value={}};we(()=>{y.item&&y.item.data&&(i.value={type:y.item.data.type||"",fields:{monthlyInstalment:y.item.data.monthlyInstalment||null,downPayment:y.item.data.downPayment||null,duration:y.item.data.duration||null,interestRate:y.item.data.interestRate||null,effectiveInterestRate:y.item.data.effectiveInterestRate||null,gfv:y.item.data.gfv||null,mileageLimit:y.item.data.mileageLimit||null,finalInstalment:y.item.data.finalInstalment||null,customerType:y.item.data.customerType||"",insuranceIncluded:y.item.data.insuranceIncluded||!1,maintenanceIncluded:y.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:y.item.data.registrationTaxesIncluded||!1}})});const f=()=>{var Z,X;if(!C.value)return;const m=o(i.value.type),c=i.value.fields.monthlyInstalment||0,T=i.value.fields.duration||0,P={id:((Z=y.item)==null?void 0:Z.id)||Date.now(),type:"purchase-method",action:y.item?"updated a purchase method":"added a purchase method",content:`${m}: €${k(c)}/month for ${T} months`,timestamp:((X=y.item)==null?void 0:X.timestamp)||new Date().toISOString(),isEdit:!!y.item,data:{type:i.value.type,typeLabel:m,monthlyInstalment:i.value.fields.monthlyInstalment,downPayment:i.value.fields.downPayment,duration:i.value.fields.duration,interestRate:i.value.fields.interestRate,effectiveInterestRate:i.value.fields.effectiveInterestRate,gfv:i.value.fields.gfv,mileageLimit:i.value.fields.mileageLimit,finalInstalment:i.value.fields.finalInstalment,customerType:i.value.fields.customerType,insuranceIncluded:i.value.fields.insuranceIncluded,maintenanceIncluded:i.value.fields.maintenanceIncluded,registrationTaxesIncluded:i.value.fields.registrationTaxesIncluded,totalLeasingAmount:b.value,totalRentalAmount:n.value}};h("save",P)};return v({submit:f,canSubmit:()=>C.value}),(m,c)=>(s(),l("div",{class:O(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?p("",!0):(s(),l("div",to)),t.hideHeader?p("",!0):(s(),l("div",so,[e("h5",ao,u(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:c[0]||(c[0]=T=>m.$emit("cancel")),class:"text-sub hover:text-body"},[...c[23]||(c[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ee(f,["prevent"]),class:"space-y-4"},[e("div",null,[c[24]||(c[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},[N("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",lo,[(s(),l(U,null,W(r,T=>e("label",{key:T.value,class:"flex-1 cursor-pointer"},[M(e("input",{type:"radio",value:T.value,"onUpdate:modelValue":c[1]||(c[1]=P=>i.value.type=P),class:"sr-only",onChange:w},null,40,no),[[At,i.value.type]]),e("div",{class:O(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",i.value.type===T.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},u(T.label),3)])),64))])]),i.value.type?(s(),l("div",io,[e("div",oo,[e("div",null,[c[26]||(c[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",ro,[c[25]||(c[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":c[2]||(c[2]=T=>i.value.fields.monthlyInstalment=T),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:O(["input pl-8",{"border-red-500":g.value.monthlyInstalment}]),onInput:c[3]||(c[3]=T=>I("monthlyInstalment"))},null,34),[[R,i.value.fields.monthlyInstalment,void 0,{number:!0}]])]),g.value.monthlyInstalment?(s(),l("p",uo,u(g.value.monthlyInstalment),1)):p("",!0)]),e("div",null,[c[28]||(c[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",co,[c[27]||(c[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":c[4]||(c[4]=T=>i.value.fields.downPayment=T),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:O(["input pl-8",{"border-red-500":g.value.downPayment}]),onInput:c[5]||(c[5]=T=>I("downPayment"))},null,34),[[R,i.value.fields.downPayment,void 0,{number:!0}]])]),g.value.downPayment?(s(),l("p",mo,u(g.value.downPayment),1)):p("",!0)])]),e("div",fo,[e("div",null,[c[30]||(c[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("select",{"onUpdate:modelValue":c[6]||(c[6]=T=>i.value.fields.duration=T),class:O(["input",{"border-red-500":g.value.duration}]),onChange:c[7]||(c[7]=T=>I("duration"))},[c[29]||(c[29]=e("option",{value:""},"Select duration...",-1)),(s(!0),l(U,null,W(a(i.value.type),T=>(s(),l("option",{key:T,value:T},u(T)+" months ",9,po))),128))],34),[[ne,i.value.fields.duration,void 0,{number:!0}]]),g.value.duration?(s(),l("p",bo,u(g.value.duration),1)):p("",!0)]),i.value.type==="FIN"||i.value.type==="LEA"?(s(),l("div",vo,[c[32]||(c[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Interest Rate / APR (%)",-1)),e("div",yo,[M(e("input",{"onUpdate:modelValue":c[8]||(c[8]=T=>i.value.fields.interestRate=T),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:c[9]||(c[9]=T=>I("interestRate"))},null,544),[[R,i.value.fields.interestRate,void 0,{number:!0}]]),c[31]||(c[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])])):p("",!0),i.value.type==="LEA"||i.value.type==="LTR"?(s(),l("div",xo,[c[33]||(c[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage Limit (annual km)",-1)),M(e("input",{"onUpdate:modelValue":c[10]||(c[10]=T=>i.value.fields.mileageLimit=T),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[R,i.value.fields.mileageLimit,void 0,{number:!0}]])])):p("",!0)]),i.value.type==="FIN"?(s(),l(U,{key:0},[e("div",go,[e("div",null,[c[35]||(c[35]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",ho,[M(e("input",{"onUpdate:modelValue":c[11]||(c[11]=T=>i.value.fields.effectiveInterestRate=T),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[R,i.value.fields.effectiveInterestRate,void 0,{number:!0}]]),c[34]||(c[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])]),e("div",null,[c[37]||(c[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",ko,[c[36]||(c[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":c[12]||(c[12]=T=>i.value.fields.gfv=T),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[R,i.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",wo,[M(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":c[13]||(c[13]=T=>i.value.fields.insuranceIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.insuranceIncluded]]),c[38]||(c[38]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):p("",!0),i.value.type==="LEA"?(s(),l(U,{key:1},[e("div",$o,[e("div",null,[c[40]||(c[40]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Final Instalment (€)",-1)),e("div",Co,[c[39]||(c[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":c[14]||(c[14]=T=>i.value.fields.finalInstalment=T),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[R,i.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",To,[e("div",So,[c[41]||(c[41]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Io,"€ "+u(k(b.value)),1)]),c[42]||(c[42]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Ao,[e("div",Do,[M(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":c[15]||(c[15]=T=>i.value.fields.insuranceIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.insuranceIncluded]]),c[43]||(c[43]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",qo,[M(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":c[16]||(c[16]=T=>i.value.fields.maintenanceIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.maintenanceIncluded]]),c[44]||(c[44]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):p("",!0),i.value.type==="LTR"?(s(),l(U,{key:2},[e("div",null,[c[46]||(c[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("select",{"onUpdate:modelValue":c[17]||(c[17]=T=>i.value.fields.customerType=T),class:O(["input",{"border-red-500":g.value.customerType}]),onChange:c[18]||(c[18]=T=>I("customerType"))},[...c[45]||(c[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[ne,i.value.fields.customerType]]),g.value.customerType?(s(),l("p",Eo,u(g.value.customerType),1)):p("",!0)]),e("div",Lo,[e("div",Oo,[c[47]||(c[47]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",Mo,"€ "+u(k(n.value)),1)]),c[48]||(c[48]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",jo,[e("div",No,[M(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":c[19]||(c[19]=T=>i.value.fields.insuranceIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.insuranceIncluded]]),c[49]||(c[49]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Vo,[M(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":c[20]||(c[20]=T=>i.value.fields.maintenanceIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.maintenanceIncluded]]),c[50]||(c[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Bo,[M(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":c[21]||(c[21]=T=>i.value.fields.registrationTaxesIncluded=T),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[xe,i.value.fields.registrationTaxesIncluded]]),c[51]||(c[51]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):p("",!0)])):p("",!0)],32),t.hideActions?p("",!0):(s(),l("div",Ro,[E(A(Y),{label:"Cancel",variant:"outline",size:"small",onClick:c[22]||(c[22]=T=>m.$emit("cancel"))}),E(A(Y),{label:"Save",variant:"primary",size:"small",disabled:!C.value,onClick:f},null,8,["disabled"])]))],2))}},Uo=["max"],Po={class:"relative"},zo={class:"border-t border pt-4"},Wo={key:0,class:"mt-4 space-y-4"},Ho={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:v}){const d=t,y=v,h=n=>{n||y("close")},g=j(!1),r=j({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});se(()=>d.show,n=>{var a;if(n&&((a=d.task)!=null&&a.requestedCar)){const o=d.task.requestedCar;r.value={brand:o.brand||"",model:o.model||"",year:o.year||new Date().getFullYear(),price:o.price||null,requestType:o.requestType||"Quotation",requestMessage:o.requestMessage||"",image:o.image||"",dealership:o.dealership||"",fuelType:o.fuelType||"",gearType:o.gearType||"",kilometers:o.kilometers||null}}else n&&(r.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const i=S(()=>r.value.brand.trim()&&r.value.model.trim()&&r.value.year>1900),b=()=>{if(!i.value)return;const n={brand:r.value.brand.trim(),model:r.value.model.trim(),year:r.value.year,requestType:r.value.requestType};r.value.price&&(n.price=r.value.price),r.value.requestMessage&&(n.requestMessage=r.value.requestMessage.trim()),r.value.image&&(n.image=r.value.image.trim()),r.value.dealership&&(n.dealership=r.value.dealership.trim()),r.value.fuelType&&(n.fuelType=r.value.fuelType),r.value.gearType&&(n.gearType=r.value.gearType),r.value.kilometers!==null&&(n.kilometers=r.value.kilometers),y("save",n)};return(n,a)=>(s(),B(A(Le),{open:t.show,"onUpdate:open":h},{default:F(()=>[E(A(Se),null,{default:F(()=>[E(A(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),E(A(Ae),{class:"w-full sm:max-w-2xl"},{default:F(()=>[E(A(De),null,{default:F(()=>[E(A(qe),null,{default:F(()=>{var o;return[N(u((o=t.task)!=null&&o.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("form",{onSubmit:ee(b,["prevent"]),class:"space-y-4"},[e("div",null,[a[13]||(a[13]=e("label",{class:"block label-upper mb-2"},"Brand *",-1)),M(e("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>r.value.brand=o),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"input"},null,512),[[R,r.value.brand]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block label-upper mb-2"},"Model *",-1)),M(e("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>r.value.model=o),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"input"},null,512),[[R,r.value.model]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block label-upper mb-2"},"Year *",-1)),M(e("input",{"onUpdate:modelValue":a[2]||(a[2]=o=>r.value.year=o),type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"input"},null,8,Uo),[[R,r.value.year,void 0,{number:!0}]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block label-upper mb-2"},"Price (Optional)",-1)),e("div",Po,[a[16]||(a[16]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-sub"},"€",-1)),M(e("input",{"onUpdate:modelValue":a[3]||(a[3]=o=>r.value.price=o),type:"number",min:"0",step:"1000",placeholder:"45000",class:"input pl-8"},null,512),[[R,r.value.price,void 0,{number:!0}]])])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block label-upper mb-2"},"Request Type",-1)),M(e("select",{"onUpdate:modelValue":a[4]||(a[4]=o=>r.value.requestType=o),class:"input"},[...a[18]||(a[18]=[e("option",{value:"Quotation"},"Quotation",-1),e("option",{value:"Test Drive"},"Test Drive",-1),e("option",{value:"Generic Sales"},"Generic Sales",-1)])],512),[[ne,r.value.requestType]])]),e("div",null,[a[20]||(a[20]=e("label",{class:"block label-upper mb-2"},"Request Message (Optional)",-1)),M(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=o=>r.value.requestMessage=o),rows:"4",placeholder:"Customer's message or notes about the vehicle request...",class:"input resize-none"},null,512),[[R,r.value.requestMessage]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block label-upper mb-2"},"Image URL (Optional)",-1)),M(e("input",{"onUpdate:modelValue":a[6]||(a[6]=o=>r.value.image=o),type:"url",placeholder:"https://example.com/car-image.jpg",class:"input"},null,512),[[R,r.value.image]]),a[22]||(a[22]=e("p",{class:"text-xs text-sub mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",zo,[e("button",{type:"button",onClick:a[7]||(a[7]=o=>g.value=!g.value),class:"flex items-center gap-2 text-sm font-medium text-body hover:text-heading transition-colors"},[e("i",{class:O(["fa-solid",g.value?"fa-chevron-down":"fa-chevron-right"])},null,2),a[23]||(a[23]=N(" Advanced Details (Optional) ",-1))]),g.value?(s(),l("div",Wo,[e("div",null,[a[24]||(a[24]=e("label",{class:"block label-upper mb-2"},"Dealership",-1)),M(e("input",{"onUpdate:modelValue":a[8]||(a[8]=o=>r.value.dealership=o),type:"text",placeholder:"e.g., Milano, Berlin",class:"input"},null,512),[[R,r.value.dealership]])]),e("div",null,[a[26]||(a[26]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),M(e("select",{"onUpdate:modelValue":a[9]||(a[9]=o=>r.value.fuelType=o),class:"input"},[...a[25]||(a[25]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1)])],512),[[ne,r.value.fuelType]])]),e("div",null,[a[28]||(a[28]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),M(e("select",{"onUpdate:modelValue":a[10]||(a[10]=o=>r.value.gearType=o),class:"input"},[...a[27]||(a[27]=[e("option",{value:""},"Select gear type",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1)])],512),[[ne,r.value.gearType]])]),e("div",null,[a[29]||(a[29]=e("label",{class:"block label-upper mb-2"},"Kilometers",-1)),M(e("input",{"onUpdate:modelValue":a[11]||(a[11]=o=>r.value.kilometers=o),type:"number",min:"0",placeholder:"e.g., 50000",class:"input"},null,512),[[R,r.value.kilometers,void 0,{number:!0}]])])])):p("",!0)])],32),E(A(Ee),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:F(()=>{var o;return[E(A(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[12]||(a[12]=k=>n.$emit("close"))}),E(A(Y),{label:(o=t.task)!=null&&o.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!i.value,onClick:b},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Yo={class:"p-6"},Qo={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:v}){const d=v,y=j(null),h=S(()=>{var b;return((b=y.value)==null?void 0:b.isValid)||!1}),g=()=>{var b;(b=y.value)==null||b.submit()},r=b=>{b||d("close")},i=b=>{d("save",b),d("close")};return(b,n)=>(s(),B(A(Le),{open:t.show,"onUpdate:open":r},{default:F(()=>[E(A(Se),null,{default:F(()=>[E(A(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),E(A(Ae),{class:"w-full sm:max-w-2xl p-0"},{default:F(()=>[E(A(De),{class:"p-6 pb-4 border-b border"},{default:F(()=>[E(A(qe),null,{default:F(()=>[...n[2]||(n[2]=[N("Create Offer",-1)])]),_:1}),E(A(pt),null,{default:F(()=>[...n[3]||(n[3]=[N("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Yo,[E(Ot,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:y,onSave:i,onCancel:n[0]||(n[0]=a=>b.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),E(A(Ee),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:F(()=>[E(A(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=a=>b.$emit("close"))}),E(A(Y),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!h.value,onClick:g},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ko={class:"space-y-4"},Go={key:0},Jo={class:"flex flex-wrap gap-2"},Xo=["onClick"],Zo={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:v}){const d=t,y=v,h=j(""),g=i=>{i||y("close")};se(()=>d.show,i=>{i&&(h.value="")});const r=()=>{const i=h.value.trim();i&&(d.existingTags.includes(i)||(y("add",i),h.value=""))};return(i,b)=>(s(),B(A(Le),{open:t.show,"onUpdate:open":g},{default:F(()=>[E(A(Se),null,{default:F(()=>[E(A(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),E(A(Ae),{class:"w-full sm:max-w-md"},{default:F(()=>[E(A(De),null,{default:F(()=>[E(A(qe),null,{default:F(()=>[...b[2]||(b[2]=[N("Add Tag",-1)])]),_:1})]),_:1}),e("div",Ko,[e("div",null,[b[3]||(b[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),M(e("input",{"onUpdate:modelValue":b[0]||(b[0]=n=>h.value=n),onKeyup:Dt(r,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[R,h.value]])]),t.existingTags.length>0?(s(),l("div",Go,[b[4]||(b[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Jo,[(s(!0),l(U,null,W(t.existingTags,n=>(s(),l("button",{key:n,onClick:a=>h.value=n,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},u(n),9,Xo))),128))])])):p("",!0)]),E(A(Ee),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:F(()=>[E(A(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[1]||(b[1]=n=>i.$emit("close"))}),E(A(Y),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!h.value.trim(),onClick:r},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ze={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function _o(t){if(!t)return ze.default;const v=t.toLowerCase().trim();return ze[v]||ze.default}function er({store:t,taskId:v,getTabForItemType:d,isOverviewModalAction:y}){const h=j(null),g=j(null),r=j("overview"),i=j(null),b=j([]);se(r,()=>{h.value=null,g.value=null});const n=S(()=>[...t.currentActivities.value,...b.value.filter(f=>!f.activityId)].filter(f=>{const m=d(f.type);return r.value==="overview"?m==="overview":m===r.value}).sort((f,m)=>{const c=new Date(f.timestamp||0);return new Date(m.timestamp||0)-c})),a=w=>(g.value=null,r.value==="overview"&&y&&y(w)?{type:"overview-modal",action:w}:(["email","sms","whatsapp","call"].includes(w)?(i.value=w,h.value="communication"):h.value=w,null)),o=async w=>{var f;if(w.isEdit){const m=b.value.findIndex(c=>c.id===w.id);m>-1&&(b.value[m]={...b.value[m],...w}),(f=g.value)!=null&&f.activityId&&await t.updateActivity(v.value,g.value.activityId,{type:w.communicationType||w.type,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data})}else{const m=w.communicationType||w.type,c=await t.addActivity(v.value,{type:m,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data});b.value.push({id:c.id,type:m==="email"||m==="whatsapp"||m==="sms"?"communication":m,action:w.action,content:w.content,fileName:w.fileName,data:w.data,timestamp:c.timestamp,activityId:c.id})}h.value=null,g.value=null},k=()=>{h.value=null,g.value=null},I=w=>{d(w.type)&&(h.value=w.type==="email"||w.type==="whatsapp"||w.type==="sms"||w.type==="communication"?"communication":w.type,g.value=w)},C=async w=>{try{await t.deleteActivity(v.value,w)}catch(f){throw console.error("Error deleting item:",f),f}};return{activeTab:r,showInlineWidget:h,inlineWidgetType:S(()=>h.value),editingItem:g,isEditing:S(()=>g.value!==null),communicationType:i,inlineContent:b,filteredInlineContent:n,handleAddNewAction:a,handleWidgetSave:o,handleWidgetCancel:k,handleEditItem:I,handleDeleteItem:C}}const tr={class:"flex-1 flex flex-col overflow-hidden h-full"},sr={class:"bg-surface border-b border-black/5 shrink-0"},ar={key:0},lr={key:0,class:"flex-1 flex flex-row overflow-hidden"},nr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},ir={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},or={class:"mb-4"},rr={key:0},dr={key:0},ur={key:1,class:"mb-6"},cr={key:2,class:"space-y-4 mb-6 px-1"},mr={key:1},fr={key:0},pr={key:1},br={class:"relative flex items-center py-1 mb-4"},vr={class:"relative mx-4"},yr={key:0,class:"animate-fade-in relative bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6"},xr={class:"flex justify-between items-center mb-4"},gr={key:0,class:"space-y-4 mb-6 px-1"},hr={key:1,class:"flex-1 flex flex-row overflow-hidden"},kr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},wr={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},$r={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},Cr={class:"space-y-6"},Tr={key:0},Sr={key:0,class:"lg:col-span-1 space-y-6"},Ir={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Ar={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Dr={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},qr={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},Er={class:"relative flex-1 min-h-0"},Lr={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},Or={key:1,class:"text-center py-6 text-sub"},Mr={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},jr={class:"flex-1 min-w-0"},Nr={class:"text-fluid-sm text-slate-700 leading-snug"},Vr={class:"font-bold"},Br={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},Rr={class:"text-fluid-xs text-sub mt-1"},Fr={key:2},Ur={key:0,class:"space-y-4 mt-4"},Pr={key:1,class:"text-center py-12 text-sub"},Pu={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created"],setup(t,{emit:v}){const d=t,y=v,h=qt(),g=ce(),r=Yt(),i=Kt(),b=S(()=>d.task.id),n=S(()=>h.path.startsWith("/tasks")&&!h.path.startsWith("/customer")),a=j("manage"),o=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];j(!1);const k=j(null),I=j(null),C=["note","attachment","tradein","purchase"],w=S(()=>{var H,K;const x=[],$=new Set,V=["note","attachment","tradein","purchase","purchase-method","financing"];return(K=(H=d.storeAdapter)==null?void 0:H.currentActivities)!=null&&K.value&&d.storeAdapter.currentActivities.value.filter(L=>V.includes(L.type)).forEach(L=>{$.has(L.id)||($.add(L.id),x.push(L))}),d.task.activities&&d.task.activities.filter(L=>V.includes(L.type)).forEach(L=>{$.has(L.id)||($.add(L.id),x.push(L))}),pe.value.filter(Q=>V.includes(Q.type)).forEach(Q=>{$.has(Q.id)||($.add(Q.id),x.push(Q))}),x.sort((Q,L)=>{const ye=new Date(Q.timestamp||0);return new Date(L.timestamp||0)-ye})}),f=x=>{I.value=null,k.value=x},m=async x=>{try{await d.storeAdapter.addActivity(d.task.id,{type:x.type,action:x.action,content:x.content,data:x.data,fileName:x.fileName,timestamp:x.timestamp||new Date().toISOString()}),pe.value.push({id:x.id||Date.now(),type:x.type,action:x.action,content:x.content,data:x.data,fileName:x.fileName,timestamp:x.timestamp||new Date().toISOString()}),k.value=null,I.value=null}catch($){console.error("Error saving enrich data:",$)}},c=()=>{k.value=null,I.value=null},T=x=>{I.value=x,k.value=x.type==="purchase-method"?"purchase":x.type},P=async x=>{try{await d.storeAdapter.deleteActivity(d.task.id,x.id);const $=pe.value.findIndex(V=>V.id===x.id);$!==-1&&pe.value.splice($,1)}catch($){console.error("Error deleting enrich item:",$)}};S(()=>d.task.activities?d.task.activities.filter(x=>x.type==="note"):[]),S(()=>d.task.activities?d.task.activities.filter(x=>["email","call","sms","whatsapp"].includes(x.type)):[]),S(()=>d.task.activities?d.task.activities.filter(x=>x.type==="attachment"):[]),S(()=>d.task.activities?d.task.activities.filter(x=>x.type==="purchase"):[]),S(()=>d.task.activities?d.task.activities.filter(x=>x.type==="tradein"):[]);const Z=S(()=>d.type==="contact"?"bg-blue-100 text-blue-600":d.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),X=j(h.path.startsWith("/tasks")&&!h.path.startsWith("/customer"));se(()=>h.path,x=>{X.value=x.startsWith("/tasks")&&!x.startsWith("/customer")});const ae=()=>{g.push({path:`/customer/${d.task.id}`,query:{type:d.type}})};async function me(x){var tt,st;const $=((tt=d.task.customer)==null?void 0:tt.id)??d.task.id,V=x.time||"10:00",z=V.length===5?`${V}:00`:V,H=`${x.date}T${z}`,[K,Q]=V.split(":").map(Number),L=K+1,ye=`${x.date}T${String(L).padStart(2,"0")}:${String(Q||0).padStart(2,"0")}:00`;let Ve=null,Be="user",et=null,Re="",Fe=null;if(x.assignee){if(x.assignee.startsWith("user-")){const de=parseInt(x.assignee.replace("user-",""),10),ue=i.getUserById(de);Ve=de,Be="user",Re=(ue==null?void 0:ue.name)||""}else if(x.assignee.startsWith("team-")){const de=parseInt(x.assignee.replace("team-",""),10),ue=i.getTeamById(de);et=de,Be="team",Fe=(ue==null?void 0:ue.name)||"",Re=Fe}}const Ct={type:x.type,title:x.title||`${x.type} - ${x.customer||"Customer"}`,customer:x.customer||((st=d.task.customer)==null?void 0:st.name)||"",customerId:$,start:H,end:ye,assignee:Re,assigneeId:Ve,assigneeType:Be,teamId:et,team:Fe,dealership:x.dealership||"",status:"confirmed"};try{await Jt(Ct)}catch(de){console.error("Failed to create appointment:",de);return}oe.value=!1,te.value=!1,y("appointment-created")}const ie=()=>{q.value=!0},ge=async x=>{var V,z,H,K;const $=x.name;d.type==="lead"?await((z=(V=d.storeAdapter).updateLead)==null?void 0:z.call(V,d.task.id,{assignee:$,assigneeType:x.type,teamId:x.type==="team"?x.id:null})):d.type==="opportunity"&&await((K=(H=d.storeAdapter).updateOpportunity)==null?void 0:K.call(H,d.task.id,{assignee:$,assigneeType:x.type,teamId:x.type==="team"?x.id:null})),q.value=!1},fe=()=>{_.value=!0},he=async x=>{var $,V,z,H;try{d.type==="lead"?await((V=($=d.storeAdapter).updateLead)==null?void 0:V.call($,d.task.id,{requestedCar:x})):d.type==="opportunity"&&await((H=(z=d.storeAdapter).updateOpportunity)==null?void 0:H.call(z,d.task.id,{requestedCar:x})),_.value=!1}catch(K){console.error("Error saving requested car:",K)}},le=j(!1),G=j(null),oe=j(!1),te=j(!1),q=j(!1),D=j(!1),_=j(!1),re=j([]),{activeTab:J,showInlineWidget:Oe,editingItem:Me,communicationType:bt,inlineContent:pe,filteredInlineContent:$e,handleAddNewAction:vt,handleWidgetSave:ke,handleWidgetCancel:je,handleEditItem:Qe,handleDeleteItem:Ke}=er({store:d.storeAdapter,taskId:b,getTabForItemType:_o,isOverviewModalAction:x=>J.value==="overview"&&d.addNewConfig.overviewActions.includes(x)});se(()=>d.task.id,()=>{J.value="overview"}),se(J,x=>{x!=="appointments"&&(te.value=!1)});const yt=S(()=>new Date().toISOString().slice(0,10));we(async()=>{if(!n.value)try{const x=await Gt();re.value=x.dealerships||[]}catch(x){console.error("Failed to fetch calendar filter options:",x)}});const Ge=()=>{n.value?a.value="request":J.value="overview"},Ne=x=>{const $=vt(x);$&&$.modalAction&&(G.value=$.modalAction,le.value=!0)},Je=x=>{if(x==="appointment"){oe.value=!0;return}const $={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(x))G.value=x,le.value=!0;else{const V=$[x];V?(J.value=V,setTimeout(()=>{Ne(x),setTimeout(()=>{try{const z=document.querySelector(".animate-fade-in");z&&z.parentNode&&z.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Ne(x)}},be=()=>{le.value=!1,G.value=null},xt=async x=>{var $,V;try{const z=x.type==="FIN"?"Captive Financing":x.type==="LEA"?"Leasing":"Long-Term Rental",H=(($=x.fields)==null?void 0:$.monthlyInstalment)||0;await ke({type:"purchase-method",action:`added a ${z} purchase method`,content:`${z}: €${H.toLocaleString()}/month for ${((V=x.fields)==null?void 0:V.duration)||0} months`,data:{purchaseMethodId:x.id,type:x.type,...x.fields}}),be()}catch(z){console.error("Error saving purchase method:",z)}},Xe=async x=>{if(G.value==="tradein")try{const{saveTradeInVehicle:$}=Vt(),V=await $(d.type,d.task.id,x.vehicle,x.valuation||{});pe.value.push({id:V.activity.id,type:"tradein",action:"added a trade-in",vehicleId:V.vehicle.id,data:V.activity.data,timestamp:V.activity.timestamp,activityId:V.activity.id}),be()}catch($){console.error("Error saving trade-in:",$)}else G.value==="purchase"&&(await ke(x),be())},gt=S(()=>{const x=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return d.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...x.slice(1),{key:"appointments",label:"Appointments"}]:x}),ve=S(()=>[...d.storeAdapter.currentActivities.value,...pe.value]);S(()=>G.value==="financing"?"Add Financing":G.value==="tradein"?"Add Trade-in":G.value==="purchase"?"Create Purchase Offer":"");const Ze=async x=>{if(d.type==="opportunity")try{await d.storeAdapter.addVehicle(d.task.id,x.vehicleData),d.storeAdapter.loadOpportunityById&&await d.storeAdapter.loadOpportunityById(d.task.id)}catch($){console.error("Error selecting vehicle:",$)}},_e=async x=>{if(d.type==="opportunity")try{await d.storeAdapter.createOffer(d.task.id,x.offerData),d.storeAdapter.loadOpportunityById&&await d.storeAdapter.loadOpportunityById(d.task.id)}catch($){console.error("Error creating offer:",$)}},ht=async x=>{var z,H,K,Q;const $=d.task.tags||[];if($.includes(x)){D.value=!1;return}const V=[...$,x];try{if(d.type==="lead")await((H=(z=d.storeAdapter).updateLead)==null?void 0:H.call(z,d.task.id,{tags:V})),d.storeAdapter.loadLeadById&&await d.storeAdapter.loadLeadById(d.task.id);else if(d.type==="opportunity")await((Q=(K=d.storeAdapter).updateOpportunity)==null?void 0:Q.call(K,d.task.id,{tags:V})),d.storeAdapter.loadOpportunityById&&await d.storeAdapter.loadOpportunityById(d.task.id);else if(d.type==="contact"){const L=h.query.type==="account"?"account":"contact";await r.updateCustomer(d.task.id,{tags:V},L),await r.fetchCustomerById(d.task.id,L),y("tag-updated")}D.value=!1}catch(L){console.error("Error adding tag:",L)}},kt=x=>{const $={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return $[x]||$.default},wt=x=>{const $={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return $[x]||$.default},$t=x=>x?new Date(x).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(x,$)=>{var V,z,H,K,Q;return s(),l("div",tr,[e("header",sr,[n.value?p("",!0):(s(),l("div",ar,[E(ys,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":Z.value,"task-type":t.type,"customer-id":((V=t.task.customer)==null?void 0:V.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Je,onAddTag:$[0]||($[0]=L=>D.value=!0)},{"name-action":F(()=>[n.value?(s(),l("button",{key:0,onClick:ae,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...$[18]||($[18]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):p("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags"])]))]),n.value?n.value?(s(),l("div",hr,[e("div",kr,[e("div",wr,[E(rt,{modelValue:a.value,"onUpdate:modelValue":$[9]||($[9]=L=>a.value=L),tabs:o,class:"mb-6"},null,8,["modelValue"]),a.value==="manage"?(s(),l("div",$r,[e("div",Cr,[t.managementWidget?(s(),l("div",Tr,[(s(),B(at(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ve.value,onCarAdded:$[10]||($[10]=L=>x.$emit("car-added",L)),onConvertToLead:$[11]||($[11]=L=>x.$emit("convert-to-lead")),onConvertToOpportunity:$[12]||($[12]=L=>x.$emit("convert-to-opportunity")),onVehicleSelected:Ze,onCreateOffer:_e,onViewHistory:Ge},null,40,["lead","opportunity","contact","activities"]))])):p("",!0)]),t.type!=="contact"?(s(),l("div",Sr,[E(dt,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:ie,onAddRequestedCar:fe},null,8,["task","entity-type","activities"]),E(ut,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):p("",!0)])):p("",!0),a.value==="request"?(s(),l("div",Ir,[e("div",Ar,[t.type!=="contact"?(s(),B(dt,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:ie,onAddRequestedCar:fe},null,8,["task","entity-type","activities"])):p("",!0),E(Mt,{task:t.task,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,onAction:Je,onAddTag:$[13]||($[13]=L=>D.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(s(),B(ut,{key:0,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):p("",!0),e("div",Dr,[$[26]||($[26]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",qr,[e("div",Er,[ve.value.length>0?(s(),l("div",Lr)):p("",!0),ve.value.length===0?(s(),l("div",Or,[...$[25]||($[25]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(s(),l("div",Mr,[(s(!0),l(U,null,W(ve.value,L=>(s(),l("div",{key:L.id,class:"flex gap-4 relative"},[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",wt(L.type)])},[e("i",{class:O([kt(L.type),"text-fluid-sm"])},null,2)],2),e("div",jr,[e("div",Nr,[e("span",Vr,u(L.user),1),N(" "+u(L.action),1)]),L.content?(s(),l("div",Br,u(L.content),1)):p("",!0),e("div",Rr,u($t(L.timestamp)),1)])]))),128))]))])])])])):p("",!0),a.value==="data"?(s(),l("div",Fr,[E(ct,{actions:C,"active-tab":"data",onAction:f}),e("div",null,[k.value==="note"?(s(),B(ot,{key:0,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:m,onCancel:c},null,8,["item","task-type","task-id"])):p("",!0),k.value==="attachment"?(s(),B(ft,{key:1,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:m,onCancel:c},null,8,["item","task-type","task-id"])):p("",!0),k.value==="tradein"?(s(),B(eo,{key:2,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:m,onCancel:c},null,8,["item","task-type","task-id"])):p("",!0),k.value==="purchase"?(s(),B(Fo,{key:3,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:m,onCancel:c},null,8,["item","task-type","task-id"])):p("",!0)]),w.value.length>0?(s(),l("div",Ur,[(s(!0),l(U,null,W(w.value,L=>{var ye;return s(),B(Pe,{key:L.id,item:L,"task-type":t.type,"customer-initials":((ye=t.task.customer)==null?void 0:ye.initials)||"SK",onEdit:T,onDelete:P},null,8,["item","task-type","customer-initials"])}),128))])):k.value?p("",!0):(s(),l("div",Pr,[...$[27]||($[27]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-fluid-sm"},"No enrichment data yet",-1),e("p",{class:"text-fluid-xs mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):p("",!0)])])])):p("",!0):(s(),l("div",lr,[e("div",nr,[e("main",ir,[e("div",or,[E(rt,{modelValue:A(J),"onUpdate:modelValue":$[1]||($[1]=L=>Et(J)?J.value=L:null),tabs:gt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),A(J)==="overview"?(s(),l("div",rr,[t.type!=="contact"?(s(),l("div",dr,[E(Ca,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((z=t.task.requestedCar)==null?void 0:z.requestType)||"","request-message":((H=t.task.requestedCar)==null?void 0:H.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:ie},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):p("",!0),Ue(x.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(s(),l("div",ur,[(s(),B(at(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ve.value,onCarAdded:$[2]||($[2]=L=>x.$emit("car-added",L)),onConvertToLead:$[3]||($[3]=L=>x.$emit("convert-to-lead")),onConvertToOpportunity:$[4]||($[4]=L=>x.$emit("convert-to-opportunity")),onViewHistory:Ge,onVehicleSelected:Ze,onCreateOffer:_e},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),A($e).length>0?(s(),l("div",cr,[(s(!0),l(U,null,W(A($e),L=>(s(),B(Pe,{key:L.id,item:L,"task-type":t.type,"customer-initials":"SK",onEdit:A(Qe),onDelete:A(Ke)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)])):(s(),l("div",mr,[t.type==="contact"&&A(J)==="negotiations"?(s(),l("div",fr,[Ue(x.$slots,"tab-negotiations")])):t.type==="contact"&&A(J)==="appointments"?(s(),l("div",pr,[e("div",br,[$[20]||($[20]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",vr,[te.value?p("",!0):(s(),l("button",{key:0,onClick:$[5]||($[5]=ee(L=>te.value=!0,["stop"])),class:"bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-E5E7EB"},[...$[19]||($[19]=[e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1),e("span",{class:"ml-1.5 text-body"},"add appointment",-1)])]))]),$[21]||($[21]=e("div",{class:"flex-grow border-t border"},null,-1))]),te.value?(s(),l("div",yr,[$[24]||($[24]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",xr,[$[23]||($[23]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Add Appointment",-1)),e("button",{type:"button",onClick:$[6]||($[6]=L=>te.value=!1),class:"text-sub hover:text-body"},[...$[22]||($[22]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(s(),B(Wt,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":yt.value,dealerships:re.value,"show-actions":!0,"reset-trigger":te.value,onCreate:me,onCancel:$[7]||($[7]=L=>te.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):p("",!0),Ue(x.$slots,"tab-appointments")])):(s(),l(U,{key:2},[E(ct,{actions:t.addNewConfig.tabActions,"active-tab":A(J),onAction:Ne},null,8,["actions","active-tab"]),e("div",null,[A(Oe)==="communication"?(s(),B(Mi,{key:0,type:A(bt),"task-type":t.type,"task-id":t.task.id,"phone-number":((K=t.task.customer)==null?void 0:K.phone)||"",item:A(Me),onSave:A(ke),onCancel:A(je)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):p("",!0),A(J)==="data"&&A(Oe)==="note"?(s(),B(ot,{key:1,item:A(Me),"task-type":t.type,"task-id":t.task.id,onSave:A(ke),onCancel:A(je)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0),A(Oe)==="attachment"?(s(),B(ft,{key:2,item:A(Me),"task-type":t.type,"task-id":t.task.id,onSave:A(ke),onCancel:A(je)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0)]),A($e).length>0?(s(),l("div",gr,[(s(!0),l(U,null,W(A($e),L=>(s(),B(Pe,{key:L.id,item:L,"task-type":t.type,"customer-initials":"SK",onEdit:A(Qe),onDelete:A(Ke)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)],64))]))])]),E(gi,{title:"Activity summary",activities:ve.value,collapsed:X.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:$[8]||($[8]=L=>X.value=!X.value)},null,8,["activities","collapsed"])])),E(jt,{show:G.value==="financing"&&le.value,"task-type":t.type,"task-id":t.task.id,onSave:xt,onClose:be},null,8,["show","task-type","task-id"]),E(Nt,{show:G.value==="tradein"&&le.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:Xe,onClose:be},null,8,["show","task-type","task-id"]),E(Qo,{show:G.value==="purchase"&&le.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:Xe,onClose:be},null,8,["show","task-type","task-id","requested-car"]),E(zt,{show:q.value,onClose:$[14]||($[14]=L=>q.value=!1),onConfirm:ge},null,8,["show"]),E(Ho,{show:_.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:$[15]||($[15]=L=>_.value=!1),onSave:he},null,8,["show","task","task-type","task-id"]),oe.value?(s(),B(Ht,{key:2,show:oe.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:re.value,onCreate:me,onCancel:$[16]||($[16]=L=>oe.value=!1)},null,8,["show","customer","assignee","dealerships"])):p("",!0),E(Zo,{show:D.value,"existing-tags":t.task.tags||[],onClose:$[17]||($[17]=L=>D.value=!1),onAdd:ht},null,8,["show","existing-tags"])])}}},zr={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Wr={class:"px-4 py-4 flex items-center justify-between shrink-0"},Hr={class:"flex items-center gap-2"},Yr={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Qr={class:"bg-white rounded-lg p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Kr={key:0,class:"divide-y divide-gray-100"},Gr=["onClick"],Jr={class:"flex items-start justify-between gap-3"},Xr={class:"flex-1 min-w-0"},Zr={class:"flex items-center gap-2 mb-1"},_r={class:"text-xs font-semibold text-heading uppercase tracking-wider"},ed={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},td={key:0,class:"flex items-center gap-1"},sd={key:1,class:"flex items-center gap-1"},ad={key:0,class:"mt-2 space-y-1.5 border-t border-gray-50 pt-2"},ld={class:"flex items-center gap-2 min-w-0"},nd={class:"text-xs text-body font-medium truncate"},id={key:1,class:"text-center py-8 text-sub"},zu={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:v}){const d=t,y=ce(),h=n=>{if(!n)return 0;const a=new Date(n),k=Math.abs(new Date-a);return Math.ceil(k/(1e3*60*60*24))},g=n=>{const a=[];return d.allTasks&&d.allTasks.length>0&&d.allTasks.filter(k=>k.leadId===n.id).forEach(k=>{a.push({id:k.id,type:k.title||"Task",description:k.description||k.title})}),n.stage==="Open Lead"&&h(n.createdAt)>=0&&a.push({id:`lead-${n.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),a},r=n=>({LQ:"bg-orange-50 text-orange-600 border-orange-100"})[n]||"bg-surface text-body border-gray-100",i=n=>({"Open Lead":"bg-orange-50 text-orange-600 border-orange-100",Validated:"bg-blue-50 text-blue-600 border-blue-100",Contacted:"bg-blue-50 text-blue-600 border-blue-100"})[n]||"bg-surfaceSecondary text-body border-gray-100",b=n=>{const a=y.resolve({path:`/tasks/${n.id}`,query:{type:"lead"}});window.open(a.href,"_blank")};return(n,a)=>(s(),l("div",zr,[e("div",Wr,[e("div",Hr,[a[1]||(a[1]=e("i",{class:"fa-solid fa-user-circle text-heading"},null,-1)),a[2]||(a[2]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Leads",-1)),e("span",Yr,u(t.leads.length),1)]),e("button",{onClick:a[0]||(a[0]=o=>n.$emit("add-lead")),class:"text-fluid-xs text-brand-blue hover:text-brand-blue/80 font-medium flex items-center gap-1 transition-colors"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),e("div",Qr,[t.leads.length>0?(s(),l("div",Kr,[(s(!0),l(U,null,W(t.leads,o=>(s(),l("div",{key:o.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:k=>b(o)},[e("div",Jr,[e("div",Xr,[e("div",Zr,[e("span",_r,"Lead #"+u(o.id),1),e("span",{class:O(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",i(o.stage)])},u(o.stage),3)]),e("div",ed,[o.assignee?(s(),l("span",td,[a[4]||(a[4]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+u(o.assignee),1)])):p("",!0),o.requestedCar?(s(),l("span",sd,[a[5]||(a[5]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+u(o.requestedCar.brand)+" "+u(o.requestedCar.model),1)])):p("",!0)])]),a[6]||(a[6]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))]),g(o).length>0?(s(),l("div",ad,[(s(!0),l(U,null,W(g(o),k=>(s(),l("div",{key:k.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",ld,[e("span",{class:O(["text-xs px-1.5 py-0.5 rounded font-black uppercase tracking-widest border",r(k.type)])},u(k.type),3),e("span",nd,u(k.description),1)]),a[7]||(a[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):p("",!0)],8,Gr))),128))])):(s(),l("div",id,[...a[8]||(a[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))])]))}},od={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},rd={class:"px-4 py-4 flex items-center justify-between shrink-0"},dd={class:"flex items-center gap-2"},ud={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},cd={class:"bg-white rounded-lg p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},md={key:0,class:"divide-y divide-gray-100"},fd=["onClick"],pd={class:"flex items-start justify-between gap-3"},bd={class:"flex-1 min-w-0"},vd={class:"flex items-center gap-2 mb-1"},yd={class:"text-xs font-semibold text-heading uppercase tracking-wider"},xd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},gd={key:0,class:"flex items-center gap-1"},hd={key:1,class:"flex items-center gap-1"},kd={key:2,class:"flex items-center gap-1"},wd={key:0,class:"mt-2 space-y-1.5 border-t border-gray-50 pt-2"},$d={class:"flex items-center gap-2 min-w-0"},Cd={class:"text-xs text-body font-medium truncate"},Td={key:1,class:"text-center py-8 text-sub"},Wu={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:v}){const d=t,y=ce(),h=n=>{const a=[];d.allTasks&&d.allTasks.length>0&&d.allTasks.filter(w=>w.opportunityId===n.id).forEach(w=>{a.push({id:w.id,type:w.title||"Task",description:w.description||w.title})});const o=d.activities.filter(C=>C.opportunityId===n.id),k={opportunity:n,scheduledAppointment:n.scheduledAppointment||null,activities:o,hasOffers:o.some(C=>C.type==="offer")||!1,stage:n.displayStage||n.stage,deliverySubstatus:n.deliverySubstatus||null},I=Bt(k.stage,k);if(I){const C={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};a.push({id:`opp-${n.id}-${I}`,type:I,description:C[I]||I})}return a},g=n=>({OOFB:"bg-blue-50 text-blue-600 border-blue-100",UFB:"bg-purple-50 text-purple-600 border-purple-100",NFU:"bg-red-50 text-red-600 border-red-100",OFB:"bg-yellow-50 text-yellow-600 border-yellow-100",CFB:"bg-green-50 text-green-600 border-green-100",DFB:"bg-teal-50 text-teal-600 border-teal-100",NS:"bg-pink-50 text-pink-600 border-pink-100"})[n]||"bg-surface text-body border-gray-100",r=n=>new Intl.NumberFormat("en-US").format(n),i=n=>({Qualified:"bg-purple-50 text-purple-600 border-purple-100","In Negotiation":"bg-blue-50 text-blue-600 border-blue-100","Closed Won":"bg-green-50 text-green-600 border-green-100","Closed Lost":"bg-red-50 text-red-600 border-red-100"})[n]||"bg-surfaceSecondary text-body border-gray-100",b=n=>{const a=y.resolve({path:`/tasks/${n.id}`,query:{type:"opportunity"}});window.open(a.href,"_blank")};return(n,a)=>(s(),l("div",od,[e("div",rd,[e("div",dd,[a[1]||(a[1]=e("i",{class:"fa-solid fa-briefcase text-heading"},null,-1)),a[2]||(a[2]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Opportunities",-1)),e("span",ud,u(t.opportunities.length),1)]),e("button",{onClick:a[0]||(a[0]=o=>n.$emit("add-opportunity")),class:"text-fluid-xs text-brand-blue hover:text-brand-blue/80 font-medium flex items-center gap-1 transition-colors"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),e("div",cd,[t.opportunities.length>0?(s(),l("div",md,[(s(!0),l(U,null,W(t.opportunities,o=>(s(),l("div",{key:o.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:k=>b(o)},[e("div",pd,[e("div",bd,[e("div",vd,[e("span",yd,"Opp #"+u(o.id),1),e("span",{class:O(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",i(o.stage)])},u(o.displayStage||o.stage),3)]),e("div",xd,[o.assignee?(s(),l("span",gd,[a[4]||(a[4]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+u(o.assignee),1)])):p("",!0),o.value?(s(),l("span",hd,[a[5]||(a[5]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),N(" € "+u(r(o.value)),1)])):p("",!0),o.vehicle?(s(),l("span",kd,[a[6]||(a[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+u(o.vehicle.brand)+" "+u(o.vehicle.model),1)])):p("",!0)])]),a[7]||(a[7]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))]),h(o).length>0?(s(),l("div",wd,[(s(!0),l(U,null,W(h(o),k=>(s(),l("div",{key:k.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",$d,[e("span",{class:O(["text-xs px-1.5 py-0.5 rounded font-black uppercase tracking-widest border",g(k.type)])},u(k.type),3),e("span",Cd,u(k.description),1)]),a[8]||(a[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):p("",!0)],8,fd))),128))])):(s(),l("div",Td,[...a[9]||(a[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))])]))}},Sd={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Id={class:"px-4 py-4 flex items-center justify-between shrink-0"},Ad={class:"flex items-center gap-2"},Dd={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},qd={class:"bg-white rounded-lg p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ed={key:0,class:"divide-y divide-gray-100"},Ld=["onClick"],Od={class:"flex items-start justify-between gap-3"},Md={class:"flex-1 min-w-0"},jd={class:"flex items-center gap-2 mb-1 flex-wrap"},Nd={class:"text-fluid-sm font-medium text-heading truncate mb-0.5"},Vd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},Bd={class:"flex items-center gap-1"},Rd={key:0,class:"flex items-center gap-1"},Fd={key:1,class:"flex items-center gap-1"},Ud={key:1,class:"text-center py-8 text-sub"},Hu={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const v=ce(),d={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},y=b=>d[b]||b||"Appointment",h=b=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[b]||"bg-surfaceSecondary text-body border-gray-100",g=b=>{const n=(b||"").toLowerCase();return n==="confirmed"?"bg-green-50 text-green-600":n==="cancelled"?"bg-red-50 text-red-600":n==="no-show"?"bg-amber-50 text-amber-600":"bg-surfaceSecondary text-body"},r=b=>{if(!b)return"";const n=new Date(b);return n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:n.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},i=b=>{b.opportunityId?v.push({path:`/tasks/${b.opportunityId}`,query:{type:"opportunity"}}):b.leadId?v.push({path:`/tasks/${b.leadId}`,query:{type:"lead"}}):v.push({path:"/calendar"})};return(b,n)=>(s(),l("div",Sd,[e("div",Id,[e("div",Ad,[n[0]||(n[0]=e("i",{class:"fa-solid fa-calendar-days text-heading"},null,-1)),n[1]||(n[1]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Appointments",-1)),e("span",Dd,u(t.appointments.length),1)])]),e("div",qd,[t.appointments.length>0?(s(),l("div",Ed,[(s(!0),l(U,null,W(t.appointments,a=>(s(),l("div",{key:a.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:o=>i(a)},[e("div",Od,[e("div",Md,[e("div",jd,[e("span",{class:O(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",h(a.type)])},u(y(a.type)),3),a.status?(s(),l("span",{key:0,class:O(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",g(a.status)])},u(a.status),3)):p("",!0)]),e("div",Nd,u(a.title||"Appointment"),1),e("div",Vd,[e("span",Bd,[n[2]||(n[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),N(" "+u(r(a.start)),1)]),a.assignee?(s(),l("span",Rd,[n[3]||(n[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+u(a.assignee),1)])):p("",!0),a.vehicle?(s(),l("span",Fd,[n[4]||(n[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+u(a.vehicle),1)])):p("",!0)])]),n[5]||(n[5]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-chevron-right text-xs"})],-1))])],8,Ld))),128))])):(s(),l("div",Ud,[...n[6]||(n[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))])]))}},Pd={key:0,class:"mb-8"},zd={class:"relative"},Wd={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Hd=["onClick"],Yd={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},Qd=["src"],Kd={key:1,class:"fa-solid fa-car text-4xl text-sub"},Gd={class:"p-6"},Jd={class:"font-bold text-heading text-sm mb-1"},Xd={key:0,class:"text-xs text-sub mb-2"},Zd={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},_d={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:v}){const d=v,y=j(!1),h=b=>new Intl.NumberFormat("en-US").format(b),g=b=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[b]||"Car",r=b=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[b]||"bg-gray-600",i=b=>{d("car-click",b),y.value=!0};return(b,n)=>t.cars.length>0?(s(),l("div",Pd,[n[2]||(n[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),e("h3",{class:"font-bold text-heading text-sm"},"Cars")],-1)),e("div",zd,[e("div",Wd,[(s(!0),l(U,null,W(t.cars,(a,o)=>(s(),l("div",{key:a.id,class:"flex-none w-64 snap-start bg-surface border border-E5E7EB rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:k=>i(a)},[e("div",{class:O(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",r(a.type)])},u(g(a.type)),3),e("div",Yd,[a.image?(s(),l("img",{key:0,src:a.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Qd)):(s(),l("i",Kd))]),e("div",Gd,[e("h4",Jd,u(a.brand)+" "+u(a.model)+" ("+u(a.year)+")",1),a.price?(s(),l("p",Xd,"€ "+u(h(a.price)),1)):p("",!0),a.stockDays!==null&&a.stockDays!==void 0?(s(),l("div",Zd,[n[1]||(n[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+u(a.stockDays)+" days) ",1)])):p("",!0)])],8,Hd))),128))])]),E(Rt,{show:y.value,title:"Car Details",onClose:n[0]||(n[0]=a=>y.value=!1)},null,8,["show"])])):p("",!0)}},Yu=Lt(_d,[["__scopeId","data-v-30853160"]]),Qu={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:v}){const d=t,y=v,h=j(null),g=S(()=>d.type==="lead"?"Add New Lead":"Add New Opportunity"),r=S(()=>`Create a ${d.type} for ${d.contact.name}`),i=n=>{n||y("close")},b=n=>{y("save",n)};return(n,a)=>(s(),B(A(Le),{open:t.show,"onUpdate:open":i},{default:F(()=>[E(A(Se),null,{default:F(()=>[E(A(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),E(A(Ae),{class:"w-full sm:max-w-lg"},{default:F(()=>[E(A(De),null,{default:F(()=>[E(A(qe),null,{default:F(()=>[N(u(g.value),1)]),_:1}),E(A(pt),null,{default:F(()=>[N(u(r.value),1)]),_:1})]),_:1}),E(Qt,{ref_key:"formRef",ref:h,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:b},null,8,["initial-contact","force-type"]),E(A(Ee),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:F(()=>{var o,k,I,C;return[E(A(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[0]||(a[0]=w=>n.$emit("close"))}),E(A(Y),{label:(o=h.value)!=null&&o.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((k=h.value)==null?void 0:k.isSubmitting)||!((I=h.value)!=null&&I.canSubmit),onClick:(C=h.value)==null?void 0:C.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},eu={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},tu={class:"bg-white rounded-lg p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},su={class:"divide-y divide-gray-100"},au={class:"p-3"},lu={key:0,class:"text-sm text-body leading-relaxed whitespace-pre-line"},nu={key:1,class:"flex items-center gap-3 py-1 text-sub"},iu={key:0,class:"p-3"},ou={class:"flex flex-wrap gap-2"},Ku={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null}},setup(t){const v=t,d=S(()=>{if(v.preferences&&v.preferences.length>0)return v.preferences;const y=[],h=v.customerData;if(!h)return y;if(h.preferredVehicleType&&y.push({icon:"fa-solid fa-car",label:`Prefers ${h.preferredVehicleType}s`}),h.preferredChannel){const g={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};y.push({icon:g[h.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${h.preferredChannel}`})}return h.preferredContactTime&&y.push({icon:"fa-solid fa-clock",label:h.preferredContactTime}),h.budgetRange&&y.push({icon:"fa-solid fa-dollar-sign",label:h.budgetRange}),y});return(y,h)=>(s(),l("div",eu,[h[1]||(h[1]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Customer Insights")])],-1)),e("div",tu,[e("div",su,[e("div",au,[t.summary?(s(),l("p",lu,u(t.summary),1)):(s(),l("div",nu,[...h[0]||(h[0]=[e("i",{class:"fa-solid fa-circle-info text-sm opacity-20"},null,-1),e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1)])]))]),d.value&&d.value.length>0?(s(),l("div",iu,[e("div",ou,[(s(!0),l(U,null,W(d.value,(g,r)=>(s(),l("span",{key:r,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-surfaceSecondary text-heading text-xs font-semibold uppercase tracking-wider rounded border border-black/5"},[e("i",{class:O([g.icon,"text-xs text-brand-blue"])},null,2),N(" "+u(g.label),1)]))),128))])])):p("",!0)])])]))}},ru={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},du={class:"bg-white rounded-lg p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},uu={class:"divide-y divide-gray-100"},cu={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},mu={class:"flex items-center gap-3 min-w-0"},fu={class:"min-w-0"},pu={class:"text-sm text-body truncate"},bu={class:"text-xs text-sub truncate"},vu={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},yu={class:"flex items-center gap-3 min-w-0"},xu={class:"w-8 h-8 rounded bg-brand-slate/10 flex items-center justify-center shrink-0"},gu={class:"min-w-0"},hu={class:"text-sm text-body truncate"},ku={class:"text-xs text-sub truncate"},wu={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},$u={class:"flex items-center gap-3 min-w-0"},Cu={class:"min-w-0"},Tu={class:"text-sm text-body truncate"},Su={class:"text-xs text-sub truncate"},Iu={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Au={class:"flex items-center gap-3 min-w-0"},Du={class:"min-w-0"},qu={class:"text-sm text-body truncate"},Eu={class:"text-xs text-sub truncate"},Lu={key:0,class:"text-center py-6 text-sub"},Gu={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null}},setup(t){const v=t,d=ce(),y=S(()=>{const f=["email","sms","whatsapp","call"],m=v.activities.filter(c=>f.includes(c.type)).sort((c,T)=>new Date(T.timestamp)-new Date(c.timestamp));return m.length>0?m[0]:null}),h=S(()=>{const f=v.leads.filter(m=>{var c;return!m.isDisqualified&&m.status!=="Disqualified"&&!((c=m.stage)!=null&&c.includes("Closed"))});return f.length>0?f[0]:null}),g=S(()=>{if(!h.value)return null;try{return Ft({lead:h.value,displayStage:h.value.stage})}catch(f){return console.error("Error getting lead next action:",f),null}}),r=S(()=>{const f=v.opportunities.filter(m=>m.stage!=="Closed Won"&&m.stage!=="Closed Lost");return f.length>0?f[0]:null}),i=S(()=>{if(!r.value)return null;try{const f=v.activities.filter(c=>c.opportunityId===r.value.id)||[];return Ut(r.value.stage,{opportunity:r.value,scheduledAppointment:r.value.scheduledAppointment||null,activities:f,hasOffers:f.some(c=>c.type==="offer")||!1,stage:r.value.stage,deliverySubstatus:r.value.deliverySubstatus||null,formatDateTime:c=>c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(f){return console.error("Error getting opportunity next action:",f),null}}),b=f=>({email:"fa-solid fa-envelope",sms:"fa-solid fa-message",whatsapp:"fa-brands fa-whatsapp",call:"fa-solid fa-phone"})[f]||"fa-solid fa-comment",n=f=>f.type==="call"?f.content||`Call with ${f.user||"customer"}`:f.type==="email"?f.subject||f.content||"Email communication":f.type==="sms"||f.type==="whatsapp"?f.content||`${f.type.toUpperCase()} message`:f.content||"Communication",a=f=>{if(!f)return"";const m=new Date(f),c=new Date,T=Math.abs(c-m),P=Math.ceil(T/(1e3*60*60*24));return P===1?"Today":P===2?"Yesterday":P<=7?`${P-1} days ago`:m.toLocaleDateString("en-US",{month:"short",day:"numeric",year:m.getFullYear()!==c.getFullYear()?"numeric":void 0})},o=f=>{if(!f)return"";const m=new Date(f),c=new Date;if(m.toDateString()===c.toDateString())return`Today at ${m.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const P=new Date(c);return P.setDate(P.getDate()+1),m.toDateString()===P.toDateString()?`Tomorrow at ${m.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:m.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},k=()=>{var f,m;(f=v.nextAppointment)!=null&&f.opportunityId?d.push({path:`/tasks/${v.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(m=v.nextAppointment)!=null&&m.leadId?d.push({path:`/tasks/${v.nextAppointment.leadId}`,query:{type:"lead"}}):d.push({path:"/calendar"})},I=()=>{var f,m;(f=y.value)!=null&&f.opportunityId?d.push({path:`/tasks/${y.value.opportunityId}`,query:{type:"opportunity"}}):(m=y.value)!=null&&m.leadId&&d.push({path:`/tasks/${y.value.leadId}`,query:{type:"lead"}})},C=()=>{var f;(f=h.value)!=null&&f.id&&d.push({path:`/tasks/${h.value.id}`,query:{type:"lead"}})},w=()=>{var f;(f=r.value)!=null&&f.id&&d.push({path:`/tasks/${r.value.id}`,query:{type:"opportunity"}})};return(f,m)=>{var c,T,P,Z,X,ae;return s(),l("div",ru,[m[12]||(m[12]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock-rotate-left text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Recent Activities")])],-1)),e("div",du,[e("div",uu,[t.nextAppointment?(s(),l("div",cu,[e("div",mu,[m[1]||(m[1]=e("div",{class:"w-8 h-8 rounded bg-brand-blue/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar-check text-brand-blue text-sm"})],-1)),e("div",fu,[m[0]||(m[0]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",pu,u(o(t.nextAppointment.start)),1),e("div",bu,u(t.nextAppointment.title||"Appointment"),1)])]),e("button",{onClick:k,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0",title:"View Details"},[...m[2]||(m[2]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):p("",!0),y.value?(s(),l("div",vu,[e("div",yu,[e("div",xu,[e("i",{class:O([b(y.value.type),"text-brand-slate text-sm"])},null,2)]),e("div",gu,[m[3]||(m[3]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",hu,u(n(y.value)),1),e("div",ku,u(a(y.value.timestamp)),1)])]),e("button",{onClick:I,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-slate/30 text-sub hover:text-brand-slate transition-all shrink-0",title:"View Details"},[...m[4]||(m[4]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):p("",!0),h.value?(s(),l("div",wu,[e("div",$u,[m[6]||(m[6]=e("div",{class:"w-8 h-8 rounded bg-brand-dark/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-user-clock text-brand-dark text-sm"})],-1)),e("div",Cu,[m[5]||(m[5]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",Tu,u(((c=g.value)==null?void 0:c.label)||"No action defined"),1),e("div",Su,u((T=h.value.requestedCar)==null?void 0:T.brand)+" "+u((P=h.value.requestedCar)==null?void 0:P.model),1)])]),e("button",{onClick:C,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-dark/30 text-sub hover:text-brand-dark transition-all shrink-0",title:"View Details"},[...m[7]||(m[7]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):p("",!0),r.value?(s(),l("div",Iu,[e("div",Au,[m[9]||(m[9]=e("div",{class:"w-8 h-8 rounded bg-brand-blue/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-handshake text-brand-blue text-sm"})],-1)),e("div",Du,[m[8]||(m[8]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",qu,u(((Z=i.value)==null?void 0:Z.label)||"No action defined"),1),e("div",Eu,u((X=r.value.vehicle)==null?void 0:X.brand)+" "+u((ae=r.value.vehicle)==null?void 0:ae.model)+" - "+u(r.value.stage),1)])]),e("button",{onClick:w,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0",title:"View Details"},[...m[10]||(m[10]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):p("",!0)]),!t.nextAppointment&&!y.value&&!h.value&&!r.value?(s(),l("div",Lu,[...m[11]||(m[11]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No recent activities available",-1)])])):p("",!0)])])}}};export{Yu as V,Pu as _,Qu as a,Hu as b,zu as c,Wu as d,Ku as e,Gu as f};
