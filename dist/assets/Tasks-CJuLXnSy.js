import{E as Te,G as Ze,H as et,c as D,I as tt,r as q,J as De,d as S,o as w,g as N,p as te,e as p,w as de,x as K,y as T,P as pe,t as j,n as P,k as fe,_ as ne,s as R,D as W,T as se,F as ge,i as me,l as J,K as st,L as _,M as ae,N as A,u as Le,C as nt,O as at,m as lt,j as it,h as rt,z as ce,R as ke}from"./index-H5Cqf6fX.js";import{u as ot}from"./opportunities-DEbYZ9Ha.js";import{u as Ne}from"./users-C7jahJiq.js";import{L as Ce,O as Se,g as Fe,f as ut,a as ct,b as Me,c as dt,d as pt}from"./ComingSoonModal-DnKIG9sS.js";import{y as ft}from"./components-DM0tY7ch.js";import{u as gt,a as $e,T as Ie}from"./useTaskFilters-CG3S3Xc-.js";import{_ as mt}from"./ReassignUserModal-DI-WnWzN.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-1_jAZFgo.js";import"./vehicles-By7ZQa14.js";import"./sparkles-T3_ayguP.js";import"./CreateEventModal-DnaL32CW.js";import"./EditEventModal-PD1ZHOsn.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Te("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Te("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function yt(e){if(!e)return"Action Required";if(e.title)return e.title;const g=e.type||(e.customer?"opportunity":"lead"),n=Ze(e,g);if(g==="lead"){const s=(Ce[n]||Ce.New).primaryAction;if(s){const m=typeof s=="function"?s({lead:e,displayStage:n}):s;return m.label||m.title||"Follow up"}}if(g==="opportunity"){const s=(Se[n]||Se.Qualified).primaryAction;if(s){const m=typeof s=="function"?s({deliverySubstatus:e.deliverySubstatus||et(e,e.activities||[]),hasOffers:!!(e.offers&&e.offers.length>0)||!!(e.activities&&e.activities.some(y=>y.type==="offer")),scheduledAppointment:e.scheduledAppointment,formatDateTime:y=>new Date(y).toLocaleDateString()}):s;return m.label||m.title||"Update Opportunity"}}return"Action Required"}const ht={key:1,class:"absolute right-2 top-7 z-50"},vt={class:"flex flex-col min-w-0 flex-1 pr-4"},bt={class:"flex items-center gap-1 mb-0.5"},xt={class:"font-bold text-heading text-fluid-base truncate"},wt={class:"flex items-center gap-2 overflow-hidden"},kt={class:"text-sub text-fluid-sm truncate"},Ct={class:"flex flex-wrap items-center gap-2 mt-2"},St={key:1,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},$t={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(e,{emit:g}){const n=e,b=D(()=>n.item.compositeId||`${n.item.type||"task"}-${n.item.id}`||n.item.id),s=D(()=>n.selected),m=D(()=>s.value?typeof n.selectedClass=="function"?n.selectedClass(n.item):n.selectedClass:typeof n.unselectedClass=="function"?n.unselectedClass(n.item):n.unselectedClass),y=D(()=>{const i=n.item.displayStage||n.item.stage;return i?tt(i,n.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),c=D(()=>yt(n.item)),o=D(()=>{const i=n.item.nextActionDue||n.item.dueDate;if(!i)return null;const h=Fe(i);return{text:ut(i),status:h}}),u=D(()=>o.value?o.value.status.textClass.replace("text-","bg-"):""),a=q(null);return(i,h)=>{const k=De("click-outside");return w(),S("div",{ref_key:"cardRef",ref:a,onClick:h[1]||(h[1]=v=>i.$emit("select",b.value)),class:P(["bg-white rounded-xl p-4 flex items-center justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-all border group",m.value])},[e.showMenu?(w(),S("button",{key:0,onClick:h[0]||(h[0]=de(v=>i.$emit("menu-click",e.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 z-10"},[...h[2]||(h[2]=[p("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):N("",!0),e.openMenuId===e.item.id&&e.showMenu?te((w(),S("div",ht,[e.menuItems&&e.menuItems.length>0?(w(),K(T(pe),{key:0,items:e.menuItems,className:"w-40 text-xs"},null,8,["items"])):N("",!0)])),[[k,()=>i.$emit("menu-close")]]):N("",!0),p("div",vt,[p("div",bt,[p("h3",xt,j(c.value),1),o.value?(w(),S("span",{key:0,class:P(["flex items-center gap-1 text-[10px] font-bold uppercase leading-none shrink-0",o.value.status.textClass])},[p("span",{class:P(["w-1.5 h-1.5 rounded-full",u.value])},null,2),fe(" "+j(o.value.text),1)],2)):N("",!0)]),p("div",wt,[p("span",kt,j(e.getName(e.item)),1)]),p("div",Ct,[p("span",{class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",e.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},j(e.item.type==="lead"?"Lead":"Opportunity"),3),e.item.displayStage||e.item.stage?(w(),S("span",{key:0,class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",y.value])},j(e.item.displayStage||e.item.stage),3)):N("",!0),e.item.priority==="Hot"?(w(),S("span",St," Hot ")):N("",!0)])])],2)}}},It={key:0,class:"flex flex-col gap-2"},At={class:"flex items-center gap-2 flex-wrap"},Tt={class:"relative",ref:"filterContainer"},Dt={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},Lt={key:0,class:"absolute left-0 mt-2 z-50 filter-dropdown-wrapper"},Nt={key:0,class:"flex items-center gap-2 flex-wrap"},Ft=["onClick"],Mt={key:1,class:"relative",ref:"filterContainer"},Ot={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},qt={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},Bt={key:2,class:"flex items-center gap-2 flex-wrap"},Ut=["onClick"],Rt={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:"recent-first"},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(e,{emit:g}){const n=e,b=g,s=q(!1),m=()=>{s.value=!s.value},y=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],c=v=>{const $=y.find(L=>L.key===v);return $?$.label:v},o=v=>{s.value=!1;const $=[...n.activeFilters],L=$.indexOf(v);L>-1?$.splice(L,1):$.push(v),b("filter-change",$)},u=v=>{const $=[...n.activeFilters],L=$.indexOf(v);L>-1&&($.splice(L,1),b("filter-change",$))},a=D(()=>y.map(v=>({key:v.key,label:v.label,onClick:()=>o(v.key),className:n.activeFilters.includes(v.key)?"filter-item-selected":""}))),i=v=>{s.value=!1,b("sort-change",v)},h=D(()=>{const v=n.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First",onClick:()=>i("recent-first")},...v?[{key:"urgent-first",label:"Urgent first",onClick:()=>i("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>i("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>i("assigned-to-my-team")}].map(L=>({...L,className:L.key===n.sortOption?"sort-item-selected":""}))}),k=D(()=>{const v=a.value,$=h.value;return[...v,...$]});return(v,$)=>{const L=De("click-outside");return!e.buttonOnly&&!e.chipsOnly?(w(),S("div",It,[p("div",At,[p("div",Tt,[p("button",{onClick:de(m,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[$[0]||($[0]=p("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption&&e.sortOption!=="recent-first"?(w(),S("span",Dt)):N("",!0)]),R(se,{name:"dropdown"},{default:W(()=>[s.value?te((w(),S("div",Lt,[R(T(pe),{items:k.value,className:"w-56"},null,8,["items"])])),[[L,()=>s.value=!1]]):N("",!0)]),_:1})],512),e.activeFilters.length>0?(w(),S("div",Nt,[(w(!0),S(ge,null,me(e.activeFilters,U=>(w(),S("div",{key:U,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-xs font-medium text-heading border border-E5E7EB"},[p("span",null,j(c(U)),1),p("button",{onClick:z=>u(U),class:"flex items-center justify-center w-4 h-4 rounded-full hover:bg-gray-200 transition-colors text-sub hover:text-heading","aria-label":"Remove filter"},[...$[1]||($[1]=[p("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])],8,Ft)]))),128))])):N("",!0)])])):e.buttonOnly?(w(),S("div",Mt,[p("button",{onClick:de(m,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[$[2]||($[2]=p("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption&&e.sortOption!=="recent-first"?(w(),S("span",Ot)):N("",!0)]),R(se,{name:"dropdown"},{default:W(()=>[s.value?te((w(),S("div",qt,[R(T(pe),{items:k.value,className:"w-56"},null,8,["items"])])),[[L,()=>s.value=!1]]):N("",!0)]),_:1})],512)):e.chipsOnly&&e.activeFilters.length>0?(w(),S("div",Bt,[(w(!0),S(ge,null,me(e.activeFilters,U=>(w(),S("div",{key:U,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-xs font-medium text-heading border border-E5E7EB"},[p("span",null,j(c(U)),1),p("button",{onClick:z=>u(U),class:"flex items-center justify-center w-4 h-4 rounded-full hover:bg-gray-200 transition-colors text-sub hover:text-heading","aria-label":"Remove filter"},[...$[3]||($[3]=[p("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])],8,Ut)]))),128))])):N("",!0)}}},Ae=ne(Rt,[["__scopeId","data-v-af642c69"]]),Ht={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},Vt={class:"page-header shrink-0"},Et={class:"page-header-main"},Wt={class:"page-header-content"},jt={class:"page-header-title-container"},zt={class:"page-header-title"},Pt={class:"page-header-actions"},Qt={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},Gt={class:"px-5 py-3"},Kt={class:"flex items-center gap-2"},Yt={class:"relative flex-1"},Jt=["placeholder"],_t={key:0,class:"mt-2"},Xt={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:e=>e.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(e,{emit:g}){const n=e,b=g,s=q(n.initialSearchQuery),m=q(null),y=q("recent-first");J(()=>n.initialSearchQuery,a=>{s.value=a});const c=D(()=>{let a=n.items;const i=n.activeFilters.filter(k=>k==="lead"||k==="opportunity");if(i.length>0&&(a=a.filter(k=>!!(k.type&&i.includes(k.type)))),!s.value.trim())return a;const h=s.value.toLowerCase().trim();return a.filter(k=>{const v=n.getName(k).toLowerCase(),$=n.getVehicleInfo(k).toLowerCase();return v.includes(h)||$.includes(h)})}),o=a=>n.selectedId?(a.compositeId||`${a.type||"task"}-${a.id}`)===n.selectedId:!1,u=a=>{y.value=a,b("sort-change",a)};return(a,i)=>(w(),S("div",Ht,[p("header",Vt,[p("div",Et,[p("div",Wt,[p("div",jt,[p("h1",zt,j(e.title),1)]),p("div",Pt,[p("div",Qt,[p("button",{onClick:i[0]||(i[0]=h=>a.$emit("view-change","table")),class:P(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[R(T(qe),{size:14})],2),p("button",{onClick:i[1]||(i[1]=h=>a.$emit("view-change","card")),class:P(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[R(T(Oe),{size:14})],2)])])])])]),p("div",Gt,[p("div",Kt,[p("div",Yt,[i[8]||(i[8]=p("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),te(p("input",{"onUpdate:modelValue":i[2]||(i[2]=h=>s.value=h),type:"text",placeholder:e.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,Jt),[[st,s.value]])]),R(Ae,{"active-filters":e.activeFilters,"sort-option":y.value,"button-only":!0,onFilterChange:i[3]||(i[3]=h=>a.$emit("filter-change",h)),onSortChange:u},null,8,["active-filters","sort-option"])]),e.activeFilters.length>0?(w(),S("div",_t,[R(Ae,{"active-filters":e.activeFilters,"sort-option":y.value,"chips-only":!0,onFilterChange:i[4]||(i[4]=h=>a.$emit("filter-change",h)),onSortChange:u},null,8,["active-filters","sort-option"])])):N("",!0)]),p("div",{ref_key:"scrollContainer",ref:m,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(w(!0),S(ge,null,me(c.value,h=>(w(),K($t,{key:h.compositeId||`${h.type||"task"}-${h.id}`,item:h,selected:o(h),"selected-class":e.selectedClass,"unselected-class":e.unselectedClass,"show-menu":e.showMenu,"open-menu-id":e.openMenuId,getName:e.getName,getVehicleInfo:e.getVehicleInfo,"menu-items":e.getMenuItems?e.getMenuItems(h):null,onSelect:i[5]||(i[5]=k=>a.$emit("select",k)),onMenuClick:i[6]||(i[6]=k=>a.$emit("menu-click",k)),onMenuClose:i[7]||(i[7]=k=>a.$emit("menu-close"))},{location:W(({item:k})=>[_(a.$slots,"location",{item:k},void 0,!0)]),source:W(({item:k})=>[_(a.$slots,"source",{item:k},void 0,!0)]),owner:W(({item:k})=>[_(a.$slots,"owner",{item:k},void 0,!0)]),dates:W(({item:k})=>[_(a.$slots,"dates",{item:k},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},Zt=ne(Xt,[["__scopeId","data-v-48106ff7"]]);function Be(e,g=[],n,b){const s=ae(),m=s.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},y=s.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},c=es(e,g),o=ts(e,g),u=ss(e),a=ns(e),i=m.intent+m.behavioral+m.temporal,h={intent:m.intent/i*100,behavioral:m.behavioral/i*100,temporal:m.temporal/i*100},k=c/40*h.intent,v=o/35*h.behavioral,$=u/25*h.temporal,L=Math.min(100,Math.max(0,k+v+$+a));let U="COLD";return L>=y.hot?U="HOT":L>=y.warm?U="WARM":L>=y.standard&&(U="STANDARD"),{score:Math.round(L*10)/10,level:U,breakdown:{intent:Math.round(c*10)/10,behavioral:Math.round(o*10)/10,temporal:Math.round(u*10)/10,quality:Math.round(a*10)/10,total:Math.round(L*10)/10}}}function es(e,g){var b;let n=0;return(e.requestType==="Test Drive"||((b=e.scheduledAppointment)==null?void 0:b.type)==="test-drive"||g.some(s=>s.type==="test-drive"||s.type==="appointment"))&&(n=Math.max(n,40)),g.some(s=>s.type==="financing")&&(n=Math.max(n,35)),g.some(s=>s.type==="tradein")&&(n=Math.max(n,30)),(e.source==="Walk-in"||g.some(s=>{var m,y,c;return((m=s.content)==null?void 0:m.toLowerCase().includes("location"))||((y=s.content)==null?void 0:y.toLowerCase().includes("dealership"))||((c=s.content)==null?void 0:c.toLowerCase().includes("visit"))}))&&(n=Math.max(n,25)),e.requestedCar&&(e.requestedCar.requestMessage||g.some(s=>{var m,y;return((m=s.content)==null?void 0:m.toLowerCase().includes("configur"))||s.type==="attachment"&&((y=s.fileName)==null?void 0:y.toLowerCase().includes("config"))}))&&(n=Math.max(n,20)),g.some(s=>{var y;const m=((y=s.content)==null?void 0:y.toLowerCase())||"";return m.includes("compare")||m.includes("versus")||m.includes("vs")||m.includes("alternative")})&&(n=Math.max(n,15)),Math.min(n,40)}function ts(e,g){let n=0;const b=new Set(g.map(c=>{if(!c.timestamp)return null;const o=new Date(c.timestamp);return`${o.getFullYear()}-${o.getMonth()}-${o.getDate()}`}).filter(Boolean)),s=Math.min(b.size*10,35);n+=s,e.contactAttempts&&e.contactAttempts.length>1&&(n+=20);const m=g.reduce((c,o)=>{var u;return c+(((u=o.content)==null?void 0:u.length)||0)},0),y=Math.min(Math.floor(m/50),25);return n+=y,g.some(c=>{var o,u,a;return c.type==="attachment"&&(((o=c.fileName)==null?void 0:o.toLowerCase().includes("brochure"))||((u=c.fileName)==null?void 0:u.toLowerCase().includes("spec"))||((a=c.fileName)==null?void 0:a.toLowerCase().includes("pdf")))})&&(n+=15),Math.min(n,35)}function ss(e){let g=0;if(!e.createdAt)return 0;const n=new Date,b=new Date(e.createdAt),s=(n.getTime()-b.getTime())/(1e3*60*60);s<2?g+=25:s<24?g+=15:s<48?g+=5:g-=10;const m=b.getDay(),y=b.getHours();if((m===0||m===6||y<9||y>17)&&(g+=10),e.contactAttempts&&e.contactAttempts.length===3&&(g+=50),e.lastActivity){const c=new Date(e.lastActivity);(n.getTime()-c.getTime())/(1e3*60*60*24)>3&&(g+=20)}return Math.min(Math.max(g,0),25)}function ns(e){var n,b,s,m,y,c,o;let g=0;return(n=e.customer)!=null&&n.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer.email)&&(g+=10),(b=e.customer)!=null&&b.phone&&/^\+?[\d\s\-()]+$/.test(e.customer.phone)&&e.customer.phone.length>=10&&(g+=10),(s=e.customer)!=null&&s.name&&((m=e.customer)!=null&&m.email)&&((y=e.customer)!=null&&y.phone)&&((c=e.customer)!=null&&c.address)&&(g+=5),(e.isDuplicate||e.isDisqualified||!((o=e.customer)!=null&&o.name))&&(g-=20),g}function Ue(e){switch(e){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Re(e){switch(e){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function as({typeFilter:e,showTypeFilter:g,tasks:n}){return{filterDefinitions:D(()=>{const s=[];g.value&&s.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),s.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),s.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),e.value==="lead"&&s.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),s.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const m=[...new Set(n.value.map(c=>c.assignee).filter(Boolean))];m.length>0&&s.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:m.map(c=>({value:c,label:c})),aiHint:"Person assigned to the task",pinned:!0});const y=[...new Set(n.value.map(c=>{const o=c.type==="lead"?c.requestedCar:c.vehicle;return o==null?void 0:o.brand}).filter(Boolean))];return y.length>0&&s.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:y.map(c=>({value:c,label:c})),aiHint:"Car brand requested by customer"}),s.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),s})}}const ls={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},is={class:"page-header shrink-0"},rs={class:"page-header-main"},os={class:"page-header-content"},us={class:"page-header-actions"},cs={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},ds={class:"flex-1 overflow-y-auto p-4 md:p-8"},ps={class:"table-wrapper w-full"},fs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:"recent-first"},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(e,{emit:g}){const n=e,b=g,s=ae();q("");const m=q({pageIndex:0,pageSize:10}),y=q(""),c=q([]),u=q((()=>{const d=[],l=n.activeFilters.find(x=>x==="lead"||x==="opportunity");return l&&d.push({id:"type",value:l,operator:"eq"}),d})());q({}),J(()=>n.activeFilters,d=>{const l=d.find(M=>M==="lead"||M==="opportunity"),x=u.value.find(M=>M.id==="type");if(l)x?x.value=l:u.value.push({id:"type",value:l,operator:"eq"});else{const M=u.value.findIndex(V=>V.id==="type");M>-1&&u.value.splice(M,1)}},{immediate:!0});const a=D(()=>n.activeFilters.filter(d=>d==="lead"||d==="opportunity")),{filterDefinitions:i}=as({typeFilter:D(()=>a.value.length>0?a.value[0]:"all"),showTypeFilter:D(()=>a.value.length>0||n.activeFilters.length===0),tasks:D(()=>n.tasks)}),h=D(()=>n.tasks),k=d=>d.compositeId===n.currentTaskId||d.compositeId===n.highlightId,v=d=>{if(d.type==="lead")return d.requestedCar?`${d.requestedCar.brand} ${d.requestedCar.model}`:"No vehicle specified";const l=d.vehicle||d.requestedCar;return l?`${l.brand} ${l.model}`:"No vehicle specified"},$=d=>{const l=d.type==="lead"?d.requestedCar:d.vehicle;if(!l)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const x=l.stockDays!==void 0&&l.stockDays!==null;return{status:x?"In Stock":"Out of Stock",class:x?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},L=d=>{var l;return d.type==="lead"?((l=d.requestedCar)==null?void 0:l.requestType)||d.requestType||"N/A":d.requestType||"Opportunity"},U=D(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:d=>z(d.original)},cell:({row:d})=>{const l=d.original,x=l.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${x}`},l.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:d})=>{const l=d.original;return A("div",{class:"flex items-center gap-2 md:gap-3"},[A("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},l.customer.initials),A("div",{class:"min-w-0"},[A("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},l.customer.name),A("div",{class:"text-meta truncate hidden sm:block"},l.customer.phone||"N/A")])])}},{accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:d})=>{const l=d.original,x=v(l),M=$(l),V=L(l),F=l.type==="lead"?l.requestedCar:l.vehicle||l.requestedCar;if(x==="No vehicle specified")return A("span",{class:"text-meta"},"N/A");const Q=F!=null&&F.condition?F.condition.charAt(0).toUpperCase()+F.condition.slice(1).toLowerCase():null,ee=F!=null&&F.kilometers?`${F.kilometers.toLocaleString()} km`:null,le=l.quotationNumber||l.quotation||null,E=V&&V!=="N/A"&&(V!=="Quotation"||le);return A("div",{class:"flex flex-col gap-1"},[A("div",{class:"flex items-center gap-2"},[A("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),A("span",{class:"text-content font-medium text-heading truncate max-w-32"},x)]),A("div",{class:"flex items-center gap-2 flex-wrap"},[A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${M.class}`},M.status),Q&&A("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},Q),ee&&A("span",{class:"text-meta text-xs"},ee),E&&A("span",{class:"text-meta text-xs"},V)])])}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:d})=>{const l=d.original;return A("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},l.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:d})=>{const l=d.original,x=n.getOwnerInfo(l);return A("div",{class:"flex items-center gap-2"},[A("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},x.initials),A("span",{class:"text-meta truncate max-w-20"},x.name)])}},{accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:d})=>{const l=d.original;return l.createdAt?A("span",{class:"text-meta"},ct(l.createdAt)):A("span",{class:"text-meta"},"N/A")}},{accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:d})=>{var M;const x=((M=d.original.contactAttempts)==null?void 0:M.length)||0;return A("span",{class:"text-content font-medium text-heading"},x)}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:d})=>{const l=d.original,x=l.type==="lead"?l.status:l.displayStage||l.stage,M=n.getStageBadgeClass(x);return A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${M}`},x)}},...a.value.includes("lead")&&s.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:d})=>{const l=d.original;if(l.type!=="lead")return A("span",{class:"text-meta"},"â€”");let x=l.urgencyLevel;x||(x=Be(l).level);const M=Re(x),V=Ue(x);return A("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${M}`},[A("span",{},V),A("span",{},x)])}}]:[]]),z=d=>{y.value=String(d.id),b("select",d.compositeId)},X=D(()=>({class:{tr:d=>{const l="cursor-pointer hover:bg-surfaceSecondary transition-colors",x=d.original;return k(x)?`${l} bg-blue-50 border-l-4 border-l-blue-500`:l}}}));return(d,l)=>(w(),S("div",ls,[p("header",is,[p("div",rs,[p("div",os,[l[8]||(l[8]=p("div",{class:"page-header-title-container"},[p("h1",{class:"page-header-title"},"Tasks")],-1)),p("div",us,[p("div",cs,[p("button",{onClick:l[0]||(l[0]=x=>d.$emit("view-change","table")),class:P(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[R(T(qe),{size:14})],2),p("button",{onClick:l[1]||(l[1]=x=>d.$emit("view-change","card")),class:P(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[R(T(Oe),{size:14})],2)]),p("button",{onClick:l[2]||(l[2]=x=>d.$emit("toggle-closed",!e.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...l[7]||(l[7]=[p("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),p("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),p("div",ds,[p("div",ps,[R(T(ft),{data:h.value,columns:U.value,meta:X.value,onRowClick:z,columnFiltersOptions:{filterDefs:T(i)},pagination:m.value,"onUpdate:pagination":l[3]||(l[3]=x=>m.value=x),globalFilter:y.value,"onUpdate:globalFilter":l[4]||(l[4]=x=>y.value=x),sorting:c.value,"onUpdate:sorting":l[5]||(l[5]=x=>c.value=x),columnFilters:u.value,"onUpdate:columnFilters":l[6]||(l[6]=x=>u.value=x),paginationOptions:{rowCount:h.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!1}},{"empty-state":W(()=>[...l[9]||(l[9]=[p("div",{class:"empty-state"},[p("i",{class:"fa-solid fa-tasks empty-state-icon"}),p("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},gs=ne(fs,[["__scopeId","data-v-ab1eb616"]]),ms={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},ys={class:"px-4 py-3 flex items-center justify-between gap-3"},hs=["aria-label"],vs={key:0,class:"flex-1 flex items-center justify-center"},bs={key:1,class:"flex items-center gap-2"},xs={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(e,{emit:g}){const n=g,b=()=>{n("back")};return(s,m)=>e.show?(w(),S("div",ms,[p("div",ys,[p("button",{onClick:b,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":e.backLabel},[...m[0]||(m[0]=[p("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,hs),s.$slots.title?(w(),S("div",vs,[_(s.$slots,"title")])):N("",!0),s.$slots.actions?(w(),S("div",bs,[_(s.$slots,"actions")])):N("",!0)])])):N("",!0)}};function ws(){const e=a=>{if(!a)return"No deadline";const i=Fe(a);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:dt(a)},g=a=>{const i=a.type==="lead"?a.requestedCar:a.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},n=a=>a?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[a.type]||"bg-gray-50 text-gray-700":"",b=a=>{if(!a||!a.assignee)return{name:"Unassigned",initials:"?"};const i=a.assigneeInitials||a.assignee.split(" ").map(h=>h[0]).join("");return{name:a.assignee,initials:i}},s=a=>{if(!a||!a.customer||!a.customer.address)return null;const h=a.customer.address.split(",");return h.length>1&&h[h.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:e,getVehicleType:g,getVehicleTypeBadgeClass:n,getOwnerInfo:b,getCustomerCity:s,getLocationDisplay:a=>{const i=s(a),h=a.source||"Unknown";return i?`${i} â€¢ ${h}`:h},getAssigneeInitials:a=>{if(!a)return"?";const i=a.split(" ");return i.length>=2?(i[0][0]+i[i.length-1][0]).toUpperCase():a.substring(0,2).toUpperCase()},getVehicleStatusDisplay:a=>{const i=a.type==="lead"?a.requestedCar:a.vehicle;if(!i)return"No vehicle";const h=g(a),k=h?h.label:i.type||"Unknown";let v="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?v=`${(i.kilometers/1e3).toFixed(0)}k`:v=`${i.kilometers}`),v?`${k} / ${v}`:k},getTaskStatusDisplay:a=>a.type==="lead"?a.status||"Unknown":a.stage||"Unknown",getStageBadgeClass:Me,getUnselectedClass:a=>a.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function ks(){const e=Le(),g=Ne(),n=ae();return{sortTasks:(s,m)=>{if(m==="none")return[...s].sort((y,c)=>{const o=new Date(y.lastActivity||y.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-o});if(m==="urgent-first")return n.getSetting("urgencyEnabled")!==!1?[...s.map(o=>{if(o.type==="lead"&&!o.urgencyScore){const u=Be(o);return{...o,urgencyScore:u.score,urgencyLevel:u.level}}return o})].sort((o,u)=>{if(o.type==="lead"&&u.type==="lead"){const h=o.urgencyScore||0,k=u.urgencyScore||0;if(h!==k)return k-h;const v=new Date(o.createdAt||0);return new Date(u.createdAt||0)-v}if(o.type==="lead"&&u.type==="opportunity")return-1;if(o.type==="opportunity"&&u.type==="lead")return 1;if(o.priority==="Hot"&&u.priority!=="Hot")return-1;if(o.priority!=="Hot"&&u.priority==="Hot")return 1;const a=new Date(o.lastActivity||o.createdAt||0);return new Date(u.lastActivity||u.createdAt||0)-a}):[...s].sort((c,o)=>{if(c.priority==="Hot"&&o.priority!=="Hot")return-1;if(c.priority!=="Hot"&&o.priority==="Hot")return 1;const u=new Date(c.lastActivity||c.createdAt||0);return new Date(o.lastActivity||o.createdAt||0)-u});if(m==="assigned-to-me"){const y=e.currentUser.name;return[...s.filter(o=>o.assignee===y)].sort((o,u)=>{const a=new Date(o.lastActivity||o.createdAt||0);return new Date(u.lastActivity||u.createdAt||0)-a})}if(m==="assigned-to-my-team"){const y=e.currentUser;let c=[];return y.role==="manager"?c=g.users.map(u=>u.name):y.role==="salesman"?c=g.users.filter(u=>u.role==="salesman").map(u=>u.name):y.role==="operator"&&(c=g.users.filter(u=>u.role==="operator").map(u=>u.name)),[...s.filter(u=>c.includes(u.assignee))].sort((u,a)=>{const i=new Date(u.lastActivity||u.createdAt||0);return new Date(a.lastActivity||a.createdAt||0)-i})}return s}}}const Cs={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Ss={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},$s={key:0,class:"flex items-center gap-2"},Is={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},As={class:"text-gray-600 font-medium"},Ts={key:1},Ds={key:0},Ls={key:1},Ns={key:2},Fs={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Ms={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Os={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},qs={__name:"Tasks",setup(e){const g=at(),n=rt(),b=nt(),s=ot(),m=Le();Ne();const y=ae(),{getDateDisplay:c,getVehicleType:o,getVehicleTypeBadgeClass:u,getOwnerInfo:a,getCustomerCity:i,getAssigneeInitials:h,getUnselectedClass:k}=ws(),v=q(localStorage.getItem("tasksViewMode")||"table"),$=q(""),L=D(()=>g.query.highlight||null);J(v,t=>{localStorage.setItem("tasksViewMode",t)});const U=(t,f="")=>{v.value;const C=H.value;if(v.value=t,t==="card"&&f&&($.value=f),t==="table"&&C)$.value="",n.push({path:"/tasks",query:{highlight:C.compositeId}});else if(t==="card"&&L.value){const[B,r]=L.value.split("-");n.push({path:`/tasks/${r}`,query:{type:B}})}else t==="card"&&!L.value&&!H.value&&n.push({path:"/tasks"})},z=q(["lead"]),X=q("none"),d=q(!1),l=q(null);q(!1);const x=q(!1),M=q(null),V=q(!1),F=q(null),{allTasks:Q,applyFilters:ee}=gt(d),{sortTasks:le}=ks(),E=D(()=>{let t=ee(Q.value,z.value);return t=le(t,X.value),t}),H=D(()=>{if(!g.params.id)return null;const t=parseInt(g.params.id);if(isNaN(t))return null;const f=g.query.type;if(f){const O=`${f}-${t}`;return Q.value.find(Z=>Z.compositeId===O)||null}const C=z.value.filter(O=>O==="lead"||O==="opportunity"),B=C.length>0?Q.value.filter(O=>C.includes(O.type)):Q.value,r=`lead-${t}`,I=`opportunity-${t}`,G=B.find(O=>O.compositeId===r||O.compositeId===I);return G||Q.value.find(O=>O.compositeId===r||O.compositeId===I)||null});D(()=>H.value?H.value.type==="lead"?b.currentLeadActivities:s.currentOpportunityActivities:[]);const ie=$e(H),He=ie.managementWidget,Ve=ie.storeAdapter,Ee=ie.addNewConfig,We=D(()=>F.value),re=$e(We),ye=D(()=>re.managementWidget.value),he=D(()=>re.storeAdapter.value),je=D(()=>re.addNewConfig.value),ze=k;lt(()=>{b.fetchLeads(),s.fetchOpportunities();const t=g.params.id;t&&ve(t)}),J(()=>g.params.id,t=>{t&&ve(t)}),J(H,t=>{t&&(t.type==="lead"?b.fetchLeadById(t.id):s.fetchOpportunityById(t.id))},{immediate:!0}),J(F,t=>{t&&(t.type==="lead"?b.fetchLeadById(t.id):s.fetchOpportunityById(t.id))},{immediate:!0});const ve=t=>{const f=parseInt(t),C=Q.value.find(B=>B.id===f);C&&(C.type==="lead"?b.fetchLeadById(f):s.fetchOpportunityById(f))},Y=t=>{const[f,C]=t.split("-");if(v.value==="table"){const B=Q.value.find(r=>r.compositeId===t);B&&(F.value=B,V.value=!0,B.type==="lead"?b.fetchLeadById(B.id):s.fetchOpportunityById(B.id));return}v.value="card",n.push({path:`/tasks/${C}`,query:{type:f}})},oe=()=>{if(V.value){ue();return}n.push({path:"/tasks"})},ue=()=>{V.value=!1,F.value=null},Pe=t=>{if(!H.value)return;const f=E.value.findIndex(C=>{const B=H.value.compositeId||`${H.value.type}-${H.value.id}`;return(C.compositeId||`${C.type}-${C.id}`)===B});if(f!==-1){if(t==="previous"&&f>0){const C=E.value[f-1];Y(C.compositeId)}else if(t==="next"&&f<E.value.length-1){const C=E.value[f+1];Y(C.compositeId)}}},Qe=t=>{if(!F.value)return;const f=E.value.findIndex(C=>{const B=F.value.compositeId||`${F.value.type}-${F.value.id}`;return(C.compositeId||`${C.type}-${C.id}`)===B});if(f!==-1){if(t==="previous"&&f>0){const C=E.value[f-1];Y(C.compositeId)}else if(t==="next"&&f<E.value.length-1){const C=E.value[f+1];Y(C.compositeId)}}},be=t=>{l.value=l.value===t?null:t},xe=t=>{M.value=t,x.value=!0,l.value=null},we=t=>{X.value=t},Ge=async t=>{if(!M.value)return;const f=M.value,C=t.name;f.type==="lead"?await b.updateLead(f.id,{assignee:C,assigneeType:t.type,teamId:t.type==="team"?t.id:null}):f.type==="opportunity"&&await s.updateOpportunity(f.id,{assignee:C,assigneeType:t.type,teamId:t.type==="team"?t.id:null}),x.value=!1,M.value=null},Ke=async t=>{l.value=null,t.type==="lead"?await b.updateLead(t.id,{priority:"Hot"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{priority:"Hot"})},Ye=async t=>{l.value=null,t.type==="lead"?await b.updateLead(t.id,{priority:"Normal"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{priority:"Normal"})},Je=async t=>{l.value=null;const f=m.user;f&&(t.type==="lead"?await b.updateLead(t.id,{assignee:f.name,assigneeType:"user"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{assignee:f.name,assigneeType:"user"}))},_e=async t=>{if(l.value=null,t.type==="lead")try{const f=t.displayStage||t.stage||ke.NEW,C=ke.NEW,B=pt(f,C);if(B){const{updates:r,activities:I}=B(t);await b.updateLead(t.id,r);for(const G of I)await b.addActivity(t.id,G)}else await b.updateLead(t.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await b.addActivity(t.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await b.fetchLeadById(t.id)}catch(f){console.error("Failed to reopen lead:",f)}},Xe=t=>{var C;const f=[];return t.type==="lead"&&t.isDisqualified===!0&&f.push({key:"reopen",label:"Reopen Lead",onClick:()=>_e(t)}),f.push({key:"reassign",label:"Reassign",onClick:()=>xe(t)}),t.assignee!==((C=m.user)==null?void 0:C.name)&&f.push({key:"assign-me",label:"Assign to me",onClick:()=>Je(t)}),t.priority!=="Hot"?f.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Ke(t)}):f.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Ye(t)}),f};return(t,f)=>{var C,B;return w(),S("div",Cs,[R(xs,{show:!!H.value||v.value==="table"&&!!F.value,"back-label":"Back to task list",onBack:oe},null,8,["show"]),v.value==="card"?(w(),S("div",Ss,[p("div",{class:P(["flex flex-col overflow-hidden",H.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[R(Zt,{title:"Tasks",items:E.value,"selected-id":(C=H.value)==null?void 0:C.compositeId,"view-mode":v.value,"initial-search-query":$.value,onViewChange:U,"selected-class":r=>r.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":T(ze),"open-menu-id":l.value,getName:r=>{const I=r.customer;return I&&I.name?I.name:I&&!I.name&&I.email&&I.email.split("@")[0]||"Unknown"},getInitials:r=>{const I=r.customer;return I&&I.initials?I.initials:I&&I.name&&I.name.split(" ").map(O=>O[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:r=>{if(r.type==="lead"){if(!r.requestedCar)return"No vehicle specified";const O=r.requestedCar,Z=[`${O.brand} ${O.model}`];return O.kilometers!==void 0&&O.kilometers!==null&&Z.push(`${O.kilometers} km`),O.status&&Z.push(O.status),Z.join(" â€¢ ")}const I=r.vehicle||r.requestedCar;if(!I)return"No vehicle specified";const G=[`${I.brand} ${I.model}`];return I.kilometers!==void 0&&I.kilometers!==null&&G.push(`${I.kilometers} km`),I.status&&G.push(I.status),G.join(" â€¢ ")},avatarClass:r=>r.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":Xe,"show-mobile-close":!1,onSelect:Y,onMenuClick:be,onMenuClose:f[0]||(f[0]=r=>l.value=null),onClose:oe,"active-filters":z.value,onFilterChange:f[1]||(f[1]=r=>z.value=r),onSortChange:we},{badges:W(({item:r})=>[r&&r.type?(w(),K(T(ce),{key:0,text:r.type==="lead"?"Lead":"Opportunity",size:"small",theme:r.type==="lead"?"blue":"gray"},null,8,["text","theme"])):N("",!0),r&&r.type==="lead"&&T(y).getSetting("urgencyEnabled")!==!1&&r.urgencyLevel?(w(),K(T(ce),{key:1,text:`${T(Ue)(r.urgencyLevel)} ${r.urgencyLevel}`,size:"small",class:P(T(Re)(r.urgencyLevel))},null,8,["text","class"])):N("",!0),r&&r.priority==="Hot"&&(T(y).getSetting("urgencyEnabled")===!1||r.type!=="lead")?(w(),K(T(ce),{key:2,text:"HOT",size:"small",theme:"red"})):N("",!0)]),location:W(({item:r})=>[fe(j(T(i)(r)||"Unknown"),1)]),source:W(({item:r})=>{var I;return[fe(j(r.source||((I=r.customer)==null?void 0:I.source)||"Unknown"),1)]}),owner:W(({item:r})=>[r.assignee?(w(),S("div",$s,[p("div",Is,j(T(h)(r.assignee)),1),p("span",As,j(r.assignee),1)])):(w(),S("span",Ts,"Unassigned"))]),dates:W(({item:r})=>[r.type==="lead"&&r.nextActionDue?(w(),S("span",Ds,"Due: "+j(T(c)(r.nextActionDue)),1)):r.type==="opportunity"&&r.nextActionDue?(w(),S("span",Ls,"Due: "+j(T(c)(r.nextActionDue)),1)):(w(),S("span",Ns,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),H.value?(w(),K(Ie,{key:0,task:H.value,"management-widget":T(He),"store-adapter":T(Ve),"add-new-config":T(Ee),"filtered-tasks":E.value,onTaskNavigate:Pe},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0),H.value?N("",!0):(w(),S("div",Fs,[...f[6]||(f[6]=[it('<div class="flex-1 flex items-center justify-center p-8" data-v-4cfa2826><div class="text-center max-w-sm" data-v-4cfa2826><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-4cfa2826><i class="fa-solid fa-tasks text-2xl text-sub" data-v-4cfa2826></i></div><h3 class="text-content-bold mb-2" data-v-4cfa2826>No task selected</h3><p class="text-meta" data-v-4cfa2826>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):N("",!0),v.value==="table"?(w(),S("div",Ms,[R(gs,{tasks:E.value,"current-task-id":(B=F.value)==null?void 0:B.compositeId,"highlight-id":L.value,"active-filters":z.value,"sort-option":X.value,"show-closed":d.value,"show-mobile-close":!1,"open-menu-id":l.value,"get-vehicle-type":T(o),"get-vehicle-type-badge-class":T(u),"get-owner-info":T(a),"get-stage-badge-class":T(Me),"view-mode":v.value,onSelect:Y,onMenuClick:be,onMenuClose:f[2]||(f[2]=r=>l.value=null),onFilterChange:f[3]||(f[3]=r=>z.value=r),onSortChange:we,onToggleClosed:f[4]||(f[4]=r=>d.value=r),onReassign:xe,onClose:oe,onViewChange:U,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","active-filters","sort-option","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):N("",!0),R(se,{name:"fade"},{default:W(()=>[V.value&&v.value==="table"?(w(),S("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:ue})):N("",!0)]),_:1}),R(se,{name:"slide-right"},{default:W(()=>[V.value&&v.value==="table"?(w(),S("div",Os,[F.value&&ye.value&&he.value?(w(),K(Ie,{key:0,task:F.value,"management-widget":ye.value,"store-adapter":he.value,"add-new-config":je.value,"filtered-tasks":E.value,"is-drawer-view":!0,onTaskNavigate:Qe,onClose:ue},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0)])):N("",!0)]),_:1}),R(mt,{show:x.value,onClose:f[5]||(f[5]=r=>x.value=!1),onConfirm:Ge},null,8,["show"])])}}},Ks=ne(qs,[["__scopeId","data-v-4cfa2826"]]);export{Ks as default};
