import{h as O,r as n,c as A,m as h,d as x,o as I,s as D,E as N,e as r,y as s}from"./index-hkpYR6II.js";import{y as S}from"./components-D2JvxUA6.js";import{u as T}from"./customers-C9LDQ7wg.js";import{u as U}from"./opportunities-B28Vp_6U.js";import{u as k}from"./useCustomersTable-Dopt43fb.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-YF1Jctsa.js";const B={class:"table-wrapper w-full"},$={__name:"ContactsTab",setup(L){const y=O(),a=T(),i=U(),c=n("all"),p=n({pageIndex:0,pageSize:10}),u=n(""),d=n([]),m=n([]),v=e=>{if(!e)return"N/A";const t=e.split(",");return t.length>1&&t[t.length-1].trim().replace(/^\d+\s*/,"").trim()||e},l=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",g=A(()=>{let e=a.customers;return c.value==="contacts"?e=a.contacts:c.value==="accounts"&&(e=a.accounts),e.map(t=>({id:`customer-${t.id}`,stageKey:"contacts",customer:t.name,accountType:t.company&&t.company!==""?"Account":"Contact",telephone:t.phone,location:v(t.address),createdAt:l(t.createdAt),name:t.name,accountOwner:t.source||"N/A",updatedAt:l(t.lastContact||t.createdAt),lastActivity:l(t.lastContact),openOpportunities:i.opportunities.filter(o=>o.customerId===t.id&&o.stage!=="Closed Won"&&o.stage!=="Closed Lost").length,wonOpportunities:i.opportunities.filter(o=>o.customerId===t.id&&o.stage==="Closed Won").length,initials:t.initials||t.name.slice(0,2).toUpperCase(),type:t.company&&t.company!==""?"account":"contact",customerId:t.id}))}),f=e=>{if(e.stageKey==="contacts"){const t=e.customerId||e.id.split("-")[1];y.push({path:`/customer/${t}`})}},C=n("contacts"),{columns:b,filterDefinitions:F,tableMeta:w}=k(C,f);return h(async()=>{await a.fetchCustomers(),await i.fetchOpportunities()}),(e,t)=>(I(),x("div",B,[D(s(S),{data:g.value,columns:s(b),meta:s(w),onRowClick:f,columnFiltersOptions:{filterDefs:s(F)},pagination:p.value,"onUpdate:pagination":t[0]||(t[0]=o=>p.value=o),globalFilter:u.value,"onUpdate:globalFilter":t[1]||(t[1]=o=>u.value=o),sorting:d.value,"onUpdate:sorting":t[2]||(t[2]=o=>d.value=o),columnFilters:m.value,"onUpdate:columnFilters":t[3]||(t[3]=o=>m.value=o),paginationOptions:{rowCount:g.value.length},globalFilterOptions:{debounce:300}},{"empty-state":N(()=>[...t[4]||(t[4]=[r("div",{class:"empty-state"},[r("i",{class:"fa-solid fa-inbox empty-state-icon"}),r("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{$ as default};
