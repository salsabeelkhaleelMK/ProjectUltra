const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Baowk8yV.js","assets/index-BN-6T1Rw.css"])))=>i.map(i=>d[i]);
import{a0 as S,a1 as T,a2 as j,a3 as d,V as N,a4 as X,a5 as _,$ as Y,r as y,c as v}from"./index-Baowk8yV.js";const w=(t=300)=>new Promise(e=>setTimeout(e,t)),h=()=>d.filter(t=>!t.company||t.company===""),z=async(t={})=>{await w();let e=h();if(t.search){const n=t.search.toLowerCase();e=e.filter(c=>c.name.toLowerCase().includes(n)||c.email.toLowerCase().includes(n))}return{data:e,total:e.length}},O=async t=>{await w();const n=h().find(c=>c.id===parseInt(t));if(!n)throw new Error("Contact not found");return n},F=async t=>{await w();const e={id:d.length+1,...t,company:null,createdAt:new Date().toISOString(),lastContact:new Date().toISOString()};return d.push(e),e},G=async(t,e)=>{if(await w(),h().findIndex(l=>l.id===parseInt(t))===-1)throw new Error("Contact not found");const u=d.findIndex(l=>l.id===parseInt(t));return u!==-1&&(d[u]={...d[u],...e,company:null}),d[u]},H=async t=>{await w();const e=d.findIndex(n=>n.id===parseInt(t));if(e===-1)throw new Error("Contact not found");return d.splice(e,1),{success:!0}},J=async(t,e)=>{if(await w(),!h().find(l=>l.id===parseInt(t)))throw new Error("Contact not found");const u=d.findIndex(l=>l.id===parseInt(t));if(u===-1)throw new Error("Contact not found");return d[u].requestedCar={...e,id:Date.now()},{...d[u]}},K=async t=>{await w();const n=h().find(l=>l.id===parseInt(t));if(!n)throw new Error("Contact not found");if(!n.requestedCar)throw new Error("Contact must have requested car");const{createLead:c}=await _(async()=>{const{createLead:l}=await import("./index-Baowk8yV.js").then(o=>o.aX);return{createLead:l}},__vite__mapDeps([0,1]));return await c({customerId:n.id,requestedCar:n.requestedCar,source:n.source||"Direct",tags:n.tags||[],stage:"Open Lead",status:"Open",priority:"Normal"})},M=async t=>{await w();const n=h().find(l=>l.id===parseInt(t));if(!n)throw new Error("Contact not found");if(!n.requestedCar)throw new Error("Contact must have requested car");const{createOpportunity:c}=await _(async()=>{const{createOpportunity:l}=await import("./index-Baowk8yV.js").then(o=>o.aY);return{createOpportunity:l}},__vite__mapDeps([0,1]));return await c({customerId:n.id,vehicle:n.requestedCar,source:n.source||"Direct",tags:n.tags||[],stage:"Qualified",value:n.requestedCar.price||0})},at=async t=>{await w();const e=S.filter(n=>n.customerId===parseInt(t));return{data:e,total:e.length}},ot=async t=>{await w();const e=T.filter(n=>n.customerId===parseInt(t));return{data:e,total:e.length}},ct=async t=>{await w();const e=[],n=d.find(o=>o.id===parseInt(t));n!=null&&n.id,S.filter(o=>o.customerId===parseInt(t)).forEach(o=>{o.requestedCar&&e.push({...o.requestedCar,id:`requested-${o.id}`,type:"requested",leadId:o.id,leadStage:o.stage})}),n!=null&&n.requestedCar&&e.push({...n.requestedCar,id:`requested-contact-${n.id}`,type:"requested",contactId:n.id});const u=T.filter(o=>o.customerId===parseInt(t));return u.forEach(o=>{N.filter(p=>p.opportunityId===o.id&&p.type==="offer").forEach(p=>{var m;(m=p.data)!=null&&m.vehicle&&e.push({...p.data.vehicle,id:`offered-${p.id}`,type:"offered",opportunityId:o.id,opportunityStage:o.stage,offerDate:p.timestamp})})}),X.filter(o=>o.customerId===parseInt(t)&&o.type==="test-drive").forEach(o=>{o.vehicle&&e.push({brand:o.vehicle.split(" ")[0]||"",model:o.vehicle.split(" ").slice(1).join(" ")||"",id:`drove-${o.id}`,type:"drove",eventId:o.id,testDriveDate:o.start,vehicle:o.vehicle})}),u.forEach(o=>{o.stage==="Closed Won"&&o.vehicle&&e.push({...o.vehicle,id:`purchased-${o.id}`,type:"purchased",opportunityId:o.id,purchaseDate:o.contractDate||o.lastActivity})}),{data:e,total:e.length}},rt=async t=>{await w();const e=j.filter(n=>n.customerId===parseInt(t));return{data:e,total:e.length}},C=(t=300)=>new Promise(e=>setTimeout(e,t)),I=()=>d.filter(t=>t.company&&t.company!==""),U=async(t={})=>{await C();let e=I();if(t.search){const n=t.search.toLowerCase();e=e.filter(c=>{var u;return c.name.toLowerCase().includes(n)||c.email.toLowerCase().includes(n)||((u=c.company)==null?void 0:u.toLowerCase().includes(n))})}return{data:e,total:e.length}},D=async t=>{await C();const n=I().find(c=>c.id===parseInt(t));if(!n)throw new Error("Account not found");return n},Z=async t=>{await C();const e={id:d.length+1,...t,createdAt:new Date().toISOString(),lastContact:new Date().toISOString()};return d.push(e),e},tt=async(t,e)=>{if(await C(),I().findIndex(l=>l.id===parseInt(t))===-1)throw new Error("Account not found");const u=d.findIndex(l=>l.id===parseInt(t));return u!==-1&&(d[u]={...d[u],...e}),d[u]},et=async t=>{await C();const e=d.findIndex(n=>n.id===parseInt(t));if(e===-1)throw new Error("Account not found");return d.splice(e,1),{success:!0}},st=Y("customers",()=>{const t=y([]),e=y(null),n=y(!1),c=y(null),u=y(""),l=v(()=>t.value.filter(a=>a.type==="contact")),o=v(()=>t.value.filter(a=>a.type==="account")),g=v(()=>t.value.length),p=v(()=>l.value.length),m=v(()=>o.value.length);async function E(a={}){n.value=!0,c.value=null;try{const[r,s]=await Promise.all([z(a),U(a)]),i=[...r.data.map(f=>({...f,type:"contact"})),...s.data.map(f=>({...f,type:"account"}))];return t.value=i,{data:i,total:i.length}}catch(r){throw c.value=r.message,r}finally{n.value=!1}}async function k(a,r=null){n.value=!0,c.value=null;try{if(r==="contact")e.value={...await O(a),type:"contact"};else if(r==="account")e.value={...await D(a),type:"account"};else try{const s=await O(a);e.value={...s,type:"contact"}}catch{const s=await D(a);e.value={...s,type:"account"}}return e.value}catch(s){throw c.value=s.message,s}finally{n.value=!1}}async function A(a){n.value=!0,c.value=null;try{const r=a.company&&a.company!=="",i={...await(r?Z(a):F(a)),type:r?"account":"contact"};return t.value.unshift(i),i}catch(r){throw c.value=r.message,r}finally{n.value=!1}}async function q(a,r,s){var i;n.value=!0,c.value=null;try{const f=await(s==="account"?tt(a,r):G(a,r)),L=t.value.findIndex(W=>W.id===a);return L!==-1&&(t.value[L]={...f,type:s}),((i=e.value)==null?void 0:i.id)===a&&(e.value={...f,type:s}),{...f,type:s}}catch(f){throw c.value=f.message,f}finally{n.value=!1}}async function x(a,r){var s;n.value=!0,c.value=null;try{await(r==="account"?et(a):H(a)),t.value=t.value.filter(i=>i.id!==a),((s=e.value)==null?void 0:s.id)===a&&(e.value=null)}catch(i){throw c.value=i.message,i}finally{n.value=!1}}function R(a){u.value=a,E({search:a})}async function $(a){return await A({...a,company:null})}async function B(a,r){return await q(a,r,"contact")}async function P(a){return await x(a,"contact")}async function b(a,r){const s=t.value.find(i=>i.id===a);if(!s)throw new Error("Customer not found");if(s.type==="contact")return await J(a,r);throw new Error("Requested cars not supported for accounts")}async function Q(a){var s;const r=t.value.find(i=>i.id===a);if(!r)throw new Error("Customer not found");if(r.type==="contact"){const i=await K(a);return t.value=t.value.filter(f=>f.id!==a),((s=e.value)==null?void 0:s.id)===a&&(e.value=null),i}throw new Error("Only contacts can be converted to leads")}async function V(a){var s;const r=t.value.find(i=>i.id===a);if(!r)throw new Error("Customer not found");if(r.type==="contact"){const i=await M(a);return t.value=t.value.filter(f=>f.id!==a),((s=e.value)==null?void 0:s.id)===a&&(e.value=null),i}throw new Error("Only contacts can be converted to opportunities")}return{customers:t,contacts:l,accounts:o,currentCustomer:e,loading:n,error:c,searchQuery:u,totalCustomers:g,totalContacts:p,totalAccounts:m,loadCustomers:E,loadCustomerById:k,addCustomer:A,updateCustomer:q,removeCustomer:x,setSearchQuery:R,addContact:$,modifyContact:B,removeContact:P,addRequestedCar:b,convertToLead:Q,convertToOpportunity:V}});export{ot as a,rt as b,ct as c,at as f,st as u};
