import{r as O,d,o as l,e as t,g as p,n as E,t as g,H as ie,w as Y,p as T,k as F,F as j,i as z,c as A,a0 as Se,I as Ae,x as U,y as S,s as q,v as oe,G as N,m as Q,D as W,l as K,a1 as De,X as Te,h as Oe,a2 as Ie,W as Ve}from"./index-4t0q-YoU.js";import{i as pe,Q as re}from"./index-B_XAiWWB.js";import{_ as Ne}from"./ReassignUserModal-C2VIE97n.js";import{_ as Fe}from"./CreateEventModal-BR-2QR2U.js";import{_ as G}from"./ModalShell-CCJo1Yaq.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-Dd2SCa0l.js";import{u as L}from"./settings-Buo-UMP2.js";const Ee={class:"w-full"},qe={class:"flex items-center justify-between gap-3 md:gap-4"},Ue={class:"flex items-center gap-3 md:gap-4 flex-1"},Be={class:"min-w-0 flex-1"},Me={class:"flex items-center gap-2"},je={class:"heading-main truncate"},We={class:"flex flex-wrap items-center gap-2 mt-1"},Le={class:"flex items-center gap-1 ml-2"},Pe={class:"relative"},Re={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-50 overflow-hidden flex flex-col p-1"},ze={key:0,class:"border-t border-gray-100 my-1"},Ye={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},He={class:"flex items-center gap-4"},Ke={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},Qe={class:"flex items-center gap-2"},Ge={class:"text-xs text-gray-900 font-medium"},Je={class:"flex items-center gap-2"},Xe={class:"text-xs text-gray-900 font-medium"},Ze={class:"flex items-center gap-2"},_e={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},et={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},tt={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},at={class:"text-xs text-gray-900 font-medium"},st={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},nt={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action","add-tag"],setup(e,{emit:m}){const r={mounted(u,c){u.clickOutsideEvent=D=>{u===D.target||u.contains(D.target)||c.value()},document.addEventListener("click",u.clickOutsideEvent)},unmounted(u){document.removeEventListener("click",u.clickOutsideEvent)}},n=m,f=O(!1),s=O(!1),y=O(null),i=u=>{s.value=!1,n("action",u)},a=async(u,c)=>{try{await navigator.clipboard.writeText(u),y.value=c,setTimeout(()=>{y.value=null},1500)}catch(D){console.error("Failed to copy:",D)}},o=()=>{n("add-tag")};return(u,c)=>(l(),d("div",Ee,[t("div",qe,[t("div",Ue,[t("div",{class:E(["w-14 h-14 rounded flex items-center justify-center text-lg font-bold shadow-sm shrink-0",e.avatarColorClass])},g(e.initials),3),t("div",Be,[t("div",Me,[t("h1",je,g(e.name),1),ie(u.$slots,"name-action")]),t("div",We,[ie(u.$slots,"tags"),t("button",{onClick:Y(o,["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 font-medium hover:underline flex items-center gap-1"},[...c[14]||(c[14]=[t("i",{class:"fa-solid fa-plus text-[10px]"},null,-1),t("span",null,"add tag",-1)])])])])]),t("div",Le,[t("div",Pe,[t("button",{onClick:c[0]||(c[0]=Y(D=>s.value=!s.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors","aria-label":"Quick actions"},[...c[15]||(c[15]=[t("i",{class:"fa-solid fa-plus text-base"},null,-1)])]),s.value?T((l(),d("div",Re,[t("button",{onClick:c[1]||(c[1]=D=>i("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note "),t("button",{onClick:c[2]||(c[2]=D=>i("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing "),t("button",{onClick:c[3]||(c[3]=D=>i("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in "),t("button",{onClick:c[4]||(c[4]=D=>i("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase "),t("button",{onClick:c[5]||(c[5]=D=>i("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment "),c[20]||(c[20]=t("div",{class:"border-t border-gray-100 my-1"},null,-1)),t("button",{onClick:c[6]||(c[6]=D=>i("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[16]||(c[16]=[t("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),F(" WhatsApp msg ",-1)])]),t("button",{onClick:c[7]||(c[7]=D=>i("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[17]||(c[17]=[t("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),F(" Email ",-1)])]),t("button",{onClick:c[8]||(c[8]=D=>i("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[18]||(c[18]=[t("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),F(" SMS ",-1)])]),t("button",{onClick:c[9]||(c[9]=D=>i("call")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[19]||(c[19]=[t("i",{class:"fa-solid fa-phone text-xs text-gray-400"},null,-1),F(" Call ",-1)])]),e.taskType==="opportunity"?(l(),d("div",ze)):p("",!0),e.taskType==="opportunity"?(l(),d("button",{key:1,onClick:c[10]||(c[10]=D=>i("appointment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Appointment ")):p("",!0)])),[[r,()=>s.value=!1]]):p("",!0)]),t("button",{onClick:c[11]||(c[11]=D=>f.value=!f.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[t("i",{class:E(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":f.value}])},null,2)])])]),f.value?(l(),d("div",Ye,[t("div",He,[t("div",Ke,[t("div",Qe,[c[22]||(c[22]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),t("span",Ge,g(e.email),1),t("button",{onClick:c[12]||(c[12]=Y(D=>a(e.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...c[21]||(c[21]=[t("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),t("div",Je,[c[24]||(c[24]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),t("span",Xe,g(e.phone),1),t("button",{onClick:c[13]||(c[13]=Y(D=>a(e.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...c[23]||(c[23]=[t("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),t("div",Ze,[t("div",_e,[e.thirdFieldLabel.toLowerCase().includes("address")?(l(),d("i",et)):(l(),d("i",tt))]),t("span",at,g(e.thirdFieldValue),1)])])]),y.value?(l(),d("div",st,g(y.value==="email"?"Email":"Phone")+" copied! ",1)):p("",!0)])):p("",!0)]))}},lt={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},it=["onClick"],ot={class:"hidden md:inline whitespace-nowrap"},rt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(e){const m={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},r=n=>m[n]||"fa-solid fa-circle";return(n,f)=>(l(),d("div",lt,[(l(!0),d(j,null,z(e.tabs,s=>(l(),d("div",{key:s.key,onClick:y=>n.$emit("update:modelValue",s.key),class:E(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",e.modelValue===s.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[t("i",{class:E([r(s.key),"text-base md:text-base"])},null,2),t("span",ot,g(s.label),1),s.count!==void 0?(l(),d("span",{key:0,class:E(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",e.modelValue===s.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},g(s.count),3)):p("",!0)],10,it))),128))]))}},dt={class:"metadata-bar w-full"},ut={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ct={class:"flex items-center gap-1.5"},mt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ft={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},pt={class:"text-[10px] md:text-xs font-bold text-gray-800"},yt={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"}},emits:["reassign"],setup(e){const m=e;A(()=>m.deliverySubstatus?Se(m.deliverySubstatus):"");const r=A(()=>m.deliverySubstatus?m.deliverySubstatus==="Delivered"?"green":m.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),n=A(()=>Ae(m.stage,m.entityType));function f(i){return!i||i.length===0?null:i.filter(o=>o.type==="offer").sort((o,u)=>new Date(u.timestamp)-new Date(o.timestamp))[0]||null}function s(i){if(!i)return 0;const a=new Date(i),u=Math.abs(new Date-a);return Math.ceil(u/(1e3*60*60*24))}const y=A(()=>{if(m.stage!=="In Negotiation")return null;const i=f(m.activities);if(!i)return null;const a=s(i.timestamp);return a<1?{label:"New Offer",theme:"orange"}:a<3?{label:"Active",theme:"yellow"}:null});return(i,a)=>(l(),d("div",dt,[t("div",ut,[a[1]||(a[1]=t("span",{class:"label-upper text-[9px] md:text-xs"},"Stage",-1)),t("div",ct,[t("span",{class:E(["text-xs px-1.5 py-0.5 rounded font-semibold border",n.value])},g(e.stage),3),e.deliverySubstatus?(l(),U(S(pe),{key:0,text:e.deliverySubstatus,size:"small",theme:r.value},null,8,["text","theme"])):p("",!0),y.value?(l(),U(S(pe),{key:1,text:y.value.label,size:"small",theme:y.value.theme},null,8,["text","theme"])):p("",!0)])]),a[5]||(a[5]=t("div",{class:"metadata-divider"},null,-1)),t("div",mt,[a[2]||(a[2]=t("span",{class:"label-upper text-[9px] md:text-xs"},"Owner",-1)),t("button",{onClick:a[0]||(a[0]=o=>i.$emit("reassign")),class:"text-[10px] md:text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},g(e.owner),1)]),e.source?(l(),d(j,{key:0},[a[4]||(a[4]=t("div",{class:"metadata-divider"},null,-1)),t("div",ft,[a[3]||(a[3]=t("span",{class:"label-upper text-[9px] md:text-xs"},"Source",-1)),t("span",pt,g(e.source),1)])],64)):p("",!0)]))}},gt={key:0,class:"flex-grow border-t border-gray-200"},vt={key:0,class:"ml-1.5"},bt={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},xt={key:0,class:"border-t border-gray-100 my-1"},ht={key:0,class:"border-t border-gray-100 my-1"},kt={key:1,class:"flex-grow border-t border-gray-200"},wt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(e,{emit:m}){const r={mounted(h,v){h.clickOutsideEvent=V=>{h===V.target||h.contains(V.target)||v.value()},document.addEventListener("click",h.clickOutsideEvent)},unmounted(h){document.removeEventListener("click",h.clickOutsideEvent)}},n=e,f=m,s=O(!1),y={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},i=A(()=>{if(!n.activeTab||n.activeTab==="overview")return n.actions.filter(v=>!y[v]);const h=Object.entries(y).filter(([,v])=>v===n.activeTab).map(([v])=>v);return n.actions.filter(v=>h.includes(v))}),a=A(()=>n.activeTab==="communication"?!1:i.value.length===1),o=A(()=>{if(!a.value||i.value.length!==1)return"";const h=i.value[0];return{note:"add note",attachment:"add attachment"}[h]||""}),u=A(()=>n.activeTab==="communication"?!0:i.value.length>1),c=A(()=>{if(n.inline)return"bg-blue-600 hover:bg-blue-700 text-white font-medium w-9 h-9 rounded-lg shadow-sm transition-all flex items-center justify-center z-20 relative";const h="bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative";return a.value?`${h} px-4 h-9`:`${h} w-9 h-9`}),D=A(()=>i.value.some(h=>["email","whatsapp","sms"].includes(h))),C=A(()=>i.value.some(h=>["addVehicle","configureVehicle"].includes(h))),x=A(()=>i.value.some(h=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(h))),b=h=>{s.value=!1,f("action",h)},I=()=>{a.value&&i.value.length===1?b(i.value[0]):s.value=!s.value};return(h,v)=>e.show?(l(),d("div",{key:0,class:E(["relative flex items-center",e.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[e.inline?p("",!0):(l(),d("div",gt)),t("div",{class:E(["relative",e.inline?"mx-0":"mx-4"])},[t("button",{onClick:Y(I,["stop"]),class:E(c.value)},[v[11]||(v[11]=t("i",{class:"fa-solid fa-plus text-xs"},null,-1)),a.value?(l(),d("span",vt,g(o.value),1)):p("",!0)],2),s.value&&u.value?T((l(),d("div",bt,[C.value?(l(),d(j,{key:0},[i.value.includes("addVehicle")?(l(),d("button",{key:0,onClick:v[0]||(v[0]=V=>b("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):p("",!0),i.value.includes("configureVehicle")?(l(),d("button",{key:1,onClick:v[1]||(v[1]=V=>b("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):p("",!0)],64)):p("",!0),x.value?(l(),d(j,{key:1},[C.value?(l(),d("div",xt)):p("",!0),i.value.includes("note")?(l(),d("button",{key:1,onClick:v[2]||(v[2]=V=>b("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):p("",!0),i.value.includes("financing")?(l(),d("button",{key:2,onClick:v[3]||(v[3]=V=>b("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):p("",!0),i.value.includes("tradein")?(l(),d("button",{key:3,onClick:v[4]||(v[4]=V=>b("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):p("",!0),i.value.includes("requestedCar")?(l(),d("button",{key:4,onClick:v[5]||(v[5]=V=>b("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):p("",!0),i.value.includes("purchase")?(l(),d("button",{key:5,onClick:v[6]||(v[6]=V=>b("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):p("",!0),i.value.includes("attachment")?(l(),d("button",{key:6,onClick:v[7]||(v[7]=V=>b("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):p("",!0)],64)):p("",!0),D.value?(l(),d(j,{key:2},[C.value||x.value?(l(),d("div",ht)):p("",!0),i.value.includes("email")?(l(),d("button",{key:1,onClick:v[8]||(v[8]=V=>b("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[12]||(v[12]=[t("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),F(" Send Email ",-1)])])):p("",!0),i.value.includes("whatsapp")?(l(),d("button",{key:2,onClick:v[9]||(v[9]=V=>b("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[13]||(v[13]=[t("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),F(" Send WhatsApp ",-1)])])):p("",!0),i.value.includes("sms")?(l(),d("button",{key:3,onClick:v[10]||(v[10]=V=>b("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[14]||(v[14]=[t("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),F(" Send SMS ",-1)])])):p("",!0)],64)):p("",!0)])),[[r,()=>s.value=!1]]):p("",!0)],2),e.inline?p("",!0):(l(),d("div",kt))],2)):p("",!0)}},Ct={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},$t={class:"flex items-start gap-3"},St={class:"flex-1 min-w-0"},At={class:"font-bold text-sm text-slate-800 mb-2"},Dt={class:"space-y-1.5 text-xs text-gray-600"},Tt={class:"flex items-center gap-2"},Ot={class:"flex items-center gap-2"},It={class:"flex items-center gap-2"},Vt={key:0,class:"mt-2"},Nt={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(e){const m=e,r=A(()=>m.appointmentData.date?new Date(m.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),n=A(()=>m.appointmentData.time?m.appointmentData.time:""),f=s=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[s==null?void 0:s.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(s,y)=>(l(),d("div",Ct,[t("div",$t,[y[3]||(y[3]=t("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-calendar text-sm"})],-1)),t("div",St,[t("h4",At,g(e.appointmentData.type),1),t("div",Dt,[t("div",Tt,[y[0]||(y[0]=t("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),t("span",null,g(r.value),1)]),t("div",Ot,[y[1]||(y[1]=t("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),t("span",null,g(n.value),1)]),t("div",It,[y[2]||(y[2]=t("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),t("span",null,g(e.appointmentData.assignee),1)])]),e.appointmentData.status?(l(),d("div",Vt,[t("span",{class:E(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",f(e.appointmentData.status)])},g(e.appointmentData.status),3)])):p("",!0)])])]))}},Ft={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Et={class:"flex-1"},qt={class:"flex items-center gap-2 mb-1"},Ut={class:"text-xs font-bold text-slate-800"},Bt={class:"text-[10px] text-gray-400"},Mt={class:"text-[10px] text-gray-400"},jt={key:0,class:"bg-blue-50 text-blue-600 text-[10px] px-1 py-0.5 rounded border border-blue-100"},Wt={class:"ml-auto relative"},Lt={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},Pt={key:0,class:"text-sm text-slate-700"},Rt={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},zt={key:2,class:"mt-2"},Yt={key:0},Ht={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},Kt={key:0},Qt={class:"text-sm font-bold text-slate-800"},Gt={key:0,class:"text-xs text-gray-600 mt-0.5"},Jt={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},Xt={key:0},Zt={key:1},_t={key:2},ea={key:3},ta={key:4},aa={key:1},sa={class:"text-sm font-bold text-slate-800 mb-2"},na={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},la={key:0},ia={class:"text-slate-700 font-medium ml-1"},oa={key:1},ra={class:"text-slate-700 font-medium ml-1"},da={key:2},ua={class:"text-slate-700 font-medium ml-1"},ca={key:3},ma={class:"text-slate-700 font-medium ml-1"},fa={key:4},pa={class:"text-slate-700 font-medium ml-1"},ya={key:5},ga={class:"text-slate-700 font-medium ml-1"},va={key:2,class:"flex items-center gap-3"},ba={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},xa=["src"],ha={class:"flex-1"},ka={class:"text-sm font-bold text-slate-800"},wa={class:"text-xs text-gray-500"},Ca={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-1 py-0.5 rounded"},$a={key:3,class:"flex items-center gap-3"},Sa={class:"flex-1"},Aa={class:"text-sm font-bold text-slate-800"},Da={class:"text-xs text-gray-500"},Ta={key:0,class:"text-xs text-gray-400 mt-1"},Oa={key:1,class:"text-xs text-gray-600 mt-1"},ye={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(e,{emit:m}){const r=e,n=m,f=O(!1),s={mounted(C,x){C.clickOutsideEvent=b=>{C===b.target||C.contains(b.target)||x.value()},setTimeout(()=>{document.addEventListener("click",C.clickOutsideEvent)},0)},unmounted(C){document.removeEventListener("click",C.clickOutsideEvent)}},y=C=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[C]||"fa-solid fa-circle",i=C=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[C]||"bg-gray-100 text-gray-600 border-gray-200",a=C=>{if(!C)return"Just now";const x=new Date(C),I=new Date-x,h=Math.floor(I/6e4),v=Math.floor(h/60),V=Math.floor(v/24);return h<1?"Just now":h<60?`${h} minutes ago`:v<24?`${v} hours ago`:V===1?"Yesterday":V<7?`${V} days ago`:x.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},o=C=>C?new Intl.NumberFormat("en-US").format(C):"0",u=C=>C?new Date(C).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",c=()=>{f.value=!1,n("edit",r.item)},D=()=>{f.value=!1,confirm("Are you sure you want to delete this item?")&&n("delete",r.item)};return(C,x)=>(l(),d("div",Ft,[t("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",i(e.item.type)])},[t("i",{class:E([y(e.item.type),"text-sm"])},null,2)],2),t("div",Et,[t("div",qt,[t("span",Ut,g(e.customerInitials),1),t("span",Bt,g(e.item.action||"added"),1),t("span",Mt,"• "+g(a(e.item.timestamp)),1),e.item.autoDetected?(l(),d("span",jt,"Auto-detected")):p("",!0),t("div",Wt,[t("button",{onClick:x[0]||(x[0]=Y(b=>f.value=!f.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...x[1]||(x[1]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),f.value?T((l(),d("div",Lt,[t("button",{onClick:c,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...x[2]||(x[2]=[t("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),F(" Edit ",-1)])]),t("button",{onClick:D,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...x[3]||(x[3]=[t("i",{class:"fa-solid fa-trash text-red-400"},null,-1),F(" Delete ",-1)])])])),[[s,()=>f.value=!1]]):p("",!0)])]),e.item.content?(l(),d("div",Pt,g(e.item.content),1)):p("",!0),e.item.fileName?(l(),d("div",Rt,[x[4]||(x[4]=t("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),t("span",null,g(e.item.fileName),1)])):p("",!0),e.item.data?(l(),d("div",zt,[e.item.type==="appointment"?(l(),d("div",Yt,[q(Nt,{"appointment-data":e.item.data},null,8,["appointment-data"])])):(l(),d("div",Ht,[e.item.type==="tradein"?(l(),d("div",Kt,[t("h4",Qt,g(e.item.data.brand)+" "+g(e.item.data.model),1),e.item.data.version?(l(),d("p",Gt,g(e.item.data.version),1)):p("",!0),t("div",Jt,[e.item.data.year?(l(),d("div",Xt,[x[5]||(x[5]=t("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),F(g(e.item.data.year),1)])):p("",!0),e.item.data.km?(l(),d("div",Zt,[x[6]||(x[6]=t("i",{class:"fa-solid fa-road mr-1"},null,-1)),F(g(e.item.data.km)+" km ",1)])):p("",!0),e.item.data.plate?(l(),d("div",_t,[x[7]||(x[7]=t("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),F(g(e.item.data.plate),1)])):p("",!0),e.item.data.date?(l(),d("div",ea,[x[8]||(x[8]=t("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),F(g(u(e.item.data.date)),1)])):p("",!0),e.item.data.class?(l(),d("div",ta,[x[9]||(x[9]=t("i",{class:"fa-solid fa-car mr-1"},null,-1)),F(g(e.item.data.class),1)])):p("",!0)])])):e.item.type==="financing"?(l(),d("div",aa,[t("h4",sa,g(e.item.data.product),1),t("div",na,[e.item.data.provider?(l(),d("div",la,[x[10]||(x[10]=t("span",{class:"text-gray-500"},"Provider:",-1)),t("span",ia,g(e.item.data.provider),1)])):p("",!0),e.item.data.total?(l(),d("div",oa,[x[11]||(x[11]=t("span",{class:"text-gray-500"},"Total:",-1)),t("span",ra,"€"+g(o(e.item.data.total)),1)])):p("",!0),e.item.data.monthly?(l(),d("div",da,[x[12]||(x[12]=t("span",{class:"text-gray-500"},"Monthly:",-1)),t("span",ua,"€"+g(o(e.item.data.monthly)),1)])):p("",!0),e.item.data.deposit?(l(),d("div",ca,[x[13]||(x[13]=t("span",{class:"text-gray-500"},"Deposit:",-1)),t("span",ma,"€"+g(o(e.item.data.deposit)),1)])):p("",!0),e.item.data.startDate?(l(),d("div",fa,[x[14]||(x[14]=t("span",{class:"text-gray-500"},"Start:",-1)),t("span",pa,g(u(e.item.data.startDate)),1)])):p("",!0),e.item.data.expDate?(l(),d("div",ya,[x[15]||(x[15]=t("span",{class:"text-gray-500"},"Expires:",-1)),t("span",ga,g(u(e.item.data.expDate)),1)])):p("",!0)])])):e.item.type==="offer"?(l(),d("div",va,[e.item.data.image?(l(),d("div",ba,[t("img",{src:e.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,xa)])):p("",!0),t("div",ha,[t("h4",ka,g(e.item.data.brand)+" "+g(e.item.data.model)+" ("+g(e.item.data.year)+")",1),t("p",wa,"€ "+g(o(e.item.data.price)),1)]),e.item.data.isMainOffer?(l(),d("span",Ca,"Main Offer")):p("",!0)])):e.item.type==="purchase"?(l(),d("div",$a,[t("div",Sa,[t("h4",Aa,g(e.item.data.brand)+" "+g(e.item.data.model)+" ("+g(e.item.data.year)+")",1),t("p",Da,"€ "+g(o(e.item.data.price)),1),e.item.data.purchaseDate?(l(),d("p",Ta,"Purchased: "+g(u(e.item.data.purchaseDate)),1)):p("",!0),e.item.data.notes?(l(),d("p",Oa,g(e.item.data.notes),1)):p("",!0)])])):p("",!0)]))])):p("",!0)])]))}},Ia={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Va={class:"flex items-center gap-3"},Na=["title"],Fa={key:0,class:"fa-solid fa-arrow-left text-sm"},Ea={key:1,class:"fa-solid fa-arrow-right text-sm"},qa={key:2,class:"font-bold text-lg text-gray-800"},Ua={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Ba={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Ma={key:1,class:"text-center py-8 text-gray-400 relative z-10"},ja={class:"text-sm"},Wa={key:2,class:"space-y-6 relative z-10"},La={key:0,class:"mb-4 pl-12"},Pa={class:"text-sm font-semibold text-gray-800"},Ra={class:"flex gap-4 relative mb-6"},za={class:"flex-1 min-w-0"},Ya={class:"text-sm text-slate-700 leading-snug"},Ha={class:"font-bold"},Ka={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},Qa={class:"text-xs text-gray-400 mt-1"},Ga={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},Ja={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 z-0"},Xa={key:1,class:"space-y-4 relative z-10"},Za=["title"],_a={key:2,class:"text-center py-8 text-gray-400 relative z-10"},es={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(e,{emit:m}){const r=e,n=a=>{const o={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return o[a]||o.default},f=a=>{const o={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return o[a]||o.default},s=a=>{if(!a)return"";const o=new Date(a),u=new Date,c=new Date(u);return c.setDate(c.getDate()-1),o.toDateString()===u.toDateString()?"Today":o.toDateString()===c.toDateString()?"Yesterday":o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},y=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",i=(a,o)=>{if(a===0)return!0;const u=r.activities[a-1];if(!u)return!0;const c=new Date(o.timestamp).toDateString(),D=new Date(u.timestamp).toDateString();return c!==D};return(a,o)=>e.show?(l(),d("div",{key:0,class:E(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[e.collapsed?"w-16":"w-80",e.mobileFullscreen?"xl:relative xl:border-l":""]])},[t("div",Ia,[t("div",Va,[e.mobileFullscreen?(l(),d("button",{key:0,onClick:o[0]||(o[0]=u=>a.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...o[2]||(o[2]=[t("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):e.showCollapse?(l(),d("button",{key:1,onClick:o[1]||(o[1]=u=>a.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:e.collapsed?"Expand sidebar":"Collapse sidebar"},[e.collapsed?(l(),d("i",Fa)):(l(),d("i",Ea))],8,Na)):p("",!0),e.collapsed?p("",!0):(l(),d("h2",qa,g(e.title),1))])]),e.collapsed?(l(),d("div",Ga,[e.activities.length>0?(l(),d("div",Ja)):p("",!0),e.activities.length>0?(l(),d("div",Xa,[(l(!0),d(j,null,z(e.activities,u=>(l(),d("div",{key:u.id,class:"relative"},[t("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white border-2 border-gray-200",f(u.type)]),title:`${u.user} ${u.action}`},[t("i",{class:E([n(u.type),"text-xs"])},null,2)],10,Za)]))),128))])):(l(),d("div",_a,[...o[4]||(o[4]=[t("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(l(),d("div",Ua,[e.activities.length>0?(l(),d("div",Ba)):p("",!0),e.activities.length===0?(l(),d("div",Ma,[o[3]||(o[3]=t("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),t("p",ja,g(e.emptyMessage),1)])):(l(),d("div",Wa,[(l(!0),d(j,null,z(e.activities,(u,c)=>(l(),d(j,{key:u.id},[i(c,u)?(l(),d("div",La,[t("h3",Pa,g(s(u.timestamp)),1)])):p("",!0),t("div",Ra,[t("div",{class:E(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",f(u.type)])},[t("i",{class:E([n(u.type),"text-sm"])},null,2)],2),t("div",za,[t("div",Ya,[t("span",Ha,g(u.user),1),F(" "+g(u.action),1)]),u.content?(l(),d("div",Ka,g(u.content),1)):p("",!0),t("div",Qa,g(y(u.timestamp)),1)])])],64))),128))]))]))],2)):p("",!0)}},ts={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},as={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},ss={class:"mb-3"},ns={class:"flex justify-end gap-2"},ls={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const r=e,n=m,f=O(""),s=O(""),y=()=>{!f.value.trim()&&!s.value||n("save",{type:"communication",action:`sent via ${r.type}`,content:f.value||`Sent template: ${s.value}`,communicationType:r.type})};return(i,a)=>(l(),d("div",ts,[a[5]||(a[5]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("h5",as,g(e.type==="email"?"Send Email":e.type==="whatsapp"?"Send WhatsApp":e.type==="sms"?"Send SMS":"Send Message"),1),t("div",ss,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),T(t("select",{"onUpdate:modelValue":a[0]||(a[0]=o=>s.value=o),class:"input"},[...a[3]||(a[3]=[t("option",{value:""},"Select a template...",-1),t("option",null,"Follow-up",-1),t("option",null,"Meeting Confirmation",-1),t("option",null,"Quote Proposal",-1),t("option",null,"Unable to Reach",-1)])],512),[[oe,s.value]])]),T(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=o=>f.value=o),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[N,f.value]]),t("div",ns,[t("button",{onClick:a[2]||(a[2]=o=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:y,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},is={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},os={key:1,class:"flex justify-between items-center mb-4"},rs={class:"text-sm font-bold text-slate-800"},ds={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},us={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:r}){const n=e,f=r,s=O("");Q(()=>{n.item&&(s.value=n.item.content||"")});const y=()=>{var i,a;s.value.trim()&&f("save",{id:((i=n.item)==null?void 0:i.id)||Date.now(),type:"note",action:n.item?"updated a note":"added a note",content:s.value,timestamp:((a=n.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return m({submit:y,canSubmit:()=>!!s.value.trim()}),(i,a)=>(l(),d("div",{class:E(["animate-fade-in relative",{"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6":!e.hideHeader}])},[e.hideHeader?p("",!0):(l(),d("div",is)),e.hideHeader?p("",!0):(l(),d("div",os,[t("h5",rs,g(e.item?"Edit Note":"Add Note"),1),t("button",{onClick:a[0]||(a[0]=o=>i.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...a[3]||(a[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t("div",null,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),T(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=o=>s.value=o),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[N,s.value]])]),e.hideActions?p("",!0):(l(),d("div",ds,[t("button",{onClick:a[2]||(a[2]=o=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:y,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")]))],2))}},cs={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},ms={class:"flex justify-between items-center mb-4"},fs={class:"text-sm font-bold text-slate-800"},ps={class:"flex items-center gap-3"},ys={key:0,class:"text-sm text-slate-600"},gs={key:1,class:"text-sm text-gray-400"},vs={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},bs=["disabled"],xs={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const r=e,n=m,f=O(null),s=O("");Q(()=>{r.item&&(s.value=r.item.fileName||"")});const y=a=>{const o=a.target.files[0];o&&(f.value=o,s.value=o.name)},i=()=>{var a,o;!f.value&&!r.item||n("save",{id:((a=r.item)==null?void 0:a.id)||Date.now(),type:"attachment",action:r.item?"updated an attachment":"added an attachment",fileName:s.value,timestamp:((o=r.item)==null?void 0:o.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return(a,o)=>(l(),d("div",cs,[o[6]||(o[6]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("div",ms,[t("h5",fs,g(e.item?"Edit Attachment":"Add Attachment"),1),t("button",{onClick:o[0]||(o[0]=u=>a.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...o[3]||(o[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t("div",null,[o[5]||(o[5]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),t("div",ps,[t("input",{type:"file",onChange:y,ref:"fileInput",class:"hidden"},null,544),t("button",{onClick:o[1]||(o[1]=u=>a.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...o[4]||(o[4]=[t("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),F("Choose File ",-1)])]),s.value?(l(),d("span",ys,g(s.value),1)):(l(),d("span",gs,"No file selected"))])]),t("div",vs,[t("button",{onClick:o[2]||(o[2]=u=>a.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:i,disabled:!f.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,bs)])]))}},hs={class:"animate-fade-in"},ks={class:"space-y-4"},ws={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$s={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ss=["disabled"],As={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:r}){const n=e,f=r,s=O({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});Q(()=>{n.item&&n.item.data&&(s.value={startDate:n.item.data.startDate||"",expDate:n.item.data.expDate||"",productName:n.item.data.product||n.item.data.productName||"",deposit:n.item.data.deposit||"",loanAmount:n.item.data.total||n.item.data.loanAmount||""})});const y=()=>{var i,a;s.value.productName&&f("save",{id:((i=n.item)==null?void 0:i.id)||Date.now(),type:"financing",action:n.item?"updated a financing proposal":"added a financing proposal",data:{product:s.value.productName,provider:"Audi Financial",total:s.value.loanAmount||"0",monthly:Math.round(parseFloat(s.value.loanAmount||0)/36).toString(),startDate:s.value.startDate,expDate:s.value.expDate,deposit:s.value.deposit},timestamp:((a=n.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return m({submit:y,isValid:A(()=>!!s.value.productName)}),(i,a)=>(l(),d("div",hs,[t("div",ks,[t("div",ws,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),T(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=o=>s.value.startDate=o),class:"input"},null,512),[[N,s.value.startDate]])]),t("div",null,[a[7]||(a[7]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),T(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=o=>s.value.expDate=o),class:"input"},null,512),[[N,s.value.expDate]])])]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),T(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=o=>s.value.productName=o),class:"input"},null,512),[[N,s.value.productName]])]),t("div",Cs,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),T(t("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=o=>s.value.deposit=o),class:"input"},null,512),[[N,s.value.deposit]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),T(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=o=>s.value.loanAmount=o),class:"input"},null,512),[[N,s.value.loanAmount]])])])]),e.hideActions?p("",!0):(l(),d("div",$s,[t("button",{onClick:a[5]||(a[5]=o=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:y,disabled:!s.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Ss)]))]))}},Ds={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const r=m,n=O(null),f=A(()=>{var i;return((i=n.value)==null?void 0:i.isValid)||!1}),s=()=>{var i;(i=n.value)==null||i.submit()},y=i=>{r("save",i),r("close")};return(i,a)=>(l(),U(G,{show:e.show,title:"Add Financing",subtitle:"Record financing details for this customer",size:"lg",onClose:a[1]||(a[1]=o=>i.$emit("close")),onCancel:a[2]||(a[2]=o=>i.$emit("close"))},{actions:W(()=>[q(S(re),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm",disabled:!f.value,onClick:s},null,8,["disabled"])]),default:W(()=>[q(As,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:n,onSave:y,onCancel:a[0]||(a[0]=o=>i.$emit("close"))},null,8,["item","task-type","task-id"])]),_:1},8,["show"]))}},Ts={class:"animate-fade-in"},Os={class:"space-y-4"},Is={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ns={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Fs=["disabled"],Es={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:r}){const n=e,f=r,s=O({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});Q(()=>{n.item&&n.item.data&&(s.value={class:n.item.data.class||"Car",brand:n.item.data.brand||"",model:n.item.data.model||"",version:n.item.data.version||"",km:n.item.data.km||"",plate:n.item.data.plate||"",date:n.item.data.date||""})});const y=()=>{var i,a;s.value.brand&&f("save",{id:((i=n.item)==null?void 0:i.id)||Date.now(),type:"tradein",action:n.item?"updated a trade-in":"added a trade-in",data:{class:s.value.class,brand:s.value.brand,model:s.value.model||"Unknown Model",year:s.value.date?new Date(s.value.date).getFullYear():"Unknown Year",km:s.value.km||"0",plate:s.value.plate||"",date:s.value.date||""},timestamp:((a=n.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return m({submit:y,isValid:A(()=>!!s.value.brand)}),(i,a)=>(l(),d("div",Ts,[t("div",Os,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),T(t("select",{"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.class=o),class:"input"},[...a[8]||(a[8]=[t("option",{value:"Car"},"Car",-1),t("option",{value:"Motorcycle"},"Motorcycle",-1),t("option",{value:"Truck"},"Truck",-1)])],512),[[oe,s.value.class]])]),t("div",Is,[t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>s.value.brand=o),class:"input"},null,512),[[N,s.value.brand]])]),t("div",null,[a[11]||(a[11]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=o=>s.value.model=o),class:"input"},null,512),[[N,s.value.model]])])]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),T(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>s.value.version=o),class:"input"},null,512),[[N,s.value.version]])]),t("div",Vs,[t("div",null,[a[13]||(a[13]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),T(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=o=>s.value.km=o),class:"input"},null,512),[[N,s.value.km]])]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),T(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=o=>s.value.plate=o),class:"input"},null,512),[[N,s.value.plate]])])]),t("div",null,[a[15]||(a[15]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),T(t("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=o=>s.value.date=o),class:"input"},null,512),[[N,s.value.date]])])]),e.hideActions?p("",!0):(l(),d("div",Ns,[t("button",{onClick:a[7]||(a[7]=o=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:y,disabled:!s.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Fs)]))]))}},qs={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const r=m,n=O(null),f=A(()=>{var i;return((i=n.value)==null?void 0:i.isValid)||!1}),s=()=>{var i;(i=n.value)==null||i.submit()},y=i=>{r("save",i),r("close")};return(i,a)=>(l(),U(G,{show:e.show,title:"Add Trade-In Vehicle",subtitle:"Record details of the customer's trade-in vehicle",size:"lg",onClose:a[1]||(a[1]=o=>i.$emit("close")),onCancel:a[2]||(a[2]=o=>i.$emit("close"))},{actions:W(()=>[q(S(re),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm",disabled:!f.value,onClick:s},null,8,["disabled"])]),default:W(()=>[q(Es,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:n,onSave:y,onCancel:a[0]||(a[0]=o=>i.$emit("close"))},null,8,["item","task-type","task-id"])]),_:1},8,["show"]))}},Us={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Bs={key:0,class:"flex justify-between items-center mb-4"},Ms={class:"text-sm font-bold text-slate-800"},js={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ws={class:"flex items-center gap-3"},Ls={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Ps=["src"],Rs={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},zs={class:"font-bold text-sm text-gray-800"},Ys={class:"text-xs text-gray-500"},Hs={class:"space-y-4"},Ks={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qs={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Gs=["disabled"],Js={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:r}){const n=e,f=r,s=O({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});Q(()=>{if(n.selectedVehicle){s.value.price=n.selectedVehicle.price||0,s.value.brand=n.selectedVehicle.brand||"",s.value.model=n.selectedVehicle.model||"",s.value.year=n.selectedVehicle.year||"",s.value.image=n.selectedVehicle.image||"";const o=new Date;o.setDate(o.getDate()+30),s.value.validUntil=o.toISOString().split("T")[0]}n.item&&n.item.data&&(s.value={...s.value,...n.item.data,price:n.item.data.price||n.item.data.total||0,financingType:n.item.data.financingType||n.item.data.paymentMethod||"",notes:n.item.data.notes||n.item.data.description||""})}),K(()=>n.selectedVehicle,o=>{o&&!n.item&&(s.value.price=o.price||0,s.value.brand=o.brand||"",s.value.model=o.model||"",s.value.year=o.year||"",s.value.image=o.image||"")});const y=A(()=>s.value.price>0&&s.value.financingType!==""),i=o=>o?o.toLocaleString("en-US"):"0",a=()=>{var u,c;if(!y.value)return;const o={id:((u=n.item)==null?void 0:u.id)||Date.now(),type:"offer",action:n.item?"updated an offer":"created an offer",data:{brand:s.value.brand,model:s.value.model,year:s.value.year,price:s.value.price,total:s.value.price,paymentMethod:s.value.financingType,financingType:s.value.financingType,downPayment:s.value.downPayment,monthlyPayment:s.value.monthlyPayment,term:s.value.term,interestRate:s.value.interestRate,deliveryDate:s.value.deliveryDate,validUntil:s.value.validUntil,notes:s.value.notes,description:s.value.notes,image:s.value.image},timestamp:((c=n.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!n.item};f("save",o)};return m({submit:a,isValid:y,offerData:s}),(o,u)=>(l(),d("div",Us,[e.hideHeader?p("",!0):(l(),d("div",Bs,[t("h5",Ms,g(e.item?"Edit Offer":"Create Offer"),1),t("button",{onClick:u[0]||(u[0]=c=>o.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[11]||(u[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e.selectedVehicle?(l(),d("div",js,[u[12]||(u[12]=t("p",{class:"text-xs text-gray-500 mb-2"},"Creating offer for:",-1)),t("div",Ws,[t("div",Ls,[e.selectedVehicle.image?(l(),d("img",{key:0,src:e.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Ps)):(l(),d("i",Rs))]),t("div",null,[t("h4",zs,g(e.selectedVehicle.brand)+" "+g(e.selectedVehicle.model)+" ("+g(e.selectedVehicle.year)+") ",1),t("p",Ys,"Base Price: € "+g(i(e.selectedVehicle.price)),1)])])])):p("",!0),t("div",Hs,[t("div",null,[u[13]||(u[13]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[F(" Offer Price (€) "),t("span",{class:"text-red-500"},"*")],-1)),T(t("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=c=>s.value.price=c),class:"input",placeholder:"Enter offer price"},null,512),[[N,s.value.price]])]),t("div",null,[u[15]||(u[15]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[F(" Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),T(t("select",{"onUpdate:modelValue":u[2]||(u[2]=c=>s.value.financingType=c),class:"input"},[...u[14]||(u[14]=[t("option",{value:""},"Select payment method",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"finance"},"Finance",-1),t("option",{value:"lease"},"Lease",-1)])],512),[[oe,s.value.financingType]])]),s.value.financingType==="finance"||s.value.financingType==="lease"?(l(),d("div",Ks,[t("div",null,[u[16]||(u[16]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Down Payment (€)",-1)),T(t("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=c=>s.value.downPayment=c),class:"input",placeholder:"0"},null,512),[[N,s.value.downPayment]])]),t("div",null,[u[17]||(u[17]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),T(t("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>s.value.monthlyPayment=c),class:"input",placeholder:"Calculated automatically"},null,512),[[N,s.value.monthlyPayment]])]),t("div",null,[u[18]||(u[18]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Term (months)",-1)),T(t("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=c=>s.value.term=c),class:"input",placeholder:"36"},null,512),[[N,s.value.term]])]),t("div",null,[u[19]||(u[19]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Interest Rate (%)",-1)),T(t("input",{type:"number",step:"0.1","onUpdate:modelValue":u[6]||(u[6]=c=>s.value.interestRate=c),class:"input",placeholder:"3.5"},null,512),[[N,s.value.interestRate]])])])):p("",!0),t("div",null,[u[20]||(u[20]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expected Delivery Date",-1)),T(t("input",{type:"date","onUpdate:modelValue":u[7]||(u[7]=c=>s.value.deliveryDate=c),class:"input"},null,512),[[N,s.value.deliveryDate]])]),t("div",null,[u[21]||(u[21]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Offer Valid Until",-1)),T(t("input",{type:"date","onUpdate:modelValue":u[8]||(u[8]=c=>s.value.validUntil=c),class:"input"},null,512),[[N,s.value.validUntil]])]),t("div",null,[u[22]||(u[22]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes / Special Terms",-1)),T(t("textarea",{"onUpdate:modelValue":u[9]||(u[9]=c=>s.value.notes=c),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[N,s.value.notes]])])]),e.hideActions?p("",!0):(l(),d("div",Qs,[t("button",{onClick:u[10]||(u[10]=c=>o.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),t("button",{onClick:a,disabled:!y.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},g(e.item?"Update Offer":"Create Offer"),9,Gs)]))]))}},Xs={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(e,{emit:m}){const r=m,n=O(null),f=A(()=>{var i;return((i=n.value)==null?void 0:i.isValid)||!1}),s=()=>{var i;(i=n.value)==null||i.submit()},y=i=>{r("save",i),r("close")};return(i,a)=>(l(),U(G,{show:e.show,title:"Create Offer",subtitle:"Create a purchase offer for the customer",size:"2xl",onClose:a[1]||(a[1]=o=>i.$emit("close")),onCancel:a[2]||(a[2]=o=>i.$emit("close"))},{actions:W(()=>[q(S(re),{label:e.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm",disabled:!f.value,onClick:s},null,8,["label","disabled"])]),default:W(()=>[q(Js,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"requested-car":e.requestedCar,"recommended-cars":e.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:n,onSave:y,onCancel:a[0]||(a[0]=o=>i.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),_:1},8,["show"]))}},Zs={class:"space-y-4"},_s={key:0},en={class:"flex flex-wrap gap-2"},tn=["onClick"],an=["disabled"],sn={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(e,{emit:m}){const r=e,n=m,f=O("");K(()=>r.show,y=>{y&&(f.value="")});const s=()=>{const y=f.value.trim();y&&(r.existingTags.includes(y)||(n("add",y),f.value=""))};return(y,i)=>(l(),U(G,{show:e.show,onClose:i[1]||(i[1]=a=>y.$emit("close")),onCancel:i[2]||(i[2]=a=>y.$emit("close")),title:"Add Tag"},{actions:W(()=>[t("button",{onClick:s,disabled:!f.value.trim(),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium text-sm"}," Add Tag ",8,an)]),default:W(()=>[t("div",Zs,[t("div",null,[i[3]||(i[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Tag Name ",-1)),T(t("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>f.value=a),onKeyup:De(s,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[N,f.value]])]),e.existingTags.length>0?(l(),d("div",_s,[i[4]||(i[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Existing Tags ",-1)),t("div",en,[(l(!0),d(j,null,z(e.existingTags,a=>(l(),d("button",{key:a,onClick:o=>f.value=a,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},g(a),9,tn))),128))])])):p("",!0)])]),_:1},8,["show"]))}},ne={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function ge(e){if(!e)return ne.default;const m=e.toLowerCase().trim();return ne[m]||ne.default}function nn({store:e,taskId:m,getTabForItemType:r,isOverviewModalAction:n}){const f=O(null),s=O(null),y=O("overview"),i=O("email"),a=O([]);K(y,()=>{f.value=null,s.value=null});const o=A(()=>[...e.currentActivities.value,...a.value.filter(I=>!I.activityId)].filter(I=>{const h=r(I.type);return y.value==="overview"?h==="overview":h===y.value}).sort((I,h)=>{const v=new Date(I.timestamp||0);return new Date(h.timestamp||0)-v})),u=b=>(s.value=null,y.value==="overview"&&n&&n(b)?{type:"overview-modal",action:b}:(["email","sms","whatsapp","call"].includes(b)?(i.value=b,f.value="communication"):f.value=b,null)),c=async b=>{var I;if(b.isEdit){const h=a.value.findIndex(v=>v.id===b.id);h>-1&&(a.value[h]={...a.value[h],...b}),(I=s.value)!=null&&I.activityId&&await e.updateActivity(m.value,s.value.activityId,{type:b.communicationType||b.type,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data})}else{const h=b.communicationType||b.type,v=await e.addActivity(m.value,{type:h,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data});a.value.push({id:v.id,type:h==="email"||h==="whatsapp"||h==="sms"?"communication":h,action:b.action,content:b.content,fileName:b.fileName,data:b.data,timestamp:v.timestamp,activityId:v.id})}f.value=null,s.value=null},D=()=>{f.value=null,s.value=null},C=b=>{r(b.type)&&(f.value=b.type==="email"||b.type==="whatsapp"||b.type==="sms"||b.type==="communication"?"communication":b.type,s.value=b)},x=async b=>{try{await e.deleteActivity(m.value,b)}catch(I){throw console.error("Error deleting item:",I),I}};return{activeTab:y,showInlineWidget:f,inlineWidgetType:A(()=>f.value),editingItem:s,isEditing:A(()=>s.value!==null),communicationType:i,inlineContent:a,filteredInlineContent:o,handleAddNewAction:u,handleWidgetSave:c,handleWidgetCancel:D,handleEditItem:C,handleDeleteItem:x}}const ln={class:"flex-1 flex flex-col overflow-hidden h-full"},on={class:"bg-gray-50 border-b border-gray-200 shrink-0"},rn={class:"px-4 md:px-8 py-3 md:py-4"},dn={class:"flex-1 flex flex-row overflow-hidden"},un={class:"flex-1 flex flex-col overflow-hidden min-w-0"},cn={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},mn={class:"mb-4"},fn={key:0},pn={key:0,class:"mb-6"},yn={class:"space-y-6 mb-6"},gn={key:1,class:"mb-6"},vn={key:2,class:"space-y-4 mb-6 px-1"},bn={key:1},xn={key:0,class:"space-y-4 mb-6 px-1"},Dn={__name:"CustomerShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(e,{emit:m}){const r=e,n=Te(),f=Oe(),s=A(()=>r.task.id),y=A(()=>r.type==="contact"?"bg-blue-100 text-blue-600":r.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),i=A(()=>n.path.startsWith("/tasks")&&!n.path.startsWith("/customer")),a=O(n.path.startsWith("/tasks")&&!n.path.startsWith("/customer"));K(()=>n.path,k=>{a.value=k.startsWith("/tasks")&&!k.startsWith("/customer")});const o=()=>{f.push({path:`/customer/${r.task.id}`,query:{type:r.type}})};function u(k){b.value=!1}const c=()=>{I.value=!0},D=async k=>{var $,B,P,M;const w=k.name;r.type==="lead"?await((B=($=r.storeAdapter).updateLead)==null?void 0:B.call($,r.task.id,{assignee:w,assigneeType:k.type,teamId:k.type==="team"?k.id:null})):r.type==="opportunity"&&await((M=(P=r.storeAdapter).updateOpportunity)==null?void 0:M.call(P,r.task.id,{assignee:w,assigneeType:k.type,teamId:k.type==="team"?k.id:null})),I.value=!1},C=O(!1),x=O(null),b=O(!1),I=O(!1),h=O(!1),{activeTab:v,showInlineWidget:V,editingItem:_,communicationType:ve,inlineContent:ue,filteredInlineContent:J,handleAddNewAction:be,handleWidgetSave:X,handleWidgetCancel:ee,handleEditItem:ce,handleDeleteItem:me}=nn({store:r.storeAdapter,taskId:s,getTabForItemType:ge,isOverviewModalAction:k=>v.value==="overview"&&r.addNewConfig.overviewActions.includes(k)});K(()=>r.task.id,()=>{v.value="overview"});const te=k=>{const w=be(k);w&&w.modalAction&&(x.value=w.modalAction,C.value=!0)},xe=k=>{if(k==="appointment"){b.value=!0;return}const w={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(k))x.value=k,C.value=!0;else{const $=w[k];$?(v.value=$,setTimeout(()=>{te(k),setTimeout(()=>{try{const B=document.querySelector(".animate-fade-in");B&&B.parentNode&&B.scrollIntoView({behavior:"smooth",block:"start"})}catch(B){console.debug("Could not scroll to inline widget:",B)}},100)},50)):te(k)}},Z=()=>{C.value=!1,x.value=null},ae=async k=>{await X(k),Z()},he=A(()=>{const k=[...r.storeAdapter.currentActivities.value,...ue.value],w=k.filter(M=>ge(M.type)==="overview").length,$=k.filter(M=>["call","email","sms","whatsapp","communication"].includes(M.type)).length,B=k.filter(M=>M.type==="note").length,P=k.filter(M=>M.type==="attachment").length;return[{key:"overview",label:"Overview",count:w},{key:"note",label:"Notes",count:B},{key:"communication",label:"Communication",count:$},{key:"attachment",label:"Attachments",count:P}]}),fe=A(()=>[...r.storeAdapter.currentActivities.value,...ue.value]);A(()=>x.value==="financing"?"Add Financing":x.value==="tradein"?"Add Trade-in":x.value==="purchase"?"Create Purchase Offer":"");const ke=async k=>{if(r.type==="opportunity")try{await r.storeAdapter.addVehicle(r.task.id,k.vehicleData),r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id)}catch(w){console.error("Error selecting vehicle:",w)}},we=async k=>{if(r.type==="opportunity")try{await r.storeAdapter.createOffer(r.task.id,k.offerData),r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id)}catch(w){console.error("Error creating offer:",w)}},Ce=async k=>{var B,P,M,se;const w=r.task.tags||[];if(w.includes(k)){h.value=!1;return}const $=[...w,k];try{r.type==="lead"?await((P=(B=r.storeAdapter).updateLead)==null?void 0:P.call(B,r.task.id,{tags:$})):r.type==="opportunity"&&await((se=(M=r.storeAdapter).updateOpportunity)==null?void 0:se.call(M,r.task.id,{tags:$})),r.type==="lead"&&r.storeAdapter.loadLeadById?await r.storeAdapter.loadLeadById(r.task.id):r.type==="opportunity"&&r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id),h.value=!1}catch($e){console.error("Error adding tag:",$e)}};return(k,w)=>(l(),d("div",ln,[t("header",on,[t("div",rn,[q(nt,{initials:e.task.customer.initials,name:e.task.customer.name,email:e.task.customer.email,phone:e.task.customer.phone,"third-field-value":e.task.customer.address,"avatar-color-class":y.value,"task-type":e.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:xe,onAddTag:w[0]||(w[0]=$=>h.value=!0)},{tags:W(()=>[(l(!0),d(j,null,z(e.task.tags,$=>(l(),d("span",{key:$,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},g($),1))),128))]),"name-action":W(()=>[i.value?(l(),d("button",{key:0,onClick:o,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...w[9]||(w[9]=[t("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):p("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),t("div",dn,[t("div",un,[t("main",cn,[t("div",mn,[q(rt,{modelValue:S(v),"onUpdate:modelValue":w[1]||(w[1]=$=>Ie(v)?v.value=$:null),tabs:he.value,class:"mb-0"},null,8,["modelValue","tabs"])]),S(v)==="overview"?(l(),d("div",fn,[e.type!=="contact"?(l(),d("div",pn,[q(yt,{stage:e.task.displayStage||e.task.stage,owner:e.task.assignee,source:e.task.source||"","delivery-substatus":e.task.deliverySubstatus,activities:e.task.activities||[],"entity-type":e.type,onReassign:c},null,8,["stage","owner","source","delivery-substatus","activities","entity-type"])])):p("",!0),t("div",yn,[ie(k.$slots,"pinned-extra",{task:e.task})]),e.managementWidget?(l(),d("div",gn,[(l(),U(Ve(e.managementWidget),{lead:e.type==="lead"?e.task:void 0,opportunity:e.type==="opportunity"?e.task:void 0,contact:e.type==="contact"?e.task:void 0,activities:fe.value,onCarAdded:w[2]||(w[2]=$=>k.$emit("car-added",$)),onConvertToLead:w[3]||(w[3]=$=>k.$emit("convert-to-lead")),onConvertToOpportunity:w[4]||(w[4]=$=>k.$emit("convert-to-opportunity")),onVehicleSelected:ke,onCreateOffer:we},null,40,["lead","opportunity","contact","activities"]))])):p("",!0),S(J).length>0?(l(),d("div",vn,[(l(!0),d(j,null,z(S(J),$=>(l(),U(ye,{key:$.id,item:$,"task-type":e.type,"customer-initials":"SK",onEdit:S(ce),onDelete:S(me)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)])):(l(),d("div",bn,[q(wt,{actions:e.addNewConfig.tabActions,"active-tab":S(v),onAction:te},null,8,["actions","active-tab"]),t("div",null,[S(V)==="communication"?(l(),U(ls,{key:0,type:S(ve),"task-type":e.type,"task-id":e.task.id,item:S(_),onSave:S(X),onCancel:S(ee)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):p("",!0),S(V)==="note"?(l(),U(us,{key:1,item:S(_),"task-type":e.type,"task-id":e.task.id,onSave:S(X),onCancel:S(ee)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0),S(V)==="attachment"?(l(),U(xs,{key:2,item:S(_),"task-type":e.type,"task-id":e.task.id,onSave:S(X),onCancel:S(ee)},null,8,["item","task-type","task-id","onSave","onCancel"])):p("",!0)]),S(J).length>0?(l(),d("div",xn,[(l(!0),d(j,null,z(S(J),$=>(l(),U(ye,{key:$.id,item:$,"task-type":e.type,"customer-initials":"SK",onEdit:S(ce),onDelete:S(me)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):p("",!0)]))])]),q(es,{title:"Activity summary",activities:fe.value,collapsed:a.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:w[5]||(w[5]=$=>a.value=!a.value)},null,8,["activities","collapsed"])]),q(Ds,{show:x.value==="financing"&&C.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:ae,onClose:Z},null,8,["show","task-type","task-id"]),q(qs,{show:x.value==="tradein"&&C.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:ae,onClose:Z},null,8,["show","task-type","task-id"]),q(Xs,{show:x.value==="purchase"&&C.value,item:null,"task-type":e.type,"task-id":e.task.id,"requested-car":e.type==="lead"?e.task.requestedCar:null,"recommended-cars":[],onSave:ae,onClose:Z},null,8,["show","task-type","task-id","requested-car"]),q(Ne,{show:I.value,onClose:w[6]||(w[6]=$=>I.value=!1),onConfirm:D},null,8,["show"]),b.value?(l(),U(Fe,{key:0,show:b.value,customer:e.task.customer,assignee:e.task.assignee,"disabled-fields":["customer"],onCreate:u,onCancel:w[7]||(w[7]=$=>b.value=!1)},null,8,["show","customer","assignee"])):p("",!0),q(sn,{show:h.value,"existing-tags":e.task.tags||[],onClose:w[8]||(w[8]=$=>h.value=!1),onAdd:Ce},null,8,["show","existing-tags"])]))}},de={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:e=>e.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:e=>e.scheduledAppointment?`Scheduled for ${e.formatDateTime(e.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:e=>e.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:e=>e.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:e=>e.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:e=>{const m=e.deliverySubstatus;return m==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:m==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},le={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function R(e){if(!e)return 0;const m=new Date(e),n=Math.abs(new Date-m);return Math.ceil(n/(1e3*60*60*24))}const H={"no-appointment":e=>!e.scheduledAppointment,"has-appointment":e=>!!e.scheduledAppointment,"appointment-past-not-completed":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)<new Date&&e.scheduledAppointment.status!=="completed":!1,"has-future-appointment":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)>new Date:!1,"no-offers":e=>!e.hasOffers,"has-offers":e=>e.hasOffers,"qualified-no-offers-7-13-days":e=>{const m=L(),r=m.getSetting("oofbMinDays"),n=m.getSetting("oofbMaxDays"),f=R(e.opportunity.createdAt);return f>=r&&f<n+1&&!e.hasOffers},"qualified-no-offers-14-plus-days":e=>{const r=L().getSetting("ufbDays");return R(e.opportunity.createdAt)>=r&&!e.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const r=L().getSetting("ofbDays");return R(e.opportunity.lastActivity||e.opportunity.createdAt)>=r&&!e.opportunity.contractDate&&e.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const r=L().getSetting("nfuDays"),n=R(e.opportunity.lastActivity||e.opportunity.createdAt),f=e.scheduledAppointment&&new Date(e.scheduledAppointment.start)>new Date;return n>=r&&!e.opportunity.contractDate&&!f&&e.hasOffers},"contract-7-plus-days-no-delivery":e=>{var s;if(!e.opportunity.contractDate)return!1;const r=L().getSetting("cfbDays"),n=R(e.opportunity.contractDate),f=(s=e.activities)==null?void 0:s.some(y=>{var i;return y.type==="delivery"||((i=y.action)==null?void 0:i.toLowerCase().includes("delivered"))});return n>=r&&!f},"delivery-date-set":e=>!!e.opportunity.deliveryDate,"delivery-3-plus-days":e=>{var s;const m=(s=e.activities)==null?void 0:s.find(y=>{var i;return y.type==="delivery"||((i=y.action)==null?void 0:i.toLowerCase().includes("delivered"))});if(!m)return!1;const n=L().getSetting("dfbDays");return R(m.timestamp)>=n},"is-awaiting-delivery":e=>e.deliverySubstatus==="Awaiting Delivery","is-delivered":e=>e.deliverySubstatus==="Delivered","has-no-delivery":e=>!e.deliverySubstatus||e.deliverySubstatus===null,"is-closed":e=>{const m=e.stage;return m==="Closed Won"||m==="Closed Lost"},"is-closed-with-task-widget":e=>H["is-closed"](e)&&e.hasActiveTaskWidget,"opportunity-abandoned":e=>{if(H["is-closed"](e))return!1;const m=L(),r=m.getSetting("abandonedOpportunityDays");if(!m.getSetting("abandonedEligibleStages").includes(e.stage))return!1;const f=e.opportunity.lastActivity||e.opportunity.createdAt;return R(f)>=r}};function Tn(e,m){if(H["is-closed-with-task-widget"](m))return[le.reopen,le.requalify,le.closeLost];const r=de[e];return!r||!r.secondaryActions?[]:r.secondaryActions.filter(n=>{if(!n.conditional)return!0;const f=H[n.conditional];return f?f(m):!0})}function On(e,m){const r=de[e];if(!r||!r.taskWidgets)return null;const f=L().getSetting("autoCloseWidgetsOnClose"),s=H["is-closed"]({stage:e});for(const y of r.taskWidgets){if(f&&s&&(y.type==="NFU"||y.type==="OFB"))continue;const i=H[y.condition];if(i&&i(m))return y.type}return null}function In(e,m){const r=de[e];if(!r||!r.primaryAction)return null;const n=r.primaryAction;return{...n,title:typeof n.title=="function"?n.title(m):n.title,description:typeof n.description=="function"?n.description(m):n.description,label:typeof n.label=="function"?n.label(m):n.label}}function Vn(e){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[e]||"Task"}function Nn(e){return e==="Closed Won"||e==="Closed Lost"}const Fn={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(e,{emit:m}){const r=m,n=()=>{r("close")};return(f,s)=>(l(),U(G,{show:e.show,title:e.title,onClose:n,onCancel:n},{default:W(()=>[...s[0]||(s[0]=[t("div",{class:"py-8 flex items-center justify-center"},[t("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)])]),_:1},8,["show","title"]))}};export{us as _,In as a,Tn as b,Vn as c,Js as d,Fn as e,Dn as f,On as g,Nn as i};
