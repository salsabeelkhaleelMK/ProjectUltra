import{d as p,o as n,F as _,i as ee,n as R,e,_ as Fe,r as S,g as D,l as J,w as ue,y as K,z as W,T as Ke,c as V,A as ie,t as $,B as Z,C as me,D as Ne,E as z,m as H,u as Te,k as $e,G as de,j,H as ot,p as Y,I as qe,J as He,K as ze,h as Le,x as Re,L as Ge,M as Ie,N as lt,O as ye,P as nt,Q as Ve,R as at,S as it,U as rt}from"./index-BKcf9KHs.js";import{u as Ue}from"./opportunities-DSsbbxEq.js";import{u as Me}from"./users-J-IiIbb3.js";import{_ as dt}from"./PageHeader-shNadXGX.js";import{y as ut}from"./components-CiYM0QIO.js";import{g as je,f as Ae,a as ct,b as Ce,c as De,d as pt}from"./formatters-hBiVcbat.js";import{_ as mt,g as yt,a as gt,b as ft,i as vt,c as bt,d as xt,e as ht,f as Qe}from"./ComingSoonModal-DH_YKcKq.js";import{_ as wt}from"./CreateEventModal-C3AbBFzw.js";import{_ as Se}from"./ModalShell-B-Tai2ka.js";import{_ as kt,a as Ct}from"./EditEventModal-G4ljwgF3.js";import{_ as $t}from"./ReassignUserModal-ij2IFwkA.js";const St={class:"flex bg-gray-100 p-1 rounded-lg w-fit"},At=["onClick"],Je={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:o=>o.every(T=>T.value&&T.icon&&T.label)}},emits:["update:view"],setup(o){return(T,t)=>(n(),p("div",St,[(n(!0),p(_,null,ee(o.options,d=>(n(),p("button",{key:d.value,onClick:x=>T.$emit("update:view",d.value),class:R(["p-1.5 rounded-md transition-all duration-200",o.view===d.value?"bg-white shadow-sm text-gray-900":"text-gray-400 hover:text-gray-600"])},[e("i",{class:R([d.icon,"text-base"])},null,2)],10,At))),128))]))}},Dt={class:"flex items-center gap-2"},Tt={key:0,class:"flex gap-2"},Ot={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},It={key:0,class:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Vt={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0}},emits:["filter-change","sort-change"],setup(o,{emit:T}){const t=T,d=S(!1),x=()=>{d.value=!d.value},c=y=>{d.value=!1,t("sort-change",y)},g={mounted(y,b){y.clickOutsideEvent=f=>{y===f.target||y.contains(f.target)||b.value(f)},document.addEventListener("click",y.clickOutsideEvent)},unmounted(y){document.removeEventListener("click",y.clickOutsideEvent)}};return(y,b)=>(n(),p("div",Dt,[o.showTypeFilter?(n(),p("div",Tt,[e("button",{onClick:b[0]||(b[0]=f=>y.$emit("filter-change","all")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:b[1]||(b[1]=f=>y.$emit("filter-change","lead")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:b[2]||(b[2]=f=>y.$emit("filter-change","opportunity")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):D("",!0),e("div",{class:R(["relative",o.showTypeFilter?"ml-auto":""]),ref:"sortContainer"},[e("button",{onClick:ue(x,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[b[7]||(b[7]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),o.sortOption&&o.sortOption!=="recent-first"?(n(),p("span",Ot)):D("",!0)]),J(Ke,{name:"dropdown"},{default:K(()=>[d.value?W((n(),p("div",It,[e("button",{onClick:b[3]||(b[3]=f=>c("recent-first")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="recent-first"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="recent-first"?"opacity-100":"opacity-0"])},null,2),b[8]||(b[8]=e("span",null,"Most Recent First",-1))],2),e("button",{onClick:b[4]||(b[4]=f=>c("urgent-first")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="urgent-first"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="urgent-first"?"opacity-100":"opacity-0"])},null,2),b[9]||(b[9]=e("span",null,"Urgent first",-1))],2),e("button",{onClick:b[5]||(b[5]=f=>c("assigned-to-me")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-me"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-me"?"opacity-100":"opacity-0"])},null,2),b[10]||(b[10]=e("span",null,"Assigned to me",-1))],2),e("button",{onClick:b[6]||(b[6]=f=>c("assigned-to-my-team")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-my-team"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-my-team"?"opacity-100":"opacity-0"])},null,2),b[11]||(b[11]=e("span",null,"Assigned to my team",-1))],2)])),[[g,()=>d.value=!1]]):D("",!0)]),_:1})],2)]))}},Nt=Fe(Vt,[["__scopeId","data-v-59aa697a"]]),qt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},Ft={class:"px-4 md:px-8 py-4 md:py-6 border-b border-gray-100 bg-gray-50/50 shrink-0"},Lt={class:"flex items-center justify-between gap-3"},Rt={class:"flex items-center gap-3"},Ut={class:"page-header-title"},Mt={key:0,class:"hidden lg:flex"},jt={class:"px-5 py-3"},Bt={class:"relative"},Wt=["placeholder"],Et={key:0,class:"px-5 pb-3"},Pt=["onClick"],Ht={key:0,class:"absolute right-2 top-10 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},zt={class:"flex items-center justify-between border-b border-gray-100 p-2 bg-gray-50"},Qt={class:"flex gap-2"},Yt=["onClick"],Kt={class:"p-3 flex-1 flex flex-col justify-between"},Gt={class:"flex items-start gap-3 mb-3"},Jt={class:"flex-1 min-w-0"},Xt={class:"text-sm font-bold text-gray-900 truncate"},Zt={class:"text-[10px] text-gray-500"},_t={class:"space-y-1 mb-3"},es={class:"flex justify-between text-[10px]"},ts={class:"font-medium text-gray-700 truncate ml-2"},ss={class:"flex justify-between text-[10px]"},os={class:"font-medium text-gray-700"},ls={class:"border-t border-gray-100 pt-2 flex justify-between text-[9px] text-gray-400"},ns={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(o,{emit:T}){const t={mounted(l,w){l.clickOutsideEvent=u=>{l===u.target||l.contains(u.target)||w.value()},document.addEventListener("click",l.clickOutsideEvent)},unmounted(l){document.removeEventListener("click",l.clickOutsideEvent)}},d=o,x=T,c=S(""),g=S("none"),y=V(()=>{let l=d.items;if(d.typeFilter&&d.typeFilter!=="all"&&(l=l.filter(w=>w.type===d.typeFilter)),c.value){const w=c.value.toLowerCase();l=l.filter(u=>{const q=d.getName(u).toLowerCase(),A=d.getVehicleInfo(u).toLowerCase();return q.includes(w)||A.includes(w)})}return l}),b=l=>{const w=l.compositeId||`${l.type||"task"}-${l.id}`||l.id;return d.selectedId===w},f=l=>{g.value=l,x("sort-change",l)},v=S(null),m=S(null);return ie(()=>d.selectedId,async l=>{l&&m.value&&(await Ne(),m.value.scrollIntoView({behavior:"smooth",block:"nearest"}))},{immediate:!0}),ie(y,async()=>{d.selectedId&&m.value&&(await Ne(),setTimeout(()=>{m.value&&m.value.scrollIntoView({behavior:"smooth",block:"nearest"})},100))},{immediate:!0}),(l,w)=>(n(),p("div",qt,[e("div",Ft,[e("div",Lt,[e("div",Rt,[o.showMobileClose?(n(),p("button",{key:0,onClick:w[0]||(w[0]=u=>l.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...w[4]||(w[4]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):D("",!0),e("h2",Ut,$(o.title),1)]),o.viewMode?(n(),p("div",Mt,[J(Je,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-grip",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":w[1]||(w[1]=u=>l.$emit("view-change",u))},null,8,["view"])])):D("",!0)])]),e("div",jt,[e("div",Bt,[w[5]||(w[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),W(e("input",{"onUpdate:modelValue":w[2]||(w[2]=u=>c.value=u),type:"text",placeholder:o.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Wt),[[Z,c.value]])])]),o.showTypeFilter?(n(),p("div",Et,[J(Nt,{"type-filter":o.typeFilter,"sort-option":g.value,"show-type-filter":!0,onFilterChange:w[3]||(w[3]=u=>l.$emit("filter-change",u)),onSortChange:f},null,8,["type-filter","sort-option"])])):D("",!0),e("div",{ref_key:"scrollContainer",ref:v,class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},[(n(!0),p(_,null,ee(y.value,u=>(n(),p("div",{key:u.compositeId||`${u.type||"task"}-${u.id}`,ref_for:!0,ref:q=>{b(u)&&(m.value=q)},onClick:q=>l.$emit("select",u.compositeId||`${u.type||"task"}-${u.id}`||u.id),class:R(["card card-hover min-h-[11rem] flex flex-col overflow-hidden cursor-pointer relative",b(u)?typeof o.selectedClass=="function"?o.selectedClass(u):o.selectedClass:typeof o.unselectedClass=="function"?o.unselectedClass(u):o.unselectedClass])},[o.openMenuId===u.id&&o.showMenu?W((n(),p("div",Ht,[me(l.$slots,"menu",{item:u},void 0,!0)])),[[t,()=>l.$emit("menu-close")]]):D("",!0),e("div",zt,[e("div",Qt,[me(l.$slots,"badges",{item:u},void 0,!0)]),o.showMenu?(n(),p("button",{key:0,onClick:ue(q=>l.$emit("menu-click",u.id),["stop"]),class:"text-gray-400 hover:text-gray-600 transition-colors pr-2"},[...w[6]||(w[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Yt)):D("",!0)]),e("div",Kt,[e("div",Gt,[e("div",{class:R(["w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-bold shrink-0",o.avatarClass(u)])},$(o.getInitials(u)),3),e("div",Jt,[e("h3",Xt,$(o.getName(u)),1),e("p",Zt,[me(l.$slots,"location",{item:u},void 0,!0)])])]),e("div",_t,[e("div",es,[w[7]||(w[7]=e("span",{class:"text-gray-400"},"Car",-1)),e("span",ts,$(o.getVehicleInfo(u)),1)]),e("div",ss,[w[8]||(w[8]=e("span",{class:"text-gray-400"},"Status",-1)),e("span",os,[me(l.$slots,"vehicle-status",{item:u},void 0,!0)])])]),e("div",ls,[me(l.$slots,"owner",{item:u},void 0,!0),me(l.$slots,"dates",{item:u},void 0,!0)])])],10,Pt))),128))],512)]))}},as=Fe(ns,[["__scopeId","data-v-9815ca27"]]),is={class:"page-container flex-1 flex flex-col overflow-hidden w-full min-w-0"},rs={class:"flex-1 flex flex-col overflow-hidden p-4 md:p-8"},ds={class:"table-wrapper flex-1 w-full"},us={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","reassign","close","view-change"],setup(o,{emit:T}){const t=o,d=T;S("");const x=S({pageIndex:0,pageSize:10}),c=S(""),g=S([]),y=S([]);S({});const b=V(()=>{const A=[];return t.showTypeFilter&&A.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type"}),A.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"}],aiHint:"Lead status or opportunity stage"}),A.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"Hot"},{value:"Normal",label:"Normal"}]}),A}),f=V(()=>t.tasks),v=A=>A.compositeId===t.currentTaskId||A.compositeId===t.highlightId,m=A=>A.type==="lead"?A.requestedCar?`${A.requestedCar.brand} ${A.requestedCar.model}`:"No vehicle specified":A.vehicle?`${A.vehicle.brand} ${A.vehicle.model}`:"No vehicle specified",l=A=>{if(!A)return"Not set";const h=new Date,r=new Date(A),k=new Date(h.getFullYear(),h.getMonth(),h.getDate()),G=new Date(r.getFullYear(),r.getMonth(),r.getDate())-k,E=Math.ceil(G/(1e3*60*60*24));return E===0?"Today":E===1?"Tomorrow":E===-1?"Yesterday":E>1&&E<=7?`In ${E} days`:E<-1&&E>=-7?`${Math.abs(E)} days ago`:Ae(A)},w=V(()=>[{accessorKey:"customer",header:"Customer",meta:{title:"Customer",onOpen:A=>u(A.original)},cell:({row:A})=>{const h=A.original;return z("div",{class:"flex items-center gap-2 md:gap-3"},[z("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${h.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},h.customer.initials),z("div",{class:"min-w-0"},[z("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},h.customer.name),z("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},h.customer.email)])])}},{accessorKey:"vehicle",header:"Vehicle",meta:{title:"Vehicle"},cell:({row:A})=>{const h=A.original,r=t.getVehicleType(h);return z("div",{class:"flex items-center gap-2"},[z("div",{class:"min-w-0"},[z("div",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},m(h)),r?z("div",{class:"flex items-center gap-1 mt-0.5"},[z("span",{class:`text-[10px] font-medium px-1.5 py-0.5 rounded-md ${t.getVehicleTypeBadgeClass(r)}`},r.label)]):null])])}},{accessorKey:"type",header:"Type",meta:{title:"Type"},cell:({row:A})=>{const h=A.original,r=h.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return z("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${r}`},h.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"stage",header:"Stage/Status",meta:{title:"Stage/Status"},cell:({row:A})=>{const h=A.original,r=h.type==="lead"?h.status:h.displayStage||h.stage,k=t.getStageBadgeClass(r);return z("div",{class:"flex flex-col gap-1"},[z("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${k}`},r),h.type==="lead"&&h.priority==="Hot"?z("span",{class:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold bg-red-50 text-red-700 w-fit"},[z("i",{class:"fa-solid fa-fire text-[9px]"}),"Hot"]):null])}},{accessorKey:"nextActionDue",header:"Next Action",meta:{title:"Next Action"},cell:({row:A})=>{const h=A.original;if(!h.nextActionDue)return"-";const r=je(h.nextActionDue);return z("div",{class:"text-sm"},[z("div",{class:`font-medium mb-0.5 ${r.textClass}`},Ae(h.nextActionDue)),z("div",{class:`text-xs flex items-center gap-1 ${r.textClass}`},[r.icon?z("i",{class:`fa-solid ${r.icon} text-[10px]`}):null,z("span",l(h.nextActionDue))])])}},{accessorKey:"owner",header:"Owner",meta:{title:"Owner"},cell:({row:A})=>{const h=A.original,r=t.getOwnerInfo(h);return z("div",{class:"flex items-center gap-2"},[z("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},r.initials),z("span",{class:"text-sm text-gray-600 truncate max-w-[80px]"},r.name)])}},{accessorKey:"value",header:"Value",meta:{title:"Value"},cell:({row:A})=>{const h=A.original;return h.type==="opportunity"?z("div",{class:"text-sm font-semibold text-gray-900"},`â‚¬${ct(h.value)}`):z("div",{class:"text-gray-400"},"-")}},{id:"actions",header:"",meta:{title:"Actions"},cell:({row:A})=>{const h=A.original;return z("button",{class:"text-gray-400 hover:text-gray-600",onClick:r=>{r.stopPropagation(),d("menu-click",h.id)}},[z("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),u=A=>{d("select",A.compositeId)},q=V(()=>({class:{tr:A=>{const h="cursor-pointer hover:bg-gray-50 transition-colors",r=A.original;return v(r)?`${h} bg-blue-50 border-l-4 border-l-blue-500`:h}}}));return ie(()=>[t.highlightId,t.tasks],async([A])=>{A&&t.tasks.length>0&&(await Ne(),setTimeout(()=>{var M,G;const h=document.querySelector(".table-wrapper");if(!h)return;const r=t.tasks.find(E=>E.compositeId===A);if(!r)return;const k=(M=r.customer)==null?void 0:M.name;if(k){const E=h.querySelectorAll('tbody tr, [role="row"]');for(const Q of E)if((G=Q.textContent)!=null&&G.includes(k)){Q.scrollIntoView({behavior:"smooth",block:"nearest"});break}}},500))},{immediate:!0}),(A,h)=>(n(),p("div",is,[J(dt,{title:"Tasks",subtitle:"Manage your leads and opportunities"},{actions:K(()=>[J(Je,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-list",label:"Cards"},{value:"table",icon:"fa-solid fa-table",label:"Table"}],"onUpdate:view":h[0]||(h[0]=r=>A.$emit("view-change",r))},null,8,["view"])]),_:1}),e("div",rs,[e("div",ds,[J(H(ut),{data:f.value,columns:w.value,meta:q.value,onRowClick:u,columnFiltersOptions:{filterDefs:b.value},pagination:x.value,"onUpdate:pagination":h[1]||(h[1]=r=>x.value=r),globalFilter:c.value,"onUpdate:globalFilter":h[2]||(h[2]=r=>c.value=r),sorting:g.value,"onUpdate:sorting":h[3]||(h[3]=r=>g.value=r),columnFilters:y.value,"onUpdate:columnFilters":h[4]||(h[4]=r=>y.value=r),paginationOptions:{rowCount:f.value.length},globalFilterOptions:{debounce:300}},null,8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},cs={key:0,class:"space-y-4 animate-fade-in"},ps={label:"Teams"},ms=["value"],ys={label:"Users"},gs=["value"],fs={key:0,class:"text-xs text-gray-500 mt-1"},vs={key:0,class:"animate-fade-in"},bs={class:"grid grid-cols-4 gap-2"},xs=["onClick"],hs={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,d=T,x=Te(),c=Me(),g=S(""),y=S(null),b=S(""),f=S(!1),v=S(""),m=V(()=>c.assignableUsers),l=V(()=>c.assignableTeams),w=V(()=>y.value&&y.value.startsWith("team-"));$e(()=>{var h;y.value=`user-${((h=x.currentUser)==null?void 0:h.id)||1}`}),ie(()=>t.show,h=>{h||u()});const u=()=>{var h;g.value="",y.value=`user-${((h=x.currentUser)==null?void 0:h.id)||1}`,b.value="",f.value=!1,v.value=""},q=()=>{if(!g.value||!b.value||!v.value||!y.value)return;const h=y.value.startsWith("team-"),r=parseInt(y.value.split("-")[1]);let k={};if(h){const M=c.getTeamById(r);k={assigneeType:"team",teamId:r,team:(M==null?void 0:M.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const M=c.getUserById(r);k={assigneeType:"user",assigneeId:r,assignee:(M==null?void 0:M.name)||"Unknown",teamId:null,team:null}}d("confirm",{type:g.value,date:b.value,time:v.value,...k}),u()},A=()=>{u(),d("cancel")};return(h,r)=>o.show?(n(),p("div",cs,[e("div",null,[r[5]||(r[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),W(e("select",{"onUpdate:modelValue":r[0]||(r[0]=k=>g.value=k),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...r[4]||(r[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[de,g.value]])]),e("div",null,[r[7]||(r[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),W(e("select",{"onUpdate:modelValue":r[1]||(r[1]=k=>y.value=k),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[e("optgroup",ps,[(n(!0),p(_,null,ee(l.value,k=>(n(),p("option",{key:`team-${k.id}`,value:`team-${k.id}`},$(k.name)+" Team ",9,ms))),128))]),e("optgroup",ys,[(n(!0),p(_,null,ee(m.value,k=>{var M;return n(),p("option",{key:`user-${k.id}`,value:`user-${k.id}`},$(k.name)+$(k.id===((M=H(x).currentUser)==null?void 0:M.id)?" (Me)":""),9,gs)}),128))])],512),[[de,y.value]]),w.value?(n(),p("p",fs,[...r[6]||(r[6]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),j(" Any available team member will be assigned ",-1)])])):D("",!0)]),e("div",null,[r[8]||(r[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":r[2]||(r[2]=k=>b.value=k),onChange:r[3]||(r[3]=k=>f.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[Z,b.value]])]),f.value?(n(),p("div",vs,[r[9]||(r[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",bs,[(n(),p(_,null,ee(["09:00","10:30","11:00","14:30","15:00","16:30"],k=>e("button",{key:k,onClick:M=>v.value=k,class:R(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",v.value===k?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},$(k),11,xs)),64))])])):D("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:A,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:q,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...r[10]||(r[10]=[j(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):D("",!0)}},ws={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},ks={key:0,class:"flex justify-between items-center mb-4"},Cs={class:"font-semibold text-slate-800 text-sm"},$s={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(o){return(T,t)=>(n(),p("div",ws,[o.title?(n(),p("div",ks,[e("h5",Cs,$(o.title),1),o.showClose?(n(),p("button",{key:0,onClick:t[0]||(t[0]=d=>T.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[1]||(t[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):D("",!0)])):D("",!0),me(T.$slots,"default")]))}},Ss={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},As={class:"flex justify-between items-start mb-3"},Ds={class:"font-bold text-slate-800 text-sm"},Ts={class:"text-xs text-gray-500 mt-0.5"},Os={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},Is={class:"text-xs text-blue-700"},Vs={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},Ns={class:"flex items-center justify-between"},qs={class:"flex items-center gap-2"},Fs={class:"text-xs font-bold text-slate-800"},Ls={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},Rs={class:"flex items-center gap-2 mb-3"},Us={class:"text-sm text-slate-700 font-medium"},Ms={key:2,class:"flex gap-2 items-center mb-4"},js=["disabled"],Bs={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Ws=["disabled"],Es={key:3,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Ps={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Hs={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},zs={class:"flex items-center gap-2 text-red-400"},Qs={class:"text-xs font-mono"},Ys={class:"space-y-3 text-sm font-mono"},Ks={class:"ml-2"},Gs={class:"ml-2"},Js={key:0},Xs={class:"ml-2"},Zs={key:1},_s={class:"ml-2"},eo={key:2},to={class:"ml-2"},so={class:"mt-4 pt-4 border-t border-slate-700"},oo={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},lo={key:4,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},no={class:"grid grid-cols-3 gap-2"},ao={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},io={class:"grid grid-cols-4 gap-2"},ro=["onClick"],uo={key:0},co={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},po={class:"text-xs text-slate-700"},mo={class:"grid grid-cols-3 gap-2"},yo={key:0,class:"mt-3 grid grid-cols-2 gap-3"},go={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},fo={class:"flex gap-4"},vo={class:"flex items-center gap-2 cursor-pointer"},bo={class:"flex items-center gap-2 cursor-pointer"},xo={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},ho=["disabled"],wo={key:2,class:"space-y-4"},ko={class:"bg-white border border-gray-200 rounded-lg p-4"},Co={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},$o=["value"],So=["value"],Ao=["value"],Do={class:"bg-white border border-gray-200 rounded-lg p-4"},To={class:"flex gap-2"},Oo={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Io={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Vo={class:"ml-2 font-medium text-slate-800"},No={class:"ml-2 font-medium text-slate-800"},qo={class:"ml-2 font-medium text-slate-800 capitalize"},Fo={class:"ml-2 font-medium text-slate-800"},Lo={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},Ro={class:"space-y-2"},Uo=["checked"],Mo=["checked","disabled"],jo={class:"flex-1"},Bo={class:"text-xs text-gray-500 mt-0.5"},Wo={class:"space-y-3"},Eo={class:"grid grid-cols-2 gap-3 text-sm"},Po={class:"ml-2 font-medium text-slate-800"},Ho={class:"ml-2 font-medium text-slate-800"},zo={class:"ml-2 font-medium text-slate-800 capitalize"},Qo={class:"ml-2 font-medium text-slate-800"},Yo={key:0,class:"text-sm"},Ko={class:"ml-2 font-medium text-slate-800"},Go={key:1,class:"text-sm"},Jo={class:"mt-1 text-slate-700"},Xo={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Zo={class:"p-6"},_o={class:"flex justify-between items-center mb-4"},el={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},tl={class:"p-6"},sl={class:"flex justify-between items-center mb-4"},ol={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(o,{emit:T}){var Be,We,Ee;const t=o,d=T,x=Me(),c=Te(),g=S(!1),y=S(!1),b=S(0),f=S(""),v=S(null),m=S(!1),l=S(null),w=S(!1),u=S(!1),q=S(!1),A=S(null),h=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],r=S("whatsapp"),k=S("followup-1"),M=S("custom"),G=S(""),E=S("09:00"),Q=S("Not Interested"),I=S(""),F=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],P=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],le=V(()=>x.assignableUsers),ce=V(()=>c.currentUser),oe=S({dealership:((We=(Be=t.lead)==null?void 0:Be.requestedCar)==null?void 0:We.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Ee=ce.value)==null?void 0:Ee.id)||1}),re=S({tradeIn:!1,financing:!1,contactAvailability:!1}),X=S({}),ne=S(null);$e(()=>{const L=t.lead.displayStage||t.lead.stage;(L==="Valid"||L==="Validated")&&(l.value="interested",m.value=!0)});const te={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},fe=V(()=>{const L=Math.floor(b.value/60),s=b.value%60;return`${L.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}),pe=V(()=>{const L=t.lead.displayStage||t.lead.stage;return L==="Valid"||L==="Validated"?"Lead Validated":t.lead.callbackDate||t.lead.callbackScheduled?"Call Prospect":"Call to Verify Contact Details"}),ve=V(()=>{const L=t.lead.displayStage||t.lead.stage;return L==="Valid"||L==="Validated"?"Lead is validated. Complete conversion details to create opportunity.":t.lead.callbackDate||t.lead.callbackScheduled?"Customer requested a callback. Make the call at scheduled time.":"Begin lead qualification by verifying customer contact information."}),we=V(()=>t.lead.scheduledAppointment?new Date(t.lead.scheduledAppointment.start)<new Date:!1),be=V(()=>!!t.lead.scheduledAppointment),xe=V(()=>be.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:we.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),ae=V(()=>{var L;return((L=t.lead.contactAttempts)==null?void 0:L.length)||0});V(()=>t.activities.filter(L=>L.type==="note"));const a={"followup-1":`Hi ${t.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}?`,"followup-2":`Hello ${t.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},i=V(()=>k.value==="custom"?"Type your custom message...":a[k.value]),O=()=>{g.value=!0,b.value=0,y.value=!1,f.value="",v.value=setInterval(()=>{b.value++,b.value>=20&&U()},1e3)},U=()=>{v.value&&(clearInterval(v.value),v.value=null),g.value=!1,y.value=!0,X.value={duration:b.value,notes:f.value,transcription:te,channel:"phone"},m.value=!0},C=async()=>{try{await navigator.clipboard.writeText(t.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(L){console.error("Failed to copy:",L)}},B=()=>{ne.value={tradeIn:te.leadLines.some(L=>L.toLowerCase().includes("trade")||L.toLowerCase().includes("exchange"))||!1,financing:te.leadLines.some(L=>L.toLowerCase().includes("financ")||L.toLowerCase().includes("payment")||L.toLowerCase().includes("loan"))||!1},ne.value.tradeIn&&(re.value.tradeIn=!0),ne.value.financing&&(re.value.financing=!0),m.value=!0,y.value=!1},se=async L=>{A.value=L,q.value=!0,u.value=!1,d("appointment-scheduled",L)},ke=()=>{const L={timestamp:new Date().toISOString(),outcome:"interested",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};d("call-attempt-logged",L),d("validated",{scheduleFollowUp:!1}),d("qualified",{assignment:oe.value,preferences:re.value,scheduleAppointment:q.value,appointmentData:A.value}),he()},Xe=()=>{const L={timestamp:new Date().toISOString(),outcome:"interested",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};d("call-attempt-logged",L),l.value="not-valid"},Ze=()=>{X.value={channel:"external",notes:"",transcription:null},m.value=!0},Oe=L=>{l.value=L,L==="interested"&&ne.value&&(re.value.tradeIn=ne.value.tradeIn||!1,re.value.financing=ne.value.financing||!1)},he=()=>{l.value=null,m.value=!1,q.value=!1,A.value=null},_e=()=>{if(M.value==="tomorrow-9am"){const s=new Date;return s.setDate(s.getDate()+1),s.setHours(9,0,0,0),s.toISOString()}else if(M.value==="monday"){const s=new Date,N=(8-s.getDay())%7||7;return s.setDate(s.getDate()+N),s.setHours(9,0,0,0),s.toISOString()}else if(M.value==="custom"&&G.value&&E.value)return new Date(`${G.value}T${E.value}:00`).toISOString();const L=new Date;return L.setDate(L.getDate()+1),L.setHours(9,0,0,0),L.toISOString()},et=async()=>{const L={timestamp:new Date().toISOString(),outcome:"no-answer",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};d("call-attempt-logged",L),r.value&&r.value;const s=_e(),N=s.split("T")[0],Pe=new Date(s).toTimeString().slice(0,5);d("postponed",{date:N,time:Pe,createAppointment:!0}),ae.value+1>=5&&d("disqualified",{category:"Not Interested",reason:"Unreachable"}),he()},tt=()=>{const L={timestamp:new Date().toISOString(),outcome:"not-valid",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};d("call-attempt-logged",L),d("disqualified",{category:Q.value,reason:I.value}),he()},st=L=>{w.value=!1,d("note-saved",L)};return ot(()=>{v.value&&clearInterval(v.value)}),(L,s)=>(n(),p("div",Ss,[e("div",As,[e("div",null,[e("h4",Ds,$(pe.value),1),e("p",Ts,$(ve.value),1)]),e("div",{class:R(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",xe.value.class])},$(xe.value.text),3)]),be.value?(n(),p("div",Os,[s[29]||(s[29]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",Is,$(H(Ce)(o.lead.scheduledAppointment.start))+" at "+$(H(De)(o.lead.scheduledAppointment.start)),1)])):D("",!0),ae.value>0?(n(),p("div",Vs,[e("div",Ns,[e("div",qs,[s[30]||(s[30]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),s[31]||(s[31]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",Fs,$(ae.value)+" / 5",1)]),ae.value>=4?(n(),p("div",Ls,[...s[32]||(s[32]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),j(" One more attempt before auto-disqualification ",-1)])])):D("",!0)])])):D("",!0),e("div",Rs,[e("span",Us,$(o.lead.customer.phone),1),e("button",{onClick:C,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...s[33]||(s[33]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),!m.value&&!g.value&&!y.value?(n(),p("div",Ms,[e("button",{onClick:O,disabled:g.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[s[34]||(s[34]=e("i",{class:"fa-solid fa-phone"},null,-1)),j(" "+$(ae.value>0?"Call Again":"Initiate Call")+" ",1),ae.value>0?(n(),p("span",Bs,$(ae.value+1)+"/5 ",1)):D("",!0)],8,js),e("button",{onClick:Ze,disabled:g.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[35]||(s[35]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),j(" Log Call Outcome ",-1)])],8,Ws)])):D("",!0),g.value||y.value?(n(),p("div",Es,[g.value?(n(),p("div",Ps,[e("div",Hs,[s[37]||(s[37]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",zs,[s[36]||(s[36]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Qs,"REC "+$(fe.value),1)])]),e("div",Ys,[e("div",null,[s[38]||(s[38]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ks,$(te.leadLines[0]),1)]),e("div",null,[s[39]||(s[39]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Gs,$(te.salesLines[0]),1)]),b.value>=5?(n(),p("div",Js,[s[40]||(s[40]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Xs,$(te.leadLines[1]),1)])):D("",!0),b.value>=8?(n(),p("div",Zs,[s[41]||(s[41]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",_s,$(te.salesLines[1]),1)])):D("",!0),b.value>=12?(n(),p("div",eo,[s[42]||(s[42]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",to,$(te.leadLines[2]),1)])):D("",!0)]),e("div",so,[W(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=N=>f.value=N),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[Z,f.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:U,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[43]||(s[43]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),j(" End Call ",-1)])])])])):D("",!0),y.value&&!g.value?(n(),p("div",oo,[e("div",{class:"flex items-center justify-between"},[s[45]||(s[45]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:B,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[44]||(s[44]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),j(" Extract information ",-1)])])])])):D("",!0)])):D("",!0),m.value?(n(),p("div",lo,[e("div",null,[s[49]||(s[49]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",no,[e("button",{onClick:s[1]||(s[1]=N=>Oe("no-answer")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[46]||(s[46]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:s[2]||(s[2]=N=>Oe("not-valid")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[47]||(s[47]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:s[3]||(s[3]=N=>Oe("interested")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[48]||(s[48]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),l.value==="no-answer"?(n(),p("div",ao,[s[57]||(s[57]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",io,[(n(),p(_,null,ee(h,N=>e("button",{key:N.value,onClick:Pe=>r.value=N.value,class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",r.value===N.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},$(N.label),11,ro)),64))]),r.value&&r.value!=="dont-send"?(n(),p("div",uo,[s[52]||(s[52]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),W(e("select",{"onUpdate:modelValue":s[4]||(s[4]=N=>k.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...s[50]||(s[50]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[de,k.value]]),e("div",co,[s[51]||(s[51]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",po,$(i.value),1)])])):D("",!0),e("div",null,[s[55]||(s[55]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",mo,[e("button",{onClick:s[5]||(s[5]=N=>M.value="tomorrow-9am"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",M.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:s[6]||(s[6]=N=>M.value="monday"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",M.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:s[7]||(s[7]=N=>M.value="custom"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",M.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),M.value==="custom"?(n(),p("div",yo,[e("div",null,[s[53]||(s[53]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":s[8]||(s[8]=N=>G.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[Z,G.value]])]),e("div",null,[s[54]||(s[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),W(e("input",{type:"time","onUpdate:modelValue":s[9]||(s[9]=N=>E.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[Z,E.value]])])])):D("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:he,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:et,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[56]||(s[56]=[j(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):D("",!0),l.value==="not-valid"?(n(),p("div",go,[e("div",null,[s[60]||(s[60]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",fo,[e("label",vo,[W(e("input",{type:"radio","onUpdate:modelValue":s[10]||(s[10]=N=>Q.value=N),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[qe,Q.value]]),s[58]||(s[58]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",bo,[W(e("input",{type:"radio","onUpdate:modelValue":s[11]||(s[11]=N=>Q.value=N),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[qe,Q.value]]),s[59]||(s[59]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[s[62]||(s[62]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),W(e("select",{"onUpdate:modelValue":s[12]||(s[12]=N=>I.value=N),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...s[61]||(s[61]=[He('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[de,I.value]])]),e("div",xo,[e("button",{onClick:he,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:tt,disabled:!Q.value||!I.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,ho)])])):D("",!0),l.value==="interested"?(n(),p("div",wo,[e("div",ko,[s[66]||(s[66]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",Co,[e("div",null,[s[63]||(s[63]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),W(e("select",{"onUpdate:modelValue":s[13]||(s[13]=N=>oe.value.dealership=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(n(),p(_,null,ee(F,N=>e("option",{key:N,value:N},$(N),9,$o)),64))],512),[[de,oe.value.dealership]])]),e("div",null,[s[64]||(s[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),W(e("select",{"onUpdate:modelValue":s[14]||(s[14]=N=>oe.value.team=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(n(),p(_,null,ee(P,N=>e("option",{key:N,value:N},$(N),9,So)),64))],512),[[de,oe.value.team]])]),e("div",null,[s[65]||(s[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),W(e("select",{"onUpdate:modelValue":s[15]||(s[15]=N=>oe.value.assigneeId=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(n(!0),p(_,null,ee(le.value,N=>(n(),p("option",{key:N.id,value:N.id},$(N.name)+$(N.id===ce.value.id?" (Me)":""),9,Ao))),128))],512),[[de,oe.value.assigneeId]])])])]),e("div",Do,[s[70]||(s[70]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",To,[e("button",{onClick:s[16]||(s[16]=N=>d("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[67]||(s[67]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),j(" Add purchase method ",-1)])]),e("button",{onClick:s[17]||(s[17]=N=>d("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[68]||(s[68]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),j(" Add trade-in ",-1)])]),e("button",{onClick:s[18]||(s[18]=N=>w.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[69]||(s[69]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),j(" Add note ",-1)])])])]),L.hasExistingAppointment&&!q.value?(n(),p("div",Oo,[s[76]||(s[76]=He('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Io,[e("div",null,[s[71]||(s[71]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Vo,$(H(Ce)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[72]||(s[72]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",No,$(H(De)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[73]||(s[73]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",qo,$(o.lead.scheduledAppointment.type),1)]),e("div",null,[s[74]||(s[74]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Fo,$(o.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:s[19]||(s[19]=N=>u.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[75]||(s[75]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),j(" Reschedule Appointment ",-1)])])])):D("",!0),L.hasExistingAppointment?D("",!0):(n(),p("div",Lo,[s[79]||(s[79]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",Ro,[e("label",{class:R(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!q.value}])},[e("input",{type:"radio",checked:!q.value,onChange:s[20]||(s[20]=()=>{q.value=!1,A.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Uo),s[77]||(s[77]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:R(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":q.value}]),onClick:s[22]||(s[22]=N=>!q.value&&(u.value=!0))},[e("input",{type:"radio",checked:q.value,disabled:!q.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Mo),e("div",jo,[s[78]||(s[78]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",Bo,$(q.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),q.value?(n(),p("button",{key:0,onClick:s[21]||(s[21]=ue(N=>u.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):D("",!0)],2)])])),q.value?(n(),Y($s,{key:2,title:"Scheduled Appointment","show-close":!1},{default:K(()=>[e("div",Wo,[e("div",Eo,[e("div",null,[s[80]||(s[80]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Po,$(H(Ce)(A.value.datetime)),1)]),e("div",null,[s[81]||(s[81]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Ho,$(A.value.time),1)]),e("div",null,[s[82]||(s[82]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",zo,$(A.value.type),1)]),e("div",null,[s[83]||(s[83]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Qo,$(A.value.assignee),1)])]),A.value.location?(n(),p("div",Yo,[s[84]||(s[84]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",Ko,$(A.value.location),1)])):D("",!0),A.value.notes?(n(),p("div",Go,[s[85]||(s[85]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",Jo,$(A.value.notes),1)])):D("",!0)])]),_:1})):D("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:he,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:Xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...s[86]||(s[86]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),j(" Disqualify ",-1)])]),e("button",{onClick:ke,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[87]||(s[87]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),j(" Qualify ",-1)])])])])])):D("",!0)])):D("",!0),(n(),Y(ze,{to:"body"},[w.value?(n(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[25]||(s[25]=ue(N=>w.value=!1,["self"]))},[e("div",Xo,[e("div",Zo,[e("div",_o,[s[89]||(s[89]=e("h5",{class:"text-sm font-bold text-slate-800"},"Add Note",-1)),e("button",{onClick:s[23]||(s[23]=N=>w.value=!1),class:"text-gray-400 hover:text-gray-600"},[...s[88]||(s[88]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),J(mt,{item:null,"task-type":"lead","task-id":o.lead.id,borderless:!1,onSave:st,onCancel:s[24]||(s[24]=N=>w.value=!1)},null,8,["task-id"])])])])):D("",!0)])),(n(),Y(ze,{to:"body"},[u.value?(n(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[28]||(s[28]=ue(N=>u.value=!1,["self"]))},[e("div",el,[e("div",tl,[e("div",sl,[s[91]||(s[91]=e("h5",{class:"text-sm font-bold text-slate-800"},"Schedule Appointment",-1)),e("button",{onClick:s[26]||(s[26]=N=>u.value=!1),class:"text-gray-400 hover:text-gray-600"},[...s[90]||(s[90]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),J(hs,{show:!0,onConfirm:se,onCancel:s[27]||(s[27]=N=>u.value=!1)})])])])):D("",!0)]))]))}},ll={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm"},nl={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},al={class:"flex items-center gap-3"},il={class:"flex-1"},rl={key:0,class:"text-xs font-normal opacity-75"},dl={class:"p-5 space-y-6"},ul={key:1,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},cl={class:"flex justify-between items-start mb-3"},pl={class:"text-xs text-gray-500 mt-0.5"},ml={key:0},yl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(o,{emit:T}){const t=o,d=T,x=Le(),c=Re(),g=Te(),y=S(new Set),b=V(()=>y.value.has(t.lead.id)),f=()=>{y.value.add(t.lead.id)},v=V(()=>je(t.lead.nextActionDue)),m=V(()=>{var I,F;return((I=t.lead)==null?void 0:I.displayStage)||((F=t.lead)==null?void 0:F.stage)||"New Lead"}),l=V(()=>Ge(m.value,"lead"));V(()=>(t.lead.contactAttempts||[]).length||0),V(()=>t.lead.isDisqualified||m.value.startsWith("Closed"));const w=V(()=>m.value.startsWith("Closed"));async function u(I){try{const F=new Date(`${I.date}T${I.time}:00`),P=F.toISOString();await c.modifyLead(t.lead.id,{nextActionDue:P}),await c.addActivity(t.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ce(F)} at ${De(F)}`}),await c.loadLeadById(t.lead.id)}catch(F){console.error("Failed to postpone lead task:",F)}}async function q(I){try{if(await c.modifyLead(t.lead.id,{stage:"Validated"}),await c.addActivity(t.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),I.scheduleFollowUp&&I.appointmentData){const F=new Date(`${I.appointmentData.date}T${I.appointmentData.time}:00`);await c.scheduleFollowUp(t.lead.id,{dateTime:F.toISOString(),assignee:I.appointmentData.assignee||t.lead.assignee,assigneeId:I.appointmentData.assigneeId||null,assigneeType:I.appointmentData.assigneeType||"user",teamId:I.appointmentData.teamId||null,team:I.appointmentData.team||null}),await c.addActivity(t.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ce(F)} at ${De(F)}`})}await c.loadLeadById(t.lead.id)}catch(F){console.error("Failed to validate lead:",F)}}async function A(){try{const I=await c.convertLeadToOpportunity(t.lead.id);g.canAccessOpportunities()?x.push({path:`/tasks/${I}`,query:{type:"opportunity"}}):x.push("/tasks/1")}catch(I){console.error("Failed to qualify lead:",I)}}async function h(I){try{const F=t.lead.contactAttempts||[];await c.modifyLead(t.lead.id,{contactAttempts:[...F,I],lastContactAttempt:I.timestamp,totalContactAttempts:F.length+1}),await c.addActivity(t.lead.id,{type:"call",user:"You",action:`logged call attempt - ${I.outcome}`,content:I.notes||`Call attempt via ${I.channel}`,data:{outcome:I.outcome,channel:I.channel,duration:I.duration}}),await c.loadLeadById(t.lead.id)}catch(F){console.error("Failed to log call attempt:",F)}}async function r(I){try{await c.addActivity(t.lead.id,{type:"note",user:"You",action:"added a note",content:I.content||I.text||"",data:I}),await c.loadLeadById(t.lead.id)}catch(F){console.error("Failed to save note:",F)}}function k(){d("open-purchase-method")}function M(){d("open-trade-in")}async function G(I){var F;try{const P=`${I.date}T${I.time}:00`,le=new Date(P);le.setHours(le.getHours()+1),await c.modifyLead(t.lead.id,{scheduledAppointment:{id:Date.now(),title:`${I.type} - ${t.lead.customer.name}`,start:P,end:le.toISOString(),type:I.type,assignee:I.assignee,assigneeId:I.assigneeId,status:"scheduled",location:I.location||"",notes:I.notes||""}}),await c.addActivity(t.lead.id,{type:"appointment",user:((F=g.currentUser)==null?void 0:F.name)||"You",action:"scheduled an appointment",content:`${I.type} scheduled for ${I.date} at ${I.time}`,data:{type:I.type,date:I.date,time:I.time,assignee:I.assignee}}),await c.loadLeadById(t.lead.id)}catch(P){console.error("Failed to schedule appointment:",P)}}async function E(I){try{const F=I.reason==="Duplicate";await c.modifyLead(t.lead.id,{isDisqualified:!0,disqualifyReason:I.reason,isDuplicate:F,stage:F?"Closed Failed":"Not Valid",status:"Disqualified"}),await c.addActivity(t.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${I.category}, Reason: ${I.reason}`}),x.push("/tasks")}catch(F){console.error("Failed to disqualify lead:",F)}}async function Q(){try{await c.modifyLead(t.lead.id,{isDisqualified:!1,disqualifyReason:null,stage:"Open Lead",status:"Open"}),await c.addActivity(t.lead.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}),await c.loadLeadById(t.lead.id)}catch(I){console.error("Failed to reopen lead:",I)}}return(I,F)=>o.lead?(n(),p("div",ll,[e("div",nl,[F[0]||(F[0]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:R(["text-xs px-3 py-1 rounded-full font-medium border",l.value])},$(m.value),3)]),o.lead.nextActionDue&&!b.value&&(v.value.type==="overdue"||v.value.type==="urgent")?(n(),p("div",{key:0,class:R(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[v.value.bgClass,v.value.borderClass]])},[e("div",al,[e("div",{class:R(["w-9 h-9 rounded-lg flex items-center justify-center",[v.value.bgClass,v.value.borderClass,"border"]])},[e("i",{class:R(["text-base",[`fa-solid ${v.value.icon}`,v.value.textClass]])},null,2)],2),e("div",il,[F[1]||(F[1]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:R(["text-sm font-bold",v.value.textClass])},[j($(H(Ae)(o.lead.nextActionDue))+" ",1),v.value.type!=="overdue"?(n(),p("span",rl," ("+$(H(pt)(o.lead.nextActionDue))+") ",1)):D("",!0)],2)]),v.value.type==="overdue"?(n(),p("div",{key:0,class:R(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[v.value.bgClass,v.value.textClass,v.value.borderClass,"border"]])},[...F[2]||(F[2]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),j(" Overdue ",-1)])],2)):v.value.type==="urgent"?(n(),p("div",{key:1,class:R(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[v.value.bgClass,v.value.textClass,v.value.borderClass,"border"]])},[...F[3]||(F[3]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),j(" Urgent ",-1)])],2)):D("",!0)]),e("button",{onClick:f,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...F[4]||(F[4]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):D("",!0),e("div",dl,[w.value?(n(),p("div",ul,[e("div",cl,[e("div",null,[F[5]||(F[5]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Closed",-1)),e("p",pl,[j(" Status: "+$(m.value)+" ",1),o.lead.disqualifyReason?(n(),p("span",ml," - "+$(o.lead.disqualifyReason),1)):D("",!0)])])]),e("button",{onClick:Q,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...F[6]||(F[6]=[j(" Reopen Lead ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):(n(),Y(ol,{key:0,lead:o.lead,onPostponed:u,onValidated:q,onQualified:A,onDisqualified:E,onCallAttemptLogged:h,onNoteSaved:r,onOpenPurchaseMethod:k,onOpenTradeIn:M,onAppointmentScheduled:G},null,8,["lead"]))])])):D("",!0)}},gl={class:"mt-1.5 border-t border-gray-200 pt-1.5"},fl={key:1},vl={class:"flex items-center justify-between mb-1.5"},bl={class:"space-y-1.5"},xl={class:"block label-upper mb-1"},hl=["onUpdate:modelValue","placeholder"],wl=["onUpdate:modelValue"],kl=["value"],Cl={key:2,class:"space-y-0.5"},$l=["onUpdate:modelValue","value"],ge={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=S(!1),c=S({});ie(()=>t.questions,v=>{const m={};v.forEach(l=>{m[l.key]=""}),c.value=m},{immediate:!0});const g=()=>{d("survey-completed",{...c.value}),f()},y=()=>{d("survey-refused"),f()},b=()=>{d("not-responding"),f()},f=()=>{x.value=!1;const v={};t.questions.forEach(m=>{v[m.key]=""}),c.value=v};return(v,m)=>(n(),p("div",gl,[x.value?(n(),p("div",fl,[e("div",vl,[m[4]||(m[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:m[1]||(m[1]=l=>x.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...m[3]||(m[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",bl,[(n(!0),p(_,null,ee(o.questions,(l,w)=>(n(),p("div",{key:w,class:"bg-gray-50 rounded-md p-1.5"},[e("label",xl,$(l.label),1),l.type==="text"?W((n(),p("textarea",{key:0,"onUpdate:modelValue":u=>c.value[l.key]=u,placeholder:l.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,hl)),[[Z,c.value[l.key]]]):l.type==="select"?W((n(),p("select",{key:1,"onUpdate:modelValue":u=>c.value[l.key]=u,class:"input text-xs py-1 px-2"},[m[5]||(m[5]=e("option",{value:""},"Select an option...",-1)),(n(!0),p(_,null,ee(l.options,u=>(n(),p("option",{key:u,value:u},$(u),9,kl))),128))],8,wl)),[[de,c.value[l.key]]]):l.type==="radio"?(n(),p("div",Cl,[(n(!0),p(_,null,ee(l.options,u=>(n(),p("label",{key:u,class:"flex items-center text-xs"},[W(e("input",{type:"radio","onUpdate:modelValue":q=>c.value[l.key]=q,value:u,class:"mr-1"},null,8,$l),[[qe,c.value[l.key]]]),j(" "+$(u),1)]))),128))])):D("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:b,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(n(),p("button",{key:0,onClick:m[0]||(m[0]=l=>x.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...m[2]||(m[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Sl={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Al={class:"flex justify-between items-start mb-3"},Dl={class:"text-xs text-gray-500 mt-0.5"},Tl={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],c=V(()=>{if(!t.opportunity.createdAt)return 0;const m=new Date(t.opportunity.createdAt),w=Math.abs(new Date-m);return Math.ceil(w/(1e3*60*60*24))}),g=()=>{d("create-offer",t.opportunity)},y=()=>{d("review",t.opportunity)},b=m=>{d("survey-completed",{opportunity:t.opportunity,responses:m})},f=()=>{d("survey-refused",{opportunity:t.opportunity})},v=()=>{d("not-responding",{opportunity:t.opportunity})};return(m,l)=>(n(),p("div",Sl,[e("div",Al,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Dl,"This opportunity has been open for "+$(c.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),J(ge,{questions:x,onSurveyCompleted:b,onSurveyRefused:f,onNotResponding:v})]))}},Ol={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Il={class:"flex justify-between items-start mb-3"},Vl={class:"text-xs text-gray-500 mt-0.5"},Nl={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],c=V(()=>{if(!t.opportunity.createdAt)return 0;const v=new Date(t.opportunity.createdAt),l=Math.abs(new Date-v);return Math.ceil(l/(1e3*60*60*24))}),g=()=>{d("create-offer",t.opportunity)},y=v=>{d("survey-completed",{opportunity:t.opportunity,responses:v})},b=()=>{d("survey-refused",{opportunity:t.opportunity})},f=()=>{d("not-responding",{opportunity:t.opportunity})};return(v,m)=>(n(),p("div",Ol,[e("div",Il,[e("div",null,[m[0]||(m[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Vl,"This opportunity has been open for "+$(c.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),J(ge,{questions:x,onSurveyCompleted:y,onSurveyRefused:b,onNotResponding:f})]))}},ql={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Fl={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],c=()=>{d("schedule-closing",t.opportunity)},g=f=>{d("survey-completed",{opportunity:t.opportunity,responses:f})},y=()=>{d("survey-refused",{opportunity:t.opportunity})},b=()=>{d("not-responding",{opportunity:t.opportunity})};return(f,v)=>(n(),p("div",ql,[v[0]||(v[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),J(ge,{questions:x,onSurveyCompleted:g,onSurveyRefused:y,onNotResponding:b})]))}},Ll={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Rl={class:"flex justify-between items-start mb-3"},Ul={class:"text-xs text-gray-500 mt-0.5"},Ml={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],c=V(()=>{const v=t.opportunity.lastActivity||t.opportunity.createdAt;if(!v)return 0;const m=new Date(v),w=Math.abs(new Date-m);return Math.ceil(w/(1e3*60*60*24))}),g=()=>{d("create-contract",t.opportunity)},y=v=>{d("survey-completed",{opportunity:t.opportunity,responses:v})},b=()=>{d("survey-refused",{opportunity:t.opportunity})},f=()=>{d("not-responding",{opportunity:t.opportunity})};return(v,m)=>(n(),p("div",Ll,[e("div",Rl,[e("div",null,[m[0]||(m[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Ul,"This opportunity has been in negotiation for "+$(c.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),J(ge,{questions:x,onSurveyCompleted:y,onSurveyRefused:b,onNotResponding:f})]))}},jl={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Bl={class:"flex justify-between items-start mb-3"},Wl={class:"text-xs text-gray-500 mt-0.5"},El={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],c=V(()=>{var u;if(!((u=t.opportunity)!=null&&u.contractDate))return 0;const m=new Date(t.opportunity.contractDate),w=Math.abs(new Date-m);return Math.ceil(w/(1e3*60*60*24))}),g=()=>{d("prepare-delivery",t.opportunity)},y=()=>{d("pre-delivery-checklist",t.opportunity)},b=m=>{d("survey-completed",{opportunity:t.opportunity,responses:m})},f=()=>{d("survey-refused",{opportunity:t.opportunity})},v=()=>{d("not-responding",{opportunity:t.opportunity})};return(m,l)=>(n(),p("div",jl,[e("div",Bl,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Wl,"Contract was signed "+$(c.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),J(ge,{questions:x,onSurveyCompleted:b,onSurveyRefused:f,onNotResponding:v})]))}},Pl={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Hl={class:"flex justify-between items-start mb-3"},zl={class:"text-xs text-gray-500 mt-0.5"},Ql={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,d=T,x=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],c=V(()=>{const v=t.activities.find(u=>{var q;return u.type==="delivery"||((q=u.action)==null?void 0:q.toLowerCase().includes("delivered"))});if(!v||!v.timestamp)return 0;const m=new Date(v.timestamp),w=Math.abs(new Date-m);return Math.ceil(w/(1e3*60*60*24))}),g=()=>{d("delivery-feedback",t.opportunity)},y=v=>{d("survey-completed",{opportunity:t.opportunity,responses:v})},b=()=>{d("survey-refused",{opportunity:t.opportunity})},f=()=>{d("not-responding",{opportunity:t.opportunity})};return(v,m)=>(n(),p("div",Pl,[e("div",Hl,[e("div",null,[m[0]||(m[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",zl,"Vehicle was delivered "+$(c.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:g,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),J(ge,{questions:x,onSurveyCompleted:y,onSurveyRefused:b,onNotResponding:f})]))}},Yl={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Kl={class:"flex justify-between items-start mb-3"},Gl={class:"font-bold text-slate-800 text-sm"},Jl={class:"text-xs text-gray-500 mt-0.5"},Xl={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(o,{emit:T}){const t=o,d=T,x=V(()=>{var u;return((u=t.scheduledAppointment)==null?void 0:u.noShowCount)||0}),c=V(()=>{const u=x.value;return u===0?"No-Show Follow-up":u>=3?`No-Show #${u} - Final Warning`:`No-Show #${u} Follow-up`}),g=V(()=>{const u=x.value;return u>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":u>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),y=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],b=V(()=>{var q;return(q=t.scheduledAppointment)!=null&&q.start?new Date(t.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),f=()=>{d("contact-customer",t.opportunity)},v=()=>{const u=x.value;if(u>=3)d("auto-close-lost",{opportunity:t.opportunity,reason:`Automatically closed after ${u} no-shows`});else if(u===1||u===2){const q=new Date;q.setDate(q.getDate()+2),d("set-callback",{opportunity:t.opportunity,callbackDate:q.toISOString()})}else d("reschedule",t.opportunity)},m=u=>{d("survey-completed",{opportunity:t.opportunity,responses:u})},l=()=>{d("survey-refused",{opportunity:t.opportunity})},w=()=>{d("not-responding",{opportunity:t.opportunity})};return(u,q)=>(n(),p("div",Yl,[e("div",Kl,[e("div",null,[e("h4",Gl,$(c.value),1),e("p",Jl,"Appointment was scheduled for "+$(b.value)+" but customer did not show up. "+$(g.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:v,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...q[0]||(q[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),j(" Book Another Appointment ",-1)])]),e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...q[1]||(q[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),j(" Contact Customer ",-1)])])]),J(ge,{questions:y,onSurveyCompleted:m,onSurveyRefused:l,onNotResponding:w})]))}},Zl={OOFB:Tl,UFB:Nl,NFU:Fl,OFB:Ml,CFB:El,DFB:Ql,NS:Xl};function _l(o,T,t,d,x){const c=V(()=>{const l=Ie(o),w=Ie(T),u=Ie(t);return{opportunity:l,scheduledAppointment:w,activities:u,hasOffers:(u==null?void 0:u.some(q=>q.type==="offer"))||!1,stage:l.displayStage||l.stage,deliverySubstatus:l.deliverySubstatus||null,formatDateTime:x,hasActiveTaskWidget:!1}}),g=V(()=>{const l=c.value,w=yt(l.stage,l);if(!w)return null;const u=Zl[w];return u?{component:u,props:{opportunity:l.opportunity,appointment:l.scheduledAppointment}}:null}),y=V(()=>({...c.value,hasActiveTaskWidget:!!g.value})),b=V(()=>{const l=y.value,w=gt(l.stage,l);if(!w)return null;const u=d[w.key];return{...w,handler:u||(()=>console.warn(`No handler for action: ${w.key}`))}}),f=V(()=>{const l=y.value;return ft(l.stage,l).map(u=>{const q=d[u.key];return{...u,handler:q||(()=>console.warn(`No handler for action: ${u.key}`))}})}),v=V(()=>{const l=c.value;return vt(l.stage)}),m=V(()=>{if(!g.value)return"";const w=(g.value.component.__name||g.value.component.name).replace("Widget","");return bt(w)});return{primaryAction:b,secondaryActions:f,activeTaskWidget:g,taskWidgetTitle:m,isClosed:v}}const en=["disabled"],tn={key:0,class:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden max-h-96 overflow-y-auto min-w-full",style:{"z-index":"9999"}},sn=["onClick","disabled"],on={class:"flex-1"},ln={class:"font-medium text-slate-700"},nn={key:0,class:"text-xs text-gray-500 mt-0.5"},an={key:0,class:"px-4 py-3 text-sm text-gray-500 text-center"},rn={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(o,{emit:T}){const t=T,d=S(!1),x=S(null),c=()=>{d.value=!d.value},g=()=>{d.value=!1},y=f=>{f.disabled||(g(),t("action-selected",f),f.handler&&typeof f.handler=="function"&&f.handler())},b=f=>{x.value&&!x.value.contains(f.target)&&g()};return $e(()=>{document.addEventListener("click",b)}),lt(()=>{document.removeEventListener("click",b)}),(f,v)=>(n(),p("div",{class:"relative",ref_key:"dropdownRef",ref:x},[e("button",{onClick:c,class:"w-auto bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!o.actions||o.actions.length===0},[v[0]||(v[0]=e("span",null,"More actions",-1)),e("i",{class:R(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":d.value}])},null,2)],8,en),J(Ke,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:K(()=>[d.value?(n(),p("div",tn,[(n(!0),p(_,null,ee(o.actions,m=>(n(),p("button",{key:m.key,onClick:l=>y(m),class:R(["w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-start gap-3 border-b border-gray-100 last:border-b-0 transition-colors whitespace-nowrap",{"opacity-50 cursor-not-allowed":m.disabled}]),disabled:m.disabled},[e("i",{class:R([m.icon,"text-gray-400 mt-0.5 w-4 flex-shrink-0"])},null,2),e("div",on,[e("div",ln,$(m.label),1),m.description?(n(),p("div",nn,$(m.description),1)):D("",!0)])],10,sn))),128)),!o.actions||o.actions.length===0?(n(),p("div",an," No actions available ")):D("",!0)])):D("",!0)]),_:1})],512))}},dn={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},un=["src","alt"],cn={key:1,class:"w-full h-full flex items-center justify-center"},pn={class:"flex items-center justify-between mb-1.5"},mn={class:"text-sm font-bold text-gray-900"},yn={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},gn={class:"text-[10px] text-gray-500 mb-1.5"},fn={key:0,class:"text-[10px] text-green-600 font-medium mb-2"},vn={key:1,class:"text-[10px] text-orange-600 font-medium mb-2"},Ye={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(o){const T=o,t=V(()=>({Requested:"bg-blue-100 text-blue-700 border border-blue-200",Recommended:"bg-purple-100 text-purple-700 border border-purple-200","In Stock":"bg-green-100 text-green-700 border border-green-200",Custom:"bg-orange-100 text-orange-700 border border-orange-200"})[T.badge]||"bg-gray-100 text-gray-700 border border-gray-200"),d=x=>x?x.toLocaleString("en-US"):"0";return(x,c)=>(n(),p("div",{onClick:c[1]||(c[1]=g=>x.$emit("select")),class:R(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":o.selected}])},[e("div",dn,[o.vehicle.image?(n(),p("img",{key:0,src:o.vehicle.image,alt:`${o.vehicle.brand} ${o.vehicle.model}`,class:"w-full h-full object-cover"},null,8,un)):(n(),p("div",cn,[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",pn,[e("span",{class:R(["text-[10px] font-bold uppercase px-1.5 py-0.5 rounded",t.value])},$(o.badge),3),e("span",mn,"â‚¬"+$(d(o.vehicle.price)),1)]),e("h4",yn,$(o.vehicle.brand)+" "+$(o.vehicle.model),1),e("p",gn,$(o.vehicle.year),1),o.stockDays!==null&&o.stockDays!==void 0?(n(),p("div",fn,[c[3]||(c[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),j(" In stock ("+$(o.stockDays)+" days) ",1)])):(n(),p("div",vn,[...c[4]||(c[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),j(" Out of stock ",-1)])])),e("button",{onClick:c[0]||(c[0]=ue(g=>x.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},bn={class:"space-y-6 max-h-[75vh] overflow-y-auto px-2"},xn={key:0},hn={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},wn={class:"mb-4"},kn={class:"relative"},Cn={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},$n={key:1,class:"text-center py-8 text-gray-500"},Sn={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},An={key:0,class:"mt-4 space-y-3"},Dn={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Tn={class:"flex justify-end"},On=["disabled"],In={class:"p-4 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Vn={class:"flex items-center gap-3"},Nn={class:"font-bold text-sm text-gray-800"},qn={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(o,{emit:T}){const t=o,d=T,x=S(""),c=S(!1),g=S(null),y=S(null),b=S(null),f=S({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""}),v=V(()=>t.requestedVehicle&&t.requestedVehicle.stockDays!==null&&t.requestedVehicle.stockDays!==void 0),m=V(()=>{const h=[];if(t.requestedVehicle&&v.value&&h.push({...t.requestedVehicle,isRequested:!0}),ye&&ye.length>0){const r=ye.filter(M=>t.requestedVehicle?M.brand!==t.requestedVehicle.brand||M.model!==t.requestedVehicle.model:!0),k=t.requestedVehicle&&v.value?3:4;h.push(...r.slice(0,k))}return h}),l=V(()=>{if(!ye||ye.length===0)return[];let h=[...ye];if(x.value){const r=x.value.toLowerCase();h=h.filter(k=>k.brand.toLowerCase().includes(r)||k.model.toLowerCase().includes(r)||k.year.toString().includes(r))}return h}),w=V(()=>f.value.brand&&f.value.model&&f.value.year&&f.value.price>0),u=(h,r)=>{g.value=h,y.value=h.id||`custom-${Date.now()}`,b.value=r},q=()=>{if(!w.value)return;const h={...f.value,id:`custom-${Date.now()}`,isCustom:!0};u(h,"custom")},A=()=>{g.value&&(d("vehicle-selected",{vehicle:g.value,type:b.value}),d("close"),g.value=null,y.value=null,b.value=null,x.value="",c.value=!1,f.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(h,r)=>(n(),Y(Se,{show:o.show,onClose:r[6]||(r[6]=k=>h.$emit("close")),title:"Select Vehicle",size:"6xl"},nt({default:K(()=>[e("div",bn,[m.value.length?(n(),p("div",xn,[r[7]||(r[7]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),j(" Recommended Vehicles ")],-1)),e("div",hn,[(n(!0),p(_,null,ee(m.value,k=>(n(),Y(Ye,{key:k.id,vehicle:k,badge:k.isRequested?"Requested":"Recommended","stock-days":k.stockDays,selected:y.value===k.id,onSelect:M=>u(k,k.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):D("",!0),e("div",null,[r[10]||(r[10]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),j(" Browse Stock ")],-1)),e("div",wn,[e("div",kn,[r[8]||(r[8]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),W(e("input",{"onUpdate:modelValue":r[0]||(r[0]=k=>x.value=k),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Z,x.value]])])]),l.value.length?(n(),p("div",Cn,[(n(!0),p(_,null,ee(l.value,k=>(n(),Y(Ye,{key:k.id,vehicle:k,badge:"In Stock","stock-days":k.stockDays,selected:y.value===k.id,onSelect:M=>u(k,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(n(),p("div",$n,[...r[9]||(r[9]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[r[18]||(r[18]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),j(" Configure Custom Vehicle ")],-1)),e("div",Sn,[r[17]||(r[17]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:r[1]||(r[1]=k=>c.value=!c.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[r[11]||(r[11]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),j(" "+$(c.value?"Hide Configuration":"Build Custom Configuration"),1)]),c.value?(n(),p("div",An,[e("div",Dn,[e("div",null,[r[12]||(r[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),W(e("input",{"onUpdate:modelValue":r[2]||(r[2]=k=>f.value.brand=k),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., Audi"},null,512),[[Z,f.value.brand]])]),e("div",null,[r[13]||(r[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),W(e("input",{"onUpdate:modelValue":r[3]||(r[3]=k=>f.value.model=k),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., e-tron GT"},null,512),[[Z,f.value.model]])]),e("div",null,[r[14]||(r[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),W(e("input",{"onUpdate:modelValue":r[4]||(r[4]=k=>f.value.year=k),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"2024"},null,512),[[Z,f.value.year]])]),e("div",null,[r[15]||(r[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (â‚¬)",-1)),W(e("input",{"onUpdate:modelValue":r[5]||(r[5]=k=>f.value.price=k),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"98000"},null,512),[[Z,f.value.price]])])]),e("div",Tn,[e("button",{onClick:q,disabled:!w.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...r[16]||(r[16]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),j(" Use Custom Configuration ",-1)])],8,On)])])):D("",!0)])])])]),_:2},[g.value?{name:"footer",fn:K(()=>[e("div",In,[e("div",Vn,[r[20]||(r[20]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg"},null,-1)),e("div",null,[r[19]||(r[19]=e("p",{class:"text-xs text-gray-500"},"Selected Vehicle",-1)),e("p",Nn,$(g.value.brand)+" "+$(g.value.model)+" ("+$(g.value.year)+") ",1)])]),e("button",{onClick:A,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors shadow-sm"}," Confirm Selection ")])]),key:"0"}:void 0]),1032,["show"]))}},Fn={class:"space-y-4"},Ln=["max"],Rn=["disabled"],Un={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,d=T,x=S(""),c=S(""),g=S(""),y=V(()=>new Date().toISOString().split("T")[0]);ie(()=>t.show,v=>{if(v){const m=new Date;x.value=m.toISOString().split("T")[0],c.value=m.toTimeString().slice(0,5),g.value=""}});const b=()=>{if(!x.value)return;const v=c.value?`${x.value}T${c.value}:00`:`${x.value}T12:00:00`;d("confirm",{contractDate:v,notes:g.value})},f=()=>{d("cancel")};return(v,m)=>(n(),Y(Se,{show:o.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:f},{actions:K(()=>[e("button",{onClick:b,disabled:!x.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,Rn)]),default:K(()=>[e("div",Fn,[e("div",null,[m[3]||(m[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=l=>x.value=l),max:y.value,class:"input"},null,8,Ln),[[Z,x.value]])]),e("div",null,[m[4]||(m[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),W(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=l=>c.value=l),class:"input"},null,512),[[Z,c.value]])]),e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),W(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=l=>g.value=l),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[Z,g.value]])])])]),_:1},8,["show"]))}},Mn={class:"space-y-4"},jn=["max"],Bn=["disabled"],Wn={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,d=T,x=S(""),c=S(""),g=S(""),y=S(""),b=V(()=>new Date().toISOString().split("T")[0]);ie(()=>t.show,m=>{if(m){const l=new Date;x.value=l.toISOString().split("T")[0],c.value=l.toTimeString().slice(0,5),g.value="",y.value=""}});const f=()=>{if(!x.value||!g.value)return;const m=c.value?`${x.value}T${c.value}:00`:`${x.value}T12:00:00`;d("confirm",{deliveryDate:m,location:g.value,notes:y.value})},v=()=>{d("cancel")};return(m,l)=>(n(),Y(Se,{show:o.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:v},{actions:K(()=>[e("button",{onClick:f,disabled:!x.value||!g.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,Bn)]),default:K(()=>[e("div",Mn,[e("div",null,[l[4]||(l[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=w=>x.value=w),max:b.value,class:"input"},null,8,jn),[[Z,x.value]])]),e("div",null,[l[5]||(l[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),W(e("input",{type:"time","onUpdate:modelValue":l[1]||(l[1]=w=>c.value=w),class:"input"},null,512),[[Z,c.value]])]),e("div",null,[l[7]||(l[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),W(e("select",{"onUpdate:modelValue":l[2]||(l[2]=w=>g.value=w),class:"input"},[...l[6]||(l[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[de,g.value]])]),e("div",null,[l[8]||(l[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),W(e("textarea",{"onUpdate:modelValue":l[3]||(l[3]=w=>y.value=w),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[Z,y.value]])])])]),_:1},8,["show"]))}},En={class:"space-y-4"},Pn=["disabled"],Hn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,d=T,x=S(""),c=S("");ie(()=>t.show,b=>{b&&(x.value="",c.value="")});const g=()=>{x.value&&d("confirm",{reason:x.value,notes:c.value})},y=()=>{d("cancel")};return(b,f)=>(n(),Y(Se,{show:o.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:y},{actions:K(()=>[e("button",{onClick:g,disabled:!x.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Pn)]),default:K(()=>[e("div",En,[e("div",null,[f[3]||(f[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),W(e("select",{"onUpdate:modelValue":f[0]||(f[0]=v=>x.value=v),class:"input"},[...f[2]||(f[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[de,x.value]])]),e("div",null,[f[4]||(f[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),W(e("textarea",{"onUpdate:modelValue":f[1]||(f[1]=v=>c.value=v),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[Z,c.value]])])])]),_:1},8,["show"]))}},zn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o){return(T,t)=>(n(),Y(Se,{show:o.show,title:"Requalify as Lead",size:"lg",onCancel:t[1]||(t[1]=d=>T.$emit("cancel"))},{header:K(()=>[...t[2]||(t[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:K(()=>[e("button",{onClick:t[0]||(t[0]=d=>T.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:K(()=>[t[3]||(t[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),j(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),j(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),j(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},Qn={class:"flex justify-between items-start mb-3"},Yn={class:"font-bold text-slate-800 text-sm"},Kn={class:"text-xs text-gray-500 mt-0.5"},Gn={class:"flex gap-3 flex-wrap"},Jn={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(o){return(T,t)=>(n(),p("div",{class:R(["rounded-lg p-4 relative transition-all duration-300 border",[o.colorScheme.background,o.colorScheme.border]])},[e("div",Qn,[e("div",null,[e("h4",Yn,$(o.action.title),1),e("p",Kn,$(o.action.description),1)])]),e("div",Gn,[e("button",{onClick:t[0]||(t[0]=d=>T.$emit("action-clicked")),class:R([o.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:R(o.action.icon)},null,2),j(" "+$(o.action.label),1)],2)])],2))}},Xn={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-8"},Zn={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},_n={class:"p-5 space-y-6"},ea={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},ta={class:"flex gap-3"},sa={key:2,class:"space-y-3"},oa={class:"flex items-center gap-2 pb-2 border-b border-gray-200"},la={class:"font-semibold text-gray-900 text-sm"},na={key:3,class:"flex justify-end"},aa={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(o,{emit:T}){const t=o,d=T,x=Le(),c=Ue(),g=S(!1),y=S(!1),b=S(!1),f=S(!1),v=S(!1),m=S(!1),l=S(!1),w=S(!1),u=S(!1),q=S(!1),A=S([]),h=V(()=>{var a,i;return((a=t.opportunity)==null?void 0:a.displayStage)||((i=t.opportunity)==null?void 0:i.stage)||"Qualified"}),r=V(()=>Ge(h.value,"opportunity"));function k(a){return a?new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const M={"schedule-appointment":()=>{g.value=!0},"view-or-schedule-appointment":()=>{t.scheduledAppointment?u.value=!0:g.value=!0},"select-vehicle":()=>{l.value=!0},"create-offer":()=>{!t.opportunity.selectedVehicle&&!t.opportunity.vehicle?l.value=!0:y.value=!0},"call-prospect":()=>{w.value=!0},"follow-up-offer":()=>{w.value=!0},"request-decision":()=>{w.value=!0},"finalize-contract":()=>{f.value=!0},"schedule-delivery":()=>{v.value=!0},"confirm-delivery":()=>{v.value=!0},"collect-feedback":()=>{w.value=!0},reschedule:()=>{q.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&X()},"close-won":()=>{f.value=!0},"add-offer":()=>{y.value=!0},"add-contract":()=>{f.value=!0},"extend-deadline":()=>{w.value=!0},"close-lost":()=>{b.value=!0},reopen:()=>{pe()},requalify:()=>{m.value=!0}},{primaryAction:G,secondaryActions:E,activeTaskWidget:Q,taskWidgetTitle:I,isClosed:F}=_l(Ve(t,"opportunity"),Ve(t,"scheduledAppointment"),Ve(t,"activities"),M,k);function P(a){console.log("Secondary action selected:",a.key)}function le(){}function ce(a){l.value=!1,d("vehicle-selected",a),setTimeout(()=>{y.value=!0},300)}function oe(a){y.value=!1,d("offer-created",a)}function re(a){g.value=!1,d("appointment-scheduled",{...a,opportunityId:t.opportunity.id,customer:t.opportunity.customer.name})}function X(){t.scheduledAppointment&&d("appointment-cancelled",t.scheduledAppointment.id)}function ne(a){f.value=!1,c.modifyOpportunity(t.opportunity.id,{stage:"Closed Won",contractDate:a.contractDate})}function te(a){v.value=!1,c.addActivity(t.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:a})}function fe(a){b.value=!1,c.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:a})}function pe(){c.modifyOpportunity(t.opportunity.id,{stage:"Qualified"})}function ve(a){m.value=!1,x.push(`/customer/${a.id}?type=lead`)}function we(a){u.value=!1,console.log("Delete appointment:",a)}function be(a){q.value=!1,console.log("Save appointment:",a)}function xe(a){c.modifyOpportunity(t.opportunity.id,{callbackDate:a.callbackDate})}function ae(a){c.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:a.reason||"Multiple no-shows (NS3)"})}return $e(()=>{A.value=ye.filter(a=>a.stockDays!==null&&a.stockDays!==void 0).slice(0,5)}),(a,i)=>o.opportunity?(n(),p("div",Xn,[e("div",Zn,[i[13]||(i[13]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:R(["text-xs px-3 py-1 rounded-full font-medium border",r.value])},$(o.opportunity.displayStage||o.opportunity.stage),3)]),e("div",_n,[H(F)&&!H(Q)?(n(),p("div",ea,[i[16]||(i[16]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",ta,[e("button",{onClick:pe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[14]||(i[14]=[j(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:i[0]||(i[0]=O=>m.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[15]||(i[15]=[j(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):D("",!0),!H(F)&&H(G)?(n(),Y(Jn,{key:1,action:H(G),"color-scheme":H(G).colorScheme,onActionClicked:i[1]||(i[1]=O=>H(G).handler())},null,8,["action","color-scheme"])):D("",!0),H(Q)?(n(),p("div",sa,[e("div",oa,[i[17]||(i[17]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",la,$(H(I)),1)]),(n(),Y(it(H(Q).component),at(H(Q).props,{onClose:le,onSetCallback:xe,onAutoCloseLost:ae}),null,16))])):D("",!0),H(E).length>0?(n(),p("div",na,[J(rn,{actions:H(E),onActionSelected:P},null,8,["actions"])])):D("",!0),g.value?(n(),Y(wt,{key:4,show:g.value,customer:o.opportunity.customer,assignee:o.opportunity.assignee,"disabled-fields":["customer"],onCreate:re,onCancel:i[2]||(i[2]=O=>g.value=!1)},null,8,["show","customer","assignee"])):D("",!0)]),l.value?(n(),Y(qn,{key:0,opportunity:o.opportunity,"requested-car":o.opportunity.requestedCar,"recommended-cars":A.value,onVehicleSelected:ce,onClose:i[3]||(i[3]=O=>l.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):D("",!0),y.value?(n(),Y(xt,{key:1,opportunity:o.opportunity,vehicle:o.opportunity.selectedVehicle||o.opportunity.vehicle||o.opportunity.requestedCar,onOfferCreated:oe,onClose:i[4]||(i[4]=O=>y.value=!1)},null,8,["opportunity","vehicle"])):D("",!0),f.value?(n(),Y(Un,{key:2,opportunity:o.opportunity,onContractSet:ne,onClose:i[5]||(i[5]=O=>f.value=!1)},null,8,["opportunity"])):D("",!0),v.value?(n(),Y(Wn,{key:3,opportunity:o.opportunity,onDelivered:te,onClose:i[6]||(i[6]=O=>v.value=!1)},null,8,["opportunity"])):D("",!0),b.value?(n(),Y(Hn,{key:4,opportunity:o.opportunity,onClosed:fe,onClose:i[7]||(i[7]=O=>b.value=!1)},null,8,["opportunity"])):D("",!0),m.value?(n(),Y(zn,{key:5,opportunity:o.opportunity,onRequalified:ve,onClose:i[8]||(i[8]=O=>m.value=!1)},null,8,["opportunity"])):D("",!0),w.value?(n(),Y(ht,{key:6,onClose:i[9]||(i[9]=O=>w.value=!1)})):D("",!0),u.value&&o.scheduledAppointment?(n(),Y(kt,{key:7,show:u.value,event:o.scheduledAppointment,onClose:i[10]||(i[10]=O=>u.value=!1),onEdit:i[11]||(i[11]=O=>{u.value=!1,q.value=!0}),onDelete:we},null,8,["show","event"])):D("",!0),q.value&&o.scheduledAppointment?(n(),Y(Ct,{key:8,show:q.value,event:o.scheduledAppointment,customer:o.opportunity.customer,"disabled-fields":["customer"],onSave:be,onCancel:i[12]||(i[12]=O=>q.value=!1)},null,8,["show","event","customer"])):D("",!0)])):D("",!0)}};function ia(o){const T=Re(),t=Ue(),d=V(()=>o.value?o.value.type==="lead"?yl:aa:null),x=V(()=>o.value?o.value.type==="lead"?{currentActivities:V(()=>T.currentLeadActivities),addActivity:(g,y)=>T.addActivity(g,y),updateActivity:(g,y,b)=>T.updateActivity(g,y,b),deleteActivity:(g,y)=>T.deleteActivity(g,y)}:{currentActivities:V(()=>t.currentOpportunityActivities),addActivity:(g,y)=>t.addActivity(g,y),updateActivity:(g,y,b)=>t.updateActivity(g,y,b),deleteActivity:(g,y)=>t.deleteActivity(g,y),addVehicle:(g,y)=>t.addVehicle(g,y),createOffer:(g,y)=>t.createOffer(g,y),loadOpportunityById:g=>t.loadOpportunityById(g)}:null),c=V(()=>o.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:d,storeAdapter:x,addNewConfig:c}}const ra={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},da={key:0,class:"px-1.5 py-0.5 bg-red-50 text-red-600 rounded text-[9px] font-bold uppercase"},ua={key:0},ca={key:1},pa={key:0},ma={key:1},ya={key:2},ga=["onClick"],fa=["onClick"],va=["onClick"],ba={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},xa={key:0,class:"flex-1 flex flex-col overflow-hidden border-l border-gray-200 lg:w-1/2"},ha={key:2,class:"flex-1 flex flex-col overflow-hidden"},wa={class:"lg:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},ka=["title"],Ca={key:0,class:"flex-1 flex items-center justify-center"},$a={__name:"Tasks",setup(o){const T=rt(),t=Le(),d=Re(),x=Ue(),c=Te(),g=Me(),y=S(localStorage.getItem("tasksViewMode")||"table"),b=V(()=>T.query.highlight||null);ie(y,a=>{localStorage.setItem("tasksViewMode",a)});const f=a=>{y.value;const i=P.value;if(y.value=a,a==="table"&&i)t.push({path:"/tasks",query:{highlight:i.compositeId}});else if(a==="card"&&b.value){const[O,U]=b.value.split("-");t.push({path:`/tasks/${U}`,query:{type:O}})}else a==="card"&&!b.value&&!P.value&&t.push({path:"/tasks"})},v=a=>{if(!a)return"No deadline";const i=je(a);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:Ae(a)},m=a=>{const i=a.type==="lead"?a.requestedCar:a.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},l=a=>a?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[a.type]||"bg-gray-50 text-gray-700":"",w=a=>{if(!a||!a.assignee)return{name:"Unassigned",initials:"?"};const i=a.assigneeInitials||a.assignee.split(" ").map(O=>O[0]).join("");return{name:a.assignee,initials:i}},u=a=>{if(!a||!a.customer||!a.customer.address)return null;const O=a.customer.address.split(",");return O.length>1&&O[O.length-1].trim().replace(/^\d+\s*/,"").trim()||null},q=a=>{const i=u(a),O=a.source||"Unknown";return i?`${i} â€¢ ${O}`:O},A=a=>{const i=a.type==="lead"?a.requestedCar:a.vehicle;if(!i)return"No vehicle";const O=m(a),U=O?O.label:i.type||"Unknown";let C="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?C=`${(i.kilometers/1e3).toFixed(0)}k`:C=`${i.kilometers}`),C?`${U} / ${C}`:U},h=S("all"),r=S("none"),k=S(null),M=S(!1),G=S(!1),E=S(null),Q=V(()=>{const i=d.leads.filter(C=>!C.isDisqualified).map(C=>{const B={...C,type:"lead",compositeId:`lead-${C.id}`};return!B.customer&&C.customer&&(B.customer=C.customer),B}),O=x.opportunities.map(C=>{const B={...C,type:"opportunity",compositeId:`opportunity-${C.id}`};return!B.customer&&C.customer&&(B.customer=C.customer),B});let U=[];return c.isOperator()?U=i:c.isSalesman()?U=O:U=[...i,...O],U}),I=V(()=>{let a=Q.value;if(h.value!=="all"&&(a=a.filter(i=>i.type===h.value)),r.value==="urgent-first")a=[...a].sort((i,O)=>{if(i.priority==="Hot"&&O.priority!=="Hot")return-1;if(i.priority!=="Hot"&&O.priority==="Hot")return 1;const U=new Date(i.lastActivity||i.createdAt||0);return new Date(O.lastActivity||O.createdAt||0)-U});else if(r.value==="assigned-to-me"){const i=c.currentUser.name;a=a.filter(O=>O.assignee===i),a=[...a].sort((O,U)=>{const C=new Date(O.lastActivity||O.createdAt||0);return new Date(U.lastActivity||U.createdAt||0)-C})}else if(r.value==="assigned-to-my-team"){const i=c.currentUser;let O=[];i.role==="manager"?O=g.users.map(U=>U.name):i.role==="salesman"?O=g.users.filter(U=>U.role==="salesman").map(U=>U.name):i.role==="operator"&&(O=g.users.filter(U=>U.role==="operator").map(U=>U.name)),a=a.filter(U=>O.includes(U.assignee)),a=[...a].sort((U,C)=>{const B=new Date(U.lastActivity||U.createdAt||0);return new Date(C.lastActivity||C.createdAt||0)-B})}else a=[...a].sort((i,O)=>{const U=new Date(i.lastActivity||i.createdAt||0);return new Date(O.lastActivity||O.createdAt||0)-U});return a}),F=V(()=>{const a=Q.value.some(O=>O.type==="lead"),i=Q.value.some(O=>O.type==="opportunity");return a&&i}),P=V(()=>{const a=parseInt(T.params.id),i=T.query.type;if(i){const se=`${i}-${a}`;return Q.value.find(ke=>ke.compositeId===se)||null}const O=h.value!=="all"?Q.value.filter(se=>se.type===h.value):Q.value,U=`lead-${a}`,C=`opportunity-${a}`,B=O.find(se=>se.compositeId===U||se.compositeId===C);return B||Q.value.find(se=>se.compositeId===U||se.compositeId===C)||null});V(()=>P.value?P.value.type==="lead"?d.currentLeadActivities:x.currentOpportunityActivities:[]);const le=ia(P),ce=le.managementWidget,oe=le.storeAdapter,re=le.addNewConfig,X=V(()=>a=>a.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");$e(()=>{d.loadLeads(),x.loadOpportunities();const a=T.params.id;a&&ne(a)}),ie(()=>T.params.id,a=>{a&&ne(a)}),ie(P,a=>{a&&(a.type==="lead"?d.loadLeadById(a.id):x.loadOpportunityById(a.id))},{immediate:!0});const ne=a=>{const i=parseInt(a),O=Q.value.find(U=>U.id===i);O&&(O.type==="lead"?d.loadLeadById(i):x.loadOpportunityById(i))},te=a=>{const[i,O]=a.split("-");y.value==="table"&&(y.value="card"),t.push({path:`/tasks/${O}`,query:{type:i}}),M.value=!1},fe=a=>{k.value=k.value===a?null:a},pe=a=>{E.value=a,G.value=!0,k.value=null},ve=a=>{r.value=a},we=async a=>{if(!E.value)return;const i=E.value,O=a.name;i.type==="lead"?await d.modifyLead(i.id,{assignee:O,assigneeType:a.type,teamId:a.type==="team"?a.id:null}):i.type==="opportunity"&&await x.updateOpportunity(i.id,{assignee:O,assigneeType:a.type,teamId:a.type==="team"?a.id:null}),G.value=!1,E.value=null},be=async a=>{k.value=null,a.type==="lead"?await d.modifyLead(a.id,{priority:"Hot"}):a.type==="opportunity"&&await x.modifyOpportunity(a.id,{priority:"Hot"})},xe=async a=>{k.value=null,a.type==="lead"?await d.modifyLead(a.id,{priority:"Normal"}):a.type==="opportunity"&&await x.modifyOpportunity(a.id,{priority:"Normal"})},ae=a=>({Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"})[a]||"bg-gray-100 text-gray-700";return(a,i)=>{var O,U;return n(),p("div",ra,[y.value==="card"?(n(),p("div",{key:0,class:R(["lg:relative lg:block",M.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[J(as,{title:"Tasks",items:I.value,"selected-id":(O=P.value)==null?void 0:O.compositeId,"type-filter":h.value,"view-mode":y.value,"selected-class":C=>C.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":X.value,"open-menu-id":k.value,getName:C=>{const B=C.customer;return B&&B.name?B.name:B&&!B.name&&B.email&&B.email.split("@")[0]||"Unknown"},getInitials:C=>{const B=C.customer;return B&&B.initials?B.initials:B&&B.name&&B.name.split(" ").map(ke=>ke[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:C=>C.type==="lead"?C.requestedCar?`${C.requestedCar.brand} ${C.requestedCar.model}`:"No vehicle specified":C.vehicle?`${C.vehicle.brand} ${C.vehicle.model}`:"No vehicle specified",avatarClass:C=>C.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:te,onMenuClick:fe,onMenuClose:i[0]||(i[0]=C=>k.value=null),onClose:i[1]||(i[1]=C=>M.value=!1),"show-type-filter":F.value,onFilterChange:i[2]||(i[2]=C=>h.value=C),onSortChange:ve,onViewChange:f},{badges:K(({item:C})=>[e("span",{class:R(["px-1.5 py-0.5 rounded text-[9px] font-bold uppercase",C.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},$(C.type==="lead"?"Lead":"Opportunity"),3),C.priority==="Hot"?(n(),p("span",da," HOT ")):D("",!0)]),location:K(({item:C})=>[j($(q(C)),1)]),"vehicle-status":K(({item:C})=>[j($(A(C)),1)]),owner:K(({item:C})=>[C.assignee?(n(),p("span",ua,"Assignee: "+$(C.assignee),1)):(n(),p("span",ca,"Assignee: Unassigned"))]),dates:K(({item:C})=>[C.type==="lead"&&C.nextActionDue?(n(),p("span",pa,"Due: "+$(v(C.nextActionDue)),1)):C.type==="opportunity"&&C.nextActionDue?(n(),p("span",ma,"Due: "+$(v(C.nextActionDue)),1)):(n(),p("span",ya,"Due: No deadline"))]),menu:K(({item:C})=>[e("button",{onClick:ue(B=>pe(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[9]||(i[9]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),j(" Reassign ",-1)])],8,ga),C.priority!=="Hot"?(n(),p("button",{key:0,onClick:ue(B=>be(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[10]||(i[10]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),j(" Mark as hot ",-1)])],8,fa)):(n(),p("button",{key:1,onClick:ue(B=>xe(C),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[11]||(i[11]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),j(" Unmark as hot ",-1)])],8,va))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2)):D("",!0),y.value==="table"?(n(),p("div",ba,[J(us,{tasks:I.value,"current-task-id":(U=P.value)==null?void 0:U.compositeId,"highlight-id":b.value,"type-filter":h.value,"sort-option":r.value,"show-type-filter":F.value,"show-mobile-close":!0,"open-menu-id":k.value,"get-vehicle-type":m,"get-vehicle-type-badge-class":l,"get-owner-info":w,"get-stage-badge-class":ae,"view-mode":y.value,onSelect:te,onMenuClick:fe,onMenuClose:i[3]||(i[3]=C=>k.value=null),onFilterChange:i[4]||(i[4]=C=>h.value=C),onSortChange:ve,onReassign:pe,onClose:i[5]||(i[5]=C=>M.value=!1),onViewChange:f,class:R(P.value?"lg:w-1/2":"w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","open-menu-id","view-mode","class"]),P.value?(n(),p("div",xa,[J(Qe,{task:P.value,type:P.value.type,"management-widget":H(ce),"store-adapter":H(oe),"add-new-config":H(re)},{"pinned-extra":K(({task:C})=>[...i[12]||(i[12]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):D("",!0)])):D("",!0),y.value==="card"&&P.value?(n(),p("div",ha,[e("div",wa,[e("button",{onClick:i[6]||(i[6]=C=>f(y.value==="card"?"table":"card")),class:"w-14 h-14 bg-gray-700 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all hover:scale-110",title:y.value==="card"?"Switch to Table":"Switch to Cards"},[e("i",{class:R(y.value==="card"?"fa-solid fa-table text-lg":"fa-solid fa-list text-lg")},null,2)],8,ka),e("button",{onClick:i[7]||(i[7]=C=>M.value=!M.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...i[13]||(i[13]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])]),!P.value&&y.value==="card"?(n(),p("div",Ca,[...i[14]||(i[14]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])])):P.value&&y.value==="card"?(n(),Y(Qe,{key:1,task:P.value,type:P.value.type,"management-widget":H(ce),"store-adapter":H(oe),"add-new-config":H(re)},{"pinned-extra":K(({task:C})=>[...i[15]||(i[15]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):D("",!0)])):D("",!0),J($t,{show:G.value,onClose:i[8]||(i[8]=C=>G.value=!1),onConfirm:we},null,8,["show"])])}}},Ra=Fe($a,[["__scopeId","data-v-cac4c1a0"]]);export{Ra as default};
