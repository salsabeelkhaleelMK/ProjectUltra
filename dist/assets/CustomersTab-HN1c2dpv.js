import{y as G}from"./components-D1kWShum.js";import{n as F}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-3RNqBGno.js";import{u as K,U as M,g as W}from"./useDataTableData-D7InczSP.js";import{u as j}from"./UnifiedAddForm-vTbw0or0.js";import{u as q}from"./opportunities-D_EVVSI9.js";import{u as H}from"./useCustomersTable-DJeOs6IQ.js";import{u as J}from"./useTableRowSelection-BPyRhPA4.js";import{I as Q,r as n,c as h,m as X,d as S,o as D,e as s,s as p,B as d,g as Y,y as a,t as Z,k as O,G as tt}from"./index-D-GV69Dn.js";import"./sparkles-DqOgHrLF.js";import"./contacts-Doz8YZdN.js";const et={class:"mb-8"},ot={class:"bg-white"},st={class:"mb-4"},at={class:"data-table-inner table-search-wrapper"},nt={key:0,class:"flex items-center gap-2"},it={class:"flex items-center gap-2 mr-1"},lt={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},rt={__name:"CustomersTab",emits:["row-click"],setup(ct,{emit:k}){const i=j(),m=q(),b=n("all"),{rowSelection:f,selectedCount:U,hasSelection:A,getSelectedRows:T,clearSelection:C}=J(e=>e.id),I=k,l=n({pageIndex:0,pageSize:10}),c=n(""),u=n([]),g=n([]),N=e=>{if(!e)return"N/A";const t=e.split(",");return t.length>1&&t[t.length-1].trim().replace(/^\d+\s*/,"").trim()||e},v=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",B=h(()=>{let e=i.customers;return b.value==="contacts"?e=i.contacts:b.value==="accounts"&&(e=i.accounts),e.map(t=>({id:`customer-${t.id}`,stageKey:"customers",customer:t.name,accountType:t.company&&t.company!==""?"Account":"Contact",telephone:t.phone,location:N(t.address),createdAt:v(t.createdAt),name:t.name,accountOwner:t.source||"N/A",updatedAt:v(t.lastContact||t.createdAt),lastActivity:v(t.lastContact),openOpportunities:m.opportunities.filter(o=>o.customerId===t.id&&o.stage!=="Closed Won"&&o.stage!=="Closed Lost").length,wonOpportunities:m.opportunities.filter(o=>o.customerId===t.id&&o.stage==="Closed Won").length,initials:t.initials||t.name.slice(0,2).toUpperCase(),type:t.company&&t.company!==""?"account":"contact",customerId:t.id}))}),w=e=>{e.stageKey==="customers"&&I("row-click",e)},R=n("customers"),{columns:x,filterDefinitions:y,tableMeta:V}=H(R,w),_=(e,t)=>t==="company"?e.type==="account":t==="source"?e.accountOwner:W(e,t),{paginatedData:z,sortedData:L,totalFilteredCount:P}=K({rawData:B,columns:x,globalFilter:c,columnFilters:u,sorting:g,pagination:l,filterDefs:y,searchableFields:e=>[e.customer,e.name,e.accountOwner,e.telephone,e.location],getFilterValue:_}),$=h(()=>{var t,o;const e=(t=y.value)==null?void 0:t.find(r=>r.key==="source");return((o=e==null?void 0:e.options)==null?void 0:o.map(r=>({value:r.value,label:r.label})))??[]}),E=()=>{const e=T(L.value);e.length!==0&&confirm(`Are you sure you want to delete ${e.length} ${e.length===1?"customer":"customers"}?`)&&(e.forEach(t=>{const o=t.id.replace("customer-","");i.deleteCustomer(o)}),C())};return X(async()=>{await i.fetchCustomers(),await m.fetchOpportunities()}),(e,t)=>(D(),S("div",et,[s("div",ot,[s("div",st,[p(M,{"active-tab":"customers",placeholder:"Search customers...",pagination:l.value,"source-options":$.value,"onUpdate:globalFilter":t[0]||(t[0]=o=>c.value=o),"onUpdate:columnFilters":t[1]||(t[1]=o=>u.value=o),"onUpdate:pagination":t[2]||(t[2]=o=>l.value=o)},null,8,["pagination","source-options"])]),s("div",at,[p(a(G),{data:a(z),columns:a(x),meta:a(V),onRowClick:w,columnFiltersOptions:{filterDefs:a(y)},pagination:l.value,"onUpdate:pagination":t[3]||(t[3]=o=>l.value=o),globalFilter:c.value,"onUpdate:globalFilter":t[4]||(t[4]=o=>c.value=o),sorting:g.value,"onUpdate:sorting":t[5]||(t[5]=o=>g.value=o),columnFilters:u.value,"onUpdate:columnFilters":t[6]||(t[6]=o=>u.value=o),rowSelection:a(f),"onUpdate:rowSelection":t[7]||(t[7]=o=>tt(f)?f.value=o:null),paginationOptions:{rowCount:a(P)},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":d(()=>[...t[8]||(t[8]=[s("div",{class:"empty-state"},[s("i",{class:"fa-solid fa-inbox empty-state-icon"}),s("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":d(()=>[a(A)?(D(),S("div",nt,[s("div",it,[s("div",lt,Z(a(U)),1),t[9]||(t[9]=s("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),t[12]||(t[12]=s("div",{class:"h-4 w-px bg-greys-700"},null,-1)),p(a(F),{variant:"ghost",size:"sm",onClick:E},{default:d(()=>[...t[10]||(t[10]=[s("i",{class:"fa-solid fa-trash mr-2"},null,-1),O(" Delete ",-1)])]),_:1}),p(a(F),{variant:"ghost",size:"sm",onClick:a(C)},{default:d(()=>[...t[11]||(t[11]=[s("i",{class:"fa-solid fa-x mr-2"},null,-1),O(" Close ",-1)])]),_:1},8,["onClick"])])):Y("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])])]))}},wt=Q(rt,[["__scopeId","data-v-61764bf1"]]);export{wt as default};
