import{H as ce,S as ae,a2 as je,h as _e,C as We,c as q,d as k,o as g,e,x as z,g as P,B as i,s as l,y as t,n as j,t as A,F as H,i as Z,K as Be,r as O,L as He,w as Ce,p as pe,T as Qe,k as v,m as ge,l as ne,N as Ve,ad as Ye,D as Ge,u as Ke,a0 as Ze,I as ye,ae as Je,af as Xe,ag as et,ah as tt,P as re}from"./index-DqWyOYoU.js";import{u as lt}from"./opportunities-Cr-mXogK.js";import{n as F,$ as st,f as J,F as X,L as ee,g as te,h as le,Q as $,o as ue,C as be,d as se,W as Q,U as Y,H as G,j as R,G as K,c as L,i as oe,z as at}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-SVS8Zwad-DVNwBQcn.js";import{S as ot}from"./sparkles-C-JQGf45.js";import{f as nt,u as it}from"./vehicles-BiOUVEQF.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=ce("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=ce("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ce("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ce("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ce("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=ce("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=ce("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=ce("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function vn(s){if(!s)return"";const r=new Date(s),o=new Date;if(r<o)return"OVERDUE";if(r.toDateString()===o.toDateString()){const f=r-o,p=Math.floor(f/(1e3*60*60)),h=Math.floor(f%(1e3*60*60)/(1e3*60));return p>0?`${p}h ${h}m`:`${h}m`}return r.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function yn(s){return(typeof s=="string"?new Date(s):s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function bn(s){return(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Fe(s){return(s==null?void 0:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function gn(s){if(!s)return"No deadline";const r=new Date(s);if(r<new Date)return"OVERDUE";const a=r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${a}, ${f}`}function hn(s){if(!s)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const r=new Date(s),o=new Date,a=(r-o)/(1e3*60*60);if(a<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(a<2){const f=Math.floor((r-o)/6e4),p=Math.floor(f/60),h=f%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:p>0?`${p}h ${h}m`:`${h}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(a<24){const f=Math.floor(a),p=Math.floor((a-f)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${f}h ${p}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const f=Math.ceil(a/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${f} day${f!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function xn(s){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700"}const he={[ae.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:s=>!!(s.callbackDate||s.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[ae.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Ue={toClosed:(s,r,o)=>{const a={isDisqualified:!0,disqualifyReason:(o==null?void 0:o.reason)||null,disqualifyCategory:(o==null?void 0:o.category)||null,scheduledAppointment:null,nextActionDue:null};(o==null?void 0:o.reason)==="Duplicate"?(a.isDuplicate=!0,a.stage="Closed Failed"):(o==null?void 0:o.category)==="Not Interested"?a.stage="Not Interested":a.stage="Not Valid",a.status="Disqualified";const f=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(o==null?void 0:o.category)||"Unknown"}, Reason: ${(o==null?void 0:o.reason)||"Unknown"}`}];return s.scheduledAppointment&&f.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:s.scheduledAppointment}}),{updates:a,activities:f}},reopen:s=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function wn(s,r){return r.startsWith("Closed")?Ue.toClosed:s.startsWith("Closed")&&!r.startsWith("Closed")?Ue.reopen:null}const Te={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:s=>s.scheduledAppointment&&s.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:r=>{const o=new Date(r.scheduledAppointment.start);return`Appointment scheduled for ${r.formatDateTime?r.formatDateTime(r.scheduledAppointment.start):o.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"view-or-schedule-appointment",title:s=>s.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:s=>s.scheduledAppointment&&s.scheduledAppointment.start?`Scheduled for ${s.formatDateTime?s.formatDateTime(s.scheduledAppointment.start):new Date(s.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:s=>s.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:s=>{var o;return((o=s.opportunity)==null?void 0:o.negotiationSubstatus)==="Offer Feedback"?{key:"request-feedback",title:"Request Offer Feedback",description:"Get customer response on pending offer(s) and push forward",label:"Request Feedback",icon:"fa-solid fa-comments",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}:{key:"follow-up-offer",title:"Follow Up on Offer",description:s.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:s.hasOffers?"Follow Up":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}},secondaryActions:[{key:"mark-offer-accepted",label:"Mark Offer Accepted",icon:"fa-solid fa-check-circle",description:"Mark an offer as accepted and move to In Negotiation - Contract Pending",conditional:"has-offers"},{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"In Negotiation - Contract Pending":{primaryAction:{key:"finalize-contract",title:"Collect e-signatures, finalize contract",description:"Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs.",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"add-offer",label:"Add offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create additional offers if terms need adjustment"},{key:"extend-deadline",label:"Extend deadline",icon:"fa-solid fa-clock",description:"Give customer more time to review/sign"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"End negotiation if customer changes mind"},{key:"schedule-appointment",label:"Schedule appointment",icon:"fa-solid fa-calendar-plus",description:"Book delivery or signing meeting"}],taskWidgets:[]},"Closed Won":{primaryAction:s=>{const r=s.deliverySubstatus;return r==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:r==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ie={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},yt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},bt={class:"flex items-center justify-between gap-2 mb-4"},gt={class:"flex flex-col"},ht={class:"space-y-3"},xt={class:"flex items-start justify-between gap-2"},wt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},kt={class:"flex items-start justify-between gap-2"},Ct={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},Vt={class:"flex items-center justify-between gap-2"},St={class:"flex items-center gap-1 min-w-0 flex-1 justify-end"},$t={class:"text-sm font-medium text-heading leading-5 text-right truncate min-w-0"},It={key:0,class:"flex items-start justify-between gap-2"},Tt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},At={key:0,class:"mt-4 pt-4 border-t border-black/5"},Et={class:"space-y-0.5"},Mt=["onClick"],Dt={class:"text-sm font-medium text-heading truncate shrink-0 min-w-0"},Pt={class:"text-sm text-body truncate flex-1 min-w-0"},Lt={key:0,class:"text-sm font-bold text-heading shrink-0"},Ot={class:"text-sm text-sub shrink-0"},kn={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(s){const r=s,o=je(),a=_e(),f=We(),p=lt();q(()=>r.task.negotiations||r.task.activeNegotiations||0);const h=q(()=>{if(!r.task.customer)return[];const T=r.task.customer.email,d=r.task.customer.phone,B=r.task.compositeId;return[...(f.leads||[]).map(N=>({...N,type:"lead",compositeId:`lead-${N.id}`})),...(p.opportunities||[]).map(N=>({...N,type:"opportunity",compositeId:`opportunity-${N.id}`}))].filter(N=>N.compositeId===B||!N.customer?!1:N.customer.email===T||N.customer.phone===d).sort((N,I)=>new Date(I.createdAt||0)-new Date(N.createdAt||0)).slice(0,3)}),c=async(T,d)=>{if(T)try{await navigator.clipboard.writeText(T),o.pushToast("success",`${d==="email"?"Email":"Phone"} copied!`)}catch{o.pushToast("error","Failed to copy")}},V=()=>{var d;const T=((d=r.task.customer)==null?void 0:d.id)||r.customerId;if(T){const B=a.resolve(`/customer/${T}`).href;window.open(B,"_blank")}},M=T=>{const[d,B]=T.compositeId.split("-");a.push({path:`/tasks/${B}`,query:{type:d}})},m=T=>T.stage||T.currentStage||"Unknown",C=T=>{const d=T.createdAt||T.nextActionDue||T.updatedAt;if(!d)return"";try{return new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},u=T=>{const d=T.requestedCar||T.vehicle;if(!d)return"No vehicle";const B=d.brand||"",W=d.model||"",N=d.year?`(${d.year})`:"";return`${B} ${W} ${N}`.trim()||"Vehicle info N/A"},w=T=>T?T>=1e3?"€"+(T/1e3).toFixed(0)+"k":"€"+T:"€0";return(T,d)=>{var B,W,N,I,y,D;return g(),k("div",yt,[e("div",bt,[d[1]||(d[1]=e("h3",{class:"text-base font-medium text-heading leading-6"},"Customer information",-1)),(B=s.task.customer)!=null&&B.id?(g(),z(t(F),{key:0,variant:"ghost",size:"icon",onClick:V,class:j("h-7 w-7"),title:"Open customer profile in new tab"},{default:i(()=>[l(t(ut),{size:14,class:"text-sub"})]),_:1})):P("",!0)]),e("div",gt,[e("div",ht,[e("div",xt,[d[2]||(d[2]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Customer",-1)),e("p",wt,A(((W=s.task.customer)==null?void 0:W.name)||"Unknown"),1)]),e("div",kt,[d[3]||(d[3]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Email",-1)),e("p",Ct,A(((N=s.task.customer)==null?void 0:N.email)||"N/A"),1)]),e("div",Vt,[d[4]||(d[4]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Phone",-1)),e("div",St,[e("p",$t,A(((I=s.task.customer)==null?void 0:I.phone)||"N/A"),1),(y=s.task.customer)!=null&&y.phone?(g(),z(t(F),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 shrink-0 text-body hover:text-heading",title:"Copy phone number",onClick:d[0]||(d[0]=x=>c(s.task.customer.phone,"phone"))},{default:i(()=>[l(t(rt),{size:14})]),_:1})):P("",!0)])]),(D=s.task.customer)!=null&&D.address?(g(),k("div",It,[d[5]||(d[5]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Address",-1)),e("p",Tt,A(s.task.customer.address),1)])):P("",!0)]),h.value.length>0?(g(),k("div",At,[d[6]||(d[6]=e("h3",{class:"text-base font-medium text-heading mb-4 leading-6"},"Other customer requests",-1)),e("div",Et,[(g(!0),k(H,null,Z(h.value,x=>(g(),k("div",{key:x.compositeId,onClick:b=>M(x),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:j(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",x.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},A(x.type==="lead"?"Lead":"Opp"),3),e("span",Dt,A(m(x)),1),e("span",Pt,A(u(x)),1),x.type==="opportunity"&&x.estimatedValue?(g(),k("span",Lt,A(w(x.estimatedValue)),1)):P("",!0),e("span",Ot,A(C(x)),1)],8,Mt))),128))])])):P("",!0)])])}}},Ft={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},Ut={class:"mb-4"},Rt={class:"flex items-center justify-between mb-2"},Bt={class:"flex items-center gap-2 flex-wrap"},Nt={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},qt={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},zt={class:"relative"},jt={class:"space-y-6 flex-1 flex flex-col min-h-0"},_t={key:0,class:"flex-1 overflow-y-auto min-h-0"},Wt={class:"flex flex-col items-start gap-1 mb-4"},Ht={class:"text-sm font-normal text-sub leading-normal"},Qt={class:"space-y-4"},Yt=["onClick"],Gt={class:"flex-1 min-w-0"},Kt={class:"flex items-start justify-between gap-2"},Zt={class:"text-sm text-heading flex-1 wrap-break-word min-w-0 leading-normal"},Jt={key:0,class:"text-sub"},Xt={key:1,class:"text-sub"},el={key:2,class:"text-sub"},tl={key:3,class:"text-sub"},ll={key:4,class:"text-sub"},sl={key:5,class:"text-sub"},al={key:6,class:"text-sub"},ol={class:"text-sm text-sub text-right shrink-0 w-14 leading-normal"},nl={key:0,class:"mt-2 bg-[#fef7ee] rounded-lg p-4 backdrop-blur-sm"},il={class:"text-sm text-heading wrap-break-word leading-normal"},dl={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},rl={class:"text-sm text-heading wrap-break-word leading-normal"},ul={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},cl={class:"text-sm text-heading wrap-break-word leading-normal"},ml={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},fl={class:"text-sm text-heading wrap-break-word leading-normal"},pl={key:0,class:"flex items-center gap-2 flex-wrap"},vl={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},yl={class:"text-center"},bl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(s,{emit:r}){const o=s,a=r,f=O(!1),p=O(!1),h=O(null),c=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],V=O([]),M=()=>{p.value=!p.value},m=I=>{p.value=!1;const y=V.value.indexOf(I);y>-1?V.value.splice(y,1):V.value.push(I)},C=I=>{const y=V.value.indexOf(I);y>-1&&V.value.splice(y,1)},u=I=>{const y=c.find(D=>D.value===I);return y?y.label:I},w=q(()=>c.map(I=>({key:I.value,label:I.label,onClick:()=>m(I.value),className:V.value.includes(I.value)?"filter-item-selected":""}))),T=I=>I.important||I.isImportant?"important":["email","sms","whatsapp","call"].includes(I.type)?"communications":I.type==="note"?"notes":I.type==="transcription"||I.transcription?"transcriptions":I.type==="system"||I.type==="created"||I.type==="status"?"system-updates":null,d=q(()=>{let I=[...o.activities];return V.value.length>0&&(I=I.filter(y=>{const D=T(y);return D&&V.value.includes(D)})),I.sort((y,D)=>{const x=new Date(y.timestamp||y.createdAt||0).getTime();return new Date(D.timestamp||D.createdAt||0).getTime()-x})}),B=I=>{if(!I||I.length===0)return"";const y=I[0],D=y.timestamp||y.createdAt;if(!D)return"Recent Activity";const x=new Date(D),b=new Date,E=new Date(b);return E.setDate(E.getDate()-1),x.toDateString()===b.toDateString()?"Today":x.toDateString()===E.toDateString()?"Yesterday":x.toLocaleDateString("en-US",{month:"long",day:"numeric",year:x.getFullYear()!==b.getFullYear()?"numeric":void 0})},W=I=>{["note","email","whatsapp"].includes(I.type)&&a("activity-click",I)},N=I=>{f.value=!1,a("add-activity",I)};return(I,y)=>{const D=He("click-outside");return g(),k("div",Ft,[e("div",Ut,[e("div",Rt,[y[27]||(y[27]=e("h3",{class:"text-base font-medium text-heading leading-6"},"Activity",-1)),e("div",Bt,[e("div",{class:"relative",ref_key:"filterContainer",ref:h},[l(t(F),{variant:"outline",size:"icon",onClick:Ce(M,["stop"]),class:"relative w-8 h-8"},{default:i(()=>[y[12]||(y[12]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),V.value.length>0?(g(),k("span",Nt)):P("",!0)]),_:1}),l(Qe,{name:"dropdown"},{default:i(()=>[p.value?pe((g(),k("div",qt,[l(t(st),{items:w.value,className:"w-56"},null,8,["items"])])),[[D,()=>p.value=!1]]):P("",!0)]),_:1})],512),e("div",zt,[l(t(F),{variant:"default",size:"icon",onClick:y[0]||(y[0]=Ce(x=>f.value=!f.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:i(()=>[...y[13]||(y[13]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),f.value?pe((g(),k("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-lg py-1 z-50",onClick:y[11]||(y[11]=Ce(()=>{},["stop"]))},[e("button",{onClick:y[1]||(y[1]=x=>N("email")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[14]||(y[14]=[e("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),v(" Email ",-1)])]),e("button",{onClick:y[2]||(y[2]=x=>N("sms")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[15]||(y[15]=[e("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),v(" SMS ",-1)])]),e("button",{onClick:y[3]||(y[3]=x=>N("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[16]||(y[16]=[e("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),v(" WhatsApp ",-1)])]),e("button",{onClick:y[4]||(y[4]=x=>N("call")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[17]||(y[17]=[e("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),v(" Call ",-1)])]),y[24]||(y[24]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[5]||(y[5]=x=>N("note")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[18]||(y[18]=[e("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),v(" Note ",-1)])]),e("button",{onClick:y[6]||(y[6]=x=>N("attachment")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[19]||(y[19]=[e("i",{class:"fa-solid fa-paperclip text-sm text-sub"},null,-1),v(" Attachment ",-1)])]),y[25]||(y[25]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[7]||(y[7]=x=>N("financing")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[20]||(y[20]=[e("i",{class:"fa-solid fa-file-invoice-dollar text-sm text-primary"},null,-1),v(" Financing ",-1)])]),e("button",{onClick:y[8]||(y[8]=x=>N("tradein")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[21]||(y[21]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sm text-primary"},null,-1),v(" Trade-in ",-1)])]),e("button",{onClick:y[9]||(y[9]=x=>N("purchase")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[22]||(y[22]=[e("i",{class:"fa-solid fa-handshake text-sm text-primary"},null,-1),v(" Offer ",-1)])]),y[26]||(y[26]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[10]||(y[10]=x=>N("appointment")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[23]||(y[23]=[e("i",{class:"fa-regular fa-calendar text-sm text-purple-600"},null,-1),v(" Appointment ",-1)])])])),[[D,()=>f.value=!1]]):P("",!0)])])])]),e("div",jt,[d.value.length>0?(g(),k("div",_t,[e("div",Wt,[e("h3",Ht,A(B(d.value)),1)]),e("div",Qt,[(g(!0),k(H,null,Z(d.value,x=>(g(),k("div",{key:x.id,class:"space-y-2"},[e("div",{class:j(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":x.type==="note"||x.type==="email"||x.type==="whatsapp"}]),onClick:b=>W(x)},[e("div",{class:j(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",x.type==="note"?"bg-orange-100":x.type==="call"?"bg-green-100":x.type==="ai-summary"?"bg-purple-100":x.type==="email"?"bg-blue-100":x.type==="whatsapp"?"bg-green-100":"bg-surfaceSecondary"])},[x.type==="note"?(g(),z(t(vt),{key:0,size:16,class:"text-orange-600"})):x.type==="call"?(g(),z(t(pt),{key:1,size:16,class:"text-green-600"})):x.type==="ai-summary"?(g(),z(t(ot),{key:2,size:16,class:"text-purple-600"})):x.type==="email"?(g(),z(t(mt),{key:3,size:16,class:"text-blue-600"})):x.type==="whatsapp"?(g(),z(t(ft),{key:4,size:16,class:"text-green-600"})):(g(),z(t(ct),{key:5,size:16,class:"text-heading"}))],2),e("div",Gt,[e("div",Kt,[e("p",Zt,[e("span",{class:j(["font-normal",x.type==="ai-summary"?"font-medium":""])},A(x.type==="ai-summary"?"MotorKAI":x.user),3),x.type==="note"?(g(),k("span",Jt," added a note")):x.type==="created"?(g(),k("span",Xt,A(x.message||x.action),1)):x.type==="call"?(g(),k("span",el,A(" "+(x.message||x.action)),1)):x.type==="ai-summary"?(g(),k("span",tl," summary")):x.type==="email"?(g(),k("span",ll,A(" sent an email"))):x.type==="whatsapp"?(g(),k("span",sl,A(" sent a WhatsApp message"))):(g(),k("span",al,A(" "+(x.message||x.action)),1))]),e("p",ol,A(x.time),1)]),x.type==="note"&&(x.message||x.content)?(g(),k("div",nl,[e("p",il,A(x.message||x.content),1)])):P("",!0),x.type==="email"&&x.content?(g(),k("div",dl,[e("p",rl,A(x.content),1)])):P("",!0),x.type==="whatsapp"&&x.content?(g(),k("div",ul,[e("p",cl,A(x.content),1)])):P("",!0),x.type==="ai-summary"&&(x.message||x.content)?(g(),k("div",ml,[e("p",fl,A(x.message||x.content),1)])):P("",!0)])],10,Yt)]))),128)),V.value.length>0?(g(),k("div",pl,[(g(!0),k(H,null,Z(V.value,x=>(g(),k("div",{key:x,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-sm font-medium text-heading border border-black/5"},[e("span",null,A(u(x)),1),l(t(F),{variant:"ghost",size:"icon",onClick:b=>C(x),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:i(()=>[...y[28]||(y[28]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):P("",!0)])])):(g(),k("div",vl,[e("div",yl,[l(t(dt),{size:32,class:"mx-auto text-sub mb-2"}),y[29]||(y[29]=e("p",{class:"text-sm text-sub"},"No activity yet",-1))])]))])])}}},Cn=Be(bl,[["__scopeId","data-v-d6092c27"]]),gl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},hl={class:"space-y-2"},xl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},wl={key:1,class:"flex justify-between items-center mb-4"},kl={class:"text-fluid-sm font-semibold text-heading"},Cl={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Vn={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O(""),h=O(!1);ge(()=>{a.item&&(p.value=a.item.content||a.item.message||"")}),ne(()=>a.item,m=>{m&&(p.value=m.content||m.message||"")},{deep:!0}),ne(()=>a.show,m=>{a.modal&&!m&&setTimeout(()=>{p.value=a.item&&(a.item.content||a.item.message)||"",h.value=!1},300)});const c=async()=>{var m,C;if(p.value.trim()){h.value=!0;try{const u={id:((m=a.item)==null?void 0:m.id)||Date.now(),type:"note",action:a.item?"updated a note":"added a note",content:p.value,message:p.value,timestamp:((C=a.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",u),a.modal&&f("close")}finally{h.value=!1}}},V=()=>{f("cancel"),a.modal&&f("close")},M=m=>{m||f("close")};return r({submit:c,canSubmit:()=>!!p.value.trim()}),(m,C)=>s.modal?(g(),z(t(se),{key:0,open:s.show,"onUpdate:open":M},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(A(s.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),e("div",gl,[e("div",hl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[2]||(C[2]=[v(" Note ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":C[0]||(C[0]=u=>p.value=u),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:V}),l(t(F),{label:h.value?"Saving...":s.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value.trim()||h.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(g(),k("div",{key:1,class:j(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!s.hideHeader}])},[s.hideHeader?P("",!0):(g(),k("div",xl)),s.hideHeader?P("",!0):(g(),k("div",wl,[e("h5",kl,A(s.item?"Edit Note":"Add Note"),1),e("button",{onClick:V,class:"text-sub hover:text-body"},[...C[3]||(C[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[C[4]||(C[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),pe(e("textarea",{"onUpdate:modelValue":C[1]||(C[1]=u=>p.value=u),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[Ve,p.value]])]),s.hideActions?P("",!0):(g(),k("div",Cl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",onClick:V}),l(t(F),{label:"Save",variant:"primary",size:"small",onClick:c})]))],2))}},Vl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Sl={class:"space-y-2"},$l={class:"flex items-center gap-3"},Il={key:0,class:"text-sm text-body truncate"},Tl={key:1,class:"text-sm text-sub"},Al={key:1,class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},El={class:"flex justify-between items-center mb-4"},Ml={class:"text-fluid-sm font-semibold text-heading"},Dl={class:"flex items-center gap-3"},Pl={key:0,class:"text-fluid-sm text-slate-600"},Ll={key:1,class:"text-fluid-sm text-sub"},Ol={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Sn={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O(null),h=O(""),c=O(!1),V=O(null);ge(()=>{a.item&&(h.value=a.item.fileName||"")}),ne(()=>a.item,w=>{w&&(h.value=w.fileName||"")},{deep:!0}),ne(()=>a.show,w=>{a.modal&&!w&&setTimeout(()=>{p.value=null,h.value=a.item&&a.item.fileName||"",c.value=!1},300)});const M=w=>{const T=w.target.files[0];T&&(p.value=T,h.value=T.name)},m=async()=>{var w,T;if(!(!p.value&&!a.item)){c.value=!0;try{const d={id:((w=a.item)==null?void 0:w.id)||Date.now(),type:"attachment",action:a.item?"updated an attachment":"added an attachment",fileName:h.value,file:p.value,timestamp:((T=a.item)==null?void 0:T.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",d),a.modal&&f("close")}finally{c.value=!1}}},C=()=>{f("cancel"),a.modal&&f("close")},u=w=>{w||f("close")};return r({submit:m,canSubmit:()=>!!p.value||!!a.item}),(w,T)=>s.modal?(g(),z(t(se),{key:0,open:s.show,"onUpdate:open":u},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(A(s.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),e("div",Vl,[e("div",Sl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...T[2]||(T[2]=[v(" File ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),e("div",$l,[e("input",{type:"file",onChange:M,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(F),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:T[0]||(T[0]=d=>{var B;return(B=V.value)==null?void 0:B.click()})}),h.value?(g(),k("span",Il,A(h.value),1)):(g(),k("span",Tl,"No file selected"))])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:C}),l(t(F),{label:c.value?"Saving...":s.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value||c.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(g(),k("div",Al,[T[5]||(T[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",El,[e("h5",Ml,A(s.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:C,class:"text-sub hover:text-body"},[...T[3]||(T[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[T[4]||(T[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Dl,[e("input",{type:"file",onChange:M,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(F),{label:"Choose File",variant:"outline",size:"small",onClick:T[1]||(T[1]=d=>w.$refs.fileInput.click())}),h.value?(g(),k("span",Pl,A(h.value),1)):(g(),k("span",Ll,"No file selected"))])]),e("div",Ol,[l(t(F),{label:"Cancel",variant:"outline",size:"small",onClick:C}),l(t(F),{label:"Save",variant:"primary",size:"small",disabled:!p.value,onClick:m},null,8,["disabled"])])]))}},Fl={class:"space-y-6"},Ul={class:"space-y-2"},Rl={class:"space-y-2"},Bl={class:"flex justify-end gap-3"},Nl={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(o.initialMessage),h={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},c=()=>{f.value&&h[f.value]&&(p.value=h[f.value])},V=()=>{p.value.trim()&&a("send",{type:"whatsapp",template:f.value,message:p.value})};return(M,m)=>(g(),k("div",Fl,[e("div",Ul,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),l(t(R),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(R),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),l(t(R),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Rl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=C=>p.value=C),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Bl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>M.$emit("cancel"))}),l(t(F),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:V})])]))}},$n={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,h)=>(g(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...h[1]||(h[1]=[v("Send WhatsApp Message",-1)])]),_:1})]),_:1}),l(Nl,{onSend:a,onCancel:h[0]||(h[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},ql={class:"space-y-6"},zl={class:"space-y-2"},jl={class:"space-y-2"},_l={class:"text-xs text-sub mt-1"},Wl={class:"flex justify-end gap-3"},Hl={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(o.initialMessage),h={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},c=()=>{f.value&&h[f.value]&&(p.value=h[f.value])},V=()=>{p.value.trim()&&a("send",{type:"sms",template:f.value,message:p.value})};return(M,m)=>(g(),k("div",ql,[e("div",zl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),l(t(R),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(R),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),l(t(R),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",jl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=C=>p.value=C),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),e("p",_l,A(p.value.length)+"/160 characters",1)]),e("div",Wl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>M.$emit("cancel"))}),l(t(F),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:V})])]))}},In={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,h)=>(g(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...h[1]||(h[1]=[v("Send SMS",-1)])]),_:1})]),_:1}),l(Hl,{onSend:a,onCancel:h[0]||(h[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ql={class:"space-y-6"},Yl={class:"space-y-2"},Gl={class:"space-y-2"},Kl={class:"space-y-2"},Zl={class:"flex justify-end gap-3"},Jl={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(""),h=O(o.initialMessage),c={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},V=()=>{f.value&&c[f.value]&&(p.value=c[f.value].subject,h.value=c[f.value].message)},M=()=>{h.value.trim()&&a("send",{type:"email",template:f.value,subject:p.value,message:h.value})};return(m,C)=>(g(),k("div",Ql,[e("div",Yl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[4]||(C[4]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[C[0]||(C[0]=u=>f.value=u),V]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Follow-up"},{default:i(()=>[...C[5]||(C[5]=[v("Follow-up",-1)])]),_:1}),l(t(R),{value:"Meeting Confirmation"},{default:i(()=>[...C[6]||(C[6]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(R),{value:"Quote Proposal"},{default:i(()=>[...C[7]||(C[7]=[v("Quote Proposal",-1)])]),_:1}),l(t(R),{value:"Unable to Reach"},{default:i(()=>[...C[8]||(C[8]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Gl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[9]||(C[9]=[v("Subject",-1)])]),_:1}),l(t(L),{modelValue:p.value,"onUpdate:modelValue":C[1]||(C[1]=u=>p.value=u),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Kl,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[10]||(C[10]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:h.value,"onUpdate:modelValue":C[2]||(C[2]=u=>h.value=u),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Zl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:C[3]||(C[3]=u=>m.$emit("cancel"))}),l(t(F),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:M})])]))}},Tn={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,h)=>(g(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...h[1]||(h[1]=[v("Send Email",-1)])]),_:1})]),_:1}),l(Jl,{onSend:a,onCancel:h[0]||(h[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},An={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(s,{emit:r}){const o=r,a=p=>{p||o("close")},f=()=>{o("close")};return(p,h)=>(g(),z(t(se),{open:s.show,"onUpdate:open":a},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(A(s.title),1)]),_:1})]),_:1}),h[0]||(h[0]=e("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[e("div",{class:"flex items-center justify-center w-full"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class Xl extends Ye{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(r={}){await new Promise(a=>setTimeout(a,300));let o=[...this.dataSource];return r.leadId!==void 0&&(o=o.filter(a=>a.leadId===parseInt(r.leadId))),r.opportunityId!==void 0&&(o=o.filter(a=>a.opportunityId===parseInt(r.opportunityId))),r.type&&(o=o.filter(a=>a.type===r.type)),r.offerId!==void 0&&(o=o.filter(a=>a.offerId===parseInt(r.offerId))),r.vehicleId!==void 0&&(o=o.filter(a=>a.vehicleId===parseInt(r.vehicleId))),o}async findAllByLeadId(r){return this.findAll({leadId:r})}async findAllByOpportunityId(r){return this.findAll({opportunityId:r})}async findById(r){return await new Promise(a=>setTimeout(a,300)),this.dataSource.find(a=>a.id===parseInt(r))||null}async create(r){await new Promise(f=>setTimeout(f,300));const a={id:this.dataSource.length>0?Math.max(...this.dataSource.map(f=>f.id))+1:1,type:r.type,leadId:r.leadId!==void 0?parseInt(r.leadId):void 0,opportunityId:r.opportunityId!==void 0?parseInt(r.opportunityId):void 0,offerId:r.offerId!==void 0?parseInt(r.offerId):void 0,vehicleId:r.vehicleId!==void 0?parseInt(r.vehicleId):void 0,fields:r.fields||{},currency:r.currency||"EUR",offerValidFrom:r.offerValidFrom||null,offerValidTo:r.offerValidTo||null,status:r.status||"active",createdAt:r.createdAt||new Date().toISOString(),createdBy:r.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(a),a}async update(r,o){await new Promise(f=>setTimeout(f,300));const a=this.dataSource.find(f=>f.id===parseInt(r));if(!a)throw new Error("Purchase method not found");return Object.assign(a,o,{updatedAt:new Date().toISOString()}),a}async delete(r){await new Promise(a=>setTimeout(a,300));const o=this.dataSource.findIndex(a=>a.id===parseInt(r));if(o===-1)throw new Error("Purchase method not found");return this.dataSource.splice(o,1),{success:!0}}}class es{constructor(){this.repository=new Xl}calculateTotal(r){const{type:o,fields:a}=r;if(!a)return 0;const f=parseFloat(a.monthlyInstalment)||0,p=parseFloat(a.downPayment)||0,h=parseInt(a.duration)||0;switch(o){case"FIN":return f*h+p;case"LEA":const c=parseFloat(a.finalInstalment)||0;return f*h+p+c;case"LTR":return f*h+p;default:return 0}}validate(r){const o=[],{type:a,fields:f}=r;if((!a||!["FIN","LEA","LTR"].includes(a))&&o.push("Purchase method type is required and must be FIN, LEA, or LTR"),!f)return o.push("Purchase method fields are required"),{isValid:!1,errors:o};const p=parseFloat(f.monthlyInstalment);(!p||p<=0)&&o.push("Monthly Instalment must be greater than 0");const h=parseFloat(f.downPayment);(h==null||h<0)&&o.push("Down Payment must be greater than or equal to 0");const c=parseInt(f.duration);if((!c||c<12||c>60)&&o.push("Duration must be between 12 and 60 months"),a==="FIN"){const V=parseFloat(f.interestRate);V!=null&&(V<0||V>99.99)&&o.push("Interest Rate must be between 0 and 99.99%");const M=parseFloat(f.effectiveInterestRate);M!=null&&(M<0||M>99.99)&&o.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(a==="LEA"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&o.push("Mileage Limit must be greater than 0 if provided");const M=parseFloat(f.finalInstalment);M!=null&&M<0&&o.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(f.interestRate);m!=null&&(m<0||m>99.99)&&o.push("Interest Rate must be between 0 and 99.99%")}if(a==="LTR"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&o.push("Mileage Limit must be greater than 0 if provided"),(!f.customerType||!["Private","Business","Fleet"].includes(f.customerType))&&o.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:o.length===0,errors:o}}async findAll(r={}){return await this.repository.findAll(r)}async findById(r){return await this.repository.findById(r)}async create(r){const o=this.validate(r);if(!o.isValid)throw new Error(`Validation failed: ${o.errors.join(", ")}`);const a=await this.repository.create(r),f=this.calculateTotal(a);return a.fields={...a.fields,totalAmount:f},await this.repository.update(a.id,{fields:a.fields})}async update(r,o){const a=await this.repository.findById(r);if(!a)throw new Error("Purchase method not found");const f={...a,...o,fields:{...a.fields,...o.fields}},p=this.validate(f);if(!p.isValid)throw new Error(`Validation failed: ${p.errors.join(", ")}`);const h=this.calculateTotal(f);return f.fields.totalAmount=h,await this.repository.update(r,{...o,fields:f.fields})}async delete(r){return await this.repository.delete(r)}}const xe=new es,we=(s=300)=>new Promise(r=>setTimeout(r,s)),ts=async(s={})=>(await we(),await xe.findAll(s)),ls=async s=>(await we(),await xe.findById(s)),ss=async s=>(await we(),await xe.create(s)),as=async(s,r)=>(await we(),await xe.update(s,r)),os=async s=>(await we(),await xe.delete(s)),ns=Ge("purchaseMethods",()=>{const s=O([]),r=O(null),o=O(!1),a=O(null),f=q(()=>u=>s.value.filter(w=>w.type===u)),p=q(()=>u=>s.value.filter(w=>w.leadId===parseInt(u))),h=q(()=>u=>s.value.filter(w=>w.opportunityId===parseInt(u)));return{purchaseMethods:s,currentPurchaseMethod:r,loading:o,error:a,purchaseMethodsByType:f,purchaseMethodsByLead:p,purchaseMethodsByOpportunity:h,fetchPurchaseMethods:async(u={})=>{o.value=!0,a.value=null;try{const w=await ts(u);return s.value=w,w}catch(w){throw a.value=w.message,w}finally{o.value=!1}},fetchPurchaseMethodById:async u=>{o.value=!0,a.value=null;try{return r.value=await ls(u),r.value}catch(w){throw a.value=w.message,w}finally{o.value=!1}},createPurchaseMethod:async u=>{o.value=!0,a.value=null;try{const w=await ss(u);return s.value.push(w),w}catch(w){throw a.value=w.message,w}finally{o.value=!1}},updatePurchaseMethod:async(u,w)=>{var T;o.value=!0,a.value=null;try{const d=await as(u,w),B=s.value.findIndex(W=>W.id===u);return B!==-1&&(s.value[B]=d),((T=r.value)==null?void 0:T.id)===u&&(r.value=d),d}catch(d){throw a.value=d.message,d}finally{o.value=!1}},deletePurchaseMethod:async u=>{var w;o.value=!0,a.value=null;try{await os(u),s.value=s.value.filter(T=>T.id!==u),((w=r.value)==null?void 0:w.id)===u&&(r.value=null)}catch(T){throw a.value=T.message,T}finally{o.value=!1}}}}),is={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ds={class:"flex gap-2"},rs=["value"],us={key:0,class:"space-y-4"},cs={class:"text-h3-card text-heading mb-4"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fs={class:"relative"},ps={key:0,class:"text-xs text-red-600 mt-1"},vs={class:"relative"},ys={key:0,class:"text-xs text-red-600 mt-1"},bs={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gs={key:0,class:"text-xs text-red-600 mt-1"},hs={class:"space-y-2"},xs={key:0,class:"text-xs text-red-600 mt-1"},ws={key:0,class:"text-xs text-red-600 mt-1"},ks={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Cs={class:"flex justify-between items-center"},Vs={class:"text-lg font-bold text-heading"},Ss={class:"flex flex-col gap-3"},$s={class:"flex items-center gap-2"},Is={class:"flex items-center gap-2"},Ts={class:"flex items-center gap-2"},As={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},Es={class:"space-y-2"},Ms={class:"space-y-2"},Ds={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},Ps={class:"list-disc list-inside text-sm text-red-700 space-y-1"},Ls={key:0},Os={key:1},Fs={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:s=>["lead","opportunity"].includes(s)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(s,{emit:r}){const o=s,a=r,f=ns(),p=Ke(),h=O(!1),c=O({}),V=O([]),M=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],m=O({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),C=q(()=>!!o.purchaseMethod);q(()=>{if(m.value.type!=="LEA")return 0;const x=parseFloat(m.value.fields.monthlyInstalment)||0,b=parseInt(m.value.fields.duration)||0,E=parseFloat(m.value.fields.downPayment)||0,me=parseFloat(m.value.fields.finalInstalment)||0;return x*b+E+me});const u=q(()=>{if(m.value.type!=="LTR")return 0;const x=parseFloat(m.value.fields.monthlyInstalment)||0,b=parseInt(m.value.fields.duration)||0,E=parseFloat(m.value.fields.downPayment)||0;return x*b+E}),w=x=>x==="FIN"?[12,24,36,48,60]:x==="LEA"?[24,36,48,60]:x==="LTR"?[12,24,36,48,60]:[],T=x=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[x]||x,d=x=>{const b=m.value.fields[x];switch(x){case"monthlyInstalment":!b||b<=0?c.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete c.value.monthlyInstalment;break;case"downPayment":b==null||b<0?c.value.downPayment="Down Payment must be greater than or equal to 0":delete c.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!b||b<12||b>60)?c.value.duration="Duration must be between 12 and 60 months":delete c.value.duration;break;case"customerType":m.value.type==="LTR"&&(!b||!["Private","Business","Fleet"].includes(b))?c.value.customerType="Customer Type is required":delete c.value.customerType;break}},B=x=>{delete c.value[x]},W=()=>{V.value=[],c.value={};const x=xe.validate({type:m.value.type,fields:m.value.fields});return x.isValid||(V.value=x.errors,x.errors.forEach(b=>{b.includes("Monthly Instalment")?c.value.monthlyInstalment=b:b.includes("Down Payment")?c.value.downPayment=b:b.includes("Duration")?c.value.duration=b:b.includes("Customer Type")&&(c.value.customerType=b)})),x.isValid},N=q(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(c.value).length===0),I=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),c.value={},V.value=[]},y=async()=>{var x;if(W()){h.value=!0;try{const b={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((x=p.currentUser)==null?void 0:x.id)||null};o.taskType==="lead"?b.leadId=parseInt(o.taskId):o.taskType==="opportunity"&&(b.opportunityId=parseInt(o.taskId)),o.vehicleId&&(b.vehicleId=parseInt(o.vehicleId)),o.offerId&&(b.offerId=parseInt(o.offerId));let E;C.value?E=await f.updatePurchaseMethod(o.purchaseMethod.id,b):E=await f.createPurchaseMethod(b);const me=T(E.type),Se=Fe(E.fields.monthlyInstalment||0);a("save",{...E,successMessage:`Purchase Method Added: ${me} - €${Se}/month`}),a("close")}catch(b){V.value=[b.message||"Failed to save purchase method"]}finally{h.value=!1}}},D=x=>{x||a("close")};return ge(()=>{o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null})}),ne(()=>o.show,x=>{x?o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},c.value={},V.value=[],h.value=!1},300)}),(x,b)=>(g(),z(t(se),{open:s.show,"onUpdate:open":D},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(A(C.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),e("div",is,[e("div",null,[b[19]||(b[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",ds,[(g(),k(H,null,Z(M,E=>e("label",{key:E.value,class:"flex-1 cursor-pointer"},[pe(e("input",{type:"radio",value:E.value,"onUpdate:modelValue":b[0]||(b[0]=me=>m.value.type=me),class:"sr-only",onChange:I},null,40,rs),[[Ze,m.value.type]]),e("div",{class:j(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",m.value.type===E.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},A(E.label),3)])),64))])]),m.value.type?(g(),k("div",us,[e("h3",cs,A(T(m.value.type))+" Details ",1),e("div",ms,[e("div",null,[b[21]||(b[21]=e("label",{class:"block label-upper mb-2"},[v(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fs,[b[20]||(b[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),pe(e("input",{"onUpdate:modelValue":b[1]||(b[1]=E=>m.value.fields.monthlyInstalment=E),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.monthlyInstalment}]),onInput:b[2]||(b[2]=E=>B("monthlyInstalment")),onBlur:b[3]||(b[3]=E=>d("monthlyInstalment"))},null,34),[[Ve,m.value.fields.monthlyInstalment,void 0,{number:!0}]])]),c.value.monthlyInstalment?(g(),k("p",ps,A(c.value.monthlyInstalment),1)):P("",!0),b[22]||(b[22]=e("p",{class:"text-xs text-sub mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[b[24]||(b[24]=e("label",{class:"block label-upper mb-2"},[v(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",vs,[b[23]||(b[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),pe(e("input",{"onUpdate:modelValue":b[4]||(b[4]=E=>m.value.fields.downPayment=E),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.downPayment}]),onInput:b[5]||(b[5]=E=>B("downPayment")),onBlur:b[6]||(b[6]=E=>d("downPayment"))},null,34),[[Ve,m.value.fields.downPayment,void 0,{number:!0}]])]),c.value.downPayment?(g(),k("p",ys,A(c.value.downPayment),1)):P("",!0),b[25]||(b[25]=e("p",{class:"text-xs text-sub mt-1"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(g(),k("div",bs,[e("div",null,[b[26]||(b[26]=e("label",{class:"block label-upper mb-2"},[v(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[b[7]||(b[7]=E=>m.value.fields.duration=E),b[8]||(b[8]=E=>B("duration"))]},{default:i(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.duration}])},{default:i(()=>[l(t(Y),{placeholder:"Select duration..."})]),_:1},8,["class"]),l(t(G),null,{default:i(()=>[(g(!0),k(H,null,Z(w(m.value.type),E=>(g(),z(t(R),{key:E,value:E},{default:i(()=>[v(A(E)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c.value.duration?(g(),k("p",gs,A(c.value.duration),1)):P("",!0)]),e("div",hs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...b[27]||(b[27]=[v("Unlock Kilometers",-1)])]),_:1}),l(t(L),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":b[9]||(b[9]=E=>m.value.fields.mileageLimit=E),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:j(["w-full h-10",{"border-red-500":c.value.mileageLimit}]),onInput:b[10]||(b[10]=E=>B("mileageLimit"))},null,8,["modelValue","class"]),c.value.mileageLimit?(g(),k("p",xs,A(c.value.mileageLimit),1)):P("",!0)])])):P("",!0),m.value.type==="LTR"?(g(),k(H,{key:1},[e("div",null,[b[31]||(b[31]=e("label",{class:"block label-upper mb-2"},[v(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[b[11]||(b[11]=E=>m.value.fields.customerType=E),b[12]||(b[12]=E=>B("customerType"))]},{default:i(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.customerType}])},{default:i(()=>[l(t(Y),{placeholder:"Select customer type..."})]),_:1},8,["class"]),l(t(G),null,{default:i(()=>[l(t(R),{value:"Private"},{default:i(()=>[...b[28]||(b[28]=[v("Private",-1)])]),_:1}),l(t(R),{value:"Business"},{default:i(()=>[...b[29]||(b[29]=[v("Business",-1)])]),_:1}),l(t(R),{value:"Fleet"},{default:i(()=>[...b[30]||(b[30]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value.customerType?(g(),k("p",ws,A(c.value.customerType),1)):P("",!0)]),e("div",ks,[e("div",Cs,[b[32]||(b[32]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",Vs,"€ "+A(t(Fe)(u.value)),1)]),b[33]||(b[33]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Ss,[e("div",$s,[l(t(oe),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":b[13]||(b[13]=E=>m.value.fields.insuranceIncluded=E)},null,8,["checked"]),l(t($),{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...b[34]||(b[34]=[v(" Insurance Included ",-1)])]),_:1})]),e("div",Is,[l(t(oe),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":b[14]||(b[14]=E=>m.value.fields.maintenanceIncluded=E)},null,8,["checked"]),l(t($),{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...b[35]||(b[35]=[v(" Maintenance Included ",-1)])]),_:1})]),e("div",Ts,[l(t(oe),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":b[15]||(b[15]=E=>m.value.fields.registrationTaxesIncluded=E)},null,8,["checked"]),l(t($),{for:"ltr-registration",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...b[36]||(b[36]=[v(" Registration/Taxes Included ",-1)])]),_:1})])])],64)):P("",!0),e("div",As,[e("div",Es,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...b[37]||(b[37]=[v("Offer Valid From",-1)])]),_:1}),l(t(L),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":b[16]||(b[16]=E=>m.value.offerValidFrom=E),type:"date",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Ms,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...b[38]||(b[38]=[v("Offer Valid To",-1)])]),_:1}),l(t(L),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":b[17]||(b[17]=E=>m.value.offerValidTo=E),type:"date",class:"w-full h-10"},null,8,["modelValue"])])])])):P("",!0),V.value.length>0?(g(),k("div",Ds,[b[39]||(b[39]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Ps,[(g(!0),k(H,null,Z(V.value,E=>(g(),k("li",{key:E},A(E),1))),128))])])):P("",!0)]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[18]||(b[18]=E=>x.$emit("close"))}),l(t(F),{label:C.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!N.value||h.value,onClick:y},{default:i(()=>[h.value?(g(),k("span",Ls,"Saving...")):(g(),k("span",Os,A(C.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},En=Be(Fs,[["__scopeId","data-v-c85eec7d"]]),Us={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},Rs={key:0,class:"space-y-4 py-4 w-full"},Bs={class:"grid grid-cols-1 gap-3"},Ns={key:1,class:"space-y-6 w-full"},qs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zs={class:"space-y-2"},js={class:"space-y-2"},_s={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ws={class:"space-y-2"},Hs={class:"space-y-2"},Qs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ys={class:"space-y-2"},Gs={class:"space-y-2"},Ks={class:"space-y-2"},Zs={class:"space-y-2"},Js={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xs={class:"space-y-2"},ea={class:"space-y-2"},ta={class:"space-y-2"},la={class:"space-y-2"},sa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},aa={class:"space-y-2"},oa={class:"space-y-2"},na={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ia={class:"space-y-2"},da={class:"space-y-2"},ra={class:"space-y-2"},ua={class:"space-y-2"},ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ma={class:"space-y-2"},fa={class:"space-y-2"},pa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},va={class:"space-y-2"},ya={class:"space-y-2"},Mn={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:s=>["vehicle","tradein"].includes(s)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(s,{emit:r}){const o=s,a=r,f=O(o.mode==="tradein"?"tradein":null);ne(()=>o.mode,C=>{C==="tradein"?f.value="tradein":o.item||(f.value=null)});const p=q(()=>o.mode==="tradein"||f.value==="tradein"),h=()=>o.mode==="tradein"||f.value==="tradein"?"Add Trade-In Vehicle":f.value==="drove"?"Add Drove Vehicle":f.value==="requested"?"Add Requested Vehicle":"Add Vehicle",c=O({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});ge(()=>{o.item&&o.item.data&&(c.value={brand:o.item.data.brand||"",model:o.item.data.model||"",year:o.item.data.year||"",version:o.item.data.version||"",vin:o.item.data.vin||"",plates:o.item.data.plate||o.item.data.plates||"",fuelType:o.item.data.fuelType||"",gearType:o.item.data.gearType||"",kilometers:o.item.data.km||o.item.data.kilometers||"",registration:o.item.data.date||o.item.data.registration||"",owner:o.item.data.owner||"",ownershipType:o.item.data.ownershipType||"",ownedSince:o.item.data.ownedSince||"",warrantyInfo:o.item.data.warrantyInfo||"",note:o.item.data.note||"",stockDays:null})}),ne(()=>o.show,C=>{C||(f.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const V=q(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),M=C=>{C||a("close")},m=()=>{if(!V.value)return;const C={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,note:c.value.note||null,stockDays:null,status:"Available"}};f.value&&(C.vehicleType=f.value),o.item&&(C.id=o.item.id,C.isEdit=!0,C.timestamp=o.item.timestamp||new Date().toISOString()),a("save",C)};return(C,u)=>(g(),z(t(se),{open:s.show,"onUpdate:open":M},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(A(h()),1)]),_:1})]),_:1}),e("div",Us,[s.mode==="vehicle"&&!s.item&&!f.value?(g(),k("div",Rs,[u[26]||(u[26]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Bs,[l(t(F),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[0]||(u[0]=w=>f.value="drove")}),l(t(F),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[1]||(u[1]=w=>f.value="requested")}),l(t(F),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:u[2]||(u[2]=w=>f.value="tradein")})])])):(g(),k("div",Ns,[p.value?(g(),k(H,{key:0},[e("div",qs,[e("div",zs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[27]||(u[27]=[v("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(L),{modelValue:c.value.brand,"onUpdate:modelValue":u[3]||(u[3]=w=>c.value.brand=w),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",js,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[28]||(u[28]=[v("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(L),{modelValue:c.value.model,"onUpdate:modelValue":u[4]||(u[4]=w=>c.value.model=w),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])])]),e("div",_s,[e("div",Ws,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[29]||(u[29]=[v("Year (or registration year) ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(L),{modelValue:c.value.year,"onUpdate:modelValue":u[5]||(u[5]=w=>c.value.year=w),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),e("div",Hs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[30]||(u[30]=[v("Kilometers",-1)])]),_:1}),l(t(L),{modelValue:c.value.kilometers,"onUpdate:modelValue":u[6]||(u[6]=w=>c.value.kilometers=w),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",Qs,[e("div",Ys,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[31]||(u[31]=[v("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":u[7]||(u[7]=w=>c.value.fuelType=w)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Petrol"},{default:i(()=>[...u[32]||(u[32]=[v("Petrol",-1)])]),_:1}),l(t(R),{value:"Diesel"},{default:i(()=>[...u[33]||(u[33]=[v("Diesel",-1)])]),_:1}),l(t(R),{value:"Electric"},{default:i(()=>[...u[34]||(u[34]=[v("Electric",-1)])]),_:1}),l(t(R),{value:"Hybrid"},{default:i(()=>[...u[35]||(u[35]=[v("Hybrid",-1)])]),_:1}),l(t(R),{value:"Plug-in Hybrid"},{default:i(()=>[...u[36]||(u[36]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Gs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[37]||(u[37]=[v("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":u[8]||(u[8]=w=>c.value.gearType=w)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Manual"},{default:i(()=>[...u[38]||(u[38]=[v("Manual",-1)])]),_:1}),l(t(R),{value:"Automatic"},{default:i(()=>[...u[39]||(u[39]=[v("Automatic",-1)])]),_:1}),l(t(R),{value:"CVT"},{default:i(()=>[...u[40]||(u[40]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",Ks,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[41]||(u[41]=[v("Plates",-1)])]),_:1}),l(t(L),{modelValue:c.value.plates,"onUpdate:modelValue":u[9]||(u[9]=w=>c.value.plates=w),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"]),u[42]||(u[42]=e("p",{class:"text-xs text-sub mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",Zs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[43]||(u[43]=[v("Note",-1)])]),_:1}),l(t(ue),{modelValue:c.value.note,"onUpdate:modelValue":u[10]||(u[10]=w=>c.value.note=w),rows:"5",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])],64)):(g(),k(H,{key:1},[e("div",Js,[e("div",Xs,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[44]||(u[44]=[v("Brand",-1)])]),_:1}),l(t(L),{modelValue:c.value.brand,"onUpdate:modelValue":u[11]||(u[11]=w=>c.value.brand=w),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",ea,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[45]||(u[45]=[v("Model",-1)])]),_:1}),l(t(L),{modelValue:c.value.model,"onUpdate:modelValue":u[12]||(u[12]=w=>c.value.model=w),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",ta,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[46]||(u[46]=[v("Year",-1)])]),_:1}),l(t(L),{modelValue:c.value.year,"onUpdate:modelValue":u[13]||(u[13]=w=>c.value.year=w),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",la,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[47]||(u[47]=[v("Version/Trim",-1)])]),_:1}),l(t(L),{modelValue:c.value.version,"onUpdate:modelValue":u[14]||(u[14]=w=>c.value.version=w),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),e("div",sa,[e("div",aa,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[48]||(u[48]=[v("VIN",-1)])]),_:1}),l(t(L),{modelValue:c.value.vin,"onUpdate:modelValue":u[15]||(u[15]=w=>c.value.vin=w),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),e("div",oa,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[49]||(u[49]=[v("Plates",-1)])]),_:1}),l(t(L),{modelValue:c.value.plates,"onUpdate:modelValue":u[16]||(u[16]=w=>c.value.plates=w),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",na,[e("div",ia,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[50]||(u[50]=[v("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":u[17]||(u[17]=w=>c.value.fuelType=w)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Petrol"},{default:i(()=>[...u[51]||(u[51]=[v("Petrol",-1)])]),_:1}),l(t(R),{value:"Diesel"},{default:i(()=>[...u[52]||(u[52]=[v("Diesel",-1)])]),_:1}),l(t(R),{value:"Electric"},{default:i(()=>[...u[53]||(u[53]=[v("Electric",-1)])]),_:1}),l(t(R),{value:"Hybrid"},{default:i(()=>[...u[54]||(u[54]=[v("Hybrid",-1)])]),_:1}),l(t(R),{value:"Plug-in Hybrid"},{default:i(()=>[...u[55]||(u[55]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",da,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[56]||(u[56]=[v("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":u[18]||(u[18]=w=>c.value.gearType=w)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Manual"},{default:i(()=>[...u[57]||(u[57]=[v("Manual",-1)])]),_:1}),l(t(R),{value:"Automatic"},{default:i(()=>[...u[58]||(u[58]=[v("Automatic",-1)])]),_:1}),l(t(R),{value:"CVT"},{default:i(()=>[...u[59]||(u[59]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ra,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[60]||(u[60]=[v("Mileage (km)",-1)])]),_:1}),l(t(L),{modelValue:c.value.kilometers,"onUpdate:modelValue":u[19]||(u[19]=w=>c.value.kilometers=w),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",ua,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[61]||(u[61]=[v("Registration Year/Month",-1)])]),_:1}),l(t(L),{modelValue:c.value.registration,"onUpdate:modelValue":u[20]||(u[20]=w=>c.value.registration=w),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ca,[e("div",ma,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[62]||(u[62]=[v("Owned Since",-1)])]),_:1}),l(t(L),{modelValue:c.value.ownedSince,"onUpdate:modelValue":u[21]||(u[21]=w=>c.value.ownedSince=w),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",fa,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[63]||(u[63]=[v("Owner",-1)])]),_:1}),l(t(L),{modelValue:c.value.owner,"onUpdate:modelValue":u[22]||(u[22]=w=>c.value.owner=w),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",pa,[e("div",va,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[64]||(u[64]=[v("Ownership Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.ownershipType,"onUpdate:modelValue":u[23]||(u[23]=w=>c.value.ownershipType=w)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select ownership type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Private"},{default:i(()=>[...u[65]||(u[65]=[v("Private",-1)])]),_:1}),l(t(R),{value:"Company"},{default:i(()=>[...u[66]||(u[66]=[v("Company",-1)])]),_:1}),l(t(R),{value:"Lease"},{default:i(()=>[...u[67]||(u[67]=[v("Lease",-1)])]),_:1}),l(t(R),{value:"Fleet"},{default:i(()=>[...u[68]||(u[68]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",ya,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...u[69]||(u[69]=[v("Warranty Info",-1)])]),_:1}),l(t(ue),{modelValue:c.value.warrantyInfo,"onUpdate:modelValue":u[24]||(u[24]=w=>c.value.warrantyInfo=w),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[25]||(u[25]=w=>C.$emit("close"))}),l(t(F),{label:p.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!V.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ba={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},ga=["src","alt"],ha={key:1,class:"w-full h-full flex items-center justify-center"},xa={class:"flex items-center justify-between mb-1.5"},wa={class:"text-sm font-bold text-heading"},ka={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},Ca={class:"text-xs text-sub mb-1.5"},Va={key:0,class:"text-xs text-green-600 font-medium mb-2"},Sa={key:1,class:"text-xs text-orange-600 font-medium mb-2"},Re={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(s){const r=s,o=q(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[r.badge]||"gray"),a=f=>f?f.toLocaleString("en-US"):"0";return(f,p)=>(g(),k("div",{onClick:p[1]||(p[1]=h=>f.$emit("select")),class:j(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":s.selected}])},[e("div",ba,[s.vehicle.image?(g(),k("img",{key:0,src:s.vehicle.image,alt:`${s.vehicle.brand} ${s.vehicle.model}`,class:"w-full h-full object-cover"},null,8,ga)):(g(),k("div",ha,[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",xa,[l(t(at),{text:s.badge,size:"small",theme:o.value},null,8,["text","theme"]),e("span",wa,"€"+A(a(s.vehicle.price)),1)]),e("h4",ka,A(s.vehicle.brand)+" "+A(s.vehicle.model),1),e("p",Ca,A(s.vehicle.year),1),s.stockDays!==null&&s.stockDays!==void 0?(g(),k("div",Va,[p[3]||(p[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),v(" In stock ("+A(s.stockDays)+" days) ",1)])):(g(),k("div",Sa,[...p[4]||(p[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),v(" Out of stock ",-1)])])),e("button",{onClick:p[0]||(p[0]=Ce(h=>f.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},$a={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Ia={key:0},Ta={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Aa={class:"mb-4"},Ea={class:"relative"},Ma={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Da={key:1,class:"text-center py-8 text-sub"},Pa={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},La={key:0,class:"mt-4 space-y-4"},Oa={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Fa={class:"space-y-2"},Ua={class:"space-y-2"},Ra={class:"space-y-2"},Ba={class:"space-y-2"},Na={class:"flex justify-end"},qa=["disabled"],za={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(s,{emit:r}){const o=s,a=r,f=I=>{I||a("close")},p=O(""),h=O(!1),c=O(null),V=O(null),M=O(null),m=O([]),C=O({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});ge(async()=>{try{const I=await nt({});m.value=I.data||[]}catch(I){console.error("Failed to load vehicles:",I),m.value=[]}});const u=q(()=>o.requestedVehicle&&o.requestedVehicle.stockDays!==null&&o.requestedVehicle.stockDays!==void 0),w=q(()=>{const I=[];if(o.requestedVehicle&&u.value&&I.push({...o.requestedVehicle,isRequested:!0}),m.value&&m.value.length>0){const y=m.value.filter(x=>o.requestedVehicle?x.brand!==o.requestedVehicle.brand||x.model!==o.requestedVehicle.model:!0),D=o.requestedVehicle&&u.value?3:4;I.push(...y.slice(0,D))}return I}),T=q(()=>{if(!m.value||m.value.length===0)return[];let I=[...m.value];if(p.value){const y=p.value.toLowerCase();I=I.filter(D=>D.brand.toLowerCase().includes(y)||D.model.toLowerCase().includes(y)||D.year.toString().includes(y))}return I}),d=q(()=>C.value.brand&&C.value.model&&C.value.year&&C.value.price>0),B=(I,y)=>{c.value=I,V.value=I.id||`custom-${Date.now()}`,M.value=y},W=()=>{if(!d.value)return;const I={...C.value,id:`custom-${Date.now()}`,isCustom:!0};B(I,"custom")},N=()=>{c.value&&(a("vehicle-selected",{vehicle:c.value,type:M.value}),a("close"),c.value=null,V.value=null,M.value=null,p.value="",h.value=!1,C.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(I,y)=>(g(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-6xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[...y[7]||(y[7]=[v("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",$a,[w.value.length?(g(),k("div",Ia,[y[8]||(y[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),v(" Recommended Vehicles ")],-1)),e("div",Ta,[(g(!0),k(H,null,Z(w.value,D=>(g(),z(Re,{key:D.id,vehicle:D,badge:D.isRequested?"Requested":"Recommended","stock-days":D.stockDays,selected:V.value===D.id,onSelect:x=>B(D,D.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):P("",!0),e("div",null,[y[11]||(y[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),v(" Browse Stock ")],-1)),e("div",Aa,[e("div",Ea,[y[9]||(y[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),pe(e("input",{"onUpdate:modelValue":y[0]||(y[0]=D=>p.value=D),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Ve,p.value]])])]),T.value.length?(g(),k("div",Ma,[(g(!0),k(H,null,Z(T.value,D=>(g(),z(Re,{key:D.id,vehicle:D,badge:"In Stock","stock-days":D.stockDays,selected:V.value===D.id,onSelect:x=>B(D,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(g(),k("div",Da,[...y[10]||(y[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[y[19]||(y[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),v(" Configure Custom Vehicle ")],-1)),e("div",Pa,[y[18]||(y[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:y[1]||(y[1]=D=>h.value=!h.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[y[12]||(y[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),v(" "+A(h.value?"Hide Configuration":"Build Custom Configuration"),1)]),h.value?(g(),k("div",La,[e("div",Oa,[e("div",Fa,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[13]||(y[13]=[v("Brand",-1)])]),_:1}),l(t(L),{modelValue:C.value.brand,"onUpdate:modelValue":y[2]||(y[2]=D=>C.value.brand=D),type:"text",class:"w-full h-10",placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",Ua,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[14]||(y[14]=[v("Model",-1)])]),_:1}),l(t(L),{modelValue:C.value.model,"onUpdate:modelValue":y[3]||(y[3]=D=>C.value.model=D),type:"text",class:"w-full h-10",placeholder:"e.g., e-tron GT"},null,8,["modelValue"])]),e("div",Ra,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[15]||(y[15]=[v("Year",-1)])]),_:1}),l(t(L),{modelValue:C.value.year,"onUpdate:modelValue":y[4]||(y[4]=D=>C.value.year=D),type:"number",class:"w-full h-10",placeholder:"2024"},null,8,["modelValue"])]),e("div",Ba,[l(t($),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[16]||(y[16]=[v("Price (€)",-1)])]),_:1}),l(t(L),{modelValue:C.value.price,"onUpdate:modelValue":y[5]||(y[5]=D=>C.value.price=D),type:"number",class:"w-full h-10",placeholder:"98000"},null,8,["modelValue"])])]),e("div",Na,[e("button",{onClick:W,disabled:!d.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...y[17]||(y[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),v(" Use Custom Configuration ",-1)])],8,qa)])])):P("",!0)])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[6]||(y[6]=D=>I.$emit("close"))}),c.value?(g(),z(t(F),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:N})):P("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ja={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},_a={key:0,class:"flex justify-between items-center mb-4"},Wa={class:"text-sm font-bold text-heading"},Ha={key:1,class:"mb-6"},Qa={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ya={class:"space-y-3"},Ga={key:2,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-border"},Ka={class:"flex items-center gap-3"},Za={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},Ja=["src"],Xa={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},eo={class:"font-bold text-sm text-heading"},to={class:"text-xs text-sub"},lo={key:3,class:"space-y-3"},so={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},ao={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},oo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},no={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},io={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ro={key:0,class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},uo={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},co={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},mo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},po={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},vo={class:"space-y-3"},yo={class:"flex items-center gap-2"},bo={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-surfaceSecondary rounded-lg"},go={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},ho={class:"flex items-center gap-2"},xo={class:"text-xs text-sub"},wo={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},ko={class:"flex justify-end"},Co={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Vo={class:"md:col-span-2"},So={class:"flex justify-between items-end gap-2"},$o={class:"grid grid-cols-2 gap-3"},Io={class:"flex justify-end"},To={class:"text-sm font-semibold text-heading"},Ao={key:0,class:"text-center py-6 text-sub text-xs"},Eo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},Mo={class:"flex items-center gap-2"},Do={class:"text-xs text-sub"},Po={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},Lo={class:"flex justify-end"},Oo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fo={class:"flex justify-between items-center"},Uo={key:0,class:"text-center py-6 text-sub text-xs"},Ro={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},Bo={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},No={class:"flex items-center gap-2"},qo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},zo={class:"flex items-center gap-2"},jo={class:"text-xs text-sub"},_o={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},Wo={class:"flex justify-end"},Ho={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Qo={class:"flex justify-between items-center"},Yo={key:0,class:"text-center py-6 text-sub text-xs"},Go={key:1,class:"bg-surfaceSecondary rounded-lg p-4 mt-4 space-y-2"},Ko={class:"flex justify-between items-center"},Zo={class:"text-sm font-bold text-heading"},Jo={class:"flex justify-between items-center"},Xo={class:"text-sm font-bold text-heading"},en={key:0,class:"text-xs text-red-600"},tn={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},ln={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},sn={class:"space-y-3 pt-3 border-t border-E5E7EB"},an={class:"flex items-start gap-2"},on={class:"flex items-start gap-2"},nn={key:4,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},dn={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O("select"),h=O(!1),c=O(!1),V=O(!1),M=O(!1),m=O(!1),C=O(!1),u=O(!1),w=O(!1),T=O(!1),d=O({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null}),B=q(()=>!!a.customer),W=q(()=>{let U=d.value.price||0;return d.value.quotationItems.forEach(n=>{U+=(n.price||0)*(n.quantity||1)}),d.value.showVat?U-N.value:U}),N=q(()=>{if(!d.value.showVat||!d.value.vatRate)return 0;let U=d.value.price||0;return d.value.quotationItems.forEach(n=>{U+=(n.price||0)*(n.quantity||1)}),U*d.value.vatRate/(100+d.value.vatRate)}),I=q(()=>{let U=d.value.price||0;return d.value.quotationItems.forEach(n=>{U+=(n.price||0)*(n.quantity||1)}),d.value.discounts.forEach(n=>{U-=n.price||0}),d.value.tradeIn.valuation&&(U-=d.value.tradeIn.valuation),U}),y=q(()=>d.value.paymentMethods.reduce((U,n)=>U+(n.amount||0),0)),D=q(()=>d.value.paymentMethods.length===0?!0:Math.abs(y.value-I.value)<.01),x=()=>{d.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},b=U=>{d.value.quotationItems.splice(U,1)},E=()=>{d.value.discounts.push({title:"",price:0,vatInclusive:!0})},me=U=>{d.value.discounts.splice(U,1)},Se=()=>{d.value.paymentMethods.push({description:"",amount:0,paid:!1})},qe=U=>{d.value.paymentMethods.splice(U,1)},Ae=()=>{if(a.customer){const U=(a.customer.name||"").split(" ");d.value.firstName=U[0]||"",d.value.lastName=U.slice(1).join(" ")||"",d.value.email=a.customer.email||"",d.value.phone=a.customer.phone||"",d.value.address=a.customer.address||"",d.value.city=a.customer.city||"",d.value.zipCode=a.customer.zipCode||a.customer.postalCode||""}};ge(()=>{Ae(),a.item&&(p.value="manual"),a.selectedVehicle&&(p.value="manual"),a.selectedVehicle&&(d.value.price=a.selectedVehicle.price||0,d.value.brand=a.selectedVehicle.brand||"",d.value.model=a.selectedVehicle.model||"",d.value.year=a.selectedVehicle.year||"",d.value.image=a.selectedVehicle.image||""),a.item&&a.item.data&&(d.value={...d.value,...a.item.data,price:a.item.data.price||a.item.data.total||0,financingType:a.item.data.financingType||a.item.data.paymentMethod||"",notes:a.item.data.notes||a.item.data.description||"",showVat:a.item.data.showVat||!1,vatRate:a.item.data.vatRate||21,quotationItems:a.item.data.quotationItems||[],discounts:a.item.data.discounts||[],tradeIn:a.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:a.item.data.paymentMethods||[],expirationDate:a.item.data.expirationDate||null})}),ne(()=>a.selectedVehicle,U=>{U&&!a.item&&(p.value="manual",d.value.price=U.price||0,d.value.brand=U.brand||"",d.value.model=U.model||"",d.value.year=U.year||"",d.value.image=U.image||"")}),ne(()=>a.customer,()=>{Ae()});const $e=q(()=>{const U=d.value.salutation!==""&&d.value.firstName!==""&&d.value.lastName!==""&&d.value.email!==""&&d.value.zipCode!==""&&d.value.price>0&&d.value.financingType!==""&&d.value.privacyConsent===!0,n=a.selectedVehicle||p.value==="manual",fe=D.value;return U&&n&&fe}),ke=U=>U?(typeof U=="string"?parseFloat(U):U).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",ze=U=>{const n=U.vehicle;d.value.brand=n.brand||"",d.value.model=n.model||"",d.value.year=n.year||"",d.value.price=n.price||0,d.value.image=n.image||"",p.value="manual",h.value=!1},Ee=()=>{var n,fe;if(!$e.value)return;const U={id:((n=a.item)==null?void 0:n.id)||Date.now(),type:"offer",action:a.item?"updated an offer":"created an offer",data:{salutation:d.value.salutation,firstName:d.value.firstName,lastName:d.value.lastName,email:d.value.email,phone:d.value.phone,zipCode:d.value.zipCode,address:d.value.address,city:d.value.city,brand:d.value.brand,model:d.value.model,year:d.value.year,image:d.value.image,price:d.value.price,total:I.value,paymentMethod:d.value.financingType,financingType:d.value.financingType,downPayment:d.value.downPayment,monthlyPayment:d.value.monthlyPayment,term:d.value.term,interestRate:d.value.interestRate,notes:d.value.notes,description:d.value.notes,privacyConsent:d.value.privacyConsent,marketingConsent:d.value.marketingConsent,showVat:d.value.showVat,vatRate:d.value.vatRate,vatAmount:N.value,subtotal:W.value,quotationItems:d.value.quotationItems,discounts:d.value.discounts,tradeIn:d.value.tradeIn,paymentMethods:d.value.paymentMethods,expirationDate:d.value.expirationDate,grandTotal:I.value},timestamp:((fe=a.item)==null?void 0:fe.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",U)};return r({submit:Ee,isValid:$e,offerData:d}),(U,n)=>{var fe,Me,De,Pe,Le,Oe;return g(),k("div",ja,[s.hideHeader?P("",!0):(g(),k("div",_a,[e("h5",Wa,A(s.item?"Edit Offer":"Create Offer"),1),l(t(F),{variant:"ghost",size:"icon",onClick:n[0]||(n[0]=S=>U.$emit("cancel")),class:"text-sub hover:text-body"},{default:i(()=>[...n[37]||(n[37]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!s.selectedVehicle&&!s.item&&p.value==="select"?(g(),k("div",Ha,[e("div",Qa,[n[41]||(n[41]=e("h6",{class:"text-sm font-semibold text-heading mb-4"},"Select Vehicle",-1)),n[42]||(n[42]=e("p",{class:"text-xs text-body mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),e("div",Ya,[l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[1]||(n[1]=S=>h.value=!0)},{default:i(()=>[...n[38]||(n[38]=[e("i",{class:"fa-solid fa-warehouse mr-2"},null,-1),v(" Add from Stock — Search and select an existing vehicle from inventory ",-1)])]),_:1}),l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[2]||(n[2]=S=>h.value=!0)},{default:i(()=>[...n[39]||(n[39]=[e("i",{class:"fa-solid fa-cog mr-2"},null,-1),v(" Configure Vehicle — Build/customize a new vehicle ",-1)])]),_:1}),l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[3]||(n[3]=S=>p.value="manual")},{default:i(()=>[...n[40]||(n[40]=[e("i",{class:"fa-solid fa-pen-to-square mr-2"},null,-1),v(" Skip & Enter Manually — Create vehicle data from scratch ",-1)])]),_:1})])])])):P("",!0),s.selectedVehicle||p.value==="manual"&&d.value.brand?(g(),k("div",Ga,[n[43]||(n[43]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",Ka,[e("div",Za,[(fe=s.selectedVehicle)!=null&&fe.image||d.value.image?(g(),k("img",{key:0,src:((Me=s.selectedVehicle)==null?void 0:Me.image)||d.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Ja)):(g(),k("i",Xa))]),e("div",null,[e("h4",eo,A(((De=s.selectedVehicle)==null?void 0:De.brand)||d.value.brand)+" "+A(((Pe=s.selectedVehicle)==null?void 0:Pe.model)||d.value.model)+" ("+A(((Le=s.selectedVehicle)==null?void 0:Le.year)||d.value.year)+") ",1),e("p",to,"Base Price: € "+A(ke(((Oe=s.selectedVehicle)==null?void 0:Oe.price)||d.value.price)),1)])])])):P("",!0),s.selectedVehicle||p.value==="manual"||s.item?(g(),k("div",lo,[e("div",so,[e("button",{type:"button",onClick:n[4]||(n[4]=S=>c.value=!c.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors rounded-t-lg"},[n[44]||(n[44]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Personal Information"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",c.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),c.value?(g(),k("div",ao,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[45]||(n[45]=[v("Salutation ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:d.value.salutation,"onUpdate:modelValue":n[5]||(n[5]=S=>d.value.salutation=S)},{default:i(()=>[l(t(Q),{class:"w-full"},{default:i(()=>[l(t(Y),{placeholder:"Select salutation"})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"Mr."},{default:i(()=>[...n[46]||(n[46]=[v("Mr.",-1)])]),_:1}),l(t(R),{value:"Mrs."},{default:i(()=>[...n[47]||(n[47]=[v("Mrs.",-1)])]),_:1}),l(t(R),{value:"Ms."},{default:i(()=>[...n[48]||(n[48]=[v("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",oo,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[49]||(n[49]=[v("First Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(L),{modelValue:d.value.firstName,"onUpdate:modelValue":n[6]||(n[6]=S=>d.value.firstName=S),placeholder:"Enter first name",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[50]||(n[50]=[v("Last Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(L),{modelValue:d.value.lastName,"onUpdate:modelValue":n[7]||(n[7]=S=>d.value.lastName=S),placeholder:"Enter last name",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",no,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[51]||(n[51]=[v("Email ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(L),{type:"email",modelValue:d.value.email,"onUpdate:modelValue":n[8]||(n[8]=S=>d.value.email=S),placeholder:"email@example.com",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[52]||(n[52]=[v("Phone Number",-1)])]),_:1}),l(t(L),{type:"tel",modelValue:d.value.phone,"onUpdate:modelValue":n[9]||(n[9]=S=>d.value.phone=S),placeholder:"+1 (555) 000-0000",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",io,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[53]||(n[53]=[v("ZIP / Postal Code ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(L),{modelValue:d.value.zipCode,"onUpdate:modelValue":n[10]||(n[10]=S=>d.value.zipCode=S),placeholder:"Enter ZIP code",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[54]||(n[54]=[v("City",-1)])]),_:1}),l(t(L),{modelValue:d.value.city,"onUpdate:modelValue":n[11]||(n[11]=S=>d.value.city=S),placeholder:"Enter city",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[55]||(n[55]=[v("Address / Street",-1)])]),_:1}),l(t(L),{modelValue:d.value.address,"onUpdate:modelValue":n[12]||(n[12]=S=>d.value.address=S),placeholder:"Enter street address",disabled:B.value},null,8,["modelValue","disabled"])])])):P("",!0)]),p.value==="manual"&&!s.selectedVehicle?(g(),k("div",ro,[e("button",{type:"button",onClick:n[13]||(n[13]=S=>V.value=!V.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[56]||(n[56]=e("h6",{class:"text-sm font-semibold text-heading"},"Vehicle Details",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",V.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),V.value?(g(),k("div",uo,[e("div",co,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[57]||(n[57]=[v("Brand",-1)])]),_:1}),l(t(L),{modelValue:d.value.brand,"onUpdate:modelValue":n[14]||(n[14]=S=>d.value.brand=S),placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[58]||(n[58]=[v("Model",-1)])]),_:1}),l(t(L),{modelValue:d.value.model,"onUpdate:modelValue":n[15]||(n[15]=S=>d.value.model=S),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),e("div",mo,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[59]||(n[59]=[v("Year",-1)])]),_:1}),l(t(L),{type:"number",modelValue:d.value.year,"onUpdate:modelValue":n[16]||(n[16]=S=>d.value.year=S),placeholder:"2024"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[60]||(n[60]=[v("Image URL",-1)])]),_:1}),l(t(L),{modelValue:d.value.image,"onUpdate:modelValue":n[17]||(n[17]=S=>d.value.image=S),placeholder:"https://..."},null,8,["modelValue"])])])])):P("",!0)])):P("",!0),e("div",fo,[e("button",{type:"button",onClick:n[18]||(n[18]=S=>M.value=!M.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[61]||(n[61]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Pricing & Financing"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",M.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),M.value?(g(),k("div",po,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[62]||(n[62]=[v("Base Price (€) ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(L),{type:"number",modelValue:d.value.price,"onUpdate:modelValue":n[19]||(n[19]=S=>d.value.price=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[63]||(n[63]=[v("Financing Type ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:d.value.financingType,"onUpdate:modelValue":n[20]||(n[20]=S=>d.value.financingType=S)},{default:i(()=>[l(t(Q),{class:"w-full"},{default:i(()=>[l(t(Y),{placeholder:"Select financing type"})]),_:1}),l(t(G),null,{default:i(()=>[l(t(R),{value:"cash"},{default:i(()=>[...n[64]||(n[64]=[v("Cash",-1)])]),_:1}),l(t(R),{value:"financing"},{default:i(()=>[...n[65]||(n[65]=[v("Financing",-1)])]),_:1}),l(t(R),{value:"leasing"},{default:i(()=>[...n[66]||(n[66]=[v("Leasing",-1)])]),_:1}),l(t(R),{value:"rental"},{default:i(()=>[...n[67]||(n[67]=[v("Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",vo,[e("div",yo,[l(t(oe),{checked:d.value.showVat,"onUpdate:checked":n[21]||(n[21]=S=>d.value.showVat=S),id:"show-vat"},null,8,["checked"]),l(t($),{for:"show-vat",class:"text-xs font-medium text-body cursor-pointer"},{default:i(()=>[...n[68]||(n[68]=[v("Show VAT breakdown",-1)])]),_:1})]),d.value.showVat?(g(),k("div",bo,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[69]||(n[69]=[v("VAT %",-1)])]),_:1}),l(t(L),{type:"number",step:"0.1",modelValue:d.value.vatRate,"onUpdate:modelValue":n[22]||(n[22]=S=>d.value.vatRate=S),placeholder:"21"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[70]||(n[70]=[v("VAT €",-1)])]),_:1}),l(t(L),{type:"number",value:N.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[71]||(n[71]=[v("Subtotal €",-1)])]),_:1}),l(t(L),{type:"number",value:W.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):P("",!0)])])):P("",!0)]),e("div",go,[e("button",{type:"button",onClick:n[23]||(n[23]=S=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",ho,[n[72]||(n[72]=e("h6",{class:"text-sm font-semibold text-heading"},"Quotation Items",-1)),e("span",xo,"("+A(d.value.quotationItems.length)+" items)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(g(),k("div",wo,[e("div",ko,[l(t(F),{variant:"outline",size:"small",onClick:x},{default:i(()=>[...n[73]||(n[73]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Item ",-1)])]),_:1})]),(g(!0),k(H,null,Z(d.value.quotationItems,(S,ie)=>(g(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",Co,[e("div",Vo,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[74]||(n[74]=[v("Item Name",-1)])]),_:1}),l(t(L),{modelValue:S.name,"onUpdate:modelValue":_=>S.name=_,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",So,[l(t(F),{variant:"ghost",size:"icon",onClick:_=>b(ie),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:i(()=>[...n[75]||(n[75]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),e("div",$o,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[76]||(n[76]=[v("Price (€)",-1)])]),_:1}),l(t(L),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[77]||(n[77]=[v("Quantity",-1)])]),_:1}),l(t(L),{type:"number",modelValue:S.quantity,"onUpdate:modelValue":_=>S.quantity=_,placeholder:"1",value:S.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),e("div",Io,[e("span",To,"Total: € "+A(ke((S.price||0)*(S.quantity||1))),1)])]))),128)),d.value.quotationItems.length===0?(g(),k("div",Ao," No quotation items added yet ")):P("",!0)])):P("",!0)]),e("div",Eo,[e("button",{type:"button",onClick:n[24]||(n[24]=S=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",Mo,[n[78]||(n[78]=e("h6",{class:"text-sm font-semibold text-heading"},"Discounts",-1)),e("span",Do,"("+A(d.value.discounts.length)+" discounts)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(g(),k("div",Po,[e("div",Lo,[l(t(F),{variant:"outline",size:"small",onClick:E},{default:i(()=>[...n[79]||(n[79]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Discount ",-1)])]),_:1})]),(g(!0),k(H,null,Z(d.value.discounts,(S,ie)=>(g(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",Oo,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[80]||(n[80]=[v("Discount Title",-1)])]),_:1}),l(t(L),{modelValue:S.title,"onUpdate:modelValue":_=>S.title=_,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[81]||(n[81]=[v("Amount (€)",-1)])]),_:1}),l(t(L),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Fo,[l(t($),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[l(t(oe),{checked:S.vatInclusive,"onUpdate:checked":_=>S.vatInclusive=_},null,8,["checked","onUpdate:checked"]),n[82]||(n[82]=e("span",{class:"text-xs text-body"},"VAT inclusive",-1))]),_:2},1024),l(t(F),{variant:"ghost",size:"icon",onClick:_=>me(ie),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...n[83]||(n[83]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),d.value.discounts.length===0?(g(),k("div",Uo," No discounts added yet ")):P("",!0)])):P("",!0)]),e("div",Ro,[e("button",{type:"button",onClick:n[25]||(n[25]=S=>u.value=!u.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[84]||(n[84]=e("h6",{class:"text-sm font-semibold text-heading"},"Trade-In",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",u.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),u.value?(g(),k("div",Bo,[e("div",No,[l(t(oe),{checked:d.value.tradeIn.showOnPdf,"onUpdate:checked":n[26]||(n[26]=S=>d.value.tradeIn.showOnPdf=S),id:"show-tradein-pdf"},null,8,["checked"]),l(t($),{for:"show-tradein-pdf",class:"text-xs font-medium text-body cursor-pointer"},{default:i(()=>[...n[85]||(n[85]=[v("Show on PDF",-1)])]),_:1})]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[86]||(n[86]=[v("Trade-in Valuation (€)",-1)])]),_:1}),l(t(L),{type:"number",modelValue:d.value.tradeIn.valuation,"onUpdate:modelValue":n[27]||(n[27]=S=>d.value.tradeIn.valuation=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[87]||(n[87]=[v("Trade-in Notes",-1)])]),_:1}),l(t(ue),{modelValue:d.value.tradeIn.notes,"onUpdate:modelValue":n[28]||(n[28]=S=>d.value.tradeIn.notes=S),rows:"3",placeholder:"Add notes about the trade-in vehicle..."},null,8,["modelValue"])])])):P("",!0)]),e("div",qo,[e("button",{type:"button",onClick:n[29]||(n[29]=S=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",zo,[n[88]||(n[88]=e("h6",{class:"text-sm font-semibold text-heading"},"Payment Methods",-1)),e("span",jo,"("+A(d.value.paymentMethods.length)+" methods)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(g(),k("div",_o,[e("div",Wo,[l(t(F),{variant:"outline",size:"small",onClick:Se},{default:i(()=>[...n[89]||(n[89]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Payment Method ",-1)])]),_:1})]),(g(!0),k(H,null,Z(d.value.paymentMethods,(S,ie)=>(g(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",Ho,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[90]||(n[90]=[v("Description",-1)])]),_:1}),l(t(L),{modelValue:S.description,"onUpdate:modelValue":_=>S.description=_,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[91]||(n[91]=[v("Amount (€)",-1)])]),_:1}),l(t(L),{type:"number",modelValue:S.amount,"onUpdate:modelValue":_=>S.amount=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Qo,[l(t($),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[l(t(oe),{checked:S.paid,"onUpdate:checked":_=>S.paid=_},null,8,["checked","onUpdate:checked"]),n[92]||(n[92]=e("span",{class:"text-xs text-body"},"PAID",-1))]),_:2},1024),l(t(F),{variant:"ghost",size:"icon",onClick:_=>qe(ie),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...n[93]||(n[93]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),d.value.paymentMethods.length===0?(g(),k("div",Yo," No payment methods added yet ")):P("",!0),d.value.paymentMethods.length>0?(g(),k("div",Go,[e("div",Ko,[n[94]||(n[94]=e("span",{class:"text-xs font-medium text-body"},"Payment Methods Total:",-1)),e("span",Zo,"€ "+A(ke(y.value)),1)]),e("div",Jo,[n[95]||(n[95]=e("span",{class:"text-xs font-medium text-body"},"Grand Total:",-1)),e("span",Xo,"€ "+A(ke(I.value)),1)]),D.value?P("",!0):(g(),k("div",en," ⚠️ Payment methods must equal Grand Total "))])):P("",!0)])):P("",!0)]),e("div",tn,[e("button",{type:"button",onClick:n[30]||(n[30]=S=>T.value=!T.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[96]||(n[96]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Terms & Conditions"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",T.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),T.value?(g(),k("div",ln,[e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[97]||(n[97]=[v("Notes / Comments",-1)])]),_:1}),l(t(ue),{modelValue:d.value.notes,"onUpdate:modelValue":n[31]||(n[31]=S=>d.value.notes=S),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[98]||(n[98]=[v("Offer Expiration Date",-1)])]),_:1}),l(t(L),{type:"date",modelValue:d.value.expirationDate,"onUpdate:modelValue":n[32]||(n[32]=S=>d.value.expirationDate=S)},null,8,["modelValue"])]),e("div",sn,[n[101]||(n[101]=e("h6",{class:"text-xs font-semibold text-heading"},"Privacy & Consent",-1)),e("div",an,[l(t(oe),{checked:d.value.privacyConsent,"onUpdate:checked":n[33]||(n[33]=S=>d.value.privacyConsent=S),id:"privacy-consent"},null,8,["checked"]),l(t($),{for:"privacy-consent",class:"text-xs text-body cursor-pointer"},{default:i(()=>[...n[99]||(n[99]=[v(" I agree to the privacy policy ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1})]),e("div",on,[l(t(oe),{checked:d.value.marketingConsent,"onUpdate:checked":n[34]||(n[34]=S=>d.value.marketingConsent=S),id:"marketing-consent"},null,8,["checked"]),l(t($),{for:"marketing-consent",class:"text-xs text-body cursor-pointer"},{default:i(()=>[...n[100]||(n[100]=[v(" I want to receive marketing communications ",-1)])]),_:1})])])])):P("",!0)])])):P("",!0),s.hideActions?P("",!0):(g(),k("div",nn,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:n[35]||(n[35]=S=>U.$emit("cancel"))}),l(t(F),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!$e.value,onClick:Ee},null,8,["label","disabled"])])),l(za,{show:h.value,"requested-vehicle":s.selectedVehicle,"opportunity-id":s.taskId,onClose:n[36]||(n[36]=S=>h.value=!1),onVehicleSelected:ze},null,8,["show","requested-vehicle","opportunity-id"])])}}},rn={class:"flex-1 overflow-y-auto p-6 w-full"},Dn={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=O(null),f=q(()=>{var V;return((V=a.value)==null?void 0:V.isValid)||!1}),p=()=>{var V;(V=a.value)==null||V.submit()},h=V=>{V||o("close")},c=V=>{o("save",V),o("close")};return(V,M)=>(g(),z(t(se),{open:s.show,"onUpdate:open":h},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:i(()=>[l(t(te),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:i(()=>[l(t(le),null,{default:i(()=>[...M[2]||(M[2]=[v("Create Offer",-1)])]),_:1})]),_:1}),e("div",rn,[l(dn,{item:s.item,"task-type":s.taskType,"task-id":s.taskId,"selected-vehicle":s.requestedCar,customer:s.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:a,onSave:c,onCancel:M[0]||(M[0]=m=>V.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),l(t(be),{class:"flex-shrink-0 p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:i(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:M[1]||(M[1]=m=>V.$emit("close"))}),l(t(F),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:p},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Pn(s){const r=s.lead;if(!r)return null;const o=ye(r,"lead");if(!o)return console.warn("No display stage calculated for lead"),null;const a=he[o];if(!a)return console.warn(`No state config found for lead stage: ${o}`),null;if(!a.primaryAction)return console.warn(`No primary action found for lead stage: ${o}`),null;const f=a.primaryAction;if(typeof f=="function"){const p=f({lead:r,displayStage:o});return p||console.warn(`Primary action function returned null for lead stage: ${o}`),p}return f}function Ln(s){const r=s.lead;if(!r)return[];const o=ye(r,"lead"),a=he[o];return a?a.secondaryActions||[]:[]}function Ne(s){const r=s.lead;if(!r||!(r.isDisqualified===!0))return!1;const a=ye(r,"lead");return a===ae.CLOSED_INVALID||a===ae.CLOSED_NOT_INTERESTED||a===ae.CLOSED_DUPLICATE}function On(s){const r=s.lead;if(!r||Ne(s))return!1;const o=ye(r,"lead"),a=he[o];return a?typeof a.showLQWidget=="function"?a.showLQWidget(r):a.showLQWidget??!1:!1}function Fn(s){const r=s.lead;if(!r||Ne(s))return!1;const o=ye(r,"lead"),a=he[o];return a?a.showDeadlineBanner&&r.nextActionDue:!1}function Un(s){const r=s.lead;if(!r)return!1;const o=ye(r,"lead"),a=he[o];return a?a.canPostpone??!1:!1}function Rn(s){const r=s.lead;if(!r)return"qualification";const o=ye(r,"lead"),a=he[o];return a&&a.lqWidgetMode||"qualification"}function Bn(){const s=it();return{saveTradeInVehicle:async(a,f,p,h={})=>{try{const c=await s.addVehicle(p),V={type:"tradein",action:"added a trade-in",vehicleId:c.id,data:{brand:p.brand,model:p.model,version:p.version||null,year:p.year,kilometers:p.kilometers||0,plates:p.plates||null,registration:p.registration||null,vin:p.vin||null,fuelType:p.fuelType||null,gearType:p.gearType||null,tradeInPrice:h.tradeInPrice||null,evaluationRangeLow:h.evaluationRangeLow||null,evaluationRangeHigh:h.evaluationRangeHigh||null,provider:h.provider||null,evaluationDate:h.evaluationDate||null,priceToBuy:h.priceToBuy||null,priceToSell:h.priceToSell||null,priceOfVehicle:h.priceOfVehicle||null,priceOfOptionals:h.priceOfOptionals||null,listOfOptionals:h.listOfOptionals||null}};let M;if(a==="lead")M=await et(f,V);else if(a==="opportunity")M=await tt(f,V);else throw new Error(`Invalid taskType: ${a}`);return{vehicle:c,activity:M}}catch(c){throw console.error("Error saving trade-in vehicle:",c),c}},updateTradeInVehicle:async(a,f,p,h,c,V={})=>{try{const M=await s.modifyVehicle(p,c),m={data:{brand:c.brand,model:c.model,version:c.version||null,year:c.year,kilometers:c.kilometers||0,plates:c.plates||null,registration:c.registration||null,vin:c.vin||null,fuelType:c.fuelType||null,gearType:c.gearType||null,tradeInPrice:V.tradeInPrice||null,evaluationRangeLow:V.evaluationRangeLow||null,evaluationRangeHigh:V.evaluationRangeHigh||null,provider:V.provider||null,evaluationDate:V.evaluationDate||null,priceToBuy:V.priceToBuy||null,priceToSell:V.priceToSell||null,priceOfVehicle:V.priceOfVehicle||null,priceOfOptionals:V.priceOfOptionals||null,listOfOptionals:V.listOfOptionals||null}};let C;if(a==="lead")C=await Je(f,h,m);else if(a==="opportunity")C=await Xe(f,h,m);else throw new Error(`Invalid taskType: ${a}`);return{vehicle:M,activity:C}}catch(M){throw console.error("Error updating trade-in vehicle:",M),M}}}}function de(s){if(!s)return 0;const r=new Date(s),a=Math.abs(new Date-r);return Math.ceil(a/(1e3*60*60*24))}const ve={"no-appointment":s=>!s.scheduledAppointment,"has-appointment":s=>!!s.scheduledAppointment,"appointment-past-not-completed":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)<new Date&&s.scheduledAppointment.status!=="completed":!1,"has-future-appointment":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)>new Date:!1,"no-offers":s=>!s.hasOffers,"has-offers":s=>s.hasOffers,"qualified-no-offers-7-13-days":s=>{const r=re(),o=r.getSetting("oofbMinDays"),a=r.getSetting("oofbMaxDays"),f=de(s.opportunity.createdAt);return f>=o&&f<a+1&&!s.hasOffers},"qualified-no-offers-14-plus-days":s=>{const o=re().getSetting("ufbDays");return de(s.opportunity.createdAt)>=o&&!s.hasOffers},"negotiation-offer-sent-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Sent"},"negotiation-offer-feedback-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Feedback"},"negotiation-offer-accepted-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Accepted"},"negotiation-offer-sent-3-days":s=>{var a,f;if(((a=s.opportunity)==null?void 0:a.negotiationSubstatus)!=="Offer Sent"||!((f=s.opportunity)!=null&&f.offers)||s.opportunity.offers.length===0)return!1;const r=s.opportunity.offers.filter(p=>p.status==="active").sort((p,h)=>new Date(h.createdAt)-new Date(p.createdAt))[0];return r?de(r.createdAt)>=3:!1},"negotiation-5-plus-days-no-contract-has-offers":s=>{if(s.stage==="In Negotiation"&&!s.hasOffers)return!1;const o=re().getSetting("ofbDays");return de(s.opportunity.lastActivity||s.opportunity.createdAt)>=o&&!s.opportunity.contractDate&&s.hasOffers},"negotiation-offer-feedback-5-plus-days-no-appointment":s=>{var p;if(((p=s.opportunity)==null?void 0:p.negotiationSubstatus)!=="Offer Feedback"||!s.hasOffers)return!1;const o=re().getSetting("nfuDays"),a=de(s.opportunity.lastActivity||s.opportunity.createdAt),f=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date;return a>=o&&!s.opportunity.contractDate&&!f},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":s=>ve["negotiation-offer-feedback-5-plus-days-no-appointment"](s),"contract-7-plus-days-no-delivery":s=>{var p;if(!s.opportunity.contractDate)return!1;const o=re().getSetting("cfbDays"),a=de(s.opportunity.contractDate),f=(p=s.activities)==null?void 0:p.some(h=>{var c;return h.type==="delivery"||((c=h.action)==null?void 0:c.toLowerCase().includes("delivered"))});return a>=o&&!f},"delivery-date-set":s=>!!s.opportunity.deliveryDate,"delivery-3-plus-days":s=>{var p;const r=(p=s.activities)==null?void 0:p.find(h=>{var c;return h.type==="delivery"||((c=h.action)==null?void 0:c.toLowerCase().includes("delivered"))});if(!r)return!1;const a=re().getSetting("dfbDays");return de(r.timestamp)>=a},"is-awaiting-delivery":s=>s.deliverySubstatus==="Awaiting Delivery","is-delivered":s=>s.deliverySubstatus==="Delivered","has-no-delivery":s=>!s.deliverySubstatus||s.deliverySubstatus===null,"is-closed":s=>{const r=s.stage;return r==="Closed Won"||r==="Closed Lost"},"is-closed-with-task-widget":s=>ve["is-closed"](s)&&s.hasActiveTaskWidget,"opportunity-abandoned":s=>{if(ve["is-closed"](s))return!1;const r=re(),o=r.getSetting("abandonedOpportunityDays");if(!r.getSetting("abandonedEligibleStages").includes(s.stage))return!1;const f=s.opportunity.lastActivity||s.opportunity.createdAt;return de(f)>=o}};function Nn(s,r){if(ve["is-closed-with-task-widget"](r))return[Ie.reopen,Ie.requalify,Ie.closeLost];const o=Te[s];return!o||!o.secondaryActions?[]:o.secondaryActions.filter(a=>{if(!a.conditional)return!0;const f=ve[a.conditional];return f?f(r):!0})}function qn(s,r){const o=Te[s];if(!o||!o.taskWidgets)return null;const f=re().getSetting("autoCloseWidgetsOnClose"),p=ve["is-closed"]({stage:s});for(const h of o.taskWidgets){if(f&&p&&(h.type==="NFU"||h.type==="OFB"))continue;const c=ve[h.condition];if(c&&c(r))return h.type}return null}function zn(s,r){const o=Te[s];if(!o||!o.primaryAction)return null;let a=o.primaryAction;return typeof a=="function"&&(a=a(r),!a)?null:{...a,title:typeof a.title=="function"?a.title(r):a.title,description:typeof a.description=="function"?a.description(r):a.description,label:typeof a.label=="function"?a.label(r):a.label}}function jn(s){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[s]||"Task"}function _n(s){return s==="Closed Won"||s==="Closed Lost"}export{Nn as A,_n as B,jn as C,dn as D,ut as E,za as F,Jl as G,Hl as H,Nl as I,he as L,Te as O,En as P,Cn as T,kn as _,Fe as a,yn as b,gn as c,xn as d,wn as e,vn as f,hn as g,Vn as h,Sn as i,$n as j,In as k,Tn as l,An as m,Mn as n,Dn as o,Ne as p,Pn as q,Ln as r,On as s,Fn as t,Un as u,Rn as v,bn as w,Bn as x,qn as y,zn as z};
