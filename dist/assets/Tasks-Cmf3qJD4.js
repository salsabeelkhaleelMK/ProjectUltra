import{d as k,o as y,F as de,i as pe,n as z,e,_ as st,r as I,c as D,G as nt,g as L,s as S,w as Ye,E as $,p as Q,y as n,P as ot,T as ct,H as pt,x as W,t as N,I as te,k as j,l as Ce,J as ie,K as De,L as J,j as Qe,M as oe,N as Se,O as He,h as lt,D as Ee,u as We,m as Ke,v as he,Q as P,R as qt,S as Mt,U as Be,V as Ve,W as et,z as Pe,X as Rt,Y as Ft,Z as Vt}from"./index-tu1CT0Iz.js";import{u as Ge}from"./opportunities-CbroMNT2.js";import{u as Je}from"./users-CrEBkKNl.js";import{y as Bt}from"./components-6bQnjAJG.js";import{_ as Ut,a as Wt,g as jt,b as Et,c as zt,i as Ht,d as Pt,e as Qt,f as Yt}from"./ComingSoonModal-Ujri14UV.js";import{f as Ue,a as je,g as mt,b as ft,c as yt,d as gt}from"./formatters-DjeI4Z8-.js";import{z as Te,F as Ie,L as Le,H as Oe,j as Ne,K as ze,C as qe,W as Me}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BPomdMSh.js";import{f as vt}from"./vehicles-LioqL0e8.js";import{_ as Kt}from"./CreateEventModal-DuoYTNPE.js";import{_ as Gt,a as Jt}from"./EditEventModal-CKm3pk7G.js";import{_ as Xt}from"./ReassignUserModal-Qyaee-ZO.js";const Zt={class:"flex items-center gap-1 bg-surfaceSecondary rounded-full p-1"},_t=["onClick","title"],bt={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:t=>t.every(r=>r.value&&r.icon&&r.label)}},emits:["update:view"],setup(t){return(r,s)=>(y(),k("div",Zt,[(y(!0),k(de,null,pe(t.options,l=>(y(),k("button",{key:l.value,onClick:o=>r.$emit("update:view",l.value),class:z(["w-8 h-8 flex items-center justify-center rounded-full transition-all",t.view===l.value?"bg-surface text-brand-red shadow-sm":"text-sub hover:text-heading"]),title:l.label},[e("i",{class:z([l.icon,"text-xs"])},null,2)],10,_t))),128))]))}},es={class:"flex items-center gap-2"},ts={key:0,class:"flex gap-2"},ss={class:"relative ml-auto",ref:"sortContainer"},ns={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white",style:{"background-color":"var(--brand-red)"}},os={key:0,class:"absolute right-0 mt-2 z-50 sort-dropdown-wrapper"},ls={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:r}){const s=t,l=r,o=I(!1),i=()=>{o.value=!o.value},p=v=>{o.value=!1,l("sort-change",v)},d=D(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>p("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>p("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>p("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>p("assigned-to-my-team")}].map(c=>({...c,className:c.key===s.sortOption?"sort-item-selected":""})));return(v,c)=>{const a=nt("click-outside");return y(),k("div",es,[t.showTypeFilter?(y(),k("div",ts,[e("button",{onClick:c[0]||(c[0]=u=>v.$emit("filter-change","all")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:c[1]||(c[1]=u=>v.$emit("filter-change","lead")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:c[2]||(c[2]=u=>v.$emit("filter-change","opportunity")),class:z(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-brand-dark text-white border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):L("",!0),e("div",ss,[e("button",{onClick:Ye(i,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[c[3]||(c[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(y(),k("span",ns)):L("",!0)]),S(ct,{name:"dropdown"},{default:$(()=>[o.value?Q((y(),k("div",os,[S(n(ot),{items:d.value,className:"w-56"},null,8,["items"])])),[[a,()=>o.value=!1]]):L("",!0)]),_:1})],512)])}}},as=st(ls,[["__scopeId","data-v-b1a2e14c"]]),is={key:1,class:"absolute right-3 top-8 z-50"},rs={class:"flex gap-2 mb-0.5"},ds={key:1,class:"px-2 py-0.5 rounded text-xs font-medium bg-red-50 text-red-700 border border-red-200"},us={class:"font-bold text-gray-900 text-content-bold line-clamp-2 pt-0.5"},cs={class:"flex gap-3 text-xs mt-0.5 mb-1"},ps={class:"flex items-center gap-1.5"},ms={class:"flex items-center gap-1.5"},fs={key:0,class:"text-xs text-gray-600 pb-3"},ys={key:2,class:"flex items-center justify-between pt-1 border-t border-gray-100"},gs={class:"text-xs flex items-center gap-2"},vs={class:"rounded-full bg-black text-white font-medium flex items-center justify-center text-[6px] shrink-0 w-3 h-3"},bs={class:"text-gray-600 font-medium"},hs={key:1},xs={class:"text-xs font-medium"},ws={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:r}){const s=t,l=D(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),o=D(()=>s.selected),i=D(()=>o.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),p=D(()=>{const c=s.item.displayStage||s.item.stage;return c?pt(c,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),d=c=>{if(!c)return"?";const a=c.split(" ");return a.length>=2?(a[0][0]+a[a.length-1][0]).toUpperCase():c.substring(0,2).toUpperCase()},v=I(null);return(c,a)=>{const u=nt("click-outside");return y(),k("div",{ref_key:"cardRef",ref:v,onClick:a[1]||(a[1]=m=>c.$emit("select",l.value)),class:z(["bg-white rounded-lg p-2.5 min-h-32 flex flex-col justify-between hover:shadow-sm cursor-pointer relative",i.value])},[t.showMenu?(y(),k("button",{key:0,onClick:a[0]||(a[0]=Ye(m=>c.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-3 right-3 text-gray-300 hover:text-gray-600"},[...a[2]||(a[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):L("",!0),t.openMenuId===t.item.id&&t.showMenu?Q((y(),k("div",is,[t.menuItems&&t.menuItems.length>0?(y(),W(n(ot),{key:0,items:t.menuItems,className:"w-40"},null,8,["items"])):L("",!0)])),[[u,()=>c.$emit("menu-close")]]):L("",!0),e("div",null,[e("div",rs,[e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},N(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(y(),k("span",{key:0,class:z(["px-2 py-0.5 rounded text-xs font-medium border",p.value])},N(t.item.displayStage||t.item.stage),3)):L("",!0),t.item.priority==="Hot"?(y(),k("span",ds," Hot ")):L("",!0)]),e("h3",us,N(t.getName(t.item)),1),e("div",cs,[e("span",ps,[a[3]||(a[3]=e("i",{class:"fa-solid fa-location-dot text-xs"},null,-1)),te(c.$slots,"location",{item:t.item})]),e("span",ms,[a[4]||(a[4]=e("i",{class:"fa-solid fa-globe text-xs"},null,-1)),te(c.$slots,"source",{item:t.item},()=>{var m;return[j(N(t.item.source||((m=t.item.customer)==null?void 0:m.source)||"Unknown"),1)]})])]),t.getVehicleInfo?(y(),k("p",fs,N(t.getVehicleInfo(t.item)),1)):L("",!0)]),c.$slots.owner||c.$slots.dates?(y(),k("div",ys,[e("div",gs,[te(c.$slots,"owner",{item:t.item},()=>[t.item.assignee?(y(),k(de,{key:0},[e("div",vs,N(d(t.item.assignee)),1),e("span",bs,N(t.item.assignee),1)],64)):(y(),k("span",hs,"Unassigned"))])]),e("div",xs,[te(c.$slots,"dates",{item:t.item})])])):L("",!0)],2)}}},ks={class:"bg-surface border-r border flex flex-col shrink-0 w-full lg:w-80 h-full"},Cs={class:"page-header shrink-0"},Ss={class:"page-header-main"},$s={class:"page-header-content"},As={class:"page-header-title"},Ds={class:"flex items-center gap-3"},Ts={class:"px-5 py-3"},Is={class:"relative"},Ls=["placeholder"],Os={key:0,class:"px-5 pb-3"},Ns={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-surface border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-surface border border hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},initialSearchQuery:{type:String,default:""},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"},getMenuItems:{type:Function,default:null}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:r}){const s=t,l=r,o=I(s.initialSearchQuery||""),i=I("none");Ce(()=>s.initialSearchQuery,a=>{o.value=a||""});const p=D(()=>{let a=s.items;if(s.typeFilter&&s.typeFilter!=="all"&&(a=a.filter(u=>u.type===s.typeFilter)),o.value){const u=o.value.toLowerCase();a=a.filter(m=>{const h=s.getName(m).toLowerCase(),C=s.getVehicleInfo?s.getVehicleInfo(m).toLowerCase():"",O=String(m.id||"").toLowerCase();return h.includes(u)||C&&C.includes(u)||O.includes(u)})}return a}),d=a=>{const u=a.compositeId||`${a.type||"task"}-${a.id}`||a.id;return s.selectedId===u},v=a=>{i.value=a,l("sort-change",a)},c=I(null);return(a,u)=>(y(),k("div",ks,[e("header",Cs,[e("div",Ss,[e("div",$s,[e("div",null,[e("h1",As,N(t.title),1)]),e("div",Ds,[t.viewMode?(y(),W(bt,{key:0,view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":u[0]||(u[0]=m=>a.$emit("view-change",m))},null,8,["view"])):L("",!0)])])])]),e("div",Ts,[e("div",Is,[u[6]||(u[6]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),Q(e("input",{"onUpdate:modelValue":u[1]||(u[1]=m=>o.value=m),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-surfaceSecondary border border rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ls),[[ie,o.value]])])]),t.showTypeFilter?(y(),k("div",Os,[S(as,{"type-filter":t.typeFilter,"sort-option":i.value,"show-type-filter":!0,onFilterChange:u[2]||(u[2]=m=>a.$emit("filter-change",m)),onSortChange:v},null,8,["type-filter","sort-option"])])):L("",!0),e("div",{ref_key:"scrollContainer",ref:c,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(y(!0),k(de,null,pe(p.value,m=>(y(),W(ws,{key:m.compositeId||`${m.type||"task"}-${m.id}`,item:m,selected:d(m),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(m):null,onSelect:u[3]||(u[3]=h=>a.$emit("select",h)),onMenuClick:u[4]||(u[4]=h=>a.$emit("menu-click",h)),onMenuClose:u[5]||(u[5]=h=>a.$emit("menu-close"))},{location:$(({item:h})=>[te(a.$slots,"location",{item:h},void 0,!0)]),source:$(({item:h})=>[te(a.$slots,"source",{item:h},void 0,!0)]),owner:$(({item:h})=>[te(a.$slots,"owner",{item:h},void 0,!0)]),dates:$(({item:h})=>[te(a.$slots,"dates",{item:h},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},qs=st(Ns,[["__scopeId","data-v-fb7c0658"]]);function ht(t,r=[],s,l){const o=De(),i=o.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},p=o.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},d=Ms(t,r),v=Rs(t,r),c=Fs(t),a=Vs(t),u=i.intent+i.behavioral+i.temporal,m={intent:i.intent/u*100,behavioral:i.behavioral/u*100,temporal:i.temporal/u*100},h=d/40*m.intent,C=v/35*m.behavioral,O=c/25*m.temporal,M=Math.min(100,Math.max(0,h+C+O+a));let w="COLD";return M>=p.hot?w="HOT":M>=p.warm?w="WARM":M>=p.standard&&(w="STANDARD"),{score:Math.round(M*10)/10,level:w,breakdown:{intent:Math.round(d*10)/10,behavioral:Math.round(v*10)/10,temporal:Math.round(c*10)/10,quality:Math.round(a*10)/10,total:Math.round(M*10)/10}}}function Ms(t,r){var l;let s=0;return(t.requestType==="Test Drive"||((l=t.scheduledAppointment)==null?void 0:l.type)==="test-drive"||r.some(o=>o.type==="test-drive"||o.type==="appointment"))&&(s=Math.max(s,40)),r.some(o=>o.type==="financing")&&(s=Math.max(s,35)),r.some(o=>o.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||r.some(o=>{var i,p,d;return((i=o.content)==null?void 0:i.toLowerCase().includes("location"))||((p=o.content)==null?void 0:p.toLowerCase().includes("dealership"))||((d=o.content)==null?void 0:d.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||r.some(o=>{var i,p;return((i=o.content)==null?void 0:i.toLowerCase().includes("configur"))||o.type==="attachment"&&((p=o.fileName)==null?void 0:p.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),r.some(o=>{var p;const i=((p=o.content)==null?void 0:p.toLowerCase())||"";return i.includes("compare")||i.includes("versus")||i.includes("vs")||i.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function Rs(t,r){let s=0;const l=new Set(r.map(d=>{if(!d.timestamp)return null;const v=new Date(d.timestamp);return`${v.getFullYear()}-${v.getMonth()}-${v.getDate()}`}).filter(Boolean)),o=Math.min(l.size*10,35);s+=o,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const i=r.reduce((d,v)=>{var c;return d+(((c=v.content)==null?void 0:c.length)||0)},0),p=Math.min(Math.floor(i/50),25);return s+=p,r.some(d=>{var v,c,a;return d.type==="attachment"&&(((v=d.fileName)==null?void 0:v.toLowerCase().includes("brochure"))||((c=d.fileName)==null?void 0:c.toLowerCase().includes("spec"))||((a=d.fileName)==null?void 0:a.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function Fs(t){let r=0;if(!t.createdAt)return 0;const s=new Date,l=new Date(t.createdAt),o=(s.getTime()-l.getTime())/(1e3*60*60);o<2?r+=25:o<24?r+=15:o<48?r+=5:r-=10;const i=l.getDay(),p=l.getHours();if((i===0||i===6||p<9||p>17)&&(r+=10),t.contactAttempts&&t.contactAttempts.length===3&&(r+=50),t.lastActivity){const d=new Date(t.lastActivity);(s.getTime()-d.getTime())/(1e3*60*60*24)>3&&(r+=20)}return Math.min(Math.max(r,0),25)}function Vs(t){var s,l,o,i,p,d,v;let r=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(r+=10),(l=t.customer)!=null&&l.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(r+=10),(o=t.customer)!=null&&o.name&&((i=t.customer)!=null&&i.email)&&((p=t.customer)!=null&&p.phone)&&((d=t.customer)!=null&&d.address)&&(r+=5),(t.isDuplicate||t.isDisqualified||!((v=t.customer)!=null&&v.name))&&(r-=20),r}function xt(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function wt(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Bs({typeFilter:t,showTypeFilter:r,tasks:s}){return{filterDefinitions:D(()=>{const o=[];r.value&&o.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),o.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),o.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&o.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),o.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const i=[...new Set(s.value.map(d=>d.assignee).filter(Boolean))];i.length>0&&o.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:i.map(d=>({value:d,label:d})),aiHint:"Person assigned to the task",pinned:!0});const p=[...new Set(s.value.map(d=>{const v=d.type==="lead"?d.requestedCar:d.vehicle;return v==null?void 0:v.brand}).filter(Boolean))];return p.length>0&&o.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:p.map(d=>({value:d,label:d})),aiHint:"Car brand requested by customer"}),o.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),o})}}const Us={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},Ws={class:"page-header shrink-0"},js={class:"page-header-main"},Es={class:"page-header-content"},zs={class:"flex items-center gap-3"},Hs={class:"flex-1 overflow-y-auto p-4 md:p-8"},Ps={class:"table-wrapper w-full"},Qs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:r}){const s=t,l=r,o=De();I("");const i=I({pageIndex:0,pageSize:10}),p=I(""),d=I([]),v=I([{id:"status",value:["Valid","Qualified","Open Lead"],operator:"in"},{id:"type",value:"lead",operator:"eq"},{id:"source",value:["Marketing","Website"],operator:"in"},{id:"assignee",value:void 0},{id:"urgencyLevel",value:void 0}]);I({});const{filterDefinitions:c}=Bs({typeFilter:D(()=>s.typeFilter),showTypeFilter:D(()=>s.showTypeFilter),tasks:D(()=>s.tasks)}),a=D(()=>s.tasks),u=x=>x.compositeId===s.currentTaskId||x.compositeId===s.highlightId,m=x=>{if(x.type==="lead")return x.requestedCar?`${x.requestedCar.brand} ${x.requestedCar.model}`:"No vehicle specified";const g=x.vehicle||x.requestedCar;return g?`${g.brand} ${g.model}`:"No vehicle specified"},h=x=>{const g=x.type==="lead"?x.requestedCar:x.vehicle;if(!g)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const f=g.stockDays!==void 0&&g.stockDays!==null;return{status:f?"In Stock":"Out of Stock",class:f?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},C=x=>{var g;return x.type==="lead"?((g=x.requestedCar)==null?void 0:g.requestType)||x.requestType||"N/A":x.requestType||"Opportunity"},O=D(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:x=>M(x.original)},cell:({row:x})=>{const g=x.original,f=g.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${f}`},g.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:x})=>{const g=x.original;return J("div",{class:"flex items-center gap-2 md:gap-3"},[J("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${g.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},g.customer.initials),J("div",{class:"min-w-0"},[J("div",{class:"text-content font-semibold text-heading truncate max-w-[7.5rem] md:max-w-none"},g.customer.name),J("div",{class:"text-meta truncate hidden sm:block"},g.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:x})=>{const g=x.original,f=m(g);return f==="No vehicle specified"?J("span",{class:"text-meta"},"N/A"):J("div",{class:"flex items-center gap-2"},[J("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),J("span",{class:"text-content font-medium text-heading truncate max-w-[7.5rem]"},f)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:x})=>{const g=x.original,f=h(g);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${f.class}`},f.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:x})=>{const g=x.original,f=C(g);return J("span",{class:"text-meta"},f)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:x})=>{const g=x.original;return J("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},g.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:x})=>{const g=x.original,f=s.getOwnerInfo(g);return J("div",{class:"flex items-center gap-2"},[J("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},f.initials),J("span",{class:"text-meta truncate max-w-20"},f.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:x})=>{const g=x.original,f=g.type==="lead"?g.status:g.displayStage||g.stage,A=s.getStageBadgeClass(f);return J("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${A}`},f)}},...s.typeFilter==="lead"&&o.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:x})=>{const g=x.original;if(g.type!=="lead")return J("span",{class:"text-meta"},"â€”");let f=g.urgencyLevel;f||(f=ht(g).level);const A=wt(f),V=xt(f);return J("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${A}`},[J("span",{},V),J("span",{},f)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:x})=>{const g=x.original;return J("button",{class:"text-sub hover:text-body",onClick:f=>{f.stopPropagation(),l("menu-click",g.id)}},[J("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),M=x=>{p.value=String(x.id),s.viewMode==="table"&&l("view-change","card",String(x.id)),l("select",x.compositeId)},w=D(()=>({class:{tr:x=>{const g="cursor-pointer hover:bg-surfaceSecondary transition-colors",f=x.original;return u(f)?`${g} bg-blue-50 border-l-4 border-l-blue-500`:g}}}));return(x,g)=>(y(),k("div",Us,[e("header",Ws,[e("div",js,[e("div",Es,[g[7]||(g[7]=e("div",null,[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",zs,[e("button",{onClick:g[0]||(g[0]=f=>x.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border px-4 py-2 text-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...g[6]||(g[6]=[e("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])]),S(bt,{view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":g[1]||(g[1]=f=>x.$emit("view-change",f))},null,8,["view"])])])])]),e("div",Hs,[e("div",Ps,[S(n(Bt),{data:a.value,columns:O.value,meta:w.value,onRowClick:M,columnFiltersOptions:{filterDefs:n(c)},pagination:i.value,"onUpdate:pagination":g[2]||(g[2]=f=>i.value=f),globalFilter:p.value,"onUpdate:globalFilter":g[3]||(g[3]=f=>p.value=f),sorting:d.value,"onUpdate:sorting":g[4]||(g[4]=f=>d.value=f),columnFilters:v.value,"onUpdate:columnFilters":g[5]||(g[5]=f=>v.value=f),paginationOptions:{rowCount:a.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{toolbar:$(()=>[...g[8]||(g[8]=[e("div",{class:"flex justify-end"},[e("button",{class:"group flex items-center gap-2 rounded-2xl border border px-4 py-2 text-sm font-medium text-body hover:border-purple-100 hover:bg-purple-50 hover:text-purple-600 transition-all"},[e("i",{class:"fa-solid fa-arrow-left text-sub group-hover:text-purple-500"}),e("span",{class:"hidden sm:inline"},"Switch back to old design")])],-1)])]),"empty-state":$(()=>[...g[9]||(g[9]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Ys={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border bg-surface"},Ks={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border bg-surface"},rt={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){return(r,s)=>t.task?(y(),k("div",Ys,[S(Ut,{task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},null,8,["task","type","management-widget","store-adapter","add-new-config"])])):(y(),k("div",Ks,[...s[0]||(s[0]=[Qe('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-sub"></i></div><h3 class="text-base font-semibold text-heading mb-2">No task selected</h3><p class="text-meta">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},Gs={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},Js={class:"px-4 py-3 flex items-center justify-between gap-3"},Xs=["aria-label"],Zs={key:0,class:"flex-1 flex items-center justify-center"},_s={key:1,class:"flex items-center gap-2"},en={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:r}){const s=r,l=()=>{s("back")};return(o,i)=>t.show?(y(),k("div",Gs,[e("div",Js,[e("button",{onClick:l,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...i[0]||(i[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Xs),o.$slots.title?(y(),k("div",Zs,[te(o.$slots,"title")])):L("",!0),o.$slots.actions?(y(),k("div",_s,[te(o.$slots,"actions")])):L("",!0)])])):L("",!0)}},ke={[oe.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[oe.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[oe.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[oe.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[oe.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[oe.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},dt={toClosed:(t,r,s)=>{const l={isDisqualified:!0,disqualifyReason:(s==null?void 0:s.reason)||null,disqualifyCategory:(s==null?void 0:s.category)||null,scheduledAppointment:null,nextActionDue:null};(s==null?void 0:s.reason)==="Duplicate"?(l.isDuplicate=!0,l.stage="Closed Failed"):(s==null?void 0:s.category)==="Not Interested"?l.stage="Not Interested":l.stage="Not Valid",l.status="Disqualified";const o=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(s==null?void 0:s.category)||"Unknown"}, Reason: ${(s==null?void 0:s.reason)||"Unknown"}`}];return t.scheduledAppointment&&o.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:l,activities:o}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function tt(t,r){return r.startsWith("Closed")?dt.toClosed:t.startsWith("Closed")&&!r.startsWith("Closed")?dt.reopen:null}function tn(t){var i,p,d;const r=t.lead;if(!r)return null;const s=Se(r,"lead");if(!s)return((i=ke[oe.NEW])==null?void 0:i.primaryAction)||null;const l=ke[s];if(!l)return((p=ke[oe.NEW])==null?void 0:p.primaryAction)||null;if(!l.primaryAction)return((d=ke[oe.NEW])==null?void 0:d.primaryAction)||null;const o=l.primaryAction;return typeof o=="function"?o({lead:r,displayStage:s}):o}function sn(t){const r=t.lead;if(!r)return[];const s=Se(r,"lead"),l=ke[s];return l?l.secondaryActions||[]:[]}function at(t){const r=t.lead;if(!r||!(r.isDisqualified===!0))return!1;const l=Se(r,"lead");return l===oe.CLOSED_INVALID||l===oe.CLOSED_NOT_INTERESTED||l===oe.CLOSED_DUPLICATE}function nn(t){const r=t.lead;if(!r||at(t))return!1;const s=Se(r,"lead"),l=ke[s];return l?typeof l.showLQWidget=="function"?l.showLQWidget(r):l.showLQWidget??!1:!1}function on(t){const r=t.lead;if(!r||at(t))return!1;const s=Se(r,"lead"),l=ke[s];return l?l.showDeadlineBanner&&r.nextActionDue:!1}function ln(t){const r=t.lead;if(!r)return!1;const s=Se(r,"lead"),l=ke[s];return l?l.canPostpone??!1:!1}function an(t){const r=t.lead;if(!r)return"qualification";const s=Se(r,"lead"),l=ke[s];return l&&l.lqWidgetMode||"qualification"}function kt(t,r={}){const s=De(),l=D(()=>{const M=typeof t=="function"?t():He(t);return{lead:M,displayStage:M?Se(M,"lead"):null}}),o=D(()=>l.value.displayStage||"New"),i=D(()=>{const M=l.value;return at(M)}),p=D(()=>{const M=l.value,w=tn(M);if(!w)return null;const x=r[w.key];return{...w,handler:x||(()=>console.warn(`No handler for action: ${w.key}`))}}),d=D(()=>{const M=l.value;return sn(M).map(x=>{const g=r[x.key];return{...x,handler:g||(()=>console.warn(`No handler for action: ${x.key}`))}})}),v=D(()=>{const M=l.value;return nn(M)}),c=D(()=>{const M=l.value;return on(M)}),a=D(()=>{const M=l.value;return ln(M)}),u=D(()=>{const M=l.value;return an(M)}),m=D(()=>{const w=l.value.lead;return((w==null?void 0:w.contactAttempts)||[]).length||0}),h=D(()=>s.getSetting("maxContactAttempts")),C=D(()=>m.value+1>=h.value),O=D(()=>!0);return{displayStage:o,isClosed:i,primaryAction:p,secondaryActions:d,showLQWidget:v,showDeadlineBanner:c,canPostpone:a,canReassign:O,lqWidgetMode:u,contactAttempts:m,maxContactAttempts:h,shouldShowAutoDisqualifyWarning:C}}function rn({getLead:t,leadState:r,emit:s}){const l=lt(),o=Ee(),i=We();async function p(w){var g;const x=t();if(x){if(!r.canPostpone.value){console.warn("Cannot postpone in current state");return}try{const f=new Date(`${w.date}T${w.time}:00`),A=f.toISOString(),V={nextActionDue:A};if((w.assigneeId||w.teamId)&&(V.assignee=w.assignee||null,V.assigneeId=w.assigneeId||null,V.assigneeType=w.assigneeType||"user",V.teamId=w.teamId||null,V.team=w.team||null),await o.updateLead(x.id,V),w.createAppointment){const H=new Date(f);H.setHours(H.getHours()+1),await o.updateLead(x.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${x.customer.name}`,start:A,end:H.toISOString(),type:"Call",assignee:w.assignee||x.assignee,assigneeId:w.assigneeId||x.assigneeId,assigneeType:w.assigneeType||x.assigneeType||"user",teamId:w.teamId||x.teamId,team:w.team||x.team,status:"scheduled"}}),await o.addActivity(x.id,{type:"appointment",user:((g=i.currentUser)==null?void 0:g.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ue(f)} at ${je(f)}`,data:{type:"Call",date:w.date,time:w.time,assignee:w.assignee||x.assignee}})}await o.addActivity(x.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ue(f)} at ${je(f)}${w.assignee?` and reassigned to ${w.assignee}`:""}`}),await o.fetchLeadById(x.id)}catch(f){console.error("Failed to postpone lead task:",f)}}}async function d(w){const x=t();if(x)try{if(await o.updateLead(x.id,{stage:"Validated"}),await o.addActivity(x.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),w.scheduleFollowUp&&w.appointmentData){const g=new Date(`${w.appointmentData.date}T${w.appointmentData.time}:00`);await o.scheduleFollowUp(x.id,{dateTime:g.toISOString(),assignee:w.appointmentData.assignee||x.assignee,assigneeId:w.appointmentData.assigneeId||null,assigneeType:w.appointmentData.assigneeType||"user",teamId:w.appointmentData.teamId||null,team:w.appointmentData.team||null}),await o.addActivity(x.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ue(g)} at ${je(g)}`})}await o.fetchLeadById(x.id)}catch(g){console.error("Failed to validate lead:",g)}}async function v(){const w=t();if(w)try{const x=await o.convertLeadToOpportunity(w.id);i.canAccessOpportunities()?l.push({path:`/tasks/${x}`,query:{type:"opportunity"}}):l.push("/tasks")}catch(x){console.error("Failed to qualify lead:",x)}}async function c(w){const x=t();if(x)try{const g=x.contactAttempts||[];await o.updateLead(x.id,{contactAttempts:[...g,w],lastContactAttempt:w.timestamp,totalContactAttempts:g.length+1}),await o.addActivity(x.id,{type:"call",user:"You",action:`logged call attempt - ${w.outcome}`,content:w.notes||`Call attempt via ${w.channel}`,data:{outcome:w.outcome,channel:w.channel,duration:w.duration}}),await o.fetchLeadById(x.id)}catch(g){console.error("Failed to log call attempt:",g)}}async function a(w){const x=t();if(x)try{await o.addActivity(x.id,{type:"note",user:"You",action:"added a note",content:w.content||w.text||"",data:w}),await o.fetchLeadById(x.id)}catch(g){console.error("Failed to save note:",g)}}function u(){s("open-purchase-method")}function m(){s("open-trade-in")}async function h(w){var g;const x=t();if(x)try{const f=`${w.date}T${w.time}:00`,A=new Date(f);A.setHours(A.getHours()+1),await o.updateLead(x.id,{scheduledAppointment:{id:Date.now(),title:`${w.type} - ${x.customer.name}`,start:f,end:A.toISOString(),type:w.type,assignee:w.assignee,assigneeId:w.assigneeId,status:"scheduled",location:w.location||"",notes:w.notes||""}}),await o.addActivity(x.id,{type:"appointment",user:((g=i.currentUser)==null?void 0:g.name)||"You",action:"scheduled an appointment",content:`${w.type} scheduled for ${w.date} at ${w.time}`,data:{type:w.type,date:w.date,time:w.time,assignee:w.assignee}}),await o.fetchLeadById(x.id)}catch(f){console.error("Failed to schedule appointment:",f)}}async function C(w){const x=t();if(x){if(r.isClosed.value&&!w.force){console.warn("Lead already closed");return}try{const g=r.displayStage.value,f=w.reason==="Duplicate"?oe.CLOSED_DUPLICATE:w.category==="Not Interested"?oe.CLOSED_NOT_INTERESTED:oe.CLOSED_INVALID,A=tt(g,f);if(A){const{updates:V,activities:H}=A(x,f,w);await o.updateLead(x.id,V);for(const X of H)await o.addActivity(x.id,X)}else{const V=w.reason==="Duplicate";await o.updateLead(x.id,{isDisqualified:!0,disqualifyReason:w.reason,isDuplicate:V,stage:V?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await o.addActivity(x.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${w.category}, Reason: ${w.reason}`})}l.push("/tasks")}catch(g){console.error("Failed to disqualify lead:",g)}}}async function O(){const w=t();if(w)try{const x=r.displayStage.value,g=oe.NEW,f=tt(x,g);if(f){const{updates:A,activities:V}=f(w);await o.updateLead(w.id,A);for(const H of V)await o.addActivity(w.id,H)}else await o.updateLead(w.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await o.addActivity(w.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await o.fetchLeadById(w.id)}catch(x){console.error("Failed to reopen lead:",x)}}function M(){const w=t();w&&w.opportunityId&&l.push({path:`/tasks/${w.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:p,handleValidated:d,handleQualified:v,handleCallAttemptLogged:c,handleNoteSaved:a,handleOpenPurchaseMethod:u,handleOpenTradeIn:m,handleAppointmentScheduled:h,handleDisqualified:C,handleReopen:O,viewOpportunity:M}}const dn={class:"p-5 space-y-6"},Ct={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(r,s)=>t.task?(y(),k("div",{key:0,class:z(["bg-white border border-gray-200 rounded-xl shadow-sm",t.containerClass])},[s[0]||(s[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Manage next steps")])],-1)),te(r.$slots,"deadline-banner"),e("div",dn,[te(r.$slots,"primary-action"),te(r.$slots,"task-widgets"),te(r.$slots,"closed-state"),te(r.$slots,"secondary-actions")])],2)):L("",!0)}},un={class:"flex justify-between items-start mb-3"},cn={class:"font-bold text-gray-900 text-sm"},pn={class:"text-xs text-gray-500 mt-0.5"},mn={class:"flex gap-3 flex-wrap"},St={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(r,s)=>(y(),k("div",{class:z(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",un,[e("div",null,[e("h4",cn,N(t.action.title),1),e("p",pn,N(t.action.description),1)])]),e("div",mn,[e("button",{onClick:s[0]||(s[0]=l=>r.$emit("action-clicked")),class:z([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:z(t.action.icon)},null,2),j(" "+N(t.action.label),1)],2)])],2))}},fn={class:"flex items-center gap-3"},yn={class:"flex-1"},gn={key:0,class:"text-xs font-normal opacity-75"},vn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:r}){const s=t,l=r,o=I(!1),i=D(()=>mt(s.nextActionDue)),p=D(()=>s.isClosed||!s.showDeadlineBanner||o.value?!1:i.value.type==="overdue"||i.value.type==="urgent"),d=()=>{o.value=!0,l("dismissed")};return(v,c)=>p.value?(y(),k("div",{key:0,class:z(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[i.value.bgClass,i.value.borderClass]])},[e("div",fn,[e("div",{class:z(["w-9 h-9 rounded-lg flex items-center justify-center",[i.value.bgClass,i.value.borderClass,"border"]])},[e("i",{class:z(["text-base",[`fa-solid ${i.value.icon}`,i.value.textClass]])},null,2)],2),e("div",yn,[c[0]||(c[0]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:z(["text-sm font-bold",i.value.textClass])},[j(N(n(ft)(t.nextActionDue))+" ",1),i.value.type!=="overdue"?(y(),k("span",gn," ("+N(n(yt)(t.nextActionDue))+") ",1)):L("",!0)],2)]),i.value.type==="overdue"?(y(),k("div",{key:0,class:z(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...c[1]||(c[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),j(" Overdue ",-1)])],2)):i.value.type==="urgent"?(y(),k("div",{key:1,class:z(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),j(" Urgent ",-1)])],2)):L("",!0)]),e("button",{onClick:d,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...c[3]||(c[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):L("",!0)}},bn={class:"space-y-4"},hn={label:"Teams"},xn=["value"],wn={label:"Users"},kn=["value"],Cn={key:0,class:"text-xs text-sub mt-1"},Sn={key:0,class:"animate-fade-in"},$n={class:"grid grid-cols-4 gap-2"},An=["onClick"],Dn={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(t,{emit:r}){const s=t,l=r,o=We(),i=Je(),p=I(""),d=I(null),v=I(""),c=I(!1),a=I(""),u=D(()=>i.assignableUsers),m=D(()=>i.assignableTeams),h=D(()=>d.value&&d.value.startsWith("team-")),C=D(()=>!!(p.value&&v.value&&a.value&&d.value));Ke(()=>{var g;d.value=`user-${((g=o.currentUser)==null?void 0:g.id)||1}`}),Ce(()=>s.show,g=>{g||O()});const O=()=>{var g;p.value="",d.value=`user-${((g=o.currentUser)==null?void 0:g.id)||1}`,v.value="",c.value=!1,a.value=""},M=g=>{g||l("close")},w=()=>{if(!C.value)return;const g=d.value.startsWith("team-"),f=parseInt(d.value.split("-")[1]);let A={};if(g){const V=i.getTeamById(f);A={assigneeType:"team",teamId:f,team:(V==null?void 0:V.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const V=i.getUserById(f);A={assigneeType:"user",assigneeId:f,assignee:(V==null?void 0:V.name)||"Unknown",teamId:null,team:null}}l("confirm",{type:p.value,date:v.value,time:a.value,...A}),l("close")},x=()=>{l("close")};return(g,f)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":M},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...f[4]||(f[4]=[j("Schedule Appointment",-1)])]),_:1}),S(n(ze),null,{default:$(()=>[...f[5]||(f[5]=[j("Book an appointment with the customer",-1)])]),_:1})]),_:1}),e("div",bn,[e("div",null,[f[7]||(f[7]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Appointment Type",-1)),Q(e("select",{"onUpdate:modelValue":f[0]||(f[0]=A=>p.value=A),class:"input"},[...f[6]||(f[6]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[he,p.value]])]),e("div",null,[f[9]||(f[9]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Assign to",-1)),Q(e("select",{"onUpdate:modelValue":f[1]||(f[1]=A=>d.value=A),class:"input"},[e("optgroup",hn,[(y(!0),k(de,null,pe(m.value,A=>(y(),k("option",{key:`team-${A.id}`,value:`team-${A.id}`},N(A.name)+" Team ",9,xn))),128))]),e("optgroup",wn,[(y(!0),k(de,null,pe(u.value,A=>{var V;return y(),k("option",{key:`user-${A.id}`,value:`user-${A.id}`},N(A.name)+N(A.id===((V=n(o).currentUser)==null?void 0:V.id)?" (Me)":""),9,kn)}),128))])],512),[[he,d.value]]),h.value?(y(),k("p",Cn,[...f[8]||(f[8]=[e("i",{class:"fa-solid fa-users text-sub"},null,-1),j(" Any available team member will be assigned ",-1)])])):L("",!0)]),e("div",null,[f[10]||(f[10]=e("label",{class:"block text-xs font-medium text-sub mb-1.5"},"Select Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":f[2]||(f[2]=A=>v.value=A),onChange:f[3]||(f[3]=A=>c.value=!0),class:"input"},null,544),[[ie,v.value]])]),c.value?(y(),k("div",Sn,[f[11]||(f[11]=e("label",{class:"block text-xs font-medium text-sub mb-2"},"Available Slots",-1)),e("div",$n,[(y(),k(de,null,pe(["09:00","10:30","11:00","14:30","15:00","16:30"],A=>e("button",{key:A,onClick:V=>a.value=A,class:z(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",a.value===A?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},N(A),11,An)),64))])])):L("",!0)]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x}),S(n(P),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!C.value,onClick:w},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Tn={class:"bg-surface border border rounded-lg p-4 animate-fade-in"},In={key:0,class:"flex justify-between items-center mb-4"},Ln={class:"font-semibold text-heading text-sm"},On={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(r,s)=>(y(),k("div",Tn,[t.title?(y(),k("div",In,[e("h5",Ln,N(t.title),1),t.showClose?(y(),W(n(P),{key:0,label:"Close",variant:"outline",size:"small",onClick:s[0]||(s[0]=l=>r.$emit("close"))})):L("",!0)])):L("",!0),te(r.$slots,"default")]))}};function Nn(){const t=qt(),r=I(!1),s=I(!1),l=I(0),o=I(""),i=I(null),p=I({}),d=I(null),v={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},c=D(()=>{const O=Math.floor(l.value/60),M=l.value%60;return`${O.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`}),a=()=>{r.value=!0,l.value=0,s.value=!1,o.value="",i.value=setInterval(()=>{l.value++,l.value>=20&&u()},1e3)},u=()=>{i.value&&(clearInterval(i.value),i.value=null),r.value=!1,s.value=!0,p.value={duration:l.value,notes:o.value,transcription:v,channel:"phone"}},m=async O=>{try{await navigator.clipboard.writeText(O),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},h=O=>(d.value={tradeIn:v.leadLines.some(M=>M.toLowerCase().includes("trade")||M.toLowerCase().includes("exchange"))||!1,financing:v.leadLines.some(M=>M.toLowerCase().includes("financ")||M.toLowerCase().includes("payment")||M.toLowerCase().includes("loan"))||!1},d.value.tradeIn&&O&&(O.value.tradeIn=!0),d.value.financing&&O&&(O.value.financing=!0),d.value),C=()=>{r.value=!1,s.value=!1,l.value=0,o.value="",p.value={},i.value&&(clearInterval(i.value),i.value=null)};return Mt(()=>{i.value&&clearInterval(i.value)}),{isCallActive:r,callEnded:s,callDuration:l,callNotes:o,callData:p,extractedData:d,mockTranscription:v,formattedCallDuration:c,startCall:a,endCall:u,copyNumber:m,extractInformation:h,resetCall:C}}function qn(t,r,s,l,o,i){var me,xe,we;const p=I(!1),d=I(null),v=I(!1),c=I(null),a=I(!1),u=I(!1),m=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],h=I("whatsapp"),C=I("followup-1"),O=I("custom"),M=I(""),w=I("09:00"),x=I("Not Interested"),g=I(""),f=I({dealership:((xe=(me=t.value)==null?void 0:me.requestedCar)==null?void 0:xe.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((we=i==null?void 0:i.value)==null?void 0:we.id)||null}),A=I({tradeIn:!1,financing:!1,contactAvailability:!1}),V=D(()=>{var fe,ve,be,ue,ne,U,F;const Z=((be=(ve=(fe=t.value)==null?void 0:fe.customer)==null?void 0:ve.name)==null?void 0:be.split(" ")[0])||"",_=((ne=(ue=t.value)==null?void 0:ue.requestedCar)==null?void 0:ne.brand)||"",ae=((F=(U=t.value)==null?void 0:U.requestedCar)==null?void 0:F.model)||"";return{"followup-1":`Hi ${Z}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${_} ${ae}?`,"followup-2":`Hello ${Z}, this is regarding your inquiry about the ${_} ${ae}. Please let me know when you're available for a call.`,custom:""}}),H=D(()=>C.value==="custom"?"Type your custom message...":V.value[C.value]||""),X=D(()=>{var Z;return!!((Z=t.value)!=null&&Z.scheduledAppointment)});return{showOutcomeSelection:p,selectedOutcome:d,appointmentScheduled:v,scheduledAppointmentData:c,showNoteModal:a,showScheduleAppointmentModal:u,followupChannels:m,followupChannel:h,selectedTemplate:C,rescheduleTime:O,customDate:M,customTime:w,disqualifyCategory:x,disqualifyReason:g,assignment:f,preferences:A,messageTemplates:V,messagePreview:H,hasExistingAppointment:X,selectOutcome:Z=>{d.value=Z,Z==="interested"&&(s!=null&&s.value)&&(A.value.tradeIn=s.value.tradeIn||!1,A.value.financing=s.value.financing||!1)},cancelOutcome:()=>{d.value=null,p.value=!1,v.value=!1,c.value=null},calculateNextCallDate:()=>{if(O.value==="tomorrow-9am"){const _=new Date;return _.setDate(_.getDate()+1),_.setHours(9,0,0,0),_.toISOString()}else if(O.value==="monday"){const _=new Date,ae=(8-_.getDay())%7||7;return _.setDate(_.getDate()+ae),_.setHours(9,0,0,0),_.toISOString()}else if(O.value==="custom"&&M.value&&w.value)return new Date(`${M.value}T${w.value}:00`).toISOString();const Z=new Date;return Z.setDate(Z.getDate()+1),Z.setHours(9,0,0,0),Z.toISOString()},resetOutcomeState:()=>{d.value=null,p.value=!1,v.value=!1,c.value=null,h.value="whatsapp",C.value="followup-1",O.value="custom",M.value="",w.value="09:00",x.value="Not Interested",g.value=""}}}function Mn(t,r,s,l,o,i){const{callData:p}=r,{showOutcomeSelection:d,selectedOutcome:v,appointmentScheduled:c,scheduledAppointmentData:a,assignment:u,preferences:m,cancelOutcome:h,calculateNextCallDate:C,showScheduleAppointmentModal:O}=s;return{logManualCall:()=>{p.value={channel:"external",notes:"",transcription:null},d.value=!0},handleScheduleAppointmentConfirm:async H=>{a.value=H,c.value=!0,O.value=!1,t("appointment-scheduled",H)},handleQualify:()=>{var X,se,le;const H={timestamp:new Date().toISOString(),outcome:"interested",channel:((X=p.value)==null?void 0:X.channel)||"phone",notes:((se=p.value)==null?void 0:se.notes)||"",transcription:((le=p.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",H),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:u.value,preferences:m.value,scheduleAppointment:c.value,appointmentData:a.value}),h()},handleDisqualifyFromInterested:()=>{var X,se,le;const H={timestamp:new Date().toISOString(),outcome:"interested",channel:((X=p.value)==null?void 0:X.channel)||"phone",notes:((se=p.value)==null?void 0:se.notes)||"",transcription:((le=p.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",H),v.value="not-valid"},handleNoAnswerConfirm:async()=>{var ge,Y,me;const H={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((ge=p.value)==null?void 0:ge.channel)||"phone",notes:((Y=p.value)==null?void 0:Y.notes)||"",transcription:((me=p.value)==null?void 0:me.transcription)||null};t("call-attempt-logged",H);const X=C(),se=X.split("T")[0],le=new Date(X).toTimeString().slice(0,5);t("postponed",{date:se,time:le,createAppointment:!0}),(o==null?void 0:o.value)+1>=(i==null?void 0:i.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),h()},handleNotValidConfirm:()=>{var X,se,le;const H={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((X=p.value)==null?void 0:X.channel)||"phone",notes:((se=p.value)==null?void 0:se.notes)||"",transcription:((le=p.value)==null?void 0:le.transcription)||null};t("call-attempt-logged",H),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),h()},handleNoteSave:H=>{s.showNoteModal.value=!1,t("note-saved",H)}}}const Rn={key:0,class:"flex gap-2 items-center mb-4"},Fn=["disabled"],Vn=["disabled"],Bn={key:1,class:"mb-4 space-y-4 border-t border pt-4"},Un={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Wn={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},jn={class:"flex items-center gap-2 text-red-400"},En={class:"text-xs font-mono"},zn={class:"space-y-3 text-sm font-mono"},Hn={class:"ml-2"},Pn={class:"ml-2"},Qn={key:0},Yn={class:"ml-2"},Kn={key:1},Gn={class:"ml-2"},Jn={key:2},Xn={class:"ml-2"},Zn={class:"mt-4 pt-4 border-t border-slate-700"},_n=["model-value"],eo={class:"mt-4 flex justify-end"},to={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},so={class:"flex items-center justify-between"},no={class:"flex gap-2"},oo={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(r,s)=>(y(),k("div",null,[!t.showOutcomeSelection&&!t.isCallActive&&!t.callEnded?(y(),k("div",Rn,[e("button",{disabled:t.isCallActive,onClick:s[0]||(s[0]=l=>r.$emit("start-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),j(" "+N(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],8,Fn),e("button",{disabled:t.isCallActive,onClick:s[1]||(s[1]=l=>r.$emit("log-manual-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),j(" Log Call Outcome ",-1)])],8,Vn)])):L("",!0),t.isCallActive||t.callEnded?(y(),k("div",Bn,[t.isCallActive?(y(),k("div",Un,[e("div",Wn,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",jn,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",En,"REC "+N(t.formattedCallDuration),1)])]),e("div",zn,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Hn,N(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Pn,N(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(y(),k("div",Qn,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Yn,N(t.mockTranscription.leadLines[1]),1)])):L("",!0),t.callDuration>=8?(y(),k("div",Kn,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Gn,N(t.mockTranscription.salesLines[1]),1)])):L("",!0),t.callDuration>=12?(y(),k("div",Jn,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Xn,N(t.mockTranscription.leadLines[2]),1)])):L("",!0)]),e("div",Zn,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=l=>r.$emit("update:call-notes",l)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,_n)]),e("div",eo,[S(n(P),{label:"End Call",variant:"primary",size:"small",onClick:s[3]||(s[3]=l=>r.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):L("",!0),t.callEnded&&!t.isCallActive?(y(),k("div",to,[e("div",so,[s[15]||(s[15]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",no,[S(n(P),{label:"Extract information",variant:"primary",size:"small",onClick:s[4]||(s[4]=l=>r.$emit("extract-information")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Log outcome",variant:"outline",size:"small",onClick:s[5]||(s[5]=l=>r.$emit("log-manual-call"))})])])])):L("",!0)])):L("",!0)]))}},lo={class:"bg-surfaceSecondary/50 border border rounded-lg p-6 relative transition-all duration-300"},ao={class:"flex justify-between items-start mb-3"},io={class:"font-bold text-heading text-content"},ro={class:"text-meta mt-0.5"},uo={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},co={class:"text-meta text-blue-700"},po={key:1,class:"mb-3 bg-surfaceSecondary border border rounded-lg p-3"},mo={class:"flex items-center justify-between"},fo={class:"flex items-center gap-2"},yo={class:"text-meta-bold text-heading"},go={key:0,class:"text-meta text-orange-600 font-medium flex items-center gap-1"},vo={class:"flex items-center gap-2 mb-3"},bo={class:"text-content text-body font-medium"},ho={key:2,class:"mt-4 space-y-4 border-t border pt-4"},xo={class:"grid grid-cols-3 gap-2"},wo={key:0,class:"space-y-4 bg-surface border border rounded-lg p-6"},ko={class:"grid grid-cols-4 gap-2"},Co=["onClick"],So={key:0,class:"fa-brands fa-whatsapp text-xs"},$o={key:1,class:"fa-solid fa-message text-xs"},Ao={key:2,class:"fa-solid fa-envelope text-xs"},Do={key:3,class:"fa-solid fa-xmark text-xs"},To={key:0},Io={class:"mt-2 p-3 bg-surfaceSecondary border border rounded-lg"},Lo={class:"text-meta text-body"},Oo={class:"grid grid-cols-3 gap-2"},No={key:0,class:"mt-3 grid grid-cols-2 gap-3"},qo={class:"flex justify-end gap-2 pt-3 border-t border"},Mo={key:1,class:"space-y-4 bg-surface border border rounded-lg p-6"},Ro={class:"flex gap-4"},Fo={class:"flex items-center gap-2 cursor-pointer"},Vo={class:"flex items-center gap-2 cursor-pointer"},Bo={class:"flex justify-end gap-2 pt-3 border-t border"},Uo={key:2,class:"space-y-4"},Wo={class:"bg-surface border border rounded-lg p-6"},jo={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Eo=["value"],zo=["value"],Ho=["value"],Po={class:"bg-surface border border rounded-lg p-6"},Qo={class:"flex gap-2"},Yo={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Ko={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Go={class:"ml-2 font-medium text-heading"},Jo={class:"ml-2 font-medium text-heading"},Xo={class:"ml-2 font-medium text-heading capitalize"},Zo={class:"ml-2 font-medium text-heading"},_o={key:1,class:"bg-surface border border rounded-lg p-6"},el={class:"space-y-2"},tl=["checked"],sl=["checked","disabled"],nl={class:"flex-1"},ol={class:"text-xs text-gray-500 mt-0.5"},ll={class:"space-y-3"},al={class:"grid grid-cols-2 gap-3 text-sm"},il={class:"ml-2 font-medium text-heading"},rl={class:"ml-2 font-medium text-heading"},dl={class:"ml-2 font-medium text-heading capitalize"},ul={class:"ml-2 font-medium text-heading"},cl={key:0,class:"text-sm"},pl={class:"ml-2 font-medium text-heading"},ml={key:1,class:"text-sm"},fl={class:"mt-1 text-body"},yl={class:"flex justify-between items-center pt-3 border-t border"},gl={class:"flex gap-2"},vl={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:r}){const s=t,l=ce=>{ce||(F.value=!1)},o=r,i=Je(),p=We();De();const d=kt(()=>s.lead,{}),v=Nn(),{isCallActive:c,callEnded:a,callDuration:u,callNotes:m,callData:h,extractedData:C,mockTranscription:O,formattedCallDuration:M,startCall:w,endCall:x,copyNumber:g,extractInformation:f}=v,A=I(null),V=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],H=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],X=D(()=>i.assignableUsers),se=D(()=>p.currentUser),le=()=>{w()},ge=()=>{g(s.lead.customer.phone)},Y=ce=>{m.value=ce},me=D(()=>{var ce;return((ce=d.primaryAction.value)==null?void 0:ce.title)||"Call to Verify Contact Details"}),xe=D(()=>{var ce;return((ce=d.primaryAction.value)==null?void 0:ce.description)||"Begin lead qualification by verifying customer contact information."}),we=D(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),Z=D(()=>!!s.lead.scheduledAppointment),_=D(()=>Z.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:we.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${yt(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),ae=d.contactAttempts,fe=d.maxContactAttempts,ve=qn(Be(s,"lead"),h,C,ae,fe,se),{showOutcomeSelection:be,selectedOutcome:ue,appointmentScheduled:ne,scheduledAppointmentData:U,showNoteModal:F,showScheduleAppointmentModal:K,followupChannels:Xe,followupChannel:Re,selectedTemplate:T,rescheduleTime:B,customDate:ee,customTime:re,disqualifyCategory:q,disqualifyReason:E,assignment:G,messagePreview:ye,hasExistingAppointment:Fe,selectOutcome:Ze,cancelOutcome:_e}=ve;D(()=>s.activities.filter(ce=>ce.type==="note"));const $t=Mn(o,v,ve,Be(s,"lead"),ae,fe),{logManualCall:At,handleScheduleAppointmentConfirm:Dt,handleQualify:Tt,handleDisqualifyFromInterested:It,handleNoAnswerConfirm:Lt,handleNotValidConfirm:Ot,handleNoteSave:Nt}=$t;return(ce,b)=>(y(),k("div",lo,[e("div",ao,[e("div",null,[e("h4",io,N(me.value),1),e("p",ro,N(xe.value),1)]),e("div",{class:z(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",_.value.class])},N(_.value.text),3)]),Z.value?(y(),k("div",uo,[b[25]||(b[25]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-meta-bold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",co,N(n(Ue)(t.lead.scheduledAppointment.start))+" at "+N(n(je)(t.lead.scheduledAppointment.start)),1)])):L("",!0),n(ae)>0?(y(),k("div",po,[e("div",mo,[e("div",fo,[b[26]||(b[26]=e("i",{class:"fa-solid fa-phone text-body text-xs"},null,-1)),b[27]||(b[27]=e("span",{class:"text-meta-bold text-body"},"Contact Attempts:",-1)),e("span",yo,N(n(ae))+" / "+N(n(fe)),1)]),n(ae)>=n(fe)-1?(y(),k("div",go,[...b[28]||(b[28]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),j(" One more attempt before auto-disqualification ",-1)])])):L("",!0)])])):L("",!0),e("div",vo,[e("span",bo,N(t.lead.customer.phone),1),e("button",{onClick:ge,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-[21.6px] h-[21.6px]",title:"Copy phone number"},[...b[29]||(b[29]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),S(oo,{"is-call-active":n(c),"call-ended":n(a),"call-duration":n(u),"call-notes":n(m),"formatted-call-duration":n(M),"mock-transcription":n(O),"show-outcome-selection":n(be),"contact-attempts":n(ae),"max-contact-attempts":n(fe),onStartCall:le,onEndCall:n(x),onLogManualCall:n(At),onExtractInformation:n(f),"onUpdate:callNotes":Y,onCopyNumber:ge},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),n(be)?(y(),k("div",ho,[e("div",null,[b[33]||(b[33]=e("h4",{class:"font-semibold text-heading mb-2 text-content"},"What's the outcome?",-1)),e("div",xo,[e("button",{onClick:b[0]||(b[0]=R=>n(Ze)("no-answer")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(ue)==="no-answer"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[30]||(b[30]=[e("i",{class:"fa-solid fa-phone-slash text-sm"},null,-1),e("span",null,"No answer",-1)])],2),e("button",{onClick:b[1]||(b[1]=R=>n(Ze)("not-valid")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(ue)==="not-valid"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[31]||(b[31]=[e("i",{class:"fa-solid fa-ban text-sm"},null,-1),e("span",null,"Not valid",-1)])],2),e("button",{onClick:b[2]||(b[2]=R=>n(Ze)("interested")),class:z(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-sm font-medium text-body transition-all",n(ue)==="interested"?"border-brand-red bg-red-50 text-brand-red":"border hover:border-red-300 hover:bg-red-50/50"])},[...b[32]||(b[32]=[e("i",{class:"fa-solid fa-check-circle text-sm"},null,-1),e("span",null,"Interested",-1)])],2)])]),n(ue)==="no-answer"?(y(),k("div",wo,[b[40]||(b[40]=e("h5",{class:"font-semibold text-heading text-content"},"Send follow-up message",-1)),e("div",ko,[(y(!0),k(de,null,pe(n(Xe),R=>(y(),k("button",{key:R.value,onClick:()=>{n(Re).value=R.value},class:z(["bg-surface border-2 rounded-lg h-10 flex items-center justify-center gap-2 text-sm font-medium transition-all",n(Re).value===R.value?"border-primary-700 bg-primary-50 text-primary-700":"border text-body hover:border-primary-300 hover:bg-primary-50/50"])},[R.value==="whatsapp"?(y(),k("i",So)):R.value==="sms"?(y(),k("i",$o)):R.value==="email"?(y(),k("i",Ao)):R.value==="dont-send"?(y(),k("i",Do)):L("",!0),e("span",null,N(R.label),1)],10,Co))),128))]),n(Re)&&n(Re)!=="dont-send"?(y(),k("div",To,[b[36]||(b[36]=e("label",{class:"block text-meta-bold mb-1.5"},"Template",-1)),Q(e("select",{"onUpdate:modelValue":b[3]||(b[3]=R=>Ve(T)?T.value=R:null),class:"input"},[...b[34]||(b[34]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[he,n(T)]]),e("div",Io,[b[35]||(b[35]=e("p",{class:"text-meta-bold mb-1 uppercase"},"Message preview",-1)),e("p",Lo,N(n(ye)),1)])])):L("",!0),e("div",null,[b[39]||(b[39]=e("h5",{class:"font-semibold text-heading text-content mb-2"},"Next call attempt",-1)),e("div",Oo,[e("button",{onClick:b[4]||(b[4]=R=>B.value="tomorrow-9am"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(B)==="tomorrow-9am"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:b[5]||(b[5]=R=>B.value="monday"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(B)==="monday"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Monday ",2),e("button",{onClick:b[6]||(b[6]=R=>B.value="custom"),class:z(["bg-surface border-2 rounded-lg px-4 py-2 text-sm font-medium text-body transition-all",n(B)==="custom"?"border-primary-700 bg-primary-50 text-primary-700":"border hover:border-primary-300 hover:bg-primary-50/50"])}," Select time ",2)]),n(B)==="custom"?(y(),k("div",No,[e("div",null,[b[37]||(b[37]=e("label",{class:"block text-meta-bold mb-1.5"},"Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":b[7]||(b[7]=R=>Ve(ee)?ee.value=R:null),class:"input"},null,512),[[ie,n(ee)]])]),e("div",null,[b[38]||(b[38]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Time",-1)),Q(e("input",{type:"time","onUpdate:modelValue":b[8]||(b[8]=R=>Ve(re)?re.value=R:null),class:"input"},null,512),[[ie,n(re)]])])])):L("",!0)]),e("div",qo,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(_e)},null,8,["onClick"]),S(n(P),{label:"Send and reschedule",variant:"primary",size:"small",onClick:n(Lt),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])):L("",!0),n(ue)==="not-valid"?(y(),k("div",Mo,[e("div",null,[b[43]||(b[43]=e("label",{class:"block text-meta-bold mb-2"},"Category",-1)),e("div",Ro,[e("label",Fo,[Q(e("input",{type:"radio","onUpdate:modelValue":b[9]||(b[9]=R=>Ve(q)?q.value=R:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,n(q)]]),b[41]||(b[41]=e("span",{class:"text-content text-body"},"Not Valid",-1))]),e("label",Vo,[Q(e("input",{type:"radio","onUpdate:modelValue":b[10]||(b[10]=R=>Ve(q)?q.value=R:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,n(q)]]),b[42]||(b[42]=e("span",{class:"text-sm text-body"},"Not Interested",-1))])])]),e("div",null,[b[45]||(b[45]=e("label",{class:"block text-xs font-medium text-body mb-2"},"Failure Reason",-1)),Q(e("select",{"onUpdate:modelValue":b[11]||(b[11]=R=>Ve(E)?E.value=R:null),class:"w-full bg-surface border-2 border-red-500 rounded-lg px-3 py-2 text-content text-body focus:outline-none focus:border-red-600"},[...b[44]||(b[44]=[Qe('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[he,n(E)]])]),e("div",Bo,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(_e)},null,8,["onClick"]),S(n(P),{label:"Confirm Disqualification",variant:"primary",size:"small",disabled:!n(q)||!n(E),onClick:n(Ot),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"},null,8,["disabled","onClick"])])])):L("",!0),n(ue)==="interested"?(y(),k("div",Uo,[e("div",Wo,[b[49]||(b[49]=e("h5",{class:"font-semibold text-heading text-content mb-3"},"Assign to salesman",-1)),e("div",jo,[e("div",null,[b[46]||(b[46]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Dealership",-1)),Q(e("select",{"onUpdate:modelValue":b[12]||(b[12]=R=>n(G).dealership=R),class:"input"},[(y(),k(de,null,pe(V,R=>e("option",{key:R,value:R},N(R),9,Eo)),64))],512),[[he,n(G).dealership]])]),e("div",null,[b[47]||(b[47]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Team",-1)),Q(e("select",{"onUpdate:modelValue":b[13]||(b[13]=R=>n(G).team=R),class:"input"},[(y(),k(de,null,pe(H,R=>e("option",{key:R,value:R},N(R),9,zo)),64))],512),[[he,n(G).team]])]),e("div",null,[b[48]||(b[48]=e("label",{class:"block text-xs font-medium text-body mb-1.5"},"Assignee",-1)),Q(e("select",{"onUpdate:modelValue":b[14]||(b[14]=R=>n(G).assigneeId=R),class:"input"},[(y(!0),k(de,null,pe(X.value,R=>(y(),k("option",{key:R.id,value:R.id},N(R.name)+N(R.id===se.value.id?" (Me)":""),9,Ho))),128))],512),[[he,n(G).assigneeId]])])])]),e("div",Po,[b[50]||(b[50]=e("h5",{class:"font-semibold text-heading text-content mb-3"},"Customer preferences",-1)),e("div",Qo,[S(n(P),{label:"Add purchase method",variant:"primary",size:"small",onClick:b[15]||(b[15]=R=>o("open-purchase-method")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Add trade-in",variant:"primary",size:"small",onClick:b[16]||(b[16]=R=>o("open-trade-in")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),S(n(P),{label:"Add note",variant:"primary",size:"small",onClick:b[17]||(b[17]=R=>F.value=!0),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"})])]),n(Fe)&&!n(ne)?(y(),k("div",Yo,[b[55]||(b[55]=Qe('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="heading-sub">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Ko,[e("div",null,[b[51]||(b[51]=e("span",{class:"text-body"},"Date:",-1)),e("span",Go,N(n(Ue)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[b[52]||(b[52]=e("span",{class:"text-body"},"Time:",-1)),e("span",Jo,N(n(je)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[b[53]||(b[53]=e("span",{class:"text-body"},"Type:",-1)),e("span",Xo,N(t.lead.scheduledAppointment.type),1)]),e("div",null,[b[54]||(b[54]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Zo,N(t.lead.scheduledAppointment.assignee),1)])]),S(n(P),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:b[18]||(b[18]=R=>K.value=!0)})])):L("",!0),n(Fe)?L("",!0):(y(),k("div",_o,[b[58]||(b[58]=e("h5",{class:"text-xs font-semibold text-body mb-3"},"Choose Next Step",-1)),e("div",el,[e("label",{class:z(["flex items-start gap-3 p-3 border border rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!n(ne)}])},[e("input",{type:"radio",checked:!n(ne),onChange:b[19]||(b[19]=()=>{ne.value=!1,U.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,tl),b[56]||(b[56]=e("div",{class:"flex-1"},[e("div",{class:"heading-sub"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:z(["flex items-start gap-3 p-3 border border rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":n(ne)}]),onClick:b[21]||(b[21]=R=>!n(ne)&&(K.value=!0))},[e("input",{type:"radio",checked:n(ne),disabled:!n(ne),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,sl),e("div",nl,[b[57]||(b[57]=e("div",{class:"heading-sub"},"Schedule Appointment",-1)),e("div",ol,N(n(ne)?"Appointment scheduled":"Book a meeting or test drive"),1)]),n(ne)?(y(),W(n(P),{key:0,label:"Reschedule",variant:"primary",size:"small",onClick:b[20]||(b[20]=Ye(R=>K.value=!0,["stop","prevent"])),class:"text-xs !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"})):L("",!0)],2)])])),n(ne)?(y(),W(On,{key:2,title:"Scheduled Appointment","show-close":!1},{default:$(()=>[e("div",ll,[e("div",al,[e("div",null,[b[59]||(b[59]=e("span",{class:"text-body"},"Date:",-1)),e("span",il,N(n(Ue)(n(U).datetime)),1)]),e("div",null,[b[60]||(b[60]=e("span",{class:"text-body"},"Time:",-1)),e("span",rl,N(n(U).time),1)]),e("div",null,[b[61]||(b[61]=e("span",{class:"text-body"},"Type:",-1)),e("span",dl,N(n(U).type),1)]),e("div",null,[b[62]||(b[62]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",ul,N(n(U).assignee),1)])]),n(U).location?(y(),k("div",cl,[b[63]||(b[63]=e("span",{class:"text-body"},"Location:",-1)),e("span",pl,N(n(U).location),1)])):L("",!0),n(U).notes?(y(),k("div",ml,[b[64]||(b[64]=e("span",{class:"text-body"},"Notes:",-1)),e("p",fl,N(n(U).notes),1)])):L("",!0)])]),_:1})):L("",!0),e("div",yl,[S(n(P),{label:"Cancel",variant:"outline",size:"small",onClick:n(_e)},null,8,["onClick"]),e("div",gl,[S(n(P),{label:"Disqualify",variant:"outline",size:"small",onClick:n(It)},null,8,["onClick"]),S(n(P),{label:"Qualify",variant:"primary",size:"small",onClick:n(Tt),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"},null,8,["onClick"])])])])):L("",!0)])):L("",!0),S(n(Me),{open:n(F),"onUpdate:open":l},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-2xl"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...b[65]||(b[65]=[j("Add Note",-1)])]),_:1})]),_:1}),S(Wt,{ref_key:"noteWidgetRef",ref:A,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(Nt),onCancel:b[22]||(b[22]=R=>F.value=!1)},null,8,["task-id","onSave"]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>{var R,it;return[S(n(P),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[23]||(b[23]=Xa=>F.value=!1)},{default:$(()=>[...b[66]||(b[66]=[j(" Cancel ",-1)])]),_:1}),S(n(P),{variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!((R=A.value)!=null&&R.canSubmit()),onClick:(it=A.value)==null?void 0:it.submit},{default:$(()=>[...b[67]||(b[67]=[j(" Save Note ",-1)])]),_:1},8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),S(Dn,{show:n(K),onConfirm:n(Dt),onClose:b[24]||(b[24]=R=>K.value=!1)},null,8,["show","onConfirm"])]))}},bl={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},hl={class:"flex justify-between items-start mb-3"},xl={class:"text-xs text-gray-500 mt-0.5"},wl={key:0},kl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:r}){const s=t,l=r,o=Ee(),i=()=>{var g;const x=o.currentLead;return x&&x.id===((g=s.lead)==null?void 0:g.id)?x:s.lead},p={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},d=kt(Be(s,"lead"),p),{handlePostponed:v,handleValidated:c,handleQualified:a,handleCallAttemptLogged:u,handleNoteSaved:m,handleOpenPurchaseMethod:h,handleOpenTradeIn:C,handleAppointmentScheduled:O,handleDisqualified:M,handleReopen:w}=rn({getLead:i,leadState:d,emit:l});return(x,g)=>(y(),W(Ct,{task:t.lead},{"deadline-banner":$(()=>[S(vn,{"next-action-due":t.lead.nextActionDue,"is-closed":n(d).isClosed.value,"show-deadline-banner":n(d).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":$(()=>[!n(d).isClosed.value&&n(d).showLQWidget.value?(y(),W(vl,{key:t.lead.id,lead:t.lead,onPostponed:n(v),onValidated:n(c),onQualified:n(a),onDisqualified:n(M),onCallAttemptLogged:n(u),onNoteSaved:n(m),onOpenPurchaseMethod:n(h),onOpenTradeIn:n(C),onAppointmentScheduled:n(O)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(d).isClosed.value&&n(d).primaryAction.value?(y(),W(St,{key:1,action:n(d).primaryAction.value,"color-scheme":n(d).primaryAction.value.colorScheme,onActionClicked:n(d).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]),"task-widgets":$(()=>[...g[0]||(g[0]=[])]),"closed-state":$(()=>[n(d).isClosed.value?(y(),k("div",bl,[e("div",hl,[e("div",null,[g[1]||(g[1]=e("h4",{class:"font-bold text-gray-900 text-sm"},"Lead Closed",-1)),e("p",xl,[j(" Status: "+N(n(d).displayStage.value)+" ",1),t.lead.disqualifyReason?(y(),k("span",wl," - "+N(t.lead.disqualifyReason),1)):L("",!0)])])]),S(n(P),{variant:"primary",size:"small",onClick:n(w),class:"flex items-center gap-2"},{default:$(()=>[...g[2]||(g[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):L("",!0)]),_:1},8,["task"]))}},Cl={class:"flex justify-between items-start mb-3"},Sl={class:"font-bold text-gray-900 text-sm"},$l={class:"text-xs text-gray-500 mt-0.5"},Al={class:"flex gap-3 flex-wrap"},$e={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(r,s)=>(y(),k("div",{class:z(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Cl,[e("div",null,[e("h4",Sl,N(t.title),1),e("p",$l,N(t.description),1)]),te(r.$slots,"badge")]),e("div",Al,[te(r.$slots,"actions")]),te(r.$slots,"survey"),te(r.$slots,"content")],2))}},Dl={class:"mt-1.5 border-t border pt-1.5"},Tl={key:1},Il={class:"flex items-center justify-between mb-1.5"},Ll={class:"space-y-1.5"},Ol={class:"block label-upper mb-1"},Nl=["onUpdate:modelValue","placeholder"],ql=["onUpdate:modelValue"],Ml=["value"],Rl={key:2,class:"space-y-0.5"},Fl=["onUpdate:modelValue","value"],Ae={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=I(!1),i=I({});Ce(()=>s.questions,a=>{const u={};a.forEach(m=>{u[m.key]=""}),i.value=u},{immediate:!0});const p=()=>{l("survey-completed",{...i.value}),c()},d=()=>{l("survey-refused"),c()},v=()=>{l("not-responding"),c()},c=()=>{o.value=!1;const a={};s.questions.forEach(u=>{a[u.key]=""}),i.value=a};return(a,u)=>(y(),k("div",Dl,[o.value?(y(),k("div",Tl,[e("div",Il,[u[4]||(u[4]=e("h5",{class:"text-xs font-semibold text-body"},"Survey / Feedback",-1)),e("button",{onClick:u[1]||(u[1]=m=>o.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-chevron-up text-xs"},null,-1)])])]),e("div",Ll,[(y(!0),k(de,null,pe(t.questions,(m,h)=>(y(),k("div",{key:h,class:"bg-surfaceSecondary rounded-md p-1.5"},[e("label",Ol,N(m.label),1),m.type==="text"?Q((y(),k("textarea",{key:0,"onUpdate:modelValue":C=>i.value[m.key]=C,placeholder:m.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Nl)),[[ie,i.value[m.key]]]):m.type==="select"?Q((y(),k("select",{key:1,"onUpdate:modelValue":C=>i.value[m.key]=C,class:"input text-xs py-1 px-2"},[u[5]||(u[5]=e("option",{value:""},"Select an option...",-1)),(y(!0),k(de,null,pe(m.options,C=>(y(),k("option",{key:C,value:C},N(C),9,Ml))),128))],8,ql)),[[he,i.value[m.key]]]):m.type==="radio"?(y(),k("div",Rl,[(y(!0),k(de,null,pe(m.options,C=>(y(),k("label",{key:C,class:"flex items-center text-xs"},[Q(e("input",{type:"radio","onUpdate:modelValue":O=>i.value[m.key]=O,value:C,class:"mr-1"},null,8,Fl),[[et,i.value[m.key]]]),j(" "+N(C),1)]))),128))])):L("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:v,class:"bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(y(),k("button",{key:0,onClick:u[0]||(u[0]=m=>o.value=!0),class:"w-full flex items-center justify-between text-xs text-sub hover:text-body py-0.5 transition-colors"},[...u[2]||(u[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1)])]))]))}},Vl={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],i=D(()=>{if(!s.opportunity.createdAt)return 0;const u=new Date(s.opportunity.createdAt),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{l("create-offer",s.opportunity)},d=()=>{l("review",s.opportunity)},v=u=>{l("survey-completed",{opportunity:s.opportunity,responses:u})},c=()=>{l("survey-refused",{opportunity:s.opportunity})},a=()=>{l("not-responding",{opportunity:s.opportunity})};return(u,m)=>(y(),W($e,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${i.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:v,onSurveyRefused:c,onNotResponding:a})]),_:1},8,["description"]))}},Bl={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],i=D(()=>{if(!s.opportunity.createdAt)return 0;const a=new Date(s.opportunity.createdAt),m=Math.abs(new Date-a);return Math.ceil(m/(1e3*60*60*24))}),p=()=>{l("create-offer",s.opportunity)},d=a=>{l("survey-completed",{opportunity:s.opportunity,responses:a})},v=()=>{l("survey-refused",{opportunity:s.opportunity})},c=()=>{l("not-responding",{opportunity:s.opportunity})};return(a,u)=>(y(),W($e,{title:"Unsold Feedback",description:`This opportunity has been open for ${i.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:d,onSurveyRefused:v,onNotResponding:c})]),_:1},8,["description"]))}},Ul={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],i=()=>{l("schedule-closing",s.opportunity)},p=c=>{l("survey-completed",{opportunity:s.opportunity,responses:c})},d=()=>{l("survey-refused",{opportunity:s.opportunity})},v=()=>{l("not-responding",{opportunity:s.opportunity})};return(c,a)=>(y(),W($e,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:$(()=>[e("button",{onClick:i,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:p,onSurveyRefused:d,onNotResponding:v})]),_:1}))}},Wl={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],i=D(()=>{const a=s.opportunity.lastActivity||s.opportunity.createdAt;if(!a)return 0;const u=new Date(a),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{l("create-contract",s.opportunity)},d=a=>{l("survey-completed",{opportunity:s.opportunity,responses:a})},v=()=>{l("survey-refused",{opportunity:s.opportunity})},c=()=>{l("not-responding",{opportunity:s.opportunity})};return(a,u)=>(y(),W($e,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${i.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:d,onSurveyRefused:v,onNotResponding:c})]),_:1},8,["description"]))}},jl={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],i=D(()=>{var C;if(!((C=s.opportunity)!=null&&C.contractDate))return 0;const u=new Date(s.opportunity.contractDate),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{l("prepare-delivery",s.opportunity)},d=()=>{l("pre-delivery-checklist",s.opportunity)},v=u=>{l("survey-completed",{opportunity:s.opportunity,responses:u})},c=()=>{l("survey-refused",{opportunity:s.opportunity})},a=()=>{l("not-responding",{opportunity:s.opportunity})};return(u,m)=>(y(),W($e,{title:"Contract Feedback",description:`Contract was signed ${i.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:d,class:"bg-surface border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:v,onSurveyRefused:c,onNotResponding:a})]),_:1},8,["description"]))}},El={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r,o=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],i=D(()=>{const a=s.activities.find(C=>{var O;return C.type==="delivery"||((O=C.action)==null?void 0:O.toLowerCase().includes("delivered"))});if(!a||!a.timestamp)return 0;const u=new Date(a.timestamp),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{l("delivery-feedback",s.opportunity)},d=a=>{l("survey-completed",{opportunity:s.opportunity,responses:a})},v=()=>{l("survey-refused",{opportunity:s.opportunity})},c=()=>{l("not-responding",{opportunity:s.opportunity})};return(a,u)=>(y(),W($e,{title:"Delivery Feedback",description:`Vehicle was delivered ${i.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:d,onSurveyRefused:v,onNotResponding:c})]),_:1},8,["description"]))}},zl={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:r}){const s=t,l=r,o=D(()=>{var C;return((C=s.scheduledAppointment)==null?void 0:C.noShowCount)||0}),i=D(()=>{const C=o.value;return C===0?"No-Show Follow-up":C>=3?`No-Show #${C} - Final Warning`:`No-Show #${C} Follow-up`}),p=D(()=>{const C=o.value;return C>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":C>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),d=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],v=D(()=>{var O;return(O=s.scheduledAppointment)!=null&&O.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),c=()=>{l("contact-customer",s.opportunity)},a=()=>{const C=o.value;if(C>=3)l("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${C} no-shows`});else if(C===1||C===2){const O=new Date;O.setDate(O.getDate()+2),l("set-callback",{opportunity:s.opportunity,callbackDate:O.toISOString()})}else l("reschedule",s.opportunity)},u=C=>{l("survey-completed",{opportunity:s.opportunity,responses:C})},m=()=>{l("survey-refused",{opportunity:s.opportunity})},h=()=>{l("not-responding",{opportunity:s.opportunity})};return(C,O)=>(y(),W($e,{title:i.value,description:`Appointment was scheduled for ${v.value} but customer did not show up. ${p.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:$(()=>[e("button",{onClick:a,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...O[0]||(O[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),j(" Book Another Appointment ",-1)])]),e("button",{onClick:c,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...O[1]||(O[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),j(" Contact Customer ",-1)])])]),survey:$(()=>[S(Ae,{questions:d,onSurveyCompleted:u,onSurveyRefused:m,onNotResponding:h})]),_:1},8,["title","description"]))}},Hl={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,l=r;De();const o=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],i=D(()=>{const m=s.opportunity.lastActivity||s.opportunity.createdAt;if(!m)return 0;const h=new Date(m),O=Math.abs(new Date-h);return Math.ceil(O/(1e3*60*60*24))}),p=()=>{l("reopen",s.opportunity)},d=()=>{l("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},v=()=>{l("requalify",s.opportunity)},c=m=>{l("survey-completed",{opportunity:s.opportunity,responses:m})},a=()=>{l("survey-refused",{opportunity:s.opportunity})},u=()=>{l("not-responding",{opportunity:s.opportunity})};return(m,h)=>(y(),W($e,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${i.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:$(()=>[e("button",{onClick:p,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...h[0]||(h[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),j(" Reopen Opportunity ",-1)])]),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...h[1]||(h[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),j(" Close as Lost ",-1)])]),e("button",{onClick:v,class:"bg-surface hover:bg-surfaceSecondary border border text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...h[2]||(h[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),j(" Requalify as Lead ",-1)])])]),survey:$(()=>[S(Ae,{questions:o,onSurveyCompleted:c,onSurveyRefused:a,onNotResponding:u})]),_:1},8,["description"]))}},Pl={OOFB:Vl,UFB:Bl,NFU:Ul,OFB:Wl,CFB:jl,DFB:El,NS:zl,ABANDONED:Hl};function Ql(t,r,s,l,o){const i=D(()=>{const m=He(t),h=He(r),C=He(s);return{opportunity:m,scheduledAppointment:h,activities:C,hasOffers:(C==null?void 0:C.some(O=>O.type==="offer"))||!1,stage:m.displayStage||m.stage,deliverySubstatus:m.deliverySubstatus||null,formatDateTime:o,hasActiveTaskWidget:!1}}),p=D(()=>{const m=i.value,h=jt(m.stage,m);if(!h)return null;const C=Pl[h];return C?{type:h,component:C,props:{opportunity:m.opportunity,appointment:m.scheduledAppointment,activities:m.activities}}:(console.warn(`No component found for widget type: ${h}`),null)}),d=D(()=>({...i.value,hasActiveTaskWidget:!!p.value})),v=D(()=>{const m=d.value,h=Et(m.stage,m);if(!h)return null;const C=l[h.key];return{...h,handler:C||(()=>console.warn(`No handler for action: ${h.key}`))}}),c=D(()=>{const m=d.value;return zt(m.stage,m).map(C=>{const O=l[C.key];return{...C,handler:O||(()=>console.warn(`No handler for action: ${C.key}`))}})}),a=D(()=>{const m=i.value;return Ht(m.stage)}),u=D(()=>!p.value||!p.value.type?"":Pt(p.value.type));return{primaryAction:v,secondaryActions:c,activeTaskWidget:p,taskWidgetTitle:u,isClosed:a}}const Yl={class:"relative"},Kl=["disabled"],Gl={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-[9999]"},Jl={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:r}){const s=t,l=r,o=I(!1),i=()=>{o.value=!o.value},p=()=>{o.value=!1},d=c=>{c.disabled||(p(),l("action-selected",c),c.handler&&typeof c.handler=="function"&&c.handler())},v=D(()=>(s.actions||[]).map(c=>({key:c.key,label:c.label,disabled:!!c.disabled,onClick:()=>d(c)})));return(c,a)=>{const u=nt("click-outside");return Q((y(),k("div",Yl,[e("button",{onClick:i,class:"w-auto bg-surface hover:bg-surfaceSecondary border border text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[a[0]||(a[0]=e("span",null,"More actions",-1)),e("i",{class:z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":o.value}])},null,2)],8,Kl),S(ct,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:$(()=>[o.value?(y(),k("div",Gl,[S(n(ot),{items:v.value,className:"min-w-full"},null,8,["items"])])):L("",!0)]),_:1})])),[[u,p]])}}},Xl={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},Zl=["src","alt"],_l={key:1,class:"w-full h-full flex items-center justify-center"},ea={class:"flex items-center justify-between mb-1.5"},ta={class:"text-sm font-bold text-heading"},sa={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},na={class:"text-xs text-sub mb-1.5"},oa={key:0,class:"text-xs text-green-600 font-medium mb-2"},la={key:1,class:"text-xs text-orange-600 font-medium mb-2"},ut={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const r=t,s=D(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[r.badge]||"gray"),l=o=>o?o.toLocaleString("en-US"):"0";return(o,i)=>(y(),k("div",{onClick:i[1]||(i[1]=p=>o.$emit("select")),class:z(["border border rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",Xl,[t.vehicle.image?(y(),k("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Zl)):(y(),k("div",_l,[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",ea,[S(n(Pe),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",ta,"â‚¬"+N(l(t.vehicle.price)),1)]),e("h4",sa,N(t.vehicle.brand)+" "+N(t.vehicle.model),1),e("p",na,N(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(y(),k("div",oa,[i[3]||(i[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),j(" In stock ("+N(t.stockDays)+" days) ",1)])):(y(),k("div",la,[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),j(" Out of stock ",-1)])])),e("button",{onClick:i[0]||(i[0]=Ye(p=>o.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},aa={class:"space-y-6"},ia={key:0},ra={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},da={class:"mb-4"},ua={class:"relative"},ca={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},pa={key:1,class:"text-center py-8 text-sub"},ma={class:"border border rounded-lg p-4 bg-surfaceSecondary"},fa={key:0,class:"mt-4 space-y-3"},ya={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},ga={class:"flex justify-end"},va=["disabled"],ba={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:r}){const s=t,l=r,o=g=>{g||l("close")},i=I(""),p=I(!1),d=I(null),v=I(null),c=I(null),a=I([]),u=I({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Ke(async()=>{try{const g=await vt({});a.value=g.data||[]}catch(g){console.error("Failed to load vehicles:",g),a.value=[]}});const m=D(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),h=D(()=>{const g=[];if(s.requestedVehicle&&m.value&&g.push({...s.requestedVehicle,isRequested:!0}),a.value&&a.value.length>0){const f=a.value.filter(V=>s.requestedVehicle?V.brand!==s.requestedVehicle.brand||V.model!==s.requestedVehicle.model:!0),A=s.requestedVehicle&&m.value?3:4;g.push(...f.slice(0,A))}return g}),C=D(()=>{if(!a.value||a.value.length===0)return[];let g=[...a.value];if(i.value){const f=i.value.toLowerCase();g=g.filter(A=>A.brand.toLowerCase().includes(f)||A.model.toLowerCase().includes(f)||A.year.toString().includes(f))}return g}),O=D(()=>u.value.brand&&u.value.model&&u.value.year&&u.value.price>0),M=(g,f)=>{d.value=g,v.value=g.id||`custom-${Date.now()}`,c.value=f},w=()=>{if(!O.value)return;const g={...u.value,id:`custom-${Date.now()}`,isCustom:!0};M(g,"custom")},x=()=>{d.value&&(l("vehicle-selected",{vehicle:d.value,type:c.value}),l("close"),d.value=null,v.value=null,c.value=null,i.value="",p.value=!1,u.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(g,f)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":o},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-6xl"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...f[7]||(f[7]=[j("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",aa,[h.value.length?(y(),k("div",ia,[f[8]||(f[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),j(" Recommended Vehicles ")],-1)),e("div",ra,[(y(!0),k(de,null,pe(h.value,A=>(y(),W(ut,{key:A.id,vehicle:A,badge:A.isRequested?"Requested":"Recommended","stock-days":A.stockDays,selected:v.value===A.id,onSelect:V=>M(A,A.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):L("",!0),e("div",null,[f[11]||(f[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),j(" Browse Stock ")],-1)),e("div",da,[e("div",ua,[f[9]||(f[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),Q(e("input",{"onUpdate:modelValue":f[0]||(f[0]=A=>i.value=A),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ie,i.value]])])]),C.value.length?(y(),k("div",ca,[(y(!0),k(de,null,pe(C.value,A=>(y(),W(ut,{key:A.id,vehicle:A,badge:"In Stock","stock-days":A.stockDays,selected:v.value===A.id,onSelect:V=>M(A,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(y(),k("div",pa,[...f[10]||(f[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[f[19]||(f[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),j(" Configure Custom Vehicle ")],-1)),e("div",ma,[f[18]||(f[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:f[1]||(f[1]=A=>p.value=!p.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[f[12]||(f[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),j(" "+N(p.value?"Hide Configuration":"Build Custom Configuration"),1)]),p.value?(y(),k("div",fa,[e("div",ya,[e("div",null,[f[13]||(f[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),Q(e("input",{"onUpdate:modelValue":f[2]||(f[2]=A=>u.value.brand=A),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ie,u.value.brand]])]),e("div",null,[f[14]||(f[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),Q(e("input",{"onUpdate:modelValue":f[3]||(f[3]=A=>u.value.model=A),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ie,u.value.model]])]),e("div",null,[f[15]||(f[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),Q(e("input",{"onUpdate:modelValue":f[4]||(f[4]=A=>u.value.year=A),type:"number",class:"input",placeholder:"2024"},null,512),[[ie,u.value.year]])]),e("div",null,[f[16]||(f[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (â‚¬)",-1)),Q(e("input",{"onUpdate:modelValue":f[5]||(f[5]=A=>u.value.price=A),type:"number",class:"input",placeholder:"98000"},null,512),[[ie,u.value.price]])])]),e("div",ga,[e("button",{onClick:w,disabled:!O.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...f[17]||(f[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),j(" Use Custom Configuration ",-1)])],8,va)])])):L("",!0)])])]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f[6]||(f[6]=A=>g.$emit("close"))}),d.value?(y(),W(n(P),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:x})):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ha={class:"space-y-4"},xa=["max"],wa={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,l=r,o=I(""),i=I(""),p=I(""),d=D(()=>new Date().toISOString().split("T")[0]);Ce(()=>s.show,u=>{if(u){const m=new Date;o.value=m.toISOString().split("T")[0],i.value=m.toTimeString().slice(0,5),p.value=""}});const v=()=>{if(!o.value)return;const u=i.value?`${o.value}T${i.value}:00`:`${o.value}T12:00:00`;l("confirm",{contractDate:u,notes:p.value})},c=()=>{l("cancel")},a=u=>{u||c()};return(u,m)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":a},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...m[3]||(m[3]=[j("Set Contract Signing Date",-1)])]),_:1}),S(n(ze),null,{default:$(()=>[...m[4]||(m[4]=[j("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",ha,[e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=h=>o.value=h),max:d.value,class:"input"},null,8,xa),[[ie,o.value]])]),e("div",null,[m[6]||(m[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=h=>i.value=h),class:"input"},null,512),[[ie,i.value]])]),e("div",null,[m[7]||(m[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),Q(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=h=>p.value=h),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ie,p.value]])])]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c}),S(n(P),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!o.value,onClick:v},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ka={class:"space-y-4"},Ca=["max"],Sa={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,l=r,o=I(""),i=I(""),p=I(""),d=I(""),v=D(()=>new Date().toISOString().split("T")[0]);Ce(()=>s.show,m=>{if(m){const h=new Date;o.value=h.toISOString().split("T")[0],i.value=h.toTimeString().slice(0,5),p.value="",d.value=""}});const c=()=>{if(!o.value||!p.value)return;const m=i.value?`${o.value}T${i.value}:00`:`${o.value}T12:00:00`;l("confirm",{deliveryDate:m,location:p.value,notes:d.value})},a=()=>{l("cancel")},u=m=>{m||a()};return(m,h)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":u},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...h[4]||(h[4]=[j("Mark as Delivered",-1)])]),_:1}),S(n(ze),null,{default:$(()=>[...h[5]||(h[5]=[j("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",ka,[e("div",null,[h[6]||(h[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":h[0]||(h[0]=C=>o.value=C),max:v.value,class:"input"},null,8,Ca),[[ie,o.value]])]),e("div",null,[h[7]||(h[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":h[1]||(h[1]=C=>i.value=C),class:"input"},null,512),[[ie,i.value]])]),e("div",null,[h[9]||(h[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),Q(e("select",{"onUpdate:modelValue":h[2]||(h[2]=C=>p.value=C),class:"input"},[...h[8]||(h[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[he,p.value]])]),e("div",null,[h[10]||(h[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":h[3]||(h[3]=C=>d.value=C),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ie,d.value]])])]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a}),S(n(P),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!o.value||!p.value,onClick:c},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$a={class:"space-y-4"},Aa={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,l=r,o=I(""),i=I("");Ce(()=>s.show,c=>{c&&(o.value="",i.value="")});const p=()=>{o.value&&l("confirm",{reason:o.value,notes:i.value})},d=()=>{l("cancel")},v=c=>{c||d()};return(c,a)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":v},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...a[2]||(a[2]=[j("Close as Lost",-1)])]),_:1}),S(n(ze),null,{default:$(()=>[...a[3]||(a[3]=[j("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",$a,[e("div",null,[a[5]||(a[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),Q(e("select",{"onUpdate:modelValue":a[0]||(a[0]=u=>o.value=u),class:"input"},[...a[4]||(a[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[he,o.value]])]),e("div",null,[a[6]||(a[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=u=>i.value=u),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ie,i.value]])])]),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),S(n(P),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!o.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Da={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=r,l=o=>{o||s("cancel")};return(o,i)=>(y(),W(n(Me),{open:t.show,"onUpdate:open":l},{default:$(()=>[S(n(Te),null,{default:$(()=>[S(n(Ie),{class:"fixed inset-0 z-50 bg-black/50"}),S(n(Le),{class:"w-full sm:max-w-lg"},{default:$(()=>[S(n(Oe),null,{default:$(()=>[S(n(Ne),null,{default:$(()=>[...i[2]||(i[2]=[j("Requalify as Lead",-1)])]),_:1}),S(n(ze),null,{default:$(()=>[...i[3]||(i[3]=[j("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),i[4]||(i[4]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),j(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),j(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),j(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),S(n(qe),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:$(()=>[S(n(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[0]||(i[0]=p=>o.$emit("cancel"))}),S(n(P),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:i[1]||(i[1]=p=>o.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ta={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},Ia={class:"flex gap-3"},La={key:0,class:"space-y-3"},Oa={class:"flex items-center gap-2 pb-2 border-b border"},Na={class:"font-semibold text-heading text-sm"},qa={key:0,class:"flex justify-end"},Ma={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:r}){const s=t,l=r,o=lt(),i=Ge(),p=I(!1),d=I(!1),v=I(!1),c=I(!1),a=I(!1),u=I(!1),m=I(!1),h=I(!1),C=I(!1),O=I(!1),M=I([]),w=D(()=>{var U,F;return((U=s.opportunity)==null?void 0:U.displayStage)||((F=s.opportunity)==null?void 0:F.stage)||"Qualified"});D(()=>pt(w.value,"opportunity"));function x(U){return U?new Date(U).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const g={"schedule-appointment":()=>{p.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?C.value=!0:p.value=!0},"select-vehicle":()=>{m.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?m.value=!0:d.value=!0},"call-prospect":()=>{h.value=!0},"follow-up-offer":()=>{h.value=!0},"request-decision":()=>{h.value=!0},"finalize-contract":()=>{c.value=!0},"schedule-delivery":()=>{a.value=!0},"confirm-delivery":()=>{a.value=!0},"collect-feedback":()=>{h.value=!0},reschedule:()=>{O.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&xe()},"close-won":()=>{c.value=!0},"add-offer":()=>{d.value=!0},"add-contract":()=>{c.value=!0},"extend-deadline":()=>{h.value=!0},"close-lost":()=>{v.value=!0},reopen:()=>{ae()},requalify:()=>{u.value=!0}},{primaryAction:f,secondaryActions:A,activeTaskWidget:V,taskWidgetTitle:H,isClosed:X}=Ql(Be(s,"opportunity"),Be(s,"scheduledAppointment"),Be(s,"activities"),g,x);function se(U){}function le(){}function ge(U){m.value=!1,l("vehicle-selected",U),setTimeout(()=>{d.value=!0},300)}function Y(U){d.value=!1,l("offer-created",U)}function me(U){p.value=!1,l("appointment-scheduled",{...U,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function xe(){s.scheduledAppointment&&l("appointment-cancelled",s.scheduledAppointment.id)}function we(U){c.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:U.contractDate})}function Z(U){a.value=!1,i.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:U})}function _(U){v.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:U})}function ae(){i.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function fe(U){u.value=!1,o.push(`/customer/${U.id}?type=lead`)}function ve(U){C.value=!1}function be(U){O.value=!1}function ue(U){i.updateOpportunity(s.opportunity.id,{callbackDate:U.callbackDate})}function ne(U){i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:U.reason||"Multiple no-shows (NS3)"})}return Ke(async()=>{try{const F=(await vt({})).data||[];M.value=F.filter(K=>K.stockDays!==null&&K.stockDays!==void 0).slice(0,5)}catch(U){console.error("Failed to load recommended cars:",U),M.value=[]}}),(U,F)=>(y(),k(de,null,[S(Ct,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":$(()=>[n(X)&&!n(V)?(y(),k("div",Ta,[F[15]||(F[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-heading text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Ia,[S(n(P),{variant:"primary",size:"small",onClick:ae,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700"},{default:$(()=>[...F[13]||(F[13]=[e("span",null,"Reopen",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}),S(n(P),{variant:"outline",size:"small",onClick:F[0]||(F[0]=K=>u.value=!0),class:"flex items-center gap-2 bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300"},{default:$(()=>[...F[14]||(F[14]=[e("span",null,"Requalify as Lead",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])]),_:1})])])):L("",!0)]),"primary-action":$(()=>[!n(X)&&n(f)?(y(),W(St,{key:0,action:n(f),"color-scheme":n(f).colorScheme,onActionClicked:F[1]||(F[1]=K=>n(f).handler())},null,8,["action","color-scheme"])):L("",!0)]),"task-widgets":$(()=>[n(V)&&n(V).component?(y(),k("div",La,[e("div",Oa,[F[16]||(F[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Na,N(n(H)),1)]),(y(),W(Rt(n(V).component),Ft(n(V).props,{onClose:le,onSetCallback:ue,onAutoCloseLost:ne}),null,16))])):L("",!0)]),"secondary-actions":$(()=>[n(A).length>0?(y(),k("div",qa,[S(Jl,{actions:n(A),onActionSelected:se},null,8,["actions"])])):L("",!0)]),_:1},8,["task"]),p.value?(y(),W(Kt,{key:0,show:p.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:me,onCancel:F[2]||(F[2]=K=>p.value=!1)},null,8,["show","customer","assignee"])):L("",!0),m.value?(y(),W(ba,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":M.value,onVehicleSelected:ge,onClose:F[3]||(F[3]=K=>m.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):L("",!0),d.value?(y(),W(Qt,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:Y,onClose:F[4]||(F[4]=K=>d.value=!1)},null,8,["opportunity","vehicle"])):L("",!0),c.value?(y(),W(wa,{key:3,opportunity:t.opportunity,onContractSet:we,onClose:F[5]||(F[5]=K=>c.value=!1)},null,8,["opportunity"])):L("",!0),a.value?(y(),W(Sa,{key:4,opportunity:t.opportunity,onDelivered:Z,onClose:F[6]||(F[6]=K=>a.value=!1)},null,8,["opportunity"])):L("",!0),v.value?(y(),W(Aa,{key:5,opportunity:t.opportunity,onClosed:_,onClose:F[7]||(F[7]=K=>v.value=!1)},null,8,["opportunity"])):L("",!0),u.value?(y(),W(Da,{key:6,opportunity:t.opportunity,onRequalified:fe,onClose:F[8]||(F[8]=K=>u.value=!1)},null,8,["opportunity"])):L("",!0),h.value?(y(),W(Yt,{key:7,onClose:F[9]||(F[9]=K=>h.value=!1)})):L("",!0),C.value&&t.scheduledAppointment?(y(),W(Gt,{key:8,show:C.value,event:t.scheduledAppointment,onClose:F[10]||(F[10]=K=>C.value=!1),onEdit:F[11]||(F[11]=K=>{C.value=!1,O.value=!0}),onDelete:ve},null,8,["show","event"])):L("",!0),O.value&&t.scheduledAppointment?(y(),W(Jt,{key:9,show:O.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:be,onCancel:F[12]||(F[12]=K=>O.value=!1)},null,8,["show","event","customer"])):L("",!0)],64))}};function Ra(t){const r=Ee(),s=Ge(),l=D(()=>t.value?t.value.type==="lead"?kl:Ma:null),o=D(()=>t.value?t.value.type==="lead"?{currentActivities:D(()=>r.currentLeadActivities),addActivity:(p,d)=>r.addActivity(p,d),updateActivity:(p,d,v)=>r.updateActivity(p,d,v),deleteActivity:(p,d)=>r.deleteActivity(p,d),updateLead:(p,d)=>r.updateLead(p,d),loadLeadById:p=>r.fetchLeadById(p)}:{currentActivities:D(()=>s.currentOpportunityActivities),addActivity:(p,d)=>s.addActivity(p,d),updateActivity:(p,d,v)=>s.updateActivity(p,d,v),deleteActivity:(p,d)=>s.deleteActivity(p,d),addVehicle:(p,d)=>s.addVehicle(p,d),createOffer:(p,d)=>s.createOffer(p,d),updateOpportunity:(p,d)=>s.updateOpportunity(p,d),loadOpportunityById:p=>s.fetchOpportunityById(p)}:null),i=D(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:l,storeAdapter:o,addNewConfig:i}}function Fa(){const t=a=>{if(!a)return"No deadline";const u=mt(a);return u.type==="overdue"?"OVERDUE":u.type==="today"||u.type==="urgent"?u.relativeTime:ft(a)},r=a=>{const u=a.type==="lead"?a.requestedCar:a.vehicle;return!u||!u.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[u.type]||{type:u.type.toLowerCase(),label:u.type}},s=a=>a?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[a.type]||"bg-gray-50 text-gray-700":"",l=a=>{if(!a||!a.assignee)return{name:"Unassigned",initials:"?"};const u=a.assigneeInitials||a.assignee.split(" ").map(m=>m[0]).join("");return{name:a.assignee,initials:u}},o=a=>{if(!a||!a.customer||!a.customer.address)return null;const m=a.customer.address.split(",");return m.length>1&&m[m.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:r,getVehicleTypeBadgeClass:s,getOwnerInfo:l,getCustomerCity:o,getLocationDisplay:a=>{const u=o(a),m=a.source||"Unknown";return u?`${u} â€¢ ${m}`:m},getAssigneeInitials:a=>{if(!a)return"?";const u=a.split(" ");return u.length>=2?(u[0][0]+u[u.length-1][0]).toUpperCase():a.substring(0,2).toUpperCase()},getVehicleStatusDisplay:a=>{const u=a.type==="lead"?a.requestedCar:a.vehicle;if(!u)return"No vehicle";const m=r(a),h=m?m.label:u.type||"Unknown";let C="";return u.kilometers!==void 0&&u.kilometers!==null&&(u.kilometers>=1e3?C=`${(u.kilometers/1e3).toFixed(0)}k`:C=`${u.kilometers}`),C?`${h} / ${C}`:h},getTaskStatusDisplay:a=>a.type==="lead"?a.status||"Unknown":a.stage||"Unknown",getStageBadgeClass:gt,getUnselectedClass:a=>a.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Va(t){const r=Ee(),s=Ge(),l=We(),o=D(()=>{const v=(t.value?r.leads:r.leads.filter(u=>!u.isDisqualified)).map(u=>{const m=Se(u,"lead"),h={...u,type:"lead",compositeId:`lead-${u.id}`,displayStage:m};return!h.customer&&u.customer&&(h.customer=u.customer),h}),c=s.opportunities.map(u=>{const m={...u,type:"opportunity",compositeId:`opportunity-${u.id}`};return!m.customer&&u.customer&&(m.customer=u.customer),m});let a=[];return l.isOperator()?a=v:l.isSalesman()?a=c:a=[...v,...c],a}),i=(d,v)=>v==="all"?d:d.filter(c=>c.type===v),p=D(()=>{const d=o.value.some(c=>c.type==="lead"),v=o.value.some(c=>c.type==="opportunity");return d&&v});return{allTasks:o,filterByType:i,shouldShowTypeFilter:p}}function Ba(){const t=We(),r=Je(),s=De();return{sortTasks:(o,i)=>{if(i==="none")return[...o].sort((p,d)=>{const v=new Date(p.lastActivity||p.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-v});if(i==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...o.map(v=>{if(v.type==="lead"&&!v.urgencyScore){const c=ht(v);return{...v,urgencyScore:c.score,urgencyLevel:c.level}}return v})].sort((v,c)=>{if(v.type==="lead"&&c.type==="lead"){const m=v.urgencyScore||0,h=c.urgencyScore||0;if(m!==h)return h-m;const C=new Date(v.createdAt||0);return new Date(c.createdAt||0)-C}if(v.type==="lead"&&c.type==="opportunity")return-1;if(v.type==="opportunity"&&c.type==="lead")return 1;if(v.priority==="Hot"&&c.priority!=="Hot")return-1;if(v.priority!=="Hot"&&c.priority==="Hot")return 1;const a=new Date(v.lastActivity||v.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-a}):[...o].sort((d,v)=>{if(d.priority==="Hot"&&v.priority!=="Hot")return-1;if(d.priority!=="Hot"&&v.priority==="Hot")return 1;const c=new Date(d.lastActivity||d.createdAt||0);return new Date(v.lastActivity||v.createdAt||0)-c});if(i==="assigned-to-me"){const p=t.currentUser.name;return[...o.filter(v=>v.assignee===p)].sort((v,c)=>{const a=new Date(v.lastActivity||v.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-a})}if(i==="assigned-to-my-team"){const p=t.currentUser;let d=[];return p.role==="manager"?d=r.users.map(c=>c.name):p.role==="salesman"?d=r.users.filter(c=>c.role==="salesman").map(c=>c.name):p.role==="operator"&&(d=r.users.filter(c=>c.role==="operator").map(c=>c.name)),[...o.filter(c=>d.includes(c.assignee))].sort((c,a)=>{const u=new Date(c.lastActivity||c.createdAt||0);return new Date(a.lastActivity||a.createdAt||0)-u})}return o}}}const Ua={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Wa={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},ja={key:0,class:"flex items-center gap-2"},Ea={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-[6px] shrink-0"},za={class:"text-gray-600 font-medium"},Ha={key:1},Pa={key:0},Qa={key:1},Ya={key:2},Ka={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Ga={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Ja={__name:"Tasks",setup(t){const r=Vt(),s=lt(),l=Ee(),o=Ge();We(),Je();const i=De(),{getDateDisplay:p,getVehicleType:d,getVehicleTypeBadgeClass:v,getOwnerInfo:c,getCustomerCity:a,getAssigneeInitials:u,getUnselectedClass:m}=Fa(),h=I(localStorage.getItem("tasksViewMode")||"table"),C=I(""),O=D(()=>r.query.highlight||null);Ce(h,T=>{localStorage.setItem("tasksViewMode",T)});const M=(T,B="")=>{h.value;const ee=Y.value;if(h.value=T,T==="card"&&B&&(C.value=B),T==="table"&&ee)C.value="",s.push({path:"/tasks",query:{highlight:ee.compositeId}});else if(T==="card"&&O.value){const[re,q]=O.value.split("-");s.push({path:`/tasks/${q}`,query:{type:re}})}else T==="card"&&!O.value&&!Y.value&&s.push({path:"/tasks"})},w=I("all"),x=I("none"),g=I(!1),f=I(null);I(!1);const A=I(!1),V=I(null),{allTasks:H,filterByType:X,shouldShowTypeFilter:se}=Va(g),{sortTasks:le}=Ba(),ge=D(()=>{let T=X(H.value,w.value);return T=le(T,x.value),T}),Y=D(()=>{if(!r.params.id)return null;const T=parseInt(r.params.id);if(isNaN(T))return null;const B=r.query.type;if(B){const G=`${B}-${T}`;return H.value.find(ye=>ye.compositeId===G)||null}const ee=w.value!=="all"?H.value.filter(G=>G.type===w.value):H.value,re=`lead-${T}`,q=`opportunity-${T}`,E=ee.find(G=>G.compositeId===re||G.compositeId===q);return E||H.value.find(G=>G.compositeId===re||G.compositeId===q)||null});D(()=>Y.value?Y.value.type==="lead"?l.currentLeadActivities:o.currentOpportunityActivities:[]);const me=Ra(Y),xe=me.managementWidget,we=me.storeAdapter,Z=me.addNewConfig,_=m;Ke(()=>{l.fetchLeads(),o.fetchOpportunities();const T=r.params.id;T&&ae(T)}),Ce(()=>r.params.id,T=>{T&&ae(T)}),Ce(Y,T=>{T&&(T.type==="lead"?l.fetchLeadById(T.id):o.fetchOpportunityById(T.id))},{immediate:!0});const ae=T=>{const B=parseInt(T),ee=H.value.find(re=>re.id===B);ee&&(ee.type==="lead"?l.fetchLeadById(B):o.fetchOpportunityById(B))},fe=T=>{const[B,ee]=T.split("-");s.push({path:`/tasks/${ee}`,query:{type:B}})},ve=()=>{s.push({path:"/tasks"})},be=T=>{f.value=f.value===T?null:T},ue=T=>{V.value=T,A.value=!0,f.value=null},ne=T=>{x.value=T},U=async T=>{if(!V.value)return;const B=V.value,ee=T.name;B.type==="lead"?await l.updateLead(B.id,{assignee:ee,assigneeType:T.type,teamId:T.type==="team"?T.id:null}):B.type==="opportunity"&&await o.updateOpportunity(B.id,{assignee:ee,assigneeType:T.type,teamId:T.type==="team"?T.id:null}),A.value=!1,V.value=null},F=async T=>{f.value=null,T.type==="lead"?await l.updateLead(T.id,{priority:"Hot"}):T.type==="opportunity"&&await o.updateOpportunity(T.id,{priority:"Hot"})},K=async T=>{f.value=null,T.type==="lead"?await l.updateLead(T.id,{priority:"Normal"}):T.type==="opportunity"&&await o.updateOpportunity(T.id,{priority:"Normal"})},Xe=async T=>{if(f.value=null,T.type==="lead")try{const B=T.displayStage||T.stage||oe.NEW,ee=oe.NEW,re=tt(B,ee);if(re){const{updates:q,activities:E}=re(T);await l.updateLead(T.id,q);for(const G of E)await l.addActivity(T.id,G)}else await l.updateLead(T.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await l.addActivity(T.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await l.fetchLeadById(T.id)}catch(B){console.error("Failed to reopen lead:",B)}},Re=T=>{const B=[];return T.type==="lead"&&T.isDisqualified===!0&&B.push({key:"reopen",label:"Reopen Lead",onClick:()=>Xe(T)}),B.push({key:"reassign",label:"Reassign",onClick:()=>ue(T)}),T.priority!=="Hot"?B.push({key:"mark-hot",label:"Mark as hot",onClick:()=>F(T)}):B.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>K(T)}),B};return(T,B)=>{var ee,re;return y(),k("div",Ua,[S(en,{show:!!Y.value,"back-label":"Back to task list",onBack:ve},null,8,["show"]),h.value==="card"?(y(),k("div",Wa,[e("div",{class:z(["flex flex-col overflow-hidden",Y.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[S(qs,{title:"Tasks",items:ge.value,"selected-id":(ee=Y.value)==null?void 0:ee.compositeId,"type-filter":w.value,"view-mode":h.value,"initial-search-query":C.value,"selected-class":q=>q.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":n(_),"open-menu-id":f.value,getName:q=>{const E=q.customer;return E&&E.name?E.name:E&&!E.name&&E.email&&E.email.split("@")[0]||"Unknown"},getInitials:q=>{const E=q.customer;return E&&E.initials?E.initials:E&&E.name&&E.name.split(" ").map(ye=>ye[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:q=>{if(q.type==="lead"){if(!q.requestedCar)return"No vehicle specified";const ye=q.requestedCar,Fe=[`${ye.brand} ${ye.model}`];return ye.kilometers!==void 0&&ye.kilometers!==null&&Fe.push(`${ye.kilometers} km`),ye.status&&Fe.push(ye.status),Fe.join(" â€¢ ")}const E=q.vehicle||q.requestedCar;if(!E)return"No vehicle specified";const G=[`${E.brand} ${E.model}`];return E.kilometers!==void 0&&E.kilometers!==null&&G.push(`${E.kilometers} km`),E.status&&G.push(E.status),G.join(" â€¢ ")},avatarClass:q=>q.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":Re,"show-mobile-close":!1,onSelect:fe,onMenuClick:be,onMenuClose:B[0]||(B[0]=q=>f.value=null),onClose:ve,"show-type-filter":n(se),onFilterChange:B[1]||(B[1]=q=>w.value=q),onSortChange:ne,onViewChange:M},{badges:$(({item:q})=>[q&&q.type?(y(),W(n(Pe),{key:0,text:q.type==="lead"?"Lead":"Opportunity",size:"small",theme:q.type==="lead"?"blue":"gray"},null,8,["text","theme"])):L("",!0),q&&q.type==="lead"&&n(i).getSetting("urgencyEnabled")!==!1&&q.urgencyLevel?(y(),W(n(Pe),{key:1,text:`${n(xt)(q.urgencyLevel)} ${q.urgencyLevel}`,size:"small",class:z(n(wt)(q.urgencyLevel))},null,8,["text","class"])):L("",!0),q&&q.priority==="Hot"&&(n(i).getSetting("urgencyEnabled")===!1||q.type!=="lead")?(y(),W(n(Pe),{key:2,text:"HOT",size:"small",theme:"red"})):L("",!0)]),location:$(({item:q})=>[j(N(n(a)(q)||"Unknown"),1)]),source:$(({item:q})=>{var E;return[j(N(q.source||((E=q.customer)==null?void 0:E.source)||"Unknown"),1)]}),owner:$(({item:q})=>[q.assignee?(y(),k("div",ja,[e("div",Ea,N(n(u)(q.assignee)),1),e("span",za,N(q.assignee),1)])):(y(),k("span",Ha,"Unassigned"))]),dates:$(({item:q})=>[q.type==="lead"&&q.nextActionDue?(y(),k("span",Pa,"Due: "+N(n(p)(q.nextActionDue)),1)):q.type==="opportunity"&&q.nextActionDue?(y(),k("span",Qa,"Due: "+N(n(p)(q.nextActionDue)),1)):(y(),k("span",Ya,"Due: No deadline"))]),_:1},8,["items","selected-id","type-filter","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),Y.value?(y(),W(rt,{key:0,task:Y.value,"management-widget":n(xe),"store-adapter":n(we),"add-new-config":n(Z)},null,8,["task","management-widget","store-adapter","add-new-config"])):L("",!0),Y.value?L("",!0):(y(),k("div",Ka,[...B[6]||(B[6]=[Qe('<div class="flex-1 flex items-center justify-center p-8" data-v-35c8e5dc><div class="text-center max-w-sm" data-v-35c8e5dc><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center" data-v-35c8e5dc><i class="fa-solid fa-tasks text-2xl text-sub" data-v-35c8e5dc></i></div><h3 class="text-content-bold mb-2" data-v-35c8e5dc>No task selected</h3><p class="text-meta" data-v-35c8e5dc>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):L("",!0),h.value==="table"?(y(),k("div",Ga,[S(Qs,{tasks:ge.value,"current-task-id":(re=Y.value)==null?void 0:re.compositeId,"highlight-id":O.value,"type-filter":w.value,"sort-option":x.value,"show-type-filter":n(se),"show-closed":g.value,"show-mobile-close":!1,"open-menu-id":f.value,"get-vehicle-type":n(d),"get-vehicle-type-badge-class":n(v),"get-owner-info":n(c),"get-stage-badge-class":n(gt),"view-mode":h.value,onSelect:fe,onMenuClick:be,onMenuClose:B[2]||(B[2]=q=>f.value=null),onFilterChange:B[3]||(B[3]=q=>w.value=q),onSortChange:ne,onToggleClosed:B[4]||(B[4]=q=>g.value=q),onReassign:ue,onClose:ve,onViewChange:M,class:z(Y.value?"hidden lg:flex shrink-0":"flex-1 w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode","class"]),Y.value?(y(),W(rt,{key:0,task:Y.value,"management-widget":n(xe),"store-adapter":n(we),"add-new-config":n(Z)},null,8,["task","management-widget","store-adapter","add-new-config"])):L("",!0)])):L("",!0),S(Xt,{show:A.value,onClose:B[5]||(B[5]=q=>A.value=!1),onConfirm:U},null,8,["show"])])}}},di=st(Ja,[["__scopeId","data-v-35c8e5dc"]]);export{di as default};
