import{r as C,c as D,a as d,o as a,b as e,e as v,t as g,A as I,n as O,y as T,z as R,F as J,h as ee,C as te,D as me,k as U,E as ne,j as le,w as oe,f as F,g as Q,l as V,G as yt,H as ft,T as he,I as we,J as je,u as Ce,p as Se,_ as gt,K as Ve,L as vt,M as bt}from"./index-BpJzGUMn.js";import{useOpportunitiesStore as Fe}from"./opportunities-BF2RxsxX.js";import{_ as pe}from"./ModalShell-FsWhITeb.js";import{f as ke,a as $e,b as fe,c as xt}from"./formatters-CNf1MjAs.js";const ht={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},wt={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},kt={class:"flex items-center gap-3"},$t={class:"font-bold text-lg text-gray-800"},Ct={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},St={class:"flex gap-2"},Dt={class:"px-5 py-3"},At={class:"relative"},Tt=["placeholder"],qt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Ot=["onClick"],Nt=["onClick"],It={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Mt={class:"flex items-start gap-3.5 pr-6"},Rt={class:"flex-1 min-w-0"},jt={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Vt={class:"text-gray-600 text-xs mt-1 truncate"},Ft={class:"text-right shrink-0"},Lt={class:"flex items-center gap-2 flex-wrap mt-3"},Ut={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change","close"],setup(t,{emit:h}){const s={mounted(r,i){r.clickOutsideEvent=n=>{r===n.target||r.contains(n.target)||i.value()},document.addEventListener("click",r.clickOutsideEvent)},unmounted(r){document.removeEventListener("click",r.clickOutsideEvent)}},u=t,o=C(""),l=D(()=>{let r=u.items;if(u.typeFilter&&u.typeFilter!=="all"&&(r=r.filter(i=>i.type===u.typeFilter)),o.value){const i=o.value.toLowerCase();r=r.filter(n=>{const p=u.getName(n).toLowerCase(),y=u.getVehicleInfo(n).toLowerCase();return p.includes(i)||y.includes(i)})}return r}),c=r=>{const i=r.compositeId||`${r.type||"task"}-${r.id}`||r.id;return u.selectedId===i};return(r,i)=>(a(),d("div",ht,[e("div",wt,[e("div",kt,[t.showMobileClose?(a(),d("button",{key:0,onClick:i[0]||(i[0]=n=>r.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...i[5]||(i[5]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):v("",!0),e("h2",$t,g(t.title),1)]),i[6]||(i[6]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[I(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(a(),d("div",Ct,[e("div",St,[e("button",{onClick:i[1]||(i[1]=n=>r.$emit("filter-change","all")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:i[2]||(i[2]=n=>r.$emit("filter-change","lead")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:i[3]||(i[3]=n=>r.$emit("filter-change","opportunity")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):v("",!0),e("div",Dt,[e("div",At,[i[7]||(i[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),T(e("input",{"onUpdate:modelValue":i[4]||(i[4]=n=>o.value=n),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Tt),[[R,o.value]])])]),e("div",qt,[(a(!0),d(J,null,ee(l.value,n=>(a(),d("div",{key:n.id,onClick:p=>r.$emit("select",n.compositeId||`${n.type||"task"}-${n.id}`||n.id),class:O(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",c(n)?typeof t.selectedClass=="function"?t.selectedClass(n):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(n):t.unselectedClass])},[t.showMenu?(a(),d("button",{key:0,onClick:te(p=>r.$emit("menu-click",n.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,Nt)):v("",!0),t.openMenuId===n.id&&t.showMenu?T((a(),d("div",It,[me(r.$slots,"menu",{item:n})])),[[s,()=>r.$emit("menu-close")]]):v("",!0),e("div",Mt,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(n)])},g(t.getInitials(n)),3),e("div",Rt,[e("div",jt,g(t.getName(n)),1),e("div",Vt,g(t.getVehicleInfo(n)),1)]),e("div",Ft,[me(r.$slots,"meta",{item:n}),me(r.$slots,"footer",{item:n})])]),e("div",Lt,[me(r.$slots,"badges",{item:n})])],10,Ot))),128))])]))}},Et={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Wt={class:"flex items-center gap-3"},Bt={key:2,class:"font-bold text-lg text-gray-800"},Pt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},zt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Qt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Yt={class:"text-sm"},Ht={key:2,class:"space-y-6 relative z-10"},Jt={key:0,class:"mb-4 pl-12"},Kt={class:"text-sm font-semibold text-gray-800"},Gt={class:"flex gap-4 relative mb-6"},Xt={class:"flex-1 min-w-0"},Zt={class:"text-sm text-slate-700 leading-snug"},_t={class:"font-bold"},es={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},ts={class:"text-xs text-gray-400 mt-1"},Ie={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:h}){const s=t,u=i=>{const n={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return n[i]||n.default},o=i=>{const n={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return n[i]||n.default},l=i=>{if(!i)return"";const n=new Date(i),p=new Date,y=new Date(p);return y.setDate(y.getDate()-1),n.toDateString()===p.toDateString()?"Today":n.toDateString()===y.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},c=i=>i?new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",r=(i,n)=>{if(i===0)return!0;const p=s.activities[i-1];if(!p)return!0;const y=new Date(n.timestamp).toDateString(),f=new Date(p.timestamp).toDateString();return y!==f};return(i,n)=>t.show?(a(),d("div",{key:0,class:O(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Et,[e("div",Wt,[t.mobileFullscreen?(a(),d("button",{key:0,onClick:n[0]||(n[0]=p=>i.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...n[2]||(n[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(a(),d("button",{key:1,onClick:n[1]||(n[1]=p=>i.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:O(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):v("",!0),t.collapsed?v("",!0):(a(),d("h2",Bt,g(t.title),1))])]),t.collapsed?v("",!0):(a(),d("div",Pt,[t.activities.length>0?(a(),d("div",zt)):v("",!0),t.activities.length===0?(a(),d("div",Qt,[n[3]||(n[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Yt,g(t.emptyMessage),1)])):(a(),d("div",Ht,[(a(!0),d(J,null,ee(t.activities,(p,y)=>(a(),d(J,{key:p.id},[r(y,p)?(a(),d("div",Jt,[e("h3",Kt,g(l(p.timestamp)),1)])):v("",!0),e("div",Gt,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",o(p.type)])},[e("i",{class:O([u(p.type),"text-sm"])},null,2)],2),e("div",Xt,[e("div",Zt,[e("span",_t,g(p.user),1),I(" "+g(p.action),1)]),p.content?(a(),d("div",es,g(p.content),1)):v("",!0),e("div",ts,g(c(p.timestamp)),1)])])],64))),128))]))]))],2)):v("",!0)}},ss={class:"w-full"},os={class:"flex items-center justify-between gap-3 md:gap-4"},ls={class:"flex items-center gap-3 md:gap-4 flex-1"},as={class:"min-w-0 flex-1"},ns={class:"heading-main truncate"},is={class:"flex flex-wrap items-center gap-2 mt-1"},rs={class:"flex items-center gap-1 ml-2"},ds={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},us={class:"flex items-center gap-4"},cs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ms={class:"flex items-center gap-2"},ps={class:"text-xs text-gray-900 font-medium"},ys={class:"flex items-center gap-2"},fs={class:"text-xs text-gray-900 font-medium"},gs={class:"flex items-center gap-2"},vs={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},bs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},xs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},hs={class:"text-xs text-gray-900 font-medium"},ws={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ks={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},setup(t){const h=C(!1),s=C(null),u=async(o,l)=>{try{await navigator.clipboard.writeText(o),s.value=l,setTimeout(()=>{s.value=null},1500)}catch(c){console.error("Failed to copy:",c)}};return(o,l)=>(a(),d("div",ss,[e("div",os,[e("div",ls,[e("div",{class:O(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},g(t.initials),3),e("div",as,[e("h1",ns,g(t.name),1),e("div",is,[me(o.$slots,"tags")])])]),e("div",rs,[e("button",{onClick:l[0]||(l[0]=c=>h.value=!h.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:O(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":h.value}])},null,2)])])]),h.value?(a(),d("div",ds,[e("div",us,[e("div",cs,[e("div",ms,[l[4]||(l[4]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ps,g(t.email),1),e("button",{onClick:l[1]||(l[1]=te(c=>u(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...l[3]||(l[3]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ys,[l[6]||(l[6]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",fs,g(t.phone),1),e("button",{onClick:l[2]||(l[2]=te(c=>u(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...l[5]||(l[5]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",gs,[e("div",vs,[t.thirdFieldLabel.toLowerCase().includes("address")?(a(),d("i",bs)):(a(),d("i",xs))]),e("span",hs,g(t.thirdFieldValue),1)])])]),s.value?(a(),d("div",ws,g(s.value==="email"?"Email":"Phone")+" copied! ",1)):v("",!0)])):v("",!0)]))}},$s={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},Cs=["onClick"],Ss={class:"hidden md:inline whitespace-nowrap"},Ds={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const h={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},s=u=>h[u]||"fa-solid fa-circle";return(u,o)=>(a(),d("div",$s,[(a(!0),d(J,null,ee(t.tabs,l=>(a(),d("div",{key:l.key,onClick:c=>u.$emit("update:modelValue",l.key),class:O(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===l.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[e("i",{class:O([s(l.key),"text-base md:text-base"])},null,2),e("span",Ss,g(l.label),1),l.count!==void 0?(a(),d("span",{key:0,class:O(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===l.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},g(l.count),3)):v("",!0)],10,Cs))),128))]))}},As={class:"metadata-bar w-full"},Ts={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},qs={class:"text-xs sm:text-sm font-bold text-gray-800"},Os={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Ns={class:"text-xs sm:text-sm font-bold text-gray-800"},Is={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Ms={class:"text-xs sm:text-sm font-bold text-gray-800"},Rs={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""}},setup(t){return(h,s)=>(a(),d("div",As,[e("div",Ts,[s[0]||(s[0]=e("span",{class:"label-upper text-xs"},"Stage",-1)),e("span",qs,g(t.stage),1)]),s[4]||(s[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Os,[s[1]||(s[1]=e("span",{class:"label-upper text-xs"},"Owner",-1)),e("span",Ns,g(t.owner),1)]),t.source?(a(),d(J,{key:0},[s[3]||(s[3]=e("div",{class:"metadata-divider"},null,-1)),e("div",Is,[s[2]||(s[2]=e("span",{class:"label-upper text-xs"},"Source",-1)),e("span",Ms,g(t.source),1)])],64)):v("",!0)]))}},js={key:0,class:"flex-grow border-t border-gray-200"},Vs={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Fs={key:0,class:"border-t border-gray-100 my-1"},Ls={key:1,class:"flex-grow border-t border-gray-200"},Me={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:h}){const s={mounted(b,m){b.clickOutsideEvent=$=>{b===$.target||b.contains($.target)||m.value()},document.addEventListener("click",b.clickOutsideEvent)},unmounted(b){document.removeEventListener("click",b.clickOutsideEvent)}},u=t,o=h,l=C(!1),c=D(()=>u.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 md:px-4 py-2 md:py-2 text-xs md:text-sm rounded-lg shadow-sm transition-all flex items-center justify-center gap-1.5 md:gap-2 z-20 relative whitespace-nowrap":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),r={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},i=D(()=>{if(!u.activeTab||u.activeTab==="overview")return u.actions.filter(m=>!r[m]);const b=Object.entries(r).filter(([,m])=>m===u.activeTab).map(([m])=>m);return u.actions.filter(m=>b.includes(m))}),n=D(()=>i.value.some(b=>["email","whatsapp","sms"].includes(b))),p=D(()=>i.value.some(b=>["addVehicle","configureVehicle"].includes(b))),y=D(()=>i.value.some(b=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(b))),f=b=>{l.value=!1,o("action",b)};return(b,m)=>t.show?(a(),d("div",{key:0,class:O(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?v("",!0):(a(),d("div",js)),e("div",{class:O(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:m[0]||(m[0]=te($=>l.value=!l.value,["stop"])),class:O(c.value)},[...m[12]||(m[12]=[e("i",{class:"fa-solid fa-plus text-[10px] md:text-xs"},null,-1),e("span",{class:"text-xs md:text-sm"},"Add new",-1)])],2),l.value?T((a(),d("div",Vs,[p.value?(a(),d(J,{key:0},[i.value.includes("addVehicle")?(a(),d("button",{key:0,onClick:m[1]||(m[1]=$=>f("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):v("",!0),i.value.includes("configureVehicle")?(a(),d("button",{key:1,onClick:m[2]||(m[2]=$=>f("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):v("",!0)],64)):v("",!0),y.value?(a(),d(J,{key:1},[p.value?(a(),d("div",Fs)):v("",!0),i.value.includes("note")?(a(),d("button",{key:1,onClick:m[3]||(m[3]=$=>f("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):v("",!0),i.value.includes("financing")?(a(),d("button",{key:2,onClick:m[4]||(m[4]=$=>f("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):v("",!0),i.value.includes("tradein")?(a(),d("button",{key:3,onClick:m[5]||(m[5]=$=>f("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):v("",!0),i.value.includes("requestedCar")?(a(),d("button",{key:4,onClick:m[6]||(m[6]=$=>f("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):v("",!0),i.value.includes("purchase")?(a(),d("button",{key:5,onClick:m[7]||(m[7]=$=>f("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):v("",!0),i.value.includes("attachment")?(a(),d("button",{key:6,onClick:m[8]||(m[8]=$=>f("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):v("",!0)],64)):v("",!0),n.value?(a(),d(J,{key:2},[m[16]||(m[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),i.value.includes("email")?(a(),d("button",{key:0,onClick:m[9]||(m[9]=$=>f("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...m[13]||(m[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),I(" Send Email ",-1)])])):v("",!0),i.value.includes("whatsapp")?(a(),d("button",{key:1,onClick:m[10]||(m[10]=$=>f("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...m[14]||(m[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),I(" Send WhatsApp ",-1)])])):v("",!0),i.value.includes("sms")?(a(),d("button",{key:2,onClick:m[11]||(m[11]=$=>f("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...m[15]||(m[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),I(" Send SMS ",-1)])])):v("",!0)],64)):v("",!0)])),[[s,()=>l.value=!1]]):v("",!0)],2),t.inline?v("",!0):(a(),d("div",Ls))],2)):v("",!0)}},Us={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Es={class:"flex items-start gap-3"},Ws={class:"flex-1 min-w-0"},Bs={class:"font-bold text-sm text-slate-800 mb-2"},Ps={class:"space-y-1.5 text-xs text-gray-600"},zs={class:"flex items-center gap-2"},Qs={class:"flex items-center gap-2"},Ys={class:"flex items-center gap-2"},Hs={key:0,class:"mt-2"},Js={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const h=t,s=D(()=>h.appointmentData.date?new Date(h.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),u=D(()=>h.appointmentData.time?h.appointmentData.time:""),o=l=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[l==null?void 0:l.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(l,c)=>(a(),d("div",Us,[e("div",Es,[c[3]||(c[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Ws,[e("h4",Bs,g(t.appointmentData.type),1),e("div",Ps,[e("div",zs,[c[0]||(c[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,g(s.value),1)]),e("div",Qs,[c[1]||(c[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,g(u.value),1)]),e("div",Ys,[c[2]||(c[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,g(t.appointmentData.assignee),1)])]),t.appointmentData.status?(a(),d("div",Hs,[e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",o(t.appointmentData.status)])},g(t.appointmentData.status),3)])):v("",!0)])])]))}},Ks={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Gs={class:"flex-1"},Xs={class:"flex items-center gap-2 mb-1"},Zs={class:"text-xs font-bold text-slate-800"},_s={class:"text-[10px] text-gray-400"},eo={class:"text-[10px] text-gray-400"},to={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},so={class:"ml-auto relative"},oo={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},lo={key:0,class:"text-sm text-slate-700"},ao={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},no={key:2,class:"mt-2"},io={key:0},ro={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},uo={key:0},co={class:"text-sm font-bold text-slate-800"},mo={key:0,class:"text-xs text-gray-600 mt-0.5"},po={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},yo={key:0},fo={key:1},go={key:2},vo={key:3},bo={key:4},xo={key:1},ho={class:"text-sm font-bold text-slate-800 mb-2"},wo={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},ko={key:0},$o={class:"text-slate-700 font-medium ml-1"},Co={key:1},So={class:"text-slate-700 font-medium ml-1"},Do={key:2},Ao={class:"text-slate-700 font-medium ml-1"},To={key:3},qo={class:"text-slate-700 font-medium ml-1"},Oo={key:4},No={class:"text-slate-700 font-medium ml-1"},Io={key:5},Mo={class:"text-slate-700 font-medium ml-1"},Ro={key:2,class:"flex items-center gap-3"},jo={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Vo=["src"],Fo={class:"flex-1"},Lo={class:"text-sm font-bold text-slate-800"},Uo={class:"text-xs text-gray-500"},Eo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Wo={key:3,class:"flex items-center gap-3"},Bo={class:"flex-1"},Po={class:"text-sm font-bold text-slate-800"},zo={class:"text-xs text-gray-500"},Qo={key:0,class:"text-xs text-gray-400 mt-1"},Yo={key:1,class:"text-xs text-gray-600 mt-1"},Ho={__name:"TaskCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:h}){const s=t,u=h,o=C(!1),l={mounted(b,m){b.clickOutsideEvent=$=>{b===$.target||b.contains($.target)||m.value()},setTimeout(()=>{document.addEventListener("click",b.clickOutsideEvent)},0)},unmounted(b){document.removeEventListener("click",b.clickOutsideEvent)}},c=b=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[b]||"fa-solid fa-circle",r=b=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[b]||"bg-gray-100 text-gray-600 border-gray-200",i=b=>{if(!b)return"Just now";const m=new Date(b),q=new Date-m,M=Math.floor(q/6e4),L=Math.floor(M/60),W=Math.floor(L/24);return M<1?"Just now":M<60?`${M} minutes ago`:L<24?`${L} hours ago`:W===1?"Yesterday":W<7?`${W} days ago`:m.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},n=b=>b?new Intl.NumberFormat("en-US").format(b):"0",p=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",y=()=>{o.value=!1,u("edit",s.item)},f=()=>{o.value=!1,confirm("Are you sure you want to delete this item?")&&u("delete",s.item)};return(b,m)=>(a(),d("div",Ks,[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",r(t.item.type)])},[e("i",{class:O([c(t.item.type),"text-sm"])},null,2)],2),e("div",Gs,[e("div",Xs,[e("span",Zs,g(t.customerInitials),1),e("span",_s,g(t.item.action||"added"),1),e("span",eo,"• "+g(i(t.item.timestamp)),1),t.item.autoDetected?(a(),d("span",to,"Auto-detected")):v("",!0),e("div",so,[e("button",{onClick:m[0]||(m[0]=te($=>o.value=!o.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...m[1]||(m[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),o.value?T((a(),d("div",oo,[e("button",{onClick:y,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...m[2]||(m[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),I(" Edit ",-1)])]),e("button",{onClick:f,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...m[3]||(m[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),I(" Delete ",-1)])])])),[[l,()=>o.value=!1]]):v("",!0)])]),t.item.content?(a(),d("div",lo,g(t.item.content),1)):v("",!0),t.item.fileName?(a(),d("div",ao,[m[4]||(m[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,g(t.item.fileName),1)])):v("",!0),t.item.data?(a(),d("div",no,[t.item.type==="appointment"?(a(),d("div",io,[U(Js,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(a(),d("div",ro,[t.item.type==="tradein"?(a(),d("div",uo,[e("h4",co,g(t.item.data.brand)+" "+g(t.item.data.model),1),t.item.data.version?(a(),d("p",mo,g(t.item.data.version),1)):v("",!0),e("div",po,[t.item.data.year?(a(),d("div",yo,[m[5]||(m[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),I(g(t.item.data.year),1)])):v("",!0),t.item.data.km?(a(),d("div",fo,[m[6]||(m[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),I(g(t.item.data.km)+" km ",1)])):v("",!0),t.item.data.plate?(a(),d("div",go,[m[7]||(m[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),I(g(t.item.data.plate),1)])):v("",!0),t.item.data.date?(a(),d("div",vo,[m[8]||(m[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),I(g(p(t.item.data.date)),1)])):v("",!0),t.item.data.class?(a(),d("div",bo,[m[9]||(m[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),I(g(t.item.data.class),1)])):v("",!0)])])):t.item.type==="financing"?(a(),d("div",xo,[e("h4",ho,g(t.item.data.product),1),e("div",wo,[t.item.data.provider?(a(),d("div",ko,[m[10]||(m[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",$o,g(t.item.data.provider),1)])):v("",!0),t.item.data.total?(a(),d("div",Co,[m[11]||(m[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",So,"€"+g(n(t.item.data.total)),1)])):v("",!0),t.item.data.monthly?(a(),d("div",Do,[m[12]||(m[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Ao,"€"+g(n(t.item.data.monthly)),1)])):v("",!0),t.item.data.deposit?(a(),d("div",To,[m[13]||(m[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",qo,"€"+g(n(t.item.data.deposit)),1)])):v("",!0),t.item.data.startDate?(a(),d("div",Oo,[m[14]||(m[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",No,g(p(t.item.data.startDate)),1)])):v("",!0),t.item.data.expDate?(a(),d("div",Io,[m[15]||(m[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Mo,g(p(t.item.data.expDate)),1)])):v("",!0)])])):t.item.type==="offer"?(a(),d("div",Ro,[t.item.data.image?(a(),d("div",jo,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Vo)])):v("",!0),e("div",Fo,[e("h4",Lo,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",Uo,"€ "+g(n(t.item.data.price)),1)]),t.item.data.isMainOffer?(a(),d("span",Eo,"Main Offer")):v("",!0)])):t.item.type==="purchase"?(a(),d("div",Wo,[e("div",Bo,[e("h4",Po,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",zo,"€ "+g(n(t.item.data.price)),1),t.item.data.purchaseDate?(a(),d("p",Qo,"Purchased: "+g(p(t.item.data.purchaseDate)),1)):v("",!0),t.item.data.notes?(a(),d("p",Yo,g(t.item.data.notes),1)):v("",!0)])])):v("",!0)]))])):v("",!0)])]))}},Jo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Ko={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Go={class:"mb-3"},Xo={class:"flex justify-end gap-2"},Zo={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(""),l=C(""),c=()=>{!o.value.trim()&&!l.value||u("save",{type:"communication",action:`sent via ${s.type}`,content:o.value||`Sent template: ${l.value}`,communicationType:s.type})};return(r,i)=>(a(),d("div",Jo,[i[5]||(i[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Ko,g(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Go,[i[4]||(i[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),T(e("select",{"onUpdate:modelValue":i[0]||(i[0]=n=>l.value=n),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...i[3]||(i[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[ne,l.value]])]),T(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=n=>o.value=n),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[R,o.value]]),e("div",Xo,[e("button",{onClick:i[2]||(i[2]=n=>r.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},_o={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},el={class:"flex justify-between items-center mb-4"},tl={class:"text-sm font-bold text-slate-800"},sl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ol={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C("");le(()=>{s.item&&(o.value=s.item.content||"")});const l=()=>{var c,r;o.value.trim()&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:o.value,timestamp:((r=s.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,r)=>(a(),d("div",_o,[r[5]||(r[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",el,[e("h5",tl,g(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:r[0]||(r[0]=i=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...r[3]||(r[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),T(e("textarea",{"onUpdate:modelValue":r[1]||(r[1]=i=>o.value=i),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[R,o.value]])]),e("div",sl,[e("button",{onClick:r[2]||(r[2]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:l,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},ll={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},al={class:"flex justify-between items-center mb-4"},nl={class:"text-sm font-bold text-slate-800"},il={class:"flex items-center gap-3"},rl={key:0,class:"text-sm text-slate-600"},dl={key:1,class:"text-sm text-gray-400"},ul={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},cl=["disabled"],ml={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(null),l=C("");le(()=>{s.item&&(l.value=s.item.fileName||"")});const c=i=>{const n=i.target.files[0];n&&(o.value=n,l.value=n.name)},r=()=>{var i,n;!o.value&&!s.item||u("save",{id:((i=s.item)==null?void 0:i.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:l.value,timestamp:((n=s.item)==null?void 0:n.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(i,n)=>(a(),d("div",ll,[n[6]||(n[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",al,[e("h5",nl,g(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:n[0]||(n[0]=p=>i.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",il,[e("input",{type:"file",onChange:c,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:n[1]||(n[1]=p=>i.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),I("Choose File ",-1)])]),l.value?(a(),d("span",rl,g(l.value),1)):(a(),d("span",dl,"No file selected"))])]),e("div",ul,[e("button",{onClick:n[2]||(n[2]=p=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:r,disabled:!o.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,cl)])]))}},pl={class:"animate-fade-in"},yl={class:"space-y-4"},fl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},bl=["disabled"],xl={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});le(()=>{s.item&&s.item.data&&(o.value={startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",productName:s.item.data.product||s.item.data.productName||"",deposit:s.item.data.deposit||"",loanAmount:s.item.data.total||s.item.data.loanAmount||""})});const l=()=>{var c,r;o.value.productName&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"financing",action:s.item?"updated a financing proposal":"added a financing proposal",data:{product:o.value.productName,provider:"Audi Financial",total:o.value.loanAmount||"0",monthly:Math.round(parseFloat(o.value.loanAmount||0)/36).toString(),startDate:o.value.startDate,expDate:o.value.expDate,deposit:o.value.deposit},timestamp:((r=s.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,r)=>(a(),d("div",pl,[e("div",yl,[e("div",fl,[e("div",null,[r[6]||(r[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),T(e("input",{type:"date","onUpdate:modelValue":r[0]||(r[0]=i=>o.value.startDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.startDate]])]),e("div",null,[r[7]||(r[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),T(e("input",{type:"date","onUpdate:modelValue":r[1]||(r[1]=i=>o.value.expDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.expDate]])])]),e("div",null,[r[8]||(r[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),T(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=i=>o.value.productName=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.productName]])]),e("div",gl,[e("div",null,[r[9]||(r[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),T(e("input",{type:"number","onUpdate:modelValue":r[3]||(r[3]=i=>o.value.deposit=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.deposit]])]),e("div",null,[r[10]||(r[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),T(e("input",{type:"number","onUpdate:modelValue":r[4]||(r[4]=i=>o.value.loanAmount=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.loanAmount]])])])]),e("div",vl,[e("button",{onClick:r[5]||(r[5]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:l,disabled:!o.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,bl)])]))}},hl={class:"animate-fade-in"},wl={class:"space-y-4"},kl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$l={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Sl=["disabled"],Dl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});le(()=>{s.item&&s.item.data&&(o.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const l=()=>{var c,r;o.value.brand&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:o.value.class,brand:o.value.brand,model:o.value.model||"Unknown Model",year:o.value.date?new Date(o.value.date).getFullYear():"Unknown Year",km:o.value.km||"0",plate:o.value.plate||"",date:o.value.date||""},timestamp:((r=s.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,r)=>(a(),d("div",hl,[e("div",wl,[e("div",null,[r[9]||(r[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),T(e("select",{"onUpdate:modelValue":r[0]||(r[0]=i=>o.value.class=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...r[8]||(r[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[ne,o.value.class]])]),e("div",kl,[e("div",null,[r[10]||(r[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=i=>o.value.brand=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.brand]])]),e("div",null,[r[11]||(r[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=i=>o.value.model=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.model]])])]),e("div",null,[r[12]||(r[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),T(e("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=i=>o.value.version=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.version]])]),e("div",$l,[e("div",null,[r[13]||(r[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),T(e("input",{type:"number","onUpdate:modelValue":r[4]||(r[4]=i=>o.value.km=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.km]])]),e("div",null,[r[14]||(r[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),T(e("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=i=>o.value.plate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.plate]])])]),e("div",null,[r[15]||(r[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),T(e("input",{type:"date","onUpdate:modelValue":r[6]||(r[6]=i=>o.value.date=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.date]])])]),e("div",Cl,[e("button",{onClick:r[7]||(r[7]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:l,disabled:!o.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Sl)])]))}},Al={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Tl={class:"flex justify-between items-center mb-4"},ql={class:"text-sm font-bold text-slate-800"},Ol={class:"space-y-4"},Nl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Il={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ml={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Rl=["disabled"],jl={__name:"PurchaseWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C({brand:"",model:"",year:"",price:"",purchaseDate:"",notes:""});le(()=>{s.item&&s.item.data&&(o.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",purchaseDate:s.item.data.purchaseDate||"",notes:s.item.data.notes||""})});const l=D(()=>o.value.brand&&o.value.model&&o.value.price),c=()=>{var r,i;l.value&&u("save",{id:((r=s.item)==null?void 0:r.id)||Date.now(),type:"purchase",action:s.item?"updated a purchase":"added a purchase",data:{brand:o.value.brand,model:o.value.model,year:o.value.year||new Date().getFullYear(),price:o.value.price,purchaseDate:o.value.purchaseDate||new Date().toISOString().split("T")[0],notes:o.value.notes||""},timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(r,i)=>(a(),d("div",Al,[i[15]||(i[15]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Tl,[e("h5",ql,g(t.item?"Edit Purchase":"Add Purchase"),1),e("button",{onClick:i[0]||(i[0]=n=>r.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",Ol,[e("div",Nl,[e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=n=>o.value.brand=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.brand]])]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=n=>o.value.model=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.model]])])]),e("div",Il,[e("div",null,[i[11]||(i[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":i[3]||(i[3]=n=>o.value.year=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.year]])]),e("div",null,[i[12]||(i[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Price (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=n=>o.value.price=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.price]])])]),e("div",null,[i[13]||(i[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":i[5]||(i[5]=n=>o.value.purchaseDate=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,o.value.purchaseDate]])]),e("div",null,[i[14]||(i[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes",-1)),T(e("textarea",{"onUpdate:modelValue":i[6]||(i[6]=n=>o.value.notes=n),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Additional purchase details..."},null,512),[[R,o.value.notes]])])]),e("div",Ml,[e("button",{onClick:i[7]||(i[7]=n=>r.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:c,disabled:!l.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Rl)])]))}},Vl=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function Fl(t){const{store:h,taskId:s,getTabForItemType:u,isOverviewModalAction:o}=t,l=C("overview"),c=C(null),r=C(null),i=C("email"),n=C([]),p=D(()=>[...h.currentActivities.value,...n.value.filter(M=>!M.activityId)].filter(M=>{const L=u(M.type);return l.value==="overview"?L==="overview":L===l.value})),y=q=>(r.value=null,l.value==="overview"&&o(q)?{modalAction:q}:(["email","whatsapp","sms"].includes(q)?(i.value=q,c.value="communication"):c.value=q,null)),f=async q=>{var M;if(q.isEdit){const L=n.value.findIndex(W=>W.id===q.id);L>-1&&(n.value[L]={...n.value[L],...q}),(M=r.value)!=null&&M.activityId&&await h.updateActivity(s.value,r.value.activityId,{type:q.communicationType||q.type,user:"You",action:q.action,content:q.content,fileName:q.fileName,data:q.data})}else{const L=q.communicationType||q.type,W=await h.addActivity(s.value,{type:L,user:"You",action:q.action,content:q.content,fileName:q.fileName,data:q.data});n.value.push({id:W.id,type:L==="email"||L==="whatsapp"||L==="sms"?"communication":L,action:q.action,content:q.content,fileName:q.fileName,data:q.data,timestamp:W.timestamp,activityId:W.id})}c.value=null,r.value=null},b=()=>{c.value=null,r.value=null},m=q=>{r.value=q,c.value=q.type},$=async q=>{const M=n.value.findIndex(L=>L.id===q.id);M>-1&&n.value.splice(M,1),q.activityId&&await h.deleteActivity(s.value,q.activityId)};return oe(l,()=>{c.value=null,r.value=null}),{activeTab:l,showInlineWidget:c,editingItem:r,communicationType:i,inlineContent:n,filteredInlineContent:p,handleAddNewAction:y,handleWidgetSave:f,handleWidgetCancel:b,handleEditItem:m,handleDeleteItem:$}}const Ll={class:"flex-1 flex flex-col overflow-hidden"},Ul={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},El={class:"px-4 md:px-8 py-4 md:py-6"},Wl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Bl={class:"mb-4"},Pl={key:0,class:"mb-6"},zl={key:1,class:"space-y-6 mb-6"},Ql={key:3},Yl={key:4,class:"space-y-4 mb-6 px-1"},Hl={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Jl={class:"p-6"},Kl={class:"flex justify-between items-center mb-4"},Gl={class:"text-sm font-bold text-slate-800"},Xl={key:1,class:"max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Zl={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const h=t,s=D(()=>h.task.id),u=C(!1),o=C(null),{activeTab:l,showInlineWidget:c,editingItem:r,communicationType:i,inlineContent:n,filteredInlineContent:p,handleAddNewAction:y,handleWidgetSave:f,handleWidgetCancel:b,handleEditItem:m,handleDeleteItem:$}=Fl({store:h.storeAdapter,taskId:s,getTabForItemType:Vl,isOverviewModalAction:z=>l.value==="overview"&&h.addNewConfig.overviewActions.includes(z)}),q=z=>{const B=y(z);B&&B.modalAction&&(o.value=B.modalAction,u.value=!0)},M=()=>{u.value=!1,o.value=null},L=async z=>{await f(z),M()},W=D(()=>{const z=[...h.storeAdapter.currentActivities.value,...n.value],B=z.length,N=z.filter(Z=>["call","email","sms","whatsapp","communication"].includes(Z.type)).length,X=z.filter(Z=>Z.type==="note").length,ie=z.filter(Z=>Z.type==="attachment").length;return[{key:"overview",label:"Overview",count:B},{key:"note",label:"Notes",count:X},{key:"communication",label:"Communication",count:N},{key:"attachment",label:"Attachments",count:ie}]}),se=D(()=>[...h.storeAdapter.currentActivities.value,...n.value]);return(z,B)=>(a(),d("div",Ll,[e("header",Ul,[e("div",El,[U(ks,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:Q(()=>[(a(!0),d(J,null,ee(t.task.tags,N=>(a(),d("span",{key:N,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},g(N),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class"])])]),e("main",Wl,[e("div",Bl,[U(Ds,{modelValue:V(l),"onUpdate:modelValue":B[0]||(B[0]=N=>yt(l)?l.value=N:null),tabs:W.value,class:"mb-0"},null,8,["modelValue","tabs"])]),V(l)==="overview"?(a(),d("div",Pl,[U(Rs,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||""},null,8,["stage","owner","source"])])):v("",!0),V(l)==="overview"?(a(),d("div",zl,[(a(),F(ft(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:se.value},null,8,["lead","opportunity","activities"])),t.addNewConfig.overviewActions.length?(a(),F(Me,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":V(l),onAction:q},null,8,["actions","active-tab"])):v("",!0),me(z.$slots,"pinned-extra",{task:t.task})])):v("",!0),V(l)!=="overview"?(a(),F(Me,{key:2,actions:t.addNewConfig.tabActions,"active-tab":V(l),onAction:q},null,8,["actions","active-tab"])):v("",!0),V(l)!=="overview"?(a(),d("div",Ql,[V(c)==="communication"?(a(),F(Zo,{key:0,type:V(i),"task-type":t.type,"task-id":t.task.id,onSave:V(f),onCancel:V(b)},null,8,["type","task-type","task-id","onSave","onCancel"])):v("",!0),V(c)==="note"?(a(),F(ol,{key:1,item:V(r),"task-type":t.type,"task-id":t.task.id,onSave:V(f),onCancel:V(b)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0),V(c)==="attachment"?(a(),F(ml,{key:2,item:V(r),"task-type":t.type,"task-id":t.task.id,onSave:V(f),onCancel:V(b)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0)])):v("",!0),V(p).length>0?(a(),d("div",Yl,[(a(!0),d(J,null,ee(V(p),N=>(a(),F(Ho,{key:N.id,item:N,"task-type":t.type,"customer-initials":"SK",onEdit:V(m),onDelete:V($)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):v("",!0)]),(a(),F(he,{to:"body"},[u.value?(a(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:te(M,["self"])},[o.value==="financing"||o.value==="tradein"?(a(),d("div",Hl,[e("div",Jl,[e("div",Kl,[e("h5",Gl,g(o.value==="financing"?"Add Financing":"Add Trade-in"),1),e("button",{onClick:M,class:"text-gray-400 hover:text-gray-600"},[...B[1]||(B[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),o.value==="financing"?(a(),F(xl,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])):v("",!0),o.value==="tradein"?(a(),F(Dl,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])):v("",!0)])])):v("",!0),o.value==="purchase"?(a(),d("div",Xl,[U(jl,{item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])])):v("",!0)])):v("",!0)]))]))}},_l={key:0,class:"mb-8"},ea={class:"flex items-center gap-2 mb-4"},ta={class:"font-bold text-gray-800 text-sm"},sa={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},oa={class:"p-4"},la={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},aa={class:"text-sm text-slate-700 leading-snug"},na={class:"flex items-center justify-between"},ia={class:"flex items-center gap-4"},ra={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},da=["src"],ua={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},ca={class:"flex items-center gap-2"},ma={class:"font-bold text-slate-800 text-sm md:text-base"},pa={class:"mt-1.5"},ya={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},fa={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},ga={class:"flex items-center gap-4"},va={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},ba={key:1,class:"text-right"},xa={class:"font-bold text-slate-800"},ha={class:"border-t border-gray-200"},wa={class:"font-medium"},ka={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},$a={class:"mb-6"},Ca={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Sa={key:0},Da={class:"font-medium text-slate-700"},Aa={key:1},Ta={class:"font-medium text-slate-700"},qa={key:2},Oa={class:"font-medium text-slate-700"},Na={class:"font-medium text-slate-700"},Ia={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ma={key:0},Ra={class:"font-medium text-slate-700"},ja={key:1},Va={class:"font-medium text-slate-700"},Fa={key:2},La={class:"font-medium text-slate-700"},Ua={key:3},Ea={class:"font-medium text-slate-700"},Wa={key:4},Ba={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Pa={key:5},za={class:"font-medium text-slate-700"},Qa={key:0,class:"mt-6 flex justify-end"},Re={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const h=C(!1),s=o=>new Intl.NumberFormat("en-US").format(o),u=o=>new Intl.NumberFormat("en-US").format(o);return(o,l)=>t.show?(a(),d("div",_l,[e("div",ea,[l[1]||(l[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",ta,g(t.label),1)]),e("div",sa,[e("div",oa,[t.requestMessage?(a(),d("div",la,[l[2]||(l[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",aa,g(t.requestMessage),1)])):v("",!0),e("div",na,[e("div",ia,[e("div",ra,[t.image?(a(),d("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,da)):(a(),d("i",ua))]),e("div",null,[e("div",ca,[e("div",ma,g(t.brand)+" "+g(t.model)+" ("+g(t.year)+")",1)]),e("div",pa,[t.stockDays!==void 0&&t.stockDays!==null?(a(),d("div",ya,[l[3]||(l[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),I(" In stock ("+g(t.stockDays)+" days) ",1)])):(a(),d("div",fa,[...l[4]||(l[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),I(" Out of stock ",-1)])]))])])]),e("div",ga,[t.showOpenAd&&t.price?(a(),d("button",va,[...l[5]||(l[5]=[I(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):v("",!0),t.price?(a(),d("div",ba,[l[6]||(l[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",xa,"€ "+g(s(t.price)),1)])):v("",!0)])])]),e("div",ha,[e("button",{onClick:l[0]||(l[0]=c=>h.value=!h.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",wa,g(h.value?"Hide":"View")+" Details",1),e("i",{class:O(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":h.value}])},null,2)])]),h.value?(a(),d("div",ka,[e("div",$a,[l[17]||(l[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Ca,[t.requestType?(a(),d("div",Sa,[l[7]||(l[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Da,g(t.requestType),1)])):v("",!0),t.source?(a(),d("div",Aa,[l[8]||(l[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Ta,g(t.source),1)])):v("",!0),e("div",null,[l[9]||(l[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:O(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},g(t.sourceDetails||"--"),3)]),t.dealership?(a(),d("div",qa,[l[10]||(l[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Oa,g(t.dealership),1)])):v("",!0),e("div",null,[l[11]||(l[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Na,g(t.channel||"Email"),1)]),e("div",null,[l[12]||(l[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:O(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},g(t.adCampaign||"--"),3)]),e("div",null,[l[13]||(l[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:O(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},g(t.adMedium||"--"),3)]),e("div",null,[l[14]||(l[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:O(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},g(t.adSource||"--"),3)]),e("div",null,[l[15]||(l[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:O(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},g(t.expectedPurchaseDate||"--"),3)]),e("div",null,[l[16]||(l[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:O(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},g(t.fiscalEntity||"--"),3)])])]),l[26]||(l[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[l[25]||(l[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Ia,[t.registration?(a(),d("div",Ma,[l[18]||(l[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Ra,g(t.registration),1)])):v("",!0),t.kilometers!==void 0&&t.kilometers!==null?(a(),d("div",ja,[l[19]||(l[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Va,g(u(t.kilometers))+" Km",1)])):v("",!0),t.fuelType?(a(),d("div",Fa,[l[20]||(l[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",La,g(t.fuelType),1)])):v("",!0),t.gearType?(a(),d("div",Ua,[l[21]||(l[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Ea,g(t.gearType),1)])):v("",!0),t.vin?(a(),d("div",Wa,[l[22]||(l[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Ba,g(t.vin),1)])):v("",!0),t.dealership?(a(),d("div",Pa,[l[23]||(l[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",za,g(t.dealership),1)])):v("",!0)]),t.showTechnicalSpecs?(a(),d("div",Qa,[...l[24]||(l[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),I(" View technical specs ")],-1)])])):v("",!0)])])):v("",!0)])])):v("",!0)}},Ya={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Ha={class:"grid grid-cols-3 gap-3 mb-4"},Ja={class:"flex gap-3 mb-4"},Le={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:h}){const s=h,u=C(null),o=C(""),l=C(""),c=n=>{u.value=n;const p=new Date;if(n==="later-today"){const y=new Date(p.getTime()+72e5);o.value=y.toISOString().split("T")[0],l.value=y.toTimeString().slice(0,5)}else if(n==="tomorrow"){const y=new Date(p);y.setDate(y.getDate()+1),o.value=y.toISOString().split("T")[0],l.value="09:00"}else if(n==="next-week"){const y=new Date(p);y.setDate(y.getDate()+(7-y.getDay()+1)),o.value=y.toISOString().split("T")[0],l.value="09:00"}},r=()=>{s("confirm",{date:o.value,time:l.value,option:u.value}),s("close"),u.value=null,o.value="",l.value=""},i=()=>{s("close"),u.value=null,o.value="",l.value=""};return(n,p)=>t.show?(a(),d("div",Ya,[e("div",Ha,[e("button",{onClick:p[0]||(p[0]=y=>c("later-today")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="later-today"}])},[...p[5]||(p[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:p[1]||(p[1]=y=>c("tomorrow")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="tomorrow"}])},[...p[6]||(p[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:p[2]||(p[2]=y=>c("next-week")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="next-week"}])},[...p[7]||(p[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",Ja,[T(e("input",{"onUpdate:modelValue":p[3]||(p[3]=y=>o.value=y),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[R,o.value]]),T(e("input",{"onUpdate:modelValue":p[4]||(p[4]=y=>l.value=y),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[R,l.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:i,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:r,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):v("",!0)}},Ka={key:0,class:"space-y-4 animate-fade-in"},Ga={key:0,class:"animate-fade-in"},Xa={class:"grid grid-cols-4 gap-2"},Za=["onClick"],Ue={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(""),l=C("Michael Thomas (Me)"),c=C(""),r=C(!1),i=C("");oe(()=>s.show,f=>{f||n()});const n=()=>{o.value="",l.value="Michael Thomas (Me)",c.value="",r.value=!1,i.value=""},p=()=>{!o.value||!c.value||!i.value||(u("confirm",{type:o.value,assignee:l.value,date:c.value,time:i.value}),n())},y=()=>{n(),u("cancel")};return(f,b)=>t.show?(a(),d("div",Ka,[e("div",null,[b[5]||(b[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),T(e("select",{"onUpdate:modelValue":b[0]||(b[0]=m=>o.value=m),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...b[4]||(b[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ne,o.value]])]),e("div",null,[b[7]||(b[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),T(e("select",{"onUpdate:modelValue":b[1]||(b[1]=m=>l.value=m),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...b[6]||(b[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[ne,l.value]])]),e("div",null,[b[8]||(b[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":b[2]||(b[2]=m=>c.value=m),onChange:b[3]||(b[3]=m=>r.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[R,c.value]])]),r.value?(a(),d("div",Ga,[b[9]||(b[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",Xa,[(a(),d(J,null,ee(["09:00","10:30","11:00","14:30","15:00","16:30"],m=>e("button",{key:m,onClick:$=>i.value=m,class:O(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",i.value===m?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},g(m),11,Za)),64))])])):v("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:y,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:p,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...b[10]||(b[10]=[I(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):v("",!0)}},_a={class:"space-y-6"},en={class:"flex gap-6"},tn={class:"flex items-center gap-2 cursor-pointer"},sn={class:"flex items-center gap-2 cursor-pointer"},on=["disabled"],ln={__name:"DisqualifyModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C("Not Interested"),l=C("");oe(()=>s.show,i=>{i&&(o.value="Not Interested",l.value="")});const c=()=>{u("confirm",{category:o.value,reason:l.value})},r=()=>{u("cancel")};return(i,n)=>(a(),F(pe,{show:t.show,title:"Disqualify Lead",subtitle:"Please select a reason for disqualification.",onCancel:r},{actions:Q(()=>[e("button",{onClick:c,disabled:!o.value||!l.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-6 py-3 rounded-lg text-base transition-colors"}," Confirm Disqualification ",8,on)]),default:Q(()=>[e("div",_a,[e("div",null,[n[5]||(n[5]=e("label",{class:"block label-upper mb-3"},"Category",-1)),e("div",en,[e("label",tn,[T(e("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=p=>o.value=p),value:"Not Valid",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,o.value]]),n[3]||(n[3]=e("span",{class:"text-base text-gray-700"},"Not Valid",-1))]),e("label",sn,[T(e("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=p=>o.value=p),value:"Not Interested",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,o.value]]),n[4]||(n[4]=e("span",{class:"text-base text-gray-700"},"Not Interested",-1))])])]),e("div",null,[n[7]||(n[7]=e("label",{class:"block label-upper mb-3"},"Failure Reason",-1)),T(e("select",{"onUpdate:modelValue":n[2]||(n[2]=p=>l.value=p),class:"w-full bg-white border-2 border-red-500 rounded-lg px-4 py-3 text-base text-gray-700 focus:outline-none focus:border-red-600 transition-colors"},[...n[6]||(n[6]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[ne,l.value]])])])]),_:1},8,["show"]))}},an={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},nn={class:"flex justify-between items-start mb-3"},rn={class:"text-xs text-gray-500 mt-0.5"},dn={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},un={class:"text-xs text-blue-700"},cn={class:"flex gap-3 flex-wrap"},mn={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},pn={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},yn={class:"flex items-center justify-between mb-4"},fn={__name:"LQWidget",props:{lead:{type:Object,required:!0}},emits:["postponed","validated","qualified","disqualified"],setup(t,{emit:h}){const s=t,u=h,o=C(!1),l=C(!1),c=C(!1),r=C(!1),i=D(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),n=D(()=>s.lead.nextActionDue?new Date(s.lead.nextActionDue)<new Date:!1),p=D(()=>!!s.lead.scheduledAppointment),y=D(()=>p.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:n.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),f=()=>{o.value=!0},b=B=>{u("postponed",B),o.value=!1},m=()=>{l.value=!0},$=()=>{u("validated",{scheduleFollowUp:!1}),l.value=!1},q=()=>{l.value=!1,c.value=!0},M=B=>{u("validated",{scheduleFollowUp:!0,appointmentData:B}),c.value=!1},L=()=>{c.value=!1,u("validated",{scheduleFollowUp:!1})},W=()=>{u("qualified")},se=()=>{r.value=!0},z=B=>{u("disqualified",B),r.value=!1};return(B,N)=>(a(),d("div",an,[e("div",nn,[e("div",null,[N[3]||(N[3]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",rn,g(i.value),1)]),e("div",{class:O(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",y.value.class])},g(y.value.text),3)]),p.value?(a(),d("div",dn,[N[4]||(N[4]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",un,g(V(ke)(t.lead.scheduledAppointment.start))+" at "+g(V($e)(t.lead.scheduledAppointment.start)),1)])):v("",!0),e("div",cn,[e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...N[5]||(N[5]=[I(" Postpone ",-1),e("i",{class:"fa-regular fa-clock text-xs"},null,-1)])]),e("button",{onClick:se,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...N[6]||(N[6]=[I(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban text-xs"},null,-1)])]),t.lead.stage==="Open Lead"?(a(),d("button",{key:0,onClick:m,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[...N[7]||(N[7]=[I(" Validate ",-1),e("i",{class:"fa-solid fa-check text-xs"},null,-1)])])):v("",!0),e("button",{onClick:W,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-green-200"},[...N[8]||(N[8]=[I(" Qualify ",-1),e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])]),U(Le,{show:o.value,onClose:N[0]||(N[0]=X=>o.value=!1),onConfirm:b},null,8,["show"]),l.value?(a(),d("div",mn,[e("div",pn,[e("div",yn,[N[10]||(N[10]=e("h3",{class:"text-lg font-bold text-gray-900"},"Validate Lead",-1)),e("button",{onClick:N[1]||(N[1]=X=>l.value=!1),class:"text-gray-400 hover:text-gray-600"},[...N[9]||(N[9]=[e("i",{class:"fa-solid fa-times"},null,-1)])])]),N[11]||(N[11]=e("p",{class:"text-sm text-gray-600 mb-4"},' Lead will be marked as "Validated". Would you like to schedule a follow-up call? ',-1)),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:$,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Just Validate "),e("button",{onClick:q,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Schedule Follow-up ")])])])):v("",!0),c.value?(a(),F(Ue,{key:2,show:c.value,onConfirm:M,onCancel:L},null,8,["show"])):v("",!0),U(ln,{show:r.value,onConfirm:z,onCancel:N[2]||(N[2]=X=>r.value=!1)},null,8,["show"])]))}},gn={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},vn={class:"p-5 space-y-6"},bn={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},setup(t){const h=t,s=Se(),u=je(),o=Ce(),l=async n=>{try{const p=new Date(`${n.date}T${n.time}:00`),y=p.toISOString();await u.modifyLead(h.lead.id,{nextActionDue:y}),await u.addActivity(h.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${ke(p)} at ${$e(p)}`}),await u.loadLeadById(h.lead.id)}catch(p){console.error("Failed to postpone lead task:",p)}},c=async n=>{try{if(await u.modifyLead(h.lead.id,{stage:"Validated"}),await u.addActivity(h.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),n.scheduleFollowUp&&n.appointmentData){const p=new Date(`${n.appointmentData.date}T${n.appointmentData.time}:00`);await u.scheduleFollowUp(h.lead.id,{dateTime:p.toISOString(),assignee:n.appointmentData.assignee||h.lead.assignee,assigneeId:n.appointmentData.assigneeId||1}),await u.addActivity(h.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${ke(p)} at ${$e(p)}`})}await u.loadLeadById(h.lead.id)}catch(p){console.error("Failed to validate lead:",p)}},r=async()=>{try{const n=await u.convertLeadToOpportunity(h.lead.id);o.canAccessOpportunities()?s.push({path:`/tasks/${n}`,query:{type:"opportunity"}}):s.push("/tasks/1")}catch(n){console.error("Failed to qualify lead:",n)}},i=async n=>{try{await u.modifyLead(h.lead.id,{isDisqualified:!0,disqualifyReason:n.reason,status:"Disqualified"}),await u.addActivity(h.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${n.category}, Reason: ${n.reason}`}),s.push("/tasks")}catch(p){console.error("Failed to disqualify lead:",p)}};return(n,p)=>t.lead?(a(),d("div",gn,[p[0]||(p[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")])],-1)),e("div",vn,[U(fn,{lead:t.lead,onPostponed:l,onValidated:c,onQualified:r,onDisqualified:i},null,8,["lead"])])])):v("",!0)}},xn={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:h}){const s=h,u=()=>{s("close")};return(o,l)=>(a(),F(pe,{show:t.show,title:t.title,onCancel:u},{footer:Q(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:u,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:Q(()=>[l[0]||(l[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},hn={class:"space-y-4"},wn=["disabled"],kn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(""),l=C("");oe(()=>s.show,i=>{i&&(o.value="",l.value="")});const c=()=>{o.value&&u("confirm",{reason:o.value,notes:l.value})},r=()=>{u("cancel")};return(i,n)=>(a(),F(pe,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:r},{actions:Q(()=>[e("button",{onClick:c,disabled:!o.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,wn)]),default:Q(()=>[e("div",hn,[e("div",null,[n[3]||(n[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),T(e("select",{"onUpdate:modelValue":n[0]||(n[0]=p=>o.value=p),class:"input"},[...n[2]||(n[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ne,o.value]])]),e("div",null,[n[4]||(n[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),T(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=p=>l.value=p),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[R,l.value]])])])]),_:1},8,["show"]))}},$n={class:"space-y-4"},Cn=["max"],Sn=["disabled"],Dn={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(""),l=C(""),c=C(""),r=D(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,p=>{if(p){const y=new Date;o.value=y.toISOString().split("T")[0],l.value=y.toTimeString().slice(0,5),c.value=""}});const i=()=>{if(!o.value)return;const p=l.value?`${o.value}T${l.value}:00`:`${o.value}T12:00:00`;u("confirm",{contractDate:p,notes:c.value})},n=()=>{u("cancel")};return(p,y)=>(a(),F(pe,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:n},{actions:Q(()=>[e("button",{onClick:i,disabled:!o.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,Sn)]),default:Q(()=>[e("div",$n,[e("div",null,[y[3]||(y[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=f=>o.value=f),max:r.value,class:"input"},null,8,Cn),[[R,o.value]])]),e("div",null,[y[4]||(y[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=f=>l.value=f),class:"input"},null,512),[[R,l.value]])]),e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),T(e("textarea",{"onUpdate:modelValue":y[2]||(y[2]=f=>c.value=f),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[R,c.value]])])])]),_:1},8,["show"]))}},An={class:"space-y-4"},Tn=["max"],qn=["disabled"],On={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(""),l=C(""),c=C(""),r=C(""),i=D(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,y=>{if(y){const f=new Date;o.value=f.toISOString().split("T")[0],l.value=f.toTimeString().slice(0,5),c.value="",r.value=""}});const n=()=>{if(!o.value||!c.value)return;const y=l.value?`${o.value}T${l.value}:00`:`${o.value}T12:00:00`;u("confirm",{deliveryDate:y,location:c.value,notes:r.value})},p=()=>{u("cancel")};return(y,f)=>(a(),F(pe,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:p},{actions:Q(()=>[e("button",{onClick:n,disabled:!o.value||!c.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,qn)]),default:Q(()=>[e("div",An,[e("div",null,[f[4]||(f[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":f[0]||(f[0]=b=>o.value=b),max:i.value,class:"input"},null,8,Tn),[[R,o.value]])]),e("div",null,[f[5]||(f[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":f[1]||(f[1]=b=>l.value=b),class:"input"},null,512),[[R,l.value]])]),e("div",null,[f[7]||(f[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),T(e("select",{"onUpdate:modelValue":f[2]||(f[2]=b=>c.value=b),class:"input"},[...f[6]||(f[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ne,c.value]])]),e("div",null,[f[8]||(f[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),T(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=b=>r.value=b),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[R,r.value]])])])]),_:1},8,["show"]))}},Nn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(h,s)=>(a(),F(pe,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=u=>h.$emit("cancel"))},{header:Q(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:Q(()=>[e("button",{onClick:s[0]||(s[0]=u=>h.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:Q(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),I(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage, probability, and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),I(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),I(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},In={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Mn={class:"flex justify-between items-center mb-4"},Rn={class:"text-sm font-bold text-slate-800"},jn={key:0,class:"mb-4"},Vn={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},Fn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Ln=["src"],Un={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},En={class:"flex-1 min-w-0"},Wn={class:"flex items-center gap-2 flex-wrap"},Bn={class:"font-bold text-sm text-gray-800 truncate"},Pn={class:"text-xs text-gray-500"},zn={key:0,class:"text-[10px] text-green-600 mt-0.5"},Qn={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Yn=["onClick"],Hn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Jn=["src"],Kn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Gn={class:"flex-1 min-w-0"},Xn={class:"flex items-center gap-2 flex-wrap"},Zn={class:"font-bold text-sm text-gray-800 truncate"},_n={class:"text-xs text-gray-500"},ei={key:0,class:"text-[10px] text-green-600 mt-0.5"},ti={key:1,class:"text-center py-4 text-gray-400 text-sm"},si={class:"mb-4"},oi={key:0,class:"flex items-center gap-2 mb-2"},li={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ai={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},ni={class:"mt-4"},ii={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ri=["disabled"],di={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:h}){const s=t,u=h,o=C(null),l=C(null),c=C({brand:"",model:"",year:"",price:"",image:""});le(()=>{s.item&&s.item.data&&(c.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const r=y=>{if(o.value=y,s.requestedCar){const f=y.id&&s.requestedCar.id&&y.id===s.requestedCar.id||y.brand===s.requestedCar.brand&&y.model===s.requestedCar.model&&y.year===s.requestedCar.year;l.value=f?"requested":"recommended"}else l.value="recommended";c.value={brand:y.brand||"",model:y.model||"",year:y.year||new Date().getFullYear(),price:y.price||"",image:y.image||""}},i=D(()=>o.value||c.value.brand&&c.value.model&&c.value.price),n=y=>new Intl.NumberFormat("en-US").format(y),p=()=>{var f,b;const y=o.value||c.value;u("save",{id:((f=s.item)==null?void 0:f.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:y.brand,model:y.model,year:y.year||new Date().getFullYear(),price:y.price,image:y.image||"",isMainOffer:!1},timestamp:((b=s.item)==null?void 0:b.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(y,f)=>{var b,m;return a(),d("div",In,[e("div",Mn,[e("h5",Rn,g(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:f[0]||(f[0]=$=>y.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...f[8]||(f[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?v("",!0):(a(),d("div",jn,[f[11]||(f[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",Vn,[t.requestedCar?(a(),d("div",{key:0,onClick:f[1]||(f[1]=$=>r(t.requestedCar)),class:O(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((b=o.value)==null?void 0:b.id)===t.requestedCar.id}])},[e("div",Fn,[t.requestedCar.image?(a(),d("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Ln)):(a(),d("i",Un))]),e("div",En,[e("div",Wn,[e("h4",Bn,g(t.requestedCar.brand)+" "+g(t.requestedCar.model)+" ("+g(t.requestedCar.year)+")",1),e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((m=o.value)==null?void 0:m.id)===t.requestedCar.id&&l.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",Pn,"€ "+g(n(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(a(),d("div",zn," In stock ("+g(t.requestedCar.stockDays)+" days) ",1)):(a(),d("div",Qn," Out of stock "))]),f[9]||(f[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):v("",!0),(a(!0),d(J,null,ee(t.recommendedCars,$=>{var q,M;return a(),d("div",{key:$.id,onClick:L=>r($),class:O(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((q=o.value)==null?void 0:q.id)===$.id}])},[e("div",Hn,[$.image?(a(),d("img",{key:0,src:$.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Jn)):(a(),d("i",Kn))]),e("div",Gn,[e("div",Xn,[e("h4",Zn,g($.brand)+" "+g($.model)+" ("+g($.year)+")",1),e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((M=o.value)==null?void 0:M.id)===$.id&&l.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",_n,"€ "+g(n($.price)),1),$.stockDays!==null&&$.stockDays!==void 0?(a(),d("div",ei," In stock ("+g($.stockDays)+" days) ",1)):v("",!0)]),f[10]||(f[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Yn)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(a(),d("div",ti," No vehicles available ")):v("",!0)])])),e("div",si,[t.requestedCar||t.recommendedCars.length>0?(a(),d("div",oi,[...f[12]||(f[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):v("",!0),e("div",li,[e("div",null,[f[13]||(f[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":f[2]||(f[2]=$=>c.value.brand=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,c.value.brand]])]),e("div",null,[f[14]||(f[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":f[3]||(f[3]=$=>c.value.model=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,c.value.model]])])]),e("div",ai,[e("div",null,[f[15]||(f[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":f[4]||(f[4]=$=>c.value.year=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,c.value.year]])]),e("div",null,[f[16]||(f[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":f[5]||(f[5]=$=>c.value.price=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,c.value.price]])])]),e("div",ni,[f[17]||(f[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),T(e("input",{type:"text","onUpdate:modelValue":f[6]||(f[6]=$=>c.value.image=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[R,c.value.image]])])]),e("div",ii,[e("button",{onClick:f[7]||(f[7]=$=>y.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,disabled:!i.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ri)])])}}},ui={key:0,class:"mb-8"},ci={class:"relative"},mi={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},pi={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},yi=["src"],fi={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},gi={class:"p-4"},vi={class:"font-bold text-gray-800 text-sm mb-1"},bi={class:"text-xs text-gray-500 mb-2"},xi={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},hi=["onClick"],wi={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:h}){const s=C([]);le(()=>{s.value=Ve.filter(o=>o.stockDays!==null&&o.stockDays!==void 0).slice(0,5)});const u=o=>new Intl.NumberFormat("en-US").format(o);return(o,l)=>s.value.length>0?(a(),d("div",ui,[l[1]||(l[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",ci,[e("div",mi,[(a(!0),d(J,null,ee(s.value,c=>(a(),d("div",{key:c.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",pi,[c.image?(a(),d("img",{key:0,src:c.image,alt:"Car",class:"w-full h-full object-cover"},null,8,yi)):(a(),d("i",fi))]),e("div",gi,[e("h4",vi,g(c.brand)+" "+g(c.model)+" ("+g(c.year)+")",1),e("p",bi,"€ "+g(u(c.price)),1),c.stockDays!==null&&c.stockDays!==void 0?(a(),d("div",xi,[l[0]||(l[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),I(" In stock ("+g(c.stockDays)+" days) ",1)])):v("",!0),e("button",{onClick:r=>o.$emit("add-to-opportunity",c),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,hi)])]))),128))])])])):v("",!0)}},ki=gt(wi,[["__scopeId","data-v-894833e6"]]),$i={class:"mt-1.5 border-t border-gray-200 pt-1.5"},Ci={key:1},Si={class:"flex items-center justify-between mb-1.5"},Di={class:"space-y-1.5"},Ai={class:"block label-upper mb-1"},Ti=["onUpdate:modelValue","placeholder"],qi=["onUpdate:modelValue"],Oi=["value"],Ni={key:2,class:"space-y-0.5"},Ii=["onUpdate:modelValue","value"],ce={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=C(!1),l=C({});oe(()=>s.questions,p=>{const y={};p.forEach(f=>{y[f.key]=""}),l.value=y},{immediate:!0});const c=()=>{u("survey-completed",{...l.value}),n()},r=()=>{u("survey-refused"),n()},i=()=>{u("not-responding"),n()},n=()=>{o.value=!1;const p={};s.questions.forEach(y=>{p[y.key]=""}),l.value=p};return(p,y)=>(a(),d("div",$i,[o.value?(a(),d("div",Ci,[e("div",Si,[y[4]||(y[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:y[1]||(y[1]=f=>o.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...y[3]||(y[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",Di,[(a(!0),d(J,null,ee(t.questions,(f,b)=>(a(),d("div",{key:b,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Ai,g(f.label),1),f.type==="text"?T((a(),d("textarea",{key:0,"onUpdate:modelValue":m=>l.value[f.key]=m,placeholder:f.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Ti)),[[R,l.value[f.key]]]):f.type==="select"?T((a(),d("select",{key:1,"onUpdate:modelValue":m=>l.value[f.key]=m,class:"input text-xs py-1 px-2"},[y[5]||(y[5]=e("option",{value:""},"Select an option...",-1)),(a(!0),d(J,null,ee(f.options,m=>(a(),d("option",{key:m,value:m},g(m),9,Oi))),128))],8,qi)),[[ne,l.value[f.key]]]):f.type==="radio"?(a(),d("div",Ni,[(a(!0),d(J,null,ee(f.options,m=>(a(),d("label",{key:m,class:"flex items-center text-xs"},[T(e("input",{type:"radio","onUpdate:modelValue":$=>l.value[f.key]=$,value:m,class:"mr-1"},null,8,Ii),[[we,l.value[f.key]]]),I(" "+g(m),1)]))),128))])):v("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:r,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:i,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(a(),d("button",{key:0,onClick:y[0]||(y[0]=f=>o.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...y[2]||(y[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Mi={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Ri={class:"flex justify-between items-start mb-3"},ji={class:"text-xs text-gray-500 mt-0.5"},Vi={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],l=D(()=>{if(!s.opportunity.createdAt)return 0;const y=new Date(s.opportunity.createdAt),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),c=()=>{u("create-offer",s.opportunity)},r=()=>{u("review",s.opportunity)},i=y=>{u("survey-completed",{opportunity:s.opportunity,responses:y})},n=()=>{u("survey-refused",{opportunity:s.opportunity})},p=()=>{u("not-responding",{opportunity:s.opportunity})};return(y,f)=>(a(),d("div",Mi,[e("div",Ri,[e("div",null,[f[0]||(f[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",ji,"This opportunity has been open for "+g(l.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:r,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),U(ce,{questions:o,onSurveyCompleted:i,onSurveyRefused:n,onNotResponding:p})]))}},Fi={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Li={class:"flex justify-between items-start mb-3"},Ui={class:"text-xs text-gray-500 mt-0.5"},Ei={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],l=D(()=>{if(!s.opportunity.createdAt)return 0;const p=new Date(s.opportunity.createdAt),f=Math.abs(new Date-p);return Math.ceil(f/(1e3*60*60*24))}),c=()=>{u("create-offer",s.opportunity)},r=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),d("div",Fi,[e("div",Li,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Ui,"This opportunity has been open for "+g(l.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),U(ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:i,onNotResponding:n})]))}},Wi={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Bi={class:"flex justify-between items-start mb-3"},Pi={class:"text-xs text-gray-500 mt-0.5"},zi={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],l=D(()=>{const p=s.opportunity.lastActivity||s.opportunity.createdAt;if(!p)return 0;const y=new Date(p),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),c=()=>{u("create-contract",s.opportunity)},r=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),d("div",Wi,[e("div",Bi,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Pi,"This opportunity has been in negotiation for "+g(l.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),U(ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:i,onNotResponding:n})]))}},Qi={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Yi={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],l=()=>{u("schedule-closing",s.opportunity)},c=n=>{u("survey-completed",{opportunity:s.opportunity,responses:n})},r=()=>{u("survey-refused",{opportunity:s.opportunity})},i=()=>{u("not-responding",{opportunity:s.opportunity})};return(n,p)=>(a(),d("div",Qi,[p[0]||(p[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),U(ce,{questions:o,onSurveyCompleted:c,onSurveyRefused:r,onNotResponding:i})]))}},Hi={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Ji={class:"flex justify-between items-start mb-3"},Ki={class:"font-bold text-slate-800 text-sm"},Gi={class:"text-xs text-gray-500 mt-0.5"},Xi={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:h}){const s=t,u=h,o=D(()=>{var m;return((m=s.scheduledAppointment)==null?void 0:m.noShowCount)||0}),l=D(()=>{const m=o.value;return m===0?"No-Show Follow-up":m>=3?`No-Show #${m} - Final Warning`:`No-Show #${m} Follow-up`}),c=D(()=>{const m=o.value;return m>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":m>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),r=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],i=D(()=>{var $;return($=s.scheduledAppointment)!=null&&$.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),n=()=>{u("contact-customer",s.opportunity)},p=()=>{o.value>=3?u("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${o.value} no-shows`}):u("reschedule",s.opportunity)},y=m=>{u("survey-completed",{opportunity:s.opportunity,responses:m})},f=()=>{u("survey-refused",{opportunity:s.opportunity})},b=()=>{u("not-responding",{opportunity:s.opportunity})};return(m,$)=>(a(),d("div",Hi,[e("div",Ji,[e("div",null,[e("h4",Ki,g(l.value),1),e("p",Gi,"Appointment was scheduled for "+g(i.value)+" but customer did not show up. "+g(c.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...$[0]||($[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),I(" Book Another Appointment ",-1)])]),e("button",{onClick:n,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...$[1]||($[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),I(" Contact Customer ",-1)])])]),U(ce,{questions:r,onSurveyCompleted:y,onSurveyRefused:f,onNotResponding:b})]))}},Zi={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},_i={class:"flex justify-between items-start mb-3"},er={class:"text-xs text-gray-500 mt-0.5"},tr={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],l=D(()=>{var m;if(!((m=s.opportunity)!=null&&m.contractDate))return 0;const y=new Date(s.opportunity.contractDate),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),c=()=>{u("prepare-delivery",s.opportunity)},r=()=>{u("pre-delivery-checklist",s.opportunity)},i=y=>{u("survey-completed",{opportunity:s.opportunity,responses:y})},n=()=>{u("survey-refused",{opportunity:s.opportunity})},p=()=>{u("not-responding",{opportunity:s.opportunity})};return(y,f)=>(a(),d("div",Zi,[e("div",_i,[e("div",null,[f[0]||(f[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",er,"Contract was signed "+g(l.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:r,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),U(ce,{questions:o,onSurveyCompleted:i,onSurveyRefused:n,onNotResponding:p})]))}},sr={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},or={class:"flex justify-between items-start mb-3"},lr={class:"text-xs text-gray-500 mt-0.5"},ar={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:h}){const s=t,u=h,o=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],l=D(()=>{const p=s.activities.find(m=>{var $;return m.type==="delivery"||(($=m.action)==null?void 0:$.toLowerCase().includes("delivered"))});if(!p||!p.timestamp)return 0;const y=new Date(p.timestamp),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),c=()=>{u("delivery-feedback",s.opportunity)},r=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),d("div",sr,[e("div",or,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",lr,"Vehicle was delivered "+g(l.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:c,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),U(ce,{questions:o,onSurveyCompleted:r,onSurveyRefused:i,onNotResponding:n})]))}},nr={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},ir={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:h}){const s=t,u=h,o=()=>{u("close-won",s.opportunity)},l=()=>{u("close-lost",s.opportunity)};return(c,r)=>(a(),d("div",nr,[r[2]||(r[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:o,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...r[0]||(r[0]=[I(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:l,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...r[1]||(r[1]=[I(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},rr={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},dr={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},ur={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},cr={class:"p-5 space-y-6"},mr={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},pr={class:"flex gap-3"},yr={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},fr={class:"flex items-start gap-3"},gr={class:"flex-1"},vr={class:"font-bold text-slate-800 text-sm mb-1"},br={key:0},xr={key:1},hr={class:"text-xs text-gray-600"},wr={key:0},kr={key:1},$r={key:2},Cr={class:"flex justify-between items-start mb-3"},Sr={class:"font-bold text-slate-800 text-sm"},Dr={key:0},Ar={key:1},Tr={class:"text-xs text-gray-500 mt-0.5"},qr={key:0},Or={key:1},Nr={class:"flex gap-3 flex-wrap"},Ir={key:0,class:"mt-4"},Mr={class:"[&>div]:mb-0"},Rr={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},jr={class:"flex justify-between items-start mb-3"},Vr={class:"text-xs text-gray-500 mt-0.5"},Fr={key:0,class:"pt-4"},Lr={key:4,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},Ur={key:5,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Er={class:"flex justify-between items-start mb-3"},Wr={class:"text-xs text-gray-500 mt-0.5"},Br={key:12,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},Pr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},zr={class:"p-6"},Qr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Yr={class:"p-6"},Hr={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:h}){const s=t,u=h,o=D(()=>{var w,k,j;return((w=s.opportunity)==null?void 0:w.stage)==="Closed"||((k=s.opportunity)==null?void 0:k.stage)==="Closed Lost"||((j=s.opportunity)==null?void 0:j.stage)==="Registration"}),l=C(!1),c=C(!1),r=C(null),i=C(!1),n=C(""),p=C(!1),y=C(!1),f=C(!1),b=C(!1),m=C(!1),$=C([]),q=Se(),M=Fe(),L=Ce();le(()=>{$.value=Ve.filter(w=>w.stockDays!==null&&w.stockDays!==void 0).slice(0,5).map(w=>({id:w.id,brand:w.brand,model:w.model,year:w.year,price:w.price,image:w.image||"",stockDays:w.stockDays}))});const W=w=>{n.value=w,i.value=!0},se=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",z=w=>w?new Date(w).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",B=()=>{l.value=!l.value},N=w=>{l.value=!1},X=D(()=>{var Y;if(!((Y=s.opportunity)!=null&&Y.createdAt))return 0;const w=new Date(s.opportunity.createdAt),j=Math.abs(new Date-w);return Math.ceil(j/(1e3*60*60*24))}),ie=D(()=>{var k,j;return s.activities.some(Y=>Y.type==="offer")||((k=s.opportunity)==null?void 0:k.stage)==="In Negotiation"||((j=s.opportunity)==null?void 0:j.stage)==="Closed"}),Z=D(()=>s.activities.some(w=>w.type==="appointment")),S=D(()=>{var j,Y,H,_;const w=((j=s.opportunity)==null?void 0:j.contractDate)!==null&&((Y=s.opportunity)==null?void 0:Y.contractDate)!==void 0,k=s.activities.some(K=>{var G,ae;return((G=K.action)==null?void 0:G.toLowerCase().includes("won"))||((ae=K.action)==null?void 0:ae.toLowerCase().includes("contract"))});return w||k||((H=s.opportunity)==null?void 0:H.stage)==="Closed"&&((_=s.opportunity)==null?void 0:_.probability)===100}),A=D(()=>s.activities.some(w=>{var k,j;return w.type==="delivery"||((k=w.action)==null?void 0:k.toLowerCase().includes("delivered"))||((j=w.action)==null?void 0:j.toLowerCase().includes("delivery"))})),P=D(()=>{var k;if(((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ie.value||s.scheduledAppointment||Z.value)return!1;const w=X.value;return w>=7&&w<14}),x=D(()=>{var k;return((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ie.value||s.scheduledAppointment||Z.value?!1:X.value>=14}),E=D(()=>{var k;return((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ie.value||!s.scheduledAppointment?!1:X.value>=7}),ye=D(()=>{const w=X.value;return w>=14?"high":w>=7?"medium":null}),ge=D(()=>{var H;if(((H=s.opportunity)==null?void 0:H.stage)!=="In Negotiation")return!1;const w=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),j=Math.abs(new Date-w),Y=Math.ceil(j/(1e3*60*60*24));return!S.value&&Y>=5}),De=D(()=>{var G,ae,Oe;if(((G=s.opportunity)==null?void 0:G.stage)!=="In Negotiation")return!1;const w=((ae=s.opportunity)==null?void 0:ae.contractDate)!==null&&((Oe=s.opportunity)==null?void 0:Oe.contractDate)!==void 0,k=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||Z.value&&s.activities.some(xe=>{var Ne;return xe.type==="appointment"&&((Ne=xe.data)!=null&&Ne.datetime)?new Date(xe.data.datetime)>new Date:!1}),j=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),H=Math.abs(new Date-j);return Math.ceil(H/(1e3*60*60*24))>=5&&!w&&!k}),Ee=D(()=>{var K,G,ae;if(((K=s.opportunity)==null?void 0:K.stage)!=="Closed"&&((G=s.opportunity)==null?void 0:G.stage)!=="Registration")return!1;const w=(ae=s.opportunity)==null?void 0:ae.contractDate;if(!w||A.value)return!1;const k=new Date(w),Y=Math.abs(new Date-k);return Math.ceil(Y/(1e3*60*60*24))>=7}),We=D(()=>{const w=s.activities.find(K=>{var G;return K.type==="delivery"||((G=K.action)==null?void 0:G.toLowerCase().includes("delivered"))});if(!w)return!1;const k=new Date(w.timestamp),Y=Math.abs(new Date-k);return Math.ceil(Y/(1e3*60*60*24))>=3}),Be=D(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const j=s.activities.some(H=>{var _,K,G;return H.type==="appointment"&&(((_=H.data)==null?void 0:_.status)==="completed"||((K=H.action)==null?void 0:K.toLowerCase().includes("completed")))&&((G=H.data)==null?void 0:G.appointmentId)===s.scheduledAppointment.id}),Y=s.scheduledAppointment.status==="no-show";return!j&&!Y}),Pe=D(()=>!o.value),ze=D(()=>{var w,k,j;return!(((w=s.opportunity)==null?void 0:w.stage)!=="In Negotiation"||!((k=s.opportunity)!=null&&k.contractDate)||((j=s.opportunity)==null?void 0:j.stage)==="Closed")}),Qe=D(()=>{var H,_,K;if(((H=s.opportunity)==null?void 0:H.stage)!=="Closed"||!((_=s.opportunity)!=null&&_.contractDate)||A.value||((K=s.opportunity)==null?void 0:K.stage)==="Registration")return!1;const w=new Date(s.opportunity.contractDate),j=Math.abs(new Date-w);return Math.ceil(j/(1e3*60*60*24))>=7}),Ye=()=>{u("add-vehicle",s.opportunity)},He=()=>{W("Add Vehicle from Stock")},Je=()=>{W("Configure Vehicle")},ve=()=>{p.value=!0},Ae=()=>{p.value=!1},Ke=w=>{p.value=!1,u("create-offer",{opportunity:s.opportunity,offerData:w})},Ge=w=>{u("add-to-opportunity",w)},Xe=w=>{W("Review Opportunity")},Ze=w=>{f.value=!0},_e=w=>{f.value=!1},Te=w=>{c.value=!0,r.value=w},be=()=>{c.value=!1,r.value=null},et=w=>{Te("nfu")},tt=w=>{be();const k={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${w.type} on ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,date:w.date,time:w.time,datetime:`${w.date}T${w.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};u("appointment-created",k)},st=w=>{b.value=!0},ot=w=>{W("Pre-Delivery Checklist")},lt=w=>{b.value=!1},at=w=>{W("Delivery Feedback")},nt=()=>{qe()},it=()=>{y.value=!0},rt=w=>{},dt=w=>{y.value=!1},ut=()=>{W("Contact Customer")},re=w=>{},de=w=>{},ue=w=>{},ct=async()=>{try{await M.reopenOpportunity(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to reopen opportunity:",w)}},mt=async()=>{try{m.value=!1;const w=await M.convertOpportunityToLead(s.opportunity.id);L.canAccessLeads()?q.push({path:`/tasks/${w}`,query:{type:"lead"}}):q.push("/tasks/1")}catch(w){console.error("Failed to convert opportunity to lead:",w),m.value=!1}},pt=async()=>{try{await M.markAsRegistration(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as registration:",w)}},qe=async()=>{try{await M.markAsClosedWon(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as closed won:",w)}};return(w,k)=>t.opportunity?(a(),d("div",rr,[e("div",dr,[k[8]||(k[8]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")],-1)),e("span",ur,g(o.value?"Closed":"Active"),1)]),e("div",cr,[o.value?(a(),d("div",mr,[k[11]||(k[11]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",pr,[e("button",{onClick:ct,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[9]||(k[9]=[I(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:k[0]||(k[0]=j=>m.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...k[10]||(k[10]=[I(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):v("",!0),E.value?(a(),d("div",yr,[e("div",fr,[k[12]||(k[12]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",gr,[e("h4",vr,[ye.value==="high"?(a(),d("span",br,"High Risk")):(a(),d("span",xr,"At Risk"))]),e("p",hr,[ye.value==="high"?(a(),d("span",wr," This opportunity has been open for "+g(X.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(a(),d("span",kr," This opportunity has been open for "+g(X.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):v("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(a(),d("div",$r,[e("div",{class:O([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",Cr,[e("div",null,[e("h4",Sr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),d("span",Dr," Add Vehicle ")):(a(),d("span",Ar," Find Alternative "))]),e("p",Tr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),d("span",qr," The requested vehicle is available. Add it to the opportunity to proceed. ")):(a(),d("span",Or," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",Nr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),d("button",{key:0,onClick:Ye,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):v("",!0),e("button",{onClick:He,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:Je,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:ve,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(a(),d("div",Ir,[e("div",Mr,[U(ki,{onAddToOpportunity:Ge})])])):v("",!0)],2)])):v("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(a(),d("div",Rr,[e("div",jr,[e("div",null,[k[13]||(k[13]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",Vr,g(t.scheduledAppointment.title)+" on "+g(se(t.scheduledAppointment.start))+" at "+g(z(t.scheduledAppointment.start)),1)])]),e("button",{onClick:B,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),l.value?(a(),d("div",Fr,[U(Le,{show:l.value,onClose:k[1]||(k[1]=j=>l.value=!1),onConfirm:N},null,8,["show"])])):v("",!0)])):t.opportunity.stage==="Qualified"&&!Z.value?(a(),d("div",Lr,[k[14]||(k[14]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:k[2]||(k[2]=j=>Te("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):v("",!0),ze.value?(a(),d("div",Ur,[e("div",Er,[e("div",null,[k[15]||(k[15]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",Wr," Contract was signed on "+g(se(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:qe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[16]||(k[16]=[I(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):v("",!0),Be.value?(a(),F(Xi,{key:6,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:ut,onReschedule:w.openRescheduleModal,onAutoCloseLost:rt,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity","scheduled-appointment","onReschedule"])):v("",!0),x.value?(a(),F(Ei,{key:7,opportunity:t.opportunity,onCreateOffer:ve,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),P.value?(a(),F(Vi,{key:8,opportunity:t.opportunity,onCreateOffer:ve,onReview:Xe,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),De.value?(a(),F(Yi,{key:9,opportunity:t.opportunity,onScheduleClosing:et,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),ge.value?(a(),F(zi,{key:10,opportunity:t.opportunity,onCreateContract:Ze,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),Ee.value?(a(),F(tr,{key:11,opportunity:t.opportunity,onPrepareDelivery:st,onPreDeliveryChecklist:ot,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),Qe.value?(a(),d("div",Br,[k[18]||(k[18]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:pt,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[17]||(k[17]=[I(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):v("",!0),We.value?(a(),F(ar,{key:13,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:at,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity","activities"])):v("",!0),Pe.value?(a(),F(ir,{key:14,opportunity:t.opportunity,onCloseWon:nt,onCloseLost:it},null,8,["opportunity"])):v("",!0)]),U(xn,{show:i.value,title:n.value,onClose:k[3]||(k[3]=j=>i.value=!1)},null,8,["show","title"]),U(kn,{show:y.value,onConfirm:dt,onCancel:k[4]||(k[4]=j=>y.value=!1)},null,8,["show"]),U(Nn,{show:m.value,onConfirm:mt,onCancel:k[5]||(k[5]=j=>m.value=!1)},null,8,["show"]),U(Dn,{show:f.value,onConfirm:_e,onCancel:k[6]||(k[6]=j=>f.value=!1)},null,8,["show"]),U(On,{show:b.value,onConfirm:lt,onCancel:k[7]||(k[7]=j=>b.value=!1)},null,8,["show"]),(a(),F(he,{to:"body"},[p.value?(a(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:te(Ae,["self"])},[e("div",Pr,[e("div",zr,[U(di,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":$.value,onSave:Ke,onCancel:Ae},null,8,["task-id","requested-car","recommended-cars"])])])])):v("",!0)])),(a(),F(he,{to:"body"},[c.value?(a(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:te(be,["self"])},[e("div",Qr,[e("div",Yr,[U(Ue,{show:c.value,onConfirm:tt,onCancel:be},null,8,["show"])])])])):v("",!0)]))])):v("",!0)}},Jr={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},Kr={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},Gr={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},Xr={class:"text-[10px] font-bold uppercase tracking-wide"},Zr={key:1,class:"text-right"},_r={class:"text-sm font-bold text-gray-900"},ed={class:"mt-1.5"},td={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},sd={class:"text-[10px] text-gray-500 mt-0.5"},od=["onClick"],ld=["onClick"],ad=["onClick"],nd={class:"flex-1 flex flex-col overflow-hidden"},id={key:0,class:"lg:hidden xl:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},rd={key:1,class:"flex-1 flex items-center justify-center"},dd={key:0,class:"xl:hidden fixed inset-0 z-[60] bg-white"},yd={__name:"Tasks",setup(t){const h=vt(),s=Se(),u=je(),o=Fe(),l=Ce(),c=C("all"),r=C(null),i=C(!1),n=C(!1),p=D(()=>{const A=u.leads.filter(E=>!E.isDisqualified).map(E=>({...E,type:"lead",compositeId:`lead-${E.id}`})),P=o.opportunities.map(E=>({...E,type:"opportunity",compositeId:`opportunity-${E.id}`}));let x=[];return l.isOperator()?x=A:l.isSalesman()?x=P:x=[...A,...P],x.sort((E,ye)=>{const ge=new Date(E.lastActivity||E.createdAt||0);return new Date(ye.lastActivity||ye.createdAt||0)-ge})}),y=D(()=>c.value==="all"?p.value:p.value.filter(S=>S.type===c.value)),f=D(()=>{const S=p.value.some(P=>P.type==="lead"),A=p.value.some(P=>P.type==="opportunity");return S&&A}),b=D(()=>{const S=parseInt(h.params.id),A=h.query.type;if(A)return p.value.find(E=>E.id===S&&E.type===A)||null;const x=(c.value!=="all"?p.value.filter(E=>E.type===c.value):p.value).find(E=>E.id===S);return x||p.value.find(E=>E.id===S)||null}),m=D(()=>b.value?b.value.type==="lead"?u.currentLeadActivities:o.currentOpportunityActivities:[]),$=D(()=>b.value?b.value.type==="lead"?bn:Hr:null),q=D(()=>b.value?b.value.type==="lead"?{currentActivities:D(()=>u.currentLeadActivities),addActivity:(S,A)=>u.addActivity(S,A),updateActivity:(S,A,P)=>u.updateActivity(S,A,P),deleteActivity:(S,A)=>u.deleteActivity(S,A)}:{currentActivities:D(()=>o.currentOpportunityActivities),addActivity:(S,A)=>o.addActivity(S,A),updateActivity:(S,A,P)=>o.updateActivity(S,A,P),deleteActivity:(S,A)=>o.deleteActivity(S,A)}:null),M=D(()=>b.value?b.value.type==="lead"?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),L=D(()=>S=>S.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");le(()=>{u.loadLeads(),o.loadOpportunities();const S=h.params.id;S?se(S):W()});const W=()=>{const S=y.value[0];S&&s.replace({path:`/tasks/${S.id}`,query:{type:S.type}})};oe(()=>h.params.id,S=>{S?se(S):W()}),oe(b,S=>{S&&(S.type==="lead"?u.loadLeadById(S.id):o.loadOpportunityById(S.id))},{immediate:!0});const se=S=>{const A=parseInt(S),P=p.value.find(x=>x.id===A);P&&(P.type==="lead"?u.loadLeadById(A):o.loadOpportunityById(A))},z=S=>{const[A,P]=S.split("-");s.push({path:`/tasks/${P}`,query:{type:A}}),i.value=!1},B=S=>{r.value=r.value===S?null:S},N=S=>{r.value=null},X=async S=>{r.value=null,S.type==="lead"?await u.modifyLead(S.id,{priority:"Hot"}):S.type==="opportunity"&&await o.modifyOpportunity(S.id,{priority:"Hot"})},ie=async S=>{r.value=null,S.type==="lead"?await u.modifyLead(S.id,{priority:"Normal"}):S.type==="opportunity"&&await o.modifyOpportunity(S.id,{priority:"Normal"})},Z=S=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[S]||"bg-gray-100 text-gray-700 border-gray-200";return(S,A)=>{var P;return a(),d("div",Jr,[e("div",{class:O(["lg:relative lg:block",i.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[U(Ut,{title:"My Tasks",items:y.value,"selected-id":(P=b.value)==null?void 0:P.compositeId,"type-filter":c.value,"selected-class":x=>x.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":L.value,"open-menu-id":r.value,getName:x=>x.customer.name,getInitials:x=>x.customer.initials,getVehicleInfo:x=>x.type==="lead"?`${x.requestedCar.brand} ${x.requestedCar.model}`:`${x.vehicle.brand} ${x.vehicle.model}`,avatarClass:x=>x.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:z,onMenuClick:B,onMenuClose:A[0]||(A[0]=x=>r.value=null),onClose:A[1]||(A[1]=x=>i.value=!1),"show-type-filter":f.value,onFilterChange:A[2]||(A[2]=x=>c.value=x)},{badges:Q(({item:x})=>[e("span",{class:O(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",x.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(x.type==="lead"?"Lead":"Opportunity"),3),x.type==="lead"?(a(),d(J,{key:0},[e("span",Kr,g(x.status),1),x.priority==="Hot"?(a(),d("span",Gr,[...A[6]||(A[6]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),I(" Hot ",-1)])])):v("",!0)],64)):(a(),d("span",{key:1,class:O(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",Z(x.stage)])},g(x.stage),3))]),meta:Q(({item:x})=>[x.type==="lead"?(a(),d("div",{key:0,class:O(["flex items-center gap-1.5",V(fe)(x.nextActionDue)==="OVERDUE"?"text-red-500":x.priority==="Hot"?"text-orange-500":"text-gray-400"])},[e("i",{class:O(["text-[10px]",V(fe)(x.nextActionDue)==="OVERDUE"?"fa-solid fa-exclamation-triangle":"fa-solid fa-clock"])},null,2),e("span",Xr,g(V(fe)(x.nextActionDue)==="OVERDUE"?"OVERDUE":`Due in ${V(fe)(x.nextActionDue)}`),1)],2)):(a(),d("div",Zr,[e("div",_r,"€"+g(V(xt)(x.value)),1),e("div",ed,[e("div",td,[e("div",{class:O(["h-full rounded-full",x.probability>=70?"bg-green-500":x.probability>=40?"bg-blue-500":"bg-orange-500"]),style:bt({width:`${x.probability}%`})},null,6)]),e("div",sd,g(x.probability)+"% PROB",1)])]))]),menu:Q(({item:x})=>[e("button",{onClick:te(E=>N(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[7]||(A[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),I(" Reassign ",-1)])],8,od),x.priority!=="Hot"?(a(),d("button",{key:0,onClick:te(E=>X(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[8]||(A[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),I(" Mark as hot ",-1)])],8,ld)):(a(),d("button",{key:1,onClick:te(E=>ie(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[9]||(A[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),I(" Unmark as hot ",-1)])],8,ad))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),e("div",nd,[b.value?(a(),d("div",id,[e("button",{onClick:A[3]||(A[3]=x=>n.value=!n.value),class:"w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-all hover:scale-110",title:"Activity"},[...A[10]||(A[10]=[e("i",{class:"fa-solid fa-clock-rotate-left text-lg"},null,-1)])]),e("button",{onClick:A[4]||(A[4]=x=>i.value=!i.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...A[11]||(A[11]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])])):v("",!0),b.value?(a(),F(Zl,{key:2,task:b.value,type:b.value.type,"management-widget":$.value,"store-adapter":q.value,"add-new-config":M.value},{"pinned-extra":Q(({task:x})=>[x.type==="lead"&&x.requestedCar?(a(),F(Re,{key:0,brand:x.requestedCar.brand,model:x.requestedCar.model,year:x.requestedCar.year,image:x.requestedCar.image||"",price:x.requestedCar.price||null,"request-message":x.requestedCar.requestMessage||"","request-type":x.requestedCar.requestType||"",source:x.source||"",dealership:x.requestedCar.dealership||"",registration:x.requestedCar.registration||"",kilometers:x.requestedCar.kilometers||null,"fuel-type":x.requestedCar.fuelType||"","gear-type":x.requestedCar.gearType||"",vin:x.requestedCar.vin||"","stock-days":x.requestedCar.stockDays!==void 0?x.requestedCar.stockDays:null,channel:x.requestedCar.channel||"Email","ad-campaign":x.requestedCar.adCampaign||"","expected-purchase-date":x.requestedCar.expectedPurchaseDate||"","fiscal-entity":x.requestedCar.fiscalEntity||"","source-details":x.requestedCar.sourceDetails||"","ad-medium":x.requestedCar.adMedium||"","ad-source":x.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0),x.type==="opportunity"&&x.vehicle?(a(),F(Re,{key:1,brand:x.vehicle.brand,model:x.vehicle.model,year:x.vehicle.year,image:x.vehicle.image||"",price:x.vehicle.price||null,"request-message":x.vehicle.requestMessage||"","request-type":x.vehicle.requestType||"",source:x.source||"",dealership:x.vehicle.dealership||"",registration:x.vehicle.registration||"",kilometers:x.vehicle.kilometers||null,"fuel-type":x.vehicle.fuelType||"","gear-type":x.vehicle.gearType||"",vin:x.vehicle.vin||"","stock-days":x.vehicle.stockDays!==void 0?x.vehicle.stockDays:null,channel:x.vehicle.channel||"Email","ad-campaign":x.vehicle.adCampaign||"","expected-purchase-date":x.vehicle.expectedPurchaseDate||"","fiscal-entity":x.vehicle.fiscalEntity||"","source-details":x.vehicle.sourceDetails||"","ad-medium":x.vehicle.adMedium||"","ad-source":x.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(a(),d("div",rd,[...A[12]||(A[12]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),n.value&&b.value?(a(),d("div",dd,[U(Ie,{title:"Activity summary",activities:m.value,collapsed:!1,"show-collapse":!1,show:!0,"mobile-fullscreen":!0,onClose:A[5]||(A[5]=x=>n.value=!1),class:"flex w-full h-full"},null,8,["activities"])])):v("",!0),U(Ie,{title:"Activity summary",activities:m.value,collapsed:!1,"show-collapse":!1,show:!!b.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{yd as default};
