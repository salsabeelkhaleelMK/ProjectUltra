import{e as a,g as y,o,h as e,t as m,F as z,i as K,n as j,j as I,r as D,J as Fe,z as N,w as oe,c as O,l as W,C as te,B as L,k as ke,H as $e,K as yt,d as Ze,p as B,L as G,m as E,M as ft,N as gt,T as je,u as Be,y as vt,A as Xe,D as st,G as nt,O as we,P as bt}from"./index-BWBI-39A.js";import{_ as xt,u as at}from"./ReassignUserModal-BGYPf12H.js";import{g as ht,b as wt,c as kt,f as Ne,d as Ee}from"./formatters-BG48v0Hy.js";import{u as it}from"./opportunities-BqbHAwj_.js";import{_ as Oe}from"./ModalShell-BIWc87zS.js";const $t={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Ct={class:"flex items-center gap-3"},St=["title"],Dt={key:0,class:"fa-solid fa-arrow-left text-sm"},At={key:1,class:"fa-solid fa-arrow-right text-sm"},Tt={key:2,class:"font-bold text-lg text-gray-800"},Ot={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Vt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},It={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Nt={class:"text-sm"},jt={key:2,class:"space-y-6 relative z-10"},Rt={key:0,class:"mb-4 pl-12"},qt={class:"text-sm font-semibold text-gray-800"},Mt={class:"flex gap-4 relative mb-6"},Ut={class:"flex-1 min-w-0"},Lt={class:"text-sm text-slate-700 leading-snug"},Ft={class:"font-bold"},Et={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},Bt={class:"text-xs text-gray-400 mt-1"},Wt={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},Pt={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 z-0"},zt={key:1,class:"space-y-4 relative z-10"},Qt=["title"],Yt={key:2,class:"text-center py-8 text-gray-400 relative z-10"},Ht={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:k}){const s=t,f=c=>{const d={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return d[c]||d.default},l=c=>{const d={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return d[c]||d.default},n=c=>{if(!c)return"";const d=new Date(c),r=new Date,v=new Date(r);return v.setDate(v.getDate()-1),d.toDateString()===r.toDateString()?"Today":d.toDateString()===v.toDateString()?"Yesterday":d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},g=c=>c?new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",u=(c,d)=>{if(c===0)return!0;const r=s.activities[c-1];if(!r)return!0;const v=new Date(d.timestamp).toDateString(),w=new Date(r.timestamp).toDateString();return v!==w};return(c,d)=>t.show?(o(),a("div",{key:0,class:j(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",$t,[e("div",Ct,[t.mobileFullscreen?(o(),a("button",{key:0,onClick:d[0]||(d[0]=r=>c.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(o(),a("button",{key:1,onClick:d[1]||(d[1]=r=>c.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(o(),a("i",Dt)):(o(),a("i",At))],8,St)):y("",!0),t.collapsed?y("",!0):(o(),a("h2",Tt,m(t.title),1))])]),t.collapsed?(o(),a("div",Wt,[t.activities.length>0?(o(),a("div",Pt)):y("",!0),t.activities.length>0?(o(),a("div",zt,[(o(!0),a(z,null,K(t.activities,r=>(o(),a("div",{key:r.id,class:"relative"},[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white border-2 border-gray-200",l(r.type)]),title:`${r.user} ${r.action}`},[e("i",{class:j([f(r.type),"text-xs"])},null,2)],10,Qt)]))),128))])):(o(),a("div",Yt,[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(o(),a("div",Ot,[t.activities.length>0?(o(),a("div",Vt)):y("",!0),t.activities.length===0?(o(),a("div",It,[d[3]||(d[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Nt,m(t.emptyMessage),1)])):(o(),a("div",jt,[(o(!0),a(z,null,K(t.activities,(r,v)=>(o(),a(z,{key:r.id},[u(v,r)?(o(),a("div",Rt,[e("h3",qt,m(n(r.timestamp)),1)])):y("",!0),e("div",Mt,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",l(r.type)])},[e("i",{class:j([f(r.type),"text-sm"])},null,2)],2),e("div",Ut,[e("div",Lt,[e("span",Ft,m(r.user),1),I(" "+m(r.action),1)]),r.content?(o(),a("div",Et,m(r.content),1)):y("",!0),e("div",Bt,m(g(r.timestamp)),1)])])],64))),128))]))]))],2)):y("",!0)}},Kt={class:"w-full"},Gt={class:"flex items-center justify-between gap-3 md:gap-4"},Jt={class:"flex items-center gap-3 md:gap-4 flex-1"},Xt={class:"min-w-0 flex-1"},Zt={class:"flex items-center gap-2"},_t={class:"heading-main truncate"},es={class:"flex flex-wrap items-center gap-2 mt-1"},ts={class:"flex items-center gap-1 ml-2"},ss={class:"relative"},os={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-50 overflow-hidden flex flex-col p-1"},ls={key:0,class:"border-t border-gray-100 my-1"},ns={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},as={class:"flex items-center gap-4"},is={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},rs={class:"flex items-center gap-2"},ds={class:"text-xs text-gray-900 font-medium"},us={class:"flex items-center gap-2"},cs={class:"text-xs text-gray-900 font-medium"},ms={class:"flex items-center gap-2"},ps={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},ys={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},fs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},gs={class:"text-xs text-gray-900 font-medium"},vs={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},bs={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action"],setup(t,{emit:k}){const s={mounted(d,r){d.clickOutsideEvent=v=>{d===v.target||d.contains(v.target)||r.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},f=k,l=D(!1),n=D(!1),g=D(null),u=d=>{n.value=!1,f("action",d)},c=async(d,r)=>{try{await navigator.clipboard.writeText(d),g.value=r,setTimeout(()=>{g.value=null},1500)}catch(v){console.error("Failed to copy:",v)}};return(d,r)=>(o(),a("div",Kt,[e("div",Gt,[e("div",Jt,[e("div",{class:j(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},m(t.initials),3),e("div",Xt,[e("div",Zt,[e("h1",_t,m(t.name),1),Fe(d.$slots,"name-action")]),e("div",es,[Fe(d.$slots,"tags")])])]),e("div",ts,[e("div",ss,[e("button",{onClick:r[0]||(r[0]=oe(v=>n.value=!n.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors"},[...r[14]||(r[14]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),n.value?N((o(),a("div",os,[e("button",{onClick:r[1]||(r[1]=v=>u("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note "),e("button",{onClick:r[2]||(r[2]=v=>u("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing "),e("button",{onClick:r[3]||(r[3]=v=>u("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in "),e("button",{onClick:r[4]||(r[4]=v=>u("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase "),e("button",{onClick:r[5]||(r[5]=v=>u("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment "),r[19]||(r[19]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),e("button",{onClick:r[6]||(r[6]=v=>u("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...r[15]||(r[15]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),I(" WhatsApp msg ",-1)])]),e("button",{onClick:r[7]||(r[7]=v=>u("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...r[16]||(r[16]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),I(" Email ",-1)])]),e("button",{onClick:r[8]||(r[8]=v=>u("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...r[17]||(r[17]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),I(" SMS ",-1)])]),e("button",{onClick:r[9]||(r[9]=v=>u("call")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...r[18]||(r[18]=[e("i",{class:"fa-solid fa-phone text-xs text-gray-400"},null,-1),I(" Call ",-1)])]),t.taskType==="opportunity"?(o(),a("div",ls)):y("",!0),t.taskType==="opportunity"?(o(),a("button",{key:1,onClick:r[10]||(r[10]=v=>u("appointment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Appointment ")):y("",!0)])),[[s,()=>n.value=!1]]):y("",!0)]),e("button",{onClick:r[11]||(r[11]=v=>l.value=!l.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:j(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])]),l.value?(o(),a("div",ns,[e("div",as,[e("div",is,[e("div",rs,[r[21]||(r[21]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ds,m(t.email),1),e("button",{onClick:r[12]||(r[12]=oe(v=>c(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...r[20]||(r[20]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",us,[r[23]||(r[23]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",cs,m(t.phone),1),e("button",{onClick:r[13]||(r[13]=oe(v=>c(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...r[22]||(r[22]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ms,[e("div",ps,[t.thirdFieldLabel.toLowerCase().includes("address")?(o(),a("i",ys)):(o(),a("i",fs))]),e("span",gs,m(t.thirdFieldValue),1)])])]),g.value?(o(),a("div",vs,m(g.value==="email"?"Email":"Phone")+" copied! ",1)):y("",!0)])):y("",!0)]))}},xs={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},hs=["onClick"],ws={class:"hidden md:inline whitespace-nowrap"},ks={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const k={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},s=f=>k[f]||"fa-solid fa-circle";return(f,l)=>(o(),a("div",xs,[(o(!0),a(z,null,K(t.tabs,n=>(o(),a("div",{key:n.key,onClick:g=>f.$emit("update:modelValue",n.key),class:j(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===n.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[e("i",{class:j([s(n.key),"text-base md:text-base"])},null,2),e("span",ws,m(n.label),1),n.count!==void 0?(o(),a("span",{key:0,class:j(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===n.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},m(n.count),3)):y("",!0)],10,hs))),128))]))}},$s={class:"metadata-bar w-full"},Cs={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},Ss={class:"text-[10px] md:text-xs font-bold text-gray-800"},Ds={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},As={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},Ts={class:"text-[10px] md:text-xs font-bold text-gray-800"},Os={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""}},emits:["reassign"],setup(t){return(k,s)=>(o(),a("div",$s,[e("div",Cs,[s[1]||(s[1]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Stage",-1)),e("span",Ss,m(t.stage),1)]),s[5]||(s[5]=e("div",{class:"metadata-divider"},null,-1)),e("div",Ds,[s[2]||(s[2]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Owner",-1)),e("button",{onClick:s[0]||(s[0]=f=>k.$emit("reassign")),class:"text-[10px] md:text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},m(t.owner),1)]),t.source?(o(),a(z,{key:0},[s[4]||(s[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",As,[s[3]||(s[3]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Source",-1)),e("span",Ts,m(t.source),1)])],64)):y("",!0)]))}},Vs={key:0,class:"flex-grow border-t border-gray-200"},Is={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Ns={key:0,class:"border-t border-gray-100 my-1"},js={key:1,class:"flex-grow border-t border-gray-200"},Rs={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:k}){const s={mounted(T,p){T.clickOutsideEvent=b=>{T===b.target||T.contains(b.target)||p.value()},document.addEventListener("click",T.clickOutsideEvent)},unmounted(T){document.removeEventListener("click",T.clickOutsideEvent)}},f=t,l=k,n=D(!1),g=O(()=>f.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium w-9 h-9 rounded-lg shadow-sm transition-all flex items-center justify-center z-20 relative":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium w-9 h-9 rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative"),u={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},c=O(()=>{if(!f.activeTab||f.activeTab==="overview")return f.actions.filter(p=>!u[p]);const T=Object.entries(u).filter(([,p])=>p===f.activeTab).map(([p])=>p);return f.actions.filter(p=>T.includes(p))}),d=O(()=>c.value.some(T=>["email","whatsapp","sms"].includes(T))),r=O(()=>c.value.some(T=>["addVehicle","configureVehicle"].includes(T))),v=O(()=>c.value.some(T=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(T))),w=T=>{n.value=!1,l("action",T)};return(T,p)=>t.show?(o(),a("div",{key:0,class:j(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?y("",!0):(o(),a("div",Vs)),e("div",{class:j(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:p[0]||(p[0]=oe(b=>n.value=!n.value,["stop"])),class:j(g.value)},[...p[12]||(p[12]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1)])],2),n.value?N((o(),a("div",Is,[r.value?(o(),a(z,{key:0},[c.value.includes("addVehicle")?(o(),a("button",{key:0,onClick:p[1]||(p[1]=b=>w("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):y("",!0),c.value.includes("configureVehicle")?(o(),a("button",{key:1,onClick:p[2]||(p[2]=b=>w("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):y("",!0)],64)):y("",!0),v.value?(o(),a(z,{key:1},[r.value?(o(),a("div",Ns)):y("",!0),c.value.includes("note")?(o(),a("button",{key:1,onClick:p[3]||(p[3]=b=>w("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):y("",!0),c.value.includes("financing")?(o(),a("button",{key:2,onClick:p[4]||(p[4]=b=>w("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):y("",!0),c.value.includes("tradein")?(o(),a("button",{key:3,onClick:p[5]||(p[5]=b=>w("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):y("",!0),c.value.includes("requestedCar")?(o(),a("button",{key:4,onClick:p[6]||(p[6]=b=>w("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):y("",!0),c.value.includes("purchase")?(o(),a("button",{key:5,onClick:p[7]||(p[7]=b=>w("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):y("",!0),c.value.includes("attachment")?(o(),a("button",{key:6,onClick:p[8]||(p[8]=b=>w("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):y("",!0)],64)):y("",!0),d.value?(o(),a(z,{key:2},[p[16]||(p[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),c.value.includes("email")?(o(),a("button",{key:0,onClick:p[9]||(p[9]=b=>w("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[13]||(p[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),I(" Send Email ",-1)])])):y("",!0),c.value.includes("whatsapp")?(o(),a("button",{key:1,onClick:p[10]||(p[10]=b=>w("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[14]||(p[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),I(" Send WhatsApp ",-1)])])):y("",!0),c.value.includes("sms")?(o(),a("button",{key:2,onClick:p[11]||(p[11]=b=>w("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[15]||(p[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),I(" Send SMS ",-1)])])):y("",!0)],64)):y("",!0)])),[[s,()=>n.value=!1]]):y("",!0)],2),t.inline?y("",!0):(o(),a("div",js))],2)):y("",!0)}},qs={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Ms={class:"flex items-start gap-3"},Us={class:"flex-1 min-w-0"},Ls={class:"font-bold text-sm text-slate-800 mb-2"},Fs={class:"space-y-1.5 text-xs text-gray-600"},Es={class:"flex items-center gap-2"},Bs={class:"flex items-center gap-2"},Ws={class:"flex items-center gap-2"},Ps={key:0,class:"mt-2"},zs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const k=t,s=O(()=>k.appointmentData.date?new Date(k.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),f=O(()=>k.appointmentData.time?k.appointmentData.time:""),l=n=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[n==null?void 0:n.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(n,g)=>(o(),a("div",qs,[e("div",Ms,[g[3]||(g[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Us,[e("h4",Ls,m(t.appointmentData.type),1),e("div",Fs,[e("div",Es,[g[0]||(g[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,m(s.value),1)]),e("div",Bs,[g[1]||(g[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,m(f.value),1)]),e("div",Ws,[g[2]||(g[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,m(t.appointmentData.assignee),1)])]),t.appointmentData.status?(o(),a("div",Ps,[e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",l(t.appointmentData.status)])},m(t.appointmentData.status),3)])):y("",!0)])])]))}},Qs={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Ys={class:"flex-1"},Hs={class:"flex items-center gap-2 mb-1"},Ks={class:"text-xs font-bold text-slate-800"},Gs={class:"text-[10px] text-gray-400"},Js={class:"text-[10px] text-gray-400"},Xs={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},Zs={class:"ml-auto relative"},_s={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},eo={key:0,class:"text-sm text-slate-700"},to={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},so={key:2,class:"mt-2"},oo={key:0},lo={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},no={key:0},ao={class:"text-sm font-bold text-slate-800"},io={key:0,class:"text-xs text-gray-600 mt-0.5"},ro={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},uo={key:0},co={key:1},mo={key:2},po={key:3},yo={key:4},fo={key:1},go={class:"text-sm font-bold text-slate-800 mb-2"},vo={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},bo={key:0},xo={class:"text-slate-700 font-medium ml-1"},ho={key:1},wo={class:"text-slate-700 font-medium ml-1"},ko={key:2},$o={class:"text-slate-700 font-medium ml-1"},Co={key:3},So={class:"text-slate-700 font-medium ml-1"},Do={key:4},Ao={class:"text-slate-700 font-medium ml-1"},To={key:5},Oo={class:"text-slate-700 font-medium ml-1"},Vo={key:2,class:"flex items-center gap-3"},Io={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},No=["src"],jo={class:"flex-1"},Ro={class:"text-sm font-bold text-slate-800"},qo={class:"text-xs text-gray-500"},Mo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Uo={key:3,class:"flex items-center gap-3"},Lo={class:"flex-1"},Fo={class:"text-sm font-bold text-slate-800"},Eo={class:"text-xs text-gray-500"},Bo={key:0,class:"text-xs text-gray-400 mt-1"},Wo={key:1,class:"text-xs text-gray-600 mt-1"},Po={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:k}){const s=t,f=k,l=D(!1),n={mounted(T,p){T.clickOutsideEvent=b=>{T===b.target||T.contains(b.target)||p.value()},setTimeout(()=>{document.addEventListener("click",T.clickOutsideEvent)},0)},unmounted(T){document.removeEventListener("click",T.clickOutsideEvent)}},g=T=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[T]||"fa-solid fa-circle",u=T=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[T]||"bg-gray-100 text-gray-600 border-gray-200",c=T=>{if(!T)return"Just now";const p=new Date(T),$=new Date-p,S=Math.floor($/6e4),x=Math.floor(S/60),A=Math.floor(x/24);return S<1?"Just now":S<60?`${S} minutes ago`:x<24?`${x} hours ago`:A===1?"Yesterday":A<7?`${A} days ago`:p.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=T=>T?new Intl.NumberFormat("en-US").format(T):"0",r=T=>T?new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",v=()=>{l.value=!1,f("edit",s.item)},w=()=>{l.value=!1,confirm("Are you sure you want to delete this item?")&&f("delete",s.item)};return(T,p)=>(o(),a("div",Qs,[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",u(t.item.type)])},[e("i",{class:j([g(t.item.type),"text-sm"])},null,2)],2),e("div",Ys,[e("div",Hs,[e("span",Ks,m(t.customerInitials),1),e("span",Gs,m(t.item.action||"added"),1),e("span",Js,"• "+m(c(t.item.timestamp)),1),t.item.autoDetected?(o(),a("span",Xs,"Auto-detected")):y("",!0),e("div",Zs,[e("button",{onClick:p[0]||(p[0]=oe(b=>l.value=!l.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...p[1]||(p[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),l.value?N((o(),a("div",_s,[e("button",{onClick:v,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),I(" Edit ",-1)])]),e("button",{onClick:w,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...p[3]||(p[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),I(" Delete ",-1)])])])),[[n,()=>l.value=!1]]):y("",!0)])]),t.item.content?(o(),a("div",eo,m(t.item.content),1)):y("",!0),t.item.fileName?(o(),a("div",to,[p[4]||(p[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,m(t.item.fileName),1)])):y("",!0),t.item.data?(o(),a("div",so,[t.item.type==="appointment"?(o(),a("div",oo,[W(zs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(o(),a("div",lo,[t.item.type==="tradein"?(o(),a("div",no,[e("h4",ao,m(t.item.data.brand)+" "+m(t.item.data.model),1),t.item.data.version?(o(),a("p",io,m(t.item.data.version),1)):y("",!0),e("div",ro,[t.item.data.year?(o(),a("div",uo,[p[5]||(p[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),I(m(t.item.data.year),1)])):y("",!0),t.item.data.km?(o(),a("div",co,[p[6]||(p[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),I(m(t.item.data.km)+" km ",1)])):y("",!0),t.item.data.plate?(o(),a("div",mo,[p[7]||(p[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),I(m(t.item.data.plate),1)])):y("",!0),t.item.data.date?(o(),a("div",po,[p[8]||(p[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),I(m(r(t.item.data.date)),1)])):y("",!0),t.item.data.class?(o(),a("div",yo,[p[9]||(p[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),I(m(t.item.data.class),1)])):y("",!0)])])):t.item.type==="financing"?(o(),a("div",fo,[e("h4",go,m(t.item.data.product),1),e("div",vo,[t.item.data.provider?(o(),a("div",bo,[p[10]||(p[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",xo,m(t.item.data.provider),1)])):y("",!0),t.item.data.total?(o(),a("div",ho,[p[11]||(p[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",wo,"€"+m(d(t.item.data.total)),1)])):y("",!0),t.item.data.monthly?(o(),a("div",ko,[p[12]||(p[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",$o,"€"+m(d(t.item.data.monthly)),1)])):y("",!0),t.item.data.deposit?(o(),a("div",Co,[p[13]||(p[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",So,"€"+m(d(t.item.data.deposit)),1)])):y("",!0),t.item.data.startDate?(o(),a("div",Do,[p[14]||(p[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Ao,m(r(t.item.data.startDate)),1)])):y("",!0),t.item.data.expDate?(o(),a("div",To,[p[15]||(p[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Oo,m(r(t.item.data.expDate)),1)])):y("",!0)])])):t.item.type==="offer"?(o(),a("div",Vo,[t.item.data.image?(o(),a("div",Io,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,No)])):y("",!0),e("div",jo,[e("h4",Ro,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",qo,"€ "+m(d(t.item.data.price)),1)]),t.item.data.isMainOffer?(o(),a("span",Mo,"Main Offer")):y("",!0)])):t.item.type==="purchase"?(o(),a("div",Uo,[e("div",Lo,[e("h4",Fo,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",Eo,"€ "+m(d(t.item.data.price)),1),t.item.data.purchaseDate?(o(),a("p",Bo,"Purchased: "+m(r(t.item.data.purchaseDate)),1)):y("",!0),t.item.data.notes?(o(),a("p",Wo,m(t.item.data.notes),1)):y("",!0)])])):y("",!0)]))])):y("",!0)])]))}},zo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Qo={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Yo={class:"mb-3"},Ho={class:"flex justify-end gap-2"},Ko={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D(""),n=D(""),g=()=>{!l.value.trim()&&!n.value||f("save",{type:"communication",action:`sent via ${s.type}`,content:l.value||`Sent template: ${n.value}`,communicationType:s.type})};return(u,c)=>(o(),a("div",zo,[c[5]||(c[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Qo,m(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Yo,[c[4]||(c[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),N(e("select",{"onUpdate:modelValue":c[0]||(c[0]=d=>n.value=d),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...c[3]||(c[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[te,n.value]])]),N(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=d=>l.value=d),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[L,l.value]]),e("div",Ho,[e("button",{onClick:c[2]||(c[2]=d=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:g,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},Go={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Jo={class:"flex justify-between items-center mb-4"},Xo={class:"text-sm font-bold text-slate-800"},Zo={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},rt={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D("");ke(()=>{s.item&&(l.value=s.item.content||"")});const n=()=>{var g,u;l.value.trim()&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:l.value,timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",Go,[u[5]||(u[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Jo,[e("h5",Xo,m(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:u[0]||(u[0]=c=>g.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[u[4]||(u[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),N(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=c=>l.value=c),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[L,l.value]])]),e("div",Zo,[e("button",{onClick:u[2]||(u[2]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},_o={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},el={class:"flex justify-between items-center mb-4"},tl={class:"text-sm font-bold text-slate-800"},sl={class:"flex items-center gap-3"},ol={key:0,class:"text-sm text-slate-600"},ll={key:1,class:"text-sm text-gray-400"},nl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},al=["disabled"],il={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D(null),n=D("");ke(()=>{s.item&&(n.value=s.item.fileName||"")});const g=c=>{const d=c.target.files[0];d&&(l.value=d,n.value=d.name)},u=()=>{var c,d;!l.value&&!s.item||f("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:n.value,timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,d)=>(o(),a("div",_o,[d[6]||(d[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",el,[e("h5",tl,m(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:d[0]||(d[0]=r=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[d[5]||(d[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",sl,[e("input",{type:"file",onChange:g,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:d[1]||(d[1]=r=>c.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),I("Choose File ",-1)])]),n.value?(o(),a("span",ol,m(n.value),1)):(o(),a("span",ll,"No file selected"))])]),e("div",nl,[e("button",{onClick:d[2]||(d[2]=r=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:u,disabled:!l.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,al)])]))}},rl={class:"animate-fade-in"},dl={class:"space-y-4"},ul={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},cl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ml={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},pl=["disabled"],yl={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ke(()=>{s.item&&s.item.data&&(l.value={startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",productName:s.item.data.product||s.item.data.productName||"",deposit:s.item.data.deposit||"",loanAmount:s.item.data.total||s.item.data.loanAmount||""})});const n=()=>{var g,u;l.value.productName&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"financing",action:s.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",rl,[e("div",dl,[e("div",ul,[e("div",null,[u[6]||(u[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),N(e("input",{type:"date","onUpdate:modelValue":u[0]||(u[0]=c=>l.value.startDate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.startDate]])]),e("div",null,[u[7]||(u[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":u[1]||(u[1]=c=>l.value.expDate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.expDate]])])]),e("div",null,[u[8]||(u[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),N(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=c=>l.value.productName=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.productName]])]),e("div",cl,[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=c=>l.value.deposit=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.deposit]])]),e("div",null,[u[10]||(u[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>l.value.loanAmount=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.loanAmount]])])])]),e("div",ml,[e("button",{onClick:u[5]||(u[5]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,pl)])]))}},fl={class:"animate-fade-in"},gl={class:"space-y-4"},vl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},hl=["disabled"],wl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ke(()=>{s.item&&s.item.data&&(l.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const n=()=>{var g,u;l.value.brand&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",fl,[e("div",gl,[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),N(e("select",{"onUpdate:modelValue":u[0]||(u[0]=c=>l.value.class=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...u[8]||(u[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[te,l.value.class]])]),e("div",vl,[e("div",null,[u[10]||(u[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),N(e("input",{type:"text","onUpdate:modelValue":u[1]||(u[1]=c=>l.value.brand=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.brand]])]),e("div",null,[u[11]||(u[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),N(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=c=>l.value.model=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.model]])])]),e("div",null,[u[12]||(u[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),N(e("input",{type:"text","onUpdate:modelValue":u[3]||(u[3]=c=>l.value.version=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.version]])]),e("div",bl,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),N(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>l.value.km=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.km]])]),e("div",null,[u[14]||(u[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),N(e("input",{type:"text","onUpdate:modelValue":u[5]||(u[5]=c=>l.value.plate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.plate]])])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":u[6]||(u[6]=c=>l.value.date=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[L,l.value.date]])])]),e("div",xl,[e("button",{onClick:u[7]||(u[7]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,hl)])]))}},kl={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},$l={class:"flex justify-between items-center mb-4"},Cl={class:"text-sm font-bold text-slate-800"},Sl={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Dl={class:"flex items-center gap-3"},Al={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Tl=["src"],Ol={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Vl={class:"font-bold text-sm text-gray-800"},Il={class:"text-xs text-gray-500"},Nl={class:"space-y-4"},jl={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ql=["disabled"],dt={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});ke(()=>{if(s.selectedVehicle){l.value.price=s.selectedVehicle.price||0,l.value.brand=s.selectedVehicle.brand||"",l.value.model=s.selectedVehicle.model||"",l.value.year=s.selectedVehicle.year||"",l.value.image=s.selectedVehicle.image||"";const c=new Date;c.setDate(c.getDate()+30),l.value.validUntil=c.toISOString().split("T")[0]}s.item&&s.item.data&&(l.value={...l.value,...s.item.data,price:s.item.data.price||s.item.data.total||0,financingType:s.item.data.financingType||s.item.data.paymentMethod||"",notes:s.item.data.notes||s.item.data.description||""})}),$e(()=>s.selectedVehicle,c=>{c&&!s.item&&(l.value.price=c.price||0,l.value.brand=c.brand||"",l.value.model=c.model||"",l.value.year=c.year||"",l.value.image=c.image||"")});const n=O(()=>l.value.price>0&&l.value.financingType!==""),g=c=>c?c.toLocaleString("en-US"):"0",u=()=>{var d,r;if(!n.value)return;const c={id:((d=s.item)==null?void 0:d.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"created an offer",data:{brand:l.value.brand,model:l.value.model,year:l.value.year,price:l.value.price,total:l.value.price,paymentMethod:l.value.financingType,financingType:l.value.financingType,downPayment:l.value.downPayment,monthlyPayment:l.value.monthlyPayment,term:l.value.term,interestRate:l.value.interestRate,deliveryDate:l.value.deliveryDate,validUntil:l.value.validUntil,notes:l.value.notes,description:l.value.notes,image:l.value.image},timestamp:((r=s.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!s.item};f("save",c)};return(c,d)=>(o(),a("div",kl,[e("div",$l,[e("h5",Cl,m(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:d[0]||(d[0]=r=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[11]||(d[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.selectedVehicle?(o(),a("div",Sl,[d[12]||(d[12]=e("p",{class:"text-xs text-gray-500 mb-2"},"Creating offer for:",-1)),e("div",Dl,[e("div",Al,[t.selectedVehicle.image?(o(),a("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Tl)):(o(),a("i",Ol))]),e("div",null,[e("h4",Vl,m(t.selectedVehicle.brand)+" "+m(t.selectedVehicle.model)+" ("+m(t.selectedVehicle.year)+") ",1),e("p",Il,"Base Price: € "+m(g(t.selectedVehicle.price)),1)])])])):y("",!0),e("div",Nl,[e("div",null,[d[13]||(d[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[I(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),N(e("input",{type:"number","onUpdate:modelValue":d[1]||(d[1]=r=>l.value.price=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"Enter offer price"},null,512),[[L,l.value.price]])]),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[I(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),N(e("select",{"onUpdate:modelValue":d[2]||(d[2]=r=>l.value.financingType=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...d[14]||(d[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[te,l.value.financingType]])]),l.value.financingType==="finance"||l.value.financingType==="lease"?(o(),a("div",jl,[e("div",null,[d[16]||(d[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Down Payment (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[3]||(d[3]=r=>l.value.downPayment=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"0"},null,512),[[L,l.value.downPayment]])]),e("div",null,[d[17]||(d[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=r=>l.value.monthlyPayment=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"Calculated automatically"},null,512),[[L,l.value.monthlyPayment]])]),e("div",null,[d[18]||(d[18]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Term (months)",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[5]||(d[5]=r=>l.value.term=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"36"},null,512),[[L,l.value.term]])]),e("div",null,[d[19]||(d[19]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Interest Rate (%)",-1)),N(e("input",{type:"number",step:"0.1","onUpdate:modelValue":d[6]||(d[6]=r=>l.value.interestRate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"3.5"},null,512),[[L,l.value.interestRate]])])])):y("",!0),e("div",null,[d[20]||(d[20]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expected Delivery Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":d[7]||(d[7]=r=>l.value.deliveryDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[L,l.value.deliveryDate]])]),e("div",null,[d[21]||(d[21]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Offer Valid Until",-1)),N(e("input",{type:"date","onUpdate:modelValue":d[8]||(d[8]=r=>l.value.validUntil=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[L,l.value.validUntil]])]),e("div",null,[d[22]||(d[22]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes / Special Terms",-1)),N(e("textarea",{"onUpdate:modelValue":d[9]||(d[9]=r=>l.value.notes=r),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 resize-none",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[L,l.value.notes]])])]),e("div",Rl,[e("button",{onClick:d[10]||(d[10]=r=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:u,disabled:!n.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},m(t.item?"Update Offer":"Create Offer"),9,ql)])]))}},Je={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function ot(t){if(!t)return Je.default;const k=t.toLowerCase().trim();return Je[k]||Je.default}function Ml({store:t,taskId:k,getTabForItemType:s,isOverviewModalAction:f}){const l=D(null),n=D(null),g=D("overview"),u=D("email"),c=D([]);$e(g,()=>{l.value=null,n.value=null});const d=O(()=>[...t.currentActivities.value,...c.value.filter($=>!$.activityId)].filter($=>{const S=s($.type);return g.value==="overview"?S==="overview":S===g.value}).sort(($,S)=>{const x=new Date($.timestamp||0);return new Date(S.timestamp||0)-x})),r=b=>(n.value=null,g.value==="overview"&&f&&f(b)?{type:"overview-modal",action:b}:(["email","sms","whatsapp","call"].includes(b)?(u.value=b,l.value="communication"):l.value=b,null)),v=async b=>{var $;if(b.isEdit){const S=c.value.findIndex(x=>x.id===b.id);S>-1&&(c.value[S]={...c.value[S],...b}),($=n.value)!=null&&$.activityId&&await t.updateActivity(k.value,n.value.activityId,{type:b.communicationType||b.type,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data})}else{const S=b.communicationType||b.type,x=await t.addActivity(k.value,{type:S,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data});c.value.push({id:x.id,type:S==="email"||S==="whatsapp"||S==="sms"?"communication":S,action:b.action,content:b.content,fileName:b.fileName,data:b.data,timestamp:x.timestamp,activityId:x.id})}l.value=null,n.value=null},w=()=>{l.value=null,n.value=null},T=b=>{s(b.type)&&(l.value=b.type==="email"||b.type==="whatsapp"||b.type==="sms"||b.type==="communication"?"communication":b.type,n.value=b)},p=async b=>{try{await t.deleteActivity(k.value,b)}catch($){throw console.error("Error deleting item:",$),$}};return{activeTab:g,showInlineWidget:l,inlineWidgetType:O(()=>l.value),editingItem:n,isEditing:O(()=>n.value!==null),communicationType:u,inlineContent:c,filteredInlineContent:d,handleAddNewAction:r,handleWidgetSave:v,handleWidgetCancel:w,handleEditItem:T,handleDeleteItem:p}}const Ul={class:"flex-1 flex flex-row overflow-hidden h-full"},Ll={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Fl={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},El={class:"px-4 md:px-8 py-4 md:py-6"},Bl={class:"flex items-center gap-3"},Wl={key:0,class:"text-xs font-normal opacity-75"},Pl={class:"flex items-center gap-2"},zl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Ql={class:"mb-4"},Yl={key:0,class:"mb-6"},Hl={key:1,class:"space-y-6 mb-6"},Kl={key:3},Gl={key:4,class:"space-y-4 mb-6 px-1"},Jl={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Xl={class:"p-6"},Zl={class:"flex justify-between items-center mb-4"},_l={class:"text-sm font-bold text-slate-800"},en={key:1,class:"max-w-2xl w-full max-h-[90vh] overflow-y-auto"},su={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(t,{emit:k}){const s=t,f=yt(),l=Ze(),n=O(()=>s.task.id),g=O(()=>s.type==="contact"?"bg-blue-100 text-blue-600":s.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),u=D(!1),c=D(new Set),d=O(()=>c.value.has(s.task.id)),r=()=>{c.value.add(s.task.id)},v=O(()=>f.path.startsWith("/tasks")&&!f.path.startsWith("/lead")),w=()=>{l.push({path:`/lead/${s.task.id}`,query:{stage:s.type}})},T=()=>{A.value=!0},p=async R=>{var P,ae,ie,J;const q=R.name;s.type==="lead"?await((ae=(P=s.storeAdapter).updateLead)==null?void 0:ae.call(P,s.task.id,{assignee:q,assigneeType:R.type,teamId:R.type==="team"?R.id:null})):s.type==="opportunity"&&await((J=(ie=s.storeAdapter).updateOpportunity)==null?void 0:J.call(ie,s.task.id,{assignee:q,assigneeType:R.type,teamId:R.type==="team"?R.id:null})),A.value=!1},b=O(()=>ht(s.task.nextActionDue)),$=D(!1),S=D(null),x=D(!1),A=D(!1),{activeTab:U,showInlineWidget:ee,editingItem:le,communicationType:de,inlineContent:pe,filteredInlineContent:Se,handleAddNewAction:ue,handleWidgetSave:ne,handleWidgetCancel:fe,handleEditItem:se,handleDeleteItem:ye}=Ml({store:s.storeAdapter,taskId:n,getTabForItemType:ot,isOverviewModalAction:R=>U.value==="overview"&&s.addNewConfig.overviewActions.includes(R)}),Q=R=>{const q=ue(R);q&&q.modalAction&&(S.value=q.modalAction,$.value=!0)},ce=R=>{if(R==="appointment"&&s.type==="opportunity"){x.value=!x.value;return}const q={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(R))S.value=R,$.value=!0;else{const P=q[R];P?(U.value=P,setTimeout(()=>{Q(R),setTimeout(()=>{const ae=document.querySelector(".animate-fade-in");ae&&ae.scrollIntoView({behavior:"smooth",block:"start"})},100)},50)):Q(R)}},Y=()=>{$.value=!1,S.value=null},ve=async R=>{await ne(R),Y()},Ve=O(()=>{const R=[...s.storeAdapter.currentActivities.value,...pe.value],q=R.filter(J=>ot(J.type)==="overview").length,P=R.filter(J=>["call","email","sms","whatsapp","communication"].includes(J.type)).length,ae=R.filter(J=>J.type==="note").length,ie=R.filter(J=>J.type==="attachment").length;return[{key:"overview",label:"Overview",count:q},{key:"note",label:"Notes",count:ae},{key:"communication",label:"Communication",count:P},{key:"attachment",label:"Attachments",count:ie}]}),De=O(()=>[...s.storeAdapter.currentActivities.value,...pe.value]),Ae=async R=>{if(s.type==="opportunity")try{await s.storeAdapter.addVehicle(s.task.id,R.vehicleData),s.storeAdapter.loadOpportunityById&&await s.storeAdapter.loadOpportunityById(s.task.id)}catch(q){console.error("Error selecting vehicle:",q)}},Te=async R=>{if(s.type==="opportunity")try{await s.storeAdapter.createOffer(s.task.id,R.offerData),s.storeAdapter.loadOpportunityById&&await s.storeAdapter.loadOpportunityById(s.task.id)}catch(q){console.error("Error creating offer:",q)}};return(R,q)=>(o(),a("div",Ul,[e("div",Ll,[e("header",Fl,[e("div",El,[W(bs,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":g.value,"task-type":t.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:ce},{tags:G(()=>[(o(!0),a(z,null,K(t.task.tags,P=>(o(),a("span",{key:P,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},m(P),1))),128))]),"name-action":G(()=>[v.value?(o(),a("button",{key:0,onClick:w,class:"w-7 h-7 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page"},[...q[6]||(q[6]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),t.task.nextActionDue&&t.type==="lead"&&!d.value&&(b.value.type==="overdue"||b.value.type==="urgent")?(o(),a("div",{key:0,class:j(["px-4 md:px-8 py-3 border-b flex items-center justify-between shrink-0",[b.value.bgClass,b.value.borderClass]])},[e("div",Bl,[e("div",{class:j(["w-10 h-10 rounded-lg flex items-center justify-center",[b.value.bgClass,b.value.borderClass,"border"]])},[e("i",{class:j(["text-lg",[`fa-solid ${b.value.icon}`,b.value.textClass]])},null,2)],2),e("div",null,[q[7]||(q[7]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:j(["text-sm font-bold",b.value.textClass])},[I(m(E(wt)(t.task.nextActionDue))+" ",1),b.value.type!=="overdue"?(o(),a("span",Wl," ("+m(E(kt)(t.task.nextActionDue))+") ",1)):y("",!0)],2)])]),e("div",Pl,[b.value.type==="overdue"?(o(),a("div",{key:0,class:j(["text-xs font-bold uppercase px-3 py-1.5 rounded-lg",[b.value.bgClass,b.value.textClass,b.value.borderClass,"border"]])},[...q[8]||(q[8]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),I(" Overdue ",-1)])],2)):b.value.type==="urgent"?(o(),a("div",{key:1,class:j(["text-xs font-bold uppercase px-3 py-1.5 rounded-lg",[b.value.bgClass,b.value.textClass,b.value.borderClass,"border"]])},[...q[9]||(q[9]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),I(" Urgent ",-1)])],2)):y("",!0),e("button",{onClick:r,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Dismiss"},[...q[10]||(q[10]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])])],2)):y("",!0),e("main",zl,[e("div",Ql,[W(ks,{modelValue:E(U),"onUpdate:modelValue":q[0]||(q[0]=P=>ft(U)?U.value=P:null),tabs:Ve.value,class:"mb-0"},null,8,["modelValue","tabs"])]),E(U)==="overview"&&t.type!=="contact"?(o(),a("div",Yl,[W(Os,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||"",onReassign:T},null,8,["stage","owner","source"])])):y("",!0),E(U)==="overview"?(o(),a("div",Hl,[(o(),B(gt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:De.value,onCarAdded:q[1]||(q[1]=P=>R.$emit("car-added",P)),onConvertToLead:q[2]||(q[2]=P=>R.$emit("convert-to-lead")),onConvertToOpportunity:q[3]||(q[3]=P=>R.$emit("convert-to-opportunity")),onVehicleSelected:Ae,onCreateOffer:Te},null,40,["lead","opportunity","contact","activities"])),Fe(R.$slots,"pinned-extra",{task:t.task})])):y("",!0),E(U)!=="overview"?(o(),B(Rs,{key:2,actions:t.addNewConfig.tabActions,"active-tab":E(U),onAction:Q},null,8,["actions","active-tab"])):y("",!0),E(U)!=="overview"?(o(),a("div",Kl,[E(ee)==="communication"?(o(),B(Ko,{key:0,type:E(de),"task-type":t.type,"task-id":t.task.id,item:E(le),onSave:E(ne),onCancel:E(fe)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):y("",!0),E(ee)==="note"?(o(),B(rt,{key:1,item:E(le),"task-type":t.type,"task-id":t.task.id,onSave:E(ne),onCancel:E(fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0),E(ee)==="attachment"?(o(),B(il,{key:2,item:E(le),"task-type":t.type,"task-id":t.task.id,onSave:E(ne),onCancel:E(fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0)])):y("",!0),E(Se).length>0?(o(),a("div",Gl,[(o(!0),a(z,null,K(E(Se),P=>(o(),B(Po,{key:P.id,item:P,"task-type":t.type,"customer-initials":"SK",onEdit:E(se),onDelete:E(ye)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)])]),W(Ht,{title:"Activity summary",activities:De.value,collapsed:u.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:q[4]||(q[4]=P=>u.value=!u.value)},null,8,["activities","collapsed"]),(o(),B(je,{to:"body"},[$.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:oe(Y,["self"])},[S.value==="financing"||S.value==="tradein"?(o(),a("div",Jl,[e("div",Xl,[e("div",Zl,[e("h5",_l,m(S.value==="financing"?"Add Financing":"Add Trade-in"),1),e("button",{onClick:Y,class:"text-gray-400 hover:text-gray-600"},[...q[11]||(q[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),S.value==="financing"?(o(),B(yl,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:ve,onCancel:Y},null,8,["task-type","task-id"])):y("",!0),S.value==="tradein"?(o(),B(wl,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:ve,onCancel:Y},null,8,["task-type","task-id"])):y("",!0)])])):y("",!0),S.value==="purchase"?(o(),a("div",en,[W(dt,{item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:ve,onCancel:Y},null,8,["task-type","task-id","requested-car"])])):y("",!0)])):y("",!0)])),W(xt,{show:A.value,onClose:q[5]||(q[5]=P=>A.value=!1),onConfirm:p},null,8,["show"])]))}},tn={key:0,class:"mb-8"},sn={class:"flex items-center gap-2 mb-4"},on={class:"font-bold text-gray-800 text-sm"},ln={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},nn={class:"p-4"},an={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},rn={class:"text-sm text-slate-700 leading-snug"},dn={class:"flex items-center justify-between"},un={class:"flex items-center gap-4"},cn={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},mn=["src"],pn={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},yn={class:"flex items-center gap-2"},fn={class:"font-bold text-slate-800 text-sm md:text-base"},gn={class:"mt-1.5"},vn={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},bn={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},xn={class:"flex items-center gap-4"},hn={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},wn={key:1,class:"text-right"},kn={class:"font-bold text-slate-800"},$n={class:"border-t border-gray-200"},Cn={class:"font-medium"},Sn={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Dn={class:"mb-6"},An={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Tn={key:0},On={class:"font-medium text-slate-700"},Vn={key:1},In={class:"font-medium text-slate-700"},Nn={key:2},jn={class:"font-medium text-slate-700"},Rn={class:"font-medium text-slate-700"},qn={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Mn={key:0},Un={class:"font-medium text-slate-700"},Ln={key:1},Fn={class:"font-medium text-slate-700"},En={key:2},Bn={class:"font-medium text-slate-700"},Wn={key:3},Pn={class:"font-medium text-slate-700"},zn={key:4},Qn={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Yn={key:5},Hn={class:"font-medium text-slate-700"},Kn={key:0,class:"mt-6 flex justify-end"},ou={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const k=D(!1),s=l=>new Intl.NumberFormat("en-US").format(l),f=l=>new Intl.NumberFormat("en-US").format(l);return(l,n)=>t.show?(o(),a("div",tn,[e("div",sn,[n[1]||(n[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",on,m(t.label),1)]),e("div",ln,[e("div",nn,[t.requestMessage?(o(),a("div",an,[n[2]||(n[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",rn,m(t.requestMessage),1)])):y("",!0),e("div",dn,[e("div",un,[e("div",cn,[t.image?(o(),a("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,mn)):(o(),a("i",pn))]),e("div",null,[e("div",yn,[e("div",fn,m(t.brand)+" "+m(t.model)+" ("+m(t.year)+")",1)]),e("div",gn,[t.stockDays!==void 0&&t.stockDays!==null?(o(),a("div",vn,[n[3]||(n[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),I(" In stock ("+m(t.stockDays)+" days) ",1)])):(o(),a("div",bn,[...n[4]||(n[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),I(" Out of stock ",-1)])]))])])]),e("div",xn,[t.showOpenAd&&t.price?(o(),a("button",hn,[...n[5]||(n[5]=[I(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):y("",!0),t.price?(o(),a("div",wn,[n[6]||(n[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",kn,"€ "+m(s(t.price)),1)])):y("",!0)])])]),e("div",$n,[e("button",{onClick:n[0]||(n[0]=g=>k.value=!k.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",Cn,m(k.value?"Hide":"View")+" Details",1),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":k.value}])},null,2)])]),k.value?(o(),a("div",Sn,[e("div",Dn,[n[17]||(n[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",An,[t.requestType?(o(),a("div",Tn,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",On,m(t.requestType),1)])):y("",!0),t.source?(o(),a("div",Vn,[n[8]||(n[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",In,m(t.source),1)])):y("",!0),e("div",null,[n[9]||(n[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:j(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},m(t.sourceDetails||"--"),3)]),t.dealership?(o(),a("div",Nn,[n[10]||(n[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",jn,m(t.dealership),1)])):y("",!0),e("div",null,[n[11]||(n[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Rn,m(t.channel||"Email"),1)]),e("div",null,[n[12]||(n[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:j(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},m(t.adCampaign||"--"),3)]),e("div",null,[n[13]||(n[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:j(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},m(t.adMedium||"--"),3)]),e("div",null,[n[14]||(n[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:j(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},m(t.adSource||"--"),3)]),e("div",null,[n[15]||(n[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:j(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},m(t.expectedPurchaseDate||"--"),3)]),e("div",null,[n[16]||(n[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:j(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},m(t.fiscalEntity||"--"),3)])])]),n[26]||(n[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[n[25]||(n[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",qn,[t.registration?(o(),a("div",Mn,[n[18]||(n[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Un,m(t.registration),1)])):y("",!0),t.kilometers!==void 0&&t.kilometers!==null?(o(),a("div",Ln,[n[19]||(n[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Fn,m(f(t.kilometers))+" Km",1)])):y("",!0),t.fuelType?(o(),a("div",En,[n[20]||(n[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Bn,m(t.fuelType),1)])):y("",!0),t.gearType?(o(),a("div",Wn,[n[21]||(n[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Pn,m(t.gearType),1)])):y("",!0),t.vin?(o(),a("div",zn,[n[22]||(n[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Qn,m(t.vin),1)])):y("",!0),t.dealership?(o(),a("div",Yn,[n[23]||(n[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Hn,m(t.dealership),1)])):y("",!0)]),t.showTechnicalSpecs?(o(),a("div",Kn,[...n[24]||(n[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),I(" View technical specs ")],-1)])])):y("",!0)])])):y("",!0)])])):y("",!0)}},Gn={key:0,class:"space-y-4 animate-fade-in"},Jn={label:"Teams"},Xn=["value"],Zn={label:"Users"},_n=["value"],ea={key:0,class:"text-xs text-gray-500 mt-1"},ta={key:0,class:"animate-fade-in"},sa={class:"grid grid-cols-4 gap-2"},oa=["onClick"],ut={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=Be(),n=at(),g=D(""),u=D(null),c=D(""),d=D(!1),r=D(""),v=O(()=>n.assignableUsers),w=O(()=>n.assignableTeams),T=O(()=>u.value&&u.value.startsWith("team-"));ke(()=>{var S;u.value=`user-${((S=l.currentUser)==null?void 0:S.id)||1}`}),$e(()=>s.show,S=>{S||p()});const p=()=>{var S;g.value="",u.value=`user-${((S=l.currentUser)==null?void 0:S.id)||1}`,c.value="",d.value=!1,r.value=""},b=()=>{if(!g.value||!c.value||!r.value||!u.value)return;const S=u.value.startsWith("team-"),x=parseInt(u.value.split("-")[1]);let A={};if(S){const U=n.getTeamById(x);A={assigneeType:"team",teamId:x,team:(U==null?void 0:U.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const U=n.getUserById(x);A={assigneeType:"user",assigneeId:x,assignee:(U==null?void 0:U.name)||"Unknown",teamId:null,team:null}}f("confirm",{type:g.value,date:c.value,time:r.value,...A}),p()},$=()=>{p(),f("cancel")};return(S,x)=>t.show?(o(),a("div",Gn,[e("div",null,[x[5]||(x[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),N(e("select",{"onUpdate:modelValue":x[0]||(x[0]=A=>g.value=A),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...x[4]||(x[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[te,g.value]])]),e("div",null,[x[7]||(x[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),N(e("select",{"onUpdate:modelValue":x[1]||(x[1]=A=>u.value=A),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[e("optgroup",Jn,[(o(!0),a(z,null,K(w.value,A=>(o(),a("option",{key:`team-${A.id}`,value:`team-${A.id}`},m(A.name)+" Team ",9,Xn))),128))]),e("optgroup",Zn,[(o(!0),a(z,null,K(v.value,A=>{var U;return o(),a("option",{key:`user-${A.id}`,value:`user-${A.id}`},m(A.name)+m(A.id===((U=E(l).currentUser)==null?void 0:U.id)?" (Me)":""),9,_n)}),128))])],512),[[te,u.value]]),T.value?(o(),a("p",ea,[...x[6]||(x[6]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),I(" Any available team member will be assigned ",-1)])])):y("",!0)]),e("div",null,[x[8]||(x[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":x[2]||(x[2]=A=>c.value=A),onChange:x[3]||(x[3]=A=>d.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[L,c.value]])]),d.value?(o(),a("div",ta,[x[9]||(x[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",sa,[(o(),a(z,null,K(["09:00","10:30","11:00","14:30","15:00","16:30"],A=>e("button",{key:A,onClick:U=>r.value=A,class:j(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",r.value===A?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},m(A),11,oa)),64))])])):y("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:$,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:b,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...x[10]||(x[10]=[I(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):y("",!0)}},la={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},na={key:0,class:"flex justify-between items-center mb-4"},aa={class:"font-semibold text-slate-800 text-sm"},ia={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(k,s)=>(o(),a("div",la,[t.title?(o(),a("div",na,[e("h5",aa,m(t.title),1),t.showClose?(o(),a("button",{key:0,onClick:s[0]||(s[0]=f=>k.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):y("",!0)])):y("",!0),Fe(k.$slots,"default")]))}},ra={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},da={class:"flex justify-between items-start mb-3"},ua={class:"text-xs text-gray-500 mt-0.5"},ca={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},ma={class:"text-xs text-blue-700"},pa={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},ya={class:"flex items-center justify-between"},fa={class:"flex items-center gap-2"},ga={class:"text-xs font-bold text-slate-800"},va={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},ba={class:"flex items-center gap-2 mb-3"},xa={class:"text-sm text-slate-700 font-medium"},ha={class:"flex gap-2 items-center mb-4"},wa=["disabled"],ka={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},$a=["disabled"],Ca={key:2,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Sa={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Da={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Aa={class:"flex items-center gap-2 text-red-400"},Ta={class:"text-xs font-mono"},Oa={class:"space-y-3 text-sm font-mono"},Va={class:"ml-2"},Ia={class:"ml-2"},Na={key:0},ja={class:"ml-2"},Ra={key:1},qa={class:"ml-2"},Ma={key:2},Ua={class:"ml-2"},La={class:"mt-4 pt-4 border-t border-slate-700"},Fa={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ea={key:3,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},Ba={class:"grid grid-cols-3 gap-2"},Wa={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Pa={class:"grid grid-cols-4 gap-2"},za=["onClick"],Qa={key:0},Ya={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Ha={class:"text-xs text-slate-700"},Ka={class:"grid grid-cols-3 gap-2"},Ga={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Ja={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Xa={class:"flex gap-4"},Za={class:"flex items-center gap-2 cursor-pointer"},_a={class:"flex items-center gap-2 cursor-pointer"},ei={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},ti=["disabled"],si={key:2,class:"space-y-4"},oi={class:"bg-white border border-gray-200 rounded-lg p-4"},li={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ni=["value"],ai=["value"],ii=["value"],ri={class:"bg-white border border-gray-200 rounded-lg p-4"},di={class:"flex gap-2"},ui={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ci={class:"grid grid-cols-2 gap-3 text-sm mb-3"},mi={class:"ml-2 font-medium text-slate-800"},pi={class:"ml-2 font-medium text-slate-800"},yi={class:"ml-2 font-medium text-slate-800 capitalize"},fi={class:"ml-2 font-medium text-slate-800"},gi={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},vi={class:"space-y-2"},bi=["checked"],xi=["checked","disabled"],hi={class:"flex-1"},wi={class:"text-xs text-gray-500 mt-0.5"},ki={class:"space-y-3"},$i={class:"grid grid-cols-2 gap-3 text-sm"},Ci={class:"ml-2 font-medium text-slate-800"},Si={class:"ml-2 font-medium text-slate-800"},Di={class:"ml-2 font-medium text-slate-800 capitalize"},Ai={class:"ml-2 font-medium text-slate-800"},Ti={key:0,class:"text-sm"},Oi={class:"ml-2 font-medium text-slate-800"},Vi={key:1,class:"text-sm"},Ii={class:"mt-1 text-slate-700"},Ni={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ji={class:"p-6"},Ri={class:"flex justify-between items-center mb-4"},qi={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Mi={class:"p-6"},Ui={class:"flex justify-between items-center mb-4"},Li={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:k}){var Me,Ue,Le;const s=t,f=k,l=at(),n=Be(),g=D(!1),u=D(!1),c=D(0),d=D(""),r=D(null),v=D(!1),w=D(null),T=D(!1),p=D(!1),b=D(!1),$=D(null),S=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],x=D("whatsapp"),A=D("followup-1"),U=D("custom"),ee=D(""),le=D("09:00"),de=D("Not Interested"),pe=D(""),Se=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],ue=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],ne=O(()=>l.assignableUsers),fe=O(()=>n.currentUser),se=D({dealership:((Ue=(Me=s.lead)==null?void 0:Me.requestedCar)==null?void 0:Ue.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Le=fe.value)==null?void 0:Le.id)||1}),ye=D({tradeIn:!1,financing:!1,contactAvailability:!1}),Q=D({}),ce=D(null),Y={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},ve=O(()=>{const M=Math.floor(c.value/60),i=c.value%60;return`${M.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}),Ve=O(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),De=O(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),Ae=O(()=>!!s.lead.scheduledAppointment),Te=O(()=>Ae.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:De.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),R=O(()=>{var M;return((M=s.lead.contactAttempts)==null?void 0:M.length)||0});O(()=>s.activities.filter(M=>M.type==="note"));const q={"followup-1":`Hi ${s.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}?`,"followup-2":`Hello ${s.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},P=O(()=>A.value==="custom"?"Type your custom message...":q[A.value]),ae=()=>{g.value=!0,c.value=0,u.value=!1,d.value="",r.value=setInterval(()=>{c.value++,c.value>=20&&ie()},1e3)},ie=()=>{r.value&&(clearInterval(r.value),r.value=null),g.value=!1,u.value=!0,Q.value={duration:c.value,notes:d.value,transcription:Y,channel:"phone"},v.value=!0},J=async()=>{try{await navigator.clipboard.writeText(s.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(M){console.error("Failed to copy:",M)}},Re=()=>{ce.value={tradeIn:Y.leadLines.some(M=>M.toLowerCase().includes("trade")||M.toLowerCase().includes("exchange"))||!1,financing:Y.leadLines.some(M=>M.toLowerCase().includes("financ")||M.toLowerCase().includes("payment")||M.toLowerCase().includes("loan"))||!1},ce.value.tradeIn&&(ye.value.tradeIn=!0),ce.value.financing&&(ye.value.financing=!0),v.value=!0,u.value=!1},We=async M=>{$.value=M,b.value=!0,p.value=!1,f("appointment-scheduled",M)},Pe=()=>{const M={timestamp:new Date().toISOString(),outcome:"interested",channel:Q.value.channel||"phone",notes:Q.value.notes||"",transcription:Q.value.transcription||null};f("call-attempt-logged",M),f("validated",{scheduleFollowUp:!1}),f("qualified",{assignment:se.value,preferences:ye.value,scheduleAppointment:b.value,appointmentData:$.value}),ge()},ze=()=>{const M={timestamp:new Date().toISOString(),outcome:"interested",channel:Q.value.channel||"phone",notes:Q.value.notes||"",transcription:Q.value.transcription||null};f("call-attempt-logged",M),w.value="not-valid"},qe=()=>{Q.value={channel:"external",notes:"",transcription:null},v.value=!0},be=M=>{w.value=M,M==="interested"&&ce.value&&(ye.value.tradeIn=ce.value.tradeIn||!1,ye.value.financing=ce.value.financing||!1)},ge=()=>{w.value=null,v.value=!1,b.value=!1,$.value=null},Qe=()=>{if(U.value==="tomorrow-9am"){const i=new Date;return i.setDate(i.getDate()+1),i.setHours(9,0,0,0),i.toISOString()}else if(U.value==="monday"){const i=new Date,V=(8-i.getDay())%7||7;return i.setDate(i.getDate()+V),i.setHours(9,0,0,0),i.toISOString()}else if(U.value==="custom"&&ee.value&&le.value)return new Date(`${ee.value}T${le.value}:00`).toISOString();const M=new Date;return M.setDate(M.getDate()+1),M.setHours(9,0,0,0),M.toISOString()},Ye=async()=>{const M={timestamp:new Date().toISOString(),outcome:"no-answer",channel:Q.value.channel||"phone",notes:Q.value.notes||"",transcription:Q.value.transcription||null};f("call-attempt-logged",M),x.value&&x.value;const i=Qe(),V=i.split("T")[0],me=new Date(i).toTimeString().slice(0,5);f("postponed",{date:V,time:me,createAppointment:!0}),R.value+1>=5&&f("disqualified",{category:"Not Interested",reason:"Unreachable"}),ge()},He=()=>{const M={timestamp:new Date().toISOString(),outcome:"not-valid",channel:Q.value.channel||"phone",notes:Q.value.notes||"",transcription:Q.value.transcription||null};f("call-attempt-logged",M),f("disqualified",{category:de.value,reason:pe.value}),ge()},Ke=M=>{T.value=!1,f("note-saved",M)};return vt(()=>{r.value&&clearInterval(r.value)}),(M,i)=>(o(),a("div",ra,[e("div",da,[e("div",null,[i[29]||(i[29]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",ua,m(Ve.value),1)]),e("div",{class:j(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",Te.value.class])},m(Te.value.text),3)]),Ae.value?(o(),a("div",ca,[i[30]||(i[30]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",ma,m(E(Ne)(t.lead.scheduledAppointment.start))+" at "+m(E(Ee)(t.lead.scheduledAppointment.start)),1)])):y("",!0),R.value>0?(o(),a("div",pa,[e("div",ya,[e("div",fa,[i[31]||(i[31]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),i[32]||(i[32]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",ga,m(R.value)+" / 5",1)]),R.value>=4?(o(),a("div",va,[...i[33]||(i[33]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),I(" One more attempt before auto-disqualification ",-1)])])):y("",!0)])])):y("",!0),e("div",ba,[e("span",xa,m(t.lead.customer.phone),1),e("button",{onClick:J,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...i[34]||(i[34]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",ha,[e("button",{onClick:ae,disabled:g.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[i[35]||(i[35]=e("i",{class:"fa-solid fa-phone"},null,-1)),I(" "+m(R.value>0?"Call Again":"Initiate Call")+" ",1),R.value>0?(o(),a("span",ka,m(R.value+1)+"/5 ",1)):y("",!0)],8,wa),e("button",{onClick:qe,disabled:g.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[36]||(i[36]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),I(" Log Call Outcome ",-1)])],8,$a)]),g.value||u.value?(o(),a("div",Ca,[g.value?(o(),a("div",Sa,[e("div",Da,[i[38]||(i[38]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Aa,[i[37]||(i[37]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ta,"REC "+m(ve.value),1)])]),e("div",Oa,[e("div",null,[i[39]||(i[39]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Va,m(Y.leadLines[0]),1)]),e("div",null,[i[40]||(i[40]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ia,m(Y.salesLines[0]),1)]),c.value>=5?(o(),a("div",Na,[i[41]||(i[41]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",ja,m(Y.leadLines[1]),1)])):y("",!0),c.value>=8?(o(),a("div",Ra,[i[42]||(i[42]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",qa,m(Y.salesLines[1]),1)])):y("",!0),c.value>=12?(o(),a("div",Ma,[i[43]||(i[43]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ua,m(Y.leadLines[2]),1)])):y("",!0)]),e("div",La,[N(e("textarea",{"onUpdate:modelValue":i[0]||(i[0]=V=>d.value=V),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[L,d.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:ie,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[44]||(i[44]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),I(" End Call ",-1)])])])])):y("",!0),u.value&&!g.value?(o(),a("div",Fa,[e("div",{class:"flex items-center justify-between"},[i[46]||(i[46]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:Re,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[45]||(i[45]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),I(" Extract information ",-1)])])])])):y("",!0)])):y("",!0),v.value?(o(),a("div",Ea,[e("div",null,[i[50]||(i[50]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",Ba,[e("button",{onClick:i[1]||(i[1]=V=>be("no-answer")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",w.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...i[47]||(i[47]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:i[2]||(i[2]=V=>be("not-valid")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",w.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...i[48]||(i[48]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:i[3]||(i[3]=V=>be("interested")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",w.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...i[49]||(i[49]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),w.value==="no-answer"?(o(),a("div",Wa,[i[58]||(i[58]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",Pa,[(o(),a(z,null,K(S,V=>e("button",{key:V.value,onClick:me=>x.value=V.value,class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",x.value===V.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},m(V.label),11,za)),64))]),x.value&&x.value!=="dont-send"?(o(),a("div",Qa,[i[53]||(i[53]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),N(e("select",{"onUpdate:modelValue":i[4]||(i[4]=V=>A.value=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...i[51]||(i[51]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[te,A.value]]),e("div",Ya,[i[52]||(i[52]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",Ha,m(P.value),1)])])):y("",!0),e("div",null,[i[56]||(i[56]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",Ka,[e("button",{onClick:i[5]||(i[5]=V=>U.value="tomorrow-9am"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",U.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:i[6]||(i[6]=V=>U.value="monday"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",U.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:i[7]||(i[7]=V=>U.value="custom"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",U.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),U.value==="custom"?(o(),a("div",Ga,[e("div",null,[i[54]||(i[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":i[8]||(i[8]=V=>ee.value=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[L,ee.value]])]),e("div",null,[i[55]||(i[55]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),N(e("input",{type:"time","onUpdate:modelValue":i[9]||(i[9]=V=>le.value=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[L,le.value]])])])):y("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:ge,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:Ye,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[57]||(i[57]=[I(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):y("",!0),w.value==="not-valid"?(o(),a("div",Ja,[e("div",null,[i[61]||(i[61]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",Xa,[e("label",Za,[N(e("input",{type:"radio","onUpdate:modelValue":i[10]||(i[10]=V=>de.value=V),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Xe,de.value]]),i[59]||(i[59]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",_a,[N(e("input",{type:"radio","onUpdate:modelValue":i[11]||(i[11]=V=>de.value=V),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Xe,de.value]]),i[60]||(i[60]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[i[63]||(i[63]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),N(e("select",{"onUpdate:modelValue":i[12]||(i[12]=V=>pe.value=V),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...i[62]||(i[62]=[st('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[te,pe.value]])]),e("div",ei,[e("button",{onClick:ge,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:He,disabled:!de.value||!pe.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,ti)])])):y("",!0),w.value==="interested"?(o(),a("div",si,[e("div",oi,[i[67]||(i[67]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",li,[e("div",null,[i[64]||(i[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),N(e("select",{"onUpdate:modelValue":i[13]||(i[13]=V=>se.value.dealership=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(),a(z,null,K(Se,V=>e("option",{key:V,value:V},m(V),9,ni)),64))],512),[[te,se.value.dealership]])]),e("div",null,[i[65]||(i[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),N(e("select",{"onUpdate:modelValue":i[14]||(i[14]=V=>se.value.team=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(),a(z,null,K(ue,V=>e("option",{key:V,value:V},m(V),9,ai)),64))],512),[[te,se.value.team]])]),e("div",null,[i[66]||(i[66]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),N(e("select",{"onUpdate:modelValue":i[15]||(i[15]=V=>se.value.assigneeId=V),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(!0),a(z,null,K(ne.value,V=>(o(),a("option",{key:V.id,value:V.id},m(V.name)+m(V.id===fe.value.id?" (Me)":""),9,ii))),128))],512),[[te,se.value.assigneeId]])])])]),e("div",ri,[i[71]||(i[71]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",di,[e("button",{onClick:i[16]||(i[16]=V=>f("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[68]||(i[68]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),I(" Add purchase method ",-1)])]),e("button",{onClick:i[17]||(i[17]=V=>f("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[69]||(i[69]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),I(" Add trade-in ",-1)])]),e("button",{onClick:i[18]||(i[18]=V=>T.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[70]||(i[70]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),I(" Add note ",-1)])])])]),M.hasExistingAppointment&&!b.value?(o(),a("div",ui,[i[77]||(i[77]=st('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",ci,[e("div",null,[i[72]||(i[72]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",mi,m(E(Ne)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[i[73]||(i[73]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",pi,m(E(Ee)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[i[74]||(i[74]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",yi,m(t.lead.scheduledAppointment.type),1)]),e("div",null,[i[75]||(i[75]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",fi,m(t.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:i[19]||(i[19]=V=>p.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...i[76]||(i[76]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),I(" Reschedule Appointment ",-1)])])])):y("",!0),M.hasExistingAppointment?y("",!0):(o(),a("div",gi,[i[80]||(i[80]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",vi,[e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!b.value}])},[e("input",{type:"radio",checked:!b.value,onChange:i[20]||(i[20]=()=>{b.value=!1,$.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,bi),i[78]||(i[78]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":b.value}]),onClick:i[22]||(i[22]=V=>!b.value&&(p.value=!0))},[e("input",{type:"radio",checked:b.value,disabled:!b.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,xi),e("div",hi,[i[79]||(i[79]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",wi,m(b.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),b.value?(o(),a("button",{key:0,onClick:i[21]||(i[21]=oe(V=>p.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):y("",!0)],2)])])),b.value?(o(),B(ia,{key:2,title:"Scheduled Appointment","show-close":!1},{default:G(()=>[e("div",ki,[e("div",$i,[e("div",null,[i[81]||(i[81]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Ci,m(E(Ne)($.value.datetime)),1)]),e("div",null,[i[82]||(i[82]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Si,m($.value.time),1)]),e("div",null,[i[83]||(i[83]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Di,m($.value.type),1)]),e("div",null,[i[84]||(i[84]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Ai,m($.value.assignee),1)])]),$.value.location?(o(),a("div",Ti,[i[85]||(i[85]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",Oi,m($.value.location),1)])):y("",!0),$.value.notes?(o(),a("div",Vi,[i[86]||(i[86]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",Ii,m($.value.notes),1)])):y("",!0)])]),_:1})):y("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:ge,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:ze,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...i[87]||(i[87]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),I(" Disqualify ",-1)])]),e("button",{onClick:Pe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...i[88]||(i[88]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),I(" Qualify ",-1)])])])])])):y("",!0)])):y("",!0),(o(),B(je,{to:"body"},[T.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:i[25]||(i[25]=oe(V=>T.value=!1,["self"]))},[e("div",Ni,[e("div",ji,[e("div",Ri,[i[90]||(i[90]=e("h5",{class:"text-sm font-bold text-slate-800"},"Add Note",-1)),e("button",{onClick:i[23]||(i[23]=V=>T.value=!1),class:"text-gray-400 hover:text-gray-600"},[...i[89]||(i[89]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),W(rt,{item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,onSave:Ke,onCancel:i[24]||(i[24]=V=>T.value=!1)},null,8,["task-id"])])])])):y("",!0)])),(o(),B(je,{to:"body"},[p.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:i[28]||(i[28]=oe(V=>p.value=!1,["self"]))},[e("div",qi,[e("div",Mi,[e("div",Ui,[i[92]||(i[92]=e("h5",{class:"text-sm font-bold text-slate-800"},"Schedule Appointment",-1)),e("button",{onClick:i[26]||(i[26]=V=>p.value=!1),class:"text-gray-400 hover:text-gray-600"},[...i[91]||(i[91]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),W(ut,{show:!0,onConfirm:We,onCancel:i[27]||(i[27]=V=>p.value=!1)})])])])):y("",!0)]))]))}},Fi={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},Ei={class:"p-5 space-y-6"},Bi={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:k}){const s=t,f=k,l=Ze(),n=nt(),g=Be(),u=async $=>{try{const S=new Date(`${$.date}T${$.time}:00`),x=S.toISOString();await n.modifyLead(s.lead.id,{nextActionDue:x}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ne(S)} at ${Ee(S)}`}),await n.loadLeadById(s.lead.id)}catch(S){console.error("Failed to postpone lead task:",S)}},c=async $=>{try{if(await n.modifyLead(s.lead.id,{stage:"Validated"}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),$.scheduleFollowUp&&$.appointmentData){const S=new Date(`${$.appointmentData.date}T${$.appointmentData.time}:00`);await n.scheduleFollowUp(s.lead.id,{dateTime:S.toISOString(),assignee:$.appointmentData.assignee||s.lead.assignee,assigneeId:$.appointmentData.assigneeId||null,assigneeType:$.appointmentData.assigneeType||"user",teamId:$.appointmentData.teamId||null,team:$.appointmentData.team||null}),await n.addActivity(s.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ne(S)} at ${Ee(S)}`})}await n.loadLeadById(s.lead.id)}catch(S){console.error("Failed to validate lead:",S)}},d=async()=>{try{const $=await n.convertLeadToOpportunity(s.lead.id);g.canAccessOpportunities()?l.push({path:`/tasks/${$}`,query:{type:"opportunity"}}):l.push("/tasks/1")}catch($){console.error("Failed to qualify lead:",$)}},r=async $=>{try{const S=s.lead.contactAttempts||[];await n.modifyLead(s.lead.id,{contactAttempts:[...S,$],lastContactAttempt:$.timestamp,totalContactAttempts:S.length+1}),await n.addActivity(s.lead.id,{type:"call",user:"You",action:`logged call attempt - ${$.outcome}`,content:$.notes||`Call attempt via ${$.channel}`,data:{outcome:$.outcome,channel:$.channel,duration:$.duration}}),await n.loadLeadById(s.lead.id)}catch(S){console.error("Failed to log call attempt:",S)}},v=async $=>{try{await n.addActivity(s.lead.id,{type:"note",user:"You",action:"added a note",content:$.content||$.text||"",data:$}),await n.loadLeadById(s.lead.id)}catch(S){console.error("Failed to save note:",S)}},w=()=>{f("open-purchase-method")},T=()=>{f("open-trade-in")},p=async $=>{var S;try{const x=`${$.date}T${$.time}:00`,A=new Date(x);A.setHours(A.getHours()+1),await n.modifyLead(s.lead.id,{scheduledAppointment:{id:Date.now(),title:`${$.type} - ${s.lead.customer.name}`,start:x,end:A.toISOString(),type:$.type,assignee:$.assignee,assigneeId:$.assigneeId,status:"scheduled",location:$.location||"",notes:$.notes||""}}),await n.addActivity(s.lead.id,{type:"appointment",user:((S=g.currentUser)==null?void 0:S.name)||"You",action:"scheduled an appointment",content:`${$.type} scheduled for ${$.date} at ${$.time}`,data:{type:$.type,date:$.date,time:$.time,assignee:$.assignee}}),await n.loadLeadById(s.lead.id)}catch(x){console.error("Failed to schedule appointment:",x)}},b=async $=>{try{await n.modifyLead(s.lead.id,{isDisqualified:!0,disqualifyReason:$.reason,status:"Disqualified"}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${$.category}, Reason: ${$.reason}`}),l.push("/tasks")}catch(S){console.error("Failed to disqualify lead:",S)}};return($,S)=>t.lead?(o(),a("div",Fi,[S[0]||(S[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Lead Management")])],-1)),e("div",Ei,[W(Li,{lead:t.lead,onPostponed:u,onValidated:c,onQualified:d,onDisqualified:b,onCallAttemptLogged:r,onNoteSaved:v,onOpenPurchaseMethod:w,onOpenTradeIn:T,onAppointmentScheduled:p},null,8,["lead"])])])):y("",!0)}},Wi={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Pi={class:"grid grid-cols-3 gap-3 mb-4"},zi={class:"flex gap-3 mb-4"},Qi={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:k}){const s=k,f=D(null),l=D(""),n=D(""),g=d=>{f.value=d;const r=new Date;if(d==="later-today"){const v=new Date(r.getTime()+72e5);l.value=v.toISOString().split("T")[0],n.value=v.toTimeString().slice(0,5)}else if(d==="tomorrow"){const v=new Date(r);v.setDate(v.getDate()+1),l.value=v.toISOString().split("T")[0],n.value="09:00"}else if(d==="next-week"){const v=new Date(r);v.setDate(v.getDate()+(7-v.getDay()+1)),l.value=v.toISOString().split("T")[0],n.value="09:00"}},u=()=>{s("confirm",{date:l.value,time:n.value,option:f.value}),s("close"),f.value=null,l.value="",n.value=""},c=()=>{s("close"),f.value=null,l.value="",n.value=""};return(d,r)=>t.show?(o(),a("div",Wi,[e("div",Pi,[e("button",{onClick:r[0]||(r[0]=v=>g("later-today")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="later-today"}])},[...r[5]||(r[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:r[1]||(r[1]=v=>g("tomorrow")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="tomorrow"}])},[...r[6]||(r[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:r[2]||(r[2]=v=>g("next-week")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="next-week"}])},[...r[7]||(r[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",zi,[N(e("input",{"onUpdate:modelValue":r[3]||(r[3]=v=>l.value=v),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[L,l.value]]),N(e("input",{"onUpdate:modelValue":r[4]||(r[4]=v=>n.value=v),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[L,n.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:c,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:u,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):y("",!0)}},Yi={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:k}){const s=k,f=()=>{s("close")};return(l,n)=>(o(),B(Oe,{show:t.show,title:t.title,onCancel:f},{footer:G(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:f,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:G(()=>[n[0]||(n[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},Hi={class:"space-y-4"},Ki=["disabled"],Gi={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D(""),n=D("");$e(()=>s.show,c=>{c&&(l.value="",n.value="")});const g=()=>{l.value&&f("confirm",{reason:l.value,notes:n.value})},u=()=>{f("cancel")};return(c,d)=>(o(),B(Oe,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:u},{actions:G(()=>[e("button",{onClick:g,disabled:!l.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Ki)]),default:G(()=>[e("div",Hi,[e("div",null,[d[3]||(d[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),N(e("select",{"onUpdate:modelValue":d[0]||(d[0]=r=>l.value=r),class:"input"},[...d[2]||(d[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[te,l.value]])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),N(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=r=>n.value=r),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[L,n.value]])])])]),_:1},8,["show"]))}},Ji={class:"space-y-4"},Xi=["max"],Zi=["disabled"],_i={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D(""),n=D(""),g=D(""),u=O(()=>new Date().toISOString().split("T")[0]);$e(()=>s.show,r=>{if(r){const v=new Date;l.value=v.toISOString().split("T")[0],n.value=v.toTimeString().slice(0,5),g.value=""}});const c=()=>{if(!l.value)return;const r=n.value?`${l.value}T${n.value}:00`:`${l.value}T12:00:00`;f("confirm",{contractDate:r,notes:g.value})},d=()=>{f("cancel")};return(r,v)=>(o(),B(Oe,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:d},{actions:G(()=>[e("button",{onClick:c,disabled:!l.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,Zi)]),default:G(()=>[e("div",Ji,[e("div",null,[v[3]||(v[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":v[0]||(v[0]=w=>l.value=w),max:u.value,class:"input"},null,8,Xi),[[L,l.value]])]),e("div",null,[v[4]||(v[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),N(e("input",{type:"time","onUpdate:modelValue":v[1]||(v[1]=w=>n.value=w),class:"input"},null,512),[[L,n.value]])]),e("div",null,[v[5]||(v[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),N(e("textarea",{"onUpdate:modelValue":v[2]||(v[2]=w=>g.value=w),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[L,g.value]])])])]),_:1},8,["show"]))}},er={class:"space-y-4"},tr=["max"],sr=["disabled"],or={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=D(""),n=D(""),g=D(""),u=D(""),c=O(()=>new Date().toISOString().split("T")[0]);$e(()=>s.show,v=>{if(v){const w=new Date;l.value=w.toISOString().split("T")[0],n.value=w.toTimeString().slice(0,5),g.value="",u.value=""}});const d=()=>{if(!l.value||!g.value)return;const v=n.value?`${l.value}T${n.value}:00`:`${l.value}T12:00:00`;f("confirm",{deliveryDate:v,location:g.value,notes:u.value})},r=()=>{f("cancel")};return(v,w)=>(o(),B(Oe,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:r},{actions:G(()=>[e("button",{onClick:d,disabled:!l.value||!g.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,sr)]),default:G(()=>[e("div",er,[e("div",null,[w[4]||(w[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":w[0]||(w[0]=T=>l.value=T),max:c.value,class:"input"},null,8,tr),[[L,l.value]])]),e("div",null,[w[5]||(w[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),N(e("input",{type:"time","onUpdate:modelValue":w[1]||(w[1]=T=>n.value=T),class:"input"},null,512),[[L,n.value]])]),e("div",null,[w[7]||(w[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),N(e("select",{"onUpdate:modelValue":w[2]||(w[2]=T=>g.value=T),class:"input"},[...w[6]||(w[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[te,g.value]])]),e("div",null,[w[8]||(w[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),N(e("textarea",{"onUpdate:modelValue":w[3]||(w[3]=T=>u.value=T),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[L,u.value]])])])]),_:1},8,["show"]))}},lr={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(k,s)=>(o(),B(Oe,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=f=>k.$emit("cancel"))},{header:G(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:G(()=>[e("button",{onClick:s[0]||(s[0]=f=>k.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:G(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),I(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),I(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),I(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},nr={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},ar=["src","alt"],ir={key:1,class:"w-full h-full flex items-center justify-center"},rr={class:"flex items-center justify-between mb-1.5"},dr={class:"text-sm font-bold text-gray-900"},ur={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},cr={class:"text-[10px] text-gray-500 mb-1.5"},mr={key:0,class:"text-[10px] text-green-600 font-medium mb-2"},pr={key:1,class:"text-[10px] text-orange-600 font-medium mb-2"},lt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const k=t,s=O(()=>({Requested:"bg-blue-100 text-blue-700 border border-blue-200",Recommended:"bg-purple-100 text-purple-700 border border-purple-200","In Stock":"bg-green-100 text-green-700 border border-green-200",Custom:"bg-orange-100 text-orange-700 border border-orange-200"})[k.badge]||"bg-gray-100 text-gray-700 border border-gray-200"),f=l=>l?l.toLocaleString("en-US"):"0";return(l,n)=>(o(),a("div",{onClick:n[1]||(n[1]=g=>l.$emit("select")),class:j(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":t.selected}])},[e("div",nr,[t.vehicle.image?(o(),a("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,ar)):(o(),a("div",ir,[...n[2]||(n[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",rr,[e("span",{class:j(["text-[10px] font-bold uppercase px-1.5 py-0.5 rounded",s.value])},m(t.badge),3),e("span",dr,"€"+m(f(t.vehicle.price)),1)]),e("h4",ur,m(t.vehicle.brand)+" "+m(t.vehicle.model),1),e("p",cr,m(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(o(),a("div",mr,[n[3]||(n[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),I(" In stock ("+m(t.stockDays)+" days) ",1)])):(o(),a("div",pr,[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),I(" Out of stock ",-1)])])),e("button",{onClick:n[0]||(n[0]=oe(g=>l.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},yr={class:"space-y-6 max-h-[75vh] overflow-y-auto px-2"},fr={key:0},gr={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},vr={class:"mb-4"},br={class:"relative"},xr={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},hr={key:1,class:"text-center py-8 text-gray-500"},wr={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},kr={key:0,class:"mt-4 space-y-3"},$r={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Cr={class:"flex justify-end"},Sr=["disabled"],Dr={class:"p-4 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Ar={class:"flex items-center gap-3"},Tr={class:"font-bold text-sm text-gray-800"},Or={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:k}){const s=t,f=k,l=D(""),n=D(!1),g=D(null),u=D(null),c=D(null),d=D({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""}),r=O(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),v=O(()=>{const S=[];if(s.requestedVehicle&&r.value&&S.push({...s.requestedVehicle,isRequested:!0}),we&&we.length>0){const x=we.filter(U=>s.requestedVehicle?U.brand!==s.requestedVehicle.brand||U.model!==s.requestedVehicle.model:!0),A=s.requestedVehicle&&r.value?3:4;S.push(...x.slice(0,A))}return S}),w=O(()=>{if(!we||we.length===0)return[];let S=[...we];if(l.value){const x=l.value.toLowerCase();S=S.filter(A=>A.brand.toLowerCase().includes(x)||A.model.toLowerCase().includes(x)||A.year.toString().includes(x))}return S}),T=O(()=>d.value.brand&&d.value.model&&d.value.year&&d.value.price>0),p=(S,x)=>{g.value=S,u.value=S.id||`custom-${Date.now()}`,c.value=x},b=()=>{if(!T.value)return;const S={...d.value,id:`custom-${Date.now()}`,isCustom:!0};p(S,"custom")},$=()=>{g.value&&(f("vehicle-selected",{vehicle:g.value,type:c.value}),f("close"),g.value=null,u.value=null,c.value=null,l.value="",n.value=!1,d.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(S,x)=>(o(),B(Oe,{show:t.show,onClose:x[6]||(x[6]=A=>S.$emit("close")),title:"Select Vehicle",size:"6xl"},bt({default:G(()=>[e("div",yr,[v.value.length?(o(),a("div",fr,[x[7]||(x[7]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),I(" Recommended Vehicles ")],-1)),e("div",gr,[(o(!0),a(z,null,K(v.value,A=>(o(),B(lt,{key:A.id,vehicle:A,badge:A.isRequested?"Requested":"Recommended","stock-days":A.stockDays,selected:u.value===A.id,onSelect:U=>p(A,A.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):y("",!0),e("div",null,[x[10]||(x[10]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),I(" Browse Stock ")],-1)),e("div",vr,[e("div",br,[x[8]||(x[8]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),N(e("input",{"onUpdate:modelValue":x[0]||(x[0]=A=>l.value=A),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[L,l.value]])])]),w.value.length?(o(),a("div",xr,[(o(!0),a(z,null,K(w.value,A=>(o(),B(lt,{key:A.id,vehicle:A,badge:"In Stock","stock-days":A.stockDays,selected:u.value===A.id,onSelect:U=>p(A,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(o(),a("div",hr,[...x[9]||(x[9]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[x[18]||(x[18]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),I(" Configure Custom Vehicle ")],-1)),e("div",wr,[x[17]||(x[17]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:x[1]||(x[1]=A=>n.value=!n.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[x[11]||(x[11]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),I(" "+m(n.value?"Hide Configuration":"Build Custom Configuration"),1)]),n.value?(o(),a("div",kr,[e("div",$r,[e("div",null,[x[12]||(x[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),N(e("input",{"onUpdate:modelValue":x[2]||(x[2]=A=>d.value.brand=A),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., Audi"},null,512),[[L,d.value.brand]])]),e("div",null,[x[13]||(x[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),N(e("input",{"onUpdate:modelValue":x[3]||(x[3]=A=>d.value.model=A),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., e-tron GT"},null,512),[[L,d.value.model]])]),e("div",null,[x[14]||(x[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),N(e("input",{"onUpdate:modelValue":x[4]||(x[4]=A=>d.value.year=A),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"2024"},null,512),[[L,d.value.year]])]),e("div",null,[x[15]||(x[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (€)",-1)),N(e("input",{"onUpdate:modelValue":x[5]||(x[5]=A=>d.value.price=A),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"98000"},null,512),[[L,d.value.price]])])]),e("div",Cr,[e("button",{onClick:b,disabled:!T.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...x[16]||(x[16]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),I(" Use Custom Configuration ",-1)])],8,Sr)])])):y("",!0)])])])]),_:2},[g.value?{name:"footer",fn:G(()=>[e("div",Dr,[e("div",Ar,[x[20]||(x[20]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg"},null,-1)),e("div",null,[x[19]||(x[19]=e("p",{class:"text-xs text-gray-500"},"Selected Vehicle",-1)),e("p",Tr,m(g.value.brand)+" "+m(g.value.model)+" ("+m(g.value.year)+") ",1)])]),e("button",{onClick:$,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors shadow-sm"}," Confirm Selection ")])]),key:"0"}:void 0]),1032,["show"]))}},Vr={class:"mt-1.5 border-t border-gray-200 pt-1.5"},Ir={key:1},Nr={class:"flex items-center justify-between mb-1.5"},jr={class:"space-y-1.5"},Rr={class:"block label-upper mb-1"},qr=["onUpdate:modelValue","placeholder"],Mr=["onUpdate:modelValue"],Ur=["value"],Lr={key:2,class:"space-y-0.5"},Fr=["onUpdate:modelValue","value"],Ce={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=D(!1),n=D({});$e(()=>s.questions,r=>{const v={};r.forEach(w=>{v[w.key]=""}),n.value=v},{immediate:!0});const g=()=>{f("survey-completed",{...n.value}),d()},u=()=>{f("survey-refused"),d()},c=()=>{f("not-responding"),d()},d=()=>{l.value=!1;const r={};s.questions.forEach(v=>{r[v.key]=""}),n.value=r};return(r,v)=>(o(),a("div",Vr,[l.value?(o(),a("div",Ir,[e("div",Nr,[v[4]||(v[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:v[1]||(v[1]=w=>l.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",jr,[(o(!0),a(z,null,K(t.questions,(w,T)=>(o(),a("div",{key:T,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Rr,m(w.label),1),w.type==="text"?N((o(),a("textarea",{key:0,"onUpdate:modelValue":p=>n.value[w.key]=p,placeholder:w.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,qr)),[[L,n.value[w.key]]]):w.type==="select"?N((o(),a("select",{key:1,"onUpdate:modelValue":p=>n.value[w.key]=p,class:"input text-xs py-1 px-2"},[v[5]||(v[5]=e("option",{value:""},"Select an option...",-1)),(o(!0),a(z,null,K(w.options,p=>(o(),a("option",{key:p,value:p},m(p),9,Ur))),128))],8,Mr)),[[te,n.value[w.key]]]):w.type==="radio"?(o(),a("div",Lr,[(o(!0),a(z,null,K(w.options,p=>(o(),a("label",{key:p,class:"flex items-center text-xs"},[N(e("input",{type:"radio","onUpdate:modelValue":b=>n.value[w.key]=b,value:p,class:"mr-1"},null,8,Fr),[[Xe,n.value[w.key]]]),I(" "+m(p),1)]))),128))])):y("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:c,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(o(),a("button",{key:0,onClick:v[0]||(v[0]=w=>l.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...v[2]||(v[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Er={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Br={class:"flex justify-between items-start mb-3"},Wr={class:"text-xs text-gray-500 mt-0.5"},Pr={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],n=O(()=>{if(!s.opportunity.createdAt)return 0;const v=new Date(s.opportunity.createdAt),T=Math.abs(new Date-v);return Math.ceil(T/(1e3*60*60*24))}),g=()=>{f("create-offer",s.opportunity)},u=()=>{f("review",s.opportunity)},c=v=>{f("survey-completed",{opportunity:s.opportunity,responses:v})},d=()=>{f("survey-refused",{opportunity:s.opportunity})},r=()=>{f("not-responding",{opportunity:s.opportunity})};return(v,w)=>(o(),a("div",Er,[e("div",Br,[e("div",null,[w[0]||(w[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Wr,"This opportunity has been open for "+m(n.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),W(Ce,{questions:l,onSurveyCompleted:c,onSurveyRefused:d,onNotResponding:r})]))}},zr={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Qr={class:"flex justify-between items-start mb-3"},Yr={class:"text-xs text-gray-500 mt-0.5"},Hr={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],n=O(()=>{if(!s.opportunity.createdAt)return 0;const r=new Date(s.opportunity.createdAt),w=Math.abs(new Date-r);return Math.ceil(w/(1e3*60*60*24))}),g=()=>{f("create-offer",s.opportunity)},u=r=>{f("survey-completed",{opportunity:s.opportunity,responses:r})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(r,v)=>(o(),a("div",zr,[e("div",Qr,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Yr,"This opportunity has been open for "+m(n.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),W(Ce,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},Kr={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Gr={class:"flex justify-between items-start mb-3"},Jr={class:"text-xs text-gray-500 mt-0.5"},Xr={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],n=O(()=>{const r=s.opportunity.lastActivity||s.opportunity.createdAt;if(!r)return 0;const v=new Date(r),T=Math.abs(new Date-v);return Math.ceil(T/(1e3*60*60*24))}),g=()=>{f("create-contract",s.opportunity)},u=r=>{f("survey-completed",{opportunity:s.opportunity,responses:r})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(r,v)=>(o(),a("div",Kr,[e("div",Gr,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Jr,"This opportunity has been in negotiation for "+m(n.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),W(Ce,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},Zr={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},_r={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],n=()=>{f("schedule-closing",s.opportunity)},g=d=>{f("survey-completed",{opportunity:s.opportunity,responses:d})},u=()=>{f("survey-refused",{opportunity:s.opportunity})},c=()=>{f("not-responding",{opportunity:s.opportunity})};return(d,r)=>(o(),a("div",Zr,[r[0]||(r[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:n,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),W(Ce,{questions:l,onSurveyCompleted:g,onSurveyRefused:u,onNotResponding:c})]))}},ed={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},td={class:"flex justify-between items-start mb-3"},sd={class:"font-bold text-slate-800 text-sm"},od={class:"text-xs text-gray-500 mt-0.5"},ld={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:k}){const s=t,f=k,l=O(()=>{var p;return((p=s.scheduledAppointment)==null?void 0:p.noShowCount)||0}),n=O(()=>{const p=l.value;return p===0?"No-Show Follow-up":p>=3?`No-Show #${p} - Final Warning`:`No-Show #${p} Follow-up`}),g=O(()=>{const p=l.value;return p>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":p>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),u=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],c=O(()=>{var b;return(b=s.scheduledAppointment)!=null&&b.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),d=()=>{f("contact-customer",s.opportunity)},r=()=>{l.value>=3?f("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${l.value} no-shows`}):f("reschedule",s.opportunity)},v=p=>{f("survey-completed",{opportunity:s.opportunity,responses:p})},w=()=>{f("survey-refused",{opportunity:s.opportunity})},T=()=>{f("not-responding",{opportunity:s.opportunity})};return(p,b)=>(o(),a("div",ed,[e("div",td,[e("div",null,[e("h4",sd,m(n.value),1),e("p",od,"Appointment was scheduled for "+m(c.value)+" but customer did not show up. "+m(g.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:r,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...b[0]||(b[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),I(" Book Another Appointment ",-1)])]),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),I(" Contact Customer ",-1)])])]),W(Ce,{questions:u,onSurveyCompleted:v,onSurveyRefused:w,onNotResponding:T})]))}},nd={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},ad={class:"flex justify-between items-start mb-3"},id={class:"text-xs text-gray-500 mt-0.5"},rd={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],n=O(()=>{var p;if(!((p=s.opportunity)!=null&&p.contractDate))return 0;const v=new Date(s.opportunity.contractDate),T=Math.abs(new Date-v);return Math.ceil(T/(1e3*60*60*24))}),g=()=>{f("prepare-delivery",s.opportunity)},u=()=>{f("pre-delivery-checklist",s.opportunity)},c=v=>{f("survey-completed",{opportunity:s.opportunity,responses:v})},d=()=>{f("survey-refused",{opportunity:s.opportunity})},r=()=>{f("not-responding",{opportunity:s.opportunity})};return(v,w)=>(o(),a("div",nd,[e("div",ad,[e("div",null,[w[0]||(w[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",id,"Contract was signed "+m(n.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),W(Ce,{questions:l,onSurveyCompleted:c,onSurveyRefused:d,onNotResponding:r})]))}},dd={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},ud={class:"flex justify-between items-start mb-3"},cd={class:"text-xs text-gray-500 mt-0.5"},md={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],n=O(()=>{const r=s.activities.find(p=>{var b;return p.type==="delivery"||((b=p.action)==null?void 0:b.toLowerCase().includes("delivered"))});if(!r||!r.timestamp)return 0;const v=new Date(r.timestamp),T=Math.abs(new Date-v);return Math.ceil(T/(1e3*60*60*24))}),g=()=>{f("delivery-feedback",s.opportunity)},u=r=>{f("survey-completed",{opportunity:s.opportunity,responses:r})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(r,v)=>(o(),a("div",dd,[e("div",ud,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",cd,"Vehicle was delivered "+m(n.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:g,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),W(Ce,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},pd={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},yd={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:k}){const s=t,f=k,l=()=>{f("close-won",s.opportunity)},n=()=>{f("close-lost",s.opportunity)};return(g,u)=>(o(),a("div",pd,[u[2]||(u[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...u[0]||(u[0]=[I(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:n,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...u[1]||(u[1]=[I(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},fd={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},gd={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},vd={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},bd={class:"p-5 space-y-6"},xd={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},hd={class:"flex gap-3"},wd={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},kd={class:"flex items-start gap-3"},$d={class:"flex-1"},Cd={class:"font-bold text-slate-800 text-sm mb-1"},Sd={key:0},Dd={key:1},Ad={class:"text-xs text-gray-600"},Td={key:0},Od={key:1},Vd={key:2},Id={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Nd={key:3},jd={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Rd={class:"flex justify-between items-start mb-3"},qd={class:"text-xs text-gray-500 mt-0.5"},Md={class:"flex gap-3 flex-wrap"},Ud={key:4,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Ld={class:"flex justify-between items-start mb-3"},Fd={class:"text-xs text-gray-500 mt-0.5"},Ed={key:0,class:"pt-4"},Bd={key:5,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},Wd={key:6,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Pd={class:"flex justify-between items-start mb-3"},zd={class:"text-xs text-gray-500 mt-0.5"},Qd={key:13,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},Yd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Hd={class:"p-6"},Kd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Gd={class:"p-6"},Jd={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity","vehicle-selected"],setup(t,{emit:k}){const s=t,f=k,l=O(()=>{var h,C,F;return((h=s.opportunity)==null?void 0:h.stage)==="Closed"||((C=s.opportunity)==null?void 0:C.stage)==="Closed Lost"||((F=s.opportunity)==null?void 0:F.stage)==="Registration"}),n=D(!1),g=D(!1),u=D(null),c=D(!1),d=D(""),r=D(!1),v=D(!1),w=D(!1),T=D(!1),p=D(!1),b=D(!1),$=D([]),S=O(()=>{var h;return((h=s.activities)==null?void 0:h.some(C=>C.type==="offer"))||!1}),x=Ze(),A=it(),U=Be();ke(()=>{$.value=we.filter(h=>h.stockDays!==null&&h.stockDays!==void 0).slice(0,5).map(h=>({id:h.id,brand:h.brand,model:h.model,year:h.year,price:h.price,image:h.image||"",stockDays:h.stockDays}))});const ee=h=>{d.value=h,c.value=!0},le=h=>h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",de=h=>h?new Date(h).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",pe=()=>{n.value=!n.value},Se=h=>{n.value=!1},ue=O(()=>{var X;if(!((X=s.opportunity)!=null&&X.createdAt))return 0;const h=new Date(s.opportunity.createdAt),F=Math.abs(new Date-h);return Math.ceil(F/(1e3*60*60*24))}),ne=O(()=>s.activities.some(h=>h.type==="appointment")),fe=O(()=>{var F,X,H;const h=((F=s.opportunity)==null?void 0:F.contractDate)!==null&&((X=s.opportunity)==null?void 0:X.contractDate)!==void 0,C=s.activities.some(re=>{var Z,_;return((Z=re.action)==null?void 0:Z.toLowerCase().includes("won"))||((_=re.action)==null?void 0:_.toLowerCase().includes("contract"))});return h||C||((H=s.opportunity)==null?void 0:H.stage)==="Closed"}),se=O(()=>s.activities.some(h=>{var C,F;return h.type==="delivery"||((C=h.action)==null?void 0:C.toLowerCase().includes("delivered"))||((F=h.action)==null?void 0:F.toLowerCase().includes("delivery"))})),ye=O(()=>{var C;if(((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||S.value||s.scheduledAppointment||ne.value)return!1;const h=ue.value;return h>=7&&h<14}),Q=O(()=>{var C;return((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||S.value||s.scheduledAppointment||ne.value?!1:ue.value>=14}),ce=O(()=>{var C;return((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||S.value||!s.scheduledAppointment?!1:ue.value>=7}),Y=O(()=>{const h=ue.value;return h>=14?"high":h>=7?"medium":null}),ve=O(()=>{var H;if(((H=s.opportunity)==null?void 0:H.stage)!=="In Negotiation")return!1;const h=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),F=Math.abs(new Date-h),X=Math.ceil(F/(1e3*60*60*24));return!fe.value&&X>=5}),Ve=O(()=>{var _,Ie,et;if(((_=s.opportunity)==null?void 0:_.stage)!=="In Negotiation")return!1;const h=((Ie=s.opportunity)==null?void 0:Ie.contractDate)!==null&&((et=s.opportunity)==null?void 0:et.contractDate)!==void 0,C=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||ne.value&&s.activities.some(Ge=>{var tt;return Ge.type==="appointment"&&((tt=Ge.data)!=null&&tt.datetime)?new Date(Ge.data.datetime)>new Date:!1}),F=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),H=Math.abs(new Date-F);return Math.ceil(H/(1e3*60*60*24))>=5&&!h&&!C}),De=O(()=>{var Z,_,Ie;if(((Z=s.opportunity)==null?void 0:Z.stage)!=="Closed"&&((_=s.opportunity)==null?void 0:_.stage)!=="Registration")return!1;const h=(Ie=s.opportunity)==null?void 0:Ie.contractDate;if(!h||se.value)return!1;const C=new Date(h),X=Math.abs(new Date-C);return Math.ceil(X/(1e3*60*60*24))>=7}),Ae=O(()=>{const h=s.activities.find(Z=>{var _;return Z.type==="delivery"||((_=Z.action)==null?void 0:_.toLowerCase().includes("delivered"))});if(!h)return!1;const C=new Date(h.timestamp),X=Math.abs(new Date-C);return Math.ceil(X/(1e3*60*60*24))>=3}),Te=O(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const F=s.activities.some(H=>{var re,Z,_;return H.type==="appointment"&&(((re=H.data)==null?void 0:re.status)==="completed"||((Z=H.action)==null?void 0:Z.toLowerCase().includes("completed")))&&((_=H.data)==null?void 0:_.appointmentId)===s.scheduledAppointment.id}),X=s.scheduledAppointment.status==="no-show";return!F&&!X}),R=O(()=>!l.value),q=O(()=>{var h,C,F;return!(((h=s.opportunity)==null?void 0:h.stage)!=="In Negotiation"||!((C=s.opportunity)!=null&&C.contractDate)||((F=s.opportunity)==null?void 0:F.stage)==="Closed")}),P=O(()=>{var H,re,Z;if(((H=s.opportunity)==null?void 0:H.stage)!=="Closed"||!((re=s.opportunity)!=null&&re.contractDate)||se.value||((Z=s.opportunity)==null?void 0:Z.stage)==="Registration")return!1;const h=new Date(s.opportunity.contractDate),F=Math.abs(new Date-h);return Math.ceil(F/(1e3*60*60*24))>=7}),ae=h=>{b.value=!1,f("vehicle-selected",{opportunity:s.opportunity,vehicleData:h})},ie=()=>{r.value=!0},J=()=>{r.value=!1},Re=h=>{r.value=!1,f("create-offer",{opportunity:s.opportunity,offerData:h})},We=h=>{ee("Review Opportunity")},Pe=h=>{w.value=!0},ze=h=>{w.value=!1},qe=h=>{g.value=!0,u.value=h},be=()=>{g.value=!1,u.value=null},ge=h=>{qe("nfu")},Qe=h=>{be(),h.assigneeType==="team"?`${h.team}`:h.assignee;const C={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${h.type} on ${h.date} at ${h.time}${h.assigneeType==="team"?` (assigned to ${h.team} Team)`:""}`,data:{type:h.type,assignee:h.assignee,assigneeId:h.assigneeId,assigneeType:h.assigneeType,teamId:h.teamId,team:h.team,date:h.date,time:h.time,datetime:`${h.date}T${h.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};f("appointment-created",C)},Ye=h=>{T.value=!0},He=h=>{ee("Pre-Delivery Checklist")},Ke=h=>{T.value=!1},Me=h=>{ee("Delivery Feedback")},Ue=()=>{_e()},Le=()=>{v.value=!0},M=h=>{},i=h=>{v.value=!1},V=()=>{ee("Contact Customer")},me=h=>{},xe=h=>{},he=h=>{},ct=async()=>{try{await A.reopenOpportunity(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(h){console.error("Failed to reopen opportunity:",h)}},mt=async()=>{try{p.value=!1;const h=await A.convertOpportunityToLead(s.opportunity.id);U.canAccessLeads()?x.push({path:`/tasks/${h}`,query:{type:"lead"}}):x.push("/tasks/1")}catch(h){console.error("Failed to convert opportunity to lead:",h),p.value=!1}},pt=async()=>{try{await A.markAsRegistration(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(h){console.error("Failed to mark as registration:",h)}},_e=async()=>{try{await A.markAsClosedWon(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(h){console.error("Failed to mark as closed won:",h)}};return(h,C)=>t.opportunity?(o(),a("div",fd,[e("div",gd,[C[11]||(C[11]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next steps")],-1)),e("span",vd,m(l.value?"Closed":"Active"),1)]),e("div",bd,[l.value?(o(),a("div",xd,[C[14]||(C[14]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",hd,[e("button",{onClick:ct,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[12]||(C[12]=[I(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:C[0]||(C[0]=F=>p.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...C[13]||(C[13]=[I(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):y("",!0),ce.value?(o(),a("div",wd,[e("div",kd,[C[15]||(C[15]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",$d,[e("h4",Cd,[Y.value==="high"?(o(),a("span",Sd,"High Risk")):(o(),a("span",Dd,"At Risk"))]),e("p",Ad,[Y.value==="high"?(o(),a("span",Td," This opportunity has been open for "+m(ue.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(o(),a("span",Od," This opportunity has been open for "+m(ue.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):y("",!0),t.opportunity.stage==="Qualified"&&!t.opportunity.selectedVehicle?(o(),a("div",Vd,[e("div",Id,[C[17]||(C[17]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Select Vehicle"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," Choose a vehicle to create an offer for this opportunity ")])],-1)),e("button",{onClick:C[1]||(C[1]=F=>b.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[16]||(C[16]=[e("i",{class:"fa-solid fa-car mr-1"},null,-1),I(" Select Vehicle ",-1)])])])])):y("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.selectedVehicle&&!S.value?(o(),a("div",Nd,[e("div",jd,[e("div",Rd,[e("div",null,[C[18]||(C[18]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Create Offer",-1)),e("p",qd," Vehicle selected: "+m(t.opportunity.selectedVehicle.brand)+" "+m(t.opportunity.selectedVehicle.model)+" ("+m(t.opportunity.selectedVehicle.year)+") ",1)])]),e("div",Md,[e("button",{onClick:ie,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[19]||(C[19]=[e("i",{class:"fa-solid fa-file-contract mr-1"},null,-1),I(" Create Offer ",-1)])]),e("button",{onClick:C[2]||(C[2]=F=>b.value=!0),class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...C[20]||(C[20]=[e("i",{class:"fa-solid fa-car mr-1"},null,-1),I(" Change Vehicle ",-1)])])])])])):y("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(o(),a("div",Ud,[e("div",Ld,[e("div",null,[C[21]||(C[21]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",Fd,m(t.scheduledAppointment.title)+" on "+m(le(t.scheduledAppointment.start))+" at "+m(de(t.scheduledAppointment.start)),1)])]),e("button",{onClick:pe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),n.value?(o(),a("div",Ed,[W(Qi,{show:n.value,onClose:C[3]||(C[3]=F=>n.value=!1),onConfirm:Se},null,8,["show"])])):y("",!0)])):t.opportunity.stage==="Qualified"&&!ne.value?(o(),a("div",Bd,[C[22]||(C[22]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:C[4]||(C[4]=F=>qe("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):y("",!0),q.value?(o(),a("div",Wd,[e("div",Pd,[e("div",null,[C[23]||(C[23]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",zd," Contract was signed on "+m(le(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:_e,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[24]||(C[24]=[I(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):y("",!0),Te.value?(o(),B(ld,{key:7,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:V,onReschedule:h.openRescheduleModal,onAutoCloseLost:M,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity","scheduled-appointment","onReschedule"])):y("",!0),Q.value?(o(),B(Hr,{key:8,opportunity:t.opportunity,onCreateOffer:ie,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):y("",!0),ye.value?(o(),B(Pr,{key:9,opportunity:t.opportunity,onCreateOffer:ie,onReview:We,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):y("",!0),Ve.value?(o(),B(_r,{key:10,opportunity:t.opportunity,onScheduleClosing:ge,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):y("",!0),ve.value?(o(),B(Xr,{key:11,opportunity:t.opportunity,onCreateContract:Pe,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):y("",!0),De.value?(o(),B(rd,{key:12,opportunity:t.opportunity,onPrepareDelivery:Ye,onPreDeliveryChecklist:He,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity"])):y("",!0),P.value?(o(),a("div",Qd,[C[26]||(C[26]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:pt,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[25]||(C[25]=[I(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):y("",!0),Ae.value?(o(),B(md,{key:14,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:Me,onSurveyCompleted:me,onSurveyRefused:xe,onNotResponding:he},null,8,["opportunity","activities"])):y("",!0),R.value?(o(),B(yd,{key:15,opportunity:t.opportunity,onCloseWon:Ue,onCloseLost:Le},null,8,["opportunity"])):y("",!0)]),W(Yi,{show:c.value,title:d.value,onClose:C[5]||(C[5]=F=>c.value=!1)},null,8,["show","title"]),W(Gi,{show:v.value,onConfirm:i,onCancel:C[6]||(C[6]=F=>v.value=!1)},null,8,["show"]),W(lr,{show:p.value,onConfirm:mt,onCancel:C[7]||(C[7]=F=>p.value=!1)},null,8,["show"]),W(_i,{show:w.value,onConfirm:ze,onCancel:C[8]||(C[8]=F=>w.value=!1)},null,8,["show"]),W(or,{show:T.value,onConfirm:Ke,onCancel:C[9]||(C[9]=F=>T.value=!1)},null,8,["show"]),W(Or,{show:b.value,"requested-vehicle":t.opportunity.requestedCar||t.opportunity.vehicle||null,"opportunity-id":t.opportunity.id,onClose:C[10]||(C[10]=F=>b.value=!1),onVehicleSelected:ae},null,8,["show","requested-vehicle","opportunity-id"]),(o(),B(je,{to:"body"},[r.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:oe(J,["self"])},[e("div",Yd,[e("div",Hd,[W(dt,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"selected-vehicle":t.opportunity.selectedVehicle||null,onSave:Re,onCancel:J},null,8,["task-id","selected-vehicle"])])])])):y("",!0)])),(o(),B(je,{to:"body"},[g.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:oe(be,["self"])},[e("div",Kd,[e("div",Gd,[W(ut,{show:g.value,onConfirm:Qe,onCancel:be},null,8,["show"])])])])):y("",!0)]))])):y("",!0)}};function lu(t){const k=nt(),s=it(),f=O(()=>t.value?t.value.type==="lead"?Bi:Jd:null),l=O(()=>t.value?t.value.type==="lead"?{currentActivities:O(()=>k.currentLeadActivities),addActivity:(g,u)=>k.addActivity(g,u),updateActivity:(g,u,c)=>k.updateActivity(g,u,c),deleteActivity:(g,u)=>k.deleteActivity(g,u)}:{currentActivities:O(()=>s.currentOpportunityActivities),addActivity:(g,u)=>s.addActivity(g,u),updateActivity:(g,u,c)=>s.updateActivity(g,u,c),deleteActivity:(g,u)=>s.deleteActivity(g,u),addVehicle:(g,u)=>s.addVehicle(g,u),createOffer:(g,u)=>s.createOffer(g,u),loadOpportunityById:g=>s.loadOpportunityById(g)}:null),n=O(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:f,storeAdapter:l,addNewConfig:n}}export{su as _,Ht as a,ou as b,lu as u};
