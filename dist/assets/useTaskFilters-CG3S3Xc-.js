const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-Dm10rkvw.js","assets/index-H5Cqf6fX.js","assets/index-Pz_Wb7EZ.css"])))=>i.map(i=>d[i]);
import{n as Ge,a as Vs,z as pt,F as mt,L as ft,H as vt,j as yt,C as gt,W as bt,K as Et}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-1_jAZFgo.js";import{E as ge,_ as at,c as E,d as v,o as i,e,g as M,t as I,n as F,s as w,x as z,D as N,y as s,$ as ts,a0 as Ut,Z as Wt,r as A,k as V,J as js,w as ss,p as Q,P as zs,T as Us,F as ce,i as he,a1 as Zt,j as jt,M as Pt,a2 as qt,G as Ht,h as ns,C as ht,u as At,R as Ot,L as Pe,q as Ws,l as ke,a3 as nt,v as ct,Q as X,K as ie,a4 as Ps,a5 as Hs,a6 as dt,a7 as ut,a8 as Ae,Y as Qs,z as Ys,m as as}from"./index-H5Cqf6fX.js";import{T as Gs,i as Js,e as Zs,h as Ks,s as Xs,j as _s,k as en,l as tn,d as Kt,a as Ye,m as Dt,_ as sn,n as nn,o as an,g as ln,c as on,f as rn,u as dn,p as un,P as cn,q as pn,r as mn,t as fn,v as vn,w as yn,x as gn,y as bn,z as hn}from"./ComingSoonModal-DnKIG9sS.js";import{S as ls}from"./sparkles-T3_ayguP.js";import{u as Mt}from"./opportunities-DEbYZ9Ha.js";import{_ as os}from"./ReassignUserModal-DI-WnWzN.js";import{u as Qt}from"./users-C7jahJiq.js";import{f as is}from"./vehicles-By7ZQa14.js";import{_ as xn}from"./CreateEventModal-DnaL32CW.js";import{_ as wn,a as kn}from"./EditEventModal-PD1ZHOsn.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=ge("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=ge("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=ge("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=ge("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=ge("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=ge("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=ge("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=ge("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=ge("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=ge("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=ge("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=ge("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=ge("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=ge("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ge("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=ge("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=ge("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ln={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Bn={class:"flex items-center justify-between gap-4 w-full h-full"},Fn={class:"flex flex-col min-w-0"},Rn={class:"flex items-center gap-2 min-w-0"},Vn={key:0,class:"text-fluid-lg font-medium text-greys-900 truncate"},jn={key:1,class:"text-fluid-lg font-medium text-greys-900"},zn={key:2,class:"flex items-center gap-1.5 shrink-0"},Un={class:"px-1.5 py-0.5 rounded bg-greys-100 text-greys-600 text-[10px] font-bold uppercase border border-E5E7EB"},Wn={key:0,class:"text-[11px] text-greys-500 truncate leading-none mt-0.5"},Pn={key:1,class:"text-fluid-sm text-greys-500"},Hn={class:"flex items-center gap-2 shrink-0"},Qn={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close"],setup(t){const C=t,n=E(()=>!C.task||!C.filteredTasks.length?!1:C.filteredTasks.findIndex($=>{const k=C.task.compositeId||C.task.id;return($.compositeId||$.id)===k})>0),o=E(()=>{if(!C.task||!C.filteredTasks.length)return!1;const u=C.filteredTasks.findIndex($=>{const k=C.task.compositeId||C.task.id;return($.compositeId||$.id)===k});return u>=0&&u<C.filteredTasks.length-1}),d=u=>u?u.type==="lead"?"Lead Qualification Task":u.type==="opportunity"?"Opportunity Management Task":"Task Details":"No task selected",l=u=>{var k;if(!u)return"";const $=[];if(u.vehicle||u.requestedCar){const h=u.vehicle||u.requestedCar;h.brand&&h.model?$.push(`${h.brand} ${h.model} (${h.year||"N/A"})`):h.model&&$.push(`${h.model} (${h.year||"N/A"})`)}return(k=u.customer)!=null&&k.name?$.push(u.customer.name):u.customerName&&$.push(u.customerName),$.join(" • ")},p=u=>u?u.stage||u.currentStage||"New":"",y=u=>{const $=p(u).toLowerCase();return $.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":$.includes("qualif")?"bg-green-50 text-green-600 border-green-200":$.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":$.includes("close")?"bg-greys-100 text-greys-600 border-greys-300":"bg-blue-50 text-blue-600 border-blue-200"};return(u,$)=>(i(),v("div",Ln,[e("div",Bn,[e("div",Fn,[e("div",Rn,[t.task?(i(),v("h2",Vn,I(d(t.task)),1)):(i(),v("h2",jn," No task selected ")),t.task?(i(),v("div",zn,[e("span",{class:F(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border border-transparent",y(t.task)])},I(p(t.task)),3),e("span",Un,I(t.task.source||"N/A"),1)])):M("",!0)]),t.task?(i(),v("p",Wn,I(l(t.task)),1)):(i(),v("p",Pn," Select a task to view details "))]),e("div",Hn,[w(s(Ge),{variant:"secondary",size:"icon",onClick:$[0]||($[0]=k=>u.$emit("previous")),disabled:!n.value},{default:N(()=>[w(s(Cn),{size:16,class:"text-greys-700"})]),_:1},8,["disabled"]),w(s(Ge),{variant:"secondary",size:"icon",onClick:$[1]||($[1]=k=>u.$emit("next")),disabled:!o.value},{default:N(()=>[w(s($n),{size:16,class:"text-greys-700"})]),_:1},8,["disabled"]),t.isDrawerView?(i(),z(s(Ge),{key:0,variant:"secondary",size:"icon",onClick:$[2]||($[2]=k=>u.$emit("close")),class:"ml-1"},{default:N(()=>[w(s(ts),{size:16,class:"text-greys-700"})]),_:1})):M("",!0)])])]))}},Yn=at(Qn,[["__scopeId","data-v-34aeb5a5"]]),Gn=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:t=>["lead","opportunity"].includes(t)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(t){return(C,n)=>(i(),v("div",null,[t.managementWidget?(i(),z(Wt(t.managementWidget),Ut({key:0,lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:t.activities},C.$attrs),null,16,["lead","opportunity","activities"])):M("",!0)]))}}),Jn=at(Gn,[["__scopeId","data-v-f5db9491"]]),Zn={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},Kn={key:0,class:"w-full h-20 rounded-btn overflow-hidden mb-4 bg-gray-100"},Xn=["src","alt"],_n={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},ea={class:"space-y-2 mb-4"},ta={class:"flex justify-between items-start gap-2"},sa={class:"min-w-0 flex-1"},na={class:"text-sm font-medium text-greys-900 truncate"},aa={key:0,class:"text-xs text-greys-500"},la={key:0,class:"text-sm font-semibold text-greys-900 shrink-0"},oa={key:0,class:"flex gap-3 text-xs text-greys-500"},ia={key:0},ra={key:1},da={key:2,class:"mb-4"},ua={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ca={class:"text-sm text-greys-900"},pa={class:"flex gap-2 pt-4 border-t border-black/5"},ma={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(t){const C=t,n=A(!1),o=E(()=>{const y=[];return C.vehicle.brand&&y.push(C.vehicle.brand),C.vehicle.model&&y.push(C.vehicle.model),C.vehicle.variant&&y.push(C.vehicle.variant),y.join(" ")||"Vehicle Details"}),d=y=>{if(!y)return"0";const u=typeof y=="string"?parseFloat(y):y;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u)},l=y=>{if(!y)return"0";const u=typeof y=="string"?parseFloat(y):y;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u)},p=()=>{n.value=!0};return(y,u)=>(i(),v("div",Zn,[u[4]||(u[4]=e("h3",{class:"text-base font-medium mb-4 text-greys-900 -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),t.imageUrl?(i(),v("div",Kn,[e("img",{src:t.imageUrl,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover",onError:p},null,40,Xn)])):(i(),v("div",_n,[w(s(Sn),{size:48,class:"text-gray-400"})])),e("div",ea,[e("div",ta,[e("div",sa,[e("p",na,I(o.value),1),t.vehicle.year?(i(),v("p",aa,I(t.vehicle.year),1)):M("",!0)]),t.vehicle.price?(i(),v("p",la," €"+I(d(t.vehicle.price)),1)):M("",!0)]),t.vehicle.mileage||t.vehicle.fuelType?(i(),v("div",oa,[t.vehicle.mileage?(i(),v("span",ia,I(l(t.vehicle.mileage))+" km",1)):M("",!0),t.vehicle.fuelType?(i(),v("span",ra,I(t.vehicle.fuelType),1)):M("",!0)])):M("",!0)]),t.source?(i(),v("div",da,[w(s(Vs),{variant:"secondary",class:"text-xs"},{default:N(()=>[V(I(t.source),1)]),_:1})])):M("",!0),t.requestMessage?(i(),v("div",ua,[u[2]||(u[2]=e("p",{class:"text-xs text-greys-500 mb-1"},"Request message",-1)),e("p",ca,I(t.requestMessage),1)])):M("",!0),e("div",pa,[w(s(Ge),{variant:"secondary",size:"sm",class:"flex-1",onClick:u[0]||(u[0]=$=>y.$emit("open-ad"))},{default:N(()=>[w(s(An),{size:16}),u[3]||(u[3]=e("span",null,"Open Ad",-1))]),_:1}),w(s(Ge),{variant:"secondary",size:"icon-sm",onClick:u[1]||(u[1]=$=>y.$emit("more-actions"))},{default:N(()=>[w(s(In),{size:16})]),_:1})])]))}},fa=at(ma,[["__scopeId","data-v-592ea29b"]]),va={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},ya={class:"mb-2"},ga={class:"flex items-center justify-between mb-1"},ba={class:"flex items-center gap-2 flex-wrap"},ha={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},xa={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},wa={key:0,class:"flex items-center gap-2 flex-wrap"},ka=["onClick"],Sa={class:"space-y-6"},Ca={key:0},$a={class:"flex flex-col items-start gap-1 mb-4"},Da={class:"text-fluid-sm font-normal text-greys-500",style:{"line-height":"var(--leading-5)"}},Aa={class:"relative"},Ta={class:"space-y-4"},Ia=["onClick"],Oa={class:"flex-1 min-w-0"},qa={class:"flex items-start justify-between gap-2"},Ea={class:"text-xs text-greys-900 flex-1 wrap-break-word min-w-0",style:{"line-height":"var(--leading-5)"}},Ma={key:0,class:"text-greys-500"},Na={key:1,class:"text-greys-500"},La={key:2,class:"text-greys-500"},Ba={key:3,class:"text-greys-500"},Fa={key:4,class:"text-greys-500"},Ra={key:5,class:"text-greys-500"},Va={key:6,class:"text-greys-500"},ja={class:"text-xs text-greys-500 text-right shrink-0 w-14",style:{"line-height":"var(--leading-5)"}},za={key:0,class:"mt-2 bg-[#fef7ee] rounded-lg p-4 backdrop-blur-sm"},Ua={class:"text-xs text-greys-900 wrap-break-word",style:{"line-height":"var(--leading-5)"}},Wa={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},Pa={class:"text-xs text-greys-900 wrap-break-word",style:{"line-height":"var(--leading-5)"}},Ha={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},Qa={class:"text-xs text-greys-900 wrap-break-word",style:{"line-height":"var(--leading-5)"}},Ya={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},Ga={class:"text-xs text-greys-900 wrap-break-word",style:{"line-height":"var(--leading-5)"}},Ja={key:1,class:"py-8"},Za={class:"relative mb-6"},Ka={class:"text-center"},Xa={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(t,{emit:C}){const n=t,o=C,d=A(!1),l=A(!1),p=A(null),y=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],u=A([]),$=()=>{l.value=!l.value},k=x=>{l.value=!1;const r=u.value.indexOf(x);r>-1?u.value.splice(r,1):u.value.push(x)},h=x=>{const r=u.value.indexOf(x);r>-1&&u.value.splice(r,1)},f=x=>{const r=y.find(c=>c.value===x);return r?r.label:x},b=E(()=>y.map(x=>({key:x.value,label:x.label,onClick:()=>k(x.value),className:u.value.includes(x.value)?"filter-item-selected":""}))),S=x=>x.important||x.isImportant?"important":["email","sms","whatsapp","call"].includes(x.type)?"communications":x.type==="note"?"notes":x.type==="transcription"||x.transcription?"transcriptions":x.type==="system"||x.type==="created"||x.type==="status"?"system-updates":null,T=E(()=>{let x=[...n.activities];return u.value.length>0&&(x=x.filter(r=>{const c=S(r);return c&&u.value.includes(c)})),x.sort((r,c)=>{const g=new Date(r.timestamp||r.createdAt||0).getTime();return new Date(c.timestamp||c.createdAt||0).getTime()-g})}),O=x=>{if(!x||x.length===0)return"";const r=x[0],c=r.timestamp||r.createdAt;if(!c)return"Recent Activity";const g=new Date(c),R=new Date,j=new Date(R);return j.setDate(j.getDate()-1),g.toDateString()===R.toDateString()?"Today":g.toDateString()===j.toDateString()?"Yesterday":g.toLocaleDateString("en-US",{month:"long",day:"numeric",year:g.getFullYear()!==R.getFullYear()?"numeric":void 0})},m=x=>{["note","email","whatsapp"].includes(x.type)&&o("activity-click",x)};return(x,r)=>{const c=js("click-outside");return i(),v("div",va,[e("div",ya,[e("div",ga,[r[16]||(r[16]=e("h3",{class:"text-base font-medium text-greys-900 leading-6"},"Activity",-1)),e("div",ba,[e("div",{class:"relative",ref_key:"filterContainer",ref:p},[e("button",{onClick:ss($,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[r[14]||(r[14]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),u.value.length>0?(i(),v("span",ha)):M("",!0)]),w(Us,{name:"dropdown"},{default:N(()=>[l.value?Q((i(),v("div",xa,[w(s(zs),{items:b.value,className:"w-56"},null,8,["items"])])),[[c,()=>l.value=!1]]):M("",!0)]),_:1})],512),u.value.length>0?(i(),v("div",wa,[(i(!0),v(ce,null,he(u.value,g=>(i(),v("div",{key:g,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-xs font-medium text-heading border border-E5E7EB"},[e("span",null,I(f(g)),1),e("button",{onClick:R=>h(g),class:"flex items-center justify-center w-4 h-4 rounded-full hover:bg-gray-200 transition-colors text-sub hover:text-heading","aria-label":"Remove filter"},[...r[15]||(r[15]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])],8,ka)]))),128))])):M("",!0)])])]),e("div",Sa,[T.value.length>0?(i(),v("div",Ca,[e("div",$a,[e("h3",Da,I(O(T.value)),1),e("div",Aa,[e("button",{onClick:r[0]||(r[0]=g=>d.value=!d.value),class:"flex items-center gap-1.5 text-xs font-medium text-blue-600 hover:text-blue-700 underline decoration-blue-600 hover:decoration-blue-700 transition-colors"},[w(s(Zt),{size:14}),r[17]||(r[17]=V(" Add activity ",-1))]),d.value?(i(),v("div",{key:0,class:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-black/10 py-1 z-10",onClick:r[6]||(r[6]=g=>d.value=!1)},[e("button",{onClick:r[1]||(r[1]=g=>x.$emit("add-activity","note")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s(Vt),{size:16,class:"text-orange-600"}),r[18]||(r[18]=V(" Note ",-1))]),e("button",{onClick:r[2]||(r[2]=g=>x.$emit("add-activity","sms")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s($t),{size:16,class:"text-purple-600"}),r[19]||(r[19]=V(" SMS ",-1))]),e("button",{onClick:r[3]||(r[3]=g=>x.$emit("add-activity","whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s($t),{size:16,class:"text-green-600"}),r[20]||(r[20]=V(" WhatsApp ",-1))]),e("button",{onClick:r[4]||(r[4]=g=>x.$emit("add-activity","tradein")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...r[21]||(r[21]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"text-blue-600"},[e("path",{d:"M7 17L17 7M7 7h10v10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),V(" Trade-In ",-1)])]),e("button",{onClick:r[5]||(r[5]=g=>x.$emit("add-activity","purchase-method")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s(Rt),{size:16,class:"text-indigo-600"}),r[22]||(r[22]=V(" Purchase Method ",-1))])])):M("",!0)])]),e("div",Ta,[(i(!0),v(ce,null,he(T.value,g=>(i(),v("div",{key:g.id,class:"space-y-2"},[e("div",{class:F(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":g.type==="note"||g.type==="email"||g.type==="whatsapp"}]),onClick:R=>m(g)},[e("div",{class:F(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",g.type==="note"?"bg-orange-100":g.type==="call"?"bg-green-100":g.type==="ai-summary"?"bg-purple-100":g.type==="email"?"bg-blue-100":g.type==="whatsapp"?"bg-green-100":"bg-greys-100"])},[g.type==="note"?(i(),z(s(Vt),{key:0,size:16,class:"text-orange-600"})):g.type==="call"?(i(),z(s(qn),{key:1,size:16,class:"text-green-600"})):g.type==="ai-summary"?(i(),z(s(ls),{key:2,size:16,class:"text-purple-600"})):g.type==="email"?(i(),z(s(Tn),{key:3,size:16,class:"text-blue-600"})):g.type==="whatsapp"?(i(),z(s($t),{key:4,size:16,class:"text-green-600"})):(i(),z(s(Rt),{key:5,size:16,class:"text-greys-900"}))],2),e("div",Oa,[e("div",qa,[e("p",Ea,[e("span",{class:F(["font-normal",g.type==="ai-summary"?"font-medium":""])},I(g.type==="ai-summary"?"MotorKAI":g.user),3),g.type==="note"?(i(),v("span",Ma," added a note")):g.type==="created"?(i(),v("span",Na,I(g.message||g.action),1)):g.type==="call"?(i(),v("span",La,I(" "+(g.message||g.action)),1)):g.type==="ai-summary"?(i(),v("span",Ba," summary")):g.type==="email"?(i(),v("span",Fa,I(" sent an email"))):g.type==="whatsapp"?(i(),v("span",Ra,I(" sent a WhatsApp message"))):(i(),v("span",Va,I(" "+(g.message||g.action)),1))]),e("p",ja,I(g.time),1)]),g.type==="note"&&(g.message||g.content)?(i(),v("div",za,[e("p",Ua,I(g.message||g.content),1)])):M("",!0),g.type==="email"&&g.content?(i(),v("div",Wa,[e("p",Pa,I(g.content),1)])):M("",!0),g.type==="whatsapp"&&g.content?(i(),v("div",Ha,[e("p",Qa,I(g.content),1)])):M("",!0),g.type==="ai-summary"&&(g.message||g.content)?(i(),v("div",Ya,[e("p",Ga,I(g.message||g.content),1)])):M("",!0)])],10,Ia)]))),128))])])):(i(),v("div",Ja,[e("div",Za,[e("button",{onClick:r[7]||(r[7]=g=>d.value=!d.value),class:"flex items-center gap-1.5 text-xs font-medium text-blue-600 hover:text-blue-700 underline decoration-blue-600 hover:decoration-blue-700 transition-colors"},[w(s(Zt),{size:14}),r[23]||(r[23]=V(" Add activity ",-1))]),d.value?(i(),v("div",{key:0,class:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-black/10 py-1 z-10",onClick:r[13]||(r[13]=g=>d.value=!1)},[e("button",{onClick:r[8]||(r[8]=g=>x.$emit("add-activity","note")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s(Vt),{size:16,class:"text-orange-600"}),r[24]||(r[24]=V(" Note ",-1))]),e("button",{onClick:r[9]||(r[9]=g=>x.$emit("add-activity","sms")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s($t),{size:16,class:"text-purple-600"}),r[25]||(r[25]=V(" SMS ",-1))]),e("button",{onClick:r[10]||(r[10]=g=>x.$emit("add-activity","whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s($t),{size:16,class:"text-green-600"}),r[26]||(r[26]=V(" WhatsApp ",-1))]),e("button",{onClick:r[11]||(r[11]=g=>x.$emit("add-activity","tradein")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...r[27]||(r[27]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"text-blue-600"},[e("path",{d:"M7 17L17 7M7 7h10v10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),V(" Trade-In ",-1)])]),e("button",{onClick:r[12]||(r[12]=g=>x.$emit("add-activity","purchase-method")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[w(s(Rt),{size:16,class:"text-indigo-600"}),r[28]||(r[28]=V(" Purchase Method ",-1))])])):M("",!0)]),e("div",Ka,[w(s(Dn),{size:32,class:"mx-auto text-greys-400 mb-2"}),r[29]||(r[29]=e("p",{class:"text-sm text-greys-500"},"No activity yet",-1))])]))])])}}},_a=at(Xa,[["__scopeId","data-v-887c6c1e"]]),el={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},tl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},sl={class:"flex flex-1 overflow-hidden"},nl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},al={class:"flex-1 overflow-y-auto"},ll={class:"p-2"},ol={class:"right-sidebar flex flex-col overflow-hidden shrink-0 border-l border-black/5",style:{"background-color":"#F8F8F8"}},il={class:"flex border-b border-black/5 bg-white"},rl={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"},dl={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"},ul={class:"flex-1 overflow-y-auto"},cl={key:0,class:"space-y-2 p-2"},pl={key:1,class:"p-2"},ml={key:1,class:"flex-1 flex items-center justify-center bg-surface"},fl={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close"],setup(t,{emit:C}){const n=t,o=C,d=A("request"),l=A({}),p=E(()=>{var T;return((T=n.storeAdapter.currentActivities)==null?void 0:T.value)||[]}),y=()=>{o("task-navigate","previous")},u=()=>{o("task-navigate","next")},$=T=>{d.value!=="activity"&&(d.value="activity"),console.log("Activity clicked:",T)},k=T=>{l.value[T]=!l.value[T]},h=T=>T&&(T.image||T.imageUrl)||"",f=()=>{console.log("Open ad clicked")},b=()=>{console.log("More actions clicked")},S=T=>{console.log("Contact action:",T)};return(T,O)=>{var m,x;return i(),v("div",el,[t.task?(i(),v("div",tl,[w(Yn,{task:t.task,"filtered-tasks":t.filteredTasks,"is-drawer-view":t.isDrawerView,onPrevious:y,onNext:u,onClose:O[0]||(O[0]=r=>T.$emit("close"))},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",sl,[e("div",nl,[e("div",al,[e("div",ll,[w(Jn,Ut({task:t.task,type:t.task.type,"management-widget":t.managementWidget,activities:p.value},T.$attrs),null,16,["task","type","management-widget","activities"])])])]),e("div",ol,[e("div",il,[e("button",{onClick:O[1]||(O[1]=r=>d.value="request"),class:F(["flex-1 px-4 py-3 text-sm font-medium transition-colors relative",d.value==="request"?"text-blue-600":"text-greys-600 hover:text-greys-900"])},[O[3]||(O[3]=V(" Request ",-1)),d.value==="request"?(i(),v("span",rl)):M("",!0)],2),e("button",{onClick:O[2]||(O[2]=r=>d.value="activity"),class:F(["flex-1 px-4 py-3 text-sm font-medium transition-colors relative",d.value==="activity"?"text-blue-600":"text-greys-600 hover:text-greys-900"])},[O[4]||(O[4]=V(" Activity ",-1)),d.value==="activity"?(i(),v("span",dl)):M("",!0)],2)]),e("div",ul,[d.value==="request"?(i(),v("div",cl,[w(Gs,{task:t.task,"task-type":t.task.type,"customer-id":t.task.customerId||((m=t.task.customer)==null?void 0:m.id),onAction:S},null,8,["task","task-type","customer-id"]),t.task.requestedCar||t.task.vehicle?(i(),z(fa,{key:0,vehicle:t.task.requestedCar||t.task.vehicle,"request-message":t.task.requestMessage||((x=t.task.requestedCar)==null?void 0:x.requestMessage),source:t.task.source,"image-url":h(t.task.requestedCar||t.task.vehicle),onOpenAd:f,onMoreActions:b},null,8,["vehicle","request-message","source","image-url"])):M("",!0)])):M("",!0),d.value==="activity"?(i(),v("div",pl,[w(_a,{activities:p.value,"expanded-summaries":l.value,onActivityClick:$,onToggleSummaryExpanded:k},null,8,["activities","expanded-summaries"])])):M("",!0)])])])])):(i(),v("div",ml,[...O[5]||(O[5]=[jt('<div class="text-center max-w-sm p-8" data-v-b9cfe5ba><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-b9cfe5ba><i class="fa-solid fa-tasks text-2xl text-sub" data-v-b9cfe5ba></i></div><h3 class="text-fluid-lg font-bold text-heading mb-2" data-v-b9cfe5ba>No task selected</h3><p class="text-fluid-sm text-sub" data-v-b9cfe5ba>Select a task from the list to view its details and manage activities</p></div>',1)])]))])}}},su=at(fl,[["__scopeId","data-v-b9cfe5ba"]]);function rs(t,C={}){const n=Pt(),o=E(()=>{const O=typeof t=="function"?t():qt(t);return{lead:O,displayStage:O?Ht(O,"lead"):null}}),d=E(()=>o.value.displayStage||"New"),l=E(()=>{const O=o.value;return Js(O)}),p=E(()=>{const O=o.value,m=Zs(O);if(!m)return null;const x=C[m.key];return{...m,handler:x||(()=>{})}}),y=E(()=>{const O=o.value;return Ks(O).map(x=>{const r=C[x.key];return{...x,handler:r||(()=>{})}})}),u=E(()=>{const O=o.value;return Xs(O)}),$=E(()=>{const O=o.value;return _s(O)}),k=E(()=>{const O=o.value;return en(O)}),h=E(()=>{const O=o.value;return tn(O)}),f=E(()=>{const m=o.value.lead;return((m==null?void 0:m.contactAttempts)||[]).length||0}),b=E(()=>n.getSetting("maxContactAttempts")),S=E(()=>f.value+1>=b.value),T=E(()=>!0);return{displayStage:d,isClosed:l,primaryAction:p,secondaryActions:y,showLQWidget:u,showDeadlineBanner:$,canPostpone:k,canReassign:T,lqWidgetMode:h,contactAttempts:f,maxContactAttempts:b,shouldShowAutoDisqualifyWarning:S}}function vl({getLead:t,leadState:C,emit:n}){const o=ns(),d=ht(),l=At();async function p(m){var r;const x=t();if(x&&C.canPostpone.value)try{const c=new Date(`${m.date}T${m.time}:00`),g=c.toISOString(),R={nextActionDue:g};if((m.assigneeId||m.teamId)&&(R.assignee=m.assignee||null,R.assigneeId=m.assigneeId||null,R.assigneeType=m.assigneeType||"user",R.teamId=m.teamId||null,R.team=m.team||null),await d.updateLead(x.id,R),m.createAppointment){const j=new Date(c);j.setHours(j.getHours()+1),await d.updateLead(x.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${x.customer.name}`,start:g,end:j.toISOString(),type:"Call",assignee:m.assignee||x.assignee,assigneeId:m.assigneeId||x.assigneeId,assigneeType:m.assigneeType||x.assigneeType||"user",teamId:m.teamId||x.teamId,team:m.team||x.team,status:"scheduled"}}),await d.addActivity(x.id,{type:"appointment",user:((r=l.currentUser)==null?void 0:r.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ye(c)} at ${Dt(c)}`,data:{type:"Call",date:m.date,time:m.time,assignee:m.assignee||x.assignee}})}await d.addActivity(x.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ye(c)} at ${Dt(c)}${m.assignee?` and reassigned to ${m.assignee}`:""}`}),await d.fetchLeadById(x.id)}catch(c){console.error("Failed to postpone lead task:",c)}}async function y(m){const x=t();if(x)try{if(await d.updateLead(x.id,{stage:"Validated"}),await d.addActivity(x.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),m.scheduleFollowUp&&m.appointmentData){const r=new Date(`${m.appointmentData.date}T${m.appointmentData.time}:00`);await d.scheduleFollowUp(x.id,{dateTime:r.toISOString(),assignee:m.appointmentData.assignee||x.assignee,assigneeId:m.appointmentData.assigneeId||null,assigneeType:m.appointmentData.assigneeType||"user",teamId:m.appointmentData.teamId||null,team:m.appointmentData.team||null}),await d.addActivity(x.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ye(r)} at ${Dt(r)}`})}await d.fetchLeadById(x.id)}catch(r){console.error("Failed to validate lead:",r)}}async function u(m){var r,c,g;const x=t();if(x)try{if((r=m==null?void 0:m.assignment)!=null&&r.assignee){const j=m.assignment.assignee,ee={assignee:j.name||j.label||null,assigneeId:j.id||null,assigneeType:j.type||"user"};j.type==="team"&&(ee.teamId=j.id||null,ee.team=j.name||null),m.assignment.salesperson&&(ee.assignee=m.assignment.salesperson.name||m.assignment.salesperson,ee.assigneeId=m.assignment.salesperson.id||null,ee.assigneeType="user",ee.teamId=j.id||null,ee.team=j.name||null),await d.updateLead(x.id,ee);const Se=((c=m.assignment.salesperson)==null?void 0:c.name)||j.name||"Unassigned";await d.addActivity(x.id,{type:"note",user:((g=l.currentUser)==null?void 0:g.name)||"You",action:"assigned lead",content:`Lead assigned to ${Se}${m.assignment.salesperson&&j.name?` (${j.name} team)`:""}`,timestamp:new Date().toISOString()})}const R=await d.convertLeadToOpportunity(x.id);l.canAccessOpportunities()?o.push({path:`/tasks/${R}`,query:{type:"opportunity"}}):o.push("/tasks")}catch(R){console.error("Failed to qualify lead:",R)}}async function $(m){const x=t();if(x)try{const r=x.contactAttempts||[];await d.updateLead(x.id,{contactAttempts:[...r,m],lastContactAttempt:m.timestamp,totalContactAttempts:r.length+1}),await d.addActivity(x.id,{type:"call",user:"You",action:`logged call attempt - ${m.outcome}`,content:m.notes||`Call attempt via ${m.channel}`,data:{outcome:m.outcome,channel:m.channel,duration:m.duration}}),await d.fetchLeadById(x.id)}catch(r){console.error("Failed to log call attempt:",r)}}async function k(m){const x=t();if(x)try{await d.addActivity(x.id,{type:"note",user:"You",action:"added a note",content:m.content||m.text||"",data:m}),await d.fetchLeadById(x.id)}catch(r){console.error("Failed to save note:",r)}}function h(){n("open-purchase-method")}function f(){n("open-trade-in")}async function b(m){var r;const x=t();if(x)try{const c=m.datetime?new Date(m.datetime).toISOString().split("T")[0]+"T"+m.time+":00":`${m.date}T${m.time}:00`,g=new Date(c),R=m.duration||60;g.setMinutes(g.getMinutes()+R);const j={scheduledAppointment:{id:Date.now(),title:`${m.type} - ${x.customer.name}`,start:c,end:g.toISOString(),type:m.type,assignee:m.assignee,assigneeId:m.assigneeId||m.salespersonId||m.teamId,assigneeType:m.assigneeType||(m.salespersonId?"user":"team"),teamId:m.teamId||null,team:m.team||null,salesperson:m.salesperson||null,salespersonId:m.salespersonId||null,status:"scheduled",location:m.location||"",notes:m.notes||""}};(m.assigneeId||m.salespersonId||m.teamId)&&(j.assignee=m.assignee||m.salesperson||m.team,j.assigneeId=m.assigneeId||m.salespersonId||m.teamId,j.assigneeType=m.assigneeType||(m.salespersonId?"user":"team"),m.teamId&&(j.teamId=m.teamId,j.team=m.team)),await d.updateLead(x.id,j),await d.addActivity(x.id,{type:"appointment",user:((r=l.currentUser)==null?void 0:r.name)||"You",action:"scheduled an appointment",content:`${m.type} scheduled for ${Ye(new Date(c))} at ${m.time}`,data:{type:m.type,date:m.date||Ye(new Date(c)),time:m.time,assignee:m.assignee,assigneeId:m.assigneeId,team:m.team,salesperson:m.salesperson}}),await d.fetchLeadById(x.id)}catch(c){console.error("Failed to schedule appointment:",c)}}async function S(m){const x=t();if(x&&!(C.isClosed.value&&!m.force))try{const r=C.displayStage.value,c=m.reason==="Duplicate"?Ot.CLOSED_DUPLICATE:m.category==="Not Interested"?Ot.CLOSED_NOT_INTERESTED:Ot.CLOSED_INVALID,g=Kt(r,c);if(g){const{updates:R,activities:j}=g(x,c,m);await d.updateLead(x.id,R);for(const ee of j)await d.addActivity(x.id,ee)}else{const R=m.reason==="Duplicate";await d.updateLead(x.id,{isDisqualified:!0,disqualifyReason:m.reason,isDuplicate:R,stage:R?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await d.addActivity(x.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${m.category}, Reason: ${m.reason}`})}o.push("/tasks")}catch(r){console.error("Failed to disqualify lead:",r)}}async function T(){const m=t();if(m)try{const x=C.displayStage.value,r=Ot.NEW,c=Kt(x,r);if(c){const{updates:g,activities:R}=c(m);await d.updateLead(m.id,g);for(const j of R)await d.addActivity(m.id,j)}else await d.updateLead(m.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await d.addActivity(m.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await d.fetchLeadById(m.id)}catch(x){console.error("Failed to reopen lead:",x)}}function O(){const m=t();m&&m.opportunityId&&o.push({path:`/tasks/${m.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:p,handleValidated:y,handleQualified:u,handleCallAttemptLogged:$,handleNoteSaved:k,handleOpenPurchaseMethod:h,handleOpenTradeIn:f,handleAppointmentScheduled:b,handleDisqualified:S,handleReopen:T,viewOpportunity:O}}const yl={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},gl={class:"space-y-6"},ds={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(t){return(C,n)=>t.task?(i(),v("div",{key:0,class:F(["rounded-lg flex flex-col",t.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[t.hideTitle?M("",!0):(i(),v("div",yl,[...n[0]||(n[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:F(["bg-white rounded-lg p-2 flex flex-col",t.hideBorder?"shadow-none":"shadow-sm"]),style:Ws(t.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[Pe(C.$slots,"deadline-banner"),e("div",gl,[Pe(C.$slots,"primary-action"),Pe(C.$slots,"task-widgets"),Pe(C.$slots,"closed-state"),Pe(C.$slots,"secondary-actions")])],6)],2)):M("",!0)}},bl={class:"flex justify-between items-start mb-3"},hl={class:"font-bold text-gray-900 text-fluid-sm"},xl={class:"text-fluid-xs text-gray-500 mt-0.5"},wl={class:"flex gap-3 flex-wrap"},us={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(C,n)=>(i(),v("div",{class:F(["rounded-card p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",bl,[e("div",null,[e("h4",hl,I(t.action.title),1),e("p",xl,I(t.action.description),1)])]),e("div",wl,[e("button",{onClick:n[0]||(n[0]=o=>C.$emit("action-clicked")),class:F([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:F(t.action.icon)},null,2),V(" "+I(t.action.label),1)],2)])],2))}},kl={class:"rounded-lg",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Sl={class:"bg-white rounded-lg px-3 py-2 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Cl={key:0,class:"flex items-center justify-between gap-2"},$l={class:"flex items-center gap-2 min-w-0 flex-1"},Dl={class:"min-w-0 flex-1"},Al={class:"text-sm font-semibold text-greys-900 truncate leading-tight"},Tl={class:"font-normal text-greys-500"},Il={class:"text-xs text-greys-500 truncate leading-tight"},Ol={key:1,class:"space-y-2"},ql={class:"flex items-center justify-between gap-2 flex-wrap"},El={class:"flex items-center gap-1.5 shrink-0"},Ml={key:0,class:"flex gap-1.5 flex-wrap"},Nl=["onClick"],Ll={__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"}},emits:["reassigned"],setup(t,{emit:C}){const n=t,o=C,d=Qt(),l=At(),p=ht(),y=Mt(),u=A(!1),$=A(null),k=E(()=>l.currentUser),h=E(()=>!!(n.task.assignee||n.task.owner||n.task.assignedTo)),f=E(()=>{var g;const r=n.task.assignee||n.task.owner||n.task.assignedTo||"Unassigned",c=(g=d.allUsers)==null?void 0:g.find(R=>R.name===r);return{name:r,team:(c==null?void 0:c.team)||n.task.assigneeTeam||n.task.team||"No team",dealership:(c==null?void 0:c.dealership)||n.task.assigneeDealership||"MotorK Dealership",role:(c==null?void 0:c.role)||n.task.assigneeRole||"salesman"}});E(()=>!k.value||!h.value?!1:f.value.name===k.value.name);const b=E(()=>(d.assignableTeams||[]).slice(0,3)),S=r=>!r||r==="Unassigned"?"?":r.split(" ").map(c=>c[0]).join("").toUpperCase().substring(0,2),T=r=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[r]||"bg-surfaceSecondary text-body",O=async()=>{if(k.value)try{n.taskType==="lead"?await p.updateLead(n.task.id,{assignee:k.value.name,assigneeType:"user",assigneeTeam:k.value.team,assigneeDealership:k.value.dealership,assigneeRole:k.value.role}):n.taskType==="opportunity"&&await y.updateOpportunity(n.task.id,{assignee:k.value.name,assigneeType:"user",assigneeTeam:k.value.team,assigneeDealership:k.value.dealership,assigneeRole:k.value.role}),o("reassigned",k.value)}catch(r){console.error("Error assigning to self:",r)}},m=async r=>{$.value=r;try{n.taskType==="lead"?await p.updateLead(n.task.id,{assignee:r.name,assigneeType:"team",teamId:r.id,assigneeTeam:r.name}):n.taskType==="opportunity"&&await y.updateOpportunity(n.task.id,{assignee:r.name,assigneeType:"team",teamId:r.id,assigneeTeam:r.name}),o("reassigned",r)}catch(c){console.error("Error assigning to team:",c)}},x=async r=>{try{const c={assignee:r.name,assigneeType:r.type,assigneeTeam:r.team,assigneeDealership:r.dealership,assigneeRole:r.role};r.type==="team"&&(c.teamId=r.id),n.taskType==="lead"?await p.updateLead(n.task.id,c):n.taskType==="opportunity"&&await y.updateOpportunity(n.task.id,c),u.value=!1,o("reassigned",r)}catch(c){console.error("Error reassigning:",c)}};return(r,c)=>(i(),v(ce,null,[e("div",kl,[e("div",Sl,[h.value?(i(),v("div",Cl,[e("div",$l,[e("div",{class:F(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",T(f.value.role)])},I(S(f.value.name)),3),e("div",Dl,[e("p",Al,[V(I(f.value.name)+" ",1),e("span",Tl,"• "+I(f.value.team),1)]),e("p",Il,I(f.value.dealership),1)])]),w(s(Ge),{variant:"ghost",size:"sm",onClick:c[0]||(c[0]=g=>u.value=!0),class:"shrink-0 text-xs px-2 py-1"},{default:N(()=>[...c[3]||(c[3]=[V(" Change ",-1)])]),_:1})])):(i(),v("div",Ol,[e("div",ql,[c[6]||(c[6]=e("p",{class:"text-sm text-greys-500 font-medium"},"Unassigned",-1)),e("div",El,[w(s(Ge),{variant:"primary",size:"sm",onClick:O,class:"!bg-brand-red text-sm px-3 py-1"},{default:N(()=>[...c[4]||(c[4]=[V(" Assign to me ",-1)])]),_:1}),w(s(Ge),{variant:"outline",size:"sm",onClick:c[1]||(c[1]=g=>u.value=!0),class:"text-sm px-3 py-1 border-D1D5DB"},{default:N(()=>[...c[5]||(c[5]=[V(" Assign to someone ",-1)])]),_:1})])]),b.value.length>0?(i(),v("div",Ml,[(i(!0),v(ce,null,he(b.value,g=>{var R;return i(),v("button",{key:g.id,class:F(["inline-flex items-center gap-1 px-2 py-0.5 rounded-md border text-xs font-medium transition-all",((R=$.value)==null?void 0:R.id)===g.id?"border-brand-blue bg-blue-50 text-brand-blue":"border-E5E7EB hover:border-brand-blue/30 text-greys-600"]),onClick:j=>m(g)},[c[7]||(c[7]=e("i",{class:"fa-solid fa-users text-xs"},null,-1)),V(" "+I(g.name),1)],10,Nl)}),128))])):M("",!0)]))])]),w(os,{show:u.value,title:h.value?"Reassign task":"Assign task","confirm-label":h.value?"Reassign":"Assign",onClose:c[2]||(c[2]=g=>u.value=!1),onConfirm:x},null,8,["show","title","confirm-label"])],64))}},cs=at(Ll,[["__scopeId","data-v-8fbba5aa"]]),zt=(t,C)=>{if(!t||!C)return[];const n=new Date(C).getDay();if(n===0||n===6)return[];const[d,l]=t.split("-"),p=parseInt(l);return d==="team"?Fl(p,C):d==="user"?Bl(p,C,n):[]},Bl=(t,C,n)=>{const o={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(o[t]||o[1])[n]||[]},Fl=(t,C)=>{const n=new Date(C).getDay(),o=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return t===1?n===1||n===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:t===2?o.filter((d,l)=>l%2===0):o},Rl={class:"space-y-6"},Vl={class:"space-y-3"},jl={key:0,class:"space-y-4"},zl={class:"flex gap-2"},Ul={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Wl={class:"flex items-center justify-between mb-4"},Pl={class:"text-fluid-sm font-semibold text-heading"},Hl={class:"grid grid-cols-7 gap-1 mb-2"},Ql={class:"grid grid-cols-7 gap-1"},Yl=["onClick"],Gl={class:"text-fluid-sm font-semibold text-heading mb-4"},Jl={key:0,class:"space-y-2"},Zl=["onClick"],Kl={key:1,class:"text-fluid-sm text-sub py-4 text-center"},Xl={key:2,class:"text-fluid-sm text-sub py-4 text-center"},_l={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(t,{emit:C}){const n=t,o=C,d=At(),l=Qt(),p=A("assign-and-schedule"),y=A(""),u=A(null),$=A(""),k=A(""),h=A("30min"),f=A(new Date().getMonth()),b=A(new Date().getFullYear()),S=A(null);E(()=>l.assignableUsers),E(()=>l.assignableTeams);const T=E(()=>new Date(b.value,f.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),O=E(()=>{const Y=new Date(b.value,f.value,1),W=new Date(b.value,f.value+1,0).getDate(),ae=Y.getDay(),Z=[];for(let se=0;se<ae;se++)Z.push(null);for(let se=1;se<=W;se++)Z.push(se);return Z}),m=E(()=>{if(!S.value||!$.value)return"Select a date";const Y=new Date($.value),L=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],W=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${L[Y.getDay()]}, ${W[Y.getMonth()]} ${Y.getDate()}`}),x=Y=>{if(!Y||!$.value)return!1;const L=new Date($.value);return L.getDate()===Y&&L.getMonth()===f.value&&L.getFullYear()===b.value},r=Y=>{if(!Y)return;const L=new Date(b.value,f.value,Y);$.value=L.toISOString().split("T")[0],S.value=Y,k.value=""},c=()=>{f.value===0?(f.value=11,b.value--):f.value--},g=()=>{f.value===11?(f.value=0,b.value++):f.value++},R=E(()=>!$.value||!u.value?[]:zt(u.value,$.value)),j=()=>{var Y;if(n.preselectedAssignee){const{type:L,id:W}=n.preselectedAssignee;u.value=`${L}-${W}`}else u.value=`user-${((Y=d.currentUser)==null?void 0:Y.id)||1}`};j();const ee=E(()=>p.value==="assign-only"?!0:!!(y.value&&$.value&&k.value&&u.value));ke(()=>n.show,Y=>{Y?j():Se()}),ke($,()=>{k.value=""});const Se=()=>{p.value="assign-and-schedule",y.value="",$.value="",k.value="",h.value="30min",S.value=null;const Y=new Date;f.value=Y.getMonth(),b.value=Y.getFullYear()},Ce=Y=>{Y||o("close")},be=()=>{if(!ee.value)return;const Y=u.value.startsWith("team-"),L=parseInt(u.value.split("-")[1]);let W={};if(Y){const Z=l.getTeamById(L);W={assigneeType:"team",teamId:L,team:(Z==null?void 0:Z.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const Z=l.getUserById(L);W={assigneeType:"user",assigneeId:L,assignee:(Z==null?void 0:Z.name)||"Unknown",teamId:null,team:null}}const ae={...W};p.value==="assign-and-schedule"&&(ae.type=y.value,ae.date=$.value,ae.time=k.value,ae.duration=h.value),o("confirm",ae),o("close")},re=()=>{o("close")};return(Y,L)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":Ce},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-4xl"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),{class:"text-fluid-lg"},{default:N(()=>[...L[6]||(L[6]=[V("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",Rl,[e("div",Vl,[e("label",{class:F(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",p.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Q(e("input",{type:"radio","onUpdate:modelValue":L[0]||(L[0]=W=>p.value=W),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[nt,p.value]]),L[7]||(L[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:F(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",p.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Q(e("input",{type:"radio","onUpdate:modelValue":L[1]||(L[1]=W=>p.value=W),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[nt,p.value]]),L[8]||(L[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),p.value==="assign-and-schedule"?(i(),v("div",jl,[L[14]||(L[14]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Schedule",-1)),e("div",null,[L[10]||(L[10]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Event type",-1)),Q(e("select",{"onUpdate:modelValue":L[2]||(L[2]=W=>y.value=W),class:"input text-fluid-sm w-full"},[...L[9]||(L[9]=[e("option",{value:"",disabled:""},"Select event type",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ct,y.value]])]),e("div",null,[L[11]||(L[11]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Duration",-1)),e("div",zl,[e("button",{onClick:L[3]||(L[3]=W=>h.value="30min"),class:F(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",h.value==="30min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 30min ",2),e("button",{onClick:L[4]||(L[4]=W=>h.value="60min"),class:F(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",h.value==="60min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 60min ",2),e("button",{onClick:L[5]||(L[5]=W=>h.value="custom"),class:F(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",h.value==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," Custom ",2)])]),e("div",Ul,[e("div",null,[e("div",Wl,[e("button",{onClick:c,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...L[12]||(L[12]=[e("i",{class:"fa-solid fa-chevron-left text-fluid-sm text-body"},null,-1)])]),e("h6",Pl,I(T.value),1),e("button",{onClick:g,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...L[13]||(L[13]=[e("i",{class:"fa-solid fa-chevron-right text-fluid-sm text-body"},null,-1)])])]),e("div",Hl,[(i(),v(ce,null,he(["SUN","MON","TUE","WED","THU","FRI","SAT"],W=>e("div",{key:W,class:"text-center text-fluid-xs font-medium text-sub py-2"},I(W),1)),64))]),e("div",Ql,[(i(!0),v(ce,null,he(O.value,(W,ae)=>(i(),v("div",{key:ae,onClick:Z=>r(W),class:F(["aspect-square flex items-center justify-center text-fluid-sm font-medium rounded-lg cursor-pointer transition-all",x(W)?"bg-green-600 text-white":W?"text-body hover:bg-surfaceSecondary":"text-transparent"])},I(W),11,Yl))),128))])]),e("div",null,[e("h6",Gl,I(m.value),1),$.value&&R.value.length>0?(i(),v("div",Jl,[(i(!0),v(ce,null,he(R.value,W=>(i(),v("button",{key:W,onClick:ae=>k.value=W,class:F(["w-full py-2 px-4 border-2 rounded-lg text-fluid-sm font-medium text-left transition-all",k.value===W?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},I(W),11,Zl))),128))])):$.value&&R.value.length===0?(i(),v("div",Kl," No available time slots for this date ")):(i(),v("div",Xl," Select a date to see available time slots "))])])])):M("",!0)]),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:re}),w(s(X),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!ee.value,onClick:be},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},eo={key:1,class:"space-y-4"},to={class:"flex items-center justify-between"},so={class:"space-y-4"},no={class:"block text-fluid-sm font-medium text-body"},ao=["onUpdate:modelValue","placeholder"],lo=["onUpdate:modelValue"],oo=["value"],io={key:2,class:"space-y-2"},ro=["onUpdate:modelValue","value"],uo={class:"flex gap-2 flex-wrap justify-end pt-2"},He={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=A(n.initialExpanded),l=A({});ke(()=>n.questions,k=>{const h={};k.forEach(f=>{h[f.key]=""}),l.value=h},{immediate:!0});const p=()=>{o("survey-completed",{...l.value}),$()},y=()=>{o("survey-refused"),$()},u=()=>{o("not-responding"),$()},$=()=>{d.value=!1;const k={};n.questions.forEach(h=>{k[h.key]=""}),l.value=k};return(k,h)=>(i(),v("div",null,[d.value?(i(),v("div",eo,[e("div",to,[h[4]||(h[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:h[1]||(h[1]=f=>d.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...h[3]||(h[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",so,[(i(!0),v(ce,null,he(t.questions,(f,b)=>(i(),v("div",{key:b,class:"space-y-2"},[e("label",no,I(f.label),1),f.type==="text"?Q((i(),v("textarea",{key:0,"onUpdate:modelValue":S=>l.value[f.key]=S,placeholder:f.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,ao)),[[ie,l.value[f.key]]]):f.type==="select"?Q((i(),v("select",{key:1,"onUpdate:modelValue":S=>l.value[f.key]=S,class:"input text-fluid-sm py-2 px-3 w-full"},[h[5]||(h[5]=e("option",{value:""},"Select an option...",-1)),(i(!0),v(ce,null,he(f.options,S=>(i(),v("option",{key:S,value:S},I(S),9,oo))),128))],8,lo)),[[ct,l.value[f.key]]]):f.type==="radio"?(i(),v("div",io,[(i(!0),v(ce,null,he(f.options,S=>(i(),v("label",{key:S,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[Q(e("input",{type:"radio","onUpdate:modelValue":T=>l.value[f.key]=T,value:S,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,ro),[[nt,l.value[f.key]]]),V(" "+I(S),1)]))),128))])):M("",!0)]))),128)),e("div",uo,[w(s(X),{label:"Complete Survey",variant:"primary",size:"small",onClick:p,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),w(s(X),{label:"Customer Refused",variant:"outline",size:"small",onClick:y}),w(s(X),{label:"Not Responding",variant:"outline",size:"small",onClick:u})])])])):(i(),v("button",{key:0,onClick:h[0]||(h[0]=f=>d.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...h[2]||(h[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},co={class:"space-y-3"},po={class:"space-y-2"},mo={key:0,class:"font-semibold text-heading text-fluid-sm mb-2"},fo={class:"grid grid-cols-4 gap-2"},vo={key:0},yo={__name:"CommunicationSelector",props:{title:{type:String,default:"Send follow-up message"},showEmail:{type:Boolean,default:!0},showSMS:{type:Boolean,default:!0},showWhatsApp:{type:Boolean,default:!0},showDontSend:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel","dont-send"],setup(t,{emit:C}){const n=C,o=A(null),d=y=>{y==="dont-send"?(o.value="dont-send",n("dont-send")):o.value=y},l=y=>{n("send",y),o.value=null},p=()=>{o.value=null,n("cancel")};return(y,u)=>(i(),v("div",co,[e("div",po,[t.title?(i(),v("h5",mo,I(t.title),1)):M("",!0),e("div",fo,[t.showEmail?(i(),v("button",{key:0,onClick:u[0]||(u[0]=$=>d("email")),class:F(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",o.value==="email"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])],2)):M("",!0),t.showSMS?(i(),v("button",{key:1,onClick:u[1]||(u[1]=$=>d("sms")),class:F(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",o.value==="sms"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[5]||(u[5]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])],2)):M("",!0),t.showWhatsApp?(i(),v("button",{key:2,onClick:u[2]||(u[2]=$=>d("whatsapp")),class:F(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",o.value==="whatsapp"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[6]||(u[6]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])],2)):M("",!0),t.showDontSend?(i(),v("button",{key:3,onClick:u[3]||(u[3]=$=>d("dont-send")),class:F(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",o.value==="dont-send"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[7]||(u[7]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])],2)):M("",!0)])]),o.value&&o.value!=="dont-send"?(i(),v("div",vo,[o.value==="email"?(i(),z(sn,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:l,onCancel:p},null,8,["initial-template","initial-message"])):o.value==="sms"?(i(),z(nn,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:l,onCancel:p},null,8,["initial-template","initial-message"])):o.value==="whatsapp"?(i(),z(an,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:l,onCancel:p},null,8,["initial-template","initial-message"])):M("",!0)])):M("",!0)]))}};function go(){const t=Ps(),C=A(!1),n=A(!1),o=A(0),d=A(""),l=A(null),p=A({}),y=A(null),u={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},$=E(()=>{const T=Math.floor(o.value/60),O=o.value%60;return`${T.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`}),k=()=>{C.value=!0,o.value=0,n.value=!1,d.value="",l.value=setInterval(()=>{o.value++,o.value>=20&&h()},1e3)},h=()=>{l.value&&(clearInterval(l.value),l.value=null),C.value=!1,n.value=!0,p.value={duration:o.value,notes:d.value,transcription:u,channel:"phone"}},f=async T=>{try{await navigator.clipboard.writeText(T),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},b=T=>(y.value={tradeIn:u.leadLines.some(O=>O.toLowerCase().includes("trade")||O.toLowerCase().includes("exchange"))||!1,financing:u.leadLines.some(O=>O.toLowerCase().includes("financ")||O.toLowerCase().includes("payment")||O.toLowerCase().includes("loan"))||!1},y.value.tradeIn&&T&&(T.value.tradeIn=!0),y.value.financing&&T&&(T.value.financing=!0),y.value),S=()=>{C.value=!1,n.value=!1,o.value=0,d.value="",p.value={},l.value&&(clearInterval(l.value),l.value=null)};return Hs(()=>{l.value&&clearInterval(l.value)}),{isCallActive:C,callEnded:n,callDuration:o,callNotes:d,callData:p,extractedData:y,mockTranscription:u,formattedCallDuration:$,startCall:k,endCall:h,copyNumber:f,extractInformation:b,resetCall:S}}function bo(t,C,n,o,d,l){var je,it,rt;const p=A(!0),y=A(null),u=A(!1),$=A(!1),k=A(!1),h=A(""),f=A(null),b=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],S=A("whatsapp"),T=A("followup-1"),O=A(null),m=A(""),x=A("09:00"),r=A(null),c=A("Not Interested"),g=A(""),R=A({dealership:((it=(je=t.value)==null?void 0:je.requestedCar)==null?void 0:it.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((rt=l==null?void 0:l.value)==null?void 0:rt.id)||null}),j=A(null),ee=A(null),Se=A({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),Ce=E(()=>{var B,G;if(!((B=t.value)!=null&&B.requestedCar))return null;const H=(G=t.value.requestedCar.condition)==null?void 0:G.toLowerCase();return H==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:H==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),be=A({tradeIn:!1,financing:!1,contactAvailability:!1}),re=A(!1),Y=A(null),L=A(!0),W=A(null),ae=A(null),Z=A("assign-only"),se=A(""),Ie=A(null),P=A(""),U=A(null),de=A(""),Ze=A(""),Ke=A(null),lt=A(""),Re=E(()=>{const H=[];for(let B=9*60;B<=18*60;B+=30){const G=String(Math.floor(B/60)).padStart(2,"0"),K=String(B%60).padStart(2,"0");H.push(`${G}:${K}`)}return H}),Qe=E(()=>{if(Ie.value!=null)return Ie.value;const H=parseInt(P.value,10);return Number.isFinite(H)&&H>0?H:null}),xt=E(()=>{if(!U.value)return[];const H=[],B=new Date;if(B.setHours(0,0,0,0),U.value==="tomorrow"){const G=new Date(B);G.setDate(G.getDate()+1),G.getDay()!==0&&G.getDay()!==6&&H.push(G)}else if(U.value==="this-week"){const G=B.getDay(),K=new Date(B);K.setDate(B.getDate()-(G===0?6:G-1));for(let J=0;J<5;J++){const oe=new Date(K);oe.setDate(K.getDate()+J),oe>=B&&H.push(oe)}}else if(U.value==="custom"&&de.value&&Ze.value){const G=new Date(de.value),K=new Date(Ze.value),J=new Date(G);for(;J<=K;)J.getDay()!==0&&J.getDay()!==6&&H.push(new Date(J)),J.setDate(J.getDate()+1)}return H}),Tt=E(()=>{var K,J,oe,De,Oe,Be,xe;const H=((oe=(J=(K=t.value)==null?void 0:K.customer)==null?void 0:J.name)==null?void 0:oe.split(" ")[0])||"",B=((Oe=(De=t.value)==null?void 0:De.requestedCar)==null?void 0:Oe.brand)||"",G=((xe=(Be=t.value)==null?void 0:Be.requestedCar)==null?void 0:xe.model)||"";return{"followup-1":`Hi ${H}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${B} ${G}?`,"followup-2":`Hello ${H}, this is regarding your inquiry about the ${B} ${G}. Please let me know when you're available for a call.`,custom:""}}),Ne=E(()=>T.value==="custom"?"Type your custom message...":Tt.value[T.value]||""),ot=E(()=>{var H;return!!((H=t.value)!=null&&H.scheduledAppointment)}),Xe=()=>{const H=new Date,B=H.getHours(),G=H.getDay();let K=new Date,J="10:00",oe="";if(G===5&&B>=15)K.setDate(H.getDate()+3),J="10:00",oe="Optimal time after weekend, customer likely refreshed";else if(G===6||G===0)K.setDate(H.getDate()+(G===6?2:1)),J="10:00",oe="Weekend follow-up avoided, better response rate on weekdays";else if(B>=17)K.setDate(H.getDate()+1),J="10:00",oe="Business hours preferred, higher engagement rate";else if(B<9)K=new Date(H),K.setHours(10,0,0,0),J="10:00",oe="Peak response time, customers more available mid-morning";else if(B<14){K=new Date(H);const Be=B+2;K.setHours(Be,0,0,0),J=`${String(Be).padStart(2,"0")}:00`,oe="Follow-up within same day increases conversion likelihood"}else K.setDate(H.getDate()+1),K.setHours(10,0,0,0),J="10:00",oe="Next morning follow-up maintains momentum";const De=K.toISOString().split("T")[0],Oe=`${De}T${J}:00`;return{date:De,time:J,dateTime:Oe,reason:oe,formattedDate:K.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:p,selectedOutcome:y,showNoteModal:u,showScheduleAppointmentModal:$,followupChannels:b,followupChannel:S,selectedTemplate:T,rescheduleTime:O,customDate:m,customTime:x,disqualifyCategory:c,disqualifyReason:g,assignment:R,preferences:be,surveyCompleted:re,surveyResponses:Y,showSurvey:L,aiSuggestionData:r,showCallLogForm:k,callLogDateTime:h,callLogAssignee:f,qualificationSelectedTeam:j,qualificationSelectedSalesman:ee,suggestedTeam:Ce,communicationPreferences:Se,messageTemplates:Tt,messagePreview:Ne,hasExistingAppointment:ot,selectOutcome:H=>{if(y.value=H,!h.value){const B=new Date,G=B.getFullYear(),K=String(B.getMonth()+1).padStart(2,"0"),J=String(B.getDate()).padStart(2,"0"),oe=String(B.getHours()).padStart(2,"0"),De=String(B.getMinutes()).padStart(2,"0");h.value=`${G}-${K}-${J}T${oe}:${De}`}!f.value&&(l!=null&&l.value)&&(f.value=l.value),H==="interested"&&(re.value=!1,Y.value=null,L.value=!0,n!=null&&n.value&&(be.value.tradeIn=n.value.tradeIn||!1,be.value.financing=n.value.financing||!1))},cancelOutcome:()=>{y.value=null,k.value=!1},calculateNextCallDate:()=>{if(O.value==="tomorrow-9am"){const B=new Date;return B.setDate(B.getDate()+1),B.setHours(9,0,0,0),B.toISOString()}else if(O.value==="monday"){if(r.value)return new Date(r.value.dateTime).toISOString();const B=new Date,G=(8-B.getDay())%7||7;return B.setDate(B.getDate()+G),B.setHours(9,0,0,0),B.toISOString()}else if(O.value==="custom"&&m.value&&x.value)return new Date(`${m.value}T${x.value}:00`).toISOString();const H=new Date;return H.setDate(H.getDate()+1),H.setHours(9,0,0,0),H.toISOString()},calculateAISuggestion:Xe,handleAISuggestionClick:()=>{O.value="monday",r.value=Xe()},resetOutcomeState:()=>{y.value=null,p.value=!0,S.value="whatsapp",T.value="followup-1",O.value=null,m.value="",x.value="09:00",c.value="Not Interested",g.value="",re.value=!1,Y.value=null,L.value=!0,r.value=null,k.value=!1,h.value="",f.value=null,W.value=null,ae.value=null,Z.value="assign-only",se.value="",U.value=null,de.value="",Ze.value="",Ke.value=null,lt.value="",j.value=null,ee.value=null,Ie.value=null,P.value=""},initCallLogForm:(H=!1)=>{if(W.value)return;const B=new Date,G=B.getFullYear(),K=String(B.getMonth()+1).padStart(2,"0"),J=String(B.getDate()).padStart(2,"0"),oe=String(B.getHours()).padStart(2,"0"),De=String(B.getMinutes()).padStart(2,"0");h.value=`${G}-${K}-${J}T${oe}:${De}`,l!=null&&l.value&&(f.value=l.value),k.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{k.value=!1,h.value="",f.value=null},clearSuccessState:()=>{W.value=null,ae.value=null},successState:W,successPerformedAt:ae,qualificationMethod:Z,qualificationEventType:se,qualificationDurationMinutes:Ie,qualificationCustomDuration:P,qualificationDateRange:U,qualificationCustomDateStart:de,qualificationCustomDateEnd:Ze,availableDatesForRange:xt,qualificationSelectedDate:Ke,qualificationSelectedSlot:lt,qualificationScheduleSlotOptions:Re,qualificationDurationValue:Qe}}function ho(t,C,n,o,d,l,p,y){const{callData:u}=C,{showOutcomeSelection:$,selectedOutcome:k,assignment:h,preferences:f,cancelOutcome:b,calculateNextCallDate:S,showScheduleAppointmentModal:T,surveyCompleted:O,surveyResponses:m,showSurvey:x,initCallLogForm:r,callLogDateTime:c,callLogAssignee:g,successState:R,successPerformedAt:j,rescheduleTime:ee,aiSuggestionData:Se,customDate:Ce,customTime:be,qualificationMethod:re,qualificationEventType:Y,qualificationDurationValue:L,qualificationSelectedDate:W,qualificationSelectedSlot:ae,qualificationSelectedTeam:Z,qualificationSelectedSalesman:se,communicationPreferences:Ie}=n,P=()=>{var ne;return((ne=y==null?void 0:y.value)==null?void 0:ne.name)||"Unknown"},U=()=>ee.value==="tomorrow-9am"?"Tomorrow 9:00 AM":ee.value==="monday"&&Se.value?`${Se.value.formattedDate} at ${Se.value.time}`:ee.value==="monday"?"Monday":ee.value==="custom"&&Ce.value&&be.value?`${Ce.value} ${be.value}`:"selected time";return{logManualCall:()=>{u.value={channel:"external",notes:"",transcription:null},r(!0)},handleScheduleAppointmentConfirm:async ne=>{T.value=!1,t("appointment-scheduled",ne)},handleQualify:async()=>{var Le,fe,je,it,rt,H,B,G,K,J,oe,De,Oe,Be,xe,It,Nt,Lt,wt,we,kt,ve,ze,_e,et;const ne={timestamp:new Date().toISOString(),outcome:"interested",channel:((Le=u.value)==null?void 0:Le.channel)||"phone",notes:((fe=u.value)==null?void 0:fe.notes)||"",transcription:((je=u.value)==null?void 0:je.transcription)||null};t("call-attempt-logged",ne),t("validated",{scheduleFollowUp:!1});let te="Unassigned";re.value==="assign-and-schedule"?se.value?te=se.value.name:Z.value&&(te=Z.value.name):te=((rt=(it=h.value)==null?void 0:it.assignee)==null?void 0:rt.name)||"Unassigned";let me=null,pe=!1,Ve=null;if(re.value==="assign-and-schedule"&&W.value&&ae.value){const tt=W.value,ye=tt.toLocaleDateString(void 0,{month:"long",day:"numeric"}),qe={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[Y.value]||Y.value;pe=!0;const Fe=tt.getFullYear(),St=String(tt.getMonth()+1).padStart(2,"0"),Ct=String(tt.getDate()).padStart(2,"0"),We=`${Fe}-${St}-${Ct}`;if(Ve={datetime:tt,date:We,time:ae.value,type:qe,assignee:te,assigneeId:((H=se.value)==null?void 0:H.id)||((B=Z.value)==null?void 0:B.id)||null,assigneeType:se.value?"user":"team",duration:L.value,team:((G=Z.value)==null?void 0:G.name)||null,teamId:((K=Z.value)==null?void 0:K.id)||null,salesperson:((J=se.value)==null?void 0:J.name)||null,salespersonId:((oe=se.value)==null?void 0:oe.id)||null},me={date:ye,time:ae.value,title:qe,name:((Oe=(De=o.value)==null?void 0:De.customer)==null?void 0:Oe.name)||"",location:te},t("appointment-scheduled",Ve),Ie.value){const Ee=Ie.value;if((Be=Ee.immediateConfirmation)!=null&&Be.enabled&&((It=(xe=Ee.immediateConfirmation)==null?void 0:xe.channels)==null?void 0:It.length)>0){for(const Me of Ee.immediateConfirmation.channels)if(p&&((Nt=o.value)!=null&&Nt.id))try{await p.addActivity(o.value.id,{type:Me,user:P(),action:`sent ${Me} confirmation`,content:`Appointment confirmed: ${qe} on ${ye} at ${ae.value}`,timestamp:new Date().toISOString()})}catch(le){console.error(`Failed to log ${Me} confirmation:`,le)}}if((Lt=Ee.reminder)!=null&&Lt.enabled&&((we=(wt=Ee.reminder)==null?void 0:wt.channels)==null?void 0:we.length)>0){const Me=new Date(tt);Me.setDate(Me.getDate()-1);const le=Me.toISOString().split("T")[0];if(p&&((kt=o.value)!=null&&kt.id))try{await p.addActivity(o.value.id,{type:"reminder-scheduled",user:P(),action:"scheduled reminder",content:`Reminder scheduled for ${le} via ${Ee.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:le,channels:Ee.reminder.channels}})}catch(Te){console.error("Failed to schedule reminder:",Te)}}if((ve=Ee.salespersonNotification)!=null&&ve.enabled){const Me=((ze=se.value)==null?void 0:ze.name)||((_e=Z.value)==null?void 0:_e.name)||"Team";if(p&&((et=o.value)!=null&&et.id))try{await p.addActivity(o.value.id,{type:"notification",user:P(),action:"sent notification",content:`Notification sent to ${Me} about appointment`,timestamp:new Date().toISOString()})}catch(le){console.error("Failed to send notification:",le)}}}}re.value==="assign-and-schedule"&&(se.value?h.value={...h.value,assignee:{...se.value,type:"user"},assigneeId:se.value.id,salesperson:se.value}:Z.value&&(h.value={...h.value,assignee:{...Z.value,type:"team"},team:Z.value}));const Ue=re.value==="assign-and-schedule"?{assignee:se.value||Z.value,salesperson:se.value||null,team:Z.value||null}:h.value;t("qualified",{assignment:Ue,preferences:f.value,scheduleAppointment:pe,appointmentData:Ve,surveyData:O.value?m.value:null});let $e=`Qualified - Assigned to ${te}`;me&&($e=`Qualified - Assigned to ${te}, meeting on ${me.date} ${me.time}`),R.value={kind:"qualified",statusText:$e,meeting:me,actorName:P()},j.value=new Date,b()},handleDisqualifyFromInterested:()=>{var te,me,pe;const ne={timestamp:new Date().toISOString(),outcome:"interested",channel:((te=u.value)==null?void 0:te.channel)||"phone",notes:((me=u.value)==null?void 0:me.notes)||"",transcription:((pe=u.value)==null?void 0:pe.transcription)||null};t("call-attempt-logged",ne),k.value="not-valid"},handleNoAnswerConfirm:async()=>{var Ue,$e,Le,fe;const ne={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Ue=u.value)==null?void 0:Ue.channel)||"phone",notes:(($e=u.value)==null?void 0:$e.notes)||"",transcription:((Le=u.value)==null?void 0:Le.transcription)||null};t("call-attempt-logged",ne);const te=S(),me=te.split("T")[0],pe=new Date(te).toTimeString().slice(0,5);if(p&&((fe=o.value)!=null&&fe.id))try{await p.updateLead(o.value.id,{nextActionDue:te,status:"Pending"})}catch(je){console.error('Failed to update lead status to "to be called back":',je)}t("postponed",{date:me,time:pe,createAppointment:!0}),(d==null?void 0:d.value)+1>=(l==null?void 0:l.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"});const Ve=U();R.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${Ve}`,actorName:P()},j.value=new Date,b()},handleNotValidConfirm:()=>{var te,me,pe;const ne={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((te=u.value)==null?void 0:te.channel)||"phone",notes:((me=u.value)==null?void 0:me.notes)||"",transcription:((pe=u.value)==null?void 0:pe.transcription)||null};t("call-attempt-logged",ne),t("disqualified",{category:n.disqualifyCategory.value,reason:n.disqualifyReason.value}),R.value={kind:"not-interested",statusText:"Closed - Not interested",actorName:P()},j.value=new Date,b()},handleNoteSave:ne=>{n.showNoteModal.value=!1,t("note-saved",ne)},handleSurveyCompleted:async ne=>{var te;if(m.value=ne,O.value=!0,x.value=!1,p&&((te=o.value)!=null&&te.id))try{await p.addActivity(o.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ne),timestamp:new Date().toISOString()})}catch(me){console.error("Failed to save survey activity:",me)}t("survey-completed",{lead:o.value,responses:ne})},handleSurveyRefused:async()=>{var ne;if(x.value=!1,p&&((ne=o.value)!=null&&ne.id))try{await p.addActivity(o.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(te){console.error("Failed to save survey refusal activity:",te)}t("survey-refused",{lead:o.value})},handleNotResponding:async()=>{var ne;if(x.value=!1,p&&((ne=o.value)!=null&&ne.id))try{await p.addActivity(o.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(te){console.error("Failed to save survey not responding activity:",te)}t("not-responding",{lead:o.value})},handleReopen:()=>{n.clearSuccessState(),n.resetOutcomeState()}}}const xo=["disabled"],ps={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:t=>["small","medium"].includes(t)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(t){return(C,n)=>(i(),v("button",{class:F(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",t.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",t.size==="small"?"px-3 py-1.5 text-fluid-xs":"px-4 py-2 text-fluid-sm"]),disabled:t.disabled,style:{background:"linear-gradient(to right, #9333EA, #A855F7, #C084FC)"},onClick:n[0]||(n[0]=o=>C.$emit("click",o))},[w(s(ls),{size:t.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,I(t.label),1)],10,xo))}},wo={class:"flex gap-2 items-center mb-4"},ko={key:0,class:"mb-4 space-y-4 border-t border pt-4"},So={key:0,class:"bg-slate-900 text-white rounded-card p-4"},Co={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},$o={class:"flex items-center gap-2 text-red-400"},Do={class:"text-xs font-mono"},Ao={class:"space-y-3 text-sm font-mono"},To={class:"ml-2"},Io={class:"ml-2"},Oo={key:0},qo={class:"ml-2"},Eo={key:1},Mo={class:"ml-2"},No={key:2},Lo={class:"ml-2"},Bo={class:"mt-4 pt-4 border-t border-slate-700"},Fo=["model-value"],Ro={class:"mt-4 flex justify-end"},Vo={key:1,class:"bg-blue-50 border border-blue-200 rounded-card p-4"},jo={class:"flex items-center justify-between"},zo={class:"flex gap-2"},Uo={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(C,n)=>(i(),v("div",null,[e("div",wo,[e("button",{onClick:n[0]||(n[0]=o=>C.$emit("start-call")),class:F(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",t.isCallActive?"bg-brand-red text-white border-brand-red":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[n[4]||(n[4]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),V(" "+I(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],2)]),t.isCallActive||t.callEnded?(i(),v("div",ko,[t.isCallActive?(i(),v("div",So,[e("div",Co,[n[6]||(n[6]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",$o,[n[5]||(n[5]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Do,"REC "+I(t.formattedCallDuration),1)])]),e("div",Ao,[e("div",null,[n[7]||(n[7]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",To,I(t.mockTranscription.leadLines[0]),1)]),e("div",null,[n[8]||(n[8]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Io,I(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(i(),v("div",Oo,[n[9]||(n[9]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",qo,I(t.mockTranscription.leadLines[1]),1)])):M("",!0),t.callDuration>=8?(i(),v("div",Eo,[n[10]||(n[10]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Mo,I(t.mockTranscription.salesLines[1]),1)])):M("",!0),t.callDuration>=12?(i(),v("div",No,[n[11]||(n[11]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Lo,I(t.mockTranscription.leadLines[2]),1)])):M("",!0)]),e("div",Bo,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":n[1]||(n[1]=o=>C.$emit("update:call-notes",o)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Fo)]),e("div",Ro,[w(s(X),{label:"End Call",variant:"primary",size:"small",onClick:n[2]||(n[2]=o=>C.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):M("",!0),t.callEnded&&!t.isCallActive?(i(),v("div",Vo,[e("div",jo,[n[12]||(n[12]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",zo,[w(ps,{label:"Extract information",size:"small",onClick:n[3]||(n[3]=o=>C.$emit("extract-information"))})])])])):M("",!0)])):M("",!0)]))}},Wo={class:"flex items-center gap-2.5 min-w-0"},Po={class:"flex items-center gap-2 min-w-0"},ms={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:C}){const n=t,o=C,d=A(!1),l=E(()=>ln(n.nextActionDue)),p=E(()=>l.value.type==="overdue"?Xt:l.value.type==="urgent"?Nn:Xt),y=E(()=>n.isClosed||!n.showDeadlineBanner||d.value?!1:l.value.type==="overdue"||l.value.type==="urgent"),u=()=>{d.value=!0,o("dismissed")};return($,k)=>y.value?(i(),v("div",{key:0,class:F(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[l.value.bgClass,l.value.borderClass]])},[e("div",Wo,[e("div",{class:F(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",l.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(i(),z(Wt(p.value),{size:12,class:F(l.value.textClass)},null,8,["class"]))],2),e("div",Po,[e("span",{class:F(["text-[10px] font-bold uppercase tracking-wider",l.value.textClass])},I(l.value.type==="overdue"?"Overdue":"Urgent"),3),k[0]||(k[0]=e("span",{class:"text-fluid-xs text-sub opacity-30"},"•",-1)),e("span",{class:F(["text-fluid-xs font-medium truncate",l.value.textClass])}," Next Action: "+I(s(on)(t.nextActionDue)),3)])]),e("button",{onClick:u,class:F(["p-1 rounded-md transition-colors shrink-0",[l.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[w(s(ts),{size:14})],2)],2)):M("",!0)}},Ho={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Qo={class:"space-y-1"},Yo={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},Go={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},Jo={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},Zo={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},Ko={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},Xo={class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},_o={class:"text-fluid-sm font-medium text-heading"},ei={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(t,{emit:C}){const n=C,o=A({immediateConfirmationEmail:!0,immediateConfirmationSMS:!1,immediateConfirmationWhatsApp:!1,reminderEmail:!0,reminderSMS:!1,salespersonNotification:!0});return ke(o,d=>{const l={immediateConfirmation:{enabled:d.immediateConfirmationEmail||d.immediateConfirmationSMS||d.immediateConfirmationWhatsApp,channels:[]},reminder:{enabled:d.reminderEmail||d.reminderSMS,channels:[]},salespersonNotification:{enabled:d.salespersonNotification}};d.immediateConfirmationEmail&&l.immediateConfirmation.channels.push("email"),d.immediateConfirmationSMS&&l.immediateConfirmation.channels.push("sms"),d.immediateConfirmationWhatsApp&&l.immediateConfirmation.channels.push("whatsapp"),d.reminderEmail&&l.reminder.channels.push("email"),d.reminderSMS&&l.reminder.channels.push("sms"),n("update",l)},{deep:!0}),(d,l)=>(i(),v("div",Ho,[l[11]||(l[11]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Automated Appointment Communications",-1)),e("div",Qo,[e("label",Yo,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[0]||(l[0]=p=>o.value.immediateConfirmationEmail=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.immediateConfirmationEmail]]),l[6]||(l[6]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation email to customer",-1))]),e("label",Go,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=p=>o.value.immediateConfirmationSMS=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.immediateConfirmationSMS]]),l[7]||(l[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation SMS to customer",-1))]),e("label",Jo,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=p=>o.value.immediateConfirmationWhatsApp=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.immediateConfirmationWhatsApp]]),l[8]||(l[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation WhatsApp to customer",-1))]),e("label",Zo,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=p=>o.value.reminderEmail=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.reminderEmail]]),l[9]||(l[9]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder email the day before appointment",-1))]),e("label",Ko,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=p=>o.value.reminderSMS=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.reminderSMS]]),l[10]||(l[10]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder SMS the day before appointment",-1))]),e("label",Xo,[Q(e("input",{type:"checkbox","onUpdate:modelValue":l[5]||(l[5]=p=>o.value.salespersonNotification=p),class:"w-4 h-4 appearance-none text-green-600 focus:ring-green-600 border-gray-300 rounded checkbox-green cursor-pointer"},null,512),[[dt,o.value.salespersonNotification]]),e("span",_o," Notify "+I(t.salesperson?t.salesperson.name:t.team?t.team.name:"salesperson")+" about appointment ",1)])])]))}},ti=at(ei,[["__scopeId","data-v-59713384"]]),si={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ni={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},ai={class:"flex items-center gap-3"},li={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},oi={class:"text-fluid-sm font-medium text-heading flex-1 pr-10"},ii={key:0,class:"mt-4 bg-white rounded-lg border border-E5E7EB overflow-hidden shadow-sm"},ri={class:"grid grid-cols-2 gap-3 p-4 text-fluid-sm"},di={class:"ml-2 font-medium text-heading"},ui={class:"ml-2 font-medium text-heading"},ci={class:"ml-2 font-medium text-heading capitalize"},pi={class:"ml-2 font-medium text-heading"},mi={class:"flex justify-end mt-4"},fi={class:"px-4 py-2 flex items-center justify-between text-fluid-sm text-sub"},vi={class:"tabular-nums"},yi={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},gi={class:"p-4"},bi={class:"flex justify-between items-start mb-3"},hi={class:"font-bold text-heading text-fluid-sm"},xi={class:"text-fluid-xs text-body mt-0.5"},wi={key:0,class:"mb-3 bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},ki={class:"flex items-center justify-between gap-4 flex-wrap"},Si={key:0,class:"flex items-center gap-2"},Ci={class:"flex items-center gap-2"},$i={class:"text-fluid-xs text-body"},Di={key:1,class:"flex items-center gap-2"},Ai={class:"text-fluid-xs font-semibold text-heading"},Ti={key:0,class:"text-fluid-xs text-orange-600 font-medium flex items-center gap-1 ml-2"},Ii={class:"flex items-center gap-2 mb-3"},Oi={class:"text-fluid-sm text-body font-medium"},qi={class:"px-4 py-4 space-y-3"},Ei={key:0,class:"space-y-4"},Mi={class:"flex flex-wrap gap-3"},Ni={key:0,class:"space-y-4"},Li={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Bi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Fi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ri={class:"grid grid-cols-3 gap-2"},Vi={key:0,class:"mt-3 grid grid-cols-2 gap-3"},ji={key:1,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},zi={class:"text-fluid-xs text-body"},Ui={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Wi={key:1,class:"space-y-4"},Pi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Hi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Qi={class:"flex gap-4"},Yi={class:"flex items-center gap-2 cursor-pointer"},Gi={class:"flex items-center gap-2 cursor-pointer"},Ji={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Zi={key:2,class:"space-y-4"},Ki={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Xi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},_i={class:"flex gap-2 mt-3"},er={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},tr={class:"flex gap-2 flex-wrap"},sr={key:0,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},nr={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-3"},ar={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},lr={class:"space-y-2"},or={key:2,class:"space-y-4"},ir={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},rr=["value"],dr={key:0,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},ur={class:"mb-4"},cr={class:"flex gap-2 items-center flex-wrap"},pr={class:"mb-4"},mr={class:"flex gap-2 flex-wrap"},fr={key:0,class:"mt-3 grid grid-cols-2 gap-3"},vr={key:1,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},yr={class:"mb-3"},gr={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},br=["onClick"],hr={class:"text-sub"},xr={class:"font-medium text-heading"},wr={key:0},kr={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},Sr=["onClick"],Cr={class:"font-medium text-heading truncate"},$r={key:2,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Dr={key:0,class:"mb-4"},Ar={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},Tr=["onClick"],Ir={key:1},Or={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"},qr=["onClick"],Er={key:0,class:"text-fluid-xs text-sub text-center py-4"},Mr={key:3,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Nr={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},Lr={class:"ml-2 font-medium text-heading"},Br={class:"ml-2 font-medium text-heading"},Fr={class:"ml-2 font-medium text-heading capitalize"},Rr={class:"ml-2 font-medium text-heading"},Vr={class:"flex justify-between items-center pt-3 border-t border-E5E7EB"},jr={class:"flex gap-2"},zr={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=Qt(),l=At();Pt();const p=ht(),y=rs(()=>n.lead,{}),u=go(),{isCallActive:$,callEnded:k,callDuration:h,callNotes:f,callData:b,extractedData:S,mockTranscription:T,formattedCallDuration:O,startCall:m,endCall:x,copyNumber:r,extractInformation:c}=u,g=A(null),R=A(!1),j=A(!1),ee=A(!1),Se=E(()=>d.assignableUsers),Ce=E(()=>d.assignableTeams),be=E(()=>l.currentUser),re=A(""),Y=D=>D?D.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"?",L=D=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[D]||"bg-surfaceSecondary text-body",W=D=>{fe.value.assignee=D,D.type==="team"&&(Te.value=null),R.value=!1};E(()=>!!It.value),E(()=>{if(we.value)return we.value.statusText;const D=n.activities.filter(a=>a.type==="call"||a.type==="outcome").sort((a,_)=>new Date(_.timestamp)-new Date(a.timestamp))[0];return D?D.outcome||D.content||"Outcome logged":null});const ae=async()=>{var D;if(re.value.trim())try{await p.addActivity(n.lead.id,{type:"note",user:((D=be.value)==null?void 0:D.name)||"You",action:"added a note",content:re.value,timestamp:new Date().toISOString()}),o("note-saved",{type:"note",content:re.value,timestamp:new Date().toISOString()}),re.value=""}catch(a){console.error("Error saving note:",a)}},Z=async()=>{re.value.trim()&&console.log("Extracting information with AI from:",re.value)},se=()=>{m(),wt(!1)},Ie=()=>{r(n.lead.customer.phone)},P=D=>{f.value=D},U=E(()=>{var D;return((D=y.primaryAction.value)==null?void 0:D.title)||"Call to Verify Contact Details"}),de=E(()=>{var D;return((D=y.primaryAction.value)==null?void 0:D.description)||"Begin lead qualification by verifying customer contact information."}),Ze=E(()=>n.lead.scheduledAppointment?new Date(n.lead.scheduledAppointment.start)<new Date:!1),Ke=E(()=>!!n.lead.scheduledAppointment),lt=E(()=>Ke.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Ze.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:n.lead.nextActionDue?`Task Pending - Due ${rn(n.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),Re=y.contactAttempts,Qe=y.maxContactAttempts,xt=bo(ut(n,"lead"),b,S,Re,Qe,be),{showOutcomeSelection:Tt,selectedOutcome:Ne,showNoteModal:ot,showScheduleAppointmentModal:Xe,followupChannels:ne,followupChannel:te,selectedTemplate:me,rescheduleTime:pe,customDate:Ve,customTime:Ue,disqualifyCategory:$e,disqualifyReason:Le,assignment:fe,preferences:je,messageTemplates:it,messagePreview:rt,hasExistingAppointment:H,selectOutcome:B,cancelOutcome:G,calculateNextCallDate:K,surveyCompleted:J,surveyResponses:oe,showSurvey:De,aiSuggestionData:Oe,handleAISuggestionClick:Be,callLogDateTime:xe,callLogAssignee:It,confirmCallLogForm:Nt,cancelCallLogForm:Lt,initCallLogForm:wt,successState:we,successPerformedAt:kt,qualificationMethod:ve,qualificationEventType:ze,qualificationDurationMinutes:_e,qualificationCustomDuration:et,qualificationCalendarMonth:tt,qualificationSelectedDate:ye,qualificationSelectedSlot:qe,qualificationDateRange:Fe,qualificationCustomDateStart:St,qualificationCustomDateEnd:Ct,availableDatesForRange:We,qualificationScheduleSlotOptions:Ee,qualificationDurationValue:Me,qualificationSelectedTeam:le,qualificationSelectedSalesman:Te,suggestedTeam:fs,communicationPreferences:vs}=xt,ys=D=>{vs.value=D},gs=(D,a)=>!D||!a?!1:D.getFullYear()===a.getFullYear()&&D.getMonth()===a.getMonth()&&D.getDate()===a.getDate(),Bt=D=>{Fe.value=D,ye.value=null,qe.value="",(D==="tomorrow"&&We.value.length>0||D==="this-week"&&We.value.length>0)&&(ye.value=We.value[0])},Yt=E(()=>{if(!ye.value)return[];const D=ye.value.toISOString().split("T")[0];if(Te.value){const a=zt(`user-${Te.value.id}`,D);return Ee.value.filter(_=>a.includes(_))}if(le.value){const a=zt(`team-${le.value.id}`,D);return Ee.value.filter(_=>a.includes(_))}return Ee.value});E(()=>n.activities.filter(D=>D.type==="note"));const Gt=E(()=>(Ce.value||[]).slice(0,3)),bs=E(()=>{if(!Ce.value)return[];const D=[...Ce.value];if(le.value){const a=D.findIndex(_=>_.id===le.value.id);if(a>0){const _=D.splice(a,1)[0];D.unshift(_)}}return D});ke([Fe,fs,Ce],([D,a,_])=>{if(D&&a&&_&&!le.value){const q=_.find(ue=>ue.id===a.id);q&&(le.value=q)}},{immediate:!0}),ke([Fe,We],([D,a])=>{D&&a&&a.length>0&&!ye.value&&(ye.value=a[0])}),ke(Ne,D=>{var a,_,q;if(D==="interested"&&ve.value==="assign-only"&&!((a=fe.value)!=null&&a.assignee))if(n.lead.assignee){const ue=(_=Se.value)==null?void 0:_.find(Ft=>Ft.name===n.lead.assignee),st=(q=Ce.value)==null?void 0:q.find(Ft=>Ft.name===n.lead.assignee);ue?fe.value={...fe.value,assignee:{...ue,type:"user"}}:st&&(fe.value={...fe.value,assignee:{...st,type:"team"}})}else Gt.value.length>0&&(fe.value={...fe.value,assignee:{...Gt.value[0],type:"team"}})}),ke(()=>{var D;return(D=fe.value)==null?void 0:D.assignee},D=>{(D==null?void 0:D.type)!=="team"&&(Te.value=null)}),ke(le,()=>{Te.value=null}),ke(ye,()=>{qe.value=""}),ke(Te,()=>{qe.value=""}),ke(k,D=>{D&&!we.value&&wt(!1)});const hs=[{value:"test-drive",label:"Test Drive"},{value:"in-store-visit",label:"In-Store Visit"}],Jt=D=>{_e.value=D,et.value=""},xs=E(()=>{var D;return ve.value==="assign-only"?!!((D=fe.value)!=null&&D.assignee):!!(ze.value&&Me.value&&Fe.value&&ye.value&&qe.value&&le.value)}),ws=ho(o,u,xt,ut(n,"lead"),Re,Qe,p,be),{logManualCall:ks,handleScheduleAppointmentConfirm:Ss,handleQualify:Cs,handleDisqualifyFromInterested:$s,handleNoAnswerConfirm:Ds,handleNotValidConfirm:As,handleNoteSave:Ts,handleSurveyCompleted:Is,handleSurveyRefused:Os,handleNotResponding:qs,handleReopen:Es}=ws,Ms=E(()=>{if(!kt.value)return"";const D=kt.value,a=String(D.getDate()).padStart(2,"0"),_=String(D.getMonth()+1).padStart(2,"0"),q=String(D.getFullYear()),ue=String(D.getHours()).padStart(2,"0"),st=String(D.getMinutes()).padStart(2,"0");return`${a}/${_}/${q} ${ue}:${st}`}),Ns=[{key:"interestLevel",label:"Customer interest level?",type:"radio",options:["High","Medium","Low"]},{key:"purchaseTimeline",label:"Expected purchase timeline?",type:"select",options:["Immediate","Within 1 month","Within 3 months","Within 6 months","Just browsing"]},{key:"budgetRange",label:"Budget range (if discussed)?",type:"select",options:["Under €30k","€30k-€50k","€50k-€80k","€80k+","Not discussed"]},{key:"preferredContact",label:"Preferred contact method?",type:"radio",options:["Phone","Email","WhatsApp","SMS"]},{key:"additionalNotes",label:"Additional notes",type:"text",placeholder:"Any relevant information about customer interest or preferences..."}],{saveTradeInVehicle:Ls}=dn(),Bs=async D=>{var a,_,q;try{j.value=!1,je.value.financing=!0;const ue=D.type==="FIN"?"Captive Financing":D.type==="LEA"?"Leasing":"Long-Term Rental",st=((a=D.fields)==null?void 0:a.monthlyInstalment)||0;await p.addActivity(n.lead.id,{type:"purchase-method",user:((_=be.value)==null?void 0:_.name)||"You",action:`added a ${ue} purchase method`,content:`${ue}: €${st.toLocaleString()}/month for ${((q=D.fields)==null?void 0:q.duration)||0} months`,data:{purchaseMethodId:D.id,type:D.type,...D.fields},timestamp:new Date().toISOString()}),o("note-saved",{type:"purchase-method",...D})}catch(ue){console.error("Error saving purchase method:",ue)}},Fs=async D=>{try{if(ee.value=!1,D.vehicleType==="tradein"||n.mode==="tradein"){const a=await Ls("lead",n.lead.id,D.vehicle,D.valuation||{});je.value.tradeIn=!0,o("note-saved",{type:"tradein",id:a.activity.id,action:"added a trade-in",vehicleId:a.vehicle.id,data:a.activity.data,timestamp:a.activity.timestamp})}else{const{addVehicleToCustomer:a}=await Qs(async()=>{const{addVehicleToCustomer:_}=await import("./contacts-Dm10rkvw.js");return{addVehicleToCustomer:_}},__vite__mapDeps([0,1,2]));await a(n.lead.customerId,D.vehicle),o("note-saved",{type:"vehicle",vehicleType:D.vehicleType,...D.vehicle})}}catch(a){console.error("Error saving vehicle:",a)}},Rs=async D=>{var a;try{te.value=D.type,me.value=D.template||"";const _={email:"sent an email",sms:"sent an SMS",whatsapp:"sent a WhatsApp message"},q=((a=be.value)==null?void 0:a.name)||"You";let ue=D.message||"";D.type==="email"&&D.subject&&(ue=`${D.subject}: ${ue}`),await p.addActivity(n.lead.id,{type:D.type,user:q,action:_[D.type]||"sent a message",content:ue,timestamp:new Date().toISOString()})}catch(_){console.error("Failed to save follow-up communication:",_)}};return(D,a)=>{var _;return i(),v("div",si,[s(we)?(i(),v(ce,{key:0},[e("div",ni,[e("div",ai,[e("div",li,[w(s(_t),{size:16,class:"text-green-600"})]),e("p",oi,I(s(we).statusText),1)]),s(we).meeting?(i(),v("div",ii,[e("div",ri,[e("div",null,[a[38]||(a[38]=e("span",{class:"text-body"},"Date:",-1)),e("span",di,I(s(we).meeting.date),1)]),e("div",null,[a[39]||(a[39]=e("span",{class:"text-body"},"Time:",-1)),e("span",ui,I(s(we).meeting.time),1)]),e("div",null,[a[40]||(a[40]=e("span",{class:"text-body"},"Type:",-1)),e("span",ci,I(s(we).meeting.title),1)]),e("div",null,[a[41]||(a[41]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",pi,I(s(we).meeting.location),1)])])])):M("",!0),e("div",mi,[w(s(X),{variant:"outline",size:"small",class:"flex items-center gap-2",onClick:s(Es)},{default:N(()=>[w(s(En),{size:14}),a[42]||(a[42]=V(" Re-open ",-1))]),_:1},8,["onClick"])])]),e("div",fi,[e("span",null,"Updated by "+I(s(we).actorName||"Unknown"),1),e("span",vi,I(Ms.value),1)])],64)):(i(),v(ce,{key:1},[e("div",yi,[w(ms,{"next-action-due":t.lead.nextActionDue,"show-deadline-banner":t.showDeadlineBanner,"task-id":t.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",gi,[e("div",bi,[e("div",null,[e("h4",hi,I(U.value),1),e("p",xi,I(de.value),1)]),e("div",{class:F(["flex items-center gap-2 px-2 py-1 rounded-btn text-fluid-xs font-semibold",lt.value.class])},I(lt.value.text),3)]),Ke.value||s(Re)>0?(i(),v("div",wi,[e("div",ki,[Ke.value?(i(),v("div",Si,[a[44]||(a[44]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-fluid-xs"},null,-1)),e("div",Ci,[a[43]||(a[43]=e("span",{class:"text-fluid-xs font-semibold text-heading"},"Scheduled Follow-up Call:",-1)),e("span",$i,I(s(Ye)(t.lead.scheduledAppointment.start))+" at "+I(s(Dt)(t.lead.scheduledAppointment.start)),1)])])):M("",!0),s(Re)>0?(i(),v("div",Di,[a[46]||(a[46]=e("i",{class:"fa-solid fa-phone text-body text-fluid-xs"},null,-1)),a[47]||(a[47]=e("span",{class:"text-fluid-xs font-semibold text-body"},"Contact Attempts:",-1)),e("span",Ai,I(s(Re))+" / "+I(s(Qe)),1),s(Re)>=s(Qe)-1?(i(),v("div",Ti,[...a[45]||(a[45]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):M("",!0)])):M("",!0)])])):M("",!0),e("div",Ii,[e("span",Oi,I(t.lead.customer.phone),1),e("button",{onClick:Ie,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...a[48]||(a[48]=[e("i",{class:"fa-regular fa-copy text-fluid-xs"},null,-1)])])]),w(Uo,{"is-call-active":s($),"call-ended":s(k),"call-duration":s(h),"call-notes":s(f),"formatted-call-duration":s(O),"mock-transcription":s(T),"contact-attempts":s(Re),"max-contact-attempts":s(Qe),onStartCall:se,onEndCall:s(x),onLogManualCall:s(ks),onExtractInformation:s(c),"onUpdate:callNotes":P,onCopyNumber:Ie},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"])])]),e("div",qi,[s(we)?M("",!0):(i(),v("div",Ei,[e("div",null,[a[52]||(a[52]=e("p",{class:"text-fluid-sm font-medium text-heading leading-6 mb-3"},"Log what is happening?",-1)),e("div",Mi,[e("button",{type:"button",class:F(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",s(Ne)==="no-answer"?"border-green-600 text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:a[0]||(a[0]=q=>s(B)("no-answer"))},[w(s(On),{size:18,class:"shrink-0"}),a[49]||(a[49]=e("span",null,"No answer",-1))],2),e("button",{type:"button",class:F(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",s(Ne)==="not-valid"?"border-green-600 text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:a[1]||(a[1]=q=>s(B)("not-valid"))},[w(s(Mn),{size:18,class:"shrink-0"}),a[50]||(a[50]=e("span",null,"Not valid",-1))],2),e("button",{type:"button",class:F(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",s(Ne)==="interested"?"border-green-600 text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:a[2]||(a[2]=q=>s(B)("interested"))},[w(s(_t),{size:18,class:"shrink-0"}),a[51]||(a[51]=e("span",null,"Interested",-1))],2)])]),s(Ne)==="no-answer"?(i(),v("div",Ni,[e("div",Li,[a[53]||(a[53]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"When did you call?",-1)),Q(e("input",{type:"datetime-local","onUpdate:modelValue":a[3]||(a[3]=q=>Ae(xe)?xe.value=q:null),class:"input w-full"},null,512),[[ie,s(xe)]])]),e("div",Bi,[w(yo,{title:"Send follow-up message","show-email":!0,"show-sms":!0,"show-whatsapp":!0,"show-dont-send":!0,onSend:Rs,onDontSend:a[4]||(a[4]=()=>{s(te).value="dont-send"}),onCancel:a[5]||(a[5]=()=>{s(Ne).value=null})})]),e("div",Fi,[a[57]||(a[57]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-2"},"Next call attempt",-1)),e("div",Ri,[e("button",{onClick:a[6]||(a[6]=q=>pe.value="tomorrow-9am"),class:F(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",s(pe)==="tomorrow-9am"?"border-green-600 bg-surfaceSecondary":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:a[7]||(a[7]=(...q)=>s(Be)&&s(Be)(...q)),class:F(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",s(pe)==="monday"?"border-green-600 bg-surfaceSecondary":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])}," AI suggestion ",2),e("button",{onClick:a[8]||(a[8]=q=>pe.value="custom"),class:F(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",s(pe)==="custom"?"border-green-600 bg-surfaceSecondary":"border-E5E7EB hover:border-green-600/30 hover:bg-surfaceSecondary/50"])}," Select time ",2)]),s(pe)==="custom"?(i(),v("div",Vi,[e("div",null,[a[54]||(a[54]=e("label",{class:"block text-fluid-xs font-semibold mb-1.5"},"Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=q=>Ae(Ve)?Ve.value=q:null),class:"input"},null,512),[[ie,s(Ve)]])]),e("div",null,[a[55]||(a[55]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Time",-1)),Q(e("input",{type:"time","onUpdate:modelValue":a[10]||(a[10]=q=>Ae(Ue)?Ue.value=q:null),class:"input"},null,512),[[ie,s(Ue)]])])])):M("",!0),s(pe)==="monday"&&s(Oe)?(i(),v("div",ji,[e("p",zi,[a[56]||(a[56]=e("span",{class:"font-semibold text-heading"},"AI Suggestion:",-1)),V(" "+I(s(Oe).formattedDate)+" at "+I(s(Oe).time)+". "+I(s(Oe).reason),1)])])):M("",!0)]),e("div",Ui,[w(s(X),{label:"Cancel",variant:"outline",size:"small",onClick:s(G)},null,8,["onClick"]),w(s(X),{label:"Send and reschedule",variant:"primary",size:"small",onClick:s(Ds),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"},null,8,["onClick"])])])):M("",!0),s(Ne)==="not-valid"?(i(),v("div",Wi,[e("div",Pi,[a[58]||(a[58]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"When did you call?",-1)),Q(e("input",{type:"datetime-local","onUpdate:modelValue":a[11]||(a[11]=q=>Ae(xe)?xe.value=q:null),class:"input w-full"},null,512),[[ie,s(xe)]])]),e("div",Hi,[e("div",null,[a[61]||(a[61]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"Category",-1)),e("div",Qi,[e("label",Yi,[Q(e("input",{type:"radio","onUpdate:modelValue":a[12]||(a[12]=q=>Ae($e)?$e.value=q:null),value:"Not Valid",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[nt,s($e)]]),a[59]||(a[59]=e("span",{class:"text-fluid-sm text-body"},"Not Valid",-1))]),e("label",Gi,[Q(e("input",{type:"radio","onUpdate:modelValue":a[13]||(a[13]=q=>Ae($e)?$e.value=q:null),value:"Not Interested",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[nt,s($e)]]),a[60]||(a[60]=e("span",{class:"text-fluid-sm text-body"},"Not Interested",-1))])])]),e("div",null,[a[63]||(a[63]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Failure Reason",-1)),Q(e("select",{"onUpdate:modelValue":a[14]||(a[14]=q=>Ae(Le)?Le.value=q:null),class:"input"},[...a[62]||(a[62]=[jt('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[ct,s(Le)]])]),e("div",Ji,[w(s(X),{label:"Cancel",variant:"outline",size:"small",onClick:s(G)},null,8,["onClick"]),w(s(X),{label:"Disqualify",variant:"primary",size:"small",disabled:!s($e)||!s(Le),onClick:s(As),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"},null,8,["disabled","onClick"])])])])):M("",!0),s(Ne)==="interested"?(i(),v("div",Zi,[e("div",Ki,[a[64]||(a[64]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"When did you call?",-1)),Q(e("input",{type:"datetime-local","onUpdate:modelValue":a[15]||(a[15]=q=>Ae(xe)?xe.value=q:null),class:"input w-full"},null,512),[[ie,s(xe)]])]),e("div",Xi,[a[66]||(a[66]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Add Note",-1)),e("div",null,[a[65]||(a[65]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Note",-1)),Q(e("textarea",{"onUpdate:modelValue":a[16]||(a[16]=q=>re.value=q),rows:"4",class:"input w-full",placeholder:"Enter your note..."},null,512),[[ie,re.value]])]),e("div",_i,[w(s(X),{label:"Save",variant:"primary",size:"small",onClick:ae,class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),w(ps,{label:"Extract with AI",size:"small",onClick:Z})])]),e("div",er,[a[67]||(a[67]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Customer data",-1)),e("div",tr,[w(s(X),{label:"+ Add trade-in",variant:"outline",size:"small",onClick:a[17]||(a[17]=q=>ee.value=!0)}),w(s(X),{label:"+ Add financing",variant:"outline",size:"small",onClick:a[18]||(a[18]=q=>j.value=!0)})])]),s(De)&&!s(J)?(i(),v("div",sr,[w(He,{questions:Ns,"initial-expanded":!1,onSurveyCompleted:s(Is),onSurveyRefused:s(Os),onNotResponding:s(qs)},null,8,["onSurveyCompleted","onSurveyRefused","onNotResponding"])])):M("",!0),s(J)?(i(),v("div",nr,[...a[68]||(a[68]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle text-green-600 text-fluid-sm"}),e("span",{class:"text-fluid-xs font-semibold text-green-900"},"Survey completed")],-1)])])):M("",!0),e("div",ar,[a[71]||(a[71]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Qualification method",-1)),e("div",lr,[e("label",{class:F(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",s(ve)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-E5E7EB hover:bg-surfaceSecondary/50"])},[Q(e("input",{"onUpdate:modelValue":a[19]||(a[19]=q=>Ae(ve)?ve.value=q:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[nt,s(ve)]]),a[69]||(a[69]=e("span",{class:"text-fluid-sm text-heading"},"Assign only",-1))],2),e("label",{class:F(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",s(ve)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-E5E7EB hover:bg-surfaceSecondary/50"])},[Q(e("input",{"onUpdate:modelValue":a[20]||(a[20]=q=>Ae(ve)?ve.value=q:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[nt,s(ve)]]),a[70]||(a[70]=e("span",{class:"text-fluid-sm text-heading"},"Assign and schedule",-1))],2)])]),s(ve)==="assign-and-schedule"?(i(),v("div",or,[e("div",ir,[a[73]||(a[73]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Event Type",-1)),a[74]||(a[74]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Select event type",-1)),Q(e("select",{"onUpdate:modelValue":a[21]||(a[21]=q=>Ae(ze)?ze.value=q:null),class:"input w-full"},[a[72]||(a[72]=e("option",{value:"",disabled:""},"Select event type",-1)),(i(),v(ce,null,he(hs,q=>e("option",{key:q.value,value:q.value},I(q.label),9,rr)),64))],512),[[ct,s(ze)]])]),s(ze)?(i(),v("div",dr,[a[79]||(a[79]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Schedule",-1)),e("div",ur,[a[75]||(a[75]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Duration",-1)),e("div",cr,[e("button",{type:"button",class:F(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",s(_e)===30?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"]),onClick:a[22]||(a[22]=q=>Jt(30))}," 30min ",2),e("button",{type:"button",class:F(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",s(_e)===60?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"]),onClick:a[23]||(a[23]=q=>Jt(60))}," 60min ",2),Q(e("input",{"onUpdate:modelValue":a[24]||(a[24]=q=>Ae(et)?et.value=q:null),type:"number",min:"1",placeholder:"Custom",class:"input w-24",onInput:a[25]||(a[25]=q=>_e.value=null)},null,544),[[ie,s(et)]])])]),e("div",pr,[a[78]||(a[78]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Select Date Range",-1)),e("div",mr,[e("button",{type:"button",class:F(["px-4 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",s(Fe)==="tomorrow"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"]),onClick:a[26]||(a[26]=q=>Bt("tomorrow"))}," Tomorrow ",2),e("button",{type:"button",class:F(["px-4 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",s(Fe)==="this-week"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"]),onClick:a[27]||(a[27]=q=>Bt("this-week"))}," This Week ",2),e("button",{type:"button",class:F(["px-4 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",s(Fe)==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"]),onClick:a[28]||(a[28]=q=>Bt("custom"))}," Custom ",2)]),s(Fe)==="custom"?(i(),v("div",fr,[e("div",null,[a[76]||(a[76]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Start Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":a[29]||(a[29]=q=>Ae(St)?St.value=q:null),class:"input w-full"},null,512),[[ie,s(St)]])]),e("div",null,[a[77]||(a[77]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"End Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":a[30]||(a[30]=q=>Ae(Ct)?Ct.value=q:null),class:"input w-full"},null,512),[[ie,s(Ct)]])])])):M("",!0)])])):M("",!0),s(ze)&&s(Fe)?(i(),v("div",vr,[a[84]||(a[84]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-2"},"Assign appointment to :",-1)),e("div",yr,[a[81]||(a[81]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Select Team",-1)),e("div",gr,[(i(!0),v(ce,null,he(bs.value,q=>(i(),v("button",{key:q.id,type:"button",class:F(["flex items-center gap-1.5 px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all whitespace-nowrap shrink-0",s(le)&&s(le).id===q.id?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:ue=>le.value=q},[e("span",hr,I(q.dealership||"No location"),1),a[80]||(a[80]=e("span",{class:"text-sub"},"→",-1)),e("span",xr,I(q.name),1)],10,br))),128))])]),s(le)?(i(),v("div",wr,[a[82]||(a[82]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Select Salesperson (Optional)",-1)),a[83]||(a[83]=e("p",{class:"text-fluid-xs text-sub mb-2"},"You can proceed without selecting a salesperson - the appointment will be assigned to the team.",-1)),e("div",kr,[(i(!0),v(ce,null,he(Se.value,(q,ue)=>(i(),v("button",{key:q.id,type:"button",class:F(["flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all whitespace-nowrap shrink-0",s(Te)&&s(Te).id===q.id?"border-green-600 bg-surfaceSecondary text-heading":ue===0&&!s(Te)?"border-green-600/50 bg-surfaceSecondary/30 text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:st=>Te.value=q},[e("div",{class:F(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-fluid-xs shrink-0",L(q.role)])},I(Y(q.name)),3),e("span",Cr,I(q.name),1)],10,Sr))),128))])])):M("",!0)])):M("",!0),s(le)?(i(),v("div",$r,[a[87]||(a[87]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Select Date and Time Slot",-1)),s(We).length>0?(i(),v("div",Dr,[a[85]||(a[85]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Select Date",-1)),e("div",Ar,[(i(!0),v(ce,null,he(s(We),q=>(i(),v("button",{key:q.getTime(),type:"button",class:F(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all whitespace-nowrap shrink-0",s(ye)&&gs(q,s(ye))?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:ue=>{ye.value=q,qe.value=""}},I(s(Ye)(q)),11,Tr))),128))])])):M("",!0),s(ye)?(i(),v("div",Ir,[a[86]||(a[86]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Select Time Slot",-1)),e("div",Or,[(i(!0),v(ce,null,he(Yt.value,q=>(i(),v("button",{key:q,type:"button",class:F(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all whitespace-nowrap shrink-0",s(qe)===q?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"]),onClick:ue=>qe.value=q},I(q),11,qr))),128)),Yt.value.length===0?(i(),v("p",Er," No available slots for this date ")):M("",!0)])])):M("",!0)])):M("",!0),w(ti,{appointment:{type:s(ze),date:s(ye),time:s(qe),duration:s(Me)},customer:t.lead.customer,salesperson:s(Te),team:s(le),dealership:(_=s(le))!=null&&_.dealership?{name:s(le).dealership}:null,onUpdate:ys},null,8,["appointment","customer","salesperson","team","dealership"])])):M("",!0),s(H)&&s(ve)==="assign-only"?(i(),v("div",Mr,[a[92]||(a[92]=jt('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-fluid-sm">Existing Appointment</h5></div><span class="text-fluid-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Nr,[e("div",null,[a[88]||(a[88]=e("span",{class:"text-body"},"Date:",-1)),e("span",Lr,I(s(Ye)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[a[89]||(a[89]=e("span",{class:"text-body"},"Time:",-1)),e("span",Br,I(s(Dt)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[a[90]||(a[90]=e("span",{class:"text-body"},"Type:",-1)),e("span",Fr,I(t.lead.scheduledAppointment.type),1)]),e("div",null,[a[91]||(a[91]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Rr,I(t.lead.scheduledAppointment.assignee),1)])]),w(s(X),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:a[31]||(a[31]=q=>Xe.value=!0)})])):M("",!0),e("div",Vr,[w(s(X),{label:"Cancel",variant:"outline",size:"small",onClick:s(G)},null,8,["onClick"]),e("div",jr,[s(ve)!=="assign-and-schedule"?(i(),z(s(X),{key:0,label:"Disqualify",variant:"outline",size:"small",onClick:s($s)},null,8,["onClick"])):M("",!0),w(s(X),{label:s(ve)==="assign-and-schedule"?"Confirm Appointment and Qualify":"Qualify",variant:"primary",size:"small",disabled:!xs.value,onClick:s(Cs),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,["label","disabled","onClick"])])])])):M("",!0)]))])],64)),w(un,{ref_key:"noteWidgetRef",ref:g,modal:"",show:s(ot),item:null,"task-type":"lead","task-id":t.lead.id,onSave:s(Ts),onClose:a[32]||(a[32]=q=>ot.value=!1),onCancel:a[33]||(a[33]=q=>ot.value=!1)},null,8,["show","task-id","onSave"]),w(_l,{show:s(Xe),"preselected-assignee":s(fe).assignee,onConfirm:s(Ss),onClose:a[34]||(a[34]=q=>Xe.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),w(os,{show:R.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:W,onClose:a[35]||(a[35]=q=>R.value=!1)},null,8,["show"]),w(cn,{show:j.value,"task-type":"lead","task-id":t.lead.id,onSave:Bs,onClose:a[36]||(a[36]=q=>j.value=!1)},null,8,["show","task-id"]),w(pn,{show:ee.value,mode:"tradein","task-type":"lead","task-id":t.lead.id,"customer-id":t.lead.customerId,onClose:a[37]||(a[37]=q=>ee.value=!1),onSave:Fs},null,8,["show","task-id","customer-id"])])}}},Ur={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},Wr={class:"flex justify-between items-start mb-3"},Pr={class:"text-fluid-xs text-body mt-0.5"},Hr={key:0},Qr={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:C}){const n=t,o=C,d=ht(),l=()=>{var c;const r=d.currentLead;return r&&r.id===((c=n.lead)==null?void 0:c.id)?r:n.lead},p={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},y=rs(ut(n,"lead"),p),{handlePostponed:u,handleValidated:$,handleQualified:k,handleCallAttemptLogged:h,handleNoteSaved:f,handleOpenPurchaseMethod:b,handleOpenTradeIn:S,handleAppointmentScheduled:T,handleDisqualified:O,handleReopen:m}=vl({getLead:l,leadState:y,emit:o}),x=async r=>{var c;(c=n.lead)!=null&&c.id&&await d.loadLeadById(n.lead.id)};return(r,c)=>(i(),z(ds,{task:t.lead,"hide-title":"","hide-border":""},{"primary-action":N(()=>[s(y).isClosed.value?M("",!0):(i(),z(cs,{key:0,task:t.lead,"task-type":"lead",onReassigned:x,class:"mb-3"},null,8,["task"])),!s(y).isClosed.value&&s(y).showLQWidget.value?(i(),z(zr,{key:t.lead.id,lead:t.lead,"show-deadline-banner":s(y).showDeadlineBanner.value,onPostponed:s(u),onValidated:s($),onQualified:s(k),onDisqualified:s(O),onCallAttemptLogged:s(h),onNoteSaved:s(f),onOpenPurchaseMethod:s(b),onOpenTradeIn:s(S),onAppointmentScheduled:s(T)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!s(y).isClosed.value&&s(y).primaryAction.value?(i(),z(us,{key:2,action:s(y).primaryAction.value,"color-scheme":s(y).primaryAction.value.colorScheme,onActionClicked:s(y).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):M("",!0)]),"task-widgets":N(()=>[...c[0]||(c[0]=[])]),"closed-state":N(()=>[s(y).isClosed.value?(i(),v("div",Ur,[e("div",Wr,[e("div",null,[c[1]||(c[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",Pr,[V(" Status: "+I(s(y).displayStage.value)+" ",1),t.lead.disqualifyReason?(i(),v("span",Hr," - "+I(t.lead.disqualifyReason),1)):M("",!0)])])]),w(s(X),{variant:"primary",size:"small",onClick:s(m),class:"flex items-center gap-2"},{default:N(()=>[...c[2]||(c[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):M("",!0)]),_:1},8,["task"]))}},Yr={class:"flex justify-between items-start mb-3"},Gr={class:"font-bold text-heading text-fluid-sm"},Jr={class:"text-fluid-xs text-sub mt-0.5"},Zr={class:"flex gap-3 flex-wrap"},Je={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(C,n)=>(i(),v("div",{class:F(["rounded-lg p-3 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Yr,[e("div",null,[e("h4",Gr,I(t.title),1),e("p",Jr,I(t.description),1)]),Pe(C.$slots,"badge")]),e("div",Zr,[Pe(C.$slots,"actions")]),Pe(C.$slots,"survey"),Pe(C.$slots,"content")],2))}},Kr={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],l=E(()=>{if(!n.opportunity.createdAt)return 0;const h=new Date(n.opportunity.createdAt),b=Math.abs(new Date-h);return Math.ceil(b/(1e3*60*60*24))}),p=()=>{o("create-offer",n.opportunity)},y=()=>{o("review",n.opportunity)},u=h=>{o("survey-completed",{opportunity:n.opportunity,responses:h})},$=()=>{o("survey-refused",{opportunity:n.opportunity})},k=()=>{o("not-responding",{opportunity:n.opportunity})};return(h,f)=>(i(),z(Je,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${l.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:y,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Review Opportunity ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:u,onSurveyRefused:$,onNotResponding:k})]),_:1},8,["description"]))}},Xr={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],l=E(()=>{if(!n.opportunity.createdAt)return 0;const k=new Date(n.opportunity.createdAt),f=Math.abs(new Date-k);return Math.ceil(f/(1e3*60*60*24))}),p=()=>{o("create-offer",n.opportunity)},y=k=>{o("survey-completed",{opportunity:n.opportunity,responses:k})},u=()=>{o("survey-refused",{opportunity:n.opportunity})},$=()=>{o("not-responding",{opportunity:n.opportunity})};return(k,h)=>(i(),z(Je,{title:"Unsold Feedback",description:`This opportunity has been open for ${l.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:y,onSurveyRefused:u,onNotResponding:$})]),_:1},8,["description"]))}},_r={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],l=()=>{o("schedule-closing",n.opportunity)},p=$=>{o("survey-completed",{opportunity:n.opportunity,responses:$})},y=()=>{o("survey-refused",{opportunity:n.opportunity})},u=()=>{o("not-responding",{opportunity:n.opportunity})};return($,k)=>(i(),z(Je,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:N(()=>[e("button",{onClick:l,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Schedule Closing Meeting ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:p,onSurveyRefused:y,onNotResponding:u})]),_:1}))}},ed={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],l=E(()=>{const k=n.opportunity.lastActivity||n.opportunity.createdAt;if(!k)return 0;const h=new Date(k),b=Math.abs(new Date-h);return Math.ceil(b/(1e3*60*60*24))}),p=()=>{o("create-contract",n.opportunity)},y=k=>{o("survey-completed",{opportunity:n.opportunity,responses:k})},u=()=>{o("survey-refused",{opportunity:n.opportunity})},$=()=>{o("not-responding",{opportunity:n.opportunity})};return(k,h)=>(i(),z(Je,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${l.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Contract ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:y,onSurveyRefused:u,onNotResponding:$})]),_:1},8,["description"]))}},td={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],l=E(()=>{var S;if(!((S=n.opportunity)!=null&&S.contractDate))return 0;const h=new Date(n.opportunity.contractDate),b=Math.abs(new Date-h);return Math.ceil(b/(1e3*60*60*24))}),p=()=>{o("prepare-delivery",n.opportunity)},y=()=>{o("pre-delivery-checklist",n.opportunity)},u=h=>{o("survey-completed",{opportunity:n.opportunity,responses:h})},$=()=>{o("survey-refused",{opportunity:n.opportunity})},k=()=>{o("not-responding",{opportunity:n.opportunity})};return(h,f)=>(i(),z(Je,{title:"Contract Feedback",description:`Contract was signed ${l.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Prepare for Delivery "),e("button",{onClick:y,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:u,onSurveyRefused:$,onNotResponding:k})]),_:1},8,["description"]))}},sd={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C,d=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],l=E(()=>{const k=n.activities.find(S=>{var T;return S.type==="delivery"||((T=S.action)==null?void 0:T.toLowerCase().includes("delivered"))});if(!k||!k.timestamp)return 0;const h=new Date(k.timestamp),b=Math.abs(new Date-h);return Math.ceil(b/(1e3*60*60*24))}),p=()=>{o("delivery-feedback",n.opportunity)},y=k=>{o("survey-completed",{opportunity:n.opportunity,responses:k})},u=()=>{o("survey-refused",{opportunity:n.opportunity})},$=()=>{o("not-responding",{opportunity:n.opportunity})};return(k,h)=>(i(),z(Je,{title:"Delivery Feedback",description:`Vehicle was delivered ${l.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Delivery Feedback ")]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:y,onSurveyRefused:u,onNotResponding:$})]),_:1},8,["description"]))}},nd={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:C}){const n=t,o=C,d=E(()=>{var S;return((S=n.scheduledAppointment)==null?void 0:S.noShowCount)||0}),l=E(()=>{const S=d.value;return S===0?"No-Show Follow-up":S>=3?`No-Show #${S} - Final Warning`:`No-Show #${S} Follow-up`}),p=E(()=>{const S=d.value;return S>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":S>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),y=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],u=E(()=>{var T;return(T=n.scheduledAppointment)!=null&&T.start?new Date(n.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),$=()=>{o("contact-customer",n.opportunity)},k=()=>{const S=d.value;if(S>=3)o("auto-close-lost",{opportunity:n.opportunity,reason:`Automatically closed after ${S} no-shows`});else if(S===1||S===2){const T=new Date;T.setDate(T.getDate()+2),o("set-callback",{opportunity:n.opportunity,callbackDate:T.toISOString()})}else o("reschedule",n.opportunity)},h=S=>{o("survey-completed",{opportunity:n.opportunity,responses:S})},f=()=>{o("survey-refused",{opportunity:n.opportunity})},b=()=>{o("not-responding",{opportunity:n.opportunity})};return(S,T)=>(i(),z(Je,{title:l.value,description:`Appointment was scheduled for ${u.value} but customer did not show up. ${p.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:N(()=>[e("button",{onClick:k,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...T[0]||(T[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),V(" Book Another Appointment ",-1)])]),e("button",{onClick:$,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...T[1]||(T[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),V(" Contact Customer ",-1)])])]),survey:N(()=>[w(He,{questions:y,onSurveyCompleted:h,onSurveyRefused:f,onNotResponding:b})]),_:1},8,["title","description"]))}},ad={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:C}){const n=t,o=C;Pt();const d=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],l=E(()=>{const f=n.opportunity.lastActivity||n.opportunity.createdAt;if(!f)return 0;const b=new Date(f),T=Math.abs(new Date-b);return Math.ceil(T/(1e3*60*60*24))}),p=()=>{o("reopen",n.opportunity)},y=()=>{o("close-lost",{opportunity:n.opportunity,reason:"Abandoned - no activity for extended period"})},u=()=>{o("requalify",n.opportunity)},$=f=>{o("survey-completed",{opportunity:n.opportunity,responses:f})},k=()=>{o("survey-refused",{opportunity:n.opportunity})},h=()=>{o("not-responding",{opportunity:n.opportunity})};return(f,b)=>(i(),z(Je,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${l.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:N(()=>[e("button",{onClick:p,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...b[0]||(b[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),V(" Reopen Opportunity ",-1)])]),e("button",{onClick:y,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),V(" Close as Lost ",-1)])]),e("button",{onClick:u,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...b[2]||(b[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),V(" Requalify as Lead ",-1)])])]),survey:N(()=>[w(He,{questions:d,onSurveyCompleted:$,onSurveyRefused:k,onNotResponding:h})]),_:1},8,["description"]))}},ld={OOFB:Kr,UFB:Xr,NFU:_r,OFB:ed,CFB:td,DFB:sd,NS:nd,ABANDONED:ad};function od(t,C,n,o,d){const l=E(()=>{const f=qt(t),b=qt(C),S=qt(n);return{opportunity:f,scheduledAppointment:b,activities:S,hasOffers:(S==null?void 0:S.some(T=>T.type==="offer"))||!1,stage:f.displayStage||f.stage,deliverySubstatus:f.deliverySubstatus||null,formatDateTime:d,hasActiveTaskWidget:!1}}),p=E(()=>{const f=l.value,b=mn(f.stage,f);if(!b)return null;const S=ld[b];return S?{type:b,component:S,props:{opportunity:f.opportunity,appointment:f.scheduledAppointment,activities:f.activities}}:null}),y=E(()=>({...l.value,hasActiveTaskWidget:!!p.value})),u=E(()=>{const f=y.value,b=fn(f.stage,f);if(!b)return null;const S=o[b.key];return{...b,handler:S||(()=>{})}}),$=E(()=>{const f=y.value;return vn(f.stage,f).map(S=>{const T=o[S.key];return{...S,handler:T||(()=>{})}})}),k=E(()=>{const f=l.value;return yn(f.stage)}),h=E(()=>!p.value||!p.value.type?"":gn(p.value.type));return{primaryAction:u,secondaryActions:$,activeTaskWidget:p,taskWidgetTitle:h,isClosed:k}}const id={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},rd=["src","alt"],dd={key:1,class:"w-full h-full flex items-center justify-center"},ud={class:"flex items-center justify-between mb-1.5"},cd={class:"text-sm font-bold text-heading"},pd={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},md={class:"text-xs text-sub mb-1.5"},fd={key:0,class:"text-xs text-green-600 font-medium mb-2"},vd={key:1,class:"text-xs text-orange-600 font-medium mb-2"},es={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const C=t,n=E(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[C.badge]||"gray"),o=d=>d?d.toLocaleString("en-US"):"0";return(d,l)=>(i(),v("div",{onClick:l[1]||(l[1]=p=>d.$emit("select")),class:F(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",id,[t.vehicle.image?(i(),v("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,rd)):(i(),v("div",dd,[...l[2]||(l[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",ud,[w(s(Ys),{text:t.badge,size:"small",theme:n.value},null,8,["text","theme"]),e("span",cd,"€"+I(o(t.vehicle.price)),1)]),e("h4",pd,I(t.vehicle.brand)+" "+I(t.vehicle.model),1),e("p",md,I(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(i(),v("div",fd,[l[3]||(l[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),V(" In stock ("+I(t.stockDays)+" days) ",1)])):(i(),v("div",vd,[...l[4]||(l[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),V(" Out of stock ",-1)])])),e("button",{onClick:l[0]||(l[0]=ss(p=>d.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},yd={class:"space-y-6"},gd={key:0},bd={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},hd={class:"mb-4"},xd={class:"relative"},wd={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},kd={key:1,class:"text-center py-8 text-sub"},Sd={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},Cd={key:0,class:"mt-4 space-y-3"},$d={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Dd={class:"flex justify-end"},Ad=["disabled"],Td={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:C}){const n=t,o=C,d=r=>{r||o("close")},l=A(""),p=A(!1),y=A(null),u=A(null),$=A(null),k=A([]),h=A({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});as(async()=>{try{const r=await is({});k.value=r.data||[]}catch(r){console.error("Failed to load vehicles:",r),k.value=[]}});const f=E(()=>n.requestedVehicle&&n.requestedVehicle.stockDays!==null&&n.requestedVehicle.stockDays!==void 0),b=E(()=>{const r=[];if(n.requestedVehicle&&f.value&&r.push({...n.requestedVehicle,isRequested:!0}),k.value&&k.value.length>0){const c=k.value.filter(R=>n.requestedVehicle?R.brand!==n.requestedVehicle.brand||R.model!==n.requestedVehicle.model:!0),g=n.requestedVehicle&&f.value?3:4;r.push(...c.slice(0,g))}return r}),S=E(()=>{if(!k.value||k.value.length===0)return[];let r=[...k.value];if(l.value){const c=l.value.toLowerCase();r=r.filter(g=>g.brand.toLowerCase().includes(c)||g.model.toLowerCase().includes(c)||g.year.toString().includes(c))}return r}),T=E(()=>h.value.brand&&h.value.model&&h.value.year&&h.value.price>0),O=(r,c)=>{y.value=r,u.value=r.id||`custom-${Date.now()}`,$.value=c},m=()=>{if(!T.value)return;const r={...h.value,id:`custom-${Date.now()}`,isCustom:!0};O(r,"custom")},x=()=>{y.value&&(o("vehicle-selected",{vehicle:y.value,type:$.value}),o("close"),y.value=null,u.value=null,$.value=null,l.value="",p.value=!1,h.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(r,c)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":d},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-6xl"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),null,{default:N(()=>[...c[7]||(c[7]=[V("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",yd,[b.value.length?(i(),v("div",gd,[c[8]||(c[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),V(" Recommended Vehicles ")],-1)),e("div",bd,[(i(!0),v(ce,null,he(b.value,g=>(i(),z(es,{key:g.id,vehicle:g,badge:g.isRequested?"Requested":"Recommended","stock-days":g.stockDays,selected:u.value===g.id,onSelect:R=>O(g,g.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):M("",!0),e("div",null,[c[11]||(c[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),V(" Browse Stock ")],-1)),e("div",hd,[e("div",xd,[c[9]||(c[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),Q(e("input",{"onUpdate:modelValue":c[0]||(c[0]=g=>l.value=g),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ie,l.value]])])]),S.value.length?(i(),v("div",wd,[(i(!0),v(ce,null,he(S.value,g=>(i(),z(es,{key:g.id,vehicle:g,badge:"In Stock","stock-days":g.stockDays,selected:u.value===g.id,onSelect:R=>O(g,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(i(),v("div",kd,[...c[10]||(c[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[c[19]||(c[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),V(" Configure Custom Vehicle ")],-1)),e("div",Sd,[c[18]||(c[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:c[1]||(c[1]=g=>p.value=!p.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[c[12]||(c[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),V(" "+I(p.value?"Hide Configuration":"Build Custom Configuration"),1)]),p.value?(i(),v("div",Cd,[e("div",$d,[e("div",null,[c[13]||(c[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),Q(e("input",{"onUpdate:modelValue":c[2]||(c[2]=g=>h.value.brand=g),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ie,h.value.brand]])]),e("div",null,[c[14]||(c[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),Q(e("input",{"onUpdate:modelValue":c[3]||(c[3]=g=>h.value.model=g),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ie,h.value.model]])]),e("div",null,[c[15]||(c[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),Q(e("input",{"onUpdate:modelValue":c[4]||(c[4]=g=>h.value.year=g),type:"number",class:"input",placeholder:"2024"},null,512),[[ie,h.value.year]])]),e("div",null,[c[16]||(c[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (€)",-1)),Q(e("input",{"onUpdate:modelValue":c[5]||(c[5]=g=>h.value.price=g),type:"number",class:"input",placeholder:"98000"},null,512),[[ie,h.value.price]])])]),e("div",Dd,[e("button",{onClick:m,disabled:!T.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...c[17]||(c[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),V(" Use Custom Configuration ",-1)])],8,Ad)])])):M("",!0)])])]),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c[6]||(c[6]=g=>r.$emit("close"))}),y.value?(i(),z(s(X),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:x})):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Id={class:"space-y-4"},Od=["max"],qd={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const n=t,o=C,d=A(""),l=A(""),p=A(""),y=E(()=>new Date().toISOString().split("T")[0]);ke(()=>n.show,h=>{if(h){const f=new Date;d.value=f.toISOString().split("T")[0],l.value=f.toTimeString().slice(0,5),p.value=""}});const u=()=>{if(!d.value)return;const h=l.value?`${d.value}T${l.value}:00`:`${d.value}T12:00:00`;o("confirm",{contractDate:h,notes:p.value})},$=()=>{o("cancel")},k=h=>{h||$()};return(h,f)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":k},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-lg"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),null,{default:N(()=>[...f[3]||(f[3]=[V("Set Contract Signing Date",-1)])]),_:1}),w(s(Et),null,{default:N(()=>[...f[4]||(f[4]=[V("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",Id,[e("div",null,[f[5]||(f[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":f[0]||(f[0]=b=>d.value=b),max:y.value,class:"input"},null,8,Od),[[ie,d.value]])]),e("div",null,[f[6]||(f[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":f[1]||(f[1]=b=>l.value=b),class:"input"},null,512),[[ie,l.value]])]),e("div",null,[f[7]||(f[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),Q(e("textarea",{"onUpdate:modelValue":f[2]||(f[2]=b=>p.value=b),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ie,p.value]])])]),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:$}),w(s(X),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!d.value,onClick:u},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ed={class:"space-y-4"},Md=["max"],Nd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const n=t,o=C,d=A(""),l=A(""),p=A(""),y=A(""),u=E(()=>new Date().toISOString().split("T")[0]);ke(()=>n.show,f=>{if(f){const b=new Date;d.value=b.toISOString().split("T")[0],l.value=b.toTimeString().slice(0,5),p.value="",y.value=""}});const $=()=>{if(!d.value||!p.value)return;const f=l.value?`${d.value}T${l.value}:00`:`${d.value}T12:00:00`;o("confirm",{deliveryDate:f,location:p.value,notes:y.value})},k=()=>{o("cancel")},h=f=>{f||k()};return(f,b)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":h},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-lg"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),null,{default:N(()=>[...b[4]||(b[4]=[V("Mark as Delivered",-1)])]),_:1}),w(s(Et),null,{default:N(()=>[...b[5]||(b[5]=[V("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",Ed,[e("div",null,[b[6]||(b[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),Q(e("input",{type:"date","onUpdate:modelValue":b[0]||(b[0]=S=>d.value=S),max:u.value,class:"input"},null,8,Md),[[ie,d.value]])]),e("div",null,[b[7]||(b[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),Q(e("input",{type:"time","onUpdate:modelValue":b[1]||(b[1]=S=>l.value=S),class:"input"},null,512),[[ie,l.value]])]),e("div",null,[b[9]||(b[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),Q(e("select",{"onUpdate:modelValue":b[2]||(b[2]=S=>p.value=S),class:"input"},[...b[8]||(b[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ct,p.value]])]),e("div",null,[b[10]||(b[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":b[3]||(b[3]=S=>y.value=S),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ie,y.value]])])]),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),w(s(X),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!d.value||!p.value,onClick:$},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ld={class:"space-y-4"},Bd={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const n=t,o=C,d=A(""),l=A("");ke(()=>n.show,$=>{$&&(d.value="",l.value="")});const p=()=>{d.value&&o("confirm",{reason:d.value,notes:l.value})},y=()=>{o("cancel")},u=$=>{$||y()};return($,k)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":u},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-lg"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),null,{default:N(()=>[...k[2]||(k[2]=[V("Close as Lost",-1)])]),_:1}),w(s(Et),null,{default:N(()=>[...k[3]||(k[3]=[V("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",Ld,[e("div",null,[k[5]||(k[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),Q(e("select",{"onUpdate:modelValue":k[0]||(k[0]=h=>d.value=h),class:"input"},[...k[4]||(k[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ct,d.value]])]),e("div",null,[k[6]||(k[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),Q(e("textarea",{"onUpdate:modelValue":k[1]||(k[1]=h=>l.value=h),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ie,l.value]])])]),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y}),w(s(X),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!d.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Fd={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:C}){const n=C,o=d=>{d||n("cancel")};return(d,l)=>(i(),z(s(bt),{open:t.show,"onUpdate:open":o},{default:N(()=>[w(s(pt),null,{default:N(()=>[w(s(mt),{class:"fixed inset-0 z-50 bg-black/50"}),w(s(ft),{class:"w-full sm:max-w-lg"},{default:N(()=>[w(s(vt),null,{default:N(()=>[w(s(yt),null,{default:N(()=>[...l[2]||(l[2]=[V("Requalify as Lead",-1)])]),_:1}),w(s(Et),null,{default:N(()=>[...l[3]||(l[3]=[V("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),l[4]||(l[4]=e("div",{class:"space-y-6 max-h-screen-60 overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),V(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),V(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),V(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),w(s(gt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[w(s(X),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:l[0]||(l[0]=p=>d.$emit("cancel"))}),w(s(X),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:l[1]||(l[1]=p=>d.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Rd={key:0,class:"space-y-3"},Vd={class:"flex items-center gap-2 pb-2 border-b border"},jd={class:"font-semibold text-heading text-fluid-sm"},zd={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},Ud={class:"flex justify-between items-start mb-3"},Wd={class:"text-fluid-xs text-body mt-0.5"},Pd={key:0},Hd={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:C}){const n=t,o=C,d=ns(),l=Mt(),p=A(!1),y=A(!1),u=A(!1),$=A(!1),k=A(!1),h=A(!1),f=A(!1),b=A(!1),S=A(!1),T=A(!1),O=A([]);function m(P){return P?new Date(P).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const x={"schedule-appointment":()=>{p.value=!0},"view-or-schedule-appointment":()=>{n.scheduledAppointment?S.value=!0:p.value=!0},"select-vehicle":()=>{f.value=!0},"create-offer":()=>{!n.opportunity.selectedVehicle&&!n.opportunity.vehicle?f.value=!0:y.value=!0},"call-prospect":()=>{b.value=!0},"follow-up-offer":()=>{b.value=!0},"request-decision":()=>{b.value=!0},"finalize-contract":()=>{$.value=!0},"schedule-delivery":()=>{k.value=!0},"confirm-delivery":()=>{k.value=!0},"collect-feedback":()=>{b.value=!0},reschedule:()=>{T.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&Ce()},"close-won":()=>{$.value=!0},"add-offer":()=>{y.value=!0},"add-contract":()=>{$.value=!0},"extend-deadline":()=>{b.value=!0},"close-lost":()=>{u.value=!0},reopen:()=>{L()},requalify:()=>{h.value=!0}},r=od(ut(n,"opportunity"),ut(n,"scheduledAppointment"),ut(n,"activities"),x,m),c={isClosed:r.isClosed,primaryAction:r.primaryAction,activeTaskWidget:r.activeTaskWidget,taskWidgetTitle:r.taskWidgetTitle,displayStage:E(()=>Ht(n.opportunity,"opportunity")||"Qualified"),showDeadlineBanner:E(()=>{var P;return!r.isClosed.value&&!!((P=n.opportunity)!=null&&P.nextActionDue)})},g=async P=>{var U;(U=n.opportunity)!=null&&U.id&&await l.fetchOpportunityById(n.opportunity.id)};function R(){}function j(P){f.value=!1,o("vehicle-selected",P),setTimeout(()=>{y.value=!0},300)}function ee(P){y.value=!1,o("offer-created",P)}function Se(P){p.value=!1,o("appointment-scheduled",{...P,opportunityId:n.opportunity.id,customer:n.opportunity.customer.name})}function Ce(){n.scheduledAppointment&&o("appointment-cancelled",n.scheduledAppointment.id)}function be(P){$.value=!1,l.updateOpportunity(n.opportunity.id,{stage:"Closed Won",contractDate:P.contractDate})}function re(P){k.value=!1,l.addActivity(n.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:P})}function Y(P){u.value=!1,l.updateOpportunity(n.opportunity.id,{stage:"Closed Lost",lossReason:P})}function L(){l.updateOpportunity(n.opportunity.id,{stage:"Qualified"})}function W(P){h.value=!1,d.push(`/customer/${P.id}?type=lead`)}function ae(P){S.value=!1}function Z(P){T.value=!1}function se(P){l.updateOpportunity(n.opportunity.id,{callbackDate:P.callbackDate})}function Ie(P){l.updateOpportunity(n.opportunity.id,{stage:"Closed Lost",lossReason:P.reason||"Multiple no-shows (NS3)"})}return as(async()=>{try{const U=(await is({})).data||[];O.value=U.filter(de=>de.stockDays!==null&&de.stockDays!==void 0).slice(0,5)}catch(P){console.error("Failed to load recommended cars:",P),O.value=[]}}),(P,U)=>(i(),v(ce,null,[w(ds,{task:t.opportunity,"hide-title":"","hide-border":""},{"deadline-banner":N(()=>[c.isClosed.value?M("",!0):(i(),z(ms,{key:0,"next-action-due":t.opportunity.nextActionDue,"show-deadline-banner":c.showDeadlineBanner.value,"task-id":t.opportunity.id},null,8,["next-action-due","show-deadline-banner","task-id"]))]),"primary-action":N(()=>[c.isClosed.value?M("",!0):(i(),z(cs,{key:0,task:t.opportunity,"task-type":"opportunity",onReassigned:g,class:"mb-3"},null,8,["task"])),!c.isClosed.value&&c.primaryAction.value?(i(),z(us,{key:1,action:c.primaryAction.value,"color-scheme":c.primaryAction.value.colorScheme,onActionClicked:c.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):M("",!0)]),"task-widgets":N(()=>[c.activeTaskWidget.value&&c.activeTaskWidget.value.component?(i(),v("div",Rd,[e("div",Vd,[U[11]||(U[11]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",jd,I(c.taskWidgetTitle.value),1)]),(i(),z(Wt(c.activeTaskWidget.value.component),Ut(c.activeTaskWidget.value.props,{onClose:R,onSetCallback:se,onAutoCloseLost:Ie}),null,16))])):M("",!0)]),"closed-state":N(()=>[c.isClosed.value?(i(),v("div",zd,[e("div",Ud,[e("div",null,[U[12]||(U[12]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed",-1)),e("p",Wd,[V(" Status: "+I(c.displayStage.value)+" ",1),t.opportunity.lossReason?(i(),v("span",Pd," - "+I(t.opportunity.lossReason),1)):M("",!0)])])]),w(s(X),{variant:"primary",size:"small",onClick:L,class:"flex items-center gap-2"},{default:N(()=>[...U[13]||(U[13]=[e("span",null,"Reopen Opportunity",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1})])):M("",!0)]),_:1},8,["task"]),p.value?(i(),z(xn,{key:0,show:p.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:Se,onCancel:U[0]||(U[0]=de=>p.value=!1)},null,8,["show","customer","assignee"])):M("",!0),f.value?(i(),z(Td,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":O.value,onVehicleSelected:j,onClose:U[1]||(U[1]=de=>f.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):M("",!0),y.value?(i(),z(bn,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:ee,onClose:U[2]||(U[2]=de=>y.value=!1)},null,8,["opportunity","vehicle"])):M("",!0),$.value?(i(),z(qd,{key:3,opportunity:t.opportunity,onContractSet:be,onClose:U[3]||(U[3]=de=>$.value=!1)},null,8,["opportunity"])):M("",!0),k.value?(i(),z(Nd,{key:4,opportunity:t.opportunity,onDelivered:re,onClose:U[4]||(U[4]=de=>k.value=!1)},null,8,["opportunity"])):M("",!0),u.value?(i(),z(Bd,{key:5,opportunity:t.opportunity,onClosed:Y,onClose:U[5]||(U[5]=de=>u.value=!1)},null,8,["opportunity"])):M("",!0),h.value?(i(),z(Fd,{key:6,opportunity:t.opportunity,onRequalified:W,onClose:U[6]||(U[6]=de=>h.value=!1)},null,8,["opportunity"])):M("",!0),b.value?(i(),z(hn,{key:7,onClose:U[7]||(U[7]=de=>b.value=!1)})):M("",!0),S.value&&t.scheduledAppointment?(i(),z(wn,{key:8,show:S.value,event:t.scheduledAppointment,onClose:U[8]||(U[8]=de=>S.value=!1),onEdit:U[9]||(U[9]=de=>{S.value=!1,T.value=!0}),onDelete:ae},null,8,["show","event"])):M("",!0),T.value&&t.scheduledAppointment?(i(),z(kn,{key:9,show:T.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:Z,onCancel:U[10]||(U[10]=de=>T.value=!1)},null,8,["show","event","customer"])):M("",!0)],64))}};function nu(t){const C=ht(),n=Mt(),o=E(()=>t.value?t.value.type==="lead"?Qr:Hd:null),d=E(()=>t.value?t.value.type==="lead"?{currentActivities:E(()=>C.currentLeadActivities),addActivity:(p,y)=>C.addActivity(p,y),updateActivity:(p,y,u)=>C.updateActivity(p,y,u),deleteActivity:(p,y)=>C.deleteActivity(p,y),updateLead:(p,y)=>C.updateLead(p,y),loadLeadById:p=>C.fetchLeadById(p)}:{currentActivities:E(()=>n.currentOpportunityActivities),addActivity:(p,y)=>n.addActivity(p,y),updateActivity:(p,y,u)=>n.updateActivity(p,y,u),deleteActivity:(p,y)=>n.deleteActivity(p,y),addVehicle:(p,y)=>n.addVehicle(p,y),createOffer:(p,y)=>n.createOffer(p,y),updateOpportunity:(p,y)=>n.updateOpportunity(p,y),loadOpportunityById:p=>n.fetchOpportunityById(p)}:null),l=E(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:o,storeAdapter:d,addNewConfig:l}}function au(t){const C=ht(),n=Mt(),o=At(),d=E(()=>{const b=(t.value?C.leads:C.leads.filter(O=>!O.isDisqualified)).map(O=>{const m=Ht(O,"lead"),x={...O,type:"lead",compositeId:`lead-${O.id}`,displayStage:m};return!x.customer&&O.customer&&(x.customer=O.customer),x}),S=n.opportunities.map(O=>{const m={...O,type:"opportunity",compositeId:`opportunity-${O.id}`};return!m.customer&&O.customer&&(m.customer=O.customer),m});let T=[];return o.isOperator()?T=b:o.isSalesman()?T=S:T=[...b,...S],T}),l=(f,b)=>!b||b.length===0?f:Array.isArray(b)?f.filter(S=>b.includes(S.type)):b==="all"?f:f.filter(S=>S.type===b),p=f=>{const b=new Date,S=new Date(b.getTime()+24*60*60*1e3);return f.filter(T=>{if(!T.nextActionDue)return!1;const O=new Date(T.nextActionDue);return O>=b&&O<=S})},y=f=>f.filter(b=>b.nextActionDue!=null),u=f=>{const b=new Date(Date.now()-36e5);return f.filter(S=>S.type!=="lead"||!S.createdAt?!1:new Date(S.createdAt)>=b)},$=f=>{var S;const b=(S=o.currentUser)==null?void 0:S.name;return b?f.filter(T=>T.assignee===b):[]},k=(f,b)=>{if(!b||b.length===0)return f;let S=[...f];const T=b.filter(O=>O==="lead"||O==="opportunity");return T.length>0&&(S=l(S,T)),b.forEach(O=>{switch(O){case"due-in-24h":S=p(S);break;case"to-be-called":S=y(S);break;case"leads-1h":S=u(S);break;case"assigned-to-me":S=$(S);break}}),S},h=E(()=>{const f=d.value.some(S=>S.type==="lead"),b=d.value.some(S=>S.type==="opportunity");return f&&b});return{allTasks:d,filterByType:l,filterByDueIn24Hours:p,filterByToBeCalled:y,filterByLeadsCreated1Hour:u,filterByAssignedToMe:$,applyFilters:k,shouldShowTypeFilter:h}}export{su as T,nu as a,au as u};
