import{u as X,a as ke,r as A,c as L,f as Ce,b as De,d as r,o,e,n as M,t as c,g as m,F as $,h as te,i as U,j as se,k as ee,w as $e,l as Ae,m as Te,p as je,v as Re,q as Q,s as E,x as F,y as _,z as Z,Q as K,A as Me,B as Se,C as Oe}from"./index-DqXOZZRa.js";import{f as Ne,a as Ie}from"./calendar-C4arRczc.js";import{u as Pe}from"./users-BeZFi7uU.js";import{_ as Le}from"./ReassignUserModal-Da6cQ3cL.js";import{f as Ue,a as Ve,b as Be}from"./dashboard-FPPonrrJ.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CzLkKHlp.js";function qe(){const h=X(),{questions:w,totalQuestionsCount:f,loading:x,loadQuestions:v}=ke(),g=A([]),n=A([]),i=A([]),b=A([]),O=A(!0),N=A(!0),S=L(()=>{const l=n.value.map(p=>({...p,type:"lead",taskType:"Lead",dueTime:p.nextActionDue?new Date(p.nextActionDue).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:p.nextActionDue?new Date(p.nextActionDue):null})),a=i.value.map(p=>({...p,type:"opportunity",taskType:"Opportunity",dueTime:p.expectedCloseDate?new Date(p.expectedCloseDate).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:p.expectedCloseDate?new Date(p.expectedCloseDate):null}));return[...l,...a]}),j=L(()=>{const l=[],a=g.value.map(d=>({...d,todoType:"appointment",sortTime:new Date(d.start).getTime(),time:new Date(d.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(d.start)}));l.push(...a);const p=S.value.map(d=>{const t=d.dueDate||(d.nextActionDue?new Date(d.nextActionDue):null),u=t&&t<new Date;return{...d,todoType:"task",sortTime:t?t.getTime():0,isOverdue:u,priority:d.priority==="Hot"?1:2}});return l.push(...p),l.sort((d,t)=>d.todoType==="appointment"&&t.todoType!=="appointment"?-1:d.todoType!=="appointment"&&t.todoType==="appointment"?1:d.todoType==="appointment"&&t.todoType==="appointment"?d.sortTime-t.sortTime:d.isOverdue&&!t.isOverdue?-1:!d.isOverdue&&t.isOverdue?1:d.priority!==t.priority?d.priority-t.priority:d.sortTime-t.sortTime)}),C=L(()=>g.value.map(l=>({...l,time:new Date(l.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(l.start)})).sort((l,a)=>l.date.getTime()-a.date.getTime())),k=L(()=>S.value.filter(l=>{const a=l.dueDate||(l.nextActionDue?new Date(l.nextActionDue):null);if(!a)return!1;const p=new Date;p.setHours(0,0,0,0);const d=new Date(p);d.setDate(d.getDate()+1);const t=new Date(a);return t.setHours(0,0,0,0),t>=p&&t<d}).sort((l,a)=>{var s,u;const p=new Date,d=l.dueDate<p,t=a.dueDate<p;return d&&!t?-1:!d&&t?1:l.priority!==a.priority?(l.priority==="Hot"?1:2)-(a.priority==="Hot"?1:2):(((s=l.dueDate)==null?void 0:s.getTime())||0)-(((u=a.dueDate)==null?void 0:u.getTime())||0)})),R=L(()=>w.value);async function D(){Promise.all([v(),Ne().then(l=>{g.value=l,O.value=!1}),Promise.all([h.canAccessLeads()?Ce().then(l=>{n.value=l}):Promise.resolve(),h.canAccessOpportunities()?De().then(l=>{i.value=l}):Promise.resolve()]).then(()=>{N.value=!1}),Ie(1).then(l=>{b.value=l})]).catch(l=>{console.error("Error loading dashboard:",l),O.value=!1,N.value=!1})}return{notifications:R,totalNotificationsCount:f,appointmentsToday:C,tasksDueToday:k,prioritizedTodos:j,loadingNotifications:x,loadingAppointments:L(()=>O.value),loadingTasks:L(()=>N.value),loadDashboard:D}}const He={class:"flex items-center gap-2 mb-2"},Qe={class:"text-xs text-gray-500"},Ge={class:"text-xs text-gray-500"},ze={class:"ml-auto flex items-center gap-2"},Ee={key:1,class:"bg-white border border-gray-200 rounded-lg shadow-lg p-1.5 flex items-center gap-1.5 z-10"},Ye=["innerHTML"],Fe={class:"flex gap-2 flex-wrap justify-end mt-3"},We={__name:"ActionableQuestionCard",props:{question:{type:Object,required:!0}},emits:["answer-yes","answer-no","reassign","view-task","dismiss"],setup(h,{emit:w}){const f=h,x=w,v=A(!1),g=A(!1),n=X();Pe();const i=()=>{var p,d,t;const a=((p=f.question.opportunity)==null?void 0:p.assignee)||((d=f.question.lead)==null?void 0:d.assignee);return a?a===((t=n.currentUser)==null?void 0:t.name)?"me":a:"Unknown"},b=()=>{const a=f.question.customer.name,p=f.question.question,d=`<a href="#" class="font-bold text-primary-600 hover:text-primary-700 hover:underline" onclick="event.preventDefault()">${a}</a>`;return p.replace(new RegExp(a,"g"),d)},O=a=>a===1?"bg-red-50 text-red-600 border-red-100":a<=3?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100",N=a=>a===1?"CRITICAL":a<=3?"HIGH":"MEDIUM",S=()=>{if(!f.question.createdAt&&!f.question.appointmentDate)return"Just now";const a=new Date(f.question.createdAt||f.question.appointmentDate),d=new Date-a,t=Math.floor(d/6e4),s=Math.floor(t/60),u=Math.floor(s/24);return t<1?"Just now":t<60?`${t} min ago`:s<24?`${s} hours ago`:u===1?"1 day ago":u<7?`${u} days ago`:`${Math.floor(u/7)} weeks ago`},j=()=>x("answer-yes",f.question),C=()=>x("answer-no",f.question),k=()=>x("reassign",f.question),R=()=>x("view-task",f.question),D=a=>{a.target.tagName==="A"&&(a.preventDefault(),R())},l=()=>{g.value=!0,setTimeout(()=>{x("dismiss",f.question)},200)};return(a,p)=>(o(),r("div",{class:M(["bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all",g.value?"opacity-50":""])},[e("div",He,[e("span",{class:M(["text-xs font-bold px-2 py-0.5 rounded border whitespace-nowrap",O(h.question.priority)])},c(N(h.question.priority)),3),e("span",Qe,c(S()),1),e("span",Ge,"• Owner: "+c(i()),1),e("div",ze,[v.value?(o(),r("div",Ee,[p[3]||(p[3]=e("span",{class:"text-xs text-gray-600 whitespace-nowrap"},"Dismiss?",-1)),e("button",{onClick:l,class:"px-2 py-0.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded transition-colors"}," Yes "),e("button",{onClick:p[1]||(p[1]=d=>v.value=!1),class:"px-2 py-0.5 text-xs font-medium text-gray-600 hover:text-gray-800 transition-colors"}," No ")])):(o(),r("button",{key:0,onClick:p[0]||(p[0]=d=>v.value=!0),class:"w-7 h-7 flex items-center justify-center rounded text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"Dismiss"},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]))])]),e("div",{class:"mb-2",onClick:D},[e("p",{class:"text-gray-900 text-sm mb-1",innerHTML:b()},null,8,Ye)]),e("div",Fe,[h.question.type==="appointment-followup"?(o(),r($,{key:0},[e("button",{onClick:j,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:C,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No ")],64)):h.question.type==="ns-followup"?(o(),r($,{key:1},[e("button",{onClick:j,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:C,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:k,class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg transition-colors"}," Reassign ")],64)):h.question.type==="offer-followup"?(o(),r("button",{key:2,onClick:R,class:"px-3 py-1.5 text-xs font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors"}," View Opportunity ")):h.question.type==="stuck-opportunity"?(o(),r($,{key:3},[e("button",{onClick:j,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:C,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:k,class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg transition-colors"}," Reassign ")],64)):h.question.type==="lead-qualification-urgency"?(o(),r($,{key:4},[e("button",{onClick:j,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),e("button",{onClick:C,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),e("button",{onClick:k,class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg transition-colors"}," Reassign ")],64)):m("",!0)])],2))}},Je={class:"space-y-3"},Xe={key:0,class:"text-center py-8 text-gray-500"},Ze=["onClick"],Ke={class:"flex items-start justify-between gap-4"},et={class:"flex-1 min-w-0"},tt={class:"flex items-center gap-2 mb-1"},st={class:"font-semibold text-gray-900 text-sm mb-1"},ot={class:"text-xs text-gray-600 mb-2"},rt={key:0},nt={class:"flex items-center gap-2 text-xs text-gray-500"},it={key:0},lt={key:1},at=["onClick"],dt={__name:"TodaysAppointments",props:{appointments:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(h){const w=te(),f=g=>{const n=new Date,b=(new Date(g)-n)/(1e3*60*60);return b<0?"bg-red-100 text-red-700 border-red-200":b<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},x=g=>({confirmed:"bg-green-50 text-green-700 border-green-200",scheduled:"bg-blue-50 text-blue-700 border-blue-200",pending:"bg-yellow-50 text-yellow-700 border-yellow-200",cancelled:"bg-red-50 text-red-700 border-red-200","no-show":"bg-gray-50 text-gray-700 border-gray-200"})[g]||"bg-gray-50 text-gray-700 border-gray-200",v=g=>{g.opportunityId?w.push(`/tasks/${g.opportunityId}?type=opportunity`):g.leadId?w.push(`/tasks/${g.leadId}?type=lead`):w.push("/calendar")};return(g,n)=>(o(),r("div",Je,[h.loading?(o(),r($,{key:0},U(3,i=>e("div",{key:`skeleton-${i}`,class:"bg-white border border-gray-200 rounded-lg p-4"},[...n[0]||(n[0]=[se('<div class="flex items-start justify-between gap-4"><div class="flex-1 min-w-0 space-y-2"><div class="flex items-center gap-2"><div class="h-5 bg-gray-200 rounded w-16 animate-pulse"></div><div class="h-5 bg-gray-200 rounded w-20 animate-pulse"></div></div><div class="h-4 bg-gray-200 rounded w-32 animate-pulse"></div><div class="h-3 bg-gray-200 rounded w-24 animate-pulse"></div><div class="h-3 bg-gray-200 rounded w-20 animate-pulse"></div></div><div class="h-4 w-4 bg-gray-200 rounded animate-pulse"></div></div>',1)])])),64)):(o(),r($,{key:1},[h.appointments.length===0?(o(),r("div",Xe,[...n[1]||(n[1]=[e("i",{class:"fa-solid fa-calendar-check text-4xl mb-2 text-gray-300"},null,-1),e("p",{class:"text-sm"},"No appointments scheduled for today",-1)])])):m("",!0),(o(!0),r($,null,U(h.appointments,i=>(o(),r("div",{key:i.id,onClick:b=>v(i),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[e("div",Ke,[e("div",et,[e("div",tt,[e("span",{class:M(["text-xs font-bold px-2 py-0.5 rounded",f(i.date)])},c(i.time),3),e("span",{class:M(["text-xs font-medium px-2 py-0.5 rounded border",x(i.status)])},c(i.status),3)]),e("h4",st,c(i.customer||i.title),1),e("p",ot,[ee(c(i.type)+" ",1),i.vehicle?(o(),r("span",rt," - "+c(i.vehicle),1)):m("",!0)]),e("div",nt,[n[2]||(n[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),i.assigneeType==="team"?(o(),r("span",it,c(i.team)+" Team ",1)):(o(),r("span",lt,c(i.assignee||"Unassigned"),1))])]),e("button",{onClick:$e(b=>v(i),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,at)])],8,Ze))),128))],64))]))}},ut={class:"space-y-3"},ct={key:0,class:"text-center py-8 text-gray-500"},pt=["onClick"],gt={class:"flex items-start justify-between gap-4"},yt={class:"flex-1 min-w-0"},ft={class:"flex items-center gap-2 mb-1"},vt={key:0,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 flex items-center gap-1"},xt={key:1,class:"text-xs font-medium px-2 py-0.5 rounded bg-gray-50 text-gray-700 border border-gray-200"},mt={key:3,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-100 text-red-700 border border-red-200"},bt={class:"font-semibold text-gray-900 text-sm mb-1"},ht={class:"text-xs text-gray-600 mb-2"},_t={key:0},wt={class:"flex items-center gap-2 text-xs text-gray-500"},kt={key:0,class:"text-gray-500"},$t=["onClick"],Tt={__name:"TodaysTasks",props:{tasks:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(h){const w=te(),f=v=>{if(!v)return"bg-gray-100 text-gray-700 border-gray-200";const g=new Date,i=(new Date(v)-g)/(1e3*60*60);return i<0?"bg-red-100 text-red-700 border-red-200":i<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},x=v=>{w.push(`/tasks/${v.id}?type=${v.type}`)};return(v,g)=>(o(),r("div",ut,[h.loading?(o(),r($,{key:0},U(3,n=>e("div",{key:`skeleton-${n}`,class:"bg-white border border-gray-200 rounded-lg p-4"},[...g[0]||(g[0]=[se('<div class="flex items-start justify-between gap-4"><div class="flex-1 min-w-0 space-y-2"><div class="flex items-center gap-2"><div class="h-5 bg-gray-200 rounded w-16 animate-pulse"></div><div class="h-5 bg-gray-200 rounded w-20 animate-pulse"></div></div><div class="h-4 bg-gray-200 rounded w-32 animate-pulse"></div><div class="h-3 bg-gray-200 rounded w-24 animate-pulse"></div><div class="flex items-center gap-2"><div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div><div class="h-3 bg-gray-200 rounded w-20 animate-pulse"></div></div></div><div class="h-4 w-4 bg-gray-200 rounded animate-pulse"></div></div>',1)])])),64)):(o(),r($,{key:1},[h.tasks.length===0?(o(),r("div",ct,[...g[1]||(g[1]=[e("i",{class:"fa-solid fa-tasks text-4xl mb-2 text-gray-300"},null,-1),e("p",{class:"text-sm"},"No tasks due today",-1)])])):m("",!0),(o(!0),r($,null,U(h.tasks,n=>{var i;return o(),r("div",{key:`${n.type}-${n.id}`,onClick:b=>x(n),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[e("div",gt,[e("div",yt,[e("div",ft,[n.priority==="Hot"?(o(),r("span",vt,[...g[2]||(g[2]=[e("i",{class:"fa-solid fa-fire text-xs"},null,-1),ee(" HOT ",-1)])])):(o(),r("span",xt," Normal ")),n.dueTime?(o(),r("span",{key:2,class:M(["text-xs font-bold px-2 py-0.5 rounded",f(n.dueDate)])},c(n.dueTime),3)):m("",!0),n.isOverdue?(o(),r("span",mt," OVERDUE ")):m("",!0)]),e("h4",bt,c(((i=n.customer)==null?void 0:i.name)||"Unknown Customer"),1),e("p",ht,[ee(c(n.taskType)+" ",1),n.requestedCar||n.vehicle?(o(),r("span",_t," - "+c(n.requestedCar?`${n.requestedCar.brand} ${n.requestedCar.model}`:`${n.vehicle.brand} ${n.vehicle.model}`),1)):m("",!0)]),e("div",wt,[e("span",{class:M(["px-2 py-0.5 rounded border text-xs font-bold uppercase",n.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(n.type==="lead"?"Lead":"Opportunity"),3),n.stage||n.displayStage?(o(),r("span",kt,c(n.displayStage||n.stage),1)):m("",!0)])]),e("button",{onClick:$e(b=>x(n),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...g[3]||(g[3]=[e("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,$t)])],8,pt)}),128))],64))]))}},Ct={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow"},Dt={class:"p-4 md:p-5 border-b border-gray-200 bg-gray-50/50"},At={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0"},jt={class:"p-4 md:p-5"},Rt={key:0,class:"space-y-4"},Mt={key:1,class:"space-y-4"},St={class:"bg-white rounded-lg p-3 border border-gray-200"},Ot={class:"flex items-center justify-between mb-2"},Nt={class:"text-xs sm:text-sm text-gray-600"},It={class:"bg-white rounded-lg p-3 border border-gray-200"},Pt={class:"flex items-center justify-between mb-2"},Lt={class:"w-full bg-gray-200 rounded-full h-2 mt-2"},Ut={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Vt={class:"bg-white rounded-lg p-3 border border-gray-200"},Bt={class:"flex items-start justify-between gap-2"},qt={class:"flex-1"},Ht={class:"text-base font-bold text-gray-900 mb-1"},Qt={key:0,class:"h-12 w-16 flex-shrink-0"},Gt={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},zt=["d"],Et=["d"],Yt={class:"bg-white rounded-lg p-3 border border-gray-200"},Ft={class:"flex items-start justify-between gap-2"},Wt={class:"flex-1"},Jt={class:"text-base font-bold text-gray-900 mb-1"},Xt={key:0,class:"h-12 w-16 flex-shrink-0"},Zt={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},Kt=["d"],es=["d"],ts={key:2,class:"space-y-4"},ss={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},os={class:"bg-white rounded-lg p-3 border border-gray-200"},rs={class:"flex items-start justify-between gap-2"},ns={class:"flex-1"},is={class:"text-base font-bold text-gray-900 mb-1"},ls={key:0,class:"h-12 w-16 flex-shrink-0"},as={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},ds=["d"],us=["d"],cs={class:"bg-white rounded-lg p-3 border border-gray-200"},ps={class:"flex items-start justify-between gap-2"},gs={class:"flex-1"},ys={class:"text-base font-bold text-gray-900 mb-1"},fs={key:0,class:"h-12 w-16 flex-shrink-0"},vs={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},xs=["d"],ms=["d"],bs={class:"space-y-2"},hs={class:"flex items-center justify-between text-xs"},_s={class:"font-bold"},ws={class:"w-full bg-gray-200 rounded-full h-2"},ks={class:"flex items-center justify-between text-xs"},$s={class:"font-bold"},Ts={class:"w-full bg-gray-200 rounded-full h-2"},Cs={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Ds={class:"bg-white rounded-lg p-3 border border-gray-200"},As={class:"flex items-start justify-between gap-2"},js={class:"flex-1"},Rs={class:"text-base font-bold text-gray-900 mb-1"},Ms={key:0,class:"h-12 w-16 flex-shrink-0"},Ss={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},Os=["d"],Ns=["d"],Is={class:"bg-white rounded-lg p-3 border border-gray-200"},Ps={class:"flex items-start justify-between gap-2"},Ls={class:"flex-1"},Us={class:"text-base font-bold text-gray-900 mb-1"},Vs={key:0,class:"h-12 w-16 flex-shrink-0"},Bs={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},qs=["d"],Hs=["d"],Qs={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Gs={class:"bg-white rounded-lg p-3 border border-gray-200"},zs={class:"flex items-start justify-between gap-2"},Es={class:"flex-1"},Ys={class:"text-base font-bold text-gray-900 mb-1"},Fs={key:0,class:"h-12 w-16 flex-shrink-0"},Ws={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},Js=["d"],Xs=["d"],Zs={class:"bg-white rounded-lg p-3 border border-gray-200"},Ks={class:"flex items-start justify-between gap-2"},eo={class:"flex-1"},to={class:"text-base font-bold text-red-600 mb-1"},so={key:0,class:"h-12 w-16 flex-shrink-0"},oo={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},ro=["d"],no=["d"],io={key:3,class:"space-y-4"},lo={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"},ao={class:"flex items-center justify-between mb-2"},uo={class:"text-xs text-gray-500"},co={class:"flex items-start justify-between gap-2"},po={class:"flex-1"},go={class:"text-base font-bold text-gray-900 mb-1"},yo={class:"text-xs text-gray-600 leading-tight"},fo={key:0,class:"h-12 w-16 flex-shrink-0"},vo={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},xo=["id"],mo=["d","fill"],bo=["d","stroke"],ho={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},_o={class:"lg:col-span-2 bg-white rounded-lg p-4 md:p-5 border border-gray-200"},wo={class:"space-y-3"},ko={class:"flex items-center gap-3 mb-1"},$o={class:"text-xs font-medium text-gray-700 w-32 sm:w-40 flex-shrink-0"},To={class:"flex-1 relative"},Co={class:"w-full bg-gray-200 rounded-full h-6 overflow-hidden"},Do={class:"text-xs font-bold text-gray-900"},Ao={class:"text-xs font-bold text-gray-900 w-12 text-right flex-shrink-0"},jo={class:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200 flex flex-col items-center justify-center"},Ro={class:"relative w-24 h-24 sm:w-28 sm:h-28 mb-3"},Mo={class:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100"},So=["stroke-dasharray"],Oo={class:"absolute inset-0 flex items-center justify-center"},No={class:"text-center"},Io={class:"text-base font-bold text-green-700"},Po={class:"text-xs text-green-600 text-center"},Lo={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Uo={class:"flex items-center justify-between mb-2"},Vo={class:"text-xs text-gray-500"},Bo={class:"flex items-start justify-between gap-2"},qo={class:"flex-1"},Ho={class:"text-base font-bold text-gray-900 mb-1"},Qo={class:"text-xs text-gray-600 leading-tight"},Go={key:0,class:"h-12 w-16 flex-shrink-0"},zo={class:"w-full h-full overflow-visible",viewBox:"0 0 100 40",preserveAspectRatio:"none"},Eo=["id"],Yo=["d","fill"],Fo=["d","stroke"],Wo={key:4,class:"text-center py-8 text-gray-500"},Jo={__name:"PerformanceWidget",setup(h){const w=X(),f=L(()=>w.userRole()),x=L(()=>{var t;return(t=w.currentUser)==null?void 0:t.id}),v=A("month"),g=A(!0),n=A(null),i=A(null),b=A(null),O=L(()=>{var u;if(!((u=n.value)!=null&&u.slaCompliance))return 0;const{completed:t,total:s}=n.value.slaCompliance;return s>0?Math.round(t/s*100*10)/10:0}),N=(t=!1)=>{var u,T;const s=((T=(u=n.value)==null?void 0:u.tasksPerDay)==null?void 0:T.current)||0;return s>=40?t?"bg-green-600":"text-green-600":s>=20?t?"bg-yellow-600":"text-yellow-600":t?"bg-red-600":"text-red-600"},S=t=>{var T,I;if(!i.value)return 0;const s=((T=i.value.revenue)==null?void 0:T[t])||0,u=((I=i.value.revenueTargets)==null?void 0:I[t])||1;return Math.round(s/u*100)},j=t=>t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(0)+"k":t.toString(),C=t=>t>=1e3?(t/1e3).toFixed(1)+"k":t.toString(),k=t=>({red:"bg-red-300",orange:"bg-orange-300",blue:"bg-blue-300",gray:"bg-gray-300"})[t]||"bg-gray-300",R=t=>({red:"#ef4444",orange:"#f97316",blue:"#3b82f6",gray:"#6b7280"})[t]||"#6b7280",D=t=>{var s,u,T;return i.value?t==="contractsClosed"?((s=i.value.contractsClosed)==null?void 0:s[`${v.value}Trend`])||null:t==="revenue"?((u=i.value.revenue)==null?void 0:u[`${v.value}Trend`])||null:t==="newOpportunities"&&((T=i.value.newOpportunities)==null?void 0:T[`${v.value}Trend`])||null:null},l=t=>{if(!t||t.length===0)return"";const s=Math.max(...t),u=Math.min(...t),T=s-u||1,I=100,G=40,V=4,B=t.map((q,P)=>({x:P/(t.length-1)*(I-V*2)+V,y:G-V-(q-u)/T*(G-V*2)}));if(B.length<2)return"";let Y=`M ${B[0].x},${B[0].y}`;for(let q=0;q<B.length-1;q++){const P=B[q],H=B[q+1],W=P.x+(H.x-P.x)/2,J=P.x+(H.x-P.x)/2;Y+=` C ${W},${P.y} ${J},${H.y} ${H.x},${H.y}`}return Y},a=t=>{const s=l(t);if(!s)return"";const u=100,T=40,I=4,G=I,V=u-I;return`${s} L ${V},${T} L ${G},${T} Z`},p=t=>t>=20?"Excellent performance":t>=15?"Good performance":t>=10?"Average performance":"Needs improvement",d=async()=>{g.value=!0;try{f.value==="operator"?n.value=await Ue(x.value,v.value):f.value==="salesman"?i.value=await Ve(x.value,v.value):f.value==="manager"&&(b.value=await Be(v.value))}catch(t){console.error("Error loading performance metrics:",t)}finally{g.value=!1}};return Ae([x,f],()=>{d()},{immediate:!1}),Te(()=>{d()}),(t,s)=>{var u,T,I,G,V,B,Y,q,P,H,W,J,oe,re,ne,ie,le,ae,de,ue,ce,pe,ge,ye,fe,ve,xe,me,be,he,_e,we;return o(),r("div",Ct,[e("div",Dt,[e("div",At,[s[2]||(s[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-chart-line text-gray-400 text-sm"}),e("h2",{class:"heading-sub"},"Performance")],-1)),je(e("select",{"onUpdate:modelValue":s[0]||(s[0]=y=>v.value=y),onChange:d,class:"input text-xs w-full sm:w-auto"},[...s[1]||(s[1]=[e("option",{value:"month"},"Month",-1),e("option",{value:"quarter"},"Quarter",-1),e("option",{value:"year"},"Year",-1)])],544),[[Re,v.value]])])]),e("div",jt,[g.value?(o(),r("div",Rt,[(o(),r($,null,U(4,y=>e("div",{key:`skeleton-${y}`,class:"h-16 bg-gray-100 rounded animate-pulse"})),64))])):f.value==="operator"?(o(),r("div",Mt,[e("div",St,[e("div",Ot,[s[3]||(s[3]=e("span",{class:"text-xs font-medium text-gray-700"},"SLA Compliance",-1)),e("span",{class:M(["text-xs font-bold",O.value>=90?"text-green-600":"text-yellow-600"])},c(O.value)+"% ",3)]),e("div",Nt,c(((T=(u=n.value)==null?void 0:u.slaCompliance)==null?void 0:T.withinSLA)||0)+" / "+c(((G=(I=n.value)==null?void 0:I.slaCompliance)==null?void 0:G.total)||0)+" tasks completed within SLA ",1)]),e("div",It,[e("div",Pt,[s[4]||(s[4]=e("span",{class:"text-xs font-medium text-gray-700"},"Tasks Per Day",-1)),e("span",{class:M(["text-xs font-bold",N()])},c(((B=(V=n.value)==null?void 0:V.tasksPerDay)==null?void 0:B.current)||0)+" / "+c(((q=(Y=n.value)==null?void 0:Y.tasksPerDay)==null?void 0:q.target)||0),3)]),e("div",Lt,[e("div",{class:M(["h-2 rounded-full transition-all",N(!0)]),style:Q({width:`${Math.min((((H=(P=n.value)==null?void 0:P.tasksPerDay)==null?void 0:H.current)||0)/50*100,100)}%`})},null,6)]),s[5]||(s[5]=e("div",{class:"text-xs text-gray-500 mt-1"},"Target: 20-50 tasks/day",-1))]),e("div",Ut,[e("div",Vt,[e("div",Bt,[e("div",qt,[s[6]||(s[6]=e("div",{class:"text-xs text-gray-500 mb-1"},"Appointments Reserved",-1)),e("div",Ht,c(((W=n.value)==null?void 0:W.appointmentsReserved)||0),1)]),(J=n.value)!=null&&J.appointmentsReservedTrend?(o(),r("div",Qt,[(o(),r("svg",Gt,[s[7]||(s[7]=e("defs",null,[e("linearGradient",{id:"gradient-appointments",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#3b82f6","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#3b82f6","stop-opacity":"0"}})])],-1)),e("path",{d:a(n.value.appointmentsReservedTrend),fill:"url(#gradient-appointments)",class:"transition-all duration-700"},null,8,zt),e("path",{d:l(n.value.appointmentsReservedTrend),stroke:"#3b82f6","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,Et)]))])):m("",!0)])]),e("div",Yt,[e("div",Ft,[e("div",Wt,[s[8]||(s[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Lead-to-Opportunity Rate",-1)),e("div",Jt,c(((oe=n.value)==null?void 0:oe.leadToOpportunityConversion)||0)+"%",1)]),(re=n.value)!=null&&re.leadToOpportunityConversionTrend?(o(),r("div",Xt,[(o(),r("svg",Zt,[s[9]||(s[9]=e("defs",null,[e("linearGradient",{id:"gradient-lead-opp",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#10b981","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#10b981","stop-opacity":"0"}})])],-1)),e("path",{d:a(n.value.leadToOpportunityConversionTrend),fill:"url(#gradient-lead-opp)",class:"transition-all duration-700"},null,8,Kt),e("path",{d:l(n.value.leadToOpportunityConversionTrend),stroke:"#10b981","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,es)]))])):m("",!0)])])])])):f.value==="salesman"?(o(),r("div",ts,[e("div",ss,[e("div",os,[e("div",rs,[e("div",ns,[s[10]||(s[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Contracts Closed",-1)),e("div",is,c(((ie=(ne=i.value)==null?void 0:ne.contractsClosed)==null?void 0:ie[v.value])||0),1)]),D("contractsClosed")?(o(),r("div",ls,[(o(),r("svg",as,[s[11]||(s[11]=e("defs",null,[e("linearGradient",{id:"gradient-contracts",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#10b981","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#10b981","stop-opacity":"0"}})])],-1)),e("path",{d:a(D("contractsClosed")),fill:"url(#gradient-contracts)",class:"transition-all duration-700"},null,8,ds),e("path",{d:l(D("contractsClosed")),stroke:"#10b981","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,us)]))])):m("",!0)])]),e("div",cs,[e("div",ps,[e("div",gs,[s[12]||(s[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"Revenue",-1)),e("div",ys,"€"+c(j(((ae=(le=i.value)==null?void 0:le.revenue)==null?void 0:ae[v.value])||0)),1)]),D("revenue")?(o(),r("div",fs,[(o(),r("svg",vs,[s[13]||(s[13]=e("defs",null,[e("linearGradient",{id:"gradient-revenue",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#3b82f6","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#3b82f6","stop-opacity":"0"}})])],-1)),e("path",{d:a(D("revenue")),fill:"url(#gradient-revenue)",class:"transition-all duration-700"},null,8,xs),e("path",{d:l(D("revenue")),stroke:"#3b82f6","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,ms)]))])):m("",!0)])])]),e("div",bs,[e("div",hs,[s[14]||(s[14]=e("span",{class:"text-gray-700"},"Monthly Target",-1)),e("span",_s,c(S("month"))+"%",1)]),e("div",ws,[e("div",{class:"h-2 rounded-full bg-blue-600 transition-all",style:Q({width:`${Math.min(S("month"),100)}%`})},null,4)]),e("div",ks,[s[15]||(s[15]=e("span",{class:"text-gray-700"},"Quarterly Target",-1)),e("span",$s,c(S("quarter"))+"%",1)]),e("div",Ts,[e("div",{class:"h-2 rounded-full bg-blue-600 transition-all",style:Q({width:`${Math.min(S("quarter"),100)}%`})},null,4)])]),e("div",Cs,[e("div",Ds,[e("div",As,[e("div",js,[s[16]||(s[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Pipeline Value",-1)),e("div",Rs,"€"+c(j(((de=i.value)==null?void 0:de.pipelineValue)||0)),1)]),(ue=i.value)!=null&&ue.pipelineValueTrend?(o(),r("div",Ms,[(o(),r("svg",Ss,[s[17]||(s[17]=e("defs",null,[e("linearGradient",{id:"gradient-pipeline",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#3b82f6","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#3b82f6","stop-opacity":"0"}})])],-1)),e("path",{d:a(i.value.pipelineValueTrend),fill:"url(#gradient-pipeline)",class:"transition-all duration-700"},null,8,Os),e("path",{d:l(i.value.pipelineValueTrend),stroke:"#3b82f6","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,Ns)]))])):m("",!0)])]),e("div",Is,[e("div",Ps,[e("div",Ls,[s[18]||(s[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Win Rate",-1)),e("div",Us,c(((ce=i.value)==null?void 0:ce.winRate)||0)+"%",1)]),(pe=i.value)!=null&&pe.winRateTrend?(o(),r("div",Vs,[(o(),r("svg",Bs,[s[19]||(s[19]=e("defs",null,[e("linearGradient",{id:"gradient-winrate",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#10b981","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#10b981","stop-opacity":"0"}})])],-1)),e("path",{d:a(i.value.winRateTrend),fill:"url(#gradient-winrate)",class:"transition-all duration-700"},null,8,qs),e("path",{d:l(i.value.winRateTrend),stroke:"#10b981","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,Hs)]))])):m("",!0)])])]),e("div",Qs,[e("div",Gs,[e("div",zs,[e("div",Es,[s[20]||(s[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"New Opportunities",-1)),e("div",Ys,c(((ye=(ge=i.value)==null?void 0:ge.newOpportunities)==null?void 0:ye[v.value])||0),1)]),D("newOpportunities")?(o(),r("div",Fs,[(o(),r("svg",Ws,[s[21]||(s[21]=e("defs",null,[e("linearGradient",{id:"gradient-new-opp",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#10b981","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#10b981","stop-opacity":"0"}})])],-1)),e("path",{d:a(D("newOpportunities")),fill:"url(#gradient-new-opp)",class:"transition-all duration-700"},null,8,Js),e("path",{d:l(D("newOpportunities")),stroke:"#10b981","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,Xs)]))])):m("",!0)])]),e("div",Zs,[e("div",Ks,[e("div",eo,[s[22]||(s[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dormant Opportunities",-1)),e("div",to,c(((fe=i.value)==null?void 0:fe.dormantOpportunities)||0),1)]),(ve=i.value)!=null&&ve.dormantOpportunitiesTrend?(o(),r("div",so,[(o(),r("svg",oo,[s[23]||(s[23]=e("defs",null,[e("linearGradient",{id:"gradient-dormant",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#ef4444","stop-opacity":"0.2"}}),e("stop",{offset:"100%",style:{"stop-color":"#ef4444","stop-opacity":"0"}})])],-1)),e("path",{d:a(i.value.dormantOpportunitiesTrend),fill:"url(#gradient-dormant)",class:"transition-all duration-700"},null,8,ro),e("path",{d:l(i.value.dormantOpportunitiesTrend),stroke:"#ef4444","stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,no)]))])):m("",!0)])])])])):f.value==="manager"?(o(),r("div",io,[e("div",lo,[(o(!0),r($,null,U((((xe=b.value)==null?void 0:xe.stages)||[]).slice(0,4),(y,z)=>(o(),r("div",{key:y.name,class:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow"},[e("div",ao,[e("div",{class:M(["w-2 h-2 rounded-full",k(y.color)])},null,2),e("span",uo,c(y.percentage)+"%",1)]),e("div",co,[e("div",po,[e("div",go,c(C(y.count)),1),e("div",yo,c(y.name),1)]),y.trend?(o(),r("div",fo,[(o(),r("svg",vo,[e("defs",null,[e("linearGradient",{id:`gradient-stage-${z}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:Q(`stop-color:${R(y.color)};stop-opacity:0.2`)},null,4),e("stop",{offset:"100%",style:Q(`stop-color:${R(y.color)};stop-opacity:0`)},null,4)],8,xo)]),e("path",{d:a(y.trend),fill:`url(#gradient-stage-${z})`,class:"transition-all duration-700"},null,8,mo),e("path",{d:l(y.trend),stroke:R(y.color),"stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,bo)]))])):m("",!0)])]))),128))]),e("div",ho,[e("div",_o,[s[24]||(s[24]=e("h3",{class:"text-sm font-bold text-gray-900 mb-4"},"Sales Funnel",-1)),e("div",wo,[(o(!0),r($,null,U(((me=b.value)==null?void 0:me.stages)||[],(y,z)=>(o(),r("div",{key:y.name,class:"relative"},[e("div",ko,[e("span",$o,c(y.name),1),e("div",To,[e("div",Co,[e("div",{class:M(["h-full rounded-full transition-all duration-700 flex items-center justify-end pr-2",k(y.color)]),style:Q({width:`${y.percentage}%`,minWidth:"2px"})},[e("span",Do,c(C(y.count)),1)],6)])]),e("span",Ao,c(y.percentage)+"%",1)])]))),128))])]),e("div",jo,[e("div",Ro,[(o(),r("svg",Mo,[s[25]||(s[25]=e("circle",{cx:"50",cy:"50",r:"42",fill:"none",stroke:"#d1fae5","stroke-width":"8"},null,-1)),e("circle",{cx:"50",cy:"50",r:"42",fill:"none",stroke:"#10b981","stroke-width":"8","stroke-dasharray":`${(((be=b.value)==null?void 0:be.conversionRate)||0)*2.64} 265`,"stroke-linecap":"round",class:"transition-all duration-700"},null,8,So)])),e("div",Oo,[e("div",No,[e("div",Io,c(((he=b.value)==null?void 0:he.conversionRate)||0)+"% ",1)])])]),s[26]||(s[26]=e("div",{class:"text-sm font-bold text-green-800 mb-1"},"Conversion Rate",-1)),e("div",Po,c(p(((_e=b.value)==null?void 0:_e.conversionRate)||0)),1)])]),e("div",Lo,[(o(!0),r($,null,U((((we=b.value)==null?void 0:we.stages)||[]).slice(4),(y,z)=>(o(),r("div",{key:y.name,class:"bg-white rounded-lg p-4 border border-gray-200"},[e("div",Uo,[e("div",{class:M(["w-2 h-2 rounded-full",k(y.color)])},null,2),e("span",Vo,c(y.percentage)+"%",1)]),e("div",Bo,[e("div",qo,[e("div",Ho,c(C(y.count)),1),e("div",Qo,c(y.name),1)]),y.trend?(o(),r("div",Go,[(o(),r("svg",zo,[e("defs",null,[e("linearGradient",{id:`gradient-stage-${z+4}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%",style:Q(`stop-color:${R(y.color)};stop-opacity:0.2`)},null,4),e("stop",{offset:"100%",style:Q(`stop-color:${R(y.color)};stop-opacity:0`)},null,4)],8,Eo)]),e("path",{d:a(y.trend),fill:`url(#gradient-stage-${z+4})`,class:"transition-all duration-700"},null,8,Yo),e("path",{d:l(y.trend),stroke:R(y.color),"stroke-width":"2.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"transition-all duration-700"},null,8,Fo)]))])):m("",!0)])]))),128))])])):(o(),r("div",Wo,[...s[27]||(s[27]=[e("i",{class:"fa-solid fa-chart-line text-4xl mb-2 text-gray-300"},null,-1),e("p",{class:"text-sm"},"Performance metrics not available",-1),e("p",{class:"text-xs text-gray-400 mt-1"},"Contact your administrator",-1)])]))])])}}},Xo={class:"page-container"},Zo={class:"p-4 md:p-6 lg:p-8"},Ko={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 items-start"},er={class:"lg:col-span-2 space-y-4 md:space-y-6"},tr={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow"},sr={class:"p-4 border-b border-gray-200 bg-gray-50/50"},or={class:"flex items-center justify-between"},rr={class:"flex items-center gap-2"},nr={class:"p-4"},ir={class:"space-y-4 md:space-y-6"},lr={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow"},ar={class:"p-4 border-b border-gray-200 bg-gray-50/50"},dr={class:"flex items-center justify-between"},ur={class:"flex items-center gap-2"},cr={class:"p-4 space-y-3"},pr={key:0,class:"text-center py-8 text-gray-500"},gr={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow"},yr={class:"p-4 border-b border-gray-200 bg-gray-50/50"},fr={class:"flex items-center justify-between"},vr={class:"flex items-center gap-2"},xr={class:"p-4"},$r={__name:"Home",setup(h){const w=te(),f=X(),{dismissQuestion:x,addFollowUpQuestion:v}=ke(),{notifications:g,totalNotificationsCount:n,appointmentsToday:i,tasksDueToday:b,loadingNotifications:O,loadingAppointments:N,loadingTasks:S,loadDashboard:j}=qe(),C=A(!1),k=A(null);Te(async()=>{await j()});const R=async t=>{t.type==="appointment-followup"?(x(t.id),v({id:`offer-followup-${t.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${t.customer.name}?`,customer:t.customer,opportunityId:t.opportunityId,opportunity:t.opportunity,createdAt:new Date().toISOString()})):(t.type==="ns-followup"||t.type==="stuck-opportunity"||t.type==="lead-qualification-urgency")&&x(t.id)},D=async t=>{var s;if(t.type==="appointment-followup")try{const u=(s=f.currentUser)==null?void 0:s.id;u&&(await Oe(t.opportunityId,u),x(t.id),await j())}catch(u){console.error("Error creating NS task:",u)}else t.type==="ns-followup"?x(t.id):t.type==="stuck-opportunity"?w.push(`/tasks/${t.opportunityId}?type=opportunity`):t.type==="lead-qualification-urgency"&&w.push(`/tasks/${t.leadId}?type=lead`)},l=t=>{k.value=t,C.value=!0},a=async t=>{if(k.value)try{const s=k.value.opportunityId||k.value.leadId;k.value.opportunityId&&await Me(s,t),x(k.value.id),C.value=!1,k.value=null,await j()}catch(s){console.error("Error reassigning:",s)}},p=t=>{t.opportunityId?w.push(`/tasks/${t.opportunityId}?type=opportunity`):t.leadId&&w.push(`/tasks/${t.leadId}?type=lead`)},d=t=>{f.currentUser&&Se(t.id,f.currentUser.id),x(t.id)};return(t,s)=>(o(),r("div",Xo,[e("div",Zo,[e("div",Ko,[e("div",er,[E(Jo),e("div",tr,[e("div",sr,[e("div",or,[e("div",rr,[s[4]||(s[4]=e("i",{class:"fa-solid fa-tasks text-gray-400 text-sm"},null,-1)),s[5]||(s[5]=e("h2",{class:"heading-sub"},"Tasks Due Today",-1)),_(b).length>0?(o(),F(_(Z),{key:0,text:String(_(b).length),size:"small",theme:"red"},null,8,["text"])):m("",!0)]),E(_(K),{label:"View all tasks →",variant:"ghost",size:"small",onClick:s[0]||(s[0]=u=>t.$router.push("/tasks")),class:"text-xs"})])]),e("div",nr,[E(Tt,{tasks:_(b),loading:_(S)},null,8,["tasks","loading"])])])]),e("div",ir,[e("div",lr,[e("div",ar,[e("div",dr,[e("div",ur,[s[6]||(s[6]=e("i",{class:"fa-solid fa-bolt text-gray-400 text-sm"},null,-1)),s[7]||(s[7]=e("h2",{class:"heading-sub"},"Quick Actions",-1)),_(n)>0?(o(),F(_(Z),{key:0,text:String(_(n)),size:"small",theme:"blue"},null,8,["text"])):m("",!0)]),_(n)>5?(o(),F(_(K),{key:0,label:"View all →",variant:"ghost",size:"small",onClick:s[1]||(s[1]=u=>t.$router.push("/tasks")),class:"text-xs"})):m("",!0)])]),e("div",cr,[_(O)?(o(),r($,{key:0},U(3,u=>e("div",{key:`skeleton-${u}`,class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},[...s[8]||(s[8]=[se('<div class="space-y-2"><div class="h-4 bg-gray-200 rounded w-3/4 animate-pulse"></div><div class="h-3 bg-gray-200 rounded w-1/2 animate-pulse"></div><div class="flex gap-2 mt-3"><div class="h-8 bg-gray-200 rounded flex-1 animate-pulse"></div><div class="h-8 bg-gray-200 rounded flex-1 animate-pulse"></div></div></div>',1)])])),64)):(o(),r($,{key:1},[_(g).length===0?(o(),r("div",pr,[...s[9]||(s[9]=[e("i",{class:"fa-solid fa-check-circle text-4xl mb-2 text-gray-300"},null,-1),e("p",{class:"text-sm"},"All caught up!",-1),e("p",{class:"text-xs text-gray-400 mt-1"},"No quick actions needed",-1)])])):m("",!0),(o(!0),r($,null,U(_(g).slice(0,5),u=>(o(),F(We,{key:u.id,question:u,onAnswerYes:R,onAnswerNo:D,onReassign:l,onViewTask:p,onDismiss:d},null,8,["question"]))),128))],64))])]),e("div",gr,[e("div",yr,[e("div",fr,[e("div",vr,[s[10]||(s[10]=e("i",{class:"fa-solid fa-calendar text-gray-400 text-sm"},null,-1)),s[11]||(s[11]=e("h2",{class:"heading-sub"},"Appointments Today",-1)),_(i).length>0?(o(),F(_(Z),{key:0,text:String(_(i).length),size:"small",theme:"blue"},null,8,["text"])):m("",!0)]),E(_(K),{label:"View calendar →",variant:"ghost",size:"small",onClick:s[2]||(s[2]=u=>t.$router.push("/calendar")),class:"text-xs"})])]),e("div",xr,[E(dt,{appointments:_(i),loading:_(N)},null,8,["appointments","loading"])])])])])]),E(Le,{show:C.value,onClose:s[3]||(s[3]=u=>C.value=!1),onConfirm:a},null,8,["show"])]))}};export{$r as default};
