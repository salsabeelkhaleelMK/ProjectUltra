import{H as ie,V as oe,a3 as je,h as _e,C as We,c as B,d as k,o as b,e,x as z,g as L,B as r,s as l,y as t,n as j,t as A,F as H,i as Z,K as Ne,r as U,L as He,w as Ce,p as pe,T as Qe,k as p,m as be,l as ne,N as Ve,ae as Ye,D as Ge,u as Ke,a2 as Ze,I as ge,af as Je,ag as Xe,ah as et,ai as tt,P as fe}from"./index-BSxt259F.js";import{u as lt}from"./opportunities-C7VMVq_4.js";import{n as F,$ as st,f as J,F as X,L as ee,g as te,h as le,Q as $,o as de,C as ye,d as se,W as Q,U as Y,H as G,j as q,G as K,c as O,p as ae,z as ot}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{S as at}from"./sparkles-ByigpcXa.js";import{f as nt,u as rt}from"./vehicles-sZbJG44U.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=ie("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=ie("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ie("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ie("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ie("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=ie("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=ie("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=ie("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function vn(s){if(!s)return"";const i=new Date(s),a=new Date;if(i<a)return"OVERDUE";if(i.toDateString()===a.toDateString()){const f=i-a,v=Math.floor(f/(1e3*60*60)),x=Math.floor(f%(1e3*60*60)/(1e3*60));return v>0?`${v}h ${x}m`:`${x}m`}return i.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function gn(s){return(typeof s=="string"?new Date(s):s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function yn(s){return(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Fe(s){return(s==null?void 0:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function bn(s){if(!s)return"No deadline";const i=new Date(s);if(i<new Date)return"OVERDUE";const o=i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${o}, ${f}`}function hn(s){if(!s)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const i=new Date(s),a=new Date,o=(i-a)/(1e3*60*60);if(o<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(o<2){const f=Math.floor((i-a)/6e4),v=Math.floor(f/60),x=f%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:v>0?`${v}h ${x}m`:`${x}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(o<24){const f=Math.floor(o),v=Math.floor((o-f)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${f}h ${v}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const f=Math.ceil(o/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${f} day${f!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function xn(s){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700"}const he={[oe.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[oe.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:s=>!!(s.callbackDate||s.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[oe.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[oe.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[oe.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[oe.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Re={toClosed:(s,i,a)=>{const o={isDisqualified:!0,disqualifyReason:(a==null?void 0:a.reason)||null,disqualifyCategory:(a==null?void 0:a.category)||null,scheduledAppointment:null,nextActionDue:null};(a==null?void 0:a.reason)==="Duplicate"?(o.isDuplicate=!0,o.stage="Closed Failed"):(a==null?void 0:a.category)==="Not Interested"?o.stage="Not Interested":o.stage="Not Valid",o.status="Disqualified";const f=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(a==null?void 0:a.category)||"Unknown"}, Reason: ${(a==null?void 0:a.reason)||"Unknown"}`}];return s.scheduledAppointment&&f.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:s.scheduledAppointment}}),{updates:o,activities:f}},reopen:s=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function wn(s,i){return i.startsWith("Closed")?Re.toClosed:s.startsWith("Closed")&&!i.startsWith("Closed")?Re.reopen:null}const Te={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:s=>s.scheduledAppointment&&s.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:i=>{const a=new Date(i.scheduledAppointment.start);return`Appointment scheduled for ${i.formatDateTime?i.formatDateTime(i.scheduledAppointment.start):a.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"view-or-schedule-appointment",title:s=>s.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:s=>s.scheduledAppointment&&s.scheduledAppointment.start?`Scheduled for ${s.formatDateTime?s.formatDateTime(s.scheduledAppointment.start):new Date(s.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:s=>s.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:s=>{var a;return((a=s.opportunity)==null?void 0:a.negotiationSubstatus)==="Offer Feedback"?{key:"request-feedback",title:"Request Offer Feedback",description:"Get customer response on pending offer(s) and push forward",label:"Request Feedback",icon:"fa-solid fa-comments",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}:{key:"follow-up-offer",title:"Follow Up on Offer",description:s.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:s.hasOffers?"Follow Up":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}},secondaryActions:[{key:"mark-offer-accepted",label:"Mark Offer Accepted",icon:"fa-solid fa-check-circle",description:"Mark an offer as accepted and move to In Negotiation - Contract Pending",conditional:"has-offers"},{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"In Negotiation - Contract Pending":{primaryAction:{key:"finalize-contract",title:"Collect e-signatures, finalize contract",description:"Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs.",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"add-offer",label:"Add offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create additional offers if terms need adjustment"},{key:"extend-deadline",label:"Extend deadline",icon:"fa-solid fa-clock",description:"Give customer more time to review/sign"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"End negotiation if customer changes mind"},{key:"schedule-appointment",label:"Schedule appointment",icon:"fa-solid fa-calendar-plus",description:"Book delivery or signing meeting"}],taskWidgets:[]},"Closed Won":{primaryAction:s=>{const i=s.deliverySubstatus;return i==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:i==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-feedback-required"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ie={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},gt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},yt={class:"flex items-center justify-between gap-2 mb-4"},bt={class:"flex flex-col"},ht={class:"space-y-3"},xt={class:"flex items-start justify-between gap-2"},wt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},kt={class:"flex items-start justify-between gap-2"},Ct={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Vt={class:"flex items-center justify-between gap-2"},St={class:"flex items-center gap-1 min-w-0 flex-1 justify-end"},$t={class:"text-sm font-medium text-foreground leading-5 text-right truncate min-w-0"},It={key:0,class:"flex items-start justify-between gap-2"},Tt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},At={key:0,class:"mt-4 pt-4 border-t border-border"},Mt={class:"space-y-0.5"},Dt=["onClick"],Pt={class:"text-sm font-medium text-foreground truncate shrink-0 min-w-0"},Lt={class:"text-sm text-muted-foreground truncate flex-1 min-w-0"},Ot={key:0,class:"text-sm font-bold text-foreground shrink-0"},Ut={class:"text-sm text-muted-foreground shrink-0"},kn={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(s){const i=s,a=je(),o=_e(),f=We(),v=lt();B(()=>i.task.negotiations||i.task.activeNegotiations||0);const x=B(()=>{if(!i.task.customer)return[];const T=i.task.customer.email,d=i.task.customer.phone,N=i.task.compositeId;return[...(f.leads||[]).map(E=>({...E,type:"lead",compositeId:`lead-${E.id}`})),...(v.opportunities||[]).map(E=>({...E,type:"opportunity",compositeId:`opportunity-${E.id}`}))].filter(E=>E.compositeId===N||!E.customer?!1:E.customer.email===T||E.customer.phone===d).sort((E,I)=>new Date(I.createdAt||0)-new Date(E.createdAt||0)).slice(0,3)}),c=async(T,d)=>{if(T)try{await navigator.clipboard.writeText(T),a.pushToast("success",`${d==="email"?"Email":"Phone"} copied!`)}catch{a.pushToast("error","Failed to copy")}},V=()=>{var d;const T=((d=i.task.customer)==null?void 0:d.id)||i.customerId;if(T){const N=o.resolve(`/customer/${T}`).href;window.open(N,"_blank")}},D=T=>{const[d,N]=T.compositeId.split("-");o.push({path:`/tasks/${N}`,query:{type:d}})},m=T=>T.stage||T.currentStage||"Unknown",C=T=>{const d=T.createdAt||T.nextActionDue||T.updatedAt;if(!d)return"";try{return new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},u=T=>{const d=T.requestedCar||T.vehicle;if(!d)return"No vehicle";const N=d.brand||"",W=d.model||"",E=d.year?`(${d.year})`:"";return`${N} ${W} ${E}`.trim()||"Vehicle info N/A"},w=T=>T?T>=1e3?"€"+(T/1e3).toFixed(0)+"k":"€"+T:"€0";return(T,d)=>{var N,W,E,I,g,P;return b(),k("div",gt,[e("div",yt,[d[1]||(d[1]=e("h3",{class:"text-base font-medium text-foreground leading-6"},"Customer information",-1)),(N=s.task.customer)!=null&&N.id?(b(),z(t(F),{key:0,variant:"ghost",size:"icon",onClick:V,class:j("h-7 w-7"),title:"Open customer profile in new tab"},{default:r(()=>[l(t(ut),{size:14,class:"text-muted-foreground"})]),_:1})):L("",!0)]),e("div",bt,[e("div",ht,[e("div",xt,[d[2]||(d[2]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Customer",-1)),e("p",wt,A(((W=s.task.customer)==null?void 0:W.name)||"Unknown"),1)]),e("div",kt,[d[3]||(d[3]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Email",-1)),e("p",Ct,A(((E=s.task.customer)==null?void 0:E.email)||"N/A"),1)]),e("div",Vt,[d[4]||(d[4]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Phone",-1)),e("div",St,[e("p",$t,A(((I=s.task.customer)==null?void 0:I.phone)||"N/A"),1),(g=s.task.customer)!=null&&g.phone?(b(),z(t(F),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 shrink-0 text-muted-foreground hover:text-foreground",title:"Copy phone number",onClick:d[0]||(d[0]=h=>c(s.task.customer.phone,"phone"))},{default:r(()=>[l(t(it),{size:14})]),_:1})):L("",!0)])]),(P=s.task.customer)!=null&&P.address?(b(),k("div",It,[d[5]||(d[5]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Address",-1)),e("p",Tt,A(s.task.customer.address),1)])):L("",!0)]),x.value.length>0?(b(),k("div",At,[d[6]||(d[6]=e("h3",{class:"text-base font-medium text-foreground mb-4 leading-6"},"Other customer requests",-1)),e("div",Mt,[(b(!0),k(H,null,Z(x.value,h=>(b(),k("div",{key:h.compositeId,onClick:y=>D(h),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:j(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",h.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},A(h.type==="lead"?"Lead":"Opp"),3),e("span",Pt,A(m(h)),1),e("span",Lt,A(u(h)),1),h.type==="opportunity"&&h.estimatedValue?(b(),k("span",Ot,A(w(h.estimatedValue)),1)):L("",!0),e("span",Ut,A(C(h)),1)],8,Dt))),128))])])):L("",!0)])])}}},Ft={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},Rt={class:"mb-4"},qt={class:"flex items-center justify-between mb-2"},Nt={class:"flex items-center gap-2 flex-wrap"},Et={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},Bt={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},zt={class:"relative"},jt={class:"space-y-6 flex-1 flex flex-col min-h-0"},_t={key:0,class:"flex-1 overflow-y-auto min-h-0"},Wt={class:"flex flex-col items-start gap-1 mb-4"},Ht={class:"text-sm font-normal text-muted-foreground leading-normal"},Qt={class:"space-y-4"},Yt=["onClick"],Gt={class:"flex-1 min-w-0"},Kt={class:"flex items-start justify-between gap-2"},Zt={class:"text-sm text-foreground flex-1 wrap-break-word min-w-0 leading-normal"},Jt={key:0,class:"text-muted-foreground"},Xt={key:1,class:"text-muted-foreground"},el={key:2,class:"text-muted-foreground"},tl={key:3,class:"text-muted-foreground"},ll={key:4,class:"text-muted-foreground"},sl={key:5,class:"text-muted-foreground"},ol={key:6,class:"text-muted-foreground"},al={class:"text-sm text-muted-foreground text-right shrink-0 w-14 leading-normal"},nl={key:0,class:"mt-2 bg-amber-50 rounded-lg p-4 backdrop-blur-sm"},rl={class:"text-sm text-foreground wrap-break-word leading-normal"},dl={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},il={class:"text-sm text-foreground wrap-break-word leading-normal"},ul={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},cl={class:"text-sm text-foreground wrap-break-word leading-normal"},ml={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},fl={class:"text-sm text-foreground wrap-break-word leading-normal"},pl={key:0,class:"flex items-center gap-2 flex-wrap"},vl={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},gl={class:"text-center"},yl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(s,{emit:i}){const a=s,o=i,f=U(!1),v=U(!1),x=U(null),c=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],V=U([]),D=()=>{v.value=!v.value},m=I=>{v.value=!1;const g=V.value.indexOf(I);g>-1?V.value.splice(g,1):V.value.push(I)},C=I=>{const g=V.value.indexOf(I);g>-1&&V.value.splice(g,1)},u=I=>{const g=c.find(P=>P.value===I);return g?g.label:I},w=B(()=>c.map(I=>({key:I.value,label:I.label,onClick:()=>m(I.value),className:V.value.includes(I.value)?"filter-item-selected":""}))),T=I=>I.important||I.isImportant?"important":["email","sms","whatsapp","call"].includes(I.type)?"communications":I.type==="note"?"notes":I.type==="transcription"||I.transcription?"transcriptions":I.type==="system"||I.type==="created"||I.type==="status"?"system-updates":null,d=B(()=>{let I=[...a.activities];return V.value.length>0&&(I=I.filter(g=>{const P=T(g);return P&&V.value.includes(P)})),I.sort((g,P)=>{const h=new Date(g.timestamp||g.createdAt||0).getTime();return new Date(P.timestamp||P.createdAt||0).getTime()-h})}),N=I=>{if(!I||I.length===0)return"";const g=I[0],P=g.timestamp||g.createdAt;if(!P)return"Recent Activity";const h=new Date(P),y=new Date,M=new Date(y);return M.setDate(M.getDate()-1),h.toDateString()===y.toDateString()?"Today":h.toDateString()===M.toDateString()?"Yesterday":h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:h.getFullYear()!==y.getFullYear()?"numeric":void 0})},W=I=>{["note","email","whatsapp"].includes(I.type)&&o("activity-click",I)},E=I=>{f.value=!1,o("add-activity",I)};return(I,g)=>{const P=He("click-outside");return b(),k("div",Ft,[e("div",Rt,[e("div",qt,[g[27]||(g[27]=e("h3",{class:"text-base font-medium text-foreground leading-6"},"Activity",-1)),e("div",Nt,[e("div",{class:"relative",ref_key:"filterContainer",ref:x},[l(t(F),{variant:"outline",size:"icon",onClick:Ce(D,["stop"]),class:"relative w-8 h-8"},{default:r(()=>[g[12]||(g[12]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),V.value.length>0?(b(),k("span",Et)):L("",!0)]),_:1}),l(Qe,{name:"dropdown"},{default:r(()=>[v.value?pe((b(),k("div",Bt,[l(t(st),{items:w.value,className:"w-56"},null,8,["items"])])),[[P,()=>v.value=!1]]):L("",!0)]),_:1})],512),e("div",zt,[l(t(F),{variant:"default",size:"icon",onClick:g[0]||(g[0]=Ce(h=>f.value=!f.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:r(()=>[...g[13]||(g[13]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),f.value?pe((b(),k("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1 z-50",onClick:g[11]||(g[11]=Ce(()=>{},["stop"]))},[e("button",{onClick:g[1]||(g[1]=h=>E("email")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[14]||(g[14]=[e("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),p(" Email ",-1)])]),e("button",{onClick:g[2]||(g[2]=h=>E("sms")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[15]||(g[15]=[e("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),p(" SMS ",-1)])]),e("button",{onClick:g[3]||(g[3]=h=>E("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[16]||(g[16]=[e("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),p(" WhatsApp ",-1)])]),e("button",{onClick:g[4]||(g[4]=h=>E("call")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[17]||(g[17]=[e("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),p(" Call ",-1)])]),g[24]||(g[24]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:g[5]||(g[5]=h=>E("note")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[18]||(g[18]=[e("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),p(" Note ",-1)])]),e("button",{onClick:g[6]||(g[6]=h=>E("attachment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[19]||(g[19]=[e("i",{class:"fa-solid fa-paperclip text-sm text-muted-foreground"},null,-1),p(" Attachment ",-1)])]),g[25]||(g[25]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:g[7]||(g[7]=h=>E("financing")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[20]||(g[20]=[e("i",{class:"fa-solid fa-file-invoice-dollar text-sm text-primary"},null,-1),p(" Financing ",-1)])]),e("button",{onClick:g[8]||(g[8]=h=>E("tradein")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[21]||(g[21]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sm text-primary"},null,-1),p(" Trade-in ",-1)])]),e("button",{onClick:g[9]||(g[9]=h=>E("purchase")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[22]||(g[22]=[e("i",{class:"fa-solid fa-handshake text-sm text-primary"},null,-1),p(" Offer ",-1)])]),g[26]||(g[26]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:g[10]||(g[10]=h=>E("appointment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...g[23]||(g[23]=[e("i",{class:"fa-regular fa-calendar text-sm text-purple-600"},null,-1),p(" Appointment ",-1)])])])),[[P,()=>f.value=!1]]):L("",!0)])])])]),e("div",jt,[d.value.length>0?(b(),k("div",_t,[e("div",Wt,[e("h3",Ht,A(N(d.value)),1)]),e("div",Qt,[(b(!0),k(H,null,Z(d.value,h=>(b(),k("div",{key:h.id,class:"space-y-2"},[e("div",{class:j(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":h.type==="note"||h.type==="email"||h.type==="whatsapp"}]),onClick:y=>W(h)},[e("div",{class:j(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",h.type==="note"?"bg-orange-100":h.type==="call"?"bg-green-100":h.type==="ai-summary"?"bg-purple-100":h.type==="email"?"bg-blue-100":h.type==="whatsapp"?"bg-green-100":"bg-muted"])},[h.type==="note"?(b(),z(t(vt),{key:0,size:16,class:"text-orange-600"})):h.type==="call"?(b(),z(t(pt),{key:1,size:16,class:"text-green-600"})):h.type==="ai-summary"?(b(),z(t(at),{key:2,size:16,class:"text-purple-600"})):h.type==="email"?(b(),z(t(mt),{key:3,size:16,class:"text-blue-600"})):h.type==="whatsapp"?(b(),z(t(ft),{key:4,size:16,class:"text-green-600"})):(b(),z(t(ct),{key:5,size:16,class:"text-foreground"}))],2),e("div",Gt,[e("div",Kt,[e("p",Zt,[e("span",{class:j(["font-normal",h.type==="ai-summary"?"font-medium":""])},A(h.type==="ai-summary"?"MotorKAI":h.user),3),h.type==="note"?(b(),k("span",Jt," added a note")):h.type==="created"?(b(),k("span",Xt,A(h.message||h.action),1)):h.type==="call"?(b(),k("span",el,A(" "+(h.message||h.action)),1)):h.type==="ai-summary"?(b(),k("span",tl," summary")):h.type==="email"?(b(),k("span",ll,A(" sent an email"))):h.type==="whatsapp"?(b(),k("span",sl,A(" sent a WhatsApp message"))):(b(),k("span",ol,A(" "+(h.message||h.action)),1))]),e("p",al,A(h.time),1)]),h.type==="note"&&(h.message||h.content)?(b(),k("div",nl,[e("p",rl,A(h.message||h.content),1)])):L("",!0),h.type==="email"&&h.content?(b(),k("div",dl,[e("p",il,A(h.content),1)])):L("",!0),h.type==="whatsapp"&&h.content?(b(),k("div",ul,[e("p",cl,A(h.content),1)])):L("",!0),h.type==="ai-summary"&&(h.message||h.content)?(b(),k("div",ml,[e("p",fl,A(h.message||h.content),1)])):L("",!0)])],10,Yt)]))),128)),V.value.length>0?(b(),k("div",pl,[(b(!0),k(H,null,Z(V.value,h=>(b(),k("div",{key:h,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-muted text-sm font-medium text-foreground border border-border"},[e("span",null,A(u(h)),1),l(t(F),{variant:"ghost",size:"icon",onClick:y=>C(h),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:r(()=>[...g[28]||(g[28]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):L("",!0)])])):(b(),k("div",vl,[e("div",gl,[l(t(dt),{size:32,class:"mx-auto text-muted-foreground mb-2"}),g[29]||(g[29]=e("p",{class:"text-sm text-muted-foreground"},"No activity yet",-1))])]))])])}}},Cn=Ne(yl,[["__scopeId","data-v-cc936425"]]),bl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},hl={class:"space-y-2"},xl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},wl={key:1,class:"flex justify-between items-center mb-4"},kl={class:"text-sm font-semibold text-foreground"},Cl={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Vn={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(s,{expose:i,emit:a}){const o=s,f=a,v=U(""),x=U(!1);be(()=>{o.item&&(v.value=o.item.content||o.item.message||"")}),ne(()=>o.item,m=>{m&&(v.value=m.content||m.message||"")},{deep:!0}),ne(()=>o.show,m=>{o.modal&&!m&&setTimeout(()=>{v.value=o.item&&(o.item.content||o.item.message)||"",x.value=!1},300)});const c=async()=>{var m,C;if(v.value.trim()){x.value=!0;try{const u={id:((m=o.item)==null?void 0:m.id)||Date.now(),type:"note",action:o.item?"updated a note":"added a note",content:v.value,message:v.value,timestamp:((C=o.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",u),o.modal&&f("close")}finally{x.value=!1}}},V=()=>{f("cancel"),o.modal&&f("close")},D=m=>{m||f("close")};return i({submit:c,canSubmit:()=>!!v.value.trim()}),(m,C)=>s.modal?(b(),z(t(se),{key:0,open:s.show,"onUpdate:open":D},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[p(A(s.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),e("div",bl,[e("div",hl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...C[2]||(C[2]=[p(" Note ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(de),{modelValue:v.value,"onUpdate:modelValue":C[0]||(C[0]=u=>v.value=u),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:V}),l(t(F),{label:x.value?"Saving...":s.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value.trim()||x.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(b(),k("div",{key:1,class:j(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!s.hideHeader}])},[s.hideHeader?L("",!0):(b(),k("div",xl)),s.hideHeader?L("",!0):(b(),k("div",wl,[e("h5",kl,A(s.item?"Edit Note":"Add Note"),1),e("button",{onClick:V,class:"text-muted-foreground hover:text-muted-foreground"},[...C[3]||(C[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[C[4]||(C[4]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Note",-1)),pe(e("textarea",{"onUpdate:modelValue":C[1]||(C[1]=u=>v.value=u),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[Ve,v.value]])]),s.hideActions?L("",!0):(b(),k("div",Cl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",onClick:V}),l(t(F),{label:"Save",variant:"primary",size:"small",onClick:c})]))],2))}},Vl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Sl={class:"space-y-2"},$l={class:"flex items-center gap-3"},Il={key:0,class:"text-sm text-muted-foreground truncate"},Tl={key:1,class:"text-sm text-muted-foreground"},Al={key:1,class:"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6 animate-fade-in relative"},Ml={class:"flex justify-between items-center mb-4"},Dl={class:"text-sm font-semibold text-foreground"},Pl={class:"flex items-center gap-3"},Ll={key:0,class:"text-sm text-slate-600"},Ol={key:1,class:"text-sm text-muted-foreground"},Ul={class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Sn={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(s,{expose:i,emit:a}){const o=s,f=a,v=U(null),x=U(""),c=U(!1),V=U(null);be(()=>{o.item&&(x.value=o.item.fileName||"")}),ne(()=>o.item,w=>{w&&(x.value=w.fileName||"")},{deep:!0}),ne(()=>o.show,w=>{o.modal&&!w&&setTimeout(()=>{v.value=null,x.value=o.item&&o.item.fileName||"",c.value=!1},300)});const D=w=>{const T=w.target.files[0];T&&(v.value=T,x.value=T.name)},m=async()=>{var w,T;if(!(!v.value&&!o.item)){c.value=!0;try{const d={id:((w=o.item)==null?void 0:w.id)||Date.now(),type:"attachment",action:o.item?"updated an attachment":"added an attachment",fileName:x.value,file:v.value,timestamp:((T=o.item)==null?void 0:T.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",d),o.modal&&f("close")}finally{c.value=!1}}},C=()=>{f("cancel"),o.modal&&f("close")},u=w=>{w||f("close")};return i({submit:m,canSubmit:()=>!!v.value||!!o.item}),(w,T)=>s.modal?(b(),z(t(se),{key:0,open:s.show,"onUpdate:open":u},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[p(A(s.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),e("div",Vl,[e("div",Sl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...T[2]||(T[2]=[p(" File ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),e("div",$l,[e("input",{type:"file",onChange:D,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(F),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:T[0]||(T[0]=d=>{var N;return(N=V.value)==null?void 0:N.click()})}),x.value?(b(),k("span",Il,A(x.value),1)):(b(),k("span",Tl,"No file selected"))])])]),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:C}),l(t(F),{label:c.value?"Saving...":s.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value||c.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(b(),k("div",Al,[T[5]||(T[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),e("div",Ml,[e("h5",Dl,A(s.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:C,class:"text-muted-foreground hover:text-muted-foreground"},[...T[3]||(T[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[T[4]||(T[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Pl,[e("input",{type:"file",onChange:D,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(F),{label:"Choose File",variant:"outline",size:"small",onClick:T[1]||(T[1]=d=>w.$refs.fileInput.click())}),x.value?(b(),k("span",Ll,A(x.value),1)):(b(),k("span",Ol,"No file selected"))])]),e("div",Ul,[l(t(F),{label:"Cancel",variant:"outline",size:"small",onClick:C}),l(t(F),{label:"Save",variant:"primary",size:"small",disabled:!v.value,onClick:m},null,8,["disabled"])])]))}},Fl={class:"space-y-6"},Rl={class:"space-y-2"},ql={class:"space-y-2"},Nl={class:"flex justify-end gap-3"},El={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const a=s,o=i,f=U(a.initialTemplate),v=U(a.initialMessage),x={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},c=()=>{f.value&&x[f.value]&&(v.value=x[f.value])},V=()=>{v.value.trim()&&o("send",{type:"whatsapp",template:f.value,message:v.value})};return(D,m)=>(b(),k("div",Fl,[e("div",Rl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...m[3]||(m[3]=[p("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Follow-up"},{default:r(()=>[...m[4]||(m[4]=[p("Follow-up",-1)])]),_:1}),l(t(q),{value:"Meeting Confirmation"},{default:r(()=>[...m[5]||(m[5]=[p("Meeting Confirmation",-1)])]),_:1}),l(t(q),{value:"Quote Proposal"},{default:r(()=>[...m[6]||(m[6]=[p("Quote Proposal",-1)])]),_:1}),l(t(q),{value:"Unable to Reach"},{default:r(()=>[...m[7]||(m[7]=[p("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ql,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...m[8]||(m[8]=[p("Message",-1)])]),_:1}),l(t(de),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Nl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>D.$emit("cancel"))}),l(t(F),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:V})])]))}},$n={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const a=i,o=v=>{a("save",v),a("close")},f=v=>{v||a("close")};return(v,x)=>(b(),z(t(se),{open:s.show,"onUpdate:open":f},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:r(()=>[l(t(te),null,{default:r(()=>[l(t(le),null,{default:r(()=>[...x[1]||(x[1]=[p("Send WhatsApp Message",-1)])]),_:1})]),_:1}),l(El,{onSend:o,onCancel:x[0]||(x[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Bl={class:"space-y-6"},zl={class:"space-y-2"},jl={class:"space-y-2"},_l={class:"text-xs text-muted-foreground mt-1"},Wl={class:"flex justify-end gap-3"},Hl={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const a=s,o=i,f=U(a.initialTemplate),v=U(a.initialMessage),x={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},c=()=>{f.value&&x[f.value]&&(v.value=x[f.value])},V=()=>{v.value.trim()&&o("send",{type:"sms",template:f.value,message:v.value})};return(D,m)=>(b(),k("div",Bl,[e("div",zl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...m[3]||(m[3]=[p("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Follow-up"},{default:r(()=>[...m[4]||(m[4]=[p("Follow-up",-1)])]),_:1}),l(t(q),{value:"Meeting Confirmation"},{default:r(()=>[...m[5]||(m[5]=[p("Meeting Confirmation",-1)])]),_:1}),l(t(q),{value:"Quote Proposal"},{default:r(()=>[...m[6]||(m[6]=[p("Quote Proposal",-1)])]),_:1}),l(t(q),{value:"Unable to Reach"},{default:r(()=>[...m[7]||(m[7]=[p("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",jl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...m[8]||(m[8]=[p("Message",-1)])]),_:1}),l(t(de),{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=C=>v.value=C),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),e("p",_l,A(v.value.length)+"/160 characters",1)]),e("div",Wl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>D.$emit("cancel"))}),l(t(F),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:V})])]))}},In={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const a=i,o=v=>{a("save",v),a("close")},f=v=>{v||a("close")};return(v,x)=>(b(),z(t(se),{open:s.show,"onUpdate:open":f},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:r(()=>[l(t(te),null,{default:r(()=>[l(t(le),null,{default:r(()=>[...x[1]||(x[1]=[p("Send SMS",-1)])]),_:1})]),_:1}),l(Hl,{onSend:o,onCancel:x[0]||(x[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ql={class:"space-y-6"},Yl={class:"space-y-2"},Gl={class:"space-y-2"},Kl={class:"space-y-2"},Zl={class:"flex justify-end gap-3"},Jl={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:i}){const a=s,o=i,f=U(a.initialTemplate),v=U(""),x=U(a.initialMessage),c={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},V=()=>{f.value&&c[f.value]&&(v.value=c[f.value].subject,x.value=c[f.value].message)},D=()=>{x.value.trim()&&o("send",{type:"email",template:f.value,subject:v.value,message:x.value})};return(m,C)=>(b(),k("div",Ql,[e("div",Yl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...C[4]||(C[4]=[p("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[C[0]||(C[0]=u=>f.value=u),V]},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Follow-up"},{default:r(()=>[...C[5]||(C[5]=[p("Follow-up",-1)])]),_:1}),l(t(q),{value:"Meeting Confirmation"},{default:r(()=>[...C[6]||(C[6]=[p("Meeting Confirmation",-1)])]),_:1}),l(t(q),{value:"Quote Proposal"},{default:r(()=>[...C[7]||(C[7]=[p("Quote Proposal",-1)])]),_:1}),l(t(q),{value:"Unable to Reach"},{default:r(()=>[...C[8]||(C[8]=[p("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Gl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...C[9]||(C[9]=[p("Subject",-1)])]),_:1}),l(t(O),{modelValue:v.value,"onUpdate:modelValue":C[1]||(C[1]=u=>v.value=u),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Kl,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...C[10]||(C[10]=[p("Message",-1)])]),_:1}),l(t(de),{modelValue:x.value,"onUpdate:modelValue":C[2]||(C[2]=u=>x.value=u),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Zl,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:C[3]||(C[3]=u=>m.$emit("cancel"))}),l(t(F),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:D})])]))}},Tn={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:i}){const a=i,o=v=>{a("save",v),a("close")},f=v=>{v||a("close")};return(v,x)=>(b(),z(t(se),{open:s.show,"onUpdate:open":f},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:r(()=>[l(t(te),null,{default:r(()=>[l(t(le),null,{default:r(()=>[...x[1]||(x[1]=[p("Send Email",-1)])]),_:1})]),_:1}),l(Jl,{onSend:o,onCancel:x[0]||(x[0]=c=>v.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},An={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(s,{emit:i}){const a=i,o=v=>{v||a("close")},f=()=>{a("close")};return(v,x)=>(b(),z(t(se),{open:s.show,"onUpdate:open":o},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[p(A(s.title),1)]),_:1})]),_:1}),x[0]||(x[0]=e("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[e("div",{class:"flex items-center justify-center w-full"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class Xl extends Ye{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(i={}){await new Promise(o=>setTimeout(o,300));let a=[...this.dataSource];return i.leadId!==void 0&&(a=a.filter(o=>o.leadId===parseInt(i.leadId))),i.opportunityId!==void 0&&(a=a.filter(o=>o.opportunityId===parseInt(i.opportunityId))),i.type&&(a=a.filter(o=>o.type===i.type)),i.offerId!==void 0&&(a=a.filter(o=>o.offerId===parseInt(i.offerId))),i.vehicleId!==void 0&&(a=a.filter(o=>o.vehicleId===parseInt(i.vehicleId))),a}async findAllByLeadId(i){return this.findAll({leadId:i})}async findAllByOpportunityId(i){return this.findAll({opportunityId:i})}async findById(i){return await new Promise(o=>setTimeout(o,300)),this.dataSource.find(o=>o.id===parseInt(i))||null}async create(i){await new Promise(f=>setTimeout(f,300));const o={id:this.dataSource.length>0?Math.max(...this.dataSource.map(f=>f.id))+1:1,type:i.type,leadId:i.leadId!==void 0?parseInt(i.leadId):void 0,opportunityId:i.opportunityId!==void 0?parseInt(i.opportunityId):void 0,offerId:i.offerId!==void 0?parseInt(i.offerId):void 0,vehicleId:i.vehicleId!==void 0?parseInt(i.vehicleId):void 0,fields:i.fields||{},currency:i.currency||"EUR",offerValidFrom:i.offerValidFrom||null,offerValidTo:i.offerValidTo||null,status:i.status||"active",createdAt:i.createdAt||new Date().toISOString(),createdBy:i.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(o),o}async update(i,a){await new Promise(f=>setTimeout(f,300));const o=this.dataSource.find(f=>f.id===parseInt(i));if(!o)throw new Error("Purchase method not found");return Object.assign(o,a,{updatedAt:new Date().toISOString()}),o}async delete(i){await new Promise(o=>setTimeout(o,300));const a=this.dataSource.findIndex(o=>o.id===parseInt(i));if(a===-1)throw new Error("Purchase method not found");return this.dataSource.splice(a,1),{success:!0}}}class es{constructor(){this.repository=new Xl}calculateTotal(i){const{type:a,fields:o}=i;if(!o)return 0;const f=parseFloat(o.monthlyInstalment)||0,v=parseFloat(o.downPayment)||0,x=parseInt(o.duration)||0;switch(a){case"FIN":return f*x+v;case"LEA":const c=parseFloat(o.finalInstalment)||0;return f*x+v+c;case"LTR":return f*x+v;default:return 0}}validate(i){const a=[],{type:o,fields:f}=i;if((!o||!["FIN","LEA","LTR"].includes(o))&&a.push("Purchase method type is required and must be FIN, LEA, or LTR"),!f)return a.push("Purchase method fields are required"),{isValid:!1,errors:a};const v=parseFloat(f.monthlyInstalment);(!v||v<=0)&&a.push("Monthly Instalment must be greater than 0");const x=parseFloat(f.downPayment);(x==null||x<0)&&a.push("Down Payment must be greater than or equal to 0");const c=parseInt(f.duration);if((!c||c<12||c>60)&&a.push("Duration must be between 12 and 60 months"),o==="FIN"){const V=parseFloat(f.interestRate);V!=null&&(V<0||V>99.99)&&a.push("Interest Rate must be between 0 and 99.99%");const D=parseFloat(f.effectiveInterestRate);D!=null&&(D<0||D>99.99)&&a.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(o==="LEA"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&a.push("Mileage Limit must be greater than 0 if provided");const D=parseFloat(f.finalInstalment);D!=null&&D<0&&a.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(f.interestRate);m!=null&&(m<0||m>99.99)&&a.push("Interest Rate must be between 0 and 99.99%")}if(o==="LTR"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&a.push("Mileage Limit must be greater than 0 if provided"),(!f.customerType||!["Private","Business","Fleet"].includes(f.customerType))&&a.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:a.length===0,errors:a}}async findAll(i={}){return await this.repository.findAll(i)}async findById(i){return await this.repository.findById(i)}async create(i){const a=this.validate(i);if(!a.isValid)throw new Error(`Validation failed: ${a.errors.join(", ")}`);const o=await this.repository.create(i),f=this.calculateTotal(o);return o.fields={...o.fields,totalAmount:f},await this.repository.update(o.id,{fields:o.fields})}async update(i,a){const o=await this.repository.findById(i);if(!o)throw new Error("Purchase method not found");const f={...o,...a,fields:{...o.fields,...a.fields}},v=this.validate(f);if(!v.isValid)throw new Error(`Validation failed: ${v.errors.join(", ")}`);const x=this.calculateTotal(f);return f.fields.totalAmount=x,await this.repository.update(i,{...a,fields:f.fields})}async delete(i){return await this.repository.delete(i)}}const xe=new es,we=(s=300)=>new Promise(i=>setTimeout(i,s)),ts=async(s={})=>(await we(),await xe.findAll(s)),ls=async s=>(await we(),await xe.findById(s)),ss=async s=>(await we(),await xe.create(s)),os=async(s,i)=>(await we(),await xe.update(s,i)),as=async s=>(await we(),await xe.delete(s)),ns=Ge("purchaseMethods",()=>{const s=U([]),i=U(null),a=U(!1),o=U(null),f=B(()=>u=>s.value.filter(w=>w.type===u)),v=B(()=>u=>s.value.filter(w=>w.leadId===parseInt(u))),x=B(()=>u=>s.value.filter(w=>w.opportunityId===parseInt(u)));return{purchaseMethods:s,currentPurchaseMethod:i,loading:a,error:o,purchaseMethodsByType:f,purchaseMethodsByLead:v,purchaseMethodsByOpportunity:x,fetchPurchaseMethods:async(u={})=>{a.value=!0,o.value=null;try{const w=await ts(u);return s.value=w,w}catch(w){throw o.value=w.message,w}finally{a.value=!1}},fetchPurchaseMethodById:async u=>{a.value=!0,o.value=null;try{return i.value=await ls(u),i.value}catch(w){throw o.value=w.message,w}finally{a.value=!1}},createPurchaseMethod:async u=>{a.value=!0,o.value=null;try{const w=await ss(u);return s.value.push(w),w}catch(w){throw o.value=w.message,w}finally{a.value=!1}},updatePurchaseMethod:async(u,w)=>{var T;a.value=!0,o.value=null;try{const d=await os(u,w),N=s.value.findIndex(W=>W.id===u);return N!==-1&&(s.value[N]=d),((T=i.value)==null?void 0:T.id)===u&&(i.value=d),d}catch(d){throw o.value=d.message,d}finally{a.value=!1}},deletePurchaseMethod:async u=>{var w;a.value=!0,o.value=null;try{await as(u),s.value=s.value.filter(T=>T.id!==u),((w=i.value)==null?void 0:w.id)===u&&(i.value=null)}catch(T){throw o.value=T.message,T}finally{a.value=!1}}}}),rs={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ds={class:"flex gap-2"},is=["value"],us={key:0,class:"space-y-4"},cs={class:"text-h3-card text-foreground mb-4"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fs={class:"relative"},ps={key:0,class:"text-xs text-red-600 mt-1"},vs={class:"relative"},gs={key:0,class:"text-xs text-red-600 mt-1"},ys={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bs={key:0,class:"text-xs text-red-600 mt-1"},hs={class:"space-y-2"},xs={key:0,class:"text-xs text-red-600 mt-1"},ws={key:0,class:"text-xs text-red-600 mt-1"},ks={class:"bg-muted p-4 rounded-lg border border-border"},Cs={class:"flex justify-between items-center"},Vs={class:"text-lg font-bold text-foreground"},Ss={class:"flex flex-col gap-3"},$s={class:"flex items-center gap-2"},Is={class:"flex items-center gap-2"},Ts={class:"flex items-center gap-2"},As={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-border"},Ms={class:"space-y-2"},Ds={class:"space-y-2"},Ps={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ls={class:"list-disc list-inside text-sm text-red-700 space-y-1"},Os={key:0},Us={key:1},Fs={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:s=>["lead","opportunity"].includes(s)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(s,{emit:i}){const a=s,o=i,f=ns(),v=Ke(),x=U(!1),c=U({}),V=U([]),D=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],m=U({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),C=B(()=>!!a.purchaseMethod);B(()=>{if(m.value.type!=="LEA")return 0;const h=parseFloat(m.value.fields.monthlyInstalment)||0,y=parseInt(m.value.fields.duration)||0,M=parseFloat(m.value.fields.downPayment)||0,ue=parseFloat(m.value.fields.finalInstalment)||0;return h*y+M+ue});const u=B(()=>{if(m.value.type!=="LTR")return 0;const h=parseFloat(m.value.fields.monthlyInstalment)||0,y=parseInt(m.value.fields.duration)||0,M=parseFloat(m.value.fields.downPayment)||0;return h*y+M}),w=h=>h==="FIN"?[12,24,36,48,60]:h==="LEA"?[24,36,48,60]:h==="LTR"?[12,24,36,48,60]:[],T=h=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[h]||h,d=h=>{const y=m.value.fields[h];switch(h){case"monthlyInstalment":!y||y<=0?c.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete c.value.monthlyInstalment;break;case"downPayment":y==null||y<0?c.value.downPayment="Down Payment must be greater than or equal to 0":delete c.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!y||y<12||y>60)?c.value.duration="Duration must be between 12 and 60 months":delete c.value.duration;break;case"customerType":m.value.type==="LTR"&&(!y||!["Private","Business","Fleet"].includes(y))?c.value.customerType="Customer Type is required":delete c.value.customerType;break}},N=h=>{delete c.value[h]},W=()=>{V.value=[],c.value={};const h=xe.validate({type:m.value.type,fields:m.value.fields});return h.isValid||(V.value=h.errors,h.errors.forEach(y=>{y.includes("Monthly Instalment")?c.value.monthlyInstalment=y:y.includes("Down Payment")?c.value.downPayment=y:y.includes("Duration")?c.value.duration=y:y.includes("Customer Type")&&(c.value.customerType=y)})),h.isValid},E=B(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(c.value).length===0),I=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),c.value={},V.value=[]},g=async()=>{var h;if(W()){x.value=!0;try{const y={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((h=v.currentUser)==null?void 0:h.id)||null};a.taskType==="lead"?y.leadId=parseInt(a.taskId):a.taskType==="opportunity"&&(y.opportunityId=parseInt(a.taskId)),a.vehicleId&&(y.vehicleId=parseInt(a.vehicleId)),a.offerId&&(y.offerId=parseInt(a.offerId));let M;C.value?M=await f.updatePurchaseMethod(a.purchaseMethod.id,y):M=await f.createPurchaseMethod(y);const ue=T(M.type),Se=Fe(M.fields.monthlyInstalment||0);o("save",{...M,successMessage:`Purchase Method Added: ${ue} - €${Se}/month`}),o("close")}catch(y){V.value=[y.message||"Failed to save purchase method"]}finally{x.value=!1}}},P=h=>{h||o("close")};return be(()=>{a.purchaseMethod&&(m.value={type:a.purchaseMethod.type||"",fields:{...m.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null})}),ne(()=>a.show,h=>{h?a.purchaseMethod&&(m.value={type:a.purchaseMethod.type||"",fields:{...m.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},c.value={},V.value=[],x.value=!1},300)}),(h,y)=>(b(),z(t(se),{open:s.show,"onUpdate:open":P},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[p(A(C.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),e("div",rs,[e("div",null,[y[19]||(y[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",ds,[(b(),k(H,null,Z(D,M=>e("label",{key:M.value,class:"flex-1 cursor-pointer"},[pe(e("input",{type:"radio",value:M.value,"onUpdate:modelValue":y[0]||(y[0]=ue=>m.value.type=ue),class:"sr-only",onChange:I},null,40,is),[[Ze,m.value.type]]),e("div",{class:j(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",m.value.type===M.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-muted-foreground hover:border-brand-slate"])},A(M.label),3)])),64))])]),m.value.type?(b(),k("div",us,[e("h3",cs,A(T(m.value.type))+" Details ",1),e("div",ms,[e("div",null,[y[21]||(y[21]=e("label",{class:"block label-upper mb-2"},[p(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fs,[y[20]||(y[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),pe(e("input",{"onUpdate:modelValue":y[1]||(y[1]=M=>m.value.fields.monthlyInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.monthlyInstalment}]),onInput:y[2]||(y[2]=M=>N("monthlyInstalment")),onBlur:y[3]||(y[3]=M=>d("monthlyInstalment"))},null,34),[[Ve,m.value.fields.monthlyInstalment,void 0,{number:!0}]])]),c.value.monthlyInstalment?(b(),k("p",ps,A(c.value.monthlyInstalment),1)):L("",!0),y[22]||(y[22]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[y[24]||(y[24]=e("label",{class:"block label-upper mb-2"},[p(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",vs,[y[23]||(y[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),pe(e("input",{"onUpdate:modelValue":y[4]||(y[4]=M=>m.value.fields.downPayment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.downPayment}]),onInput:y[5]||(y[5]=M=>N("downPayment")),onBlur:y[6]||(y[6]=M=>d("downPayment"))},null,34),[[Ve,m.value.fields.downPayment,void 0,{number:!0}]])]),c.value.downPayment?(b(),k("p",gs,A(c.value.downPayment),1)):L("",!0),y[25]||(y[25]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(b(),k("div",ys,[e("div",null,[y[26]||(y[26]=e("label",{class:"block label-upper mb-2"},[p(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[y[7]||(y[7]=M=>m.value.fields.duration=M),y[8]||(y[8]=M=>N("duration"))]},{default:r(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.duration}])},{default:r(()=>[l(t(Y),{placeholder:"Select duration..."})]),_:1},8,["class"]),l(t(G),null,{default:r(()=>[(b(!0),k(H,null,Z(w(m.value.type),M=>(b(),z(t(q),{key:M,value:M},{default:r(()=>[p(A(M)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c.value.duration?(b(),k("p",bs,A(c.value.duration),1)):L("",!0)]),e("div",hs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...y[27]||(y[27]=[p("Unlock Kilometers",-1)])]),_:1}),l(t(O),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":y[9]||(y[9]=M=>m.value.fields.mileageLimit=M),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:j(["w-full h-10",{"border-red-500":c.value.mileageLimit}]),onInput:y[10]||(y[10]=M=>N("mileageLimit"))},null,8,["modelValue","class"]),c.value.mileageLimit?(b(),k("p",xs,A(c.value.mileageLimit),1)):L("",!0)])])):L("",!0),m.value.type==="LTR"?(b(),k(H,{key:1},[e("div",null,[y[31]||(y[31]=e("label",{class:"block label-upper mb-2"},[p(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[y[11]||(y[11]=M=>m.value.fields.customerType=M),y[12]||(y[12]=M=>N("customerType"))]},{default:r(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.customerType}])},{default:r(()=>[l(t(Y),{placeholder:"Select customer type..."})]),_:1},8,["class"]),l(t(G),null,{default:r(()=>[l(t(q),{value:"Private"},{default:r(()=>[...y[28]||(y[28]=[p("Private",-1)])]),_:1}),l(t(q),{value:"Business"},{default:r(()=>[...y[29]||(y[29]=[p("Business",-1)])]),_:1}),l(t(q),{value:"Fleet"},{default:r(()=>[...y[30]||(y[30]=[p("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value.customerType?(b(),k("p",ws,A(c.value.customerType),1)):L("",!0)]),e("div",ks,[e("div",Cs,[y[32]||(y[32]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),e("span",Vs,"€ "+A(t(Fe)(u.value)),1)]),y[33]||(y[33]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Ss,[e("div",$s,[l(t(ae),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":y[13]||(y[13]=M=>m.value.fields.insuranceIncluded=M)},null,8,["checked"]),l(t($),{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"},{default:r(()=>[...y[34]||(y[34]=[p(" Insurance Included ",-1)])]),_:1})]),e("div",Is,[l(t(ae),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":y[14]||(y[14]=M=>m.value.fields.maintenanceIncluded=M)},null,8,["checked"]),l(t($),{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"},{default:r(()=>[...y[35]||(y[35]=[p(" Maintenance Included ",-1)])]),_:1})]),e("div",Ts,[l(t(ae),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":y[15]||(y[15]=M=>m.value.fields.registrationTaxesIncluded=M)},null,8,["checked"]),l(t($),{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"},{default:r(()=>[...y[36]||(y[36]=[p(" Registration/Taxes Included ",-1)])]),_:1})])])],64)):L("",!0),e("div",As,[e("div",Ms,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...y[37]||(y[37]=[p("Offer Valid From",-1)])]),_:1}),l(t(O),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":y[16]||(y[16]=M=>m.value.offerValidFrom=M),type:"date",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Ds,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...y[38]||(y[38]=[p("Offer Valid To",-1)])]),_:1}),l(t(O),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":y[17]||(y[17]=M=>m.value.offerValidTo=M),type:"date",class:"w-full h-10"},null,8,["modelValue"])])])])):L("",!0),V.value.length>0?(b(),k("div",Ps,[y[39]||(y[39]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Ls,[(b(!0),k(H,null,Z(V.value,M=>(b(),k("li",{key:M},A(M),1))),128))])])):L("",!0)]),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[18]||(y[18]=M=>h.$emit("close"))}),l(t(F),{label:C.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!E.value||x.value,onClick:g},{default:r(()=>[x.value?(b(),k("span",Os,"Saving...")):(b(),k("span",Us,A(C.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Mn=Ne(Fs,[["__scopeId","data-v-1f134801"]]),Rs={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},qs={key:0,class:"space-y-4 py-4 w-full"},Ns={class:"grid grid-cols-1 gap-3"},Es={key:1,class:"space-y-6 w-full"},Bs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zs={class:"space-y-2"},js={class:"space-y-2"},_s={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ws={class:"space-y-2"},Hs={class:"space-y-2"},Qs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ys={class:"space-y-2"},Gs={class:"space-y-2"},Ks={class:"space-y-2"},Zs={class:"space-y-2"},Js={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xs={class:"space-y-2"},eo={class:"space-y-2"},to={class:"space-y-2"},lo={class:"space-y-2"},so={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oo={class:"space-y-2"},ao={class:"space-y-2"},no={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ro={class:"space-y-2"},io={class:"space-y-2"},uo={class:"space-y-2"},co={class:"space-y-2"},mo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fo={class:"space-y-2"},po={class:"space-y-2"},vo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},go={class:"space-y-2"},yo={class:"space-y-2"},Dn={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:s=>["vehicle","tradein"].includes(s)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(s,{emit:i}){const a=s,o=i,f=U(a.mode==="tradein"?"tradein":null);ne(()=>a.mode,C=>{C==="tradein"?f.value="tradein":a.item||(f.value=null)});const v=B(()=>a.mode==="tradein"||f.value==="tradein"),x=()=>a.mode==="tradein"||f.value==="tradein"?"Add Trade-In Vehicle":f.value==="drove"?"Add Drove Vehicle":f.value==="requested"?"Add Requested Vehicle":"Add Vehicle",c=U({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});be(()=>{a.item&&a.item.data&&(c.value={brand:a.item.data.brand||"",model:a.item.data.model||"",year:a.item.data.year||"",version:a.item.data.version||"",vin:a.item.data.vin||"",plates:a.item.data.plate||a.item.data.plates||"",fuelType:a.item.data.fuelType||"",gearType:a.item.data.gearType||"",kilometers:a.item.data.km||a.item.data.kilometers||"",registration:a.item.data.date||a.item.data.registration||"",owner:a.item.data.owner||"",ownershipType:a.item.data.ownershipType||"",ownedSince:a.item.data.ownedSince||"",warrantyInfo:a.item.data.warrantyInfo||"",note:a.item.data.note||"",stockDays:null})}),ne(()=>a.show,C=>{C||(f.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const V=B(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),D=C=>{C||o("close")},m=()=>{if(!V.value)return;const C={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,note:c.value.note||null,stockDays:null,status:"Available"}};f.value&&(C.vehicleType=f.value),a.item&&(C.id=a.item.id,C.isEdit=!0,C.timestamp=a.item.timestamp||new Date().toISOString()),o("save",C)};return(C,u)=>(b(),z(t(se),{open:s.show,"onUpdate:open":D},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[p(A(x()),1)]),_:1})]),_:1}),e("div",Rs,[s.mode==="vehicle"&&!s.item&&!f.value?(b(),k("div",qs,[u[26]||(u[26]=e("p",{class:"text-muted-foreground text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Ns,[l(t(F),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:u[0]||(u[0]=w=>f.value="drove")}),l(t(F),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:u[1]||(u[1]=w=>f.value="requested")}),l(t(F),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:u[2]||(u[2]=w=>f.value="tradein")})])])):(b(),k("div",Es,[v.value?(b(),k(H,{key:0},[e("div",Bs,[e("div",zs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[27]||(u[27]=[p("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(O),{modelValue:c.value.brand,"onUpdate:modelValue":u[3]||(u[3]=w=>c.value.brand=w),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",js,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[28]||(u[28]=[p("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(O),{modelValue:c.value.model,"onUpdate:modelValue":u[4]||(u[4]=w=>c.value.model=w),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])])]),e("div",_s,[e("div",Ws,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[29]||(u[29]=[p("Year (or registration year) ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(O),{modelValue:c.value.year,"onUpdate:modelValue":u[5]||(u[5]=w=>c.value.year=w),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),e("div",Hs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[30]||(u[30]=[p("Kilometers",-1)])]),_:1}),l(t(O),{modelValue:c.value.kilometers,"onUpdate:modelValue":u[6]||(u[6]=w=>c.value.kilometers=w),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",Qs,[e("div",Ys,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[31]||(u[31]=[p("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":u[7]||(u[7]=w=>c.value.fuelType=w)},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Petrol"},{default:r(()=>[...u[32]||(u[32]=[p("Petrol",-1)])]),_:1}),l(t(q),{value:"Diesel"},{default:r(()=>[...u[33]||(u[33]=[p("Diesel",-1)])]),_:1}),l(t(q),{value:"Electric"},{default:r(()=>[...u[34]||(u[34]=[p("Electric",-1)])]),_:1}),l(t(q),{value:"Hybrid"},{default:r(()=>[...u[35]||(u[35]=[p("Hybrid",-1)])]),_:1}),l(t(q),{value:"Plug-in Hybrid"},{default:r(()=>[...u[36]||(u[36]=[p("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Gs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[37]||(u[37]=[p("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":u[8]||(u[8]=w=>c.value.gearType=w)},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Manual"},{default:r(()=>[...u[38]||(u[38]=[p("Manual",-1)])]),_:1}),l(t(q),{value:"Automatic"},{default:r(()=>[...u[39]||(u[39]=[p("Automatic",-1)])]),_:1}),l(t(q),{value:"CVT"},{default:r(()=>[...u[40]||(u[40]=[p("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",Ks,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[41]||(u[41]=[p("Plates",-1)])]),_:1}),l(t(O),{modelValue:c.value.plates,"onUpdate:modelValue":u[9]||(u[9]=w=>c.value.plates=w),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"]),u[42]||(u[42]=e("p",{class:"text-xs text-muted-foreground mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",Zs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[43]||(u[43]=[p("Note",-1)])]),_:1}),l(t(de),{modelValue:c.value.note,"onUpdate:modelValue":u[10]||(u[10]=w=>c.value.note=w),rows:"5",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])],64)):(b(),k(H,{key:1},[e("div",Js,[e("div",Xs,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[44]||(u[44]=[p("Brand",-1)])]),_:1}),l(t(O),{modelValue:c.value.brand,"onUpdate:modelValue":u[11]||(u[11]=w=>c.value.brand=w),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",eo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[45]||(u[45]=[p("Model",-1)])]),_:1}),l(t(O),{modelValue:c.value.model,"onUpdate:modelValue":u[12]||(u[12]=w=>c.value.model=w),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",to,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[46]||(u[46]=[p("Year",-1)])]),_:1}),l(t(O),{modelValue:c.value.year,"onUpdate:modelValue":u[13]||(u[13]=w=>c.value.year=w),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",lo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[47]||(u[47]=[p("Version/Trim",-1)])]),_:1}),l(t(O),{modelValue:c.value.version,"onUpdate:modelValue":u[14]||(u[14]=w=>c.value.version=w),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),e("div",so,[e("div",oo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[48]||(u[48]=[p("VIN",-1)])]),_:1}),l(t(O),{modelValue:c.value.vin,"onUpdate:modelValue":u[15]||(u[15]=w=>c.value.vin=w),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ao,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[49]||(u[49]=[p("Plates",-1)])]),_:1}),l(t(O),{modelValue:c.value.plates,"onUpdate:modelValue":u[16]||(u[16]=w=>c.value.plates=w),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",no,[e("div",ro,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[50]||(u[50]=[p("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":u[17]||(u[17]=w=>c.value.fuelType=w)},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Petrol"},{default:r(()=>[...u[51]||(u[51]=[p("Petrol",-1)])]),_:1}),l(t(q),{value:"Diesel"},{default:r(()=>[...u[52]||(u[52]=[p("Diesel",-1)])]),_:1}),l(t(q),{value:"Electric"},{default:r(()=>[...u[53]||(u[53]=[p("Electric",-1)])]),_:1}),l(t(q),{value:"Hybrid"},{default:r(()=>[...u[54]||(u[54]=[p("Hybrid",-1)])]),_:1}),l(t(q),{value:"Plug-in Hybrid"},{default:r(()=>[...u[55]||(u[55]=[p("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",io,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[56]||(u[56]=[p("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":u[18]||(u[18]=w=>c.value.gearType=w)},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Manual"},{default:r(()=>[...u[57]||(u[57]=[p("Manual",-1)])]),_:1}),l(t(q),{value:"Automatic"},{default:r(()=>[...u[58]||(u[58]=[p("Automatic",-1)])]),_:1}),l(t(q),{value:"CVT"},{default:r(()=>[...u[59]||(u[59]=[p("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",uo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[60]||(u[60]=[p("Mileage (km)",-1)])]),_:1}),l(t(O),{modelValue:c.value.kilometers,"onUpdate:modelValue":u[19]||(u[19]=w=>c.value.kilometers=w),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",co,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[61]||(u[61]=[p("Registration Year/Month",-1)])]),_:1}),l(t(O),{modelValue:c.value.registration,"onUpdate:modelValue":u[20]||(u[20]=w=>c.value.registration=w),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",mo,[e("div",fo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[62]||(u[62]=[p("Owned Since",-1)])]),_:1}),l(t(O),{modelValue:c.value.ownedSince,"onUpdate:modelValue":u[21]||(u[21]=w=>c.value.ownedSince=w),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",po,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[63]||(u[63]=[p("Owner",-1)])]),_:1}),l(t(O),{modelValue:c.value.owner,"onUpdate:modelValue":u[22]||(u[22]=w=>c.value.owner=w),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",vo,[e("div",go,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[64]||(u[64]=[p("Ownership Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.ownershipType,"onUpdate:modelValue":u[23]||(u[23]=w=>c.value.ownershipType=w)},{default:r(()=>[l(t(Q),{class:"w-full h-10"},{default:r(()=>[l(t(Y),{placeholder:"Select ownership type..."})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Private"},{default:r(()=>[...u[65]||(u[65]=[p("Private",-1)])]),_:1}),l(t(q),{value:"Company"},{default:r(()=>[...u[66]||(u[66]=[p("Company",-1)])]),_:1}),l(t(q),{value:"Lease"},{default:r(()=>[...u[67]||(u[67]=[p("Lease",-1)])]),_:1}),l(t(q),{value:"Fleet"},{default:r(()=>[...u[68]||(u[68]=[p("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",yo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...u[69]||(u[69]=[p("Warranty Info",-1)])]),_:1}),l(t(de),{modelValue:c.value.warrantyInfo,"onUpdate:modelValue":u[24]||(u[24]=w=>c.value.warrantyInfo=w),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[25]||(u[25]=w=>C.$emit("close"))}),l(t(F),{label:v.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!V.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},bo={class:"w-full h-28 bg-muted rounded overflow-hidden mb-2"},ho=["src","alt"],xo={key:1,class:"w-full h-full flex items-center justify-center"},wo={class:"flex items-center justify-between mb-1.5"},ko={class:"text-sm font-bold text-foreground"},Co={class:"font-bold text-xs text-foreground mb-0.5 line-clamp-1"},Vo={class:"text-xs text-muted-foreground mb-1.5"},So={key:0,class:"text-xs text-green-600 font-medium mb-2"},$o={key:1,class:"text-xs text-orange-600 font-medium mb-2"},qe={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(s){const i=s,a=B(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[i.badge]||"gray"),o=f=>f?f.toLocaleString("en-US"):"0";return(f,v)=>(b(),k("div",{onClick:v[1]||(v[1]=x=>f.$emit("select")),class:j(["border border-border rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":s.selected}])},[e("div",bo,[s.vehicle.image?(b(),k("img",{key:0,src:s.vehicle.image,alt:`${s.vehicle.brand} ${s.vehicle.model}`,class:"w-full h-full object-cover"},null,8,ho)):(b(),k("div",xo,[...v[2]||(v[2]=[e("i",{class:"fa-solid fa-car text-muted-foreground opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",wo,[l(t(ot),{text:s.badge,size:"small",theme:a.value},null,8,["text","theme"]),e("span",ko,"€"+A(o(s.vehicle.price)),1)]),e("h4",Co,A(s.vehicle.brand)+" "+A(s.vehicle.model),1),e("p",Vo,A(s.vehicle.year),1),s.stockDays!==null&&s.stockDays!==void 0?(b(),k("div",So,[v[3]||(v[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),p(" In stock ("+A(s.stockDays)+" days) ",1)])):(b(),k("div",$o,[...v[4]||(v[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),p(" Out of stock ",-1)])])),e("button",{onClick:v[0]||(v[0]=Ce(x=>f.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},Io={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},To={key:0},Ao={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Mo={class:"mb-4"},Do={class:"relative"},Po={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Lo={key:1,class:"text-center py-8 text-muted-foreground"},Oo={class:"border border-border rounded-lg p-4 bg-muted"},Uo={key:0,class:"mt-4 space-y-4"},Fo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ro={class:"space-y-2"},qo={class:"space-y-2"},No={class:"space-y-2"},Eo={class:"space-y-2"},Bo={class:"flex justify-end"},zo=["disabled"],jo={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(s,{emit:i}){const a=s,o=i,f=I=>{I||o("close")},v=U(""),x=U(!1),c=U(null),V=U(null),D=U(null),m=U([]),C=U({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});be(async()=>{try{const I=await nt({});m.value=I.data||[]}catch(I){console.error("Failed to load vehicles:",I),m.value=[]}});const u=B(()=>a.requestedVehicle&&a.requestedVehicle.stockDays!==null&&a.requestedVehicle.stockDays!==void 0),w=B(()=>{const I=[];if(a.requestedVehicle&&u.value&&I.push({...a.requestedVehicle,isRequested:!0}),m.value&&m.value.length>0){const g=m.value.filter(h=>a.requestedVehicle?h.brand!==a.requestedVehicle.brand||h.model!==a.requestedVehicle.model:!0),P=a.requestedVehicle&&u.value?3:4;I.push(...g.slice(0,P))}return I}),T=B(()=>{if(!m.value||m.value.length===0)return[];let I=[...m.value];if(v.value){const g=v.value.toLowerCase();I=I.filter(P=>P.brand.toLowerCase().includes(g)||P.model.toLowerCase().includes(g)||P.year.toString().includes(g))}return I}),d=B(()=>C.value.brand&&C.value.model&&C.value.year&&C.value.price>0),N=(I,g)=>{c.value=I,V.value=I.id||`custom-${Date.now()}`,D.value=g},W=()=>{if(!d.value)return;const I={...C.value,id:`custom-${Date.now()}`,isCustom:!0};N(I,"custom")},E=()=>{c.value&&(o("vehicle-selected",{vehicle:c.value,type:D.value}),o("close"),c.value=null,V.value=null,D.value=null,v.value="",x.value=!1,C.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(I,g)=>(b(),z(t(se),{open:s.show,"onUpdate:open":f},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-6xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[l(t(te),{class:"flex-shrink-0"},{default:r(()=>[l(t(le),null,{default:r(()=>[...g[7]||(g[7]=[p("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",Io,[w.value.length?(b(),k("div",To,[g[8]||(g[8]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),p(" Recommended Vehicles ")],-1)),e("div",Ao,[(b(!0),k(H,null,Z(w.value,P=>(b(),z(qe,{key:P.id,vehicle:P,badge:P.isRequested?"Requested":"Recommended","stock-days":P.stockDays,selected:V.value===P.id,onSelect:h=>N(P,P.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):L("",!0),e("div",null,[g[11]||(g[11]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),p(" Browse Stock ")],-1)),e("div",Mo,[e("div",Do,[g[9]||(g[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-muted-foreground text-sm"},null,-1)),pe(e("input",{"onUpdate:modelValue":g[0]||(g[0]=P=>v.value=P),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-border rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Ve,v.value]])])]),T.value.length?(b(),k("div",Po,[(b(!0),k(H,null,Z(T.value,P=>(b(),z(qe,{key:P.id,vehicle:P,badge:"In Stock","stock-days":P.stockDays,selected:V.value===P.id,onSelect:h=>N(P,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(b(),k("div",Lo,[...g[10]||(g[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-muted-foreground"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[g[19]||(g[19]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),p(" Configure Custom Vehicle ")],-1)),e("div",Oo,[g[18]||(g[18]=e("p",{class:"text-xs text-muted-foreground mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:g[1]||(g[1]=P=>x.value=!x.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[g[12]||(g[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),p(" "+A(x.value?"Hide Configuration":"Build Custom Configuration"),1)]),x.value?(b(),k("div",Uo,[e("div",Fo,[e("div",Ro,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...g[13]||(g[13]=[p("Brand",-1)])]),_:1}),l(t(O),{modelValue:C.value.brand,"onUpdate:modelValue":g[2]||(g[2]=P=>C.value.brand=P),type:"text",class:"w-full h-10",placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",qo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...g[14]||(g[14]=[p("Model",-1)])]),_:1}),l(t(O),{modelValue:C.value.model,"onUpdate:modelValue":g[3]||(g[3]=P=>C.value.model=P),type:"text",class:"w-full h-10",placeholder:"e.g., e-tron GT"},null,8,["modelValue"])]),e("div",No,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...g[15]||(g[15]=[p("Year",-1)])]),_:1}),l(t(O),{modelValue:C.value.year,"onUpdate:modelValue":g[4]||(g[4]=P=>C.value.year=P),type:"number",class:"w-full h-10",placeholder:"2024"},null,8,["modelValue"])]),e("div",Eo,[l(t($),{class:"block text-sm font-semibold text-foreground"},{default:r(()=>[...g[16]||(g[16]=[p("Price (€)",-1)])]),_:1}),l(t(O),{modelValue:C.value.price,"onUpdate:modelValue":g[5]||(g[5]=P=>C.value.price=P),type:"number",class:"w-full h-10",placeholder:"98000"},null,8,["modelValue"])])]),e("div",Bo,[e("button",{onClick:W,disabled:!d.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...g[17]||(g[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),p(" Use Custom Configuration ",-1)])],8,zo)])])):L("",!0)])])]),l(t(ye),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:g[6]||(g[6]=P=>I.$emit("close"))}),c.value?(b(),z(t(F),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:E})):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},_o={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Wo={key:0,class:"flex justify-between items-center mb-4"},Ho={class:"text-sm font-bold text-foreground"},Qo={key:1,class:"mb-6"},Yo={class:"bg-white border border-border rounded-lg shadow-nsc-card overflow-hidden p-6"},Go={class:"space-y-3"},Ko={key:2,class:"mb-6 p-4 bg-muted rounded-lg border border-border"},Zo={class:"flex items-center gap-3"},Jo={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},Xo=["src"],ea={key:1,class:"fa-solid fa-car text-muted-foreground w-full h-full flex items-center justify-center"},ta={class:"font-bold text-sm text-foreground"},la={class:"text-xs text-muted-foreground"},sa={key:3,class:"space-y-3"},oa={class:"border border-border rounded-lg bg-white shadow-nsc-card"},aa={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},na={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ra={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},da={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ia={key:0,class:"border border-border rounded-lg bg-white shadow-nsc-card"},ua={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ma={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fa={class:"border border-border rounded-lg bg-white shadow-nsc-card"},pa={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},va={class:"space-y-3"},ga={class:"flex items-center gap-2"},ya={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted rounded-lg"},ba={class:"border border-border rounded-lg bg-white shadow-nsc-card"},ha={class:"flex items-center gap-2"},xa={class:"text-xs text-muted-foreground"},wa={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},ka={class:"flex justify-end"},Ca={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Va={class:"md:col-span-2"},Sa={class:"flex justify-between items-end gap-2"},$a={class:"grid grid-cols-2 gap-3"},Ia={class:"flex justify-end"},Ta={class:"text-sm font-semibold text-foreground"},Aa={key:0,class:"text-center py-6 text-muted-foreground text-xs"},Ma={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Da={class:"flex items-center gap-2"},Pa={class:"text-xs text-muted-foreground"},La={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Oa={class:"flex justify-end"},Ua={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fa={class:"flex justify-between items-center"},Ra={key:0,class:"text-center py-6 text-muted-foreground text-xs"},qa={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Na={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},Ea={class:"flex items-center gap-2"},Ba={class:"border border-border rounded-lg bg-white shadow-nsc-card"},za={class:"flex items-center gap-2"},ja={class:"text-xs text-muted-foreground"},_a={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Wa={class:"flex justify-end"},Ha={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Qa={class:"flex justify-between items-center"},Ya={key:0,class:"text-center py-6 text-muted-foreground text-xs"},Ga={key:1,class:"bg-muted rounded-lg p-4 mt-4 space-y-2"},Ka={class:"flex justify-between items-center"},Za={class:"text-sm font-bold text-foreground"},Ja={class:"flex justify-between items-center"},Xa={class:"text-sm font-bold text-foreground"},en={key:0,class:"text-xs text-red-600"},tn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},ln={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},sn={class:"space-y-3 pt-3 border-t border-border"},on={class:"flex items-start gap-2"},an={class:"flex items-start gap-2"},nn={key:4,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},rn={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(s,{expose:i,emit:a}){const o=s,f=a,v=U("select"),x=U(!1),c=U(!1),V=U(!1),D=U(!1),m=U(!1),C=U(!1),u=U(!1),w=U(!1),T=U(!1),d=U({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null}),N=B(()=>!!o.customer),W=B(()=>{let R=d.value.price||0;return d.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),d.value.showVat?R-E.value:R}),E=B(()=>{if(!d.value.showVat||!d.value.vatRate)return 0;let R=d.value.price||0;return d.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),R*d.value.vatRate/(100+d.value.vatRate)}),I=B(()=>{let R=d.value.price||0;return d.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),d.value.discounts.forEach(n=>{R-=n.price||0}),d.value.tradeIn.valuation&&(R-=d.value.tradeIn.valuation),R}),g=B(()=>d.value.paymentMethods.reduce((R,n)=>R+(n.amount||0),0)),P=B(()=>d.value.paymentMethods.length===0?!0:Math.abs(g.value-I.value)<.01),h=()=>{d.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},y=R=>{d.value.quotationItems.splice(R,1)},M=()=>{d.value.discounts.push({title:"",price:0,vatInclusive:!0})},ue=R=>{d.value.discounts.splice(R,1)},Se=()=>{d.value.paymentMethods.push({description:"",amount:0,paid:!1})},Be=R=>{d.value.paymentMethods.splice(R,1)},Ae=()=>{if(o.customer){const R=(o.customer.name||"").split(" ");d.value.firstName=R[0]||"",d.value.lastName=R.slice(1).join(" ")||"",d.value.email=o.customer.email||"",d.value.phone=o.customer.phone||"",d.value.address=o.customer.address||"",d.value.city=o.customer.city||"",d.value.zipCode=o.customer.zipCode||o.customer.postalCode||""}};be(()=>{Ae(),o.item&&(v.value="manual"),o.selectedVehicle&&(v.value="manual"),o.selectedVehicle&&(d.value.price=o.selectedVehicle.price||0,d.value.brand=o.selectedVehicle.brand||"",d.value.model=o.selectedVehicle.model||"",d.value.year=o.selectedVehicle.year||"",d.value.image=o.selectedVehicle.image||""),o.item&&o.item.data&&(d.value={...d.value,...o.item.data,price:o.item.data.price||o.item.data.total||0,financingType:o.item.data.financingType||o.item.data.paymentMethod||"",notes:o.item.data.notes||o.item.data.description||"",showVat:o.item.data.showVat||!1,vatRate:o.item.data.vatRate||21,quotationItems:o.item.data.quotationItems||[],discounts:o.item.data.discounts||[],tradeIn:o.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:o.item.data.paymentMethods||[],expirationDate:o.item.data.expirationDate||null})}),ne(()=>o.selectedVehicle,R=>{R&&!o.item&&(v.value="manual",d.value.price=R.price||0,d.value.brand=R.brand||"",d.value.model=R.model||"",d.value.year=R.year||"",d.value.image=R.image||"")}),ne(()=>o.customer,()=>{Ae()});const $e=B(()=>{const R=d.value.salutation!==""&&d.value.firstName!==""&&d.value.lastName!==""&&d.value.email!==""&&d.value.zipCode!==""&&d.value.price>0&&d.value.financingType!==""&&d.value.privacyConsent===!0,n=o.selectedVehicle||v.value==="manual",ce=P.value;return R&&n&&ce}),ke=R=>R?(typeof R=="string"?parseFloat(R):R).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",ze=R=>{const n=R.vehicle;d.value.brand=n.brand||"",d.value.model=n.model||"",d.value.year=n.year||"",d.value.price=n.price||0,d.value.image=n.image||"",v.value="manual",x.value=!1},Me=()=>{var n,ce;if(!$e.value)return;const R={id:((n=o.item)==null?void 0:n.id)||Date.now(),type:"offer",action:o.item?"updated an offer":"created an offer",data:{salutation:d.value.salutation,firstName:d.value.firstName,lastName:d.value.lastName,email:d.value.email,phone:d.value.phone,zipCode:d.value.zipCode,address:d.value.address,city:d.value.city,brand:d.value.brand,model:d.value.model,year:d.value.year,image:d.value.image,price:d.value.price,total:I.value,paymentMethod:d.value.financingType,financingType:d.value.financingType,downPayment:d.value.downPayment,monthlyPayment:d.value.monthlyPayment,term:d.value.term,interestRate:d.value.interestRate,notes:d.value.notes,description:d.value.notes,privacyConsent:d.value.privacyConsent,marketingConsent:d.value.marketingConsent,showVat:d.value.showVat,vatRate:d.value.vatRate,vatAmount:E.value,subtotal:W.value,quotationItems:d.value.quotationItems,discounts:d.value.discounts,tradeIn:d.value.tradeIn,paymentMethods:d.value.paymentMethods,expirationDate:d.value.expirationDate,grandTotal:I.value},timestamp:((ce=o.item)==null?void 0:ce.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",R)};return i({submit:Me,isValid:$e,offerData:d}),(R,n)=>{var ce,De,Pe,Le,Oe,Ue;return b(),k("div",_o,[s.hideHeader?L("",!0):(b(),k("div",Wo,[e("h5",Ho,A(s.item?"Edit Offer":"Create Offer"),1),l(t(F),{variant:"ghost",size:"icon",onClick:n[0]||(n[0]=S=>R.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},{default:r(()=>[...n[37]||(n[37]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!s.selectedVehicle&&!s.item&&v.value==="select"?(b(),k("div",Qo,[e("div",Yo,[n[41]||(n[41]=e("h6",{class:"text-sm font-semibold text-foreground mb-4"},"Select Vehicle",-1)),n[42]||(n[42]=e("p",{class:"text-xs text-muted-foreground mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),e("div",Go,[l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[1]||(n[1]=S=>x.value=!0)},{default:r(()=>[...n[38]||(n[38]=[e("i",{class:"fa-solid fa-warehouse mr-2"},null,-1),p(" Add from Stock — Search and select an existing vehicle from inventory ",-1)])]),_:1}),l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[2]||(n[2]=S=>x.value=!0)},{default:r(()=>[...n[39]||(n[39]=[e("i",{class:"fa-solid fa-cog mr-2"},null,-1),p(" Configure Vehicle — Build/customize a new vehicle ",-1)])]),_:1}),l(t(F),{variant:"outline",class:"w-full justify-start",onClick:n[3]||(n[3]=S=>v.value="manual")},{default:r(()=>[...n[40]||(n[40]=[e("i",{class:"fa-solid fa-pen-to-square mr-2"},null,-1),p(" Skip & Enter Manually — Create vehicle data from scratch ",-1)])]),_:1})])])])):L("",!0),s.selectedVehicle||v.value==="manual"&&d.value.brand?(b(),k("div",Ko,[n[43]||(n[43]=e("p",{class:"text-xs text-muted-foreground mb-2"},"Creating offer for:",-1)),e("div",Zo,[e("div",Jo,[(ce=s.selectedVehicle)!=null&&ce.image||d.value.image?(b(),k("img",{key:0,src:((De=s.selectedVehicle)==null?void 0:De.image)||d.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Xo)):(b(),k("i",ea))]),e("div",null,[e("h4",ta,A(((Pe=s.selectedVehicle)==null?void 0:Pe.brand)||d.value.brand)+" "+A(((Le=s.selectedVehicle)==null?void 0:Le.model)||d.value.model)+" ("+A(((Oe=s.selectedVehicle)==null?void 0:Oe.year)||d.value.year)+") ",1),e("p",la,"Base Price: € "+A(ke(((Ue=s.selectedVehicle)==null?void 0:Ue.price)||d.value.price)),1)])])])):L("",!0),s.selectedVehicle||v.value==="manual"||s.item?(b(),k("div",sa,[e("div",oa,[e("button",{type:"button",onClick:n[4]||(n[4]=S=>c.value=!c.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors rounded-t-lg"},[n[44]||(n[44]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Personal Information"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",c.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),c.value?(b(),k("div",aa,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[45]||(n[45]=[p("Salutation ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:d.value.salutation,"onUpdate:modelValue":n[5]||(n[5]=S=>d.value.salutation=S)},{default:r(()=>[l(t(Q),{class:"w-full"},{default:r(()=>[l(t(Y),{placeholder:"Select salutation"})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"Mr."},{default:r(()=>[...n[46]||(n[46]=[p("Mr.",-1)])]),_:1}),l(t(q),{value:"Mrs."},{default:r(()=>[...n[47]||(n[47]=[p("Mrs.",-1)])]),_:1}),l(t(q),{value:"Ms."},{default:r(()=>[...n[48]||(n[48]=[p("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",na,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[49]||(n[49]=[p("First Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(O),{modelValue:d.value.firstName,"onUpdate:modelValue":n[6]||(n[6]=S=>d.value.firstName=S),placeholder:"Enter first name",disabled:N.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[50]||(n[50]=[p("Last Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(O),{modelValue:d.value.lastName,"onUpdate:modelValue":n[7]||(n[7]=S=>d.value.lastName=S),placeholder:"Enter last name",disabled:N.value},null,8,["modelValue","disabled"])])]),e("div",ra,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[51]||(n[51]=[p("Email ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(O),{type:"email",modelValue:d.value.email,"onUpdate:modelValue":n[8]||(n[8]=S=>d.value.email=S),placeholder:"email@example.com",disabled:N.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[52]||(n[52]=[p("Phone Number",-1)])]),_:1}),l(t(O),{type:"tel",modelValue:d.value.phone,"onUpdate:modelValue":n[9]||(n[9]=S=>d.value.phone=S),placeholder:"+1 (555) 000-0000",disabled:N.value},null,8,["modelValue","disabled"])])]),e("div",da,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[53]||(n[53]=[p("ZIP / Postal Code ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(O),{modelValue:d.value.zipCode,"onUpdate:modelValue":n[10]||(n[10]=S=>d.value.zipCode=S),placeholder:"Enter ZIP code",disabled:N.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[54]||(n[54]=[p("City",-1)])]),_:1}),l(t(O),{modelValue:d.value.city,"onUpdate:modelValue":n[11]||(n[11]=S=>d.value.city=S),placeholder:"Enter city",disabled:N.value},null,8,["modelValue","disabled"])])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[55]||(n[55]=[p("Address / Street",-1)])]),_:1}),l(t(O),{modelValue:d.value.address,"onUpdate:modelValue":n[12]||(n[12]=S=>d.value.address=S),placeholder:"Enter street address",disabled:N.value},null,8,["modelValue","disabled"])])])):L("",!0)]),v.value==="manual"&&!s.selectedVehicle?(b(),k("div",ia,[e("button",{type:"button",onClick:n[13]||(n[13]=S=>V.value=!V.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[n[56]||(n[56]=e("h6",{class:"text-sm font-semibold text-foreground"},"Vehicle Details",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",V.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),V.value?(b(),k("div",ua,[e("div",ca,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[57]||(n[57]=[p("Brand",-1)])]),_:1}),l(t(O),{modelValue:d.value.brand,"onUpdate:modelValue":n[14]||(n[14]=S=>d.value.brand=S),placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[58]||(n[58]=[p("Model",-1)])]),_:1}),l(t(O),{modelValue:d.value.model,"onUpdate:modelValue":n[15]||(n[15]=S=>d.value.model=S),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),e("div",ma,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[59]||(n[59]=[p("Year",-1)])]),_:1}),l(t(O),{type:"number",modelValue:d.value.year,"onUpdate:modelValue":n[16]||(n[16]=S=>d.value.year=S),placeholder:"2024"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[60]||(n[60]=[p("Image URL",-1)])]),_:1}),l(t(O),{modelValue:d.value.image,"onUpdate:modelValue":n[17]||(n[17]=S=>d.value.image=S),placeholder:"https://..."},null,8,["modelValue"])])])])):L("",!0)])):L("",!0),e("div",fa,[e("button",{type:"button",onClick:n[18]||(n[18]=S=>D.value=!D.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[n[61]||(n[61]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Pricing & Financing"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",D.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),D.value?(b(),k("div",pa,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[62]||(n[62]=[p("Base Price (€) ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(O),{type:"number",modelValue:d.value.price,"onUpdate:modelValue":n[19]||(n[19]=S=>d.value.price=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[63]||(n[63]=[p("Financing Type ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:d.value.financingType,"onUpdate:modelValue":n[20]||(n[20]=S=>d.value.financingType=S)},{default:r(()=>[l(t(Q),{class:"w-full"},{default:r(()=>[l(t(Y),{placeholder:"Select financing type"})]),_:1}),l(t(G),null,{default:r(()=>[l(t(q),{value:"cash"},{default:r(()=>[...n[64]||(n[64]=[p("Cash",-1)])]),_:1}),l(t(q),{value:"financing"},{default:r(()=>[...n[65]||(n[65]=[p("Financing",-1)])]),_:1}),l(t(q),{value:"leasing"},{default:r(()=>[...n[66]||(n[66]=[p("Leasing",-1)])]),_:1}),l(t(q),{value:"rental"},{default:r(()=>[...n[67]||(n[67]=[p("Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",va,[e("div",ga,[l(t(ae),{checked:d.value.showVat,"onUpdate:checked":n[21]||(n[21]=S=>d.value.showVat=S),id:"show-vat"},null,8,["checked"]),l(t($),{for:"show-vat",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:r(()=>[...n[68]||(n[68]=[p("Show VAT breakdown",-1)])]),_:1})]),d.value.showVat?(b(),k("div",ya,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[69]||(n[69]=[p("VAT %",-1)])]),_:1}),l(t(O),{type:"number",step:"0.1",modelValue:d.value.vatRate,"onUpdate:modelValue":n[22]||(n[22]=S=>d.value.vatRate=S),placeholder:"21"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[70]||(n[70]=[p("VAT €",-1)])]),_:1}),l(t(O),{type:"number",value:E.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[71]||(n[71]=[p("Subtotal €",-1)])]),_:1}),l(t(O),{type:"number",value:W.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):L("",!0)])])):L("",!0)]),e("div",ba,[e("button",{type:"button",onClick:n[23]||(n[23]=S=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",ha,[n[72]||(n[72]=e("h6",{class:"text-sm font-semibold text-foreground"},"Quotation Items",-1)),e("span",xa,"("+A(d.value.quotationItems.length)+" items)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(b(),k("div",wa,[e("div",ka,[l(t(F),{variant:"outline",size:"small",onClick:h},{default:r(()=>[...n[73]||(n[73]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),p(" Add Item ",-1)])]),_:1})]),(b(!0),k(H,null,Z(d.value.quotationItems,(S,re)=>(b(),k("div",{key:re,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Ca,[e("div",Va,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[74]||(n[74]=[p("Item Name",-1)])]),_:1}),l(t(O),{modelValue:S.name,"onUpdate:modelValue":_=>S.name=_,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Sa,[l(t(F),{variant:"ghost",size:"icon",onClick:_=>y(re),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:r(()=>[...n[75]||(n[75]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),e("div",$a,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[76]||(n[76]=[p("Price (€)",-1)])]),_:1}),l(t(O),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[77]||(n[77]=[p("Quantity",-1)])]),_:1}),l(t(O),{type:"number",modelValue:S.quantity,"onUpdate:modelValue":_=>S.quantity=_,placeholder:"1",value:S.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),e("div",Ia,[e("span",Ta,"Total: € "+A(ke((S.price||0)*(S.quantity||1))),1)])]))),128)),d.value.quotationItems.length===0?(b(),k("div",Aa," No quotation items added yet ")):L("",!0)])):L("",!0)]),e("div",Ma,[e("button",{type:"button",onClick:n[24]||(n[24]=S=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",Da,[n[78]||(n[78]=e("h6",{class:"text-sm font-semibold text-foreground"},"Discounts",-1)),e("span",Pa,"("+A(d.value.discounts.length)+" discounts)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(b(),k("div",La,[e("div",Oa,[l(t(F),{variant:"outline",size:"small",onClick:M},{default:r(()=>[...n[79]||(n[79]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),p(" Add Discount ",-1)])]),_:1})]),(b(!0),k(H,null,Z(d.value.discounts,(S,re)=>(b(),k("div",{key:re,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Ua,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[80]||(n[80]=[p("Discount Title",-1)])]),_:1}),l(t(O),{modelValue:S.title,"onUpdate:modelValue":_=>S.title=_,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[81]||(n[81]=[p("Amount (€)",-1)])]),_:1}),l(t(O),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Fa,[l(t($),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[l(t(ae),{checked:S.vatInclusive,"onUpdate:checked":_=>S.vatInclusive=_},null,8,["checked","onUpdate:checked"]),n[82]||(n[82]=e("span",{class:"text-xs text-muted-foreground"},"VAT inclusive",-1))]),_:2},1024),l(t(F),{variant:"ghost",size:"icon",onClick:_=>ue(re),class:"text-red-600 hover:text-red-700"},{default:r(()=>[...n[83]||(n[83]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),d.value.discounts.length===0?(b(),k("div",Ra," No discounts added yet ")):L("",!0)])):L("",!0)]),e("div",qa,[e("button",{type:"button",onClick:n[25]||(n[25]=S=>u.value=!u.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[n[84]||(n[84]=e("h6",{class:"text-sm font-semibold text-foreground"},"Trade-In",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",u.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),u.value?(b(),k("div",Na,[e("div",Ea,[l(t(ae),{checked:d.value.tradeIn.showOnPdf,"onUpdate:checked":n[26]||(n[26]=S=>d.value.tradeIn.showOnPdf=S),id:"show-tradein-pdf"},null,8,["checked"]),l(t($),{for:"show-tradein-pdf",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:r(()=>[...n[85]||(n[85]=[p("Show on PDF",-1)])]),_:1})]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[86]||(n[86]=[p("Trade-in Valuation (€)",-1)])]),_:1}),l(t(O),{type:"number",modelValue:d.value.tradeIn.valuation,"onUpdate:modelValue":n[27]||(n[27]=S=>d.value.tradeIn.valuation=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[87]||(n[87]=[p("Trade-in Notes",-1)])]),_:1}),l(t(de),{modelValue:d.value.tradeIn.notes,"onUpdate:modelValue":n[28]||(n[28]=S=>d.value.tradeIn.notes=S),rows:"3",placeholder:"Add notes about the trade-in vehicle..."},null,8,["modelValue"])])])):L("",!0)]),e("div",Ba,[e("button",{type:"button",onClick:n[29]||(n[29]=S=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",za,[n[88]||(n[88]=e("h6",{class:"text-sm font-semibold text-foreground"},"Payment Methods",-1)),e("span",ja,"("+A(d.value.paymentMethods.length)+" methods)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(b(),k("div",_a,[e("div",Wa,[l(t(F),{variant:"outline",size:"small",onClick:Se},{default:r(()=>[...n[89]||(n[89]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),p(" Add Payment Method ",-1)])]),_:1})]),(b(!0),k(H,null,Z(d.value.paymentMethods,(S,re)=>(b(),k("div",{key:re,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Ha,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[90]||(n[90]=[p("Description",-1)])]),_:1}),l(t(O),{modelValue:S.description,"onUpdate:modelValue":_=>S.description=_,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[91]||(n[91]=[p("Amount (€)",-1)])]),_:1}),l(t(O),{type:"number",modelValue:S.amount,"onUpdate:modelValue":_=>S.amount=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Qa,[l(t($),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[l(t(ae),{checked:S.paid,"onUpdate:checked":_=>S.paid=_},null,8,["checked","onUpdate:checked"]),n[92]||(n[92]=e("span",{class:"text-xs text-muted-foreground"},"PAID",-1))]),_:2},1024),l(t(F),{variant:"ghost",size:"icon",onClick:_=>Be(re),class:"text-red-600 hover:text-red-700"},{default:r(()=>[...n[93]||(n[93]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),d.value.paymentMethods.length===0?(b(),k("div",Ya," No payment methods added yet ")):L("",!0),d.value.paymentMethods.length>0?(b(),k("div",Ga,[e("div",Ka,[n[94]||(n[94]=e("span",{class:"text-xs font-medium text-muted-foreground"},"Payment Methods Total:",-1)),e("span",Za,"€ "+A(ke(g.value)),1)]),e("div",Ja,[n[95]||(n[95]=e("span",{class:"text-xs font-medium text-muted-foreground"},"Grand Total:",-1)),e("span",Xa,"€ "+A(ke(I.value)),1)]),P.value?L("",!0):(b(),k("div",en," ⚠️ Payment methods must equal Grand Total "))])):L("",!0)])):L("",!0)]),e("div",tn,[e("button",{type:"button",onClick:n[30]||(n[30]=S=>T.value=!T.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[n[96]||(n[96]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Terms & Conditions"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",T.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),T.value?(b(),k("div",ln,[e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[97]||(n[97]=[p("Notes / Comments",-1)])]),_:1}),l(t(de),{modelValue:d.value.notes,"onUpdate:modelValue":n[31]||(n[31]=S=>d.value.notes=S),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),e("div",null,[l(t($),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:r(()=>[...n[98]||(n[98]=[p("Offer Expiration Date",-1)])]),_:1}),l(t(O),{type:"date",modelValue:d.value.expirationDate,"onUpdate:modelValue":n[32]||(n[32]=S=>d.value.expirationDate=S)},null,8,["modelValue"])]),e("div",sn,[n[101]||(n[101]=e("h6",{class:"text-xs font-semibold text-foreground"},"Privacy & Consent",-1)),e("div",on,[l(t(ae),{checked:d.value.privacyConsent,"onUpdate:checked":n[33]||(n[33]=S=>d.value.privacyConsent=S),id:"privacy-consent"},null,8,["checked"]),l(t($),{for:"privacy-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:r(()=>[...n[99]||(n[99]=[p(" I agree to the privacy policy ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1})]),e("div",an,[l(t(ae),{checked:d.value.marketingConsent,"onUpdate:checked":n[34]||(n[34]=S=>d.value.marketingConsent=S),id:"marketing-consent"},null,8,["checked"]),l(t($),{for:"marketing-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:r(()=>[...n[100]||(n[100]=[p(" I want to receive marketing communications ",-1)])]),_:1})])])])):L("",!0)])])):L("",!0),s.hideActions?L("",!0):(b(),k("div",nn,[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:n[35]||(n[35]=S=>R.$emit("cancel"))}),l(t(F),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!$e.value,onClick:Me},null,8,["label","disabled"])])),l(jo,{show:x.value,"requested-vehicle":s.selectedVehicle,"opportunity-id":s.taskId,onClose:n[36]||(n[36]=S=>x.value=!1),onVehicleSelected:ze},null,8,["show","requested-vehicle","opportunity-id"])])}}},dn={class:"flex-1 overflow-y-auto p-6 w-full"},Pn={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(s,{emit:i}){const a=i,o=U(null),f=B(()=>{var V;return((V=o.value)==null?void 0:V.isValid)||!1}),v=()=>{var V;(V=o.value)==null||V.submit()},x=V=>{V||a("close")},c=V=>{a("save",V),a("close")};return(V,D)=>(b(),z(t(se),{open:s.show,"onUpdate:open":x},{default:r(()=>[l(t(J),null,{default:r(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:r(()=>[l(t(te),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:r(()=>[l(t(le),null,{default:r(()=>[...D[2]||(D[2]=[p("Create Offer",-1)])]),_:1})]),_:1}),e("div",dn,[l(rn,{item:s.item,"task-type":s.taskType,"task-id":s.taskId,"selected-vehicle":s.requestedCar,customer:s.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:o,onSave:c,onCancel:D[0]||(D[0]=m=>V.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),l(t(ye),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:r(()=>[l(t(F),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:D[1]||(D[1]=m=>V.$emit("close"))}),l(t(F),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:v},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Ln(s){const i=s.lead;if(!i)return null;const a=ge(i,"lead");if(!a)return console.warn("No display stage calculated for lead"),null;const o=he[a];if(!o)return console.warn(`No state config found for lead stage: ${a}`),null;if(!o.primaryAction)return console.warn(`No primary action found for lead stage: ${a}`),null;const f=o.primaryAction;if(typeof f=="function"){const v=f({lead:i,displayStage:a});return v||console.warn(`Primary action function returned null for lead stage: ${a}`),v}return f}function On(s){const i=s.lead;if(!i)return[];const a=ge(i,"lead"),o=he[a];return o?o.secondaryActions||[]:[]}function Ee(s){const i=s.lead;if(!i||!(i.isDisqualified===!0))return!1;const o=ge(i,"lead");return o===oe.CLOSED_INVALID||o===oe.CLOSED_NOT_INTERESTED||o===oe.CLOSED_DUPLICATE}function Un(s){const i=s.lead;if(!i||Ee(s))return!1;const a=ge(i,"lead"),o=he[a];return o?typeof o.showLQWidget=="function"?o.showLQWidget(i):o.showLQWidget??!1:!1}function Fn(s){const i=s.lead;if(!i||Ee(s))return!1;const a=ge(i,"lead"),o=he[a];return o?o.showDeadlineBanner&&i.nextActionDue:!1}function Rn(s){const i=s.lead;if(!i)return!1;const a=ge(i,"lead"),o=he[a];return o?o.canPostpone??!1:!1}function qn(s){const i=s.lead;if(!i)return"qualification";const a=ge(i,"lead"),o=he[a];return o&&o.lqWidgetMode||"qualification"}function Nn(){const s=rt();return{saveTradeInVehicle:async(o,f,v,x={})=>{try{const c=await s.addVehicle(v),V={type:"tradein",action:"added a trade-in",vehicleId:c.id,data:{brand:v.brand,model:v.model,version:v.version||null,year:v.year,kilometers:v.kilometers||0,plates:v.plates||null,registration:v.registration||null,vin:v.vin||null,fuelType:v.fuelType||null,gearType:v.gearType||null,tradeInPrice:x.tradeInPrice||null,evaluationRangeLow:x.evaluationRangeLow||null,evaluationRangeHigh:x.evaluationRangeHigh||null,provider:x.provider||null,evaluationDate:x.evaluationDate||null,priceToBuy:x.priceToBuy||null,priceToSell:x.priceToSell||null,priceOfVehicle:x.priceOfVehicle||null,priceOfOptionals:x.priceOfOptionals||null,listOfOptionals:x.listOfOptionals||null}};let D;if(o==="lead")D=await et(f,V);else if(o==="opportunity")D=await tt(f,V);else throw new Error(`Invalid taskType: ${o}`);return{vehicle:c,activity:D}}catch(c){throw console.error("Error saving trade-in vehicle:",c),c}},updateTradeInVehicle:async(o,f,v,x,c,V={})=>{try{const D=await s.modifyVehicle(v,c),m={data:{brand:c.brand,model:c.model,version:c.version||null,year:c.year,kilometers:c.kilometers||0,plates:c.plates||null,registration:c.registration||null,vin:c.vin||null,fuelType:c.fuelType||null,gearType:c.gearType||null,tradeInPrice:V.tradeInPrice||null,evaluationRangeLow:V.evaluationRangeLow||null,evaluationRangeHigh:V.evaluationRangeHigh||null,provider:V.provider||null,evaluationDate:V.evaluationDate||null,priceToBuy:V.priceToBuy||null,priceToSell:V.priceToSell||null,priceOfVehicle:V.priceOfVehicle||null,priceOfOptionals:V.priceOfOptionals||null,listOfOptionals:V.listOfOptionals||null}};let C;if(o==="lead")C=await Je(f,x,m);else if(o==="opportunity")C=await Xe(f,x,m);else throw new Error(`Invalid taskType: ${o}`);return{vehicle:D,activity:C}}catch(D){throw console.error("Error updating trade-in vehicle:",D),D}}}}function me(s){if(!s)return 0;const i=new Date(s),o=Math.abs(new Date-i);return Math.ceil(o/(1e3*60*60*24))}const ve={"no-appointment":s=>!s.scheduledAppointment,"has-appointment":s=>!!s.scheduledAppointment,"appointment-past-not-completed":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)<new Date&&s.scheduledAppointment.status!=="completed":!1,"has-future-appointment":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)>new Date:!1,"no-offers":s=>!s.hasOffers,"has-offers":s=>s.hasOffers,"qualified-no-offers-7-13-days":s=>{const i=fe(),a=i.getSetting("oofbMinDays"),o=i.getSetting("oofbMaxDays"),f=me(s.opportunity.createdAt);return f>=a&&f<o+1&&!s.hasOffers},"qualified-no-offers-14-plus-days":s=>{const a=fe().getSetting("ufbDays");return me(s.opportunity.createdAt)>=a&&!s.hasOffers},"negotiation-offer-sent-substatus":s=>{var i;return((i=s.opportunity)==null?void 0:i.negotiationSubstatus)==="Offer Sent"},"negotiation-offer-feedback-substatus":s=>{var i;return((i=s.opportunity)==null?void 0:i.negotiationSubstatus)==="Offer Feedback"},"negotiation-offer-accepted-substatus":s=>{var i;return((i=s.opportunity)==null?void 0:i.negotiationSubstatus)==="Offer Accepted"},"negotiation-offer-sent-3-days":s=>{var o,f;if(((o=s.opportunity)==null?void 0:o.negotiationSubstatus)!=="Offer Sent"||!((f=s.opportunity)!=null&&f.offers)||s.opportunity.offers.length===0)return!1;const i=s.opportunity.offers.filter(v=>v.status==="active").sort((v,x)=>new Date(x.createdAt)-new Date(v.createdAt))[0];return i?me(i.createdAt)>=3:!1},"negotiation-5-plus-days-no-contract-has-offers":s=>{if(s.stage==="In Negotiation"&&!s.hasOffers)return!1;const a=fe().getSetting("ofbDays");return me(s.opportunity.lastActivity||s.opportunity.createdAt)>=a&&!s.opportunity.contractDate&&s.hasOffers},"negotiation-offer-feedback-5-plus-days-no-appointment":s=>{var v;if(((v=s.opportunity)==null?void 0:v.negotiationSubstatus)!=="Offer Feedback"||!s.hasOffers)return!1;const a=fe().getSetting("nfuDays"),o=me(s.opportunity.lastActivity||s.opportunity.createdAt),f=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date;return o>=a&&!s.opportunity.contractDate&&!f},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":s=>ve["negotiation-offer-feedback-5-plus-days-no-appointment"](s),"contract-7-plus-days-no-delivery":s=>{var v;if(!s.opportunity.contractDate)return!1;const a=fe().getSetting("cfbDays"),o=me(s.opportunity.contractDate),f=(v=s.activities)==null?void 0:v.some(x=>{var c;return x.type==="delivery"||((c=x.action)==null?void 0:c.toLowerCase().includes("delivered"))});return o>=a&&!f},"delivery-feedback-required":s=>s.deliverySubstatus==="Delivered","is-awaiting-delivery":s=>s.deliverySubstatus==="Awaiting Delivery","is-delivered":s=>s.deliverySubstatus==="Delivered","has-no-delivery":s=>!s.deliverySubstatus||s.deliverySubstatus===null,"is-closed":s=>{const i=s.stage;return i==="Closed Won"||i==="Closed Lost"},"is-closed-with-task-widget":s=>ve["is-closed"](s)&&s.hasActiveTaskWidget,"opportunity-abandoned":s=>{if(ve["is-closed"](s))return!1;const i=fe(),a=i.getSetting("abandonedOpportunityDays");if(!i.getSetting("abandonedEligibleStages").includes(s.stage))return!1;const f=s.opportunity.lastActivity||s.opportunity.createdAt;return me(f)>=a}};function En(s,i){if(ve["is-closed-with-task-widget"](i))return[Ie.reopen,Ie.requalify,Ie.closeLost];const a=Te[s];return!a||!a.secondaryActions?[]:a.secondaryActions.filter(o=>{if(!o.conditional)return!0;const f=ve[o.conditional];return f?f(i):!0})}function Bn(s,i){const a=Te[s];if(!a||!a.taskWidgets)return null;const f=fe().getSetting("autoCloseWidgetsOnClose"),v=ve["is-closed"]({stage:s});for(const x of a.taskWidgets){if(f&&v&&(x.type==="NFU"||x.type==="OFB"))continue;const c=ve[x.condition];if(c&&c(i))return x.type}return null}function zn(s,i){const a=Te[s];if(!a||!a.primaryAction)return null;let o=a.primaryAction;return typeof o=="function"&&(o=o(i),!o)?null:{...o,title:typeof o.title=="function"?o.title(i):o.title,description:typeof o.description=="function"?o.description(i):o.description,label:typeof o.label=="function"?o.label(i):o.label}}function jn(s){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Post-Delivery Customer Satisfaction Survey",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[s]||"Task"}function _n(s){return s==="Closed Won"||s==="Closed Lost"}export{zn as A,En as B,_n as C,jn as D,ut as E,rn as F,jo as G,Jl as H,Hl as I,El as J,he as L,Te as O,Mn as P,Cn as T,kn as _,Fe as a,gn as b,bn as c,xn as d,wn as e,vn as f,hn as g,Vn as h,Sn as i,$n as j,In as k,Tn as l,An as m,Dn as n,Pn as o,Ee as p,Ln as q,On as r,Un as s,Fn as t,Rn as u,qn as v,yn as w,pt as x,Nn as y,Bn as z};
