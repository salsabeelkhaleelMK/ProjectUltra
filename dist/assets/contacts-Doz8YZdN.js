const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D-GV69Dn.js","assets/index-C6dtcYjV.css"])))=>i.map(i=>d[i]);
import{as as i,_ as w,bC as y,bD as l,bE as I,bF as C,aO as m}from"./index-D-GV69Dn.js";const d=(r=300)=>new Promise(e=>setTimeout(e,r)),f=()=>i.filter(r=>!r.company||r.company===""),E=async(r={})=>{await d();let e=f();if(r.search){const t=r.search.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(t)||s.email.toLowerCase().includes(t))}return{data:e,total:e.length}},q=async r=>{await d();const t=f().find(s=>s.id===parseInt(r));if(!t)throw new Error("Contact not found");return t},A=async r=>{await d();const e={id:i.length+1,...r,company:null,createdAt:new Date().toISOString(),lastContact:new Date().toISOString()};return i.push(e),e},_=async(r,e)=>{if(await d(),f().findIndex(o=>o.id===parseInt(r))===-1)throw new Error("Contact not found");const a=i.findIndex(o=>o.id===parseInt(r));return a!==-1&&(i[a]={...i[a],...e,company:null}),i[a]},v=async r=>{await d();const e=i.findIndex(t=>t.id===parseInt(r));if(e===-1)throw new Error("Contact not found");return i.splice(e,1),{success:!0}},O=async(r,e)=>{if(await d(),!f().find(o=>o.id===parseInt(r)))throw new Error("Contact not found");const a=i.findIndex(o=>o.id===parseInt(r));if(a===-1)throw new Error("Contact not found");return i[a].requestedCar={...e,id:Date.now()},{...i[a]}},T=async r=>{await d();const t=f().find(o=>o.id===parseInt(r));if(!t)throw new Error("Contact not found");if(!t.requestedCar)throw new Error("Contact must have requested car");const{createLead:s}=await w(async()=>{const{createLead:o}=await import("./index-D-GV69Dn.js").then(p=>p.bI);return{createLead:o}},__vite__mapDeps([0,1]));return await s({customerId:t.id,requestedCar:t.requestedCar,source:t.source||"Direct",tags:t.tags||[],stage:"Open",status:"Open",priority:"Normal"})},k=async r=>{await d();const t=f().find(o=>o.id===parseInt(r));if(!t)throw new Error("Contact not found");if(!t.requestedCar)throw new Error("Contact must have requested car");const{createOpportunity:s}=await w(async()=>{const{createOpportunity:o}=await import("./index-D-GV69Dn.js").then(p=>p.bJ);return{createOpportunity:o}},__vite__mapDeps([0,1]));return await s({customerId:t.id,vehicle:t.requestedCar,source:t.source||"Direct",tags:t.tags||[],stage:"Qualified",value:t.requestedCar.price||0})},L=async(r,e=null)=>{await d();let t=[];e?t=l.filter(a=>{const o=a.account_id||a.accountId;return o&&parseInt(o)===parseInt(e)}):t=l.filter(a=>a.customerId===parseInt(r));const s=t.map(a=>({...a,contactReference:a.contactId?{id:a.contactId,name:a.contactName||"Unknown Contact"}:null}));return{data:s,total:s.length}},x=async(r,e=null)=>{await d();let t=[];e?t=I.filter(a=>{const o=a.account_id||a.accountId;return o&&parseInt(o)===parseInt(e)}):t=I.filter(a=>a.customerId===parseInt(r));const s=t.map(a=>({...a,contactReference:a.contactId?{id:a.contactId,name:a.contactName||"Unknown Contact"}:null}));return{data:s,total:s.length}},b=async r=>{await d();const e=[],t=i.find(n=>n.id===parseInt(r));t!=null&&t.id;const s=(t==null?void 0:t.company)&&t.company!=="";l.filter(n=>n.customerId===parseInt(r)).forEach(n=>{n.requestedCar&&e.push({...n.requestedCar,id:`requested-${n.id}`,type:"requested",leadId:n.id,leadStage:n.stage})}),t!=null&&t.requestedCar&&e.push({...t.requestedCar,id:`requested-contact-${t.id}`,type:"requested",contactId:t.id});const o=I.filter(n=>n.customerId===parseInt(r));if(o.forEach(n=>{C.filter(c=>c.opportunityId===n.id&&c.type==="offer").forEach(c=>{var u;(u=c.data)!=null&&u.vehicle&&e.push({...c.data.vehicle,id:`offered-${c.id}`,type:"offered",opportunityId:n.id,opportunityStage:n.stage,offerDate:c.timestamp})})}),m.filter(n=>n.customerId===parseInt(r)&&n.type==="test-drive").forEach(n=>{n.vehicle&&e.push({brand:n.vehicle.split(" ")[0]||"",model:n.vehicle.split(" ").slice(1).join(" ")||"",id:`drove-${n.id}`,type:"drove",eventId:n.id,testDriveDate:n.start,vehicle:n.vehicle})}),o.forEach(n=>{n.stage==="Closed Won"&&n.vehicle&&e.push({...n.vehicle,id:`purchased-${n.id}`,type:"purchased",opportunityId:n.id,purchaseDate:n.contractDate||n.lastActivity})}),s&&(t!=null&&t.vehicles)&&Array.isArray(t.vehicles)&&t.vehicles.forEach(n=>{(n.type==="owned"||!n.type)&&e.push({...n,id:n.id||`owned-${t.id}-${Date.now()}`,type:"owned",accountId:t.id})}),s){const n=t.id;f().filter(c=>{const u=c.account_id||c.accountId;return u&&parseInt(u)===parseInt(n)}).forEach(c=>{c.vehicles&&Array.isArray(c.vehicles)&&c.vehicles.forEach(u=>{u.type==="driven"&&e.push({...u,id:u.id||`driven-${c.id}-${Date.now()}`,type:"driven",contactId:c.id,contactName:c.name,accountId:n})})})}return{data:e,total:e.length}},$=async(r,e)=>{await d();const t=i.findIndex(o=>o.id===parseInt(r));if(t===-1)throw new Error("Customer not found");const s=i[t];s.vehicles||(s.vehicles=[]);const a={...e,id:e.id||Date.now()};return e.type==="requested"&&(s.requestedCar={brand:e.brand,model:e.model,year:e.year,price:e.price,requestType:e.requestType,requestMessage:e.requestMessage,image:e.image,dealership:e.dealership,fuelType:e.fuelType,gearType:e.gearType,kilometers:e.kilometers,id:a.id}),s.vehicles.push(a),i[t]=s,{...s}},S=async r=>{await d();const e=y.filter(t=>t.customerId===parseInt(r));return{data:e,total:e.length}},B=async r=>{await d();const t=f().filter(s=>{const a=s.account_id||s.accountId;return a&&parseInt(a)===parseInt(r)});return{data:t,total:t.length}};export{O as addRequestedCarToContact,$ as addVehicleToCustomer,T as convertContactToLead,k as convertContactToOpportunity,A as createContact,v as deleteContact,q as fetchContactById,E as fetchContacts,B as fetchContactsByAccountId,b as fetchCustomerCars,L as fetchLeadsByCustomerId,x as fetchOpportunitiesByCustomerId,S as fetchTasksByCustomerId,_ as updateContact};
