const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsTab-CtXMCzhG.js","assets/components-Ci9ddle2.js","assets/index-Db_3peLd.js","assets/index-B085vE-V.css","assets/toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js","assets/UnifiedAddForm-wanemrH9.js","assets/contacts-BPIU2ljN.js","assets/opportunities-CySWWyzd.js","assets/useCustomersTable-CD9F3w9b.js","assets/OpenLeadsTab-B7h-jxU4.js","assets/ComingSoonModal-ClD5EuQ6.js","assets/sparkles-CCfcFWX8.js","assets/vehicles-ygxbygEI.js","assets/ComingSoonModal-CLJjYt2p.css","assets/OpenOpportunitiesTab-DSLtrcEf.js","assets/InNegotiationTab-5KLfWOx8.js","assets/WonTab-D6VzZnTt.js","assets/LostTab-DSctKaIK.js"])))=>i.map(i=>d[i]);
import{r as x,l as q,c as w,x as N,o as p,B as u,s as r,y as i,e as l,k as M,t as X,d as V,p as m,N as c,u as Q,C as ee,m as te,h as ae,F,i as j,U as le,V as oe,W as D,g as se,_ as O}from"./index-Db_3peLd.js";import{_ as ne}from"./PageHeader-DewLlPvW.js";import{f as ie,F as ue,L as re,g as pe,h as de,K as me,C as ce,n as R,d as ve,a as fe,b as be,Z as ye,z as ke,X as ge}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import{u as we,a as Ce,D as he,T as xe}from"./useTaskFilters-CUVj16h1.js";import{_ as Te}from"./CustomerProfile-CMzwHkEQ.js";import{u as Ne}from"./opportunities-CySWWyzd.js";import{u as Ve}from"./UnifiedAddForm-wanemrH9.js";import"./ComingSoonModal-ClD5EuQ6.js";import"./sparkles-CCfcFWX8.js";import"./vehicles-ygxbygEI.js";import"./ReassignUserModal-Jtm4D-75.js";import"./users-Dyw3oNPt.js";import"./components-Ci9ddle2.js";import"./CreateEventModal-Y_RNkacC.js";import"./EditEventModal-LuRwpSnI.js";import"./calendar-DrsClk7B.js";import"./contacts-BPIU2ljN.js";const Ie={class:"space-y-4"},De={key:0},Oe={key:1},Le={key:2},$e={key:3},Ae=["placeholder"],Ee={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(C,{emit:$}){const d=C,T=$,t=x({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});q(()=>d.show,b=>{b&&(t.value={customerName:d.initialData.customerName||"",email:d.initialData.email||"",phone:d.initialData.phone||"",company:d.initialData.company||"",vehicle:d.initialData.vehicle||"",value:d.initialData.value||"",reason:d.initialData.reason||""})});const A=b=>{b||T("close")},h=w(()=>({contacts:"Add New Contact","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[d.activeTab]||"Add New Item"),W=w(()=>({contacts:"Contact","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[d.activeTab]||"Item"),I=()=>{T("save",{...t.value}),t.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(b,e)=>(p(),N(i(ve),{open:C.show,"onUpdate:open":A},{default:u(()=>[r(i(ie),null,{default:u(()=>[r(i(ue),{class:"fixed inset-0 z-50 bg-black/50"}),r(i(re),{class:"w-full sm:max-w-md"},{default:u(()=>[r(i(pe),null,{default:u(()=>[r(i(de),null,{default:u(()=>[M(X(h.value),1)]),_:1}),r(i(me),null,{default:u(()=>[...e[14]||(e[14]=[M("Fill in the details below",-1)])]),_:1})]),_:1}),l("div",Ie,[C.activeTab==="contacts"?(p(),V("div",De,[e[15]||(e[15]=l("label",{class:"block label-upper mb-2"},"Contact Name",-1)),m(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.customerName=s),type:"text",placeholder:"Enter contact name...",class:"input"},null,512),[[c,t.value.customerName]]),e[16]||(e[16]=l("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),m(l("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.email=s),type:"email",placeholder:"contact@example.com",class:"input"},null,512),[[c,t.value.email]]),e[17]||(e[17]=l("label",{class:"block label-upper mb-2 mt-4"},"Phone",-1)),m(l("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.phone=s),type:"tel",placeholder:"+49...",class:"input"},null,512),[[c,t.value.phone]]),e[18]||(e[18]=l("label",{class:"block label-upper mb-2 mt-4"},"Company (optional)",-1)),m(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.company=s),type:"text",placeholder:"Company name...",class:"input"},null,512),[[c,t.value.company]])])):C.activeTab==="open-leads"?(p(),V("div",Oe,[e[19]||(e[19]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,t.value.customerName]]),e[20]||(e[20]=l("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),m(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.email=s),type:"email",placeholder:"customer@example.com",class:"input"},null,512),[[c,t.value.email]]),e[21]||(e[21]=l("label",{class:"block label-upper mb-2 mt-4"},"Requested Vehicle",-1)),m(l("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.vehicle=s),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"input"},null,512),[[c,t.value.vehicle]])])):C.activeTab==="open-opportunities"||C.activeTab==="in-negotiation"?(p(),V("div",Le,[e[22]||(e[22]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>t.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,t.value.customerName]]),e[23]||(e[23]=l("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),m(l("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>t.value.vehicle=s),type:"text",placeholder:"e.g., Porsche Taycan",class:"input"},null,512),[[c,t.value.vehicle]]),e[24]||(e[24]=l("label",{class:"block label-upper mb-2 mt-4"},"Opportunity Value",-1)),m(l("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.value.value=s),type:"number",placeholder:"0",class:"input"},null,512),[[c,t.value.value]])])):(p(),V("div",$e,[e[25]||(e[25]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>t.value.customerName=s),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[c,t.value.customerName]]),e[26]||(e[26]=l("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),m(l("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>t.value.vehicle=s),type:"text",placeholder:"Vehicle model",class:"input"},null,512),[[c,t.value.vehicle]]),e[27]||(e[27]=l("label",{class:"block label-upper mb-2 mt-4"},"Reason",-1)),m(l("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>t.value.reason=s),rows:"3",placeholder:`Reason for ${C.activeTab==="won"?"win":"loss"}...`,class:"input resize-none"},null,8,Ae),[[c,t.value.reason]])]))]),r(i(ce),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:u(()=>[r(i(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:e[13]||(e[13]=s=>b.$emit("close"))}),r(i(R),{label:`Create ${W.value}`,variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:I},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Se={class:"page-container relative"},Ue={class:"p-4 md:p-8"},_e={class:"text-fluid-sm font-medium whitespace-nowrap"},et={__name:"Customers",setup(C){const $=ae(),d=Q(),T=ee(),t=Ne(),A=Ve(),h=w(()=>{const n=T.leads.filter(y=>!y.isDisqualified),o=t.opportunities.filter(y=>y.stage!=="Closed Won"&&y.stage!=="Closed Lost"),a=t.opportunities.filter(y=>y.stage==="In Negotiation"||y.stage==="In negotiation"),f=t.opportunities.filter(y=>y.stage==="Closed Won"),g=t.opportunities.filter(y=>y.stage==="Closed Lost");return{contacts:A.totalCustomers,openLeads:n.length,openOpportunities:o.length-a.length,inNegotiation:a.length,won:f.length,lost:g.length}}),I=x("contacts"),b=x(!1),e=x({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),s=x(!1),k=x(null),v=x(null),{allTasks:E}=we(x(!1)),L=w(()=>E.value),Z=w(()=>v.value),S=Ce(Z),B=w(()=>S.managementWidget.value),P=w(()=>S.storeAdapter.value),H=w(()=>S.addNewConfig.value);q(v,n=>{n&&(n.type==="lead"?T.fetchLeadById(n.id):t.fetchOpportunityById(n.id))},{immediate:!0});const J={contacts:D(()=>O(()=>import("./ContactsTab-CtXMCzhG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),"open-leads":D(()=>O(()=>import("./OpenLeadsTab-B7h-jxU4.js"),__vite__mapDeps([9,1,2,3,4,10,7,11,12,13,8]))),"open-opportunities":D(()=>O(()=>import("./OpenOpportunitiesTab-DSLtrcEf.js"),__vite__mapDeps([14,1,2,3,4,7,10,11,12,13,8]))),"in-negotiation":D(()=>O(()=>import("./InNegotiationTab-5KLfWOx8.js"),__vite__mapDeps([15,1,2,3,4,7,10,11,12,13,8]))),won:D(()=>O(()=>import("./WonTab-D6VzZnTt.js"),__vite__mapDeps([16,1,2,3,4,7,10,11,12,13,8]))),lost:D(()=>O(()=>import("./LostTab-DSctKaIK.js"),__vite__mapDeps([17,1,2,3,4,7,10,11,12,13,8])))},z=w(()=>{const n=[{key:"contacts",label:"Customers",count:h.value.contacts},{key:"open-leads",label:"Open leads",count:h.value.openLeads},{key:"open-opportunities",label:"Open opportunities",count:h.value.openOpportunities},{key:"in-negotiation",label:"In negotiation",count:h.value.inNegotiation},{key:"won",label:"Won",count:h.value.won},{key:"lost",label:"Lost",count:h.value.lost}];return d.isOperator()?n.filter(o=>o.key==="contacts"||o.key==="open-leads"):d.isSalesman()?n.filter(o=>o.key!=="open-leads"):n}),K=()=>{e.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},b.value=!1},Y=(n,o)=>{if(!o||!n)return"gray";const f={contacts:"gray","open-leads":"blue","open-opportunities":"blue","in-negotiation":"blue",won:"green",lost:"red"}[n]||"gray";return["blue","green","red","gray"].includes(f)?f:"gray"},U=n=>{if(n.id.startsWith("customer-")){const o=n.customerId||parseInt(n.id.replace("customer-",""));k.value={type:"customer",id:o},v.value=null,s.value=!0}else if(n.id.startsWith("lead-")){const o=n.id.match(/-(\d+)$/),a=parseInt(o?o[1]:n.id.replace("lead-","")),f=E.value.find(g=>g.type==="lead"&&g.id===a);f&&(v.value=f,k.value={type:"task",id:a},s.value=!0,T.fetchLeadById(a))}else if(n.id.startsWith("opp-")){const o=n.id.match(/-(\d+)$/),a=parseInt(o?o[1]:n.id.replace("opp-","")),f=E.value.find(g=>g.type==="opportunity"&&g.id===a);f&&(v.value=f,k.value={type:"task",id:a},s.value=!0,t.fetchOpportunityById(a))}},_=()=>{s.value=!1,k.value=null,v.value=null},G=n=>{if(!v.value)return;const o=L.value.findIndex(a=>{const f=v.value.compositeId||`${v.value.type}-${v.value.id}`;return(a.compositeId||`${a.type}-${a.id}`)===f});if(o!==-1){if(n==="previous"&&o>0){const a=L.value[o-1];U({id:`${a.type}-${a.id}`})}else if(n==="next"&&o<L.value.length-1){const a=L.value[o+1];U({id:`${a.type}-${a.id}`})}}};return te(async()=>{await T.fetchLeads(),await t.fetchOpportunities()}),(n,o)=>(p(),V("div",Se,[r(ne,{title:"Customers"},{actions:u(()=>[r(i(R),{onClick:o[0]||(o[0]=a=>i($).push("/add-new")),variant:"secondary",size:"md",class:"flex items-center gap-2"},{default:u(()=>[...o[3]||(o[3]=[l("i",{class:"fa-solid fa-plus text-sm"},null,-1),l("span",{class:"hidden sm:inline"},"Add new",-1)])]),_:1})]),_:1}),l("div",Ue,[r(i(fe),{modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=a=>I.value=a)},{default:u(()=>[r(i(be),{class:"w-full justify-start border-b border-border bg-transparent mb-6 overflow-x-auto"},{default:u(()=>[(p(!0),V(F,null,j(z.value,a=>(p(),N(i(ye),{key:a.key,value:a.key,class:"flex items-center gap-2 data-[state=active]:border-b-2 data-[state=active]:border-brand-dark data-[state=active]:text-brand-darkDarker rounded-none pb-3 px-4 shrink-0"},{default:u(()=>[l("span",_e,X(a.label),1),r(i(ke),{text:String(a.count),size:"small",theme:Y(a.key,I.value===a.key)},null,8,["text","theme"])]),_:2},1032,["value"]))),128))]),_:1}),(p(!0),V(F,null,j(z.value,a=>(p(),N(i(ge),{key:`content-${a.key}`,value:a.key},{default:u(()=>[(p(),N(le,null,{fallback:u(()=>[...o[4]||(o[4]=[l("div",{class:"flex items-center justify-center py-12"},[l("div",{class:"text-center"},[l("i",{class:"fa-solid fa-spinner fa-spin text-gray-400 text-2xl mb-2"}),l("p",{class:"text-meta"},"Loading...")])],-1)])]),default:u(()=>[(p(),N(oe(J[a.key]),{onRowClick:U},null,32))]),_:2},1024))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),r(he,{show:s.value,onClose:_},{default:u(()=>[k.value&&k.value.type==="customer"?(p(),N(Te,{key:0,"customer-id":k.value.id,"customer-type":"contact","show-close-button":!0,"close-on-convert":!0,onClose:_},null,8,["customer-id"])):k.value&&k.value.type==="task"&&v.value&&B.value&&P.value?(p(),N(xe,{key:1,task:v.value,"management-widget":B.value,"store-adapter":P.value,"add-new-config":H.value,"filtered-tasks":L.value,"is-drawer-view":!0,onTaskNavigate:G,onClose:_},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):se("",!0)]),_:1},8,["show"]),r(Ee,{show:b.value,"active-tab":I.value,"initial-data":e.value,onClose:o[2]||(o[2]=a=>b.value=!1),onSave:K},null,8,["show","active-tab","initial-data"])]))}};export{et as default};
