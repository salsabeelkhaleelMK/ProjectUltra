import{H as pe,I as Fe,J as ot,K as me,c as O,r as U,L as Oe,d as k,o as b,g as F,p as fe,e as u,w as ge,F as Z,i as _,t as B,n as W,k as oe,M as it,s as H,B as R,T as Ie,l as de,y as L,N as ut,x as se,O as le,P as ve,C as qe,Q as N,S as Be,G as ct,u as Ue,R as dt,m as pt,j as ft,h as gt,U as yt,V as Te}from"./index-BSxt259F.js";import{u as Re}from"./opportunities-C7VMVq_4.js";import{u as He}from"./users-i2L6lO-2.js";import{n as ae,z as De}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{L as mt,O as vt,g as we,f as ht,a as bt,b as xt,c as Ve,d as ze,e as wt}from"./opportunityRules-DVPgyxsv.js";import{y as kt}from"./components-WJKgpbNX.js";import{u as Ct}from"./useTableRowSelection-Bs49OKi4.js";import{u as St,a as Le,T as Me,D as $t}from"./useTaskFilters-_o99iYhw.js";import{_ as At}from"./ReassignUserModal-8Wfd_b4T.js";import"./sparkles-ByigpcXa.js";import"./vehicles-sZbJG44U.js";import"./CreateEventModal-DQDakbY_.js";import"./EditEventModal-_ABol0cZ.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=pe("CheckCircleIcon",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=pe("CircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=pe("FlameIcon",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=pe("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=pe("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function It(e){if(!e)return null;if(e.title)return e.title;const w=e.type||(e.customer?"opportunity":"lead"),r=Fe(e,w);if(w==="lead"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const $=mt[r];if(!$||!$.primaryAction)return null;const l=$.primaryAction,o={lead:e,displayStage:r},i=typeof l=="function"?l(o):l;if(!i)return null;const d=typeof i.label=="function"?i.label(o):i.label,g=typeof i.title=="function"?i.title(o):i.title;return d||g||null}if(w==="opportunity"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const $=vt[r];if(!$||!$.primaryAction)return null;const l=$.primaryAction,o={deliverySubstatus:e.deliverySubstatus||ot(e,e.activities||[]),hasOffers:!!(e.offers&&e.offers.length>0)||!!(e.activities&&e.activities.some(m=>m.type==="offer")),scheduledAppointment:e.scheduledAppointment,opportunity:e,formatDateTime:m=>new Date(m).toLocaleDateString()},i=typeof l=="function"?l(o):l;if(!i)return null;const d=typeof i.label=="function"?i.label(o):i.label,g=typeof i.title=="function"?i.title(o):i.title;return d||g||null}return null}const Tt=["onClick"],Dt={class:"flex flex-col min-w-0 flex-1 pr-4"},Lt={class:"flex items-center gap-1 mb-0.5"},Mt={key:0,class:"font-bold text-foreground text-base truncate"},Nt={class:"flex items-center gap-2 overflow-hidden"},Ft={class:"text-muted-foreground text-sm truncate"},Ot={class:"flex flex-wrap items-center gap-2 mt-2"},qt={key:1,class:"px-1.5 py-0.5 rounded text-xs font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},Bt={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(e,{emit:w}){const r=e,$=O(()=>r.item.compositeId||`${r.item.type||"task"}-${r.item.id}`||r.item.id),l=O(()=>r.selected),o=O(()=>l.value?typeof r.selectedClass=="function"?r.selectedClass(r.item):r.selectedClass:typeof r.unselectedClass=="function"?r.unselectedClass(r.item):r.unselectedClass),i=O(()=>{var n;return l.value?((n=r.item)==null?void 0:n.type)==="opportunity"?"task-card-selected task-card-selected-opportunity":"task-card-selected":""}),d=n=>n?n.stage||n.currentStage||"New":"",g=n=>{if(!n||n.type!=="opportunity")return null;try{return Fe(n,"opportunity")}catch{return n.displayStage||n.stage||null}},m=n=>{if(!n)return"";if(n.type==="opportunity"){const S=g(n)||n.stage||n.currentStage||"New";d(n);const f=y(n);return f&&f!==S?f:S}return n.stage||n.currentStage||n.displayStage||"New"},y=n=>{if(!n||n.type!=="opportunity")return"";const S=d(n),f=g(n);if(!f||!S)return f||"";const q=S.toLowerCase().trim();if(f.toLowerCase().trim().startsWith(q+" - ")){const X=S+" - ";if(f.startsWith(X))return f.substring(X.length)}return f},a=(n,S="opportunity")=>{if(!n)return"bg-gray-50 text-gray-700 border-gray-200";try{const f=it(n,S);return f.includes("blue")?f+" border-blue-200":f.includes("purple")?f+" border-purple-200":f.includes("yellow")?f+" border-yellow-200":f.includes("pink")?f+" border-pink-200":f.includes("indigo")?f+" border-indigo-200":f.includes("emerald")?f+" border-emerald-200":f.includes("green")?f+" border-green-200":f.includes("red")?f+" border-red-200":(f.includes("gray"),f+" border-gray-200")}catch{const q=n.toLowerCase();return q.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":q.includes("qualif")?"bg-green-50 text-green-600 border-green-200":q.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":q.includes("close")?"bg-muted text-muted-foreground border-border":"bg-gray-50 text-gray-700 border-gray-200"}},x=O(()=>{const n=r.item;if(!n)return"bg-gray-50 text-gray-700 border-gray-200";if(n.type==="opportunity"){const f=g(n)||d(n);return a(f,"opportunity")}const S=m(n).toLowerCase();return S.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":S.includes("qualif")?"bg-green-50 text-green-600 border-green-200":S.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":S.includes("close")?"bg-muted text-muted-foreground border-border":"bg-blue-50 text-blue-600 border-blue-200"}),I=O(()=>It(r.item)),C=O(()=>{const n=r.item.nextActionDue||r.item.dueDate;if(!n)return null;const S=we(n);return{text:ht(n),status:S}}),E=O(()=>C.value?C.value.status.textClass.replace("text-","bg-"):""),A=U(null);return(n,S)=>{const f=Oe("click-outside");return b(),k("div",{ref_key:"cardRef",ref:A,class:W(["task-card bg-white rounded-xl p-4 flex items-center justify-between cursor-pointer relative transition-all border group",[o.value,i.value]]),onClick:S[2]||(S[2]=q=>n.$emit("select",$.value))},[e.showMenu?(b(),k("button",{key:0,onClick:S[0]||(S[0]=ge(q=>n.$emit("menu-click",e.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 z-10"},[...S[3]||(S[3]=[u("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):F("",!0),e.openMenuId===e.item.id&&e.showMenu?fe((b(),k("div",{key:1,class:"absolute right-2 top-7 z-50 w-40 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:S[1]||(S[1]=ge(()=>{},["stop"]))},[(b(!0),k(Z,null,_(e.menuItems,q=>(b(),k("button",{key:q.key,onClick:q.onClick,class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2"},B(q.label),9,Tt))),128))])),[[f,()=>n.$emit("menu-close")]]):F("",!0),u("div",Dt,[u("div",Lt,[I.value?(b(),k("h3",Mt,B(I.value),1)):F("",!0),C.value?(b(),k("span",{key:1,class:W(["flex items-center gap-1 text-xs font-bold uppercase leading-none shrink-0",C.value.status.textClass])},[u("span",{class:W(["w-1.5 h-1.5 rounded-full",E.value])},null,2),oe(" "+B(C.value.text),1)],2)):F("",!0)]),u("div",Nt,[u("span",Ft,B(e.getName(e.item)),1)]),u("div",Ot,[u("span",{class:W(["px-1.5 py-0.5 rounded text-xs font-bold uppercase border leading-none",e.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},B(e.item.type==="lead"?"Lead":"Opportunity"),3),m(e.item)?(b(),k("span",{key:0,class:W(["px-1.5 py-0.5 rounded text-xs font-bold uppercase border leading-none",x.value])},B(m(e.item)),3)):F("",!0),e.item.priority==="Hot"?(b(),k("span",qt," Hot ")):F("",!0)])])],2)}}},Ut=me(Bt,[["__scopeId","data-v-b7c47486"]]),Rt={key:0,class:"flex flex-col gap-2"},Ht={class:"flex items-center gap-1.5 flex-wrap"},Vt={class:"relative",ref:"filterContainer"},zt={key:0,class:"filter-indicator"},Wt=["onClick"],Et=["onClick"],jt={key:0,class:"flex items-center gap-1.5 flex-wrap"},Pt=["onClick"],Qt={key:0,class:"task-filter-badge"},Gt={key:1,class:"relative",ref:"filterContainer"},Yt={key:0,class:"filter-indicator"},Kt=["onClick"],Jt=["onClick"],Xt={key:2,class:"flex items-center gap-1.5 flex-wrap"},Zt=["onClick"],_t={key:0,class:"task-filter-badge"},Ne={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:""},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(e,{emit:w}){const r=e,$=w,l=U(!1),o=()=>{l.value=!l.value},i=()=>{l.value=!1},d=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],g=A=>{const n=d.find(S=>S.key===A);return n?n.label:A},m=A=>{l.value=!1;const n=[...r.activeFilters],S=n.indexOf(A);S>-1?n.splice(S,1):n.push(A),$("filter-change",n)},y=A=>{const n=[...r.activeFilters],S=n.indexOf(A);S>-1&&(n.splice(S,1),$("filter-change",n))},a=A=>{l.value=!1,$("sort-change",A)},x=()=>{$("sort-change","")},I=O(()=>{const A=r.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First"},...A?[{key:"urgent-first",label:"Urgent first"}]:[],{key:"assigned-to-me",label:"Assigned to me"},{key:"assigned-to-my-team",label:"Assigned to my team"}]}),C=O(()=>r.sortOption&&r.sortOption!==""&&r.sortOption!=="none"),E=O(()=>{const A=I.value.find(n=>n.key===r.sortOption);return A?A.label:r.sortOption});return(A,n)=>{const S=Oe("click-outside");return!e.buttonOnly&&!e.chipsOnly?(b(),k("div",Rt,[u("div",Ht,[fe((b(),k("div",Vt,[u("button",{onClick:o,class:"filter-dropdown-button"},[n[2]||(n[2]=u("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(b(),k("span",zt)):F("",!0)]),H(Ie,{name:"dropdown-fade"},{default:R(()=>[l.value?(b(),k("div",{key:0,class:"absolute left-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:n[0]||(n[0]=ge(()=>{},["stop"]))},[(b(),k(Z,null,_(d,f=>u("button",{key:f.key,onClick:q=>m(f.key),class:W(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted filter-item-selected":e.activeFilters.includes(f.key)}])},[u("span",null,B(f.label),1)],10,Wt)),64)),n[3]||(n[3]=u("div",{class:"border-t border-black/10 my-1"},null,-1)),(b(!0),k(Z,null,_(I.value,f=>(b(),k("button",{key:f.key,onClick:q=>a(f.key),class:W(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted sort-item-selected":f.key===e.sortOption}])},[u("span",null,B(f.label),1)],10,Et))),128))])):F("",!0)]),_:1})])),[[S,i]]),e.activeFilters.length>0||C.value?(b(),k("div",jt,[(b(!0),k(Z,null,_(e.activeFilters,f=>(b(),k("div",{key:f,class:"task-filter-badge"},[u("span",null,B(g(f)),1),u("button",{onClick:q=>y(f),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...n[4]||(n[4]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Pt)]))),128)),C.value?(b(),k("div",Qt,[u("span",null,B(E.value),1),u("button",{onClick:x,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...n[5]||(n[5]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)])])):e.buttonOnly?fe((b(),k("div",Gt,[u("button",{onClick:o,class:"filter-dropdown-button"},[n[6]||(n[6]=u("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(b(),k("span",Yt)):F("",!0)]),H(Ie,{name:"dropdown-fade"},{default:R(()=>[l.value?(b(),k("div",{key:0,class:"absolute right-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:n[1]||(n[1]=ge(()=>{},["stop"]))},[(b(),k(Z,null,_(d,f=>u("button",{key:f.key,onClick:q=>m(f.key),class:W(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted filter-item-selected":e.activeFilters.includes(f.key)}])},[u("span",null,B(f.label),1)],10,Kt)),64)),n[7]||(n[7]=u("div",{class:"border-t border-black/10 my-1"},null,-1)),(b(!0),k(Z,null,_(I.value,f=>(b(),k("button",{key:f.key,onClick:q=>a(f.key),class:W(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted sort-item-selected":f.key===e.sortOption}])},[u("span",null,B(f.label),1)],10,Jt))),128))])):F("",!0)]),_:1})])),[[S,i]]):e.chipsOnly&&(e.activeFilters.length>0||C.value)?(b(),k("div",Xt,[(b(!0),k(Z,null,_(e.activeFilters,f=>(b(),k("div",{key:f,class:"task-filter-badge"},[u("span",null,B(g(f)),1),u("button",{onClick:q=>y(f),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...n[8]||(n[8]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Zt)]))),128)),C.value?(b(),k("div",_t,[u("span",null,B(E.value),1),u("button",{onClick:x,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...n[9]||(n[9]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)}}},es={class:"tasks-list-container border-r border-border flex flex-col shrink-0 w-full lg:w-80 h-full"},ts={class:"page-header shrink-0"},ss={class:"page-header-main"},ns={class:"page-header-content"},rs={class:"page-header-title-container"},ls={class:"page-header-title"},as={class:"page-header-actions"},os={class:"bg-white border border-border p-0.5 rounded-btn inline-flex gap-0.5"},is={class:"px-5 py-3"},us={class:"flex items-center gap-2"},cs={class:"relative flex-1"},ds=["placeholder"],ps={key:0,class:"mt-2"},fs={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:e=>e.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(e,{emit:w}){const r=e,$=w,l=U(r.initialSearchQuery),o=U(null),i=U(""),d=O(()=>typeof r.title=="string"?r.title:typeof r.title=="function"?(console.warn("TasksList: title prop received a function instead of a string. Using default title."),"Tasks"):r.title||"Tasks");de(()=>r.initialSearchQuery,a=>{l.value=a});const g=O(()=>{let a=r.items;const x=r.activeFilters.filter(C=>C==="lead"||C==="opportunity");if(x.length>0&&(a=a.filter(C=>!!(C.type&&x.includes(C.type)))),!l.value.trim())return a;const I=l.value.toLowerCase().trim();return a.filter(C=>{const E=r.getName(C).toLowerCase(),A=r.getVehicleInfo(C).toLowerCase();return E.includes(I)||A.includes(I)})}),m=a=>{if(!r.selectedId)return!1;const x=a.compositeId||`${a.type||"task"}-${a.id}`;return String(x)===String(r.selectedId)},y=a=>{i.value=a,$("sort-change",a)};return(a,x)=>(b(),k("div",es,[u("header",ts,[u("div",ss,[u("div",ns,[u("div",rs,[u("h1",ls,B(d.value),1)]),u("div",as,[u("div",os,[H(L(ae),{variant:"secondary",size:"icon",onClick:x[0]||(x[0]=I=>a.$emit("view-change","card")),class:W(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:R(()=>[H(L(je),{size:14})]),_:1},8,["class","aria-pressed"]),H(L(ae),{variant:"secondary",size:"icon",onClick:x[1]||(x[1]=I=>a.$emit("view-change","table")),class:W(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:R(()=>[H(L(Pe),{size:14})]),_:1},8,["class","aria-pressed"])])])])])]),u("div",is,[u("div",us,[u("div",cs,[x[8]||(x[8]=u("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-muted-foreground text-sm"},null,-1)),fe(u("input",{"onUpdate:modelValue":x[2]||(x[2]=I=>l.value=I),type:"text",placeholder:e.searchPlaceholder,class:"w-full bg-white border border-border rounded-btn pl-9 pr-3 py-2 text-sm"},null,8,ds),[[ut,l.value]])]),H(Ne,{"active-filters":e.activeFilters,"sort-option":i.value,"button-only":!0,onFilterChange:x[3]||(x[3]=I=>a.$emit("filter-change",I)),onSortChange:y},null,8,["active-filters","sort-option"])]),e.activeFilters.length>0?(b(),k("div",ps,[H(Ne,{"active-filters":e.activeFilters,"sort-option":i.value,"chips-only":!0,onFilterChange:x[4]||(x[4]=I=>a.$emit("filter-change",I)),onSortChange:y},null,8,["active-filters","sort-option"])])):F("",!0)]),u("div",{ref_key:"scrollContainer",ref:o,class:"task-list-cards flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(b(!0),k(Z,null,_(g.value,I=>(b(),se(Ut,{key:I.compositeId||`${I.type||"task"}-${I.id}`,item:I,selected:m(I),"selected-class":e.selectedClass,"unselected-class":e.unselectedClass,"show-menu":e.showMenu,"open-menu-id":e.openMenuId,getName:e.getName,getVehicleInfo:e.getVehicleInfo,"menu-items":e.getMenuItems?e.getMenuItems(I):null,onSelect:x[5]||(x[5]=C=>a.$emit("select",C)),onMenuClick:x[6]||(x[6]=C=>a.$emit("menu-click",C)),onMenuClose:x[7]||(x[7]=C=>a.$emit("menu-close"))},{location:R(({item:C})=>[le(a.$slots,"location",{item:C},void 0,!0)]),source:R(({item:C})=>[le(a.$slots,"source",{item:C},void 0,!0)]),owner:R(({item:C})=>[le(a.$slots,"owner",{item:C},void 0,!0)]),dates:R(({item:C})=>[le(a.$slots,"dates",{item:C},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},gs=me(fs,[["__scopeId","data-v-d0497207"]]);function Qe(e,w=[],r,$){const l=ve(),o=l.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},i=l.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},d=ys(e,w),g=ms(e,w),m=vs(e),y=hs(e),a=o.intent+o.behavioral+o.temporal,x={intent:o.intent/a*100,behavioral:o.behavioral/a*100,temporal:o.temporal/a*100},I=d/40*x.intent,C=g/35*x.behavioral,E=m/25*x.temporal,A=Math.min(100,Math.max(0,I+C+E+y));let n="COLD";return A>=i.hot?n="HOT":A>=i.warm?n="WARM":A>=i.standard&&(n="STANDARD"),{score:Math.round(A*10)/10,level:n,breakdown:{intent:Math.round(d*10)/10,behavioral:Math.round(g*10)/10,temporal:Math.round(m*10)/10,quality:Math.round(y*10)/10,total:Math.round(A*10)/10}}}function ys(e,w){var $;let r=0;return(e.requestType==="Test Drive"||(($=e.scheduledAppointment)==null?void 0:$.type)==="test-drive"||w.some(l=>l.type==="test-drive"||l.type==="appointment"))&&(r=Math.max(r,40)),w.some(l=>l.type==="financing")&&(r=Math.max(r,35)),w.some(l=>l.type==="tradein")&&(r=Math.max(r,30)),(e.source==="Walk-in"||w.some(l=>{var o,i,d;return((o=l.content)==null?void 0:o.toLowerCase().includes("location"))||((i=l.content)==null?void 0:i.toLowerCase().includes("dealership"))||((d=l.content)==null?void 0:d.toLowerCase().includes("visit"))}))&&(r=Math.max(r,25)),e.requestedCar&&(e.requestedCar.requestMessage||w.some(l=>{var o,i;return((o=l.content)==null?void 0:o.toLowerCase().includes("configur"))||l.type==="attachment"&&((i=l.fileName)==null?void 0:i.toLowerCase().includes("config"))}))&&(r=Math.max(r,20)),w.some(l=>{var i;const o=((i=l.content)==null?void 0:i.toLowerCase())||"";return o.includes("compare")||o.includes("versus")||o.includes("vs")||o.includes("alternative")})&&(r=Math.max(r,15)),Math.min(r,40)}function ms(e,w){let r=0;const $=new Set(w.map(d=>{if(!d.timestamp)return null;const g=new Date(d.timestamp);return`${g.getFullYear()}-${g.getMonth()}-${g.getDate()}`}).filter(Boolean)),l=Math.min($.size*10,35);r+=l,e.contactAttempts&&e.contactAttempts.length>1&&(r+=20);const o=w.reduce((d,g)=>{var m;return d+(((m=g.content)==null?void 0:m.length)||0)},0),i=Math.min(Math.floor(o/50),25);return r+=i,w.some(d=>{var g,m,y;return d.type==="attachment"&&(((g=d.fileName)==null?void 0:g.toLowerCase().includes("brochure"))||((m=d.fileName)==null?void 0:m.toLowerCase().includes("spec"))||((y=d.fileName)==null?void 0:y.toLowerCase().includes("pdf")))})&&(r+=15),Math.min(r,35)}function vs(e){let w=0;if(!e.createdAt)return 0;const r=new Date,$=new Date(e.createdAt),l=(r.getTime()-$.getTime())/(1e3*60*60);l<2?w+=25:l<24?w+=15:l<48?w+=5:w-=10;const o=$.getDay(),i=$.getHours();if((o===0||o===6||i<9||i>17)&&(w+=10),e.contactAttempts&&e.contactAttempts.length===3&&(w+=50),e.lastActivity){const d=new Date(e.lastActivity);(r.getTime()-d.getTime())/(1e3*60*60*24)>3&&(w+=20)}return Math.min(Math.max(w,0),25)}function hs(e){var r,$,l,o,i,d,g;let w=0;return(r=e.customer)!=null&&r.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer.email)&&(w+=10),($=e.customer)!=null&&$.phone&&/^\+?[\d\s\-()]+$/.test(e.customer.phone)&&e.customer.phone.length>=10&&(w+=10),(l=e.customer)!=null&&l.name&&((o=e.customer)!=null&&o.email)&&((i=e.customer)!=null&&i.phone)&&((d=e.customer)!=null&&d.address)&&(w+=5),(e.isDuplicate||e.isDisqualified||!((g=e.customer)!=null&&g.name))&&(w-=20),w}const bs={HOT:"Flame",WARM:"Sun",STANDARD:"CheckCircle",COLD:"Circle"};function Ge(e){return bs[e]??"Circle"}function Ye(e){switch(e){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function xs({typeFilter:e,showTypeFilter:w,tasks:r}){return{filterDefinitions:O(()=>{const l=[];w.value&&l.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),l.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),l.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),e.value==="lead"&&l.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),l.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const o=[...new Set(r.value.map(d=>d.assignee).filter(Boolean))];o.length>0&&l.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:o.map(d=>({value:d,label:d})),aiHint:"Person assigned to the task",pinned:!0});const i=[...new Set(r.value.map(d=>{const g=d.type==="lead"?d.requestedCar:d.vehicle;return g==null?void 0:g.brand}).filter(Boolean))];return i.length>0&&l.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:i.map(d=>({value:d,label:d})),aiHint:"Car brand requested by customer"}),l.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),l})}}const ws={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},ks={class:"page-header shrink-0"},Cs={class:"page-header-main"},Ss={class:"page-header-content"},$s={class:"page-header-actions"},As={class:"bg-white border border-border p-0.5 rounded-btn inline-flex gap-0.5"},Is={class:"flex-1 overflow-y-auto p-4 md:p-8 bg-white"},Ts={key:0,class:"flex items-center gap-2"},Ds={class:"flex items-center gap-2 mr-1"},Ls={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},Ms={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","toggle-closed","reassign","close","view-change"],setup(e,{emit:w}){const r=e,$=w,l=ve(),o=qe(),i=Re();U("");const{rowSelection:d,selectedCount:g,hasSelection:m,getSelectedRows:y,clearSelection:a}=Ct(c=>c.compositeId),x=U({pageIndex:0,pageSize:10}),I=U(""),C=U([]),E=U([]),A=U({}),{filterDefinitions:n}=xs({typeFilter:O(()=>"all"),showTypeFilter:O(()=>!0),tasks:O(()=>r.tasks)}),S=O(()=>r.tasks),f=c=>c.compositeId===r.currentTaskId||c.compositeId===r.highlightId,q=c=>{if(c.type==="lead")return c.requestedCar?`${c.requestedCar.brand} ${c.requestedCar.model}`:"No vehicle specified";const t=c.vehicle||c.requestedCar;return t?`${t.brand} ${t.model}`:"No vehicle specified"},ie=c=>{if(!c)return"Not set";const t=new Date,v=new Date(c),M=new Date(t.getFullYear(),t.getMonth(),t.getDate()),P=new Date(v.getFullYear(),v.getMonth(),v.getDate())-M,V=Math.ceil(P/(1e3*60*60*24));return V===0?"Today":V===1?"Tomorrow":V===-1?"Yesterday":V>1&&V<=7?`In ${V} days`:V<-1&&V>=-7?`${Math.abs(V)} days ago`:Ve(c)},X=c=>{const t=c.type==="lead"?c.requestedCar:c.vehicle;if(!t)return{status:"N/A",class:"bg-muted text-muted-foreground"};const v=t.stockDays!==void 0&&t.stockDays!==null;return{status:v?"In Stock":"Out of Stock",class:v?"bg-green-100 text-green-700":"bg-muted text-muted-foreground"}},G=c=>{var t;return c.type==="lead"?((t=c.requestedCar)==null?void 0:t.requestType)||c.requestType||"N/A":c.requestType||"Opportunity"},ee=c=>{const t=c.type==="lead"?c.requestedCar:c.vehicle||c.requestedCar;return t==null?void 0:t.price},ne=O(()=>[{id:"type",accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:c=>te(c.original)},cell:({row:c})=>{const t=c.original,v=t.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return N("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${v}`},t.type==="lead"?"Lead":"Opportunity")}},{id:"customer",accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:c})=>{const t=c.original;return N("div",{class:"flex items-center gap-2 md:gap-3"},[N("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},t.customer.initials),N("div",{class:"min-w-0"},[N("div",{class:"text-content font-semibold text-foreground truncate max-w-32 md:max-w-none"},t.customer.name),N("div",{class:"text-meta truncate hidden sm:block"},t.customer.phone||"N/A")])])}},{id:"carInfo",accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:c})=>{const t=c.original,v=q(t),M=X(t),K=G(t),P=t.type==="lead"?t.requestedCar:t.vehicle||t.requestedCar;if(v==="No vehicle specified")return N("span",{class:"text-meta"},"N/A");const V=P!=null&&P.condition?P.condition.charAt(0).toUpperCase()+P.condition.slice(1).toLowerCase():null,ue=P!=null&&P.kilometers?`${P.kilometers.toLocaleString()} km`:null,he=t.quotationNumber||t.quotation||null,ce=K&&K!=="N/A"&&(K!=="Quotation"||he);return N("div",{class:"flex flex-col gap-1"},[N("div",{class:"flex items-center gap-2"},[N("i",{class:"fa-brands fa-volkswagen text-muted-foreground text-sm"}),N("span",{class:"text-content font-medium text-foreground truncate max-w-32"},v)]),N("div",{class:"flex items-center gap-2 flex-wrap"},[N("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${M.class}`},M.status),V&&N("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},V),ue&&N("span",{class:"text-meta text-xs"},ue),ce&&N("span",{class:"text-meta text-xs"},K)])])}},{id:"dueDate",accessorKey:"nextActionDue",header:"Due Date",meta:{title:"Due Date"},cell:({row:c})=>{const v=c.original.nextActionDue;if(!v)return N("span",{class:"text-meta"},"Not set");const M=we(v);return N("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${M.bgClass} ${M.textClass} ${M.borderClass}`},ie(v))}},{id:"price",accessorKey:"price",accessorFn:c=>ee(c)??0,header:"Price",meta:{title:"Price"},cell:({row:c})=>{const t=c.original,v=ee(t);return v==null||v===""?N("span",{class:"text-meta"},"â€”"):N("span",{class:"text-content font-medium text-foreground"},`â‚¬ ${bt(v)}`)}},{id:"source",accessorKey:"source",header:"Lead Source",meta:{title:"Lead Source"},cell:({row:c})=>{const t=c.original;return N("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-muted text-muted-foreground"},t.source||"N/A")}},{id:"contactAttempts",accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:c})=>{var M;const v=((M=c.original.contactAttempts)==null?void 0:M.length)||0;return N("span",{class:"text-content font-medium text-foreground"},v)}},{id:"assignee",accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:c})=>{const t=c.original,v=r.getOwnerInfo(t);return N("div",{class:"flex items-center gap-2"},[N("div",{class:"w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs font-bold text-muted-foreground shrink-0"},v.initials),N("span",{class:"text-meta truncate max-w-20"},v.name)])}},{id:"createdAt",accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:c})=>{const t=c.original;return t.createdAt?N("span",{class:"text-meta"},xt(t.createdAt)):N("span",{class:"text-meta"},"N/A")}},{id:"status",accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:c})=>{const t=c.original,v=t.type==="lead"?t.status:t.displayStage||t.stage,M=r.getStageBadgeClass(v);return N("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${M}`},v)}},...l.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:c})=>{const t=c.original;if(t.type!=="lead")return N("span",{class:"text-meta"},"â€”");let v=t.urgencyLevel;v||(v=Qe(t).level);const M=Ye(v),K=Ge(v),V={Flame:Ee,Sun:Be,CheckCircle:We,Circle:ye}[K]||ye;return N("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${M}`},[N(V,{class:"size-3 shrink-0"}),N("span",{},v)])}}]:[]]),te=c=>{I.value=String(c.id),$("select",c.compositeId)},j=()=>{const c=y(S.value);c.length!==0&&confirm(`Are you sure you want to delete ${c.length} ${c.length===1?"task":"tasks"}?`)&&(c.forEach(t=>{t.type==="lead"?o.deleteLead(t.id):i.deleteOpportunity(t.id)}),a())},Y=O(()=>({class:{tr:c=>{const t="cursor-pointer hover:bg-muted transition-colors",v=c.original;return f(v)?`${t} bg-blue-50 border-l-4 border-l-blue-500`:t}}}));return(c,t)=>(b(),k("div",ws,[u("header",ks,[u("div",Cs,[u("div",Ss,[t[10]||(t[10]=u("div",{class:"page-header-title-container"},[u("h1",{class:"page-header-title"},"Tasks")],-1)),u("div",$s,[u("div",As,[H(L(ae),{variant:"secondary",size:"icon",onClick:t[0]||(t[0]=v=>c.$emit("view-change","card")),class:W(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:R(()=>[H(L(je),{size:14})]),_:1},8,["class","aria-pressed"]),H(L(ae),{variant:"secondary",size:"icon",onClick:t[1]||(t[1]=v=>c.$emit("view-change","table")),class:W(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:R(()=>[H(L(Pe),{size:14})]),_:1},8,["class","aria-pressed"])]),u("button",{onClick:t[2]||(t[2]=v=>c.$emit("toggle-closed",!e.showClosed)),class:"group flex items-center gap-2 rounded-xl border border-border px-3 py-1.5 bg-surface text-sm font-medium text-muted-foreground hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...t[9]||(t[9]=[u("i",{class:"fa-solid fa-eye-slash text-muted-foreground group-hover:text-brand-red"},null,-1),u("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),u("div",Is,[H(L(kt),{data:S.value,columns:ne.value,meta:Y.value,onRowClick:te,columnFiltersOptions:{filterDefs:L(n)},pagination:x.value,"onUpdate:pagination":t[3]||(t[3]=v=>x.value=v),globalFilter:I.value,"onUpdate:globalFilter":t[4]||(t[4]=v=>I.value=v),sorting:C.value,"onUpdate:sorting":t[5]||(t[5]=v=>C.value=v),columnFilters:E.value,"onUpdate:columnFilters":t[6]||(t[6]=v=>E.value=v),columnVisibility:A.value,"onUpdate:columnVisibility":t[7]||(t[7]=v=>A.value=v),rowSelection:L(d),"onUpdate:rowSelection":t[8]||(t[8]=v=>ct(d)?d.value=v:null),paginationOptions:{rowCount:S.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!0},class:"h-full"},{"empty-state":R(()=>[...t[11]||(t[11]=[u("div",{class:"empty-state"},[u("i",{class:"fa-solid fa-tasks empty-state-icon"}),u("p",{class:"empty-state-text"},"No tasks found")],-1)])]),"batch-action-bar":R(()=>[L(m)?(b(),k("div",Ts,[u("div",Ds,[u("div",Ls,B(L(g)),1),t[12]||(t[12]=u("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),t[15]||(t[15]=u("div",{class:"h-4 w-px bg-greys-700"},null,-1)),H(L(ae),{variant:"ghost",size:"sm",onClick:j},{default:R(()=>[...t[13]||(t[13]=[u("i",{class:"fa-solid fa-trash mr-2"},null,-1),oe(" Delete ",-1)])]),_:1}),H(L(ae),{variant:"ghost",size:"sm",onClick:L(a)},{default:R(()=>[...t[14]||(t[14]=[u("i",{class:"fa-solid fa-x mr-2"},null,-1),oe(" Close ",-1)])]),_:1},8,["onClick"])])):F("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","columnVisibility","rowSelection","paginationOptions"])])]))}},Ns=me(Ms,[["__scopeId","data-v-2203393a"]]),Fs={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},Os={class:"px-4 py-3 flex items-center justify-between gap-3"},qs=["aria-label"],Bs={key:0,class:"flex-1 flex items-center justify-center"},Us={key:1,class:"flex items-center gap-2"},Rs={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(e,{emit:w}){const r=w,$=()=>{r("back")};return(l,o)=>e.show?(b(),k("div",Fs,[u("div",Os,[u("button",{onClick:$,class:"w-11 h-11 flex items-center justify-center text-muted-foreground hover:text-foreground hover:bg-muted rounded-lg transition-colors shrink-0","aria-label":e.backLabel},[...o[0]||(o[0]=[u("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,qs),l.$slots.title?(b(),k("div",Bs,[le(l.$slots,"title")])):F("",!0),l.$slots.actions?(b(),k("div",Us,[le(l.$slots,"actions")])):F("",!0)])])):F("",!0)}};function Hs(){const e=y=>{if(!y)return"No deadline";const a=we(y);return a.type==="overdue"?"OVERDUE":a.type==="today"||a.type==="urgent"?a.relativeTime:Ve(y)},w=y=>{const a=y.type==="lead"?y.requestedCar:y.vehicle;return!a||!a.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[a.type]||{type:a.type.toLowerCase(),label:a.type}},r=y=>y?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[y.type]||"bg-gray-50 text-gray-700":"",$=y=>{if(!y||!y.assignee)return{name:"Unassigned",initials:"?"};const a=y.assigneeInitials||y.assignee.split(" ").map(x=>x[0]).join("");return{name:y.assignee,initials:a}},l=y=>{if(!y||!y.customer||!y.customer.address)return null;const x=y.customer.address.split(",");return x.length>1&&x[x.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:e,getVehicleType:w,getVehicleTypeBadgeClass:r,getOwnerInfo:$,getCustomerCity:l,getLocationDisplay:y=>{const a=l(y),x=y.source||"Unknown";return a?`${a} â€¢ ${x}`:x},getAssigneeInitials:y=>{if(!y)return"?";const a=y.split(" ");return a.length>=2?(a[0][0]+a[a.length-1][0]).toUpperCase():y.substring(0,2).toUpperCase()},getVehicleStatusDisplay:y=>{const a=y.type==="lead"?y.requestedCar:y.vehicle;if(!a)return"No vehicle";const x=w(y),I=x?x.label:a.type||"Unknown";let C="";return a.kilometers!==void 0&&a.kilometers!==null&&(a.kilometers>=1e3?C=`${(a.kilometers/1e3).toFixed(0)}k`:C=`${a.kilometers}`),C?`${I} / ${C}`:I},getTaskStatusDisplay:y=>y.type==="lead"?y.status||"Unknown":y.stage||"Unknown",getStageBadgeClass:ze,getUnselectedClass:y=>y.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Vs(){const e=Ue(),w=He(),r=ve();return{sortTasks:(l,o)=>{if(!o||o===""||o==="none")return l;if(o==="recent-first")return[...l].sort((i,d)=>{const g=new Date(i.lastActivity||i.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-g});if(o==="urgent-first")return r.getSetting("urgencyEnabled")!==!1?[...l.map(g=>{if(g.type==="lead"&&!g.urgencyScore){const m=Qe(g);return{...g,urgencyScore:m.score,urgencyLevel:m.level}}return g})].sort((g,m)=>{if(g.type==="lead"&&m.type==="lead"){const x=g.urgencyScore||0,I=m.urgencyScore||0;if(x!==I)return I-x;const C=new Date(g.createdAt||0);return new Date(m.createdAt||0)-C}if(g.type==="lead"&&m.type==="opportunity")return-1;if(g.type==="opportunity"&&m.type==="lead")return 1;if(g.priority==="Hot"&&m.priority!=="Hot")return-1;if(g.priority!=="Hot"&&m.priority==="Hot")return 1;const y=new Date(g.lastActivity||g.createdAt||0);return new Date(m.lastActivity||m.createdAt||0)-y}):[...l].sort((d,g)=>{if(d.priority==="Hot"&&g.priority!=="Hot")return-1;if(d.priority!=="Hot"&&g.priority==="Hot")return 1;const m=new Date(d.lastActivity||d.createdAt||0);return new Date(g.lastActivity||g.createdAt||0)-m});if(o==="assigned-to-me"){const i=e.currentUser.name;return[...l.filter(g=>g.assignee===i)].sort((g,m)=>{const y=new Date(g.lastActivity||g.createdAt||0);return new Date(m.lastActivity||m.createdAt||0)-y})}if(o==="assigned-to-my-team"){const i=e.currentUser;let d=[];return i.role==="manager"?d=w.users.map(m=>m.name):i.role==="salesman"?d=w.users.filter(m=>m.role==="salesman").map(m=>m.name):i.role==="operator"&&(d=w.users.filter(m=>m.role==="operator").map(m=>m.name)),[...l.filter(m=>d.includes(m.assignee))].sort((m,y)=>{const a=new Date(m.lastActivity||m.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-a})}return l}}}const zs={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Ws={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Es={key:0,class:"flex items-center gap-2"},js={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Ps={class:"text-gray-600 font-medium"},Qs={key:1},Gs={key:0},Ys={key:1},Ks={key:2},Js={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Xs={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Zs={__name:"Tasks",setup(e){const w={Flame:Ee,Sun:Be,CheckCircle:We,Circle:ye};function r(s){return w[Ge(s)]||ye}const $=dt(),l=gt(),o=qe(),i=Re(),d=Ue();He();const g=ve(),{getDateDisplay:m,getVehicleType:y,getVehicleTypeBadgeClass:a,getOwnerInfo:x,getCustomerCity:I,getAssigneeInitials:C,getUnselectedClass:E}=Hs(),A=U(localStorage.getItem("tasksViewMode")||"table"),n=U(""),S=O(()=>$.query.highlight||null);de(A,s=>{localStorage.setItem("tasksViewMode",s)});const f=(s,h="")=>{A.value;const T=M.value;if(A.value=s,s==="card"&&h&&(n.value=h),s==="table"&&T)n.value="",l.push({path:"/tasks",query:{highlight:T.compositeId}});else if(s==="card"&&S.value){const[p,D]=S.value.split("-");l.push({path:`/tasks/${D}`,query:{type:p}})}else s==="card"&&!S.value&&!M.value&&l.push({path:"/tasks"})},q=U([]),ie=U(""),X=U(!1),G=U(null);U(!1);const ee=U(!1),ne=U(null),te=U(!1),j=U(null),{allTasks:Y,applyFilters:c}=St(X),{sortTasks:t}=Vs(),v=O(()=>{let s=c(Y.value,q.value);return s=t(s,ie.value),s}),M=O(()=>{if(!$.params.id)return null;const s=parseInt($.params.id);if(isNaN(s))return null;const h=$.query.type;if(h){const z=`${h}-${s}`;return Y.value.find(at=>at.compositeId===z)||null}const T=q.value.filter(z=>z==="lead"||z==="opportunity"),p=T.length>0?Y.value.filter(z=>T.includes(z.type)):Y.value,D=`lead-${s}`,J=`opportunity-${s}`,Q=p.find(z=>z.compositeId===D||z.compositeId===J);return Q||Y.value.find(z=>z.compositeId===D||z.compositeId===J)||null});O(()=>M.value?M.value.type==="lead"?o.currentLeadActivities:i.currentOpportunityActivities:[]);const K=Le(M),P=K.managementWidget,V=K.storeAdapter,ue=K.addNewConfig,he=O(()=>j.value),ce=Le(he),ke=O(()=>ce.managementWidget.value),Ce=O(()=>ce.storeAdapter.value),Ke=O(()=>ce.addNewConfig.value),Je=E;pt(()=>{o.fetchLeads(),i.fetchOpportunities();const s=$.params.id;s&&Se(s)}),de(()=>$.params.id,s=>{s&&Se(s)}),de(M,s=>{s&&(s.type==="lead"?o.fetchLeadById(s.id):i.fetchOpportunityById(s.id))},{immediate:!0}),de(j,s=>{s&&(s.type==="lead"?o.fetchLeadById(s.id):i.fetchOpportunityById(s.id))},{immediate:!0});const Se=s=>{const h=parseInt(s),T=Y.value.find(p=>p.id===h);T&&(T.type==="lead"?o.fetchLeadById(h):i.fetchOpportunityById(h))},re=s=>{const[h,T]=s.split("-");if(A.value==="table"){const p=Y.value.find(D=>D.compositeId===s);p&&(j.value=p,te.value=!0,p.type==="lead"?o.fetchLeadById(p.id):i.fetchOpportunityById(p.id));return}A.value="card",l.push({path:`/tasks/${T}`,query:{type:h}})},be=()=>{if(te.value){xe();return}l.push({path:"/tasks"})},xe=()=>{te.value=!1,j.value=null},Xe=s=>{if(!M.value)return;const h=v.value.findIndex(T=>{const p=M.value.compositeId||`${M.value.type}-${M.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===p});if(h!==-1){if(s==="previous"&&h>0){const T=v.value[h-1];re(T.compositeId)}else if(s==="next"&&h<v.value.length-1){const T=v.value[h+1];re(T.compositeId)}}},Ze=s=>{if(!j.value)return;const h=v.value.findIndex(T=>{const p=j.value.compositeId||`${j.value.type}-${j.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===p});if(h!==-1){if(s==="previous"&&h>0){const T=v.value[h-1];re(T.compositeId)}else if(s==="next"&&h<v.value.length-1){const T=v.value[h+1];re(T.compositeId)}}},$e=s=>{G.value=G.value===s?null:s},Ae=s=>{ne.value=s,ee.value=!0,G.value=null},_e=s=>{ie.value=s},et=async s=>{if(!ne.value)return;const h=ne.value,T=s.name;h.type==="lead"?await o.updateLead(h.id,{assignee:T,assigneeType:s.type,teamId:s.type==="team"?s.id:null}):h.type==="opportunity"&&await i.updateOpportunity(h.id,{assignee:T,assigneeType:s.type,teamId:s.type==="team"?s.id:null}),ee.value=!1,ne.value=null},tt=async s=>{G.value=null,s.type==="lead"?await o.updateLead(s.id,{priority:"Hot"}):s.type==="opportunity"&&await i.updateOpportunity(s.id,{priority:"Hot"})},st=async s=>{G.value=null,s.type==="lead"?await o.updateLead(s.id,{priority:"Normal"}):s.type==="opportunity"&&await i.updateOpportunity(s.id,{priority:"Normal"})},nt=async s=>{G.value=null;const h=d.user;h&&(s.type==="lead"?await o.updateLead(s.id,{assignee:h.name,assigneeType:"user"}):s.type==="opportunity"&&await i.updateOpportunity(s.id,{assignee:h.name,assigneeType:"user"}))},rt=async s=>{if(G.value=null,s.type==="lead")try{const h=s.displayStage||s.stage||Te.NEW,T=Te.NEW,p=wt(h,T);if(p){const{updates:D,activities:J}=p(s);await o.updateLead(s.id,D);for(const Q of J)await o.addActivity(s.id,Q)}else await o.updateLead(s.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await o.addActivity(s.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await o.fetchLeadById(s.id)}catch(h){console.error("Failed to reopen lead:",h)}},lt=s=>{var T;const h=[];return s.type==="lead"&&s.isDisqualified===!0&&h.push({key:"reopen",label:"Reopen Lead",onClick:()=>rt(s)}),h.push({key:"reassign",label:"Reassign",onClick:()=>Ae(s)}),s.assignee!==((T=d.user)==null?void 0:T.name)&&h.push({key:"assign-me",label:"Assign to me",onClick:()=>nt(s)}),s.priority!=="Hot"?h.push({key:"mark-hot",label:"Mark as hot",onClick:()=>tt(s)}):h.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>st(s)}),h};return(s,h)=>{var T;return b(),k("div",zs,[H(Rs,{show:!!M.value||A.value==="table"&&!!j.value,"back-label":"Back to task list",onBack:be},null,8,["show"]),A.value==="card"?(b(),k("div",Ws,[u("div",{class:W(["flex flex-col overflow-hidden",M.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[H(gs,{title:"Tasks",items:v.value,"selected-id":M.value?String(M.value.compositeId):null,"view-mode":A.value,"initial-search-query":n.value,onViewChange:f,"selected-class":p=>p.type==="lead"?"bg-surface border-2 border-blue-500":"bg-surface border-2 border-purple-500","unselected-class":L(Je),"open-menu-id":G.value,getName:p=>{const D=p.customer;return D&&D.name?D.name:D&&!D.name&&D.email&&D.email.split("@")[0]||"Unknown"},getInitials:p=>{const D=p.customer;return D&&D.initials?D.initials:D&&D.name&&D.name.split(" ").map(Q=>Q[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:p=>{if(p.type==="lead"){if(!p.requestedCar)return"No vehicle specified";const Q=p.requestedCar,z=[`${Q.brand} ${Q.model}`];return Q.kilometers!==void 0&&Q.kilometers!==null&&z.push(`${Q.kilometers} km`),Q.status&&z.push(Q.status),z.join(" â€¢ ")}const D=p.vehicle||p.requestedCar;if(!D)return"No vehicle specified";const J=[`${D.brand} ${D.model}`];return D.kilometers!==void 0&&D.kilometers!==null&&J.push(`${D.kilometers} km`),D.status&&J.push(D.status),J.join(" â€¢ ")},avatarClass:p=>p.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":lt,"show-mobile-close":!1,onSelect:re,onMenuClick:$e,onMenuClose:h[0]||(h[0]=p=>G.value=null),onClose:be,"active-filters":q.value,onFilterChange:h[1]||(h[1]=p=>q.value=p),onSortChange:_e},{badges:R(({item:p})=>[p&&p.type?(b(),se(L(De),{key:0,text:p.type==="lead"?"Lead":"Opportunity",size:"small",theme:p.type==="lead"?"blue":"gray"},null,8,["text","theme"])):F("",!0),p&&p.type==="lead"&&L(g).getSetting("urgencyEnabled")!==!1&&p.urgencyLevel?(b(),k("span",{key:1,class:W(["inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border",L(Ye)(p.urgencyLevel)])},[(b(),se(yt(r(p.urgencyLevel)),{class:"size-3 shrink-0"})),oe(" "+B(p.urgencyLevel),1)],2)):F("",!0),p&&p.priority==="Hot"&&(L(g).getSetting("urgencyEnabled")===!1||p.type!=="lead")?(b(),se(L(De),{key:2,text:"HOT",size:"small",theme:"red"})):F("",!0)]),location:R(({item:p})=>[oe(B(L(I)(p)||"Unknown"),1)]),source:R(({item:p})=>{var D;return[oe(B(p.source||((D=p.customer)==null?void 0:D.source)||"Unknown"),1)]}),owner:R(({item:p})=>[p.assignee?(b(),k("div",Es,[u("div",js,B(L(C)(p.assignee)),1),u("span",Ps,B(p.assignee),1)])):(b(),k("span",Qs,"Unassigned"))]),dates:R(({item:p})=>[p.type==="lead"&&p.nextActionDue?(b(),k("span",Gs,"Due: "+B(L(m)(p.nextActionDue)),1)):p.type==="opportunity"&&p.nextActionDue?(b(),k("span",Ys,"Due: "+B(L(m)(p.nextActionDue)),1)):(b(),k("span",Ks,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),M.value?(b(),se(Me,{key:0,task:M.value,"management-widget":L(P),"store-adapter":L(V),"add-new-config":L(ue),"filtered-tasks":v.value,onTaskNavigate:Xe},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0),M.value?F("",!0):(b(),k("div",Js,[...h[5]||(h[5]=[ft('<div class="flex-1 flex items-center justify-center p-8" data-v-64e5c965><div class="text-center max-w-sm" data-v-64e5c965><div class="w-16 h-16 mx-auto mb-4 rounded-lg bg-muted flex items-center justify-center" data-v-64e5c965><i class="fa-solid fa-tasks text-2xl text-muted-foreground" data-v-64e5c965></i></div><h3 class="text-content-bold mb-2" data-v-64e5c965>No task selected</h3><p class="text-meta" data-v-64e5c965>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):F("",!0),A.value==="table"?(b(),k("div",Xs,[H(Ns,{tasks:L(Y),"current-task-id":(T=j.value)==null?void 0:T.compositeId,"highlight-id":S.value,"show-closed":X.value,"show-mobile-close":!1,"open-menu-id":G.value,"get-vehicle-type":L(y),"get-vehicle-type-badge-class":L(a),"get-owner-info":L(x),"get-stage-badge-class":L(ze),"view-mode":A.value,onSelect:re,onMenuClick:$e,onMenuClose:h[2]||(h[2]=p=>G.value=null),onToggleClosed:h[3]||(h[3]=p=>X.value=p),onReassign:Ae,onClose:be,onViewChange:f,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):F("",!0),A.value==="table"?(b(),se($t,{key:2,show:te.value,onClose:xe},{default:R(()=>[j.value&&ke.value&&Ce.value?(b(),se(Me,{key:0,task:j.value,"management-widget":ke.value,"store-adapter":Ce.value,"add-new-config":Ke.value,"filtered-tasks":L(Y),"is-drawer-view":!0,onTaskNavigate:Ze,onClose:xe},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0)]),_:1},8,["show"])):F("",!0),H(At,{show:ee.value,onClose:h[4]||(h[4]=p=>ee.value=!1),onConfirm:et},null,8,["show"])])}}},fn=me(Zs,[["__scopeId","data-v-64e5c965"]]);export{fn as default};
