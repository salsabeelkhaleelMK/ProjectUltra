import{a2 as _t,h as ye,d as n,o as a,e,n as N,w as ae,t as y,F as P,i as H,x as B,y as d,g as x,B as D,s as p,X as es,r as O,c as q,a7 as ts,L as Xe,k as L,C as It,l as me,m as Le,K as At,p as G,j as vt,N as ge,a0 as ss,v as yt,a5 as Ie,E as as,R as ls,G as ns,O as Ye,V as bt,M as is,I as xt,a8 as os,a9 as rs}from"./index-D8nDSNmq.js";import{u as Dt}from"./opportunities-D1cnNxBd.js";import{u as qt,_ as ds}from"./UnifiedAddForm-qVlS6TXg.js";import{z as re,n as Z,b as us,Z as cs,a as ms,e as fs,J as ps,Y as vs,$ as Et,Q as R,c as Y,W as Ae,U as De,H as qe,j as z,G as Ee,f as Ze,F as _e,L as et,g as tt,h as st,o as ys,C as at,d as lt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import{G as gt,H as ht,I as kt,h as Ge,i as Ke,T as bs,_ as xs,P as gs,n as hs,o as ks,j as ws,k as $s,l as Cs,m as Vt,x as Ts,y as Ss,q as Lt,z as Mt}from"./opportunityRules-DnV0W7Tj.js";import{_ as Is}from"./ReassignUserModal-ChhlJNp9.js";import{a as As,_ as Ds}from"./CreateEventModal-Dcf8GuUu.js";import{u as qs,b as Es,c as Vs,d as Ls}from"./users-CPXYaoWs.js";import{fetchLeadsByCustomerId as Ms,fetchOpportunitiesByCustomerId as Os,fetchTasksByCustomerId as Ns,fetchCustomerCars as Bs}from"./contacts-BG9sTx9a.js";const js={class:"page-header-main"},Rs={class:"page-header-content"},Fs={class:"flex items-center gap-3 min-w-0 flex-1"},Us={class:"min-w-0 flex-1 flex flex-col justify-center"},Ps={class:"flex items-center gap-2 -mb-2"},Ws={class:"text-fluid-lg font-semibold text-heading truncate leading-tight mb-0"},zs={class:"hidden lg:flex items-center gap-1.5 ml-2"},Hs={class:"flex items-center gap-4 flex-wrap -mt-2"},Ys={class:"flex items-center gap-1.5 group"},Gs={class:"text-xs text-body truncate max-w-40 sm:max-w-52"},Ks={class:"flex items-center gap-1.5 group"},Qs={class:"text-xs text-body whitespace-nowrap"},Js={class:"flex items-center gap-1.5"},Xs={key:0,class:"fa-solid fa-map-marker-alt text-xs text-sub"},Zs={key:1,class:"fa-regular fa-calendar text-xs text-sub"},_s={class:"text-xs text-body truncate max-w-40 sm:max-w-52"},ea={class:"lg:hidden flex items-center gap-1.5 ml-auto"},ta={class:"page-header-actions"},sa={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]},showCloseButton:{type:Boolean,default:!1}},emits:["add-tag","close"],setup(t,{emit:g}){const o=t,k=g,S=_t(),w=ye(),r=async(u,l)=>{try{await navigator.clipboard.writeText(u),S.pushToast("success",`${l==="email"?"Email":"Phone"} copied!`)}catch{S.pushToast("error","Failed to copy")}},i=()=>k("add-tag"),I=()=>{o.customerId&&w.push(`/customer/${o.customerId}`)};return(u,l)=>(a(),n("div",js,[e("div",Rs,[e("div",Fs,[e("button",{onClick:ae(I,["stop"]),class:N(["w-10 h-10 rounded-lg bg-primary text-white flex items-center justify-center cursor-pointer hover:opacity-90 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...l[3]||(l[3]=[e("i",{class:"fa-solid fa-user text-base"},null,-1)])],2),e("div",Us,[e("div",Ps,[e("h1",Ws,y(t.name),1),e("div",zs,[(a(!0),n(P,null,H(t.tags,s=>(a(),B(d(re),{key:s,text:s,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:ae(i,["stop"]),class:"text-xs text-sub hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors whitespace-nowrap"},[...l[4]||(l[4]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"tag",-1)])])])]),e("div",Hs,[e("div",Ys,[l[6]||(l[6]=e("i",{class:"fa-regular fa-envelope text-xs text-sub"},null,-1)),e("span",Gs,y(t.email),1),e("button",{onClick:l[0]||(l[0]=ae(s=>r(t.email,"email"),["stop"])),class:"opacity-0 group-hover:opacity-100 transition-opacity ml-0.5"},[...l[5]||(l[5]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-primary"},null,-1)])])]),e("div",Ks,[l[8]||(l[8]=e("i",{class:"fa-solid fa-phone text-xs text-sub"},null,-1)),e("span",Qs,y(t.phone),1),e("button",{onClick:l[1]||(l[1]=ae(s=>r(t.phone,"phone"),["stop"])),class:"opacity-0 group-hover:opacity-100 transition-opacity ml-0.5"},[...l[7]||(l[7]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-primary"},null,-1)])])]),e("div",Js,[t.thirdFieldLabel.toLowerCase().includes("address")?(a(),n("i",Xs)):(a(),n("i",Zs)),e("span",_s,y(t.thirdFieldValue),1)]),e("div",ea,[(a(!0),n(P,null,H(t.tags,s=>(a(),B(d(re),{key:s,text:s,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:ae(i,["stop"]),class:"text-xs text-sub hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors"},[...l[9]||(l[9]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"tag",-1)])])])])])]),e("div",ta,[t.showCloseButton?(a(),B(d(Z),{key:0,variant:"secondary",size:"icon",onClick:l[2]||(l[2]=ae(s=>u.$emit("close"),["stop"]))},{default:D(()=>[p(d(es),{size:16,class:"text-sub"})]),_:1})):x("",!0)])])]))}},aa={class:"hidden md:inline whitespace-nowrap"},wt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const g={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},o=k=>g[k]||"fa-solid fa-circle";return(k,S)=>(a(),B(d(ms),{"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=w=>k.$emit("update:modelValue",w))},{default:D(()=>[p(d(us),{class:"w-full justify-start border-b border-border bg-transparent"},{default:D(()=>[(a(!0),n(P,null,H(t.tabs,w=>(a(),B(d(cs),{key:w.key,value:w.key,class:"flex items-center gap-1.5 data-[state=active]:border-b-2 data-[state=active]:border-brand-dark data-[state=active]:text-brand-darkDarker rounded-none pb-2 focus-visible:outline-none focus-visible:ring-0"},{default:D(()=>[e("i",{class:N([o(w.key),"text-sm"])},null,2),e("span",aa,y(w.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]))}},la={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},na={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},ia={class:"flex items-center gap-1.5"},oa={key:1},ra={class:"flex items-center gap-2"},da={key:0,class:"space-y-4"},ua={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ca={class:"flex items-center gap-4"},ma={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},fa=["src"],pa={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},va={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},ya={class:"flex items-center gap-2 flex-wrap"},ba={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},xa={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},ga={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},ha={class:"text-fluid-xs font-bold text-heading"},ka={key:0,class:"text-right"},wa={class:"font-bold text-heading text-fluid-lg"},$a={key:0,class:"pt-2"},Ca={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Ta={class:"text-fluid-sm text-body leading-relaxed"},Sa={key:1,class:"space-y-3"},Ia={key:0,class:"flex items-center gap-2"},Aa={class:"text-fluid-sm font-semibold text-heading"},Da={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},qa={class:"text-fluid-sm text-body leading-relaxed"},Ea={key:2,class:"border-t border-black/5"},Va={class:"font-medium"},La={key:3,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},Ma={class:"mb-6"},Oa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Na={key:0},Ba={class:"font-medium text-body"},ja={key:1},Ra={class:"font-medium text-body"},Fa={key:2},Ua={class:"font-medium text-body"},Pa={class:"font-medium text-body"},Wa={key:0},za={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ha={key:0},Ya={class:"font-medium text-body"},Ga={key:1},Ka={class:"font-medium text-body"},Qa={key:2},Ja={class:"font-medium text-body"},Xa={key:3},Za={class:"font-medium text-body"},_a={key:4},el={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},tl={key:5},sl={class:"font-medium text-body"},al={key:0,class:"mt-6 flex justify-end"},ll={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const g=t,o=O(!1);q(()=>g.deliverySubstatus?ts(g.deliverySubstatus):"");const k=q(()=>g.deliverySubstatus?g.deliverySubstatus==="Delivered"?"green":g.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),S=q(()=>Xe(g.stage,g.entityType));function w($){return!$||$.length===0?null:$.filter(U=>U.type==="offer").sort((U,ee)=>new Date(ee.timestamp)-new Date(U.timestamp))[0]||null}function r($){if(!$)return 0;const A=new Date($),ee=Math.abs(new Date-A);return Math.ceil(ee/(1e3*60*60*24))}const i=q(()=>{if(g.stage!=="In Negotiation")return null;const $=w(g.activities);if(!$)return null;const A=r($.timestamp);return A<1?{label:"New Offer",theme:"orange"}:A<3?{label:"Active",theme:"yellow"}:null}),I=q(()=>g.requestedCar&&g.requestedCar.brand&&g.requestedCar.model),u=q(()=>g.requestType||g.requestMessage||I.value),l=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.brand)||""}),s=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.model)||""}),b=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.year)||""}),E=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.image)||""}),C=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.price)||null}),T=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.stockDays)!==void 0?g.requestedCar.stockDays:null}),m=q(()=>{var $,A;return(($=g.requestedCar)==null?void 0:$.dealership)||((A=g.task)==null?void 0:A.dealership)||""}),f=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.registration)||""}),c=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.kilometers)!==void 0?g.requestedCar.kilometers:null}),V=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.fuelType)||""}),F=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.gearType)||""}),te=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.vin)||""}),J=q(()=>"Email"),ue=q(()=>{var $,A;return(($=g.task)==null?void 0:$.sourceDetails)||((A=g.requestedCar)==null?void 0:A.adCampaign)||""}),be=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.expectedPurchaseDate)||""}),fe=q(()=>{var $;return(($=g.task)==null?void 0:$.fiscalEntity)||""}),ce=q(()=>{var $;return(($=g.task)==null?void 0:$.sourceDetails)||""}),le=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.adMedium)||""}),he=q(()=>{var $;return(($=g.requestedCar)==null?void 0:$.adSource)||""});q(()=>!0);const de=q(()=>!0),X=q(()=>I.value||g.requestType||g.source||ce.value||ue.value||be.value||fe.value||le.value||he.value),pe=$=>new Intl.NumberFormat("en-US").format($),ne=$=>new Intl.NumberFormat("en-US").format($);return($,A)=>(a(),B(d(vs),{class:"w-full mb-6 shadow-mk-dashboard-card"},{default:D(()=>[p(d(fs),{class:"px-4 md:px-6 py-3 border-b border-black/5"},{default:D(()=>[e("div",la,[u.value?(a(),n("div",na,[A[2]||(A[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",ia,[e("span",{class:N(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},y(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:N(["px-2 py-0.5 rounded text-fluid-xs font-medium border",S.value])},y(t.stage),3),t.deliverySubstatus?(a(),B(d(re),{key:0,text:t.deliverySubstatus,size:"small",theme:k.value},null,8,["text","theme"])):x("",!0),i.value?(a(),B(d(re),{key:1,text:i.value.label,size:"small",theme:i.value.theme},null,8,["text","theme"])):x("",!0)])])):(a(),n("div",oa)),e("div",ra,[A[3]||(A[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),p(d(Z),{onClick:A[0]||(A[0]=U=>$.$emit("reassign")),variant:"link",size:"small",class:"text-fluid-xs font-bold"},{default:D(()=>[L(y(t.owner),1)]),_:1})])])]),_:1}),u.value?(a(),B(d(ps),{key:0,class:"p-4 md:p-6"},{default:D(()=>[I.value?(a(),n("div",da,[e("div",ua,[e("div",ca,[e("div",ma,[E.value?(a(),n("img",{key:0,src:E.value,alt:"Car",class:"w-full h-full object-cover"},null,8,fa)):(a(),n("i",pa))]),e("div",null,[e("div",va,y(l.value)+" "+y(s.value)+" ("+y(b.value)+")",1),e("div",ya,[T.value!==void 0&&T.value!==null?(a(),n("div",ba,[A[4]||(A[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),L(" In stock ("+y(T.value)+" days) ",1)])):I.value?(a(),n("div",xa,[...A[5]||(A[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),L(" Out of stock ",-1)])])):x("",!0),t.source?(a(),n("div",ga,[A[6]||(A[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",ha,y(t.source),1)])):x("",!0)])])]),C.value?(a(),n("div",ka,[A[7]||(A[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",wa,"€ "+y(pe(C.value)),1)])):x("",!0)]),t.requestMessage?(a(),n("div",$a,[A[8]||(A[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",Ca,[e("p",Ta,y(t.requestMessage),1)])])):x("",!0)])):(a(),n("div",Sa,[t.requestType?(a(),n("div",Ia,[A[9]||(A[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",Aa,y(t.requestType),1)])):x("",!0),t.requestMessage?(a(),n("div",Da,[A[10]||(A[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",qa,y(t.requestMessage),1)])):x("",!0)])),X.value?(a(),n("div",Ea,[e("button",{onClick:A[1]||(A[1]=U=>o.value=!o.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Va,y(o.value?"Hide":"View")+" Details",1),e("i",{class:N(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":o.value}])},null,2)])])):x("",!0),o.value&&X.value?(a(),n("div",La,[e("div",Ma,[A[21]||(A[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Oa,[t.requestType?(a(),n("div",Na,[A[11]||(A[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",Ba,y(t.requestType),1)])):x("",!0),t.source?(a(),n("div",ja,[A[12]||(A[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",Ra,y(t.source),1)])):x("",!0),e("div",null,[A[13]||(A[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:N(["font-medium",ce.value?"text-body":"text-sub"])},y(ce.value||"--"),3)]),m.value?(a(),n("div",Fa,[A[14]||(A[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Ua,y(m.value),1)])):x("",!0),e("div",null,[A[15]||(A[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",Pa,y(J.value||"Email"),1)]),e("div",null,[A[16]||(A[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:N(["font-medium",ue.value?"text-body":"text-sub"])},y(ue.value||"--"),3)]),e("div",null,[A[17]||(A[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:N(["font-medium",le.value?"text-body":"text-sub"])},y(le.value||"--"),3)]),e("div",null,[A[18]||(A[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:N(["font-medium",he.value?"text-body":"text-sub"])},y(he.value||"--"),3)]),e("div",null,[A[19]||(A[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:N(["font-medium",be.value?"text-body":"text-sub"])},y(be.value||"--"),3)]),e("div",null,[A[20]||(A[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:N(["font-medium",fe.value?"text-body":"text-sub"])},y(fe.value||"--"),3)])])]),I.value?(a(),n("div",Wa,[A[30]||(A[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[A[29]||(A[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",za,[f.value?(a(),n("div",Ha,[A[22]||(A[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Ya,y(f.value),1)])):x("",!0),c.value!==void 0&&c.value!==null?(a(),n("div",Ga,[A[23]||(A[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",Ka,y(ne(c.value))+" Km",1)])):x("",!0),V.value?(a(),n("div",Qa,[A[24]||(A[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Ja,y(V.value),1)])):x("",!0),F.value?(a(),n("div",Xa,[A[25]||(A[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Za,y(F.value),1)])):x("",!0),te.value?(a(),n("div",_a,[A[26]||(A[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",el,y(te.value),1)])):x("",!0),m.value?(a(),n("div",tl,[A[27]||(A[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",sl,y(m.value),1)])):x("",!0)]),de.value?(a(),n("div",al,[p(d(Z),{variant:"outline",size:"small",class:"flex items-center gap-2"},{default:D(()=>[...A[28]||(A[28]=[e("i",{class:"fa-solid fa-list-check text-xs"},null,-1),L(" View technical specs ",-1)])]),_:1})])):x("",!0)])])):x("",!0)])):x("",!0)]),_:1})):x("",!0)]),_:1}))}},nl={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},il={class:"px-4 py-4 flex items-center justify-between shrink-0"},ol={class:"flex items-center gap-2"},rl={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},dl={class:"flex items-center gap-2 flex-wrap mb-3"},ul={key:0,class:"space-y-3"},cl={class:"flex items-center gap-3"},ml={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},fl=["src"],pl={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},vl={class:"flex-1 min-w-0"},yl={class:"font-bold text-heading text-fluid-sm mb-1"},bl={class:"flex items-center gap-2 flex-wrap"},xl={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},gl={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},hl={key:0,class:"text-right"},kl={class:"font-bold text-heading text-fluid-sm"},wl={class:"flex justify-end pt-2"},$l={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Cl={class:"mt-3 pt-3 space-y-2"},Tl={key:0,class:"flex items-center justify-between text-fluid-xs"},Sl={class:"text-heading font-medium"},Il={key:1,class:"flex items-center justify-between text-fluid-xs"},Al={class:"text-heading font-medium"},Dl={key:2,class:"pt-2"},ql={class:"bg-surfaceSecondary rounded-lg p-2"},El={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},$t={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const g=t,o=q(()=>g.task.requestedCar&&g.task.requestedCar.brand&&g.task.requestedCar.model),k=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.brand)||""}),S=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.model)||""}),w=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.year)||""}),r=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.image)||""}),i=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.price)||null}),I=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.stockDays)!==void 0?g.task.requestedCar.stockDays:null}),u=q(()=>{var m;return((m=g.task.requestedCar)==null?void 0:m.requestMessage)||""}),l=q(()=>Xe(g.task.displayStage||g.task.stage,g.entityType)),s=q(()=>g.task.deliverySubstatus?g.task.deliverySubstatus==="Delivered"?"green":g.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function b(m){return!m||m.length===0?null:m.filter(c=>c.type==="offer").sort((c,V)=>new Date(V.timestamp)-new Date(c.timestamp))[0]||null}function E(m){if(!m)return 0;const f=new Date(m),V=Math.abs(new Date-f);return Math.ceil(V/(1e3*60*60*24))}const C=q(()=>{if((g.task.displayStage||g.task.stage)!=="In Negotiation")return null;const m=b(g.activities);if(!m)return null;const f=E(m.timestamp);return f<1?{label:"New Offer",theme:"orange"}:f<3?{label:"Active",theme:"yellow"}:null}),T=m=>new Intl.NumberFormat("en-US").format(m);return(m,f)=>{var c,V;return a(),n("div",nl,[e("div",il,[f[4]||(f[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Requested Car")],-1)),e("div",ol,[f[3]||(f[3]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:f[0]||(f[0]=F=>m.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},y(t.task.assignee),1)])]),e("div",rl,[e("div",dl,[e("span",{class:N(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},y(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:N(["px-2 py-1 rounded text-xs font-medium border",l.value])},y(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(a(),B(d(re),{key:0,text:t.task.deliverySubstatus,size:"small",theme:s.value},null,8,["text","theme"])):x("",!0),C.value?(a(),B(d(re),{key:1,text:C.value.label,size:"small",theme:C.value.theme},null,8,["text","theme"])):x("",!0)]),o.value?(a(),n("div",ul,[e("div",cl,[e("div",ml,[r.value?(a(),n("img",{key:0,src:r.value,alt:"Car",class:"w-full h-full object-cover"},null,8,fl)):(a(),n("i",pl))]),e("div",vl,[e("div",yl,y(k.value)+" "+y(S.value)+" ("+y(w.value)+")",1),e("div",bl,[I.value!==void 0&&I.value!==null?(a(),n("div",xl,[f[5]||(f[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),L(" In stock ("+y(I.value)+" days) ",1)])):(a(),n("div",gl,[...f[6]||(f[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),L(" Out of stock ",-1)])]))])]),i.value?(a(),n("div",hl,[f[7]||(f[7]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",kl,"€ "+y(T(i.value)),1)])):x("",!0)]),e("div",wl,[p(d(Z),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:f[1]||(f[1]=F=>m.$emit("add-requested-car")),class:"text-fluid-xs"},null,8,["label"])])])):(a(),n("div",$l,[f[8]||(f[8]=e("i",{class:"fa-solid fa-car text-4xl text-sub mb-3"},null,-1)),f[9]||(f[9]=e("p",{class:"text-fluid-sm text-body mb-4"},"No requested car added yet",-1)),p(d(Z),{label:"+ Add or update",variant:"outline",size:"small",onClick:f[2]||(f[2]=F=>m.$emit("add-requested-car"))})])),e("div",Cl,[t.task.source?(a(),n("div",Tl,[f[10]||(f[10]=e("span",{class:"text-sub"},"Source",-1)),e("span",Sl,y(t.task.source),1)])):x("",!0),t.task.requestType||(c=t.task.requestedCar)!=null&&c.requestType?(a(),n("div",Il,[f[11]||(f[11]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",Al,y(t.task.requestType||((V=t.task.requestedCar)==null?void 0:V.requestType)),1)])):x("",!0),u.value?(a(),n("div",Dl,[f[12]||(f[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",ql,[e("p",El,y(u.value),1)])])):x("",!0)])])])}}},Vl={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ll={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},Ml={class:"flex items-center gap-2"},Ol={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Nl={class:"bg-white rounded-lg p-3 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},Bl={key:0,class:"text-center py-6 text-sub"},jl={key:1,class:"space-y-2 overflow-y-auto flex-1"},Rl=["onClick"],Fl={class:"flex items-start justify-between gap-2"},Ul={class:"flex-1 min-w-0"},Pl={class:"flex items-center gap-2 mb-1 flex-wrap"},Wl={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-sub"},zl={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},Hl={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-sub"},Yl={key:1,class:"flex items-center gap-1 text-xs text-sub"},Gl={key:2,class:"flex items-center gap-1 text-xs text-sub"},Kl={class:"truncate max-w-[150px]"},Ql={key:3,class:"flex items-center gap-1 text-xs"},Jl={class:"font-bold text-heading"},Xl={key:2,class:"text-center py-8 text-sub"},Ct={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const g=t,o=ye(),k=It(),S=Dt(),w=O(!1),r=O([]),i=O([]),I=q(()=>{var T;return g.task.customerId||((T=g.task.customer)==null?void 0:T.id)||null}),u=async()=>{if(I.value){w.value=!0;try{await Promise.all([k.fetchLeads(),S.fetchOpportunities()]),r.value=k.leads||[],i.value=S.opportunities||[]}catch(T){console.error("Error fetching related tasks:",T)}finally{w.value=!1}}},l=q(()=>{if(!I.value)return[];const T=[];return r.value.forEach(m=>{m.customerId===I.value&&!(m.id===g.task.id&&g.entityType==="lead")&&T.push({...m,type:"lead"})}),i.value.forEach(m=>{m.customerId===I.value&&!(m.id===g.task.id&&g.entityType==="opportunity")&&T.push({...m,type:"opportunity"})}),T.sort((m,f)=>{const c=new Date(m.createdAt||0);return new Date(f.createdAt||0)-c})}),s=T=>{const m=T.requestedCar||T.vehicle;return m&&m.brand&&m.model?`${m.brand} ${m.model}`:null},b=T=>T?new Intl.NumberFormat("en-US").format(T):"0",E=T=>{if(!T)return"";const m=new Date(T),c=new Date-m,V=Math.floor(c/(1e3*60*60*24));return V===0?"Today":V===1?"Yesterday":V<7?`${V} days ago`:V<30?`${Math.floor(V/7)} weeks ago`:m.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},C=T=>{o.push({path:`/tasks/${T.id}`,query:{type:T.type}})};return me(()=>g.task.id,()=>{u()},{immediate:!0}),Le(()=>{u()}),(T,m)=>(a(),n("div",Vl,[e("div",Ll,[e("div",Ml,[m[0]||(m[0]=e("i",{class:"fa-solid fa-list text-heading text-xs"},null,-1)),m[1]||(m[1]=e("h2",{class:"text-fluid-xs font-medium text-heading"},"Other Tasks for This Customer",-1)),l.value.length>0?(a(),n("span",Ol,y(l.value.length),1)):x("",!0)])]),e("div",Nl,[w.value?(a(),n("div",Bl,[...m[2]||(m[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):l.value.length>0?(a(),n("div",jl,[(a(!0),n(P,null,H(l.value,f=>(a(),n("div",{key:`${f.type}-${f.id}`,class:"flex flex-col p-2 border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors cursor-pointer group",onClick:c=>C(f)},[e("div",Fl,[e("div",Ul,[e("div",Pl,[e("span",{class:N(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",f.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},y(f.type==="lead"?"Lead":"Opp"),3),e("span",{class:N(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",d(Xe)(f.displayStage||f.stage,f.type)])},y(f.displayStage||f.stage),3),f.createdAt?(a(),n("div",Wl,[e("span",null,y(E(f.createdAt)),1)])):x("",!0)]),e("div",zl,[f.createdAt?(a(),n("div",Hl,[m[3]||(m[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,y(E(f.createdAt)),1)])):x("",!0),f.assignee?(a(),n("div",Yl,[m[4]||(m[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,y(f.assignee),1)])):x("",!0),s(f)?(a(),n("div",Gl,[m[5]||(m[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",Kl,y(s(f)),1)])):x("",!0),f.type==="opportunity"&&f.value?(a(),n("div",Ql,[m[6]||(m[6]=e("i",{class:"fa-solid fa-tag text-sub opacity-70"},null,-1)),e("span",Jl,"€ "+y(b(f.value)),1)])):x("",!0)])]),m[7]||(m[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,Rl))),128))])):(a(),n("div",Xl,[...m[8]||(m[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},Zl={key:0,class:"flex-grow border-t border"},_l={key:0,class:"ml-1.5 text-body"},en={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},tn={key:1,class:"flex-grow border-t border"},Tt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:g}){const o=t,k=g,S=O(!1),w={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},r=q(()=>{if(!o.activeTab||o.activeTab==="overview")return o.actions.filter(T=>!w[T]);const C=Object.entries(w).filter(([,T])=>T===o.activeTab).map(([T])=>T);return o.actions.filter(T=>C.includes(T))}),i=q(()=>o.activeTab==="communication"?!0:r.value.length===1),I=q(()=>{if(o.activeTab==="communication")return"add communication";if(!i.value||r.value.length!==1)return"";const C=r.value[0];return{note:"add note",attachment:"add attachment"}[C]||""}),u=q(()=>o.activeTab==="communication"?!1:r.value.length>1),l=q(()=>{const C={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return r.value.map(T=>({key:T,label:C[T]||T,onClick:()=>b(T)}))}),s=q(()=>{if(o.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const C="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return i.value?`${C} px-4 py-2 h-9`:`${C} w-9 h-9`});q(()=>r.value.some(C=>["email","whatsapp","sms"].includes(C))),q(()=>r.value.some(C=>["addVehicle","configureVehicle"].includes(C))),q(()=>r.value.some(C=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(C)));const b=C=>{S.value=!1,k("action",C)},E=()=>{if(o.activeTab==="communication"){b("call");return}i.value&&r.value.length===1?b(r.value[0]):S.value=!S.value};return(C,T)=>{const m=At("click-outside");return t.show?(a(),n("div",{key:0,class:N(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?x("",!0):(a(),n("div",Zl)),e("div",{class:N(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:ae(E,["stop"]),class:N(s.value)},[T[0]||(T[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),i.value?(a(),n("span",_l,y(I.value),1)):x("",!0)],2),S.value&&u.value?G((a(),n("div",en,[p(d(Et),{items:l.value,className:"w-48"},null,8,["items"])])),[[m,()=>S.value=!1]]):x("",!0)],2),t.inline?x("",!0):(a(),n("div",tn))],2)):x("",!0)}}},sn={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},an={class:"flex items-start gap-3"},ln={class:"flex-1 min-w-0"},nn={class:"font-bold text-sm text-heading mb-2"},on={class:"space-y-1.5 text-xs text-gray-600"},rn={class:"flex items-center gap-2"},dn={class:"flex items-center gap-2"},un={class:"flex items-center gap-2"},cn={key:0,class:"mt-2"},mn={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const g=t,o=q(()=>g.appointmentData.date?new Date(g.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),k=q(()=>g.appointmentData.time?g.appointmentData.time:""),S=w=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[w==null?void 0:w.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(w,r)=>(a(),n("div",sn,[e("div",an,[r[3]||(r[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",ln,[e("h4",nn,y(t.appointmentData.type),1),e("div",on,[e("div",rn,[r[0]||(r[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,y(o.value),1)]),e("div",dn,[r[1]||(r[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,y(k.value),1)]),e("div",un,[r[2]||(r[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,y(t.appointmentData.assignee),1)])]),t.appointmentData.status?(a(),n("div",cn,[e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",S(t.appointmentData.status)])},y(t.appointmentData.status),3)])):x("",!0)])])]))}},fn={class:"bg-white border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},pn={class:"flex-1"},vn={class:"flex items-center gap-2 mb-1"},yn={class:"text-sm font-bold text-heading"},bn={class:"text-sm text-body"},xn={class:"text-sm text-sub"},gn={key:0,class:"bg-blue-50 text-blue-600 text-sm px-1 py-0.5 rounded border border-blue-100"},hn={class:"ml-auto relative"},kn={key:0,class:"absolute right-0 top-full mt-1 z-10"},wn={key:0,class:"text-sm text-body"},$n={key:1,class:"text-sm text-body flex items-center gap-2"},Cn={key:2,class:"mt-2"},Tn={key:0},Sn={key:1,class:"bg-white border border-E5E7EB rounded-lg p-3"},In={key:0},An={class:"text-sm font-bold text-heading"},Dn={key:0,class:"text-sm text-sub mt-0.5"},qn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-sub mt-2"},En={key:0},Vn={key:1},Ln={key:2},Mn={key:3},On={key:4},Nn={key:1},Bn={class:"text-sm font-bold text-heading mb-2"},jn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-sub"},Rn={key:0},Fn={class:"text-body font-medium ml-1"},Un={key:1},Pn={class:"text-body font-medium ml-1"},Wn={key:2},zn={class:"text-body font-medium ml-1"},Hn={key:3},Yn={class:"text-body font-medium ml-1"},Gn={key:4},Kn={class:"text-body font-medium ml-1"},Qn={key:5},Jn={class:"text-body font-medium ml-1"},Xn={key:2,class:"flex items-center gap-3"},Zn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},_n=["src"],ei={class:"flex-1"},ti={class:"text-sm font-bold text-heading"},si={class:"text-sm text-sub"},ai={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},li={key:3,class:"flex items-center gap-3"},ni={class:"flex-1"},ii={class:"text-sm font-bold text-heading"},oi={class:"text-sm text-sub"},ri={key:0,class:"text-sm text-sub mt-1"},di={key:1,class:"text-sm text-sub mt-1"},ui={key:4},ci={class:"text-sm font-bold text-heading mb-2"},mi={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-sub"},fi={key:0},pi={class:"text-body font-medium ml-1"},vi={key:1},yi={class:"text-body font-medium ml-1"},bi={key:2},xi={class:"text-body font-medium ml-1"},gi={key:3},hi={class:"text-body font-medium ml-1"},ki={key:4},wi={class:"text-body font-medium ml-1"},$i={key:5},Ci={class:"text-body font-medium ml-1"},Ti={key:0,class:"flex flex-wrap gap-2 mt-2"},Si={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Ii={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},Ai={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},Qe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:g}){const o=t,k=g,S=O(!1),w=q(()=>[{key:"edit",label:"Edit",onClick:s},{key:"delete",label:"Delete",onClick:b}]),r=E=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[E]||"fa-solid fa-circle",i=E=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[E]||"bg-surfaceSecondary text-body border",I=E=>{if(!E)return"Just now";const C=new Date(E),m=new Date-C,f=Math.floor(m/6e4),c=Math.floor(f/60),V=Math.floor(c/24);return f<1?"Just now":f<60?`${f} minutes ago`:c<24?`${c} hours ago`:V===1?"Yesterday":V<7?`${V} days ago`:C.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},u=E=>E?new Intl.NumberFormat("en-US").format(E):"0",l=E=>E?new Date(E).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",s=()=>{S.value=!1,k("edit",o.item)},b=()=>{S.value=!1,confirm("Are you sure you want to delete this item?")&&k("delete",o.item)};return(E,C)=>{const T=At("click-outside");return a(),n("div",fn,[e("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",i(t.item.type)])},[e("i",{class:N([r(t.item.type),"text-sm"])},null,2)],2),e("div",pn,[e("div",vn,[e("span",yn,y(t.customerInitials),1),e("span",bn,y(t.item.action||"added"),1),e("span",xn,"• "+y(I(t.item.timestamp)),1),t.item.autoDetected?(a(),n("span",gn,"Auto-detected")):x("",!0),e("div",hn,[e("button",{onClick:C[0]||(C[0]=ae(m=>S.value=!S.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...C[1]||(C[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),S.value?G((a(),n("div",kn,[p(d(Et),{items:w.value,className:"w-32"},null,8,["items"])])),[[T,()=>S.value=!1]]):x("",!0)])]),t.item.content?(a(),n("div",wn,y(t.item.content),1)):x("",!0),t.item.fileName?(a(),n("div",$n,[C[2]||(C[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,y(t.item.fileName),1)])):x("",!0),t.item.data?(a(),n("div",Cn,[t.item.type==="appointment"?(a(),n("div",Tn,[p(mn,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(a(),n("div",Sn,[t.item.type==="tradein"?(a(),n("div",In,[e("h4",An,y(t.item.data.brand)+" "+y(t.item.data.model),1),t.item.data.version?(a(),n("p",Dn,y(t.item.data.version),1)):x("",!0),e("div",qn,[t.item.data.year?(a(),n("div",En,[C[3]||(C[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),L(y(t.item.data.year),1)])):x("",!0),t.item.data.km?(a(),n("div",Vn,[C[4]||(C[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),L(y(t.item.data.km)+" km ",1)])):x("",!0),t.item.data.plate?(a(),n("div",Ln,[C[5]||(C[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),L(y(t.item.data.plate),1)])):x("",!0),t.item.data.date?(a(),n("div",Mn,[C[6]||(C[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),L(y(l(t.item.data.date)),1)])):x("",!0),t.item.data.class?(a(),n("div",On,[C[7]||(C[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),L(y(t.item.data.class),1)])):x("",!0)])])):t.item.type==="financing"?(a(),n("div",Nn,[e("h4",Bn,y(t.item.data.product),1),e("div",jn,[t.item.data.provider?(a(),n("div",Rn,[C[8]||(C[8]=e("span",{class:"text-sub"},"Provider:",-1)),e("span",Fn,y(t.item.data.provider),1)])):x("",!0),t.item.data.total?(a(),n("div",Un,[C[9]||(C[9]=e("span",{class:"text-sub"},"Total:",-1)),e("span",Pn,"€"+y(u(t.item.data.total)),1)])):x("",!0),t.item.data.monthly?(a(),n("div",Wn,[C[10]||(C[10]=e("span",{class:"text-sub"},"Monthly:",-1)),e("span",zn,"€"+y(u(t.item.data.monthly)),1)])):x("",!0),t.item.data.deposit?(a(),n("div",Hn,[C[11]||(C[11]=e("span",{class:"text-sub"},"Deposit:",-1)),e("span",Yn,"€"+y(u(t.item.data.deposit)),1)])):x("",!0),t.item.data.startDate?(a(),n("div",Gn,[C[12]||(C[12]=e("span",{class:"text-sub"},"Start:",-1)),e("span",Kn,y(l(t.item.data.startDate)),1)])):x("",!0),t.item.data.expDate?(a(),n("div",Qn,[C[13]||(C[13]=e("span",{class:"text-sub"},"Expires:",-1)),e("span",Jn,y(l(t.item.data.expDate)),1)])):x("",!0)])])):t.item.type==="offer"?(a(),n("div",Xn,[t.item.data.image?(a(),n("div",Zn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,_n)])):x("",!0),e("div",ei,[e("h4",ti,y(t.item.data.brand)+" "+y(t.item.data.model)+" ("+y(t.item.data.year)+")",1),e("p",si,"€ "+y(u(t.item.data.price)),1)]),t.item.data.isMainOffer?(a(),n("span",ai,"Main Offer")):x("",!0)])):t.item.type==="purchase"?(a(),n("div",li,[e("div",ni,[e("h4",ii,y(t.item.data.brand)+" "+y(t.item.data.model)+" ("+y(t.item.data.year)+")",1),e("p",oi,"€ "+y(u(t.item.data.price)),1),t.item.data.purchaseDate?(a(),n("p",ri,"Purchased: "+y(l(t.item.data.purchaseDate)),1)):x("",!0),t.item.data.notes?(a(),n("p",di,y(t.item.data.notes),1)):x("",!0)])])):t.item.type==="purchase-method"?(a(),n("div",ui,[e("h4",ci,y(t.item.data.typeLabel||t.item.data.type),1),e("div",mi,[t.item.data.monthlyInstalment?(a(),n("div",fi,[C[14]||(C[14]=e("span",{class:"text-sub"},"Monthly:",-1)),e("span",pi,"€"+y(u(t.item.data.monthlyInstalment)),1)])):x("",!0),t.item.data.duration?(a(),n("div",vi,[C[15]||(C[15]=e("span",{class:"text-sub"},"Duration:",-1)),e("span",yi,y(t.item.data.duration)+" months",1)])):x("",!0),t.item.data.downPayment?(a(),n("div",bi,[C[16]||(C[16]=e("span",{class:"text-sub"},"Down Payment:",-1)),e("span",xi,"€"+y(u(t.item.data.downPayment)),1)])):x("",!0),t.item.data.interestRate?(a(),n("div",gi,[C[17]||(C[17]=e("span",{class:"text-sub"},"Interest Rate:",-1)),e("span",hi,y(t.item.data.interestRate)+"%",1)])):x("",!0),t.item.data.mileageLimit?(a(),n("div",ki,[C[18]||(C[18]=e("span",{class:"text-sub"},"Mileage Limit:",-1)),e("span",wi,y(u(t.item.data.mileageLimit))+" km/year",1)])):x("",!0),t.item.data.customerType?(a(),n("div",$i,[C[19]||(C[19]=e("span",{class:"text-sub"},"Customer Type:",-1)),e("span",Ci,y(t.item.data.customerType),1)])):x("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(a(),n("div",Ti,[t.item.data.insuranceIncluded?(a(),n("span",Si,"Insurance")):x("",!0),t.item.data.maintenanceIncluded?(a(),n("span",Ii,"Maintenance")):x("",!0),t.item.data.registrationTaxesIncluded?(a(),n("span",Ai,"Registration/Taxes")):x("",!0)])):x("",!0)])):x("",!0)]))])):x("",!0)])])}}},Di={class:"space-y-3"},qi={class:"space-y-2"},Ei={class:"flex-1"},Vi={class:"text-xs text-sub uppercase"},Li={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},St={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:g}){const o=t,k=g,S=O(""),w=r=>{r==="copy"&&navigator.clipboard.writeText(o.phoneNumber),k("call",{type:"call",option:r,phoneNumber:o.phoneNumber,notes:S.value})};return(r,i)=>(a(),n("div",Di,[e("div",qi,[i[10]||(i[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:i[0]||(i[0]=I=>w("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[5]||(i[5]=[vt('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[1]||(i[1]=I=>w("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[6]||(i[6]=[vt('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[2]||(i[2]=I=>w("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[i[8]||(i[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Ei,[i[7]||(i[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",Vi,y(t.phoneNumber),1)]),i[9]||(i[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[i[11]||(i[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),G(e("textarea",{"onUpdate:modelValue":i[3]||(i[3]=I=>S.value=I),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[ge,S.value]])]),e("div",Li,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",onClick:i[4]||(i[4]=I=>r.$emit("cancel"))})])]))}},Mi={key:0,class:"space-y-4"},Oi={class:"grid grid-cols-4 gap-2"},Ni=["onClick"],Bi={class:"text-xs font-bold uppercase tracking-wider"},ji={key:1,class:"space-y-4"},Ri={class:"grid grid-cols-4 gap-2"},Fi=["onClick"],Ui={class:"text-xs font-bold uppercase tracking-wider"},Pi={key:0},Wi={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:g}){const o=t,k=g,S=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],w=O(o.type);me(()=>o.type,l=>{l?w.value=l:w.value=null}),me(()=>o.taskId,()=>{w.value=null});const r=q(()=>l=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${w.value===l?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),i=l=>{k("save",{type:"communication",action:`sent via ${l.type}`,content:l.message,communicationType:l.type,template:l.template,subject:l.subject}),k("send",l)},I=l=>{k("save",{type:"communication",action:`called via ${l.option}`,content:l.notes||"Call attempt logged",communicationType:"call",callOption:l.option}),k("send",{type:"call",option:l.option,phoneNumber:l.phoneNumber,notes:l.notes})},u=()=>{w.value=null,k("cancel")};return(l,s)=>t.inline?(a(),n("div",ji,[e("div",Ri,[(a(),n(P,null,H(S,b=>e("button",{key:b.id,onClick:E=>w.value=b.id,class:N(r.value(b.id))},[e("i",{class:N([b.icon,"text-sm"])},null,2),e("span",Ui,y(b.label),1)],10,Fi)),64))]),w.value?(a(),n("div",Pi,[w.value==="email"?(a(),B(gt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="sms"?(a(),B(ht,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(a(),B(kt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="call"?(a(),B(St,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:u},null,8,["phone-number"])):x("",!0)])):x("",!0)])):(a(),n("div",Mi,[e("div",Oi,[(a(),n(P,null,H(S,b=>e("button",{key:b.id,onClick:E=>w.value=b.id,class:N(r.value(b.id))},[e("i",{class:N([b.icon,"text-sm"])},null,2),e("span",Bi,y(b.label),1)],10,Ni)),64))]),e("div",null,[w.value==="email"?(a(),B(gt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="sms"?(a(),B(ht,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(a(),B(kt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="call"?(a(),B(St,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:u},null,8,["phone-number"])):x("",!0)])]))}},zi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Hi={key:1,class:"flex justify-between items-center mb-4"},Yi={class:"text-fluid-sm font-semibold text-heading"},Gi={class:"space-y-4"},Ki={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Qi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ji={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xi={class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},Zi={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},_i={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},eo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},to={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},so={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:g,emit:o}){const k=t,S=o,w=O(!1),r=O({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),i=O({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),I=q(()=>!!r.value.brand&&!!r.value.model&&!!r.value.year);Le(()=>{k.item&&k.item.data&&(r.value={brand:k.item.data.brand||"",model:k.item.data.model||"",year:k.item.data.year||"",version:k.item.data.version||"",vin:k.item.data.vin||"",plates:k.item.data.plate||k.item.data.plates||"",fuelType:k.item.data.fuelType||"",gearType:k.item.data.gearType||"",kilometers:k.item.data.km||k.item.data.kilometers||"",registration:k.item.data.date||k.item.data.registration||""},k.item.data.tradeInPrice!==void 0&&(i.value={tradeInPrice:k.item.data.tradeInPrice||null,evaluationRangeLow:k.item.data.evaluationRangeLow||null,evaluationRangeHigh:k.item.data.evaluationRangeHigh||null,provider:k.item.data.provider||"",evaluationDate:k.item.data.evaluationDate||""},w.value=!0))});const u=()=>{var s,b;if(!I.value)return;const l={id:((s=k.item)==null?void 0:s.id)||Date.now(),type:"tradein",action:k.item?"updated a trade-in":"added a trade-in",timestamp:((b=k.item)==null?void 0:b.timestamp)||new Date().toISOString(),isEdit:!!k.item,data:{brand:r.value.brand,model:r.value.model,year:parseInt(r.value.year)||null,version:r.value.version||null,vin:r.value.vin||null,plate:r.value.plates||null,plates:r.value.plates||null,fuelType:r.value.fuelType||null,gearType:r.value.gearType||null,km:parseInt(r.value.kilometers)||0,kilometers:parseInt(r.value.kilometers)||0,date:r.value.registration||null,registration:r.value.registration||null,tradeInPrice:i.value.tradeInPrice,evaluationRangeLow:i.value.evaluationRangeLow,evaluationRangeHigh:i.value.evaluationRangeHigh,provider:i.value.provider||null,evaluationDate:i.value.evaluationDate||null}};S("save",l)};return g({submit:u,canSubmit:()=>I.value}),(l,s)=>(a(),n("div",{class:N(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(a(),n("div",zi)),t.hideHeader?x("",!0):(a(),n("div",Hi,[e("h5",Yi,y(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:s[0]||(s[0]=b=>l.$emit("cancel")),class:"text-sub hover:text-body"},[...s[18]||(s[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",Gi,[e("div",Ki,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[19]||(s[19]=[L("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.brand,"onUpdate:modelValue":s[1]||(s[1]=b=>r.value.brand=b),type:"text",placeholder:"e.g., Volkswagen",required:""},null,8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[20]||(s[20]=[L("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.model,"onUpdate:modelValue":s[2]||(s[2]=b=>r.value.model=b),type:"text",placeholder:"e.g., ID.4",required:""},null,8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[21]||(s[21]=[L("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.year,"onUpdate:modelValue":s[3]||(s[3]=b=>r.value.year=b),type:"number",placeholder:"e.g., 2024",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[22]||(s[22]=[L("Version/Trim",-1)])]),_:1}),p(d(Y),{modelValue:r.value.version,"onUpdate:modelValue":s[4]||(s[4]=b=>r.value.version=b),type:"text",placeholder:"e.g., Premium Plus"},null,8,["modelValue"])]),e("div",Qi,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[23]||(s[23]=[L("VIN",-1)])]),_:1}),p(d(Y),{modelValue:r.value.vin,"onUpdate:modelValue":s[5]||(s[5]=b=>r.value.vin=b),type:"text",placeholder:"Vehicle Identification Number"},null,8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[24]||(s[24]=[L("Plates",-1)])]),_:1}),p(d(Y),{modelValue:r.value.plates,"onUpdate:modelValue":s[6]||(s[6]=b=>r.value.plates=b),type:"text",placeholder:"License plate number"},null,8,["modelValue"])])]),e("div",Ji,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[25]||(s[25]=[L("Fuel Type",-1)])]),_:1}),p(d(Ee),{modelValue:r.value.fuelType,"onUpdate:modelValue":s[7]||(s[7]=b=>r.value.fuelType=b)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select fuel type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Petrol"},{default:D(()=>[...s[26]||(s[26]=[L("Petrol",-1)])]),_:1}),p(d(z),{value:"Diesel"},{default:D(()=>[...s[27]||(s[27]=[L("Diesel",-1)])]),_:1}),p(d(z),{value:"Electric"},{default:D(()=>[...s[28]||(s[28]=[L("Electric",-1)])]),_:1}),p(d(z),{value:"Hybrid"},{default:D(()=>[...s[29]||(s[29]=[L("Hybrid",-1)])]),_:1}),p(d(z),{value:"Plug-in Hybrid"},{default:D(()=>[...s[30]||(s[30]=[L("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[31]||(s[31]=[L("Gear Type",-1)])]),_:1}),p(d(Ee),{modelValue:r.value.gearType,"onUpdate:modelValue":s[8]||(s[8]=b=>r.value.gearType=b)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select gear type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Manual"},{default:D(()=>[...s[32]||(s[32]=[L("Manual",-1)])]),_:1}),p(d(z),{value:"Automatic"},{default:D(()=>[...s[33]||(s[33]=[L("Automatic",-1)])]),_:1}),p(d(z),{value:"CVT"},{default:D(()=>[...s[34]||(s[34]=[L("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[35]||(s[35]=[L("Mileage (km)",-1)])]),_:1}),p(d(Y),{modelValue:r.value.kilometers,"onUpdate:modelValue":s[9]||(s[9]=b=>r.value.kilometers=b),modelModifiers:{number:!0},type:"number",placeholder:"0",min:"0"},null,8,["modelValue"])])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[36]||(s[36]=[L("Registration Year/Month",-1)])]),_:1}),p(d(Y),{modelValue:r.value.registration,"onUpdate:modelValue":s[10]||(s[10]=b=>r.value.registration=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)"},null,8,["modelValue"])]),e("div",Xi,[e("button",{type:"button",onClick:s[11]||(s[11]=b=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-card"},[s[37]||(s[37]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:N(["fa-solid transition-transform duration-200 text-sub",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(a(),n("div",Zi,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[38]||(s[38]=[L("Trade-In Price (€)",-1)])]),_:1}),p(d(Y),{modelValue:i.value.tradeInPrice,"onUpdate:modelValue":s[12]||(s[12]=b=>i.value.tradeInPrice=b),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",_i,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[39]||(s[39]=[L("Evaluation Range - Low (€)",-1)])]),_:1}),p(d(Y),{modelValue:i.value.evaluationRangeLow,"onUpdate:modelValue":s[13]||(s[13]=b=>i.value.evaluationRangeLow=b),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[40]||(s[40]=[L("Evaluation Range - High (€)",-1)])]),_:1}),p(d(Y),{modelValue:i.value.evaluationRangeHigh,"onUpdate:modelValue":s[14]||(s[14]=b=>i.value.evaluationRangeHigh=b),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])])]),e("div",eo,[e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[41]||(s[41]=[L("Provider",-1)])]),_:1}),p(d(Ee),{modelValue:i.value.provider,"onUpdate:modelValue":s[15]||(s[15]=b=>i.value.provider=b)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select provider..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Eurotax"},{default:D(()=>[...s[42]||(s[42]=[L("Eurotax",-1)])]),_:1}),p(d(z),{value:"Infocar"},{default:D(()=>[...s[43]||(s[43]=[L("Infocar",-1)])]),_:1}),p(d(z),{value:"Manual"},{default:D(()=>[...s[44]||(s[44]=[L("Manual",-1)])]),_:1}),p(d(z),{value:"Other"},{default:D(()=>[...s[45]||(s[45]=[L("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(R),{class:"text-xs font-medium text-body mb-1"},{default:D(()=>[...s[46]||(s[46]=[L("Evaluation Date",-1)])]),_:1}),p(d(Y),{modelValue:i.value.evaluationDate,"onUpdate:modelValue":s[16]||(s[16]=b=>i.value.evaluationDate=b),type:"date"},null,8,["modelValue"])])])])):x("",!0)])]),t.hideActions?x("",!0):(a(),n("div",to,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:s[17]||(s[17]=b=>l.$emit("cancel"))}),p(d(Z),{label:"Save",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!I.value,onClick:u},null,8,["disabled"])]))],2))}},ao={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},lo={key:1,class:"flex justify-between items-center mb-4"},no={class:"text-fluid-sm font-semibold text-heading"},io={class:"flex gap-2"},oo=["value"],ro={key:0,class:"space-y-4"},uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},co={class:"relative"},mo={key:0,class:"text-xs text-red-600 mt-1"},fo={class:"relative"},po={key:0,class:"text-xs text-red-600 mt-1"},vo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yo=["value"],bo={key:0,class:"text-xs text-red-600 mt-1"},xo={key:0},go={class:"relative"},ho={key:1},ko={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wo={class:"relative"},$o={class:"relative"},Co={class:"flex items-center gap-2"},To={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},So={class:"relative"},Io={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Ao={class:"flex justify-between items-center"},Do={class:"text-lg font-bold text-heading"},qo={class:"flex flex-col gap-2"},Eo={class:"flex items-center gap-2"},Vo={class:"flex items-center gap-2"},Lo={key:0,class:"text-xs text-red-600 mt-1"},Mo={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Oo={class:"flex justify-between items-center"},No={class:"text-lg font-bold text-heading"},Bo={class:"flex flex-col gap-2"},jo={class:"flex items-center gap-2"},Ro={class:"flex items-center gap-2"},Fo={class:"flex items-center gap-2"},Uo={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Po={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:g,emit:o}){const k=t,S=o,w=O({}),r=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],i=O({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),I=q(()=>{if(i.value.type!=="LEA")return 0;const f=parseFloat(i.value.fields.monthlyInstalment)||0,c=parseInt(i.value.fields.duration)||0,V=parseFloat(i.value.fields.downPayment)||0,F=parseFloat(i.value.fields.finalInstalment)||0;return f*c+V+F}),u=q(()=>{if(i.value.type!=="LTR")return 0;const f=parseFloat(i.value.fields.monthlyInstalment)||0,c=parseInt(i.value.fields.duration)||0,V=parseFloat(i.value.fields.downPayment)||0;return f*c+V}),l=f=>f==="FIN"?[12,24,36,48,60]:f==="LEA"?[24,36,48,60]:f==="LTR"?[12,24,36,48,60]:[],s=f=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[f]||f,b=f=>f?new Intl.NumberFormat("en-US").format(f):"0",E=f=>{delete w.value[f]},C=q(()=>!i.value.type||!i.value.fields.monthlyInstalment||i.value.fields.monthlyInstalment<=0||i.value.fields.downPayment===null||i.value.fields.downPayment===void 0||i.value.fields.downPayment<0||!i.value.fields.duration||i.value.fields.duration<12||i.value.fields.duration>60||i.value.type==="LTR"&&!i.value.fields.customerType?!1:Object.keys(w.value).length===0),T=()=>{i.value.type!=="FIN"&&(i.value.fields.effectiveInterestRate=null,i.value.fields.gfv=null),i.value.type!=="LEA"&&(i.value.fields.finalInstalment=null),i.value.type!=="LTR"&&(i.value.fields.customerType="",i.value.fields.registrationTaxesIncluded=!1),i.value.type!=="LEA"&&i.value.type!=="LTR"&&(i.value.fields.mileageLimit=null,i.value.fields.maintenanceIncluded=!1),w.value={}};Le(()=>{k.item&&k.item.data&&(i.value={type:k.item.data.type||"",fields:{monthlyInstalment:k.item.data.monthlyInstalment||null,downPayment:k.item.data.downPayment||null,duration:k.item.data.duration||null,interestRate:k.item.data.interestRate||null,effectiveInterestRate:k.item.data.effectiveInterestRate||null,gfv:k.item.data.gfv||null,mileageLimit:k.item.data.mileageLimit||null,finalInstalment:k.item.data.finalInstalment||null,customerType:k.item.data.customerType||"",insuranceIncluded:k.item.data.insuranceIncluded||!1,maintenanceIncluded:k.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:k.item.data.registrationTaxesIncluded||!1}})});const m=()=>{var te,J;if(!C.value)return;const f=s(i.value.type),c=i.value.fields.monthlyInstalment||0,V=i.value.fields.duration||0,F={id:((te=k.item)==null?void 0:te.id)||Date.now(),type:"purchase-method",action:k.item?"updated a purchase method":"added a purchase method",content:`${f}: €${b(c)}/month for ${V} months`,timestamp:((J=k.item)==null?void 0:J.timestamp)||new Date().toISOString(),isEdit:!!k.item,data:{type:i.value.type,typeLabel:f,monthlyInstalment:i.value.fields.monthlyInstalment,downPayment:i.value.fields.downPayment,duration:i.value.fields.duration,interestRate:i.value.fields.interestRate,effectiveInterestRate:i.value.fields.effectiveInterestRate,gfv:i.value.fields.gfv,mileageLimit:i.value.fields.mileageLimit,finalInstalment:i.value.fields.finalInstalment,customerType:i.value.fields.customerType,insuranceIncluded:i.value.fields.insuranceIncluded,maintenanceIncluded:i.value.fields.maintenanceIncluded,registrationTaxesIncluded:i.value.fields.registrationTaxesIncluded,totalLeasingAmount:I.value,totalRentalAmount:u.value}};S("save",F)};return g({submit:m,canSubmit:()=>C.value}),(f,c)=>(a(),n("div",{class:N(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(a(),n("div",ao)),t.hideHeader?x("",!0):(a(),n("div",lo,[e("h5",no,y(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:c[0]||(c[0]=V=>f.$emit("cancel")),class:"text-sub hover:text-body"},[...c[23]||(c[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ae(m,["prevent"]),class:"space-y-4"},[e("div",null,[c[24]||(c[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},[L("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",io,[(a(),n(P,null,H(r,V=>e("label",{key:V.value,class:"flex-1 cursor-pointer"},[G(e("input",{type:"radio",value:V.value,"onUpdate:modelValue":c[1]||(c[1]=F=>i.value.type=F),class:"sr-only",onChange:T},null,40,oo),[[ss,i.value.type]]),e("div",{class:N(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",i.value.type===V.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},y(V.label),3)])),64))])]),i.value.type?(a(),n("div",ro,[e("div",uo,[e("div",null,[c[26]||(c[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[L(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",co,[c[25]||(c[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),G(e("input",{"onUpdate:modelValue":c[2]||(c[2]=V=>i.value.fields.monthlyInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:N(["input pl-8",{"border-red-500":w.value.monthlyInstalment}]),onInput:c[3]||(c[3]=V=>E("monthlyInstalment"))},null,34),[[ge,i.value.fields.monthlyInstalment,void 0,{number:!0}]])]),w.value.monthlyInstalment?(a(),n("p",mo,y(w.value.monthlyInstalment),1)):x("",!0)]),e("div",null,[c[28]||(c[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[L(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fo,[c[27]||(c[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),G(e("input",{"onUpdate:modelValue":c[4]||(c[4]=V=>i.value.fields.downPayment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:N(["input pl-8",{"border-red-500":w.value.downPayment}]),onInput:c[5]||(c[5]=V=>E("downPayment"))},null,34),[[ge,i.value.fields.downPayment,void 0,{number:!0}]])]),w.value.downPayment?(a(),n("p",po,y(w.value.downPayment),1)):x("",!0)])]),e("div",vo,[e("div",null,[c[30]||(c[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[L(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),G(e("select",{"onUpdate:modelValue":c[6]||(c[6]=V=>i.value.fields.duration=V),class:N(["input",{"border-red-500":w.value.duration}]),onChange:c[7]||(c[7]=V=>E("duration"))},[c[29]||(c[29]=e("option",{value:""},"Select duration...",-1)),(a(!0),n(P,null,H(l(i.value.type),V=>(a(),n("option",{key:V,value:V},y(V)+" months ",9,yo))),128))],34),[[yt,i.value.fields.duration,void 0,{number:!0}]]),w.value.duration?(a(),n("p",bo,y(w.value.duration),1)):x("",!0)]),i.value.type==="FIN"||i.value.type==="LEA"?(a(),n("div",xo,[c[32]||(c[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Interest Rate / APR (%)",-1)),e("div",go,[G(e("input",{"onUpdate:modelValue":c[8]||(c[8]=V=>i.value.fields.interestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:c[9]||(c[9]=V=>E("interestRate"))},null,544),[[ge,i.value.fields.interestRate,void 0,{number:!0}]]),c[31]||(c[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])])):x("",!0),i.value.type==="LEA"||i.value.type==="LTR"?(a(),n("div",ho,[c[33]||(c[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage Limit (annual km)",-1)),G(e("input",{"onUpdate:modelValue":c[10]||(c[10]=V=>i.value.fields.mileageLimit=V),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[ge,i.value.fields.mileageLimit,void 0,{number:!0}]])])):x("",!0)]),i.value.type==="FIN"?(a(),n(P,{key:0},[e("div",ko,[e("div",null,[c[35]||(c[35]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",wo,[G(e("input",{"onUpdate:modelValue":c[11]||(c[11]=V=>i.value.fields.effectiveInterestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[ge,i.value.fields.effectiveInterestRate,void 0,{number:!0}]]),c[34]||(c[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])]),e("div",null,[c[37]||(c[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",$o,[c[36]||(c[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),G(e("input",{"onUpdate:modelValue":c[12]||(c[12]=V=>i.value.fields.gfv=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[ge,i.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",Co,[G(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":c[13]||(c[13]=V=>i.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.insuranceIncluded]]),c[38]||(c[38]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):x("",!0),i.value.type==="LEA"?(a(),n(P,{key:1},[e("div",To,[e("div",null,[c[40]||(c[40]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Final Instalment (€)",-1)),e("div",So,[c[39]||(c[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),G(e("input",{"onUpdate:modelValue":c[14]||(c[14]=V=>i.value.fields.finalInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[ge,i.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Io,[e("div",Ao,[c[41]||(c[41]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Do,"€ "+y(b(I.value)),1)]),c[42]||(c[42]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",qo,[e("div",Eo,[G(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":c[15]||(c[15]=V=>i.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.insuranceIncluded]]),c[43]||(c[43]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Vo,[G(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":c[16]||(c[16]=V=>i.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.maintenanceIncluded]]),c[44]||(c[44]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):x("",!0),i.value.type==="LTR"?(a(),n(P,{key:2},[e("div",null,[c[46]||(c[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[L(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),G(e("select",{"onUpdate:modelValue":c[17]||(c[17]=V=>i.value.fields.customerType=V),class:N(["input",{"border-red-500":w.value.customerType}]),onChange:c[18]||(c[18]=V=>E("customerType"))},[...c[45]||(c[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[yt,i.value.fields.customerType]]),w.value.customerType?(a(),n("p",Lo,y(w.value.customerType),1)):x("",!0)]),e("div",Mo,[e("div",Oo,[c[47]||(c[47]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",No,"€ "+y(b(u.value)),1)]),c[48]||(c[48]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Bo,[e("div",jo,[G(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":c[19]||(c[19]=V=>i.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.insuranceIncluded]]),c[49]||(c[49]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Ro,[G(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":c[20]||(c[20]=V=>i.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.maintenanceIncluded]]),c[50]||(c[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Fo,[G(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":c[21]||(c[21]=V=>i.value.fields.registrationTaxesIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,i.value.fields.registrationTaxesIncluded]]),c[51]||(c[51]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):x("",!0)])):x("",!0)],32),t.hideActions?x("",!0):(a(),n("div",Uo,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",onClick:c[22]||(c[22]=V=>f.$emit("cancel"))}),p(d(Z),{label:"Save",variant:"primary",size:"small",disabled:!C.value,onClick:m},null,8,["disabled"])]))],2))}},Wo={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},zo={class:"space-y-2"},Ho={class:"space-y-2"},Yo={class:"space-y-2"},Go={class:"space-y-2"},Ko={class:"relative"},Qo={class:"space-y-2"},Jo={class:"space-y-2"},Xo={class:"space-y-2"},Zo={class:"border-t border pt-4"},_o={key:0,class:"mt-4 space-y-6"},er={class:"space-y-2"},tr={class:"space-y-2"},sr={class:"space-y-2"},ar={class:"space-y-2"},lr={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:g}){const o=t,k=g,S=u=>{u||k("close")},w=O(!1),r=O({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});me(()=>o.show,u=>{var l;if(u&&((l=o.task)!=null&&l.requestedCar)){const s=o.task.requestedCar;r.value={brand:s.brand||"",model:s.model||"",year:s.year||new Date().getFullYear(),price:s.price||null,requestType:s.requestType||"Quotation",requestMessage:s.requestMessage||"",image:s.image||"",dealership:s.dealership||"",fuelType:s.fuelType||"",gearType:s.gearType||"",kilometers:s.kilometers||null}}else u&&(r.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const i=q(()=>r.value.brand.trim()&&r.value.model.trim()&&r.value.year>1900),I=()=>{if(!i.value)return;const u={brand:r.value.brand.trim(),model:r.value.model.trim(),year:r.value.year,requestType:r.value.requestType};r.value.price&&(u.price=r.value.price),r.value.requestMessage&&(u.requestMessage=r.value.requestMessage.trim()),r.value.image&&(u.image=r.value.image.trim()),r.value.dealership&&(u.dealership=r.value.dealership.trim()),r.value.fuelType&&(u.fuelType=r.value.fuelType),r.value.gearType&&(u.gearType=r.value.gearType),r.value.kilometers!==null&&(u.kilometers=r.value.kilometers),k("save",u)};return(u,l)=>(a(),B(d(lt),{open:t.show,"onUpdate:open":S},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>{var s;return[L(y((s=t.task)!=null&&s.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("div",Wo,[e("div",zo,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[13]||(l[13]=[L("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.brand,"onUpdate:modelValue":l[0]||(l[0]=s=>r.value.brand=s),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Ho,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[14]||(l[14]=[L("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.model,"onUpdate:modelValue":l[1]||(l[1]=s=>r.value.model=s),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Yo,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[15]||(l[15]=[L("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:r.value.year,"onUpdate:modelValue":l[2]||(l[2]=s=>r.value.year=s),modelModifiers:{number:!0},type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Go,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[16]||(l[16]=[L("Price (Optional)",-1)])]),_:1}),e("div",Ko,[l[17]||(l[17]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-sub"},"€",-1)),p(d(Y),{modelValue:r.value.price,"onUpdate:modelValue":l[3]||(l[3]=s=>r.value.price=s),modelModifiers:{number:!0},type:"number",min:"0",step:"1000",placeholder:"45000",class:"w-full h-10 pl-8"},null,8,["modelValue"])])]),e("div",Qo,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[18]||(l[18]=[L("Request Type",-1)])]),_:1}),p(d(Ee),{modelValue:r.value.requestType,"onUpdate:modelValue":l[4]||(l[4]=s=>r.value.requestType=s)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select request type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Quotation"},{default:D(()=>[...l[19]||(l[19]=[L("Quotation",-1)])]),_:1}),p(d(z),{value:"Test Drive"},{default:D(()=>[...l[20]||(l[20]=[L("Test Drive",-1)])]),_:1}),p(d(z),{value:"Generic Sales"},{default:D(()=>[...l[21]||(l[21]=[L("Generic Sales",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Jo,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[22]||(l[22]=[L("Request Message (Optional)",-1)])]),_:1}),p(d(ys),{modelValue:r.value.requestMessage,"onUpdate:modelValue":l[5]||(l[5]=s=>r.value.requestMessage=s),rows:"5",placeholder:"Customer's message or notes about the vehicle request...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])]),e("div",Xo,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[23]||(l[23]=[L("Image URL (Optional)",-1)])]),_:1}),p(d(Y),{modelValue:r.value.image,"onUpdate:modelValue":l[6]||(l[6]=s=>r.value.image=s),type:"url",placeholder:"https://example.com/car-image.jpg",class:"w-full h-10"},null,8,["modelValue"]),l[24]||(l[24]=e("p",{class:"text-xs text-sub mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",Zo,[e("button",{type:"button",onClick:l[7]||(l[7]=s=>w.value=!w.value),class:"flex items-center gap-2 text-sm font-medium text-body hover:text-heading transition-colors"},[e("i",{class:N(["fa-solid",w.value?"fa-chevron-down":"fa-chevron-right"])},null,2),l[25]||(l[25]=L(" Advanced Details (Optional) ",-1))]),w.value?(a(),n("div",_o,[e("div",er,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[26]||(l[26]=[L("Dealership",-1)])]),_:1}),p(d(Y),{modelValue:r.value.dealership,"onUpdate:modelValue":l[8]||(l[8]=s=>r.value.dealership=s),type:"text",placeholder:"e.g., Milano, Berlin",class:"w-full h-10"},null,8,["modelValue"])]),e("div",tr,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[27]||(l[27]=[L("Fuel Type",-1)])]),_:1}),p(d(Ee),{modelValue:r.value.fuelType,"onUpdate:modelValue":l[9]||(l[9]=s=>r.value.fuelType=s)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select fuel type"})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Petrol"},{default:D(()=>[...l[28]||(l[28]=[L("Petrol",-1)])]),_:1}),p(d(z),{value:"Diesel"},{default:D(()=>[...l[29]||(l[29]=[L("Diesel",-1)])]),_:1}),p(d(z),{value:"Electric"},{default:D(()=>[...l[30]||(l[30]=[L("Electric",-1)])]),_:1}),p(d(z),{value:"Hybrid"},{default:D(()=>[...l[31]||(l[31]=[L("Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",sr,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[32]||(l[32]=[L("Gear Type",-1)])]),_:1}),p(d(Ee),{modelValue:r.value.gearType,"onUpdate:modelValue":l[10]||(l[10]=s=>r.value.gearType=s)},{default:D(()=>[p(d(Ae),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select gear type"})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Manual"},{default:D(()=>[...l[33]||(l[33]=[L("Manual",-1)])]),_:1}),p(d(z),{value:"Automatic"},{default:D(()=>[...l[34]||(l[34]=[L("Automatic",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ar,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...l[35]||(l[35]=[L("Kilometers",-1)])]),_:1}),p(d(Y),{modelValue:r.value.kilometers,"onUpdate:modelValue":l[11]||(l[11]=s=>r.value.kilometers=s),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"e.g., 50000",class:"w-full h-10"},null,8,["modelValue"])])])):x("",!0)])]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>{var s;return[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:l[12]||(l[12]=b=>u.$emit("close"))}),p(d(Z),{label:(s=t.task)!=null&&s.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!i.value,onClick:I},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},nr={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ir={class:"space-y-2"},or={key:0,class:"space-y-2"},rr={class:"flex flex-wrap gap-2"},dr=["onClick"],ur={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:g}){const o=t,k=g,S=O(""),w=i=>{i||k("close")};me(()=>o.show,i=>{i&&(S.value="")});const r=()=>{const i=S.value.trim();i&&(o.existingTags.includes(i)||(k("add",i),S.value=""))};return(i,I)=>(a(),B(d(lt),{open:t.show,"onUpdate:open":w},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>[...I[2]||(I[2]=[L("Add Tag",-1)])]),_:1})]),_:1}),e("div",nr,[e("div",ir,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...I[3]||(I[3]=[L("Tag Name",-1)])]),_:1}),p(d(Y),{modelValue:S.value,"onUpdate:modelValue":I[0]||(I[0]=u=>S.value=u),onKeyup:as(r,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full h-10",autofocus:""},null,8,["modelValue"])]),t.existingTags.length>0?(a(),n("div",or,[p(d(R),{class:"block text-sm font-semibold text-heading"},{default:D(()=>[...I[4]||(I[4]=[L("Existing Tags",-1)])]),_:1}),e("div",rr,[(a(!0),n(P,null,H(t.existingTags,u=>(a(),n("button",{key:u,onClick:l=>S.value=u,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},y(u),9,dr))),128))])])):x("",!0)]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:I[1]||(I[1]=u=>i.$emit("close"))}),p(d(Z),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!S.value.trim(),onClick:r},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Je={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function cr(t){if(!t)return Je.default;const g=t.toLowerCase().trim();return Je[g]||Je.default}function mr({store:t,taskId:g,getTabForItemType:o,isOverviewModalAction:k}){const S=O(null),w=O(null),r=O("overview"),i=O(null),I=O([]);me(r,()=>{S.value=null,w.value=null});const u=q(()=>[...t.currentActivities.value,...I.value.filter(m=>!m.activityId)].filter(m=>{const f=o(m.type);return r.value==="overview"?f==="overview":f===r.value}).sort((m,f)=>{const c=new Date(m.timestamp||0);return new Date(f.timestamp||0)-c})),l=T=>(w.value=null,r.value==="overview"&&k&&k(T)?{type:"overview-modal",action:T}:(["email","sms","whatsapp","call"].includes(T)?(i.value=T,S.value="communication"):S.value=T,null)),s=async T=>{var m;if(T.isEdit){const f=I.value.findIndex(c=>c.id===T.id);f>-1&&(I.value[f]={...I.value[f],...T}),(m=w.value)!=null&&m.activityId&&await t.updateActivity(g.value,w.value.activityId,{type:T.communicationType||T.type,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data})}else{const f=T.communicationType||T.type,c=await t.addActivity(g.value,{type:f,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data});I.value.push({id:c.id,type:f==="email"||f==="whatsapp"||f==="sms"?"communication":f,action:T.action,content:T.content,fileName:T.fileName,data:T.data,timestamp:c.timestamp,activityId:c.id})}S.value=null,w.value=null},b=()=>{S.value=null,w.value=null},E=T=>{o(T.type)&&(S.value=T.type==="email"||T.type==="whatsapp"||T.type==="sms"||T.type==="communication"?"communication":T.type,w.value=T)},C=async T=>{try{await t.deleteActivity(g.value,T)}catch(m){throw console.error("Error deleting item:",m),m}};return{activeTab:r,showInlineWidget:S,inlineWidgetType:q(()=>S.value),editingItem:w,isEditing:q(()=>w.value!==null),communicationType:i,inlineContent:I,filteredInlineContent:u,handleAddNewAction:l,handleWidgetSave:s,handleWidgetCancel:b,handleEditItem:E,handleDeleteItem:C}}const fr={class:"flex-1 flex flex-col overflow-hidden h-full"},pr={key:1,class:"flex-1 flex flex-row overflow-hidden"},vr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},yr={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},br={class:"mb-4"},xr={key:0},gr={key:0},hr={key:1,class:"mb-6"},kr={key:2,class:"space-y-4 mb-6 px-1"},wr={key:1},$r={key:0},Cr={key:1},Tr={class:"relative flex items-center py-1 mb-4"},Sr={class:"relative mx-4"},Ir={key:0,class:"animate-fade-in relative bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6"},Ar={class:"flex justify-between items-center mb-4"},Dr={key:0,class:"space-y-4 mb-6 px-1"},qr={class:"hidden lg:flex flex-col overflow-hidden border-l border-black/5 shrink-0 w-80 h-full"},Er={key:2,class:"flex-1 flex flex-row overflow-hidden"},Vr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Lr={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Mr={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},Or={class:"space-y-6"},Nr={key:0},Br={key:0,class:"lg:col-span-1 space-y-6"},jr={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Rr={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Fr={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ur={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},Pr={class:"relative flex-1 min-h-0"},Wr={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},zr={key:1,class:"text-center py-6 text-sub"},Hr={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},Yr={class:"flex-1 min-w-0"},Gr={class:"text-sm text-body leading-snug"},Kr={class:"font-bold"},Qr={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-body"},Jr={class:"text-xs text-sub mt-1"},Xr={key:2},Zr={key:0,class:"space-y-4 mt-4"},_r={key:1,class:"text-center py-12 text-sub"},ed={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},showCloseButton:{type:Boolean,default:!1}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created","close"],setup(t,{emit:g}){const o=t,k=g,S=ls(),w=ye(),r=qt(),i=qs(),I=q(()=>o.task.id),u=q(()=>S.path.startsWith("/tasks")&&!S.path.startsWith("/customer")),l=O("manage"),s=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];O(!1);const b=O(null),E=O(null),C=["note","attachment","tradein","purchase"],T=q(()=>{var K,_;const v=[],h=new Set,j=["note","attachment","tradein","purchase","purchase-method","financing"];return(_=(K=o.storeAdapter)==null?void 0:K.currentActivities)!=null&&_.value&&o.storeAdapter.currentActivities.value.filter(M=>j.includes(M.type)).forEach(M=>{h.has(M.id)||(h.add(M.id),v.push(M))}),o.task.activities&&o.task.activities.filter(M=>j.includes(M.type)).forEach(M=>{h.has(M.id)||(h.add(M.id),v.push(M))}),$e.value.filter(Q=>j.includes(Q.type)).forEach(Q=>{h.has(Q.id)||(h.add(Q.id),v.push(Q))}),v.sort((Q,M)=>{const Se=new Date(Q.timestamp||0);return new Date(M.timestamp||0)-Se})}),m=v=>{E.value=null,b.value=v},f=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:v.type,action:v.action,content:v.content,data:v.data,fileName:v.fileName,timestamp:v.timestamp||new Date().toISOString()}),$e.value.push({id:v.id||Date.now(),type:v.type,action:v.action,content:v.content,data:v.data,fileName:v.fileName,timestamp:v.timestamp||new Date().toISOString()}),b.value=null,E.value=null}catch(h){console.error("Error saving enrich data:",h)}},c=()=>{b.value=null,E.value=null},V=v=>{E.value=v,b.value=v.type==="purchase-method"?"purchase":v.type},F=async v=>{try{await o.storeAdapter.deleteActivity(o.task.id,v.id);const h=$e.value.findIndex(j=>j.id===v.id);h!==-1&&$e.value.splice(h,1)}catch(h){console.error("Error deleting enrich item:",h)}};q(()=>o.task.activities?o.task.activities.filter(v=>v.type==="note"):[]),q(()=>o.task.activities?o.task.activities.filter(v=>["email","call","sms","whatsapp"].includes(v.type)):[]),q(()=>o.task.activities?o.task.activities.filter(v=>v.type==="attachment"):[]),q(()=>o.task.activities?o.task.activities.filter(v=>v.type==="purchase"):[]),q(()=>o.task.activities?o.task.activities.filter(v=>v.type==="tradein"):[]);const te=q(()=>o.type==="contact"?"bg-blue-100 text-blue-600":o.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),J=O(S.path.startsWith("/tasks")&&!S.path.startsWith("/customer"));me(()=>S.path,v=>{J.value=v.startsWith("/tasks")&&!v.startsWith("/customer")});const ue=()=>{w.push({path:`/customer/${o.task.id}`,query:{type:o.type}})};async function be(v){var ft,pt;const h=((ft=o.task.customer)==null?void 0:ft.id)??o.task.id,j=v.time||"10:00",W=j.length===5?`${j}:00`:j,K=`${v.date}T${W}`,[_,Q]=j.split(":").map(Number),M=_+1,Se=`${v.date}T${String(M).padStart(2,"0")}:${String(Q||0).padStart(2,"0")}:00`;let Pe=null,We="user",mt=null,ze="",He=null;if(v.assignee){if(v.assignee.startsWith("user-")){const ke=parseInt(v.assignee.replace("user-",""),10),we=i.getUserById(ke);Pe=ke,We="user",ze=(we==null?void 0:we.name)||""}else if(v.assignee.startsWith("team-")){const ke=parseInt(v.assignee.replace("team-",""),10),we=i.getTeamById(ke);mt=ke,We="team",He=(we==null?void 0:we.name)||"",ze=He}}const Zt={type:v.type,title:v.title||`${v.type} - ${v.customer||"Customer"}`,customer:v.customer||((pt=o.task.customer)==null?void 0:pt.name)||"",customerId:h,start:K,end:Se,assignee:ze,assigneeId:Pe,assigneeType:We,teamId:mt,team:He,dealership:v.dealership||"",status:"confirmed"};try{await Vs(Zt)}catch(ke){console.error("Failed to create appointment:",ke);return}pe.value=!1,ne.value=!1,k("appointment-created")}const fe=()=>{$.value=!0},ce=async v=>{var j,W,K,_;const h=v.name;o.type==="lead"?await((W=(j=o.storeAdapter).updateLead)==null?void 0:W.call(j,o.task.id,{assignee:h,assigneeType:v.type,teamId:v.type==="team"?v.id:null})):o.type==="opportunity"&&await((_=(K=o.storeAdapter).updateOpportunity)==null?void 0:_.call(K,o.task.id,{assignee:h,assigneeType:v.type,teamId:v.type==="team"?v.id:null})),$.value=!1},le=()=>{U.value=!0},he=async v=>{var h,j,W,K;try{o.type==="lead"?await((j=(h=o.storeAdapter).updateLead)==null?void 0:j.call(h,o.task.id,{requestedCar:v})):o.type==="opportunity"&&await((K=(W=o.storeAdapter).updateOpportunity)==null?void 0:K.call(W,o.task.id,{requestedCar:v})),U.value=!1}catch(_){console.error("Error saving requested car:",_)}},de=O(!1),X=O(null),pe=O(!1),ne=O(!1),$=O(!1),A=O(!1),U=O(!1),ee=O([]),ve=O(!1),xe=O(!1),ie=O(!1),oe=O(!1),Me=O(!1),Ne=O(!1),Be=O({}),{activeTab:se,showInlineWidget:je,editingItem:Re,communicationType:Ot,inlineContent:$e,filteredInlineContent:Oe,handleAddNewAction:Nt,handleWidgetSave:Ve,handleWidgetCancel:Fe,handleEditItem:nt,handleDeleteItem:it}=mr({store:o.storeAdapter,taskId:I,getTabForItemType:cr,isOverviewModalAction:v=>se.value==="overview"&&o.addNewConfig.overviewActions.includes(v)});me(()=>o.task.id,()=>{se.value="overview"}),me(se,v=>{v!=="appointments"&&(ne.value=!1)});const Bt=q(()=>new Date().toISOString().slice(0,10));Le(async()=>{if(!u.value)try{const v=await Es();ee.value=v.dealerships||[]}catch(v){console.error("Failed to fetch calendar filter options:",v)}});const ot=()=>{u.value?l.value="request":se.value="overview"},Ue=v=>{const h=Nt(v);h&&h.modalAction&&(X.value=h.modalAction,de.value=!0)},rt=v=>{if(v==="appointment"){pe.value=!0;return}if(v==="call"){Ne.value=!0;return}if(v==="note"){ve.value=!0;return}if(v==="attachment"){xe.value=!0;return}if(v==="whatsapp"){ie.value=!0;return}if(v==="sms"){oe.value=!0;return}if(v==="email"){Me.value=!0;return}const h={call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(v))X.value=v,de.value=!0;else{const j=h[v];j?(se.value=j,setTimeout(()=>{Ue(v),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Ue(v)}},Ce=()=>{de.value=!1,X.value=null},jt=async v=>{var h,j;try{const W=v.type==="FIN"?"Captive Financing":v.type==="LEA"?"Leasing":"Long-Term Rental",K=((h=v.fields)==null?void 0:h.monthlyInstalment)||0;await Ve({type:"purchase-method",action:`added a ${W} purchase method`,content:`${W}: €${K.toLocaleString()}/month for ${((j=v.fields)==null?void 0:j.duration)||0} months`,data:{purchaseMethodId:v.id,type:v.type,...v.fields}}),Ce()}catch(W){console.error("Error saving purchase method:",W)}},dt=async v=>{if(X.value==="tradein")try{const{saveTradeInVehicle:h}=Ts(),j=await h(o.type,o.task.id,v.vehicle,v.valuation||{});$e.value.push({id:j.activity.id,type:"tradein",action:"added a trade-in",vehicleId:j.vehicle.id,data:j.activity.data,timestamp:j.activity.timestamp,activityId:j.activity.id}),Ce()}catch(h){console.error("Error saving trade-in:",h)}else X.value==="purchase"&&(await Ve(v),Ce())},Rt=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"note",content:v.content||v.message,message:v.content||v.message,timestamp:new Date().toISOString()}),ve.value=!1}catch(h){console.error("Error saving note:",h)}},Ft=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"attachment",fileName:v.fileName,file:v.file,content:`Attachment: ${v.fileName}`,timestamp:new Date().toISOString()}),xe.value=!1}catch(h){console.error("Error saving attachment:",h)}},Ut=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"whatsapp",message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),ie.value=!1}catch(h){console.error("Error saving WhatsApp:",h)}},Pt=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"sms",message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),oe.value=!1}catch(h){console.error("Error saving SMS:",h)}},Wt=async v=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"email",subject:v.subject,message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),Me.value=!1}catch(h){console.error("Error saving email:",h)}},zt=v=>{console.log("Activity clicked:",v)},Ht=v=>{Be.value[v]=!Be.value[v]},Yt=v=>{rt(v)},Gt=q(()=>{const v=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return o.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...v.slice(1),{key:"appointments",label:"Appointments"}]:v}),Te=q(()=>[...o.storeAdapter.currentActivities.value,...$e.value]);q(()=>X.value==="financing"?"Add Financing":X.value==="tradein"?"Add Trade-in":X.value==="purchase"?"Create Purchase Offer":"");const ut=async v=>{if(o.type==="opportunity")try{await o.storeAdapter.addVehicle(o.task.id,v.vehicleData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch(h){console.error("Error selecting vehicle:",h)}},ct=async v=>{if(o.type==="opportunity")try{await o.storeAdapter.createOffer(o.task.id,v.offerData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch(h){console.error("Error creating offer:",h)}},Kt=async v=>{var W,K,_,Q;const h=o.task.tags||[];if(h.includes(v)){A.value=!1;return}const j=[...h,v];try{if(o.type==="lead")await((K=(W=o.storeAdapter).updateLead)==null?void 0:K.call(W,o.task.id,{tags:j})),o.storeAdapter.loadLeadById&&await o.storeAdapter.loadLeadById(o.task.id);else if(o.type==="opportunity")await((Q=(_=o.storeAdapter).updateOpportunity)==null?void 0:Q.call(_,o.task.id,{tags:j})),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id);else if(o.type==="contact"){const M=S.query.type==="account"?"account":"contact";await r.updateCustomer(o.task.id,{tags:j},M),await r.fetchCustomerById(o.task.id,M),k("tag-updated")}A.value=!1}catch(M){console.error("Error adding tag:",M)}},Qt=v=>{const h={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return h[v]||h.default},Jt=v=>{const h={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return h[v]||h.default},Xt=v=>v?new Date(v).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(v,h)=>{var j,W,K,_,Q;return a(),n("div",fr,[u.value?x("",!0):(a(),B(sa,{key:0,initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":te.value,"task-type":t.type,"customer-id":((j=t.task.customer)==null?void 0:j.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"show-close-button":t.showCloseButton,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAddTag:h[0]||(h[0]=M=>A.value=!0),onClose:h[1]||(h[1]=M=>v.$emit("close"))},{"name-action":D(()=>[u.value?(a(),n("button",{key:0,onClick:ue,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...h[24]||(h[24]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):x("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags","show-close-button"])),u.value?u.value?(a(),n("div",Er,[e("div",Vr,[e("div",Lr,[p(wt,{modelValue:l.value,"onUpdate:modelValue":h[9]||(h[9]=M=>l.value=M),tabs:s,class:"mb-6"},null,8,["modelValue"]),l.value==="manage"?(a(),n("div",Mr,[e("div",Or,[t.managementWidget?(a(),n("div",Nr,[(a(),B(bt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Te.value,onCarAdded:h[10]||(h[10]=M=>v.$emit("car-added",M)),onConvertToLead:h[11]||(h[11]=M=>v.$emit("convert-to-lead")),onConvertToOpportunity:h[12]||(h[12]=M=>v.$emit("convert-to-opportunity")),onVehicleSelected:ut,onCreateOffer:ct,onViewHistory:ot},null,40,["lead","opportunity","contact","activities"]))])):x("",!0)]),t.type!=="contact"?(a(),n("div",Br,[p($t,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:fe,onAddRequestedCar:le},null,8,["task","entity-type","activities"]),p(Ct,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):x("",!0)])):x("",!0),l.value==="request"?(a(),n("div",jr,[e("div",Rr,[t.type!=="contact"?(a(),B($t,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:fe,onAddRequestedCar:le},null,8,["task","entity-type","activities"])):x("",!0),p(xs,{task:t.task,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,onAction:rt,onAddTag:h[13]||(h[13]=M=>A.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(a(),B(Ct,{key:0,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):x("",!0),e("div",Fr,[h[32]||(h[32]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Activity Summary")])],-1)),e("div",Ur,[e("div",Pr,[Te.value.length>0?(a(),n("div",Wr)):x("",!0),Te.value.length===0?(a(),n("div",zr,[...h[31]||(h[31]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-sm text-sub"},"No activities yet",-1)])])):(a(),n("div",Hr,[(a(!0),n(P,null,H(Te.value,M=>(a(),n("div",{key:M.id,class:"flex gap-4 relative"},[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",Jt(M.type)])},[e("i",{class:N([Qt(M.type),"text-sm"])},null,2)],2),e("div",Yr,[e("div",Gr,[e("span",Kr,y(M.user),1),L(" "+y(M.action),1)]),M.content?(a(),n("div",Qr,y(M.content),1)):x("",!0),e("div",Jr,y(Xt(M.timestamp)),1)])]))),128))]))])])])])):x("",!0),l.value==="data"?(a(),n("div",Xr,[p(Tt,{actions:C,"active-tab":"data",onAction:m}),e("div",null,[b.value==="note"?(a(),B(Ge,{key:0,item:E.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:c},null,8,["item","task-type","task-id"])):x("",!0),b.value==="attachment"?(a(),B(Ke,{key:1,item:E.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:c},null,8,["item","task-type","task-id"])):x("",!0),b.value==="tradein"?(a(),B(so,{key:2,item:E.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:c},null,8,["item","task-type","task-id"])):x("",!0),b.value==="purchase"?(a(),B(Po,{key:3,item:E.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:c},null,8,["item","task-type","task-id"])):x("",!0)]),T.value.length>0?(a(),n("div",Zr,[(a(!0),n(P,null,H(T.value,M=>{var Se;return a(),B(Qe,{key:M.id,item:M,"task-type":t.type,"customer-initials":((Se=t.task.customer)==null?void 0:Se.initials)||"SK",onEdit:V,onDelete:F},null,8,["item","task-type","customer-initials"])}),128))])):b.value?x("",!0):(a(),n("div",_r,[...h[33]||(h[33]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-sm text-sub"},"No enrichment data yet",-1),e("p",{class:"text-xs text-sub mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):x("",!0)])])])):x("",!0):(a(),n("div",pr,[e("div",vr,[e("main",yr,[e("div",br,[p(wt,{modelValue:d(se),"onUpdate:modelValue":h[2]||(h[2]=M=>ns(se)?se.value=M:null),tabs:Gt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),d(se)==="overview"?(a(),n("div",xr,[t.type!=="contact"?(a(),n("div",gr,[p(ll,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((K=t.task.requestedCar)==null?void 0:K.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:fe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):x("",!0),Ye(v.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(a(),n("div",hr,[(a(),B(bt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Te.value,onCarAdded:h[3]||(h[3]=M=>v.$emit("car-added",M)),onConvertToLead:h[4]||(h[4]=M=>v.$emit("convert-to-lead")),onConvertToOpportunity:h[5]||(h[5]=M=>v.$emit("convert-to-opportunity")),onViewHistory:ot,onVehicleSelected:ut,onCreateOffer:ct},null,40,["lead","opportunity","contact","activities"]))])):x("",!0),d(Oe).length>0?(a(),n("div",kr,[(a(!0),n(P,null,H(d(Oe),M=>(a(),B(Qe,{key:M.id,item:M,"task-type":t.type,"customer-initials":"SK",onEdit:d(nt),onDelete:d(it)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)])):(a(),n("div",wr,[t.type==="contact"&&d(se)==="negotiations"?(a(),n("div",$r,[Ye(v.$slots,"tab-negotiations")])):t.type==="contact"&&d(se)==="appointments"?(a(),n("div",Cr,[e("div",Tr,[h[26]||(h[26]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",Sr,[ne.value?x("",!0):(a(),n("button",{key:0,onClick:h[6]||(h[6]=ae(M=>ne.value=!0,["stop"])),class:"bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-E5E7EB"},[...h[25]||(h[25]=[e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1),e("span",{class:"ml-1.5 text-body"},"add appointment",-1)])]))]),h[27]||(h[27]=e("div",{class:"flex-grow border-t border"},null,-1))]),ne.value?(a(),n("div",Ir,[h[30]||(h[30]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Ar,[h[29]||(h[29]=e("h5",{class:"text-sm font-semibold text-heading"},"Add Appointment",-1)),e("button",{type:"button",onClick:h[7]||(h[7]=M=>ne.value=!1),class:"text-sub hover:text-body"},[...h[28]||(h[28]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(a(),B(As,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":Bt.value,dealerships:ee.value,"show-actions":!0,"reset-trigger":ne.value,onCreate:be,onCancel:h[8]||(h[8]=M=>ne.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):x("",!0),Ye(v.$slots,"tab-appointments")])):(a(),n(P,{key:2},[p(Tt,{actions:t.addNewConfig.tabActions,"active-tab":d(se),onAction:Ue},null,8,["actions","active-tab"]),e("div",null,[d(je)==="communication"?(a(),B(Wi,{key:0,type:d(Ot),"task-type":t.type,"task-id":t.task.id,"phone-number":((_=t.task.customer)==null?void 0:_.phone)||"",item:d(Re),onSave:d(Ve),onCancel:d(Fe)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):x("",!0),d(se)==="data"&&d(je)==="note"?(a(),B(Ge,{key:1,item:d(Re),"task-type":t.type,"task-id":t.task.id,onSave:d(Ve),onCancel:d(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0),d(je)==="attachment"?(a(),B(Ke,{key:2,item:d(Re),"task-type":t.type,"task-id":t.task.id,onSave:d(Ve),onCancel:d(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0)]),d(Oe).length>0?(a(),n("div",Dr,[(a(!0),n(P,null,H(d(Oe),M=>(a(),B(Qe,{key:M.id,item:M,"task-type":t.type,"customer-initials":"SK",onEdit:d(nt),onDelete:d(it)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)],64))]))])]),e("div",qr,[p(bs,{activities:Te.value,"expanded-summaries":Be.value,onActivityClick:zt,onToggleSummaryExpanded:Ht,onAddActivity:Yt},null,8,["activities","expanded-summaries"])])])),p(gs,{show:X.value==="financing"&&de.value,"task-type":t.type,"task-id":t.task.id,onSave:jt,onClose:Ce},null,8,["show","task-type","task-id"]),p(hs,{show:X.value==="tradein"&&de.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:dt,onClose:Ce},null,8,["show","task-type","task-id"]),p(ks,{show:X.value==="purchase"&&de.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,customer:t.task.customer,"recommended-cars":[],onSave:dt,onClose:Ce},null,8,["show","task-type","task-id","requested-car","customer"]),p(Is,{show:$.value,onClose:h[14]||(h[14]=M=>$.value=!1),onConfirm:ce},null,8,["show"]),p(lr,{show:U.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:h[15]||(h[15]=M=>U.value=!1),onSave:he},null,8,["show","task","task-type","task-id"]),p(Ge,{modal:"",show:ve.value,"task-type":t.type,"task-id":t.task.id,onSave:Rt,onClose:h[16]||(h[16]=M=>ve.value=!1)},null,8,["show","task-type","task-id"]),p(Ke,{modal:"",show:xe.value,"task-type":t.type,"task-id":t.task.id,onSave:Ft,onClose:h[17]||(h[17]=M=>xe.value=!1)},null,8,["show","task-type","task-id"]),p(ws,{show:ie.value,onSave:Ut,onClose:h[18]||(h[18]=M=>ie.value=!1)},null,8,["show"]),p($s,{show:oe.value,onSave:Pt,onClose:h[19]||(h[19]=M=>oe.value=!1)},null,8,["show"]),p(Cs,{show:Me.value,onSave:Wt,onClose:h[20]||(h[20]=M=>Me.value=!1)},null,8,["show"]),p(Vt,{show:Ne.value,title:"Call Feature",onClose:h[21]||(h[21]=M=>Ne.value=!1)},null,8,["show"]),pe.value?(a(),B(Ds,{key:3,show:pe.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:ee.value,onCreate:be,onCancel:h[22]||(h[22]=M=>pe.value=!1)},null,8,["show","customer","assignee","dealerships"])):x("",!0),p(ur,{show:A.value,"existing-tags":t.task.tags||[],onClose:h[23]||(h[23]=M=>A.value=!1),onAdd:Kt},null,8,["show","existing-tags"])])}}},td={class:"flex items-center justify-between mb-4 px-1"},sd={class:"flex items-center gap-2"},ad={key:0,class:"space-y-4 mb-6 px-1"},ld=["onClick"],nd={class:"flex-1 min-w-0"},id={class:"flex items-center gap-2 mb-1"},od={class:"text-xs font-bold text-heading"},rd={class:"ml-auto relative"},dd=["onClick"],ud={class:"text-sm text-body"},cd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub mb-2"},md={key:0,class:"flex items-center gap-1"},fd={key:1,class:"flex items-center gap-1"},pd={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},vd={class:"flex items-center gap-2 min-w-0"},yd={class:"text-xs text-body font-medium truncate"},bd={key:1,class:"text-center py-8 text-sub mb-6"},xd={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:g}){const o=t,k=ye(),S=I=>{if(!I)return 0;const u=new Date(I),s=Math.abs(new Date-u);return Math.ceil(s/(1e3*60*60*24))},w=I=>{const u=[];return o.allTasks&&o.allTasks.length>0&&o.allTasks.filter(s=>s.leadId===I.id).forEach(s=>{u.push({id:s.id,type:s.title||"Task",description:s.description||s.title})}),I.stage==="Open Lead"&&S(I.createdAt)>=0&&u.push({id:`lead-${I.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),u},r=I=>I==="Open Lead"||I==="Validated"||I==="Contacted"?"blue":"gray",i=I=>{const u=k.resolve({path:`/tasks/${I.id}`,query:{type:"lead"}});window.open(u.href,"_blank")};return(I,u)=>(a(),n("div",null,[e("div",td,[e("div",sd,[u[1]||(u[1]=e("i",{class:"fa-solid fa-user-circle text-heading"},null,-1)),u[2]||(u[2]=e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Leads",-1)),p(d(re),{text:String(t.leads.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:u[0]||(u[0]=l=>I.$emit("add-lead")),class:"text-fluid-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),t.leads.length>0?(a(),n("div",ad,[(a(!0),n(P,null,H(t.leads,l=>(a(),n("div",{key:l.id,class:"bg-white border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in feed-item cursor-pointer hover:shadow-md transition-shadow",onClick:s=>i(l)},[u[8]||(u[8]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-orange-100 text-orange-600 border-orange-200"},[e("i",{class:"fa-solid fa-user-circle text-sm"})],-1)),e("div",nd,[e("div",id,[e("span",od,"Lead #"+y(l.id),1),p(d(re),{text:l.stage,size:"small",theme:r(l.stage)},null,8,["text","theme"]),e("div",rd,[e("button",{onClick:ae(s=>i(l),["stop"]),class:"text-gray-400 hover:text-body transition-colors p-1",title:"Open in new tab"},[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,dd)])]),e("div",ud,[e("div",cd,[l.assignee?(a(),n("span",md,[u[5]||(u[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),L(" "+y(l.assignee),1)])):x("",!0),l.requestedCar?(a(),n("span",fd,[u[6]||(u[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),L(" "+y(l.requestedCar.brand)+" "+y(l.requestedCar.model),1)])):x("",!0)]),w(l).length>0?(a(),n("div",pd,[(a(!0),n(P,null,H(w(l),s=>(a(),n("div",{key:s.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",vd,[p(d(re),{text:s.type,size:"small",theme:s.type==="LQ"?"blue":"gray"},null,8,["text","theme"]),e("span",yd,y(s.description),1)]),u[7]||(u[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):x("",!0)])])],8,ld))),128))])):(a(),n("div",bd,[...u[9]||(u[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))]))}},gd={class:"flex items-center justify-between mb-4 px-1"},hd={class:"flex items-center gap-2"},kd={key:0,class:"space-y-4 mb-6 px-1"},wd=["onClick"],$d={class:"flex-1 min-w-0"},Cd={class:"flex items-center gap-2 mb-1"},Td={class:"text-xs font-bold text-heading"},Sd={class:"ml-auto relative"},Id=["onClick"],Ad={class:"text-sm text-body"},Dd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub mb-2"},qd={key:0,class:"flex items-center gap-1"},Ed={key:1,class:"flex items-center gap-1"},Vd={key:2,class:"flex items-center gap-1"},Ld={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},Md={class:"flex items-center gap-2 min-w-0"},Od={class:"text-xs text-body font-medium truncate"},Nd={key:1,class:"text-center py-8 text-sub mb-6"},Bd={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:g}){const o=t,k=ye(),S=u=>{const l=[];o.allTasks&&o.allTasks.length>0&&o.allTasks.filter(T=>T.opportunityId===u.id).forEach(T=>{l.push({id:T.id,type:T.title||"Task",description:T.description||T.title})});const s=o.activities.filter(C=>C.opportunityId===u.id),b={opportunity:u,scheduledAppointment:u.scheduledAppointment||null,activities:s,hasOffers:s.some(C=>C.type==="offer")||!1,stage:u.displayStage||u.stage,deliverySubstatus:u.deliverySubstatus||null},E=Ss(b.stage,b);if(E){const C={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};l.push({id:`opp-${u.id}-${E}`,type:E,description:C[E]||E})}return l},w=u=>({OOFB:"blue",UFB:"gray",NFU:"red",OFB:"blue",CFB:"green",DFB:"blue",NS:"red"})[u]||"gray",r=u=>u==="Qualified"||u==="In Negotiation"?"blue":u==="Closed Won"?"green":u==="Closed Lost"?"red":"gray",i=u=>new Intl.NumberFormat("en-US").format(u),I=u=>{const l=k.resolve({path:`/tasks/${u.id}`,query:{type:"opportunity"}});window.open(l.href,"_blank")};return(u,l)=>(a(),n("div",null,[e("div",gd,[e("div",hd,[l[1]||(l[1]=e("i",{class:"fa-solid fa-briefcase text-heading"},null,-1)),l[2]||(l[2]=e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Opportunities",-1)),p(d(re),{text:String(t.opportunities.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:l[0]||(l[0]=s=>u.$emit("add-opportunity")),class:"text-fluid-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...l[3]||(l[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),t.opportunities.length>0?(a(),n("div",kd,[(a(!0),n(P,null,H(t.opportunities,s=>(a(),n("div",{key:s.id,class:"bg-white border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in feed-item cursor-pointer hover:shadow-md transition-shadow",onClick:b=>I(s)},[l[9]||(l[9]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-briefcase text-sm"})],-1)),e("div",$d,[e("div",Cd,[e("span",Td,"Opp #"+y(s.id),1),p(d(re),{text:s.displayStage||s.stage,size:"small",theme:r(s.displayStage||s.stage)},null,8,["text","theme"]),e("div",Sd,[e("button",{onClick:ae(b=>I(s),["stop"]),class:"text-gray-400 hover:text-body transition-colors p-1",title:"Open in new tab"},[...l[4]||(l[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,Id)])]),e("div",Ad,[e("div",Dd,[s.assignee?(a(),n("span",qd,[l[5]||(l[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),L(" "+y(s.assignee),1)])):x("",!0),s.value?(a(),n("span",Ed,[l[6]||(l[6]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),L(" € "+y(i(s.value)),1)])):x("",!0),s.vehicle?(a(),n("span",Vd,[l[7]||(l[7]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),L(" "+y(s.vehicle.brand)+" "+y(s.vehicle.model),1)])):x("",!0)]),S(s).length>0?(a(),n("div",Ld,[(a(!0),n(P,null,H(S(s),b=>(a(),n("div",{key:b.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",Md,[p(d(re),{text:b.type,size:"small",theme:w(b.type)},null,8,["text","theme"]),e("span",Od,y(b.description),1)]),l[8]||(l[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):x("",!0)])])],8,wd))),128))])):(a(),n("div",Nd,[...l[10]||(l[10]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))]))}},jd={key:0,class:"space-y-4 mb-6 px-1"},Rd=["onClick"],Fd={class:"flex-1 min-w-0"},Ud={class:"flex items-center gap-2 mb-1"},Pd={class:"text-xs font-bold text-heading"},Wd={class:"text-xs text-sub"},zd={class:"ml-auto relative"},Hd=["onClick"],Yd={class:"text-sm text-body"},Gd={class:"flex items-center gap-2 mb-1 flex-wrap"},Kd={class:"text-sm font-medium text-heading mb-1"},Qd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},Jd={class:"flex items-center gap-1"},Xd={key:0,class:"flex items-center gap-1"},Zd={key:1,class:"flex items-center gap-1"},_d={key:1,class:"text-center py-8 text-sub"},eu={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const g=ye(),o=O({}),k={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},S=s=>k[s]||s||"Appointment",w=s=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[s]||"bg-surfaceSecondary text-body border-gray-100",r=s=>{const b=(s||"").toLowerCase();return b==="confirmed"?"bg-green-50 text-green-600":b==="cancelled"?"bg-red-50 text-red-600":b==="no-show"?"bg-amber-50 text-amber-600":"bg-surfaceSecondary text-body"},i=s=>{if(!s)return"";const b=new Date(s);return b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:b.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},I=s=>{if(!s)return"Just now";const b=new Date(s),C=new Date-b,T=Math.floor(C/6e4),m=Math.floor(T/60),f=Math.floor(m/24);return T<1?"Just now":T<60?`${T} minutes ago`:m<24?`${m} hours ago`:f===1?"Yesterday":f<7?`${f} days ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},u=s=>{var b;return s.customerInitials?s.customerInitials:(b=s.customer)!=null&&b.initials?s.customer.initials:"SK"},l=s=>{s.opportunityId?g.push({path:`/tasks/${s.opportunityId}`,query:{type:"opportunity"}}):s.leadId?g.push({path:`/tasks/${s.leadId}`,query:{type:"lead"}}):g.push({path:"/calendar"})};return(s,b)=>(a(),n("div",null,[t.appointments.length>0?(a(),n("div",jd,[(a(!0),n(P,null,H(t.appointments,E=>(a(),n("div",{key:E.id,class:"bg-white border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in feed-item cursor-pointer hover:shadow-md transition-shadow",onClick:C=>l(E)},[b[5]||(b[5]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Fd,[e("div",Ud,[e("span",Pd,y(u(E)),1),b[1]||(b[1]=e("span",{class:"text-xs text-sub"},"scheduled",-1)),e("span",Wd,"• "+y(I(E.start)),1),e("div",zd,[e("button",{onClick:ae(C=>o.value[E.id]=!o.value[E.id],["stop"]),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...b[0]||(b[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Hd)])]),e("div",Yd,[e("div",Gd,[e("span",{class:N(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",w(E.type)])},y(S(E.type)),3),E.status?(a(),n("span",{key:0,class:N(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",r(E.status)])},y(E.status),3)):x("",!0)]),e("div",Kd,y(E.title||"Appointment"),1),e("div",Qd,[e("span",Jd,[b[2]||(b[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),L(" "+y(i(E.start)),1)]),E.assignee?(a(),n("span",Xd,[b[3]||(b[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),L(" "+y(E.assignee),1)])):x("",!0),E.vehicle?(a(),n("span",Zd,[b[4]||(b[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),L(" "+y(E.vehicle),1)])):x("",!0)])])])],8,Rd))),128))])):(a(),n("div",_d,[...b[6]||(b[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))]))}},tu={key:0,class:"mb-8"},su={class:"relative"},au={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},lu=["onClick"],nu={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},iu=["src"],ou={key:1,class:"fa-solid fa-car text-4xl text-sub"},ru={class:"p-6"},du={class:"font-bold text-heading text-sm mb-1"},uu={key:0,class:"text-xs text-sub mb-2"},cu={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},mu={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:g}){const o=g,k=O(!1),S=I=>new Intl.NumberFormat("en-US").format(I),w=I=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[I]||"Car",r=I=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[I]||"bg-gray-600",i=I=>{o("car-click",I),k.value=!0};return(I,u)=>t.cars.length>0?(a(),n("div",tu,[u[2]||(u[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),e("h3",{class:"font-bold text-heading text-sm"},"Cars")],-1)),e("div",su,[e("div",au,[(a(!0),n(P,null,H(t.cars,(l,s)=>(a(),n("div",{key:l.id,class:"flex-none w-64 snap-start bg-surface border border-E5E7EB rounded-card shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:b=>i(l)},[e("div",{class:N(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",r(l.type)])},y(w(l.type)),3),e("div",nu,[l.image?(a(),n("img",{key:0,src:l.image,alt:"Car",class:"w-full h-full object-cover"},null,8,iu)):(a(),n("i",ou))]),e("div",ru,[e("h4",du,y(l.brand)+" "+y(l.model)+" ("+y(l.year)+")",1),l.price?(a(),n("p",uu,"€ "+y(S(l.price)),1)):x("",!0),l.stockDays!==null&&l.stockDays!==void 0?(a(),n("div",cu,[u[1]||(u[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),L(" In stock ("+y(l.stockDays)+" days) ",1)])):x("",!0)])],8,lu))),128))])]),p(Vt,{show:k.value,title:"Car Details",onClose:u[0]||(u[0]=l=>k.value=!1)},null,8,["show"])])):x("",!0)}},fu=is(mu,[["__scopeId","data-v-94fa8916"]]),pu={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},vu={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:g}){const o=t,k=g,S=O(null),w=q(()=>o.type==="lead"?"Add New Lead":"Add New Opportunity");q(()=>`Create a ${o.type} for ${o.contact.name}`);const r=I=>{I||k("close")},i=I=>{k("save",I)};return(I,u)=>(a(),B(d(lt),{open:t.show,"onUpdate:open":r},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>[L(y(w.value),1)]),_:1})]),_:1}),e("div",pu,[p(ds,{ref_key:"formRef",ref:S,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:i},null,8,["initial-contact","force-type"])]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>{var l,s,b,E;return[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[0]||(u[0]=C=>I.$emit("close"))}),p(d(Z),{label:(l=S.value)!=null&&l.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((s=S.value)==null?void 0:s.isSubmitting)||!((b=S.value)!=null&&b.canSubmit),onClick:(E=S.value)==null?void 0:E.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},yu={class:"rounded-card flex flex-col mb-6 bg-surfaceSecondary"},bu={class:"bg-white rounded-card p-2 shadow-nsc-card flex flex-col"},xu={class:"divide-y divide-gray-100"},gu={class:"p-3"},hu={key:0,class:"text-sm text-body leading-relaxed whitespace-pre-line"},ku={key:1,class:"flex items-center gap-3 py-1 text-sub"},wu={key:0,class:"p-3"},$u={class:"flex flex-wrap gap-2"},Cu={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null}},setup(t){const g=t,o=q(()=>{if(g.preferences&&g.preferences.length>0)return g.preferences;const k=[],S=g.customerData;if(!S)return k;if(S.preferredVehicleType&&k.push({icon:"fa-solid fa-car",label:`Prefers ${S.preferredVehicleType}s`}),S.preferredChannel){const w={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};k.push({icon:w[S.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${S.preferredChannel}`})}return S.preferredContactTime&&k.push({icon:"fa-solid fa-clock",label:S.preferredContactTime}),S.budgetRange&&k.push({icon:"fa-solid fa-dollar-sign",label:S.budgetRange}),k});return(k,S)=>(a(),n("div",yu,[S[1]||(S[1]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-heading"}),e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Customer Insights")])],-1)),e("div",bu,[e("div",xu,[e("div",gu,[t.summary?(a(),n("p",hu,y(t.summary),1)):(a(),n("div",ku,[...S[0]||(S[0]=[e("i",{class:"fa-solid fa-circle-info text-sm opacity-20"},null,-1),e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1)])]))]),o.value&&o.value.length>0?(a(),n("div",wu,[e("div",$u,[(a(!0),n(P,null,H(o.value,(w,r)=>(a(),n("span",{key:r,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-surfaceSecondary text-heading text-xs font-semibold uppercase tracking-wider rounded border border-black/5"},[e("i",{class:N([w.icon,"text-xs text-primary"])},null,2),L(" "+y(w.label),1)]))),128))])])):x("",!0)])])]))}},Tu={key:0,class:"rounded-card flex flex-col mb-6 bg-surfaceSecondary"},Su={class:"bg-white rounded-card p-2 shadow-nsc-card flex flex-col"},Iu={class:"divide-y divide-gray-100"},Au={class:"p-3"},Du={class:"text-sm text-body leading-relaxed break-words"},qu={key:0,class:"text-sub"},Eu={class:"font-medium text-heading"},Vu={class:"text-xs text-sub ml-1"},Lu={class:"p-3"},Mu={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},Ou={__name:"SuggestedNextAction",props:{leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},setup(t){const g=t,o=ye(),k=q(()=>{if(!g.leads||g.leads.length===0)return null;const u=g.leads.filter(s=>{if(s.isDisqualified)return!1;const b=xt(s,"lead");return b!=="Closed - Invalid"&&b!=="Closed - Not Interested"&&b!=="Closed - Duplicate"});if(u.length===0)return null;const l={Hot:3,Medium:2,Low:1};return u.sort((s,b)=>{const E=l[s.priority]||0,C=l[b.priority]||0;if(E!==C)return C-E;const T=new Date(s.updatedAt||s.createdAt||0);return new Date(b.updatedAt||b.createdAt||0)-T}),u[0]}),S=q(()=>{if(!g.opportunities||g.opportunities.length===0)return null;const u=g.opportunities.filter(s=>{const b=s.displayStage||s.stage;return b!=="Closed Won"&&b!=="Closed Lost"&&b!=="Abandoned"});if(u.length===0)return null;const l={Hot:3,Medium:2,Low:1};return u.sort((s,b)=>{const E=l[s.priority]||0,C=l[b.priority]||0;if(E!==C)return C-E;const T=new Date(s.updatedAt||s.createdAt||0);return new Date(b.updatedAt||b.createdAt||0)-T}),u[0]}),w=q(()=>{if(!k.value)return null;const u=k.value,l={lead:u,displayStage:xt(u,"lead")},s=Lt(l);return s?{...s,type:"lead",entityId:u.id,entity:u}:null}),r=q(()=>{if(!S.value)return null;const u=S.value,l=g.activities.filter(E=>E.opportunityId===u.id),s={opportunity:u,scheduledAppointment:u.scheduledAppointment||null,activities:l,hasOffers:l.some(E=>E.type==="offer")||!1,stage:u.displayStage||u.stage,deliverySubstatus:u.deliverySubstatus||null,formatDateTime:E=>{if(!E)return"";const C=new Date(E);return C.toLocaleDateString()+" "+C.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},b=Mt(s.stage,s);return b?{...b,type:"opportunity",entityId:u.id,entity:u}:null}),i=q(()=>{const u=[];w.value&&u.push({...w.value,id:`lead-${w.value.entityId}`}),r.value&&u.push({...r.value,id:`opp-${r.value.entityId}`});const l={Hot:3,Medium:2,Low:1};return u.sort((s,b)=>{const E=s.entity,C=b.entity,T=l[E==null?void 0:E.priority]||0,m=l[C==null?void 0:C.priority]||0;return T!==m?m-T:s.type==="lead"&&b.type==="opportunity"?-1:s.type==="opportunity"&&b.type==="lead"?1:0}),u}),I=u=>{u.type==="lead"?o.push({path:`/tasks/${u.entityId}`,query:{type:"lead"}}):u.type==="opportunity"&&o.push({path:`/tasks/${u.entityId}`,query:{type:"opportunity"}})};return(u,l)=>i.value.length>0?(a(),n("div",Tu,[l[2]||(l[2]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-heading"}),e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Suggested Next Action")])],-1)),e("div",Su,[e("div",Iu,[e("div",Au,[e("p",Du,[(a(!0),n(P,null,H(i.value,(s,b)=>(a(),n(P,{key:s.id},[b>0?(a(),n("span",qu," or ")):x("",!0),e("span",Eu,y(s.title),1),e("span",Vu," ("+y(s.type==="lead"?"Lead":"Opp")+" #"+y(s.entityId)+") ",1)],64))),128))])]),e("div",Lu,[e("div",Mu,[i.value.length>0?(a(),n("button",{key:0,onClick:l[0]||(l[0]=s=>I(i.value[0])),class:"flex items-center justify-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-btn font-medium text-sm transition-all w-full sm:w-auto sm:shrink-0"},[e("i",{class:N([i.value[0].icon,"text-sm"])},null,2),e("span",null,y(i.value[0].label),1)])):x("",!0),i.value.length>1?(a(),n("button",{key:1,onClick:l[1]||(l[1]=s=>I(i.value[1])),class:"flex items-center justify-center gap-2 px-4 py-2 bg-surface border border-border hover:bg-surfaceSecondary text-heading rounded-btn font-medium text-sm transition-colors w-full sm:w-auto sm:shrink-0"},[e("i",{class:N([i.value[1].icon,"text-sm"])},null,2),e("span",null,y(i.value[1].label),1)])):x("",!0)])])])])])):x("",!0)}},Nu={class:"rounded-card flex flex-col mb-6 bg-surfaceSecondary"},Bu={class:"bg-white rounded-card p-2 shadow-nsc-card flex flex-col"},ju={class:"divide-y divide-gray-100"},Ru={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Fu={class:"flex items-center gap-3 min-w-0"},Uu={class:"min-w-0"},Pu={class:"text-sm text-body truncate"},Wu={class:"text-xs text-sub truncate"},zu={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Hu={class:"flex items-center gap-3 min-w-0"},Yu={class:"w-8 h-8 rounded bg-slate-100 flex items-center justify-center shrink-0"},Gu={class:"min-w-0"},Ku={class:"text-sm text-body truncate"},Qu={class:"text-xs text-sub truncate"},Ju={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Xu={class:"flex items-center gap-3 min-w-0"},Zu={class:"min-w-0"},_u={class:"text-sm text-body truncate"},ec={class:"text-xs text-sub truncate"},tc={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},sc={class:"flex items-center gap-3 min-w-0"},ac={class:"min-w-0"},lc={class:"text-sm text-body truncate"},nc={class:"text-xs text-sub truncate"},ic={key:0,class:"text-center py-6 text-sub"},oc={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null}},setup(t){const g=t,o=ye(),k=q(()=>{const m=["email","sms","whatsapp","call"],f=g.activities.filter(c=>m.includes(c.type)).sort((c,V)=>new Date(V.timestamp)-new Date(c.timestamp));return f.length>0?f[0]:null}),S=q(()=>{const m=g.leads.filter(f=>{var c;return!f.isDisqualified&&f.status!=="Disqualified"&&!((c=f.stage)!=null&&c.includes("Closed"))});return m.length>0?m[0]:null}),w=q(()=>{if(!S.value)return null;try{return Lt({lead:S.value,displayStage:S.value.stage})}catch(m){return console.error("Error getting lead next action:",m),null}}),r=q(()=>{const m=g.opportunities.filter(f=>f.stage!=="Closed Won"&&f.stage!=="Closed Lost");return m.length>0?m[0]:null}),i=q(()=>{if(!r.value)return null;try{const m=g.activities.filter(c=>c.opportunityId===r.value.id)||[];return Mt(r.value.stage,{opportunity:r.value,scheduledAppointment:r.value.scheduledAppointment||null,activities:m,hasOffers:m.some(c=>c.type==="offer")||!1,stage:r.value.stage,deliverySubstatus:r.value.deliverySubstatus||null,formatDateTime:c=>c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(m){return console.error("Error getting opportunity next action:",m),null}}),I=m=>({email:"fa-solid fa-envelope",sms:"fa-solid fa-message",whatsapp:"fa-brands fa-whatsapp",call:"fa-solid fa-phone"})[m]||"fa-solid fa-comment",u=m=>m.type==="call"?m.content||`Call with ${m.user||"customer"}`:m.type==="email"?m.subject||m.content||"Email communication":m.type==="sms"||m.type==="whatsapp"?m.content||`${m.type.toUpperCase()} message`:m.content||"Communication",l=m=>{if(!m)return"";const f=new Date(m),c=new Date,V=Math.abs(c-f),F=Math.ceil(V/(1e3*60*60*24));return F===1?"Today":F===2?"Yesterday":F<=7?`${F-1} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:f.getFullYear()!==c.getFullYear()?"numeric":void 0})},s=m=>{if(!m)return"";const f=new Date(m),c=new Date;if(f.toDateString()===c.toDateString())return`Today at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const F=new Date(c);return F.setDate(F.getDate()+1),f.toDateString()===F.toDateString()?`Tomorrow at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:f.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=()=>{var m,f;(m=g.nextAppointment)!=null&&m.opportunityId?o.push({path:`/tasks/${g.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(f=g.nextAppointment)!=null&&f.leadId?o.push({path:`/tasks/${g.nextAppointment.leadId}`,query:{type:"lead"}}):o.push({path:"/calendar"})},E=()=>{var m,f;(m=k.value)!=null&&m.opportunityId?o.push({path:`/tasks/${k.value.opportunityId}`,query:{type:"opportunity"}}):(f=k.value)!=null&&f.leadId&&o.push({path:`/tasks/${k.value.leadId}`,query:{type:"lead"}})},C=()=>{var m;(m=S.value)!=null&&m.id&&o.push({path:`/tasks/${S.value.id}`,query:{type:"lead"}})},T=()=>{var m;(m=r.value)!=null&&m.id&&o.push({path:`/tasks/${r.value.id}`,query:{type:"opportunity"}})};return(m,f)=>{var c,V,F,te,J,ue;return a(),n("div",Nu,[f[12]||(f[12]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock-rotate-left text-heading"}),e("h2",{class:"text-sm font-semibold text-heading leading-5"},"Recent Activities")])],-1)),e("div",Bu,[e("div",ju,[t.nextAppointment?(a(),n("div",Ru,[e("div",Fu,[f[1]||(f[1]=e("div",{class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar-check text-primary text-sm"})],-1)),e("div",Uu,[f[0]||(f[0]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",Pu,y(s(t.nextAppointment.start)),1),e("div",Wu,y(t.nextAppointment.title||"Appointment"),1)])]),e("button",{onClick:b,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-primary/30 text-sub hover:text-primary transition-all shrink-0",title:"View Details"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),k.value?(a(),n("div",zu,[e("div",Hu,[e("div",Yu,[e("i",{class:N([I(k.value.type),"text-slate-600 text-sm"])},null,2)]),e("div",Gu,[f[3]||(f[3]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",Ku,y(u(k.value)),1),e("div",Qu,y(l(k.value.timestamp)),1)])]),e("button",{onClick:E,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-slate-300 text-sub hover:text-slate-600 transition-all shrink-0",title:"View Details"},[...f[4]||(f[4]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),S.value?(a(),n("div",Ju,[e("div",Xu,[f[6]||(f[6]=e("div",{class:"w-8 h-8 rounded bg-brand-dark/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-user-clock text-brand-dark text-sm"})],-1)),e("div",Zu,[f[5]||(f[5]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",_u,y(((c=w.value)==null?void 0:c.label)||"No action defined"),1),e("div",ec,y((V=S.value.requestedCar)==null?void 0:V.brand)+" "+y((F=S.value.requestedCar)==null?void 0:F.model),1)])]),e("button",{onClick:C,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-dark/30 text-sub hover:text-brand-dark transition-all shrink-0",title:"View Details"},[...f[7]||(f[7]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),r.value?(a(),n("div",tc,[e("div",sc,[f[9]||(f[9]=e("div",{class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-handshake text-primary text-sm"})],-1)),e("div",ac,[f[8]||(f[8]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",lc,y(((te=i.value)==null?void 0:te.label)||"No action defined"),1),e("div",nc,y((J=r.value.vehicle)==null?void 0:J.brand)+" "+y((ue=r.value.vehicle)==null?void 0:ue.model)+" - "+y(r.value.stage),1)])]),e("button",{onClick:T,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-primary/30 text-sub hover:text-primary transition-all shrink-0",title:"View Details"},[...f[10]||(f[10]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0)]),!t.nextAppointment&&!k.value&&!S.value&&!r.value?(a(),n("div",ic,[...f[11]||(f[11]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No recent activities available",-1)])])):x("",!0)])])}}},rc={class:"h-full flex flex-col overflow-hidden bg-surface"},dc={key:0,class:"flex-1 flex items-center justify-center"},uc={class:"flex flex-col gap-6"},cc={class:"flex flex-col gap-6 mb-6"},kc={__name:"CustomerProfile",props:{customerId:{type:Number,required:!0},customerType:{type:String,default:"contact",validator:t=>["contact","account"].includes(t)},showCloseButton:{type:Boolean,default:!1},closeOnConvert:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:g}){const o=t,k=g,S=ye();It(),Dt();const w=qt(),r=O(!1),i=O(null),I=O(null),u=O([]),l=O([]),s=O([]),b=O([]),E=O([]),C=O([]),T=q(()=>"contact"),m=q(()=>I.value||w.currentCustomer),f=q(()=>{const $=m.value;return $?{...$,id:$.id,type:"contact",customer:{id:$.id,name:$.name,email:$.email,phone:$.phone,address:$.address||"",initials:$.initials},source:$.source||"Direct",tags:$.tags||[],stage:"Contact",assignee:null,assigneeId:null}:null}),c=q(()=>{const $=new Date,A=(C.value||[]).filter(U=>(U==null?void 0:U.start)&&new Date(U.start)>=$);return A.sort((U,ee)=>new Date(U.start)-new Date(ee.start)),A.length>0?A[0]:null}),V=q(()=>null),F=q(()=>({currentActivities:q(()=>E.value),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),te=q(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),J=async()=>{if(o.customerId)try{r.value=!0;const[$,A,U,ee,ve]=await Promise.all([w.fetchCustomerById(o.customerId,o.customerType),Ms(o.customerId),Os(o.customerId),Ns(o.customerId),Bs(o.customerId)]);I.value=$||w.currentCustomer,u.value=A.data||[],l.value=U.data||[],s.value=ee.data||[],b.value=ve.data||[];const xe=[];for(const ie of u.value)try{const oe=await os(ie.id);xe.push(...oe)}catch(oe){console.error(`Failed to load activities for lead ${ie.id}:`,oe)}for(const ie of l.value)try{const oe=await rs(ie.id);xe.push(...oe)}catch(oe){console.error(`Failed to load activities for opportunity ${ie.id}:`,oe)}E.value=xe;try{C.value=await Ls(o.customerId)}catch(ie){console.error("Failed to load appointments:",ie),C.value=[]}}catch($){console.error("Error loading customer data:",$),i.value=$.message||"Failed to load customer"}finally{r.value=!1}},ue=async $=>{try{await w.addRequestedCar(o.customerId,$),await J()}catch(A){console.error("Error adding car to customer:",A),i.value=A.message||"Failed to add car"}},be=async()=>{try{r.value=!0;const $=await w.convertToLead(o.customerId);o.closeOnConvert&&k("close"),S.push({path:`/tasks/${$.id}`,query:{type:"lead"}})}catch($){console.error("Error converting to lead:",$),i.value=$.message||"Failed to convert to lead",r.value=!1}},fe=async()=>{try{r.value=!0;const $=await w.convertToOpportunity(o.customerId);o.closeOnConvert&&k("close"),S.push({path:`/tasks/${$.id}`,query:{type:"opportunity"}})}catch($){console.error("Error converting to opportunity:",$),i.value=$.message||"Failed to convert to opportunity",r.value=!1}},ce=O(!1),le=O("lead"),he=q(()=>{if(!m.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const $=m.value;return{id:$.id,name:$.name||"Unknown",email:$.email||"",phone:$.phone||"",initials:$.initials||"?"}}),de=$=>{le.value=$,ce.value=!0},X=async $=>{try{if(r.value=!0,ce.value=!1,!o.customerId)throw new Error("Customer ID not found");le.value==="lead"?await w.convertToLead(o.customerId):await w.convertToOpportunity(o.customerId),await J(),r.value=!1}catch(A){console.error(`Error adding ${le.value}:`,A),i.value=A.message||`Failed to add ${le.value}`,r.value=!1}},pe=async()=>{await J()},ne=async()=>{await J()};return Le(async()=>{await J()}),me(()=>o.customerId,$=>{$&&J()}),($,A)=>(a(),n("div",rc,[r.value||!m.value?(a(),n("div",dc,[...A[4]||(A[4]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent"},null,-1)])])):(a(),B(ed,{key:1,task:f.value,type:T.value,"management-widget":V.value,"store-adapter":F.value,"add-new-config":te.value,"show-close-button":t.showCloseButton,onClose:A[2]||(A[2]=U=>$.$emit("close")),onCarAdded:ue,onConvertToLead:be,onConvertToOpportunity:fe,onTagUpdated:pe,onAppointmentCreated:ne},{"pinned-extra":D(({task:U})=>{var ee,ve;return[e("div",uc,[p(Cu,{summary:U.summary||((ee=I.value)==null?void 0:ee.summary),preferences:U.preferences||((ve=I.value)==null?void 0:ve.preferences),"customer-data":I.value},null,8,["summary","preferences","customer-data"]),p(Ou,{leads:u.value,opportunities:l.value,activities:E.value},null,8,["leads","opportunities","activities"]),p(oc,{"next-appointment":c.value,activities:E.value,leads:u.value,opportunities:l.value,"customer-id":t.customerId},null,8,["next-appointment","activities","leads","opportunities","customer-id"]),b.value.length>0?(a(),B(fu,{key:0,cars:b.value},null,8,["cars"])):x("",!0)])]}),"tab-negotiations":D(()=>[e("div",cc,[p(xd,{leads:u.value,"all-tasks":s.value,onAddLead:A[0]||(A[0]=U=>de("lead"))},null,8,["leads","all-tasks"]),p(Bd,{opportunities:l.value,"all-tasks":s.value,activities:E.value,onAddOpportunity:A[1]||(A[1]=U=>de("opportunity"))},null,8,["opportunities","all-tasks","activities"])])]),"tab-appointments":D(()=>[p(eu,{appointments:C.value},null,8,["appointments"])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config","show-close-button"])),m.value?(a(),B(vu,{key:2,show:ce.value,type:le.value,contact:he.value,onClose:A[3]||(A[3]=U=>ce.value=!1),onSave:X},null,8,["show","type","contact"])):x("",!0)]))}};export{kc as _};
