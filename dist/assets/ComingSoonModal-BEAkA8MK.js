import{E as Fe,r as I,Y as lt,h as Be,c as $,H as Ue,d as i,o as n,e,y,n as M,w as X,t as c,F as P,i as R,p as O,g as f,s as h,P as We,a8 as yt,G as it,x as L,z as Ie,k as V,_ as vt,v as ge,j as ve,J as j,Q as B,l as ie,m as xe,D as N,a9 as gt,a2 as xt,a0 as ht,I as kt,N as Ge,X as Y,W as oe,K as te}from"./index-B6fu4vW4.js";import{_ as wt}from"./ReassignUserModal-CoERerCP.js";import{_ as Ct}from"./CreateEventModal-U-8LM8Mz.js";import{a as he,F as ke,L as we,H as Ce,j as $e,K as Pe,C as Se,W as Ae}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-K7ki7z-B.js";import{u as $t}from"./opportunities-Cpo2JN0p.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=Fe("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=Fe("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=Fe("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Tt={class:"w-full p-3 md:px-8 md:py-3.5 border-b border-black/5 shadow-xs",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Dt={class:"flex items-center justify-between gap-4"},Et={class:"flex items-center gap-2 flex-1 min-w-0"},qt={class:"flex items-center gap-3 min-w-0 flex-1"},It={class:"min-w-0 flex-1"},Ot={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},Nt={class:"flex flex-col gap-1.5 mt-1"},Mt={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},Lt={class:"flex items-center gap-1.5 group"},jt={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},Vt={class:"flex items-center gap-1.5 group"},Ft={class:"text-xs text-heading font-medium whitespace-nowrap"},Bt={class:"flex items-center gap-1.5"},Ut={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},Wt={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},Pt={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},Rt={class:"flex flex-wrap items-center gap-1.5"},zt={class:"shrink-0"},Qt={class:"relative"},Ht={key:0,class:"absolute top-full right-0 mt-2 z-50 shadow-xl"},Yt={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]}},emits:["action","add-tag"],setup(t,{emit:o}){const l=t,r=o,m=I(!1),s=lt(),b=Be(),p=$(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...l.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(T=>({...T,onClick:()=>a(T.key)}))),a=q=>{m.value=!1,r("action",q)},d=async(q,T)=>{try{await navigator.clipboard.writeText(q),s.pushToast("success",`${T==="email"?"Email":"Phone"} copied!`)}catch{s.pushToast("error","Failed to copy")}},u=()=>r("add-tag"),k=()=>{l.customerId&&b.push(`/customer/${l.customerId}`)};return(q,T)=>{const A=Ue("click-outside");return n(),i("div",Tt,[e("div",Dt,[e("div",Et,[e("button",{onClick:T[0]||(T[0]=C=>y(b).push("/customers")),class:"w-7 h-7 flex items-center justify-center text-sub hover:text-brand-dark transition-colors shrink-0 -ml-1","aria-label":"Back to customers"},[...T[4]||(T[4]=[e("i",{class:"fa-solid fa-arrow-left text-xs"},null,-1)])]),e("div",qt,[e("button",{onClick:X(k,["stop"]),class:M(["w-20 h-20 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...T[5]||(T[5]=[e("i",{class:"fa-solid fa-user text-3xl text-white"},null,-1)])],2),e("div",It,[e("h1",Ot,c(t.name),1),e("div",Nt,[e("div",Mt,[e("div",Lt,[T[7]||(T[7]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",jt,c(t.email),1),e("button",{onClick:T[1]||(T[1]=X(C=>d(t.email,"email"),["stop"])),class:"transition-all"},[...T[6]||(T[6]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",Vt,[T[9]||(T[9]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",Ft,c(t.phone),1),e("button",{onClick:T[2]||(T[2]=X(C=>d(t.phone,"phone"),["stop"])),class:"transition-all"},[...T[8]||(T[8]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",Bt,[t.thirdFieldLabel.toLowerCase().includes("address")?(n(),i("i",Ut)):(n(),i("i",Wt)),e("span",Pt,c(t.thirdFieldValue),1)])]),e("div",Rt,[(n(!0),i(P,null,R(t.tags,C=>(n(),i("span",{key:C,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},c(C),1))),128)),e("button",{onClick:X(u,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...T[10]||(T[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])])]),e("div",zt,[e("div",Qt,[e("button",{onClick:T[3]||(T[3]=X(C=>m.value=!m.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...T[11]||(T[11]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),m.value?O((n(),i("div",Ht,[h(y(We),{items:p.value,className:"w-48"},null,8,["items"])])),[[A,()=>m.value=!1]]):f("",!0)])])])])}}},Kt={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},Gt=["onClick"],Xe={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const o={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-thumbtack",manage:"fa-solid fa-gear",data:"fa-solid fa-database",notes:"fa-solid fa-note-sticky"},l=r=>o[r]||"fa-solid fa-circle";return(r,m)=>(n(),i("div",Kt,[(n(!0),i(P,null,R(t.tabs,s=>(n(),i("div",{key:s.key,onClick:b=>r.$emit("update:modelValue",s.key),class:M(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===s.key?"border-brand-dark text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:M([l(s.key),"text-sm md:text-sm",t.modelValue===s.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:M(["hidden md:inline whitespace-nowrap",t.modelValue===s.key?"text-brand-darkDarker":""])},c(s.label),3)],10,Gt))),128))]))}},Jt={class:"w-full mb-6"},Xt={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},Zt={class:"px-4 md:px-6 py-3 border-b border-black/5"},_t={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},es={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},ts={class:"flex items-center gap-1.5"},ss={key:1},as={class:"flex items-center gap-2"},ns={key:0,class:"p-4 md:p-6"},ls={key:0,class:"space-y-4"},is={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},os={class:"flex items-center gap-4"},rs={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},ds=["src"],us={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},cs={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},ms={class:"flex items-center gap-2 flex-wrap"},fs={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},ps={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},bs={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},ys={class:"text-fluid-xs font-bold text-heading"},vs={key:0,class:"text-right"},gs={class:"font-bold text-heading text-fluid-lg"},xs={key:0,class:"pt-2"},hs={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},ks={class:"text-fluid-sm text-body leading-relaxed"},ws={key:1,class:"space-y-3"},Cs={key:0,class:"flex items-center gap-2"},$s={class:"text-fluid-sm font-semibold text-heading"},Ss={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},As={class:"text-fluid-sm text-body leading-relaxed"},Ts={key:1,class:"border-t border-black/5"},Ds={class:"font-medium"},Es={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},qs={class:"mb-6"},Is={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Os={key:0},Ns={class:"font-medium text-body"},Ms={key:1},Ls={class:"font-medium text-body"},js={key:2},Vs={class:"font-medium text-body"},Fs={class:"font-medium text-body"},Bs={key:0},Us={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ws={key:0},Ps={class:"font-medium text-body"},Rs={key:1},zs={class:"font-medium text-body"},Qs={key:2},Hs={class:"font-medium text-body"},Ys={key:3},Ks={class:"font-medium text-body"},Gs={key:4},Js={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},Xs={key:5},Zs={class:"font-medium text-body"},_s={key:0,class:"mt-6 flex justify-end"},ea={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const o=t,l=I(!1);$(()=>o.deliverySubstatus?yt(o.deliverySubstatus):"");const r=$(()=>o.deliverySubstatus?o.deliverySubstatus==="Delivered"?"green":o.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),m=$(()=>it(o.stage,o.entityType));function s(w){return!w||w.length===0?null:w.filter(J=>J.type==="offer").sort((J,ae)=>new Date(ae.timestamp)-new Date(J.timestamp))[0]||null}function b(w){if(!w)return 0;const g=new Date(w),ae=Math.abs(new Date-g);return Math.ceil(ae/(1e3*60*60*24))}const p=$(()=>{if(o.stage!=="In Negotiation")return null;const w=s(o.activities);if(!w)return null;const g=b(w.timestamp);return g<1?{label:"New Offer",theme:"orange"}:g<3?{label:"Active",theme:"yellow"}:null}),a=$(()=>o.requestedCar&&o.requestedCar.brand&&o.requestedCar.model),d=$(()=>o.requestType||o.requestMessage||a.value),u=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.brand)||""}),k=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.model)||""}),q=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.year)||""}),T=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.image)||""}),A=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.price)||null}),C=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.stockDays)!==void 0?o.requestedCar.stockDays:null}),D=$(()=>{var w,g;return((w=o.requestedCar)==null?void 0:w.dealership)||((g=o.task)==null?void 0:g.dealership)||""}),E=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.registration)||""}),F=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.kilometers)!==void 0?o.requestedCar.kilometers:null}),U=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.fuelType)||""}),re=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.gearType)||""}),Te=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.vin)||""}),Oe=$(()=>"Email"),fe=$(()=>{var w,g;return((w=o.task)==null?void 0:w.sourceDetails)||((g=o.requestedCar)==null?void 0:g.adCampaign)||""}),_=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.expectedPurchaseDate)||""}),pe=$(()=>{var w;return((w=o.task)==null?void 0:w.fiscalEntity)||""}),be=$(()=>{var w;return((w=o.task)==null?void 0:w.sourceDetails)||""}),de=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.adMedium)||""}),ye=$(()=>{var w;return((w=o.requestedCar)==null?void 0:w.adSource)||""});$(()=>!0);const G=$(()=>!0),z=$(()=>a.value||o.requestType||o.source||be.value||fe.value||_.value||pe.value||de.value||ye.value),se=w=>new Intl.NumberFormat("en-US").format(w),ue=w=>new Intl.NumberFormat("en-US").format(w);return(w,g)=>(n(),i("div",Jt,[e("div",Xt,[e("div",Zt,[e("div",_t,[d.value?(n(),i("div",es,[g[2]||(g[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",ts,[e("span",{class:M(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:M(["px-2 py-0.5 rounded text-fluid-xs font-medium border",m.value])},c(t.stage),3),t.deliverySubstatus?(n(),L(y(Ie),{key:0,text:t.deliverySubstatus,size:"small",theme:r.value},null,8,["text","theme"])):f("",!0),p.value?(n(),L(y(Ie),{key:1,text:p.value.label,size:"small",theme:p.value.theme},null,8,["text","theme"])):f("",!0)])])):(n(),i("div",ss)),e("div",as,[g[3]||(g[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:g[0]||(g[0]=J=>w.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},c(t.owner),1)])])]),d.value?(n(),i("div",ns,[a.value?(n(),i("div",ls,[e("div",is,[e("div",os,[e("div",rs,[T.value?(n(),i("img",{key:0,src:T.value,alt:"Car",class:"w-full h-full object-cover"},null,8,ds)):(n(),i("i",us))]),e("div",null,[e("div",cs,c(u.value)+" "+c(k.value)+" ("+c(q.value)+")",1),e("div",ms,[C.value!==void 0&&C.value!==null?(n(),i("div",fs,[g[4]||(g[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+c(C.value)+" days) ",1)])):a.value?(n(),i("div",ps,[...g[5]||(g[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])])):f("",!0),t.source?(n(),i("div",bs,[g[6]||(g[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",ys,c(t.source),1)])):f("",!0)])])]),A.value?(n(),i("div",vs,[g[7]||(g[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",gs,"€ "+c(se(A.value)),1)])):f("",!0)]),t.requestMessage?(n(),i("div",xs,[g[8]||(g[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",hs,[e("p",ks,c(t.requestMessage),1)])])):f("",!0)])):(n(),i("div",ws,[t.requestType?(n(),i("div",Cs,[g[9]||(g[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",$s,c(t.requestType),1)])):f("",!0),t.requestMessage?(n(),i("div",Ss,[g[10]||(g[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",As,c(t.requestMessage),1)])):f("",!0)]))])):f("",!0),z.value?(n(),i("div",Ts,[e("button",{onClick:g[1]||(g[1]=J=>l.value=!l.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Ds,c(l.value?"Hide":"View")+" Details",1),e("i",{class:M(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])):f("",!0),l.value&&z.value?(n(),i("div",Es,[e("div",qs,[g[21]||(g[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Is,[t.requestType?(n(),i("div",Os,[g[11]||(g[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",Ns,c(t.requestType),1)])):f("",!0),t.source?(n(),i("div",Ms,[g[12]||(g[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",Ls,c(t.source),1)])):f("",!0),e("div",null,[g[13]||(g[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:M(["font-medium",be.value?"text-body":"text-sub"])},c(be.value||"--"),3)]),D.value?(n(),i("div",js,[g[14]||(g[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Vs,c(D.value),1)])):f("",!0),e("div",null,[g[15]||(g[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",Fs,c(Oe.value||"Email"),1)]),e("div",null,[g[16]||(g[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:M(["font-medium",fe.value?"text-body":"text-sub"])},c(fe.value||"--"),3)]),e("div",null,[g[17]||(g[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:M(["font-medium",de.value?"text-body":"text-sub"])},c(de.value||"--"),3)]),e("div",null,[g[18]||(g[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:M(["font-medium",ye.value?"text-body":"text-sub"])},c(ye.value||"--"),3)]),e("div",null,[g[19]||(g[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:M(["font-medium",_.value?"text-body":"text-sub"])},c(_.value||"--"),3)]),e("div",null,[g[20]||(g[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:M(["font-medium",pe.value?"text-body":"text-sub"])},c(pe.value||"--"),3)])])]),a.value?(n(),i("div",Bs,[g[30]||(g[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[g[29]||(g[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Us,[E.value?(n(),i("div",Ws,[g[22]||(g[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Ps,c(E.value),1)])):f("",!0),F.value!==void 0&&F.value!==null?(n(),i("div",Rs,[g[23]||(g[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",zs,c(ue(F.value))+" Km",1)])):f("",!0),U.value?(n(),i("div",Qs,[g[24]||(g[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Hs,c(U.value),1)])):f("",!0),re.value?(n(),i("div",Ys,[g[25]||(g[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Ks,c(re.value),1)])):f("",!0),Te.value?(n(),i("div",Gs,[g[26]||(g[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Js,c(Te.value),1)])):f("",!0),D.value?(n(),i("div",Xs,[g[27]||(g[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Zs,c(D.value),1)])):f("",!0)]),G.value?(n(),i("div",_s,[...g[28]||(g[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),V(" View technical specs ")],-1)])])):f("",!0)])])):f("",!0)])):f("",!0)])]))}},ta={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},sa={class:"px-4 py-4 flex items-center justify-between shrink-0"},aa={class:"flex items-center gap-2"},na={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},la={class:"flex items-center gap-2 flex-wrap mb-3"},ia={key:0,class:"space-y-3"},oa={class:"flex items-center gap-3"},ra={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},da=["src"],ua={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},ca={class:"flex-1 min-w-0"},ma={class:"font-bold text-heading text-fluid-sm mb-1"},fa={class:"flex items-center gap-2 flex-wrap"},pa={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},ba={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},ya={key:0,class:"text-right"},va={class:"font-bold text-heading text-fluid-sm"},ga={class:"mt-3 pt-3 space-y-2"},xa={key:0,class:"flex items-center justify-between text-fluid-xs"},ha={class:"text-heading font-medium"},ka={key:1,class:"flex items-center justify-between text-fluid-xs"},wa={class:"text-heading font-medium"},Ca={key:2,class:"pt-2"},$a={class:"bg-surfaceSecondary rounded-lg p-2"},Sa={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},Aa={__name:"RequestCard",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const o=t,l=$(()=>o.task.requestedCar&&o.task.requestedCar.brand&&o.task.requestedCar.model),r=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.brand)||""}),m=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.model)||""}),s=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.year)||""}),b=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.image)||""}),p=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.price)||null}),a=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.stockDays)!==void 0?o.task.requestedCar.stockDays:null}),d=$(()=>{var D;return((D=o.task.requestedCar)==null?void 0:D.requestMessage)||""}),u=$(()=>it(o.task.displayStage||o.task.stage,o.entityType)),k=$(()=>o.task.deliverySubstatus?o.task.deliverySubstatus==="Delivered"?"green":o.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function q(D){return!D||D.length===0?null:D.filter(F=>F.type==="offer").sort((F,U)=>new Date(U.timestamp)-new Date(F.timestamp))[0]||null}function T(D){if(!D)return 0;const E=new Date(D),U=Math.abs(new Date-E);return Math.ceil(U/(1e3*60*60*24))}const A=$(()=>{if((o.task.displayStage||o.task.stage)!=="In Negotiation")return null;const D=q(o.activities);if(!D)return null;const E=T(D.timestamp);return E<1?{label:"New Offer",theme:"orange"}:E<3?{label:"Active",theme:"yellow"}:null}),C=D=>new Intl.NumberFormat("en-US").format(D);return(D,E)=>{var F,U;return n(),i("div",ta,[e("div",sa,[E[2]||(E[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Request")],-1)),e("div",aa,[E[1]||(E[1]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:E[0]||(E[0]=re=>D.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},c(t.task.assignee),1)])]),e("div",na,[e("div",la,[e("span",{class:M(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:M(["px-2 py-1 rounded text-xs font-medium border",u.value])},c(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(n(),L(y(Ie),{key:0,text:t.task.deliverySubstatus,size:"small",theme:k.value},null,8,["text","theme"])):f("",!0),A.value?(n(),L(y(Ie),{key:1,text:A.value.label,size:"small",theme:A.value.theme},null,8,["text","theme"])):f("",!0)]),l.value?(n(),i("div",ia,[e("div",oa,[e("div",ra,[b.value?(n(),i("img",{key:0,src:b.value,alt:"Car",class:"w-full h-full object-cover"},null,8,da)):(n(),i("i",ua))]),e("div",ca,[e("div",ma,c(r.value)+" "+c(m.value)+" ("+c(s.value)+")",1),e("div",fa,[a.value!==void 0&&a.value!==null?(n(),i("div",pa,[E[3]||(E[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+c(a.value)+" days) ",1)])):(n(),i("div",ba,[...E[4]||(E[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])]))])]),p.value?(n(),i("div",ya,[E[5]||(E[5]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",va,"€ "+c(C(p.value)),1)])):f("",!0)])])):f("",!0),e("div",ga,[t.task.source?(n(),i("div",xa,[E[6]||(E[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",ha,c(t.task.source),1)])):f("",!0),t.task.requestType||(F=t.task.requestedCar)!=null&&F.requestType?(n(),i("div",ka,[E[7]||(E[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",wa,c(t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)),1)])):f("",!0),d.value?(n(),i("div",Ca,[E[8]||(E[8]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",$a,[e("p",Sa,c(d.value),1)])])):f("",!0)])])])}}},Ta={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                  0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                  0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Da={class:"space-y-3"},Ea={class:"flex justify-between gap-2 items-center"},qa={class:"flex items-center gap-2 min-w-0"},Ia={class:"text-sm font-medium text-greys-900 truncate"},Oa={class:"flex justify-between gap-2 items-center"},Na={class:"flex items-center gap-2 min-w-0"},Ma={class:"text-sm font-medium text-greys-900 truncate"},La={class:"flex justify-between gap-2 items-center"},ja={class:"flex items-center gap-2 min-w-0"},Va={class:"text-sm font-medium text-greys-900 truncate"},Fa={key:0,class:"flex justify-between gap-2 items-start"},Ba={class:"text-sm font-medium text-greys-900 text-right min-w-0"},Ua={key:0,class:"rounded-lg p-3 mt-4 flex items-center gap-2",style:{"background-color":"rgba(59, 130, 246, 0.1)"}},Wa={class:"text-sm text-blue-900"},Pa={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(t){const o=t,l=lt(),r=Be(),m=$(()=>o.task.negotiations||o.task.activeNegotiations||0),s=async(p,a)=>{if(p)try{await navigator.clipboard.writeText(p),l.pushToast("success",`${a==="email"?"Email":"Phone"} copied!`)}catch{l.pushToast("error","Failed to copy")}},b=()=>{o.customerId&&r.push(`/customer/${o.customerId}`)};return(p,a)=>{var d,u,k,q,T,A;return n(),i("div",Ta,[a[6]||(a[6]=e("h3",{class:"text-base font-medium mb-4 text-greys-900"},"Customer information",-1)),e("div",Da,[e("div",Ea,[a[2]||(a[2]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Customer",-1)),e("div",qa,[e("p",Ia,c(((d=t.task.customer)==null?void 0:d.name)||"Unknown"),1),t.customerId?(n(),i("button",{key:0,onClick:b,class:"w-5 h-5 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open customer profile"},[h(y(St),{size:12})])):f("",!0)])]),e("div",Oa,[a[3]||(a[3]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Email",-1)),e("div",Na,[e("p",Ma,c(((u=t.task.customer)==null?void 0:u.email)||"N/A"),1),(k=t.task.customer)!=null&&k.email?(n(),i("button",{key:0,onClick:a[0]||(a[0]=X(C=>s(t.task.customer.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy email"},[h(y(Je),{size:12})])):f("",!0)])]),e("div",La,[a[4]||(a[4]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Phone",-1)),e("div",ja,[e("p",Va,c(((q=t.task.customer)==null?void 0:q.phone)||"N/A"),1),(T=t.task.customer)!=null&&T.phone?(n(),i("button",{key:0,onClick:a[1]||(a[1]=X(C=>s(t.task.customer.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy phone"},[h(y(Je),{size:12})])):f("",!0)])]),(A=t.task.customer)!=null&&A.address?(n(),i("div",Fa,[a[5]||(a[5]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Address",-1)),e("p",Ba,c(t.task.customer.address),1)])):f("",!0)]),m.value>0?(n(),i("div",Ua,[h(y(At),{size:16,class:"text-blue-600 shrink-0"}),e("p",Wa,c(m.value)+" other negotiation"+c(m.value>1?"s":"")+" active ",1)])):f("",!0)])}}},Ra=vt(Pa,[["__scopeId","data-v-ac925766"]]),za={key:0,class:"flex-grow border-t border"},Qa={key:0,class:"ml-1.5 text-body"},Ha={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Ya={key:1,class:"flex-grow border-t border"},Ka={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:o}){const l=t,r=o,m=I(!1),s={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},b=$(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(C=>!s[C]);const A=Object.entries(s).filter(([,C])=>C===l.activeTab).map(([C])=>C);return l.actions.filter(C=>A.includes(C))}),p=$(()=>l.activeTab==="communication"?!0:b.value.length===1),a=$(()=>{if(l.activeTab==="communication")return"add communication";if(!p.value||b.value.length!==1)return"";const A=b.value[0];return{note:"add note",attachment:"add attachment"}[A]||""}),d=$(()=>l.activeTab==="communication"?!1:b.value.length>1),u=$(()=>{const A={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return b.value.map(C=>({key:C,label:A[C]||C,onClick:()=>q(C)}))}),k=$(()=>{if(l.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const A="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return p.value?`${A} px-4 py-2 h-9`:`${A} w-9 h-9`});$(()=>b.value.some(A=>["email","whatsapp","sms"].includes(A))),$(()=>b.value.some(A=>["addVehicle","configureVehicle"].includes(A))),$(()=>b.value.some(A=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(A)));const q=A=>{m.value=!1,r("action",A)},T=()=>{if(l.activeTab==="communication"){q("call");return}p.value&&b.value.length===1?q(b.value[0]):m.value=!m.value};return(A,C)=>{const D=Ue("click-outside");return t.show?(n(),i("div",{key:0,class:M(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?f("",!0):(n(),i("div",za)),e("div",{class:M(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:X(T,["stop"]),class:M(k.value)},[C[0]||(C[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),p.value?(n(),i("span",Qa,c(a.value),1)):f("",!0)],2),m.value&&d.value?O((n(),i("div",Ha,[h(y(We),{items:u.value,className:"w-48"},null,8,["items"])])),[[D,()=>m.value=!1]]):f("",!0)],2),t.inline?f("",!0):(n(),i("div",Ya))],2)):f("",!0)}}},Ga={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Ja={class:"flex items-start gap-3"},Xa={class:"flex-1 min-w-0"},Za={class:"font-bold text-sm text-heading mb-2"},_a={class:"space-y-1.5 text-xs text-gray-600"},en={class:"flex items-center gap-2"},tn={class:"flex items-center gap-2"},sn={class:"flex items-center gap-2"},an={key:0,class:"mt-2"},nn={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const o=t,l=$(()=>o.appointmentData.date?new Date(o.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),r=$(()=>o.appointmentData.time?o.appointmentData.time:""),m=s=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[s==null?void 0:s.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(s,b)=>(n(),i("div",Ga,[e("div",Ja,[b[3]||(b[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Xa,[e("h4",Za,c(t.appointmentData.type),1),e("div",_a,[e("div",en,[b[0]||(b[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,c(l.value),1)]),e("div",tn,[b[1]||(b[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,c(r.value),1)]),e("div",sn,[b[2]||(b[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,c(t.appointmentData.assignee),1)])]),t.appointmentData.status?(n(),i("div",an,[e("span",{class:M(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",m(t.appointmentData.status)])},c(t.appointmentData.status),3)])):f("",!0)])])]))}},ln={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},on={class:"flex-1"},rn={class:"flex items-center gap-2 mb-1"},dn={class:"text-meta-bold text-heading"},un={class:"text-meta"},cn={class:"text-meta"},mn={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},fn={class:"ml-auto relative"},pn={key:0,class:"absolute right-0 top-full mt-1 z-10"},bn={key:0,class:"text-content text-body"},yn={key:1,class:"text-content text-body flex items-center gap-2"},vn={key:2,class:"mt-2"},gn={key:0},xn={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},hn={key:0},kn={class:"text-content font-bold text-heading"},wn={key:0,class:"text-meta mt-0.5"},Cn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},$n={key:0},Sn={key:1},An={key:2},Tn={key:3},Dn={key:4},En={key:1},qn={class:"text-content font-bold text-heading mb-2"},In={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},On={key:0},Nn={class:"text-body font-medium ml-1"},Mn={key:1},Ln={class:"text-body font-medium ml-1"},jn={key:2},Vn={class:"text-body font-medium ml-1"},Fn={key:3},Bn={class:"text-body font-medium ml-1"},Un={key:4},Wn={class:"text-body font-medium ml-1"},Pn={key:5},Rn={class:"text-body font-medium ml-1"},zn={key:2,class:"flex items-center gap-3"},Qn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Hn=["src"],Yn={class:"flex-1"},Kn={class:"text-content font-bold text-heading"},Gn={class:"text-meta"},Jn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Xn={key:3,class:"flex items-center gap-3"},Zn={class:"flex-1"},_n={class:"text-content font-bold text-heading"},el={class:"text-meta"},tl={key:0,class:"text-meta mt-1"},sl={key:1,class:"text-meta mt-1"},Ze={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:o}){const l=t,r=o,m=I(!1),s=$(()=>[{key:"edit",label:"Edit",onClick:k},{key:"delete",label:"Delete",onClick:q}]),b=T=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[T]||"fa-solid fa-circle",p=T=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[T]||"bg-surfaceSecondary text-body border",a=T=>{if(!T)return"Just now";const A=new Date(T),D=new Date-A,E=Math.floor(D/6e4),F=Math.floor(E/60),U=Math.floor(F/24);return E<1?"Just now":E<60?`${E} minutes ago`:F<24?`${F} hours ago`:U===1?"Yesterday":U<7?`${U} days ago`:A.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=T=>T?new Intl.NumberFormat("en-US").format(T):"0",u=T=>T?new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",k=()=>{m.value=!1,r("edit",l.item)},q=()=>{m.value=!1,confirm("Are you sure you want to delete this item?")&&r("delete",l.item)};return(T,A)=>{const C=Ue("click-outside");return n(),i("div",ln,[e("div",{class:M(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",p(t.item.type)])},[e("i",{class:M([b(t.item.type),"text-sm"])},null,2)],2),e("div",on,[e("div",rn,[e("span",dn,c(t.customerInitials),1),e("span",un,c(t.item.action||"added"),1),e("span",cn,"• "+c(a(t.item.timestamp)),1),t.item.autoDetected?(n(),i("span",mn,"Auto-detected")):f("",!0),e("div",fn,[e("button",{onClick:A[0]||(A[0]=X(D=>m.value=!m.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...A[1]||(A[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),m.value?O((n(),i("div",pn,[h(y(We),{items:s.value,className:"w-32"},null,8,["items"])])),[[C,()=>m.value=!1]]):f("",!0)])]),t.item.content?(n(),i("div",bn,c(t.item.content),1)):f("",!0),t.item.fileName?(n(),i("div",yn,[A[2]||(A[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,c(t.item.fileName),1)])):f("",!0),t.item.data?(n(),i("div",vn,[t.item.type==="appointment"?(n(),i("div",gn,[h(nn,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(n(),i("div",xn,[t.item.type==="tradein"?(n(),i("div",hn,[e("h4",kn,c(t.item.data.brand)+" "+c(t.item.data.model),1),t.item.data.version?(n(),i("p",wn,c(t.item.data.version),1)):f("",!0),e("div",Cn,[t.item.data.year?(n(),i("div",$n,[A[3]||(A[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),V(c(t.item.data.year),1)])):f("",!0),t.item.data.km?(n(),i("div",Sn,[A[4]||(A[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),V(c(t.item.data.km)+" km ",1)])):f("",!0),t.item.data.plate?(n(),i("div",An,[A[5]||(A[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),V(c(t.item.data.plate),1)])):f("",!0),t.item.data.date?(n(),i("div",Tn,[A[6]||(A[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),V(c(u(t.item.data.date)),1)])):f("",!0),t.item.data.class?(n(),i("div",Dn,[A[7]||(A[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),V(c(t.item.data.class),1)])):f("",!0)])])):t.item.type==="financing"?(n(),i("div",En,[e("h4",qn,c(t.item.data.product),1),e("div",In,[t.item.data.provider?(n(),i("div",On,[A[8]||(A[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Nn,c(t.item.data.provider),1)])):f("",!0),t.item.data.total?(n(),i("div",Mn,[A[9]||(A[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Ln,"€"+c(d(t.item.data.total)),1)])):f("",!0),t.item.data.monthly?(n(),i("div",jn,[A[10]||(A[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Vn,"€"+c(d(t.item.data.monthly)),1)])):f("",!0),t.item.data.deposit?(n(),i("div",Fn,[A[11]||(A[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Bn,"€"+c(d(t.item.data.deposit)),1)])):f("",!0),t.item.data.startDate?(n(),i("div",Un,[A[12]||(A[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Wn,c(u(t.item.data.startDate)),1)])):f("",!0),t.item.data.expDate?(n(),i("div",Pn,[A[13]||(A[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Rn,c(u(t.item.data.expDate)),1)])):f("",!0)])])):t.item.type==="offer"?(n(),i("div",zn,[t.item.data.image?(n(),i("div",Qn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Hn)])):f("",!0),e("div",Yn,[e("h4",Kn,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Gn,"€ "+c(d(t.item.data.price)),1)]),t.item.data.isMainOffer?(n(),i("span",Jn,"Main Offer")):f("",!0)])):t.item.type==="purchase"?(n(),i("div",Xn,[e("div",Zn,[e("h4",_n,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",el,"€ "+c(d(t.item.data.price)),1),t.item.data.purchaseDate?(n(),i("p",tl,"Purchased: "+c(u(t.item.data.purchaseDate)),1)):f("",!0),t.item.data.notes?(n(),i("p",sl,c(t.item.data.notes),1)):f("",!0)])])):f("",!0)]))])):f("",!0)])])}}},al={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},nl={class:"flex items-center gap-3"},ll=["title"],il={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},ol={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},rl={key:2,class:"font-bold text-fluid-lg text-heading"},dl={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},ul={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},cl={key:1,class:"text-center py-8 text-sub relative z-10"},ml={class:"text-fluid-sm"},fl={key:2,class:"space-y-6 relative z-10"},pl={key:0,class:"mb-4 pl-12"},bl={class:"text-fluid-sm font-semibold text-heading"},yl={class:"flex gap-4 relative mb-6"},vl={class:"flex-1 min-w-0"},gl={class:"text-fluid-sm text-slate-700 leading-snug"},xl={class:"font-bold"},hl={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},kl={class:"text-fluid-xs text-sub mt-1"},wl={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},Cl={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},$l={key:1,class:"space-y-4 relative z-10"},Sl=["title"],Al={key:2,class:"text-center py-8 text-sub relative z-10"},Tl={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:o}){const l=t,r=a=>{const d={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return d[a]||d.default},m=a=>{const d={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return d[a]||d.default},s=a=>{if(!a)return"";const d=new Date(a),u=new Date,k=new Date(u);return k.setDate(k.getDate()-1),d.toDateString()===u.toDateString()?"Today":d.toDateString()===k.toDateString()?"Yesterday":d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},b=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",p=(a,d)=>{if(a===0)return!0;const u=l.activities[a-1];if(!u)return!0;const k=new Date(d.timestamp).toDateString(),q=new Date(u.timestamp).toDateString();return k!==q};return(a,d)=>t.show?(n(),i("div",{key:0,class:M(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",al,[e("div",nl,[t.mobileFullscreen?(n(),i("button",{key:0,onClick:d[0]||(d[0]=u=>a.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(n(),i("button",{key:1,onClick:d[1]||(d[1]=u=>a.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(n(),i("i",il)):(n(),i("i",ol))],8,ll)):f("",!0),t.collapsed?f("",!0):(n(),i("h2",rl,c(t.title),1))])]),t.collapsed?(n(),i("div",wl,[t.activities.length>0?(n(),i("div",Cl)):f("",!0),t.activities.length>0?(n(),i("div",$l,[(n(!0),i(P,null,R(t.activities,u=>(n(),i("div",{key:u.id,class:"relative"},[e("div",{class:M(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",m(u.type)]),title:`${u.user} ${u.action}`},[e("i",{class:M([r(u.type),"text-fluid-xs"])},null,2)],10,Sl)]))),128))])):(n(),i("div",Al,[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(n(),i("div",dl,[t.activities.length>0?(n(),i("div",ul)):f("",!0),t.activities.length===0?(n(),i("div",cl,[d[3]||(d[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",ml,c(t.emptyMessage),1)])):(n(),i("div",fl,[(n(!0),i(P,null,R(t.activities,(u,k)=>(n(),i(P,{key:u.id},[p(k,u)?(n(),i("div",pl,[e("h3",bl,c(s(u.timestamp)),1)])):f("",!0),e("div",yl,[e("div",{class:M(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",m(u.type)])},[e("i",{class:M([r(u.type),"text-fluid-sm"])},null,2)],2),e("div",vl,[e("div",gl,[e("span",xl,c(u.user),1),V(" "+c(u.action),1)]),u.content?(n(),i("div",hl,c(u.content),1)):f("",!0),e("div",kl,c(b(u.timestamp)),1)])])],64))),128))]))]))],2)):f("",!0)}},Dl={class:"space-y-3"},El={class:"flex justify-end gap-2"},_e={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,r=o,m=I(l.initialTemplate),s=I(""),b=I(l.initialMessage),p={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},a=()=>{m.value&&p[m.value]&&(s.value=p[m.value].subject,b.value=p[m.value].message)},d=()=>{b.value.trim()&&r("send",{type:"email",template:m.value,subject:s.value,message:b.value})};return(u,k)=>(n(),i("div",Dl,[e("div",null,[k[5]||(k[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),O(e("select",{"onUpdate:modelValue":k[0]||(k[0]=q=>m.value=q),onChange:a,class:"input"},[...k[4]||(k[4]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[k[6]||(k[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),O(e("input",{"onUpdate:modelValue":k[1]||(k[1]=q=>s.value=q),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[j,s.value]])]),e("div",null,[k[7]||(k[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),O(e("textarea",{"onUpdate:modelValue":k[2]||(k[2]=q=>b.value=q),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[j,b.value]])]),e("div",El,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:k[3]||(k[3]=q=>u.$emit("cancel"))}),h(y(B),{label:"Send Email",variant:"primary",size:"small",onClick:d})])]))}},ql={class:"space-y-3"},Il={class:"text-fluid-xs text-sub mt-1"},Ol={class:"flex justify-end gap-2"},et={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,r=o,m=I(l.initialTemplate),s=I(l.initialMessage),b={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},p=()=>{m.value&&b[m.value]&&(s.value=b[m.value])},a=()=>{s.value.trim()&&r("send",{type:"sms",template:m.value,message:s.value})};return(d,u)=>(n(),i("div",ql,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),O(e("select",{"onUpdate:modelValue":u[0]||(u[0]=k=>m.value=k),onChange:p,class:"input"},[...u[3]||(u[3]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),O(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=k=>s.value=k),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[j,s.value]]),e("p",Il,c(s.value.length)+"/160 characters",1)]),e("div",Ol,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:u[2]||(u[2]=k=>d.$emit("cancel"))}),h(y(B),{label:"Send SMS",variant:"primary",size:"small",onClick:a})])]))}},Nl={class:"space-y-3"},Ml={class:"flex justify-end gap-2"},tt={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,r=o,m=I(l.initialTemplate),s=I(l.initialMessage),b={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},p=()=>{m.value&&b[m.value]&&(s.value=b[m.value])},a=()=>{s.value.trim()&&r("send",{type:"whatsapp",template:m.value,message:s.value})};return(d,u)=>(n(),i("div",Nl,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),O(e("select",{"onUpdate:modelValue":u[0]||(u[0]=k=>m.value=k),onChange:p,class:"input"},[...u[3]||(u[3]=[ve('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[ge,m.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),O(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=k=>s.value=k),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[j,s.value]])]),e("div",Ml,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:u[2]||(u[2]=k=>d.$emit("cancel"))}),h(y(B),{label:"Send WhatsApp",variant:"primary",size:"small",onClick:a})])]))}},Ll={class:"space-y-3"},jl={class:"space-y-2"},Vl={class:"flex-1"},Fl={class:"text-xs text-sub uppercase"},Bl={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},st={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:o}){const l=t,r=o,m=I(""),s=b=>{b==="copy"&&navigator.clipboard.writeText(l.phoneNumber),r("call",{type:"call",option:b,phoneNumber:l.phoneNumber,notes:m.value})};return(b,p)=>(n(),i("div",Ll,[e("div",jl,[p[10]||(p[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:p[0]||(p[0]=a=>s("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...p[5]||(p[5]=[ve('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:p[1]||(p[1]=a=>s("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...p[6]||(p[6]=[ve('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:p[2]||(p[2]=a=>s("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[p[8]||(p[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Vl,[p[7]||(p[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",Fl,c(t.phoneNumber),1)]),p[9]||(p[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[p[11]||(p[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),O(e("textarea",{"onUpdate:modelValue":p[3]||(p[3]=a=>m.value=a),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[j,m.value]])]),e("div",Bl,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:p[4]||(p[4]=a=>b.$emit("cancel"))})])]))}},Ul={key:0,class:"space-y-4"},Wl={class:"grid grid-cols-4 gap-2"},Pl=["onClick"],Rl={class:"text-xs font-bold uppercase tracking-wider"},zl={key:1,class:"space-y-4"},Ql={class:"grid grid-cols-4 gap-2"},Hl=["onClick"],Yl={class:"text-xs font-bold uppercase tracking-wider"},Kl={key:0},at={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:o}){const l=t,r=o,m=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],s=I(l.type);ie(()=>l.type,u=>{u?s.value=u:s.value=null}),ie(()=>l.taskId,()=>{s.value=null});const b=$(()=>u=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${s.value===u?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),p=u=>{r("save",{type:"communication",action:`sent via ${u.type}`,content:u.message,communicationType:u.type,template:u.template,subject:u.subject}),r("send",u)},a=u=>{r("save",{type:"communication",action:`called via ${u.option}`,content:u.notes||"Call attempt logged",communicationType:"call",callOption:u.option}),r("send",{type:"call",option:u.option,phoneNumber:u.phoneNumber,notes:u.notes})},d=()=>{s.value=null,r("cancel")};return(u,k)=>t.inline?(n(),i("div",zl,[e("div",Ql,[(n(),i(P,null,R(m,q=>e("button",{key:q.id,onClick:T=>s.value=q.id,class:M(b.value(q.id))},[e("i",{class:M([q.icon,"text-sm"])},null,2),e("span",Yl,c(q.label),1)],10,Hl)),64))]),s.value?(n(),i("div",Kl,[s.value==="email"?(n(),L(_e,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="sms"?(n(),L(et,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="whatsapp"?(n(),L(tt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="call"?(n(),L(st,{key:3,"phone-number":t.phoneNumber,onCall:a,onCancel:d},null,8,["phone-number"])):f("",!0)])):f("",!0)])):(n(),i("div",Ul,[e("div",Wl,[(n(),i(P,null,R(m,q=>e("button",{key:q.id,onClick:T=>s.value=q.id,class:M(b.value(q.id))},[e("i",{class:M([q.icon,"text-sm"])},null,2),e("span",Rl,c(q.label),1)],10,Pl)),64))]),e("div",null,[s.value==="email"?(n(),L(_e,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="sms"?(n(),L(et,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="whatsapp"?(n(),L(tt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:p,onCancel:d},null,8,["initial-template","initial-message"])):s.value==="call"?(n(),L(st,{key:3,"phone-number":t.phoneNumber,onCall:a,onCancel:d},null,8,["phone-number"])):f("",!0)])]))}},Gl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Jl={key:1,class:"flex justify-between items-center mb-4"},Xl={class:"text-fluid-sm font-semibold text-heading"},Zl={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},_l={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const r=t,m=l,s=I("");xe(()=>{r.item&&(s.value=r.item.content||"")});const b=()=>{var p,a;s.value.trim()&&m("save",{id:((p=r.item)==null?void 0:p.id)||Date.now(),type:"note",action:r.item?"updated a note":"added a note",content:s.value,timestamp:((a=r.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return o({submit:b,canSubmit:()=>!!s.value.trim()}),(p,a)=>(n(),i("div",{class:M(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?f("",!0):(n(),i("div",Gl)),t.hideHeader?f("",!0):(n(),i("div",Jl,[e("h5",Xl,c(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:a[0]||(a[0]=d=>p.$emit("cancel")),class:"text-sub hover:text-body"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),O(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=d=>s.value=d),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[j,s.value]])]),t.hideActions?f("",!0):(n(),i("div",Zl,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=d=>p.$emit("cancel"))}),h(y(B),{label:"Save",variant:"primary",size:"small",onClick:b})]))],2))}},ei={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},ti={class:"flex justify-between items-center mb-4"},si={class:"text-fluid-sm font-semibold text-heading"},ai={class:"flex items-center gap-3"},ni={key:0,class:"text-fluid-sm text-slate-600"},li={key:1,class:"text-fluid-sm text-sub"},ii={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},oi={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:o}){const l=t,r=o,m=I(null),s=I("");xe(()=>{l.item&&(s.value=l.item.fileName||"")});const b=a=>{const d=a.target.files[0];d&&(m.value=d,s.value=d.name)},p=()=>{var a,d;!m.value&&!l.item||r("save",{id:((a=l.item)==null?void 0:a.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:s.value,timestamp:((d=l.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return(a,d)=>(n(),i("div",ei,[d[5]||(d[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",ti,[e("h5",si,c(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:d[0]||(d[0]=u=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",ai,[e("input",{type:"file",onChange:b,ref:"fileInput",class:"hidden"},null,544),h(y(B),{label:"Choose File",variant:"outline",size:"small",onClick:d[1]||(d[1]=u=>a.$refs.fileInput.click())}),s.value?(n(),i("span",ni,c(s.value),1)):(n(),i("span",li,"No file selected"))])]),e("div",ii,[h(y(B),{label:"Cancel",variant:"outline",size:"small",onClick:d[2]||(d[2]=u=>a.$emit("cancel"))}),h(y(B),{label:"Save",variant:"primary",size:"small",disabled:!m.value,onClick:p},null,8,["disabled"])])]))}},ri={class:"animate-fade-in"},di={class:"space-y-4"},ui={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ci={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},mi={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},fi=["disabled"],pi={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const r=t,m=l,s=I({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});xe(()=>{r.item&&r.item.data&&(s.value={startDate:r.item.data.startDate||"",expDate:r.item.data.expDate||"",productName:r.item.data.product||r.item.data.productName||"",deposit:r.item.data.deposit||"",loanAmount:r.item.data.total||r.item.data.loanAmount||""})});const b=()=>{var p,a;s.value.productName&&m("save",{id:((p=r.item)==null?void 0:p.id)||Date.now(),type:"financing",action:r.item?"updated a financing proposal":"added a financing proposal",data:{product:s.value.productName,provider:"Audi Financial",total:s.value.loanAmount||"0",monthly:Math.round(parseFloat(s.value.loanAmount||0)/36).toString(),startDate:s.value.startDate,expDate:s.value.expDate,deposit:s.value.deposit},timestamp:((a=r.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return o({submit:b,isValid:$(()=>!!s.value.productName)}),(p,a)=>(n(),i("div",ri,[e("div",di,[e("div",ui,[e("div",null,[a[6]||(a[6]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),O(e("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=d=>s.value.startDate=d),class:"input"},null,512),[[j,s.value.startDate]])]),e("div",null,[a[7]||(a[7]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),O(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=d=>s.value.expDate=d),class:"input"},null,512),[[j,s.value.expDate]])])]),e("div",null,[a[8]||(a[8]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),O(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=d=>s.value.productName=d),class:"input"},null,512),[[j,s.value.productName]])]),e("div",ci,[e("div",null,[a[9]||(a[9]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),O(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=d=>s.value.deposit=d),class:"input"},null,512),[[j,s.value.deposit]])]),e("div",null,[a[10]||(a[10]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),O(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=d=>s.value.loanAmount=d),class:"input"},null,512),[[j,s.value.loanAmount]])])])]),t.hideActions?f("",!0):(n(),i("div",mi,[e("button",{onClick:a[5]||(a[5]=d=>p.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!s.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,fi)]))]))}},bi={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:o}){const l=o,r=I(null),m=$(()=>{var a;return((a=r.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=r.value)==null||a.submit()},b=a=>{a||l("close")},p=a=>{l("save",a),l("close")};return(a,d)=>(n(),L(y(Ae),{open:t.show,"onUpdate:open":b},{default:N(()=>[h(y(he),null,{default:N(()=>[h(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),h(y(we),{class:"w-full sm:max-w-lg"},{default:N(()=>[h(y(Ce),null,{default:N(()=>[h(y($e),null,{default:N(()=>[...d[2]||(d[2]=[V("Add Financing",-1)])]),_:1}),h(y(Pe),null,{default:N(()=>[...d[3]||(d[3]=[V("Record financing details for this customer",-1)])]),_:1})]),_:1}),h(pi,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:p,onCancel:d[0]||(d[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id"]),h(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[h(y(B),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[1]||(d[1]=u=>a.$emit("close"))}),h(y(B),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},yi={class:"animate-fade-in"},vi={class:"space-y-4"},gi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},hi={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ki=["disabled"],wi={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const r=t,m=l,s=I({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});xe(()=>{r.item&&r.item.data&&(s.value={class:r.item.data.class||"Car",brand:r.item.data.brand||"",model:r.item.data.model||"",version:r.item.data.version||"",km:r.item.data.km||"",plate:r.item.data.plate||"",date:r.item.data.date||""})});const b=()=>{var p,a;s.value.brand&&m("save",{id:((p=r.item)==null?void 0:p.id)||Date.now(),type:"tradein",action:r.item?"updated a trade-in":"added a trade-in",data:{class:s.value.class,brand:s.value.brand,model:s.value.model||"Unknown Model",year:s.value.date?new Date(s.value.date).getFullYear():"Unknown Year",km:s.value.km||"0",plate:s.value.plate||"",date:s.value.date||""},timestamp:((a=r.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return o({submit:b,isValid:$(()=>!!s.value.brand)}),(p,a)=>(n(),i("div",yi,[e("div",vi,[e("div",null,[a[9]||(a[9]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Class",-1)),O(e("select",{"onUpdate:modelValue":a[0]||(a[0]=d=>s.value.class=d),class:"input"},[...a[8]||(a[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[ge,s.value.class]])]),e("div",gi,[e("div",null,[a[10]||(a[10]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Brand",-1)),O(e("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=d=>s.value.brand=d),class:"input"},null,512),[[j,s.value.brand]])]),e("div",null,[a[11]||(a[11]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Model",-1)),O(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=d=>s.value.model=d),class:"input"},null,512),[[j,s.value.model]])])]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Version",-1)),O(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=d=>s.value.version=d),class:"input"},null,512),[[j,s.value.version]])]),e("div",xi,[e("div",null,[a[13]||(a[13]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Km",-1)),O(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=d=>s.value.km=d),class:"input"},null,512),[[j,s.value.km]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Plate",-1)),O(e("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=d=>s.value.plate=d),class:"input"},null,512),[[j,s.value.plate]])])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),O(e("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=d=>s.value.date=d),class:"input"},null,512),[[j,s.value.date]])])]),t.hideActions?f("",!0):(n(),i("div",hi,[e("button",{onClick:a[7]||(a[7]=d=>p.$emit("cancel")),class:"text-fluid-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!s.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-fluid-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ki)]))]))}},Ci={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:o}){const l=o,r=I(null),m=$(()=>{var a;return((a=r.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=r.value)==null||a.submit()},b=a=>{a||l("close")},p=a=>{l("save",a),l("close")};return(a,d)=>(n(),L(y(Ae),{open:t.show,"onUpdate:open":b},{default:N(()=>[h(y(he),null,{default:N(()=>[h(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),h(y(we),{class:"w-full sm:max-w-lg"},{default:N(()=>[h(y(Ce),null,{default:N(()=>[h(y($e),null,{default:N(()=>[...d[2]||(d[2]=[V("Add Trade-In Vehicle",-1)])]),_:1}),h(y(Pe),null,{default:N(()=>[...d[3]||(d[3]=[V("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),h(wi,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:p,onCancel:d[0]||(d[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id"]),h(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[h(y(B),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[1]||(d[1]=u=>a.$emit("close"))}),h(y(B),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$i={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Si={key:0,class:"flex justify-between items-center mb-4"},Ai={class:"text-sm font-bold text-heading"},Ti={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},Di={class:"flex items-center gap-3"},Ei={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},qi=["src"],Ii={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Oi={class:"font-bold text-sm text-heading"},Ni={class:"text-xs text-sub"},Mi={class:"space-y-4"},Li={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ji={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Vi=["disabled"],Fi={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const r=t,m=l,s=I({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});xe(()=>{if(r.selectedVehicle){s.value.price=r.selectedVehicle.price||0,s.value.brand=r.selectedVehicle.brand||"",s.value.model=r.selectedVehicle.model||"",s.value.year=r.selectedVehicle.year||"",s.value.image=r.selectedVehicle.image||"";const d=new Date;d.setDate(d.getDate()+30),s.value.validUntil=d.toISOString().split("T")[0]}r.item&&r.item.data&&(s.value={...s.value,...r.item.data,price:r.item.data.price||r.item.data.total||0,financingType:r.item.data.financingType||r.item.data.paymentMethod||"",notes:r.item.data.notes||r.item.data.description||""})}),ie(()=>r.selectedVehicle,d=>{d&&!r.item&&(s.value.price=d.price||0,s.value.brand=d.brand||"",s.value.model=d.model||"",s.value.year=d.year||"",s.value.image=d.image||"")});const b=$(()=>s.value.price>0&&s.value.financingType!==""),p=d=>d?d.toLocaleString("en-US"):"0",a=()=>{var u,k;if(!b.value)return;const d={id:((u=r.item)==null?void 0:u.id)||Date.now(),type:"offer",action:r.item?"updated an offer":"created an offer",data:{brand:s.value.brand,model:s.value.model,year:s.value.year,price:s.value.price,total:s.value.price,paymentMethod:s.value.financingType,financingType:s.value.financingType,downPayment:s.value.downPayment,monthlyPayment:s.value.monthlyPayment,term:s.value.term,interestRate:s.value.interestRate,deliveryDate:s.value.deliveryDate,validUntil:s.value.validUntil,notes:s.value.notes,description:s.value.notes,image:s.value.image},timestamp:((k=r.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!r.item};m("save",d)};return o({submit:a,isValid:b,offerData:s}),(d,u)=>(n(),i("div",$i,[t.hideHeader?f("",!0):(n(),i("div",Si,[e("h5",Ai,c(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:u[0]||(u[0]=k=>d.$emit("cancel")),class:"text-sub hover:text-body"},[...u[11]||(u[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(n(),i("div",Ti,[u[12]||(u[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",Di,[e("div",Ei,[t.selectedVehicle.image?(n(),i("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,qi)):(n(),i("i",Ii))]),e("div",null,[e("h4",Oi,c(t.selectedVehicle.brand)+" "+c(t.selectedVehicle.model)+" ("+c(t.selectedVehicle.year)+") ",1),e("p",Ni,"Base Price: € "+c(p(t.selectedVehicle.price)),1)])])])):f("",!0),e("div",Mi,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[V(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),O(e("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=k=>s.value.price=k),class:"input",placeholder:"Enter offer price"},null,512),[[j,s.value.price]])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[V(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),O(e("select",{"onUpdate:modelValue":u[2]||(u[2]=k=>s.value.financingType=k),class:"input"},[...u[14]||(u[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[ge,s.value.financingType]])]),s.value.financingType==="finance"||s.value.financingType==="lease"?(n(),i("div",Li,[e("div",null,[u[16]||(u[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=k=>s.value.downPayment=k),class:"input",placeholder:"0"},null,512),[[j,s.value.downPayment]])]),e("div",null,[u[17]||(u[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),O(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=k=>s.value.monthlyPayment=k),class:"input",placeholder:"Calculated automatically"},null,512),[[j,s.value.monthlyPayment]])]),e("div",null,[u[18]||(u[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),O(e("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=k=>s.value.term=k),class:"input",placeholder:"36"},null,512),[[j,s.value.term]])]),e("div",null,[u[19]||(u[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),O(e("input",{type:"number",step:"0.1","onUpdate:modelValue":u[6]||(u[6]=k=>s.value.interestRate=k),class:"input",placeholder:"3.5"},null,512),[[j,s.value.interestRate]])])])):f("",!0),e("div",null,[u[20]||(u[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),O(e("input",{type:"date","onUpdate:modelValue":u[7]||(u[7]=k=>s.value.deliveryDate=k),class:"input"},null,512),[[j,s.value.deliveryDate]])]),e("div",null,[u[21]||(u[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),O(e("input",{type:"date","onUpdate:modelValue":u[8]||(u[8]=k=>s.value.validUntil=k),class:"input"},null,512),[[j,s.value.validUntil]])]),e("div",null,[u[22]||(u[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),O(e("textarea",{"onUpdate:modelValue":u[9]||(u[9]=k=>s.value.notes=k),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[j,s.value.notes]])])]),t.hideActions?f("",!0):(n(),i("div",ji,[e("button",{onClick:u[10]||(u[10]=k=>d.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:a,disabled:!b.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},c(t.item?"Update Offer":"Create Offer"),9,Vi)]))]))}},Bi={class:"p-6"},Ui={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:o}){const l=o,r=I(null),m=$(()=>{var a;return((a=r.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=r.value)==null||a.submit()},b=a=>{a||l("close")},p=a=>{l("save",a),l("close")};return(a,d)=>(n(),L(y(Ae),{open:t.show,"onUpdate:open":b},{default:N(()=>[h(y(he),null,{default:N(()=>[h(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),h(y(we),{class:"w-full sm:max-w-2xl p-0"},{default:N(()=>[h(y(Ce),{class:"p-6 pb-4 border-b border"},{default:N(()=>[h(y($e),null,{default:N(()=>[...d[2]||(d[2]=[V("Create Offer",-1)])]),_:1}),h(y(Pe),null,{default:N(()=>[...d[3]||(d[3]=[V("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Bi,[h(Fi,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:p,onCancel:d[0]||(d[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),h(y(Se),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:N(()=>[h(y(B),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[1]||(d[1]=u=>a.$emit("close"))}),h(y(B),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:s},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Wi={class:"space-y-4"},Pi={key:0},Ri={class:"flex flex-wrap gap-2"},zi=["onClick"],Qi={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:o}){const l=t,r=o,m=I(""),s=p=>{p||r("close")};ie(()=>l.show,p=>{p&&(m.value="")});const b=()=>{const p=m.value.trim();p&&(l.existingTags.includes(p)||(r("add",p),m.value=""))};return(p,a)=>(n(),L(y(Ae),{open:t.show,"onUpdate:open":s},{default:N(()=>[h(y(he),null,{default:N(()=>[h(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),h(y(we),{class:"w-full sm:max-w-md"},{default:N(()=>[h(y(Ce),null,{default:N(()=>[h(y($e),null,{default:N(()=>[...a[2]||(a[2]=[V("Add Tag",-1)])]),_:1})]),_:1}),e("div",Wi,[e("div",null,[a[3]||(a[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),O(e("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>m.value=d),onKeyup:gt(b,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[j,m.value]])]),t.existingTags.length>0?(n(),i("div",Pi,[a[4]||(a[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Ri,[(n(!0),i(P,null,R(t.existingTags,d=>(n(),i("button",{key:d,onClick:u=>m.value=d,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},c(d),9,zi))),128))])])):f("",!0)]),h(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[h(y(B),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=d=>p.$emit("close"))}),h(y(B),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value.trim(),onClick:b},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},je={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Hi(t){if(!t)return je.default;const o=t.toLowerCase().trim();return je[o]||je.default}function Yi({store:t,taskId:o,getTabForItemType:l,isOverviewModalAction:r}){const m=I(null),s=I(null),b=I("overview"),p=I(null),a=I([]);ie(b,()=>{m.value=null,s.value=null});const d=$(()=>[...t.currentActivities.value,...a.value.filter(D=>!D.activityId)].filter(D=>{const E=l(D.type);return b.value==="overview"?E==="overview":E===b.value}).sort((D,E)=>{const F=new Date(D.timestamp||0);return new Date(E.timestamp||0)-F})),u=C=>(s.value=null,b.value==="overview"&&r&&r(C)?{type:"overview-modal",action:C}:(["email","sms","whatsapp","call"].includes(C)?(p.value=C,m.value="communication"):m.value=C,null)),k=async C=>{var D;if(C.isEdit){const E=a.value.findIndex(F=>F.id===C.id);E>-1&&(a.value[E]={...a.value[E],...C}),(D=s.value)!=null&&D.activityId&&await t.updateActivity(o.value,s.value.activityId,{type:C.communicationType||C.type,user:"You",action:C.action,content:C.content,fileName:C.fileName,data:C.data})}else{const E=C.communicationType||C.type,F=await t.addActivity(o.value,{type:E,user:"You",action:C.action,content:C.content,fileName:C.fileName,data:C.data});a.value.push({id:F.id,type:E==="email"||E==="whatsapp"||E==="sms"?"communication":E,action:C.action,content:C.content,fileName:C.fileName,data:C.data,timestamp:F.timestamp,activityId:F.id})}m.value=null,s.value=null},q=()=>{m.value=null,s.value=null},T=C=>{l(C.type)&&(m.value=C.type==="email"||C.type==="whatsapp"||C.type==="sms"||C.type==="communication"?"communication":C.type,s.value=C)},A=async C=>{try{await t.deleteActivity(o.value,C)}catch(D){throw console.error("Error deleting item:",D),D}};return{activeTab:b,showInlineWidget:m,inlineWidgetType:$(()=>m.value),editingItem:s,isEditing:$(()=>s.value!==null),communicationType:p,inlineContent:a,filteredInlineContent:d,handleAddNewAction:u,handleWidgetSave:k,handleWidgetCancel:q,handleEditItem:T,handleDeleteItem:A}}const Ki={class:"flex-1 flex flex-col overflow-hidden h-full"},Gi={class:"bg-surface border-b border-black/5 shrink-0"},Ji={key:0},Xi={key:0,class:"flex-1 flex flex-row overflow-hidden"},Zi={class:"flex-1 flex flex-col overflow-hidden min-w-0"},_i={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},eo={class:"mb-4"},to={key:0},so={key:0},ao={key:1,class:"mb-6"},no={key:2,class:"space-y-4 mb-6 px-1"},lo={key:1},io={key:0,class:"space-y-4 mb-6 px-1"},oo={key:1,class:"flex-1 flex flex-row overflow-hidden"},ro={class:"flex-1 flex flex-col overflow-hidden min-w-0"},uo={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},co={key:0,class:"space-y-6"},mo={key:0},fo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},po={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},bo={key:0,class:"mt-6 pt-6 border-t border"},yo={class:"space-y-2 max-h-52 overflow-y-auto"},vo={class:"flex items-center gap-2 mb-1"},go={class:"text-fluid-xs font-semibold text-heading"},xo={class:"text-fluid-xs text-sub"},ho={class:"text-fluid-sm text-body"},ko={key:1,class:"space-y-6"},wo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Co={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},$o={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},So={class:"relative"},Ao={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},To={key:1,class:"text-center py-6 text-sub"},Do={key:2,class:"space-y-6 max-h-96 overflow-y-auto pr-2"},Eo={class:"flex-1 min-w-0"},qo={class:"text-fluid-sm text-slate-700 leading-snug"},Io={class:"font-bold"},Oo={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},No={class:"text-fluid-xs text-sub mt-1"},Mo={key:2,class:"space-y-6"},Lo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},jo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Vo={class:"space-y-2 max-h-80 overflow-y-auto"},Fo={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Bo={class:"text-fluid-xs text-sub mb-1"},Uo={class:"text-fluid-sm text-body"},Wo={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Po={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ro={class:"space-y-2 max-h-80 overflow-y-auto"},zo={key:0,class:"text-center py-6 text-sub text-fluid-sm"},Qo={class:"flex-1 min-w-0"},Ho={class:"text-fluid-sm font-medium text-heading truncate"},Yo={class:"text-fluid-xs text-sub"},Ko={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Go={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Jo={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Xo={class:"space-y-2 max-h-80 overflow-y-auto"},Zo={key:0,class:"text-center py-6 text-sub text-fluid-sm"},_o={class:"flex items-center justify-between mb-1"},er={class:"text-fluid-xs text-sub"},tr={key:0,class:"text-fluid-sm font-medium text-heading"},sr={key:0},ar={key:1,class:"grid grid-cols-2 gap-2 mt-2 text-fluid-xs text-body"},nr={key:0},lr={key:1},ir={key:2,class:"text-fluid-sm text-body mt-2"},or={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},rr={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},dr={class:"space-y-2 max-h-80 overflow-y-auto"},ur={key:0,class:"text-center py-6 text-sub text-fluid-sm"},cr={class:"flex items-center justify-between mb-1"},mr={class:"text-fluid-xs text-sub"},fr={key:0,class:"text-fluid-sm font-medium text-heading"},pr={key:0},br={key:1,class:"text-fluid-sm text-body mt-1"},yr={key:2,class:"text-fluid-sm text-body mt-2"},wr={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated"],setup(t,{emit:o}){const l=t,r=o,m=xt(),s=Be(),b=$t(),p=$(()=>l.task.id),a=$(()=>m.path.startsWith("/tasks")&&!m.path.startsWith("/customer")),d=I("manage"),u=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Data"}],k=I(!1),q=$(()=>l.task.activities?l.task.activities.filter(S=>S.type==="note"):[]),T=$(()=>l.task.activities?l.task.activities.filter(S=>["email","call","sms","whatsapp"].includes(S.type)):[]),A=$(()=>l.task.activities?l.task.activities.filter(S=>S.type==="attachment"):[]),C=$(()=>l.task.activities?l.task.activities.filter(S=>S.type==="purchase"):[]),D=$(()=>l.task.activities?l.task.activities.filter(S=>S.type==="tradein"):[]),E=()=>{z.value="purchase",G.value=!0},F=()=>{z.value="tradein",G.value=!0},U=S=>{if(!S)return"";const v=new Date(S),W=new Date-v,H=Math.floor(W/6e4),K=Math.floor(W/36e5),ee=Math.floor(W/864e5);return H<1?"Just now":H<60?`${H}m ago`:K<24?`${K}h ago`:ee<7?`${ee}d ago`:v.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},re=S=>S?new Intl.NumberFormat("en-US").format(S):"0",Te=S=>S?new Intl.NumberFormat("en-US").format(S):"0",Oe=async S=>{await l.storeAdapter.addActivity(l.task.id,{type:S.communicationType||S.type,content:S.content||S.message||"Communication logged",subject:S.subject,template:S.template,timestamp:new Date().toISOString()}),k.value=!1},fe=$(()=>l.type==="contact"?"bg-blue-100 text-blue-600":l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),_=I(m.path.startsWith("/tasks")&&!m.path.startsWith("/customer"));ie(()=>m.path,S=>{_.value=S.startsWith("/tasks")&&!S.startsWith("/customer")});const pe=()=>{s.push({path:`/customer/${l.task.id}`,query:{type:l.type}})};function be(S){se.value=!1}const de=()=>{ue.value=!0},ye=async S=>{var Q,W,H,K;const v=S.name;l.type==="lead"?await((W=(Q=l.storeAdapter).updateLead)==null?void 0:W.call(Q,l.task.id,{assignee:v,assigneeType:S.type,teamId:S.type==="team"?S.id:null})):l.type==="opportunity"&&await((K=(H=l.storeAdapter).updateOpportunity)==null?void 0:K.call(H,l.task.id,{assignee:v,assigneeType:S.type,teamId:S.type==="team"?S.id:null})),ue.value=!1},G=I(!1),z=I(null),se=I(!1),ue=I(!1),w=I(!1),{activeTab:g,showInlineWidget:J,editingItem:ae,communicationType:rt,inlineContent:dt,filteredInlineContent:De,handleAddNewAction:ut,handleWidgetSave:Ee,handleWidgetCancel:Ne,handleEditItem:ze,handleDeleteItem:Qe}=Yi({store:l.storeAdapter,taskId:p,getTabForItemType:Hi,isOverviewModalAction:S=>g.value==="overview"&&l.addNewConfig.overviewActions.includes(S)});ie(()=>l.task.id,()=>{g.value="overview"});const Me=S=>{const v=ut(S);v&&v.modalAction&&(z.value=v.modalAction,G.value=!0)},He=S=>{if(S==="appointment"){se.value=!0;return}const v={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(S))z.value=S,G.value=!0;else{const Q=v[S];Q?(g.value=Q,setTimeout(()=>{Me(S),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Me(S)}},qe=()=>{G.value=!1,z.value=null},Le=async S=>{await Ee(S),qe()},ct=$(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Notes"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),ce=$(()=>[...l.storeAdapter.currentActivities.value,...dt.value]);$(()=>z.value==="financing"?"Add Financing":z.value==="tradein"?"Add Trade-in":z.value==="purchase"?"Create Purchase Offer":"");const Ye=async S=>{if(l.type==="opportunity")try{await l.storeAdapter.addVehicle(l.task.id,S.vehicleData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(v){console.error("Error selecting vehicle:",v)}},Ke=async S=>{if(l.type==="opportunity")try{await l.storeAdapter.createOffer(l.task.id,S.offerData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(v){console.error("Error creating offer:",v)}},mt=async S=>{var W,H,K,ee;const v=l.task.tags||[];if(v.includes(S)){w.value=!1;return}const Q=[...v,S];try{if(l.type==="lead")await((H=(W=l.storeAdapter).updateLead)==null?void 0:H.call(W,l.task.id,{tags:Q})),l.storeAdapter.loadLeadById&&await l.storeAdapter.loadLeadById(l.task.id);else if(l.type==="opportunity")await((ee=(K=l.storeAdapter).updateOpportunity)==null?void 0:ee.call(K,l.task.id,{tags:Q})),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id);else if(l.type==="contact"){const ne=m.query.type==="account"?"account":"contact";await b.updateCustomer(l.task.id,{tags:Q},ne),await b.fetchCustomerById(l.task.id,ne),r("tag-updated")}w.value=!1}catch(ne){console.error("Error adding tag:",ne)}},ft=S=>{const v={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return v[S]||v.default},pt=S=>{const v={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return v[S]||v.default},bt=S=>S?new Date(S).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(S,v)=>{var Q,W,H,K,ee,ne;return n(),i("div",Ki,[e("header",Gi,[a.value?f("",!0):(n(),i("div",Ji,[h(Yt,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":fe.value,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:He,onAddTag:v[0]||(v[0]=x=>w.value=!0)},{"name-action":N(()=>[a.value?(n(),i("button",{key:0,onClick:pe,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...v[15]||(v[15]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):f("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags"])]))]),a.value?a.value?(n(),i("div",oo,[e("div",ro,[e("div",uo,[h(Xe,{modelValue:d.value,"onUpdate:modelValue":v[6]||(v[6]=x=>d.value=x),tabs:u,class:"mb-6"},null,8,["modelValue"]),d.value==="manage"?(n(),i("div",co,[t.managementWidget?(n(),i("div",mo,[(n(),L(Ge(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ce.value,onCarAdded:v[7]||(v[7]=x=>S.$emit("car-added",x)),onConvertToLead:v[8]||(v[8]=x=>S.$emit("convert-to-lead")),onConvertToOpportunity:v[9]||(v[9]=x=>S.$emit("convert-to-opportunity")),onVehicleSelected:Ye,onCreateOffer:Ke},null,40,["lead","opportunity","contact","activities"]))])):f("",!0),e("div",fo,[v[16]||(v[16]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-comments text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Communicate")])],-1)),e("div",po,[h(at,{"task-type":t.type,"task-id":t.task.id,"phone-number":((ee=t.task.customer)==null?void 0:ee.phone)||"","show-arrow":!1,onSave:Oe,onCancel:v[10]||(v[10]=x=>k.value=!1)},null,8,["task-type","task-id","phone-number"]),T.value.length>0?(n(),i("div",bo,[e("div",yo,[(n(!0),i(P,null,R(T.value,x=>(n(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",vo,[e("span",go,c(x.type),1),e("span",xo,c(U(x.timestamp)),1)]),e("p",ho,c(x.content),1)]))),128))])])):f("",!0)])])])):f("",!0),d.value==="request"?(n(),i("div",ko,[e("div",wo,[t.type!=="contact"?(n(),L(Aa,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:de},null,8,["task","entity-type","activities"])):f("",!0),h(Ra,{task:t.task,"task-type":t.type,"customer-id":((ne=t.task.customer)==null?void 0:ne.id)||t.task.customerId||t.task.id,onAction:He,onAddTag:v[11]||(v[11]=x=>w.value=!0)},null,8,["task","task-type","customer-id"])]),e("div",Co,[v[18]||(v[18]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",$o,[e("div",So,[ce.value.length>0?(n(),i("div",Ao)):f("",!0),ce.value.length===0?(n(),i("div",To,[...v[17]||(v[17]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(n(),i("div",Do,[(n(!0),i(P,null,R(ce.value,x=>(n(),i("div",{key:x.id,class:"flex gap-4 relative"},[e("div",{class:M(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",pt(x.type)])},[e("i",{class:M([ft(x.type),"text-fluid-sm"])},null,2)],2),e("div",Eo,[e("div",qo,[e("span",Io,c(x.user),1),V(" "+c(x.action),1)]),x.content?(n(),i("div",Oo,c(x.content),1)):f("",!0),e("div",No,c(bt(x.timestamp)),1)])]))),128))]))])])])])):f("",!0),d.value==="data"?(n(),i("div",Mo,[e("div",Lo,[v[20]||(v[20]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-note-sticky text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Notes")])],-1)),e("div",jo,[e("div",Vo,[q.value.length===0?(n(),i("div",Fo,[...v[19]||(v[19]=[e("i",{class:"fa-solid fa-note-sticky text-2xl mb-2"},null,-1),e("p",null,"No notes yet",-1)])])):f("",!0),(n(!0),i(P,null,R(q.value,x=>(n(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Bo,c(U(x.timestamp)),1),e("p",Uo,c(x.content),1)]))),128))])])]),e("div",Wo,[v[23]||(v[23]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-paperclip text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Attachments")])],-1)),e("div",Po,[e("div",Ro,[A.value.length===0?(n(),i("div",zo,[...v[21]||(v[21]=[e("i",{class:"fa-solid fa-paperclip text-2xl mb-2"},null,-1),e("p",null,"No attachments yet",-1)])])):f("",!0),(n(!0),i(P,null,R(A.value,x=>(n(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg flex items-center gap-3"},[v[22]||(v[22]=e("i",{class:"fa-solid fa-file text-sub text-lg"},null,-1)),e("div",Qo,[e("div",Ho,c(x.filename),1),e("div",Yo,c(U(x.timestamp)),1)])]))),128))])])]),e("div",Ko,[e("div",Go,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[v[25]||(v[25]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Trade-in")],-1)),e("button",{onClick:F,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...v[24]||(v[24]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",Jo,[e("div",Xo,[D.value.length===0?(n(),i("div",Zo,[...v[26]||(v[26]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-2xl mb-2"},null,-1),e("p",null,"No trade-ins yet",-1)])])):f("",!0),(n(!0),i(P,null,R(D.value,x=>(n(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",_o,[e("div",er,c(U(x.timestamp)),1)]),x.data&&x.data.brand?(n(),i("div",tr,[V(c(x.data.brand)+" "+c(x.data.model)+" ",1),x.data.version?(n(),i("span",sr,c(x.data.version),1)):f("",!0)])):f("",!0),x.data&&(x.data.kilometers||x.data.price)?(n(),i("div",ar,[x.data.kilometers?(n(),i("div",nr,[v[27]||(v[27]=e("span",{class:"text-sub"},"KM:",-1)),V(" "+c(Te(x.data.kilometers)),1)])):f("",!0),x.data.price?(n(),i("div",lr,[v[28]||(v[28]=e("span",{class:"text-sub"},"Price:",-1)),V(" € "+c(re(x.data.price)),1)])):f("",!0)])):f("",!0),x.content?(n(),i("div",ir,c(x.content),1)):f("",!0)]))),128))])])]),e("div",or,[e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[v[30]||(v[30]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-shopping-cart text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Purchase")],-1)),e("button",{onClick:E,class:"px-3 py-1.5 text-fluid-xs font-medium bg-brand-dark text-white rounded-lg hover:bg-brand-darkDarker transition-colors flex items-center gap-1.5"},[...v[29]||(v[29]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",rr,[e("div",dr,[C.value.length===0?(n(),i("div",ur,[...v[31]||(v[31]=[e("i",{class:"fa-solid fa-shopping-cart text-2xl mb-2"},null,-1),e("p",null,"No purchases yet",-1)])])):f("",!0),(n(!0),i(P,null,R(C.value,x=>(n(),i("div",{key:x.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",cr,[e("div",mr,c(U(x.timestamp)),1)]),x.data&&x.data.brand?(n(),i("div",fr,[V(c(x.data.brand)+" "+c(x.data.model)+" ",1),x.data.year?(n(),i("span",pr,"("+c(x.data.year)+")",1)):f("",!0)])):f("",!0),x.data&&x.data.price?(n(),i("div",br," € "+c(re(x.data.price)),1)):f("",!0),x.content?(n(),i("div",yr,c(x.content),1)):f("",!0)]))),128))])])])])])):f("",!0)])])])):f("",!0):(n(),i("div",Xi,[e("div",Zi,[e("main",_i,[e("div",eo,[h(Xe,{modelValue:y(g),"onUpdate:modelValue":v[1]||(v[1]=x=>ht(g)?g.value=x:null),tabs:ct.value,class:"mb-0"},null,8,["modelValue","tabs"])]),y(g)==="overview"?(n(),i("div",to,[t.type!=="contact"?(n(),i("div",so,[h(ea,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((H=t.task.requestedCar)==null?void 0:H.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:de},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):f("",!0),kt(S.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(n(),i("div",ao,[(n(),L(Ge(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ce.value,onCarAdded:v[2]||(v[2]=x=>S.$emit("car-added",x)),onConvertToLead:v[3]||(v[3]=x=>S.$emit("convert-to-lead")),onConvertToOpportunity:v[4]||(v[4]=x=>S.$emit("convert-to-opportunity")),onVehicleSelected:Ye,onCreateOffer:Ke},null,40,["lead","opportunity","contact","activities"]))])):f("",!0),y(De).length>0?(n(),i("div",no,[(n(!0),i(P,null,R(y(De),x=>(n(),L(Ze,{key:x.id,item:x,"task-type":t.type,"customer-initials":"SK",onEdit:y(ze),onDelete:y(Qe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):f("",!0)])):(n(),i("div",lo,[h(Ka,{actions:t.addNewConfig.tabActions,"active-tab":y(g),onAction:Me},null,8,["actions","active-tab"]),e("div",null,[y(J)==="communication"?(n(),L(at,{key:0,type:y(rt),"task-type":t.type,"task-id":t.task.id,"phone-number":((K=t.task.customer)==null?void 0:K.phone)||"",item:y(ae),onSave:y(Ee),onCancel:y(Ne)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):f("",!0),y(g)==="data"&&y(J)==="note"?(n(),L(_l,{key:1,item:y(ae),"task-type":t.type,"task-id":t.task.id,onSave:y(Ee),onCancel:y(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):f("",!0),y(J)==="attachment"?(n(),L(oi,{key:2,item:y(ae),"task-type":t.type,"task-id":t.task.id,onSave:y(Ee),onCancel:y(Ne)},null,8,["item","task-type","task-id","onSave","onCancel"])):f("",!0)]),y(De).length>0?(n(),i("div",io,[(n(!0),i(P,null,R(y(De),x=>(n(),L(Ze,{key:x.id,item:x,"task-type":t.type,"customer-initials":"SK",onEdit:y(ze),onDelete:y(Qe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):f("",!0)]))])]),h(Tl,{title:"Activity summary",activities:ce.value,collapsed:_.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:v[5]||(v[5]=x=>_.value=!_.value)},null,8,["activities","collapsed"])])),h(bi,{show:z.value==="financing"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Le,onClose:qe},null,8,["show","task-type","task-id"]),h(Ci,{show:z.value==="tradein"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Le,onClose:qe},null,8,["show","task-type","task-id"]),h(Ui,{show:z.value==="purchase"&&G.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:Le,onClose:qe},null,8,["show","task-type","task-id","requested-car"]),h(wt,{show:ue.value,onClose:v[12]||(v[12]=x=>ue.value=!1),onConfirm:ye},null,8,["show"]),se.value?(n(),L(Ct,{key:2,show:se.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:be,onCancel:v[13]||(v[13]=x=>se.value=!1)},null,8,["show","customer","assignee"])):f("",!0),h(Qi,{show:w.value,"existing-tags":t.task.tags||[],onClose:v[14]||(v[14]=x=>w.value=!1),onAdd:mt},null,8,["show","existing-tags"])])}}},Z={[Y.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[Y.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[Y.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[Y.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[Y.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[Y.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},nt={toClosed:(t,o,l)=>{const r={isDisqualified:!0,disqualifyReason:(l==null?void 0:l.reason)||null,disqualifyCategory:(l==null?void 0:l.category)||null,scheduledAppointment:null,nextActionDue:null};(l==null?void 0:l.reason)==="Duplicate"?(r.isDuplicate=!0,r.stage="Closed Failed"):(l==null?void 0:l.category)==="Not Interested"?r.stage="Not Interested":r.stage="Not Valid",r.status="Disqualified";const m=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(l==null?void 0:l.category)||"Unknown"}, Reason: ${(l==null?void 0:l.reason)||"Unknown"}`}];return t.scheduledAppointment&&m.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:r,activities:m}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Cr(t,o){return o.startsWith("Closed")?nt.toClosed:t.startsWith("Closed")&&!o.startsWith("Closed")?nt.reopen:null}function $r(t){var s,b,p;const o=t.lead;if(!o)return null;const l=oe(o,"lead");if(!l)return((s=Z[Y.NEW])==null?void 0:s.primaryAction)||null;const r=Z[l];if(!r)return((b=Z[Y.NEW])==null?void 0:b.primaryAction)||null;if(!r.primaryAction)return((p=Z[Y.NEW])==null?void 0:p.primaryAction)||null;const m=r.primaryAction;return typeof m=="function"?m({lead:o,displayStage:l}):m}function Sr(t){const o=t.lead;if(!o)return[];const l=oe(o,"lead"),r=Z[l];return r?r.secondaryActions||[]:[]}function ot(t){const o=t.lead;if(!o||!(o.isDisqualified===!0))return!1;const r=oe(o,"lead");return r===Y.CLOSED_INVALID||r===Y.CLOSED_NOT_INTERESTED||r===Y.CLOSED_DUPLICATE}function Ar(t){const o=t.lead;if(!o||ot(t))return!1;const l=oe(o,"lead"),r=Z[l];return r?typeof r.showLQWidget=="function"?r.showLQWidget(o):r.showLQWidget??!1:!1}function Tr(t){const o=t.lead;if(!o||ot(t))return!1;const l=oe(o,"lead"),r=Z[l];return r?r.showDeadlineBanner&&o.nextActionDue:!1}function Dr(t){const o=t.lead;if(!o)return!1;const l=oe(o,"lead"),r=Z[l];return r?r.canPostpone??!1:!1}function Er(t){const o=t.lead;if(!o)return"qualification";const l=oe(o,"lead"),r=Z[l];return r&&r.lqWidgetMode||"qualification"}const Re={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const o=t.deliverySubstatus;return o==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:o==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ve={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function le(t){if(!t)return 0;const o=new Date(t),r=Math.abs(new Date-o);return Math.ceil(r/(1e3*60*60*24))}const me={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const o=te(),l=o.getSetting("oofbMinDays"),r=o.getSetting("oofbMaxDays"),m=le(t.opportunity.createdAt);return m>=l&&m<r+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const l=te().getSetting("ufbDays");return le(t.opportunity.createdAt)>=l&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=te().getSetting("ofbDays");return le(t.opportunity.lastActivity||t.opportunity.createdAt)>=l&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=te().getSetting("nfuDays"),r=le(t.opportunity.lastActivity||t.opportunity.createdAt),m=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return r>=l&&!t.opportunity.contractDate&&!m&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var s;if(!t.opportunity.contractDate)return!1;const l=te().getSetting("cfbDays"),r=le(t.opportunity.contractDate),m=(s=t.activities)==null?void 0:s.some(b=>{var p;return b.type==="delivery"||((p=b.action)==null?void 0:p.toLowerCase().includes("delivered"))});return r>=l&&!m},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var s;const o=(s=t.activities)==null?void 0:s.find(b=>{var p;return b.type==="delivery"||((p=b.action)==null?void 0:p.toLowerCase().includes("delivered"))});if(!o)return!1;const r=te().getSetting("dfbDays");return le(o.timestamp)>=r},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const o=t.stage;return o==="Closed Won"||o==="Closed Lost"},"is-closed-with-task-widget":t=>me["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(me["is-closed"](t))return!1;const o=te(),l=o.getSetting("abandonedOpportunityDays");if(!o.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const m=t.opportunity.lastActivity||t.opportunity.createdAt;return le(m)>=l}};function qr(t,o){if(me["is-closed-with-task-widget"](o))return[Ve.reopen,Ve.requalify,Ve.closeLost];const l=Re[t];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(r=>{if(!r.conditional)return!0;const m=me[r.conditional];return m?m(o):!0})}function Ir(t,o){const l=Re[t];if(!l||!l.taskWidgets)return null;const m=te().getSetting("autoCloseWidgetsOnClose"),s=me["is-closed"]({stage:t});for(const b of l.taskWidgets){if(m&&s&&(b.type==="NFU"||b.type==="OFB"))continue;const p=me[b.condition];if(p&&p(o))return b.type}return null}function Or(t,o){const l=Re[t];if(!l||!l.primaryAction)return null;const r=l.primaryAction;return{...r,title:typeof r.title=="function"?r.title(o):r.title,description:typeof r.description=="function"?r.description(o):r.description,label:typeof r.label=="function"?r.label(o):r.label}}function Nr(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function Mr(t){return t==="Closed Won"||t==="Closed Lost"}const Lr={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:o}){const l=o,r=s=>{s||l("close")},m=()=>{l("close")};return(s,b)=>(n(),L(y(Ae),{open:t.show,"onUpdate:open":r},{default:N(()=>[h(y(he),null,{default:N(()=>[h(y(ke),{class:"fixed inset-0 z-50 bg-black/50"}),h(y(we),{class:"w-full sm:max-w-md"},{default:N(()=>[h(y(Ce),null,{default:N(()=>[h(y($e),null,{default:N(()=>[V(c(t.title),1)]),_:1})]),_:1}),b[0]||(b[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),h(y(Se),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:N(()=>[h(y(B),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{St as E,Ra as T,wr as _,Sr as a,Tr as b,Dr as c,Er as d,Cr as e,_e as f,$r as g,et as h,ot as i,tt as j,_l as k,Ir as l,Or as m,qr as n,Mr as o,Nr as p,Fi as q,Lr as r,Ar as s};
