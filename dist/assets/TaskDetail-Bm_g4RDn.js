import{k as te,l as ye,d as at,r as $,c as q,a as l,h as n,b as e,j as f,t as v,e as R,n as j,w as N,v as F,F as Y,f as _,i as H,p as me,q as Ve,s as P,x as re,o as ne,y as oe,z as B,A as fe,u as W,B as lt,C as rt,T as ie,D as we,E as Fe,g as it,G as dt,_ as ut,H as Le,I as ct,J as pt}from"./index-BYxhXYqh.js";const ae=(t=300)=>new Promise(y=>setTimeout(y,t)),mt=async(t={})=>{await ae();let y=[...te];if(t.stage&&(y=y.filter(s=>s.stage===t.stage)),t.assignee&&(y=y.filter(s=>s.assignee===t.assignee)),t.search){const s=t.search.toLowerCase();y=y.filter(u=>u.customer.name.toLowerCase().includes(s)||u.vehicle.brand.toLowerCase().includes(s)||u.vehicle.model.toLowerCase().includes(s))}return{data:y,total:y.length}},yt=async t=>{await ae();const y=te.find(s=>s.id===parseInt(t));if(!y)throw new Error("Opportunity not found");return y},gt=async t=>(await ae(),ye.filter(y=>y.opportunityId===parseInt(t))),vt=async t=>{await ae();const y={id:te.length+1,...t,createdAt:new Date().toISOString()};return te.push(y),y},he=async(t,y)=>{await ae();const s=te.findIndex(u=>u.id===parseInt(t));if(s===-1)throw new Error("Opportunity not found");return te[s]={...te[s],...y},te[s]},ft=async t=>{await ae();const y=te.findIndex(s=>s.id===parseInt(t));if(y===-1)throw new Error("Opportunity not found");return te.splice(y,1),{success:!0}},bt=async(t,y)=>{await ae();const s={id:ye.length+1,opportunityId:parseInt(t),timestamp:new Date().toISOString(),...y};return ye.push(s),s},xt=async(t,y,s)=>{await ae();const u=ye.find(o=>o.id===parseInt(y)&&o.opportunityId===parseInt(t));if(!u)throw new Error("Activity not found");return Object.assign(u,s,{timestamp:new Date().toISOString()}),u},ht=async(t,y)=>{await ae();const s=ye.findIndex(u=>u.id===parseInt(y)&&u.opportunityId===parseInt(t));if(s===-1)throw new Error("Activity not found");return ye.splice(s,1),{success:!0}},Ue=at("opportunities",()=>{const t=$([]),y=$(null),s=$([]),u=$(!1),o=$(null),a=$({stage:null,assignee:null,search:""}),c=q(()=>t.value.length),d=q(()=>{const D={};return t.value.forEach(O=>{D[O.stage]||(D[O.stage]=[]),D[O.stage].push(O)}),D}),i=q(()=>t.value.reduce((D,O)=>D+O.value,0));async function r(){u.value=!0,o.value=null;try{const D=await mt(a.value);t.value=D.data}catch(D){o.value=D.message}finally{u.value=!1}}async function b(D){u.value=!0,o.value=null;try{y.value=await yt(D),s.value=await gt(D);const O=t.value.findIndex(x=>x.id===parseInt(D));O!==-1&&(t.value[O]=y.value)}catch(O){o.value=O.message}finally{u.value=!1}}async function m(D){u.value=!0,o.value=null;try{const O=await vt(D);return t.value.unshift(O),O}catch(O){throw o.value=O.message,O}finally{u.value=!1}}async function p(D,O){u.value=!0,o.value=null;try{const x=await he(D,O),I=t.value.findIndex(M=>M.id===D);return I!==-1&&(t.value[I]=x),x}catch(x){throw o.value=x.message,x}finally{u.value=!1}}async function h(D){u.value=!0,o.value=null;try{await ft(D),t.value=t.value.filter(O=>O.id!==D)}catch(O){throw o.value=O.message,O}finally{u.value=!1}}async function g(D,O){try{const x=await bt(D,O);return s.value.unshift(x),x}catch(x){throw o.value=x.message,x}}async function C(D,O,x){try{const I=await xt(D,O,x),M=s.value.findIndex(w=>w.id===parseInt(O));return M!==-1&&(s.value[M]=I),I}catch(I){throw o.value=I.message,I}}async function T(D,O){try{return await ht(D,O),s.value=s.value.filter(x=>x.id!==parseInt(O)),{success:!0}}catch(x){throw o.value=x.message,x}}function V(D){a.value={...a.value,...D},r()}async function L(D){var O;u.value=!0,o.value=null;try{const x=t.value.find(z=>z.id===D)||y.value,I={stage:"Qualified"};((x==null?void 0:x.probability)===0||(x==null?void 0:x.probability)===100)&&(I.probability=50);const M=await he(D,I),w=t.value.findIndex(z=>z.id===D);return w!==-1&&(t.value[w]=M),((O=y.value)==null?void 0:O.id)===D&&(y.value=M),await g(D,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${M.stage} stage`}),M}catch(x){throw o.value=x.message,x}finally{u.value=!1}}async function Q(D){var O;u.value=!0,o.value=null;try{const x=await he(D,{stage:"Registration"}),I=t.value.findIndex(M=>M.id===D);return I!==-1&&(t.value[I]=x),((O=y.value)==null?void 0:O.id)===D&&(y.value=x),await g(D,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),x}catch(x){throw o.value=x.message,x}finally{u.value=!1}}async function se(D){var O;u.value=!0,o.value=null;try{const x=await he(D,{stage:"Closed",probability:100}),I=t.value.findIndex(M=>M.id===D);return I!==-1&&(t.value[I]=x),((O=y.value)==null?void 0:O.id)===D&&(y.value=x),await g(D,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),x}catch(x){throw o.value=x.message,x}finally{u.value=!1}}return{opportunities:t,currentOpportunity:y,currentOpportunityActivities:s,loading:u,error:o,filters:a,totalOpportunities:c,opportunitiesByStage:d,totalValue:i,loadOpportunities:r,loadOpportunityById:b,addOpportunity:m,modifyOpportunity:p,removeOpportunity:h,addActivity:g,updateActivity:C,deleteActivity:T,setFilters:V,reopenOpportunity:L,markAsRegistration:Q,markAsClosedWon:se}}),wt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 max-h-[40vh] lg:max-h-none"},kt={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},Ct={class:"font-bold text-lg text-gray-800"},$t={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},St={class:"flex gap-2"},Dt={class:"px-5 py-3"},At={class:"relative"},It=["placeholder"],Ot={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Tt=["onClick"],qt=["onClick"],Nt={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Mt={class:"flex items-start gap-3.5 pr-6"},jt={class:"flex-1 min-w-0"},Rt={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Vt={class:"text-gray-600 text-xs mt-1 truncate"},Ft={class:"text-right shrink-0"},Lt={class:"flex items-center gap-2 flex-wrap mt-3"},Ut={__name:"EntityListSidebar",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change"],setup(t,{emit:y}){const s={mounted(d,i){d.clickOutsideEvent=r=>{d===r.target||d.contains(r.target)||i.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},u=t,o=$(""),a=q(()=>{let d=u.items;if(u.typeFilter&&u.typeFilter!=="all"&&(d=d.filter(i=>i.type===u.typeFilter)),o.value){const i=o.value.toLowerCase();d=d.filter(r=>{const b=u.getName(r).toLowerCase(),m=u.getVehicleInfo(r).toLowerCase();return b.includes(i)||m.includes(i)})}return d}),c=d=>{const i=d.compositeId||`${d.type||"task"}-${d.id}`||d.id;return u.selectedId===i};return(d,i)=>(n(),l("div",wt,[e("div",kt,[e("h2",Ct,v(t.title),1),i[4]||(i[4]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[R(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(n(),l("div",$t,[e("div",St,[e("button",{onClick:i[0]||(i[0]=r=>d.$emit("filter-change","all")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:i[1]||(i[1]=r=>d.$emit("filter-change","lead")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:i[2]||(i[2]=r=>d.$emit("filter-change","opportunity")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):f("",!0),e("div",Dt,[e("div",At,[i[5]||(i[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),N(e("input",{"onUpdate:modelValue":i[3]||(i[3]=r=>o.value=r),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,It),[[F,o.value]])])]),e("div",Ot,[(n(!0),l(Y,null,_(a.value,r=>(n(),l("div",{key:r.id,onClick:b=>d.$emit("select",r.compositeId||`${r.type||"task"}-${r.id}`||r.id),class:j(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",c(r)?typeof t.selectedClass=="function"?t.selectedClass(r):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(r):t.unselectedClass])},[t.showMenu?(n(),l("button",{key:0,onClick:H(b=>d.$emit("menu-click",r.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...i[6]||(i[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,qt)):f("",!0),t.openMenuId===r.id&&t.showMenu?N((n(),l("div",Nt,[me(d.$slots,"menu",{item:r})])),[[s,()=>d.$emit("menu-close")]]):f("",!0),e("div",Mt,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(r)])},v(t.getInitials(r)),3),e("div",jt,[e("div",Rt,v(t.getName(r)),1),e("div",Vt,v(t.getVehicleInfo(r)),1)]),e("div",Ft,[me(d.$slots,"meta",{item:r}),me(d.$slots,"footer",{item:r})])]),e("div",Lt,[me(d.$slots,"badges",{item:r})])],10,Tt))),128))])]))}},Et={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center gap-3"},Bt={key:1,class:"font-bold text-lg text-gray-800"},Wt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Pt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},zt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Yt={class:"text-sm"},Qt={key:2,class:"space-y-6 relative z-10"},Ht={key:0,class:"mb-4 pl-12"},Jt={class:"text-sm font-semibold text-gray-800"},Kt={class:"flex gap-4 relative mb-6"},Gt={class:"flex-1 min-w-0"},Xt={class:"text-sm text-slate-700 leading-snug"},Zt={class:"font-bold"},_t={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},es={class:"text-xs text-gray-400 mt-1"},ts={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0}},emits:["toggle-collapse"],setup(t,{emit:y}){const s=t,u=i=>{const r={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return r[i]||r.default},o=i=>{const r={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return r[i]||r.default},a=i=>{if(!i)return"";const r=new Date(i),b=new Date,m=new Date(b);return m.setDate(m.getDate()-1),r.toDateString()===b.toDateString()?"Today":r.toDateString()===m.toDateString()?"Yesterday":r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},c=i=>i?new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",d=(i,r)=>{if(i===0)return!0;const b=s.activities[i-1];if(!b)return!0;const m=new Date(r.timestamp).toDateString(),p=new Date(b.timestamp).toDateString();return m!==p};return(i,r)=>t.show?(n(),l("div",{key:0,class:j(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",t.collapsed?"w-16":"w-80"])},[e("div",Et,[t.showCollapse?(n(),l("button",{key:0,onClick:r[0]||(r[0]=b=>i.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:j(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):f("",!0),t.collapsed?f("",!0):(n(),l("h2",Bt,v(t.title),1))]),t.collapsed?f("",!0):(n(),l("div",Wt,[t.activities.length>0?(n(),l("div",Pt)):f("",!0),t.activities.length===0?(n(),l("div",zt,[r[1]||(r[1]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Yt,v(t.emptyMessage),1)])):(n(),l("div",Qt,[(n(!0),l(Y,null,_(t.activities,(b,m)=>(n(),l(Y,{key:b.id},[d(m,b)?(n(),l("div",Ht,[e("h3",Jt,v(a(b.timestamp)),1)])):f("",!0),e("div",Kt,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",o(b.type)])},[e("i",{class:j([u(b.type),"text-sm"])},null,2)],2),e("div",Gt,[e("div",Xt,[e("span",Zt,v(b.user),1),R(" "+v(b.action),1)]),b.content?(n(),l("div",_t,v(b.content),1)):f("",!0),e("div",es,v(c(b.timestamp)),1)])])],64))),128))]))]))],2)):f("",!0)}},ss={class:"w-full"},os={class:"flex items-center justify-between gap-3 md:gap-4"},ns={class:"flex items-center gap-3 md:gap-4 flex-1"},as={class:"min-w-0 flex-1"},ls={class:"heading-main truncate"},rs={class:"flex flex-wrap items-center gap-2 mt-1"},is={class:"flex items-center gap-1 ml-2"},ds={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},us={class:"flex items-center gap-4"},cs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ps={class:"flex items-center gap-2"},ms={class:"text-xs text-gray-900 font-medium"},ys={class:"flex items-center gap-2"},gs={class:"text-xs text-gray-900 font-medium"},vs={class:"flex items-center gap-2"},fs={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},bs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},xs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},hs={class:"text-xs text-gray-900 font-medium"},ws={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ks={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},setup(t){const y=$(!1),s=$(null),u=async(o,a)=>{try{await navigator.clipboard.writeText(o),s.value=a,setTimeout(()=>{s.value=null},1500)}catch(c){console.error("Failed to copy:",c)}};return(o,a)=>(n(),l("div",ss,[e("div",os,[e("div",ns,[e("div",{class:j(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},v(t.initials),3),e("div",as,[e("h1",ls,v(t.name),1),e("div",rs,[me(o.$slots,"tags")])])]),e("div",is,[e("button",{onClick:a[0]||(a[0]=c=>y.value=!y.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:j(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":y.value}])},null,2)])])]),y.value?(n(),l("div",ds,[e("div",us,[e("div",cs,[e("div",ps,[a[4]||(a[4]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ms,v(t.email),1),e("button",{onClick:a[1]||(a[1]=H(c=>u(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...a[3]||(a[3]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ys,[a[6]||(a[6]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",gs,v(t.phone),1),e("button",{onClick:a[2]||(a[2]=H(c=>u(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...a[5]||(a[5]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",vs,[e("div",fs,[t.thirdFieldLabel.toLowerCase().includes("address")?(n(),l("i",bs)):(n(),l("i",xs))]),e("span",hs,v(t.thirdFieldValue),1)])])]),s.value?(n(),l("div",ws,v(s.value==="email"?"Email":"Phone")+" copied! ",1)):f("",!0)])):f("",!0)]))}},Cs={class:"flex gap-8 text-base font-medium text-slate-500 py-1 overflow-x-auto scrollbar-hide"},$s=["onClick"],Ss={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(y,s)=>(n(),l("div",Cs,[(n(!0),l(Y,null,_(t.tabs,u=>(n(),l("div",{key:u.key,onClick:o=>y.$emit("update:modelValue",u.key),class:j(["pb-2 border-b-2 cursor-pointer whitespace-nowrap transition-colors",t.modelValue===u.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[R(v(u.label)+" ",1),u.count!==void 0?(n(),l("span",{key:0,class:j(["ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===u.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},v(u.count),3)):f("",!0)],10,$s))),128))]))}},Ds={class:"metadata-bar w-full"},As={class:"flex items-center gap-2 px-3 py-1.5"},Is={class:"text-xs font-bold text-gray-800"},Os={key:0,class:"flex items-center gap-2 px-3 py-1.5"},Ts={class:"flex items-center gap-2"},qs={class:"w-16 bg-gray-200 rounded-full h-2"},Ns={class:"text-xs font-bold text-gray-800"},Ms={key:1,class:"metadata-divider"},js={class:"flex items-center gap-2 px-3 py-1.5"},Rs={class:"text-xs font-bold text-gray-800"},Vs={class:"flex items-center gap-2 px-3 py-1.5"},Fs={class:"text-xs font-bold text-gray-800"},Ls={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},probability:{type:Number,default:null}},setup(t){const y=t,s=q(()=>y.probability!==null&&y.probability!==void 0),u=q(()=>y.probability>=70?"bg-green-500":y.probability>=40?"bg-orange-500":"bg-red-500");return(o,a)=>(n(),l("div",Ds,[e("div",As,[a[0]||(a[0]=e("span",{class:"label-upper"},"Stage",-1)),e("span",Is,v(t.stage),1)]),a[5]||(a[5]=e("div",{class:"metadata-divider"},null,-1)),s.value?(n(),l("div",Os,[a[1]||(a[1]=e("span",{class:"label-upper"},"Probability",-1)),e("div",Ts,[e("div",qs,[e("div",{class:j(["h-2 rounded-full transition-all",u.value]),style:Ve({width:t.probability+"%"})},null,6)]),e("span",Ns,v(t.probability)+"%",1)])])):f("",!0),s.value?(n(),l("div",Ms)):f("",!0),e("div",js,[a[2]||(a[2]=e("span",{class:"label-upper"},"Owner",-1)),e("span",Rs,v(t.owner),1)]),t.source?(n(),l(Y,{key:2},[a[4]||(a[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Vs,[a[3]||(a[3]=e("span",{class:"label-upper"},"Source",-1)),e("span",Fs,v(t.source),1)])],64)):f("",!0)]))}},Us={key:0,class:"flex-grow border-t border-gray-200"},Es={key:0,class:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Bs={key:0,class:"border-t border-gray-100 my-1"},Ws={key:1,class:"flex-grow border-t border-gray-200"},je={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:y}){const s={mounted(h,g){h.clickOutsideEvent=C=>{h===C.target||h.contains(C.target)||g.value()},document.addEventListener("click",h.clickOutsideEvent)},unmounted(h){document.removeEventListener("click",h.clickOutsideEvent)}},u=t,o=y,a=$(!1),c=q(()=>u.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-1.5 text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),d={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},i=q(()=>{if(!u.activeTab||u.activeTab==="overview")return u.actions.filter(g=>!d[g]);const h=Object.entries(d).filter(([,g])=>g===u.activeTab).map(([g])=>g);return u.actions.filter(g=>h.includes(g))}),r=q(()=>i.value.some(h=>["email","whatsapp","sms"].includes(h))),b=q(()=>i.value.some(h=>["addVehicle","configureVehicle"].includes(h))),m=q(()=>i.value.some(h=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(h))),p=h=>{a.value=!1,o("action",h)};return(h,g)=>t.show?(n(),l("div",{key:0,class:j(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?f("",!0):(n(),l("div",Us)),e("div",{class:j(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:g[0]||(g[0]=H(C=>a.value=!a.value,["stop"])),class:j(c.value)},[...g[12]||(g[12]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),R(" Add new ",-1)])],2),a.value?N((n(),l("div",Es,[b.value?(n(),l(Y,{key:0},[i.value.includes("addVehicle")?(n(),l("button",{key:0,onClick:g[1]||(g[1]=C=>p("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):f("",!0),i.value.includes("configureVehicle")?(n(),l("button",{key:1,onClick:g[2]||(g[2]=C=>p("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):f("",!0)],64)):f("",!0),m.value?(n(),l(Y,{key:1},[b.value?(n(),l("div",Bs)):f("",!0),i.value.includes("note")?(n(),l("button",{key:1,onClick:g[3]||(g[3]=C=>p("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):f("",!0),i.value.includes("financing")?(n(),l("button",{key:2,onClick:g[4]||(g[4]=C=>p("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):f("",!0),i.value.includes("tradein")?(n(),l("button",{key:3,onClick:g[5]||(g[5]=C=>p("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):f("",!0),i.value.includes("requestedCar")?(n(),l("button",{key:4,onClick:g[6]||(g[6]=C=>p("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):f("",!0),i.value.includes("purchase")?(n(),l("button",{key:5,onClick:g[7]||(g[7]=C=>p("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):f("",!0),i.value.includes("attachment")?(n(),l("button",{key:6,onClick:g[8]||(g[8]=C=>p("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):f("",!0)],64)):f("",!0),r.value?(n(),l(Y,{key:2},[g[16]||(g[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),i.value.includes("email")?(n(),l("button",{key:0,onClick:g[9]||(g[9]=C=>p("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...g[13]||(g[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),R(" Send Email ",-1)])])):f("",!0),i.value.includes("whatsapp")?(n(),l("button",{key:1,onClick:g[10]||(g[10]=C=>p("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...g[14]||(g[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),R(" Send WhatsApp ",-1)])])):f("",!0),i.value.includes("sms")?(n(),l("button",{key:2,onClick:g[11]||(g[11]=C=>p("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...g[15]||(g[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),R(" Send SMS ",-1)])])):f("",!0)],64)):f("",!0)])),[[s,()=>a.value=!1]]):f("",!0)],2),t.inline?f("",!0):(n(),l("div",Ws))],2)):f("",!0)}},Ps={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},zs={class:"flex items-start gap-3"},Ys={class:"flex-1 min-w-0"},Qs={class:"font-bold text-sm text-slate-800 mb-2"},Hs={class:"space-y-1.5 text-xs text-gray-600"},Js={class:"flex items-center gap-2"},Ks={class:"flex items-center gap-2"},Gs={class:"flex items-center gap-2"},Xs={key:0,class:"mt-2"},Zs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const y=t,s=q(()=>y.appointmentData.date?new Date(y.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),u=q(()=>y.appointmentData.time?y.appointmentData.time:""),o=a=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[a==null?void 0:a.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(a,c)=>(n(),l("div",Ps,[e("div",zs,[c[3]||(c[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Ys,[e("h4",Qs,v(t.appointmentData.type),1),e("div",Hs,[e("div",Js,[c[0]||(c[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,v(s.value),1)]),e("div",Ks,[c[1]||(c[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,v(u.value),1)]),e("div",Gs,[c[2]||(c[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,v(t.appointmentData.assignee),1)])]),t.appointmentData.status?(n(),l("div",Xs,[e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",o(t.appointmentData.status)])},v(t.appointmentData.status),3)])):f("",!0)])])]))}},_s={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},eo={class:"flex-1"},to={class:"flex items-center gap-2 mb-1"},so={class:"text-xs font-bold text-slate-800"},oo={class:"text-[10px] text-gray-400"},no={class:"text-[10px] text-gray-400"},ao={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},lo={class:"ml-auto relative"},ro={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},io={key:0,class:"text-sm text-slate-700"},uo={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},co={key:2,class:"mt-2"},po={key:0},mo={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},yo={key:0},go={class:"text-sm font-bold text-slate-800"},vo={key:0,class:"text-xs text-gray-600 mt-0.5"},fo={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},bo={key:0},xo={key:1},ho={key:2},wo={key:3},ko={key:4},Co={key:1},$o={class:"text-sm font-bold text-slate-800 mb-2"},So={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},Do={key:0},Ao={class:"text-slate-700 font-medium ml-1"},Io={key:1},Oo={class:"text-slate-700 font-medium ml-1"},To={key:2},qo={class:"text-slate-700 font-medium ml-1"},No={key:3},Mo={class:"text-slate-700 font-medium ml-1"},jo={key:4},Ro={class:"text-slate-700 font-medium ml-1"},Vo={key:5},Fo={class:"text-slate-700 font-medium ml-1"},Lo={key:2,class:"flex items-center gap-3"},Uo={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Eo=["src"],Bo={class:"flex-1"},Wo={class:"text-sm font-bold text-slate-800"},Po={class:"text-xs text-gray-500"},zo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Yo={key:3,class:"flex items-center gap-3"},Qo={class:"flex-1"},Ho={class:"text-sm font-bold text-slate-800"},Jo={class:"text-xs text-gray-500"},Ko={key:0,class:"text-xs text-gray-400 mt-1"},Go={key:1,class:"text-xs text-gray-600 mt-1"},Xo={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:y}){const s=t,u=y,o=$(!1),a={mounted(h,g){h.clickOutsideEvent=C=>{h===C.target||h.contains(C.target)||g.value()},setTimeout(()=>{document.addEventListener("click",h.clickOutsideEvent)},0)},unmounted(h){document.removeEventListener("click",h.clickOutsideEvent)}},c=h=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[h]||"fa-solid fa-circle",d=h=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[h]||"bg-gray-100 text-gray-600 border-gray-200",i=h=>{if(!h)return"Just now";const g=new Date(h),T=new Date-g,V=Math.floor(T/6e4),L=Math.floor(V/60),Q=Math.floor(L/24);return V<1?"Just now":V<60?`${V} minutes ago`:L<24?`${L} hours ago`:Q===1?"Yesterday":Q<7?`${Q} days ago`:g.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},r=h=>h?new Intl.NumberFormat("en-US").format(h):"0",b=h=>h?new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",m=()=>{o.value=!1,u("edit",s.item)},p=()=>{o.value=!1,confirm("Are you sure you want to delete this item?")&&u("delete",s.item)};return(h,g)=>(n(),l("div",_s,[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",d(t.item.type)])},[e("i",{class:j([c(t.item.type),"text-sm"])},null,2)],2),e("div",eo,[e("div",to,[e("span",so,v(t.customerInitials),1),e("span",oo,v(t.item.action||"added"),1),e("span",no,"• "+v(i(t.item.timestamp)),1),t.item.autoDetected?(n(),l("span",ao,"Auto-detected")):f("",!0),e("div",lo,[e("button",{onClick:g[0]||(g[0]=H(C=>o.value=!o.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...g[1]||(g[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),o.value?N((n(),l("div",ro,[e("button",{onClick:m,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...g[2]||(g[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),R(" Edit ",-1)])]),e("button",{onClick:p,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...g[3]||(g[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),R(" Delete ",-1)])])])),[[a,()=>o.value=!1]]):f("",!0)])]),t.item.content?(n(),l("div",io,v(t.item.content),1)):f("",!0),t.item.fileName?(n(),l("div",uo,[g[4]||(g[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,v(t.item.fileName),1)])):f("",!0),t.item.data?(n(),l("div",co,[t.item.type==="appointment"?(n(),l("div",po,[P(Zs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(n(),l("div",mo,[t.item.type==="tradein"?(n(),l("div",yo,[e("h4",go,v(t.item.data.brand)+" "+v(t.item.data.model),1),t.item.data.version?(n(),l("p",vo,v(t.item.data.version),1)):f("",!0),e("div",fo,[t.item.data.year?(n(),l("div",bo,[g[5]||(g[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),R(v(t.item.data.year),1)])):f("",!0),t.item.data.km?(n(),l("div",xo,[g[6]||(g[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),R(v(t.item.data.km)+" km ",1)])):f("",!0),t.item.data.plate?(n(),l("div",ho,[g[7]||(g[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),R(v(t.item.data.plate),1)])):f("",!0),t.item.data.date?(n(),l("div",wo,[g[8]||(g[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),R(v(b(t.item.data.date)),1)])):f("",!0),t.item.data.class?(n(),l("div",ko,[g[9]||(g[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),R(v(t.item.data.class),1)])):f("",!0)])])):t.item.type==="financing"?(n(),l("div",Co,[e("h4",$o,v(t.item.data.product),1),e("div",So,[t.item.data.provider?(n(),l("div",Do,[g[10]||(g[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Ao,v(t.item.data.provider),1)])):f("",!0),t.item.data.total?(n(),l("div",Io,[g[11]||(g[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Oo,"€"+v(r(t.item.data.total)),1)])):f("",!0),t.item.data.monthly?(n(),l("div",To,[g[12]||(g[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",qo,"€"+v(r(t.item.data.monthly)),1)])):f("",!0),t.item.data.deposit?(n(),l("div",No,[g[13]||(g[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Mo,"€"+v(r(t.item.data.deposit)),1)])):f("",!0),t.item.data.startDate?(n(),l("div",jo,[g[14]||(g[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Ro,v(b(t.item.data.startDate)),1)])):f("",!0),t.item.data.expDate?(n(),l("div",Vo,[g[15]||(g[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Fo,v(b(t.item.data.expDate)),1)])):f("",!0)])])):t.item.type==="offer"?(n(),l("div",Lo,[t.item.data.image?(n(),l("div",Uo,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Eo)])):f("",!0),e("div",Bo,[e("h4",Wo,v(t.item.data.brand)+" "+v(t.item.data.model)+" ("+v(t.item.data.year)+")",1),e("p",Po,"€ "+v(r(t.item.data.price)),1)]),t.item.data.isMainOffer?(n(),l("span",zo,"Main Offer")):f("",!0)])):t.item.type==="purchase"?(n(),l("div",Yo,[e("div",Qo,[e("h4",Ho,v(t.item.data.brand)+" "+v(t.item.data.model)+" ("+v(t.item.data.year)+")",1),e("p",Jo,"€ "+v(r(t.item.data.price)),1),t.item.data.purchaseDate?(n(),l("p",Ko,"Purchased: "+v(b(t.item.data.purchaseDate)),1)):f("",!0),t.item.data.notes?(n(),l("p",Go,v(t.item.data.notes),1)):f("",!0)])])):f("",!0)]))])):f("",!0)])]))}},Zo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},_o={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},en={class:"mb-3"},tn={class:"flex justify-end gap-2"},sn={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(""),a=$(""),c=()=>{!o.value.trim()&&!a.value||u("save",{type:"communication",action:`sent via ${s.type}`,content:o.value||`Sent template: ${a.value}`,communicationType:s.type})};return(d,i)=>(n(),l("div",Zo,[i[5]||(i[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",_o,v(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",en,[i[4]||(i[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),N(e("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>a.value=r),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...i[3]||(i[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[re,a.value]])]),N(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=r=>o.value=r),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[F,o.value]]),e("div",tn,[e("button",{onClick:i[2]||(i[2]=r=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},on={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},nn={class:"flex justify-between items-center mb-4"},an={class:"text-sm font-bold text-slate-800"},ln={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},rn={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$("");ne(()=>{s.item&&(o.value=s.item.content||"")});const a=()=>{var c,d;o.value.trim()&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:o.value,timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,d)=>(n(),l("div",on,[d[5]||(d[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",nn,[e("h5",an,v(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:d[0]||(d[0]=i=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),N(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=i=>o.value=i),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[F,o.value]])]),e("div",ln,[e("button",{onClick:d[2]||(d[2]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:a,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},dn={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},un={class:"flex justify-between items-center mb-4"},cn={class:"text-sm font-bold text-slate-800"},pn={class:"flex items-center gap-3"},mn={key:0,class:"text-sm text-slate-600"},yn={key:1,class:"text-sm text-gray-400"},gn={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},vn=["disabled"],fn={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(null),a=$("");ne(()=>{s.item&&(a.value=s.item.fileName||"")});const c=i=>{const r=i.target.files[0];r&&(o.value=r,a.value=r.name)},d=()=>{var i,r;!o.value&&!s.item||u("save",{id:((i=s.item)==null?void 0:i.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:a.value,timestamp:((r=s.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(i,r)=>(n(),l("div",dn,[r[6]||(r[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",un,[e("h5",cn,v(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:r[0]||(r[0]=b=>i.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...r[3]||(r[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",pn,[e("input",{type:"file",onChange:c,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:r[1]||(r[1]=b=>i.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...r[4]||(r[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),R("Choose File ",-1)])]),a.value?(n(),l("span",mn,v(a.value),1)):(n(),l("span",yn,"No file selected"))])]),e("div",gn,[e("button",{onClick:r[2]||(r[2]=b=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:d,disabled:!o.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,vn)])]))}},bn={class:"animate-fade-in"},xn={class:"space-y-4"},hn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kn={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Cn=["disabled"],$n={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ne(()=>{s.item&&s.item.data&&(o.value={startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",productName:s.item.data.product||s.item.data.productName||"",deposit:s.item.data.deposit||"",loanAmount:s.item.data.total||s.item.data.loanAmount||""})});const a=()=>{var c,d;o.value.productName&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"financing",action:s.item?"updated a financing proposal":"added a financing proposal",data:{product:o.value.productName,provider:"Audi Financial",total:o.value.loanAmount||"0",monthly:Math.round(parseFloat(o.value.loanAmount||0)/36).toString(),startDate:o.value.startDate,expDate:o.value.expDate,deposit:o.value.deposit},timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,d)=>(n(),l("div",bn,[e("div",xn,[e("div",hn,[e("div",null,[d[6]||(d[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),N(e("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=i=>o.value.startDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.startDate]])]),e("div",null,[d[7]||(d[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":d[1]||(d[1]=i=>o.value.expDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.expDate]])])]),e("div",null,[d[8]||(d[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),N(e("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>o.value.productName=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.productName]])]),e("div",wn,[e("div",null,[d[9]||(d[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[3]||(d[3]=i=>o.value.deposit=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.deposit]])]),e("div",null,[d[10]||(d[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=i=>o.value.loanAmount=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.loanAmount]])])])]),e("div",kn,[e("button",{onClick:d[5]||(d[5]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:a,disabled:!o.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Cn)])]))}},Sn={class:"animate-fade-in"},Dn={class:"space-y-4"},An={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},In={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},On={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Tn=["disabled"],qn={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ne(()=>{s.item&&s.item.data&&(o.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const a=()=>{var c,d;o.value.brand&&u("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:o.value.class,brand:o.value.brand,model:o.value.model||"Unknown Model",year:o.value.date?new Date(o.value.date).getFullYear():"Unknown Year",km:o.value.km||"0",plate:o.value.plate||"",date:o.value.date||""},timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,d)=>(n(),l("div",Sn,[e("div",Dn,[e("div",null,[d[9]||(d[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),N(e("select",{"onUpdate:modelValue":d[0]||(d[0]=i=>o.value.class=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...d[8]||(d[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[re,o.value.class]])]),e("div",An,[e("div",null,[d[10]||(d[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),N(e("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=i=>o.value.brand=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.brand]])]),e("div",null,[d[11]||(d[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),N(e("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>o.value.model=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.model]])])]),e("div",null,[d[12]||(d[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),N(e("input",{type:"text","onUpdate:modelValue":d[3]||(d[3]=i=>o.value.version=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.version]])]),e("div",In,[e("div",null,[d[13]||(d[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),N(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=i=>o.value.km=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.km]])]),e("div",null,[d[14]||(d[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),N(e("input",{type:"text","onUpdate:modelValue":d[5]||(d[5]=i=>o.value.plate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.plate]])])]),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),N(e("input",{type:"date","onUpdate:modelValue":d[6]||(d[6]=i=>o.value.date=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.date]])])]),e("div",On,[e("button",{onClick:d[7]||(d[7]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:a,disabled:!o.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Tn)])]))}},Nn={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Mn={class:"flex justify-between items-center mb-4"},jn={class:"text-sm font-bold text-slate-800"},Rn={class:"space-y-4"},Vn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ln={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Un=["disabled"],En={__name:"PurchaseWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$({brand:"",model:"",year:"",price:"",purchaseDate:"",notes:""});ne(()=>{s.item&&s.item.data&&(o.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",purchaseDate:s.item.data.purchaseDate||"",notes:s.item.data.notes||""})});const a=q(()=>o.value.brand&&o.value.model&&o.value.price),c=()=>{var d,i;a.value&&u("save",{id:((d=s.item)==null?void 0:d.id)||Date.now(),type:"purchase",action:s.item?"updated a purchase":"added a purchase",data:{brand:o.value.brand,model:o.value.model,year:o.value.year||new Date().getFullYear(),price:o.value.price,purchaseDate:o.value.purchaseDate||new Date().toISOString().split("T")[0],notes:o.value.notes||""},timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(d,i)=>(n(),l("div",Nn,[i[15]||(i[15]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Mn,[e("h5",jn,v(t.item?"Edit Purchase":"Add Purchase"),1),e("button",{onClick:i[0]||(i[0]=r=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",Rn,[e("div",Vn,[e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),N(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=r=>o.value.brand=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.brand]])]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),N(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=r=>o.value.model=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.model]])])]),e("div",Fn,[e("div",null,[i[11]||(i[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),N(e("input",{type:"number","onUpdate:modelValue":i[3]||(i[3]=r=>o.value.year=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.year]])]),e("div",null,[i[12]||(i[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Price (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=r=>o.value.price=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.price]])])]),e("div",null,[i[13]||(i[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":i[5]||(i[5]=r=>o.value.purchaseDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,o.value.purchaseDate]])]),e("div",null,[i[14]||(i[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes",-1)),N(e("textarea",{"onUpdate:modelValue":i[6]||(i[6]=r=>o.value.notes=r),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Additional purchase details..."},null,512),[[F,o.value.notes]])])]),e("div",Ln,[e("button",{onClick:i[7]||(i[7]=r=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:c,disabled:!a.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Un)])]))}},Bn=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function Wn(t){const{store:y,taskId:s,getTabForItemType:u,isOverviewModalAction:o}=t,a=$("overview"),c=$(null),d=$(null),i=$("email"),r=$([]),b=q(()=>[...y.currentActivities.value,...r.value.filter(V=>!V.activityId)].filter(V=>{const L=u(V.type);return a.value==="overview"?L==="overview":L===a.value})),m=T=>(d.value=null,a.value==="overview"&&o(T)?{modalAction:T}:(["email","whatsapp","sms"].includes(T)?(i.value=T,c.value="communication"):c.value=T,null)),p=async T=>{var V;if(T.isEdit){const L=r.value.findIndex(Q=>Q.id===T.id);L>-1&&(r.value[L]={...r.value[L],...T}),(V=d.value)!=null&&V.activityId&&await y.updateActivity(s.value,d.value.activityId,{type:T.communicationType||T.type,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data})}else{const L=T.communicationType||T.type,Q=await y.addActivity(s.value,{type:L,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data});r.value.push({id:Q.id,type:L==="email"||L==="whatsapp"||L==="sms"?"communication":L,action:T.action,content:T.content,fileName:T.fileName,data:T.data,timestamp:Q.timestamp,activityId:Q.id})}c.value=null,d.value=null},h=()=>{c.value=null,d.value=null},g=T=>{d.value=T,c.value=T.type},C=async T=>{const V=r.value.findIndex(L=>L.id===T.id);V>-1&&r.value.splice(V,1),T.activityId&&await y.deleteActivity(s.value,T.activityId)};return oe(a,()=>{c.value=null,d.value=null}),{activeTab:a,showInlineWidget:c,editingItem:d,communicationType:i,inlineContent:r,filteredInlineContent:b,handleAddNewAction:m,handleWidgetSave:p,handleWidgetCancel:h,handleEditItem:g,handleDeleteItem:C}}const Pn={class:"flex-1 flex flex-col overflow-hidden"},zn={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Yn={class:"px-4 md:px-8 py-4 md:py-6"},Qn={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Hn={class:"flex items-center justify-between mb-4"},Jn={key:0,class:"mb-6"},Kn={key:1,class:"space-y-6 mb-6"},Gn={key:3},Xn={key:4,class:"space-y-4 mb-6 px-1"},Zn={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},_n={class:"p-6"},ea={class:"flex justify-between items-center mb-4"},ta={class:"text-sm font-bold text-slate-800"},sa={key:1,class:"max-w-2xl w-full max-h-[90vh] overflow-y-auto"},oa={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const y=t,s=q(()=>y.task.id),u=$(!1),o=$(null),{activeTab:a,showInlineWidget:c,editingItem:d,communicationType:i,inlineContent:r,filteredInlineContent:b,handleAddNewAction:m,handleWidgetSave:p,handleWidgetCancel:h,handleEditItem:g,handleDeleteItem:C}=Wn({store:y.storeAdapter,taskId:s,getTabForItemType:Bn,isOverviewModalAction:D=>a.value==="overview"&&y.addNewConfig.overviewActions.includes(D)}),T=D=>{const O=m(D);O&&O.modalAction&&(o.value=O.modalAction,u.value=!0)},V=()=>{u.value=!1,o.value=null},L=async D=>{await p(D),V()},Q=q(()=>{const D=[...y.storeAdapter.currentActivities.value,...r.value],O=D.length,x=D.filter(w=>["call","email","sms","whatsapp","communication"].includes(w.type)).length,I=D.filter(w=>w.type==="note").length,M=D.filter(w=>w.type==="attachment").length;return[{key:"overview",label:"Overview",count:O},{key:"note",label:"Notes",count:I},{key:"communication",label:"Communication",count:x},{key:"attachment",label:"Attachments",count:M}]}),se=q(()=>[...y.storeAdapter.currentActivities.value,...r.value]);return(D,O)=>(n(),l("div",Pn,[e("header",zn,[e("div",Yn,[P(ks,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:fe(()=>[(n(!0),l(Y,null,_(t.task.tags,x=>(n(),l("span",{key:x,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},v(x),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class"])])]),e("main",Qn,[e("div",Hn,[P(Ss,{modelValue:W(a),"onUpdate:modelValue":O[0]||(O[0]=x=>lt(a)?a.value=x:null),tabs:Q.value,class:"mb-0"},null,8,["modelValue","tabs"]),W(a)==="overview"&&t.addNewConfig.overviewActions.length?(n(),B(je,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":W(a),inline:!0,onAction:T},null,8,["actions","active-tab"])):f("",!0)]),W(a)==="overview"?(n(),l("div",Jn,[P(Ls,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||"",probability:t.task.probability},null,8,["stage","owner","source","probability"])])):f("",!0),W(a)==="overview"?(n(),l("div",Kn,[(n(),B(rt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:se.value},null,8,["lead","opportunity","activities"])),me(D.$slots,"pinned-extra",{task:t.task})])):f("",!0),W(a)!=="overview"?(n(),B(je,{key:2,actions:t.addNewConfig.tabActions,"active-tab":W(a),onAction:T},null,8,["actions","active-tab"])):f("",!0),W(a)!=="overview"?(n(),l("div",Gn,[W(c)==="communication"?(n(),B(sn,{key:0,type:W(i),"task-type":t.type,"task-id":t.task.id,onSave:W(p),onCancel:W(h)},null,8,["type","task-type","task-id","onSave","onCancel"])):f("",!0),W(c)==="note"?(n(),B(rn,{key:1,item:W(d),"task-type":t.type,"task-id":t.task.id,onSave:W(p),onCancel:W(h)},null,8,["item","task-type","task-id","onSave","onCancel"])):f("",!0),W(c)==="attachment"?(n(),B(fn,{key:2,item:W(d),"task-type":t.type,"task-id":t.task.id,onSave:W(p),onCancel:W(h)},null,8,["item","task-type","task-id","onSave","onCancel"])):f("",!0)])):f("",!0),W(b).length>0?(n(),l("div",Xn,[(n(!0),l(Y,null,_(W(b),x=>(n(),B(Xo,{key:x.id,item:x,"task-type":t.type,"customer-initials":"SK",onEdit:W(g),onDelete:W(C)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):f("",!0)]),(n(),B(ie,{to:"body"},[u.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:H(V,["self"])},[o.value==="financing"||o.value==="tradein"?(n(),l("div",Zn,[e("div",_n,[e("div",ea,[e("h5",ta,v(o.value==="financing"?"Add Financing":"Add Trade-in"),1),e("button",{onClick:V,class:"text-gray-400 hover:text-gray-600"},[...O[1]||(O[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),o.value==="financing"?(n(),B($n,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:V},null,8,["task-type","task-id"])):f("",!0),o.value==="tradein"?(n(),B(qn,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:V},null,8,["task-type","task-id"])):f("",!0)])])):f("",!0),o.value==="purchase"?(n(),l("div",sa,[P(En,{item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:V},null,8,["task-type","task-id"])])):f("",!0)])):f("",!0)]))]))}},na={key:0,class:"mb-8"},aa={class:"flex items-center gap-2 mb-4"},la={class:"font-bold text-gray-800 text-sm"},ra={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},ia={class:"p-4"},da={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},ua={class:"text-sm text-slate-700 leading-snug"},ca={class:"flex items-center justify-between"},pa={class:"flex items-center gap-4"},ma={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},ya=["src"],ga={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},va={class:"flex items-center gap-2"},fa={class:"font-bold text-slate-800 text-sm md:text-base"},ba={class:"mt-1.5"},xa={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},ha={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},wa={class:"flex items-center gap-4"},ka={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},Ca={key:1,class:"text-right"},$a={class:"font-bold text-slate-800"},Sa={class:"border-t border-gray-200"},Da={class:"font-medium"},Aa={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Ia={class:"mb-6"},Oa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ta={key:0},qa={class:"font-medium text-slate-700"},Na={key:1},Ma={class:"font-medium text-slate-700"},ja={key:2},Ra={class:"font-medium text-slate-700"},Va={class:"font-medium text-slate-700"},Fa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},La={key:0},Ua={class:"font-medium text-slate-700"},Ea={key:1},Ba={class:"font-medium text-slate-700"},Wa={key:2},Pa={class:"font-medium text-slate-700"},za={key:3},Ya={class:"font-medium text-slate-700"},Qa={key:4},Ha={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Ja={key:5},Ka={class:"font-medium text-slate-700"},Ga={key:0,class:"mt-6 flex justify-end"},Re={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const y=$(!1),s=o=>new Intl.NumberFormat("en-US").format(o),u=o=>new Intl.NumberFormat("en-US").format(o);return(o,a)=>t.show?(n(),l("div",na,[e("div",aa,[a[1]||(a[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",la,v(t.label),1)]),e("div",ra,[e("div",ia,[t.requestMessage?(n(),l("div",da,[a[2]||(a[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",ua,v(t.requestMessage),1)])):f("",!0),e("div",ca,[e("div",pa,[e("div",ma,[t.image?(n(),l("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ya)):(n(),l("i",ga))]),e("div",null,[e("div",va,[e("div",fa,v(t.brand)+" "+v(t.model)+" ("+v(t.year)+")",1)]),e("div",ba,[t.stockDays!==void 0&&t.stockDays!==null?(n(),l("div",xa,[a[3]||(a[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),R(" In stock ("+v(t.stockDays)+" days) ",1)])):(n(),l("div",ha,[...a[4]||(a[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),R(" Out of stock ",-1)])]))])])]),e("div",wa,[t.showOpenAd&&t.price?(n(),l("button",ka,[...a[5]||(a[5]=[R(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):f("",!0),t.price?(n(),l("div",Ca,[a[6]||(a[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",$a,"€ "+v(s(t.price)),1)])):f("",!0)])])]),e("div",Sa,[e("button",{onClick:a[0]||(a[0]=c=>y.value=!y.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",Da,v(y.value?"Hide":"View")+" Details",1),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":y.value}])},null,2)])]),y.value?(n(),l("div",Aa,[e("div",Ia,[a[17]||(a[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Oa,[t.requestType?(n(),l("div",Ta,[a[7]||(a[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",qa,v(t.requestType),1)])):f("",!0),t.source?(n(),l("div",Na,[a[8]||(a[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Ma,v(t.source),1)])):f("",!0),e("div",null,[a[9]||(a[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:j(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},v(t.sourceDetails||"--"),3)]),t.dealership?(n(),l("div",ja,[a[10]||(a[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ra,v(t.dealership),1)])):f("",!0),e("div",null,[a[11]||(a[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Va,v(t.channel||"Email"),1)]),e("div",null,[a[12]||(a[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:j(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},v(t.adCampaign||"--"),3)]),e("div",null,[a[13]||(a[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:j(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},v(t.adMedium||"--"),3)]),e("div",null,[a[14]||(a[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:j(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},v(t.adSource||"--"),3)]),e("div",null,[a[15]||(a[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:j(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},v(t.expectedPurchaseDate||"--"),3)]),e("div",null,[a[16]||(a[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:j(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},v(t.fiscalEntity||"--"),3)])])]),a[26]||(a[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[a[25]||(a[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Fa,[t.registration?(n(),l("div",La,[a[18]||(a[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Ua,v(t.registration),1)])):f("",!0),t.kilometers!==void 0&&t.kilometers!==null?(n(),l("div",Ea,[a[19]||(a[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ba,v(u(t.kilometers))+" Km",1)])):f("",!0),t.fuelType?(n(),l("div",Wa,[a[20]||(a[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Pa,v(t.fuelType),1)])):f("",!0),t.gearType?(n(),l("div",za,[a[21]||(a[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Ya,v(t.gearType),1)])):f("",!0),t.vin?(n(),l("div",Qa,[a[22]||(a[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Ha,v(t.vin),1)])):f("",!0),t.dealership?(n(),l("div",Ja,[a[23]||(a[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ka,v(t.dealership),1)])):f("",!0)]),t.showTechnicalSpecs?(n(),l("div",Ga,[...a[24]||(a[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),R(" View technical specs ")],-1)])])):f("",!0)])])):f("",!0)])])):f("",!0)}},Xa={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Za={class:"grid grid-cols-3 gap-3 mb-4"},_a={class:"flex gap-3 mb-4"},Ee={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:y}){const s=y,u=$(null),o=$(""),a=$(""),c=r=>{u.value=r;const b=new Date;if(r==="later-today"){const m=new Date(b.getTime()+72e5);o.value=m.toISOString().split("T")[0],a.value=m.toTimeString().slice(0,5)}else if(r==="tomorrow"){const m=new Date(b);m.setDate(m.getDate()+1),o.value=m.toISOString().split("T")[0],a.value="09:00"}else if(r==="next-week"){const m=new Date(b);m.setDate(m.getDate()+(7-m.getDay()+1)),o.value=m.toISOString().split("T")[0],a.value="09:00"}},d=()=>{s("confirm",{date:o.value,time:a.value,option:u.value}),s("close"),u.value=null,o.value="",a.value=""},i=()=>{s("close"),u.value=null,o.value="",a.value=""};return(r,b)=>t.show?(n(),l("div",Xa,[b[8]||(b[8]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},"Reschedule to...",-1)),e("div",Za,[e("button",{onClick:b[0]||(b[0]=m=>c("later-today")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="later-today"}])},[...b[5]||(b[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:b[1]||(b[1]=m=>c("tomorrow")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="tomorrow"}])},[...b[6]||(b[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:b[2]||(b[2]=m=>c("next-week")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="next-week"}])},[...b[7]||(b[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",_a,[N(e("input",{"onUpdate:modelValue":b[3]||(b[3]=m=>o.value=m),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[F,o.value]]),N(e("input",{"onUpdate:modelValue":b[4]||(b[4]=m=>a.value=m),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[F,a.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:i,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:d,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):f("",!0)}},el={key:0,class:"space-y-4 animate-fade-in"},tl={key:0,class:"animate-fade-in"},sl={class:"grid grid-cols-4 gap-2"},ol=["onClick"],Be={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(""),a=$("Michael Thomas (Me)"),c=$(""),d=$(!1),i=$("");oe(()=>s.show,p=>{p||r()});const r=()=>{o.value="",a.value="Michael Thomas (Me)",c.value="",d.value=!1,i.value=""},b=()=>{!o.value||!c.value||!i.value||(u("confirm",{type:o.value,assignee:a.value,date:c.value,time:i.value}),r())},m=()=>{r(),u("cancel")};return(p,h)=>t.show?(n(),l("div",el,[e("div",null,[h[5]||(h[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),N(e("select",{"onUpdate:modelValue":h[0]||(h[0]=g=>o.value=g),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...h[4]||(h[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[re,o.value]])]),e("div",null,[h[7]||(h[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),N(e("select",{"onUpdate:modelValue":h[1]||(h[1]=g=>a.value=g),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...h[6]||(h[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[re,a.value]])]),e("div",null,[h[8]||(h[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":h[2]||(h[2]=g=>c.value=g),onChange:h[3]||(h[3]=g=>d.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[F,c.value]])]),d.value?(n(),l("div",tl,[h[9]||(h[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",sl,[(n(),l(Y,null,_(["09:00","10:30","11:00","14:30","15:00","16:30"],g=>e("button",{key:g,onClick:C=>i.value=g,class:j(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",i.value===g?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},v(g),11,ol)),64))])])):f("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:m,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:b,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...h[10]||(h[10]=[R(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):f("",!0)}},nl={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},al={class:"p-6 space-y-6"},ll={class:"flex gap-6"},rl={class:"flex items-center gap-2 cursor-pointer"},il={class:"flex items-center gap-2 cursor-pointer"},dl={class:"p-6 bg-gray-50 flex justify-between gap-3 border-t border-gray-100"},ul=["disabled"],cl={__name:"DisqualifyModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$("Not Interested"),a=$("");oe(()=>s.show,i=>{i&&(o.value="Not Interested",a.value="")});const c=()=>{u("confirm",{category:o.value,reason:a.value})},d=()=>{u("cancel")};return(i,r)=>(n(),B(ie,{to:"body"},[t.show?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(d,["self"])},[e("div",nl,[r[8]||(r[8]=e("div",{class:"p-6 border-b border-gray-100"},[e("h3",{class:"font-bold text-2xl text-gray-900"},"Disqualify Lead"),e("p",{class:"text-sm text-gray-500 mt-1"},"Please select a reason for disqualification.")],-1)),e("div",al,[e("div",null,[r[5]||(r[5]=e("label",{class:"block label-upper mb-3"},"Category",-1)),e("div",ll,[e("label",rl,[N(e("input",{type:"radio","onUpdate:modelValue":r[0]||(r[0]=b=>o.value=b),value:"Not Valid",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,o.value]]),r[3]||(r[3]=e("span",{class:"text-base text-gray-700"},"Not Valid",-1))]),e("label",il,[N(e("input",{type:"radio","onUpdate:modelValue":r[1]||(r[1]=b=>o.value=b),value:"Not Interested",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,o.value]]),r[4]||(r[4]=e("span",{class:"text-base text-gray-700"},"Not Interested",-1))])])]),e("div",null,[r[7]||(r[7]=e("label",{class:"block label-upper mb-3"},"Failure Reason",-1)),N(e("select",{"onUpdate:modelValue":r[2]||(r[2]=b=>a.value=b),class:"w-full bg-white border-2 border-red-500 rounded-lg px-4 py-3 text-base text-gray-700 focus:outline-none focus:border-red-600 transition-colors"},[...r[6]||(r[6]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[re,a.value]])])]),e("div",dl,[e("button",{onClick:d,class:"text-gray-700 font-medium px-6 py-3 rounded-lg text-base hover:bg-gray-100 transition-colors"}," Cancel "),e("button",{onClick:c,disabled:!o.value||!a.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-6 py-3 rounded-lg text-base transition-colors"}," Confirm Disqualification ",8,ul)])])])):f("",!0)]))}},pl={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},ml={class:"p-5 space-y-6"},yl={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},gl={class:"flex justify-between items-start mb-3"},vl={class:"text-xs text-gray-500 mt-0.5"},fl={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},bl={key:0},xl={key:1},hl={class:"flex gap-3 flex-wrap"},wl={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},kl={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},Cl={class:"flex items-center gap-1.5"},$l={class:"text-xs font-mono text-red-400"},Sl={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},Dl={class:"font-bold"},Al={key:1,class:"mt-3 space-y-2"},Il={class:"text-xs text-slate-600 leading-relaxed"},Ol={key:2,class:"mt-3 relative z-10"},Tl={class:"relative"},ql=["onKeyup"],Nl={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},Ml=["disabled"],jl={key:0,class:"fa-solid fa-spinner fa-spin"},Rl={key:1,class:"fa-solid fa-magic"},Vl={class:"bg-gray-50 border-t border-gray-200"},Fl={class:"p-4 flex justify-end gap-3"},Ll={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Ul={class:"mb-5"},El={class:"flex flex-col gap-2"},Bl={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},Wl=["checked"],Pl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},setup(t){const y=t,s=Fe(),u=$(!1),o=$(!1),a=$(!1),c=$(!1),d=$([]),i=$(0),r=$([]),b=$(""),m=$("qualify"),p=$(null),h=$(null),g=$(0),C=$(!1),T=$([]),V=$(!1),L=[{speaker:"Sales",text:"Good morning, am I speaking with Mr. Adams?"},{speaker:"Lead",text:"Yes, this is Josh Adams speaking."},{speaker:"Sales",text:"Hi Josh, Michael here regarding your Audi A6 inquiry."},{speaker:"Lead",text:"Oh, hi Michael! Yes, I was waiting for your call."},{speaker:"Sales",text:"Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"},{speaker:"Lead",text:"Yes, I actually have a BMW X3, 2018 model with about 45,000 km.",action:{type:"tradein",data:{brand:"BMW",model:"X3",year:"2018",km:"45,000",auto:!0}}},{speaker:"Sales",text:"Excellent, we can certainly evaluate that. And regarding payment?"},{speaker:"Lead",text:"I'd like to put down €5,000 and finance the rest over 3 years.",action:{type:"financing",data:{product:"Standard Loan",provider:"Audi Financial",total:"14,000",monthly:"420",auto:!0}}},{speaker:"Sales",text:"Understood. I'll note that down and prepare the proposal.",action:{type:"note",data:"Customer requests 3-year financing with €5k deposit."}},{speaker:"Lead",text:"Sounds amazing. Let's proceed with the paperwork."}],Q=U=>{const S=Math.floor(U/60),J=U%60;return`${S.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`},se=()=>{c.value=!c.value,c.value?(i.value=0,g.value=0,r.value=[],C.value=!1,T.value=[],p.value=setInterval(()=>{i.value++},1e3),h.value=setInterval(()=>{if(g.value<L.length){const U=L[g.value];r.value.push({speaker:U.speaker,text:U.text}),g.value++,r.value.length>4&&r.value.shift()}else clearInterval(h.value),clearInterval(p.value),C.value=!0,D()},2500)):(p.value&&clearInterval(p.value),h.value&&clearInterval(h.value),C.value=!1,d.value.length>0&&D())},D=async()=>{for(const U of d.value)await s.addActivity(y.lead.id,{type:"note",user:"You",action:"added a note",content:U});d.value=[]},O=async()=>{V.value=!0,await new Promise(U=>setTimeout(U,800));for(let U=0;U<L.length;U++){const S=L[U];S.action&&!T.value.includes(U)&&(S.action.type==="tradein"?w(S.action.data):S.action.type==="financing"?z(S.action.data):S.action.type==="note"&&M(S.action.data),T.value.push(U))}V.value=!1,c.value=!1,C.value=!1},x=()=>{navigator.clipboard.writeText(y.lead.customer.phone)},I=()=>{b.value.trim()&&(d.value.push(b.value),b.value="")},M=U=>{s.addActivity(y.lead.id,{type:"note",user:"You",action:"added a note",content:U,data:{autoDetected:!0}})},w=U=>{s.addActivity(y.lead.id,{type:"tradein",user:"You",action:"added a trade-in",data:{...U,autoDetected:U.auto||!1}})},z=U=>{s.addActivity(y.lead.id,{type:"financing",user:"You",action:"added a financing proposal",data:{...U,autoDetected:U.auto||!1}})},be=()=>{u.value=!u.value,o.value=!1},xe=()=>{o.value=!o.value,u.value=!1},ke=U=>{u.value=!1},Ce=U=>{m.value="qualify",o.value=!1},$e=()=>{o.value=!1},Se=async()=>{try{await s.requalifyLead(y.lead.id),await s.loadLeadById(y.lead.id)}catch(U){console.error("Failed to requalify lead:",U)}},De=async U=>{try{await s.modifyLead(y.lead.id,{isDisqualified:!0,disqualifyReason:U.reason,status:"Disqualified"}),await s.addActivity(y.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${U.category}, Reason: ${U.reason}`}),a.value=!1,await s.loadLeadById(y.lead.id)}catch(S){console.error("Failed to disqualify lead:",S)}};return(U,S)=>t.lead?(n(),l("div",pl,[S[28]||(S[28]=it('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage Next steps</h3></div><span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium">Task pending</span></div>',1)),e("div",ml,[e("div",yl,[e("div",gl,[e("div",null,[S[8]||(S[8]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Initial Contact",-1)),e("p",vl," Call customer to discuss "+v(t.lead.requestedCar.brand)+" "+v(t.lead.requestedCar.model)+" interest. ",1)]),e("div",fl,[c.value?(n(),l("span",xl,[...S[10]||(S[10]=[R("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(n(),l("span",bl,[...S[9]||(S[9]=[R("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",hl,[e("button",{onClick:se,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[R(v(t.lead.customer.phone)+" Call ",1),S[11]||(S[11]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:x,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...S[12]||(S[12]=[R(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),c.value&&!C.value?(n(),l("div",wl,[e("div",kl,[S[14]||(S[14]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",Cl,[S[13]||(S[13]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",$l,"REC "+v(Q(i.value)),1)])]),e("div",Sl,[(n(!0),l(Y,null,_(r.value,(J,ge)=>(n(),l("div",{key:ge,class:j(["text-xs font-mono transition-all duration-500",J.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",Dl,v(J.speaker)+":",1),S[15]||(S[15]=R()),e("span",null,v(J.text),1)],2))),128))])])):f("",!0),c.value&&!C.value&&d.value.length>0?(n(),l("div",Al,[(n(!0),l(Y,null,_(d.value,(J,ge)=>(n(),l("div",{key:ge,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[S[16]||(S[16]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",Il,v(J),1)]))),128))])):f("",!0),c.value&&!C.value?(n(),l("div",Ol,[e("div",Tl,[N(e("textarea",{"onUpdate:modelValue":S[0]||(S[0]=J=>b.value=J),onKeyup:dt(H(I,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,ql),[[F,b.value]]),e("button",{onClick:I,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...S[17]||(S[17]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):f("",!0),c.value&&C.value?(n(),l("div",Nl,[S[18]||(S[18]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:O,disabled:V.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[V.value?(n(),l("i",jl)):(n(),l("i",Rl)),e("span",null,v(V.value?"Extracting...":"Extract information from transcription"),1)],8,Ml)])):f("",!0)])]),e("div",Vl,[e("div",Fl,[t.lead.isDisqualified?(n(),l("button",{key:0,onClick:Se,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...S[19]||(S[19]=[R(" Requalify ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])):(n(),l(Y,{key:1},[e("button",{onClick:S[1]||(S[1]=J=>a.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...S[20]||(S[20]=[R(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:be,class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...S[21]||(S[21]=[R(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:xe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...S[22]||(S[22]=[R(" Qualify ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])],64))]),P(Ee,{show:u.value,onClose:S[2]||(S[2]=J=>u.value=!1),onConfirm:ke},null,8,["show"]),o.value?(n(),l("div",Ll,[S[27]||(S[27]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Qualify",-1)),e("div",Ul,[S[25]||(S[25]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",El,[e("label",Bl,[N(e("input",{type:"radio","onUpdate:modelValue":S[3]||(S[3]=J=>m.value=J),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[we,m.value]]),S[23]||(S[23]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:S[5]||(S[5]=H(J=>m.value=m.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:m.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:S[4]||(S[4]=H(()=>{},["stop"]))},null,8,Wl),S[24]||(S[24]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),m.value==="schedule"?(n(),B(Be,{key:0,show:m.value==="schedule",onConfirm:Ce,onCancel:S[6]||(S[6]=J=>m.value="qualify")},null,8,["show"])):f("",!0),m.value!=="schedule"?(n(),l("button",{key:1,onClick:$e,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...S[26]||(S[26]=[R(" Qualify ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):f("",!0)])):f("",!0)]),P(cl,{show:a.value,onConfirm:De,onCancel:S[7]||(S[7]=J=>a.value=!1)},null,8,["show"])])):f("",!0)}},zl={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 overflow-hidden"},Yl={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Ql={class:"text-lg font-bold text-gray-900"},Hl={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:y}){const s=y,u=()=>{s("close")};return(o,a)=>(n(),B(ie,{to:"body"},[t.show?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(u,["self"])},[e("div",zl,[e("div",Yl,[e("h3",Ql,v(t.title),1),e("button",{onClick:u,class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"},[...a[0]||(a[0]=[e("i",{class:"fa-solid fa-times text-sm"},null,-1)])])]),a[1]||(a[1]=e("div",{class:"px-6 py-12 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:u,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])])])):f("",!0)]))}},Jl={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},Kl={class:"p-5 space-y-4"},Gl={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},Xl=["disabled"],Zl={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(""),a=$("");oe(()=>s.show,i=>{i&&(o.value="",a.value="")});const c=()=>{o.value&&u("confirm",{reason:o.value,notes:a.value})},d=()=>{u("cancel")};return(i,r)=>(n(),B(ie,{to:"body"},[t.show?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(d,["self"])},[e("div",Jl,[r[5]||(r[5]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Close as Lost"),e("p",{class:"text-xs text-gray-500 mt-1"},"Document why this opportunity didn't close")],-1)),e("div",Kl,[e("div",null,[r[3]||(r[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),N(e("select",{"onUpdate:modelValue":r[0]||(r[0]=b=>o.value=b),class:"input"},[...r[2]||(r[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[re,o.value]])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),N(e("textarea",{"onUpdate:modelValue":r[1]||(r[1]=b=>a.value=b),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[F,a.value]])])]),e("div",Gl,[e("button",{onClick:d,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:c,disabled:!o.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Xl)])])])):f("",!0)]))}},_l={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},er={class:"p-5 space-y-4"},tr=["max"],sr={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},or=["disabled"],nr={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(""),a=$(""),c=$(""),d=q(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,b=>{if(b){const m=new Date;o.value=m.toISOString().split("T")[0],a.value=m.toTimeString().slice(0,5),c.value=""}});const i=()=>{if(!o.value)return;const b=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;u("confirm",{contractDate:b,notes:c.value})},r=()=>{u("cancel")};return(b,m)=>(n(),B(ie,{to:"body"},[t.show?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(r,["self"])},[e("div",_l,[m[6]||(m[6]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Set Contract Signing Date"),e("p",{class:"text-xs text-gray-500 mt-1"},"Record when the contract was signed to track delivery timeline")],-1)),e("div",er,[e("div",null,[m[3]||(m[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=p=>o.value=p),max:d.value,class:"input"},null,8,tr),[[F,o.value]])]),e("div",null,[m[4]||(m[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),N(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=p=>a.value=p),class:"input"},null,512),[[F,a.value]])]),e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),N(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=p=>c.value=p),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[F,c.value]])])]),e("div",sr,[e("button",{onClick:r,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:i,disabled:!o.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,or)])])])):f("",!0)]))}},ar={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},lr={class:"p-5 space-y-4"},rr=["max"],ir={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},dr=["disabled"],ur={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(""),a=$(""),c=$(""),d=$(""),i=q(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,m=>{if(m){const p=new Date;o.value=p.toISOString().split("T")[0],a.value=p.toTimeString().slice(0,5),c.value="",d.value=""}});const r=()=>{if(!o.value||!c.value)return;const m=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;u("confirm",{deliveryDate:m,location:c.value,notes:d.value})},b=()=>{u("cancel")};return(m,p)=>(n(),B(ie,{to:"body"},[t.show?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(b,["self"])},[e("div",ar,[p[9]||(p[9]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Mark as Delivered"),e("p",{class:"text-xs text-gray-500 mt-1"},"Record the vehicle delivery date and details")],-1)),e("div",lr,[e("div",null,[p[4]||(p[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),N(e("input",{type:"date","onUpdate:modelValue":p[0]||(p[0]=h=>o.value=h),max:i.value,class:"input"},null,8,rr),[[F,o.value]])]),e("div",null,[p[5]||(p[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),N(e("input",{type:"time","onUpdate:modelValue":p[1]||(p[1]=h=>a.value=h),class:"input"},null,512),[[F,a.value]])]),e("div",null,[p[7]||(p[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),N(e("select",{"onUpdate:modelValue":p[2]||(p[2]=h=>c.value=h),class:"input"},[...p[6]||(p[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[re,c.value]])]),e("div",null,[p[8]||(p[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),N(e("textarea",{"onUpdate:modelValue":p[3]||(p[3]=h=>d.value=h),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[F,d.value]])])]),e("div",ir,[e("button",{onClick:b,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:r,disabled:!o.value||!c.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,dr)])])])):f("",!0)]))}},cr={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},pr={class:"flex justify-between items-center mb-4"},mr={class:"text-sm font-bold text-slate-800"},yr={key:0,class:"mb-4"},gr={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},vr={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},fr=["src"],br={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},xr={class:"flex-1 min-w-0"},hr={class:"flex items-center gap-2 flex-wrap"},wr={class:"font-bold text-sm text-gray-800 truncate"},kr={class:"text-xs text-gray-500"},Cr={key:0,class:"text-[10px] text-green-600 mt-0.5"},$r={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Sr=["onClick"],Dr={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Ar=["src"],Ir={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Or={class:"flex-1 min-w-0"},Tr={class:"flex items-center gap-2 flex-wrap"},qr={class:"font-bold text-sm text-gray-800 truncate"},Nr={class:"text-xs text-gray-500"},Mr={key:0,class:"text-[10px] text-green-600 mt-0.5"},jr={key:1,class:"text-center py-4 text-gray-400 text-sm"},Rr={class:"mb-4"},Vr={key:0,class:"flex items-center gap-2 mb-2"},Fr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Lr={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Ur={class:"mt-4"},Er={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Br=["disabled"],Wr={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:y}){const s=t,u=y,o=$(null),a=$(null),c=$({brand:"",model:"",year:"",price:"",image:""});ne(()=>{s.item&&s.item.data&&(c.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const d=m=>{if(o.value=m,s.requestedCar){const p=m.id&&s.requestedCar.id&&m.id===s.requestedCar.id||m.brand===s.requestedCar.brand&&m.model===s.requestedCar.model&&m.year===s.requestedCar.year;a.value=p?"requested":"recommended"}else a.value="recommended";c.value={brand:m.brand||"",model:m.model||"",year:m.year||new Date().getFullYear(),price:m.price||"",image:m.image||""}},i=q(()=>o.value||c.value.brand&&c.value.model&&c.value.price),r=m=>new Intl.NumberFormat("en-US").format(m),b=()=>{var p,h;const m=o.value||c.value;u("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:m.brand,model:m.model,year:m.year||new Date().getFullYear(),price:m.price,image:m.image||"",isMainOffer:!1},timestamp:((h=s.item)==null?void 0:h.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(m,p)=>{var h,g;return n(),l("div",cr,[e("div",pr,[e("h5",mr,v(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:p[0]||(p[0]=C=>m.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...p[8]||(p[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?f("",!0):(n(),l("div",yr,[p[11]||(p[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",gr,[t.requestedCar?(n(),l("div",{key:0,onClick:p[1]||(p[1]=C=>d(t.requestedCar)),class:j(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((h=o.value)==null?void 0:h.id)===t.requestedCar.id}])},[e("div",vr,[t.requestedCar.image?(n(),l("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,fr)):(n(),l("i",br))]),e("div",xr,[e("div",hr,[e("h4",wr,v(t.requestedCar.brand)+" "+v(t.requestedCar.model)+" ("+v(t.requestedCar.year)+")",1),e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((g=o.value)==null?void 0:g.id)===t.requestedCar.id&&a.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",kr,"€ "+v(r(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(n(),l("div",Cr," In stock ("+v(t.requestedCar.stockDays)+" days) ",1)):(n(),l("div",$r," Out of stock "))]),p[9]||(p[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):f("",!0),(n(!0),l(Y,null,_(t.recommendedCars,C=>{var T,V;return n(),l("div",{key:C.id,onClick:L=>d(C),class:j(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((T=o.value)==null?void 0:T.id)===C.id}])},[e("div",Dr,[C.image?(n(),l("img",{key:0,src:C.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Ar)):(n(),l("i",Ir))]),e("div",Or,[e("div",Tr,[e("h4",qr,v(C.brand)+" "+v(C.model)+" ("+v(C.year)+")",1),e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((V=o.value)==null?void 0:V.id)===C.id&&a.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",Nr,"€ "+v(r(C.price)),1),C.stockDays!==null&&C.stockDays!==void 0?(n(),l("div",Mr," In stock ("+v(C.stockDays)+" days) ",1)):f("",!0)]),p[10]||(p[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Sr)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(n(),l("div",jr," No vehicles available ")):f("",!0)])])),e("div",Rr,[t.requestedCar||t.recommendedCars.length>0?(n(),l("div",Vr,[...p[12]||(p[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):f("",!0),e("div",Fr,[e("div",null,[p[13]||(p[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),N(e("input",{type:"text","onUpdate:modelValue":p[2]||(p[2]=C=>c.value.brand=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,c.value.brand]])]),e("div",null,[p[14]||(p[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),N(e("input",{type:"text","onUpdate:modelValue":p[3]||(p[3]=C=>c.value.model=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,c.value.model]])])]),e("div",Lr,[e("div",null,[p[15]||(p[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),N(e("input",{type:"number","onUpdate:modelValue":p[4]||(p[4]=C=>c.value.year=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,c.value.year]])]),e("div",null,[p[16]||(p[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),N(e("input",{type:"number","onUpdate:modelValue":p[5]||(p[5]=C=>c.value.price=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[F,c.value.price]])])]),e("div",Ur,[p[17]||(p[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),N(e("input",{type:"text","onUpdate:modelValue":p[6]||(p[6]=C=>c.value.image=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[F,c.value.image]])])]),e("div",Er,[e("button",{onClick:p[7]||(p[7]=C=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:b,disabled:!i.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Br)])])}}},Pr={key:0,class:"mb-8"},zr={class:"relative"},Yr={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},Qr={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},Hr=["src"],Jr={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},Kr={class:"p-4"},Gr={class:"font-bold text-gray-800 text-sm mb-1"},Xr={class:"text-xs text-gray-500 mb-2"},Zr={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},_r=["onClick"],ei={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:y}){const s=$([]);ne(()=>{s.value=Le.filter(o=>o.stockDays!==null&&o.stockDays!==void 0).slice(0,5)});const u=o=>new Intl.NumberFormat("en-US").format(o);return(o,a)=>s.value.length>0?(n(),l("div",Pr,[a[1]||(a[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",zr,[e("div",Yr,[(n(!0),l(Y,null,_(s.value,c=>(n(),l("div",{key:c.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",Qr,[c.image?(n(),l("img",{key:0,src:c.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Hr)):(n(),l("i",Jr))]),e("div",Kr,[e("h4",Gr,v(c.brand)+" "+v(c.model)+" ("+v(c.year)+")",1),e("p",Xr,"€ "+v(u(c.price)),1),c.stockDays!==null&&c.stockDays!==void 0?(n(),l("div",Zr,[a[0]||(a[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),R(" In stock ("+v(c.stockDays)+" days) ",1)])):f("",!0),e("button",{onClick:d=>o.$emit("add-to-opportunity",c),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,_r)])]))),128))])])])):f("",!0)}},ti=ut(ei,[["__scopeId","data-v-0d800814"]]),si={class:"mt-1.5 border-t border-gray-200 pt-1.5"},oi={key:1},ni={class:"flex items-center justify-between mb-1.5"},ai={class:"space-y-1.5"},li={class:"block label-upper mb-1"},ri=["onUpdate:modelValue","placeholder"],ii=["onUpdate:modelValue"],di=["value"],ui={key:2,class:"space-y-0.5"},ci=["onUpdate:modelValue","value"],pe={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=$(!1),a=$({});oe(()=>s.questions,b=>{const m={};b.forEach(p=>{m[p.key]=""}),a.value=m},{immediate:!0});const c=()=>{u("survey-completed",{...a.value}),r()},d=()=>{u("survey-refused"),r()},i=()=>{u("not-responding"),r()},r=()=>{o.value=!1;const b={};s.questions.forEach(m=>{b[m.key]=""}),a.value=b};return(b,m)=>(n(),l("div",si,[o.value?(n(),l("div",oi,[e("div",ni,[m[4]||(m[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:m[1]||(m[1]=p=>o.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...m[3]||(m[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",ai,[(n(!0),l(Y,null,_(t.questions,(p,h)=>(n(),l("div",{key:h,class:"bg-gray-50 rounded-md p-1.5"},[e("label",li,v(p.label),1),p.type==="text"?N((n(),l("textarea",{key:0,"onUpdate:modelValue":g=>a.value[p.key]=g,placeholder:p.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,ri)),[[F,a.value[p.key]]]):p.type==="select"?N((n(),l("select",{key:1,"onUpdate:modelValue":g=>a.value[p.key]=g,class:"input text-xs py-1 px-2"},[m[5]||(m[5]=e("option",{value:""},"Select an option...",-1)),(n(!0),l(Y,null,_(p.options,g=>(n(),l("option",{key:g,value:g},v(g),9,di))),128))],8,ii)),[[re,a.value[p.key]]]):p.type==="radio"?(n(),l("div",ui,[(n(!0),l(Y,null,_(p.options,g=>(n(),l("label",{key:g,class:"flex items-center text-xs"},[N(e("input",{type:"radio","onUpdate:modelValue":C=>a.value[p.key]=C,value:g,class:"mr-1"},null,8,ci),[[we,a.value[p.key]]]),R(" "+v(g),1)]))),128))])):f("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:i,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(n(),l("button",{key:0,onClick:m[0]||(m[0]=p=>o.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...m[2]||(m[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},pi={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},mi={class:"flex justify-between items-start mb-3"},yi={class:"text-xs text-gray-500 mt-0.5"},gi={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],a=q(()=>{if(!s.opportunity.createdAt)return 0;const p=new Date(s.opportunity.createdAt),g=Math.abs(new Date-p);return Math.ceil(g/(1e3*60*60*24))}),c=()=>{u("create-offer",s.opportunity)},d=()=>{u("review",s.opportunity)},i=()=>{u("close-lost",s.opportunity)},r=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},b=()=>{u("survey-refused",{opportunity:s.opportunity})},m=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,h)=>(n(),l("div",pi,[e("div",mi,[e("div",null,[h[0]||(h[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",yi,"This opportunity has been open for "+v(a.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity "),e("button",{onClick:i,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),P(pe,{questions:o,onSurveyCompleted:r,onSurveyRefused:b,onNotResponding:m})]))}},vi={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},fi={class:"flex justify-between items-start mb-3"},bi={class:"text-xs text-gray-500 mt-0.5"},xi={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","mark-unsold","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],a=q(()=>{if(!s.opportunity.createdAt)return 0;const m=new Date(s.opportunity.createdAt),h=Math.abs(new Date-m);return Math.ceil(h/(1e3*60*60*24))}),c=()=>{u("create-offer",s.opportunity)},d=()=>{u("mark-unsold",s.opportunity)},i=m=>{u("survey-completed",{opportunity:s.opportunity,responses:m})},r=()=>{u("survey-refused",{opportunity:s.opportunity})},b=()=>{u("not-responding",{opportunity:s.opportunity})};return(m,p)=>(n(),l("div",vi,[e("div",fi,[e("div",null,[p[0]||(p[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",bi,"This opportunity has been open for "+v(a.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),P(pe,{questions:o,onSurveyCompleted:i,onSurveyRefused:r,onNotResponding:b})]))}},hi={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},wi={class:"flex justify-between items-start mb-3"},ki={class:"text-xs text-gray-500 mt-0.5"},Ci={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],a=q(()=>{const m=s.opportunity.lastActivity||s.opportunity.createdAt;if(!m)return 0;const p=new Date(m),g=Math.abs(new Date-p);return Math.ceil(g/(1e3*60*60*24))}),c=()=>{u("create-contract",s.opportunity)},d=()=>{u("close-lost",s.opportunity)},i=m=>{u("survey-completed",{opportunity:s.opportunity,responses:m})},r=()=>{u("survey-refused",{opportunity:s.opportunity})},b=()=>{u("not-responding",{opportunity:s.opportunity})};return(m,p)=>(n(),l("div",hi,[e("div",wi,[e("div",null,[p[0]||(p[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",ki,"This opportunity has been in negotiation for "+v(a.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract "),e("button",{onClick:d,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),P(pe,{questions:o,onSurveyCompleted:i,onSurveyRefused:r,onNotResponding:b})]))}},$i={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Si={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-lost","schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],a=()=>{u("close-lost",s.opportunity)},c=()=>{u("schedule-closing",s.opportunity)},d=b=>{u("survey-completed",{opportunity:s.opportunity,responses:b})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},r=()=>{u("not-responding",{opportunity:s.opportunity})};return(b,m)=>(n(),l("div",$i,[m[0]||(m[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting "),e("button",{onClick:a,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),P(pe,{questions:o,onSurveyCompleted:d,onSurveyRefused:i,onNotResponding:r})]))}},Di={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Ai={class:"flex justify-between items-start mb-3"},Ii={class:"text-xs text-gray-500 mt-0.5"},Oi={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Close as lost","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],a=q(()=>{var h;return(h=s.scheduledAppointment)!=null&&h.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),c=()=>{u("contact-customer",s.opportunity)},d=()=>{u("reschedule",s.opportunity)},i=()=>{u("close-lost",s.opportunity)},r=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},b=()=>{u("survey-refused",{opportunity:s.opportunity})},m=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,h)=>(n(),l("div",Di,[e("div",Ai,[e("div",null,[h[0]||(h[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"No-Show Follow-up",-1)),e("p",Ii,"Appointment was scheduled for "+v(a.value)+" but customer did not show up. Follow up with customer to understand the situation.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Contact Customer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Reschedule "),e("button",{onClick:i,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),P(pe,{questions:o,onSurveyCompleted:r,onSurveyRefused:b,onNotResponding:m})]))}},Ti={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},qi={class:"flex justify-between items-start mb-3"},Ni={class:"text-xs text-gray-500 mt-0.5"},Mi={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],a=q(()=>{var g;if(!((g=s.opportunity)!=null&&g.contractDate))return 0;const m=new Date(s.opportunity.contractDate),h=Math.abs(new Date-m);return Math.ceil(h/(1e3*60*60*24))}),c=()=>{u("prepare-delivery",s.opportunity)},d=()=>{u("pre-delivery-checklist",s.opportunity)},i=m=>{u("survey-completed",{opportunity:s.opportunity,responses:m})},r=()=>{u("survey-refused",{opportunity:s.opportunity})},b=()=>{u("not-responding",{opportunity:s.opportunity})};return(m,p)=>(n(),l("div",Ti,[e("div",qi,[e("div",null,[p[0]||(p[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Ni,"Contract was signed "+v(a.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),P(pe,{questions:o,onSurveyCompleted:i,onSurveyRefused:r,onNotResponding:b})]))}},ji={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Ri={class:"flex justify-between items-start mb-3"},Vi={class:"text-xs text-gray-500 mt-0.5"},Fi={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:y}){const s=t,u=y,o=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],a=q(()=>{const b=s.activities.find(g=>{var C;return g.type==="delivery"||((C=g.action)==null?void 0:C.toLowerCase().includes("delivered"))});if(!b||!b.timestamp)return 0;const m=new Date(b.timestamp),h=Math.abs(new Date-m);return Math.ceil(h/(1e3*60*60*24))}),c=()=>{u("delivery-feedback",s.opportunity)},d=b=>{u("survey-completed",{opportunity:s.opportunity,responses:b})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},r=()=>{u("not-responding",{opportunity:s.opportunity})};return(b,m)=>(n(),l("div",ji,[e("div",Ri,[e("div",null,[m[0]||(m[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Vi,"Vehicle was delivered "+v(a.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:c,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),P(pe,{questions:o,onSurveyCompleted:d,onSurveyRefused:i,onNotResponding:r})]))}},Li={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Ui={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},Ei={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},Bi={class:"p-5 space-y-6"},Wi={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Pi={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},zi={class:"flex items-start gap-3"},Yi={class:"flex-1"},Qi={class:"font-bold text-slate-800 text-sm mb-1"},Hi={key:0},Ji={key:1},Ki={class:"text-xs text-gray-600"},Gi={key:0},Xi={key:1},Zi={key:2},_i={class:"flex justify-between items-start mb-3"},ed={class:"font-bold text-slate-800 text-sm"},td={key:0},sd={key:1},od={class:"text-xs text-gray-500 mt-0.5"},nd={key:0},ad={key:1},ld={class:"flex gap-3 flex-wrap"},rd={key:0,class:"mt-4"},id={class:"[&>div]:mb-0"},dd={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},ud={class:"flex justify-between items-start mb-3"},cd={class:"text-xs text-gray-500 mt-0.5"},pd={key:0,class:"pt-4"},md={key:4,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},yd={key:5,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},gd={class:"flex justify-between items-start mb-3"},vd={class:"text-xs text-gray-500 mt-0.5"},fd={key:12,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},bd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},xd={class:"p-6"},hd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},wd={class:"p-6"},kd={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:y}){const s=t,u=y,o=q(()=>{var k,A,E;return((k=s.opportunity)==null?void 0:k.stage)==="Closed"||((A=s.opportunity)==null?void 0:A.stage)==="Closed Lost"||((E=s.opportunity)==null?void 0:E.stage)==="Registration"}),a=$(!1),c=$(!1),d=$(null),i=$(!1),r=$(""),b=$(!1),m=$(!1),p=$(!1),h=$(!1),g=$([]),C=Ue();ne(()=>{g.value=Le.filter(k=>k.stockDays!==null&&k.stockDays!==void 0).slice(0,5).map(k=>({id:k.id,brand:k.brand,model:k.model,year:k.year,price:k.price,image:k.image||"",stockDays:k.stockDays}))});const T=k=>{r.value=k,i.value=!0},V=k=>k?new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",L=k=>k?new Date(k).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",Q=()=>{a.value=!a.value},se=k=>{a.value=!1},D=q(()=>{var K;if(!((K=s.opportunity)!=null&&K.createdAt))return 0;const k=new Date(s.opportunity.createdAt),E=Math.abs(new Date-k);return Math.ceil(E/(1e3*60*60*24))}),O=q(()=>{var A,E;return s.activities.some(K=>K.type==="offer")||((A=s.opportunity)==null?void 0:A.stage)==="In Negotiation"||((E=s.opportunity)==null?void 0:E.stage)==="Closed"}),x=q(()=>s.activities.some(k=>k.type==="appointment")),I=q(()=>{var E,K,G,ee;const k=((E=s.opportunity)==null?void 0:E.contractDate)!==null&&((K=s.opportunity)==null?void 0:K.contractDate)!==void 0,A=s.activities.some(X=>{var Z,le;return((Z=X.action)==null?void 0:Z.toLowerCase().includes("won"))||((le=X.action)==null?void 0:le.toLowerCase().includes("contract"))});return k||A||((G=s.opportunity)==null?void 0:G.stage)==="Closed"&&((ee=s.opportunity)==null?void 0:ee.probability)===100}),M=q(()=>s.activities.some(k=>{var A,E;return k.type==="delivery"||((A=k.action)==null?void 0:A.toLowerCase().includes("delivered"))||((E=k.action)==null?void 0:E.toLowerCase().includes("delivery"))})),w=q(()=>{var A;if(((A=s.opportunity)==null?void 0:A.stage)!=="Qualified"||O.value||s.scheduledAppointment||x.value)return!1;const k=D.value;return k>=7&&k<14}),z=q(()=>{var A;return((A=s.opportunity)==null?void 0:A.stage)!=="Qualified"||O.value||s.scheduledAppointment||x.value?!1:D.value>=14}),be=q(()=>{var A;return((A=s.opportunity)==null?void 0:A.stage)!=="Qualified"||O.value||!s.scheduledAppointment?!1:D.value>=7}),xe=q(()=>{const k=D.value;return k>=14?"high":k>=7?"medium":null}),ke=q(()=>{var G;if(((G=s.opportunity)==null?void 0:G.stage)!=="In Negotiation")return!1;const k=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),E=Math.abs(new Date-k),K=Math.ceil(E/(1e3*60*60*24));return!I.value&&K>=5}),Ce=q(()=>{var Z,le,Ne;if(((Z=s.opportunity)==null?void 0:Z.stage)!=="In Negotiation")return!1;const k=((le=s.opportunity)==null?void 0:le.contractDate)!==null&&((Ne=s.opportunity)==null?void 0:Ne.contractDate)!==void 0,A=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||x.value&&s.activities.some(Oe=>{var Me;return Oe.type==="appointment"&&((Me=Oe.data)!=null&&Me.datetime)?new Date(Oe.data.datetime)>new Date:!1}),E=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),G=Math.abs(new Date-E);return Math.ceil(G/(1e3*60*60*24))>=5&&!k&&!A}),$e=q(()=>{var X,Z,le;if(((X=s.opportunity)==null?void 0:X.stage)!=="Closed"&&((Z=s.opportunity)==null?void 0:Z.stage)!=="Registration")return!1;const k=(le=s.opportunity)==null?void 0:le.contractDate;if(!k||M.value)return!1;const A=new Date(k),K=Math.abs(new Date-A);return Math.ceil(K/(1e3*60*60*24))>=7}),Se=q(()=>{const k=s.activities.find(X=>{var Z;return X.type==="delivery"||((Z=X.action)==null?void 0:Z.toLowerCase().includes("delivered"))});if(!k)return!1;const A=new Date(k.timestamp),K=Math.abs(new Date-A);return Math.ceil(K/(1e3*60*60*24))>=3}),De=q(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const E=s.activities.some(G=>{var ee,X,Z;return G.type==="appointment"&&(((ee=G.data)==null?void 0:ee.status)==="completed"||((X=G.action)==null?void 0:X.toLowerCase().includes("completed")))&&((Z=G.data)==null?void 0:Z.appointmentId)===s.scheduledAppointment.id}),K=s.scheduledAppointment.status==="no-show";return!E&&!K}),U=q(()=>{var k,A,E;return!(((k=s.opportunity)==null?void 0:k.stage)!=="In Negotiation"||!((A=s.opportunity)!=null&&A.contractDate)||((E=s.opportunity)==null?void 0:E.stage)==="Closed")}),S=q(()=>{var G,ee,X;if(((G=s.opportunity)==null?void 0:G.stage)!=="Closed"||!((ee=s.opportunity)!=null&&ee.contractDate)||M.value||((X=s.opportunity)==null?void 0:X.stage)==="Registration")return!1;const k=new Date(s.opportunity.contractDate),E=Math.abs(new Date-k);return Math.ceil(E/(1e3*60*60*24))>=7}),J=()=>{u("add-vehicle",s.opportunity)},ge=()=>{T("Add Vehicle from Stock")},We=()=>{T("Configure Vehicle")},Ae=()=>{b.value=!0},Te=()=>{b.value=!1},Pe=k=>{b.value=!1,u("create-offer",{opportunity:s.opportunity,offerData:k})},ze=k=>{u("add-to-opportunity",k)},Ye=k=>{T("Review Opportunity")},Qe=k=>{p.value=!0},He=k=>{p.value=!1,console.log("Contract date set:",k)},qe=k=>{c.value=!0,d.value=k},Ie=()=>{c.value=!1,d.value=null},Je=k=>{qe("nfu")},Ke=k=>{Ie();const A={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${k.type} on ${k.date} at ${k.time}`,data:{type:k.type,assignee:k.assignee,date:k.date,time:k.time,datetime:`${k.date}T${k.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};u("appointment-created",A)},Ge=k=>{h.value=!0},Xe=k=>{T("Pre-Delivery Checklist")},Ze=k=>{h.value=!1,console.log("Vehicle marked as delivered:",k)},_e=k=>{T("Delivery Feedback")},ve=()=>{m.value=!0},et=k=>{m.value=!1,console.log("Closing opportunity as lost:",k)},tt=()=>{T("Contact Customer")},de=k=>{console.log("Survey completed:",k)},ue=k=>{console.log("Survey refused:",k)},ce=k=>{console.log("Customer not responding:",k)},st=async()=>{try{await C.reopenOpportunity(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(k){console.error("Failed to reopen opportunity:",k)}},ot=async()=>{try{await C.markAsRegistration(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(k){console.error("Failed to mark as registration:",k)}},nt=async()=>{try{await C.markAsClosedWon(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(k){console.error("Failed to mark as closed won:",k)}};return(k,A)=>t.opportunity?(n(),l("div",Li,[e("div",Ui,[A[6]||(A[6]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next steps")],-1)),e("span",Ei,v(o.value?"Closed":"Active"),1)]),e("div",Bi,[o.value?(n(),l("div",Wi,[A[8]||(A[8]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process.")])],-1)),e("button",{onClick:st,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...A[7]||(A[7]=[R(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):f("",!0),be.value?(n(),l("div",Pi,[e("div",zi,[A[9]||(A[9]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",Yi,[e("h4",Qi,[xe.value==="high"?(n(),l("span",Hi,"High Risk")):(n(),l("span",Ji,"At Risk"))]),e("p",Ki,[xe.value==="high"?(n(),l("span",Gi," This opportunity has been open for "+v(D.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(n(),l("span",Xi," This opportunity has been open for "+v(D.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):f("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(n(),l("div",Zi,[e("div",{class:j([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",_i,[e("div",null,[e("h4",ed,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(n(),l("span",td," Add Vehicle ")):(n(),l("span",sd," Find Alternative "))]),e("p",od,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(n(),l("span",nd," The requested vehicle is available. Add it to the opportunity to proceed. ")):(n(),l("span",ad," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",ld,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(n(),l("button",{key:0,onClick:J,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):f("",!0),e("button",{onClick:ge,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:We,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:Ae,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(n(),l("div",rd,[e("div",id,[P(ti,{onAddToOpportunity:ze})])])):f("",!0)],2)])):f("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(n(),l("div",dd,[e("div",ud,[e("div",null,[A[10]||(A[10]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",cd,v(t.scheduledAppointment.title)+" on "+v(V(t.scheduledAppointment.start))+" at "+v(L(t.scheduledAppointment.start)),1)])]),e("button",{onClick:Q,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),a.value?(n(),l("div",pd,[P(Ee,{show:a.value,onClose:A[0]||(A[0]=E=>a.value=!1),onConfirm:se},null,8,["show"])])):f("",!0)])):t.opportunity.stage==="Qualified"&&!x.value?(n(),l("div",md,[A[11]||(A[11]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:A[1]||(A[1]=E=>qe("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):f("",!0),U.value?(n(),l("div",yd,[e("div",gd,[e("div",null,[A[12]||(A[12]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",vd," Contract was signed on "+v(V(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:nt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...A[13]||(A[13]=[R(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):f("",!0),De.value?(n(),B(Oi,{key:6,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:tt,onReschedule:k.openRescheduleModal,onCloseLost:ve,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity","scheduled-appointment","onReschedule"])):f("",!0),z.value?(n(),B(xi,{key:7,opportunity:t.opportunity,onCreateOffer:Ae,onMarkUnsold:ve,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity"])):f("",!0),w.value?(n(),B(gi,{key:8,opportunity:t.opportunity,onCreateOffer:Ae,onReview:Ye,onCloseLost:ve,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity"])):f("",!0),Ce.value?(n(),B(Si,{key:9,opportunity:t.opportunity,onCloseLost:ve,onScheduleClosing:Je,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity"])):f("",!0),ke.value?(n(),B(Ci,{key:10,opportunity:t.opportunity,onCreateContract:Qe,onCloseLost:ve,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity"])):f("",!0),$e.value?(n(),B(Mi,{key:11,opportunity:t.opportunity,onPrepareDelivery:Ge,onPreDeliveryChecklist:Xe,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity"])):f("",!0),S.value?(n(),l("div",fd,[A[15]||(A[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:ot,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...A[14]||(A[14]=[R(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):f("",!0),Se.value?(n(),B(Fi,{key:13,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:_e,onSurveyCompleted:de,onSurveyRefused:ue,onNotResponding:ce},null,8,["opportunity","activities"])):f("",!0)]),P(Hl,{show:i.value,title:r.value,onClose:A[2]||(A[2]=E=>i.value=!1)},null,8,["show","title"]),P(Zl,{show:m.value,onConfirm:et,onCancel:A[3]||(A[3]=E=>m.value=!1)},null,8,["show"]),P(nr,{show:p.value,onConfirm:He,onCancel:A[4]||(A[4]=E=>p.value=!1)},null,8,["show"]),P(ur,{show:h.value,onConfirm:Ze,onCancel:A[5]||(A[5]=E=>h.value=!1)},null,8,["show"]),(n(),B(ie,{to:"body"},[b.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(Te,["self"])},[e("div",bd,[e("div",xd,[P(Wr,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":g.value,onSave:Pe,onCancel:Te},null,8,["task-id","requested-car","recommended-cars"])])])])):f("",!0)])),(n(),B(ie,{to:"body"},[c.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(Ie,["self"])},[e("div",hd,[e("div",wd,[P(Be,{show:c.value,onConfirm:Ke,onCancel:Ie},null,8,["show"])])])])):f("",!0)]))])):f("",!0)}},Cd={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},$d={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},Sd={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},Dd={key:0,class:"fa-solid fa-clock text-[10px]"},Ad={class:"text-[10px] font-bold uppercase tracking-wide"},Id={key:1,class:"text-right"},Od={class:"text-sm font-bold text-gray-900"},Td={class:"mt-1.5"},qd={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},Nd={class:"text-[10px] text-gray-500 mt-0.5"},Md=["onClick"],jd=["onClick"],Rd=["onClick"],Vd={class:"flex-1 flex flex-col overflow-hidden"},Fd={key:0,class:"flex-1 flex items-center justify-center"},Ud={__name:"TaskDetail",setup(t){const y=ct(),s=pt(),u=Fe(),o=Ue(),a=$("all"),c=$(null),d=q(()=>{const x=u.leads.map(M=>({...M,type:"lead",compositeId:`lead-${M.id}`})),I=o.opportunities.map(M=>({...M,type:"opportunity",compositeId:`opportunity-${M.id}`}));return[...x,...I].sort((M,w)=>{const z=new Date(M.lastActivity||M.createdAt||0);return new Date(w.lastActivity||w.createdAt||0)-z})}),i=q(()=>a.value==="all"?d.value:d.value.filter(x=>x.type===a.value)),r=q(()=>{const x=parseInt(y.params.id),I=y.query.type;if(I)return d.value.find(z=>z.id===x&&z.type===I)||null;const w=(a.value!=="all"?d.value.filter(z=>z.type===a.value):d.value).find(z=>z.id===x);return w||d.value.find(z=>z.id===x)||null}),b=q(()=>r.value?r.value.type==="lead"?u.currentLeadActivities:o.currentOpportunityActivities:[]),m=q(()=>r.value?r.value.type==="lead"?Pl:kd:null),p=q(()=>r.value?r.value.type==="lead"?{currentActivities:q(()=>u.currentLeadActivities),addActivity:(x,I)=>u.addActivity(x,I),updateActivity:(x,I,M)=>u.updateActivity(x,I,M),deleteActivity:(x,I)=>u.deleteActivity(x,I)}:{currentActivities:q(()=>o.currentOpportunityActivities),addActivity:(x,I)=>o.addActivity(x,I),updateActivity:(x,I,M)=>o.updateActivity(x,I,M),deleteActivity:(x,I)=>o.deleteActivity(x,I)}:null),h=q(()=>r.value?r.value.type==="lead"?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),g=q(()=>x=>x.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");ne(()=>{u.loadLeads(),o.loadOpportunities();const x=y.params.id;x&&C(x)}),oe(()=>y.params.id,x=>{x&&C(x)}),oe(r,x=>{x&&(x.type==="lead"?u.loadLeadById(x.id):o.loadOpportunityById(x.id))},{immediate:!0});const C=x=>{const I=parseInt(x),M=d.value.find(w=>w.id===I);M&&(M.type==="lead"?u.loadLeadById(I):o.loadOpportunityById(I))},T=x=>{const[I,M]=x.split("-");s.push({path:`/tasks/${M}`,query:{type:I}})},V=x=>new Intl.NumberFormat("en-US").format(x),L=x=>{c.value=c.value===x?null:x},Q=x=>{c.value=null},se=async x=>{c.value=null,x.type==="lead"?await u.modifyLead(x.id,{priority:"Hot"}):x.type==="opportunity"&&await o.modifyOpportunity(x.id,{priority:"Hot"})},D=async x=>{c.value=null,x.type==="lead"?await u.modifyLead(x.id,{priority:"Normal"}):x.type==="opportunity"&&await o.modifyOpportunity(x.id,{priority:"Normal"})},O=x=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[x]||"bg-gray-100 text-gray-700 border-gray-200";return(x,I)=>{var M;return n(),l("div",Cd,[P(Ut,{title:"Tasks",items:i.value,"selected-id":(M=r.value)==null?void 0:M.compositeId,"type-filter":a.value,"selected-class":w=>w.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":g.value,"open-menu-id":c.value,getName:w=>w.customer.name,getInitials:w=>w.customer.initials,getVehicleInfo:w=>w.type==="lead"?`${w.requestedCar.brand} ${w.requestedCar.model}`:`${w.vehicle.brand} ${w.vehicle.model}`,avatarClass:w=>w.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600",onSelect:T,onMenuClick:L,onMenuClose:I[0]||(I[0]=w=>c.value=null),"show-type-filter":!0,onFilterChange:I[1]||(I[1]=w=>a.value=w)},{badges:fe(({item:w})=>[e("span",{class:j(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",w.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},v(w.type==="lead"?"Lead":"Opportunity"),3),w.type==="lead"?(n(),l(Y,{key:0},[e("span",$d,v(w.status),1),w.priority==="Hot"?(n(),l("span",Sd,[...I[2]||(I[2]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),R(" Hot ",-1)])])):f("",!0)],64)):(n(),l("span",{key:1,class:j(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",O(w.stage)])},v(w.stage),3))]),meta:fe(({item:w})=>[w.type==="lead"?(n(),l("div",{key:0,class:j(["flex items-center gap-1.5",w.priority==="Hot"?"text-red-500":"text-gray-400"])},[w.priority==="Hot"?(n(),l("i",Dd)):f("",!0),e("span",Ad," Due in "+v(w.nextActionDue),1)],2)):(n(),l("div",Id,[e("div",Od,"€"+v(V(w.value)),1),e("div",Td,[e("div",qd,[e("div",{class:j(["h-full rounded-full",w.probability>=70?"bg-green-500":w.probability>=40?"bg-blue-500":"bg-orange-500"]),style:Ve({width:`${w.probability}%`})},null,6)]),e("div",Nd,v(w.probability)+"% PROB",1)])]))]),menu:fe(({item:w})=>[e("button",{onClick:H(z=>Q(w),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...I[3]||(I[3]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),R(" Reassign ",-1)])],8,Md),w.priority!=="Hot"?(n(),l("button",{key:0,onClick:H(z=>se(w),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...I[4]||(I[4]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),R(" Mark as hot ",-1)])],8,jd)):(n(),l("button",{key:1,onClick:H(z=>D(w),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...I[5]||(I[5]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),R(" Unmark as hot ",-1)])],8,Rd))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass"]),e("div",Vd,[r.value?(n(),B(oa,{key:1,task:r.value,type:r.value.type,"management-widget":m.value,"store-adapter":p.value,"add-new-config":h.value},{"pinned-extra":fe(({task:w})=>[w.type==="lead"&&w.requestedCar?(n(),B(Re,{key:0,brand:w.requestedCar.brand,model:w.requestedCar.model,year:w.requestedCar.year,image:w.requestedCar.image||"",price:w.requestedCar.price||null,"request-message":w.requestedCar.requestMessage||"","request-type":w.requestedCar.requestType||"",source:w.source||"",dealership:w.requestedCar.dealership||"",registration:w.requestedCar.registration||"",kilometers:w.requestedCar.kilometers||null,"fuel-type":w.requestedCar.fuelType||"","gear-type":w.requestedCar.gearType||"",vin:w.requestedCar.vin||"","stock-days":w.requestedCar.stockDays!==void 0?w.requestedCar.stockDays:null,channel:w.requestedCar.channel||"Email","ad-campaign":w.requestedCar.adCampaign||"","expected-purchase-date":w.requestedCar.expectedPurchaseDate||"","fiscal-entity":w.requestedCar.fiscalEntity||"","source-details":w.requestedCar.sourceDetails||"","ad-medium":w.requestedCar.adMedium||"","ad-source":w.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):f("",!0),w.type==="opportunity"&&w.vehicle?(n(),B(Re,{key:1,brand:w.vehicle.brand,model:w.vehicle.model,year:w.vehicle.year,image:w.vehicle.image||"",price:w.vehicle.price||null,"request-message":w.vehicle.requestMessage||"","request-type":w.vehicle.requestType||"",source:w.source||"",dealership:w.vehicle.dealership||"",registration:w.vehicle.registration||"",kilometers:w.vehicle.kilometers||null,"fuel-type":w.vehicle.fuelType||"","gear-type":w.vehicle.gearType||"",vin:w.vehicle.vin||"","stock-days":w.vehicle.stockDays!==void 0?w.vehicle.stockDays:null,channel:w.vehicle.channel||"Email","ad-campaign":w.vehicle.adCampaign||"","expected-purchase-date":w.vehicle.expectedPurchaseDate||"","fiscal-entity":w.vehicle.fiscalEntity||"","source-details":w.vehicle.sourceDetails||"","ad-medium":w.vehicle.adMedium||"","ad-source":w.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):f("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(n(),l("div",Fd,[...I[6]||(I[6]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),P(ts,{title:"Activity summary",activities:b.value,collapsed:!1,"show-collapse":!1,show:!!r.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{Ud as default};
