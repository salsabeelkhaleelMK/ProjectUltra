import{E as Ye,Y as ae,r as R,$ as bt,h as Re,c as D,J as Qe,d as r,o as n,e,y as T,n as q,w as le,t as g,F as H,i as K,p as S,g as x,s as E,P as Ge,aa as Dt,I as Ke,x as j,z as Me,k as N,_ as gt,C as Et,l as oe,m as me,v as Z,j as be,K as M,Q as z,Z as xt,ab as se,ac as Lt,ad as Vt,u as Pt,D as U,ae as Ot,af as Mt,ag as Rt,ah as qt,ai as Bt,a4 as Ft,a2 as Ut,L as Nt,R as nt,G as ge,M as ce}from"./index-C3vqiHZ_.js";import{a as jt,u as Wt}from"./opportunities-DwMYze2l.js";import{_ as zt}from"./ReassignUserModal-DbetPksJ.js";import{_ as Ht}from"./CreateEventModal-BRv91JID.js";import{a as Ce,F as Se,L as Ae,H as De,j as Ee,K as Je,C as Le,W as Ve}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D8IcTfaq.js";import{e as je}from"./formatters-B1RFjlNy.js";import{u as Yt}from"./vehicles-2vgH6oRD.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=Ye("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=Ye("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Ye("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),de={[ae.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[ae.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},ot={toClosed:(t,o,l)=>{const i={isDisqualified:!0,disqualifyReason:(l==null?void 0:l.reason)||null,disqualifyCategory:(l==null?void 0:l.category)||null,scheduledAppointment:null,nextActionDue:null};(l==null?void 0:l.reason)==="Duplicate"?(i.isDuplicate=!0,i.stage="Closed Failed"):(l==null?void 0:l.category)==="Not Interested"?i.stage="Not Interested":i.stage="Not Valid",i.status="Disqualified";const m=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(l==null?void 0:l.category)||"Unknown"}, Reason: ${(l==null?void 0:l.reason)||"Unknown"}`}];return t.scheduledAppointment&&m.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:i,activities:m}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Zu(t,o){return o.startsWith("Closed")?ot.toClosed:t.startsWith("Closed")&&!o.startsWith("Closed")?ot.reopen:null}const Xe={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const o=t.deliverySubstatus;return o==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:o==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},We={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},Kt={class:"w-full card-container p-3 md:px-8 md:py-3.5"},Jt={class:"flex items-center justify-between gap-4"},Xt={class:"flex items-center gap-2 flex-1 min-w-0"},Zt={class:"flex items-center gap-3 min-w-0 flex-1"},_t={class:"min-w-0 flex-1"},el={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},tl={class:"flex flex-col gap-1.5 mt-1"},ll={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},al={class:"flex items-center gap-1.5 group"},sl={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},nl={class:"flex items-center gap-1.5 group"},il={class:"text-xs text-heading font-medium whitespace-nowrap"},ol={class:"flex items-center gap-1.5"},rl={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},dl={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},ul={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},cl={class:"flex flex-wrap items-center gap-1.5"},ml={class:"shrink-0"},fl={class:"relative"},pl={key:0,class:"absolute top-full right-0 mt-2 z-50 shadow-xl"},vl={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]}},emits:["action","add-tag"],setup(t,{emit:o}){const l=t,i=o,m=R(!1),u=bt(),v=Re(),s=D(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...l.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(I=>({...I,onClick:()=>f(I.key)}))),f=k=>{m.value=!1,i("action",k)},c=async(k,I)=>{try{await navigator.clipboard.writeText(k),u.pushToast("success",`${I==="email"?"Email":"Phone"} copied!`)}catch{u.pushToast("error","Failed to copy")}},a=()=>i("add-tag"),p=()=>{l.customerId&&v.push(`/customer/${l.customerId}`)};return(k,I)=>{const w=Qe("click-outside");return n(),r("div",Kt,[e("div",Jt,[e("div",Xt,[e("button",{onClick:I[0]||(I[0]=d=>T(v).push("/customers")),class:"w-7 h-7 flex items-center justify-center text-sub hover:text-brand-dark transition-colors shrink-0 -ml-1","aria-label":"Back to customers"},[...I[4]||(I[4]=[e("i",{class:"fa-solid fa-arrow-left text-xs"},null,-1)])]),e("div",Zt,[e("button",{onClick:le(p,["stop"]),class:q(["w-20 h-20 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...I[5]||(I[5]=[e("i",{class:"fa-solid fa-user text-3xl text-white"},null,-1)])],2),e("div",_t,[e("h1",el,g(t.name),1),e("div",tl,[e("div",ll,[e("div",al,[I[7]||(I[7]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",sl,g(t.email),1),e("button",{onClick:I[1]||(I[1]=le(d=>c(t.email,"email"),["stop"])),class:"transition-all"},[...I[6]||(I[6]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",nl,[I[9]||(I[9]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",il,g(t.phone),1),e("button",{onClick:I[2]||(I[2]=le(d=>c(t.phone,"phone"),["stop"])),class:"transition-all"},[...I[8]||(I[8]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",ol,[t.thirdFieldLabel.toLowerCase().includes("address")?(n(),r("i",rl)):(n(),r("i",dl)),e("span",ul,g(t.thirdFieldValue),1)])]),e("div",cl,[(n(!0),r(H,null,K(t.tags,d=>(n(),r("span",{key:d,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},g(d),1))),128)),e("button",{onClick:le(a,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...I[10]||(I[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])])]),e("div",ml,[e("div",fl,[e("button",{onClick:I[3]||(I[3]=le(d=>m.value=!m.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...I[11]||(I[11]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),m.value?S((n(),r("div",pl,[E(T(Ge),{items:s.value,className:"w-48"},null,8,["items"])])),[[w,()=>m.value=!1]]):x("",!0)])])])])}}},yl={class:"flex gap-0 md:gap-8 text-fluid-sm font-medium text-sub py-1"},bl=["onClick"],rt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const o={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},l=i=>o[i]||"fa-solid fa-circle";return(i,m)=>(n(),r("div",yl,[(n(!0),r(H,null,K(t.tabs,u=>(n(),r("div",{key:u.key,onClick:v=>i.$emit("update:modelValue",u.key),class:q(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===u.key?"border-brand-dark text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:q([l(u.key),"text-sm md:text-sm",t.modelValue===u.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:q(["hidden md:inline whitespace-nowrap",t.modelValue===u.key?"text-brand-darkDarker":""])},g(u.label),3)],10,bl))),128))]))}},gl={class:"w-full mb-6"},xl={class:"bg-surface border border-black/5 rounded-xl shadow-mk-dashboard-card overflow-hidden"},hl={class:"px-4 md:px-6 py-3 border-b border-black/5"},kl={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},wl={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},$l={class:"flex items-center gap-1.5"},Il={key:1},Tl={class:"flex items-center gap-2"},Cl={key:0,class:"p-4 md:p-6"},Sl={key:0,class:"space-y-4"},Al={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Dl={class:"flex items-center gap-4"},El={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},Ll=["src"],Vl={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},Pl={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},Ol={class:"flex items-center gap-2 flex-wrap"},Ml={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},Rl={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},ql={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},Bl={class:"text-fluid-xs font-bold text-heading"},Fl={key:0,class:"text-right"},Ul={class:"font-bold text-heading text-fluid-lg"},Nl={key:0,class:"pt-2"},jl={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Wl={class:"text-fluid-sm text-body leading-relaxed"},zl={key:1,class:"space-y-3"},Hl={key:0,class:"flex items-center gap-2"},Yl={class:"text-fluid-sm font-semibold text-heading"},Ql={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Gl={class:"text-fluid-sm text-body leading-relaxed"},Kl={key:1,class:"border-t border-black/5"},Jl={class:"font-medium"},Xl={key:2,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},Zl={class:"mb-6"},_l={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ea={key:0},ta={class:"font-medium text-body"},la={key:1},aa={class:"font-medium text-body"},sa={key:2},na={class:"font-medium text-body"},ia={class:"font-medium text-body"},oa={key:0},ra={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},da={key:0},ua={class:"font-medium text-body"},ca={key:1},ma={class:"font-medium text-body"},fa={key:2},pa={class:"font-medium text-body"},va={key:3},ya={class:"font-medium text-body"},ba={key:4},ga={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},xa={key:5},ha={class:"font-medium text-body"},ka={key:0,class:"mt-6 flex justify-end"},wa={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const o=t,l=R(!1);D(()=>o.deliverySubstatus?Dt(o.deliverySubstatus):"");const i=D(()=>o.deliverySubstatus?o.deliverySubstatus==="Delivered"?"green":o.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),m=D(()=>Ke(o.stage,o.entityType));function u(O){return!O||O.length===0?null:O.filter(J=>J.type==="offer").sort((J,ve)=>new Date(ve.timestamp)-new Date(J.timestamp))[0]||null}function v(O){if(!O)return 0;const L=new Date(O),ve=Math.abs(new Date-L);return Math.ceil(ve/(1e3*60*60*24))}const s=D(()=>{if(o.stage!=="In Negotiation")return null;const O=u(o.activities);if(!O)return null;const L=v(O.timestamp);return L<1?{label:"New Offer",theme:"orange"}:L<3?{label:"Active",theme:"yellow"}:null}),f=D(()=>o.requestedCar&&o.requestedCar.brand&&o.requestedCar.model),c=D(()=>o.requestType||o.requestMessage||f.value),a=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.brand)||""}),p=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.model)||""}),k=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.year)||""}),I=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.image)||""}),w=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.price)||null}),d=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.stockDays)!==void 0?o.requestedCar.stockDays:null}),b=D(()=>{var O,L;return((O=o.requestedCar)==null?void 0:O.dealership)||((L=o.task)==null?void 0:L.dealership)||""}),$=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.registration)||""}),h=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.kilometers)!==void 0?o.requestedCar.kilometers:null}),V=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.fuelType)||""}),ee=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.gearType)||""}),ne=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.vin)||""}),ue=D(()=>"Email"),F=D(()=>{var O,L;return((O=o.task)==null?void 0:O.sourceDetails)||((L=o.requestedCar)==null?void 0:L.adCampaign)||""}),y=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.expectedPurchaseDate)||""}),P=D(()=>{var O;return((O=o.task)==null?void 0:O.fiscalEntity)||""}),ie=D(()=>{var O;return((O=o.task)==null?void 0:O.sourceDetails)||""}),fe=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.adMedium)||""}),xe=D(()=>{var O;return((O=o.requestedCar)==null?void 0:O.adSource)||""});D(()=>!0);const qe=D(()=>!0),re=D(()=>f.value||o.requestType||o.source||ie.value||F.value||y.value||P.value||fe.value||xe.value),te=O=>new Intl.NumberFormat("en-US").format(O),pe=O=>new Intl.NumberFormat("en-US").format(O);return(O,L)=>(n(),r("div",gl,[e("div",xl,[e("div",hl,[e("div",kl,[c.value?(n(),r("div",wl,[L[2]||(L[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",$l,[e("span",{class:q(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:q(["px-2 py-0.5 rounded text-fluid-xs font-medium border",m.value])},g(t.stage),3),t.deliverySubstatus?(n(),j(T(Me),{key:0,text:t.deliverySubstatus,size:"small",theme:i.value},null,8,["text","theme"])):x("",!0),s.value?(n(),j(T(Me),{key:1,text:s.value.label,size:"small",theme:s.value.theme},null,8,["text","theme"])):x("",!0)])])):(n(),r("div",Il)),e("div",Tl,[L[3]||(L[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:L[0]||(L[0]=J=>O.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},g(t.owner),1)])])]),c.value?(n(),r("div",Cl,[f.value?(n(),r("div",Sl,[e("div",Al,[e("div",Dl,[e("div",El,[I.value?(n(),r("img",{key:0,src:I.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Ll)):(n(),r("i",Vl))]),e("div",null,[e("div",Pl,g(a.value)+" "+g(p.value)+" ("+g(k.value)+")",1),e("div",Ol,[d.value!==void 0&&d.value!==null?(n(),r("div",Ml,[L[4]||(L[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+g(d.value)+" days) ",1)])):f.value?(n(),r("div",Rl,[...L[5]||(L[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])):x("",!0),t.source?(n(),r("div",ql,[L[6]||(L[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",Bl,g(t.source),1)])):x("",!0)])])]),w.value?(n(),r("div",Fl,[L[7]||(L[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",Ul,"€ "+g(te(w.value)),1)])):x("",!0)]),t.requestMessage?(n(),r("div",Nl,[L[8]||(L[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",jl,[e("p",Wl,g(t.requestMessage),1)])])):x("",!0)])):(n(),r("div",zl,[t.requestType?(n(),r("div",Hl,[L[9]||(L[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",Yl,g(t.requestType),1)])):x("",!0),t.requestMessage?(n(),r("div",Ql,[L[10]||(L[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",Gl,g(t.requestMessage),1)])):x("",!0)]))])):x("",!0),re.value?(n(),r("div",Kl,[e("button",{onClick:L[1]||(L[1]=J=>l.value=!l.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Jl,g(l.value?"Hide":"View")+" Details",1),e("i",{class:q(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])):x("",!0),l.value&&re.value?(n(),r("div",Xl,[e("div",Zl,[L[21]||(L[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",_l,[t.requestType?(n(),r("div",ea,[L[11]||(L[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",ta,g(t.requestType),1)])):x("",!0),t.source?(n(),r("div",la,[L[12]||(L[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",aa,g(t.source),1)])):x("",!0),e("div",null,[L[13]||(L[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:q(["font-medium",ie.value?"text-body":"text-sub"])},g(ie.value||"--"),3)]),b.value?(n(),r("div",sa,[L[14]||(L[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",na,g(b.value),1)])):x("",!0),e("div",null,[L[15]||(L[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",ia,g(ue.value||"Email"),1)]),e("div",null,[L[16]||(L[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:q(["font-medium",F.value?"text-body":"text-sub"])},g(F.value||"--"),3)]),e("div",null,[L[17]||(L[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:q(["font-medium",fe.value?"text-body":"text-sub"])},g(fe.value||"--"),3)]),e("div",null,[L[18]||(L[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:q(["font-medium",xe.value?"text-body":"text-sub"])},g(xe.value||"--"),3)]),e("div",null,[L[19]||(L[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:q(["font-medium",y.value?"text-body":"text-sub"])},g(y.value||"--"),3)]),e("div",null,[L[20]||(L[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:q(["font-medium",P.value?"text-body":"text-sub"])},g(P.value||"--"),3)])])]),f.value?(n(),r("div",oa,[L[30]||(L[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[L[29]||(L[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",ra,[$.value?(n(),r("div",da,[L[22]||(L[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",ua,g($.value),1)])):x("",!0),h.value!==void 0&&h.value!==null?(n(),r("div",ca,[L[23]||(L[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",ma,g(pe(h.value))+" Km",1)])):x("",!0),V.value?(n(),r("div",fa,[L[24]||(L[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",pa,g(V.value),1)])):x("",!0),ee.value?(n(),r("div",va,[L[25]||(L[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",ya,g(ee.value),1)])):x("",!0),ne.value?(n(),r("div",ba,[L[26]||(L[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",ga,g(ne.value),1)])):x("",!0),b.value?(n(),r("div",xa,[L[27]||(L[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",ha,g(b.value),1)])):x("",!0)]),qe.value?(n(),r("div",ka,[...L[28]||(L[28]=[e("button",{class:"bg-surface border border-E5E7EB text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):x("",!0)])])):x("",!0)])):x("",!0)])]))}},$a={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ia={class:"px-4 py-4 flex items-center justify-between shrink-0"},Ta={class:"flex items-center gap-2"},Ca={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},Sa={class:"flex items-center gap-2 flex-wrap mb-3"},Aa={key:0,class:"space-y-3"},Da={class:"flex items-center gap-3"},Ea={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},La=["src"],Va={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},Pa={class:"flex-1 min-w-0"},Oa={class:"font-bold text-heading text-fluid-sm mb-1"},Ma={class:"flex items-center gap-2 flex-wrap"},Ra={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},qa={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},Ba={key:0,class:"text-right"},Fa={class:"font-bold text-heading text-fluid-sm"},Ua={class:"mt-3 pt-3 space-y-2"},Na={key:0,class:"flex items-center justify-between text-fluid-xs"},ja={class:"text-heading font-medium"},Wa={key:1,class:"flex items-center justify-between text-fluid-xs"},za={class:"text-heading font-medium"},Ha={key:2,class:"pt-2"},Ya={class:"bg-surfaceSecondary rounded-lg p-2"},Qa={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},Ga={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const o=t,l=D(()=>o.task.requestedCar&&o.task.requestedCar.brand&&o.task.requestedCar.model),i=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.brand)||""}),m=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.model)||""}),u=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.year)||""}),v=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.image)||""}),s=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.price)||null}),f=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.stockDays)!==void 0?o.task.requestedCar.stockDays:null}),c=D(()=>{var b;return((b=o.task.requestedCar)==null?void 0:b.requestMessage)||""}),a=D(()=>Ke(o.task.displayStage||o.task.stage,o.entityType)),p=D(()=>o.task.deliverySubstatus?o.task.deliverySubstatus==="Delivered"?"green":o.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function k(b){return!b||b.length===0?null:b.filter(h=>h.type==="offer").sort((h,V)=>new Date(V.timestamp)-new Date(h.timestamp))[0]||null}function I(b){if(!b)return 0;const $=new Date(b),V=Math.abs(new Date-$);return Math.ceil(V/(1e3*60*60*24))}const w=D(()=>{if((o.task.displayStage||o.task.stage)!=="In Negotiation")return null;const b=k(o.activities);if(!b)return null;const $=I(b.timestamp);return $<1?{label:"New Offer",theme:"orange"}:$<3?{label:"Active",theme:"yellow"}:null}),d=b=>new Intl.NumberFormat("en-US").format(b);return(b,$)=>{var h,V;return n(),r("div",$a,[e("div",Ia,[$[2]||($[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Requested Car")],-1)),e("div",Ta,[$[1]||($[1]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:$[0]||($[0]=ee=>b.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},g(t.task.assignee),1)])]),e("div",Ca,[e("div",Sa,[e("span",{class:q(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:q(["px-2 py-1 rounded text-xs font-medium border",a.value])},g(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(n(),j(T(Me),{key:0,text:t.task.deliverySubstatus,size:"small",theme:p.value},null,8,["text","theme"])):x("",!0),w.value?(n(),j(T(Me),{key:1,text:w.value.label,size:"small",theme:w.value.theme},null,8,["text","theme"])):x("",!0)]),l.value?(n(),r("div",Aa,[e("div",Da,[e("div",Ea,[v.value?(n(),r("img",{key:0,src:v.value,alt:"Car",class:"w-full h-full object-cover"},null,8,La)):(n(),r("i",Va))]),e("div",Pa,[e("div",Oa,g(i.value)+" "+g(m.value)+" ("+g(u.value)+")",1),e("div",Ma,[f.value!==void 0&&f.value!==null?(n(),r("div",Ra,[$[3]||($[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+g(f.value)+" days) ",1)])):(n(),r("div",qa,[...$[4]||($[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])]))])]),s.value?(n(),r("div",Ba,[$[5]||($[5]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",Fa,"€ "+g(d(s.value)),1)])):x("",!0)])])):x("",!0),e("div",Ua,[t.task.source?(n(),r("div",Na,[$[6]||($[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",ja,g(t.task.source),1)])):x("",!0),t.task.requestType||(h=t.task.requestedCar)!=null&&h.requestType?(n(),r("div",Wa,[$[7]||($[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",za,g(t.task.requestType||((V=t.task.requestedCar)==null?void 0:V.requestType)),1)])):x("",!0),c.value?(n(),r("div",Ha,[$[8]||($[8]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",Ya,[e("p",Qa,g(c.value),1)])])):x("",!0)])])])}}},Ka={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ja={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Xa={class:"space-y-2 mb-4"},Za={class:"flex justify-between gap-2 items-center"},_a={class:"flex items-center gap-2 min-w-0"},es={class:"text-sm font-medium text-greys-900 truncate"},ts={class:"flex justify-between gap-2 items-center"},ls={class:"flex items-center gap-2 min-w-0"},as={class:"text-sm font-medium text-greys-900 truncate"},ss={class:"flex justify-between gap-2 items-center"},ns={class:"flex items-center gap-2 min-w-0"},is={class:"text-sm font-medium text-greys-900 truncate"},os={key:0,class:"flex justify-between gap-2 items-start"},rs={class:"text-sm font-medium text-greys-900 text-right min-w-0"},ds={key:0,class:"rounded-btn p-3 flex items-center gap-2",style:{"background-color":"rgba(59, 130, 246, 0.1)"}},us={class:"text-sm text-blue-900"},cs={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(t){const o=t,l=bt(),i=Re(),m=D(()=>o.task.negotiations||o.task.activeNegotiations||0),u=async(s,f)=>{if(s)try{await navigator.clipboard.writeText(s),l.pushToast("success",`${f==="email"?"Email":"Phone"} copied!`)}catch{l.pushToast("error","Failed to copy")}},v=()=>{o.customerId&&i.push(`/customer/${o.customerId}`)};return(s,f)=>{var c,a,p,k,I,w;return n(),r("div",Ka,[f[6]||(f[6]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-user text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Customer")])],-1)),e("div",Ja,[e("div",Xa,[e("div",Za,[f[2]||(f[2]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Customer",-1)),e("div",_a,[e("p",es,g(((c=t.task.customer)==null?void 0:c.name)||"Unknown"),1),t.customerId?(n(),r("button",{key:0,onClick:v,class:"w-5 h-5 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open customer profile"},[E(T(Qt),{size:12})])):x("",!0)])]),e("div",ts,[f[3]||(f[3]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Email",-1)),e("div",ls,[e("p",as,g(((a=t.task.customer)==null?void 0:a.email)||"N/A"),1),(p=t.task.customer)!=null&&p.email?(n(),r("button",{key:0,onClick:f[0]||(f[0]=le(d=>u(t.task.customer.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy email"},[E(T(it),{size:12})])):x("",!0)])]),e("div",ss,[f[4]||(f[4]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Phone",-1)),e("div",ns,[e("p",is,g(((k=t.task.customer)==null?void 0:k.phone)||"N/A"),1),(I=t.task.customer)!=null&&I.phone?(n(),r("button",{key:0,onClick:f[1]||(f[1]=le(d=>u(t.task.customer.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-greys-500 hover:text-greys-900 transition-colors shrink-0",title:"Copy phone"},[E(T(it),{size:12})])):x("",!0)])]),(w=t.task.customer)!=null&&w.address?(n(),r("div",os,[f[5]||(f[5]=e("p",{class:"text-sm text-greys-500 shrink-0"},"Address",-1)),e("p",rs,g(t.task.customer.address),1)])):x("",!0)]),m.value>0?(n(),r("div",ds,[E(T(Gt),{size:16,class:"text-blue-600 shrink-0"}),e("p",us,g(m.value)+" other negotiation"+g(m.value>1?"s":"")+" active ",1)])):x("",!0)])])}}},ms=gt(cs,[["__scopeId","data-v-9377b774"]]),fs={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ps={class:"px-4 py-4 flex items-center justify-between shrink-0"},vs={class:"flex items-center gap-2"},ys={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},bs={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},gs={key:0,class:"text-center py-8 text-sub"},xs={key:1,class:"space-y-3"},hs=["onClick"],ks={class:"flex items-start justify-between gap-3"},ws={class:"flex-1 min-w-0"},$s={class:"flex items-center gap-2 mb-2 flex-wrap"},Is={class:"space-y-1.5"},Ts={key:0,class:"flex items-center gap-2 text-xs text-sub"},Cs={key:1,class:"flex items-center gap-2 text-xs text-sub"},Ss={key:2,class:"flex items-center gap-2 text-xs text-sub"},As={key:3,class:"flex items-center gap-2 text-xs"},Ds={class:"font-semibold text-heading"},Es={key:2,class:"text-center py-8 text-sub"},Ls={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const o=t,l=Re(),i=Et(),m=jt(),u=R(!1),v=R([]),s=R([]),f=D(()=>{var d;return o.task.customerId||((d=o.task.customer)==null?void 0:d.id)||null}),c=async()=>{if(f.value){u.value=!0;try{await Promise.all([i.fetchLeads(),m.fetchOpportunities()]),v.value=i.leads||[],s.value=m.opportunities||[]}catch(d){console.error("Error fetching related tasks:",d)}finally{u.value=!1}}},a=D(()=>{if(!f.value)return[];const d=[];return v.value.forEach(b=>{b.customerId===f.value&&!(b.id===o.task.id&&o.entityType==="lead")&&d.push({...b,type:"lead"})}),s.value.forEach(b=>{b.customerId===f.value&&!(b.id===o.task.id&&o.entityType==="opportunity")&&d.push({...b,type:"opportunity"})}),d.sort((b,$)=>{const h=new Date(b.createdAt||0);return new Date($.createdAt||0)-h})}),p=d=>{const b=d.requestedCar||d.vehicle;return b&&b.brand&&b.model?`${b.brand} ${b.model}`:null},k=d=>d?new Intl.NumberFormat("en-US").format(d):"0",I=d=>{if(!d)return"";const b=new Date(d),h=new Date-b,V=Math.floor(h/(1e3*60*60*24));return V===0?"Today":V===1?"Yesterday":V<7?`${V} days ago`:V<30?`${Math.floor(V/7)} weeks ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},w=d=>{l.push({path:`/tasks/${d.id}`,query:{type:d.type}})};return oe(()=>o.task.id,()=>{c()},{immediate:!0}),me(()=>{c()}),(d,b)=>(n(),r("div",fs,[e("div",ps,[e("div",vs,[b[0]||(b[0]=e("i",{class:"fa-solid fa-list text-heading"},null,-1)),b[1]||(b[1]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Other Tasks for This Customer",-1)),a.value.length>0?(n(),r("span",ys,g(a.value.length),1)):x("",!0)])]),e("div",bs,[u.value?(n(),r("div",gs,[...b[2]||(b[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-2xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):a.value.length>0?(n(),r("div",xs,[(n(!0),r(H,null,K(a.value,$=>(n(),r("div",{key:`${$.type}-${$.id}`,class:"flex flex-col p-3 border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors cursor-pointer group",onClick:h=>w($)},[e("div",ks,[e("div",ws,[e("div",$s,[e("span",{class:q(["px-2 py-1 rounded text-xs font-medium border",$.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g($.type==="lead"?"Lead":"Opportunity"),3),e("span",{class:q(["px-2 py-1 rounded text-xs font-medium border",T(Ke)($.displayStage||$.stage,$.type)])},g($.displayStage||$.stage),3)]),e("div",Is,[$.createdAt?(n(),r("div",Ts,[b[3]||(b[3]=e("i",{class:"fa-solid fa-calendar text-xs w-4"},null,-1)),e("span",null,g(I($.createdAt)),1)])):x("",!0),$.assignee?(n(),r("div",Cs,[b[4]||(b[4]=e("i",{class:"fa-solid fa-user text-xs w-4"},null,-1)),e("span",null,g($.assignee),1)])):x("",!0),p($)?(n(),r("div",Ss,[b[5]||(b[5]=e("i",{class:"fa-solid fa-car text-xs w-4"},null,-1)),e("span",null,g(p($)),1)])):x("",!0),$.type==="opportunity"&&$.value?(n(),r("div",As,[b[6]||(b[6]=e("i",{class:"fa-solid fa-tag text-xs w-4 text-sub"},null,-1)),e("span",Ds,"€ "+g(k($.value)),1)])):x("",!0)])]),b[7]||(b[7]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,hs))),128))])):(n(),r("div",Es,[...b[8]||(b[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},Vs={key:0,class:"flex-grow border-t border"},Ps={key:0,class:"ml-1.5 text-body"},Os={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Ms={key:1,class:"flex-grow border-t border"},dt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:o}){const l=t,i=o,m=R(!1),u={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},v=D(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(d=>!u[d]);const w=Object.entries(u).filter(([,d])=>d===l.activeTab).map(([d])=>d);return l.actions.filter(d=>w.includes(d))}),s=D(()=>l.activeTab==="communication"?!0:v.value.length===1),f=D(()=>{if(l.activeTab==="communication")return"add communication";if(!s.value||v.value.length!==1)return"";const w=v.value[0];return{note:"add note",attachment:"add attachment"}[w]||""}),c=D(()=>l.activeTab==="communication"?!1:v.value.length>1),a=D(()=>{const w={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return v.value.map(d=>({key:d,label:w[d]||d,onClick:()=>k(d)}))}),p=D(()=>{if(l.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const w="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return s.value?`${w} px-4 py-2 h-9`:`${w} w-9 h-9`});D(()=>v.value.some(w=>["email","whatsapp","sms"].includes(w))),D(()=>v.value.some(w=>["addVehicle","configureVehicle"].includes(w))),D(()=>v.value.some(w=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(w)));const k=w=>{m.value=!1,i("action",w)},I=()=>{if(l.activeTab==="communication"){k("call");return}s.value&&v.value.length===1?k(v.value[0]):m.value=!m.value};return(w,d)=>{const b=Qe("click-outside");return t.show?(n(),r("div",{key:0,class:q(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?x("",!0):(n(),r("div",Vs)),e("div",{class:q(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:le(I,["stop"]),class:q(p.value)},[d[0]||(d[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),s.value?(n(),r("span",Ps,g(f.value),1)):x("",!0)],2),m.value&&c.value?S((n(),r("div",Os,[E(T(Ge),{items:a.value,className:"w-48"},null,8,["items"])])),[[b,()=>m.value=!1]]):x("",!0)],2),t.inline?x("",!0):(n(),r("div",Ms))],2)):x("",!0)}}},Rs={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},qs={class:"flex items-start gap-3"},Bs={class:"flex-1 min-w-0"},Fs={class:"font-bold text-sm text-heading mb-2"},Us={class:"space-y-1.5 text-xs text-gray-600"},Ns={class:"flex items-center gap-2"},js={class:"flex items-center gap-2"},Ws={class:"flex items-center gap-2"},zs={key:0,class:"mt-2"},Hs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const o=t,l=D(()=>o.appointmentData.date?new Date(o.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),i=D(()=>o.appointmentData.time?o.appointmentData.time:""),m=u=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[u==null?void 0:u.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(u,v)=>(n(),r("div",Rs,[e("div",qs,[v[3]||(v[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Bs,[e("h4",Fs,g(t.appointmentData.type),1),e("div",Us,[e("div",Ns,[v[0]||(v[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,g(l.value),1)]),e("div",js,[v[1]||(v[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,g(i.value),1)]),e("div",Ws,[v[2]||(v[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,g(t.appointmentData.assignee),1)])]),t.appointmentData.status?(n(),r("div",zs,[e("span",{class:q(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",m(t.appointmentData.status)])},g(t.appointmentData.status),3)])):x("",!0)])])]))}},Ys={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Qs={class:"flex-1"},Gs={class:"flex items-center gap-2 mb-1"},Ks={class:"text-meta-bold text-heading"},Js={class:"text-meta"},Xs={class:"text-meta"},Zs={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},_s={class:"ml-auto relative"},en={key:0,class:"absolute right-0 top-full mt-1 z-10"},tn={key:0,class:"text-content text-body"},ln={key:1,class:"text-content text-body flex items-center gap-2"},an={key:2,class:"mt-2"},sn={key:0},nn={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},on={key:0},rn={class:"text-content font-bold text-heading"},dn={key:0,class:"text-meta mt-0.5"},un={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},cn={key:0},mn={key:1},fn={key:2},pn={key:3},vn={key:4},yn={key:1},bn={class:"text-content font-bold text-heading mb-2"},gn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},xn={key:0},hn={class:"text-body font-medium ml-1"},kn={key:1},wn={class:"text-body font-medium ml-1"},$n={key:2},In={class:"text-body font-medium ml-1"},Tn={key:3},Cn={class:"text-body font-medium ml-1"},Sn={key:4},An={class:"text-body font-medium ml-1"},Dn={key:5},En={class:"text-body font-medium ml-1"},Ln={key:2,class:"flex items-center gap-3"},Vn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Pn=["src"],On={class:"flex-1"},Mn={class:"text-content font-bold text-heading"},Rn={class:"text-meta"},qn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Bn={key:3,class:"flex items-center gap-3"},Fn={class:"flex-1"},Un={class:"text-content font-bold text-heading"},Nn={class:"text-meta"},jn={key:0,class:"text-meta mt-1"},Wn={key:1,class:"text-meta mt-1"},zn={key:4},Hn={class:"text-content font-bold text-heading mb-2"},Yn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},Qn={key:0},Gn={class:"text-body font-medium ml-1"},Kn={key:1},Jn={class:"text-body font-medium ml-1"},Xn={key:2},Zn={class:"text-body font-medium ml-1"},_n={key:3},ei={class:"text-body font-medium ml-1"},ti={key:4},li={class:"text-body font-medium ml-1"},ai={key:5},si={class:"text-body font-medium ml-1"},ni={key:0,class:"flex flex-wrap gap-2 mt-2"},ii={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},oi={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},ri={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},ze={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:o}){const l=t,i=o,m=R(!1),u=D(()=>[{key:"edit",label:"Edit",onClick:p},{key:"delete",label:"Delete",onClick:k}]),v=I=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[I]||"fa-solid fa-circle",s=I=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[I]||"bg-surfaceSecondary text-body border",f=I=>{if(!I)return"Just now";const w=new Date(I),b=new Date-w,$=Math.floor(b/6e4),h=Math.floor($/60),V=Math.floor(h/24);return $<1?"Just now":$<60?`${$} minutes ago`:h<24?`${h} hours ago`:V===1?"Yesterday":V<7?`${V} days ago`:w.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},c=I=>I?new Intl.NumberFormat("en-US").format(I):"0",a=I=>I?new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",p=()=>{m.value=!1,i("edit",l.item)},k=()=>{m.value=!1,confirm("Are you sure you want to delete this item?")&&i("delete",l.item)};return(I,w)=>{const d=Qe("click-outside");return n(),r("div",Ys,[e("div",{class:q(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",s(t.item.type)])},[e("i",{class:q([v(t.item.type),"text-sm"])},null,2)],2),e("div",Qs,[e("div",Gs,[e("span",Ks,g(t.customerInitials),1),e("span",Js,g(t.item.action||"added"),1),e("span",Xs,"• "+g(f(t.item.timestamp)),1),t.item.autoDetected?(n(),r("span",Zs,"Auto-detected")):x("",!0),e("div",_s,[e("button",{onClick:w[0]||(w[0]=le(b=>m.value=!m.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),m.value?S((n(),r("div",en,[E(T(Ge),{items:u.value,className:"w-32"},null,8,["items"])])),[[d,()=>m.value=!1]]):x("",!0)])]),t.item.content?(n(),r("div",tn,g(t.item.content),1)):x("",!0),t.item.fileName?(n(),r("div",ln,[w[2]||(w[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,g(t.item.fileName),1)])):x("",!0),t.item.data?(n(),r("div",an,[t.item.type==="appointment"?(n(),r("div",sn,[E(Hs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(n(),r("div",nn,[t.item.type==="tradein"?(n(),r("div",on,[e("h4",rn,g(t.item.data.brand)+" "+g(t.item.data.model),1),t.item.data.version?(n(),r("p",dn,g(t.item.data.version),1)):x("",!0),e("div",un,[t.item.data.year?(n(),r("div",cn,[w[3]||(w[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(g(t.item.data.year),1)])):x("",!0),t.item.data.km?(n(),r("div",mn,[w[4]||(w[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(g(t.item.data.km)+" km ",1)])):x("",!0),t.item.data.plate?(n(),r("div",fn,[w[5]||(w[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(g(t.item.data.plate),1)])):x("",!0),t.item.data.date?(n(),r("div",pn,[w[6]||(w[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(g(a(t.item.data.date)),1)])):x("",!0),t.item.data.class?(n(),r("div",vn,[w[7]||(w[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(g(t.item.data.class),1)])):x("",!0)])])):t.item.type==="financing"?(n(),r("div",yn,[e("h4",bn,g(t.item.data.product),1),e("div",gn,[t.item.data.provider?(n(),r("div",xn,[w[8]||(w[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",hn,g(t.item.data.provider),1)])):x("",!0),t.item.data.total?(n(),r("div",kn,[w[9]||(w[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",wn,"€"+g(c(t.item.data.total)),1)])):x("",!0),t.item.data.monthly?(n(),r("div",$n,[w[10]||(w[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",In,"€"+g(c(t.item.data.monthly)),1)])):x("",!0),t.item.data.deposit?(n(),r("div",Tn,[w[11]||(w[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Cn,"€"+g(c(t.item.data.deposit)),1)])):x("",!0),t.item.data.startDate?(n(),r("div",Sn,[w[12]||(w[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",An,g(a(t.item.data.startDate)),1)])):x("",!0),t.item.data.expDate?(n(),r("div",Dn,[w[13]||(w[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",En,g(a(t.item.data.expDate)),1)])):x("",!0)])])):t.item.type==="offer"?(n(),r("div",Ln,[t.item.data.image?(n(),r("div",Vn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Pn)])):x("",!0),e("div",On,[e("h4",Mn,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",Rn,"€ "+g(c(t.item.data.price)),1)]),t.item.data.isMainOffer?(n(),r("span",qn,"Main Offer")):x("",!0)])):t.item.type==="purchase"?(n(),r("div",Bn,[e("div",Fn,[e("h4",Un,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",Nn,"€ "+g(c(t.item.data.price)),1),t.item.data.purchaseDate?(n(),r("p",jn,"Purchased: "+g(a(t.item.data.purchaseDate)),1)):x("",!0),t.item.data.notes?(n(),r("p",Wn,g(t.item.data.notes),1)):x("",!0)])])):t.item.type==="purchase-method"?(n(),r("div",zn,[e("h4",Hn,g(t.item.data.typeLabel||t.item.data.type),1),e("div",Yn,[t.item.data.monthlyInstalment?(n(),r("div",Qn,[w[14]||(w[14]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Gn,"€"+g(c(t.item.data.monthlyInstalment)),1)])):x("",!0),t.item.data.duration?(n(),r("div",Kn,[w[15]||(w[15]=e("span",{class:"text-gray-500"},"Duration:",-1)),e("span",Jn,g(t.item.data.duration)+" months",1)])):x("",!0),t.item.data.downPayment?(n(),r("div",Xn,[w[16]||(w[16]=e("span",{class:"text-gray-500"},"Down Payment:",-1)),e("span",Zn,"€"+g(c(t.item.data.downPayment)),1)])):x("",!0),t.item.data.interestRate?(n(),r("div",_n,[w[17]||(w[17]=e("span",{class:"text-gray-500"},"Interest Rate:",-1)),e("span",ei,g(t.item.data.interestRate)+"%",1)])):x("",!0),t.item.data.mileageLimit?(n(),r("div",ti,[w[18]||(w[18]=e("span",{class:"text-gray-500"},"Mileage Limit:",-1)),e("span",li,g(c(t.item.data.mileageLimit))+" km/year",1)])):x("",!0),t.item.data.customerType?(n(),r("div",ai,[w[19]||(w[19]=e("span",{class:"text-gray-500"},"Customer Type:",-1)),e("span",si,g(t.item.data.customerType),1)])):x("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(n(),r("div",ni,[t.item.data.insuranceIncluded?(n(),r("span",ii,"Insurance")):x("",!0),t.item.data.maintenanceIncluded?(n(),r("span",oi,"Maintenance")):x("",!0),t.item.data.registrationTaxesIncluded?(n(),r("span",ri,"Registration/Taxes")):x("",!0)])):x("",!0)])):x("",!0)]))])):x("",!0)])])}}},di={class:"h-16 px-5 border-b border-black/5 bg-surfaceSecondary/50 flex items-center justify-between gap-3"},ui={class:"flex items-center gap-3"},ci=["title"],mi={key:0,class:"fa-solid fa-arrow-left text-fluid-sm"},fi={key:1,class:"fa-solid fa-arrow-right text-fluid-sm"},pi={key:2,class:"font-bold text-fluid-lg text-heading"},vi={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},yi={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},bi={key:1,class:"text-center py-8 text-sub relative z-10"},gi={class:"text-fluid-sm"},xi={key:2,class:"space-y-6 relative z-10"},hi={key:0,class:"mb-4 pl-12"},ki={class:"text-fluid-sm font-semibold text-heading"},wi={class:"flex gap-4 relative mb-6"},$i={class:"flex-1 min-w-0"},Ii={class:"text-fluid-sm text-slate-700 leading-snug"},Ti={class:"font-bold"},Ci={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},Si={class:"text-fluid-xs text-sub mt-1"},Ai={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},Di={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},Ei={key:1,class:"space-y-4 relative z-10"},Li=["title"],Vi={key:2,class:"text-center py-8 text-sub relative z-10"},Pi={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:o}){const l=t,i=f=>{const c={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return c[f]||c.default},m=f=>{const c={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return c[f]||c.default},u=f=>{if(!f)return"";const c=new Date(f),a=new Date,p=new Date(a);return p.setDate(p.getDate()-1),c.toDateString()===a.toDateString()?"Today":c.toDateString()===p.toDateString()?"Yesterday":c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},v=f=>f?new Date(f).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",s=(f,c)=>{if(f===0)return!0;const a=l.activities[f-1];if(!a)return!0;const p=new Date(c.timestamp).toDateString(),k=new Date(a.timestamp).toDateString();return p!==k};return(f,c)=>t.show?(n(),r("div",{key:0,class:q(["bg-surface border-l border-black/5 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",di,[e("div",ui,[t.mobileFullscreen?(n(),r("button",{key:0,onClick:c[0]||(c[0]=a=>f.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-xmark text-fluid-lg"},null,-1)])])):t.showCollapse?(n(),r("button",{key:1,onClick:c[1]||(c[1]=a=>f.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(n(),r("i",mi)):(n(),r("i",fi))],8,ci)):x("",!0),t.collapsed?x("",!0):(n(),r("h2",pi,g(t.title),1))])]),t.collapsed?(n(),r("div",Ai,[t.activities.length>0?(n(),r("div",Di)):x("",!0),t.activities.length>0?(n(),r("div",Ei,[(n(!0),r(H,null,K(t.activities,a=>(n(),r("div",{key:a.id,class:"relative"},[e("div",{class:q(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border-black/5",m(a.type)]),title:`${a.user} ${a.action}`},[e("i",{class:q([i(a.type),"text-fluid-xs"])},null,2)],10,Li)]))),128))])):(n(),r("div",Vi,[...c[4]||(c[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(n(),r("div",vi,[t.activities.length>0?(n(),r("div",yi)):x("",!0),t.activities.length===0?(n(),r("div",bi,[c[3]||(c[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",gi,g(t.emptyMessage),1)])):(n(),r("div",xi,[(n(!0),r(H,null,K(t.activities,(a,p)=>(n(),r(H,{key:a.id},[s(p,a)?(n(),r("div",hi,[e("h3",ki,g(u(a.timestamp)),1)])):x("",!0),e("div",wi,[e("div",{class:q(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",m(a.type)])},[e("i",{class:q([i(a.type),"text-fluid-sm"])},null,2)],2),e("div",$i,[e("div",Ii,[e("span",Ti,g(a.user),1),N(" "+g(a.action),1)]),a.content?(n(),r("div",Ci,g(a.content),1)):x("",!0),e("div",Si,g(v(a.timestamp)),1)])])],64))),128))]))]))],2)):x("",!0)}},Oi={class:"space-y-3"},Mi={class:"flex justify-end gap-2"},ut={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,i=o,m=R(l.initialTemplate),u=R(""),v=R(l.initialMessage),s={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},f=()=>{m.value&&s[m.value]&&(u.value=s[m.value].subject,v.value=s[m.value].message)},c=()=>{v.value.trim()&&i("send",{type:"email",template:m.value,subject:u.value,message:v.value})};return(a,p)=>(n(),r("div",Oi,[e("div",null,[p[5]||(p[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),S(e("select",{"onUpdate:modelValue":p[0]||(p[0]=k=>m.value=k),onChange:f,class:"input"},[...p[4]||(p[4]=[be('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[Z,m.value]])]),e("div",null,[p[6]||(p[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),S(e("input",{"onUpdate:modelValue":p[1]||(p[1]=k=>u.value=k),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[M,u.value]])]),e("div",null,[p[7]||(p[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),S(e("textarea",{"onUpdate:modelValue":p[2]||(p[2]=k=>v.value=k),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[M,v.value]])]),e("div",Mi,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:p[3]||(p[3]=k=>a.$emit("cancel"))}),E(T(z),{label:"Send Email",variant:"primary",size:"small",onClick:c})])]))}},Ri={class:"space-y-3"},qi={class:"text-fluid-xs text-sub mt-1"},Bi={class:"flex justify-end gap-2"},ct={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,i=o,m=R(l.initialTemplate),u=R(l.initialMessage),v={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},s=()=>{m.value&&v[m.value]&&(u.value=v[m.value])},f=()=>{u.value.trim()&&i("send",{type:"sms",template:m.value,message:u.value})};return(c,a)=>(n(),r("div",Ri,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),S(e("select",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),onChange:s,class:"input"},[...a[3]||(a[3]=[be('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[Z,m.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),S(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=p=>u.value=p),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[M,u.value]]),e("p",qi,g(u.value.length)+"/160 characters",1)]),e("div",Bi,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=p=>c.$emit("cancel"))}),E(T(z),{label:"Send SMS",variant:"primary",size:"small",onClick:f})])]))}},Fi={class:"space-y-3"},Ui={class:"flex justify-end gap-2"},mt={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,i=o,m=R(l.initialTemplate),u=R(l.initialMessage),v={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},s=()=>{m.value&&v[m.value]&&(u.value=v[m.value])},f=()=>{u.value.trim()&&i("send",{type:"whatsapp",template:m.value,message:u.value})};return(c,a)=>(n(),r("div",Fi,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),S(e("select",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),onChange:s,class:"input"},[...a[3]||(a[3]=[be('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[Z,m.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),S(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=p=>u.value=p),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[M,u.value]])]),e("div",Ui,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=p=>c.$emit("cancel"))}),E(T(z),{label:"Send WhatsApp",variant:"outline",size:"small",onClick:f})])]))}},Ni={class:"space-y-3"},ji={class:"space-y-2"},Wi={class:"flex-1"},zi={class:"text-xs text-sub uppercase"},Hi={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},ft={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:o}){const l=t,i=o,m=R(""),u=v=>{v==="copy"&&navigator.clipboard.writeText(l.phoneNumber),i("call",{type:"call",option:v,phoneNumber:l.phoneNumber,notes:m.value})};return(v,s)=>(n(),r("div",Ni,[e("div",ji,[s[10]||(s[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:s[0]||(s[0]=f=>u("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...s[5]||(s[5]=[be('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:s[1]||(s[1]=f=>u("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...s[6]||(s[6]=[be('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:s[2]||(s[2]=f=>u("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[s[8]||(s[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Wi,[s[7]||(s[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",zi,g(t.phoneNumber),1)]),s[9]||(s[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),S(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=f=>m.value=f),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[M,m.value]])]),e("div",Hi,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:s[4]||(s[4]=f=>v.$emit("cancel"))})])]))}},Yi={key:0,class:"space-y-4"},Qi={class:"grid grid-cols-4 gap-2"},Gi=["onClick"],Ki={class:"text-xs font-bold uppercase tracking-wider"},Ji={key:1,class:"space-y-4"},Xi={class:"grid grid-cols-4 gap-2"},Zi=["onClick"],_i={class:"text-xs font-bold uppercase tracking-wider"},eo={key:0},pt={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:o}){const l=t,i=o,m=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],u=R(l.type);oe(()=>l.type,a=>{a?u.value=a:u.value=null}),oe(()=>l.taskId,()=>{u.value=null});const v=D(()=>a=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${u.value===a?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),s=a=>{i("save",{type:"communication",action:`sent via ${a.type}`,content:a.message,communicationType:a.type,template:a.template,subject:a.subject}),i("send",a)},f=a=>{i("save",{type:"communication",action:`called via ${a.option}`,content:a.notes||"Call attempt logged",communicationType:"call",callOption:a.option}),i("send",{type:"call",option:a.option,phoneNumber:a.phoneNumber,notes:a.notes})},c=()=>{u.value=null,i("cancel")};return(a,p)=>t.inline?(n(),r("div",Ji,[e("div",Xi,[(n(),r(H,null,K(m,k=>e("button",{key:k.id,onClick:I=>u.value=k.id,class:q(v.value(k.id))},[e("i",{class:q([k.icon,"text-sm"])},null,2),e("span",_i,g(k.label),1)],10,Zi)),64))]),u.value?(n(),r("div",eo,[u.value==="email"?(n(),j(ut,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="sms"?(n(),j(ct,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="whatsapp"?(n(),j(mt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="call"?(n(),j(ft,{key:3,"phone-number":t.phoneNumber,onCall:f,onCancel:c},null,8,["phone-number"])):x("",!0)])):x("",!0)])):(n(),r("div",Yi,[e("div",Qi,[(n(),r(H,null,K(m,k=>e("button",{key:k.id,onClick:I=>u.value=k.id,class:q(v.value(k.id))},[e("i",{class:q([k.icon,"text-sm"])},null,2),e("span",Ki,g(k.label),1)],10,Gi)),64))]),e("div",null,[u.value==="email"?(n(),j(ut,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="sms"?(n(),j(ct,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="whatsapp"?(n(),j(mt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:s,onCancel:c},null,8,["initial-template","initial-message"])):u.value==="call"?(n(),j(ft,{key:3,"phone-number":t.phoneNumber,onCall:f,onCancel:c},null,8,["phone-number"])):x("",!0)])]))}},to={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},lo={key:1,class:"flex justify-between items-center mb-4"},ao={class:"text-fluid-sm font-semibold text-heading"},so={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},vt={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const i=t,m=l,u=R("");me(()=>{i.item&&(u.value=i.item.content||"")});const v=()=>{var s,f;u.value.trim()&&m("save",{id:((s=i.item)==null?void 0:s.id)||Date.now(),type:"note",action:i.item?"updated a note":"added a note",content:u.value,timestamp:((f=i.item)==null?void 0:f.timestamp)||new Date().toISOString(),isEdit:!!i.item})};return o({submit:v,canSubmit:()=>!!u.value.trim()}),(s,f)=>(n(),r("div",{class:q(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(n(),r("div",to)),t.hideHeader?x("",!0):(n(),r("div",lo,[e("h5",ao,g(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:f[0]||(f[0]=c=>s.$emit("cancel")),class:"text-sub hover:text-body"},[...f[3]||(f[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[f[4]||(f[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),S(e("textarea",{"onUpdate:modelValue":f[1]||(f[1]=c=>u.value=c),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[M,u.value]])]),t.hideActions?x("",!0):(n(),r("div",so,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:f[2]||(f[2]=c=>s.$emit("cancel"))}),E(T(z),{label:"Save",variant:"primary",size:"small",onClick:v})]))],2))}},no={class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},io={class:"flex justify-between items-center mb-4"},oo={class:"text-fluid-sm font-semibold text-heading"},ro={class:"flex items-center gap-3"},uo={key:0,class:"text-fluid-sm text-slate-600"},co={key:1,class:"text-fluid-sm text-sub"},mo={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},yt={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:o}){const l=t,i=o,m=R(null),u=R("");me(()=>{l.item&&(u.value=l.item.fileName||"")});const v=f=>{const c=f.target.files[0];c&&(m.value=c,u.value=c.name)},s=()=>{var f,c;!m.value&&!l.item||i("save",{id:((f=l.item)==null?void 0:f.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:u.value,timestamp:((c=l.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return(f,c)=>(n(),r("div",no,[c[5]||(c[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",io,[e("h5",oo,g(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:c[0]||(c[0]=a=>f.$emit("cancel")),class:"text-sub hover:text-body"},[...c[3]||(c[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[c[4]||(c[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",ro,[e("input",{type:"file",onChange:v,ref:"fileInput",class:"hidden"},null,544),E(T(z),{label:"Choose File",variant:"outline",size:"small",onClick:c[1]||(c[1]=a=>f.$refs.fileInput.click())}),u.value?(n(),r("span",uo,g(u.value),1)):(n(),r("span",co,"No file selected"))])]),e("div",mo,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:c[2]||(c[2]=a=>f.$emit("cancel"))}),E(T(z),{label:"Save",variant:"primary",size:"small",disabled:!m.value,onClick:s},null,8,["disabled"])])]))}},fo={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},po={key:1,class:"flex justify-between items-center mb-4"},vo={class:"text-fluid-sm font-semibold text-heading"},yo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},bo=["max"],go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ho={class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},ko={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},wo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$o={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Io={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},To={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const i=t,m=l,u=R(!1),v=R({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),s=R({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),f=D(()=>!!v.value.brand&&!!v.value.model&&!!v.value.year);me(()=>{i.item&&i.item.data&&(v.value={brand:i.item.data.brand||"",model:i.item.data.model||"",year:i.item.data.year||"",version:i.item.data.version||"",vin:i.item.data.vin||"",plates:i.item.data.plate||i.item.data.plates||"",fuelType:i.item.data.fuelType||"",gearType:i.item.data.gearType||"",kilometers:i.item.data.km||i.item.data.kilometers||"",registration:i.item.data.date||i.item.data.registration||""},i.item.data.tradeInPrice!==void 0&&(s.value={tradeInPrice:i.item.data.tradeInPrice||null,evaluationRangeLow:i.item.data.evaluationRangeLow||null,evaluationRangeHigh:i.item.data.evaluationRangeHigh||null,provider:i.item.data.provider||"",evaluationDate:i.item.data.evaluationDate||""},u.value=!0))});const c=()=>{var p,k;if(!f.value)return;const a={id:((p=i.item)==null?void 0:p.id)||Date.now(),type:"tradein",action:i.item?"updated a trade-in":"added a trade-in",timestamp:((k=i.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!i.item,data:{brand:v.value.brand,model:v.value.model,year:parseInt(v.value.year)||null,version:v.value.version||null,vin:v.value.vin||null,plate:v.value.plates||null,plates:v.value.plates||null,fuelType:v.value.fuelType||null,gearType:v.value.gearType||null,km:parseInt(v.value.kilometers)||0,kilometers:parseInt(v.value.kilometers)||0,date:v.value.registration||null,registration:v.value.registration||null,tradeInPrice:s.value.tradeInPrice,evaluationRangeLow:s.value.evaluationRangeLow,evaluationRangeHigh:s.value.evaluationRangeHigh,provider:s.value.provider||null,evaluationDate:s.value.evaluationDate||null}};m("save",a)};return o({submit:c,canSubmit:()=>f.value}),(a,p)=>(n(),r("div",{class:q(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(n(),r("div",fo)),t.hideHeader?x("",!0):(n(),r("div",po,[e("h5",vo,g(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:p[0]||(p[0]=k=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...p[18]||(p[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:le(c,["prevent"]),class:"space-y-4"},[e("div",yo,[e("div",null,[p[19]||(p[19]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Brand "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("input",{"onUpdate:modelValue":p[1]||(p[1]=k=>v.value.brand=k),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[M,v.value.brand]])]),e("div",null,[p[20]||(p[20]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Model "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("input",{"onUpdate:modelValue":p[2]||(p[2]=k=>v.value.model=k),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[M,v.value.model]])]),e("div",null,[p[21]||(p[21]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Year "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("input",{"onUpdate:modelValue":p[3]||(p[3]=k=>v.value.year=k),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,bo),[[M,v.value.year]])])]),e("div",null,[p[22]||(p[22]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Version/Trim",-1)),S(e("input",{"onUpdate:modelValue":p[4]||(p[4]=k=>v.value.version=k),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[M,v.value.version]])]),e("div",go,[e("div",null,[p[23]||(p[23]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"VIN",-1)),S(e("input",{"onUpdate:modelValue":p[5]||(p[5]=k=>v.value.vin=k),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[M,v.value.vin]])]),e("div",null,[p[24]||(p[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Plates",-1)),S(e("input",{"onUpdate:modelValue":p[6]||(p[6]=k=>v.value.plates=k),type:"text",placeholder:"License plate number",class:"input"},null,512),[[M,v.value.plates]])])]),e("div",xo,[e("div",null,[p[26]||(p[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Fuel Type",-1)),S(e("select",{"onUpdate:modelValue":p[7]||(p[7]=k=>v.value.fuelType=k),class:"input"},[...p[25]||(p[25]=[be('<option value="">Select fuel type...</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[Z,v.value.fuelType]])]),e("div",null,[p[28]||(p[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Gear Type",-1)),S(e("select",{"onUpdate:modelValue":p[8]||(p[8]=k=>v.value.gearType=k),class:"input"},[...p[27]||(p[27]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[Z,v.value.gearType]])]),e("div",null,[p[29]||(p[29]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage (km)",-1)),S(e("input",{"onUpdate:modelValue":p[9]||(p[9]=k=>v.value.kilometers=k),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[M,v.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[p[30]||(p[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Registration Year/Month",-1)),S(e("input",{"onUpdate:modelValue":p[10]||(p[10]=k=>v.value.registration=k),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[M,v.value.registration]])]),e("div",ho,[e("button",{type:"button",onClick:p[11]||(p[11]=k=>u.value=!u.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-card"},[p[31]||(p[31]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:q(["fa-solid transition-transform duration-200 text-sub",u.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),u.value?(n(),r("div",ko,[e("div",null,[p[32]||(p[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Trade-In Price (€)",-1)),S(e("input",{"onUpdate:modelValue":p[12]||(p[12]=k=>s.value.tradeInPrice=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,s.value.tradeInPrice,void 0,{number:!0}]])]),e("div",wo,[e("div",null,[p[33]||(p[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - Low (€)",-1)),S(e("input",{"onUpdate:modelValue":p[13]||(p[13]=k=>s.value.evaluationRangeLow=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,s.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[p[34]||(p[34]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - High (€)",-1)),S(e("input",{"onUpdate:modelValue":p[14]||(p[14]=k=>s.value.evaluationRangeHigh=k),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,s.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",$o,[e("div",null,[p[36]||(p[36]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Provider",-1)),S(e("select",{"onUpdate:modelValue":p[15]||(p[15]=k=>s.value.provider=k),class:"input"},[...p[35]||(p[35]=[be('<option value="">Select provider...</option><option value="Eurotax">Eurotax</option><option value="Infocar">Infocar</option><option value="Manual">Manual</option><option value="Other">Other</option>',5)])],512),[[Z,s.value.provider]])]),e("div",null,[p[37]||(p[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Date",-1)),S(e("input",{"onUpdate:modelValue":p[16]||(p[16]=k=>s.value.evaluationDate=k),type:"date",class:"input"},null,512),[[M,s.value.evaluationDate]])])])])):x("",!0)])],32),t.hideActions?x("",!0):(n(),r("div",Io,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:p[17]||(p[17]=k=>a.$emit("cancel"))}),E(T(z),{label:"Save",variant:"primary",size:"small",disabled:!f.value,onClick:c},null,8,["disabled"])]))],2))}},Co={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},So={key:1,class:"flex justify-between items-center mb-4"},Ao={class:"text-fluid-sm font-semibold text-heading"},Do={class:"flex gap-2"},Eo=["value"],Lo={key:0,class:"space-y-4"},Vo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Po={class:"relative"},Oo={key:0,class:"text-xs text-red-600 mt-1"},Mo={class:"relative"},Ro={key:0,class:"text-xs text-red-600 mt-1"},qo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bo=["value"],Fo={key:0,class:"text-xs text-red-600 mt-1"},Uo={key:0},No={class:"relative"},jo={key:1},Wo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zo={class:"relative"},Ho={class:"relative"},Yo={class:"flex items-center gap-2"},Qo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Go={class:"relative"},Ko={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Jo={class:"flex justify-between items-center"},Xo={class:"text-lg font-bold text-heading"},Zo={class:"flex flex-col gap-2"},_o={class:"flex items-center gap-2"},er={class:"flex items-center gap-2"},tr={key:0,class:"text-xs text-red-600 mt-1"},lr={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},ar={class:"flex justify-between items-center"},sr={class:"text-lg font-bold text-heading"},nr={class:"flex flex-col gap-2"},ir={class:"flex items-center gap-2"},or={class:"flex items-center gap-2"},rr={class:"flex items-center gap-2"},dr={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},ur={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const i=t,m=l,u=R({}),v=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],s=R({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),f=D(()=>{if(s.value.type!=="LEA")return 0;const $=parseFloat(s.value.fields.monthlyInstalment)||0,h=parseInt(s.value.fields.duration)||0,V=parseFloat(s.value.fields.downPayment)||0,ee=parseFloat(s.value.fields.finalInstalment)||0;return $*h+V+ee}),c=D(()=>{if(s.value.type!=="LTR")return 0;const $=parseFloat(s.value.fields.monthlyInstalment)||0,h=parseInt(s.value.fields.duration)||0,V=parseFloat(s.value.fields.downPayment)||0;return $*h+V}),a=$=>$==="FIN"?[12,24,36,48,60]:$==="LEA"?[24,36,48,60]:$==="LTR"?[12,24,36,48,60]:[],p=$=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[$]||$,k=$=>$?new Intl.NumberFormat("en-US").format($):"0",I=$=>{delete u.value[$]},w=D(()=>!s.value.type||!s.value.fields.monthlyInstalment||s.value.fields.monthlyInstalment<=0||s.value.fields.downPayment===null||s.value.fields.downPayment===void 0||s.value.fields.downPayment<0||!s.value.fields.duration||s.value.fields.duration<12||s.value.fields.duration>60||s.value.type==="LTR"&&!s.value.fields.customerType?!1:Object.keys(u.value).length===0),d=()=>{s.value.type!=="FIN"&&(s.value.fields.effectiveInterestRate=null,s.value.fields.gfv=null),s.value.type!=="LEA"&&(s.value.fields.finalInstalment=null),s.value.type!=="LTR"&&(s.value.fields.customerType="",s.value.fields.registrationTaxesIncluded=!1),s.value.type!=="LEA"&&s.value.type!=="LTR"&&(s.value.fields.mileageLimit=null,s.value.fields.maintenanceIncluded=!1),u.value={}};me(()=>{i.item&&i.item.data&&(s.value={type:i.item.data.type||"",fields:{monthlyInstalment:i.item.data.monthlyInstalment||null,downPayment:i.item.data.downPayment||null,duration:i.item.data.duration||null,interestRate:i.item.data.interestRate||null,effectiveInterestRate:i.item.data.effectiveInterestRate||null,gfv:i.item.data.gfv||null,mileageLimit:i.item.data.mileageLimit||null,finalInstalment:i.item.data.finalInstalment||null,customerType:i.item.data.customerType||"",insuranceIncluded:i.item.data.insuranceIncluded||!1,maintenanceIncluded:i.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:i.item.data.registrationTaxesIncluded||!1}})});const b=()=>{var ne,ue;if(!w.value)return;const $=p(s.value.type),h=s.value.fields.monthlyInstalment||0,V=s.value.fields.duration||0,ee={id:((ne=i.item)==null?void 0:ne.id)||Date.now(),type:"purchase-method",action:i.item?"updated a purchase method":"added a purchase method",content:`${$}: €${k(h)}/month for ${V} months`,timestamp:((ue=i.item)==null?void 0:ue.timestamp)||new Date().toISOString(),isEdit:!!i.item,data:{type:s.value.type,typeLabel:$,monthlyInstalment:s.value.fields.monthlyInstalment,downPayment:s.value.fields.downPayment,duration:s.value.fields.duration,interestRate:s.value.fields.interestRate,effectiveInterestRate:s.value.fields.effectiveInterestRate,gfv:s.value.fields.gfv,mileageLimit:s.value.fields.mileageLimit,finalInstalment:s.value.fields.finalInstalment,customerType:s.value.fields.customerType,insuranceIncluded:s.value.fields.insuranceIncluded,maintenanceIncluded:s.value.fields.maintenanceIncluded,registrationTaxesIncluded:s.value.fields.registrationTaxesIncluded,totalLeasingAmount:f.value,totalRentalAmount:c.value}};m("save",ee)};return o({submit:b,canSubmit:()=>w.value}),($,h)=>(n(),r("div",{class:q(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(n(),r("div",Co)),t.hideHeader?x("",!0):(n(),r("div",So,[e("h5",Ao,g(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:h[0]||(h[0]=V=>$.$emit("cancel")),class:"text-sub hover:text-body"},[...h[23]||(h[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:le(b,["prevent"]),class:"space-y-4"},[e("div",null,[h[24]||(h[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},[N("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Do,[(n(),r(H,null,K(v,V=>e("label",{key:V.value,class:"flex-1 cursor-pointer"},[S(e("input",{type:"radio",value:V.value,"onUpdate:modelValue":h[1]||(h[1]=ee=>s.value.type=ee),class:"sr-only",onChange:d},null,40,Eo),[[xt,s.value.type]]),e("div",{class:q(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",s.value.type===V.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},g(V.label),3)])),64))])]),s.value.type?(n(),r("div",Lo,[e("div",Vo,[e("div",null,[h[26]||(h[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Po,[h[25]||(h[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":h[2]||(h[2]=V=>s.value.fields.monthlyInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":u.value.monthlyInstalment}]),onInput:h[3]||(h[3]=V=>I("monthlyInstalment"))},null,34),[[M,s.value.fields.monthlyInstalment,void 0,{number:!0}]])]),u.value.monthlyInstalment?(n(),r("p",Oo,g(u.value.monthlyInstalment),1)):x("",!0)]),e("div",null,[h[28]||(h[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Mo,[h[27]||(h[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":h[4]||(h[4]=V=>s.value.fields.downPayment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":u.value.downPayment}]),onInput:h[5]||(h[5]=V=>I("downPayment"))},null,34),[[M,s.value.fields.downPayment,void 0,{number:!0}]])]),u.value.downPayment?(n(),r("p",Ro,g(u.value.downPayment),1)):x("",!0)])]),e("div",qo,[e("div",null,[h[30]||(h[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("select",{"onUpdate:modelValue":h[6]||(h[6]=V=>s.value.fields.duration=V),class:q(["input",{"border-red-500":u.value.duration}]),onChange:h[7]||(h[7]=V=>I("duration"))},[h[29]||(h[29]=e("option",{value:""},"Select duration...",-1)),(n(!0),r(H,null,K(a(s.value.type),V=>(n(),r("option",{key:V,value:V},g(V)+" months ",9,Bo))),128))],34),[[Z,s.value.fields.duration,void 0,{number:!0}]]),u.value.duration?(n(),r("p",Fo,g(u.value.duration),1)):x("",!0)]),s.value.type==="FIN"||s.value.type==="LEA"?(n(),r("div",Uo,[h[32]||(h[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Interest Rate / APR (%)",-1)),e("div",No,[S(e("input",{"onUpdate:modelValue":h[8]||(h[8]=V=>s.value.fields.interestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:h[9]||(h[9]=V=>I("interestRate"))},null,544),[[M,s.value.fields.interestRate,void 0,{number:!0}]]),h[31]||(h[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])])):x("",!0),s.value.type==="LEA"||s.value.type==="LTR"?(n(),r("div",jo,[h[33]||(h[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage Limit (annual km)",-1)),S(e("input",{"onUpdate:modelValue":h[10]||(h[10]=V=>s.value.fields.mileageLimit=V),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[M,s.value.fields.mileageLimit,void 0,{number:!0}]])])):x("",!0)]),s.value.type==="FIN"?(n(),r(H,{key:0},[e("div",Wo,[e("div",null,[h[35]||(h[35]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",zo,[S(e("input",{"onUpdate:modelValue":h[11]||(h[11]=V=>s.value.fields.effectiveInterestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[M,s.value.fields.effectiveInterestRate,void 0,{number:!0}]]),h[34]||(h[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])]),e("div",null,[h[37]||(h[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Ho,[h[36]||(h[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":h[12]||(h[12]=V=>s.value.fields.gfv=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[M,s.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",Yo,[S(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":h[13]||(h[13]=V=>s.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.insuranceIncluded]]),h[38]||(h[38]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):x("",!0),s.value.type==="LEA"?(n(),r(H,{key:1},[e("div",Qo,[e("div",null,[h[40]||(h[40]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Final Instalment (€)",-1)),e("div",Go,[h[39]||(h[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":h[14]||(h[14]=V=>s.value.fields.finalInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[M,s.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Ko,[e("div",Jo,[h[41]||(h[41]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Xo,"€ "+g(k(f.value)),1)]),h[42]||(h[42]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Zo,[e("div",_o,[S(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":h[15]||(h[15]=V=>s.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.insuranceIncluded]]),h[43]||(h[43]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",er,[S(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":h[16]||(h[16]=V=>s.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.maintenanceIncluded]]),h[44]||(h[44]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):x("",!0),s.value.type==="LTR"?(n(),r(H,{key:2},[e("div",null,[h[46]||(h[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("select",{"onUpdate:modelValue":h[17]||(h[17]=V=>s.value.fields.customerType=V),class:q(["input",{"border-red-500":u.value.customerType}]),onChange:h[18]||(h[18]=V=>I("customerType"))},[...h[45]||(h[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[Z,s.value.fields.customerType]]),u.value.customerType?(n(),r("p",tr,g(u.value.customerType),1)):x("",!0)]),e("div",lr,[e("div",ar,[h[47]||(h[47]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",sr,"€ "+g(k(c.value)),1)]),h[48]||(h[48]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",nr,[e("div",ir,[S(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":h[19]||(h[19]=V=>s.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.insuranceIncluded]]),h[49]||(h[49]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",or,[S(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":h[20]||(h[20]=V=>s.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.maintenanceIncluded]]),h[50]||(h[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",rr,[S(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":h[21]||(h[21]=V=>s.value.fields.registrationTaxesIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,s.value.fields.registrationTaxesIncluded]]),h[51]||(h[51]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):x("",!0)])):x("",!0)],32),t.hideActions?x("",!0):(n(),r("div",dr,[E(T(z),{label:"Cancel",variant:"outline",size:"small",onClick:h[22]||(h[22]=V=>$.$emit("cancel"))}),E(T(z),{label:"Save",variant:"primary",size:"small",disabled:!w.value,onClick:b},null,8,["disabled"])]))],2))}};class cr extends Lt{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(o={}){await new Promise(i=>setTimeout(i,300));let l=[...this.dataSource];return o.leadId!==void 0&&(l=l.filter(i=>i.leadId===parseInt(o.leadId))),o.opportunityId!==void 0&&(l=l.filter(i=>i.opportunityId===parseInt(o.opportunityId))),o.type&&(l=l.filter(i=>i.type===o.type)),o.offerId!==void 0&&(l=l.filter(i=>i.offerId===parseInt(o.offerId))),o.vehicleId!==void 0&&(l=l.filter(i=>i.vehicleId===parseInt(o.vehicleId))),l}async findAllByLeadId(o){return this.findAll({leadId:o})}async findAllByOpportunityId(o){return this.findAll({opportunityId:o})}async findById(o){return await new Promise(i=>setTimeout(i,300)),this.dataSource.find(i=>i.id===parseInt(o))||null}async create(o){await new Promise(m=>setTimeout(m,300));const i={id:this.dataSource.length>0?Math.max(...this.dataSource.map(m=>m.id))+1:1,type:o.type,leadId:o.leadId!==void 0?parseInt(o.leadId):void 0,opportunityId:o.opportunityId!==void 0?parseInt(o.opportunityId):void 0,offerId:o.offerId!==void 0?parseInt(o.offerId):void 0,vehicleId:o.vehicleId!==void 0?parseInt(o.vehicleId):void 0,fields:o.fields||{},currency:o.currency||"EUR",offerValidFrom:o.offerValidFrom||null,offerValidTo:o.offerValidTo||null,status:o.status||"active",createdAt:o.createdAt||new Date().toISOString(),createdBy:o.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(i),i}async update(o,l){await new Promise(m=>setTimeout(m,300));const i=this.dataSource.find(m=>m.id===parseInt(o));if(!i)throw new Error("Purchase method not found");return Object.assign(i,l,{updatedAt:new Date().toISOString()}),i}async delete(o){await new Promise(i=>setTimeout(i,300));const l=this.dataSource.findIndex(i=>i.id===parseInt(o));if(l===-1)throw new Error("Purchase method not found");return this.dataSource.splice(l,1),{success:!0}}}class mr{constructor(){this.repository=new cr}calculateTotal(o){const{type:l,fields:i}=o;if(!i)return 0;const m=parseFloat(i.monthlyInstalment)||0,u=parseFloat(i.downPayment)||0,v=parseInt(i.duration)||0;switch(l){case"FIN":return m*v+u;case"LEA":const s=parseFloat(i.finalInstalment)||0;return m*v+u+s;case"LTR":return m*v+u;default:return 0}}validate(o){const l=[],{type:i,fields:m}=o;if((!i||!["FIN","LEA","LTR"].includes(i))&&l.push("Purchase method type is required and must be FIN, LEA, or LTR"),!m)return l.push("Purchase method fields are required"),{isValid:!1,errors:l};const u=parseFloat(m.monthlyInstalment);(!u||u<=0)&&l.push("Monthly Instalment must be greater than 0");const v=parseFloat(m.downPayment);(v==null||v<0)&&l.push("Down Payment must be greater than or equal to 0");const s=parseInt(m.duration);if((!s||s<12||s>60)&&l.push("Duration must be between 12 and 60 months"),i==="FIN"){const f=parseFloat(m.interestRate);f!=null&&(f<0||f>99.99)&&l.push("Interest Rate must be between 0 and 99.99%");const c=parseFloat(m.effectiveInterestRate);c!=null&&(c<0||c>99.99)&&l.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(i==="LEA"){const f=parseFloat(m.mileageLimit);f!=null&&f<=0&&l.push("Mileage Limit must be greater than 0 if provided");const c=parseFloat(m.finalInstalment);c!=null&&c<0&&l.push("Final Instalment must be greater than or equal to 0");const a=parseFloat(m.interestRate);a!=null&&(a<0||a>99.99)&&l.push("Interest Rate must be between 0 and 99.99%")}if(i==="LTR"){const f=parseFloat(m.mileageLimit);f!=null&&f<=0&&l.push("Mileage Limit must be greater than 0 if provided"),(!m.customerType||!["Private","Business","Fleet"].includes(m.customerType))&&l.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:l.length===0,errors:l}}async findAll(o={}){return await this.repository.findAll(o)}async findById(o){return await this.repository.findById(o)}async create(o){const l=this.validate(o);if(!l.isValid)throw new Error(`Validation failed: ${l.errors.join(", ")}`);const i=await this.repository.create(o),m=this.calculateTotal(i);return i.fields={...i.fields,totalAmount:m},await this.repository.update(i.id,{fields:i.fields})}async update(o,l){const i=await this.repository.findById(o);if(!i)throw new Error("Purchase method not found");const m={...i,...l,fields:{...i.fields,...l.fields}},u=this.validate(m);if(!u.isValid)throw new Error(`Validation failed: ${u.errors.join(", ")}`);const v=this.calculateTotal(m);return m.fields.totalAmount=v,await this.repository.update(o,{...l,fields:m.fields})}async delete(o){return await this.repository.delete(o)}}const Ie=new mr,Pe=(t=300)=>new Promise(o=>setTimeout(o,t)),fr=async(t={})=>(await Pe(),await Ie.findAll(t)),pr=async t=>(await Pe(),await Ie.findById(t)),vr=async t=>(await Pe(),await Ie.create(t)),yr=async(t,o)=>(await Pe(),await Ie.update(t,o)),br=async t=>(await Pe(),await Ie.delete(t)),gr=Vt("purchaseMethods",()=>{const t=R([]),o=R(null),l=R(!1),i=R(null),m=D(()=>k=>t.value.filter(I=>I.type===k)),u=D(()=>k=>t.value.filter(I=>I.leadId===parseInt(k))),v=D(()=>k=>t.value.filter(I=>I.opportunityId===parseInt(k)));return{purchaseMethods:t,currentPurchaseMethod:o,loading:l,error:i,purchaseMethodsByType:m,purchaseMethodsByLead:u,purchaseMethodsByOpportunity:v,fetchPurchaseMethods:async(k={})=>{l.value=!0,i.value=null;try{const I=await fr(k);return t.value=I,I}catch(I){throw i.value=I.message,I}finally{l.value=!1}},fetchPurchaseMethodById:async k=>{l.value=!0,i.value=null;try{return o.value=await pr(k),o.value}catch(I){throw i.value=I.message,I}finally{l.value=!1}},createPurchaseMethod:async k=>{l.value=!0,i.value=null;try{const I=await vr(k);return t.value.push(I),I}catch(I){throw i.value=I.message,I}finally{l.value=!1}},updatePurchaseMethod:async(k,I)=>{var w;l.value=!0,i.value=null;try{const d=await yr(k,I),b=t.value.findIndex($=>$.id===k);return b!==-1&&(t.value[b]=d),((w=o.value)==null?void 0:w.id)===k&&(o.value=d),d}catch(d){throw i.value=d.message,d}finally{l.value=!1}},deletePurchaseMethod:async k=>{var I;l.value=!0,i.value=null;try{await br(k),t.value=t.value.filter(w=>w.id!==k),((I=o.value)==null?void 0:I.id)===k&&(o.value=null)}catch(w){throw i.value=w.message,w}finally{l.value=!1}}}}),xr={class:"flex gap-2"},hr=["value"],kr={key:0,class:"space-y-4"},wr={class:"text-h3-card text-heading mb-4"},$r={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ir={class:"relative"},Tr={key:0,class:"text-xs text-red-600 mt-1"},Cr={class:"relative"},Sr={key:0,class:"text-xs text-red-600 mt-1"},Ar={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dr=["value"],Er={key:0,class:"text-xs text-red-600 mt-1"},Lr={key:0},Vr={class:"relative"},Pr={key:0,class:"text-xs text-red-600 mt-1"},Or={key:1},Mr={key:0,class:"text-xs text-red-600 mt-1"},Rr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qr={class:"relative"},Br={key:0,class:"text-xs text-red-600 mt-1"},Fr={class:"relative"},Ur={class:"flex items-center gap-2"},Nr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},jr={class:"relative"},Wr={key:0,class:"text-xs text-red-600 mt-1"},zr={class:"relative"},Hr={key:0,class:"text-xs text-red-600 mt-1"},Yr={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Qr={class:"flex justify-between items-center"},Gr={class:"text-lg font-bold text-heading"},Kr={class:"flex flex-col gap-2"},Jr={class:"flex items-center gap-2"},Xr={class:"flex items-center gap-2"},Zr={key:0,class:"text-xs text-red-600 mt-1"},_r={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},ed={class:"flex justify-between items-center"},td={class:"text-lg font-bold text-heading"},ld={class:"flex flex-col gap-2"},ad={class:"flex items-center gap-2"},sd={class:"flex items-center gap-2"},nd={class:"flex items-center gap-2"},id={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},od={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},rd={class:"list-disc list-inside text-sm text-red-700 space-y-1"},dd={key:0},ud={key:1},cd={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:t=>["lead","opportunity"].includes(t)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,i=o,m=gr(),u=Pt(),v=R(!1),s=R({}),f=R([]),c=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],a=R({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),p=D(()=>!!l.purchaseMethod),k=D(()=>{if(a.value.type!=="LEA")return 0;const F=parseFloat(a.value.fields.monthlyInstalment)||0,y=parseInt(a.value.fields.duration)||0,P=parseFloat(a.value.fields.downPayment)||0,ie=parseFloat(a.value.fields.finalInstalment)||0;return F*y+P+ie}),I=D(()=>{if(a.value.type!=="LTR")return 0;const F=parseFloat(a.value.fields.monthlyInstalment)||0,y=parseInt(a.value.fields.duration)||0,P=parseFloat(a.value.fields.downPayment)||0;return F*y+P}),w=F=>F==="FIN"?[12,24,36,48,60]:F==="LEA"?[24,36,48,60]:F==="LTR"?[12,24,36,48,60]:[],d=F=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[F]||F,b=F=>{const y=a.value.fields[F];switch(F){case"monthlyInstalment":!y||y<=0?s.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete s.value.monthlyInstalment;break;case"downPayment":y==null||y<0?s.value.downPayment="Down Payment must be greater than or equal to 0":delete s.value.downPayment;break;case"duration":!y||y<12||y>60?s.value.duration="Duration must be between 12 and 60 months":delete s.value.duration;break;case"customerType":a.value.type==="LTR"&&(!y||!["Private","Business","Fleet"].includes(y))?s.value.customerType="Customer Type is required":delete s.value.customerType;break}},$=F=>{delete s.value[F]},h=()=>{f.value=[],s.value={};const F=Ie.validate({type:a.value.type,fields:a.value.fields});return F.isValid||(f.value=F.errors,F.errors.forEach(y=>{y.includes("Monthly Instalment")?s.value.monthlyInstalment=y:y.includes("Down Payment")?s.value.downPayment=y:y.includes("Duration")?s.value.duration=y:y.includes("Customer Type")&&(s.value.customerType=y)})),F.isValid},V=D(()=>!a.value.type||!a.value.fields.monthlyInstalment||a.value.fields.monthlyInstalment<=0||a.value.fields.downPayment===null||a.value.fields.downPayment===void 0||a.value.fields.downPayment<0||!a.value.fields.duration||a.value.fields.duration<12||a.value.fields.duration>60||a.value.type==="LTR"&&!a.value.fields.customerType?!1:Object.keys(s.value).length===0),ee=()=>{a.value.type!=="FIN"&&(a.value.fields.effectiveInterestRate=null,a.value.fields.gfv=null),a.value.type!=="LEA"&&(a.value.fields.finalInstalment=null),a.value.type!=="LTR"&&(a.value.fields.customerType="",a.value.fields.registrationTaxesIncluded=!1),a.value.type!=="LEA"&&a.value.type!=="LTR"&&(a.value.fields.mileageLimit=null,a.value.fields.maintenanceIncluded=!1),s.value={},f.value=[]},ne=async()=>{var F;if(h()){v.value=!0;try{const y={type:a.value.type,fields:{...a.value.fields},currency:a.value.currency,offerValidFrom:a.value.offerValidFrom||null,offerValidTo:a.value.offerValidTo||null,createdBy:((F=u.currentUser)==null?void 0:F.id)||null};l.taskType==="lead"?y.leadId=parseInt(l.taskId):l.taskType==="opportunity"&&(y.opportunityId=parseInt(l.taskId)),l.vehicleId&&(y.vehicleId=parseInt(l.vehicleId)),l.offerId&&(y.offerId=parseInt(l.offerId));let P;p.value?P=await m.updatePurchaseMethod(l.purchaseMethod.id,y):P=await m.createPurchaseMethod(y);const ie=d(P.type),fe=je(P.fields.monthlyInstalment||0);i("save",{...P,successMessage:`Purchase Method Added: ${ie} - €${fe}/month`}),i("close")}catch(y){f.value=[y.message||"Failed to save purchase method"]}finally{v.value=!1}}},ue=F=>{F||i("close")};return me(()=>{l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null})}),oe(()=>l.show,F=>{F?l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null}):setTimeout(()=>{a.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},s.value={},f.value=[],v.value=!1},300)}),(F,y)=>(n(),j(T(Ve),{open:t.show,"onUpdate:open":ue},{default:U(()=>[E(T(Ce),null,{default:U(()=>[E(T(Se),{class:"fixed inset-0 z-50 bg-black/50"}),E(T(Ae),{class:"w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto"},{default:U(()=>[E(T(De),null,{default:U(()=>[E(T(Ee),null,{default:U(()=>[N(g(p.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1}),E(T(Je),null,{default:U(()=>[N(g(p.value?"Update purchase method details":"Select purchase method type and fill in the details"),1)]),_:1})]),_:1}),e("form",{onSubmit:le(ne,["prevent"]),class:"space-y-6"},[e("div",null,[y[31]||(y[31]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",xr,[(n(),r(H,null,K(c,P=>e("label",{key:P.value,class:"flex-1 cursor-pointer"},[S(e("input",{type:"radio",value:P.value,"onUpdate:modelValue":y[0]||(y[0]=ie=>a.value.type=ie),class:"sr-only",onChange:ee},null,40,hr),[[xt,a.value.type]]),e("div",{class:q(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",a.value.type===P.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},g(P.label),3)])),64))])]),a.value.type?(n(),r("div",kr,[e("h3",wr,g(d(a.value.type))+" Details ",1),e("div",$r,[e("div",null,[y[33]||(y[33]=e("label",{class:"block label-upper mb-2"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Ir,[y[32]||(y[32]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":y[1]||(y[1]=P=>a.value.fields.monthlyInstalment=P),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":s.value.monthlyInstalment}]),onInput:y[2]||(y[2]=P=>$("monthlyInstalment")),onBlur:y[3]||(y[3]=P=>b("monthlyInstalment"))},null,34),[[M,a.value.fields.monthlyInstalment,void 0,{number:!0}]])]),s.value.monthlyInstalment?(n(),r("p",Tr,g(s.value.monthlyInstalment),1)):x("",!0)]),e("div",null,[y[35]||(y[35]=e("label",{class:"block label-upper mb-2"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Cr,[y[34]||(y[34]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":y[4]||(y[4]=P=>a.value.fields.downPayment=P),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":s.value.downPayment}]),onInput:y[5]||(y[5]=P=>$("downPayment")),onBlur:y[6]||(y[6]=P=>b("downPayment"))},null,34),[[M,a.value.fields.downPayment,void 0,{number:!0}]])]),s.value.downPayment?(n(),r("p",Sr,g(s.value.downPayment),1)):x("",!0)])]),e("div",Ar,[e("div",null,[y[37]||(y[37]=e("label",{class:"block label-upper mb-2"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("select",{"onUpdate:modelValue":y[7]||(y[7]=P=>a.value.fields.duration=P),class:q(["input",{"border-red-500":s.value.duration}]),onChange:y[8]||(y[8]=P=>$("duration"))},[y[36]||(y[36]=e("option",{value:""},"Select duration...",-1)),(n(!0),r(H,null,K(w(a.value.type),P=>(n(),r("option",{key:P,value:P},g(P)+" months ",9,Dr))),128))],34),[[Z,a.value.fields.duration,void 0,{number:!0}]]),s.value.duration?(n(),r("p",Er,g(s.value.duration),1)):x("",!0)]),a.value.type==="FIN"?(n(),r("div",Lr,[y[39]||(y[39]=e("label",{class:"block label-upper mb-2"},"Interest Rate / APR (%)",-1)),e("div",Vr,[S(e("input",{"onUpdate:modelValue":y[9]||(y[9]=P=>a.value.fields.interestRate=P),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:q(["input pr-8",{"border-red-500":s.value.interestRate}]),onInput:y[10]||(y[10]=P=>$("interestRate"))},null,34),[[M,a.value.fields.interestRate,void 0,{number:!0}]]),y[38]||(y[38]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),s.value.interestRate?(n(),r("p",Pr,g(s.value.interestRate),1)):x("",!0)])):x("",!0),a.value.type==="LEA"||a.value.type==="LTR"?(n(),r("div",Or,[y[40]||(y[40]=e("label",{class:"block label-upper mb-2"},"Mileage Limit (annual km)",-1)),S(e("input",{"onUpdate:modelValue":y[11]||(y[11]=P=>a.value.fields.mileageLimit=P),type:"number",min:"0",placeholder:"0",class:q(["input",{"border-red-500":s.value.mileageLimit}]),onInput:y[12]||(y[12]=P=>$("mileageLimit"))},null,34),[[M,a.value.fields.mileageLimit,void 0,{number:!0}]]),s.value.mileageLimit?(n(),r("p",Mr,g(s.value.mileageLimit),1)):x("",!0)])):x("",!0)]),a.value.type==="FIN"?(n(),r(H,{key:0},[e("div",Rr,[e("div",null,[y[42]||(y[42]=e("label",{class:"block label-upper mb-2"},"Effective Interest Rate / TAEG (%)",-1)),e("div",qr,[S(e("input",{"onUpdate:modelValue":y[13]||(y[13]=P=>a.value.fields.effectiveInterestRate=P),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:q(["input pr-8",{"border-red-500":s.value.effectiveInterestRate}]),onInput:y[14]||(y[14]=P=>$("effectiveInterestRate"))},null,34),[[M,a.value.fields.effectiveInterestRate,void 0,{number:!0}]]),y[41]||(y[41]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),s.value.effectiveInterestRate?(n(),r("p",Br,g(s.value.effectiveInterestRate),1)):x("",!0)]),e("div",null,[y[44]||(y[44]=e("label",{class:"block label-upper mb-2"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Fr,[y[43]||(y[43]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":y[15]||(y[15]=P=>a.value.fields.gfv=P),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[M,a.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",Ur,[S(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":y[16]||(y[16]=P=>a.value.fields.insuranceIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.insuranceIncluded]]),y[45]||(y[45]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):x("",!0),a.value.type==="LEA"?(n(),r(H,{key:1},[e("div",Nr,[e("div",null,[y[47]||(y[47]=e("label",{class:"block label-upper mb-2"},"Interest Rate / APR (%)",-1)),e("div",jr,[S(e("input",{"onUpdate:modelValue":y[17]||(y[17]=P=>a.value.fields.interestRate=P),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:q(["input pr-8",{"border-red-500":s.value.interestRate}]),onInput:y[18]||(y[18]=P=>$("interestRate"))},null,34),[[M,a.value.fields.interestRate,void 0,{number:!0}]]),y[46]||(y[46]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))]),s.value.interestRate?(n(),r("p",Wr,g(s.value.interestRate),1)):x("",!0)]),e("div",null,[y[49]||(y[49]=e("label",{class:"block label-upper mb-2"},"Final Instalment (€)",-1)),e("div",zr,[y[48]||(y[48]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),S(e("input",{"onUpdate:modelValue":y[19]||(y[19]=P=>a.value.fields.finalInstalment=P),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":s.value.finalInstalment}]),onInput:y[20]||(y[20]=P=>$("finalInstalment"))},null,34),[[M,a.value.fields.finalInstalment,void 0,{number:!0}]])]),s.value.finalInstalment?(n(),r("p",Hr,g(s.value.finalInstalment),1)):x("",!0)])]),e("div",Yr,[e("div",Qr,[y[50]||(y[50]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",Gr,"€ "+g(T(je)(k.value)),1)]),y[51]||(y[51]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Kr,[e("div",Jr,[S(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":y[21]||(y[21]=P=>a.value.fields.insuranceIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.insuranceIncluded]]),y[52]||(y[52]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Xr,[S(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":y[22]||(y[22]=P=>a.value.fields.maintenanceIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.maintenanceIncluded]]),y[53]||(y[53]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):x("",!0),a.value.type==="LTR"?(n(),r(H,{key:2},[e("div",null,[y[55]||(y[55]=e("label",{class:"block label-upper mb-2"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),S(e("select",{"onUpdate:modelValue":y[23]||(y[23]=P=>a.value.fields.customerType=P),class:q(["input",{"border-red-500":s.value.customerType}]),onChange:y[24]||(y[24]=P=>$("customerType"))},[...y[54]||(y[54]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[Z,a.value.fields.customerType]]),s.value.customerType?(n(),r("p",Zr,g(s.value.customerType),1)):x("",!0)]),e("div",_r,[e("div",ed,[y[56]||(y[56]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",td,"€ "+g(T(je)(I.value)),1)]),y[57]||(y[57]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",ld,[e("div",ad,[S(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":y[25]||(y[25]=P=>a.value.fields.insuranceIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.insuranceIncluded]]),y[58]||(y[58]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",sd,[S(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":y[26]||(y[26]=P=>a.value.fields.maintenanceIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.maintenanceIncluded]]),y[59]||(y[59]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",nd,[S(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":y[27]||(y[27]=P=>a.value.fields.registrationTaxesIncluded=P),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[se,a.value.fields.registrationTaxesIncluded]]),y[60]||(y[60]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):x("",!0),e("div",id,[e("div",null,[y[61]||(y[61]=e("label",{class:"block label-upper mb-2"},"Offer Valid From",-1)),S(e("input",{"onUpdate:modelValue":y[28]||(y[28]=P=>a.value.offerValidFrom=P),type:"date",class:"input"},null,512),[[M,a.value.offerValidFrom]])]),e("div",null,[y[62]||(y[62]=e("label",{class:"block label-upper mb-2"},"Offer Valid To",-1)),S(e("input",{"onUpdate:modelValue":y[29]||(y[29]=P=>a.value.offerValidTo=P),type:"date",class:"input"},null,512),[[M,a.value.offerValidTo]])])])])):x("",!0),f.value.length>0?(n(),r("div",od,[y[63]||(y[63]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",rd,[(n(!0),r(H,null,K(f.value,P=>(n(),r("li",{key:P},g(P),1))),128))])])):x("",!0)],32),E(T(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[E(T(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[30]||(y[30]=P=>F.$emit("close"))}),E(T(z),{label:p.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!V.value||v.value,onClick:ne},{default:U(()=>[v.value?(n(),r("span",dd,"Saving...")):(n(),r("span",ud,g(p.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},md=gt(cd,[["__scopeId","data-v-cefe6d3a"]]),fd={key:0,class:"space-y-4 py-4"},pd={class:"grid grid-cols-1 gap-3"},vd={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},yd=["max"],bd={key:0},gd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xd={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},hd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wd={key:2,class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},$d={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},Id={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Td={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cd={class:"pt-2 border-t border-E5E7EB"},Sd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ad={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Dd={class:"mt-4"},Ed={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:t=>["vehicle","tradein"].includes(t)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,i=o,m=R(null),u=R(!1),v=D(()=>l.mode==="tradein"||m.value==="tradein"),s=()=>l.mode==="tradein"||m.value==="tradein"?"Add Trade-In Vehicle":m.value==="drove"?"Add Drove Vehicle":m.value==="requested"?"Add Requested Vehicle":"Add Vehicle",f=()=>l.mode==="tradein"||m.value==="tradein"?"Record details of the customer's trade-in vehicle":m.value==="drove"?"Record details of a vehicle the customer drove":m.value==="requested"?"Record details of a vehicle the customer requested":"Fill in the details for the new vehicle",c=R({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",stockDays:null}),a=R({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:"",priceToBuy:null,priceToSell:null,priceOfVehicle:null,priceOfOptionals:null,listOfOptionals:""});me(()=>{l.item&&l.item.data&&(c.value={brand:l.item.data.brand||"",model:l.item.data.model||"",year:l.item.data.year||"",version:l.item.data.version||"",vin:l.item.data.vin||"",plates:l.item.data.plate||l.item.data.plates||"",fuelType:l.item.data.fuelType||"",gearType:l.item.data.gearType||"",kilometers:l.item.data.km||l.item.data.kilometers||"",registration:l.item.data.date||l.item.data.registration||"",owner:l.item.data.owner||"",ownershipType:l.item.data.ownershipType||"",ownedSince:l.item.data.ownedSince||"",warrantyInfo:l.item.data.warrantyInfo||"",stockDays:null},l.item.data.tradeInPrice!==void 0&&(a.value={tradeInPrice:l.item.data.tradeInPrice||null,evaluationRangeLow:l.item.data.evaluationRangeLow||null,evaluationRangeHigh:l.item.data.evaluationRangeHigh||null,provider:l.item.data.provider||"",evaluationDate:l.item.data.evaluationDate||"",priceToBuy:l.item.data.priceToBuy||null,priceToSell:l.item.data.priceToSell||null,priceOfVehicle:l.item.data.priceOfVehicle||null,priceOfOptionals:l.item.data.priceOfOptionals||null,listOfOptionals:l.item.data.listOfOptionals||""},u.value=!0))}),oe(()=>l.show,w=>{w||(m.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",stockDays:null},a.value={tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:"",priceToBuy:null,priceToSell:null,priceOfVehicle:null,priceOfOptionals:null,listOfOptionals:""},u.value=!1)});const p=D(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),k=w=>{w||i("close")},I=()=>{if(!p.value)return;const w={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,stockDays:null,status:"Available"}};m.value&&(w.vehicleType=m.value),v.value&&(w.valuation={tradeInPrice:a.value.tradeInPrice,evaluationRangeLow:a.value.evaluationRangeLow,evaluationRangeHigh:a.value.evaluationRangeHigh,provider:a.value.provider||null,evaluationDate:a.value.evaluationDate||null,priceToBuy:a.value.priceToBuy,priceToSell:a.value.priceToSell,priceOfVehicle:a.value.priceOfVehicle,priceOfOptionals:a.value.priceOfOptionals,listOfOptionals:a.value.listOfOptionals||null}),l.item&&(w.id=l.item.id,w.isEdit=!0,w.timestamp=l.item.timestamp||new Date().toISOString()),i("save",w)};return(w,d)=>(n(),j(T(Ve),{open:t.show,"onUpdate:open":k},{default:U(()=>[E(T(Ce),null,{default:U(()=>[E(T(Se),{class:"fixed inset-0 z-50 bg-black/50"}),E(T(Ae),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:U(()=>[E(T(De),null,{default:U(()=>[E(T(Ee),null,{default:U(()=>[N(g(s()),1)]),_:1}),E(T(Je),null,{default:U(()=>[N(g(f()),1)]),_:1})]),_:1}),t.mode==="vehicle"&&!t.item&&!m.value?(n(),r("div",fd,[d[29]||(d[29]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",pd,[E(T(z),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[0]||(d[0]=b=>m.value="drove")}),E(T(z),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[1]||(d[1]=b=>m.value="requested")}),E(T(z),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[2]||(d[2]=b=>m.value="tradein")})])])):(n(),r("form",{key:1,onSubmit:le(I,["prevent"]),class:"space-y-4"},[e("div",vd,[e("div",null,[d[30]||(d[30]=e("label",{class:"block label-upper mb-2"},"Brand",-1)),S(e("input",{"onUpdate:modelValue":d[3]||(d[3]=b=>c.value.brand=b),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[M,c.value.brand]])]),e("div",null,[d[31]||(d[31]=e("label",{class:"block label-upper mb-2"},"Model",-1)),S(e("input",{"onUpdate:modelValue":d[4]||(d[4]=b=>c.value.model=b),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[M,c.value.model]])]),e("div",null,[d[32]||(d[32]=e("label",{class:"block label-upper mb-2"},"Year",-1)),S(e("input",{"onUpdate:modelValue":d[5]||(d[5]=b=>c.value.year=b),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,yd),[[M,c.value.year]])])]),v.value?(n(),r("div",bd,[d[33]||(d[33]=e("label",{class:"block label-upper mb-2"},"Version/Trim",-1)),S(e("input",{"onUpdate:modelValue":d[6]||(d[6]=b=>c.value.version=b),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[M,c.value.version]])])):x("",!0),e("div",gd,[e("div",null,[d[34]||(d[34]=e("label",{class:"block label-upper mb-2"},"VIN",-1)),S(e("input",{"onUpdate:modelValue":d[7]||(d[7]=b=>c.value.vin=b),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[M,c.value.vin]])]),e("div",null,[d[35]||(d[35]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),S(e("input",{"onUpdate:modelValue":d[8]||(d[8]=b=>c.value.plates=b),type:"text",placeholder:"License plate number",class:"input"},null,512),[[M,c.value.plates]])])]),e("div",xd,[e("div",null,[d[37]||(d[37]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),S(e("select",{"onUpdate:modelValue":d[9]||(d[9]=b=>c.value.fuelType=b),class:"input"},[...d[36]||(d[36]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[Z,c.value.fuelType]])]),e("div",null,[d[39]||(d[39]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),S(e("select",{"onUpdate:modelValue":d[10]||(d[10]=b=>c.value.gearType=b),class:"input"},[...d[38]||(d[38]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[Z,c.value.gearType]])]),e("div",null,[d[40]||(d[40]=e("label",{class:"block label-upper mb-2"},"Mileage (km)",-1)),S(e("input",{"onUpdate:modelValue":d[11]||(d[11]=b=>c.value.kilometers=b),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[M,c.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[d[41]||(d[41]=e("label",{class:"block label-upper mb-2"},"Registration Year/Month",-1)),S(e("input",{"onUpdate:modelValue":d[12]||(d[12]=b=>c.value.registration=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[M,c.value.registration]])]),t.mode==="vehicle"&&m.value!=="tradein"?(n(),r(H,{key:1},[e("div",hd,[e("div",null,[d[42]||(d[42]=e("label",{class:"block label-upper mb-2"},"Owned Since",-1)),S(e("input",{"onUpdate:modelValue":d[13]||(d[13]=b=>c.value.ownedSince=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[M,c.value.ownedSince]])]),e("div",null,[d[43]||(d[43]=e("label",{class:"block label-upper mb-2"},"Owner",-1)),S(e("input",{"onUpdate:modelValue":d[14]||(d[14]=b=>c.value.owner=b),type:"text",placeholder:"Owner name",class:"input"},null,512),[[M,c.value.owner]])])]),e("div",kd,[e("div",null,[d[45]||(d[45]=e("label",{class:"block label-upper mb-2"},"Ownership Type",-1)),S(e("select",{"onUpdate:modelValue":d[15]||(d[15]=b=>c.value.ownershipType=b),class:"input"},[...d[44]||(d[44]=[e("option",{value:""},"Select ownership type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Company"},"Company",-1),e("option",{value:"Lease"},"Lease",-1),e("option",{value:"Fleet"},"Fleet",-1)])],512),[[Z,c.value.ownershipType]])])]),e("div",null,[d[46]||(d[46]=e("label",{class:"block label-upper mb-2"},"Warranty Info",-1)),S(e("textarea",{"onUpdate:modelValue":d[16]||(d[16]=b=>c.value.warrantyInfo=b),rows:"3",placeholder:"Warranty information...",class:"input"},null,512),[[M,c.value.warrantyInfo]])])],64)):x("",!0),v.value?(n(),r("div",wd,[e("button",{type:"button",onClick:d[17]||(d[17]=b=>u.value=!u.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors"},[d[47]||(d[47]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:q(["fa-solid transition-transform duration-200 text-sub",u.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),u.value?(n(),r("div",$d,[e("div",null,[d[48]||(d[48]=e("label",{class:"block label-upper mb-2"},"Trade-In Price (€)",-1)),S(e("input",{"onUpdate:modelValue":d[18]||(d[18]=b=>a.value.tradeInPrice=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.tradeInPrice,void 0,{number:!0}]])]),e("div",Id,[e("div",null,[d[49]||(d[49]=e("label",{class:"block label-upper mb-2"},"Evaluation Range - Low (€)",-1)),S(e("input",{"onUpdate:modelValue":d[19]||(d[19]=b=>a.value.evaluationRangeLow=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[d[50]||(d[50]=e("label",{class:"block label-upper mb-2"},"Evaluation Range - High (€)",-1)),S(e("input",{"onUpdate:modelValue":d[20]||(d[20]=b=>a.value.evaluationRangeHigh=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",Td,[e("div",null,[d[52]||(d[52]=e("label",{class:"block label-upper mb-2"},"Provider",-1)),S(e("select",{"onUpdate:modelValue":d[21]||(d[21]=b=>a.value.provider=b),class:"input"},[...d[51]||(d[51]=[e("option",{value:""},"Select provider...",-1),e("option",{value:"Eurotax"},"Eurotax",-1),e("option",{value:"Infocar"},"Infocar",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Other"},"Other",-1)])],512),[[Z,a.value.provider]])]),e("div",null,[d[53]||(d[53]=e("label",{class:"block label-upper mb-2"},"Evaluation Date",-1)),S(e("input",{"onUpdate:modelValue":d[22]||(d[22]=b=>a.value.evaluationDate=b),type:"date",class:"input"},null,512),[[M,a.value.evaluationDate]])])]),e("div",Cd,[d[59]||(d[59]=e("h4",{class:"text-fluid-xs font-medium text-heading mb-3"},"Optional Advanced Fields",-1)),e("div",Sd,[e("div",null,[d[54]||(d[54]=e("label",{class:"block label-upper mb-2"},"Price to Buy (€)",-1)),S(e("input",{"onUpdate:modelValue":d[23]||(d[23]=b=>a.value.priceToBuy=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.priceToBuy,void 0,{number:!0}]])]),e("div",null,[d[55]||(d[55]=e("label",{class:"block label-upper mb-2"},"Price to Sell (€)",-1)),S(e("input",{"onUpdate:modelValue":d[24]||(d[24]=b=>a.value.priceToSell=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.priceToSell,void 0,{number:!0}]])])]),e("div",Ad,[e("div",null,[d[56]||(d[56]=e("label",{class:"block label-upper mb-2"},"Price of Vehicle (€)",-1)),S(e("input",{"onUpdate:modelValue":d[25]||(d[25]=b=>a.value.priceOfVehicle=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.priceOfVehicle,void 0,{number:!0}]])]),e("div",null,[d[57]||(d[57]=e("label",{class:"block label-upper mb-2"},"Price of Optionals (€)",-1)),S(e("input",{"onUpdate:modelValue":d[26]||(d[26]=b=>a.value.priceOfOptionals=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[M,a.value.priceOfOptionals,void 0,{number:!0}]])])]),e("div",Dd,[d[58]||(d[58]=e("label",{class:"block label-upper mb-2"},"List of Optionals",-1)),S(e("textarea",{"onUpdate:modelValue":d[27]||(d[27]=b=>a.value.listOfOptionals=b),rows:"3",placeholder:"List of equipment/features...",class:"input"},null,512),[[M,a.value.listOfOptionals]])])])])):x("",!0)])):x("",!0)],32)),E(T(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[E(T(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[28]||(d[28]=b=>w.$emit("close"))}),E(T(z),{label:v.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:I},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ld={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Vd={key:0,class:"flex justify-between items-center mb-4"},Pd={class:"text-sm font-bold text-heading"},Od={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},Md={class:"flex items-center gap-3"},Rd={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},qd=["src"],Bd={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Fd={class:"font-bold text-sm text-heading"},Ud={class:"text-xs text-sub"},Nd={class:"space-y-4"},jd={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Wd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},zd=["disabled"],Hd={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const i=t,m=l,u=R({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});me(()=>{if(i.selectedVehicle){u.value.price=i.selectedVehicle.price||0,u.value.brand=i.selectedVehicle.brand||"",u.value.model=i.selectedVehicle.model||"",u.value.year=i.selectedVehicle.year||"",u.value.image=i.selectedVehicle.image||"";const c=new Date;c.setDate(c.getDate()+30),u.value.validUntil=c.toISOString().split("T")[0]}i.item&&i.item.data&&(u.value={...u.value,...i.item.data,price:i.item.data.price||i.item.data.total||0,financingType:i.item.data.financingType||i.item.data.paymentMethod||"",notes:i.item.data.notes||i.item.data.description||""})}),oe(()=>i.selectedVehicle,c=>{c&&!i.item&&(u.value.price=c.price||0,u.value.brand=c.brand||"",u.value.model=c.model||"",u.value.year=c.year||"",u.value.image=c.image||"")});const v=D(()=>u.value.price>0&&u.value.financingType!==""),s=c=>c?c.toLocaleString("en-US"):"0",f=()=>{var a,p;if(!v.value)return;const c={id:((a=i.item)==null?void 0:a.id)||Date.now(),type:"offer",action:i.item?"updated an offer":"created an offer",data:{brand:u.value.brand,model:u.value.model,year:u.value.year,price:u.value.price,total:u.value.price,paymentMethod:u.value.financingType,financingType:u.value.financingType,downPayment:u.value.downPayment,monthlyPayment:u.value.monthlyPayment,term:u.value.term,interestRate:u.value.interestRate,deliveryDate:u.value.deliveryDate,validUntil:u.value.validUntil,notes:u.value.notes,description:u.value.notes,image:u.value.image},timestamp:((p=i.item)==null?void 0:p.timestamp)||new Date().toISOString(),isEdit:!!i.item};m("save",c)};return o({submit:f,isValid:v,offerData:u}),(c,a)=>(n(),r("div",Ld,[t.hideHeader?x("",!0):(n(),r("div",Vd,[e("h5",Pd,g(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:a[0]||(a[0]=p=>c.$emit("cancel")),class:"text-sub hover:text-body"},[...a[11]||(a[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(n(),r("div",Od,[a[12]||(a[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",Md,[e("div",Rd,[t.selectedVehicle.image?(n(),r("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,qd)):(n(),r("i",Bd))]),e("div",null,[e("h4",Fd,g(t.selectedVehicle.brand)+" "+g(t.selectedVehicle.model)+" ("+g(t.selectedVehicle.year)+") ",1),e("p",Ud,"Base Price: € "+g(s(t.selectedVehicle.price)),1)])])])):x("",!0),e("div",Nd,[e("div",null,[a[13]||(a[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[N(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),S(e("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=p=>u.value.price=p),class:"input",placeholder:"Enter offer price"},null,512),[[M,u.value.price]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[N(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),S(e("select",{"onUpdate:modelValue":a[2]||(a[2]=p=>u.value.financingType=p),class:"input"},[...a[14]||(a[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[Z,u.value.financingType]])]),u.value.financingType==="finance"||u.value.financingType==="lease"?(n(),r("div",jd,[e("div",null,[a[16]||(a[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),S(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=p=>u.value.downPayment=p),class:"input",placeholder:"0"},null,512),[[M,u.value.downPayment]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),S(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=p=>u.value.monthlyPayment=p),class:"input",placeholder:"Calculated automatically"},null,512),[[M,u.value.monthlyPayment]])]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),S(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=p=>u.value.term=p),class:"input",placeholder:"36"},null,512),[[M,u.value.term]])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),S(e("input",{type:"number",step:"0.1","onUpdate:modelValue":a[6]||(a[6]=p=>u.value.interestRate=p),class:"input",placeholder:"3.5"},null,512),[[M,u.value.interestRate]])])])):x("",!0),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),S(e("input",{type:"date","onUpdate:modelValue":a[7]||(a[7]=p=>u.value.deliveryDate=p),class:"input"},null,512),[[M,u.value.deliveryDate]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),S(e("input",{type:"date","onUpdate:modelValue":a[8]||(a[8]=p=>u.value.validUntil=p),class:"input"},null,512),[[M,u.value.validUntil]])]),e("div",null,[a[22]||(a[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),S(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=p=>u.value.notes=p),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[M,u.value.notes]])])]),t.hideActions?x("",!0):(n(),r("div",Wd,[e("button",{onClick:a[10]||(a[10]=p=>c.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:f,disabled:!v.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},g(t.item?"Update Offer":"Create Offer"),9,zd)]))]))}},Yd={class:"p-6"},Qd={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:o}){const l=o,i=R(null),m=D(()=>{var f;return((f=i.value)==null?void 0:f.isValid)||!1}),u=()=>{var f;(f=i.value)==null||f.submit()},v=f=>{f||l("close")},s=f=>{l("save",f),l("close")};return(f,c)=>(n(),j(T(Ve),{open:t.show,"onUpdate:open":v},{default:U(()=>[E(T(Ce),null,{default:U(()=>[E(T(Se),{class:"fixed inset-0 z-50 bg-black/50"}),E(T(Ae),{class:"w-full sm:max-w-2xl p-0"},{default:U(()=>[E(T(De),{class:"p-6 pb-4 border-b border"},{default:U(()=>[E(T(Ee),null,{default:U(()=>[...c[2]||(c[2]=[N("Create Offer",-1)])]),_:1}),E(T(Je),null,{default:U(()=>[...c[3]||(c[3]=[N("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Yd,[E(Hd,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:i,onSave:s,onCancel:c[0]||(c[0]=a=>f.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),E(T(Le),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:U(()=>[E(T(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c[1]||(c[1]=a=>f.$emit("close"))}),E(T(z),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value,onClick:u},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Gd={class:"space-y-4"},Kd={key:0},Jd={class:"flex flex-wrap gap-2"},Xd=["onClick"],Zd={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:o}){const l=t,i=o,m=R(""),u=s=>{s||i("close")};oe(()=>l.show,s=>{s&&(m.value="")});const v=()=>{const s=m.value.trim();s&&(l.existingTags.includes(s)||(i("add",s),m.value=""))};return(s,f)=>(n(),j(T(Ve),{open:t.show,"onUpdate:open":u},{default:U(()=>[E(T(Ce),null,{default:U(()=>[E(T(Se),{class:"fixed inset-0 z-50 bg-black/50"}),E(T(Ae),{class:"w-full sm:max-w-md"},{default:U(()=>[E(T(De),null,{default:U(()=>[E(T(Ee),null,{default:U(()=>[...f[2]||(f[2]=[N("Add Tag",-1)])]),_:1})]),_:1}),e("div",Gd,[e("div",null,[f[3]||(f[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),S(e("input",{"onUpdate:modelValue":f[0]||(f[0]=c=>m.value=c),onKeyup:Ot(v,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[M,m.value]])]),t.existingTags.length>0?(n(),r("div",Kd,[f[4]||(f[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Jd,[(n(!0),r(H,null,K(t.existingTags,c=>(n(),r("button",{key:c,onClick:a=>m.value=c,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},g(c),9,Xd))),128))])])):x("",!0)]),E(T(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[E(T(z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f[1]||(f[1]=c=>s.$emit("close"))}),E(T(z),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!m.value.trim(),onClick:v},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function _d(){const t=Yt();return{saveTradeInVehicle:async(i,m,u,v={})=>{try{const s=await t.addVehicle(u),f={type:"tradein",action:"added a trade-in",vehicleId:s.id,data:{brand:u.brand,model:u.model,version:u.version||null,year:u.year,kilometers:u.kilometers||0,plates:u.plates||null,registration:u.registration||null,vin:u.vin||null,fuelType:u.fuelType||null,gearType:u.gearType||null,tradeInPrice:v.tradeInPrice||null,evaluationRangeLow:v.evaluationRangeLow||null,evaluationRangeHigh:v.evaluationRangeHigh||null,provider:v.provider||null,evaluationDate:v.evaluationDate||null,priceToBuy:v.priceToBuy||null,priceToSell:v.priceToSell||null,priceOfVehicle:v.priceOfVehicle||null,priceOfOptionals:v.priceOfOptionals||null,listOfOptionals:v.listOfOptionals||null}};let c;if(i==="lead")c=await qt(m,f);else if(i==="opportunity")c=await Bt(m,f);else throw new Error(`Invalid taskType: ${i}`);return{vehicle:s,activity:c}}catch(s){throw console.error("Error saving trade-in vehicle:",s),s}},updateTradeInVehicle:async(i,m,u,v,s,f={})=>{try{const c=await t.modifyVehicle(u,s),a={data:{brand:s.brand,model:s.model,version:s.version||null,year:s.year,kilometers:s.kilometers||0,plates:s.plates||null,registration:s.registration||null,vin:s.vin||null,fuelType:s.fuelType||null,gearType:s.gearType||null,tradeInPrice:f.tradeInPrice||null,evaluationRangeLow:f.evaluationRangeLow||null,evaluationRangeHigh:f.evaluationRangeHigh||null,provider:f.provider||null,evaluationDate:f.evaluationDate||null,priceToBuy:f.priceToBuy||null,priceToSell:f.priceToSell||null,priceOfVehicle:f.priceOfVehicle||null,priceOfOptionals:f.priceOfOptionals||null,listOfOptionals:f.listOfOptionals||null}};let p;if(i==="lead")p=await Mt(m,v,a);else if(i==="opportunity")p=await Rt(m,v,a);else throw new Error(`Invalid taskType: ${i}`);return{vehicle:c,activity:p}}catch(c){throw console.error("Error updating trade-in vehicle:",c),c}}}}const He={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function eu(t){if(!t)return He.default;const o=t.toLowerCase().trim();return He[o]||He.default}function tu({store:t,taskId:o,getTabForItemType:l,isOverviewModalAction:i}){const m=R(null),u=R(null),v=R("overview"),s=R(null),f=R([]);oe(v,()=>{m.value=null,u.value=null});const c=D(()=>[...t.currentActivities.value,...f.value.filter(b=>!b.activityId)].filter(b=>{const $=l(b.type);return v.value==="overview"?$==="overview":$===v.value}).sort((b,$)=>{const h=new Date(b.timestamp||0);return new Date($.timestamp||0)-h})),a=d=>(u.value=null,v.value==="overview"&&i&&i(d)?{type:"overview-modal",action:d}:(["email","sms","whatsapp","call"].includes(d)?(s.value=d,m.value="communication"):m.value=d,null)),p=async d=>{var b;if(d.isEdit){const $=f.value.findIndex(h=>h.id===d.id);$>-1&&(f.value[$]={...f.value[$],...d}),(b=u.value)!=null&&b.activityId&&await t.updateActivity(o.value,u.value.activityId,{type:d.communicationType||d.type,user:"You",action:d.action,content:d.content,fileName:d.fileName,data:d.data})}else{const $=d.communicationType||d.type,h=await t.addActivity(o.value,{type:$,user:"You",action:d.action,content:d.content,fileName:d.fileName,data:d.data});f.value.push({id:h.id,type:$==="email"||$==="whatsapp"||$==="sms"?"communication":$,action:d.action,content:d.content,fileName:d.fileName,data:d.data,timestamp:h.timestamp,activityId:h.id})}m.value=null,u.value=null},k=()=>{m.value=null,u.value=null},I=d=>{l(d.type)&&(m.value=d.type==="email"||d.type==="whatsapp"||d.type==="sms"||d.type==="communication"?"communication":d.type,u.value=d)},w=async d=>{try{await t.deleteActivity(o.value,d)}catch(b){throw console.error("Error deleting item:",b),b}};return{activeTab:v,showInlineWidget:m,inlineWidgetType:D(()=>m.value),editingItem:u,isEditing:D(()=>u.value!==null),communicationType:s,inlineContent:f,filteredInlineContent:c,handleAddNewAction:a,handleWidgetSave:p,handleWidgetCancel:k,handleEditItem:I,handleDeleteItem:w}}const lu={class:"flex-1 flex flex-col overflow-hidden h-full"},au={class:"bg-surface border-b border-black/5 shrink-0"},su={key:0},nu={key:0,class:"flex-1 flex flex-row overflow-hidden"},iu={class:"flex-1 flex flex-col overflow-hidden min-w-0"},ou={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},ru={class:"mb-4"},du={key:0},uu={key:0},cu={key:1,class:"mb-6"},mu={key:2,class:"space-y-4 mb-6 px-1"},fu={key:1},pu={key:0,class:"space-y-4 mb-6 px-1"},vu={key:1,class:"flex-1 flex flex-row overflow-hidden"},yu={class:"flex-1 flex flex-col overflow-hidden min-w-0"},bu={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},gu={key:0,class:"space-y-6"},xu={key:0},hu={key:1,class:"space-y-6"},ku={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},wu={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},$u={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Iu={class:"relative"},Tu={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},Cu={key:1,class:"text-center py-6 text-sub"},Su={key:2,class:"space-y-6 max-h-96 overflow-y-auto pr-2"},Au={class:"flex-1 min-w-0"},Du={class:"text-fluid-sm text-slate-700 leading-snug"},Eu={class:"font-bold"},Lu={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},Vu={class:"text-fluid-xs text-sub mt-1"},Pu={key:2},Ou={key:0,class:"space-y-4 mt-4"},Mu={key:1,class:"text-center py-12 text-sub"},Ru={key:3,class:"space-y-6"},qu={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Bu={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Fu={key:0,class:"mt-6 pt-6 border-t border"},Uu={class:"space-y-2 max-h-52 overflow-y-auto"},Nu={class:"flex items-center gap-2 mb-1"},ju={class:"text-fluid-xs font-semibold text-heading"},Wu={class:"text-fluid-xs text-sub"},zu={class:"text-fluid-sm text-body"},_u={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated"],setup(t,{emit:o}){const l=t,i=o,m=Ft(),u=Re(),v=Wt(),s=D(()=>l.task.id),f=D(()=>m.path.startsWith("/tasks")&&!m.path.startsWith("/customer")),c=R("manage"),a=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Enrich"},{key:"contact",label:"Contact"}],p=R(!1),k=R(null),I=R(null),w=["note","attachment","tradein","purchase"],d=D(()=>{var X,_;const C=[],A=new Set,W=["note","attachment","tradein","purchase","purchase-method","financing"];return(_=(X=l.storeAdapter)==null?void 0:X.currentActivities)!=null&&_.value&&l.storeAdapter.currentActivities.value.filter(Q=>W.includes(Q.type)).forEach(Q=>{A.has(Q.id)||(A.add(Q.id),C.push(Q))}),l.task.activities&&l.task.activities.filter(Q=>W.includes(Q.type)).forEach(Q=>{A.has(Q.id)||(A.add(Q.id),C.push(Q))}),he.value.filter(G=>W.includes(G.type)).forEach(G=>{A.has(G.id)||(A.add(G.id),C.push(G))}),C.sort((G,Q)=>{const B=new Date(G.timestamp||0);return new Date(Q.timestamp||0)-B})}),b=C=>{I.value=null,k.value=C},$=async C=>{try{await l.storeAdapter.addActivity(l.task.id,{type:C.type,action:C.action,content:C.content,data:C.data,fileName:C.fileName,timestamp:C.timestamp||new Date().toISOString()}),he.value.push({id:C.id||Date.now(),type:C.type,action:C.action,content:C.content,data:C.data,fileName:C.fileName,timestamp:C.timestamp||new Date().toISOString()}),k.value=null,I.value=null}catch(A){console.error("Error saving enrich data:",A)}},h=()=>{k.value=null,I.value=null},V=C=>{I.value=C,k.value=C.type==="purchase-method"?"purchase":C.type},ee=async C=>{try{await l.storeAdapter.deleteActivity(l.task.id,C.id);const A=he.value.findIndex(W=>W.id===C.id);A!==-1&&he.value.splice(A,1)}catch(A){console.error("Error deleting enrich item:",A)}};D(()=>l.task.activities?l.task.activities.filter(C=>C.type==="note"):[]);const ne=D(()=>l.task.activities?l.task.activities.filter(C=>["email","call","sms","whatsapp"].includes(C.type)):[]);D(()=>l.task.activities?l.task.activities.filter(C=>C.type==="attachment"):[]),D(()=>l.task.activities?l.task.activities.filter(C=>C.type==="purchase"):[]),D(()=>l.task.activities?l.task.activities.filter(C=>C.type==="tradein"):[]);const ue=C=>{if(!C)return"";const A=new Date(C),Y=new Date-A,X=Math.floor(Y/6e4),_=Math.floor(Y/36e5),G=Math.floor(Y/864e5);return X<1?"Just now":X<60?`${X}m ago`:_<24?`${_}h ago`:G<7?`${G}d ago`:A.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},F=async C=>{await l.storeAdapter.addActivity(l.task.id,{type:C.communicationType||C.type,content:C.content||C.message||"Communication logged",subject:C.subject,template:C.template,timestamp:new Date().toISOString()}),p.value=!1},y=D(()=>l.type==="contact"?"bg-blue-100 text-blue-600":l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),P=R(m.path.startsWith("/tasks")&&!m.path.startsWith("/customer"));oe(()=>m.path,C=>{P.value=C.startsWith("/tasks")&&!C.startsWith("/customer")});const ie=()=>{u.push({path:`/customer/${l.task.id}`,query:{type:l.type}})};function fe(C){pe.value=!1}const xe=()=>{O.value=!0},qe=async C=>{var W,Y,X,_;const A=C.name;l.type==="lead"?await((Y=(W=l.storeAdapter).updateLead)==null?void 0:Y.call(W,l.task.id,{assignee:A,assigneeType:C.type,teamId:C.type==="team"?C.id:null})):l.type==="opportunity"&&await((_=(X=l.storeAdapter).updateOpportunity)==null?void 0:_.call(X,l.task.id,{assignee:A,assigneeType:C.type,teamId:C.type==="team"?C.id:null})),O.value=!1},re=R(!1),te=R(null),pe=R(!1),O=R(!1),L=R(!1),{activeTab:J,showInlineWidget:ve,editingItem:Be,communicationType:kt,inlineContent:he,filteredInlineContent:Oe,handleAddNewAction:wt,handleWidgetSave:Te,handleWidgetCancel:Fe,handleEditItem:Ze,handleDeleteItem:_e}=tu({store:l.storeAdapter,taskId:s,getTabForItemType:eu,isOverviewModalAction:C=>J.value==="overview"&&l.addNewConfig.overviewActions.includes(C)});oe(()=>l.task.id,()=>{J.value="overview"});const et=()=>{f.value?c.value="request":J.value="overview"},Ue=C=>{const A=wt(C);A&&A.modalAction&&(te.value=A.modalAction,re.value=!0)},tt=C=>{if(C==="appointment"){pe.value=!0;return}const A={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(C))te.value=C,re.value=!0;else{const W=A[C];W?(J.value=W,setTimeout(()=>{Ue(C),setTimeout(()=>{try{const Y=document.querySelector(".animate-fade-in");Y&&Y.parentNode&&Y.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Ue(C)}},ke=()=>{re.value=!1,te.value=null},$t=async C=>{var A,W;try{const Y=C.type==="FIN"?"Captive Financing":C.type==="LEA"?"Leasing":"Long-Term Rental",X=((A=C.fields)==null?void 0:A.monthlyInstalment)||0;await Te({type:"purchase-method",action:`added a ${Y} purchase method`,content:`${Y}: €${X.toLocaleString()}/month for ${((W=C.fields)==null?void 0:W.duration)||0} months`,data:{purchaseMethodId:C.id,type:C.type,...C.fields}}),ke()}catch(Y){console.error("Error saving purchase method:",Y)}},lt=async C=>{if(te.value==="tradein")try{const{saveTradeInVehicle:A}=_d(),W=await A(l.type,l.task.id,C.vehicle,C.valuation||{});he.value.push({id:W.activity.id,type:"tradein",action:"added a trade-in",vehicleId:W.vehicle.id,data:W.activity.data,timestamp:W.activity.timestamp,activityId:W.activity.id}),ke()}catch(A){console.error("Error saving trade-in:",A)}else te.value==="purchase"&&(await Te(C),ke())},It=D(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Enrich"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),we=D(()=>[...l.storeAdapter.currentActivities.value,...he.value]);D(()=>te.value==="financing"?"Add Financing":te.value==="tradein"?"Add Trade-in":te.value==="purchase"?"Create Purchase Offer":"");const at=async C=>{if(l.type==="opportunity")try{await l.storeAdapter.addVehicle(l.task.id,C.vehicleData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(A){console.error("Error selecting vehicle:",A)}},st=async C=>{if(l.type==="opportunity")try{await l.storeAdapter.createOffer(l.task.id,C.offerData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(A){console.error("Error creating offer:",A)}},Tt=async C=>{var Y,X,_,G;const A=l.task.tags||[];if(A.includes(C)){L.value=!1;return}const W=[...A,C];try{if(l.type==="lead")await((X=(Y=l.storeAdapter).updateLead)==null?void 0:X.call(Y,l.task.id,{tags:W})),l.storeAdapter.loadLeadById&&await l.storeAdapter.loadLeadById(l.task.id);else if(l.type==="opportunity")await((G=(_=l.storeAdapter).updateOpportunity)==null?void 0:G.call(_,l.task.id,{tags:W})),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id);else if(l.type==="contact"){const Q=m.query.type==="account"?"account":"contact";await v.updateCustomer(l.task.id,{tags:W},Q),await v.fetchCustomerById(l.task.id,Q),i("tag-updated")}L.value=!1}catch(Q){console.error("Error adding tag:",Q)}},Ct=C=>{const A={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return A[C]||A.default},St=C=>{const A={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return A[C]||A.default},At=C=>C?new Date(C).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(C,A)=>{var W,Y,X,_,G,Q;return n(),r("div",lu,[e("header",au,[f.value?x("",!0):(n(),r("div",su,[E(vl,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":y.value,"task-type":t.type,"customer-id":((W=t.task.customer)==null?void 0:W.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:tt,onAddTag:A[0]||(A[0]=B=>L.value=!0)},{"name-action":U(()=>[f.value?(n(),r("button",{key:0,onClick:ie,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...A[15]||(A[15]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):x("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags"])]))]),f.value?f.value?(n(),r("div",vu,[e("div",yu,[e("div",bu,[E(rt,{modelValue:c.value,"onUpdate:modelValue":A[6]||(A[6]=B=>c.value=B),tabs:a,class:"mb-6"},null,8,["modelValue"]),c.value==="manage"?(n(),r("div",gu,[t.managementWidget?(n(),r("div",xu,[(n(),j(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:A[7]||(A[7]=B=>C.$emit("car-added",B)),onConvertToLead:A[8]||(A[8]=B=>C.$emit("convert-to-lead")),onConvertToOpportunity:A[9]||(A[9]=B=>C.$emit("convert-to-opportunity")),onVehicleSelected:at,onCreateOffer:st,onViewHistory:et},null,40,["lead","opportunity","contact","activities"]))])):x("",!0)])):x("",!0),c.value==="request"?(n(),r("div",hu,[e("div",ku,[t.type!=="contact"?(n(),j(Ga,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe},null,8,["task","entity-type","activities"])):x("",!0),E(ms,{task:t.task,"task-type":t.type,"customer-id":((G=t.task.customer)==null?void 0:G.id)||t.task.customerId||t.task.id,onAction:tt,onAddTag:A[10]||(A[10]=B=>L.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(n(),j(Ls,{key:0,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):x("",!0),e("div",wu,[A[17]||(A[17]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",$u,[e("div",Iu,[we.value.length>0?(n(),r("div",Tu)):x("",!0),we.value.length===0?(n(),r("div",Cu,[...A[16]||(A[16]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(n(),r("div",Su,[(n(!0),r(H,null,K(we.value,B=>(n(),r("div",{key:B.id,class:"flex gap-4 relative"},[e("div",{class:q(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",St(B.type)])},[e("i",{class:q([Ct(B.type),"text-fluid-sm"])},null,2)],2),e("div",Au,[e("div",Du,[e("span",Eu,g(B.user),1),N(" "+g(B.action),1)]),B.content?(n(),r("div",Lu,g(B.content),1)):x("",!0),e("div",Vu,g(At(B.timestamp)),1)])]))),128))]))])])])])):x("",!0),c.value==="data"?(n(),r("div",Pu,[E(dt,{actions:w,"active-tab":"data",onAction:b}),e("div",null,[k.value==="note"?(n(),j(vt,{key:0,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:$,onCancel:h},null,8,["item","task-type","task-id"])):x("",!0),k.value==="attachment"?(n(),j(yt,{key:1,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:$,onCancel:h},null,8,["item","task-type","task-id"])):x("",!0),k.value==="tradein"?(n(),j(To,{key:2,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:$,onCancel:h},null,8,["item","task-type","task-id"])):x("",!0),k.value==="purchase"?(n(),j(ur,{key:3,item:I.value,"task-type":t.type,"task-id":t.task.id,onSave:$,onCancel:h},null,8,["item","task-type","task-id"])):x("",!0)]),d.value.length>0?(n(),r("div",Ou,[(n(!0),r(H,null,K(d.value,B=>{var Ne;return n(),j(ze,{key:B.id,item:B,"task-type":t.type,"customer-initials":((Ne=t.task.customer)==null?void 0:Ne.initials)||"SK",onEdit:V,onDelete:ee},null,8,["item","task-type","customer-initials"])}),128))])):k.value?x("",!0):(n(),r("div",Mu,[...A[18]||(A[18]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-fluid-sm"},"No enrichment data yet",-1),e("p",{class:"text-fluid-xs mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):x("",!0),c.value==="contact"?(n(),r("div",Ru,[e("div",qu,[A[19]||(A[19]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-comments text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Communicate")])],-1)),e("div",Bu,[E(pt,{type:"call","task-type":t.type,"task-id":t.task.id,"phone-number":((Q=t.task.customer)==null?void 0:Q.phone)||"","show-arrow":!1,onSave:F,onCancel:A[11]||(A[11]=B=>p.value=!1)},null,8,["task-type","task-id","phone-number"]),ne.value.length>0?(n(),r("div",Fu,[e("div",Uu,[(n(!0),r(H,null,K(ne.value,B=>(n(),r("div",{key:B.id,class:"p-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},[e("div",Nu,[e("span",ju,g(B.type),1),e("span",Wu,g(ue(B.timestamp)),1)]),e("p",zu,g(B.content),1)]))),128))])])):x("",!0)])])])):x("",!0)])])])):x("",!0):(n(),r("div",nu,[e("div",iu,[e("main",ou,[e("div",ru,[E(rt,{modelValue:T(J),"onUpdate:modelValue":A[1]||(A[1]=B=>Ut(J)?J.value=B:null),tabs:It.value,class:"mb-0"},null,8,["modelValue","tabs"])]),T(J)==="overview"?(n(),r("div",du,[t.type!=="contact"?(n(),r("div",uu,[E(wa,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((Y=t.task.requestedCar)==null?void 0:Y.requestType)||"","request-message":((X=t.task.requestedCar)==null?void 0:X.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:xe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):x("",!0),Nt(C.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(n(),r("div",cu,[(n(),j(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:A[2]||(A[2]=B=>C.$emit("car-added",B)),onConvertToLead:A[3]||(A[3]=B=>C.$emit("convert-to-lead")),onConvertToOpportunity:A[4]||(A[4]=B=>C.$emit("convert-to-opportunity")),onViewHistory:et,onVehicleSelected:at,onCreateOffer:st},null,40,["lead","opportunity","contact","activities"]))])):x("",!0),T(Oe).length>0?(n(),r("div",mu,[(n(!0),r(H,null,K(T(Oe),B=>(n(),j(ze,{key:B.id,item:B,"task-type":t.type,"customer-initials":"SK",onEdit:T(Ze),onDelete:T(_e)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)])):(n(),r("div",fu,[E(dt,{actions:t.addNewConfig.tabActions,"active-tab":T(J),onAction:Ue},null,8,["actions","active-tab"]),e("div",null,[T(ve)==="communication"?(n(),j(pt,{key:0,type:T(kt),"task-type":t.type,"task-id":t.task.id,"phone-number":((_=t.task.customer)==null?void 0:_.phone)||"",item:T(Be),onSave:T(Te),onCancel:T(Fe)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):x("",!0),T(J)==="data"&&T(ve)==="note"?(n(),j(vt,{key:1,item:T(Be),"task-type":t.type,"task-id":t.task.id,onSave:T(Te),onCancel:T(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0),T(ve)==="attachment"?(n(),j(yt,{key:2,item:T(Be),"task-type":t.type,"task-id":t.task.id,onSave:T(Te),onCancel:T(Fe)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0)]),T(Oe).length>0?(n(),r("div",pu,[(n(!0),r(H,null,K(T(Oe),B=>(n(),j(ze,{key:B.id,item:B,"task-type":t.type,"customer-initials":"SK",onEdit:T(Ze),onDelete:T(_e)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)]))])]),E(Pi,{title:"Activity summary",activities:we.value,collapsed:P.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:A[5]||(A[5]=B=>P.value=!P.value)},null,8,["activities","collapsed"])])),E(md,{show:te.value==="financing"&&re.value,"task-type":t.type,"task-id":t.task.id,onSave:$t,onClose:ke},null,8,["show","task-type","task-id"]),E(Ed,{show:te.value==="tradein"&&re.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:lt,onClose:ke},null,8,["show","task-type","task-id"]),E(Qd,{show:te.value==="purchase"&&re.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:lt,onClose:ke},null,8,["show","task-type","task-id","requested-car"]),E(zt,{show:O.value,onClose:A[12]||(A[12]=B=>O.value=!1),onConfirm:qe},null,8,["show"]),pe.value?(n(),j(Ht,{key:2,show:pe.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:fe,onCancel:A[13]||(A[13]=B=>pe.value=!1)},null,8,["show","customer","assignee"])):x("",!0),E(Zd,{show:L.value,"existing-tags":t.task.tags||[],onClose:A[14]||(A[14]=B=>L.value=!1),onAdd:Tt},null,8,["show","existing-tags"])])}}};function ec(t){var u,v,s;const o=t.lead;if(!o)return null;const l=ge(o,"lead");if(!l)return((u=de[ae.NEW])==null?void 0:u.primaryAction)||null;const i=de[l];if(!i)return((v=de[ae.NEW])==null?void 0:v.primaryAction)||null;if(!i.primaryAction)return((s=de[ae.NEW])==null?void 0:s.primaryAction)||null;const m=i.primaryAction;return typeof m=="function"?m({lead:o,displayStage:l}):m}function tc(t){const o=t.lead;if(!o)return[];const l=ge(o,"lead"),i=de[l];return i?i.secondaryActions||[]:[]}function ht(t){const o=t.lead;if(!o||!(o.isDisqualified===!0))return!1;const i=ge(o,"lead");return i===ae.CLOSED_INVALID||i===ae.CLOSED_NOT_INTERESTED||i===ae.CLOSED_DUPLICATE}function lc(t){const o=t.lead;if(!o||ht(t))return!1;const l=ge(o,"lead"),i=de[l];return i?typeof i.showLQWidget=="function"?i.showLQWidget(o):i.showLQWidget??!1:!1}function ac(t){const o=t.lead;if(!o||ht(t))return!1;const l=ge(o,"lead"),i=de[l];return i?i.showDeadlineBanner&&o.nextActionDue:!1}function sc(t){const o=t.lead;if(!o)return!1;const l=ge(o,"lead"),i=de[l];return i?i.canPostpone??!1:!1}function nc(t){const o=t.lead;if(!o)return"qualification";const l=ge(o,"lead"),i=de[l];return i&&i.lqWidgetMode||"qualification"}function ye(t){if(!t)return 0;const o=new Date(t),i=Math.abs(new Date-o);return Math.ceil(i/(1e3*60*60*24))}const $e={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const o=ce(),l=o.getSetting("oofbMinDays"),i=o.getSetting("oofbMaxDays"),m=ye(t.opportunity.createdAt);return m>=l&&m<i+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const l=ce().getSetting("ufbDays");return ye(t.opportunity.createdAt)>=l&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=ce().getSetting("ofbDays");return ye(t.opportunity.lastActivity||t.opportunity.createdAt)>=l&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=ce().getSetting("nfuDays"),i=ye(t.opportunity.lastActivity||t.opportunity.createdAt),m=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return i>=l&&!t.opportunity.contractDate&&!m&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var u;if(!t.opportunity.contractDate)return!1;const l=ce().getSetting("cfbDays"),i=ye(t.opportunity.contractDate),m=(u=t.activities)==null?void 0:u.some(v=>{var s;return v.type==="delivery"||((s=v.action)==null?void 0:s.toLowerCase().includes("delivered"))});return i>=l&&!m},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var u;const o=(u=t.activities)==null?void 0:u.find(v=>{var s;return v.type==="delivery"||((s=v.action)==null?void 0:s.toLowerCase().includes("delivered"))});if(!o)return!1;const i=ce().getSetting("dfbDays");return ye(o.timestamp)>=i},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const o=t.stage;return o==="Closed Won"||o==="Closed Lost"},"is-closed-with-task-widget":t=>$e["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if($e["is-closed"](t))return!1;const o=ce(),l=o.getSetting("abandonedOpportunityDays");if(!o.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const m=t.opportunity.lastActivity||t.opportunity.createdAt;return ye(m)>=l}};function ic(t,o){if($e["is-closed-with-task-widget"](o))return[We.reopen,We.requalify,We.closeLost];const l=Xe[t];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(i=>{if(!i.conditional)return!0;const m=$e[i.conditional];return m?m(o):!0})}function oc(t,o){const l=Xe[t];if(!l||!l.taskWidgets)return null;const m=ce().getSetting("autoCloseWidgetsOnClose"),u=$e["is-closed"]({stage:t});for(const v of l.taskWidgets){if(m&&u&&(v.type==="NFU"||v.type==="OFB"))continue;const s=$e[v.condition];if(s&&s(o))return v.type}return null}function rc(t,o){const l=Xe[t];if(!l||!l.primaryAction)return null;const i=l.primaryAction;return{...i,title:typeof i.title=="function"?i.title(o):i.title,description:typeof i.description=="function"?i.description(o):i.description,label:typeof i.label=="function"?i.label(o):i.label}}function dc(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function uc(t){return t==="Closed Won"||t==="Closed Lost"}const cc={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:o}){const l=o,i=u=>{u||l("close")},m=()=>{l("close")};return(u,v)=>(n(),j(T(Ve),{open:t.show,"onUpdate:open":i},{default:U(()=>[E(T(Ce),null,{default:U(()=>[E(T(Se),{class:"fixed inset-0 z-50 bg-black/50"}),E(T(Ae),{class:"w-full sm:max-w-md"},{default:U(()=>[E(T(De),null,{default:U(()=>[E(T(Ee),null,{default:U(()=>[N(g(t.title),1)]),_:1})]),_:1}),v[0]||(v[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),E(T(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:U(()=>[E(T(z),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Qt as E,de as L,Xe as O,md as P,ms as T,_u as _,tc as a,ac as b,sc as c,nc as d,Zu as e,ut as f,ec as g,ct as h,ht as i,mt as j,vt as k,Ed as l,oc as m,rc as n,ic as o,uc as p,dc as q,Hd as r,lc as s,cc as t,_d as u};
