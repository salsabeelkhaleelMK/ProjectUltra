import{y as _}from"./components-_fvbk5Dq.js";import{n as b}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js";import{u as V}from"./UnifiedAddForm-BFt8oQo9.js";import{u as z}from"./opportunities-BPg57aoi.js";import{u as L}from"./useCustomersTable-DAaOrG-p.js";import{u as $}from"./useTableRowSelection-Jz-9OHJe.js";import{I as E,r as i,c as G,m as K,d as x,o as h,e as s,s as p,B as l,g as M,y as n,t as P,k as S,G as W}from"./index-BrrG4Zms.js";import"./contacts-UHPRiXzI.js";const j={class:"mb-8"},q={class:"bg-white"},H={key:0,class:"flex items-center gap-2"},J={class:"flex items-center gap-2 mr-1"},Q={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},X={__name:"CustomersTab",emits:["row-click"],setup(Y,{emit:k}){const a=V(),r=z(),d=i("all"),{rowSelection:c,selectedCount:F,hasSelection:O,getSelectedRows:A,clearSelection:f}=$(e=>e.id),g=i({pageIndex:0,pageSize:10}),y=i(""),w=i([]),v=i([]),D=e=>{if(!e)return"N/A";const t=e.split(",");return t.length>1&&t[t.length-1].trim().replace(/^\d+\s*/,"").trim()||e},u=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",m=G(()=>{let e=a.customers;return d.value==="contacts"?e=a.contacts:d.value==="accounts"&&(e=a.accounts),e.map(t=>({id:`customer-${t.id}`,stageKey:"customers",customer:t.name,accountType:t.company&&t.company!==""?"Account":"Contact",telephone:t.phone,location:D(t.address),createdAt:u(t.createdAt),name:t.name,accountOwner:t.source||"N/A",updatedAt:u(t.lastContact||t.createdAt),lastActivity:u(t.lastContact),openOpportunities:r.opportunities.filter(o=>o.customerId===t.id&&o.stage!=="Closed Won"&&o.stage!=="Closed Lost").length,wonOpportunities:r.opportunities.filter(o=>o.customerId===t.id&&o.stage==="Closed Won").length,initials:t.initials||t.name.slice(0,2).toUpperCase(),type:t.company&&t.company!==""?"account":"contact",customerId:t.id}))}),I=k,C=e=>{e.stageKey==="customers"&&I("row-click",e)},T=i("customers"),{columns:N,filterDefinitions:B,tableMeta:R}=L(T,C),U=()=>{const e=A(m.value);e.length!==0&&confirm(`Are you sure you want to delete ${e.length} ${e.length===1?"customer":"customers"}?`)&&(e.forEach(t=>{const o=t.id.replace("customer-","");a.deleteCustomer(o)}),f())};return K(async()=>{await a.fetchCustomers(),await r.fetchOpportunities()}),(e,t)=>(h(),x("div",j,[s("div",q,[p(n(_),{data:m.value,columns:n(N),meta:n(R),onRowClick:C,columnFiltersOptions:{filterDefs:n(B)},pagination:g.value,"onUpdate:pagination":t[0]||(t[0]=o=>g.value=o),globalFilter:y.value,"onUpdate:globalFilter":t[1]||(t[1]=o=>y.value=o),sorting:w.value,"onUpdate:sorting":t[2]||(t[2]=o=>w.value=o),columnFilters:v.value,"onUpdate:columnFilters":t[3]||(t[3]=o=>v.value=o),rowSelection:n(c),"onUpdate:rowSelection":t[4]||(t[4]=o=>W(c)?c.value=o:null),paginationOptions:{rowCount:m.value.length},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":l(()=>[...t[5]||(t[5]=[s("div",{class:"empty-state"},[s("i",{class:"fa-solid fa-inbox empty-state-icon"}),s("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":l(()=>[n(O)?(h(),x("div",H,[s("div",J,[s("div",Q,P(n(F)),1),t[6]||(t[6]=s("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),t[9]||(t[9]=s("div",{class:"h-4 w-px bg-greys-700"},null,-1)),p(n(b),{variant:"ghost",size:"sm",onClick:U},{default:l(()=>[...t[7]||(t[7]=[s("i",{class:"fa-solid fa-trash mr-2"},null,-1),S(" Delete ",-1)])]),_:1}),p(n(b),{variant:"ghost",size:"sm",onClick:n(f)},{default:l(()=>[...t[8]||(t[8]=[s("i",{class:"fa-solid fa-x mr-2"},null,-1),S(" Close ",-1)])]),_:1},8,["onClick"])])):M("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])]))}},rt=E(X,[["__scopeId","data-v-cb273ec4"]]);export{rt as default};
