import{k as ae,l as ge,d as Ge,r as C,c as V,a as n,h as s,b as e,j as m,t as c,e as N,n as F,w as E,v as z,F as H,f as G,i as J,p as xe,_ as Ne,q as he,s as we,x as Q,o as ie,y as Le,z as Be,A as Xe,B as L,C as ve,g as Pe,D as Ue,E as De,T as ke,G as Ve,H as Re,u as Ze,I as _e}from"./index-DddZD1od.js";const re=(t=300)=>new Promise(b=>setTimeout(b,t)),et=async(t={})=>{await re();let b=[...ae];if(t.stage&&(b=b.filter(a=>a.stage===t.stage)),t.assignee&&(b=b.filter(a=>a.assignee===t.assignee)),t.search){const a=t.search.toLowerCase();b=b.filter(y=>y.customer.name.toLowerCase().includes(a)||y.vehicle.brand.toLowerCase().includes(a)||y.vehicle.model.toLowerCase().includes(a))}return{data:b,total:b.length}},tt=async t=>{await re();const b=ae.find(a=>a.id===parseInt(t));if(!b)throw new Error("Opportunity not found");return b},st=async t=>(await re(),ge.filter(b=>b.opportunityId===parseInt(t))),ot=async t=>{await re();const b={id:ae.length+1,...t,createdAt:new Date().toISOString()};return ae.push(b),b},lt=async(t,b)=>{await re();const a=ae.findIndex(y=>y.id===parseInt(t));if(a===-1)throw new Error("Opportunity not found");return ae[a]={...ae[a],...b},ae[a]},at=async t=>{await re();const b=ae.findIndex(a=>a.id===parseInt(t));if(b===-1)throw new Error("Opportunity not found");return ae.splice(b,1),{success:!0}},nt=async(t,b)=>{await re();const a={id:ge.length+1,opportunityId:parseInt(t),timestamp:new Date().toISOString(),...b};return ge.push(a),a},it=async(t,b,a)=>{await re();const y=ge.find(l=>l.id===parseInt(b)&&l.opportunityId===parseInt(t));if(!y)throw new Error("Activity not found");return Object.assign(y,a,{timestamp:new Date().toISOString()}),y},rt=async(t,b)=>{await re();const a=ge.findIndex(y=>y.id===parseInt(b)&&y.opportunityId===parseInt(t));if(a===-1)throw new Error("Activity not found");return ge.splice(a,1),{success:!0}},We=Ge("opportunities",()=>{const t=C([]),b=C(null),a=C([]),y=C(!1),l=C(null),p=C({stage:null,assignee:null,search:""}),u=V(()=>t.value.length),o=V(()=>{const D={};return t.value.forEach(j=>{D[j.stage]||(D[j.stage]=[]),D[j.stage].push(j)}),D}),d=V(()=>t.value.reduce((D,j)=>D+j.value,0));async function r(){y.value=!0,l.value=null;try{const D=await et(p.value);t.value=D.data}catch(D){l.value=D.message}finally{y.value=!1}}async function g(D){y.value=!0,l.value=null;try{b.value=await tt(D),a.value=await st(D);const j=t.value.findIndex(S=>S.id===parseInt(D));j!==-1&&(t.value[j]=b.value)}catch(j){l.value=j.message}finally{y.value=!1}}async function f(D){y.value=!0,l.value=null;try{const j=await ot(D);return t.value.unshift(j),j}catch(j){throw l.value=j.message,j}finally{y.value=!1}}async function k(D,j){y.value=!0,l.value=null;try{const S=await lt(D,j),q=t.value.findIndex(U=>U.id===D);return q!==-1&&(t.value[q]=S),S}catch(S){throw l.value=S.message,S}finally{y.value=!1}}async function v(D){y.value=!0,l.value=null;try{await at(D),t.value=t.value.filter(j=>j.id!==D)}catch(j){throw l.value=j.message,j}finally{y.value=!1}}async function T(D,j){try{const S=await nt(D,j);return a.value.unshift(S),S}catch(S){throw l.value=S.message,S}}async function O(D,j,S){try{const q=await it(D,j,S),U=a.value.findIndex(A=>A.id===parseInt(j));return U!==-1&&(a.value[U]=q),q}catch(q){throw l.value=q.message,q}}async function B(D,j){try{return await rt(D,j),a.value=a.value.filter(S=>S.id!==parseInt(j)),{success:!0}}catch(S){throw l.value=S.message,S}}function X(D){p.value={...p.value,...D},r()}return{opportunities:t,currentOpportunity:b,currentOpportunityActivities:a,loading:y,error:l,filters:p,totalOpportunities:u,opportunitiesByStage:o,totalValue:d,loadOpportunities:r,loadOpportunityById:g,addOpportunity:f,modifyOpportunity:k,removeOpportunity:v,addActivity:T,updateActivity:O,deleteActivity:B,setFilters:X}}),dt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 max-h-[40vh] lg:max-h-none"},ut={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},ct={class:"font-bold text-lg text-gray-800"},mt={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},pt={class:"flex gap-2"},yt={class:"px-5 py-3"},gt={class:"relative"},ft=["placeholder"],bt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},xt=["onClick"],vt=["onClick"],ht={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},wt={class:"flex items-start gap-3.5 pr-6"},kt={class:"flex-1 min-w-0"},$t={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Ct={class:"text-gray-600 text-xs mt-1 truncate"},St={class:"text-right shrink-0"},Dt={class:"flex items-center gap-2 flex-wrap mt-3"},At={__name:"EntityListSidebar",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change"],setup(t,{emit:b}){const a={mounted(o,d){o.clickOutsideEvent=r=>{o===r.target||o.contains(r.target)||d.value()},document.addEventListener("click",o.clickOutsideEvent)},unmounted(o){document.removeEventListener("click",o.clickOutsideEvent)}},y=t,l=C(""),p=V(()=>{let o=y.items;if(y.typeFilter&&y.typeFilter!=="all"&&(o=o.filter(d=>d.type===y.typeFilter)),l.value){const d=l.value.toLowerCase();o=o.filter(r=>{const g=y.getName(r).toLowerCase(),f=y.getVehicleInfo(r).toLowerCase();return g.includes(d)||f.includes(d)})}return o}),u=o=>{const d=o.compositeId||`${o.type||"task"}-${o.id}`||o.id;return y.selectedId===d};return(o,d)=>(s(),n("div",dt,[e("div",ut,[e("h2",ct,c(t.title),1),d[4]||(d[4]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[N(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(s(),n("div",mt,[e("div",pt,[e("button",{onClick:d[0]||(d[0]=r=>o.$emit("filter-change","all")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:d[1]||(d[1]=r=>o.$emit("filter-change","lead")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:d[2]||(d[2]=r=>o.$emit("filter-change","opportunity")),class:F(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):m("",!0),e("div",yt,[e("div",gt,[d[5]||(d[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),E(e("input",{"onUpdate:modelValue":d[3]||(d[3]=r=>l.value=r),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,ft),[[z,l.value]])])]),e("div",bt,[(s(!0),n(H,null,G(p.value,r=>(s(),n("div",{key:r.id,onClick:g=>o.$emit("select",r.compositeId||`${r.type||"task"}-${r.id}`||r.id),class:F(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",u(r)?typeof t.selectedClass=="function"?t.selectedClass(r):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(r):t.unselectedClass])},[t.showMenu?(s(),n("button",{key:0,onClick:J(g=>o.$emit("menu-click",r.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...d[6]||(d[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,vt)):m("",!0),t.openMenuId===r.id&&t.showMenu?E((s(),n("div",ht,[xe(o.$slots,"menu",{item:r})])),[[a,()=>o.$emit("menu-close")]]):m("",!0),e("div",wt,[e("div",{class:F(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(r)])},c(t.getInitials(r)),3),e("div",kt,[e("div",$t,c(t.getName(r)),1),e("div",Ct,c(t.getVehicleInfo(r)),1)]),e("div",St,[xe(o.$slots,"meta",{item:r}),xe(o.$slots,"footer",{item:r})])]),e("div",Dt,[xe(o.$slots,"badges",{item:r})])],10,xt))),128))])]))}},It={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center gap-3"},Ot={key:1,class:"font-bold text-lg text-gray-800"},Tt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},qt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},jt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Mt={class:"text-sm"},Nt={key:2,class:"space-y-6 relative z-10"},Vt={key:0,class:"mb-4 pl-12"},Ft={class:"text-sm font-semibold text-gray-800"},Et={class:"flex gap-4 relative mb-6"},Ut={class:"flex-1 min-w-0"},Lt={class:"text-sm text-slate-700 leading-snug"},Bt={class:"font-bold"},Pt={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},Rt={class:"text-xs text-gray-400 mt-1"},Wt={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0}},emits:["toggle-collapse"],setup(t,{emit:b}){const a=t,y=d=>{const r={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return r[d]||r.default},l=d=>{const r={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return r[d]||r.default},p=d=>{if(!d)return"";const r=new Date(d),g=new Date,f=new Date(g);return f.setDate(f.getDate()-1),r.toDateString()===g.toDateString()?"Today":r.toDateString()===f.toDateString()?"Yesterday":r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},u=d=>d?new Date(d).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",o=(d,r)=>{if(d===0)return!0;const g=a.activities[d-1];if(!g)return!0;const f=new Date(r.timestamp).toDateString(),k=new Date(g.timestamp).toDateString();return f!==k};return(d,r)=>t.show?(s(),n("div",{key:0,class:F(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",t.collapsed?"w-16":"w-80"])},[e("div",It,[t.showCollapse?(s(),n("button",{key:0,onClick:r[0]||(r[0]=g=>d.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:F(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):m("",!0),t.collapsed?m("",!0):(s(),n("h2",Ot,c(t.title),1))]),t.collapsed?m("",!0):(s(),n("div",Tt,[t.activities.length>0?(s(),n("div",qt)):m("",!0),t.activities.length===0?(s(),n("div",jt,[r[1]||(r[1]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Mt,c(t.emptyMessage),1)])):(s(),n("div",Nt,[(s(!0),n(H,null,G(t.activities,(g,f)=>(s(),n(H,{key:g.id},[o(f,g)?(s(),n("div",Vt,[e("h3",Ft,c(p(g.timestamp)),1)])):m("",!0),e("div",Et,[e("div",{class:F(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",l(g.type)])},[e("i",{class:F([y(g.type),"text-sm"])},null,2)],2),e("div",Ut,[e("div",Lt,[e("span",Bt,c(g.user),1),N(" "+c(g.action),1)]),g.content?(s(),n("div",Pt,c(g.content),1)):m("",!0),e("div",Rt,c(u(g.timestamp)),1)])])],64))),128))]))]))],2)):m("",!0)}},zt={class:"w-full"},Yt={class:"flex items-center gap-3 md:gap-4"},Ht={class:"min-w-0 flex-1"},Qt={class:"flex items-center gap-2"},Jt={class:"text-lg md:text-xl font-bold text-gray-900 truncate"},Kt={class:"flex flex-wrap items-center gap-2 mt-1"},Gt={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},Xt={class:"flex items-center justify-between gap-4"},Zt={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},_t={class:"flex items-center gap-2"},es={class:"text-xs text-gray-900 font-medium"},ts={class:"flex items-center gap-2"},ss={class:"text-xs text-gray-900 font-medium"},os={class:"flex items-center gap-2"},ls={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},as={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},ns={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},is={class:"text-xs text-gray-900 font-medium"},rs={class:"flex items-center gap-1.5 shrink-0"},ds={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ze={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},emits:["action"],setup(t,{emit:b}){const a=t,y=b,l=C(!1),p=C(null),u=async(d,r)=>{try{await navigator.clipboard.writeText(d),p.value=r,setTimeout(()=>{p.value=null},1500)}catch(g){console.error("Failed to copy:",g)}},o=d=>{y("action",d,{email:a.email,phone:a.phone})};return(d,r)=>(s(),n("div",zt,[e("div",Yt,[e("div",{class:F(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},c(t.initials),3),e("div",Ht,[e("div",Qt,[e("h1",Jt,c(t.name),1)]),e("div",Kt,[xe(d.$slots,"tags")])]),e("button",{onClick:r[0]||(r[0]=g=>l.value=!l.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0 ml-auto"},[e("i",{class:F(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":l.value}])},null,2)])]),l.value?(s(),n("div",Gt,[e("div",Xt,[e("div",Zt,[e("div",_t,[r[8]||(r[8]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",es,c(t.email),1),e("button",{onClick:r[1]||(r[1]=J(g=>u(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...r[7]||(r[7]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ts,[r[10]||(r[10]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",ss,c(t.phone),1),e("button",{onClick:r[2]||(r[2]=J(g=>u(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...r[9]||(r[9]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",os,[e("div",ls,[t.thirdFieldLabel.toLowerCase().includes("address")?(s(),n("i",as)):(s(),n("i",ns))]),e("span",is,c(t.thirdFieldValue),1)])]),e("div",rs,[e("button",{onClick:r[3]||(r[3]=g=>o("call")),class:"w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 bg-white hover:bg-gray-50 text-gray-600 hover:text-gray-900 transition-colors",title:"Call"},[...r[11]||(r[11]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1)])]),e("button",{onClick:r[4]||(r[4]=g=>o("email")),class:"w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 bg-white hover:bg-gray-50 text-gray-600 hover:text-gray-900 transition-colors",title:"Send Email"},[...r[12]||(r[12]=[e("i",{class:"fa-regular fa-envelope text-xs"},null,-1)])]),e("button",{onClick:r[5]||(r[5]=g=>o("whatsapp")),class:"w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 bg-white hover:bg-gray-50 text-gray-600 hover:text-gray-900 transition-colors",title:"WhatsApp"},[...r[13]||(r[13]=[e("i",{class:"fa-brands fa-whatsapp text-sm"},null,-1)])]),e("button",{onClick:r[6]||(r[6]=g=>o("sms")),class:"w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 bg-white hover:bg-gray-50 text-gray-600 hover:text-gray-900 transition-colors",title:"Send SMS"},[...r[14]||(r[14]=[e("i",{class:"fa-solid fa-comment-sms text-xs"},null,-1)])])])]),p.value?(s(),n("div",ds,c(p.value==="email"?"Email":"Phone")+" copied! ",1)):m("",!0)])):m("",!0)]))}},us={class:"flex gap-8 text-sm font-medium text-gray-500 py-1 overflow-x-auto scrollbar-hide"},cs=["onClick"],Ye={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(b,a)=>(s(),n("div",us,[(s(!0),n(H,null,G(t.tabs,y=>(s(),n("div",{key:y.key,onClick:l=>b.$emit("update:modelValue",y.key),class:F(["pb-2 border-b-2 cursor-pointer whitespace-nowrap transition-all",t.modelValue===y.key?"border-slate-700 text-slate-800":"border-transparent hover:text-gray-700 hover:border-gray-300"])},[N(c(y.label)+" ",1),y.count!==void 0?(s(),n("span",{key:0,class:F(["ml-1 text-[10px] px-1.5 py-0.5 rounded-full",t.modelValue===y.key?"bg-gray-200 text-gray-800":"bg-gray-100 text-gray-600"])},c(y.count),3)):m("",!0)],10,cs))),128))]))}},ms={key:0,class:"mb-8"},ps={class:"flex items-center gap-2 mb-4"},ys={class:"font-bold text-gray-800 text-sm"},gs={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 group overflow-hidden"},fs={class:"block p-4 cursor-pointer select-none bg-white hover:bg-gray-50 transition-colors"},bs={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},xs={class:"text-sm text-slate-700 leading-snug"},vs={class:"flex items-center justify-between"},hs={class:"flex items-center gap-4"},ws={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},ks=["src"],$s={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},Cs={class:"flex items-center gap-2"},Ss={class:"font-bold text-slate-800 text-sm md:text-base"},Ds={class:"flex items-center gap-4"},As={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},Is={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},Os={key:2,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},Ts={key:3,class:"text-right"},qs={class:"font-bold text-slate-800"},js={class:"border-t border-gray-100 p-6 bg-gray-50/30 content-sweep text-sm"},Ms={class:"mb-6"},Ns={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Vs={key:0},Fs={class:"font-medium text-slate-700"},Es={key:1},Us={class:"font-medium text-slate-700"},Ls={key:2},Bs={class:"font-medium text-slate-700"},Ps={class:"font-medium text-slate-700"},Rs={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ws={key:0},zs={class:"font-medium text-slate-700"},Ys={key:1},Hs={class:"font-medium text-slate-700"},Qs={key:2},Js={class:"font-medium text-slate-700"},Ks={key:3},Gs={class:"font-medium text-slate-700"},Xs={key:4},Zs={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},_s={key:5},eo={class:"font-medium text-slate-700"},to={key:0,class:"mt-6 flex justify-end"},so={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const b=y=>new Intl.NumberFormat("en-US").format(y),a=y=>new Intl.NumberFormat("en-US").format(y);return(y,l)=>t.show?(s(),n("div",ms,[e("div",ps,[l[0]||(l[0]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",ys,c(t.label),1)]),e("details",gs,[e("summary",fs,[t.requestMessage?(s(),n("div",bs,[l[1]||(l[1]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",xs,c(t.requestMessage),1)])):m("",!0),e("div",vs,[e("div",hs,[e("div",ws,[t.image?(s(),n("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ks)):(s(),n("i",$s))]),e("div",null,[e("div",Cs,[e("div",Ss,c(t.brand)+" "+c(t.model)+" ("+c(t.year)+")",1)])])]),e("div",Ds,[t.showOpenAd&&t.price?(s(),n("button",As,[...l[2]||(l[2]=[N(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):m("",!0),t.stockDays!==void 0&&t.stockDays!==null?(s(),n("div",Is,[l[3]||(l[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(t.stockDays)+" days) ",1)])):(s(),n("div",Os,[...l[4]||(l[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])),t.price?(s(),n("div",Ts,[l[5]||(l[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",qs,"€ "+c(b(t.price)),1)])):m("",!0),l[6]||(l[6]=e("i",{class:"fa-solid fa-chevron-down chevron-car text-gray-400 text-sm ml-2"},null,-1))])])]),e("div",js,[e("div",Ms,[l[17]||(l[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Ns,[t.requestType?(s(),n("div",Vs,[l[7]||(l[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Fs,c(t.requestType),1)])):m("",!0),t.source?(s(),n("div",Es,[l[8]||(l[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Us,c(t.source),1)])):m("",!0),e("div",null,[l[9]||(l[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:F(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},c(t.sourceDetails||"--"),3)]),t.dealership?(s(),n("div",Ls,[l[10]||(l[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Bs,c(t.dealership),1)])):m("",!0),e("div",null,[l[11]||(l[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Ps,c(t.channel||"Email"),1)]),e("div",null,[l[12]||(l[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:F(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},c(t.adCampaign||"--"),3)]),e("div",null,[l[13]||(l[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:F(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},c(t.adMedium||"--"),3)]),e("div",null,[l[14]||(l[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:F(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},c(t.adSource||"--"),3)]),e("div",null,[l[15]||(l[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:F(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},c(t.expectedPurchaseDate||"--"),3)]),e("div",null,[l[16]||(l[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:F(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},c(t.fiscalEntity||"--"),3)])])]),l[26]||(l[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[l[25]||(l[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Rs,[t.registration?(s(),n("div",Ws,[l[18]||(l[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",zs,c(t.registration),1)])):m("",!0),t.kilometers!==void 0&&t.kilometers!==null?(s(),n("div",Ys,[l[19]||(l[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Hs,c(a(t.kilometers))+" Km",1)])):m("",!0),t.fuelType?(s(),n("div",Qs,[l[20]||(l[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Js,c(t.fuelType),1)])):m("",!0),t.gearType?(s(),n("div",Ks,[l[21]||(l[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Gs,c(t.gearType),1)])):m("",!0),t.vin?(s(),n("div",Xs,[l[22]||(l[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Zs,c(t.vin),1)])):m("",!0),t.dealership?(s(),n("div",_s,[l[23]||(l[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",eo,c(t.dealership),1)])):m("",!0)]),t.showTechnicalSpecs?(s(),n("div",to,[...l[24]||(l[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):m("",!0)])])])])):m("",!0)}},je=Ne(so,[["__scopeId","data-v-6257657e"]]),oo={key:0,class:"relative flex items-center py-1 mb-4"},lo={class:"relative mx-4"},ao={key:0,class:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},no={key:0,class:"border-t border-gray-100 my-1"},Ae={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"}},emits:["action"],setup(t,{emit:b}){const a={mounted(k,v){k.clickOutsideEvent=T=>{k===T.target||k.contains(T.target)||v.value()},document.addEventListener("click",k.clickOutsideEvent)},unmounted(k){document.removeEventListener("click",k.clickOutsideEvent)}},y=t,l=b,p=C(!1),u={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},o=V(()=>{if(!y.activeTab||y.activeTab==="overview")return y.actions.filter(v=>!u[v]);const k=Object.entries(u).filter(([,v])=>v===y.activeTab).map(([v])=>v);return y.actions.filter(v=>k.includes(v))}),d=V(()=>o.value.some(k=>["email","whatsapp","sms"].includes(k))),r=V(()=>o.value.some(k=>["addVehicle","configureVehicle"].includes(k))),g=V(()=>o.value.some(k=>["note","financing","tradein","attachment"].includes(k))),f=k=>{p.value=!1,l("action",k)};return(k,v)=>t.show?(s(),n("div",oo,[v[15]||(v[15]=e("div",{class:"flex-grow border-t border-gray-200"},null,-1)),e("div",lo,[e("button",{onClick:v[0]||(v[0]=J(T=>p.value=!p.value,["stop"])),class:"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"},[...v[10]||(v[10]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),N(" Add new ",-1)])]),p.value?E((s(),n("div",ao,[r.value?(s(),n(H,{key:0},[o.value.includes("addVehicle")?(s(),n("button",{key:0,onClick:v[1]||(v[1]=T=>f("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):m("",!0),o.value.includes("configureVehicle")?(s(),n("button",{key:1,onClick:v[2]||(v[2]=T=>f("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):m("",!0)],64)):m("",!0),g.value?(s(),n(H,{key:1},[r.value?(s(),n("div",no)):m("",!0),o.value.includes("note")?(s(),n("button",{key:1,onClick:v[3]||(v[3]=T=>f("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):m("",!0),o.value.includes("financing")?(s(),n("button",{key:2,onClick:v[4]||(v[4]=T=>f("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):m("",!0),o.value.includes("tradein")?(s(),n("button",{key:3,onClick:v[5]||(v[5]=T=>f("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):m("",!0),o.value.includes("attachment")?(s(),n("button",{key:4,onClick:v[6]||(v[6]=T=>f("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):m("",!0)],64)):m("",!0),d.value?(s(),n(H,{key:2},[v[14]||(v[14]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),o.value.includes("email")?(s(),n("button",{key:0,onClick:v[7]||(v[7]=T=>f("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[11]||(v[11]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),N(" Send Email ",-1)])])):m("",!0),o.value.includes("whatsapp")?(s(),n("button",{key:1,onClick:v[8]||(v[8]=T=>f("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[12]||(v[12]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),N(" Send WhatsApp ",-1)])])):m("",!0),o.value.includes("sms")?(s(),n("button",{key:2,onClick:v[9]||(v[9]=T=>f("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...v[13]||(v[13]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),N(" Send SMS ",-1)])])):m("",!0)],64)):m("",!0)])),[[a,()=>p.value=!1]]):m("",!0)]),v[16]||(v[16]=e("div",{class:"flex-grow border-t border-gray-200"},null,-1))])):m("",!0)}},io={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},ro={class:"grid grid-cols-3 gap-3 mb-4"},uo={class:"flex gap-3 mb-4"},Me={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:b}){const a=b,y=C(null),l=C(""),p=C(""),u=r=>{y.value=r;const g=new Date;if(r==="later-today"){const f=new Date(g.getTime()+72e5);l.value=f.toISOString().split("T")[0],p.value=f.toTimeString().slice(0,5)}else if(r==="tomorrow"){const f=new Date(g);f.setDate(f.getDate()+1),l.value=f.toISOString().split("T")[0],p.value="09:00"}else if(r==="next-week"){const f=new Date(g);f.setDate(f.getDate()+(7-f.getDay()+1)),l.value=f.toISOString().split("T")[0],p.value="09:00"}},o=()=>{a("confirm",{date:l.value,time:p.value,option:y.value}),a("close"),y.value=null,l.value="",p.value=""},d=()=>{a("close"),y.value=null,l.value="",p.value=""};return(r,g)=>t.show?(s(),n("div",io,[g[8]||(g[8]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},"Reschedule to...",-1)),e("div",ro,[e("button",{onClick:g[0]||(g[0]=f=>u("later-today")),class:F(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":y.value==="later-today"}])},[...g[5]||(g[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:g[1]||(g[1]=f=>u("tomorrow")),class:F(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":y.value==="tomorrow"}])},[...g[6]||(g[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:g[2]||(g[2]=f=>u("next-week")),class:F(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":y.value==="next-week"}])},[...g[7]||(g[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",uo,[E(e("input",{"onUpdate:modelValue":g[3]||(g[3]=f=>l.value=f),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[z,l.value]]),E(e("input",{"onUpdate:modelValue":g[4]||(g[4]=f=>p.value=f),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[z,p.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:d,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:o,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):m("",!0)}},co={key:0,class:"space-y-4 animate-fade-in"},mo={key:0,class:"animate-fade-in"},po={class:"grid grid-cols-4 gap-2"},yo=["onClick"],$e={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C(""),p=C("Michael Thomas (Me)"),u=C(""),o=C(!1),d=C("");he(()=>a.show,k=>{k||r()});const r=()=>{l.value="",p.value="Michael Thomas (Me)",u.value="",o.value=!1,d.value=""},g=()=>{!l.value||!u.value||!d.value||(y("confirm",{type:l.value,assignee:p.value,date:u.value,time:d.value}),r())},f=()=>{r(),y("cancel")};return(k,v)=>t.show?(s(),n("div",co,[e("div",null,[v[5]||(v[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),E(e("select",{"onUpdate:modelValue":v[0]||(v[0]=T=>l.value=T),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...v[4]||(v[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[we,l.value]])]),e("div",null,[v[7]||(v[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),E(e("select",{"onUpdate:modelValue":v[1]||(v[1]=T=>p.value=T),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...v[6]||(v[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[we,p.value]])]),e("div",null,[v[8]||(v[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":v[2]||(v[2]=T=>u.value=T),onChange:v[3]||(v[3]=T=>o.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[z,u.value]])]),o.value?(s(),n("div",mo,[v[9]||(v[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",po,[(s(),n(H,null,G(["09:00","10:30","11:00","14:30","15:00","16:30"],T=>e("button",{key:T,onClick:O=>d.value=T,class:F(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",d.value===T?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},c(T),11,yo)),64))])])):m("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:f,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:g,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...v[10]||(v[10]=[N(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):m("",!0)}},go={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},fo={class:"flex items-start gap-3"},bo={class:"flex-1 min-w-0"},xo={class:"font-bold text-sm text-slate-800 mb-2"},vo={class:"space-y-1.5 text-xs text-gray-600"},ho={class:"flex items-center gap-2"},wo={class:"flex items-center gap-2"},ko={class:"flex items-center gap-2"},$o={key:0,class:"mt-2"},Co={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const b=t,a=V(()=>b.appointmentData.date?new Date(b.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),y=V(()=>b.appointmentData.time?b.appointmentData.time:""),l=p=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[p==null?void 0:p.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(p,u)=>(s(),n("div",go,[e("div",fo,[u[3]||(u[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",bo,[e("h4",xo,c(t.appointmentData.type),1),e("div",vo,[e("div",ho,[u[0]||(u[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,c(a.value),1)]),e("div",wo,[u[1]||(u[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,c(y.value),1)]),e("div",ko,[u[2]||(u[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,c(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),n("div",$o,[e("span",{class:F(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",l(t.appointmentData.status)])},c(t.appointmentData.status),3)])):m("",!0)])])]))}},So={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Do={class:"flex-1"},Ao={class:"flex items-center gap-2 mb-1"},Io={class:"text-xs font-bold text-slate-800"},Oo={class:"text-[10px] text-gray-400"},To={class:"text-[10px] text-gray-400"},qo={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},jo={class:"ml-auto flex items-center gap-2"},Mo={key:0,class:"text-sm text-slate-700"},No={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},Vo={key:2,class:"mt-2"},Fo={key:0},Eo={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},Uo={key:0,class:"flex justify-between items-start"},Lo={class:"text-sm font-bold text-slate-800"},Bo={class:"text-xs text-gray-500 mt-1 flex gap-3"},Po={key:0},Ro={key:1},Wo={key:1,class:"flex justify-between items-center mb-2"},zo={class:"text-sm font-bold text-slate-800"},Yo={key:2,class:"flex items-center gap-3"},Ho={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Qo=["src"],Jo={class:"flex-1"},Ko={class:"text-sm font-bold text-slate-800"},Go={class:"text-xs text-gray-500"},Xo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Zo={key:3,class:"flex items-center gap-3"},_o={class:"flex-1"},el={class:"text-sm font-bold text-slate-800"},tl={class:"text-xs text-gray-500"},sl={key:0,class:"text-xs text-gray-400 mt-1"},ol={key:1,class:"text-xs text-gray-600 mt-1"},He={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:b}){const a=t,y=b;C(!1);const l=g=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[g]||"fa-solid fa-circle",p=g=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[g]||"bg-gray-100 text-gray-600 border-gray-200",u=g=>{if(!g)return"Just now";const f=new Date(g),v=new Date-f,T=Math.floor(v/6e4),O=Math.floor(T/60),B=Math.floor(O/24);return T<1?"Just now":T<60?`${T} minutes ago`:O<24?`${O} hours ago`:B===1?"Yesterday":B<7?`${B} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},o=g=>g?new Intl.NumberFormat("en-US").format(g):"0",d=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",r=()=>{confirm("Are you sure you want to delete this item?")&&y("delete",a.item)};return(g,f)=>(s(),n("div",So,[e("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",p(t.item.type)])},[e("i",{class:F([l(t.item.type),"text-sm"])},null,2)],2),e("div",Do,[e("div",Ao,[e("span",Io,c(t.customerInitials),1),e("span",Oo,c(t.item.action||"added"),1),e("span",To,"• "+c(u(t.item.timestamp)),1),t.item.autoDetected?(s(),n("span",qo,"Auto-detected")):m("",!0),e("div",jo,[e("button",{onClick:f[0]||(f[0]=k=>g.$emit("edit",t.item)),class:"text-gray-400 hover:text-blue-600 transition-colors p-1",title:"Edit"},[...f[1]||(f[1]=[e("i",{class:"fa-solid fa-pencil text-xs"},null,-1)])]),e("button",{onClick:r,class:"text-gray-400 hover:text-red-600 transition-colors p-1",title:"Delete"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])])])]),t.item.content?(s(),n("div",Mo,c(t.item.content),1)):m("",!0),t.item.fileName?(s(),n("div",No,[f[3]||(f[3]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,c(t.item.fileName),1)])):m("",!0),t.item.data?(s(),n("div",Vo,[t.item.type==="appointment"?(s(),n("div",Fo,[Q(Co,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),n("div",Eo,[t.item.type==="tradein"?(s(),n("div",Uo,[e("div",null,[e("h4",Lo,c(t.item.data.brand)+" "+c(t.item.data.model),1),e("div",Bo,[t.item.data.year?(s(),n("span",Po,[f[4]||(f[4]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(c(t.item.data.year),1)])):m("",!0),t.item.data.km?(s(),n("span",Ro,[f[5]||(f[5]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(c(t.item.data.km)+" km",1)])):m("",!0)])]),f[6]||(f[6]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Pending Eval",-1))])):t.item.type==="financing"?(s(),n("div",Wo,[e("h4",zo,c(t.item.data.product),1),f[7]||(f[7]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Draft",-1))])):t.item.type==="offer"?(s(),n("div",Yo,[t.item.data.image?(s(),n("div",Ho,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Qo)])):m("",!0),e("div",Jo,[e("h4",Ko,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Go,"€ "+c(o(t.item.data.price)),1)]),t.item.data.isMainOffer?(s(),n("span",Xo,"Main Offer")):m("",!0)])):t.item.type==="purchase"?(s(),n("div",Zo,[e("div",_o,[e("h4",el,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",tl,"€ "+c(o(t.item.data.price)),1),t.item.data.purchaseDate?(s(),n("p",sl,"Purchased: "+c(d(t.item.data.purchaseDate)),1)):m("",!0),t.item.data.notes?(s(),n("p",ol,c(t.item.data.notes),1)):m("",!0)])])):m("",!0)]))])):m("",!0)])]))}},ll={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},al={class:"flex justify-between items-center mb-4"},nl={class:"text-sm font-bold text-slate-800"},il={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Qe={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C("");ie(()=>{a.item&&(l.value=a.item.content||"")});const p=()=>{var u,o;l.value.trim()&&y("save",{id:((u=a.item)==null?void 0:u.id)||Date.now(),type:"note",action:a.item?"updated a note":"added a note",content:l.value,timestamp:((o=a.item)==null?void 0:o.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(u,o)=>(s(),n("div",ll,[o[5]||(o[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",al,[e("h5",nl,c(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:o[0]||(o[0]=d=>u.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...o[3]||(o[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[o[4]||(o[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),E(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=d=>l.value=d),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[z,l.value]])]),e("div",il,[e("button",{onClick:o[2]||(o[2]=d=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},rl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},dl={class:"flex justify-between items-center mb-4"},ul={class:"text-sm font-bold text-slate-800"},cl={class:"flex items-center gap-3"},ml={key:0,class:"text-sm text-slate-600"},pl={key:1,class:"text-sm text-gray-400"},yl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},gl=["disabled"],Je={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C(null),p=C("");ie(()=>{a.item&&(p.value=a.item.fileName||"")});const u=d=>{const r=d.target.files[0];r&&(l.value=r,p.value=r.name)},o=()=>{var d,r;!l.value&&!a.item||y("save",{id:((d=a.item)==null?void 0:d.id)||Date.now(),type:"attachment",action:a.item?"updated an attachment":"added an attachment",fileName:p.value,timestamp:((r=a.item)==null?void 0:r.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(d,r)=>(s(),n("div",rl,[r[6]||(r[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",dl,[e("h5",ul,c(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:r[0]||(r[0]=g=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...r[3]||(r[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",cl,[e("input",{type:"file",onChange:u,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:r[1]||(r[1]=g=>d.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...r[4]||(r[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),N("Choose File ",-1)])]),p.value?(s(),n("span",ml,c(p.value),1)):(s(),n("span",pl,"No file selected"))])]),e("div",yl,[e("button",{onClick:r[2]||(r[2]=g=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:o,disabled:!l.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,gl)])]))}},fl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},bl={class:"flex justify-between items-center mb-4"},xl={class:"text-sm font-bold text-slate-800"},vl={class:"space-y-4"},hl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},$l=["disabled"],Cl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ie(()=>{a.item&&a.item.data&&(l.value={class:a.item.data.class||"Car",brand:a.item.data.brand||"",model:a.item.data.model||"",version:a.item.data.version||"",km:a.item.data.km||"",plate:a.item.data.plate||"",date:a.item.data.date||""})});const p=()=>{var u,o;l.value.brand&&y("save",{id:((u=a.item)==null?void 0:u.id)||Date.now(),type:"tradein",action:a.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((o=a.item)==null?void 0:o.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(u,o)=>(s(),n("div",fl,[o[18]||(o[18]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",bl,[e("h5",xl,c(t.item?"Edit Trade-in":"Add Trade-in"),1),e("button",{onClick:o[0]||(o[0]=d=>u.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...o[9]||(o[9]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",vl,[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),E(e("select",{"onUpdate:modelValue":o[1]||(o[1]=d=>l.value.class=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...o[10]||(o[10]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[we,l.value.class]])]),e("div",hl,[e("div",null,[o[12]||(o[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),E(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=d=>l.value.brand=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.brand]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),E(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=d=>l.value.model=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.model]])])]),e("div",null,[o[14]||(o[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),E(e("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=d=>l.value.version=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.version]])]),e("div",wl,[e("div",null,[o[15]||(o[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),E(e("input",{type:"number","onUpdate:modelValue":o[5]||(o[5]=d=>l.value.km=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.km]])]),e("div",null,[o[16]||(o[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),E(e("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=d=>l.value.plate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.plate]])])]),e("div",null,[o[17]||(o[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),E(e("input",{type:"date","onUpdate:modelValue":o[7]||(o[7]=d=>l.value.date=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.date]])])]),e("div",kl,[e("button",{onClick:o[8]||(o[8]=d=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,$l)])]))}},Sl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Dl={class:"flex justify-between items-center mb-4"},Al={class:"text-sm font-bold text-slate-800"},Il={class:"space-y-4"},Ol={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ql={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},jl=["disabled"],Ml={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ie(()=>{a.item&&a.item.data&&(l.value={startDate:a.item.data.startDate||"",expDate:a.item.data.expDate||"",productName:a.item.data.product||a.item.data.productName||"",deposit:a.item.data.deposit||"",loanAmount:a.item.data.total||a.item.data.loanAmount||""})});const p=()=>{var u,o;l.value.productName&&y("save",{id:((u=a.item)==null?void 0:u.id)||Date.now(),type:"financing",action:a.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((o=a.item)==null?void 0:o.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(u,o)=>(s(),n("div",Sl,[o[13]||(o[13]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Dl,[e("h5",Al,c(t.item?"Edit Financing Proposal":"Add Financing Proposal"),1),e("button",{onClick:o[0]||(o[0]=d=>u.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...o[7]||(o[7]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",Il,[e("div",Ol,[e("div",null,[o[8]||(o[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),E(e("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=d=>l.value.startDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.startDate]])]),e("div",null,[o[9]||(o[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),E(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=d=>l.value.expDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.expDate]])])]),e("div",null,[o[10]||(o[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),E(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=d=>l.value.productName=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.productName]])]),e("div",Tl,[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),E(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=d=>l.value.deposit=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.deposit]])]),e("div",null,[o[12]||(o[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),E(e("input",{type:"number","onUpdate:modelValue":o[5]||(o[5]=d=>l.value.loanAmount=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,l.value.loanAmount]])])])]),e("div",ql,[e("button",{onClick:o[6]||(o[6]=d=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,jl)])]))}},Nl={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Vl={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Fl={class:"mb-3"},El={class:"flex justify-end gap-2"},Ke={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C(""),p=C(""),u=()=>{!l.value.trim()&&!p.value||y("save",{type:"communication",action:`sent via ${a.type}`,content:l.value||`Sent template: ${p.value}`,communicationType:a.type})};return(o,d)=>(s(),n("div",Nl,[d[5]||(d[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Vl,c(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Fl,[d[4]||(d[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),E(e("select",{"onUpdate:modelValue":d[0]||(d[0]=r=>p.value=r),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...d[3]||(d[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[we,p.value]])]),E(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=r=>l.value=r),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[z,l.value]]),e("div",El,[e("button",{onClick:d[2]||(d[2]=r=>o.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:u,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},Ul={class:"flex-1 flex flex-col overflow-hidden"},Ll={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Bl={class:"px-4 md:px-8 py-4 md:py-6"},Pl={class:"relative ml-1"},Rl={key:0,class:"absolute top-full left-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg z-50 p-1 overflow-hidden"},Wl=["onClick"],zl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Yl={key:1,class:"mb-6"},Hl={class:"flex items-center bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden w-full"},Ql={class:"flex items-center gap-2 px-3 py-1.5"},Jl={class:"text-xs font-bold text-gray-800"},Kl={class:"flex items-center gap-2 px-3 py-1.5"},Gl={class:"text-xs font-bold text-gray-800"},Xl={class:"flex items-center gap-2 px-3 py-1.5"},Zl={class:"text-xs font-bold text-gray-800"},_l={key:2,class:"space-y-6 mb-6"},ea={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},ta={class:"p-5 space-y-6"},sa={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},oa={class:"flex justify-between items-start mb-3"},la={class:"text-xs text-gray-500 mt-0.5"},aa={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},na={key:0},ia={key:1},ra={class:"flex gap-3 flex-wrap"},da={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},ua={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},ca={class:"flex items-center gap-1.5"},ma={class:"text-xs font-mono text-red-400"},pa={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},ya={class:"font-bold"},ga={key:1,class:"mt-3 space-y-2"},fa={class:"text-xs text-slate-600 leading-relaxed"},ba={key:2,class:"mt-3 relative z-10"},xa={class:"relative"},va=["onKeyup"],ha={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},wa=["disabled"],ka={key:0,class:"fa-solid fa-spinner fa-spin"},$a={key:1,class:"fa-solid fa-magic"},Ca={class:"bg-gray-50 border-t border-gray-200"},Sa={class:"p-4 flex justify-end gap-3"},Da={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Aa={class:"mb-5"},Ia={class:"flex flex-col gap-2"},Oa={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},Ta=["checked"],qa={key:4},ja={key:5,class:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Ma={class:"p-5 space-y-6"},Na={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Va={class:"flex justify-between items-start mb-3"},Fa={class:"text-xs text-gray-500 mt-0.5"},Ea={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},Ua={key:0},La={key:1},Ba={class:"flex gap-3 flex-wrap"},Pa={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},Ra={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},Wa={class:"flex items-center gap-1.5"},za={class:"text-xs font-mono text-red-400"},Ya={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},Ha={class:"font-bold"},Qa={key:1,class:"mt-3 space-y-2"},Ja={class:"text-xs text-slate-600 leading-relaxed"},Ka={key:2,class:"mt-3 relative z-10"},Ga={class:"relative"},Xa=["onKeyup"],Za={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},_a=["disabled"],en={key:0,class:"fa-solid fa-spinner fa-spin"},tn={key:1,class:"fa-solid fa-magic"},sn={class:"bg-gray-50 border-t border-gray-200"},on={class:"p-4 flex justify-end gap-3"},ln={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},an={class:"mb-5"},nn={class:"flex flex-col gap-2"},rn={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},dn=["checked"],un={key:6,class:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},cn={class:"p-6 flex flex-col items-center justify-center text-center"},mn={class:"bg-white border border-gray-200 rounded-lg px-4 py-2 flex items-center gap-2 text-sm text-slate-700 shadow-sm"},pn={class:"font-medium"},yn={key:7,class:"space-y-4 mb-6 px-1"},gn={class:"bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 overflow-hidden transform transition-all scale-100"},fn={class:"p-5"},bn={class:"mb-4"},xn={class:"flex gap-4"},vn={class:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer"},hn={class:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer"},wn={class:"p-4 bg-gray-50 flex justify-end gap-3"},kn={__name:"LeadContent",props:{lead:{type:Object,required:!0}},setup(t){const b=t,a=Le(),y=Be(),l=C(!1),p=C("overview"),u=C(!1),o=C(!1),d=C(!1),r=C(!1),g=C([]),f=C([]),k=C(0),v=C([]),T=C(""),O=C(null),B=C(null),X=C("email");C("");const D=C("qualify"),j=C("not-interested"),S=C("Data cleanup"),q=C(null),U=C(null),A=C(0),P=C(!1),de=C([]),ee=C(!1),ue=[{speaker:"Sales",text:"Good morning, am I speaking with Mr. Adams?"},{speaker:"Lead",text:"Yes, this is Josh Adams speaking."},{speaker:"Sales",text:"Hi Josh, Michael here regarding your Audi A6 inquiry."},{speaker:"Lead",text:"Oh, hi Michael! Yes, I was waiting for your call."},{speaker:"Sales",text:"Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"},{speaker:"Lead",text:"Yes, I actually have a BMW X3, 2018 model with about 45,000 km.",action:{type:"tradein",data:{brand:"BMW",model:"X3",year:"2018",km:"45,000",auto:!0}}},{speaker:"Sales",text:"Excellent, we can certainly evaluate that. And regarding payment?"},{speaker:"Lead",text:"I'd like to put down €5,000 and finance the rest over 3 years.",action:{type:"financing",data:{product:"Standard Loan",provider:"Audi Financial",total:"14,000",monthly:"420",auto:!0}}},{speaker:"Sales",text:"Understood. I'll note that down and prepare the proposal.",action:{type:"note",data:"Customer requests 3-year financing with €5k deposit."}},{speaker:"Lead",text:"Sounds amazing. Let's proceed with the paperwork."}],h=V(()=>{const x=[...y.currentLeadActivities,...g.value];return p.value==="overview"?x:x.filter(i=>p.value==="communication"?["call","email","sms","whatsapp","communication"].includes(i.type):i.type===p.value)}),I=V(()=>{const x=[...y.currentLeadActivities,...g.value],i=x.length,w=x.filter(ce=>["call","email","sms","whatsapp","communication"].includes(ce.type)).length,W=x.filter(ce=>ce.type==="note").length,ne=x.filter(ce=>ce.type==="attachment").length;return[{key:"overview",label:"Overview",count:i},{key:"note",label:"Notes",count:W},{key:"communication",label:"Communication",count:w},{key:"attachment",label:"Attachments",count:ne}]}),R=[{name:"Sport",color:"bg-red-400"},{name:"Blacklist",color:"bg-indigo-400"},{name:"Green",color:"bg-green-400"},{name:"Premium",color:"bg-blue-400"},{name:"Rent",color:"bg-purple-400"},{name:"Automation",color:"bg-orange-400"},{name:"Complete Profile",color:"bg-lime-400"}],Z=x=>{B.value=null,["email","whatsapp","sms"].includes(x)?(X.value=x,O.value="communication"):O.value=x},se=x=>{B.value=x,O.value=x.type},_=async x=>{const i=g.value.findIndex(w=>w.id===x.id);i>-1&&g.value.splice(i,1),x.activityId&&await y.deleteActivity(b.lead.id,x.activityId)},oe=async x=>{var i;if(x.isEdit){const w=g.value.findIndex(W=>W.id===x.id);w>-1&&(g.value[w]={...g.value[w],...x}),(i=B.value)!=null&&i.activityId&&await y.updateActivity(b.lead.id,B.value.activityId,{type:x.communicationType||x.type,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}else{const w=x.communicationType||x.type,W={id:x.id,type:w==="email"||w==="whatsapp"||w==="sms"?"communication":w,action:x.action,content:x.content,fileName:x.fileName,data:x.data,timestamp:x.timestamp,autoDetected:x.autoDetected||!1,communicationType:x.communicationType};g.value.push(W);const ne=await y.addActivity(b.lead.id,{type:w,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data});W.activityId=ne.id}O.value=null,B.value=null},le=()=>{O.value=null,B.value=null};he(p,()=>{O.value=null,B.value=null});const me=x=>{u.value=!1},te=async x=>{if(!b.lead.tags.includes(x)){const i=[...b.lead.tags,x];await y.modifyLead(b.lead.id,{tags:i})}l.value=!1},fe=x=>{const i=Math.floor(x/60),w=x%60;return`${i.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`},Ce=()=>{r.value=!r.value,r.value?(k.value=0,A.value=0,v.value=[],P.value=!1,de.value=[],q.value=setInterval(()=>{k.value++},1e3),U.value=setInterval(()=>{if(A.value<ue.length){const x=ue[A.value];v.value.push({speaker:x.speaker,text:x.text}),A.value++,v.value.length>4&&v.value.shift()}else clearInterval(U.value),clearInterval(q.value),P.value=!0,be()},2500)):(q.value&&clearInterval(q.value),U.value&&clearInterval(U.value),P.value=!1,f.value.length>0&&be())},be=async()=>{for(const x of f.value){const i={id:Date.now()+Math.random(),type:"note",action:"added a note",content:x,timestamp:new Date().toISOString()};g.value.push(i),await y.addActivity(b.lead.id,{type:"note",user:"You",action:"added a note",content:x})}f.value=[]},pe=async()=>{ee.value=!0,await new Promise(x=>setTimeout(x,800));for(let x=0;x<ue.length;x++){const i=ue[x];i.action&&!de.value.includes(x)&&(i.action.type==="tradein"?Oe(i.action.data):i.action.type==="financing"?Te(i.action.data):i.action.type==="note"&&Ie(i.action.data),de.value.push(x))}ee.value=!1,r.value=!1,P.value=!1},Se=()=>{navigator.clipboard.writeText(b.lead.customer.phone)},ye=()=>{T.value.trim()&&(f.value.push(T.value),T.value="")},Ie=x=>{const i={id:Date.now(),type:"note",action:"added a note",content:x,timestamp:new Date().toISOString(),autoDetected:!0};g.value.push(i)},Oe=x=>{const i={id:Date.now(),type:"tradein",action:"added a trade-in",data:x,timestamp:new Date().toISOString(),autoDetected:x.auto||!1};g.value.push(i)},Te=x=>{const i={id:Date.now(),type:"financing",action:"added a financing proposal",data:x,timestamp:new Date().toISOString(),autoDetected:x.auto||!1};g.value.push(i)},$=async()=>{o.value=!1,a.push("/tasks")},M=x=>{o.value=!1,D.value="qualify",a.push("/tasks")},Y=async()=>{await y.modifyLead(b.lead.id,{isDisqualified:!0,disqualifyReason:S.value,stage:"Disqualified"}),d.value=!1},K={mounted(x,i){x.clickOutsideEvent=w=>{x===w.target||x.contains(w.target)||i.value()},document.addEventListener("click",x.clickOutsideEvent)},unmounted(x){document.removeEventListener("click",x.clickOutsideEvent)}};return Xe(()=>{q.value&&clearInterval(q.value),U.value&&clearInterval(U.value)}),(x,i)=>(s(),n("div",Ul,[e("header",Ll,[e("div",Bl,[Q(ze,{initials:t.lead.customer.initials,name:t.lead.customer.name,"avatar-color-class":"bg-orange-100 text-orange-600",email:t.lead.customer.email,phone:t.lead.customer.phone,"third-field-value":t.lead.customer.address,"email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:ve(()=>[(s(!0),n(H,null,G(t.lead.tags,w=>(s(),n("span",{key:w,class:"px-2 py-0.5 rounded-full border bg-blue-50 border-blue-100 text-blue-700 text-xs font-semibold"},c(w),1))),128)),e("div",Pl,[e("button",{onClick:i[0]||(i[0]=J(w=>l.value=!l.value,["stop"])),class:"text-[10px] md:text-xs font-semibold text-blue-600 hover:text-blue-700 hover:underline flex items-center gap-1 transition-colors outline-none"}," + Add tag "),l.value?E((s(),n("div",Rl,[i[25]||(i[25]=e("div",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider px-3 py-2"},"Select Tag",-1)),(s(),n(H,null,G(R,w=>e("button",{key:w.name,onClick:W=>te(w.name),class:"w-full text-left px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-gray-50 rounded flex items-center gap-2 transition-colors"},[e("span",{class:F(["w-2 h-2 rounded-full",w.color])},null,2),N(" "+c(w.name),1)],8,Wl)),64))])),[[K,()=>l.value=!1]]):m("",!0)])]),_:1},8,["initials","name","email","phone","third-field-value"])])]),e("main",zl,[Q(Ye,{modelValue:p.value,"onUpdate:modelValue":i[1]||(i[1]=w=>p.value=w),tabs:I.value,class:"mb-4"},null,8,["modelValue","tabs"]),p.value==="overview"?(s(),L(Ae,{key:0,actions:["note","tradein","financing","attachment","email","whatsapp","sms"],"active-tab":p.value,onAction:Z},null,8,["active-tab"])):m("",!0),p.value==="overview"?(s(),n("div",Yl,[e("div",Hl,[e("div",Ql,[i[26]||(i[26]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Stage",-1)),e("span",Jl,c(t.lead.stage),1)]),i[29]||(i[29]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Kl,[i[27]||(i[27]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Owner",-1)),e("span",Gl,c(t.lead.assignee),1)]),i[30]||(i[30]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Xl,[i[28]||(i[28]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Source",-1)),e("span",Zl,c(t.lead.source),1)])])])):m("",!0),p.value==="overview"?(s(),n("div",_l,[t.lead.isDisqualified?m("",!0):(s(),n("div",ea,[i[50]||(i[50]=Pe('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage this lead</h3></div><span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium">Task pending</span></div>',1)),e("div",ta,[e("div",sa,[e("div",oa,[e("div",null,[i[31]||(i[31]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Step: Initial Contact",-1)),e("p",la,"Call customer to discuss "+c(t.lead.requestedCar.brand)+" "+c(t.lead.requestedCar.model)+" interest.",1)]),e("div",aa,[r.value?(s(),n("span",ia,[...i[33]||(i[33]=[N("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(s(),n("span",na,[...i[32]||(i[32]=[N("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",ra,[e("button",{onClick:Ce,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[N(c(t.lead.customer.phone)+" Call ",1),i[34]||(i[34]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:Se,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[35]||(i[35]=[N(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),r.value&&!P.value?(s(),n("div",da,[e("div",ua,[i[37]||(i[37]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",ca,[i[36]||(i[36]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",ma,"REC "+c(fe(k.value)),1)])]),e("div",pa,[(s(!0),n(H,null,G(v.value,(w,W)=>(s(),n("div",{key:W,class:F(["text-xs font-mono transition-all duration-500",w.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",ya,c(w.speaker)+":",1),i[38]||(i[38]=N()),e("span",null,c(w.text),1)],2))),128))])])):m("",!0),r.value&&!P.value&&f.value.length>0?(s(),n("div",ga,[(s(!0),n(H,null,G(f.value,(w,W)=>(s(),n("div",{key:W,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[i[39]||(i[39]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",fa,c(w),1)]))),128))])):m("",!0),r.value&&!P.value?(s(),n("div",ba,[e("div",xa,[E(e("textarea",{"onUpdate:modelValue":i[2]||(i[2]=w=>T.value=w),onKeyup:Ue(J(ye,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,va),[[z,T.value]]),e("button",{onClick:ye,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...i[40]||(i[40]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):m("",!0),r.value&&P.value?(s(),n("div",ha,[i[41]||(i[41]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:pe,disabled:ee.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[ee.value?(s(),n("i",ka)):(s(),n("i",$a)),e("span",null,c(ee.value?"Extracting...":"Extract information from transcription"),1)],8,wa)])):m("",!0)])]),e("div",Ca,[e("div",Sa,[e("button",{onClick:i[3]||(i[3]=w=>d.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...i[42]||(i[42]=[N(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:i[4]||(i[4]=w=>{u.value=!u.value,o.value=!1}),class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...i[43]||(i[43]=[N(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:i[5]||(i[5]=w=>{o.value=!o.value,u.value=!1}),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...i[44]||(i[44]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])]),Q(Me,{show:u.value,onClose:i[6]||(i[6]=w=>u.value=!1),onConfirm:me},null,8,["show"]),o.value?(s(),n("div",Da,[i[49]||(i[49]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Create Opportunity",-1)),e("div",Aa,[i[47]||(i[47]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",Ia,[e("label",Oa,[E(e("input",{type:"radio","onUpdate:modelValue":i[7]||(i[7]=w=>D.value=w),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[De,D.value]]),i[45]||(i[45]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:i[9]||(i[9]=J(w=>D.value=D.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:D.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:i[8]||(i[8]=J(()=>{},["stop"]))},null,8,Ta),i[46]||(i[46]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),D.value==="schedule"?(s(),L($e,{key:0,show:D.value==="schedule",onConfirm:M,onCancel:i[10]||(i[10]=w=>D.value="qualify")},null,8,["show"])):m("",!0),D.value!=="schedule"?(s(),n("button",{key:1,onClick:$,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...i[48]||(i[48]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):m("",!0)])):m("",!0)])])),t.lead&&t.lead.requestedCar?(s(),L(je,{key:1,brand:t.lead.requestedCar.brand,model:t.lead.requestedCar.model,year:t.lead.requestedCar.year,image:t.lead.requestedCar.image||"",price:t.lead.requestedCar.price||null,"request-message":t.lead.requestedCar.requestMessage||"","request-type":"Lead",source:t.lead.source||"",dealership:t.lead.requestedCar.dealership||"",registration:t.lead.requestedCar.registration||"",kilometers:t.lead.requestedCar.kilometers!==void 0?t.lead.requestedCar.kilometers:null,"fuel-type":t.lead.requestedCar.fuelType||"","gear-type":t.lead.requestedCar.gearType||"",vin:t.lead.requestedCar.vin||"","stock-days":t.lead.requestedCar.stockDays!==void 0?t.lead.requestedCar.stockDays:null,"fiscal-entity":t.lead.fiscalEntity||"","source-details":t.lead.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):m("",!0)])):m("",!0),p.value!=="overview"?(s(),L(Ae,{key:3,actions:["note","tradein","financing","attachment","email","whatsapp","sms"],"active-tab":p.value,onAction:Z},null,8,["active-tab"])):m("",!0),p.value!=="overview"?(s(),n("div",qa,[O.value==="communication"?(s(),L(Ke,{key:0,type:X.value,"task-type":"lead","task-id":t.lead.id,onSave:oe,onCancel:le},null,8,["type","task-id"])):m("",!0),O.value==="note"?(s(),L(Qe,{key:1,item:B.value,"task-type":"lead","task-id":t.lead.id,onSave:oe,onCancel:le},null,8,["item","task-id"])):m("",!0),O.value==="attachment"?(s(),L(Je,{key:2,item:B.value,"task-type":"lead","task-id":t.lead.id,onSave:oe,onCancel:le},null,8,["item","task-id"])):m("",!0),O.value==="tradein"?(s(),L(Cl,{key:3,item:B.value,"task-type":"lead","task-id":t.lead.id,onSave:oe,onCancel:le},null,8,["item","task-id"])):m("",!0),O.value==="financing"?(s(),L(Ml,{key:4,item:B.value,"task-type":"lead","task-id":t.lead.id,onSave:oe,onCancel:le},null,8,["item","task-id"])):m("",!0)])):m("",!0),p.value==="overview"&&t.lead.isDisqualified?(s(),n("div",ja,[i[70]||(i[70]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage this lead"),e("span",{class:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium"},"Task pending")],-1)),e("div",Ma,[e("div",Na,[e("div",Va,[e("div",null,[i[51]||(i[51]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Step: Initial Contact",-1)),e("p",Fa,"Call customer to discuss "+c(t.lead.requestedCar.brand)+" "+c(t.lead.requestedCar.model)+" interest.",1)]),e("div",Ea,[r.value?(s(),n("span",La,[...i[53]||(i[53]=[N("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(s(),n("span",Ua,[...i[52]||(i[52]=[N("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",Ba,[e("button",{onClick:Ce,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[N(c(t.lead.customer.phone)+" Call ",1),i[54]||(i[54]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:Se,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[55]||(i[55]=[N(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),r.value&&!P.value?(s(),n("div",Pa,[e("div",Ra,[i[57]||(i[57]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",Wa,[i[56]||(i[56]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",za,"REC "+c(fe(k.value)),1)])]),e("div",Ya,[(s(!0),n(H,null,G(v.value,(w,W)=>(s(),n("div",{key:W,class:F(["text-xs font-mono transition-all duration-500",w.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",Ha,c(w.speaker)+":",1),i[58]||(i[58]=N()),e("span",null,c(w.text),1)],2))),128))])])):m("",!0),r.value&&!P.value&&f.value.length>0?(s(),n("div",Qa,[(s(!0),n(H,null,G(f.value,(w,W)=>(s(),n("div",{key:W,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[i[59]||(i[59]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",Ja,c(w),1)]))),128))])):m("",!0),r.value&&!P.value?(s(),n("div",Ka,[e("div",Ga,[E(e("textarea",{"onUpdate:modelValue":i[11]||(i[11]=w=>T.value=w),onKeyup:Ue(J(ye,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,Xa),[[z,T.value]]),e("button",{onClick:ye,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...i[60]||(i[60]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):m("",!0),r.value&&P.value?(s(),n("div",Za,[i[61]||(i[61]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:pe,disabled:ee.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[ee.value?(s(),n("i",en)):(s(),n("i",tn)),e("span",null,c(ee.value?"Extracting...":"Extract information from transcription"),1)],8,_a)])):m("",!0)])]),e("div",sn,[e("div",on,[e("button",{onClick:i[12]||(i[12]=w=>d.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...i[62]||(i[62]=[N(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:i[13]||(i[13]=w=>{u.value=!u.value,o.value=!1}),class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...i[63]||(i[63]=[N(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:i[14]||(i[14]=w=>{o.value=!o.value,u.value=!1}),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...i[64]||(i[64]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])]),Q(Me,{show:u.value,onClose:i[15]||(i[15]=w=>u.value=!1),onConfirm:me},null,8,["show"]),o.value?(s(),n("div",ln,[i[69]||(i[69]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Create Opportunity",-1)),e("div",an,[i[67]||(i[67]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",nn,[e("label",rn,[E(e("input",{type:"radio","onUpdate:modelValue":i[16]||(i[16]=w=>D.value=w),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[De,D.value]]),i[65]||(i[65]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:i[18]||(i[18]=J(w=>D.value=D.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:D.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:i[17]||(i[17]=J(()=>{},["stop"]))},null,8,dn),i[66]||(i[66]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),D.value==="schedule"?(s(),L($e,{key:0,show:D.value==="schedule",onConfirm:M,onCancel:i[19]||(i[19]=w=>D.value="qualify")},null,8,["show"])):m("",!0),D.value!=="schedule"?(s(),n("button",{key:1,onClick:$,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...i[68]||(i[68]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):m("",!0)])):m("",!0)])])):m("",!0),t.lead.isDisqualified?(s(),n("div",un,[e("div",cn,[i[72]||(i[72]=e("div",{class:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-3"},[e("i",{class:"fa-solid fa-ban text-red-500 text-xl"})],-1)),i[73]||(i[73]=e("h3",{class:"font-bold text-slate-800 text-lg"},"Lead Disqualified",-1)),i[74]||(i[74]=e("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"This lead has been marked as lost.",-1)),e("div",mn,[i[71]||(i[71]=e("span",{class:"text-gray-400 text-xs uppercase font-bold tracking-wider"},"Reason:",-1)),e("span",pn,c(t.lead.disqualifyReason||"Not specified"),1)])])])):m("",!0),h.value.length>0?(s(),n("div",yn,[(s(!0),n(H,null,G(h.value,w=>(s(),L(He,{key:w.id,item:w,"task-type":"lead","customer-initials":t.lead.customer.initials,onEdit:se,onDelete:_},null,8,["item","customer-initials"]))),128))])):m("",!0)]),(s(),L(ke,{to:"body"},[d.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in",onClick:i[24]||(i[24]=J(w=>d.value=!1,["self"]))},[e("div",gn,[i[80]||(i[80]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-slate-800 text-lg"},"Disqualify Lead"),e("p",{class:"text-xs text-gray-500 mt-1"},"Please select a reason for disqualification.")],-1)),e("div",fn,[e("div",bn,[i[77]||(i[77]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2"},"Category",-1)),e("div",xn,[e("label",vn,[E(e("input",{type:"radio","onUpdate:modelValue":i[20]||(i[20]=w=>j.value=w),value:"not-valid",class:"w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300"},null,512),[[De,j.value]]),i[75]||(i[75]=N(" Not Valid ",-1))]),e("label",hn,[E(e("input",{type:"radio","onUpdate:modelValue":i[21]||(i[21]=w=>j.value=w),value:"not-interested",class:"w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300"},null,512),[[De,j.value]]),i[76]||(i[76]=N(" Not Interested ",-1))])])]),i[79]||(i[79]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2"},"Failure Reason",-1)),E(e("select",{"onUpdate:modelValue":i[22]||(i[22]=w=>S.value=w),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 shadow-sm"},[...i[78]||(i[78]=[e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[we,S.value]])]),e("div",wn,[e("button",{onClick:i[23]||(i[23]=w=>d.value=!1),class:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-white hover:text-slate-800 border border-transparent hover:border-gray-200 rounded-lg transition-all"}," Cancel "),e("button",{onClick:Y,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg shadow-sm shadow-red-200 transition-all"}," Confirm Disqualification ")])])])):m("",!0)]))]))}},$n={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 overflow-hidden"},Cn={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Sn={class:"text-lg font-bold text-gray-900"},Fe={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:b}){const a=b,y=()=>{a("close")};return(l,p)=>(s(),L(ke,{to:"body"},[t.show?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:J(y,["self"])},[e("div",$n,[e("div",Cn,[e("h3",Sn,c(t.title),1),e("button",{onClick:y,class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"},[...p[0]||(p[0]=[e("i",{class:"fa-solid fa-times text-sm"},null,-1)])])]),p[1]||(p[1]=e("div",{class:"px-6 py-12 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:y,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])])])):m("",!0)]))}},Dn={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},An={class:"flex justify-between items-center mb-4"},In={class:"text-sm font-bold text-slate-800"},On={key:0,class:"mb-4"},Tn={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},qn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},jn=["src"],Mn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Nn={class:"flex-1 min-w-0"},Vn={class:"flex items-center gap-2 flex-wrap"},Fn={class:"font-bold text-sm text-gray-800 truncate"},En={class:"text-xs text-gray-500"},Un={key:0,class:"text-[10px] text-green-600 mt-0.5"},Ln={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Bn=["onClick"],Pn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Rn=["src"],Wn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},zn={class:"flex-1 min-w-0"},Yn={class:"flex items-center gap-2 flex-wrap"},Hn={class:"font-bold text-sm text-gray-800 truncate"},Qn={class:"text-xs text-gray-500"},Jn={key:0,class:"text-[10px] text-green-600 mt-0.5"},Kn={key:1,class:"text-center py-4 text-gray-400 text-sm"},Gn={class:"mb-4"},Xn={key:0,class:"flex items-center gap-2 mb-2"},Zn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_n={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},ei={class:"mt-4"},ti={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},si=["disabled"],oi={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:b}){const a=t,y=b,l=C(null),p=C(null),u=C({brand:"",model:"",year:"",price:"",image:""});ie(()=>{a.item&&a.item.data&&(u.value={brand:a.item.data.brand||"",model:a.item.data.model||"",year:a.item.data.year||"",price:a.item.data.price||"",image:a.item.data.image||""})});const o=f=>{if(l.value=f,a.requestedCar){const k=f.id&&a.requestedCar.id&&f.id===a.requestedCar.id||f.brand===a.requestedCar.brand&&f.model===a.requestedCar.model&&f.year===a.requestedCar.year;p.value=k?"requested":"recommended"}else p.value="recommended";u.value={brand:f.brand||"",model:f.model||"",year:f.year||new Date().getFullYear(),price:f.price||"",image:f.image||""}},d=V(()=>l.value||u.value.brand&&u.value.model&&u.value.price),r=f=>new Intl.NumberFormat("en-US").format(f),g=()=>{var k,v;const f=l.value||u.value;y("save",{id:((k=a.item)==null?void 0:k.id)||Date.now(),type:"offer",action:a.item?"updated an offer":"added an offer",data:{brand:f.brand,model:f.model,year:f.year||new Date().getFullYear(),price:f.price,image:f.image||"",isMainOffer:!1},timestamp:((v=a.item)==null?void 0:v.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(f,k)=>{var v,T;return s(),n("div",Dn,[e("div",An,[e("h5",In,c(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:k[0]||(k[0]=O=>f.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...k[8]||(k[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?m("",!0):(s(),n("div",On,[k[11]||(k[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",Tn,[t.requestedCar?(s(),n("div",{key:0,onClick:k[1]||(k[1]=O=>o(t.requestedCar)),class:F(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((v=l.value)==null?void 0:v.id)===t.requestedCar.id}])},[e("div",qn,[t.requestedCar.image?(s(),n("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,jn)):(s(),n("i",Mn))]),e("div",Nn,[e("div",Vn,[e("h4",Fn,c(t.requestedCar.brand)+" "+c(t.requestedCar.model)+" ("+c(t.requestedCar.year)+")",1),e("span",{class:F(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((T=l.value)==null?void 0:T.id)===t.requestedCar.id&&p.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",En,"€ "+c(r(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(s(),n("div",Un," In stock ("+c(t.requestedCar.stockDays)+" days) ",1)):(s(),n("div",Ln," Out of stock "))]),k[9]||(k[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):m("",!0),(s(!0),n(H,null,G(t.recommendedCars,O=>{var B,X;return s(),n("div",{key:O.id,onClick:D=>o(O),class:F(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((B=l.value)==null?void 0:B.id)===O.id}])},[e("div",Pn,[O.image?(s(),n("img",{key:0,src:O.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Rn)):(s(),n("i",Wn))]),e("div",zn,[e("div",Yn,[e("h4",Hn,c(O.brand)+" "+c(O.model)+" ("+c(O.year)+")",1),e("span",{class:F(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((X=l.value)==null?void 0:X.id)===O.id&&p.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",Qn,"€ "+c(r(O.price)),1),O.stockDays!==null&&O.stockDays!==void 0?(s(),n("div",Jn," In stock ("+c(O.stockDays)+" days) ",1)):m("",!0)]),k[10]||(k[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Bn)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(s(),n("div",Kn," No vehicles available ")):m("",!0)])])),e("div",Gn,[t.requestedCar||t.recommendedCars.length>0?(s(),n("div",Xn,[...k[12]||(k[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):m("",!0),e("div",Zn,[e("div",null,[k[13]||(k[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),E(e("input",{type:"text","onUpdate:modelValue":k[2]||(k[2]=O=>u.value.brand=O),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,u.value.brand]])]),e("div",null,[k[14]||(k[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),E(e("input",{type:"text","onUpdate:modelValue":k[3]||(k[3]=O=>u.value.model=O),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,u.value.model]])])]),e("div",_n,[e("div",null,[k[15]||(k[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),E(e("input",{type:"number","onUpdate:modelValue":k[4]||(k[4]=O=>u.value.year=O),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,u.value.year]])]),e("div",null,[k[16]||(k[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),E(e("input",{type:"number","onUpdate:modelValue":k[5]||(k[5]=O=>u.value.price=O),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,u.value.price]])])]),e("div",ei,[k[17]||(k[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),E(e("input",{type:"text","onUpdate:modelValue":k[6]||(k[6]=O=>u.value.image=O),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[z,u.value.image]])])]),e("div",ti,[e("button",{onClick:k[7]||(k[7]=O=>f.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:g,disabled:!d.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,si)])])}}},li={key:0,class:"mb-8"},ai={class:"relative"},ni={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},ii={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},ri=["src"],di={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},ui={class:"p-4"},ci={class:"font-bold text-gray-800 text-sm mb-1"},mi={class:"text-xs text-gray-500 mb-2"},pi={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},yi=["onClick"],gi={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:b}){const a=C([]);ie(()=>{a.value=Ve.filter(l=>l.stockDays!==null&&l.stockDays!==void 0).slice(0,5)});const y=l=>new Intl.NumberFormat("en-US").format(l);return(l,p)=>a.value.length>0?(s(),n("div",li,[p[1]||(p[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",ai,[e("div",ni,[(s(!0),n(H,null,G(a.value,u=>(s(),n("div",{key:u.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",ii,[u.image?(s(),n("img",{key:0,src:u.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ri)):(s(),n("i",di))]),e("div",ui,[e("h4",ci,c(u.brand)+" "+c(u.model)+" ("+c(u.year)+")",1),e("p",mi,"€ "+c(y(u.price)),1),u.stockDays!==null&&u.stockDays!==void 0?(s(),n("div",pi,[p[0]||(p[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(u.stockDays)+" days) ",1)])):m("",!0),e("button",{onClick:o=>l.$emit("add-to-opportunity",u),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,yi)])]))),128))])])])):m("",!0)}},fi=Ne(gi,[["__scopeId","data-v-0d800814"]]),bi={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},xi={class:"flex justify-between items-start mb-3"},vi={class:"text-xs text-gray-500 mt-0.5"},hi={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review"],setup(t,{emit:b}){const a=t,y=b,l=V(()=>{if(!a.opportunity.createdAt)return 0;const o=new Date(a.opportunity.createdAt),r=Math.abs(new Date-o);return Math.ceil(r/(1e3*60*60*24))}),p=()=>{y("create-offer",a.opportunity)},u=()=>{y("review",a.opportunity)};return(o,d)=>(s(),n("div",bi,[e("div",xi,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",vi,"This opportunity has been open for "+c(l.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")])]))}},wi={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},ki={class:"flex justify-between items-start mb-3"},$i={class:"text-xs text-gray-500 mt-0.5"},Ci={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","mark-unsold"],setup(t,{emit:b}){const a=t,y=b,l=V(()=>{const o=a.opportunity.lastActivity||a.opportunity.createdAt;if(!o)return 0;const d=new Date(o),g=Math.abs(new Date-d);return Math.ceil(g/(1e3*60*60*24))}),p=()=>{y("create-contract",a.opportunity)},u=()=>{y("mark-unsold",a.opportunity)};return(o,d)=>(s(),n("div",wi,[e("div",ki,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",$i,"This opportunity has been in negotiation for "+c(l.value)+" days without a contract. The previous follow-up didn't result in progress. Consider creating a contract or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Mark as Unsold ")])]))}},Si={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Di={class:"flex justify-between items-start mb-3"},Ai={class:"text-xs text-gray-500 mt-0.5"},Ii={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract"],setup(t,{emit:b}){const a=t,y=b,l=V(()=>{const u=a.opportunity.lastActivity||a.opportunity.createdAt;if(!u)return 0;const o=new Date(u),r=Math.abs(new Date-o);return Math.ceil(r/(1e3*60*60*24))}),p=()=>{y("create-contract",a.opportunity)};return(u,o)=>(s(),n("div",Si,[e("div",Di,[e("div",null,[o[0]||(o[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Ai,"This opportunity has been in negotiation for "+c(l.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")])]))}},Oi={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Ti={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-opportunity","schedule-closing"],setup(t,{emit:b}){const a=t,y=b,l=()=>{y("close-opportunity",a.opportunity)},p=()=>{y("schedule-closing",a.opportunity)};return(u,o)=>(s(),n("div",Oi,[o[0]||(o[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Close Opportunity "),e("button",{onClick:p,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Schedule Closing Meeting ")])]))}},qi={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},ji={class:"flex justify-between items-start mb-3"},Mi={class:"text-xs text-gray-500 mt-0.5"},Ni={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist"],setup(t,{emit:b}){const a=t,y=b,l=V(()=>{var g;if(!((g=a.opportunity)!=null&&g.contractDate))return 0;const o=new Date(a.opportunity.contractDate),r=Math.abs(new Date-o);return Math.ceil(r/(1e3*60*60*24))}),p=()=>{y("prepare-delivery",a.opportunity)},u=()=>{y("pre-delivery-checklist",a.opportunity)};return(o,d)=>(s(),n("div",qi,[e("div",ji,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Mi,"Contract was signed "+c(l.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")])]))}},Vi={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Fi={class:"flex justify-between items-start mb-3"},Ei={class:"text-xs text-gray-500 mt-0.5"},Ui={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback"],setup(t,{emit:b}){const a=t,y=b,l=V(()=>{const u=a.activities.find(g=>{var f;return g.type==="delivery"||((f=g.action)==null?void 0:f.toLowerCase().includes("delivered"))});if(!u||!u.timestamp)return 0;const o=new Date(u.timestamp),r=Math.abs(new Date-o);return Math.ceil(r/(1e3*60*60*24))}),p=()=>{y("delivery-feedback",a.opportunity)};return(u,o)=>(s(),n("div",Vi,[e("div",Fi,[e("div",null,[o[0]||(o[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Ei,"Vehicle was delivered "+c(l.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]))}},Li={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Bi={class:"p-5 space-y-6"},Pi={key:0,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},Ri={class:"flex items-start gap-3"},Wi={class:"flex-1"},zi={class:"font-bold text-slate-800 text-sm mb-1"},Yi={key:0},Hi={key:1},Qi={class:"text-xs text-gray-600"},Ji={key:0},Ki={key:1},Gi={key:1},Xi={class:"flex justify-between items-start mb-3"},Zi={class:"font-bold text-slate-800 text-sm"},_i={key:0},er={key:1},tr={class:"text-xs text-gray-500 mt-0.5"},sr={key:0},or={key:1},lr={class:"flex gap-3 flex-wrap"},ar={key:0,class:"mt-4"},nr={class:"[&>div]:mb-0"},ir={key:2,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},rr={class:"flex justify-between items-start mb-3"},dr={class:"text-xs text-gray-500 mt-0.5"},ur={key:0,class:"pt-4"},cr={key:3,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},mr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},pr={class:"p-6"},yr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},gr={class:"p-6"},fr={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:b}){const a=t,y=b,l=C(!1),p=C(!1),u=C(null),o=C(!1),d=C(""),r=C(!1),g=C([]);ie(()=>{g.value=Ve.filter($=>$.stockDays!==null&&$.stockDays!==void 0).slice(0,5).map($=>({id:$.id,brand:$.brand,model:$.model,year:$.year,price:$.price,image:$.image||"",stockDays:$.stockDays}))});const f=$=>{d.value=$,o.value=!0},k=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",v=$=>$?new Date($).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",T=()=>{l.value=!l.value},O=$=>{l.value=!1},B=V(()=>{var K;if(!((K=a.opportunity)!=null&&K.createdAt))return 0;const $=new Date(a.opportunity.createdAt),Y=Math.abs(new Date-$);return Math.ceil(Y/(1e3*60*60*24))}),X=V(()=>{var M,Y;return a.activities.some(K=>K.type==="offer")||((M=a.opportunity)==null?void 0:M.stage)==="In Negotiation"||((Y=a.opportunity)==null?void 0:Y.stage)==="Closed"}),D=V(()=>a.activities.some($=>$.type==="appointment")),j=V(()=>{var M,Y;return a.activities.some(K=>{var x,i;return((x=K.action)==null?void 0:x.toLowerCase().includes("won"))||((i=K.action)==null?void 0:i.toLowerCase().includes("contract"))})||((M=a.opportunity)==null?void 0:M.stage)==="Closed"&&((Y=a.opportunity)==null?void 0:Y.probability)===100}),S=V(()=>a.activities.some($=>{var M,Y;return $.type==="delivery"||((M=$.action)==null?void 0:M.toLowerCase().includes("delivered"))||((Y=$.action)==null?void 0:Y.toLowerCase().includes("delivery"))})),q=V(()=>{var M;if(((M=a.opportunity)==null?void 0:M.stage)!=="Qualified"||X.value||a.scheduledAppointment||D.value)return!1;const $=B.value;return $>=7&&$<14}),U=V(()=>{var w,W,ne;if(((w=a.opportunity)==null?void 0:w.stage)!=="In Negotiation")return!1;const $=((W=a.opportunity)==null?void 0:W.contractDate)!==null&&((ne=a.opportunity)==null?void 0:ne.contractDate)!==void 0,M=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),K=Math.abs(new Date-M),x=Math.ceil(K/(1e3*60*60*24));return!$&&x>=10}),A=V(()=>{var M;return((M=a.opportunity)==null?void 0:M.stage)!=="Qualified"||X.value||!a.scheduledAppointment?!1:B.value>=7}),P=V(()=>{const $=B.value;return $>=14?"high":$>=7?"medium":null}),de=V(()=>{var x;if(((x=a.opportunity)==null?void 0:x.stage)!=="In Negotiation")return!1;const $=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),Y=Math.abs(new Date-$),K=Math.ceil(Y/(1e3*60*60*24));return!j.value&&K>=5}),ee=V(()=>{var W,ne,ce;if(((W=a.opportunity)==null?void 0:W.stage)!=="In Negotiation")return!1;const $=((ne=a.opportunity)==null?void 0:ne.contractDate)!==null&&((ce=a.opportunity)==null?void 0:ce.contractDate)!==void 0,M=a.scheduledAppointment&&new Date(a.scheduledAppointment.start)>new Date||D.value&&a.activities.some(qe=>{var Ee;return qe.type==="appointment"&&((Ee=qe.data)!=null&&Ee.datetime)?new Date(qe.data.datetime)>new Date:!1}),Y=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),x=Math.abs(new Date-Y);return Math.ceil(x/(1e3*60*60*24))>=5&&!$&&!M}),ue=V(()=>{var w;const $=(w=a.opportunity)==null?void 0:w.contractDate;if(!$||S.value)return!1;const M=new Date($),K=Math.abs(new Date-M);return Math.ceil(K/(1e3*60*60*24))>=7}),h=V(()=>{const $=a.activities.find(w=>{var W;return w.type==="delivery"||((W=w.action)==null?void 0:W.toLowerCase().includes("delivered"))});if(!$)return!1;const M=new Date($.timestamp),K=Math.abs(new Date-M);return Math.ceil(K/(1e3*60*60*24))>=3}),I=()=>{y("add-vehicle",a.opportunity)},R=()=>{f("Add Vehicle from Stock")},Z=()=>{f("Configure Vehicle")},se=()=>{r.value=!0},_=()=>{r.value=!1},oe=$=>{r.value=!1,y("create-offer",{opportunity:a.opportunity,offerData:$})},le=$=>{y("add-to-opportunity",$)},me=$=>{f("Review Opportunity")},te=$=>{f("Mark as Unsold")},fe=$=>{f("Create Contract")},Ce=$=>{f("Close Opportunity")},be=$=>{p.value=!0,u.value=$},pe=()=>{p.value=!1,u.value=null},Se=$=>{be("nfu")},ye=$=>{pe();const M={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${$.type} on ${$.date} at ${$.time}`,data:{type:$.type,assignee:$.assignee,date:$.date,time:$.time,datetime:`${$.date}T${$.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};y("appointment-created",M)},Ie=$=>{f("Prepare for Delivery")},Oe=$=>{f("Pre-Delivery Checklist")},Te=$=>{f("Delivery Feedback")};return($,M)=>t.opportunity?(s(),n("div",Li,[M[6]||(M[6]=Pe('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage this opportunity</h3></div><span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium">Active</span></div>',1)),e("div",Bi,[A.value?(s(),n("div",Pi,[e("div",Ri,[M[3]||(M[3]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",Wi,[e("h4",zi,[P.value==="high"?(s(),n("span",Yi,"High Risk")):(s(),n("span",Hi,"At Risk"))]),e("p",Qi,[P.value==="high"?(s(),n("span",Ji," This opportunity has been open for "+c(B.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(s(),n("span",Ki," This opportunity has been open for "+c(B.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):m("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(s(),n("div",Gi,[e("div",{class:F([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",Xi,[e("div",null,[e("h4",Zi,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),n("span",_i," Add Vehicle ")):(s(),n("span",er," Find Alternative "))]),e("p",tr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),n("span",sr," The requested vehicle is available. Add it to the opportunity to proceed. ")):(s(),n("span",or," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",lr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),n("button",{key:0,onClick:I,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):m("",!0),e("button",{onClick:R,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:Z,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:se,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(s(),n("div",ar,[e("div",nr,[Q(fi,{onAddToOpportunity:le})])])):m("",!0)],2)])):m("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(s(),n("div",ir,[e("div",rr,[e("div",null,[M[4]||(M[4]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",dr,c(t.scheduledAppointment.title)+" on "+c(k(t.scheduledAppointment.start))+" at "+c(v(t.scheduledAppointment.start)),1)])]),e("button",{onClick:T,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),l.value?(s(),n("div",ur,[Q(Me,{show:l.value,onClose:M[0]||(M[0]=Y=>l.value=!1),onConfirm:O},null,8,["show"])])):m("",!0)])):t.opportunity.stage==="Qualified"&&!D.value?(s(),n("div",cr,[M[5]||(M[5]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:M[1]||(M[1]=Y=>be("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):m("",!0),U.value?(s(),L(Ci,{key:4,opportunity:t.opportunity,onCreateContract:fe,onMarkUnsold:te},null,8,["opportunity"])):m("",!0),q.value?(s(),L(hi,{key:5,opportunity:t.opportunity,onCreateOffer:se,onReview:me},null,8,["opportunity"])):m("",!0),ee.value?(s(),L(Ti,{key:6,opportunity:t.opportunity,onCloseOpportunity:Ce,onScheduleClosing:Se},null,8,["opportunity"])):m("",!0),de.value?(s(),L(Ii,{key:7,opportunity:t.opportunity,onCreateContract:fe},null,8,["opportunity"])):m("",!0),ue.value?(s(),L(Ni,{key:8,opportunity:t.opportunity,onPrepareDelivery:Ie,onPreDeliveryChecklist:Oe},null,8,["opportunity"])):m("",!0),h.value?(s(),L(Ui,{key:9,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:Te},null,8,["opportunity","activities"])):m("",!0)]),Q(Fe,{show:o.value,title:d.value,onClose:M[2]||(M[2]=Y=>o.value=!1)},null,8,["show","title"]),(s(),L(ke,{to:"body"},[r.value?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:J(_,["self"])},[e("div",mr,[e("div",pr,[Q(oi,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":g.value,onSave:oe,onCancel:_},null,8,["task-id","requested-car","recommended-cars"])])])])):m("",!0)])),(s(),L(ke,{to:"body"},[p.value?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:J(pe,["self"])},[e("div",yr,[e("div",gr,[Q($e,{show:p.value,onConfirm:ye,onCancel:pe},null,8,["show"])])])])):m("",!0)]))])):m("",!0)}},br={key:0,class:"mb-8"},xr={class:"relative"},vr={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},hr=["onClick"],wr={key:0,class:"absolute top-2 right-2 z-10 bg-purple-600 text-white text-[10px] font-bold px-2 py-1 rounded-md shadow-sm"},kr={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},$r=["src"],Cr={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},Sr={class:"p-4"},Dr={class:"font-bold text-gray-800 text-sm mb-1"},Ar={class:"text-xs text-gray-500 mb-2"},Ir={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},Or={__name:"OffersCarousel",setup(t){const b=C(!1),a=C([]);ie(()=>{a.value=Ve.filter(p=>p.stockDays!==null&&p.stockDays!==void 0).slice(0,5)});const y=p=>new Intl.NumberFormat("en-US").format(p),l=p=>{b.value=!0};return(p,u)=>a.value.length>0?(s(),n("div",br,[u[2]||(u[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Offers")],-1)),e("div",xr,[e("div",vr,[(s(!0),n(H,null,G(a.value,(o,d)=>(s(),n("div",{key:o.id,class:"flex-none w-64 snap-start bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:r=>l()},[d===0?(s(),n("div",wr," Main Offer ")):m("",!0),e("div",kr,[o.image?(s(),n("img",{key:0,src:o.image,alt:"Car",class:"w-full h-full object-cover"},null,8,$r)):(s(),n("i",Cr))]),e("div",Sr,[e("h4",Dr,c(o.brand)+" "+c(o.model)+" ("+c(o.year)+")",1),e("p",Ar,"€ "+c(y(o.price)),1),o.stockDays!==null&&o.stockDays!==void 0?(s(),n("div",Ir,[u[1]||(u[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(o.stockDays)+" days) ",1)])):m("",!0)])],8,hr))),128))])]),Q(Fe,{show:b.value,title:"Offer Details",onClose:u[0]||(u[0]=o=>b.value=!1)},null,8,["show"])])):m("",!0)}},Tr=Ne(Or,[["__scopeId","data-v-806b0af7"]]),qr={class:"flex-1 flex flex-col overflow-hidden"},jr={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Mr={class:"px-4 md:px-8 py-4 md:py-6"},Nr={class:"px-2 py-0.5 rounded-full border bg-blue-50 border-blue-100 text-blue-700 text-xs font-semibold"},Vr={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Fr={key:1,class:"mb-6"},Er={class:"flex items-center bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden w-full"},Ur={class:"flex items-center gap-2 px-3 py-1.5"},Lr={class:"text-xs font-bold text-gray-800"},Br={class:"flex items-center gap-2 px-3 py-1.5"},Pr={class:"flex items-center gap-2"},Rr={class:"w-16 bg-gray-200 rounded-full h-2"},Wr={class:"text-xs font-bold text-gray-800"},zr={class:"flex items-center gap-2 px-3 py-1.5"},Yr={class:"text-xs font-bold text-gray-800"},Hr={key:0,class:"w-px h-4 bg-gray-200"},Qr={key:1,class:"flex items-center gap-2 px-3 py-1.5"},Jr={class:"text-xs font-bold text-gray-800"},Kr={key:2,class:"space-y-6 mb-6"},Gr={key:0},Xr={key:4,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 mb-6"},Zr={key:5,class:"space-y-4 mb-6 px-1"},_r={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ed={class:"p-6"},td={__name:"OpportunityContent",props:{opportunity:{type:Object,required:!0}},setup(t){const b=t,a=We(),y=C(!1),l=C(""),p=C(!1),u=C("overview"),o=C(null),d=C(null),r=C("email"),g=C([]),f=V(()=>{const h=[...a.currentOpportunityActivities,...g.value];return u.value==="overview"?h:h.filter(I=>u.value==="communication"?["call","email","sms","whatsapp","communication"].includes(I.type):I.type===u.value)}),k=V(()=>{const h=[...a.currentOpportunityActivities,...g.value],I=h.length,R=h.filter(_=>["call","email","sms","whatsapp","communication"].includes(_.type)).length,Z=h.filter(_=>_.type==="note").length,se=h.filter(_=>_.type==="attachment").length;return[{key:"overview",label:"Overview",count:I},{key:"note",label:"Notes",count:Z},{key:"communication",label:"Communication",count:R},{key:"attachment",label:"Attachments",count:se}]}),v=V(()=>["note","attachment","email","whatsapp","sms"]),T=h=>new Intl.NumberFormat("en-US").format(h),O=h=>h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",B=h=>{d.value=null,h==="scheduleAppointment"?p.value?p.value=!1:p.value=!0:["addVehicle","configureVehicle"].includes(h)?(l.value=h.replace(/([A-Z])/g," $1").trim(),y.value=!0):["email","whatsapp","sms"].includes(h)?(r.value=h,o.value="communication"):o.value=h},X=h=>{d.value=h,o.value=h.type},D=async h=>{const I=g.value.findIndex(R=>R.id===h.id);I>-1&&g.value.splice(I,1),h.activityId&&await a.deleteActivity(b.opportunity.id,h.activityId)},j=async h=>{var I;if(h.isEdit){const R=g.value.findIndex(Z=>Z.id===h.id);R>-1&&(g.value[R]={...g.value[R],...h}),(I=d.value)!=null&&I.activityId&&await a.updateActivity(b.opportunity.id,d.value.activityId,{type:h.communicationType||h.type,user:"You",action:h.action,content:h.content,fileName:h.fileName,data:h.data})}else{const R=h.communicationType||h.type,Z={id:h.id,type:R==="email"||R==="whatsapp"||R==="sms"?"communication":R,action:h.action,content:h.content,fileName:h.fileName,data:h.data,timestamp:h.timestamp,autoDetected:h.autoDetected||!1,communicationType:h.communicationType};g.value.push(Z);const se=await a.addActivity(b.opportunity.id,{type:R,user:"You",action:h.action,content:h.content,fileName:h.fileName,data:h.data});Z.activityId=se.id,R==="offer"&&opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id))}o.value=null,d.value=null},S=()=>{o.value=null,d.value=null};he(u,()=>{o.value=null,d.value=null,p.value=!1});const q=async h=>{p.value=!1;const I={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${h.type} on ${h.date} at ${h.time}`,data:{type:h.type,assignee:h.assignee,date:h.date,time:h.time,datetime:`${h.date}T${h.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};g.value.push({id:Date.now(),...I}),await a.addActivity(b.opportunity.id,{type:"appointment",user:"You",action:I.action,content:I.content,data:I.data})},U=async h=>{g.value.push({id:Date.now(),...h}),await a.addActivity(b.opportunity.id,{type:"appointment",user:h.user,action:h.action,content:h.content,data:h.data})},A=async h=>{if(!(opportunity!=null&&opportunity.id))return;const I={type:"offer",user:"You",action:"created an offer",content:`Offer created for ${h.brand} ${h.model}${h.year?` (${h.year})`:""}`,data:{vehicle:h,price:h.price,isMainOffer:!0}};await a.addActivity(opportunity.id,I),opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id)),g.value.push({id:Date.now(),type:"offer",action:"created an offer",content:I.content,data:I.data,timestamp:new Date().toISOString()})},P=()=>{},de=()=>{},ee=({opportunity:h,offerData:I})=>{j(I)},ue=async h=>{if(!(opportunity!=null&&opportunity.id))return;const I={type:"offer",user:"You",action:"created an offer",content:`Offer created for ${h.brand} ${h.model}${h.year?` (${h.year})`:""}`,data:{vehicle:h,price:h.price,isMainOffer:!1}};await a.addActivity(opportunity.id,I),opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id)),g.value.push({id:Date.now(),type:"offer",action:"created an offer",content:I.content,data:I.data,timestamp:new Date().toISOString()})};return(h,I)=>{var R,Z,se,_,oe,le,me;return s(),n("div",qr,[e("header",jr,[e("div",Mr,[Q(ze,{initials:t.opportunity.customer.initials,name:t.opportunity.customer.name,"avatar-color-class":"bg-purple-100 text-purple-600",email:t.opportunity.customer.email,phone:t.opportunity.customer.phone,"third-field-value":O(t.opportunity.expectedCloseDate),"email-label":"Email","phone-label":"Phone","third-field-label":"Expected Close"},{tags:ve(()=>[I[5]||(I[5]=e("span",{class:"px-2 py-0.5 rounded-full border bg-purple-50 border-purple-100 text-purple-700 text-xs font-semibold"}," Opportunity ",-1)),e("span",Nr," €"+c(T(t.opportunity.value)),1)]),_:1},8,["initials","name","email","phone","third-field-value"])])]),e("main",Vr,[Q(Ye,{modelValue:u.value,"onUpdate:modelValue":I[0]||(I[0]=te=>u.value=te),tabs:k.value,class:"mb-4"},null,8,["modelValue","tabs"]),u.value==="overview"?(s(),L(Ae,{key:0,actions:v.value,"active-tab":u.value,onAction:B},null,8,["actions","active-tab"])):m("",!0),u.value==="overview"?(s(),n("div",Fr,[e("div",Er,[e("div",Ur,[I[6]||(I[6]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Stage",-1)),e("span",Lr,c(t.opportunity.stage),1)]),I[10]||(I[10]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Br,[I[7]||(I[7]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Probability",-1)),e("div",Pr,[e("div",Rr,[e("div",{class:F(["h-2 rounded-full transition-all",t.opportunity.probability>=70?"bg-green-500":t.opportunity.probability>=40?"bg-orange-500":"bg-red-500"]),style:Re({width:t.opportunity.probability+"%"})},null,6)]),e("span",Wr,c(t.opportunity.probability)+"%",1)])]),I[11]||(I[11]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",zr,[I[8]||(I[8]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Owner",-1)),e("span",Yr,c(t.opportunity.assignee),1)]),t.opportunity.source?(s(),n("div",Hr)):m("",!0),t.opportunity.source?(s(),n("div",Qr,[I[9]||(I[9]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Source",-1)),e("span",Jr,c(t.opportunity.source),1)])):m("",!0)])])):m("",!0),u.value==="overview"?(s(),n("div",Kr,[Q(fr,{opportunity:t.opportunity,"scheduled-appointment":((R=t.opportunity)==null?void 0:R.scheduledAppointment)||null,activities:[...Ze(a).currentOpportunityActivities,...g.value],onAddVehicle:A,onAddVehicleFromStock:P,onConfigureVehicle:de,onCreateOffer:ee,onAddToOpportunity:ue,onAppointmentCreated:U},null,8,["opportunity","scheduled-appointment","activities"]),((Z=t.opportunity)==null?void 0:Z.stage)==="In Negotiation"||((se=t.opportunity)==null?void 0:se.stage)==="Closed"?(s(),n("div",Gr,[Q(Tr)])):m("",!0),t.opportunity&&t.opportunity.vehicle&&!(((_=t.opportunity)==null?void 0:_.stage)==="In Negotiation"||((oe=t.opportunity)==null?void 0:oe.stage)==="Closed")?(s(),L(je,{key:1,brand:t.opportunity.vehicle.brand,model:t.opportunity.vehicle.model,year:t.opportunity.vehicle.year,image:t.opportunity.vehicle.image||"",price:t.opportunity.vehicle.price||null,"request-message":t.opportunity.vehicle.requestMessage||"","request-type":"Opportunity",source:t.opportunity.source||"",dealership:t.opportunity.vehicle.dealership||"",registration:t.opportunity.vehicle.registration||"",kilometers:t.opportunity.vehicle.kilometers!==void 0?t.opportunity.vehicle.kilometers:null,"fuel-type":t.opportunity.vehicle.fuelType||"","gear-type":t.opportunity.vehicle.gearType||"",vin:t.opportunity.vehicle.vin||"","stock-days":t.opportunity.vehicle.stockDays!==void 0?t.opportunity.vehicle.stockDays:null,"fiscal-entity":t.opportunity.vehicle.fiscalEntity||"","source-details":t.opportunity.vehicle.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):m("",!0),t.opportunity&&t.opportunity.vehicle&&(((le=t.opportunity)==null?void 0:le.stage)==="In Negotiation"||((me=t.opportunity)==null?void 0:me.stage)==="Closed")?(s(),L(je,{key:2,brand:t.opportunity.vehicle.brand,model:t.opportunity.vehicle.model,year:t.opportunity.vehicle.year,image:t.opportunity.vehicle.image||"",price:t.opportunity.vehicle.price||null,"request-message":t.opportunity.vehicle.requestMessage||"","request-type":"Opportunity",source:t.opportunity.source||"",dealership:t.opportunity.vehicle.dealership||"",registration:t.opportunity.vehicle.registration||"",kilometers:t.opportunity.vehicle.kilometers!==void 0?t.opportunity.vehicle.kilometers:null,"fuel-type":t.opportunity.vehicle.fuelType||"","gear-type":t.opportunity.vehicle.gearType||"",vin:t.opportunity.vehicle.vin||"","stock-days":t.opportunity.vehicle.stockDays!==void 0?t.opportunity.vehicle.stockDays:null,"fiscal-entity":t.opportunity.vehicle.fiscalEntity||"","source-details":t.opportunity.vehicle.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):m("",!0)])):m("",!0),u.value!=="overview"?(s(),L(Ae,{key:3,actions:v.value,"active-tab":u.value,onAction:B},null,8,["actions","active-tab"])):m("",!0),p.value&&u.value!=="overview"?(s(),n("div",Xr,[Q($e,{show:p.value,onConfirm:q,onCancel:I[1]||(I[1]=te=>p.value=!1)},null,8,["show"])])):m("",!0),f.value.length>0?(s(),n("div",Zr,[(s(!0),n(H,null,G(f.value,te=>(s(),L(He,{key:te.id,item:te,"task-type":"opportunity","customer-initials":t.opportunity.customer.initials,onEdit:X,onDelete:D},null,8,["item","customer-initials"]))),128))])):m("",!0),o.value==="communication"?(s(),L(Ke,{key:6,type:r.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:j,onCancel:S},null,8,["type","task-id"])):m("",!0),o.value==="note"?(s(),L(Qe,{key:7,item:d.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:j,onCancel:S},null,8,["item","task-id"])):m("",!0),o.value==="attachment"?(s(),L(Je,{key:8,item:d.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:j,onCancel:S},null,8,["item","task-id"])):m("",!0)]),Q(Fe,{show:y.value,title:l.value,onClose:I[2]||(I[2]=te=>y.value=!1)},null,8,["show","title"]),(s(),L(ke,{to:"body"},[p.value?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:I[4]||(I[4]=J(te=>p.value=!1,["self"]))},[e("div",_r,[e("div",ed,[Q($e,{show:p.value,onConfirm:q,onCancel:I[3]||(I[3]=te=>p.value=!1)},null,8,["show"])])])])):m("",!0)]))])}}},sd={__name:"TaskDetailContent",props:{task:{type:Object,required:!0}},setup(t){return(b,a)=>t.task.type==="lead"?(s(),L(kn,{key:0,lead:t.task},null,8,["lead"])):t.task.type==="opportunity"?(s(),L(td,{key:1,opportunity:t.task},null,8,["opportunity"])):m("",!0)}},od={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},ld={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},ad={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},nd={key:0,class:"fa-solid fa-clock text-[10px]"},id={class:"text-[10px] font-bold uppercase tracking-wide"},rd={key:1,class:"text-right"},dd={class:"text-sm font-bold text-gray-900"},ud={class:"mt-1.5"},cd={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},md={class:"text-[10px] text-gray-500 mt-0.5"},pd=["onClick"],yd=["onClick"],gd=["onClick"],fd={class:"flex-1 flex flex-col overflow-hidden"},bd={key:0,class:"flex-1 flex items-center justify-center"},vd={__name:"TaskDetail",setup(t){const b=_e(),a=Le(),y=Be(),l=We(),p=C("all"),u=C(null),o=V(()=>{const S=y.leads.map(U=>({...U,type:"lead",compositeId:`lead-${U.id}`})),q=l.opportunities.map(U=>({...U,type:"opportunity",compositeId:`opportunity-${U.id}`}));return[...S,...q].sort((U,A)=>{const P=new Date(U.lastActivity||U.createdAt||0);return new Date(A.lastActivity||A.createdAt||0)-P})}),d=V(()=>p.value==="all"?o.value:o.value.filter(S=>S.type===p.value)),r=V(()=>{const S=parseInt(b.params.id),q=b.query.type;if(q)return o.value.find(P=>P.id===S&&P.type===q)||null;const A=(p.value!=="all"?o.value.filter(P=>P.type===p.value):o.value).find(P=>P.id===S);return A||o.value.find(P=>P.id===S)||null}),g=V(()=>r.value?r.value.type==="lead"?y.currentLeadActivities:l.currentOpportunityActivities:[]),f=V(()=>S=>S.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");ie(()=>{y.loadLeads(),l.loadOpportunities();const S=b.params.id;S&&k(S)}),he(()=>b.params.id,S=>{S&&k(S)}),he(r,S=>{S&&(S.type==="lead"?y.loadLeadById(S.id):l.loadOpportunityById(S.id))},{immediate:!0});const k=S=>{const q=parseInt(S),U=o.value.find(A=>A.id===q);U&&(U.type==="lead"?y.loadLeadById(q):l.loadOpportunityById(q))},v=S=>{const[q,U]=S.split("-");a.push({path:`/tasks/${U}`,query:{type:q}})},T=S=>new Intl.NumberFormat("en-US").format(S),O=S=>{u.value=u.value===S?null:S},B=S=>{u.value=null,console.log("Reassign task",S.id,S.type)},X=S=>{u.value=null,console.log("Mark as hot",S)},D=S=>{u.value=null,console.log("Unmark as hot",S)},j=S=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[S]||"bg-gray-100 text-gray-700 border-gray-200";return(S,q)=>{var U;return s(),n("div",od,[Q(At,{title:"Tasks",items:d.value,"selected-id":(U=r.value)==null?void 0:U.compositeId,"type-filter":p.value,"selected-class":A=>A.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":f.value,"open-menu-id":u.value,getName:A=>A.customer.name,getInitials:A=>A.customer.initials,getVehicleInfo:A=>A.type==="lead"?`${A.requestedCar.brand} ${A.requestedCar.model}`:`${A.vehicle.brand} ${A.vehicle.model}`,avatarClass:A=>A.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600",onSelect:v,onMenuClick:O,onMenuClose:q[0]||(q[0]=A=>u.value=null),"show-type-filter":!0,onFilterChange:q[1]||(q[1]=A=>p.value=A)},{badges:ve(({item:A})=>[e("span",{class:F(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",A.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(A.type==="lead"?"Lead":"Opportunity"),3),A.type==="lead"?(s(),n(H,{key:0},[e("span",ld,c(A.status),1),A.priority==="Hot"?(s(),n("span",ad,[...q[2]||(q[2]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),N(" Hot ",-1)])])):m("",!0)],64)):(s(),n("span",{key:1,class:F(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",j(A.stage)])},c(A.stage),3))]),meta:ve(({item:A})=>[A.type==="lead"?(s(),n("div",{key:0,class:F(["flex items-center gap-1.5",A.priority==="Hot"?"text-red-500":"text-gray-400"])},[A.priority==="Hot"?(s(),n("i",nd)):m("",!0),e("span",id," Due in "+c(A.nextActionDue),1)],2)):(s(),n("div",rd,[e("div",dd,"€"+c(T(A.value)),1),e("div",ud,[e("div",cd,[e("div",{class:F(["h-full rounded-full",A.probability>=70?"bg-green-500":A.probability>=40?"bg-blue-500":"bg-orange-500"]),style:Re({width:`${A.probability}%`})},null,6)]),e("div",md,c(A.probability)+"% PROB",1)])]))]),menu:ve(({item:A})=>[e("button",{onClick:J(P=>B(A),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[3]||(q[3]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),N(" Reassign ",-1)])],8,pd),A.type==="lead"?(s(),n(H,{key:0},[A.priority!=="Hot"?(s(),n("button",{key:0,onClick:J(P=>X(A.id),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[4]||(q[4]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),N(" Mark as hot ",-1)])],8,yd)):(s(),n("button",{key:1,onClick:J(P=>D(A.id),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[5]||(q[5]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),N(" Unmark as hot ",-1)])],8,gd))],64)):m("",!0)]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass"]),e("div",fd,[r.value?(s(),L(sd,{key:1,task:r.value},null,8,["task"])):(s(),n("div",bd,[...q[6]||(q[6]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),Q(Wt,{title:"Activity summary",activities:g.value,collapsed:!1,"show-collapse":!1,show:!!r.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{vd as default};
