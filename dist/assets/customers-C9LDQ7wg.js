const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-hkpYR6II.js","assets/index-CuAUe_hq.css"])))=>i.map(i=>d[i]);
import{aa as D,ab as S,ac as B,ad as l,ae as P,af as $,a9 as _,a5 as Q,r as y,c as v}from"./index-hkpYR6II.js";const w=(t=300)=>new Promise(e=>setTimeout(e,t)),h=()=>l.filter(t=>!t.company||t.company===""),V=async(t={})=>{await w();let e=h();if(t.search){const a=t.search.toLowerCase();e=e.filter(c=>c.name.toLowerCase().includes(a)||c.email.toLowerCase().includes(a))}return{data:e,total:e.length}},x=async t=>{await w();const a=h().find(c=>c.id===parseInt(t));if(!a)throw new Error("Contact not found");return a},W=async t=>{await w();const e={id:l.length+1,...t,company:null,createdAt:new Date().toISOString(),lastContact:new Date().toISOString()};return l.push(e),e},j=async(t,e)=>{if(await w(),h().findIndex(d=>d.id===parseInt(t))===-1)throw new Error("Contact not found");const u=l.findIndex(d=>d.id===parseInt(t));return u!==-1&&(l[u]={...l[u],...e,company:null}),l[u]},N=async t=>{await w();const e=l.findIndex(a=>a.id===parseInt(t));if(e===-1)throw new Error("Contact not found");return l.splice(e,1),{success:!0}},z=async(t,e)=>{if(await w(),!h().find(d=>d.id===parseInt(t)))throw new Error("Contact not found");const u=l.findIndex(d=>d.id===parseInt(t));if(u===-1)throw new Error("Contact not found");return l[u].requestedCar={...e,id:Date.now()},{...l[u]}},F=async t=>{await w();const a=h().find(d=>d.id===parseInt(t));if(!a)throw new Error("Contact not found");if(!a.requestedCar)throw new Error("Contact must have requested car");const{createLead:c}=await _(async()=>{const{createLead:d}=await import("./index-hkpYR6II.js").then(o=>o.bn);return{createLead:d}},__vite__mapDeps([0,1]));return await c({customerId:a.id,requestedCar:a.requestedCar,source:a.source||"Direct",tags:a.tags||[],stage:"Open Lead",status:"Open",priority:"Normal"})},G=async t=>{await w();const a=h().find(d=>d.id===parseInt(t));if(!a)throw new Error("Contact not found");if(!a.requestedCar)throw new Error("Contact must have requested car");const{createOpportunity:c}=await _(async()=>{const{createOpportunity:d}=await import("./index-hkpYR6II.js").then(o=>o.bo);return{createOpportunity:d}},__vite__mapDeps([0,1]));return await c({customerId:a.id,vehicle:a.requestedCar,source:a.source||"Direct",tags:a.tags||[],stage:"Qualified",value:a.requestedCar.price||0})},nt=async t=>{await w();const e=D.filter(a=>a.customerId===parseInt(t));return{data:e,total:e.length}},ot=async t=>{await w();const e=S.filter(a=>a.customerId===parseInt(t));return{data:e,total:e.length}},ct=async t=>{await w();const e=[],a=l.find(o=>o.id===parseInt(t));a!=null&&a.id,D.filter(o=>o.customerId===parseInt(t)).forEach(o=>{o.requestedCar&&e.push({...o.requestedCar,id:`requested-${o.id}`,type:"requested",leadId:o.id,leadStage:o.stage})}),a!=null&&a.requestedCar&&e.push({...a.requestedCar,id:`requested-contact-${a.id}`,type:"requested",contactId:a.id});const u=S.filter(o=>o.customerId===parseInt(t));return u.forEach(o=>{P.filter(p=>p.opportunityId===o.id&&p.type==="offer").forEach(p=>{var m;(m=p.data)!=null&&m.vehicle&&e.push({...p.data.vehicle,id:`offered-${p.id}`,type:"offered",opportunityId:o.id,opportunityStage:o.stage,offerDate:p.timestamp})})}),$.filter(o=>o.customerId===parseInt(t)&&o.type==="test-drive").forEach(o=>{o.vehicle&&e.push({brand:o.vehicle.split(" ")[0]||"",model:o.vehicle.split(" ").slice(1).join(" ")||"",id:`drove-${o.id}`,type:"drove",eventId:o.id,testDriveDate:o.start,vehicle:o.vehicle})}),u.forEach(o=>{o.stage==="Closed Won"&&o.vehicle&&e.push({...o.vehicle,id:`purchased-${o.id}`,type:"purchased",opportunityId:o.id,purchaseDate:o.contractDate||o.lastActivity})}),{data:e,total:e.length}},rt=async t=>{await w();const e=B.filter(a=>a.customerId===parseInt(t));return{data:e,total:e.length}},C=(t=300)=>new Promise(e=>setTimeout(e,t)),I=()=>l.filter(t=>t.company&&t.company!==""),H=async(t={})=>{await C();let e=I();if(t.search){const a=t.search.toLowerCase();e=e.filter(c=>{var u;return c.name.toLowerCase().includes(a)||c.email.toLowerCase().includes(a)||((u=c.company)==null?void 0:u.toLowerCase().includes(a))})}return{data:e,total:e.length}},T=async t=>{await C();const a=I().find(c=>c.id===parseInt(t));if(!a)throw new Error("Account not found");return a},J=async t=>{await C();const e={id:l.length+1,...t,createdAt:new Date().toISOString(),lastContact:new Date().toISOString()};return l.push(e),e},K=async(t,e)=>{if(await C(),I().findIndex(d=>d.id===parseInt(t))===-1)throw new Error("Account not found");const u=l.findIndex(d=>d.id===parseInt(t));return u!==-1&&(l[u]={...l[u],...e}),l[u]},M=async t=>{await C();const e=l.findIndex(a=>a.id===parseInt(t));if(e===-1)throw new Error("Account not found");return l.splice(e,1),{success:!0}},st=Q("customers",()=>{const t=y([]),e=y(null),a=y(!1),c=y(null),u=y(""),d=v(()=>t.value.filter(n=>n.type==="contact")),o=v(()=>t.value.filter(n=>n.type==="account")),g=v(()=>t.value.length),p=v(()=>d.value.length),m=v(()=>o.value.length),E=async(n={})=>{a.value=!0,c.value=null;try{const[r,s]=await Promise.all([V(n),H(n)]),i=[...r.data.map(f=>({...f,type:"contact"})),...s.data.map(f=>({...f,type:"account"}))];return t.value=i,{data:i,total:i.length}}catch(r){throw c.value=r.message,r}finally{a.value=!1}},k=async(n,r=null)=>{a.value=!0,c.value=null;try{if(r==="contact")e.value={...await x(n),type:"contact"};else if(r==="account")e.value={...await T(n),type:"account"};else try{const s=await x(n);e.value={...s,type:"contact"}}catch{const s=await T(n);e.value={...s,type:"account"}}return e.value}catch(s){throw c.value=s.message,s}finally{a.value=!1}},q=async n=>{a.value=!0,c.value=null;try{const r=n.company&&n.company!=="",i={...await(r?J(n):W(n)),type:r?"account":"contact"};return t.value.unshift(i),i}catch(r){throw c.value=r.message,r}finally{a.value=!1}},A=async(n,r,s)=>{var i;a.value=!0,c.value=null;try{const f=await(s==="account"?K(n,r):j(n,r)),O=t.value.findIndex(b=>b.id===n);return O!==-1&&(t.value[O]={...f,type:s}),((i=e.value)==null?void 0:i.id)===n&&(e.value={...f,type:s}),{...f,type:s}}catch(f){throw c.value=f.message,f}finally{a.value=!1}},L=async(n,r)=>{var s;a.value=!0,c.value=null;try{await(r==="account"?M(n):N(n)),t.value=t.value.filter(i=>i.id!==n),((s=e.value)==null?void 0:s.id)===n&&(e.value=null)}catch(i){throw c.value=i.message,i}finally{a.value=!1}};function R(n){u.value=n,E({search:n})}return{customers:t,contacts:d,accounts:o,currentCustomer:e,loading:a,error:c,searchQuery:u,totalCustomers:g,totalContacts:p,totalAccounts:m,fetchCustomers:E,fetchCustomerById:k,addCustomer:q,updateCustomer:A,removeCustomer:L,setSearchQuery:R,addContact:async n=>await q({...n,company:null}),modifyContact:async(n,r)=>await A(n,r,"contact"),removeContact:async n=>await L(n,"contact"),addRequestedCar:async(n,r)=>{const s=t.value.find(i=>i.id===n);if(!s)throw new Error("Customer not found");if(s.type==="contact")return await z(n,r);throw new Error("Requested cars not supported for accounts")},convertToLead:async n=>{var s;const r=t.value.find(i=>i.id===n);if(!r)throw new Error("Customer not found");if(r.type==="contact"){const i=await F(n);return t.value=t.value.filter(f=>f.id!==n),((s=e.value)==null?void 0:s.id)===n&&(e.value=null),i}throw new Error("Only contacts can be converted to leads")},convertToOpportunity:async n=>{var s;const r=t.value.find(i=>i.id===n);if(!r)throw new Error("Customer not found");if(r.type==="contact"){const i=await G(n);return t.value=t.value.filter(f=>f.id!==n),((s=e.value)==null?void 0:s.id)===n&&(e.value=null),i}throw new Error("Only contacts can be converted to opportunities")}}});export{ot as a,rt as b,ct as c,nt as f,st as u};
