import{r as x,c as q,H as O,I as j,e as u,o as d,h as r,g as f,t as w,j as L,n as h,z,B as ie,F as U,i as ae,w as M,J as T,G as oe,u as ne,K as de,k as ue,l as B,L as k,p as V,m as $,d as ce}from"./index-BWBI-39A.js";import{u as pe}from"./opportunities-BqbHAwj_.js";import{u as ye,_ as ge,a as fe,b as H}from"./useTaskShell-BBtCSiGW.js";import{g as A,a as ve,b as me}from"./formatters-BG48v0Hy.js";import{_ as be}from"./ReassignUserModal-BGYPf12H.js";import"./ModalShell-BIWc87zS.js";const he={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},xe={class:"px-4 md:px-8 py-4 md:py-6 border-b border-gray-100 bg-gray-50/50 shrink-0"},we={class:"flex justify-between items-center"},Ce={class:"flex items-center gap-3"},$e={class:"page-header-title"},qe={key:0,class:"px-5 py-3 bg-white"},Ie={class:"flex gap-2"},Se={class:"px-5 py-3"},Te={class:"relative"},ke=["placeholder"],Le=["onClick"],De=["onClick"],Ae={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Me={class:"flex items-start gap-3.5 pr-6"},Oe={class:"flex-1 min-w-0"},Fe={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Ne={class:"text-gray-600 text-xs mt-1 truncate"},Be={class:"text-right shrink-0"},Ve={class:"mt-2.5"},Ee={class:"flex items-center gap-2 flex-wrap mt-3"},Re={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change","close"],setup(o,{emit:I}){const F={mounted(s,a){s.clickOutsideEvent=i=>{s===i.target||s.contains(i.target)||a.value()},document.addEventListener("click",s.clickOutsideEvent)},unmounted(s){document.removeEventListener("click",s.clickOutsideEvent)}},c=o,g=x(""),S=q(()=>{let s=c.items;if(c.typeFilter&&c.typeFilter!=="all"&&(s=s.filter(a=>a.type===c.typeFilter)),g.value){const a=g.value.toLowerCase();s=s.filter(i=>{const m=c.getName(i).toLowerCase(),v=c.getVehicleInfo(i).toLowerCase();return m.includes(a)||v.includes(a)})}return s}),D=s=>{const a=s.compositeId||`${s.type||"task"}-${s.id}`||s.id;return c.selectedId===a},C=x(null),y=x(null);return O(()=>c.selectedId,async s=>{s&&y.value&&(await j(),y.value.scrollIntoView({behavior:"smooth",block:"nearest"}))},{immediate:!0}),O(S,async()=>{c.selectedId&&y.value&&(await j(),setTimeout(()=>{y.value&&y.value.scrollIntoView({behavior:"smooth",block:"nearest"})},100))},{immediate:!0}),(s,a)=>(d(),u("div",he,[r("div",xe,[r("div",we,[r("div",Ce,[o.showMobileClose?(d(),u("button",{key:0,onClick:a[0]||(a[0]=i=>s.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...a[5]||(a[5]=[r("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):f("",!0),r("h2",$e,w(o.title),1)]),a[6]||(a[6]=r("div",{class:"flex items-center gap-2"},[r("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[L(" Urgent first "),r("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))])]),o.showTypeFilter?(d(),u("div",qe,[r("div",Ie,[r("button",{onClick:a[1]||(a[1]=i=>s.$emit("filter-change","all")),class:h(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),r("button",{onClick:a[2]||(a[2]=i=>s.$emit("filter-change","lead")),class:h(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),r("button",{onClick:a[3]||(a[3]=i=>s.$emit("filter-change","opportunity")),class:h(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):f("",!0),r("div",Se,[r("div",Te,[a[7]||(a[7]=r("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),z(r("input",{"onUpdate:modelValue":a[4]||(a[4]=i=>g.value=i),type:"text",placeholder:o.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,ke),[[ie,g.value]])])]),r("div",{ref_key:"scrollContainer",ref:C,class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},[(d(!0),u(U,null,ae(S.value,i=>(d(),u("div",{key:i.id,ref_for:!0,ref:m=>{D(i)&&(y.value=m)},onClick:m=>s.$emit("select",i.compositeId||`${i.type||"task"}-${i.id}`||i.id),class:h(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",D(i)?typeof o.selectedClass=="function"?o.selectedClass(i):o.selectedClass:typeof o.unselectedClass=="function"?o.unselectedClass(i):o.unselectedClass])},[o.showMenu?(d(),u("button",{key:0,onClick:M(m=>s.$emit("menu-click",i.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...a[8]||(a[8]=[r("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,De)):f("",!0),o.openMenuId===i.id&&o.showMenu?z((d(),u("div",Ae,[T(s.$slots,"menu",{item:i})])),[[F,()=>s.$emit("menu-close")]]):f("",!0),r("div",Me,[r("div",{class:h(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",o.avatarClass(i)])},w(o.getInitials(i)),3),r("div",Oe,[r("div",Fe,w(o.getName(i)),1),r("div",Ne,w(o.getVehicleInfo(i)),1)]),r("div",Be,[T(s.$slots,"meta",{item:i}),T(s.$slots,"footer",{item:i})])]),r("div",Ve,[T(s.$slots,"dates",{item:i})]),r("div",Ee,[T(s.$slots,"badges",{item:i})])],10,Le))),128))],512)]))}},je={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},ze={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},He={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},Ue={key:0,class:"text-right"},Pe={class:"text-sm font-bold text-gray-900"},We={class:"text-[10px] font-semibold leading-tight"},Qe=["onClick"],Ge=["onClick"],Je=["onClick"],Ke={class:"flex-1 flex flex-col overflow-hidden"},Xe={key:0,class:"lg:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},Ye={key:1,class:"flex-1 flex items-center justify-center"},Ze={key:0,class:"lg:hidden fixed inset-0 z-[60] bg-white"},at={__name:"Tasks",setup(o){const I=de(),F=ce(),c=oe(),g=pe(),S=ne(),D=t=>{if(!t)return"No deadline";const l=A(t);return l.type==="overdue"?"OVERDUE":l.type==="today"||l.type==="urgent"?l.relativeTime:me(t)},C=x("all"),y=x(null),s=x(!1),a=x(!1),i=x(!1),m=x(null),v=q(()=>{const l=c.leads.filter(n=>!n.isDisqualified).map(n=>({...n,type:"lead",compositeId:`lead-${n.id}`})),p=g.opportunities.map(n=>({...n,type:"opportunity",compositeId:`opportunity-${n.id}`}));let e=[];return S.isOperator()?e=l:S.isSalesman()?e=p:e=[...l,...p],e.sort((n,R)=>{const se=new Date(n.lastActivity||n.createdAt||0);return new Date(R.lastActivity||R.createdAt||0)-se})}),P=q(()=>C.value==="all"?v.value:v.value.filter(t=>t.type===C.value)),W=q(()=>{const t=v.value.some(p=>p.type==="lead"),l=v.value.some(p=>p.type==="opportunity");return t&&l}),b=q(()=>{const t=parseInt(I.params.id),l=I.query.type;if(l)return v.value.find(n=>n.id===t&&n.type===l)||null;const e=(C.value!=="all"?v.value.filter(n=>n.type===C.value):v.value).find(n=>n.id===t);return e||v.value.find(n=>n.id===t)||null}),Q=q(()=>b.value?b.value.type==="lead"?c.currentLeadActivities:g.currentOpportunityActivities:[]),N=ye(b),G=N.managementWidget,J=N.storeAdapter,K=N.addNewConfig,X=q(()=>t=>t.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");ue(()=>{c.loadLeads(),g.loadOpportunities();const t=I.params.id;t&&E(t)}),O(()=>I.params.id,t=>{t&&E(t)}),O(b,t=>{t&&(t.type==="lead"?c.loadLeadById(t.id):g.loadOpportunityById(t.id))},{immediate:!0});const E=t=>{const l=parseInt(t),p=v.value.find(e=>e.id===l);p&&(p.type==="lead"?c.loadLeadById(l):g.loadOpportunityById(l))},Y=t=>{const[l,p]=t.split("-");F.push({path:`/tasks/${p}`,query:{type:l}}),s.value=!1},Z=t=>{y.value=y.value===t?null:t},_=t=>{m.value=t,i.value=!0,y.value=null},ee=async t=>{if(!m.value)return;const l=m.value,p=t.name;l.type==="lead"?await c.modifyLead(l.id,{assignee:p,assigneeType:t.type,teamId:t.type==="team"?t.id:null}):l.type==="opportunity"&&await g.updateOpportunity(l.id,{assignee:p,assigneeType:t.type,teamId:t.type==="team"?t.id:null}),i.value=!1,m.value=null},te=async t=>{y.value=null,t.type==="lead"?await c.modifyLead(t.id,{priority:"Hot"}):t.type==="opportunity"&&await g.modifyOpportunity(t.id,{priority:"Hot"})},le=async t=>{y.value=null,t.type==="lead"?await c.modifyLead(t.id,{priority:"Normal"}):t.type==="opportunity"&&await g.modifyOpportunity(t.id,{priority:"Normal"})},re=t=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[t]||"bg-gray-100 text-gray-700 border-gray-200";return(t,l)=>{var p;return d(),u("div",je,[r("div",{class:h(["lg:relative lg:block",s.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[B(Re,{title:"Tasks",items:P.value,"selected-id":(p=b.value)==null?void 0:p.compositeId,"type-filter":C.value,"selected-class":e=>e.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":X.value,"open-menu-id":y.value,getName:e=>e.customer.name,getInitials:e=>e.customer.initials,getVehicleInfo:e=>e.type==="lead"?e.requestedCar?`${e.requestedCar.brand} ${e.requestedCar.model}`:"No vehicle specified":e.vehicle?`${e.vehicle.brand} ${e.vehicle.model}`:"No vehicle specified",avatarClass:e=>e.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:Y,onMenuClick:Z,onMenuClose:l[0]||(l[0]=e=>y.value=null),onClose:l[1]||(l[1]=e=>s.value=!1),"show-type-filter":W.value,onFilterChange:l[2]||(l[2]=e=>C.value=e)},{badges:k(({item:e})=>[r("span",{class:h(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",e.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},w(e.type==="lead"?"Lead":"Opportunity"),3),e.type==="lead"?(d(),u(U,{key:0},[r("span",ze,w(e.status),1),e.priority==="Hot"?(d(),u("span",He,[...l[7]||(l[7]=[r("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),L(" Hot ",-1)])])):f("",!0)],64)):(d(),u("span",{key:1,class:h(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",re(e.stage)])},w(e.stage),3))]),meta:k(({item:e})=>[e.type==="opportunity"?(d(),u("div",Ue,[r("div",Pe,"â‚¬"+w($(ve)(e.value)),1)])):f("",!0)]),dates:k(({item:e})=>[e.type==="lead"&&e.nextActionDue?(d(),u("div",{key:0,class:h(["flex items-center gap-1",$(A)(e.nextActionDue).textClass])},[$(A)(e.nextActionDue).type!=="overdue"?(d(),u("i",{key:0,class:h(["text-[9px]",$(A)(e.nextActionDue).iconClass])},null,2)):f("",!0),r("span",We,w(D(e.nextActionDue)),1)],2)):f("",!0)]),menu:k(({item:e})=>[r("button",{onClick:M(n=>_(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[8]||(l[8]=[r("i",{class:"fa-solid fa-share text-gray-400"},null,-1),L(" Reassign ",-1)])],8,Qe),e.priority!=="Hot"?(d(),u("button",{key:0,onClick:M(n=>te(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[9]||(l[9]=[r("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),L(" Mark as hot ",-1)])],8,Ge)):(d(),u("button",{key:1,onClick:M(n=>le(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[10]||(l[10]=[r("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),L(" Unmark as hot ",-1)])],8,Je))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),r("div",Ke,[b.value?(d(),u("div",Xe,[r("button",{onClick:l[3]||(l[3]=e=>a.value=!a.value),class:"w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-all hover:scale-110",title:"Activity"},[...l[11]||(l[11]=[r("i",{class:"fa-solid fa-clock-rotate-left text-lg"},null,-1)])]),r("button",{onClick:l[4]||(l[4]=e=>s.value=!s.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...l[12]||(l[12]=[r("i",{class:"fa-solid fa-list text-lg"},null,-1)])])])):f("",!0),b.value?(d(),V(ge,{key:2,task:b.value,type:b.value.type,"management-widget":$(G),"store-adapter":$(J),"add-new-config":$(K)},{"pinned-extra":k(({task:e})=>[e.type==="lead"&&e.requestedCar?(d(),V(H,{key:0,brand:e.requestedCar.brand,model:e.requestedCar.model,year:e.requestedCar.year,image:e.requestedCar.image||"",price:e.requestedCar.price||null,"request-message":e.requestedCar.requestMessage||"","request-type":e.requestedCar.requestType||"",source:e.source||"",dealership:e.requestedCar.dealership||"",registration:e.requestedCar.registration||"",kilometers:e.requestedCar.kilometers||null,"fuel-type":e.requestedCar.fuelType||"","gear-type":e.requestedCar.gearType||"",vin:e.requestedCar.vin||"","stock-days":e.requestedCar.stockDays!==void 0?e.requestedCar.stockDays:null,channel:e.requestedCar.channel||"Email","ad-campaign":e.requestedCar.adCampaign||"","expected-purchase-date":e.requestedCar.expectedPurchaseDate||"","fiscal-entity":e.requestedCar.fiscalEntity||"","source-details":e.requestedCar.sourceDetails||"","ad-medium":e.requestedCar.adMedium||"","ad-source":e.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):f("",!0),e.type==="opportunity"&&e.vehicle?(d(),V(H,{key:1,brand:e.vehicle.brand,model:e.vehicle.model,year:e.vehicle.year,image:e.vehicle.image||"",price:e.vehicle.price||null,"request-message":e.vehicle.requestMessage||"","request-type":e.vehicle.requestType||"",source:e.source||"",dealership:e.vehicle.dealership||"",registration:e.vehicle.registration||"",kilometers:e.vehicle.kilometers||null,"fuel-type":e.vehicle.fuelType||"","gear-type":e.vehicle.gearType||"",vin:e.vehicle.vin||"","stock-days":e.vehicle.stockDays!==void 0?e.vehicle.stockDays:null,channel:e.vehicle.channel||"Email","ad-campaign":e.vehicle.adCampaign||"","expected-purchase-date":e.vehicle.expectedPurchaseDate||"","fiscal-entity":e.vehicle.fiscalEntity||"","source-details":e.vehicle.sourceDetails||"","ad-medium":e.vehicle.adMedium||"","ad-source":e.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):f("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(d(),u("div",Ye,[...l[13]||(l[13]=[r("div",{class:"text-center"},[r("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),r("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),a.value&&b.value?(d(),u("div",Ze,[B(fe,{title:"Activity summary",activities:Q.value,collapsed:!1,"show-collapse":!1,show:!0,"mobile-fullscreen":!0,onClose:l[5]||(l[5]=e=>a.value=!1),class:"flex w-full h-full"},null,8,["activities"])])):f("",!0),B(be,{show:i.value,onClose:l[6]||(l[6]=e=>i.value=!1),onConfirm:ee},null,8,["show"])])}}};export{at as default};
