const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsTab-hE-51Pza.js","assets/components-Y9EE84YM.js","assets/index-D8nDSNmq.js","assets/index-B2AXF7q7.css","assets/toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js","assets/UnifiedAddForm-qVlS6TXg.js","assets/contacts-BG9sTx9a.js","assets/opportunities-D1cnNxBd.js","assets/useCustomersTable-CnldMHbY.js","assets/ContactsTab-COhypgFZ.css","assets/OpenLeadsTab-CMj-ePn6.js","assets/opportunityRules-DnV0W7Tj.js","assets/sparkles-BOzuQ2gU.js","assets/vehicles-CxdEy1So.js","assets/opportunityRules-BZLrXNjF.css","assets/OpenLeadsTab-DaqrLcGi.css","assets/OpenOpportunitiesTab-DDO4D3Vp.js","assets/OpenOpportunitiesTab-XTbznLoJ.css","assets/InNegotiationTab-xseWNADs.js","assets/InNegotiationTab-Bzn_mJ50.css","assets/WonTab-D1jv6P9p.js","assets/WonTab-CIb_HGYX.css","assets/LostTab-WVzdcLQg.js","assets/LostTab-BphUbHx9.css"])))=>i.map(i=>d[i]);
import{r as _,l as q,c as x,x as T,o as m,B as i,s as a,y as t,e as d,k as r,t as Q,d as N,u as K,C as ee,m as te,h as ae,F as j,i as F,U as le,V as se,W as D,g as oe,_ as O}from"./index-D8nDSNmq.js";import{_ as ne}from"./PageHeader-DZXsEyk-.js";import{f as ie,F as ue,L as de,g as re,h as me,Q as c,c as y,o as pe,C as ce,n as W,d as ve,a as fe,b as ye,Z as he,z as ge,X as ke}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import{u as we,a as xe,D as be,T as Ve}from"./useTaskFilters-HhfZSEQ8.js";import{_ as _e}from"./CustomerProfile-B3mgOJcm.js";import{u as Ce}from"./opportunities-D1cnNxBd.js";import{u as Te}from"./UnifiedAddForm-qVlS6TXg.js";import"./opportunityRules-DnV0W7Tj.js";import"./sparkles-BOzuQ2gU.js";import"./vehicles-CxdEy1So.js";import"./CreateEventModal-Dcf8GuUu.js";import"./users-CPXYaoWs.js";import"./ReassignUserModal-ChhlJNp9.js";import"./components-Y9EE84YM.js";import"./EditEventModal-DbD5QLnE.js";import"./contacts-BG9sTx9a.js";const Ne={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Ie={key:0,class:"space-y-6"},De={class:"space-y-2"},Oe={class:"space-y-2"},Le={class:"space-y-2"},$e={class:"space-y-2"},Ae={key:1,class:"space-y-6"},Ee={class:"space-y-2"},Se={class:"space-y-2"},Ue={class:"space-y-2"},Re={key:2,class:"space-y-6"},We={class:"space-y-2"},Be={class:"space-y-2"},Pe={class:"space-y-2"},ze={key:3,class:"space-y-6"},Me={class:"space-y-2"},je={class:"space-y-2"},Fe={class:"space-y-2"},qe={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(b,{emit:$}){const p=b,C=$,l=_({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});q(()=>p.show,h=>{h&&(l.value={customerName:p.initialData.customerName||"",email:p.initialData.email||"",phone:p.initialData.phone||"",company:p.initialData.company||"",vehicle:p.initialData.vehicle||"",value:p.initialData.value||"",reason:p.initialData.reason||""})});const A=h=>{h||C("close")},V=x(()=>({contacts:"Add New Contact","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[p.activeTab]||"Add New Item"),B=x(()=>({contacts:"Contact","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[p.activeTab]||"Item"),I=()=>{C("save",{...l.value}),l.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(h,e)=>(m(),T(t(ve),{open:b.show,"onUpdate:open":A},{default:i(()=>[a(t(ie),null,{default:i(()=>[a(t(ue),{class:"fixed inset-0 z-50 bg-black/50"}),a(t(de),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[a(t(re),{class:"flex-shrink-0"},{default:i(()=>[a(t(me),null,{default:i(()=>[r(Q(V.value),1)]),_:1})]),_:1}),d("div",Ne,[b.activeTab==="contacts"?(m(),N("div",Ie,[d("div",De,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[14]||(e[14]=[r("Contact Name",-1)])]),_:1}),a(t(y),{modelValue:l.value.customerName,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.customerName=n),type:"text",placeholder:"Enter contact name...",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Oe,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[15]||(e[15]=[r("Email",-1)])]),_:1}),a(t(y),{modelValue:l.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.email=n),type:"email",placeholder:"contact@example.com",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Le,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[16]||(e[16]=[r("Phone",-1)])]),_:1}),a(t(y),{modelValue:l.value.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.phone=n),type:"tel",placeholder:"+49...",class:"w-full h-10"},null,8,["modelValue"])]),d("div",$e,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[17]||(e[17]=[r("Company (optional)",-1)])]),_:1}),a(t(y),{modelValue:l.value.company,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.company=n),type:"text",placeholder:"Company name...",class:"w-full h-10"},null,8,["modelValue"])])])):b.activeTab==="open-leads"?(m(),N("div",Ae,[d("div",Ee,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[18]||(e[18]=[r("Customer Name",-1)])]),_:1}),a(t(y),{modelValue:l.value.customerName,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Se,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[19]||(e[19]=[r("Email",-1)])]),_:1}),a(t(y),{modelValue:l.value.email,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.email=n),type:"email",placeholder:"customer@example.com",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Ue,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[20]||(e[20]=[r("Requested Vehicle",-1)])]),_:1}),a(t(y),{modelValue:l.value.vehicle,"onUpdate:modelValue":e[6]||(e[6]=n=>l.value.vehicle=n),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"w-full h-10"},null,8,["modelValue"])])])):b.activeTab==="open-opportunities"||b.activeTab==="in-negotiation"?(m(),N("div",Re,[d("div",We,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[21]||(e[21]=[r("Customer Name",-1)])]),_:1}),a(t(y),{modelValue:l.value.customerName,"onUpdate:modelValue":e[7]||(e[7]=n=>l.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Be,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[22]||(e[22]=[r("Vehicle",-1)])]),_:1}),a(t(y),{modelValue:l.value.vehicle,"onUpdate:modelValue":e[8]||(e[8]=n=>l.value.vehicle=n),type:"text",placeholder:"e.g., Porsche Taycan",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Pe,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[23]||(e[23]=[r("Opportunity Value",-1)])]),_:1}),a(t(y),{modelValue:l.value.value,"onUpdate:modelValue":e[9]||(e[9]=n=>l.value.value=n),type:"number",placeholder:"0",class:"w-full h-10"},null,8,["modelValue"])])])):(m(),N("div",ze,[d("div",Me,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[24]||(e[24]=[r("Customer Name",-1)])]),_:1}),a(t(y),{modelValue:l.value.customerName,"onUpdate:modelValue":e[10]||(e[10]=n=>l.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),d("div",je,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[25]||(e[25]=[r("Vehicle",-1)])]),_:1}),a(t(y),{modelValue:l.value.vehicle,"onUpdate:modelValue":e[11]||(e[11]=n=>l.value.vehicle=n),type:"text",placeholder:"Vehicle model",class:"w-full h-10"},null,8,["modelValue"])]),d("div",Fe,[a(t(c),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...e[26]||(e[26]=[r("Reason",-1)])]),_:1}),a(t(pe),{modelValue:l.value.reason,"onUpdate:modelValue":e[12]||(e[12]=n=>l.value.reason=n),rows:"4",placeholder:`Reason for ${b.activeTab==="won"?"win":"loss"}...`,class:"w-full min-h-[100px] resize-none"},null,8,["modelValue","placeholder"])])]))]),a(t(ce),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[a(t(W),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:e[13]||(e[13]=n=>h.$emit("close"))}),a(t(W),{label:`Create ${B.value}`,variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:I},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Qe={class:"page-container relative"},Xe={class:"p-4 md:p-8"},Ze={class:"text-fluid-sm font-medium whitespace-nowrap"},mt={__name:"Customers",setup(b){const $=ae(),p=K(),C=ee(),l=Ce(),A=Te(),V=x(()=>{const u=C.leads.filter(g=>!g.isDisqualified),o=l.opportunities.filter(g=>g.stage!=="Closed Won"&&g.stage!=="Closed Lost"),s=l.opportunities.filter(g=>g.stage==="In Negotiation"||g.stage==="In negotiation"),f=l.opportunities.filter(g=>g.stage==="Closed Won"),w=l.opportunities.filter(g=>g.stage==="Closed Lost");return{contacts:A.totalCustomers,openLeads:u.length,openOpportunities:o.length-s.length,inNegotiation:s.length,won:f.length,lost:w.length}}),I=_("contacts"),h=_(!1),e=_({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),n=_(!1),k=_(null),v=_(null),{allTasks:E}=we(_(!1)),L=x(()=>E.value),X=x(()=>v.value),S=xe(X),P=x(()=>S.managementWidget.value),z=x(()=>S.storeAdapter.value),Z=x(()=>S.addNewConfig.value);q(v,u=>{u&&(u.type==="lead"?C.fetchLeadById(u.id):l.fetchOpportunityById(u.id))},{immediate:!0});const H={contacts:D(()=>O(()=>import("./ContactsTab-hE-51Pza.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),"open-leads":D(()=>O(()=>import("./OpenLeadsTab-CMj-ePn6.js"),__vite__mapDeps([10,1,2,3,4,11,7,12,13,14,8,15]))),"open-opportunities":D(()=>O(()=>import("./OpenOpportunitiesTab-DDO4D3Vp.js"),__vite__mapDeps([16,1,2,3,4,7,11,12,13,14,8,17]))),"in-negotiation":D(()=>O(()=>import("./InNegotiationTab-xseWNADs.js"),__vite__mapDeps([18,1,2,3,4,7,11,12,13,14,8,19]))),won:D(()=>O(()=>import("./WonTab-D1jv6P9p.js"),__vite__mapDeps([20,1,2,3,4,7,11,12,13,14,8,21]))),lost:D(()=>O(()=>import("./LostTab-WVzdcLQg.js"),__vite__mapDeps([22,1,2,3,4,7,11,12,13,14,8,23])))},M=x(()=>{const u=[{key:"contacts",label:"Customers",count:V.value.contacts},{key:"open-leads",label:"Open leads",count:V.value.openLeads},{key:"open-opportunities",label:"Open opportunities",count:V.value.openOpportunities},{key:"in-negotiation",label:"In negotiation",count:V.value.inNegotiation},{key:"won",label:"Won",count:V.value.won},{key:"lost",label:"Lost",count:V.value.lost}];return p.isOperator()?u.filter(o=>o.key==="contacts"||o.key==="open-leads"):p.isSalesman()?u.filter(o=>o.key!=="open-leads"):u}),J=()=>{e.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},h.value=!1},Y=(u,o)=>{if(!o||!u)return"gray";const f={contacts:"gray","open-leads":"blue","open-opportunities":"blue","in-negotiation":"blue",won:"green",lost:"red"}[u]||"gray";return["blue","green","red","gray"].includes(f)?f:"gray"},U=u=>{if(u.id.startsWith("customer-")){const o=u.customerId||parseInt(u.id.replace("customer-",""));k.value={type:"customer",id:o},v.value=null,n.value=!0}else if(u.id.startsWith("lead-")){const o=u.id.match(/-(\d+)$/),s=parseInt(o?o[1]:u.id.replace("lead-","")),f=E.value.find(w=>w.type==="lead"&&w.id===s);f&&(v.value=f,k.value={type:"task",id:s},n.value=!0,C.fetchLeadById(s))}else if(u.id.startsWith("opp-")){const o=u.id.match(/-(\d+)$/),s=parseInt(o?o[1]:u.id.replace("opp-","")),f=E.value.find(w=>w.type==="opportunity"&&w.id===s);f&&(v.value=f,k.value={type:"task",id:s},n.value=!0,l.fetchOpportunityById(s))}},R=()=>{n.value=!1,k.value=null,v.value=null},G=u=>{if(!v.value)return;const o=L.value.findIndex(s=>{const f=v.value.compositeId||`${v.value.type}-${v.value.id}`;return(s.compositeId||`${s.type}-${s.id}`)===f});if(o!==-1){if(u==="previous"&&o>0){const s=L.value[o-1];U({id:`${s.type}-${s.id}`})}else if(u==="next"&&o<L.value.length-1){const s=L.value[o+1];U({id:`${s.type}-${s.id}`})}}};return te(async()=>{await C.fetchLeads(),await l.fetchOpportunities()}),(u,o)=>(m(),N("div",Qe,[a(ne,{title:"Customers"},{actions:i(()=>[a(t(W),{onClick:o[0]||(o[0]=s=>t($).push("/add-new")),variant:"secondary",size:"md",class:"flex items-center gap-2"},{default:i(()=>[...o[3]||(o[3]=[d("i",{class:"fa-solid fa-plus text-sm"},null,-1),d("span",{class:"hidden sm:inline"},"Add new",-1)])]),_:1})]),_:1}),d("div",Xe,[a(t(fe),{modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=s=>I.value=s)},{default:i(()=>[a(t(ye),{class:"w-full justify-start border-b border-border bg-transparent mb-6 overflow-x-auto"},{default:i(()=>[(m(!0),N(j,null,F(M.value,s=>(m(),T(t(he),{key:s.key,value:s.key,class:"flex items-center gap-2 data-[state=active]:border-b-2 data-[state=active]:border-brand-dark data-[state=active]:text-brand-darkDarker rounded-none pb-3 px-4 shrink-0"},{default:i(()=>[d("span",Ze,Q(s.label),1),a(t(ge),{text:String(s.count),size:"small",theme:Y(s.key,I.value===s.key)},null,8,["text","theme"])]),_:2},1032,["value"]))),128))]),_:1}),(m(!0),N(j,null,F(M.value,s=>(m(),T(t(ke),{key:`content-${s.key}`,value:s.key},{default:i(()=>[(m(),T(le,null,{fallback:i(()=>[...o[4]||(o[4]=[d("div",{class:"flex items-center justify-center py-12"},[d("div",{class:"text-center"},[d("i",{class:"fa-solid fa-spinner fa-spin text-gray-400 text-2xl mb-2"}),d("p",{class:"text-meta"},"Loading...")])],-1)])]),default:i(()=>[(m(),T(se(H[s.key]),{onRowClick:U},null,32))]),_:2},1024))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),a(be,{show:n.value,onClose:R},{default:i(()=>[k.value&&k.value.type==="customer"?(m(),T(_e,{key:0,"customer-id":k.value.id,"customer-type":"contact","show-close-button":!0,"close-on-convert":!0,onClose:R},null,8,["customer-id"])):k.value&&k.value.type==="task"&&v.value&&P.value&&z.value?(m(),T(Ve,{key:1,task:v.value,"management-widget":P.value,"store-adapter":z.value,"add-new-config":Z.value,"filtered-tasks":L.value,"is-drawer-view":!0,onTaskNavigate:G,onClose:R},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):oe("",!0)]),_:1},8,["show"]),a(qe,{show:h.value,"active-tab":I.value,"initial-data":e.value,onClose:o[2]||(o[2]=s=>h.value=!1),onSave:J},null,8,["show","active-tab","initial-data"])]))}};export{mt as default};
