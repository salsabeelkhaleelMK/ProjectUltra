import{y as B}from"./components-Ci9ddle2.js";import{u as T}from"./opportunities-CySWWyzd.js";import{g as I,c as M,f as W}from"./ComingSoonModal-ClD5EuQ6.js";import{u as $}from"./useCustomersTable-CD9F3w9b.js";import{r as a,c as q,m as R,d as V,o as z,s as E,B as G,e as i,y as n}from"./index-Db_3peLd.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import"./sparkles-CCfcFWX8.js";import"./vehicles-ygxbygEI.js";const K={class:"table-wrapper w-full"},Z={__name:"WonTab",emits:["row-click"],setup(L,{emit:A}){const o=T(),r=a({pageIndex:0,pageSize:10}),l=a(""),u=a([]),c=a([]),m=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",d=q(()=>o.opportunities.filter(e=>e.stage==="Closed Won").map(e=>{var s,f,p,y,v,b,D,k,x,w,C,F;const t=((s=e.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${e.id}`,stageKey:"won",customer:((f=e.customer)==null?void 0:f.name)||"Unknown",email:((p=e.customer)==null?void 0:p.email)||"",initials:((y=e.customer)==null?void 0:y.initials)||((b=(v=e.customer)==null?void 0:v.name)==null?void 0:b.slice(0,2).toUpperCase())||"?",nextAction:W(e.expectedCloseDate)||"No due date",nextActionFull:M(e.expectedCloseDate),deadlineStatus:I(e.expectedCloseDate),car:`${((D=e.vehicle)==null?void 0:D.brand)||""} ${((k=e.vehicle)==null?void 0:k.model)||""}`.trim()||"N/A",carStatus:((x=e.vehicle)==null?void 0:x.stockDays)!==void 0&&((w=e.vehicle)==null?void 0:w.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((C=e.vehicle)==null?void 0:C.stockDays)!==void 0&&((F=e.vehicle)==null?void 0:F.stockDays)!==null?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body",requestType:e.requestType||"Opportunity",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:m(e.createdAt),lastAppointment:t?m(t):"N/A",status:e.stage,statusClass:"bg-green-100 text-green-700",priority:e.priority||"Normal"}})),S=A,g=e=>{e.id.startsWith("opp-")&&S("row-click",e)},O=a("won"),{columns:N,filterDefinitions:U,tableMeta:h}=$(O,g);return R(async()=>{await o.fetchOpportunities()}),(e,t)=>(z(),V("div",K,[E(n(B),{data:d.value,columns:n(N),meta:n(h),onRowClick:g,columnFiltersOptions:{filterDefs:n(U)},pagination:r.value,"onUpdate:pagination":t[0]||(t[0]=s=>r.value=s),globalFilter:l.value,"onUpdate:globalFilter":t[1]||(t[1]=s=>l.value=s),sorting:u.value,"onUpdate:sorting":t[2]||(t[2]=s=>u.value=s),columnFilters:c.value,"onUpdate:columnFilters":t[3]||(t[3]=s=>c.value=s),paginationOptions:{rowCount:d.value.length},globalFilterOptions:{debounce:300}},{"empty-state":G(()=>[...t[4]||(t[4]=[i("div",{class:"empty-state"},[i("i",{class:"fa-solid fa-inbox empty-state-icon"}),i("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{Z as default};
