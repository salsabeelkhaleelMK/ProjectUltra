import{r as S,e as a,o,h as e,g as y,n as j,t as m,J as Ue,z as I,w as ie,j as V,F as Q,i as H,c as T,l as z,C as ne,B as U,k as he,I as we,M as ft,d as Ze,p as W,H as Z,m as B,N as gt,O as vt,P as Ve,u as Fe,y as bt,A as Xe,D as st,G as at,Q as xe,R as xt}from"./index-Be589Dcd.js";import{_ as ht,u as it}from"./ReassignUserModal-CCRTMl9B.js";import{u as rt}from"./opportunities-BEKDyPzK.js";import{f as Oe,c as Le,g as wt,a as kt,d as $t}from"./formatters-Br5TsDxy.js";import{_ as De}from"./ModalShell-BDXG1RnS.js";const Ct={class:"w-full"},St={class:"flex items-center justify-between gap-3 md:gap-4"},Dt={class:"flex items-center gap-3 md:gap-4 flex-1"},At={class:"min-w-0 flex-1"},Tt={class:"flex items-center gap-2"},Ot={class:"heading-main truncate"},Vt={class:"flex flex-wrap items-center gap-2 mt-1"},It={class:"flex items-center gap-1 ml-2"},Nt={class:"relative"},Rt={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-50 overflow-hidden flex flex-col p-1"},jt={key:0,class:"border-t border-gray-100 my-1"},qt={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},Mt={class:"flex items-center gap-4"},Ut={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},Lt={class:"flex items-center gap-2"},Ft={class:"text-xs text-gray-900 font-medium"},Et={class:"flex items-center gap-2"},Bt={class:"text-xs text-gray-900 font-medium"},Wt={class:"flex items-center gap-2"},Pt={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},zt={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},Qt={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},Yt={class:"text-xs text-gray-900 font-medium"},Ht={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},Kt={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action"],setup(t,{emit:k}){const s={mounted(d,i){d.clickOutsideEvent=v=>{d===v.target||d.contains(v.target)||i.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},f=k,l=S(!1),n=S(!1),g=S(null),u=d=>{n.value=!1,f("action",d)},c=async(d,i)=>{try{await navigator.clipboard.writeText(d),g.value=i,setTimeout(()=>{g.value=null},1500)}catch(v){console.error("Failed to copy:",v)}};return(d,i)=>(o(),a("div",Ct,[e("div",St,[e("div",Dt,[e("div",{class:j(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},m(t.initials),3),e("div",At,[e("div",Tt,[e("h1",Ot,m(t.name),1),Ue(d.$slots,"name-action")]),e("div",Vt,[Ue(d.$slots,"tags")])])]),e("div",It,[e("div",Nt,[e("button",{onClick:i[0]||(i[0]=ie(v=>n.value=!n.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors"},[...i[14]||(i[14]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),n.value?I((o(),a("div",Rt,[e("button",{onClick:i[1]||(i[1]=v=>u("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note "),e("button",{onClick:i[2]||(i[2]=v=>u("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing "),e("button",{onClick:i[3]||(i[3]=v=>u("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in "),e("button",{onClick:i[4]||(i[4]=v=>u("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase "),e("button",{onClick:i[5]||(i[5]=v=>u("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment "),i[19]||(i[19]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),e("button",{onClick:i[6]||(i[6]=v=>u("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...i[15]||(i[15]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),V(" WhatsApp msg ",-1)])]),e("button",{onClick:i[7]||(i[7]=v=>u("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...i[16]||(i[16]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),V(" Email ",-1)])]),e("button",{onClick:i[8]||(i[8]=v=>u("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...i[17]||(i[17]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),V(" SMS ",-1)])]),e("button",{onClick:i[9]||(i[9]=v=>u("call")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...i[18]||(i[18]=[e("i",{class:"fa-solid fa-phone text-xs text-gray-400"},null,-1),V(" Call ",-1)])]),t.taskType==="opportunity"?(o(),a("div",jt)):y("",!0),t.taskType==="opportunity"?(o(),a("button",{key:1,onClick:i[10]||(i[10]=v=>u("appointment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Appointment ")):y("",!0)])),[[s,()=>n.value=!1]]):y("",!0)]),e("button",{onClick:i[11]||(i[11]=v=>l.value=!l.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:j(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])]),l.value?(o(),a("div",qt,[e("div",Mt,[e("div",Ut,[e("div",Lt,[i[21]||(i[21]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",Ft,m(t.email),1),e("button",{onClick:i[12]||(i[12]=ie(v=>c(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...i[20]||(i[20]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",Et,[i[23]||(i[23]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",Bt,m(t.phone),1),e("button",{onClick:i[13]||(i[13]=ie(v=>c(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...i[22]||(i[22]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",Wt,[e("div",Pt,[t.thirdFieldLabel.toLowerCase().includes("address")?(o(),a("i",zt)):(o(),a("i",Qt))]),e("span",Yt,m(t.thirdFieldValue),1)])])]),g.value?(o(),a("div",Ht,m(g.value==="email"?"Email":"Phone")+" copied! ",1)):y("",!0)])):y("",!0)]))}},Gt={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},Jt=["onClick"],Xt={class:"hidden md:inline whitespace-nowrap"},Zt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const k={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},s=f=>k[f]||"fa-solid fa-circle";return(f,l)=>(o(),a("div",Gt,[(o(!0),a(Q,null,H(t.tabs,n=>(o(),a("div",{key:n.key,onClick:g=>f.$emit("update:modelValue",n.key),class:j(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===n.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[e("i",{class:j([s(n.key),"text-base md:text-base"])},null,2),e("span",Xt,m(n.label),1),n.count!==void 0?(o(),a("span",{key:0,class:j(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===n.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},m(n.count),3)):y("",!0)],10,Jt))),128))]))}},_t={class:"metadata-bar w-full"},es={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ts={class:"text-[10px] md:text-xs font-bold text-gray-800"},ss={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},os={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ls={class:"text-[10px] md:text-xs font-bold text-gray-800"},ns={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""}},emits:["reassign"],setup(t){return(k,s)=>(o(),a("div",_t,[e("div",es,[s[1]||(s[1]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Stage",-1)),e("span",ts,m(t.stage),1)]),s[5]||(s[5]=e("div",{class:"metadata-divider"},null,-1)),e("div",ss,[s[2]||(s[2]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Owner",-1)),e("button",{onClick:s[0]||(s[0]=f=>k.$emit("reassign")),class:"text-[10px] md:text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},m(t.owner),1)]),t.source?(o(),a(Q,{key:0},[s[4]||(s[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",os,[s[3]||(s[3]=e("span",{class:"label-upper text-[9px] md:text-xs"},"Source",-1)),e("span",ls,m(t.source),1)])],64)):y("",!0)]))}},as={key:0,class:"flex-grow border-t border-gray-200"},is={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},rs={key:0,class:"border-t border-gray-100 my-1"},ds={key:1,class:"flex-grow border-t border-gray-200"},us={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:k}){const s={mounted($,p){$.clickOutsideEvent=w=>{$===w.target||$.contains(w.target)||p.value()},document.addEventListener("click",$.clickOutsideEvent)},unmounted($){document.removeEventListener("click",$.clickOutsideEvent)}},f=t,l=k,n=S(!1),g=T(()=>f.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium w-9 h-9 rounded-lg shadow-sm transition-all flex items-center justify-center z-20 relative":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium w-9 h-9 rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative"),u={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},c=T(()=>{if(!f.activeTab||f.activeTab==="overview")return f.actions.filter(p=>!u[p]);const $=Object.entries(u).filter(([,p])=>p===f.activeTab).map(([p])=>p);return f.actions.filter(p=>$.includes(p))}),d=T(()=>c.value.some($=>["email","whatsapp","sms"].includes($))),i=T(()=>c.value.some($=>["addVehicle","configureVehicle"].includes($))),v=T(()=>c.value.some($=>["note","financing","tradein","attachment","requestedCar","purchase"].includes($))),h=$=>{n.value=!1,l("action",$)};return($,p)=>t.show?(o(),a("div",{key:0,class:j(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?y("",!0):(o(),a("div",as)),e("div",{class:j(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:p[0]||(p[0]=ie(w=>n.value=!n.value,["stop"])),class:j(g.value)},[...p[12]||(p[12]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1)])],2),n.value?I((o(),a("div",is,[i.value?(o(),a(Q,{key:0},[c.value.includes("addVehicle")?(o(),a("button",{key:0,onClick:p[1]||(p[1]=w=>h("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):y("",!0),c.value.includes("configureVehicle")?(o(),a("button",{key:1,onClick:p[2]||(p[2]=w=>h("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):y("",!0)],64)):y("",!0),v.value?(o(),a(Q,{key:1},[i.value?(o(),a("div",rs)):y("",!0),c.value.includes("note")?(o(),a("button",{key:1,onClick:p[3]||(p[3]=w=>h("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):y("",!0),c.value.includes("financing")?(o(),a("button",{key:2,onClick:p[4]||(p[4]=w=>h("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):y("",!0),c.value.includes("tradein")?(o(),a("button",{key:3,onClick:p[5]||(p[5]=w=>h("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):y("",!0),c.value.includes("requestedCar")?(o(),a("button",{key:4,onClick:p[6]||(p[6]=w=>h("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):y("",!0),c.value.includes("purchase")?(o(),a("button",{key:5,onClick:p[7]||(p[7]=w=>h("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):y("",!0),c.value.includes("attachment")?(o(),a("button",{key:6,onClick:p[8]||(p[8]=w=>h("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):y("",!0)],64)):y("",!0),d.value?(o(),a(Q,{key:2},[p[16]||(p[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),c.value.includes("email")?(o(),a("button",{key:0,onClick:p[9]||(p[9]=w=>h("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[13]||(p[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),V(" Send Email ",-1)])])):y("",!0),c.value.includes("whatsapp")?(o(),a("button",{key:1,onClick:p[10]||(p[10]=w=>h("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[14]||(p[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),V(" Send WhatsApp ",-1)])])):y("",!0),c.value.includes("sms")?(o(),a("button",{key:2,onClick:p[11]||(p[11]=w=>h("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...p[15]||(p[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),V(" Send SMS ",-1)])])):y("",!0)],64)):y("",!0)])),[[s,()=>n.value=!1]]):y("",!0)],2),t.inline?y("",!0):(o(),a("div",ds))],2)):y("",!0)}},cs={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},ms={class:"flex items-start gap-3"},ps={class:"flex-1 min-w-0"},ys={class:"font-bold text-sm text-slate-800 mb-2"},fs={class:"space-y-1.5 text-xs text-gray-600"},gs={class:"flex items-center gap-2"},vs={class:"flex items-center gap-2"},bs={class:"flex items-center gap-2"},xs={key:0,class:"mt-2"},hs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const k=t,s=T(()=>k.appointmentData.date?new Date(k.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),f=T(()=>k.appointmentData.time?k.appointmentData.time:""),l=n=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[n==null?void 0:n.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(n,g)=>(o(),a("div",cs,[e("div",ms,[g[3]||(g[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",ps,[e("h4",ys,m(t.appointmentData.type),1),e("div",fs,[e("div",gs,[g[0]||(g[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,m(s.value),1)]),e("div",vs,[g[1]||(g[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,m(f.value),1)]),e("div",bs,[g[2]||(g[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,m(t.appointmentData.assignee),1)])]),t.appointmentData.status?(o(),a("div",xs,[e("span",{class:j(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",l(t.appointmentData.status)])},m(t.appointmentData.status),3)])):y("",!0)])])]))}},ws={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},ks={class:"flex-1"},$s={class:"flex items-center gap-2 mb-1"},Cs={class:"text-xs font-bold text-slate-800"},Ss={class:"text-[10px] text-gray-400"},Ds={class:"text-[10px] text-gray-400"},As={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},Ts={class:"ml-auto relative"},Os={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},Vs={key:0,class:"text-sm text-slate-700"},Is={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},Ns={key:2,class:"mt-2"},Rs={key:0},js={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},qs={key:0},Ms={class:"text-sm font-bold text-slate-800"},Us={key:0,class:"text-xs text-gray-600 mt-0.5"},Ls={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},Fs={key:0},Es={key:1},Bs={key:2},Ws={key:3},Ps={key:4},zs={key:1},Qs={class:"text-sm font-bold text-slate-800 mb-2"},Ys={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},Hs={key:0},Ks={class:"text-slate-700 font-medium ml-1"},Gs={key:1},Js={class:"text-slate-700 font-medium ml-1"},Xs={key:2},Zs={class:"text-slate-700 font-medium ml-1"},_s={key:3},eo={class:"text-slate-700 font-medium ml-1"},to={key:4},so={class:"text-slate-700 font-medium ml-1"},oo={key:5},lo={class:"text-slate-700 font-medium ml-1"},no={key:2,class:"flex items-center gap-3"},ao={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},io=["src"],ro={class:"flex-1"},uo={class:"text-sm font-bold text-slate-800"},co={class:"text-xs text-gray-500"},mo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},po={key:3,class:"flex items-center gap-3"},yo={class:"flex-1"},fo={class:"text-sm font-bold text-slate-800"},go={class:"text-xs text-gray-500"},vo={key:0,class:"text-xs text-gray-400 mt-1"},bo={key:1,class:"text-xs text-gray-600 mt-1"},ot={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:k}){const s=t,f=k,l=S(!1),n={mounted($,p){$.clickOutsideEvent=w=>{$===w.target||$.contains(w.target)||p.value()},setTimeout(()=>{document.addEventListener("click",$.clickOutsideEvent)},0)},unmounted($){document.removeEventListener("click",$.clickOutsideEvent)}},g=$=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[$]||"fa-solid fa-circle",u=$=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[$]||"bg-gray-100 text-gray-600 border-gray-200",c=$=>{if(!$)return"Just now";const p=new Date($),q=new Date-p,N=Math.floor(q/6e4),x=Math.floor(N/60),A=Math.floor(x/24);return N<1?"Just now":N<60?`${N} minutes ago`:x<24?`${x} hours ago`:A===1?"Yesterday":A<7?`${A} days ago`:p.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=$=>$?new Intl.NumberFormat("en-US").format($):"0",i=$=>$?new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",v=()=>{l.value=!1,f("edit",s.item)},h=()=>{l.value=!1,confirm("Are you sure you want to delete this item?")&&f("delete",s.item)};return($,p)=>(o(),a("div",ws,[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",u(t.item.type)])},[e("i",{class:j([g(t.item.type),"text-sm"])},null,2)],2),e("div",ks,[e("div",$s,[e("span",Cs,m(t.customerInitials),1),e("span",Ss,m(t.item.action||"added"),1),e("span",Ds,"• "+m(c(t.item.timestamp)),1),t.item.autoDetected?(o(),a("span",As,"Auto-detected")):y("",!0),e("div",Ts,[e("button",{onClick:p[0]||(p[0]=ie(w=>l.value=!l.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...p[1]||(p[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),l.value?I((o(),a("div",Os,[e("button",{onClick:v,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),V(" Edit ",-1)])]),e("button",{onClick:h,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...p[3]||(p[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),V(" Delete ",-1)])])])),[[n,()=>l.value=!1]]):y("",!0)])]),t.item.content?(o(),a("div",Vs,m(t.item.content),1)):y("",!0),t.item.fileName?(o(),a("div",Is,[p[4]||(p[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,m(t.item.fileName),1)])):y("",!0),t.item.data?(o(),a("div",Ns,[t.item.type==="appointment"?(o(),a("div",Rs,[z(hs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(o(),a("div",js,[t.item.type==="tradein"?(o(),a("div",qs,[e("h4",Ms,m(t.item.data.brand)+" "+m(t.item.data.model),1),t.item.data.version?(o(),a("p",Us,m(t.item.data.version),1)):y("",!0),e("div",Ls,[t.item.data.year?(o(),a("div",Fs,[p[5]||(p[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),V(m(t.item.data.year),1)])):y("",!0),t.item.data.km?(o(),a("div",Es,[p[6]||(p[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),V(m(t.item.data.km)+" km ",1)])):y("",!0),t.item.data.plate?(o(),a("div",Bs,[p[7]||(p[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),V(m(t.item.data.plate),1)])):y("",!0),t.item.data.date?(o(),a("div",Ws,[p[8]||(p[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),V(m(i(t.item.data.date)),1)])):y("",!0),t.item.data.class?(o(),a("div",Ps,[p[9]||(p[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),V(m(t.item.data.class),1)])):y("",!0)])])):t.item.type==="financing"?(o(),a("div",zs,[e("h4",Qs,m(t.item.data.product),1),e("div",Ys,[t.item.data.provider?(o(),a("div",Hs,[p[10]||(p[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Ks,m(t.item.data.provider),1)])):y("",!0),t.item.data.total?(o(),a("div",Gs,[p[11]||(p[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Js,"€"+m(d(t.item.data.total)),1)])):y("",!0),t.item.data.monthly?(o(),a("div",Xs,[p[12]||(p[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Zs,"€"+m(d(t.item.data.monthly)),1)])):y("",!0),t.item.data.deposit?(o(),a("div",_s,[p[13]||(p[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",eo,"€"+m(d(t.item.data.deposit)),1)])):y("",!0),t.item.data.startDate?(o(),a("div",to,[p[14]||(p[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",so,m(i(t.item.data.startDate)),1)])):y("",!0),t.item.data.expDate?(o(),a("div",oo,[p[15]||(p[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",lo,m(i(t.item.data.expDate)),1)])):y("",!0)])])):t.item.type==="offer"?(o(),a("div",no,[t.item.data.image?(o(),a("div",ao,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,io)])):y("",!0),e("div",ro,[e("h4",uo,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",co,"€ "+m(d(t.item.data.price)),1)]),t.item.data.isMainOffer?(o(),a("span",mo,"Main Offer")):y("",!0)])):t.item.type==="purchase"?(o(),a("div",po,[e("div",yo,[e("h4",fo,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",go,"€ "+m(d(t.item.data.price)),1),t.item.data.purchaseDate?(o(),a("p",vo,"Purchased: "+m(i(t.item.data.purchaseDate)),1)):y("",!0),t.item.data.notes?(o(),a("p",bo,m(t.item.data.notes),1)):y("",!0)])])):y("",!0)]))])):y("",!0)])]))}},xo={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},ho={class:"flex items-center gap-3"},wo=["title"],ko={key:0,class:"fa-solid fa-arrow-left text-sm"},$o={key:1,class:"fa-solid fa-arrow-right text-sm"},Co={key:2,class:"font-bold text-lg text-gray-800"},So={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Do={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Ao={key:1,class:"text-center py-8 text-gray-400 relative z-10"},To={class:"text-sm"},Oo={key:2,class:"space-y-6 relative z-10"},Vo={key:0,class:"mb-4 pl-12"},Io={class:"text-sm font-semibold text-gray-800"},No={class:"flex gap-4 relative mb-6"},Ro={class:"flex-1 min-w-0"},jo={class:"text-sm text-slate-700 leading-snug"},qo={class:"font-bold"},Mo={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},Uo={class:"text-xs text-gray-400 mt-1"},Lo={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},Fo={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 z-0"},Eo={key:1,class:"space-y-4 relative z-10"},Bo=["title"],Wo={key:2,class:"text-center py-8 text-gray-400 relative z-10"},Po={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:k}){const s=t,f=c=>{const d={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return d[c]||d.default},l=c=>{const d={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return d[c]||d.default},n=c=>{if(!c)return"";const d=new Date(c),i=new Date,v=new Date(i);return v.setDate(v.getDate()-1),d.toDateString()===i.toDateString()?"Today":d.toDateString()===v.toDateString()?"Yesterday":d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},g=c=>c?new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",u=(c,d)=>{if(c===0)return!0;const i=s.activities[c-1];if(!i)return!0;const v=new Date(d.timestamp).toDateString(),h=new Date(i.timestamp).toDateString();return v!==h};return(c,d)=>t.show?(o(),a("div",{key:0,class:j(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",xo,[e("div",ho,[t.mobileFullscreen?(o(),a("button",{key:0,onClick:d[0]||(d[0]=i=>c.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(o(),a("button",{key:1,onClick:d[1]||(d[1]=i=>c.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(o(),a("i",ko)):(o(),a("i",$o))],8,wo)):y("",!0),t.collapsed?y("",!0):(o(),a("h2",Co,m(t.title),1))])]),t.collapsed?(o(),a("div",Lo,[t.activities.length>0?(o(),a("div",Fo)):y("",!0),t.activities.length>0?(o(),a("div",Eo,[(o(!0),a(Q,null,H(t.activities,i=>(o(),a("div",{key:i.id,class:"relative"},[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white border-2 border-gray-200",l(i.type)]),title:`${i.user} ${i.action}`},[e("i",{class:j([f(i.type),"text-xs"])},null,2)],10,Bo)]))),128))])):(o(),a("div",Wo,[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(o(),a("div",So,[t.activities.length>0?(o(),a("div",Do)):y("",!0),t.activities.length===0?(o(),a("div",Ao,[d[3]||(d[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",To,m(t.emptyMessage),1)])):(o(),a("div",Oo,[(o(!0),a(Q,null,H(t.activities,(i,v)=>(o(),a(Q,{key:i.id},[u(v,i)?(o(),a("div",Vo,[e("h3",Io,m(n(i.timestamp)),1)])):y("",!0),e("div",No,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",l(i.type)])},[e("i",{class:j([f(i.type),"text-sm"])},null,2)],2),e("div",Ro,[e("div",jo,[e("span",qo,m(i.user),1),V(" "+m(i.action),1)]),i.content?(o(),a("div",Mo,m(i.content),1)):y("",!0),e("div",Uo,m(g(i.timestamp)),1)])])],64))),128))]))]))],2)):y("",!0)}},zo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Qo={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Yo={class:"mb-3"},Ho={class:"flex justify-end gap-2"},Ko={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S(""),n=S(""),g=()=>{!l.value.trim()&&!n.value||f("save",{type:"communication",action:`sent via ${s.type}`,content:l.value||`Sent template: ${n.value}`,communicationType:s.type})};return(u,c)=>(o(),a("div",zo,[c[5]||(c[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Qo,m(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Yo,[c[4]||(c[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),I(e("select",{"onUpdate:modelValue":c[0]||(c[0]=d=>n.value=d),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...c[3]||(c[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[ne,n.value]])]),I(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=d=>l.value=d),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[U,l.value]]),e("div",Ho,[e("button",{onClick:c[2]||(c[2]=d=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:g,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},Go={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Jo={class:"flex justify-between items-center mb-4"},Xo={class:"text-sm font-bold text-slate-800"},Zo={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},dt={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S("");he(()=>{s.item&&(l.value=s.item.content||"")});const n=()=>{var g,u;l.value.trim()&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:l.value,timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",Go,[u[5]||(u[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Jo,[e("h5",Xo,m(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:u[0]||(u[0]=c=>g.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[u[4]||(u[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),I(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=c=>l.value=c),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[U,l.value]])]),e("div",Zo,[e("button",{onClick:u[2]||(u[2]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},_o={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},el={class:"flex justify-between items-center mb-4"},tl={class:"text-sm font-bold text-slate-800"},sl={class:"flex items-center gap-3"},ol={key:0,class:"text-sm text-slate-600"},ll={key:1,class:"text-sm text-gray-400"},nl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},al=["disabled"],il={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S(null),n=S("");he(()=>{s.item&&(n.value=s.item.fileName||"")});const g=c=>{const d=c.target.files[0];d&&(l.value=d,n.value=d.name)},u=()=>{var c,d;!l.value&&!s.item||f("save",{id:((c=s.item)==null?void 0:c.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:n.value,timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(c,d)=>(o(),a("div",_o,[d[6]||(d[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",el,[e("h5",tl,m(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:d[0]||(d[0]=i=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[d[5]||(d[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",sl,[e("input",{type:"file",onChange:g,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:d[1]||(d[1]=i=>c.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),V("Choose File ",-1)])]),n.value?(o(),a("span",ol,m(n.value),1)):(o(),a("span",ll,"No file selected"))])]),e("div",nl,[e("button",{onClick:d[2]||(d[2]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:u,disabled:!l.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,al)])]))}},rl={class:"animate-fade-in"},dl={class:"space-y-4"},ul={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},cl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ml={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},pl=["disabled"],yl={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});he(()=>{s.item&&s.item.data&&(l.value={startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",productName:s.item.data.product||s.item.data.productName||"",deposit:s.item.data.deposit||"",loanAmount:s.item.data.total||s.item.data.loanAmount||""})});const n=()=>{var g,u;l.value.productName&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"financing",action:s.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",rl,[e("div",dl,[e("div",ul,[e("div",null,[u[6]||(u[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),I(e("input",{type:"date","onUpdate:modelValue":u[0]||(u[0]=c=>l.value.startDate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.startDate]])]),e("div",null,[u[7]||(u[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),I(e("input",{type:"date","onUpdate:modelValue":u[1]||(u[1]=c=>l.value.expDate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.expDate]])])]),e("div",null,[u[8]||(u[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),I(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=c=>l.value.productName=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.productName]])]),e("div",cl,[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),I(e("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=c=>l.value.deposit=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.deposit]])]),e("div",null,[u[10]||(u[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),I(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>l.value.loanAmount=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.loanAmount]])])])]),e("div",ml,[e("button",{onClick:u[5]||(u[5]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,pl)])]))}},fl={class:"animate-fade-in"},gl={class:"space-y-4"},vl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},hl=["disabled"],wl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});he(()=>{s.item&&s.item.data&&(l.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const n=()=>{var g,u;l.value.brand&&f("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(g,u)=>(o(),a("div",fl,[e("div",gl,[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),I(e("select",{"onUpdate:modelValue":u[0]||(u[0]=c=>l.value.class=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...u[8]||(u[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[ne,l.value.class]])]),e("div",vl,[e("div",null,[u[10]||(u[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),I(e("input",{type:"text","onUpdate:modelValue":u[1]||(u[1]=c=>l.value.brand=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.brand]])]),e("div",null,[u[11]||(u[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),I(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=c=>l.value.model=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.model]])])]),e("div",null,[u[12]||(u[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),I(e("input",{type:"text","onUpdate:modelValue":u[3]||(u[3]=c=>l.value.version=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.version]])]),e("div",bl,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),I(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>l.value.km=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.km]])]),e("div",null,[u[14]||(u[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),I(e("input",{type:"text","onUpdate:modelValue":u[5]||(u[5]=c=>l.value.plate=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.plate]])])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),I(e("input",{type:"date","onUpdate:modelValue":u[6]||(u[6]=c=>l.value.date=c),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[U,l.value.date]])])]),e("div",xl,[e("button",{onClick:u[7]||(u[7]=c=>g.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:n,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,hl)])]))}},kl={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},$l={class:"flex justify-between items-center mb-4"},Cl={class:"text-sm font-bold text-slate-800"},Sl={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Dl={class:"flex items-center gap-3"},Al={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Tl=["src"],Ol={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Vl={class:"font-bold text-sm text-gray-800"},Il={class:"text-xs text-gray-500"},Nl={class:"space-y-4"},Rl={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},jl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ql=["disabled"],ut={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});he(()=>{if(s.selectedVehicle){l.value.price=s.selectedVehicle.price||0,l.value.brand=s.selectedVehicle.brand||"",l.value.model=s.selectedVehicle.model||"",l.value.year=s.selectedVehicle.year||"",l.value.image=s.selectedVehicle.image||"";const c=new Date;c.setDate(c.getDate()+30),l.value.validUntil=c.toISOString().split("T")[0]}s.item&&s.item.data&&(l.value={...l.value,...s.item.data,price:s.item.data.price||s.item.data.total||0,financingType:s.item.data.financingType||s.item.data.paymentMethod||"",notes:s.item.data.notes||s.item.data.description||""})}),we(()=>s.selectedVehicle,c=>{c&&!s.item&&(l.value.price=c.price||0,l.value.brand=c.brand||"",l.value.model=c.model||"",l.value.year=c.year||"",l.value.image=c.image||"")});const n=T(()=>l.value.price>0&&l.value.financingType!==""),g=c=>c?c.toLocaleString("en-US"):"0",u=()=>{var d,i;if(!n.value)return;const c={id:((d=s.item)==null?void 0:d.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"created an offer",data:{brand:l.value.brand,model:l.value.model,year:l.value.year,price:l.value.price,total:l.value.price,paymentMethod:l.value.financingType,financingType:l.value.financingType,downPayment:l.value.downPayment,monthlyPayment:l.value.monthlyPayment,term:l.value.term,interestRate:l.value.interestRate,deliveryDate:l.value.deliveryDate,validUntil:l.value.validUntil,notes:l.value.notes,description:l.value.notes,image:l.value.image},timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item};f("save",c)};return(c,d)=>(o(),a("div",kl,[e("div",$l,[e("h5",Cl,m(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:d[0]||(d[0]=i=>c.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[11]||(d[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.selectedVehicle?(o(),a("div",Sl,[d[12]||(d[12]=e("p",{class:"text-xs text-gray-500 mb-2"},"Creating offer for:",-1)),e("div",Dl,[e("div",Al,[t.selectedVehicle.image?(o(),a("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Tl)):(o(),a("i",Ol))]),e("div",null,[e("h4",Vl,m(t.selectedVehicle.brand)+" "+m(t.selectedVehicle.model)+" ("+m(t.selectedVehicle.year)+") ",1),e("p",Il,"Base Price: € "+m(g(t.selectedVehicle.price)),1)])])])):y("",!0),e("div",Nl,[e("div",null,[d[13]||(d[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[V(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{type:"number","onUpdate:modelValue":d[1]||(d[1]=i=>l.value.price=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"Enter offer price"},null,512),[[U,l.value.price]])]),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},[V(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{"onUpdate:modelValue":d[2]||(d[2]=i=>l.value.financingType=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...d[14]||(d[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[ne,l.value.financingType]])]),l.value.financingType==="finance"||l.value.financingType==="lease"?(o(),a("div",Rl,[e("div",null,[d[16]||(d[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Down Payment (€)",-1)),I(e("input",{type:"number","onUpdate:modelValue":d[3]||(d[3]=i=>l.value.downPayment=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"0"},null,512),[[U,l.value.downPayment]])]),e("div",null,[d[17]||(d[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),I(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=i=>l.value.monthlyPayment=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"Calculated automatically"},null,512),[[U,l.value.monthlyPayment]])]),e("div",null,[d[18]||(d[18]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Term (months)",-1)),I(e("input",{type:"number","onUpdate:modelValue":d[5]||(d[5]=i=>l.value.term=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"36"},null,512),[[U,l.value.term]])]),e("div",null,[d[19]||(d[19]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Interest Rate (%)",-1)),I(e("input",{type:"number",step:"0.1","onUpdate:modelValue":d[6]||(d[6]=i=>l.value.interestRate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500",placeholder:"3.5"},null,512),[[U,l.value.interestRate]])])])):y("",!0),e("div",null,[d[20]||(d[20]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expected Delivery Date",-1)),I(e("input",{type:"date","onUpdate:modelValue":d[7]||(d[7]=i=>l.value.deliveryDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,l.value.deliveryDate]])]),e("div",null,[d[21]||(d[21]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Offer Valid Until",-1)),I(e("input",{type:"date","onUpdate:modelValue":d[8]||(d[8]=i=>l.value.validUntil=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,l.value.validUntil]])]),e("div",null,[d[22]||(d[22]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes / Special Terms",-1)),I(e("textarea",{"onUpdate:modelValue":d[9]||(d[9]=i=>l.value.notes=i),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 resize-none",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[U,l.value.notes]])])]),e("div",jl,[e("button",{onClick:d[10]||(d[10]=i=>c.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:u,disabled:!n.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},m(t.item?"Update Offer":"Create Offer"),9,ql)])]))}},Je={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function lt(t){if(!t)return Je.default;const k=t.toLowerCase().trim();return Je[k]||Je.default}function Ml({store:t,taskId:k,getTabForItemType:s,isOverviewModalAction:f}){const l=S(null),n=S(null),g=S("overview"),u=S("email"),c=S([]);we(g,()=>{l.value=null,n.value=null});const d=T(()=>[...t.currentActivities.value,...c.value.filter(q=>!q.activityId)].filter(q=>{const N=s(q.type);return g.value==="overview"?N==="overview":N===g.value}).sort((q,N)=>{const x=new Date(q.timestamp||0);return new Date(N.timestamp||0)-x})),i=w=>(n.value=null,g.value==="overview"&&f&&f(w)?{type:"overview-modal",action:w}:(["email","sms","whatsapp","call"].includes(w)?(u.value=w,l.value="communication"):l.value=w,null)),v=async w=>{var q;if(w.isEdit){const N=c.value.findIndex(x=>x.id===w.id);N>-1&&(c.value[N]={...c.value[N],...w}),(q=n.value)!=null&&q.activityId&&await t.updateActivity(k.value,n.value.activityId,{type:w.communicationType||w.type,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data})}else{const N=w.communicationType||w.type,x=await t.addActivity(k.value,{type:N,user:"You",action:w.action,content:w.content,fileName:w.fileName,data:w.data});c.value.push({id:x.id,type:N==="email"||N==="whatsapp"||N==="sms"?"communication":N,action:w.action,content:w.content,fileName:w.fileName,data:w.data,timestamp:x.timestamp,activityId:x.id})}l.value=null,n.value=null},h=()=>{l.value=null,n.value=null},$=w=>{s(w.type)&&(l.value=w.type==="email"||w.type==="whatsapp"||w.type==="sms"||w.type==="communication"?"communication":w.type,n.value=w)},p=async w=>{try{await t.deleteActivity(k.value,w)}catch(q){throw console.error("Error deleting item:",q),q}};return{activeTab:g,showInlineWidget:l,inlineWidgetType:T(()=>l.value),editingItem:n,isEditing:T(()=>n.value!==null),communicationType:u,inlineContent:c,filteredInlineContent:d,handleAddNewAction:i,handleWidgetSave:v,handleWidgetCancel:h,handleEditItem:$,handleDeleteItem:p}}const Ul={class:"flex-1 flex flex-col overflow-hidden h-full"},Ll={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Fl={class:"px-4 md:px-8 py-4 md:py-6"},El={class:"flex-1 flex flex-row overflow-hidden"},Bl={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Wl={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Pl={class:"mb-4"},zl={key:0},Ql={key:0,class:"mb-6"},Yl={class:"mb-6"},Hl={class:"space-y-6 mb-6"},Kl={key:1,class:"space-y-4 mb-6 px-1"},Gl={key:1},Jl={key:0,class:"space-y-4 mb-6 px-1"},Xl={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Zl={class:"p-6"},_l={class:"flex justify-between items-center mb-4"},en={class:"text-sm font-bold text-slate-800"},tn={key:1,class:"max-w-2xl w-full max-h-[90vh] overflow-y-auto"},ru={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(t,{emit:k}){const s=t,f=ft(),l=Ze(),n=T(()=>s.task.id),g=T(()=>s.type==="contact"?"bg-blue-100 text-blue-600":s.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),u=S(!0),c=T(()=>f.path.startsWith("/tasks")&&!f.path.startsWith("/customer")),d=()=>{l.push({path:`/customer/${s.task.id}`,query:{type:s.type}})},i=()=>{w.value=!0},v=async L=>{var P,ae,te,se;const F=L.name;s.type==="lead"?await((ae=(P=s.storeAdapter).updateLead)==null?void 0:ae.call(P,s.task.id,{assignee:F,assigneeType:L.type,teamId:L.type==="team"?L.id:null})):s.type==="opportunity"&&await((se=(te=s.storeAdapter).updateOpportunity)==null?void 0:se.call(te,s.task.id,{assignee:F,assigneeType:L.type,teamId:L.type==="team"?L.id:null})),w.value=!1},h=S(!1),$=S(null),p=S(!1),w=S(!1),{activeTab:q,showInlineWidget:N,editingItem:x,communicationType:A,inlineContent:D,filteredInlineContent:R,handleAddNewAction:X,handleWidgetSave:K,handleWidgetCancel:me,handleEditItem:$e,handleDeleteItem:re}=Ml({store:s.storeAdapter,taskId:n,getTabForItemType:lt,isOverviewModalAction:L=>q.value==="overview"&&s.addNewConfig.overviewActions.includes(L)}),pe=L=>{const F=X(L);F&&F.modalAction&&($.value=F.modalAction,h.value=!0)},Ce=L=>{if(L==="appointment"&&s.type==="opportunity"){p.value=!p.value;return}const F={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(L))$.value=L,h.value=!0;else{const P=F[L];P?(q.value=P,setTimeout(()=>{pe(L),setTimeout(()=>{const ae=document.querySelector(".animate-fade-in");ae&&ae.scrollIntoView({behavior:"smooth",block:"start"})},100)},50)):pe(L)}},G=()=>{h.value=!1,$.value=null},de=async L=>{await K(L),G()},Y=T(()=>{const L=[...s.storeAdapter.currentActivities.value,...D.value],F=L.filter(se=>lt(se.type)==="overview").length,P=L.filter(se=>["call","email","sms","whatsapp","communication"].includes(se.type)).length,ae=L.filter(se=>se.type==="note").length,te=L.filter(se=>se.type==="attachment").length;return[{key:"overview",label:"Overview",count:F},{key:"note",label:"Notes",count:ae},{key:"communication",label:"Communication",count:P},{key:"attachment",label:"Attachments",count:te}]}),ue=T(()=>[...s.storeAdapter.currentActivities.value,...D.value]),le=async L=>{if(s.type==="opportunity")try{await s.storeAdapter.addVehicle(s.task.id,L.vehicleData),s.storeAdapter.loadOpportunityById&&await s.storeAdapter.loadOpportunityById(s.task.id)}catch(F){console.error("Error selecting vehicle:",F)}},Ae=async L=>{if(s.type==="opportunity")try{await s.storeAdapter.createOffer(s.task.id,L.offerData),s.storeAdapter.loadOpportunityById&&await s.storeAdapter.loadOpportunityById(s.task.id)}catch(F){console.error("Error creating offer:",F)}};return(L,F)=>(o(),a("div",Ul,[e("header",Ll,[e("div",Fl,[z(Kt,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":g.value,"task-type":t.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Ce},{tags:Z(()=>[(o(!0),a(Q,null,H(t.task.tags,P=>(o(),a("span",{key:P,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},m(P),1))),128))]),"name-action":Z(()=>[c.value?(o(),a("button",{key:0,onClick:d,class:"w-7 h-7 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page"},[...F[6]||(F[6]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),e("div",El,[e("div",Bl,[e("main",Wl,[e("div",Pl,[z(Zt,{modelValue:B(q),"onUpdate:modelValue":F[0]||(F[0]=P=>gt(q)?q.value=P:null),tabs:Y.value,class:"mb-0"},null,8,["modelValue","tabs"])]),B(q)==="overview"?(o(),a("div",zl,[t.type!=="contact"?(o(),a("div",Ql,[z(ns,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||"",onReassign:i},null,8,["stage","owner","source"])])):y("",!0),e("div",Yl,[(o(),W(vt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:ue.value,onCarAdded:F[1]||(F[1]=P=>L.$emit("car-added",P)),onConvertToLead:F[2]||(F[2]=P=>L.$emit("convert-to-lead")),onConvertToOpportunity:F[3]||(F[3]=P=>L.$emit("convert-to-opportunity")),onVehicleSelected:le,onCreateOffer:Ae},null,40,["lead","opportunity","contact","activities"]))]),e("div",Hl,[Ue(L.$slots,"pinned-extra",{task:t.task})]),B(R).length>0?(o(),a("div",Kl,[(o(!0),a(Q,null,H(B(R),P=>(o(),W(ot,{key:P.id,item:P,"task-type":t.type,"customer-initials":"SK",onEdit:B($e),onDelete:B(re)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)])):(o(),a("div",Gl,[z(us,{actions:t.addNewConfig.tabActions,"active-tab":B(q),onAction:pe},null,8,["actions","active-tab"]),e("div",null,[B(N)==="communication"?(o(),W(Ko,{key:0,type:B(A),"task-type":t.type,"task-id":t.task.id,item:B(x),onSave:B(K),onCancel:B(me)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):y("",!0),B(N)==="note"?(o(),W(dt,{key:1,item:B(x),"task-type":t.type,"task-id":t.task.id,onSave:B(K),onCancel:B(me)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0),B(N)==="attachment"?(o(),W(il,{key:2,item:B(x),"task-type":t.type,"task-id":t.task.id,onSave:B(K),onCancel:B(me)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0)]),B(R).length>0?(o(),a("div",Jl,[(o(!0),a(Q,null,H(B(R),P=>(o(),W(ot,{key:P.id,item:P,"task-type":t.type,"customer-initials":"SK",onEdit:B($e),onDelete:B(re)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)]))])]),z(Po,{title:"Activity summary",activities:ue.value,collapsed:u.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:F[4]||(F[4]=P=>u.value=!u.value)},null,8,["activities","collapsed"])]),(o(),W(Ve,{to:"body"},[h.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:ie(G,["self"])},[$.value==="financing"||$.value==="tradein"?(o(),a("div",Xl,[e("div",Zl,[e("div",_l,[e("h5",en,m($.value==="financing"?"Add Financing":"Add Trade-in"),1),e("button",{onClick:G,class:"text-gray-400 hover:text-gray-600"},[...F[7]||(F[7]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),$.value==="financing"?(o(),W(yl,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:de,onCancel:G},null,8,["task-type","task-id"])):y("",!0),$.value==="tradein"?(o(),W(wl,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:de,onCancel:G},null,8,["task-type","task-id"])):y("",!0)])])):y("",!0),$.value==="purchase"?(o(),a("div",tn,[z(ut,{item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:de,onCancel:G},null,8,["task-type","task-id","requested-car"])])):y("",!0)])):y("",!0)])),z(ht,{show:w.value,onClose:F[5]||(F[5]=P=>w.value=!1),onConfirm:v},null,8,["show"])]))}},sn={key:0,class:"mb-8"},on={class:"flex items-center gap-2 mb-4"},ln={class:"font-bold text-gray-800 text-sm"},nn={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},an={class:"p-4"},rn={class:"flex items-center justify-between"},dn={class:"flex items-center gap-4"},un={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},cn=["src"],mn={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},pn={class:"flex items-center gap-2"},yn={class:"font-bold text-slate-800 text-sm md:text-base"},fn={class:"mt-1.5 flex items-center gap-2"},gn={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},vn={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},bn={key:2,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},xn={class:"flex items-center gap-4"},hn={key:0,class:"text-right"},wn={class:"font-bold text-slate-800"},kn={class:"border-t border-gray-200"},$n={class:"font-medium"},Cn={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Sn={class:"mb-6"},Dn={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},An={key:0},Tn={class:"font-medium text-slate-700"},On={key:1},Vn={class:"font-medium text-slate-700"},In={key:2},Nn={class:"font-medium text-slate-700"},Rn={class:"font-medium text-slate-700"},jn={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},qn={key:0},Mn={class:"font-medium text-slate-700"},Un={key:1},Ln={class:"font-medium text-slate-700"},Fn={key:2},En={class:"font-medium text-slate-700"},Bn={key:3},Wn={class:"font-medium text-slate-700"},Pn={key:4},zn={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Qn={key:5},Yn={class:"font-medium text-slate-700"},Hn={key:0,class:"mt-6 flex justify-end"},Kn={key:0,class:"border-t border-gray-200 my-6"},Gn={key:1,class:"mb-6 px-6"},Jn={class:"bg-white border border-gray-200 rounded-lg p-4"},Xn={class:"text-sm text-slate-700 leading-relaxed"},du={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const k=S(!1),s=l=>new Intl.NumberFormat("en-US").format(l),f=l=>new Intl.NumberFormat("en-US").format(l);return(l,n)=>t.show?(o(),a("div",sn,[e("div",on,[n[1]||(n[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",ln,m(t.label),1)]),e("div",nn,[e("div",an,[e("div",rn,[e("div",dn,[e("div",un,[t.image?(o(),a("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,cn)):(o(),a("i",mn))]),e("div",null,[e("div",pn,[e("div",yn,m(t.brand)+" "+m(t.model)+" ("+m(t.year)+")",1)]),e("div",fn,[t.stockDays!==void 0&&t.stockDays!==null?(o(),a("div",gn,[n[2]||(n[2]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+m(t.stockDays)+" days) ",1)])):(o(),a("div",vn,[...n[3]||(n[3]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])])),t.showOpenAd&&t.price?(o(),a("button",bn,[...n[4]||(n[4]=[V(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):y("",!0)])])]),e("div",xn,[t.price?(o(),a("div",hn,[n[5]||(n[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",wn,"€ "+m(s(t.price)),1)])):y("",!0)])])]),e("div",kn,[e("button",{onClick:n[0]||(n[0]=g=>k.value=!k.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",$n,m(k.value?"Hide":"View")+" Details",1),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":k.value}])},null,2)])]),k.value?(o(),a("div",Cn,[e("div",Sn,[n[16]||(n[16]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Dn,[t.requestType?(o(),a("div",An,[n[6]||(n[6]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Tn,m(t.requestType),1)])):y("",!0),t.source?(o(),a("div",On,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Vn,m(t.source),1)])):y("",!0),e("div",null,[n[8]||(n[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:j(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},m(t.sourceDetails||"--"),3)]),t.dealership?(o(),a("div",In,[n[9]||(n[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Nn,m(t.dealership),1)])):y("",!0),e("div",null,[n[10]||(n[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Rn,m(t.channel||"Email"),1)]),e("div",null,[n[11]||(n[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:j(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},m(t.adCampaign||"--"),3)]),e("div",null,[n[12]||(n[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:j(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},m(t.adMedium||"--"),3)]),e("div",null,[n[13]||(n[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:j(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},m(t.adSource||"--"),3)]),e("div",null,[n[14]||(n[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:j(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},m(t.expectedPurchaseDate||"--"),3)]),e("div",null,[n[15]||(n[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:j(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},m(t.fiscalEntity||"--"),3)])])]),n[26]||(n[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[n[24]||(n[24]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",jn,[t.registration?(o(),a("div",qn,[n[17]||(n[17]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Mn,m(t.registration),1)])):y("",!0),t.kilometers!==void 0&&t.kilometers!==null?(o(),a("div",Un,[n[18]||(n[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ln,m(f(t.kilometers))+" Km",1)])):y("",!0),t.fuelType?(o(),a("div",Fn,[n[19]||(n[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",En,m(t.fuelType),1)])):y("",!0),t.gearType?(o(),a("div",Bn,[n[20]||(n[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Wn,m(t.gearType),1)])):y("",!0),t.vin?(o(),a("div",Pn,[n[21]||(n[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",zn,m(t.vin),1)])):y("",!0),t.dealership?(o(),a("div",Qn,[n[22]||(n[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Yn,m(t.dealership),1)])):y("",!0)]),t.showTechnicalSpecs?(o(),a("div",Hn,[...n[23]||(n[23]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),V(" View technical specs ")],-1)])])):y("",!0)]),t.requestMessage?(o(),a("div",Kn)):y("",!0),t.requestMessage?(o(),a("div",Gn,[n[25]||(n[25]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST MESSAGE",-1)),e("div",Jn,[e("p",Xn,m(t.requestMessage),1)])])):y("",!0)])):y("",!0)])])):y("",!0)}},Zn={key:0,class:"space-y-4 animate-fade-in"},_n={label:"Teams"},ea=["value"],ta={label:"Users"},sa=["value"],oa={key:0,class:"text-xs text-gray-500 mt-1"},la={key:0,class:"animate-fade-in"},na={class:"grid grid-cols-4 gap-2"},aa=["onClick"],ct={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=Fe(),n=it(),g=S(""),u=S(null),c=S(""),d=S(!1),i=S(""),v=T(()=>n.assignableUsers),h=T(()=>n.assignableTeams),$=T(()=>u.value&&u.value.startsWith("team-"));he(()=>{var N;u.value=`user-${((N=l.currentUser)==null?void 0:N.id)||1}`}),we(()=>s.show,N=>{N||p()});const p=()=>{var N;g.value="",u.value=`user-${((N=l.currentUser)==null?void 0:N.id)||1}`,c.value="",d.value=!1,i.value=""},w=()=>{if(!g.value||!c.value||!i.value||!u.value)return;const N=u.value.startsWith("team-"),x=parseInt(u.value.split("-")[1]);let A={};if(N){const D=n.getTeamById(x);A={assigneeType:"team",teamId:x,team:(D==null?void 0:D.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const D=n.getUserById(x);A={assigneeType:"user",assigneeId:x,assignee:(D==null?void 0:D.name)||"Unknown",teamId:null,team:null}}f("confirm",{type:g.value,date:c.value,time:i.value,...A}),p()},q=()=>{p(),f("cancel")};return(N,x)=>t.show?(o(),a("div",Zn,[e("div",null,[x[5]||(x[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),I(e("select",{"onUpdate:modelValue":x[0]||(x[0]=A=>g.value=A),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...x[4]||(x[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ne,g.value]])]),e("div",null,[x[7]||(x[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),I(e("select",{"onUpdate:modelValue":x[1]||(x[1]=A=>u.value=A),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[e("optgroup",_n,[(o(!0),a(Q,null,H(h.value,A=>(o(),a("option",{key:`team-${A.id}`,value:`team-${A.id}`},m(A.name)+" Team ",9,ea))),128))]),e("optgroup",ta,[(o(!0),a(Q,null,H(v.value,A=>{var D;return o(),a("option",{key:`user-${A.id}`,value:`user-${A.id}`},m(A.name)+m(A.id===((D=B(l).currentUser)==null?void 0:D.id)?" (Me)":""),9,sa)}),128))])],512),[[ne,u.value]]),$.value?(o(),a("p",oa,[...x[6]||(x[6]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),V(" Any available team member will be assigned ",-1)])])):y("",!0)]),e("div",null,[x[8]||(x[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),I(e("input",{type:"date","onUpdate:modelValue":x[2]||(x[2]=A=>c.value=A),onChange:x[3]||(x[3]=A=>d.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[U,c.value]])]),d.value?(o(),a("div",la,[x[9]||(x[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",na,[(o(),a(Q,null,H(["09:00","10:30","11:00","14:30","15:00","16:30"],A=>e("button",{key:A,onClick:D=>i.value=A,class:j(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",i.value===A?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},m(A),11,aa)),64))])])):y("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:q,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:w,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...x[10]||(x[10]=[V(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):y("",!0)}},ia={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},ra={key:0,class:"flex justify-between items-center mb-4"},da={class:"font-semibold text-slate-800 text-sm"},ua={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(k,s)=>(o(),a("div",ia,[t.title?(o(),a("div",ra,[e("h5",da,m(t.title),1),t.showClose?(o(),a("button",{key:0,onClick:s[0]||(s[0]=f=>k.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):y("",!0)])):y("",!0),Ue(k.$slots,"default")]))}},ca={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},ma={class:"flex justify-between items-start mb-3"},pa={class:"text-xs text-gray-500 mt-0.5"},ya={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},fa={class:"text-xs text-blue-700"},ga={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},va={class:"flex items-center justify-between"},ba={class:"flex items-center gap-2"},xa={class:"text-xs font-bold text-slate-800"},ha={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},wa={class:"flex items-center gap-2 mb-3"},ka={class:"text-sm text-slate-700 font-medium"},$a={class:"flex gap-2 items-center mb-4"},Ca=["disabled"],Sa={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Da=["disabled"],Aa={key:2,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Ta={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Oa={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Va={class:"flex items-center gap-2 text-red-400"},Ia={class:"text-xs font-mono"},Na={class:"space-y-3 text-sm font-mono"},Ra={class:"ml-2"},ja={class:"ml-2"},qa={key:0},Ma={class:"ml-2"},Ua={key:1},La={class:"ml-2"},Fa={key:2},Ea={class:"ml-2"},Ba={class:"mt-4 pt-4 border-t border-slate-700"},Wa={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Pa={key:3,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},za={class:"grid grid-cols-3 gap-2"},Qa={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Ya={class:"grid grid-cols-4 gap-2"},Ha=["onClick"],Ka={key:0},Ga={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Ja={class:"text-xs text-slate-700"},Xa={class:"grid grid-cols-3 gap-2"},Za={key:0,class:"mt-3 grid grid-cols-2 gap-3"},_a={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},ei={class:"flex gap-4"},ti={class:"flex items-center gap-2 cursor-pointer"},si={class:"flex items-center gap-2 cursor-pointer"},oi={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},li=["disabled"],ni={key:2,class:"space-y-4"},ai={class:"bg-white border border-gray-200 rounded-lg p-4"},ii={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ri=["value"],di=["value"],ui=["value"],ci={class:"bg-white border border-gray-200 rounded-lg p-4"},mi={class:"flex gap-2"},pi={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},yi={class:"grid grid-cols-2 gap-3 text-sm mb-3"},fi={class:"ml-2 font-medium text-slate-800"},gi={class:"ml-2 font-medium text-slate-800"},vi={class:"ml-2 font-medium text-slate-800 capitalize"},bi={class:"ml-2 font-medium text-slate-800"},xi={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},hi={class:"space-y-2"},wi=["checked"],ki=["checked","disabled"],$i={class:"flex-1"},Ci={class:"text-xs text-gray-500 mt-0.5"},Si={class:"space-y-3"},Di={class:"grid grid-cols-2 gap-3 text-sm"},Ai={class:"ml-2 font-medium text-slate-800"},Ti={class:"ml-2 font-medium text-slate-800"},Oi={class:"ml-2 font-medium text-slate-800 capitalize"},Vi={class:"ml-2 font-medium text-slate-800"},Ii={key:0,class:"text-sm"},Ni={class:"ml-2 font-medium text-slate-800"},Ri={key:1,class:"text-sm"},ji={class:"mt-1 text-slate-700"},qi={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Mi={class:"p-6"},Ui={class:"flex justify-between items-center mb-4"},Li={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Fi={class:"p-6"},Ei={class:"flex justify-between items-center mb-4"},Bi={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:k}){var je,qe,Me;const s=t,f=k,l=it(),n=Fe(),g=S(!1),u=S(!1),c=S(0),d=S(""),i=S(null),v=S(!1),h=S(null),$=S(!1),p=S(!1),w=S(!1),q=S(null),N=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],x=S("whatsapp"),A=S("followup-1"),D=S("custom"),R=S(""),X=S("09:00"),K=S("Not Interested"),me=S(""),$e=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],re=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],pe=T(()=>l.assignableUsers),Ce=T(()=>n.currentUser),G=S({dealership:((qe=(je=s.lead)==null?void 0:je.requestedCar)==null?void 0:qe.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Me=Ce.value)==null?void 0:Me.id)||1}),de=S({tradeIn:!1,financing:!1,contactAvailability:!1}),Y=S({}),ue=S(null),le={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},Ae=T(()=>{const M=Math.floor(c.value/60),r=c.value%60;return`${M.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}),L=T(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),F=T(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),P=T(()=>!!s.lead.scheduledAppointment),ae=T(()=>P.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:F.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),te=T(()=>{var M;return((M=s.lead.contactAttempts)==null?void 0:M.length)||0});T(()=>s.activities.filter(M=>M.type==="note"));const se={"followup-1":`Hi ${s.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}?`,"followup-2":`Hello ${s.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${s.lead.requestedCar.brand} ${s.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},Ie=T(()=>A.value==="custom"?"Type your custom message...":se[A.value]),Ee=()=>{g.value=!0,c.value=0,u.value=!1,d.value="",i.value=setInterval(()=>{c.value++,c.value>=20&&Se()},1e3)},Se=()=>{i.value&&(clearInterval(i.value),i.value=null),g.value=!1,u.value=!0,Y.value={duration:c.value,notes:d.value,transcription:le,channel:"phone"},v.value=!0},Ne=async()=>{try{await navigator.clipboard.writeText(s.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(M){console.error("Failed to copy:",M)}},Be=()=>{ue.value={tradeIn:le.leadLines.some(M=>M.toLowerCase().includes("trade")||M.toLowerCase().includes("exchange"))||!1,financing:le.leadLines.some(M=>M.toLowerCase().includes("financ")||M.toLowerCase().includes("payment")||M.toLowerCase().includes("loan"))||!1},ue.value.tradeIn&&(de.value.tradeIn=!0),ue.value.financing&&(de.value.financing=!0),v.value=!0,u.value=!1},We=async M=>{q.value=M,w.value=!0,p.value=!1,f("appointment-scheduled",M)},Pe=()=>{const M={timestamp:new Date().toISOString(),outcome:"interested",channel:Y.value.channel||"phone",notes:Y.value.notes||"",transcription:Y.value.transcription||null};f("call-attempt-logged",M),f("validated",{scheduleFollowUp:!1}),f("qualified",{assignment:G.value,preferences:de.value,scheduleAppointment:w.value,appointmentData:q.value}),fe()},ze=()=>{const M={timestamp:new Date().toISOString(),outcome:"interested",channel:Y.value.channel||"phone",notes:Y.value.notes||"",transcription:Y.value.transcription||null};f("call-attempt-logged",M),h.value="not-valid"},Re=()=>{Y.value={channel:"external",notes:"",transcription:null},v.value=!0},ge=M=>{h.value=M,M==="interested"&&ue.value&&(de.value.tradeIn=ue.value.tradeIn||!1,de.value.financing=ue.value.financing||!1)},fe=()=>{h.value=null,v.value=!1,w.value=!1,q.value=null},Qe=()=>{if(D.value==="tomorrow-9am"){const r=new Date;return r.setDate(r.getDate()+1),r.setHours(9,0,0,0),r.toISOString()}else if(D.value==="monday"){const r=new Date,O=(8-r.getDay())%7||7;return r.setDate(r.getDate()+O),r.setHours(9,0,0,0),r.toISOString()}else if(D.value==="custom"&&R.value&&X.value)return new Date(`${R.value}T${X.value}:00`).toISOString();const M=new Date;return M.setDate(M.getDate()+1),M.setHours(9,0,0,0),M.toISOString()},Ye=async()=>{const M={timestamp:new Date().toISOString(),outcome:"no-answer",channel:Y.value.channel||"phone",notes:Y.value.notes||"",transcription:Y.value.transcription||null};f("call-attempt-logged",M),x.value&&x.value;const r=Qe(),O=r.split("T")[0],ye=new Date(r).toTimeString().slice(0,5);f("postponed",{date:O,time:ye,createAppointment:!0}),te.value+1>=5&&f("disqualified",{category:"Not Interested",reason:"Unreachable"}),fe()},He=()=>{const M={timestamp:new Date().toISOString(),outcome:"not-valid",channel:Y.value.channel||"phone",notes:Y.value.notes||"",transcription:Y.value.transcription||null};f("call-attempt-logged",M),f("disqualified",{category:K.value,reason:me.value}),fe()},Ke=M=>{$.value=!1,f("note-saved",M)};return bt(()=>{i.value&&clearInterval(i.value)}),(M,r)=>(o(),a("div",ca,[e("div",ma,[e("div",null,[r[29]||(r[29]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",pa,m(L.value),1)]),e("div",{class:j(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",ae.value.class])},m(ae.value.text),3)]),P.value?(o(),a("div",ya,[r[30]||(r[30]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",fa,m(B(Oe)(t.lead.scheduledAppointment.start))+" at "+m(B(Le)(t.lead.scheduledAppointment.start)),1)])):y("",!0),te.value>0?(o(),a("div",ga,[e("div",va,[e("div",ba,[r[31]||(r[31]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),r[32]||(r[32]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",xa,m(te.value)+" / 5",1)]),te.value>=4?(o(),a("div",ha,[...r[33]||(r[33]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),V(" One more attempt before auto-disqualification ",-1)])])):y("",!0)])])):y("",!0),e("div",wa,[e("span",ka,m(t.lead.customer.phone),1),e("button",{onClick:Ne,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...r[34]||(r[34]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",$a,[e("button",{onClick:Ee,disabled:g.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[r[35]||(r[35]=e("i",{class:"fa-solid fa-phone"},null,-1)),V(" "+m(te.value>0?"Call Again":"Initiate Call")+" ",1),te.value>0?(o(),a("span",Sa,m(te.value+1)+"/5 ",1)):y("",!0)],8,Ca),e("button",{onClick:Re,disabled:g.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...r[36]||(r[36]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),V(" Log Call Outcome ",-1)])],8,Da)]),g.value||u.value?(o(),a("div",Aa,[g.value?(o(),a("div",Ta,[e("div",Oa,[r[38]||(r[38]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Va,[r[37]||(r[37]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ia,"REC "+m(Ae.value),1)])]),e("div",Na,[e("div",null,[r[39]||(r[39]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ra,m(le.leadLines[0]),1)]),e("div",null,[r[40]||(r[40]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",ja,m(le.salesLines[0]),1)]),c.value>=5?(o(),a("div",qa,[r[41]||(r[41]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ma,m(le.leadLines[1]),1)])):y("",!0),c.value>=8?(o(),a("div",Ua,[r[42]||(r[42]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",La,m(le.salesLines[1]),1)])):y("",!0),c.value>=12?(o(),a("div",Fa,[r[43]||(r[43]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ea,m(le.leadLines[2]),1)])):y("",!0)]),e("div",Ba,[I(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=O=>d.value=O),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[U,d.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:Se,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...r[44]||(r[44]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),V(" End Call ",-1)])])])])):y("",!0),u.value&&!g.value?(o(),a("div",Wa,[e("div",{class:"flex items-center justify-between"},[r[46]||(r[46]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:Be,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...r[45]||(r[45]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),V(" Extract information ",-1)])])])])):y("",!0)])):y("",!0),v.value?(o(),a("div",Pa,[e("div",null,[r[50]||(r[50]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",za,[e("button",{onClick:r[1]||(r[1]=O=>ge("no-answer")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",h.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...r[47]||(r[47]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:r[2]||(r[2]=O=>ge("not-valid")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",h.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...r[48]||(r[48]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:r[3]||(r[3]=O=>ge("interested")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",h.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...r[49]||(r[49]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),h.value==="no-answer"?(o(),a("div",Qa,[r[58]||(r[58]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",Ya,[(o(),a(Q,null,H(N,O=>e("button",{key:O.value,onClick:ye=>x.value=O.value,class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",x.value===O.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},m(O.label),11,Ha)),64))]),x.value&&x.value!=="dont-send"?(o(),a("div",Ka,[r[53]||(r[53]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),I(e("select",{"onUpdate:modelValue":r[4]||(r[4]=O=>A.value=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...r[51]||(r[51]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[ne,A.value]]),e("div",Ga,[r[52]||(r[52]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",Ja,m(Ie.value),1)])])):y("",!0),e("div",null,[r[56]||(r[56]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",Xa,[e("button",{onClick:r[5]||(r[5]=O=>D.value="tomorrow-9am"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",D.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:r[6]||(r[6]=O=>D.value="monday"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",D.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:r[7]||(r[7]=O=>D.value="custom"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",D.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),D.value==="custom"?(o(),a("div",Za,[e("div",null,[r[54]||(r[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),I(e("input",{type:"date","onUpdate:modelValue":r[8]||(r[8]=O=>R.value=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,R.value]])]),e("div",null,[r[55]||(r[55]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),I(e("input",{type:"time","onUpdate:modelValue":r[9]||(r[9]=O=>X.value=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[U,X.value]])])])):y("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:fe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:Ye,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...r[57]||(r[57]=[V(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):y("",!0),h.value==="not-valid"?(o(),a("div",_a,[e("div",null,[r[61]||(r[61]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",ei,[e("label",ti,[I(e("input",{type:"radio","onUpdate:modelValue":r[10]||(r[10]=O=>K.value=O),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Xe,K.value]]),r[59]||(r[59]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",si,[I(e("input",{type:"radio","onUpdate:modelValue":r[11]||(r[11]=O=>K.value=O),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Xe,K.value]]),r[60]||(r[60]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[r[63]||(r[63]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),I(e("select",{"onUpdate:modelValue":r[12]||(r[12]=O=>me.value=O),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...r[62]||(r[62]=[st('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[ne,me.value]])]),e("div",oi,[e("button",{onClick:fe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:He,disabled:!K.value||!me.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,li)])])):y("",!0),h.value==="interested"?(o(),a("div",ni,[e("div",ai,[r[67]||(r[67]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",ii,[e("div",null,[r[64]||(r[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),I(e("select",{"onUpdate:modelValue":r[13]||(r[13]=O=>G.value.dealership=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(),a(Q,null,H($e,O=>e("option",{key:O,value:O},m(O),9,ri)),64))],512),[[ne,G.value.dealership]])]),e("div",null,[r[65]||(r[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),I(e("select",{"onUpdate:modelValue":r[14]||(r[14]=O=>G.value.team=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(),a(Q,null,H(re,O=>e("option",{key:O,value:O},m(O),9,di)),64))],512),[[ne,G.value.team]])]),e("div",null,[r[66]||(r[66]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),I(e("select",{"onUpdate:modelValue":r[15]||(r[15]=O=>G.value.assigneeId=O),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(o(!0),a(Q,null,H(pe.value,O=>(o(),a("option",{key:O.id,value:O.id},m(O.name)+m(O.id===Ce.value.id?" (Me)":""),9,ui))),128))],512),[[ne,G.value.assigneeId]])])])]),e("div",ci,[r[71]||(r[71]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",mi,[e("button",{onClick:r[16]||(r[16]=O=>f("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...r[68]||(r[68]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),V(" Add purchase method ",-1)])]),e("button",{onClick:r[17]||(r[17]=O=>f("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...r[69]||(r[69]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),V(" Add trade-in ",-1)])]),e("button",{onClick:r[18]||(r[18]=O=>$.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...r[70]||(r[70]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),V(" Add note ",-1)])])])]),M.hasExistingAppointment&&!w.value?(o(),a("div",pi,[r[77]||(r[77]=st('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",yi,[e("div",null,[r[72]||(r[72]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",fi,m(B(Oe)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[r[73]||(r[73]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",gi,m(B(Le)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[r[74]||(r[74]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",vi,m(t.lead.scheduledAppointment.type),1)]),e("div",null,[r[75]||(r[75]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",bi,m(t.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:r[19]||(r[19]=O=>p.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...r[76]||(r[76]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),V(" Reschedule Appointment ",-1)])])])):y("",!0),M.hasExistingAppointment?y("",!0):(o(),a("div",xi,[r[80]||(r[80]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",hi,[e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!w.value}])},[e("input",{type:"radio",checked:!w.value,onChange:r[20]||(r[20]=()=>{w.value=!1,q.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,wi),r[78]||(r[78]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":w.value}]),onClick:r[22]||(r[22]=O=>!w.value&&(p.value=!0))},[e("input",{type:"radio",checked:w.value,disabled:!w.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,ki),e("div",$i,[r[79]||(r[79]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",Ci,m(w.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),w.value?(o(),a("button",{key:0,onClick:r[21]||(r[21]=ie(O=>p.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):y("",!0)],2)])])),w.value?(o(),W(ua,{key:2,title:"Scheduled Appointment","show-close":!1},{default:Z(()=>[e("div",Si,[e("div",Di,[e("div",null,[r[81]||(r[81]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Ai,m(B(Oe)(q.value.datetime)),1)]),e("div",null,[r[82]||(r[82]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Ti,m(q.value.time),1)]),e("div",null,[r[83]||(r[83]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Oi,m(q.value.type),1)]),e("div",null,[r[84]||(r[84]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Vi,m(q.value.assignee),1)])]),q.value.location?(o(),a("div",Ii,[r[85]||(r[85]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",Ni,m(q.value.location),1)])):y("",!0),q.value.notes?(o(),a("div",Ri,[r[86]||(r[86]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",ji,m(q.value.notes),1)])):y("",!0)])]),_:1})):y("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:fe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:ze,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...r[87]||(r[87]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),V(" Disqualify ",-1)])]),e("button",{onClick:Pe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...r[88]||(r[88]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),V(" Qualify ",-1)])])])])])):y("",!0)])):y("",!0),(o(),W(Ve,{to:"body"},[$.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:r[25]||(r[25]=ie(O=>$.value=!1,["self"]))},[e("div",qi,[e("div",Mi,[e("div",Ui,[r[90]||(r[90]=e("h5",{class:"text-sm font-bold text-slate-800"},"Add Note",-1)),e("button",{onClick:r[23]||(r[23]=O=>$.value=!1),class:"text-gray-400 hover:text-gray-600"},[...r[89]||(r[89]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),z(dt,{item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,onSave:Ke,onCancel:r[24]||(r[24]=O=>$.value=!1)},null,8,["task-id"])])])])):y("",!0)])),(o(),W(Ve,{to:"body"},[p.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:r[28]||(r[28]=ie(O=>p.value=!1,["self"]))},[e("div",Li,[e("div",Fi,[e("div",Ei,[r[92]||(r[92]=e("h5",{class:"text-sm font-bold text-slate-800"},"Schedule Appointment",-1)),e("button",{onClick:r[26]||(r[26]=O=>p.value=!1),class:"text-gray-400 hover:text-gray-600"},[...r[91]||(r[91]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),z(ct,{show:!0,onConfirm:We,onCancel:r[27]||(r[27]=O=>p.value=!1)})])])])):y("",!0)]))]))}},Wi={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},Pi={class:"flex items-center gap-3"},zi={class:"flex-1"},Qi={key:0,class:"text-xs font-normal opacity-75"},Yi={class:"p-5 space-y-6"},Hi={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:k}){const s=t,f=k,l=Ze(),n=at(),g=Fe(),u=S(new Set),c=T(()=>u.value.has(s.lead.id)),d=()=>{u.value.add(s.lead.id)},i=T(()=>wt(s.lead.nextActionDue)),v=async D=>{try{const R=new Date(`${D.date}T${D.time}:00`),X=R.toISOString();await n.modifyLead(s.lead.id,{nextActionDue:X}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Oe(R)} at ${Le(R)}`}),await n.loadLeadById(s.lead.id)}catch(R){console.error("Failed to postpone lead task:",R)}},h=async D=>{try{if(await n.modifyLead(s.lead.id,{stage:"Validated"}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),D.scheduleFollowUp&&D.appointmentData){const R=new Date(`${D.appointmentData.date}T${D.appointmentData.time}:00`);await n.scheduleFollowUp(s.lead.id,{dateTime:R.toISOString(),assignee:D.appointmentData.assignee||s.lead.assignee,assigneeId:D.appointmentData.assigneeId||null,assigneeType:D.appointmentData.assigneeType||"user",teamId:D.appointmentData.teamId||null,team:D.appointmentData.team||null}),await n.addActivity(s.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Oe(R)} at ${Le(R)}`})}await n.loadLeadById(s.lead.id)}catch(R){console.error("Failed to validate lead:",R)}},$=async()=>{try{const D=await n.convertLeadToOpportunity(s.lead.id);g.canAccessOpportunities()?l.push({path:`/tasks/${D}`,query:{type:"opportunity"}}):l.push("/tasks/1")}catch(D){console.error("Failed to qualify lead:",D)}},p=async D=>{try{const R=s.lead.contactAttempts||[];await n.modifyLead(s.lead.id,{contactAttempts:[...R,D],lastContactAttempt:D.timestamp,totalContactAttempts:R.length+1}),await n.addActivity(s.lead.id,{type:"call",user:"You",action:`logged call attempt - ${D.outcome}`,content:D.notes||`Call attempt via ${D.channel}`,data:{outcome:D.outcome,channel:D.channel,duration:D.duration}}),await n.loadLeadById(s.lead.id)}catch(R){console.error("Failed to log call attempt:",R)}},w=async D=>{try{await n.addActivity(s.lead.id,{type:"note",user:"You",action:"added a note",content:D.content||D.text||"",data:D}),await n.loadLeadById(s.lead.id)}catch(R){console.error("Failed to save note:",R)}},q=()=>{f("open-purchase-method")},N=()=>{f("open-trade-in")},x=async D=>{var R;try{const X=`${D.date}T${D.time}:00`,K=new Date(X);K.setHours(K.getHours()+1),await n.modifyLead(s.lead.id,{scheduledAppointment:{id:Date.now(),title:`${D.type} - ${s.lead.customer.name}`,start:X,end:K.toISOString(),type:D.type,assignee:D.assignee,assigneeId:D.assigneeId,status:"scheduled",location:D.location||"",notes:D.notes||""}}),await n.addActivity(s.lead.id,{type:"appointment",user:((R=g.currentUser)==null?void 0:R.name)||"You",action:"scheduled an appointment",content:`${D.type} scheduled for ${D.date} at ${D.time}`,data:{type:D.type,date:D.date,time:D.time,assignee:D.assignee}}),await n.loadLeadById(s.lead.id)}catch(X){console.error("Failed to schedule appointment:",X)}},A=async D=>{try{await n.modifyLead(s.lead.id,{isDisqualified:!0,disqualifyReason:D.reason,status:"Disqualified"}),await n.addActivity(s.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${D.category}, Reason: ${D.reason}`}),l.push("/tasks")}catch(R){console.error("Failed to disqualify lead:",R)}};return(D,R)=>t.lead?(o(),a("div",Wi,[R[4]||(R[4]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")])],-1)),t.lead.nextActionDue&&!c.value&&(i.value.type==="overdue"||i.value.type==="urgent")?(o(),a("div",{key:0,class:j(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[i.value.bgClass,i.value.borderClass]])},[e("div",Pi,[e("div",{class:j(["w-9 h-9 rounded-lg flex items-center justify-center",[i.value.bgClass,i.value.borderClass,"border"]])},[e("i",{class:j(["text-base",[`fa-solid ${i.value.icon}`,i.value.textClass]])},null,2)],2),e("div",zi,[R[0]||(R[0]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:j(["text-sm font-bold",i.value.textClass])},[V(m(B(kt)(t.lead.nextActionDue))+" ",1),i.value.type!=="overdue"?(o(),a("span",Qi," ("+m(B($t)(t.lead.nextActionDue))+") ",1)):y("",!0)],2)]),i.value.type==="overdue"?(o(),a("div",{key:0,class:j(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...R[1]||(R[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),V(" Overdue ",-1)])],2)):i.value.type==="urgent"?(o(),a("div",{key:1,class:j(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...R[2]||(R[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),V(" Urgent ",-1)])],2)):y("",!0)]),e("button",{onClick:d,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...R[3]||(R[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):y("",!0),e("div",Yi,[z(Bi,{lead:t.lead,onPostponed:v,onValidated:h,onQualified:$,onDisqualified:A,onCallAttemptLogged:p,onNoteSaved:w,onOpenPurchaseMethod:q,onOpenTradeIn:N,onAppointmentScheduled:x},null,8,["lead"])])])):y("",!0)}},Ki={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Gi={class:"grid grid-cols-3 gap-3 mb-4"},Ji={class:"flex gap-3 mb-4"},Xi={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:k}){const s=k,f=S(null),l=S(""),n=S(""),g=d=>{f.value=d;const i=new Date;if(d==="later-today"){const v=new Date(i.getTime()+72e5);l.value=v.toISOString().split("T")[0],n.value=v.toTimeString().slice(0,5)}else if(d==="tomorrow"){const v=new Date(i);v.setDate(v.getDate()+1),l.value=v.toISOString().split("T")[0],n.value="09:00"}else if(d==="next-week"){const v=new Date(i);v.setDate(v.getDate()+(7-v.getDay()+1)),l.value=v.toISOString().split("T")[0],n.value="09:00"}},u=()=>{s("confirm",{date:l.value,time:n.value,option:f.value}),s("close"),f.value=null,l.value="",n.value=""},c=()=>{s("close"),f.value=null,l.value="",n.value=""};return(d,i)=>t.show?(o(),a("div",Ki,[e("div",Gi,[e("button",{onClick:i[0]||(i[0]=v=>g("later-today")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="later-today"}])},[...i[5]||(i[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:i[1]||(i[1]=v=>g("tomorrow")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="tomorrow"}])},[...i[6]||(i[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:i[2]||(i[2]=v=>g("next-week")),class:j(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":f.value==="next-week"}])},[...i[7]||(i[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",Ji,[I(e("input",{"onUpdate:modelValue":i[3]||(i[3]=v=>l.value=v),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[U,l.value]]),I(e("input",{"onUpdate:modelValue":i[4]||(i[4]=v=>n.value=v),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[U,n.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:c,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:u,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):y("",!0)}},Zi={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:k}){const s=k,f=()=>{s("close")};return(l,n)=>(o(),W(De,{show:t.show,title:t.title,onCancel:f},{footer:Z(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:f,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:Z(()=>[n[0]||(n[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},_i={class:"space-y-4"},er=["disabled"],tr={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S(""),n=S("");we(()=>s.show,c=>{c&&(l.value="",n.value="")});const g=()=>{l.value&&f("confirm",{reason:l.value,notes:n.value})},u=()=>{f("cancel")};return(c,d)=>(o(),W(De,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:u},{actions:Z(()=>[e("button",{onClick:g,disabled:!l.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,er)]),default:Z(()=>[e("div",_i,[e("div",null,[d[3]||(d[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),I(e("select",{"onUpdate:modelValue":d[0]||(d[0]=i=>l.value=i),class:"input"},[...d[2]||(d[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ne,l.value]])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),I(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=i=>n.value=i),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[U,n.value]])])])]),_:1},8,["show"]))}},sr={class:"space-y-4"},or=["max"],lr=["disabled"],nr={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S(""),n=S(""),g=S(""),u=T(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,i=>{if(i){const v=new Date;l.value=v.toISOString().split("T")[0],n.value=v.toTimeString().slice(0,5),g.value=""}});const c=()=>{if(!l.value)return;const i=n.value?`${l.value}T${n.value}:00`:`${l.value}T12:00:00`;f("confirm",{contractDate:i,notes:g.value})},d=()=>{f("cancel")};return(i,v)=>(o(),W(De,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:d},{actions:Z(()=>[e("button",{onClick:c,disabled:!l.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,lr)]),default:Z(()=>[e("div",sr,[e("div",null,[v[3]||(v[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),I(e("input",{type:"date","onUpdate:modelValue":v[0]||(v[0]=h=>l.value=h),max:u.value,class:"input"},null,8,or),[[U,l.value]])]),e("div",null,[v[4]||(v[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),I(e("input",{type:"time","onUpdate:modelValue":v[1]||(v[1]=h=>n.value=h),class:"input"},null,512),[[U,n.value]])]),e("div",null,[v[5]||(v[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),I(e("textarea",{"onUpdate:modelValue":v[2]||(v[2]=h=>g.value=h),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[U,g.value]])])])]),_:1},8,["show"]))}},ar={class:"space-y-4"},ir=["max"],rr=["disabled"],dr={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:k}){const s=t,f=k,l=S(""),n=S(""),g=S(""),u=S(""),c=T(()=>new Date().toISOString().split("T")[0]);we(()=>s.show,v=>{if(v){const h=new Date;l.value=h.toISOString().split("T")[0],n.value=h.toTimeString().slice(0,5),g.value="",u.value=""}});const d=()=>{if(!l.value||!g.value)return;const v=n.value?`${l.value}T${n.value}:00`:`${l.value}T12:00:00`;f("confirm",{deliveryDate:v,location:g.value,notes:u.value})},i=()=>{f("cancel")};return(v,h)=>(o(),W(De,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:i},{actions:Z(()=>[e("button",{onClick:d,disabled:!l.value||!g.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,rr)]),default:Z(()=>[e("div",ar,[e("div",null,[h[4]||(h[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),I(e("input",{type:"date","onUpdate:modelValue":h[0]||(h[0]=$=>l.value=$),max:c.value,class:"input"},null,8,ir),[[U,l.value]])]),e("div",null,[h[5]||(h[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),I(e("input",{type:"time","onUpdate:modelValue":h[1]||(h[1]=$=>n.value=$),class:"input"},null,512),[[U,n.value]])]),e("div",null,[h[7]||(h[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),I(e("select",{"onUpdate:modelValue":h[2]||(h[2]=$=>g.value=$),class:"input"},[...h[6]||(h[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ne,g.value]])]),e("div",null,[h[8]||(h[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),I(e("textarea",{"onUpdate:modelValue":h[3]||(h[3]=$=>u.value=$),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[U,u.value]])])])]),_:1},8,["show"]))}},ur={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(k,s)=>(o(),W(De,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=f=>k.$emit("cancel"))},{header:Z(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:Z(()=>[e("button",{onClick:s[0]||(s[0]=f=>k.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:Z(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),V(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),V(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),V(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},cr={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},mr=["src","alt"],pr={key:1,class:"w-full h-full flex items-center justify-center"},yr={class:"flex items-center justify-between mb-1.5"},fr={class:"text-sm font-bold text-gray-900"},gr={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},vr={class:"text-[10px] text-gray-500 mb-1.5"},br={key:0,class:"text-[10px] text-green-600 font-medium mb-2"},xr={key:1,class:"text-[10px] text-orange-600 font-medium mb-2"},nt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const k=t,s=T(()=>({Requested:"bg-blue-100 text-blue-700 border border-blue-200",Recommended:"bg-purple-100 text-purple-700 border border-purple-200","In Stock":"bg-green-100 text-green-700 border border-green-200",Custom:"bg-orange-100 text-orange-700 border border-orange-200"})[k.badge]||"bg-gray-100 text-gray-700 border border-gray-200"),f=l=>l?l.toLocaleString("en-US"):"0";return(l,n)=>(o(),a("div",{onClick:n[1]||(n[1]=g=>l.$emit("select")),class:j(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":t.selected}])},[e("div",cr,[t.vehicle.image?(o(),a("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,mr)):(o(),a("div",pr,[...n[2]||(n[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",yr,[e("span",{class:j(["text-[10px] font-bold uppercase px-1.5 py-0.5 rounded",s.value])},m(t.badge),3),e("span",fr,"€"+m(f(t.vehicle.price)),1)]),e("h4",gr,m(t.vehicle.brand)+" "+m(t.vehicle.model),1),e("p",vr,m(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(o(),a("div",br,[n[3]||(n[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),V(" In stock ("+m(t.stockDays)+" days) ",1)])):(o(),a("div",xr,[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),V(" Out of stock ",-1)])])),e("button",{onClick:n[0]||(n[0]=ie(g=>l.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},hr={class:"space-y-6 max-h-[75vh] overflow-y-auto px-2"},wr={key:0},kr={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},$r={class:"mb-4"},Cr={class:"relative"},Sr={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Dr={key:1,class:"text-center py-8 text-gray-500"},Ar={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Tr={key:0,class:"mt-4 space-y-3"},Or={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Vr={class:"flex justify-end"},Ir=["disabled"],Nr={class:"p-4 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Rr={class:"flex items-center gap-3"},jr={class:"font-bold text-sm text-gray-800"},qr={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:k}){const s=t,f=k,l=S(""),n=S(!1),g=S(null),u=S(null),c=S(null),d=S({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""}),i=T(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),v=T(()=>{const N=[];if(s.requestedVehicle&&i.value&&N.push({...s.requestedVehicle,isRequested:!0}),xe&&xe.length>0){const x=xe.filter(D=>s.requestedVehicle?D.brand!==s.requestedVehicle.brand||D.model!==s.requestedVehicle.model:!0),A=s.requestedVehicle&&i.value?3:4;N.push(...x.slice(0,A))}return N}),h=T(()=>{if(!xe||xe.length===0)return[];let N=[...xe];if(l.value){const x=l.value.toLowerCase();N=N.filter(A=>A.brand.toLowerCase().includes(x)||A.model.toLowerCase().includes(x)||A.year.toString().includes(x))}return N}),$=T(()=>d.value.brand&&d.value.model&&d.value.year&&d.value.price>0),p=(N,x)=>{g.value=N,u.value=N.id||`custom-${Date.now()}`,c.value=x},w=()=>{if(!$.value)return;const N={...d.value,id:`custom-${Date.now()}`,isCustom:!0};p(N,"custom")},q=()=>{g.value&&(f("vehicle-selected",{vehicle:g.value,type:c.value}),f("close"),g.value=null,u.value=null,c.value=null,l.value="",n.value=!1,d.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(N,x)=>(o(),W(De,{show:t.show,onClose:x[6]||(x[6]=A=>N.$emit("close")),title:"Select Vehicle",size:"6xl"},xt({default:Z(()=>[e("div",hr,[v.value.length?(o(),a("div",wr,[x[7]||(x[7]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),V(" Recommended Vehicles ")],-1)),e("div",kr,[(o(!0),a(Q,null,H(v.value,A=>(o(),W(nt,{key:A.id,vehicle:A,badge:A.isRequested?"Requested":"Recommended","stock-days":A.stockDays,selected:u.value===A.id,onSelect:D=>p(A,A.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):y("",!0),e("div",null,[x[10]||(x[10]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),V(" Browse Stock ")],-1)),e("div",$r,[e("div",Cr,[x[8]||(x[8]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),I(e("input",{"onUpdate:modelValue":x[0]||(x[0]=A=>l.value=A),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[U,l.value]])])]),h.value.length?(o(),a("div",Sr,[(o(!0),a(Q,null,H(h.value,A=>(o(),W(nt,{key:A.id,vehicle:A,badge:"In Stock","stock-days":A.stockDays,selected:u.value===A.id,onSelect:D=>p(A,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(o(),a("div",Dr,[...x[9]||(x[9]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[x[18]||(x[18]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),V(" Configure Custom Vehicle ")],-1)),e("div",Ar,[x[17]||(x[17]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:x[1]||(x[1]=A=>n.value=!n.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[x[11]||(x[11]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),V(" "+m(n.value?"Hide Configuration":"Build Custom Configuration"),1)]),n.value?(o(),a("div",Tr,[e("div",Or,[e("div",null,[x[12]||(x[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),I(e("input",{"onUpdate:modelValue":x[2]||(x[2]=A=>d.value.brand=A),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., Audi"},null,512),[[U,d.value.brand]])]),e("div",null,[x[13]||(x[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),I(e("input",{"onUpdate:modelValue":x[3]||(x[3]=A=>d.value.model=A),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., e-tron GT"},null,512),[[U,d.value.model]])]),e("div",null,[x[14]||(x[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),I(e("input",{"onUpdate:modelValue":x[4]||(x[4]=A=>d.value.year=A),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"2024"},null,512),[[U,d.value.year]])]),e("div",null,[x[15]||(x[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (€)",-1)),I(e("input",{"onUpdate:modelValue":x[5]||(x[5]=A=>d.value.price=A),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"98000"},null,512),[[U,d.value.price]])])]),e("div",Vr,[e("button",{onClick:w,disabled:!$.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...x[16]||(x[16]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),V(" Use Custom Configuration ",-1)])],8,Ir)])])):y("",!0)])])])]),_:2},[g.value?{name:"footer",fn:Z(()=>[e("div",Nr,[e("div",Rr,[x[20]||(x[20]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg"},null,-1)),e("div",null,[x[19]||(x[19]=e("p",{class:"text-xs text-gray-500"},"Selected Vehicle",-1)),e("p",jr,m(g.value.brand)+" "+m(g.value.model)+" ("+m(g.value.year)+") ",1)])]),e("button",{onClick:q,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors shadow-sm"}," Confirm Selection ")])]),key:"0"}:void 0]),1032,["show"]))}},Mr={class:"mt-1.5 border-t border-gray-200 pt-1.5"},Ur={key:1},Lr={class:"flex items-center justify-between mb-1.5"},Fr={class:"space-y-1.5"},Er={class:"block label-upper mb-1"},Br=["onUpdate:modelValue","placeholder"],Wr=["onUpdate:modelValue"],Pr=["value"],zr={key:2,class:"space-y-0.5"},Qr=["onUpdate:modelValue","value"],ke={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=S(!1),n=S({});we(()=>s.questions,i=>{const v={};i.forEach(h=>{v[h.key]=""}),n.value=v},{immediate:!0});const g=()=>{f("survey-completed",{...n.value}),d()},u=()=>{f("survey-refused"),d()},c=()=>{f("not-responding"),d()},d=()=>{l.value=!1;const i={};s.questions.forEach(v=>{i[v.key]=""}),n.value=i};return(i,v)=>(o(),a("div",Mr,[l.value?(o(),a("div",Ur,[e("div",Lr,[v[4]||(v[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:v[1]||(v[1]=h=>l.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",Fr,[(o(!0),a(Q,null,H(t.questions,(h,$)=>(o(),a("div",{key:$,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Er,m(h.label),1),h.type==="text"?I((o(),a("textarea",{key:0,"onUpdate:modelValue":p=>n.value[h.key]=p,placeholder:h.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Br)),[[U,n.value[h.key]]]):h.type==="select"?I((o(),a("select",{key:1,"onUpdate:modelValue":p=>n.value[h.key]=p,class:"input text-xs py-1 px-2"},[v[5]||(v[5]=e("option",{value:""},"Select an option...",-1)),(o(!0),a(Q,null,H(h.options,p=>(o(),a("option",{key:p,value:p},m(p),9,Pr))),128))],8,Wr)),[[ne,n.value[h.key]]]):h.type==="radio"?(o(),a("div",zr,[(o(!0),a(Q,null,H(h.options,p=>(o(),a("label",{key:p,class:"flex items-center text-xs"},[I(e("input",{type:"radio","onUpdate:modelValue":w=>n.value[h.key]=w,value:p,class:"mr-1"},null,8,Qr),[[Xe,n.value[h.key]]]),V(" "+m(p),1)]))),128))])):y("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:c,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(o(),a("button",{key:0,onClick:v[0]||(v[0]=h=>l.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...v[2]||(v[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Yr={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Hr={class:"flex justify-between items-start mb-3"},Kr={class:"text-xs text-gray-500 mt-0.5"},Gr={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],n=T(()=>{if(!s.opportunity.createdAt)return 0;const v=new Date(s.opportunity.createdAt),$=Math.abs(new Date-v);return Math.ceil($/(1e3*60*60*24))}),g=()=>{f("create-offer",s.opportunity)},u=()=>{f("review",s.opportunity)},c=v=>{f("survey-completed",{opportunity:s.opportunity,responses:v})},d=()=>{f("survey-refused",{opportunity:s.opportunity})},i=()=>{f("not-responding",{opportunity:s.opportunity})};return(v,h)=>(o(),a("div",Yr,[e("div",Hr,[e("div",null,[h[0]||(h[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Kr,"This opportunity has been open for "+m(n.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),z(ke,{questions:l,onSurveyCompleted:c,onSurveyRefused:d,onNotResponding:i})]))}},Jr={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Xr={class:"flex justify-between items-start mb-3"},Zr={class:"text-xs text-gray-500 mt-0.5"},_r={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],n=T(()=>{if(!s.opportunity.createdAt)return 0;const i=new Date(s.opportunity.createdAt),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))}),g=()=>{f("create-offer",s.opportunity)},u=i=>{f("survey-completed",{opportunity:s.opportunity,responses:i})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(i,v)=>(o(),a("div",Jr,[e("div",Xr,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Zr,"This opportunity has been open for "+m(n.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),z(ke,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},ed={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},td={class:"flex justify-between items-start mb-3"},sd={class:"text-xs text-gray-500 mt-0.5"},od={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],n=T(()=>{const i=s.opportunity.lastActivity||s.opportunity.createdAt;if(!i)return 0;const v=new Date(i),$=Math.abs(new Date-v);return Math.ceil($/(1e3*60*60*24))}),g=()=>{f("create-contract",s.opportunity)},u=i=>{f("survey-completed",{opportunity:s.opportunity,responses:i})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(i,v)=>(o(),a("div",ed,[e("div",td,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",sd,"This opportunity has been in negotiation for "+m(n.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),z(ke,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},ld={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},nd={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],n=()=>{f("schedule-closing",s.opportunity)},g=d=>{f("survey-completed",{opportunity:s.opportunity,responses:d})},u=()=>{f("survey-refused",{opportunity:s.opportunity})},c=()=>{f("not-responding",{opportunity:s.opportunity})};return(d,i)=>(o(),a("div",ld,[i[0]||(i[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:n,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),z(ke,{questions:l,onSurveyCompleted:g,onSurveyRefused:u,onNotResponding:c})]))}},ad={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},id={class:"flex justify-between items-start mb-3"},rd={class:"font-bold text-slate-800 text-sm"},dd={class:"text-xs text-gray-500 mt-0.5"},ud={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:k}){const s=t,f=k,l=T(()=>{var p;return((p=s.scheduledAppointment)==null?void 0:p.noShowCount)||0}),n=T(()=>{const p=l.value;return p===0?"No-Show Follow-up":p>=3?`No-Show #${p} - Final Warning`:`No-Show #${p} Follow-up`}),g=T(()=>{const p=l.value;return p>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":p>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),u=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],c=T(()=>{var w;return(w=s.scheduledAppointment)!=null&&w.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),d=()=>{f("contact-customer",s.opportunity)},i=()=>{l.value>=3?f("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${l.value} no-shows`}):f("reschedule",s.opportunity)},v=p=>{f("survey-completed",{opportunity:s.opportunity,responses:p})},h=()=>{f("survey-refused",{opportunity:s.opportunity})},$=()=>{f("not-responding",{opportunity:s.opportunity})};return(p,w)=>(o(),a("div",ad,[e("div",id,[e("div",null,[e("h4",rd,m(n.value),1),e("p",dd,"Appointment was scheduled for "+m(c.value)+" but customer did not show up. "+m(g.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:i,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...w[0]||(w[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),V(" Book Another Appointment ",-1)])]),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),V(" Contact Customer ",-1)])])]),z(ke,{questions:u,onSurveyCompleted:v,onSurveyRefused:h,onNotResponding:$})]))}},cd={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},md={class:"flex justify-between items-start mb-3"},pd={class:"text-xs text-gray-500 mt-0.5"},yd={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],n=T(()=>{var p;if(!((p=s.opportunity)!=null&&p.contractDate))return 0;const v=new Date(s.opportunity.contractDate),$=Math.abs(new Date-v);return Math.ceil($/(1e3*60*60*24))}),g=()=>{f("prepare-delivery",s.opportunity)},u=()=>{f("pre-delivery-checklist",s.opportunity)},c=v=>{f("survey-completed",{opportunity:s.opportunity,responses:v})},d=()=>{f("survey-refused",{opportunity:s.opportunity})},i=()=>{f("not-responding",{opportunity:s.opportunity})};return(v,h)=>(o(),a("div",cd,[e("div",md,[e("div",null,[h[0]||(h[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",pd,"Contract was signed "+m(n.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),z(ke,{questions:l,onSurveyCompleted:c,onSurveyRefused:d,onNotResponding:i})]))}},fd={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},gd={class:"flex justify-between items-start mb-3"},vd={class:"text-xs text-gray-500 mt-0.5"},bd={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:k}){const s=t,f=k,l=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],n=T(()=>{const i=s.activities.find(p=>{var w;return p.type==="delivery"||((w=p.action)==null?void 0:w.toLowerCase().includes("delivered"))});if(!i||!i.timestamp)return 0;const v=new Date(i.timestamp),$=Math.abs(new Date-v);return Math.ceil($/(1e3*60*60*24))}),g=()=>{f("delivery-feedback",s.opportunity)},u=i=>{f("survey-completed",{opportunity:s.opportunity,responses:i})},c=()=>{f("survey-refused",{opportunity:s.opportunity})},d=()=>{f("not-responding",{opportunity:s.opportunity})};return(i,v)=>(o(),a("div",fd,[e("div",gd,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",vd,"Vehicle was delivered "+m(n.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:g,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),z(ke,{questions:l,onSurveyCompleted:u,onSurveyRefused:c,onNotResponding:d})]))}},xd={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},hd={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:k}){const s=t,f=k,l=()=>{f("close-won",s.opportunity)},n=()=>{f("close-lost",s.opportunity)};return(g,u)=>(o(),a("div",xd,[u[2]||(u[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...u[0]||(u[0]=[V(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:n,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...u[1]||(u[1]=[V(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},wd={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},kd={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},$d={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},Cd={class:"p-5 space-y-6"},Sd={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Dd={class:"flex gap-3"},Ad={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},Td={class:"flex items-start gap-3"},Od={class:"flex-1"},Vd={class:"font-bold text-slate-800 text-sm mb-1"},Id={key:0},Nd={key:1},Rd={class:"text-xs text-gray-600"},jd={key:0},qd={key:1},Md={key:2},Ud={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Ld={key:3},Fd={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Ed={class:"flex justify-between items-start mb-3"},Bd={class:"text-xs text-gray-500 mt-0.5"},Wd={class:"flex gap-3 flex-wrap"},Pd={key:4,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},zd={class:"flex justify-between items-start mb-3"},Qd={class:"text-xs text-gray-500 mt-0.5"},Yd={key:0,class:"pt-4"},Hd={key:5,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},Kd={key:6,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Gd={class:"flex justify-between items-start mb-3"},Jd={class:"text-xs text-gray-500 mt-0.5"},Xd={key:13,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},Zd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},_d={class:"p-6"},eu={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},tu={class:"p-6"},su={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity","vehicle-selected"],setup(t,{emit:k}){const s=t,f=k,l=T(()=>{var b,C,E;return((b=s.opportunity)==null?void 0:b.stage)==="Closed"||((C=s.opportunity)==null?void 0:C.stage)==="Closed Lost"||((E=s.opportunity)==null?void 0:E.stage)==="Registration"}),n=S(!1),g=S(!1),u=S(null),c=S(!1),d=S(""),i=S(!1),v=S(!1),h=S(!1),$=S(!1),p=S(!1),w=S(!1),q=S([]),N=T(()=>{var b;return((b=s.activities)==null?void 0:b.some(C=>C.type==="offer"))||!1}),x=Ze(),A=rt(),D=Fe();he(()=>{q.value=xe.filter(b=>b.stockDays!==null&&b.stockDays!==void 0).slice(0,5).map(b=>({id:b.id,brand:b.brand,model:b.model,year:b.year,price:b.price,image:b.image||"",stockDays:b.stockDays}))});const R=b=>{d.value=b,c.value=!0},X=b=>b?new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",K=b=>b?new Date(b).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",me=()=>{n.value=!n.value},$e=b=>{n.value=!1},re=T(()=>{var _;if(!((_=s.opportunity)!=null&&_.createdAt))return 0;const b=new Date(s.opportunity.createdAt),E=Math.abs(new Date-b);return Math.ceil(E/(1e3*60*60*24))}),pe=T(()=>s.activities.some(b=>b.type==="appointment")),Ce=T(()=>{var E,_,J;const b=((E=s.opportunity)==null?void 0:E.contractDate)!==null&&((_=s.opportunity)==null?void 0:_.contractDate)!==void 0,C=s.activities.some(ce=>{var ee,oe;return((ee=ce.action)==null?void 0:ee.toLowerCase().includes("won"))||((oe=ce.action)==null?void 0:oe.toLowerCase().includes("contract"))});return b||C||((J=s.opportunity)==null?void 0:J.stage)==="Closed"}),G=T(()=>s.activities.some(b=>{var C,E;return b.type==="delivery"||((C=b.action)==null?void 0:C.toLowerCase().includes("delivered"))||((E=b.action)==null?void 0:E.toLowerCase().includes("delivery"))})),de=T(()=>{var C;if(((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||N.value||s.scheduledAppointment||pe.value)return!1;const b=re.value;return b>=7&&b<14}),Y=T(()=>{var C;return((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||N.value||s.scheduledAppointment||pe.value?!1:re.value>=14}),ue=T(()=>{var C;return((C=s.opportunity)==null?void 0:C.stage)!=="Qualified"||N.value||!s.scheduledAppointment?!1:re.value>=7}),le=T(()=>{const b=re.value;return b>=14?"high":b>=7?"medium":null}),Ae=T(()=>{var J;if(((J=s.opportunity)==null?void 0:J.stage)!=="In Negotiation")return!1;const b=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),E=Math.abs(new Date-b),_=Math.ceil(E/(1e3*60*60*24));return!Ce.value&&_>=5}),L=T(()=>{var oe,Te,et;if(((oe=s.opportunity)==null?void 0:oe.stage)!=="In Negotiation")return!1;const b=((Te=s.opportunity)==null?void 0:Te.contractDate)!==null&&((et=s.opportunity)==null?void 0:et.contractDate)!==void 0,C=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||pe.value&&s.activities.some(Ge=>{var tt;return Ge.type==="appointment"&&((tt=Ge.data)!=null&&tt.datetime)?new Date(Ge.data.datetime)>new Date:!1}),E=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),J=Math.abs(new Date-E);return Math.ceil(J/(1e3*60*60*24))>=5&&!b&&!C}),F=T(()=>{var ee,oe,Te;if(((ee=s.opportunity)==null?void 0:ee.stage)!=="Closed"&&((oe=s.opportunity)==null?void 0:oe.stage)!=="Registration")return!1;const b=(Te=s.opportunity)==null?void 0:Te.contractDate;if(!b||G.value)return!1;const C=new Date(b),_=Math.abs(new Date-C);return Math.ceil(_/(1e3*60*60*24))>=7}),P=T(()=>{const b=s.activities.find(ee=>{var oe;return ee.type==="delivery"||((oe=ee.action)==null?void 0:oe.toLowerCase().includes("delivered"))});if(!b)return!1;const C=new Date(b.timestamp),_=Math.abs(new Date-C);return Math.ceil(_/(1e3*60*60*24))>=3}),ae=T(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const E=s.activities.some(J=>{var ce,ee,oe;return J.type==="appointment"&&(((ce=J.data)==null?void 0:ce.status)==="completed"||((ee=J.action)==null?void 0:ee.toLowerCase().includes("completed")))&&((oe=J.data)==null?void 0:oe.appointmentId)===s.scheduledAppointment.id}),_=s.scheduledAppointment.status==="no-show";return!E&&!_}),te=T(()=>!l.value),se=T(()=>{var b,C,E;return!(((b=s.opportunity)==null?void 0:b.stage)!=="In Negotiation"||!((C=s.opportunity)!=null&&C.contractDate)||((E=s.opportunity)==null?void 0:E.stage)==="Closed")}),Ie=T(()=>{var J,ce,ee;if(((J=s.opportunity)==null?void 0:J.stage)!=="Closed"||!((ce=s.opportunity)!=null&&ce.contractDate)||G.value||((ee=s.opportunity)==null?void 0:ee.stage)==="Registration")return!1;const b=new Date(s.opportunity.contractDate),E=Math.abs(new Date-b);return Math.ceil(E/(1e3*60*60*24))>=7}),Ee=b=>{w.value=!1,f("vehicle-selected",{opportunity:s.opportunity,vehicleData:b})},Se=()=>{i.value=!0},Ne=()=>{i.value=!1},Be=b=>{i.value=!1,f("create-offer",{opportunity:s.opportunity,offerData:b})},We=b=>{R("Review Opportunity")},Pe=b=>{h.value=!0},ze=b=>{h.value=!1},Re=b=>{g.value=!0,u.value=b},ge=()=>{g.value=!1,u.value=null},fe=b=>{Re("nfu")},Qe=b=>{ge(),b.assigneeType==="team"?`${b.team}`:b.assignee;const C={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${b.type} on ${b.date} at ${b.time}${b.assigneeType==="team"?` (assigned to ${b.team} Team)`:""}`,data:{type:b.type,assignee:b.assignee,assigneeId:b.assigneeId,assigneeType:b.assigneeType,teamId:b.teamId,team:b.team,date:b.date,time:b.time,datetime:`${b.date}T${b.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};f("appointment-created",C)},Ye=b=>{$.value=!0},He=b=>{R("Pre-Delivery Checklist")},Ke=b=>{$.value=!1},je=b=>{R("Delivery Feedback")},qe=()=>{_e()},Me=()=>{v.value=!0},M=b=>{},r=b=>{v.value=!1},O=()=>{R("Contact Customer")},ye=b=>{},ve=b=>{},be=b=>{},mt=async()=>{try{await A.reopenOpportunity(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(b){console.error("Failed to reopen opportunity:",b)}},pt=async()=>{try{p.value=!1;const b=await A.convertOpportunityToLead(s.opportunity.id);D.canAccessLeads()?x.push({path:`/tasks/${b}`,query:{type:"lead"}}):x.push("/tasks/1")}catch(b){console.error("Failed to convert opportunity to lead:",b),p.value=!1}},yt=async()=>{try{await A.markAsRegistration(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(b){console.error("Failed to mark as registration:",b)}},_e=async()=>{try{await A.markAsClosedWon(s.opportunity.id),await A.loadOpportunityById(s.opportunity.id)}catch(b){console.error("Failed to mark as closed won:",b)}};return(b,C)=>t.opportunity?(o(),a("div",wd,[e("div",kd,[C[11]||(C[11]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",$d,m(l.value?"Closed":"Active"),1)]),e("div",Cd,[l.value?(o(),a("div",Sd,[C[14]||(C[14]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",Dd,[e("button",{onClick:mt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[12]||(C[12]=[V(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:C[0]||(C[0]=E=>p.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...C[13]||(C[13]=[V(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):y("",!0),ue.value?(o(),a("div",Ad,[e("div",Td,[C[15]||(C[15]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",Od,[e("h4",Vd,[le.value==="high"?(o(),a("span",Id,"High Risk")):(o(),a("span",Nd,"At Risk"))]),e("p",Rd,[le.value==="high"?(o(),a("span",jd," This opportunity has been open for "+m(re.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(o(),a("span",qd," This opportunity has been open for "+m(re.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):y("",!0),t.opportunity.stage==="Qualified"&&!t.opportunity.selectedVehicle?(o(),a("div",Md,[e("div",Ud,[C[17]||(C[17]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Select Vehicle"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," Choose a vehicle to create an offer for this opportunity ")])],-1)),e("button",{onClick:C[1]||(C[1]=E=>w.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[16]||(C[16]=[e("i",{class:"fa-solid fa-car mr-1"},null,-1),V(" Select Vehicle ",-1)])])])])):y("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.selectedVehicle&&!N.value?(o(),a("div",Ld,[e("div",Fd,[e("div",Ed,[e("div",null,[C[18]||(C[18]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Create Offer",-1)),e("p",Bd," Vehicle selected: "+m(t.opportunity.selectedVehicle.brand)+" "+m(t.opportunity.selectedVehicle.model)+" ("+m(t.opportunity.selectedVehicle.year)+") ",1)])]),e("div",Wd,[e("button",{onClick:Se,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[19]||(C[19]=[e("i",{class:"fa-solid fa-file-contract mr-1"},null,-1),V(" Create Offer ",-1)])]),e("button",{onClick:C[2]||(C[2]=E=>w.value=!0),class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...C[20]||(C[20]=[e("i",{class:"fa-solid fa-car mr-1"},null,-1),V(" Change Vehicle ",-1)])])])])])):y("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(o(),a("div",Pd,[e("div",zd,[e("div",null,[C[21]||(C[21]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",Qd,m(t.scheduledAppointment.title)+" on "+m(X(t.scheduledAppointment.start))+" at "+m(K(t.scheduledAppointment.start)),1)])]),e("button",{onClick:me,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),n.value?(o(),a("div",Yd,[z(Xi,{show:n.value,onClose:C[3]||(C[3]=E=>n.value=!1),onConfirm:$e},null,8,["show"])])):y("",!0)])):t.opportunity.stage==="Qualified"&&!pe.value?(o(),a("div",Hd,[C[22]||(C[22]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:C[4]||(C[4]=E=>Re("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):y("",!0),se.value?(o(),a("div",Kd,[e("div",Gd,[e("div",null,[C[23]||(C[23]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",Jd," Contract was signed on "+m(X(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:_e,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[24]||(C[24]=[V(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):y("",!0),ae.value?(o(),W(ud,{key:7,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:O,onReschedule:b.openRescheduleModal,onAutoCloseLost:M,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity","scheduled-appointment","onReschedule"])):y("",!0),Y.value?(o(),W(_r,{key:8,opportunity:t.opportunity,onCreateOffer:Se,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity"])):y("",!0),de.value?(o(),W(Gr,{key:9,opportunity:t.opportunity,onCreateOffer:Se,onReview:We,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity"])):y("",!0),L.value?(o(),W(nd,{key:10,opportunity:t.opportunity,onScheduleClosing:fe,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity"])):y("",!0),Ae.value?(o(),W(od,{key:11,opportunity:t.opportunity,onCreateContract:Pe,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity"])):y("",!0),F.value?(o(),W(yd,{key:12,opportunity:t.opportunity,onPrepareDelivery:Ye,onPreDeliveryChecklist:He,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity"])):y("",!0),Ie.value?(o(),a("div",Xd,[C[26]||(C[26]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:yt,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...C[25]||(C[25]=[V(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):y("",!0),P.value?(o(),W(bd,{key:14,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:je,onSurveyCompleted:ye,onSurveyRefused:ve,onNotResponding:be},null,8,["opportunity","activities"])):y("",!0),te.value?(o(),W(hd,{key:15,opportunity:t.opportunity,onCloseWon:qe,onCloseLost:Me},null,8,["opportunity"])):y("",!0)]),z(Zi,{show:c.value,title:d.value,onClose:C[5]||(C[5]=E=>c.value=!1)},null,8,["show","title"]),z(tr,{show:v.value,onConfirm:r,onCancel:C[6]||(C[6]=E=>v.value=!1)},null,8,["show"]),z(ur,{show:p.value,onConfirm:pt,onCancel:C[7]||(C[7]=E=>p.value=!1)},null,8,["show"]),z(nr,{show:h.value,onConfirm:ze,onCancel:C[8]||(C[8]=E=>h.value=!1)},null,8,["show"]),z(dr,{show:$.value,onConfirm:Ke,onCancel:C[9]||(C[9]=E=>$.value=!1)},null,8,["show"]),z(qr,{show:w.value,"requested-vehicle":t.opportunity.requestedCar||t.opportunity.vehicle||null,"opportunity-id":t.opportunity.id,onClose:C[10]||(C[10]=E=>w.value=!1),onVehicleSelected:Ee},null,8,["show","requested-vehicle","opportunity-id"]),(o(),W(Ve,{to:"body"},[i.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ie(Ne,["self"])},[e("div",Zd,[e("div",_d,[z(ut,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"selected-vehicle":t.opportunity.selectedVehicle||null,onSave:Be,onCancel:Ne},null,8,["task-id","selected-vehicle"])])])])):y("",!0)])),(o(),W(Ve,{to:"body"},[g.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ie(ge,["self"])},[e("div",eu,[e("div",tu,[z(ct,{show:g.value,onConfirm:Qe,onCancel:ge},null,8,["show"])])])])):y("",!0)]))])):y("",!0)}};function uu(t){const k=at(),s=rt(),f=T(()=>t.value?t.value.type==="lead"?Hi:su:null),l=T(()=>t.value?t.value.type==="lead"?{currentActivities:T(()=>k.currentLeadActivities),addActivity:(g,u)=>k.addActivity(g,u),updateActivity:(g,u,c)=>k.updateActivity(g,u,c),deleteActivity:(g,u)=>k.deleteActivity(g,u)}:{currentActivities:T(()=>s.currentOpportunityActivities),addActivity:(g,u)=>s.addActivity(g,u),updateActivity:(g,u,c)=>s.updateActivity(g,u,c),deleteActivity:(g,u)=>s.deleteActivity(g,u),addVehicle:(g,u)=>s.addVehicle(g,u),createOffer:(g,u)=>s.createOffer(g,u),loadOpportunityById:g=>s.loadOpportunityById(g)}:null),n=T(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:f,storeAdapter:l,addNewConfig:n}}export{ru as _,du as a,uu as u};
