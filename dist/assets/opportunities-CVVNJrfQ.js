const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CTlK_S4G.js","assets/index-CK6X0T0y.css"])))=>i.map(i=>d[i]);
import{d as T,r as v,c as w,a4 as V,a5 as g,a6 as m,a7 as W,a8 as f,a9 as $,aa as D,ab as Q,ac as j,ad as q,ae as z}from"./index-CTlK_S4G.js";const H=T("opportunities",()=>{const r=v([]),s=v(null),o=v([]),u=v(!1),n=v(null),y=v({stage:null,assignee:null,search:""}),x=w(()=>r.value.length),A=w(()=>{const e={};return r.value.forEach(a=>{e[a.stage]||(e[a.stage]=[]),e[a.stage].push(a)}),e}),b=w(()=>r.value.reduce((e,a)=>e+a.value,0));async function h(){u.value=!0,n.value=null;try{const e=await V(y.value);r.value=e.data}catch(e){n.value=e.message}finally{u.value=!1}}async function L(e){u.value=!0,n.value=null;try{s.value=await g(e),o.value=await m(e);const a=r.value.findIndex(t=>t.id===parseInt(e));a!==-1&&(r.value[a]=s.value)}catch(a){n.value=a.message}finally{u.value=!1}}async function I(e){u.value=!0,n.value=null;try{const a=await W(e);return r.value.unshift(a),a}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function S(e,a){u.value=!0,n.value=null;try{const t=await f(e,a),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function O(e){u.value=!0,n.value=null;try{await $(e),r.value=r.value.filter(a=>a.id!==e)}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function d(e,a){try{const t=await D(e,a);return o.value.unshift(t),t}catch(t){throw n.value=t.message,t}}async function _(e,a,t){try{const i=await Q(e,a,t),l=o.value.findIndex(c=>c.id===parseInt(a));return l!==-1&&(o.value[l]=i),i}catch(i){throw n.value=i.message,i}}async function k(e,a){try{return await j(e,a),o.value=o.value.filter(t=>t.id!==parseInt(a)),{success:!0}}catch(t){throw n.value=t.message,t}}function F(e){y.value={...y.value,...e},h()}async function R(e){var a;u.value=!0,n.value=null;try{const t=r.value.find(p=>p.id===e)||s.value,i={stage:"Qualified"};((t==null?void 0:t.probability)===0||(t==null?void 0:t.probability)===100)&&(i.probability=50);const l=await f(e,i),c=r.value.findIndex(p=>p.id===e);return c!==-1&&(r.value[c]=l),((a=s.value)==null?void 0:a.id)===e&&(s.value=l),await d(e,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${l.stage} stage`}),l}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function B(e){var a;u.value=!0,n.value=null;try{const t=await f(e,{stage:"Registration"}),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function C(e){var a;u.value=!0,n.value=null;try{const t=await f(e,{stage:"Closed",probability:100}),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function E(e,a){u.value=!0,n.value=null;try{const t=await q(e,a);return r.value.unshift(t),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function Y(e){u.value=!0,n.value=null;try{const a=await g(e),t=await m(e),{useLeadsStore:i}=await z(async()=>{const{useLeadsStore:p}=await import("./index-CTlK_S4G.js").then(P=>P.af);return{useLeadsStore:p}},__vite__mapDeps([0,1])),c=await i().createLeadFromOpportunity(a,t);return await O(e),c.id}catch(a){throw n.value=a.message,a}finally{u.value=!1}}return{opportunities:r,currentOpportunity:s,currentOpportunityActivities:o,loading:u,error:n,filters:y,totalOpportunities:x,opportunitiesByStage:A,totalValue:b,loadOpportunities:h,loadOpportunityById:L,addOpportunity:I,modifyOpportunity:S,removeOpportunity:O,addActivity:d,updateActivity:_,deleteActivity:k,setFilters:F,reopenOpportunity:R,markAsRegistration:B,markAsClosedWon:C,createOpportunityFromLead:E,convertOpportunityToLead:Y}});export{H as useOpportunitiesStore};
