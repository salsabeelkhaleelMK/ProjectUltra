import{H as se,R as me,a5 as We,h as _e,C as He,c as j,d as V,o as g,e,x as H,g as L,B as i,s,y as t,n as W,t as D,F as K,i as J,I as Pe,r as F,J as ze,w as ke,p as ye,T as Qe,k as v,m as Ce,l as ae,K as Ae,aa as Ye,D as Ge,u as Ke,a4 as Ze,W as xe,ar as Je,as as Xe,at as et,au as tt,M as oe,q as lt,ae as st,Q as ot,af as at}from"./index-BcuDIK-O.js";import{u as nt}from"./opportunities-Bp4brFAh.js";import{n as N,$ as rt,f as ne,F as re,L as ie,g as de,h as ue,Q as I,o as ge,C as we,d as ce,W as X,U as ee,H as te,j as q,G as le,c as R,p as pe,z as it}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-Oem9_7mP.js";import{S as dt}from"./sparkles-DCtJyGxr.js";import{f as ut,u as ct}from"./vehicles-C-_b7mCD.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=se("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=se("CheckCircleIcon",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=se("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=se("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=se("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=se("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=se("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=se("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=se("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=se("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=se("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=se("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function zn(l){if(!l)return"";const n=new Date(l),a=new Date;if(n<a)return"OVERDUE";if(n.toDateString()===a.toDateString()){const f=n-a,p=Math.floor(f/(1e3*60*60)),y=Math.floor(f%(1e3*60*60)/(1e3*60));return p>0?`${p}h ${y}m`:`${y}m`}return n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function jn(l){return(typeof l=="string"?new Date(l):l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Wn(l){return(typeof l=="string"?new Date(l):l).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function qe(l){return(l==null?void 0:l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function _n(l){if(!l)return"No deadline";const n=new Date(l);if(n<new Date)return"OVERDUE";const o=n.toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${o}, ${f}`}function Hn(l){if(!l)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const n=new Date(l),a=new Date,o=(n-a)/(1e3*60*60);if(o<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(o<2){const f=Math.floor((n-a)/6e4),p=Math.floor(f/60),y=f%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:p>0?`${p}h ${y}m`:`${y}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(o<24){const f=Math.floor(o),p=Math.floor((o-f)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${f}h ${p}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const f=Math.ceil(o/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${f} day${f!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function Qn(l){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[l]||"bg-gray-100 text-gray-700"}function Yn(l){return l?new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const Ve={[me.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[me.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:l=>!!(l.callbackDate||l.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[me.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[me.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[me.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[me.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Ee={toClosed:(l,n,a)=>{const o={isDisqualified:!0,disqualifyReason:(a==null?void 0:a.reason)||null,disqualifyCategory:(a==null?void 0:a.category)||null,scheduledAppointment:null,nextActionDue:null};(a==null?void 0:a.reason)==="Duplicate"?(o.isDuplicate=!0,o.stage="Closed Failed"):(a==null?void 0:a.category)==="Not Interested"?o.stage="Not Interested":o.stage="Not Valid",o.status="Disqualified";const f=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(a==null?void 0:a.category)||"Unknown"}, Reason: ${(a==null?void 0:a.reason)||"Unknown"}`}];return l.scheduledAppointment&&f.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:l.scheduledAppointment}}),{updates:o,activities:f}},reopen:l=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Gn(l,n){return n.startsWith("Closed")?Ee.toClosed:l.startsWith("Closed")&&!n.startsWith("Closed")?Ee.reopen:null}const Le={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:l=>l.scheduledAppointment&&l.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:n=>{const a=new Date(n.scheduledAppointment.start);return`Appointment scheduled for ${n.formatDateTime?n.formatDateTime(n.scheduledAppointment.start):a.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"reschedule",title:"Reschedule Appointment",description:l=>l.scheduledAppointment&&l.scheduledAppointment.start?`Scheduled for ${l.formatDateTime?l.formatDateTime(l.scheduledAppointment.start):new Date(l.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:"Reschedule",icon:"fa-solid fa-calendar-days",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"In Negotiation":{primaryAction:l=>l.hasOffers?null:{key:"create-offer",title:"Create Offer",description:"Create initial offer to begin negotiation",label:"Create Offer",icon:"fa-solid fa-file-invoice-dollar",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"reassign",label:"Reassign",icon:"fa-solid fa-user-group",description:"Assign this opportunity to another sales rep"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"In Negotiation - Offer Sent":{primaryAction:null,secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation - Contract Pending":{primaryAction:l=>{const n=l.opportunity,a=!!n.deliveryDate,o=!!n.contractSigned||!!n.esignatureCollectedDate;return a&&!o?{key:"collect-esignatures",title:"Collect e-signatures",description:"Get the formal contract signed electronically by the customer",label:"Collect e-signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}}:a?null:{key:"set-delivery-date",title:"Set Delivery Date",description:"Schedule the delivery date for the vehicle",label:"Set Delivery Date",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"add-offer",label:"Create Another Offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create an additional offer if terms need adjustment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-pending-5-plus-days"}]},"Closed Won":{primaryAction:l=>{const n=l.deliverySubstatus;return n==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback or complete delivery checklist",label:"Confirm Satisfaction",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:n==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Request Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered",description:"Collect customer feedback about delivery experience"},{key:"complete-checklist",label:"Complete Checklist",icon:"fa-solid fa-clipboard-check",conditional:"is-delivered",description:"Complete post-delivery checklist and documentation"},{key:"reschedule-delivery",label:"Reschedule",icon:"fa-solid fa-calendar-days",conditional:"is-awaiting-delivery",description:"Reschedule the delivery date"},{key:"archive",label:"Archive",icon:"fa-solid fa-archive",conditional:"is-delivered",description:"Archive this completed opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"closed-won-contract-feedback"},{type:"DFB",condition:"delivery-delay-feedback-required"},{type:"DFB",condition:"delivery-feedback-required"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Me={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},wt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},kt={class:"flex items-center justify-between gap-2 mb-4"},Ct={class:"flex flex-col"},Vt={class:"space-y-3"},St={class:"flex items-start justify-between gap-2"},$t={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Tt={class:"flex items-start justify-between gap-2"},It={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},At={class:"flex items-center justify-between gap-2"},Dt={class:"flex items-center gap-1 min-w-0 flex-1 justify-end"},Mt={class:"text-sm font-medium text-foreground leading-5 text-right truncate min-w-0"},Pt={key:0,class:"flex items-start justify-between gap-2"},Lt={class:"text-sm font-medium text-foreground leading-5 text-right wrap-break-word min-w-0 flex-1"},Ot={key:0,class:"mt-4 pt-4 border-t border-border"},Ft={class:"space-y-0.5"},Ut=["onClick"],Rt={class:"text-sm font-medium text-foreground truncate shrink-0 min-w-0"},Nt={class:"text-sm text-muted-foreground truncate flex-1 min-w-0"},qt={key:0,class:"text-sm font-bold text-foreground shrink-0"},Et={class:"text-sm text-muted-foreground shrink-0"},Kn={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(l){const n=l,a=We(),o=_e(),f=He(),p=nt();j(()=>n.task.negotiations||n.task.activeNegotiations||0);const y=j(()=>{if(!n.task.customer)return[];const T=n.task.customer.email,u=n.task.customer.phone,B=n.task.compositeId;return[...(f.leads||[]).map(E=>({...E,type:"lead",compositeId:`lead-${E.id}`})),...(p.opportunities||[]).map(E=>({...E,type:"opportunity",compositeId:`opportunity-${E.id}`}))].filter(E=>E.compositeId===B||!E.customer?!1:E.customer.email===T||E.customer.phone===u).sort((E,A)=>new Date(A.createdAt||0)-new Date(E.createdAt||0)).slice(0,3)}),d=async(T,u)=>{if(T)try{await navigator.clipboard.writeText(T),a.pushToast("success",`${u==="email"?"Email":"Phone"} copied!`)}catch{a.pushToast("error","Failed to copy")}},h=()=>{var u;const T=((u=n.task.customer)==null?void 0:u.id)||n.customerId;if(T){const B=o.resolve(`/customer/${T}`).href;window.open(B,"_blank")}},S=T=>{const[u,B]=T.compositeId.split("-");o.push({path:`/tasks/${B}`,query:{type:u}})},m=T=>T.stage||T.currentStage||"Unknown",k=T=>{const u=T.createdAt||T.nextActionDue||T.updatedAt;if(!u)return"";try{return new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},c=T=>{const u=T.requestedCar||T.vehicle;if(!u)return"No vehicle";const B=u.brand||"",Y=u.model||"",E=u.year?`(${u.year})`:"";return`${B} ${Y} ${E}`.trim()||"Vehicle info N/A"},C=T=>T?T>=1e3?"€"+(T/1e3).toFixed(0)+"k":"€"+T:"€0";return(T,u)=>{var B,Y,E,A,b,P;return g(),V("div",wt,[e("div",kt,[u[1]||(u[1]=e("h3",{class:"text-base font-medium text-foreground leading-6"},"Customer information",-1)),(B=l.task.customer)!=null&&B.id?(g(),H(t(N),{key:0,variant:"ghost",size:"icon",onClick:h,class:W("h-7 w-7"),title:"Open customer profile in new tab"},{default:i(()=>[s(t(pt),{size:14,class:"text-muted-foreground"})]),_:1})):L("",!0)]),e("div",Ct,[e("div",Vt,[e("div",St,[u[2]||(u[2]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Customer",-1)),e("p",$t,D(((Y=l.task.customer)==null?void 0:Y.name)||"Unknown"),1)]),e("div",Tt,[u[3]||(u[3]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Email",-1)),e("p",It,D(((E=l.task.customer)==null?void 0:E.email)||"N/A"),1)]),e("div",At,[u[4]||(u[4]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Phone",-1)),e("div",Dt,[e("p",Mt,D(((A=l.task.customer)==null?void 0:A.phone)||"N/A"),1),(b=l.task.customer)!=null&&b.phone?(g(),H(t(N),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 shrink-0 text-muted-foreground hover:text-foreground",title:"Copy phone number",onClick:u[0]||(u[0]=w=>d(l.task.customer.phone,"phone"))},{default:i(()=>[s(t(mt),{size:14})]),_:1})):L("",!0)])]),(P=l.task.customer)!=null&&P.address?(g(),V("div",Pt,[u[5]||(u[5]=e("p",{class:"text-sm text-muted-foreground leading-5 shrink-0"},"Address",-1)),e("p",Lt,D(l.task.customer.address),1)])):L("",!0)]),y.value.length>0?(g(),V("div",Ot,[u[6]||(u[6]=e("h3",{class:"text-base font-medium text-foreground mb-4 leading-6"},"Other customer requests",-1)),e("div",Ft,[(g(!0),V(K,null,J(y.value,w=>(g(),V("div",{key:w.compositeId,onClick:x=>S(w),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:W(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",w.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},D(w.type==="lead"?"Lead":"Opp"),3),e("span",Rt,D(m(w)),1),e("span",Nt,D(c(w)),1),w.type==="opportunity"&&w.estimatedValue?(g(),V("span",qt,D(C(w.estimatedValue)),1)):L("",!0),e("span",Et,D(k(w)),1)],8,Ut))),128))])])):L("",!0)])])}}},Bt={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},zt={class:"mb-4"},jt={class:"flex items-center justify-between mb-2"},Wt={class:"flex items-center gap-2 flex-wrap"},_t={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},Ht={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},Qt={class:"relative"},Yt={class:"space-y-6 flex-1 flex flex-col min-h-0"},Gt={key:0,class:"flex-1 overflow-y-auto min-h-0"},Kt={class:"flex flex-col items-start gap-1 mb-4"},Zt={class:"text-sm font-normal text-muted-foreground leading-normal"},Jt={class:"space-y-4"},Xt=["onClick"],el={class:"flex-1 min-w-0"},tl={class:"flex items-start justify-between gap-2"},ll={class:"text-sm text-foreground flex-1 wrap-break-word min-w-0 leading-normal"},sl={key:0,class:"text-muted-foreground"},ol={key:1,class:"text-muted-foreground"},al={key:2,class:"text-muted-foreground"},nl={key:3,class:"text-muted-foreground"},rl={key:4,class:"text-muted-foreground"},il={key:5,class:"text-muted-foreground"},dl={key:6,class:"text-muted-foreground"},ul={class:"text-sm text-muted-foreground text-right shrink-0 w-14 leading-normal"},cl={key:0,class:"mt-2 bg-amber-50 rounded-lg p-4 backdrop-blur-sm"},fl={class:"text-sm text-foreground wrap-break-word leading-normal"},ml={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},pl={class:"text-sm text-foreground wrap-break-word leading-normal"},vl={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},yl={class:"text-sm text-foreground wrap-break-word leading-normal"},gl={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},bl={class:"text-sm text-foreground wrap-break-word leading-normal"},hl={key:0,class:"flex items-center gap-2 flex-wrap"},xl={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},wl={class:"text-center"},kl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(l,{emit:n}){const a=l,o=n,f=F(!1),p=F(!1),y=F(null),d=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],h=F([]),S=()=>{p.value=!p.value},m=A=>{p.value=!1;const b=h.value.indexOf(A);b>-1?h.value.splice(b,1):h.value.push(A)},k=A=>{const b=h.value.indexOf(A);b>-1&&h.value.splice(b,1)},c=A=>{const b=d.find(P=>P.value===A);return b?b.label:A},C=j(()=>d.map(A=>({key:A.value,label:A.label,onClick:()=>m(A.value),className:h.value.includes(A.value)?"filter-item-selected":""}))),T=A=>A.important||A.isImportant?"important":["email","sms","whatsapp","call"].includes(A.type)?"communications":A.type==="note"?"notes":A.type==="transcription"||A.transcription?"transcriptions":A.type==="system"||A.type==="created"||A.type==="status"?"system-updates":null,u=j(()=>{let A=[...a.activities];return h.value.length>0&&(A=A.filter(b=>{const P=T(b);return P&&h.value.includes(P)})),A.sort((b,P)=>{const w=new Date(b.timestamp||b.createdAt||0).getTime();return new Date(P.timestamp||P.createdAt||0).getTime()-w})}),B=A=>{if(!A||A.length===0)return"";const b=A[0],P=b.timestamp||b.createdAt;if(!P)return"Recent Activity";const w=new Date(P),x=new Date,M=new Date(x);return M.setDate(M.getDate()-1),w.toDateString()===x.toDateString()?"Today":w.toDateString()===M.toDateString()?"Yesterday":w.toLocaleDateString("en-US",{month:"long",day:"numeric",year:w.getFullYear()!==x.getFullYear()?"numeric":void 0})},Y=A=>{["note","email","whatsapp"].includes(A.type)&&o("activity-click",A)},E=A=>{f.value=!1,o("add-activity",A)};return(A,b)=>{const P=ze("click-outside");return g(),V("div",Bt,[e("div",zt,[e("div",jt,[b[27]||(b[27]=e("h3",{class:"text-base font-medium text-foreground leading-6"},"Activity",-1)),e("div",Wt,[e("div",{class:"relative",ref_key:"filterContainer",ref:y},[s(t(N),{variant:"outline",size:"icon",onClick:ke(S,["stop"]),class:"relative w-8 h-8"},{default:i(()=>[b[12]||(b[12]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),h.value.length>0?(g(),V("span",_t)):L("",!0)]),_:1}),s(Qe,{name:"dropdown"},{default:i(()=>[p.value?ye((g(),V("div",Ht,[s(t(rt),{items:C.value,className:"w-56"},null,8,["items"])])),[[P,()=>p.value=!1]]):L("",!0)]),_:1})],512),e("div",Qt,[s(t(N),{variant:"default",size:"icon",onClick:b[0]||(b[0]=ke(w=>f.value=!f.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:i(()=>[...b[13]||(b[13]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),f.value?ye((g(),V("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1 z-50",onClick:b[11]||(b[11]=ke(()=>{},["stop"]))},[e("button",{onClick:b[1]||(b[1]=w=>E("email")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[14]||(b[14]=[e("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),v(" Email ",-1)])]),e("button",{onClick:b[2]||(b[2]=w=>E("sms")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[15]||(b[15]=[e("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),v(" SMS ",-1)])]),e("button",{onClick:b[3]||(b[3]=w=>E("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[16]||(b[16]=[e("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),v(" WhatsApp ",-1)])]),e("button",{onClick:b[4]||(b[4]=w=>E("call")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[17]||(b[17]=[e("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),v(" Call ",-1)])]),b[24]||(b[24]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:b[5]||(b[5]=w=>E("note")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[18]||(b[18]=[e("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),v(" Note ",-1)])]),e("button",{onClick:b[6]||(b[6]=w=>E("attachment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[19]||(b[19]=[e("i",{class:"fa-solid fa-paperclip text-sm text-muted-foreground"},null,-1),v(" Attachment ",-1)])]),b[25]||(b[25]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:b[7]||(b[7]=w=>E("financing")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[20]||(b[20]=[e("i",{class:"fa-solid fa-file-invoice-dollar text-sm text-primary"},null,-1),v(" Financing ",-1)])]),e("button",{onClick:b[8]||(b[8]=w=>E("tradein")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[21]||(b[21]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sm text-primary"},null,-1),v(" Trade-in ",-1)])]),e("button",{onClick:b[9]||(b[9]=w=>E("purchase")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[22]||(b[22]=[e("i",{class:"fa-solid fa-handshake text-sm text-primary"},null,-1),v(" Offer ",-1)])]),b[26]||(b[26]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:b[10]||(b[10]=w=>E("appointment")),class:"w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2"},[...b[23]||(b[23]=[e("i",{class:"fa-regular fa-calendar text-sm text-purple-600"},null,-1),v(" Appointment ",-1)])])])),[[P,()=>f.value=!1]]):L("",!0)])])])]),e("div",Yt,[u.value.length>0?(g(),V("div",Gt,[e("div",Kt,[e("h3",Zt,D(B(u.value)),1)]),e("div",Jt,[(g(!0),V(K,null,J(u.value,w=>(g(),V("div",{key:w.id,class:"space-y-2"},[e("div",{class:W(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":w.type==="note"||w.type==="email"||w.type==="whatsapp"}]),onClick:x=>Y(w)},[e("div",{class:W(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",w.type==="note"?"bg-orange-100":w.type==="call"?"bg-green-100":w.type==="ai-summary"?"bg-purple-100":w.type==="email"?"bg-blue-100":w.type==="whatsapp"?"bg-green-100":"bg-muted"])},[w.type==="note"?(g(),H(t(xt),{key:0,size:16,class:"text-orange-600"})):w.type==="call"?(g(),H(t(ht),{key:1,size:16,class:"text-green-600"})):w.type==="ai-summary"?(g(),H(t(dt),{key:2,size:16,class:"text-purple-600"})):w.type==="email"?(g(),H(t(yt),{key:3,size:16,class:"text-blue-600"})):w.type==="whatsapp"?(g(),H(t(gt),{key:4,size:16,class:"text-green-600"})):(g(),H(t(vt),{key:5,size:16,class:"text-foreground"}))],2),e("div",el,[e("div",tl,[e("p",ll,[e("span",{class:W(["font-normal",w.type==="ai-summary"?"font-medium":""])},D(w.type==="ai-summary"?"MotorKAI":w.user),3),w.type==="note"?(g(),V("span",sl," added a note")):w.type==="created"?(g(),V("span",ol,D(w.message||w.action),1)):w.type==="call"?(g(),V("span",al,D(" "+(w.message||w.action)),1)):w.type==="ai-summary"?(g(),V("span",nl," summary")):w.type==="email"?(g(),V("span",rl,D(" sent an email"))):w.type==="whatsapp"?(g(),V("span",il,D(" sent a WhatsApp message"))):(g(),V("span",dl,D(" "+(w.message||w.action)),1))]),e("p",ul,D(w.time),1)]),w.type==="note"&&(w.message||w.content)?(g(),V("div",cl,[e("p",fl,D(w.message||w.content),1)])):L("",!0),w.type==="email"&&w.content?(g(),V("div",ml,[e("p",pl,D(w.content),1)])):L("",!0),w.type==="whatsapp"&&w.content?(g(),V("div",vl,[e("p",yl,D(w.content),1)])):L("",!0),w.type==="ai-summary"&&(w.message||w.content)?(g(),V("div",gl,[e("p",bl,D(w.message||w.content),1)])):L("",!0)])],10,Xt)]))),128)),h.value.length>0?(g(),V("div",hl,[(g(!0),V(K,null,J(h.value,w=>(g(),V("div",{key:w,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-muted text-sm font-medium text-foreground border border-border"},[e("span",null,D(c(w)),1),s(t(N),{variant:"ghost",size:"icon",onClick:x=>k(w),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:i(()=>[...b[28]||(b[28]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):L("",!0)])])):(g(),V("div",xl,[e("div",wl,[s(t(ft),{size:32,class:"mx-auto text-muted-foreground mb-2"}),b[29]||(b[29]=e("p",{class:"text-sm text-muted-foreground"},"No activity yet",-1))])]))])])}}},Zn=Pe(kl,[["__scopeId","data-v-cc936425"]]),Cl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Vl={class:"space-y-2"},Sl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},$l={key:1,class:"flex justify-between items-center mb-4"},Tl={class:"text-sm font-semibold text-foreground"},Il={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Jn={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(l,{expose:n,emit:a}){const o=l,f=a,p=F(""),y=F(!1);Ce(()=>{o.item&&(p.value=o.item.content||o.item.message||"")}),ae(()=>o.item,m=>{m&&(p.value=m.content||m.message||"")},{deep:!0}),ae(()=>o.show,m=>{o.modal&&!m&&setTimeout(()=>{p.value=o.item&&(o.item.content||o.item.message)||"",y.value=!1},300)});const d=async()=>{var m,k;if(p.value.trim()){y.value=!0;try{const c={id:((m=o.item)==null?void 0:m.id)||Date.now(),type:"note",action:o.item?"updated a note":"added a note",content:p.value,message:p.value,timestamp:((k=o.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",c),o.modal&&f("close")}finally{y.value=!1}}},h=()=>{f("cancel"),o.modal&&f("close")},S=m=>{m||f("close")};return n({submit:d,canSubmit:()=>!!p.value.trim()}),(m,k)=>l.modal?(g(),H(t(ce),{key:0,open:l.show,"onUpdate:open":S},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[v(D(l.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),e("div",Cl,[e("div",Vl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...k[2]||(k[2]=[v(" Note ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),s(t(ge),{modelValue:p.value,"onUpdate:modelValue":k[0]||(k[0]=c=>p.value=c),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:h}),s(t(N),{label:y.value?"Saving...":l.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value.trim()||y.value,onClick:d},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(g(),V("div",{key:1,class:W(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!l.hideHeader}])},[l.hideHeader?L("",!0):(g(),V("div",Sl)),l.hideHeader?L("",!0):(g(),V("div",$l,[e("h5",Tl,D(l.item?"Edit Note":"Add Note"),1),e("button",{onClick:h,class:"text-muted-foreground hover:text-muted-foreground"},[...k[3]||(k[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[k[4]||(k[4]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Note",-1)),ye(e("textarea",{"onUpdate:modelValue":k[1]||(k[1]=c=>p.value=c),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[Ae,p.value]])]),l.hideActions?L("",!0):(g(),V("div",Il,[s(t(N),{label:"Cancel",variant:"outline",size:"small",onClick:h}),s(t(N),{label:"Save",variant:"primary",size:"small",onClick:d})]))],2))}},Al={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Dl={class:"space-y-2"},Ml={class:"flex items-center gap-3"},Pl={key:0,class:"text-sm text-muted-foreground truncate"},Ll={key:1,class:"text-sm text-muted-foreground"},Ol={key:1,class:"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6 animate-fade-in relative"},Fl={class:"flex justify-between items-center mb-4"},Ul={class:"text-sm font-semibold text-foreground"},Rl={class:"flex items-center gap-3"},Nl={key:0,class:"text-sm text-slate-600"},ql={key:1,class:"text-sm text-muted-foreground"},El={class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Xn={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(l,{expose:n,emit:a}){const o=l,f=a,p=F(null),y=F(""),d=F(!1),h=F(null);Ce(()=>{o.item&&(y.value=o.item.fileName||"")}),ae(()=>o.item,C=>{C&&(y.value=C.fileName||"")},{deep:!0}),ae(()=>o.show,C=>{o.modal&&!C&&setTimeout(()=>{p.value=null,y.value=o.item&&o.item.fileName||"",d.value=!1},300)});const S=C=>{const T=C.target.files[0];T&&(p.value=T,y.value=T.name)},m=async()=>{var C,T;if(!(!p.value&&!o.item)){d.value=!0;try{const u={id:((C=o.item)==null?void 0:C.id)||Date.now(),type:"attachment",action:o.item?"updated an attachment":"added an attachment",fileName:y.value,file:p.value,timestamp:((T=o.item)==null?void 0:T.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",u),o.modal&&f("close")}finally{d.value=!1}}},k=()=>{f("cancel"),o.modal&&f("close")},c=C=>{C||f("close")};return n({submit:m,canSubmit:()=>!!p.value||!!o.item}),(C,T)=>l.modal?(g(),H(t(ce),{key:0,open:l.show,"onUpdate:open":c},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[v(D(l.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),e("div",Al,[e("div",Dl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...T[2]||(T[2]=[v(" File ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),e("div",Ml,[e("input",{type:"file",onChange:S,ref_key:"fileInput",ref:h,class:"hidden"},null,544),s(t(N),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:T[0]||(T[0]=u=>{var B;return(B=h.value)==null?void 0:B.click()})}),y.value?(g(),V("span",Pl,D(y.value),1)):(g(),V("span",Ll,"No file selected"))])])]),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),s(t(N),{label:d.value?"Saving...":l.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value||d.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(g(),V("div",Ol,[T[5]||(T[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),e("div",Fl,[e("h5",Ul,D(l.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:k,class:"text-muted-foreground hover:text-muted-foreground"},[...T[3]||(T[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[T[4]||(T[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Rl,[e("input",{type:"file",onChange:S,ref_key:"fileInput",ref:h,class:"hidden"},null,544),s(t(N),{label:"Choose File",variant:"outline",size:"small",onClick:T[1]||(T[1]=u=>C.$refs.fileInput.click())}),y.value?(g(),V("span",Nl,D(y.value),1)):(g(),V("span",ql,"No file selected"))])]),e("div",El,[s(t(N),{label:"Cancel",variant:"outline",size:"small",onClick:k}),s(t(N),{label:"Save",variant:"primary",size:"small",disabled:!p.value,onClick:m},null,8,["disabled"])])]))}},Bl={class:"space-y-6"},zl={class:"space-y-2"},jl={class:"space-y-2"},Wl={class:"flex justify-end gap-3"},_l={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:n}){const a=l,o=n,f=F(a.initialTemplate),p=F(a.initialMessage),y={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},d=()=>{f.value&&y[f.value]&&(p.value=y[f.value])},h=()=>{p.value.trim()&&o("send",{type:"whatsapp",template:f.value,message:p.value})};return(S,m)=>(g(),V("div",Bl,[e("div",zl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),s(t(le),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=k=>f.value=k),d]},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select a template..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),s(t(q),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),s(t(q),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),s(t(q),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",jl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),s(t(ge),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=k=>p.value=k),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Wl,[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=k=>S.$emit("cancel"))}),s(t(N),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:h})])]))}},er={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:n}){const a=n,o=p=>{a("save",p),a("close")},f=p=>{p||a("close")};return(p,y)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":f},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[s(t(de),null,{default:i(()=>[s(t(ue),null,{default:i(()=>[...y[1]||(y[1]=[v("Send WhatsApp Message",-1)])]),_:1})]),_:1}),s(_l,{onSend:o,onCancel:y[0]||(y[0]=d=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Hl={class:"space-y-6"},Ql={class:"space-y-2"},Yl={class:"space-y-2"},Gl={class:"text-xs text-muted-foreground mt-1"},Kl={class:"flex justify-end gap-3"},Zl={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:n}){const a=l,o=n,f=F(a.initialTemplate),p=F(a.initialMessage),y={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},d=()=>{f.value&&y[f.value]&&(p.value=y[f.value])},h=()=>{p.value.trim()&&o("send",{type:"sms",template:f.value,message:p.value})};return(S,m)=>(g(),V("div",Hl,[e("div",Ql,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),s(t(le),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=k=>f.value=k),d]},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select a template..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),s(t(q),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),s(t(q),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),s(t(q),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Yl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),s(t(ge),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=k=>p.value=k),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),e("p",Gl,D(p.value.length)+"/160 characters",1)]),e("div",Kl,[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=k=>S.$emit("cancel"))}),s(t(N),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:h})])]))}},tr={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:n}){const a=n,o=p=>{a("save",p),a("close")},f=p=>{p||a("close")};return(p,y)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":f},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[s(t(de),null,{default:i(()=>[s(t(ue),null,{default:i(()=>[...y[1]||(y[1]=[v("Send SMS",-1)])]),_:1})]),_:1}),s(Zl,{onSend:o,onCancel:y[0]||(y[0]=d=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Jl={class:"space-y-6"},Xl={class:"space-y-2"},es={class:"space-y-2"},ts={class:"space-y-2"},ls={class:"flex justify-end gap-3"},ss={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(l,{emit:n}){const a=l,o=n,f=F(a.initialTemplate),p=F(""),y=F(a.initialMessage),d={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},h=()=>{f.value&&d[f.value]&&(p.value=d[f.value].subject,y.value=d[f.value].message)},S=()=>{y.value.trim()&&o("send",{type:"email",template:f.value,subject:p.value,message:y.value})};return(m,k)=>(g(),V("div",Jl,[e("div",Xl,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...k[4]||(k[4]=[v("Template",-1)])]),_:1}),s(t(le),{modelValue:f.value,"onUpdate:modelValue":[k[0]||(k[0]=c=>f.value=c),h]},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select a template..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Follow-up"},{default:i(()=>[...k[5]||(k[5]=[v("Follow-up",-1)])]),_:1}),s(t(q),{value:"Meeting Confirmation"},{default:i(()=>[...k[6]||(k[6]=[v("Meeting Confirmation",-1)])]),_:1}),s(t(q),{value:"Quote Proposal"},{default:i(()=>[...k[7]||(k[7]=[v("Quote Proposal",-1)])]),_:1}),s(t(q),{value:"Unable to Reach"},{default:i(()=>[...k[8]||(k[8]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",es,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...k[9]||(k[9]=[v("Subject",-1)])]),_:1}),s(t(R),{modelValue:p.value,"onUpdate:modelValue":k[1]||(k[1]=c=>p.value=c),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ts,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...k[10]||(k[10]=[v("Message",-1)])]),_:1}),s(t(ge),{modelValue:y.value,"onUpdate:modelValue":k[2]||(k[2]=c=>y.value=c),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",ls,[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:k[3]||(k[3]=c=>m.$emit("cancel"))}),s(t(N),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:S})])]))}},lr={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(l,{emit:n}){const a=n,o=p=>{a("save",p),a("close")},f=p=>{p||a("close")};return(p,y)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":f},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[s(t(de),null,{default:i(()=>[s(t(ue),null,{default:i(()=>[...y[1]||(y[1]=[v("Send Email",-1)])]),_:1})]),_:1}),s(ss,{onSend:o,onCancel:y[0]||(y[0]=d=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},sr={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(l,{emit:n}){const a=n,o=p=>{p||a("close")},f=()=>{a("close")};return(p,y)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":o},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[v(D(l.title),1)]),_:1})]),_:1}),y[0]||(y[0]=e("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[e("div",{class:"flex items-center justify-center w-full"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class os extends Ye{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(n={}){await new Promise(o=>setTimeout(o,300));let a=[...this.dataSource];return n.leadId!==void 0&&(a=a.filter(o=>o.leadId===parseInt(n.leadId))),n.opportunityId!==void 0&&(a=a.filter(o=>o.opportunityId===parseInt(n.opportunityId))),n.type&&(a=a.filter(o=>o.type===n.type)),n.offerId!==void 0&&(a=a.filter(o=>o.offerId===parseInt(n.offerId))),n.vehicleId!==void 0&&(a=a.filter(o=>o.vehicleId===parseInt(n.vehicleId))),a}async findAllByLeadId(n){return this.findAll({leadId:n})}async findAllByOpportunityId(n){return this.findAll({opportunityId:n})}async findById(n){return await new Promise(o=>setTimeout(o,300)),this.dataSource.find(o=>o.id===parseInt(n))||null}async create(n){await new Promise(f=>setTimeout(f,300));const o={id:this.dataSource.length>0?Math.max(...this.dataSource.map(f=>f.id))+1:1,type:n.type,leadId:n.leadId!==void 0?parseInt(n.leadId):void 0,opportunityId:n.opportunityId!==void 0?parseInt(n.opportunityId):void 0,offerId:n.offerId!==void 0?parseInt(n.offerId):void 0,vehicleId:n.vehicleId!==void 0?parseInt(n.vehicleId):void 0,fields:n.fields||{},currency:n.currency||"EUR",offerValidFrom:n.offerValidFrom||null,offerValidTo:n.offerValidTo||null,status:n.status||"active",createdAt:n.createdAt||new Date().toISOString(),createdBy:n.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(o),o}async update(n,a){await new Promise(f=>setTimeout(f,300));const o=this.dataSource.find(f=>f.id===parseInt(n));if(!o)throw new Error("Purchase method not found");return Object.assign(o,a,{updatedAt:new Date().toISOString()}),o}async delete(n){await new Promise(o=>setTimeout(o,300));const a=this.dataSource.findIndex(o=>o.id===parseInt(n));if(a===-1)throw new Error("Purchase method not found");return this.dataSource.splice(a,1),{success:!0}}}class as{constructor(){this.repository=new os}calculateTotal(n){const{type:a,fields:o}=n;if(!o)return 0;const f=parseFloat(o.monthlyInstalment)||0,p=parseFloat(o.downPayment)||0,y=parseInt(o.duration)||0;switch(a){case"FIN":return f*y+p;case"LEA":const d=parseFloat(o.finalInstalment)||0;return f*y+p+d;case"LTR":return f*y+p;default:return 0}}validate(n){const a=[],{type:o,fields:f}=n;if((!o||!["FIN","LEA","LTR"].includes(o))&&a.push("Purchase method type is required and must be FIN, LEA, or LTR"),!f)return a.push("Purchase method fields are required"),{isValid:!1,errors:a};const p=parseFloat(f.monthlyInstalment);(!p||p<=0)&&a.push("Monthly Instalment must be greater than 0");const y=parseFloat(f.downPayment);(y==null||y<0)&&a.push("Down Payment must be greater than or equal to 0");const d=parseInt(f.duration);if((!d||d<12||d>60)&&a.push("Duration must be between 12 and 60 months"),o==="FIN"){const h=parseFloat(f.interestRate);h!=null&&(h<0||h>99.99)&&a.push("Interest Rate must be between 0 and 99.99%");const S=parseFloat(f.effectiveInterestRate);S!=null&&(S<0||S>99.99)&&a.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(o==="LEA"){const h=parseFloat(f.mileageLimit);h!=null&&h<=0&&a.push("Mileage Limit must be greater than 0 if provided");const S=parseFloat(f.finalInstalment);S!=null&&S<0&&a.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(f.interestRate);m!=null&&(m<0||m>99.99)&&a.push("Interest Rate must be between 0 and 99.99%")}if(o==="LTR"){const h=parseFloat(f.mileageLimit);h!=null&&h<=0&&a.push("Mileage Limit must be greater than 0 if provided"),(!f.customerType||!["Private","Business","Fleet"].includes(f.customerType))&&a.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:a.length===0,errors:a}}async findAll(n={}){return await this.repository.findAll(n)}async findById(n){return await this.repository.findById(n)}async create(n){const a=this.validate(n);if(!a.isValid)throw new Error(`Validation failed: ${a.errors.join(", ")}`);const o=await this.repository.create(n),f=this.calculateTotal(o);return o.fields={...o.fields,totalAmount:f},await this.repository.update(o.id,{fields:o.fields})}async update(n,a){const o=await this.repository.findById(n);if(!o)throw new Error("Purchase method not found");const f={...o,...a,fields:{...o.fields,...a.fields}},p=this.validate(f);if(!p.isValid)throw new Error(`Validation failed: ${p.errors.join(", ")}`);const y=this.calculateTotal(f);return f.fields.totalAmount=y,await this.repository.update(n,{...a,fields:f.fields})}async delete(n){return await this.repository.delete(n)}}const Se=new as,Ie=(l=300)=>new Promise(n=>setTimeout(n,l)),ns=async(l={})=>(await Ie(),await Se.findAll(l)),rs=async l=>(await Ie(),await Se.findById(l)),is=async l=>(await Ie(),await Se.create(l)),ds=async(l,n)=>(await Ie(),await Se.update(l,n)),us=async l=>(await Ie(),await Se.delete(l)),cs=Ge("purchaseMethods",()=>{const l=F([]),n=F(null),a=F(!1),o=F(null),f=j(()=>c=>l.value.filter(C=>C.type===c)),p=j(()=>c=>l.value.filter(C=>C.leadId===parseInt(c))),y=j(()=>c=>l.value.filter(C=>C.opportunityId===parseInt(c)));return{purchaseMethods:l,currentPurchaseMethod:n,loading:a,error:o,purchaseMethodsByType:f,purchaseMethodsByLead:p,purchaseMethodsByOpportunity:y,fetchPurchaseMethods:async(c={})=>{a.value=!0,o.value=null;try{const C=await ns(c);return l.value=C,C}catch(C){throw o.value=C.message,C}finally{a.value=!1}},fetchPurchaseMethodById:async c=>{a.value=!0,o.value=null;try{return n.value=await rs(c),n.value}catch(C){throw o.value=C.message,C}finally{a.value=!1}},createPurchaseMethod:async c=>{a.value=!0,o.value=null;try{const C=await is(c);return l.value.push(C),C}catch(C){throw o.value=C.message,C}finally{a.value=!1}},updatePurchaseMethod:async(c,C)=>{var T;a.value=!0,o.value=null;try{const u=await ds(c,C),B=l.value.findIndex(Y=>Y.id===c);return B!==-1&&(l.value[B]=u),((T=n.value)==null?void 0:T.id)===c&&(n.value=u),u}catch(u){throw o.value=u.message,u}finally{a.value=!1}},deletePurchaseMethod:async c=>{var C;a.value=!0,o.value=null;try{await us(c),l.value=l.value.filter(T=>T.id!==c),((C=n.value)==null?void 0:C.id)===c&&(n.value=null)}catch(T){throw o.value=T.message,T}finally{a.value=!1}}}}),fs={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ms={class:"flex gap-2"},ps=["value"],vs={key:0,class:"space-y-4"},ys={class:"text-h3-card text-foreground mb-4"},gs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bs={class:"relative"},hs={key:0,class:"text-xs text-red-600 mt-1"},xs={class:"relative"},ws={key:0,class:"text-xs text-red-600 mt-1"},ks={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cs={key:0,class:"text-xs text-red-600 mt-1"},Vs={class:"space-y-2"},Ss={key:0,class:"text-xs text-red-600 mt-1"},$s={key:0,class:"text-xs text-red-600 mt-1"},Ts={class:"bg-muted p-4 rounded-lg border border-border"},Is={class:"flex justify-between items-center"},As={class:"text-lg font-bold text-foreground"},Ds={class:"flex flex-col gap-3"},Ms={class:"flex items-center gap-2"},Ps={class:"flex items-center gap-2"},Ls={class:"flex items-center gap-2"},Os={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-border"},Fs={class:"space-y-2"},Us={class:"space-y-2"},Rs={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ns={class:"list-disc list-inside text-sm text-red-700 space-y-1"},qs={key:0},Es={key:1},Bs={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:l=>["lead","opportunity"].includes(l)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(l,{emit:n}){const a=l,o=n,f=cs(),p=Ke(),y=F(!1),d=F({}),h=F([]),S=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],m=F({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),k=j(()=>!!a.purchaseMethod);j(()=>{if(m.value.type!=="LEA")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,x=parseInt(m.value.fields.duration)||0,M=parseFloat(m.value.fields.downPayment)||0,fe=parseFloat(m.value.fields.finalInstalment)||0;return w*x+M+fe});const c=j(()=>{if(m.value.type!=="LTR")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,x=parseInt(m.value.fields.duration)||0,M=parseFloat(m.value.fields.downPayment)||0;return w*x+M}),C=w=>w==="FIN"?[12,24,36,48,60]:w==="LEA"?[24,36,48,60]:w==="LTR"?[12,24,36,48,60]:[],T=w=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[w]||w,u=w=>{const x=m.value.fields[w];switch(w){case"monthlyInstalment":!x||x<=0?d.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete d.value.monthlyInstalment;break;case"downPayment":x==null||x<0?d.value.downPayment="Down Payment must be greater than or equal to 0":delete d.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!x||x<12||x>60)?d.value.duration="Duration must be between 12 and 60 months":delete d.value.duration;break;case"customerType":m.value.type==="LTR"&&(!x||!["Private","Business","Fleet"].includes(x))?d.value.customerType="Customer Type is required":delete d.value.customerType;break}},B=w=>{delete d.value[w]},Y=()=>{h.value=[],d.value={};const w=Se.validate({type:m.value.type,fields:m.value.fields});return w.isValid||(h.value=w.errors,w.errors.forEach(x=>{x.includes("Monthly Instalment")?d.value.monthlyInstalment=x:x.includes("Down Payment")?d.value.downPayment=x:x.includes("Duration")?d.value.duration=x:x.includes("Customer Type")&&(d.value.customerType=x)})),w.isValid},E=j(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(d.value).length===0),A=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),d.value={},h.value=[]},b=async()=>{var w;if(Y()){y.value=!0;try{const x={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((w=p.currentUser)==null?void 0:w.id)||null};a.taskType==="lead"?x.leadId=parseInt(a.taskId):a.taskType==="opportunity"&&(x.opportunityId=parseInt(a.taskId)),a.vehicleId&&(x.vehicleId=parseInt(a.vehicleId)),a.offerId&&(x.offerId=parseInt(a.offerId));let M;k.value?M=await f.updatePurchaseMethod(a.purchaseMethod.id,x):M=await f.createPurchaseMethod(x);const fe=T(M.type),$e=qe(M.fields.monthlyInstalment||0);o("save",{...M,successMessage:`Purchase Method Added: ${fe} - €${$e}/month`}),o("close")}catch(x){h.value=[x.message||"Failed to save purchase method"]}finally{y.value=!1}}},P=w=>{w||o("close")};return Ce(()=>{a.purchaseMethod&&(m.value={type:a.purchaseMethod.type||"",fields:{...m.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null})}),ae(()=>a.show,w=>{w?a.purchaseMethod&&(m.value={type:a.purchaseMethod.type||"",fields:{...m.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},d.value={},h.value=[],y.value=!1},300)}),(w,x)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":P},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[v(D(k.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),e("div",fs,[e("div",null,[x[19]||(x[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",ms,[(g(),V(K,null,J(S,M=>e("label",{key:M.value,class:"flex-1 cursor-pointer"},[ye(e("input",{type:"radio",value:M.value,"onUpdate:modelValue":x[0]||(x[0]=fe=>m.value.type=fe),class:"sr-only",onChange:A},null,40,ps),[[Ze,m.value.type]]),e("div",{class:W(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",m.value.type===M.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-muted-foreground hover:border-brand-slate"])},D(M.label),3)])),64))])]),m.value.type?(g(),V("div",vs,[e("h3",ys,D(T(m.value.type))+" Details ",1),e("div",gs,[e("div",null,[x[21]||(x[21]=e("label",{class:"block label-upper mb-2"},[v(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",bs,[x[20]||(x[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),ye(e("input",{"onUpdate:modelValue":x[1]||(x[1]=M=>m.value.fields.monthlyInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:W(["input pl-8",{"border-red-500":d.value.monthlyInstalment}]),onInput:x[2]||(x[2]=M=>B("monthlyInstalment")),onBlur:x[3]||(x[3]=M=>u("monthlyInstalment"))},null,34),[[Ae,m.value.fields.monthlyInstalment,void 0,{number:!0}]])]),d.value.monthlyInstalment?(g(),V("p",hs,D(d.value.monthlyInstalment),1)):L("",!0),x[22]||(x[22]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[x[24]||(x[24]=e("label",{class:"block label-upper mb-2"},[v(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",xs,[x[23]||(x[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),ye(e("input",{"onUpdate:modelValue":x[4]||(x[4]=M=>m.value.fields.downPayment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:W(["input pl-8",{"border-red-500":d.value.downPayment}]),onInput:x[5]||(x[5]=M=>B("downPayment")),onBlur:x[6]||(x[6]=M=>u("downPayment"))},null,34),[[Ae,m.value.fields.downPayment,void 0,{number:!0}]])]),d.value.downPayment?(g(),V("p",ws,D(d.value.downPayment),1)):L("",!0),x[25]||(x[25]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(g(),V("div",ks,[e("div",null,[x[26]||(x[26]=e("label",{class:"block label-upper mb-2"},[v(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),s(t(le),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[x[7]||(x[7]=M=>m.value.fields.duration=M),x[8]||(x[8]=M=>B("duration"))]},{default:i(()=>[s(t(X),{class:W(["w-full h-10 min-h-10",{"border-red-500":d.value.duration}])},{default:i(()=>[s(t(ee),{placeholder:"Select duration..."})]),_:1},8,["class"]),s(t(te),null,{default:i(()=>[(g(!0),V(K,null,J(C(m.value.type),M=>(g(),H(t(q),{key:M,value:M},{default:i(()=>[v(D(M)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),d.value.duration?(g(),V("p",Cs,D(d.value.duration),1)):L("",!0)]),e("div",Vs,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...x[27]||(x[27]=[v("Unlock Kilometers",-1)])]),_:1}),s(t(R),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":x[9]||(x[9]=M=>m.value.fields.mileageLimit=M),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:W(["w-full h-10",{"border-red-500":d.value.mileageLimit}]),onInput:x[10]||(x[10]=M=>B("mileageLimit"))},null,8,["modelValue","class"]),d.value.mileageLimit?(g(),V("p",Ss,D(d.value.mileageLimit),1)):L("",!0)])])):L("",!0),m.value.type==="LTR"?(g(),V(K,{key:1},[e("div",null,[x[31]||(x[31]=e("label",{class:"block label-upper mb-2"},[v(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),s(t(le),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[x[11]||(x[11]=M=>m.value.fields.customerType=M),x[12]||(x[12]=M=>B("customerType"))]},{default:i(()=>[s(t(X),{class:W(["w-full h-10 min-h-10",{"border-red-500":d.value.customerType}])},{default:i(()=>[s(t(ee),{placeholder:"Select customer type..."})]),_:1},8,["class"]),s(t(te),null,{default:i(()=>[s(t(q),{value:"Private"},{default:i(()=>[...x[28]||(x[28]=[v("Private",-1)])]),_:1}),s(t(q),{value:"Business"},{default:i(()=>[...x[29]||(x[29]=[v("Business",-1)])]),_:1}),s(t(q),{value:"Fleet"},{default:i(()=>[...x[30]||(x[30]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d.value.customerType?(g(),V("p",$s,D(d.value.customerType),1)):L("",!0)]),e("div",Ts,[e("div",Is,[x[32]||(x[32]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),e("span",As,"€ "+D(t(qe)(c.value)),1)]),x[33]||(x[33]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Ds,[e("div",Ms,[s(t(pe),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":x[13]||(x[13]=M=>m.value.fields.insuranceIncluded=M)},null,8,["checked"]),s(t(I),{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...x[34]||(x[34]=[v(" Insurance Included ",-1)])]),_:1})]),e("div",Ps,[s(t(pe),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":x[14]||(x[14]=M=>m.value.fields.maintenanceIncluded=M)},null,8,["checked"]),s(t(I),{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...x[35]||(x[35]=[v(" Maintenance Included ",-1)])]),_:1})]),e("div",Ls,[s(t(pe),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":x[15]||(x[15]=M=>m.value.fields.registrationTaxesIncluded=M)},null,8,["checked"]),s(t(I),{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"},{default:i(()=>[...x[36]||(x[36]=[v(" Registration/Taxes Included ",-1)])]),_:1})])])],64)):L("",!0),e("div",Os,[e("div",Fs,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...x[37]||(x[37]=[v("Offer Valid From",-1)])]),_:1}),s(t(R),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":x[16]||(x[16]=M=>m.value.offerValidFrom=M),type:"date",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Us,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...x[38]||(x[38]=[v("Offer Valid To",-1)])]),_:1}),s(t(R),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":x[17]||(x[17]=M=>m.value.offerValidTo=M),type:"date",class:"w-full h-10"},null,8,["modelValue"])])])])):L("",!0),h.value.length>0?(g(),V("div",Rs,[x[39]||(x[39]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Ns,[(g(!0),V(K,null,J(h.value,M=>(g(),V("li",{key:M},D(M),1))),128))])])):L("",!0)]),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x[18]||(x[18]=M=>w.$emit("close"))}),s(t(N),{label:k.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!E.value||y.value,onClick:b},{default:i(()=>[y.value?(g(),V("span",qs,"Saving...")):(g(),V("span",Es,D(k.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},or=Pe(Bs,[["__scopeId","data-v-1f134801"]]),zs={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},js={key:0,class:"space-y-4 py-4 w-full"},Ws={class:"grid grid-cols-1 gap-3"},_s={key:1,class:"space-y-6 w-full"},Hs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qs={class:"space-y-2"},Ys={class:"space-y-2"},Gs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ks={class:"space-y-2"},Zs={class:"space-y-2"},Js={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xs={class:"space-y-2"},eo={class:"space-y-2"},to={class:"space-y-2"},lo={class:"space-y-2"},so={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},oo={class:"space-y-2"},ao={class:"space-y-2"},no={class:"space-y-2"},ro={class:"space-y-2"},io={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},uo={class:"space-y-2"},co={class:"space-y-2"},fo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},mo={class:"space-y-2"},po={class:"space-y-2"},vo={class:"space-y-2"},yo={class:"space-y-2"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={class:"space-y-2"},ho={class:"space-y-2"},xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wo={class:"space-y-2"},ko={class:"space-y-2"},ar={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:l=>["vehicle","tradein"].includes(l)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(l,{emit:n}){const a=l,o=n,f=F(a.mode==="tradein"?"tradein":null);ae(()=>a.mode,k=>{k==="tradein"?f.value="tradein":a.item||(f.value=null)});const p=j(()=>a.mode==="tradein"||f.value==="tradein"),y=()=>a.mode==="tradein"||f.value==="tradein"?"Add Trade-In Vehicle":f.value==="drove"?"Add Drove Vehicle":f.value==="requested"?"Add Requested Vehicle":"Add Vehicle",d=F({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});Ce(()=>{a.item&&a.item.data&&(d.value={brand:a.item.data.brand||"",model:a.item.data.model||"",year:a.item.data.year||"",version:a.item.data.version||"",vin:a.item.data.vin||"",plates:a.item.data.plate||a.item.data.plates||"",fuelType:a.item.data.fuelType||"",gearType:a.item.data.gearType||"",kilometers:a.item.data.km||a.item.data.kilometers||"",registration:a.item.data.date||a.item.data.registration||"",owner:a.item.data.owner||"",ownershipType:a.item.data.ownershipType||"",ownedSince:a.item.data.ownedSince||"",warrantyInfo:a.item.data.warrantyInfo||"",note:a.item.data.note||"",stockDays:null})}),ae(()=>a.show,k=>{k||(f.value=null,d.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const h=j(()=>!!d.value.brand&&!!d.value.model&&!!d.value.year),S=k=>{k||o("close")},m=()=>{if(!h.value)return;const k={vehicle:{brand:d.value.brand,model:d.value.model,year:parseInt(d.value.year)||null,version:d.value.version||null,vin:d.value.vin||null,plates:d.value.plates||null,fuelType:d.value.fuelType||null,gearType:d.value.gearType||null,kilometers:parseInt(d.value.kilometers)||0,registration:d.value.registration||null,owner:d.value.owner||null,ownershipType:d.value.ownershipType||null,ownedSince:d.value.ownedSince||null,warrantyInfo:d.value.warrantyInfo||null,note:d.value.note||null,stockDays:null,status:"Available"}};f.value&&(k.vehicleType=f.value),a.item&&(k.id=a.item.id,k.isEdit=!0,k.timestamp=a.item.timestamp||new Date().toISOString()),o("save",k)};return(k,c)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":S},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[v(D(y()),1)]),_:1})]),_:1}),e("div",zs,[l.mode==="vehicle"&&!l.item&&!f.value?(g(),V("div",js,[c[26]||(c[26]=e("p",{class:"text-muted-foreground text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Ws,[s(t(N),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:c[0]||(c[0]=C=>f.value="drove")}),s(t(N),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:c[1]||(c[1]=C=>f.value="requested")}),s(t(N),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-foreground hover:!bg-muted",onClick:c[2]||(c[2]=C=>f.value="tradein")})])])):(g(),V("div",_s,[p.value?(g(),V(K,{key:0},[e("div",Hs,[e("div",Qs,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[27]||(c[27]=[v("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),s(t(R),{modelValue:d.value.brand,"onUpdate:modelValue":c[3]||(c[3]=C=>d.value.brand=C),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",Ys,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[28]||(c[28]=[v("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),s(t(R),{modelValue:d.value.model,"onUpdate:modelValue":c[4]||(c[4]=C=>d.value.model=C),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])])]),e("div",Gs,[e("div",Ks,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[29]||(c[29]=[v("Year (or registration year) ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),s(t(R),{modelValue:d.value.year,"onUpdate:modelValue":c[5]||(c[5]=C=>d.value.year=C),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),e("div",Zs,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[30]||(c[30]=[v("Kilometers",-1)])]),_:1}),s(t(R),{modelValue:d.value.kilometers,"onUpdate:modelValue":c[6]||(c[6]=C=>d.value.kilometers=C),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",Js,[e("div",Xs,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[31]||(c[31]=[v("Fuel Type",-1)])]),_:1}),s(t(le),{modelValue:d.value.fuelType,"onUpdate:modelValue":c[7]||(c[7]=C=>d.value.fuelType=C)},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select fuel type..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Petrol"},{default:i(()=>[...c[32]||(c[32]=[v("Petrol",-1)])]),_:1}),s(t(q),{value:"Diesel"},{default:i(()=>[...c[33]||(c[33]=[v("Diesel",-1)])]),_:1}),s(t(q),{value:"Electric"},{default:i(()=>[...c[34]||(c[34]=[v("Electric",-1)])]),_:1}),s(t(q),{value:"Hybrid"},{default:i(()=>[...c[35]||(c[35]=[v("Hybrid",-1)])]),_:1}),s(t(q),{value:"Plug-in Hybrid"},{default:i(()=>[...c[36]||(c[36]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",eo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[37]||(c[37]=[v("Gear Type",-1)])]),_:1}),s(t(le),{modelValue:d.value.gearType,"onUpdate:modelValue":c[8]||(c[8]=C=>d.value.gearType=C)},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select gear type..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Manual"},{default:i(()=>[...c[38]||(c[38]=[v("Manual",-1)])]),_:1}),s(t(q),{value:"Automatic"},{default:i(()=>[...c[39]||(c[39]=[v("Automatic",-1)])]),_:1}),s(t(q),{value:"CVT"},{default:i(()=>[...c[40]||(c[40]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",to,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[41]||(c[41]=[v("Plates",-1)])]),_:1}),s(t(R),{modelValue:d.value.plates,"onUpdate:modelValue":c[9]||(c[9]=C=>d.value.plates=C),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"]),c[42]||(c[42]=e("p",{class:"text-xs text-muted-foreground mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",lo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[43]||(c[43]=[v("Note",-1)])]),_:1}),s(t(ge),{modelValue:d.value.note,"onUpdate:modelValue":c[10]||(c[10]=C=>d.value.note=C),rows:"5",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])],64)):(g(),V(K,{key:1},[e("div",so,[e("div",oo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[44]||(c[44]=[v("Brand",-1)])]),_:1}),s(t(R),{modelValue:d.value.brand,"onUpdate:modelValue":c[11]||(c[11]=C=>d.value.brand=C),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",ao,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[45]||(c[45]=[v("Model",-1)])]),_:1}),s(t(R),{modelValue:d.value.model,"onUpdate:modelValue":c[12]||(c[12]=C=>d.value.model=C),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",no,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[46]||(c[46]=[v("Year",-1)])]),_:1}),s(t(R),{modelValue:d.value.year,"onUpdate:modelValue":c[13]||(c[13]=C=>d.value.year=C),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",ro,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[47]||(c[47]=[v("Version/Trim",-1)])]),_:1}),s(t(R),{modelValue:d.value.version,"onUpdate:modelValue":c[14]||(c[14]=C=>d.value.version=C),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),e("div",io,[e("div",uo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[48]||(c[48]=[v("VIN",-1)])]),_:1}),s(t(R),{modelValue:d.value.vin,"onUpdate:modelValue":c[15]||(c[15]=C=>d.value.vin=C),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),e("div",co,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[49]||(c[49]=[v("Plates",-1)])]),_:1}),s(t(R),{modelValue:d.value.plates,"onUpdate:modelValue":c[16]||(c[16]=C=>d.value.plates=C),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",fo,[e("div",mo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[50]||(c[50]=[v("Fuel Type",-1)])]),_:1}),s(t(le),{modelValue:d.value.fuelType,"onUpdate:modelValue":c[17]||(c[17]=C=>d.value.fuelType=C)},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select fuel type..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Petrol"},{default:i(()=>[...c[51]||(c[51]=[v("Petrol",-1)])]),_:1}),s(t(q),{value:"Diesel"},{default:i(()=>[...c[52]||(c[52]=[v("Diesel",-1)])]),_:1}),s(t(q),{value:"Electric"},{default:i(()=>[...c[53]||(c[53]=[v("Electric",-1)])]),_:1}),s(t(q),{value:"Hybrid"},{default:i(()=>[...c[54]||(c[54]=[v("Hybrid",-1)])]),_:1}),s(t(q),{value:"Plug-in Hybrid"},{default:i(()=>[...c[55]||(c[55]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",po,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[56]||(c[56]=[v("Gear Type",-1)])]),_:1}),s(t(le),{modelValue:d.value.gearType,"onUpdate:modelValue":c[18]||(c[18]=C=>d.value.gearType=C)},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select gear type..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Manual"},{default:i(()=>[...c[57]||(c[57]=[v("Manual",-1)])]),_:1}),s(t(q),{value:"Automatic"},{default:i(()=>[...c[58]||(c[58]=[v("Automatic",-1)])]),_:1}),s(t(q),{value:"CVT"},{default:i(()=>[...c[59]||(c[59]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",vo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[60]||(c[60]=[v("Mileage (km)",-1)])]),_:1}),s(t(R),{modelValue:d.value.kilometers,"onUpdate:modelValue":c[19]||(c[19]=C=>d.value.kilometers=C),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",yo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[61]||(c[61]=[v("Registration Year/Month",-1)])]),_:1}),s(t(R),{modelValue:d.value.registration,"onUpdate:modelValue":c[20]||(c[20]=C=>d.value.registration=C),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",go,[e("div",bo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[62]||(c[62]=[v("Owned Since",-1)])]),_:1}),s(t(R),{modelValue:d.value.ownedSince,"onUpdate:modelValue":c[21]||(c[21]=C=>d.value.ownedSince=C),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ho,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[63]||(c[63]=[v("Owner",-1)])]),_:1}),s(t(R),{modelValue:d.value.owner,"onUpdate:modelValue":c[22]||(c[22]=C=>d.value.owner=C),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",xo,[e("div",wo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[64]||(c[64]=[v("Ownership Type",-1)])]),_:1}),s(t(le),{modelValue:d.value.ownershipType,"onUpdate:modelValue":c[23]||(c[23]=C=>d.value.ownershipType=C)},{default:i(()=>[s(t(X),{class:"w-full h-10"},{default:i(()=>[s(t(ee),{placeholder:"Select ownership type..."})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Private"},{default:i(()=>[...c[65]||(c[65]=[v("Private",-1)])]),_:1}),s(t(q),{value:"Company"},{default:i(()=>[...c[66]||(c[66]=[v("Company",-1)])]),_:1}),s(t(q),{value:"Lease"},{default:i(()=>[...c[67]||(c[67]=[v("Lease",-1)])]),_:1}),s(t(q),{value:"Fleet"},{default:i(()=>[...c[68]||(c[68]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",ko,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...c[69]||(c[69]=[v("Warranty Info",-1)])]),_:1}),s(t(ge),{modelValue:d.value.warrantyInfo,"onUpdate:modelValue":c[24]||(c[24]=C=>d.value.warrantyInfo=C),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c[25]||(c[25]=C=>k.$emit("close"))}),s(t(N),{label:p.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!h.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Co={class:"w-full h-28 bg-muted rounded overflow-hidden mb-2"},Vo=["src","alt"],So={key:1,class:"w-full h-full flex items-center justify-center"},$o={class:"flex items-center justify-between mb-1.5"},To={class:"text-sm font-bold text-foreground"},Io={class:"font-bold text-xs text-foreground mb-0.5 line-clamp-1"},Ao={class:"text-xs text-muted-foreground mb-1.5"},Do={key:0,class:"text-xs text-green-600 font-medium mb-2"},Mo={key:1,class:"text-xs text-orange-600 font-medium mb-2"},Be={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(l){const n=l,a=j(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[n.badge]||"gray"),o=f=>f?f.toLocaleString("en-US"):"0";return(f,p)=>(g(),V("div",{onClick:p[1]||(p[1]=y=>f.$emit("select")),class:W(["border border-border rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":l.selected}])},[e("div",Co,[l.vehicle.image?(g(),V("img",{key:0,src:l.vehicle.image,alt:`${l.vehicle.brand} ${l.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Vo)):(g(),V("div",So,[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-car text-muted-foreground opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",$o,[s(t(it),{text:l.badge,size:"small",theme:a.value},null,8,["text","theme"]),e("span",To,"€"+D(o(l.vehicle.price)),1)]),e("h4",Io,D(l.vehicle.brand)+" "+D(l.vehicle.model),1),e("p",Ao,D(l.vehicle.year),1),l.stockDays!==null&&l.stockDays!==void 0?(g(),V("div",Do,[p[3]||(p[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),v(" In stock ("+D(l.stockDays)+" days) ",1)])):(g(),V("div",Mo,[...p[4]||(p[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),v(" Out of stock ",-1)])])),e("button",{onClick:p[0]||(p[0]=ke(y=>f.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},Po={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Lo={key:0},Oo={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Fo={class:"mb-4"},Uo={class:"relative"},Ro={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},No={key:1,class:"text-center py-8 text-muted-foreground"},qo={class:"border border-border rounded-lg p-4 bg-muted"},Eo={key:0,class:"mt-4 space-y-4"},Bo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},zo={class:"space-y-2"},jo={class:"space-y-2"},Wo={class:"space-y-2"},_o={class:"space-y-2"},Ho={class:"flex justify-end"},Qo=["disabled"],Yo={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(l,{emit:n}){const a=l,o=n,f=A=>{A||o("close")},p=F(""),y=F(!1),d=F(null),h=F(null),S=F(null),m=F([]),k=F({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Ce(async()=>{try{const A=await ut({});m.value=A.data||[]}catch(A){console.error("Failed to load vehicles:",A),m.value=[]}});const c=j(()=>a.requestedVehicle&&a.requestedVehicle.stockDays!==null&&a.requestedVehicle.stockDays!==void 0),C=j(()=>{const A=[];if(a.requestedVehicle&&c.value&&A.push({...a.requestedVehicle,isRequested:!0}),m.value&&m.value.length>0){const b=m.value.filter(w=>a.requestedVehicle?w.brand!==a.requestedVehicle.brand||w.model!==a.requestedVehicle.model:!0),P=a.requestedVehicle&&c.value?3:4;A.push(...b.slice(0,P))}return A}),T=j(()=>{if(!m.value||m.value.length===0)return[];let A=[...m.value];if(p.value){const b=p.value.toLowerCase();A=A.filter(P=>P.brand.toLowerCase().includes(b)||P.model.toLowerCase().includes(b)||P.year.toString().includes(b))}return A}),u=j(()=>k.value.brand&&k.value.model&&k.value.year&&k.value.price>0),B=(A,b)=>{d.value=A,h.value=A.id||`custom-${Date.now()}`,S.value=b},Y=()=>{if(!u.value)return;const A={...k.value,id:`custom-${Date.now()}`,isCustom:!0};B(A,"custom")},E=()=>{d.value&&(o("vehicle-selected",{vehicle:d.value,type:S.value}),o("close"),d.value=null,h.value=null,S.value=null,p.value="",y.value=!1,k.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(A,b)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":f},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-6xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[s(t(de),{class:"flex-shrink-0"},{default:i(()=>[s(t(ue),null,{default:i(()=>[...b[7]||(b[7]=[v("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",Po,[C.value.length?(g(),V("div",Lo,[b[8]||(b[8]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),v(" Recommended Vehicles ")],-1)),e("div",Oo,[(g(!0),V(K,null,J(C.value,P=>(g(),H(Be,{key:P.id,vehicle:P,badge:P.isRequested?"Requested":"Recommended","stock-days":P.stockDays,selected:h.value===P.id,onSelect:w=>B(P,P.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):L("",!0),e("div",null,[b[11]||(b[11]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),v(" Browse Stock ")],-1)),e("div",Fo,[e("div",Uo,[b[9]||(b[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-muted-foreground text-sm"},null,-1)),ye(e("input",{"onUpdate:modelValue":b[0]||(b[0]=P=>p.value=P),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-border rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Ae,p.value]])])]),T.value.length?(g(),V("div",Ro,[(g(!0),V(K,null,J(T.value,P=>(g(),H(Be,{key:P.id,vehicle:P,badge:"In Stock","stock-days":P.stockDays,selected:h.value===P.id,onSelect:w=>B(P,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(g(),V("div",No,[...b[10]||(b[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-muted-foreground"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[b[19]||(b[19]=e("h3",{class:"text-sm font-bold text-foreground mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),v(" Configure Custom Vehicle ")],-1)),e("div",qo,[b[18]||(b[18]=e("p",{class:"text-xs text-muted-foreground mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:b[1]||(b[1]=P=>y.value=!y.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[b[12]||(b[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),v(" "+D(y.value?"Hide Configuration":"Build Custom Configuration"),1)]),y.value?(g(),V("div",Eo,[e("div",Bo,[e("div",zo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...b[13]||(b[13]=[v("Brand",-1)])]),_:1}),s(t(R),{modelValue:k.value.brand,"onUpdate:modelValue":b[2]||(b[2]=P=>k.value.brand=P),type:"text",class:"w-full h-10",placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",jo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...b[14]||(b[14]=[v("Model",-1)])]),_:1}),s(t(R),{modelValue:k.value.model,"onUpdate:modelValue":b[3]||(b[3]=P=>k.value.model=P),type:"text",class:"w-full h-10",placeholder:"e.g., e-tron GT"},null,8,["modelValue"])]),e("div",Wo,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...b[15]||(b[15]=[v("Year",-1)])]),_:1}),s(t(R),{modelValue:k.value.year,"onUpdate:modelValue":b[4]||(b[4]=P=>k.value.year=P),type:"number",class:"w-full h-10",placeholder:"2024"},null,8,["modelValue"])]),e("div",_o,[s(t(I),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...b[16]||(b[16]=[v("Price (€)",-1)])]),_:1}),s(t(R),{modelValue:k.value.price,"onUpdate:modelValue":b[5]||(b[5]=P=>k.value.price=P),type:"number",class:"w-full h-10",placeholder:"98000"},null,8,["modelValue"])])]),e("div",Ho,[e("button",{onClick:Y,disabled:!u.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...b[17]||(b[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),v(" Use Custom Configuration ",-1)])],8,Qo)])])):L("",!0)])])]),s(t(we),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[6]||(b[6]=P=>A.$emit("close"))}),d.value?(g(),H(t(N),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:E})):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Go={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Ko={key:0,class:"flex justify-between items-center mb-4"},Zo={class:"text-sm font-bold text-foreground"},Jo={key:1,class:"mb-6"},Xo={class:"bg-white border border-border rounded-lg shadow-nsc-card overflow-hidden p-6"},ea={class:"space-y-3"},ta={key:2,class:"mb-6 p-4 bg-muted rounded-lg border border-border"},la={class:"flex items-center gap-3"},sa={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},oa=["src"],aa={key:1,class:"fa-solid fa-car text-muted-foreground w-full h-full flex items-center justify-center"},na={class:"font-bold text-sm text-foreground"},ra={class:"text-xs text-muted-foreground"},ia={key:3,class:"space-y-3"},da={class:"border border-border rounded-lg bg-white shadow-nsc-card"},ua={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ma={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pa={key:0,class:"border border-border rounded-lg bg-white shadow-nsc-card"},va={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},ya={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ga={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ba={class:"border border-border rounded-lg bg-white shadow-nsc-card"},ha={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},xa={class:"space-y-3"},wa={class:"flex items-center gap-2"},ka={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted rounded-lg"},Ca={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Va={class:"flex items-center gap-2"},Sa={class:"text-xs text-muted-foreground"},$a={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Ta={class:"flex justify-end"},Ia={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Aa={class:"md:col-span-2"},Da={class:"flex justify-between items-end gap-2"},Ma={class:"grid grid-cols-2 gap-3"},Pa={class:"flex justify-end"},La={class:"text-sm font-semibold text-foreground"},Oa={key:0,class:"text-center py-6 text-muted-foreground text-xs"},Fa={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Ua={class:"flex items-center gap-2"},Ra={class:"text-xs text-muted-foreground"},Na={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},qa={class:"flex justify-end"},Ea={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ba={class:"flex justify-between items-center"},za={key:0,class:"text-center py-6 text-muted-foreground text-xs"},ja={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Wa={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},_a={class:"flex items-center gap-2"},Ha={class:"border border-border rounded-lg bg-white shadow-nsc-card"},Qa={class:"flex items-center gap-2"},Ya={class:"text-xs text-muted-foreground"},Ga={key:0,class:"px-4 pb-4 space-y-3 border-t border-border pt-4"},Ka={class:"flex justify-end"},Za={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ja={class:"flex justify-between items-center"},Xa={key:0,class:"text-center py-6 text-muted-foreground text-xs"},en={key:1,class:"bg-muted rounded-lg p-4 mt-4 space-y-2"},tn={class:"flex justify-between items-center"},ln={class:"text-sm font-bold text-foreground"},sn={class:"flex justify-between items-center"},on={class:"text-sm font-bold text-foreground"},an={key:0,class:"text-xs text-red-600"},nn={class:"border border-border rounded-lg bg-white shadow-nsc-card"},rn={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},dn={class:"space-y-3 pt-3 border-t border-border"},un={class:"flex items-start gap-2"},cn={class:"flex items-start gap-2"},fn={key:4,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},mn={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(l,{expose:n,emit:a}){const o=l,f=a,p=F("select"),y=F(!1),d=F(!1),h=F(!1),S=F(!1),m=F(!1),k=F(!1),c=F(!1),C=F(!1),T=F(!1),u=F({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null}),B=j(()=>!!o.customer),Y=j(()=>{let O=u.value.price||0;return u.value.quotationItems.forEach(r=>{O+=(r.price||0)*(r.quantity||1)}),u.value.showVat?O-E.value:O}),E=j(()=>{if(!u.value.showVat||!u.value.vatRate)return 0;let O=u.value.price||0;return u.value.quotationItems.forEach(r=>{O+=(r.price||0)*(r.quantity||1)}),O*u.value.vatRate/(100+u.value.vatRate)}),A=j(()=>{let O=u.value.price||0;return u.value.quotationItems.forEach(r=>{O+=(r.price||0)*(r.quantity||1)}),u.value.discounts.forEach(r=>{O-=r.price||0}),u.value.tradeIn.valuation&&(O-=u.value.tradeIn.valuation),O}),b=j(()=>u.value.paymentMethods.reduce((O,r)=>O+(r.amount||0),0)),P=j(()=>u.value.paymentMethods.length===0?!0:Math.abs(b.value-A.value)<.01),w=()=>{u.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},x=O=>{u.value.quotationItems.splice(O,1)},M=()=>{u.value.discounts.push({title:"",price:0,vatInclusive:!0})},fe=O=>{u.value.discounts.splice(O,1)},$e=()=>{u.value.paymentMethods.push({description:"",amount:0,paid:!1})},De=O=>{u.value.paymentMethods.splice(O,1)},Te=()=>{if(o.customer){const O=(o.customer.name||"").split(" ");u.value.firstName=O[0]||"",u.value.lastName=O.slice(1).join(" ")||"",u.value.email=o.customer.email||"",u.value.phone=o.customer.phone||"",u.value.address=o.customer.address||"",u.value.city=o.customer.city||"",u.value.zipCode=o.customer.zipCode||o.customer.postalCode||""}};Ce(()=>{Te(),o.item&&(p.value="manual"),o.selectedVehicle&&(p.value="manual"),o.selectedVehicle&&(u.value.price=o.selectedVehicle.price||0,u.value.brand=o.selectedVehicle.brand||"",u.value.model=o.selectedVehicle.model||"",u.value.year=o.selectedVehicle.year||"",u.value.image=o.selectedVehicle.image||""),o.item&&o.item.data&&(u.value={...u.value,...o.item.data,price:o.item.data.price||o.item.data.total||0,financingType:o.item.data.financingType||o.item.data.paymentMethod||"",notes:o.item.data.notes||o.item.data.description||"",showVat:o.item.data.showVat||!1,vatRate:o.item.data.vatRate||21,quotationItems:o.item.data.quotationItems||[],discounts:o.item.data.discounts||[],tradeIn:o.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:o.item.data.paymentMethods||[],expirationDate:o.item.data.expirationDate||null})}),ae(()=>o.selectedVehicle,O=>{O&&!o.item&&(p.value="manual",u.value.price=O.price||0,u.value.brand=O.brand||"",u.value.model=O.model||"",u.value.year=O.year||"",u.value.image=O.image||"")}),ae(()=>o.customer,()=>{Te()});const U=j(()=>{const O=u.value.salutation!==""&&u.value.firstName!==""&&u.value.lastName!==""&&u.value.email!==""&&u.value.zipCode!==""&&u.value.price>0&&u.value.financingType!==""&&u.value.privacyConsent===!0,r=o.selectedVehicle||p.value==="manual",be=P.value;return O&&r&&be}),z=O=>O?(typeof O=="string"?parseFloat(O):O).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",Z=O=>{const r=O.vehicle;u.value.brand=r.brand||"",u.value.model=r.model||"",u.value.year=r.year||"",u.value.price=r.price||0,u.value.image=r.image||"",p.value="manual",y.value=!1},G=()=>{var r,be;if(!U.value)return;const O={id:((r=o.item)==null?void 0:r.id)||Date.now(),type:"offer",action:o.item?"updated an offer":"created an offer",data:{salutation:u.value.salutation,firstName:u.value.firstName,lastName:u.value.lastName,email:u.value.email,phone:u.value.phone,zipCode:u.value.zipCode,address:u.value.address,city:u.value.city,brand:u.value.brand,model:u.value.model,year:u.value.year,image:u.value.image,price:u.value.price,total:A.value,paymentMethod:u.value.financingType,financingType:u.value.financingType,downPayment:u.value.downPayment,monthlyPayment:u.value.monthlyPayment,term:u.value.term,interestRate:u.value.interestRate,notes:u.value.notes,description:u.value.notes,privacyConsent:u.value.privacyConsent,marketingConsent:u.value.marketingConsent,showVat:u.value.showVat,vatRate:u.value.vatRate,vatAmount:E.value,subtotal:Y.value,quotationItems:u.value.quotationItems,discounts:u.value.discounts,tradeIn:u.value.tradeIn,paymentMethods:u.value.paymentMethods,expirationDate:u.value.expirationDate,grandTotal:A.value},timestamp:((be=o.item)==null?void 0:be.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",O)};return n({submit:G,isValid:U,offerData:u}),(O,r)=>{var be,Oe,Fe,Ue,Re,Ne;return g(),V("div",Go,[l.hideHeader?L("",!0):(g(),V("div",Ko,[e("h5",Zo,D(l.item?"Edit Offer":"Create Offer"),1),s(t(N),{variant:"ghost",size:"icon",onClick:r[0]||(r[0]=$=>O.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},{default:i(()=>[...r[37]||(r[37]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!l.selectedVehicle&&!l.item&&p.value==="select"?(g(),V("div",Jo,[e("div",Xo,[r[41]||(r[41]=e("h6",{class:"text-sm font-semibold text-foreground mb-4"},"Select Vehicle",-1)),r[42]||(r[42]=e("p",{class:"text-xs text-muted-foreground mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),e("div",ea,[s(t(N),{variant:"outline",class:"w-full justify-start",onClick:r[1]||(r[1]=$=>y.value=!0)},{default:i(()=>[...r[38]||(r[38]=[e("i",{class:"fa-solid fa-warehouse mr-2"},null,-1),v(" Add from Stock — Search and select an existing vehicle from inventory ",-1)])]),_:1}),s(t(N),{variant:"outline",class:"w-full justify-start",onClick:r[2]||(r[2]=$=>y.value=!0)},{default:i(()=>[...r[39]||(r[39]=[e("i",{class:"fa-solid fa-cog mr-2"},null,-1),v(" Configure Vehicle — Build/customize a new vehicle ",-1)])]),_:1}),s(t(N),{variant:"outline",class:"w-full justify-start",onClick:r[3]||(r[3]=$=>p.value="manual")},{default:i(()=>[...r[40]||(r[40]=[e("i",{class:"fa-solid fa-pen-to-square mr-2"},null,-1),v(" Skip & Enter Manually — Create vehicle data from scratch ",-1)])]),_:1})])])])):L("",!0),l.selectedVehicle||p.value==="manual"&&u.value.brand?(g(),V("div",ta,[r[43]||(r[43]=e("p",{class:"text-xs text-muted-foreground mb-2"},"Creating offer for:",-1)),e("div",la,[e("div",sa,[(be=l.selectedVehicle)!=null&&be.image||u.value.image?(g(),V("img",{key:0,src:((Oe=l.selectedVehicle)==null?void 0:Oe.image)||u.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,oa)):(g(),V("i",aa))]),e("div",null,[e("h4",na,D(((Fe=l.selectedVehicle)==null?void 0:Fe.brand)||u.value.brand)+" "+D(((Ue=l.selectedVehicle)==null?void 0:Ue.model)||u.value.model)+" ("+D(((Re=l.selectedVehicle)==null?void 0:Re.year)||u.value.year)+") ",1),e("p",ra,"Base Price: € "+D(z(((Ne=l.selectedVehicle)==null?void 0:Ne.price)||u.value.price)),1)])])])):L("",!0),l.selectedVehicle||p.value==="manual"||l.item?(g(),V("div",ia,[e("div",da,[e("button",{type:"button",onClick:r[4]||(r[4]=$=>d.value=!d.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors rounded-t-lg"},[r[44]||(r[44]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Personal Information"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",d.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),d.value?(g(),V("div",ua,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[45]||(r[45]=[v("Salutation ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(le),{modelValue:u.value.salutation,"onUpdate:modelValue":r[5]||(r[5]=$=>u.value.salutation=$)},{default:i(()=>[s(t(X),{class:"w-full"},{default:i(()=>[s(t(ee),{placeholder:"Select salutation"})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"Mr."},{default:i(()=>[...r[46]||(r[46]=[v("Mr.",-1)])]),_:1}),s(t(q),{value:"Mrs."},{default:i(()=>[...r[47]||(r[47]=[v("Mrs.",-1)])]),_:1}),s(t(q),{value:"Ms."},{default:i(()=>[...r[48]||(r[48]=[v("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ca,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[49]||(r[49]=[v("First Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(R),{modelValue:u.value.firstName,"onUpdate:modelValue":r[6]||(r[6]=$=>u.value.firstName=$),placeholder:"Enter first name",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[50]||(r[50]=[v("Last Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(R),{modelValue:u.value.lastName,"onUpdate:modelValue":r[7]||(r[7]=$=>u.value.lastName=$),placeholder:"Enter last name",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",fa,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[51]||(r[51]=[v("Email ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(R),{type:"email",modelValue:u.value.email,"onUpdate:modelValue":r[8]||(r[8]=$=>u.value.email=$),placeholder:"email@example.com",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[52]||(r[52]=[v("Phone Number",-1)])]),_:1}),s(t(R),{type:"tel",modelValue:u.value.phone,"onUpdate:modelValue":r[9]||(r[9]=$=>u.value.phone=$),placeholder:"+1 (555) 000-0000",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",ma,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[53]||(r[53]=[v("ZIP / Postal Code ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(R),{modelValue:u.value.zipCode,"onUpdate:modelValue":r[10]||(r[10]=$=>u.value.zipCode=$),placeholder:"Enter ZIP code",disabled:B.value},null,8,["modelValue","disabled"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[54]||(r[54]=[v("City",-1)])]),_:1}),s(t(R),{modelValue:u.value.city,"onUpdate:modelValue":r[11]||(r[11]=$=>u.value.city=$),placeholder:"Enter city",disabled:B.value},null,8,["modelValue","disabled"])])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[55]||(r[55]=[v("Address / Street",-1)])]),_:1}),s(t(R),{modelValue:u.value.address,"onUpdate:modelValue":r[12]||(r[12]=$=>u.value.address=$),placeholder:"Enter street address",disabled:B.value},null,8,["modelValue","disabled"])])])):L("",!0)]),p.value==="manual"&&!l.selectedVehicle?(g(),V("div",pa,[e("button",{type:"button",onClick:r[13]||(r[13]=$=>h.value=!h.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[56]||(r[56]=e("h6",{class:"text-sm font-semibold text-foreground"},"Vehicle Details",-1)),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",h.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),h.value?(g(),V("div",va,[e("div",ya,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[57]||(r[57]=[v("Brand",-1)])]),_:1}),s(t(R),{modelValue:u.value.brand,"onUpdate:modelValue":r[14]||(r[14]=$=>u.value.brand=$),placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[58]||(r[58]=[v("Model",-1)])]),_:1}),s(t(R),{modelValue:u.value.model,"onUpdate:modelValue":r[15]||(r[15]=$=>u.value.model=$),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),e("div",ga,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[59]||(r[59]=[v("Year",-1)])]),_:1}),s(t(R),{type:"number",modelValue:u.value.year,"onUpdate:modelValue":r[16]||(r[16]=$=>u.value.year=$),placeholder:"2024"},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[60]||(r[60]=[v("Image URL",-1)])]),_:1}),s(t(R),{modelValue:u.value.image,"onUpdate:modelValue":r[17]||(r[17]=$=>u.value.image=$),placeholder:"https://..."},null,8,["modelValue"])])])])):L("",!0)])):L("",!0),e("div",ba,[e("button",{type:"button",onClick:r[18]||(r[18]=$=>S.value=!S.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[61]||(r[61]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Pricing & Financing"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",S.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),S.value?(g(),V("div",ha,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[62]||(r[62]=[v("Base Price (€) ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(R),{type:"number",modelValue:u.value.price,"onUpdate:modelValue":r[19]||(r[19]=$=>u.value.price=$),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[63]||(r[63]=[v("Financing Type ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),s(t(le),{modelValue:u.value.financingType,"onUpdate:modelValue":r[20]||(r[20]=$=>u.value.financingType=$)},{default:i(()=>[s(t(X),{class:"w-full"},{default:i(()=>[s(t(ee),{placeholder:"Select financing type"})]),_:1}),s(t(te),null,{default:i(()=>[s(t(q),{value:"cash"},{default:i(()=>[...r[64]||(r[64]=[v("Cash",-1)])]),_:1}),s(t(q),{value:"financing"},{default:i(()=>[...r[65]||(r[65]=[v("Financing",-1)])]),_:1}),s(t(q),{value:"leasing"},{default:i(()=>[...r[66]||(r[66]=[v("Leasing",-1)])]),_:1}),s(t(q),{value:"rental"},{default:i(()=>[...r[67]||(r[67]=[v("Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",xa,[e("div",wa,[s(t(pe),{checked:u.value.showVat,"onUpdate:checked":r[21]||(r[21]=$=>u.value.showVat=$),id:"show-vat"},null,8,["checked"]),s(t(I),{for:"show-vat",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:i(()=>[...r[68]||(r[68]=[v("Show VAT breakdown",-1)])]),_:1})]),u.value.showVat?(g(),V("div",ka,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[69]||(r[69]=[v("VAT %",-1)])]),_:1}),s(t(R),{type:"number",step:"0.1",modelValue:u.value.vatRate,"onUpdate:modelValue":r[22]||(r[22]=$=>u.value.vatRate=$),placeholder:"21"},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[70]||(r[70]=[v("VAT €",-1)])]),_:1}),s(t(R),{type:"number",value:E.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[71]||(r[71]=[v("Subtotal €",-1)])]),_:1}),s(t(R),{type:"number",value:Y.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):L("",!0)])])):L("",!0)]),e("div",Ca,[e("button",{type:"button",onClick:r[23]||(r[23]=$=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",Va,[r[72]||(r[72]=e("h6",{class:"text-sm font-semibold text-foreground"},"Quotation Items",-1)),e("span",Sa,"("+D(u.value.quotationItems.length)+" items)",1)]),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(g(),V("div",$a,[e("div",Ta,[s(t(N),{variant:"outline",size:"small",onClick:w},{default:i(()=>[...r[73]||(r[73]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Item ",-1)])]),_:1})]),(g(!0),V(K,null,J(u.value.quotationItems,($,ve)=>(g(),V("div",{key:ve,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Ia,[e("div",Aa,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[74]||(r[74]=[v("Item Name",-1)])]),_:1}),s(t(R),{modelValue:$.name,"onUpdate:modelValue":Q=>$.name=Q,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Da,[s(t(N),{variant:"ghost",size:"icon",onClick:Q=>x(ve),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:i(()=>[...r[75]||(r[75]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),e("div",Ma,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[76]||(r[76]=[v("Price (€)",-1)])]),_:1}),s(t(R),{type:"number",modelValue:$.price,"onUpdate:modelValue":Q=>$.price=Q,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[77]||(r[77]=[v("Quantity",-1)])]),_:1}),s(t(R),{type:"number",modelValue:$.quantity,"onUpdate:modelValue":Q=>$.quantity=Q,placeholder:"1",value:$.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),e("div",Pa,[e("span",La,"Total: € "+D(z(($.price||0)*($.quantity||1))),1)])]))),128)),u.value.quotationItems.length===0?(g(),V("div",Oa," No quotation items added yet ")):L("",!0)])):L("",!0)]),e("div",Fa,[e("button",{type:"button",onClick:r[24]||(r[24]=$=>k.value=!k.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",Ua,[r[78]||(r[78]=e("h6",{class:"text-sm font-semibold text-foreground"},"Discounts",-1)),e("span",Ra,"("+D(u.value.discounts.length)+" discounts)",1)]),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",k.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),k.value?(g(),V("div",Na,[e("div",qa,[s(t(N),{variant:"outline",size:"small",onClick:M},{default:i(()=>[...r[79]||(r[79]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Discount ",-1)])]),_:1})]),(g(!0),V(K,null,J(u.value.discounts,($,ve)=>(g(),V("div",{key:ve,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Ea,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[80]||(r[80]=[v("Discount Title",-1)])]),_:1}),s(t(R),{modelValue:$.title,"onUpdate:modelValue":Q=>$.title=Q,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[81]||(r[81]=[v("Amount (€)",-1)])]),_:1}),s(t(R),{type:"number",modelValue:$.price,"onUpdate:modelValue":Q=>$.price=Q,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Ba,[s(t(I),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[s(t(pe),{checked:$.vatInclusive,"onUpdate:checked":Q=>$.vatInclusive=Q},null,8,["checked","onUpdate:checked"]),r[82]||(r[82]=e("span",{class:"text-xs text-muted-foreground"},"VAT inclusive",-1))]),_:2},1024),s(t(N),{variant:"ghost",size:"icon",onClick:Q=>fe(ve),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...r[83]||(r[83]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),u.value.discounts.length===0?(g(),V("div",za," No discounts added yet ")):L("",!0)])):L("",!0)]),e("div",ja,[e("button",{type:"button",onClick:r[25]||(r[25]=$=>c.value=!c.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[84]||(r[84]=e("h6",{class:"text-sm font-semibold text-foreground"},"Trade-In",-1)),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",c.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),c.value?(g(),V("div",Wa,[e("div",_a,[s(t(pe),{checked:u.value.tradeIn.showOnPdf,"onUpdate:checked":r[26]||(r[26]=$=>u.value.tradeIn.showOnPdf=$),id:"show-tradein-pdf"},null,8,["checked"]),s(t(I),{for:"show-tradein-pdf",class:"text-xs font-medium text-muted-foreground cursor-pointer"},{default:i(()=>[...r[85]||(r[85]=[v("Show on PDF",-1)])]),_:1})]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[86]||(r[86]=[v("Trade-in Valuation (€)",-1)])]),_:1}),s(t(R),{type:"number",modelValue:u.value.tradeIn.valuation,"onUpdate:modelValue":r[27]||(r[27]=$=>u.value.tradeIn.valuation=$),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[87]||(r[87]=[v("Trade-in Notes",-1)])]),_:1}),s(t(ge),{modelValue:u.value.tradeIn.notes,"onUpdate:modelValue":r[28]||(r[28]=$=>u.value.tradeIn.notes=$),rows:"3",placeholder:"Add notes about the trade-in vehicle..."},null,8,["modelValue"])])])):L("",!0)]),e("div",Ha,[e("button",{type:"button",onClick:r[29]||(r[29]=$=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[e("div",Qa,[r[88]||(r[88]=e("h6",{class:"text-sm font-semibold text-foreground"},"Payment Methods",-1)),e("span",Ya,"("+D(u.value.paymentMethods.length)+" methods)",1)]),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(g(),V("div",Ga,[e("div",Ka,[s(t(N),{variant:"outline",size:"small",onClick:$e},{default:i(()=>[...r[89]||(r[89]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Payment Method ",-1)])]),_:1})]),(g(!0),V(K,null,J(u.value.paymentMethods,($,ve)=>(g(),V("div",{key:ve,class:"border border-border rounded-lg p-3 space-y-3"},[e("div",Za,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[90]||(r[90]=[v("Description",-1)])]),_:1}),s(t(R),{modelValue:$.description,"onUpdate:modelValue":Q=>$.description=Q,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[91]||(r[91]=[v("Amount (€)",-1)])]),_:1}),s(t(R),{type:"number",modelValue:$.amount,"onUpdate:modelValue":Q=>$.amount=Q,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Ja,[s(t(I),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[s(t(pe),{checked:$.paid,"onUpdate:checked":Q=>$.paid=Q},null,8,["checked","onUpdate:checked"]),r[92]||(r[92]=e("span",{class:"text-xs text-muted-foreground"},"PAID",-1))]),_:2},1024),s(t(N),{variant:"ghost",size:"icon",onClick:Q=>De(ve),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...r[93]||(r[93]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),u.value.paymentMethods.length===0?(g(),V("div",Xa," No payment methods added yet ")):L("",!0),u.value.paymentMethods.length>0?(g(),V("div",en,[e("div",tn,[r[94]||(r[94]=e("span",{class:"text-xs font-medium text-muted-foreground"},"Payment Methods Total:",-1)),e("span",ln,"€ "+D(z(b.value)),1)]),e("div",sn,[r[95]||(r[95]=e("span",{class:"text-xs font-medium text-muted-foreground"},"Grand Total:",-1)),e("span",on,"€ "+D(z(A.value)),1)]),P.value?L("",!0):(g(),V("div",an," ⚠️ Payment methods must equal Grand Total "))])):L("",!0)])):L("",!0)]),e("div",nn,[e("button",{type:"button",onClick:r[30]||(r[30]=$=>T.value=!T.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-muted transition-colors"},[r[96]||(r[96]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-foreground"},"Terms & Conditions"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:W(["fa-solid transition-transform duration-200 text-muted-foreground text-xs",T.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),T.value?(g(),V("div",rn,[e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[97]||(r[97]=[v("Notes / Comments",-1)])]),_:1}),s(t(ge),{modelValue:u.value.notes,"onUpdate:modelValue":r[31]||(r[31]=$=>u.value.notes=$),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),e("div",null,[s(t(I),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:i(()=>[...r[98]||(r[98]=[v("Offer Expiration Date",-1)])]),_:1}),s(t(R),{type:"date",modelValue:u.value.expirationDate,"onUpdate:modelValue":r[32]||(r[32]=$=>u.value.expirationDate=$)},null,8,["modelValue"])]),e("div",dn,[r[101]||(r[101]=e("h6",{class:"text-xs font-semibold text-foreground"},"Privacy & Consent",-1)),e("div",un,[s(t(pe),{checked:u.value.privacyConsent,"onUpdate:checked":r[33]||(r[33]=$=>u.value.privacyConsent=$),id:"privacy-consent"},null,8,["checked"]),s(t(I),{for:"privacy-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:i(()=>[...r[99]||(r[99]=[v(" I agree to the privacy policy ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1})]),e("div",cn,[s(t(pe),{checked:u.value.marketingConsent,"onUpdate:checked":r[34]||(r[34]=$=>u.value.marketingConsent=$),id:"marketing-consent"},null,8,["checked"]),s(t(I),{for:"marketing-consent",class:"text-xs text-muted-foreground cursor-pointer"},{default:i(()=>[...r[100]||(r[100]=[v(" I want to receive marketing communications ",-1)])]),_:1})])])])):L("",!0)])])):L("",!0),l.hideActions?L("",!0):(g(),V("div",fn,[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:r[35]||(r[35]=$=>O.$emit("cancel"))}),s(t(N),{label:l.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!U.value,onClick:G},null,8,["label","disabled"])])),s(Yo,{show:y.value,"requested-vehicle":l.selectedVehicle,"opportunity-id":l.taskId,onClose:r[36]||(r[36]=$=>y.value=!1),onVehicleSelected:Z},null,8,["show","requested-vehicle","opportunity-id"])])}}},pn={class:"flex-1 overflow-y-auto p-6 w-full"},nr={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(l,{emit:n}){const a=n,o=F(null),f=j(()=>{var h;return((h=o.value)==null?void 0:h.isValid)||!1}),p=()=>{var h;(h=o.value)==null||h.submit()},y=h=>{h||a("close")},d=h=>{a("save",h),a("close")};return(h,S)=>(g(),H(t(ce),{open:l.show,"onUpdate:open":y},{default:i(()=>[s(t(ne),null,{default:i(()=>[s(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(ie),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:i(()=>[s(t(de),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:i(()=>[s(t(ue),null,{default:i(()=>[...S[2]||(S[2]=[v("Create Offer",-1)])]),_:1})]),_:1}),e("div",pn,[s(mn,{item:l.item,"task-type":l.taskType,"task-id":l.taskId,"selected-vehicle":l.requestedCar,customer:l.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:o,onSave:d,onCancel:S[0]||(S[0]=m=>h.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),s(t(we),{class:"flex-shrink-0 p-6 pt-4 bg-muted flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:i(()=>[s(t(N),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:S[1]||(S[1]=m=>h.$emit("close"))}),s(t(N),{label:l.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:p},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function rr(l){const n=l.lead;if(!n)return null;const a=xe(n,"lead");if(!a)return console.warn("No display stage calculated for lead"),null;const o=Ve[a];if(!o)return console.warn(`No state config found for lead stage: ${a}`),null;if(!o.primaryAction)return console.warn(`No primary action found for lead stage: ${a}`),null;const f=o.primaryAction;if(typeof f=="function"){const p=f({lead:n,displayStage:a});return p||console.warn(`Primary action function returned null for lead stage: ${a}`),p}return f}function ir(l){const n=l.lead;if(!n)return[];const a=xe(n,"lead"),o=Ve[a];return o?o.secondaryActions||[]:[]}function je(l){const n=l.lead;if(!n||!(n.isDisqualified===!0))return!1;const o=xe(n,"lead");return o===me.CLOSED_INVALID||o===me.CLOSED_NOT_INTERESTED||o===me.CLOSED_DUPLICATE}function dr(l){const n=l.lead;if(!n||je(l))return!1;const a=xe(n,"lead"),o=Ve[a];return o?typeof o.showLQWidget=="function"?o.showLQWidget(n):o.showLQWidget??!1:!1}function ur(l){const n=l.lead;if(!n||je(l))return!1;const a=xe(n,"lead"),o=Ve[a];return o?o.showDeadlineBanner&&n.nextActionDue:!1}function cr(l){const n=l.lead;if(!n)return!1;const a=xe(n,"lead"),o=Ve[a];return o?o.canPostpone??!1:!1}function fr(l){const n=l.lead;if(!n)return"qualification";const a=xe(n,"lead"),o=Ve[a];return o&&o.lqWidgetMode||"qualification"}function mr(){const l=ct();return{saveTradeInVehicle:async(o,f,p,y={})=>{try{const d=await l.addVehicle(p),h={type:"tradein",action:"added a trade-in",vehicleId:d.id,data:{brand:p.brand,model:p.model,version:p.version||null,year:p.year,kilometers:p.kilometers||0,plates:p.plates||null,registration:p.registration||null,vin:p.vin||null,fuelType:p.fuelType||null,gearType:p.gearType||null,tradeInPrice:y.tradeInPrice||null,evaluationRangeLow:y.evaluationRangeLow||null,evaluationRangeHigh:y.evaluationRangeHigh||null,provider:y.provider||null,evaluationDate:y.evaluationDate||null,priceToBuy:y.priceToBuy||null,priceToSell:y.priceToSell||null,priceOfVehicle:y.priceOfVehicle||null,priceOfOptionals:y.priceOfOptionals||null,listOfOptionals:y.listOfOptionals||null}};let S;if(o==="lead")S=await et(f,h);else if(o==="opportunity")S=await tt(f,h);else throw new Error(`Invalid taskType: ${o}`);return{vehicle:d,activity:S}}catch(d){throw console.error("Error saving trade-in vehicle:",d),d}},updateTradeInVehicle:async(o,f,p,y,d,h={})=>{try{const S=await l.modifyVehicle(p,d),m={data:{brand:d.brand,model:d.model,version:d.version||null,year:d.year,kilometers:d.kilometers||0,plates:d.plates||null,registration:d.registration||null,vin:d.vin||null,fuelType:d.fuelType||null,gearType:d.gearType||null,tradeInPrice:h.tradeInPrice||null,evaluationRangeLow:h.evaluationRangeLow||null,evaluationRangeHigh:h.evaluationRangeHigh||null,provider:h.provider||null,evaluationDate:h.evaluationDate||null,priceToBuy:h.priceToBuy||null,priceToSell:h.priceToSell||null,priceOfVehicle:h.priceOfVehicle||null,priceOfOptionals:h.priceOfOptionals||null,listOfOptionals:h.listOfOptionals||null}};let k;if(o==="lead")k=await Je(f,y,m);else if(o==="opportunity")k=await Xe(f,y,m);else throw new Error(`Invalid taskType: ${o}`);return{vehicle:S,activity:k}}catch(S){throw console.error("Error updating trade-in vehicle:",S),S}}}}function _(l){if(!l)return 0;const n=new Date(l),o=Math.abs(new Date-n);return Math.ceil(o/(1e3*60*60*24))}const he={"no-appointment":l=>!l.scheduledAppointment,"has-appointment":l=>!!l.scheduledAppointment,"appointment-past-not-completed":l=>l.scheduledAppointment?new Date(l.scheduledAppointment.start)<new Date&&l.scheduledAppointment.status!=="completed":!1,"has-future-appointment":l=>l.scheduledAppointment?new Date(l.scheduledAppointment.start)>new Date:!1,"no-offers":l=>!l.hasOffers,"has-offers":l=>l.hasOffers,"qualified-no-offers-7-13-days":l=>{var y;const n=oe(),a=n.getSetting("oofbMinDays"),o=n.getSetting("oofbMaxDays"),f=(y=l.opportunity.postponedTasks)==null?void 0:y.oofb;if(f){const d=_(f),h=n.getSetting("postponeTaskDays")||7;if(d<h)return!1;const S=_(f);return S>=a&&S<o+1&&!l.hasOffers}const p=_(l.opportunity.createdAt);return p>=a&&p<o+1&&!l.hasOffers},"qualified-no-offers-14-plus-days":l=>{var p;const n=oe(),a=n.getSetting("ufbDays"),o=(p=l.opportunity.postponedTasks)==null?void 0:p.ufb;if(o){const y=_(o),d=n.getSetting("postponeTaskDays")||7;return y<d?!1:_(o)>=a&&!l.hasOffers}return _(l.opportunity.createdAt)>=a&&!l.hasOffers},"negotiation-offer-sent-substatus":l=>{var n;return((n=l.opportunity)==null?void 0:n.negotiationSubstatus)==="Offer Sent"},"negotiation-contract-pending-substatus":l=>{var n,a;return((n=l.opportunity)==null?void 0:n.contractDate)!==null&&((a=l.opportunity)==null?void 0:a.contractDate)!==void 0},"negotiation-offer-feedback-substatus":l=>{var n;return((n=l.opportunity)==null?void 0:n.negotiationSubstatus)==="Offer Feedback"},"negotiation-5-plus-days-no-contract-has-offers":l=>{var n;if(((n=l.opportunity)==null?void 0:n.id)===33){if(!l.hasOffers||l.opportunity.contractDate)return!1;const a=l.opportunity.lastActivity||l.opportunity.createdAt;return a?_(a)>=5:!1}return!1},"contract-pending-5-plus-days":l=>{var h;const n=l.opportunity,a=S=>!!(S!=null&&S.contractSigned||S!=null&&S.esignatureCollectedDate);let o=!1,f=null;if(Array.isArray(n==null?void 0:n.contracts)&&n.contracts.length>0){const S=n.contracts.filter(a);o=S.length>0,o&&(f=S.reduce((k,c)=>{const C=c.esignatureCollectedDate||c.contractDate;return C?k?new Date(C)>new Date(k)?C:k:C:k},null))}else o=!!(n!=null&&n.contractSigned||n!=null&&n.esignatureCollectedDate),f=(n==null?void 0:n.contractDate)||(n==null?void 0:n.esignatureCollectedDate);if(!o||!f)return!1;const p=oe(),y=p.getSetting("cfbDays")||5,d=(h=n.postponedTasks)==null?void 0:h.cfb;if(d){const S=_(d),m=p.getSetting("postponeTaskDays")||7;return S<m?!1:_(d)>=y}try{const S=new Date(f);return isNaN(S.getTime())?!1:_(S.toISOString())>=y}catch{return!1}},"closed-won-contract-feedback":l=>{var p,y;const n=(p=l.opportunity)==null?void 0:p.contractDate;if(!n||n===null||n===void 0||n==="")return!1;const a=oe(),o=a.getSetting("cfbDays")||5,f=(y=l.opportunity.postponedTasks)==null?void 0:y.cfb;if(f){const d=_(f),h=a.getSetting("postponeTaskDays")||7;return d<h?!1:_(f)>=o}try{const d=new Date(n);return isNaN(d.getTime())?!1:_(d.toISOString())>=o}catch{return!1}},"negotiation-offer-feedback-5-plus-days-no-appointment":l=>{var y,d;if(((y=l.opportunity)==null?void 0:y.negotiationSubstatus)!=="Offer Feedback"||!l.hasOffers)return!1;const n=oe(),a=n.getSetting("nfuDays"),o=(d=l.opportunity.postponedTasks)==null?void 0:d.nfu;if(o){const h=_(o),S=n.getSetting("postponeTaskDays")||7;if(h<S)return!1;const m=_(o),k=l.scheduledAppointment&&new Date(l.scheduledAppointment.start)>new Date;return m>=a&&!l.opportunity.contractDate&&!k}const f=_(l.opportunity.lastActivity||l.opportunity.createdAt),p=l.scheduledAppointment&&new Date(l.scheduledAppointment.start)>new Date;return f>=a&&!l.opportunity.contractDate&&!p},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":l=>he["negotiation-offer-feedback-5-plus-days-no-appointment"](l),"contract-7-plus-days-no-delivery":l=>{var y,d,h;if(!l.opportunity.contractDate)return!1;const n=oe(),a=n.getSetting("cfbDays"),o=(y=l.opportunity.postponedTasks)==null?void 0:y.cfb;if(o){const S=_(o),m=n.getSetting("postponeTaskDays")||7;if(S<m)return!1;const k=_(o),c=(d=l.activities)==null?void 0:d.some(C=>{var T;return C.type==="delivery"||((T=C.action)==null?void 0:T.toLowerCase().includes("delivered"))});return k>=a&&!c}const f=_(l.opportunity.contractDate),p=(h=l.activities)==null?void 0:h.some(S=>{var m;return S.type==="delivery"||((m=S.action)==null?void 0:m.toLowerCase().includes("delivered"))});return f>=a&&!p},"delivery-delay-feedback-required":l=>{var y,d,h,S;if(l.deliverySubstatus!=="Awaiting Delivery"||!l.opportunity.deliveryDate||l.opportunity.actualDeliveryDate||((h=(d=(y=l.activities)==null?void 0:y.find(m=>{var k;return(k=m.data)==null?void 0:k.actualDeliveryDate}))==null?void 0:d.data)==null?void 0:h.actualDeliveryDate))return!1;const a=oe(),o=a.getSetting("dfbDays")||3,f=(S=l.opportunity.postponedTasks)==null?void 0:S.dfb;if(f){const m=_(f),k=a.getSetting("postponeTaskDays")||7;return m<k?!1:_(f)>=o}return _(l.opportunity.deliveryDate)>=o},"delivery-feedback-required":l=>{var y,d,h,S,m,k,c;if(l.deliverySubstatus!=="Delivered")return!1;const n=l.opportunity.actualDeliveryDate||l.opportunity.deliveredDate||((h=(d=(y=l.activities)==null?void 0:y.find(C=>{var T;return(T=C.data)==null?void 0:T.actualDeliveryDate}))==null?void 0:d.data)==null?void 0:h.actualDeliveryDate)||((k=(m=(S=l.activities)==null?void 0:S.find(C=>{var T;return(T=C.data)==null?void 0:T.deliveredDate}))==null?void 0:m.data)==null?void 0:k.deliveredDate);if(!n)return!1;const a=oe(),o=a.getSetting("dfbDays")||3,f=(c=l.opportunity.postponedTasks)==null?void 0:c.dfb;if(f){const C=_(f),T=a.getSetting("postponeTaskDays")||7;return C<T?!1:_(f)>=o}return _(n)>=o},"is-awaiting-delivery":l=>l.deliverySubstatus==="Awaiting Delivery","is-delivered":l=>l.deliverySubstatus==="Delivered","has-no-delivery":l=>!l.deliverySubstatus||l.deliverySubstatus===null,"is-closed":l=>{const n=l.stage;return n==="Closed Won"||n==="Closed Lost"},"is-closed-with-task-widget":l=>he["is-closed"](l)&&l.hasActiveTaskWidget,"opportunity-abandoned":l=>{if(he["is-closed"](l))return!1;const n=oe(),a=n.getSetting("abandonedOpportunityDays");if(!n.getSetting("abandonedEligibleStages").includes(l.stage))return!1;const f=l.opportunity.lastActivity||l.opportunity.createdAt;return _(f)>=a}};function pr(l,n){if(he["is-closed-with-task-widget"](n))return[Me.reopen,Me.requalify,Me.closeLost];const a=Le[l];return!a||!a.secondaryActions?[]:a.secondaryActions.filter(o=>{if(!o.conditional)return!0;const f=he[o.conditional];return f?f(n):!0})}function vr(l,n){const a=Le[l];if(!a||!a.taskWidgets||n.opportunity.skipTaskReTrigger)return null;const f=oe().getSetting("autoCloseWidgetsOnClose"),p=he["is-closed"]({stage:l});for(const y of a.taskWidgets){if(f&&p&&(y.type==="NFU"||y.type==="OFB"))continue;const d=he[y.condition];if(d&&d(n))return y.type}return null}function yr(l,n){const a=Le[l];if(!a||!a.primaryAction)return null;let o=a.primaryAction;return typeof o=="function"&&(o=o(n),!o)?null:{...o,title:typeof o.title=="function"?o.title(n):o.title,description:typeof o.description=="function"?o.description(n):o.description,label:typeof o.label=="function"?o.label(n):o.label}}function gr(l){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Post-Delivery Customer Satisfaction Survey",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[l]||"Task"}function br(l){return l==="Closed Won"||l==="Closed Lost"}const vn={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center rounded-lg"},yn={key:2,class:"absolute top-1 right-1 z-30"},gn=["onClick"],bn=["src"],hn={key:1,class:"fa-solid fa-car text-base text-muted-foreground"},xn={class:"flex-1 space-y-1"},wn={class:"mt-auto pt-1"},kn={key:4,class:"absolute bottom-0 left-0 right-0 z-10 bg-green-600/90 text-white text-[10px] font-medium px-2 py-1.5 flex items-center justify-between pointer-events-none"},Cn={key:0,class:"opacity-90"},Vn={__name:"OfferCard",props:{offer:{type:Object,required:!0},variant:{type:String,default:"carousel",validator:l=>["carousel","feed"].includes(l)},showStatusBadge:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showDate:{type:Boolean,default:!0},showAcceptanceInfo:{type:Boolean,default:!0},showAcceptanceBadge:{type:Boolean,default:!0},menuItems:{type:Array,default:()=>[]},containerClass:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["menu-action"],setup(l,{emit:n}){const a=l,o=F(null),f=F({}),p=F({}),y=j(()=>a.offer.status==="accepted"||a.offer.acceptance_status==="accepted"),d=j(()=>(a.variant==="carousel","h-16")),h=j(()=>a.variant==="carousel"?"p-2":"p-3"),S=j(()=>a.variant==="carousel"?"h-[105px]":""),m=j(()=>a.variant==="carousel"?"text-xs":"text-sm"),k=j(()=>a.variant==="carousel"?"text-xs":"text-sm"),c=j(()=>(a.variant==="carousel","text-xs")),C=(U,z)=>{z&&(f.value[U]=z)},T=()=>{if(a.menuItems.length===0)return 120;const U=document.createElement("span");U.style.visibility="hidden",U.style.position="absolute",U.style.fontSize="0.75rem",U.style.padding="0 12px",U.style.whiteSpace="nowrap",document.body.appendChild(U);let z=0;return a.menuItems.forEach(Z=>{U.textContent=Z.label;const G=U.offsetWidth;G>z&&(z=G)}),document.body.removeChild(U),Math.max(z+24,120)},u=U=>{const z=f.value[U];if(!z)return;const Z=z.getBoundingClientRect(),G=T();p.value[U]={top:Z.bottom+4,left:Z.right-G,width:G}},B=async U=>{o.value===U?(o.value=null,delete p.value[U]):(o.value=U,await ot(),u(U))},Y=()=>{o.value=null,p.value={}};let E=null,A=null;ae(o,U=>{if(E&&(window.removeEventListener("scroll",E,!0),window.removeEventListener("resize",A),E=null,A=null),U){const z=()=>{U&&f.value[U]&&u(U)};E=z,A=z,window.addEventListener("scroll",E,!0),window.addEventListener("resize",A)}});const b=U=>U?new Intl.NumberFormat("en-US").format(U):"0",P=U=>{if(!U)return"";const z=new Date(U),G=Math.abs(new Date-z),O=Math.ceil(G/(1e3*60*60*24));return O===0?"today":O===1?"yesterday":O<7?`${O} days ago`:z.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},w=U=>({active:"Active",accepted:"Accepted",archived:"Archived"})[U]||"Active",x=U=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[U]||"bg-gray-600",M=U=>y.value?"border-green-500 border-2":"border-border",fe=U=>U.status==="archived"?"opacity-60":"",$e=U=>{const z=U.vehicleBrand||"",Z=U.vehicleModel||"",G=U.vehicleYear||"";return z&&Z&&G?`${z} ${Z} (${G})`:z&&Z?`${z} ${Z}`:"Vehicle"},De=U=>U.price||0,Te=()=>a.offer.acceptance_date||a.offer.acceptedAt||a.offer.accepted_at||null;return(U,z)=>{var G,O;const Z=ze("click-outside");return g(),V("div",{class:W(["bg-white border rounded-lg shadow-nsc-card overflow-visible transition-shadow relative",M(l.offer),fe(l.offer),l.containerClass,{"pointer-events-none opacity-60":l.loading}])},[l.loading?(g(),V("div",vn,[...z[2]||(z[2]=[e("div",{class:"flex flex-col items-center gap-2"},[e("div",{class:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-xs text-muted-foreground"},"Updating...")],-1)])])):L("",!0),l.showStatusBadge&&!(y.value&&l.showAcceptanceBadge)?(g(),V("div",{key:1,class:W(["absolute top-1 left-1 z-10 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm uppercase tracking-wider",x(l.offer.status)])},D(w(l.offer.status)),3)):L("",!0),l.showMenu?(g(),V("div",yn,[e("button",{ref:r=>C(l.offer.id,r),onClick:z[0]||(z[0]=ke(r=>B(l.offer.id),["stop"])),title:"Offer actions",class:"relative z-30 w-6 h-6 flex items-center justify-center text-foreground hover:bg-black/10 bg-white/60 backdrop-blur-sm rounded-md transition-colors shadow-sm border border-black/5"},[s(t(bt),{size:14})],512)])):L("",!0),l.showMenu?(g(),H(st,{key:3,to:"body"},[o.value===l.offer.id&&p.value[l.offer.id]?ye((g(),V("div",{key:0,class:"fixed z-[9999] bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",style:lt({top:`${p.value[l.offer.id].top}px`,left:`${p.value[l.offer.id].left}px`,width:`${p.value[l.offer.id].width}px`,minWidth:"120px"}),onClick:z[1]||(z[1]=ke(()=>{},["stop"]))},[(g(!0),V(K,null,J(l.menuItems,r=>(g(),V("button",{key:r.key,onClick:()=>{r.onClick(),Y()},class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2",style:{"font-size":"0.75rem","line-height":"1.5"}},D(r.label),9,gn))),128))],4)),[[Z,Y]]):L("",!0)])):L("",!0),e("div",{class:W(["w-full bg-muted flex items-center justify-center overflow-hidden",d.value])},[(G=l.offer.data)!=null&&G.image||l.offer.image?(g(),V("img",{key:0,src:((O=l.offer.data)==null?void 0:O.image)||l.offer.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,bn)):(g(),V("i",hn))],2),e("div",{class:W(["flex flex-col",h.value,S.value,{"pb-10":y.value}])},[e("div",xn,[e("h4",{class:W(["font-bold text-foreground leading-tight line-clamp-2",m.value])},D($e(l.offer)),3),e("p",{class:W(["font-bold text-foreground",k.value])},"€ "+D(b(De(l.offer))),3)]),e("div",wn,[l.showDate&&l.offer.createdAt&&!(y.value&&l.showAcceptanceBadge)?(g(),V("p",{key:0,class:W(["text-muted-foreground",c.value])},D(P(l.offer.createdAt)),3)):L("",!0)])],2),l.showAcceptanceBadge&&y.value?(g(),V("div",kn,[z[3]||(z[3]=e("span",{class:"flex items-center gap-1"},[e("i",{class:"fa-solid fa-check-circle"}),v(" Accepted ")],-1)),Te()?(g(),V("span",Cn,D(P(Te())),1)):L("",!0)])):L("",!0)],2)}}},Sn={key:0},$n={class:"flex items-center justify-between mb-2"},Tn={class:"flex items-center gap-2"},In={class:"font-semibold text-foreground text-sm"},An={class:"relative"},Dn={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Mn={class:"w-8 h-8 rounded-full bg-background border border-border flex items-center justify-center text-muted-foreground group-hover:text-foreground transition-colors shadow-sm"},Pn={key:1,class:"text-center py-6 px-3 bg-muted border border-border rounded-lg"},Ln={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted","generate-pdf","offer-activated","add"],setup(l,{expose:n,emit:a}){const o=a,f=F(new Set),p=(d,h)=>{h?f.value.add(d):f.value.delete(d)},y=d=>{const h=[],S=d.status==="accepted"||d.acceptance_status==="accepted";return d.status!=="active"&&h.push({key:"set-active",label:"Set active",onClick:()=>{p(d.id,!0),o("offer-activated",d)}}),S?h.push({key:"remove-accepted",label:"Remove acceptance",onClick:()=>{p(d.id,!0),o("offer-accepted",d,!0)}}):h.push({key:"set-accepted",label:"Set accepted",onClick:()=>{p(d.id,!0),o("offer-accepted",d)}}),h.push({key:"send-offer-pdf",label:"Send Offer PDF",onClick:()=>{o("generate-pdf",d)}}),h};return n({setOfferLoading:p}),(d,h)=>l.offers&&l.offers.length>0?(g(),V("div",Sn,[e("div",$n,[e("div",Tn,[e("h3",In,"Offers ("+D(l.offers.length)+")",1)])]),e("div",An,[e("div",Dn,[(g(!0),V(K,null,J(l.offers,S=>(g(),H(Vn,{key:`offer-${S.id}-${S.status}-${S.acceptance_status||"none"}`,offer:S,variant:"carousel","menu-items":y(S),loading:f.value.has(S.id),"container-class":"flex-none w-36 snap-start"},null,8,["offer","menu-items","loading"]))),128)),e("button",{class:"flex-none w-36 h-[171px] snap-start bg-muted/50 border-2 border-dashed border-border rounded-lg flex flex-col items-center justify-center gap-2 hover:bg-muted/80 transition-colors group",onClick:h[0]||(h[0]=S=>d.$emit("add"))},[e("div",Mn,[s(t(at),{size:20})]),h[1]||(h[1]=e("span",{class:"text-[10px] font-medium text-muted-foreground group-hover:text-foreground uppercase tracking-wider"},"New Offer",-1))])])])])):(g(),V("div",Pn,[...h[2]||(h[2]=[e("i",{class:"fa-solid fa-file-invoice text-2xl text-muted-foreground mb-2"},null,-1),e("p",{class:"text-xs font-medium text-muted-foreground"},"No offers created yet",-1),e("p",{class:"text-xs text-muted-foreground mt-0.5"},"Create an offer to start negotiations",-1)])]))}},hr=Pe(Ln,[["__scopeId","data-v-aefed0c9"]]);export{vr as A,yr as B,En as C,pr as D,pt as E,br as F,gr as G,mn as H,Bn as I,Yn as J,he as K,Ve as L,bt as M,hr as N,Le as O,or as P,Yo as Q,ss as R,Zl as S,Zn as T,_l as U,ft as V,gt as W,yt as X,mt as Y,vt as Z,Kn as _,qe as a,jn as b,_n as c,Qn as d,Gn as e,zn as f,Hn as g,qn as h,Jn as i,Xn as j,er as k,tr as l,lr as m,sr as n,ar as o,nr as p,je as q,rr as r,ir as s,dr as t,ur as u,cr as v,fr as w,Wn as x,ht as y,mr as z};
