const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-B55v8mIF.js","assets/index-DqWyOYoU.js","assets/index-3ruGtqw5.css","assets/users-CkqXh-gx.js"])))=>i.map(i=>d[i]);
import{n as ee,b as sn,Z as Ta,X as Oa,a as an,f as ms,F as ps,L as fs,g as vs,h as gs,Q as J,C as ys,d as bs,i as Ut,W as Ot,U as It,H as Nt,j as ve,G as Vt,k as gt,l as Fs,c as st,o as at,$ as La}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-SVS8Zwad-DVNwBQcn.js";import{H as ht,K as Et,c as $,d as D,o as f,e,g as _,t as N,n as Z,s,x as de,B as l,y as t,X as _a,I as ds,M as nn,Y as ha,V as xa,r as O,C as Rt,j as Ua,T as dt,O as yt,F as Me,P as wa,Z as js,h as Fa,u as Dt,S as Es,q as ln,k as I,i as We,$ as ka,l as he,p as Qe,a0 as ct,a1 as Ia,a2 as on,a3 as rn,a4 as cs,G as $t,a5 as ba,a6 as un,_ as Jt,N as dn,w as Sa,m as hs,L as Ea,a7 as Rs}from"./index-DqWyOYoU.js";import{u as Mt}from"./opportunities-Cr-mXogK.js";import{E as cn,_ as mn,T as pn,h as Ra,i as fn,j as vn,k as gn,l as yn,m as Ca,P as ja,n as Ba,o as bn,p as hn,q as xn,r as wn,s as kn,t as Sn,u as Cn,v as $n,e as Na,b as _t,w as us,g as Dn,c as An,f as Tn,x as On,y as In,z as Nn,A as Vn,B as Mn,C as qn,D as Bs,F as Ln}from"./opportunityRules-BaC5nmNU.js";import{_ as Wa}from"./CreateEventModal-JUBstLnD.js";import{_ as Pa}from"./ReassignUserModal-Bfeq1bLz.js";import{u as qt,c as va}from"./users-CkqXh-gx.js";import{$ as Ye}from"./components-4J0anYM3.js";import{S as _n}from"./sparkles-C-JQGf45.js";import{f as Un}from"./vehicles-BiOUVEQF.js";import{_ as Fn,a as En}from"./EditEventModal-CNPRdaMu.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=ht("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=ht("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=ht("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=ht("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=ht("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=ht("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=ht("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=ht("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=ht("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=ht("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Qn={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Jn={class:"flex items-center justify-between gap-4 w-full h-full"},Gn={class:"flex flex-col min-w-0"},Zn={class:"flex items-center gap-2 min-w-0"},Kn={key:0,class:"text-fluid-lg font-medium text-heading truncate"},Xn={key:1,class:"text-fluid-lg font-medium text-heading"},el={key:2,class:"flex items-center gap-1.5 shrink-0"},tl={key:0,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},sl={key:0,class:"text-sm text-sub truncate leading-normal mt-0.5"},al={key:1,class:"text-fluid-sm text-sub"},nl={class:"flex items-center gap-2 shrink-0"},ll={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close"],setup(n){const M=n,i=$(()=>!M.task||!M.filteredTasks.length?!1:M.filteredTasks.findIndex(w=>{const g=M.task.compositeId||M.task.id;return(w.compositeId||w.id)===g})>0),p=$(()=>{if(!M.task||!M.filteredTasks.length)return!1;const c=M.filteredTasks.findIndex(w=>{const g=M.task.compositeId||M.task.id;return(w.compositeId||w.id)===g});return c>=0&&c<M.filteredTasks.length-1}),r=c=>c?c.type==="lead"?"Lead Qualification Task":c.type==="opportunity"?"Opportunity Management Task":"Task Details":"No task selected",u=c=>{var g;if(!c)return"";const w=[];if(c.vehicle||c.requestedCar){const x=c.vehicle||c.requestedCar;x.brand&&x.model?w.push(`${x.brand} ${x.model} (${x.year||"N/A"})`):x.model&&w.push(`${x.model} (${x.year||"N/A"})`)}return c.source&&w.push(c.source),(g=c.customer)!=null&&g.name?w.push(c.customer.name):c.customerName&&w.push(c.customerName),w.join(" • ")},h=c=>{if(!c)return"";if(c.type==="opportunity"){const w=S(c)||c.stage||c.currentStage||"New";b(c);const g=o(c);return g&&g!==w?g:w}return c.stage||c.currentStage||c.displayStage||"New"},b=c=>c?c.stage||c.currentStage||"New":"",S=c=>{if(!c||c.type!=="opportunity")return null;try{return ds(c,"opportunity")}catch{return c.displayStage||c.stage||null}},o=c=>{if(!c||c.type!=="opportunity")return"";const w=b(c),g=S(c);if(!g||!w)return g||"";const x=w.toLowerCase().trim();if(g.toLowerCase().trim().startsWith(x+" - ")){const C=w+" - ";if(g.startsWith(C))return g.substring(C.length)}return g},k=c=>{if(!c)return"bg-gray-50 text-gray-700 border-gray-200";if(c.type==="opportunity"){const g=S(c)||b(c);return A(g,"opportunity")}const w=h(c).toLowerCase();return w.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":w.includes("qualif")?"bg-green-50 text-green-600 border-green-200":w.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":w.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"},A=(c,w="opportunity")=>{if(!c)return"bg-gray-50 text-gray-700 border-gray-200";try{const g=nn(c,w);return g.includes("blue")?g+" border-blue-200":g.includes("purple")?g+" border-purple-200":g.includes("yellow")?g+" border-yellow-200":g.includes("pink")?g+" border-pink-200":g.includes("indigo")?g+" border-indigo-200":g.includes("emerald")?g+" border-emerald-200":g.includes("green")?g+" border-green-200":g.includes("red")?g+" border-red-200":(g.includes("gray"),g+" border-gray-200")}catch{const x=c.toLowerCase();return x.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":x.includes("qualif")?"bg-green-50 text-green-600 border-green-200":x.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":x.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}};return(c,w)=>(f(),D("div",Qn,[e("div",Jn,[e("div",Gn,[e("div",Zn,[n.task?(f(),D("h2",Kn,N(r(n.task)),1)):(f(),D("h2",Xn," No task selected ")),n.task?(f(),D("div",el,[e("span",{class:Z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",n.task.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},N(n.task.type==="lead"?"Lead":"Opportunity"),3),e("span",{class:Z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",k(n.task)])},N(h(n.task)),3),n.task.priority==="Hot"?(f(),D("span",tl," Hot ")):_("",!0)])):_("",!0)]),n.task?(f(),D("p",sl,N(u(n.task)),1)):(f(),D("p",al," Select a task to view details "))]),e("div",nl,[s(t(ee),{variant:"secondary",size:"icon",onClick:w[0]||(w[0]=g=>c.$emit("previous")),disabled:!i.value},{default:l(()=>[s(t(jn),{size:16,class:"text-body"})]),_:1},8,["disabled"]),s(t(ee),{variant:"secondary",size:"icon",onClick:w[1]||(w[1]=g=>c.$emit("next")),disabled:!p.value},{default:l(()=>[s(t(Bn),{size:16,class:"text-body"})]),_:1},8,["disabled"]),n.isDrawerView?(f(),de(t(ee),{key:0,variant:"secondary",size:"icon",onClick:w[2]||(w[2]=g=>c.$emit("close")),class:"ml-1"},{default:l(()=>[s(t(_a),{size:16,class:"text-body"})]),_:1})):_("",!0)])])]))}},ol=Et(ll,[["__scopeId","data-v-a84389f7"]]),il=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:n=>["lead","opportunity"].includes(n)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(n){return(M,i)=>(f(),D("div",null,[n.managementWidget?(f(),de(xa(n.managementWidget),ha({key:0,lead:n.type==="lead"?n.task:void 0,opportunity:n.type==="opportunity"?n.task:void 0,activities:n.activities},M.$attrs),null,16,["lead","opportunity","activities"])):_("",!0)]))}}),rl=Et(il,[["__scopeId","data-v-f5db9491"]]),ul={class:"overflow-hidden p-4 rounded-lg bg-white border border-black/5 shadow-sm"},dl={class:"flex gap-4"},cl={class:"w-24 shrink-0 aspect-[3/2] rounded-lg overflow-hidden bg-surfaceTertiary"},ml=["src","alt"],pl={key:1,class:"w-full h-full flex items-center justify-center"},fl={class:"min-w-0 flex-1 flex flex-col justify-center"},vl={class:"text-fluid-sm font-semibold text-heading truncate"},gl={key:0,class:"flex items-center gap-2 mt-1 text-fluid-sm text-heading flex-wrap"},yl={key:0,class:"font-semibold"},bl={key:1,class:"h-3 w-px bg-border shrink-0","aria-hidden":"true"},hl={key:2,class:"text-sub truncate"},xl={key:1,class:"flex gap-3 mt-0.5 text-fluid-xs text-sub"},wl={key:0},kl={key:1},Sl={key:0,class:"rounded-lg p-3 mt-3 bg-base-muted"},Cl={class:"text-fluid-sm text-heading"},$l={class:"flex gap-2 pt-3 mt-3 border-t border-black/5"},Dl={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(n){const M=n,i=O(!1),p=$(()=>{const S=[];return M.vehicle.brand&&S.push(M.vehicle.brand),M.vehicle.model&&S.push(M.vehicle.model),M.vehicle.variant&&S.push(M.vehicle.variant),S.join(" ")||"Vehicle Details"}),r=$(()=>{const S=p.value;return M.vehicle.year?`${S} (${M.vehicle.year})`:S}),u=S=>{if(!S)return"0";const o=typeof S=="string"?parseFloat(S):S;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o)},h=S=>{if(!S)return"0";const o=typeof S=="string"?parseFloat(S):S;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o)},b=()=>{i.value=!0};return(S,o)=>(f(),D("div",ul,[o[4]||(o[4]=e("h3",{class:"text-fluid-sm font-medium mb-3 text-heading"},"Requested Car",-1)),e("div",dl,[e("div",cl,[n.imageUrl&&!i.value?(f(),D("img",{key:0,src:n.imageUrl,alt:`${n.vehicle.brand} ${n.vehicle.model}`,class:"w-full h-full object-cover",onError:b},null,40,ml)):(f(),D("div",pl,[s(t(Rn),{size:32,class:"text-sub"})]))]),e("div",fl,[e("p",vl,N(r.value),1),n.vehicle.price||n.source?(f(),D("div",gl,[n.vehicle.price?(f(),D("span",yl," €"+N(u(n.vehicle.price)),1)):_("",!0),n.vehicle.price&&n.source?(f(),D("span",bl)):_("",!0),n.source?(f(),D("span",hl,N(n.source),1)):_("",!0)])):_("",!0),n.vehicle.mileage||n.vehicle.fuelType?(f(),D("div",xl,[n.vehicle.mileage?(f(),D("span",wl,N(h(n.vehicle.mileage))+" km",1)):_("",!0),n.vehicle.fuelType?(f(),D("span",kl,N(n.vehicle.fuelType),1)):_("",!0)])):_("",!0)])]),n.requestMessage?(f(),D("div",Sl,[o[2]||(o[2]=e("p",{class:"text-fluid-xs text-sub mb-0.5"},"Request message",-1)),e("p",Cl,N(n.requestMessage),1)])):_("",!0),e("div",$l,[s(t(ee),{variant:"secondary",size:"sm",class:"flex-1",onClick:o[0]||(o[0]=k=>S.$emit("open-ad"))},{default:l(()=>[s(t(cn),{size:16}),o[3]||(o[3]=e("span",null,"Open Ad",-1))]),_:1}),s(t(ee),{variant:"secondary",size:"icon-sm",onClick:o[1]||(o[1]=k=>S.$emit("more-actions"))},{default:l(()=>[s(t(Wn),{size:16})]),_:1})])]))}},Al={class:"relative flex-1 flex flex-col min-h-0 min-w-0 overflow-hidden"},Tl={key:0,class:"flex flex-col flex-1 min-h-0 min-w-0 overflow-hidden"},Ol={class:"flex flex-1 min-h-0 overflow-hidden"},Il={class:"flex-1 flex flex-col min-h-0 overflow-hidden bg-white min-w-0"},Nl={class:"flex-1 min-h-0 overflow-y-auto"},Vl={class:"p-2"},Ml={class:"right-sidebar flex flex-col min-h-0 overflow-hidden shrink-0 border-l border-black/5 bg-surface"},ql={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},Ll={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},_l={class:"flex-1 min-h-0 flex flex-col overflow-y-auto bg-[#F8F8F8]"},Ul={key:1,class:"flex-1 flex items-center justify-center bg-surface"},Fl={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close"],setup(n,{emit:M}){const i=n,p=M,r=Rt(),u=Mt(),h=O("request"),b=O({}),S=O(!1),o=O(!1),k=O(!1),A=O(!1),c=O(!1),w=O(!1),g=O(!1),x=O(!1),V=O(!1),C=O(!1),R=$(()=>{var z;return((z=i.storeAdapter.currentActivities)==null?void 0:z.value)||[]}),F=$(()=>R.value.length),E=$(()=>{var $e;if(!(($e=i.task)!=null&&$e.customer))return 0;const z=i.task.customer.email,X=i.task.customer.phone,Fe=i.task.compositeId||`${i.task.type}-${i.task.id}`;return[...(r.leads||[]).map(Ae=>({...Ae,type:"lead",compositeId:`lead-${Ae.id}`})),...(u.opportunities||[]).map(Ae=>({...Ae,type:"opportunity",compositeId:`opportunity-${Ae.id}`}))].filter(Ae=>Ae.compositeId===Fe||!Ae.customer?!1:Ae.customer.email===z||Ae.customer.phone===X).length}),fe=()=>{p("task-navigate","previous")},pe=()=>{p("task-navigate","next")},L=z=>{h.value!=="activity"&&(h.value="activity"),console.log("Activity clicked:",z)},T=z=>{b.value[z]=!b.value[z]},q=z=>z&&(z.image||z.imageUrl)||"",B=()=>{console.log("Open ad clicked")},Y=()=>{console.log("More actions clicked")},ne=z=>{console.log("Contact action:",z)},H=z=>{z==="note"?S.value=!0:z==="attachment"?o.value=!0:z==="whatsapp"?k.value=!0:z==="sms"?A.value=!0:z==="email"?c.value=!0:z==="call"?w.value=!0:z==="financing"?g.value=!0:z==="tradein"?x.value=!0:z==="purchase"?V.value=!0:z==="appointment"&&(C.value=!0)},ye=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"note",content:z.content||z.message,message:z.content||z.message,timestamp:new Date().toISOString()}),S.value=!1}catch(X){console.error("Error saving note:",X)}},Ie=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"attachment",fileName:z.fileName,file:z.file,content:`Attachment: ${z.fileName}`,timestamp:new Date().toISOString()}),o.value=!1}catch(X){console.error("Error saving attachment:",X)}},ce=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"whatsapp",message:z.message,content:z.message,template:z.template,timestamp:new Date().toISOString()}),k.value=!1}catch(X){console.error("Error saving WhatsApp:",X)}},te=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"sms",message:z.message,content:z.message,template:z.template,timestamp:new Date().toISOString()}),A.value=!1}catch(X){console.error("Error saving SMS:",X)}},K=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"email",subject:z.subject,message:z.message,content:z.message,template:z.template,timestamp:new Date().toISOString()}),c.value=!1}catch(X){console.error("Error saving email:",X)}},re=async z=>{var X;try{await i.storeAdapter.addActivity(i.task.id,{type:"financing",action:z.action||"added a financing proposal",content:z.content||`Financing: ${((X=z.data)==null?void 0:X.product)||"Unknown"}`,data:z.data,timestamp:new Date().toISOString()}),g.value=!1}catch(Fe){console.error("Error saving financing:",Fe)}},xe=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"tradein",action:"added a trade-in",content:z.content||"Trade-in vehicle added",data:z.data,timestamp:new Date().toISOString()}),x.value=!1}catch(X){console.error("Error saving trade-in:",X)}},De=async z=>{var X;try{await i.storeAdapter.addActivity(i.task.id,{type:"offer",action:z.action||"created an offer",content:z.content||`Offer: €${((X=z.data)==null?void 0:X.price)||0}`,data:z.data,timestamp:new Date().toISOString()}),V.value=!1}catch(Fe){console.error("Error saving offer:",Fe)}},Ge=async z=>{try{await i.storeAdapter.addActivity(i.task.id,{type:"appointment",action:"scheduled an appointment",content:`Appointment: ${z.type||"Meeting"} on ${z.date||""}`,data:z,timestamp:new Date().toISOString()}),C.value=!1}catch(X){console.error("Error saving appointment:",X)}};return(z,X)=>{var Fe,Ee,Re,$e,Ae,j,W,oe,G,P,se,le,ke;return f(),D("div",Al,[n.task?(f(),D("div",Tl,[s(ol,{task:n.task,"filtered-tasks":n.filteredTasks,"is-drawer-view":n.isDrawerView,onPrevious:fe,onNext:pe,onClose:X[0]||(X[0]=ge=>z.$emit("close"))},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",Ol,[e("div",Il,[e("div",Nl,[e("div",Vl,[s(rl,ha({task:n.task,type:n.task.type,"management-widget":n.managementWidget,activities:R.value},z.$attrs),null,16,["task","type","management-widget","activities"])])])]),e("div",Ml,[s(t(an),{modelValue:h.value,"onUpdate:modelValue":X[1]||(X[1]=ge=>h.value=ge),class:"flex flex-col flex-1 min-h-0 overflow-hidden"},{default:l(()=>[s(t(sn),{class:"flex shrink-0 border-b border-black/5 bg-white rounded-none w-full relative h-full"},{default:l(()=>[s(t(Ta),{value:"request",class:Z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",h.value==="request"?"text-heading":"text-sub hover:text-body"])},{default:l(()=>[X[12]||(X[12]=e("span",null,"Request",-1)),E.value>0?(f(),D("span",{key:0,class:Z(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",h.value==="request"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},N(E.value),3)):_("",!0),h.value==="request"?(f(),D("span",ql)):_("",!0)]),_:1},8,["class"]),s(t(Ta),{value:"activity",class:Z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",h.value==="activity"?"text-heading":"text-sub hover:text-body"])},{default:l(()=>[X[13]||(X[13]=e("span",null,"Activity",-1)),F.value>0?(f(),D("span",{key:0,class:Z(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",h.value==="activity"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},N(F.value),3)):_("",!0),h.value==="activity"?(f(),D("span",Ll)):_("",!0)]),_:1},8,["class"])]),_:1}),e("div",_l,[s(t(Oa),{value:"request",class:"space-y-2 p-2 mt-0 flex-1 min-h-full"},{default:l(()=>{var ge,Le;return[s(mn,{task:n.task,"task-type":n.task.type,"customer-id":n.task.customerId||((ge=n.task.customer)==null?void 0:ge.id),onAction:ne},null,8,["task","task-type","customer-id"]),n.task.requestedCar||n.task.vehicle?(f(),de(Dl,{key:0,vehicle:n.task.requestedCar||n.task.vehicle,"request-message":n.task.requestMessage||((Le=n.task.requestedCar)==null?void 0:Le.requestMessage),source:n.task.source,"image-url":q(n.task.requestedCar||n.task.vehicle),onOpenAd:B,onMoreActions:Y},null,8,["vehicle","request-message","source","image-url"])):_("",!0)]}),_:1}),s(t(Oa),{value:"activity",class:"p-2 flex-1 overflow-hidden h-full flex flex-col mt-0"},{default:l(()=>[s(pn,{activities:R.value,"expanded-summaries":b.value,onActivityClick:L,onToggleSummaryExpanded:T,onAddActivity:H},null,8,["activities","expanded-summaries"])]),_:1})])]),_:1},8,["modelValue"])])])])):(f(),D("div",Ul,[...X[14]||(X[14]=[Ua('<div class="text-center max-w-sm p-8" data-v-b7793434><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-b7793434><i class="fa-solid fa-tasks text-2xl text-sub" data-v-b7793434></i></div><h3 class="text-fluid-lg font-bold text-heading mb-2" data-v-b7793434>No task selected</h3><p class="text-fluid-sm text-sub" data-v-b7793434>Select a task from the list to view its details and manage activities</p></div>',1)])])),s(Ra,{modal:"",show:S.value,"task-type":((Fe=n.task)==null?void 0:Fe.type)||"lead","task-id":(Ee=n.task)==null?void 0:Ee.id,onSave:ye,onClose:X[2]||(X[2]=ge=>S.value=!1)},null,8,["show","task-type","task-id"]),s(fn,{modal:"",show:o.value,"task-type":((Re=n.task)==null?void 0:Re.type)||"lead","task-id":($e=n.task)==null?void 0:$e.id,onSave:Ie,onClose:X[3]||(X[3]=ge=>o.value=!1)},null,8,["show","task-type","task-id"]),s(vn,{show:k.value,onSave:ce,onClose:X[4]||(X[4]=ge=>k.value=!1)},null,8,["show"]),s(gn,{show:A.value,onSave:te,onClose:X[5]||(X[5]=ge=>A.value=!1)},null,8,["show"]),s(yn,{show:c.value,onSave:K,onClose:X[6]||(X[6]=ge=>c.value=!1)},null,8,["show"]),s(Ca,{show:w.value,title:"Call Feature",onClose:X[7]||(X[7]=ge=>w.value=!1)},null,8,["show"]),s(ja,{show:g.value,"task-type":((Ae=n.task)==null?void 0:Ae.type)||"lead","task-id":(j=n.task)==null?void 0:j.id,onSave:re,onClose:X[8]||(X[8]=ge=>g.value=!1)},null,8,["show","task-type","task-id"]),s(Ba,{show:x.value,mode:"tradein","task-type":((W=n.task)==null?void 0:W.type)||"lead","task-id":(oe=n.task)==null?void 0:oe.id,onSave:xe,onClose:X[9]||(X[9]=ge=>x.value=!1)},null,8,["show","task-type","task-id"]),s(bn,{show:V.value,"task-type":((G=n.task)==null?void 0:G.type)||"lead","task-id":(P=n.task)==null?void 0:P.id,customer:(se=n.task)==null?void 0:se.customer,onSave:De,onClose:X[10]||(X[10]=ge=>V.value=!1)},null,8,["show","task-type","task-id","customer"]),s(Wa,{show:C.value,customer:(le=n.task)==null?void 0:le.customer,assignee:(ke=n.task)==null?void 0:ke.assignee,onCreate:Ge,onCancel:X[11]||(X[11]=ge=>C.value=!1)},null,8,["show","customer","assignee"])])}}},Gp=Et(Fl,[["__scopeId","data-v-b7793434"]]),El={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 shadow-xl flex flex-col overflow-hidden"},Rl={class:"flex-1 min-h-0 flex flex-col overflow-hidden"},jl={__name:"DrawerContainer",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(n,{emit:M}){const i=M,p=()=>{i("close")};return(r,u)=>(f(),D(Me,null,[s(dt,{name:"fade"},{default:l(()=>[n.show?(f(),D("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:p})):_("",!0)]),_:1}),s(dt,{name:"slide-right"},{default:l(()=>[n.show?(f(),D("div",El,[e("div",Rl,[yt(r.$slots,"default",{},void 0,!0)])])):_("",!0)]),_:3})],64))}},Zp=Et(jl,[["__scopeId","data-v-ff23c65a"]]);function za(n,M={}){const i=wa(),p=$(()=>{const V=typeof n=="function"?n():js(n);return{lead:V,displayStage:V?ds(V,"lead"):null}}),r=$(()=>p.value.displayStage||"New"),u=$(()=>{const V=p.value;return hn(V)}),h=$(()=>{const V=p.value,C=xn(V);if(!C)return null;const R=M[C.key];return{...C,handler:R||(()=>{})}}),b=$(()=>{const V=p.value;return wn(V).map(R=>{const F=M[R.key];return{...R,handler:F||(()=>{})}})}),S=$(()=>{const V=p.value;return kn(V)}),o=$(()=>{const V=p.value;return Sn(V)}),k=$(()=>{const V=p.value;return Cn(V)}),A=$(()=>{const V=p.value;return $n(V)}),c=$(()=>{const C=p.value.lead;return((C==null?void 0:C.contactAttempts)||[]).length||0}),w=$(()=>i.getSetting("maxContactAttempts")),g=$(()=>c.value+1>=w.value),x=$(()=>!0);return{displayStage:r,isClosed:u,primaryAction:h,secondaryActions:b,showLQWidget:S,showDeadlineBanner:o,canPostpone:k,canReassign:x,lqWidgetMode:A,contactAttempts:c,maxContactAttempts:w,shouldShowAutoDisqualifyWarning:g}}function Bl({getLead:n,leadState:M,emit:i}){const p=Fa(),r=Rt(),u=Dt();async function h(C){var F;const R=n();if(R&&M.canPostpone.value)try{const E=new Date(`${C.date}T${C.time}:00`),fe=E.toISOString(),pe={nextActionDue:fe};if((C.assigneeId||C.teamId)&&(pe.assignee=C.assignee||null,pe.assigneeId=C.assigneeId||null,pe.assigneeType=C.assigneeType||"user",pe.teamId=C.teamId||null,pe.team=C.team||null),await r.updateLead(R.id,pe),C.createAppointment){const L=new Date(E);L.setHours(L.getHours()+1),await r.updateLead(R.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${R.customer.name}`,start:fe,end:L.toISOString(),type:"Call",assignee:C.assignee||R.assignee,assigneeId:C.assigneeId||R.assigneeId,assigneeType:C.assigneeType||R.assigneeType||"user",teamId:C.teamId||R.teamId,team:C.team||R.team,status:"scheduled"}}),await r.addActivity(R.id,{type:"appointment",user:((F=u.currentUser)==null?void 0:F.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${_t(E)} at ${us(E)}`,data:{type:"Call",date:C.date,time:C.time,assignee:C.assignee||R.assignee}})}await r.addActivity(R.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${_t(E)} at ${us(E)}${C.assignee?` and reassigned to ${C.assignee}`:""}`}),await r.fetchLeadById(R.id)}catch(E){console.error("Failed to postpone lead task:",E)}}async function b(C){const R=n();if(R)try{if(await r.updateLead(R.id,{stage:"Validated"}),await r.addActivity(R.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),C.scheduleFollowUp&&C.appointmentData){const F=new Date(`${C.appointmentData.date}T${C.appointmentData.time}:00`);await r.scheduleFollowUp(R.id,{dateTime:F.toISOString(),assignee:C.appointmentData.assignee||R.assignee,assigneeId:C.appointmentData.assigneeId||null,assigneeType:C.appointmentData.assigneeType||"user",teamId:C.appointmentData.teamId||null,team:C.appointmentData.team||null}),await r.addActivity(R.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${_t(F)} at ${us(F)}`})}await r.fetchLeadById(R.id)}catch(F){console.error("Failed to validate lead:",F)}}async function S(C){var F,E,fe;const R=n();if(R)try{if((F=C==null?void 0:C.assignment)!=null&&F.assignee){const L=C.assignment.assignee,T={assignee:L.name||L.label||null,assigneeId:L.id||null,assigneeType:L.type||"user"};L.type==="team"&&(T.teamId=L.id||null,T.team=L.name||null),C.assignment.salesperson&&(T.assignee=C.assignment.salesperson.name||C.assignment.salesperson,T.assigneeId=C.assignment.salesperson.id||null,T.assigneeType="user",T.teamId=L.id||null,T.team=L.name||null),await r.updateLead(R.id,T);const q=((E=C.assignment.salesperson)==null?void 0:E.name)||L.name||"Unassigned";await r.addActivity(R.id,{type:"note",user:((fe=u.currentUser)==null?void 0:fe.name)||"You",action:"assigned lead",content:`Lead assigned to ${q}${C.assignment.salesperson&&L.name?` (${L.name} team)`:""}`,timestamp:new Date().toISOString()})}const pe=await r.convertLeadToOpportunity(R.id);u.canAccessOpportunities()?p.push({path:`/tasks/${pe}`,query:{type:"opportunity"}}):p.push("/tasks")}catch(pe){console.error("Failed to qualify lead:",pe)}}async function o(C){const R=n();if(R)try{const F=R.contactAttempts||[];await r.updateLead(R.id,{contactAttempts:[...F,C],lastContactAttempt:C.timestamp,totalContactAttempts:F.length+1}),await r.addActivity(R.id,{type:"call",user:"You",action:`logged call attempt - ${C.outcome}`,content:C.notes||`Call attempt via ${C.channel}`,data:{outcome:C.outcome,channel:C.channel,duration:C.duration}}),await r.fetchLeadById(R.id)}catch(F){console.error("Failed to log call attempt:",F)}}async function k(C){const R=n();if(R)try{await r.addActivity(R.id,{type:"note",user:"You",action:"added a note",content:C.content||C.text||"",data:C}),await r.fetchLeadById(R.id)}catch(F){console.error("Failed to save note:",F)}}function A(){i("open-purchase-method")}function c(){i("open-trade-in")}async function w(C){var F;const R=n();if(R)try{const E=C.datetime?new Date(C.datetime).toISOString().split("T")[0]+"T"+C.time+":00":`${C.date}T${C.time}:00`,fe=new Date(E),pe=C.duration||60;fe.setMinutes(fe.getMinutes()+pe);const L={scheduledAppointment:{id:Date.now(),title:`${C.type} - ${R.customer.name}`,start:E,end:fe.toISOString(),type:C.type,assignee:C.assignee,assigneeId:C.assigneeId||C.salespersonId||C.teamId,assigneeType:C.assigneeType||(C.salespersonId?"user":"team"),teamId:C.teamId||null,team:C.team||null,salesperson:C.salesperson||null,salespersonId:C.salespersonId||null,status:"scheduled",location:C.location||"",notes:C.notes||""}};(C.assigneeId||C.salespersonId||C.teamId)&&(L.assignee=C.assignee||C.salesperson||C.team,L.assigneeId=C.assigneeId||C.salespersonId||C.teamId,L.assigneeType=C.assigneeType||(C.salespersonId?"user":"team"),C.teamId&&(L.teamId=C.teamId,L.team=C.team)),await r.updateLead(R.id,L),await r.addActivity(R.id,{type:"appointment",user:((F=u.currentUser)==null?void 0:F.name)||"You",action:"scheduled an appointment",content:`${C.type} scheduled for ${_t(new Date(E))} at ${C.time}`,data:{type:C.type,date:C.date||_t(new Date(E)),time:C.time,assignee:C.assignee,assigneeId:C.assigneeId,team:C.team,salesperson:C.salesperson}}),await r.fetchLeadById(R.id)}catch(E){console.error("Failed to schedule appointment:",E)}}async function g(C){const R=n();if(R&&!(M.isClosed.value&&!C.force))try{const F=M.displayStage.value,E=C.reason==="Duplicate"?Es.CLOSED_DUPLICATE:C.category==="Not Interested"?Es.CLOSED_NOT_INTERESTED:Es.CLOSED_INVALID,fe=Na(F,E);if(fe){const{updates:pe,activities:L}=fe(R,E,C);await r.updateLead(R.id,pe);for(const T of L)await r.addActivity(R.id,T)}else{const pe=C.reason==="Duplicate";await r.updateLead(R.id,{isDisqualified:!0,disqualifyReason:C.reason,isDuplicate:pe,stage:pe?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await r.addActivity(R.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${C.category}, Reason: ${C.reason}`})}p.push("/tasks")}catch(F){console.error("Failed to disqualify lead:",F)}}async function x(){const C=n();if(C)try{const R=M.displayStage.value,F=Es.NEW,E=Na(R,F);if(E){const{updates:fe,activities:pe}=E(C);await r.updateLead(C.id,fe);for(const L of pe)await r.addActivity(C.id,L)}else await r.updateLead(C.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await r.addActivity(C.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await r.fetchLeadById(C.id)}catch(R){console.error("Failed to reopen lead:",R)}}function V(){const C=n();C&&C.opportunityId&&p.push({path:`/tasks/${C.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:h,handleValidated:b,handleQualified:S,handleCallAttemptLogged:o,handleNoteSaved:k,handleOpenPurchaseMethod:A,handleOpenTradeIn:c,handleAppointmentScheduled:w,handleDisqualified:g,handleReopen:x,viewOpportunity:V}}const Wl={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},Pl={class:"space-y-6"},Ya={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(n){return(M,i)=>n.task?(f(),D("div",{key:0,class:Z(["rounded-lg flex flex-col",n.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[n.hideTitle?_("",!0):(f(),D("div",Wl,[...i[0]||(i[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:Z(["bg-white rounded-lg p-2 flex flex-col",n.hideBorder?"shadow-none":"shadow-sm"]),style:ln(n.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[yt(M.$slots,"deadline-banner"),e("div",Pl,[yt(M.$slots,"primary-action"),yt(M.$slots,"task-widgets"),yt(M.$slots,"closed-state"),yt(M.$slots,"secondary-actions")])],6)],2)):_("",!0)}},zl={class:"flex justify-between items-start mb-3"},Yl={class:"font-bold text-gray-900 text-fluid-sm"},Hl={class:"text-fluid-xs text-gray-500 mt-0.5"},Ql={class:"flex gap-3 flex-wrap"},Ha={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(n){return(M,i)=>(f(),D("div",{class:Z(["rounded-card p-4 relative transition-all duration-300 border",[n.colorScheme.background,n.colorScheme.border]])},[e("div",zl,[e("div",null,[e("h4",Yl,N(n.action.title),1),e("p",Hl,N(n.action.description),1)])]),e("div",Ql,[e("button",{onClick:i[0]||(i[0]=p=>M.$emit("action-clicked")),class:Z([n.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:Z(n.action.icon)},null,2),I(" "+N(n.action.label),1)],2)])],2))}},Jl={class:"rounded-lg",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Gl={class:"bg-white rounded-lg px-3 py-2 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Zl={key:0,class:"flex items-center justify-between gap-2"},Kl={class:"flex items-center gap-2 min-w-0 flex-1"},Xl={class:"min-w-0 flex-1"},eo={class:"text-sm font-semibold text-greys-900 truncate leading-tight"},to={class:"font-normal text-greys-500"},so={class:"text-xs text-greys-500 truncate leading-tight"},ao={key:1,class:"space-y-2"},no={class:"flex items-center justify-between gap-2 flex-wrap"},lo={class:"flex items-center gap-1.5 shrink-0"},oo={key:0,class:"flex gap-1.5 flex-wrap"},io=["onClick"],ro={__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"}},emits:["reassigned"],setup(n,{emit:M}){const i=n,p=M,r=qt(),u=Dt(),h=Rt(),b=Mt(),S=O(!1),o=O(null),k=$(()=>u.currentUser),A=$(()=>!!(i.task.assignee||i.task.owner||i.task.assignedTo)),c=$(()=>{var fe;const F=i.task.assignee||i.task.owner||i.task.assignedTo||"Unassigned",E=(fe=r.allUsers)==null?void 0:fe.find(pe=>pe.name===F);return{name:F,team:(E==null?void 0:E.team)||i.task.assigneeTeam||i.task.team||"No team",dealership:(E==null?void 0:E.dealership)||i.task.assigneeDealership||"MotorK Dealership",role:(E==null?void 0:E.role)||i.task.assigneeRole||"salesman"}});$(()=>!k.value||!A.value?!1:c.value.name===k.value.name);const w=$(()=>(r.assignableTeams||[]).slice(0,3)),g=F=>!F||F==="Unassigned"?"?":F.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2),x=F=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[F]||"bg-surfaceSecondary text-body",V=async()=>{if(k.value)try{i.taskType==="lead"?await h.updateLead(i.task.id,{assignee:k.value.name,assigneeType:"user",assigneeTeam:k.value.team,assigneeDealership:k.value.dealership,assigneeRole:k.value.role}):i.taskType==="opportunity"&&await b.updateOpportunity(i.task.id,{assignee:k.value.name,assigneeType:"user",assigneeTeam:k.value.team,assigneeDealership:k.value.dealership,assigneeRole:k.value.role}),p("reassigned",k.value)}catch(F){console.error("Error assigning to self:",F)}},C=async F=>{o.value=F;try{i.taskType==="lead"?await h.updateLead(i.task.id,{assignee:F.name,assigneeType:"team",teamId:F.id,assigneeTeam:F.name}):i.taskType==="opportunity"&&await b.updateOpportunity(i.task.id,{assignee:F.name,assigneeType:"team",teamId:F.id,assigneeTeam:F.name}),p("reassigned",F)}catch(E){console.error("Error assigning to team:",E)}},R=async F=>{try{const E={assignee:F.name,assigneeType:F.type,assigneeTeam:F.team,assigneeDealership:F.dealership,assigneeRole:F.role};F.type==="team"&&(E.teamId=F.id),i.taskType==="lead"?await h.updateLead(i.task.id,E):i.taskType==="opportunity"&&await b.updateOpportunity(i.task.id,E),S.value=!1,p("reassigned",F)}catch(E){console.error("Error reassigning:",E)}};return(F,E)=>(f(),D(Me,null,[e("div",Jl,[e("div",Gl,[A.value?(f(),D("div",Zl,[e("div",Kl,[e("div",{class:Z(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",x(c.value.role)])},N(g(c.value.name)),3),e("div",Xl,[e("p",eo,[I(N(c.value.name)+" ",1),e("span",to,"• "+N(c.value.team),1)]),e("p",so,N(c.value.dealership),1)])]),s(t(ee),{variant:"ghost",size:"sm",onClick:E[0]||(E[0]=fe=>S.value=!0),class:"shrink-0 text-xs px-2 py-1"},{default:l(()=>[...E[3]||(E[3]=[I(" Change ",-1)])]),_:1})])):(f(),D("div",ao,[e("div",no,[E[6]||(E[6]=e("p",{class:"text-sm text-greys-500 font-medium"},"Unassigned",-1)),e("div",lo,[s(t(ee),{variant:"primary",size:"sm",onClick:V,class:"!bg-brand-red text-sm px-3 py-1"},{default:l(()=>[...E[4]||(E[4]=[I(" Assign to me ",-1)])]),_:1}),s(t(ee),{variant:"outline",size:"sm",onClick:E[1]||(E[1]=fe=>S.value=!0),class:"text-sm px-3 py-1 border-D1D5DB"},{default:l(()=>[...E[5]||(E[5]=[I(" Assign to someone ",-1)])]),_:1})])]),w.value.length>0?(f(),D("div",oo,[(f(!0),D(Me,null,We(w.value,fe=>{var pe;return f(),D("button",{key:fe.id,class:Z(["inline-flex items-center gap-1 px-2 py-0.5 rounded-md border text-xs font-medium transition-all",((pe=o.value)==null?void 0:pe.id)===fe.id?"border-brand-blue bg-blue-50 text-brand-blue":"border-E5E7EB hover:border-brand-blue/30 text-greys-600"]),onClick:L=>C(fe)},[E[7]||(E[7]=e("i",{class:"fa-solid fa-users text-xs"},null,-1)),I(" "+N(fe.name),1)],10,io)}),128))])):_("",!0)]))])]),s(Pa,{show:S.value,title:A.value?"Reassign task":"Assign task","confirm-label":A.value?"Reassign":"Assign",onClose:E[2]||(E[2]=fe=>S.value=!1),onConfirm:R},null,8,["show","title","confirm-label"])],64))}},Qa=Et(ro,[["__scopeId","data-v-8fbba5aa"]]),Ft=(n,M)=>{if(!n||!M)return[];const i=new Date(M).getDay();if(i===0||i===6)return[];const[r,u]=n.split("-"),h=parseInt(u);return r==="team"?co(h,M):r==="user"?uo(h,M,i):[]},uo=(n,M,i)=>{const p={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(p[n]||p[1])[i]||[]},co=(n,M)=>{const i=new Date(M).getDay(),p=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return n===1?i===1||i===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:n===2?p.filter((r,u)=>u%2===0):p},mo={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},po={class:"space-y-3"},fo={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},vo={class:"font-semibold text-heading text-sm mb-4"},go={class:"mb-4"},yo={class:"mb-4"},bo={class:"flex gap-2"},ho={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wo={class:"flex items-center justify-between mb-4"},ko={class:"text-sm font-semibold text-heading"},So={class:"grid grid-cols-7 gap-1 mb-2"},Co={class:"grid grid-cols-7 gap-1"},$o=["onClick"],Do={class:"text-sm font-semibold text-heading mb-4"},Ao={key:0,class:"space-y-2"},To=["onClick"],Oo={key:1,class:"text-sm text-sub py-4 text-center"},Io={key:2,class:"text-sm text-sub py-4 text-center"},No={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(n,{emit:M}){const{t:i}=ka(),p=n,r=M,u=Dt(),h=qt(),b=O("assign-and-schedule"),S=O(""),o=O(null),k=O(""),A=O(""),c=O("30min"),w=O(new Date().getMonth()),g=O(new Date().getFullYear()),x=O(null);$(()=>h.assignableUsers),$(()=>h.assignableTeams);const V=$(()=>new Date(g.value,w.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),C=$(()=>{const ce=new Date(g.value,w.value,1),K=new Date(g.value,w.value+1,0).getDate(),re=ce.getDay()===0?6:ce.getDay()-1,xe=[];for(let De=0;De<re;De++)xe.push(null);for(let De=1;De<=K;De++)xe.push(De);return xe}),R=$(()=>[{value:"Showroom Visit",label:i("forms.schedule.eventType.options.showroomVisit")},{value:"Test Drive",label:i("forms.schedule.eventType.options.testDrive")},{value:"Video Call",label:i("forms.schedule.eventType.options.videoCall")},{value:"Home Visit",label:i("forms.schedule.eventType.options.homeVisit")},{value:"Closing Meeting",label:i("forms.schedule.eventType.options.closingMeeting")}]),F=["MON","TUE","WED","THU","FRI","SAT","SUN"],E=$(()=>{if(!x.value||!k.value)return i("forms.schedule.timeSlots.selectDate");const ce=new Date(k.value),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${te[ce.getDay()]}, ${K[ce.getMonth()]} ${ce.getDate()}`}),fe=ce=>{if(!ce||!k.value)return!1;const te=new Date(k.value);return te.getDate()===ce&&te.getMonth()===w.value&&te.getFullYear()===g.value},pe=ce=>{if(!ce)return;const te=new Date(g.value,w.value,ce);k.value=te.toISOString().split("T")[0],x.value=ce,A.value=""},L=()=>{w.value===0?(w.value=11,g.value--):w.value--},T=()=>{w.value===11?(w.value=0,g.value++):w.value++},q=$(()=>!k.value||!o.value?[]:Ft(o.value,k.value)),B=()=>{var ce;if(p.preselectedAssignee){const{type:te,id:K}=p.preselectedAssignee;o.value=`${te}-${K}`}else o.value=`user-${((ce=u.currentUser)==null?void 0:ce.id)||1}`};B();const Y=$(()=>b.value==="assign-only"?!0:!!(S.value&&k.value&&A.value&&o.value));he(()=>p.show,ce=>{ce?B():ne()}),he(k,()=>{A.value=""});const ne=()=>{b.value="assign-and-schedule",S.value="",k.value="",A.value="",c.value="30min",x.value=null;const ce=new Date;w.value=ce.getMonth(),g.value=ce.getFullYear()},H=ce=>{ce||r("close")},ye=()=>{if(!Y.value)return;const ce=o.value.startsWith("team-"),te=parseInt(o.value.split("-")[1]);let K={};if(ce){const xe=h.getTeamById(te);K={assigneeType:"team",teamId:te,team:(xe==null?void 0:xe.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const xe=h.getUserById(te);K={assigneeType:"user",assigneeId:te,assignee:(xe==null?void 0:xe.name)||"Unknown",teamId:null,team:null}}const re={...K};b.value==="assign-and-schedule"&&(re.type=S.value,re.date=k.value,re.time=A.value,re.duration=c.value),r("confirm",re),r("close")},Ie=()=>{r("close")};return(ce,te)=>(f(),de(t(bs),{open:n.show,"onUpdate:open":H},{default:l(()=>[s(t(ms),null,{default:l(()=>[s(t(ps),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(fs),{class:"w-full sm:max-w-4xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:l(()=>[s(t(vs),{class:"flex-shrink-0"},{default:l(()=>[s(t(gs),{class:"text-fluid-lg"},{default:l(()=>[...te[6]||(te[6]=[I("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",mo,[e("div",po,[e("label",{class:Z(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",b.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Qe(e("input",{type:"radio","onUpdate:modelValue":te[0]||(te[0]=K=>b.value=K),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ct,b.value]]),te[7]||(te[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:Z(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",b.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Qe(e("input",{type:"radio","onUpdate:modelValue":te[1]||(te[1]=K=>b.value=K),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[ct,b.value]]),te[8]||(te[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),b.value==="assign-and-schedule"?(f(),D("div",fo,[e("h5",vo,N(t(i)("forms.schedule.title")),1),e("div",go,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[I(N(t(i)("forms.schedule.eventType.label")),1)]),_:1}),s(t(Ye),{modelValue:S.value,"onUpdate:modelValue":te[2]||(te[2]=K=>S.value=K),items:R.value,placeholder:t(i)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:l(({item:K})=>[e("span",null,N(K.label),1)]),_:1},8,["modelValue","items","placeholder"])]),e("div",yo,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[I(N(t(i)("forms.schedule.duration.label")),1)]),_:1}),e("div",bo,[e("button",{onClick:te[3]||(te[3]=K=>c.value="30min"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="30min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},N(t(i)("forms.schedule.duration.30min")),3),e("button",{onClick:te[4]||(te[4]=K=>c.value="60min"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="60min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},N(t(i)("forms.schedule.duration.60min")),3),e("button",{onClick:te[5]||(te[5]=K=>c.value="custom"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="custom"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},N(t(i)("forms.schedule.duration.custom")),3)])]),e("div",ho,[e("div",xo,[e("div",null,[e("div",wo,[e("button",{onClick:L,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[9]||(te[9]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",ko,N(V.value),1),e("button",{onClick:T,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[10]||(te[10]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",So,[(f(),D(Me,null,We(F,K=>e("div",{key:K,class:"text-center text-xs font-medium text-sub py-2"},N(K),1)),64))]),e("div",Co,[(f(!0),D(Me,null,We(C.value,(K,re)=>(f(),D("div",{key:re,onClick:xe=>pe(K),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg cursor-pointer transition-all",fe(K)?"bg-[#0470e9] text-white":K?"text-body hover:bg-surfaceSecondary":"text-transparent"])},N(K),11,$o))),128))])]),e("div",null,[e("h6",Do,N(E.value),1),k.value&&q.value.length>0?(f(),D("div",Ao,[(f(!0),D(Me,null,We(q.value,K=>(f(),D("button",{key:K,onClick:re=>A.value=K,class:Z(["w-full py-2 px-4 bg-white border border-black/5 rounded-lg shadow-sm text-sm font-medium text-center transition-all",A.value===K?"border-[#0470e9] bg-surfaceSecondary text-heading":"text-body hover:border-[#0470e9]/30"])},N(K),11,To))),128))])):k.value&&q.value.length===0?(f(),D("div",Oo,N(t(i)("forms.schedule.timeSlots.noSlots")),1)):(f(),D("div",Io,N(t(i)("forms.schedule.timeSlots.selectDate")),1))])])])])):_("",!0)]),s(t(ys),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:l(()=>[s(t(Ia),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:Ie}),s(t(Ia),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!Y.value,onClick:ye},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Ja(){const n=on(),M=O(!1),i=O(!1),p=O(0),r=O(""),u=O(null),h=O({}),b=O(null),S={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},o=$(()=>{const x=Math.floor(p.value/60),V=p.value%60;return`${x.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}`}),k=()=>{M.value=!0,p.value=0,i.value=!1,r.value="",u.value=setInterval(()=>{p.value++,p.value>=20&&A()},1e3)},A=()=>{u.value&&(clearInterval(u.value),u.value=null),M.value=!1,i.value=!0,h.value={duration:p.value,notes:r.value,transcription:S,channel:"phone"}},c=async x=>{try{await navigator.clipboard.writeText(x),n.pushToast("success","Phone number copied to clipboard!")}catch{n.pushToast("error","Failed to copy phone number")}},w=x=>(b.value={tradeIn:S.leadLines.some(V=>V.toLowerCase().includes("trade")||V.toLowerCase().includes("exchange"))||!1,financing:S.leadLines.some(V=>V.toLowerCase().includes("financ")||V.toLowerCase().includes("payment")||V.toLowerCase().includes("loan"))||!1},b.value.tradeIn&&x&&(x.value.tradeIn=!0),b.value.financing&&x&&(x.value.financing=!0),b.value),g=()=>{M.value=!1,i.value=!1,p.value=0,r.value="",h.value={},u.value&&(clearInterval(u.value),u.value=null)};return rn(()=>{u.value&&clearInterval(u.value)}),{isCallActive:M,callEnded:i,callDuration:p,callNotes:r,callData:h,extractedData:b,mockTranscription:S,formattedCallDuration:o,startCall:k,endCall:A,copyNumber:c,extractInformation:w,resetCall:g}}function Vo(n,M,i,p,r,u){var Ze,Je,Ue;const h=O(!0),b=O(null),S=O(!1),o=O(!1),k=O(!1),A=O(""),c=O(null),w=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],g=O("whatsapp"),x=O("followup-1"),V=O(null),C=O(""),R=O("09:00"),F=O(null),E=O("Not Interested"),fe=O(""),pe=O({dealership:((Je=(Ze=n.value)==null?void 0:Ze.requestedCar)==null?void 0:Je.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Ue=u==null?void 0:u.value)==null?void 0:Ue.id)||null}),L=O(null),T=O(null),q=O({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),B=$(()=>{var ae,be;if(!((ae=n.value)!=null&&ae.requestedCar))return null;const ue=(be=n.value.requestedCar.condition)==null?void 0:be.toLowerCase();return ue==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:ue==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),Y=O({tradeIn:!1,financing:!1,contactAvailability:!1}),ne=O(!1),H=O(null),ye=O(!0),Ie=O(null),ce=O(null),te=O("assign-and-schedule"),K=O(""),re=O(null),xe=O(""),De=O(null),Ge=O(""),z=O(""),X=O(null),Fe=O(""),Ee=ue=>{Fe.value=ue},Re=$(()=>{const ue=[];for(let ae=9*60;ae<=18*60;ae+=30){const be=String(Math.floor(ae/60)).padStart(2,"0"),Se=String(ae%60).padStart(2,"0");ue.push(`${be}:${Se}`)}return ue}),$e=$(()=>{if(re.value!=null)return re.value;const ue=parseInt(xe.value,10);return Number.isFinite(ue)&&ue>0?ue:null}),Ae=$(()=>{if(!De.value)return[];const ue=[],ae=new Date;if(ae.setHours(0,0,0,0),De.value==="tomorrow"){const be=new Date(ae);be.setDate(be.getDate()+1),be.getDay()!==0&&be.getDay()!==6&&ue.push(be)}else if(De.value==="this-week"){const be=ae.getDay(),Se=new Date(ae);Se.setDate(ae.getDate()-(be===0?6:be-1));for(let Ce=0;Ce<5;Ce++){const Ve=new Date(Se);Ve.setDate(Se.getDate()+Ce),Ve>=ae&&ue.push(Ve)}}else if(De.value==="custom"&&Ge.value&&z.value){const be=new Date(Ge.value),Se=new Date(z.value),Ce=new Date(be);for(;Ce<=Se;)Ce.getDay()!==0&&Ce.getDay()!==6&&ue.push(new Date(Ce)),Ce.setDate(Ce.getDate()+1)}return ue}),j=$(()=>{var Se,Ce,Ve,Ke,Xe,et,nt;const ue=((Ve=(Ce=(Se=n.value)==null?void 0:Se.customer)==null?void 0:Ce.name)==null?void 0:Ve.split(" ")[0])||"",ae=((Xe=(Ke=n.value)==null?void 0:Ke.requestedCar)==null?void 0:Xe.brand)||"",be=((nt=(et=n.value)==null?void 0:et.requestedCar)==null?void 0:nt.model)||"";return{"followup-1":`Hi ${ue}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${ae} ${be}?`,"followup-2":`Hello ${ue}, this is regarding your inquiry about the ${ae} ${be}. Please let me know when you're available for a call.`,custom:""}}),W=$(()=>x.value==="custom"?"Type your custom message...":j.value[x.value]||""),oe=$(()=>{var ue;return!!((ue=n.value)!=null&&ue.scheduledAppointment)}),G=()=>{const ue=new Date,ae=ue.getHours(),be=ue.getDay();let Se=new Date,Ce="10:00",Ve="";if(be===5&&ae>=15)Se.setDate(ue.getDate()+3),Ce="10:00",Ve="Optimal time after weekend, customer likely refreshed";else if(be===6||be===0)Se.setDate(ue.getDate()+(be===6?2:1)),Ce="10:00",Ve="Weekend follow-up avoided, better response rate on weekdays";else if(ae>=17)Se.setDate(ue.getDate()+1),Ce="10:00",Ve="Business hours preferred, higher engagement rate";else if(ae<9)Se=new Date(ue),Se.setHours(10,0,0,0),Ce="10:00",Ve="Peak response time, customers more available mid-morning";else if(ae<14){Se=new Date(ue);const et=ae+2;Se.setHours(et,0,0,0),Ce=`${String(et).padStart(2,"0")}:00`,Ve="Follow-up within same day increases conversion likelihood"}else Se.setDate(ue.getDate()+1),Se.setHours(10,0,0,0),Ce="10:00",Ve="Next morning follow-up maintains momentum";const Ke=Se.toISOString().split("T")[0],Xe=`${Ke}T${Ce}:00`;return{date:Ke,time:Ce,dateTime:Xe,reason:Ve,formattedDate:Se.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:h,selectedOutcome:b,showNoteModal:S,showScheduleAppointmentModal:o,followupChannels:w,followupChannel:g,selectedTemplate:x,rescheduleTime:V,customDate:C,customTime:R,disqualifyCategory:E,disqualifyReason:fe,assignment:pe,preferences:Y,surveyCompleted:ne,surveyResponses:H,showSurvey:ye,aiSuggestionData:F,showCallLogForm:k,callLogDateTime:A,callLogAssignee:c,qualificationSelectedTeam:L,qualificationSelectedSalesman:T,suggestedTeam:B,communicationPreferences:q,messageTemplates:j,messagePreview:W,hasExistingAppointment:oe,selectOutcome:ue=>{if(b.value=ue,!A.value){const ae=new Date,be=ae.getFullYear(),Se=String(ae.getMonth()+1).padStart(2,"0"),Ce=String(ae.getDate()).padStart(2,"0"),Ve=String(ae.getHours()).padStart(2,"0"),Ke=String(ae.getMinutes()).padStart(2,"0");A.value=`${be}-${Se}-${Ce}T${Ve}:${Ke}`}!c.value&&(u!=null&&u.value)&&(c.value=u.value),ue==="interested"&&(ne.value=!1,H.value=null,ye.value=!0,i!=null&&i.value&&(Y.value.tradeIn=i.value.tradeIn||!1,Y.value.financing=i.value.financing||!1))},cancelOutcome:()=>{b.value=null,k.value=!1},calculateNextCallDate:()=>{if(V.value==="tomorrow-9am"){const ae=new Date;return ae.setDate(ae.getDate()+1),ae.setHours(9,0,0,0),ae.toISOString()}else if(V.value==="monday"){if(F.value)return new Date(F.value.dateTime).toISOString();const ae=new Date,be=(8-ae.getDay())%7||7;return ae.setDate(ae.getDate()+be),ae.setHours(9,0,0,0),ae.toISOString()}else if(V.value==="custom"&&C.value&&R.value)return new Date(`${C.value}T${R.value}:00`).toISOString();const ue=new Date;return ue.setDate(ue.getDate()+1),ue.setHours(9,0,0,0),ue.toISOString()},calculateAISuggestion:G,handleAISuggestionClick:()=>{V.value="monday",F.value=G()},resetOutcomeState:()=>{b.value=null,h.value=!0,g.value="whatsapp",x.value="followup-1",V.value=null,C.value="",R.value="09:00",E.value="Not Interested",fe.value="",ne.value=!1,H.value=null,ye.value=!0,F.value=null,k.value=!1,A.value="",c.value=null,Ie.value=null,ce.value=null,te.value="assign-only",K.value="",De.value=null,Ge.value="",z.value="",X.value=null,Fe.value="",L.value=null,T.value=null,re.value=null,xe.value=""},initCallLogForm:(ue=!1)=>{if(Ie.value)return;const ae=new Date,be=ae.getFullYear(),Se=String(ae.getMonth()+1).padStart(2,"0"),Ce=String(ae.getDate()).padStart(2,"0"),Ve=String(ae.getHours()).padStart(2,"0"),Ke=String(ae.getMinutes()).padStart(2,"0");A.value=`${be}-${Se}-${Ce}T${Ve}:${Ke}`,u!=null&&u.value&&(c.value=u.value),k.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{k.value=!1,A.value="",c.value=null},clearSuccessState:()=>{Ie.value=null,ce.value=null},successState:Ie,successPerformedAt:ce,qualificationMethod:te,qualificationEventType:K,qualificationDurationMinutes:re,qualificationCustomDuration:xe,qualificationDateRange:De,qualificationCustomDateStart:Ge,qualificationCustomDateEnd:z,availableDatesForRange:Ae,qualificationSelectedDate:X,qualificationSelectedSlot:Fe,setQualificationSelectedSlot:Ee,qualificationScheduleSlotOptions:Re,qualificationDurationValue:$e}}function Mo(n,M,i,p,r,u,h,b,S=null){const{callData:o}=M,{showOutcomeSelection:k,selectedOutcome:A,assignment:c,preferences:w,cancelOutcome:g,calculateNextCallDate:x,showScheduleAppointmentModal:V,surveyCompleted:C,surveyResponses:R,showSurvey:F,initCallLogForm:E,callLogDateTime:fe,callLogAssignee:pe,successState:L,successPerformedAt:T,rescheduleTime:q,aiSuggestionData:B,customDate:Y,customTime:ne,qualificationMethod:H,qualificationEventType:ye,qualificationDurationValue:Ie,qualificationSelectedDate:ce,qualificationSelectedSlot:te,qualificationSelectedTeam:K,qualificationSelectedSalesman:re,communicationPreferences:xe}=i,De=()=>{var P;return((P=b==null?void 0:b.value)==null?void 0:P.name)||"Unknown"},Ge=()=>q.value==="tomorrow-9am"?"Tomorrow 9:00 AM":q.value==="monday"&&B.value?`${B.value.formattedDate} at ${B.value.time}`:q.value==="monday"?"Monday":q.value==="custom"&&Y.value&&ne.value?`${Y.value} ${ne.value}`:"selected time";return{logManualCall:()=>{o.value={channel:"external",notes:"",transcription:null},E(!0)},handleScheduleAppointmentConfirm:async P=>{V.value=!1,n("appointment-scheduled",P)},handleQualify:async()=>{var Pe,Ze,Je,Ue,ue,ae,be,Se,Ce,Ve,Ke,Xe,et,nt,lt,xt,He,ot,mt,pt,wt,je,At,ze,_e;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((Pe=o.value)==null?void 0:Pe.channel)||"phone",notes:((Ze=o.value)==null?void 0:Ze.notes)||"",transcription:((Je=o.value)==null?void 0:Je.transcription)||null};n("call-attempt-logged",P),n("validated",{scheduleFollowUp:!1});let se="Unassigned";H.value==="assign-and-schedule"?re.value?se=re.value.name:K.value&&(se=K.value.name):se=((ue=(Ue=c.value)==null?void 0:Ue.assignee)==null?void 0:ue.name)||"Unassigned";let le=null,ke=!1,ge=null;if(H.value==="assign-and-schedule"&&ce.value&&te.value){const me=ce.value,Tt=me.toLocaleDateString(void 0,{month:"long",day:"numeric"}),jt={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[ye.value]||ye.value;ke=!0;const Be=me.getFullYear(),it=String(me.getMonth()+1).padStart(2,"0"),Zt=String(me.getDate()).padStart(2,"0"),Kt=`${Be}-${it}-${Zt}`;if(ge={datetime:me,date:Kt,time:te.value,type:jt,assignee:se,assigneeId:((ae=re.value)==null?void 0:ae.id)||((be=K.value)==null?void 0:be.id)||null,assigneeType:re.value?"user":"team",duration:Ie.value,team:((Se=K.value)==null?void 0:Se.name)||null,teamId:((Ce=K.value)==null?void 0:Ce.id)||null,salesperson:((Ve=re.value)==null?void 0:Ve.name)||null,salespersonId:((Ke=re.value)==null?void 0:Ke.id)||null},le={date:Tt,time:te.value,title:jt,name:((et=(Xe=p.value)==null?void 0:Xe.customer)==null?void 0:et.name)||"",location:se},n("appointment-scheduled",ge),xe.value){const ft=xe.value;if((nt=ft.immediateConfirmation)!=null&&nt.enabled&&((xt=(lt=ft.immediateConfirmation)==null?void 0:lt.channels)==null?void 0:xt.length)>0){for(const rt of ft.immediateConfirmation.channels)if(h&&((He=p.value)!=null&&He.id))try{await h.addActivity(p.value.id,{type:rt,user:De(),action:`sent ${rt} confirmation`,content:`Appointment confirmed: ${jt} on ${Tt} at ${te.value}`,timestamp:new Date().toISOString()})}catch(kt){console.error(`Failed to log ${rt} confirmation:`,kt)}}if((ot=ft.reminder)!=null&&ot.enabled&&((pt=(mt=ft.reminder)==null?void 0:mt.channels)==null?void 0:pt.length)>0){const rt=new Date(me);rt.setDate(rt.getDate()-1);const kt=rt.toISOString().split("T")[0];if(h&&((wt=p.value)!=null&&wt.id))try{await h.addActivity(p.value.id,{type:"reminder-scheduled",user:De(),action:"scheduled reminder",content:`Reminder scheduled for ${kt} via ${ft.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:kt,channels:ft.reminder.channels}})}catch(St){console.error("Failed to schedule reminder:",St)}}if((je=ft.salespersonNotification)!=null&&je.enabled){const rt=((At=re.value)==null?void 0:At.name)||((ze=K.value)==null?void 0:ze.name)||"Team";if(h&&((_e=p.value)!=null&&_e.id))try{await h.addActivity(p.value.id,{type:"notification",user:De(),action:"sent notification",content:`Notification sent to ${rt} about appointment`,timestamp:new Date().toISOString()})}catch(kt){console.error("Failed to send notification:",kt)}}}}H.value==="assign-and-schedule"&&(re.value?c.value={...c.value,assignee:{...re.value,type:"user"},assigneeId:re.value.id,salesperson:re.value}:K.value&&(c.value={...c.value,assignee:{...K.value,type:"team"},team:K.value}));const Le=H.value==="assign-and-schedule"?{assignee:re.value||K.value,salesperson:re.value||null,team:K.value||null}:c.value;let we=null;if(S!=null&&S.value){const me=S.value;we={interestLevel:me.interestLevel,purchaseTimeline:me.purchaseTimeline,budgetRange:me.budgetRange,hasTradeIn:me.hasTradeIn,tradeInModel:me.tradeInModel,financingOption:me.financingOption,additionalNotes:me.additionalNotes}}else C.value&&R.value&&(we=R.value);n("qualified",{assignment:Le,preferences:w.value,scheduleAppointment:ke,appointmentData:ge,surveyData:we});let Ne=`Qualified - Assigned to ${se}`;le&&(Ne=`Qualified - Assigned to ${se}, meeting on ${le.date} ${le.time}`),L.value={kind:"qualified",statusText:Ne,meeting:le,actorName:De()},T.value=new Date,g()},handleDisqualifyFromInterested:()=>{var se,le,ke;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((se=o.value)==null?void 0:se.channel)||"phone",notes:((le=o.value)==null?void 0:le.notes)||"",transcription:((ke=o.value)==null?void 0:ke.transcription)||null};n("call-attempt-logged",P),A.value="not-valid"},handleNoAnswerConfirm:async()=>{var Le,we,Ne,Pe;const P={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Le=o.value)==null?void 0:Le.channel)||"phone",notes:((we=o.value)==null?void 0:we.notes)||"",transcription:((Ne=o.value)==null?void 0:Ne.transcription)||null};n("call-attempt-logged",P);const se=x(),le=se.split("T")[0],ke=new Date(se).toTimeString().slice(0,5);if(h&&((Pe=p.value)!=null&&Pe.id))try{await h.updateLead(p.value.id,{nextActionDue:se,status:"Pending"})}catch(Ze){console.error('Failed to update lead status to "to be called back":',Ze)}n("postponed",{date:le,time:ke,createAppointment:!0}),(r==null?void 0:r.value)+1>=(u==null?void 0:u.value)&&n("disqualified",{category:"Not Interested",reason:"Unreachable"});const ge=Ge();L.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${ge}`,actorName:De()},T.value=new Date,g()},handleNotValidConfirm:()=>{var se,le,ke;const P={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((se=o.value)==null?void 0:se.channel)||"phone",notes:((le=o.value)==null?void 0:le.notes)||"",transcription:((ke=o.value)==null?void 0:ke.transcription)||null};n("call-attempt-logged",P),n("disqualified",{category:i.disqualifyCategory.value,reason:i.disqualifyReason.value}),L.value={kind:"not-interested",statusText:"Closed - Not interested",reason:i.disqualifyReason.value||null,actorName:De()},T.value=new Date,g()},handleNoteSave:P=>{i.showNoteModal.value=!1,n("note-saved",P)},handleSurveyCompleted:async P=>{var se;if(R.value=P,C.value=!0,F.value=!1,h&&((se=p.value)!=null&&se.id))try{await h.addActivity(p.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(P),timestamp:new Date().toISOString()})}catch(le){console.error("Failed to save survey activity:",le)}n("survey-completed",{lead:p.value,responses:P})},handleSurveyRefused:async()=>{var P;if(F.value=!1,h&&((P=p.value)!=null&&P.id))try{await h.addActivity(p.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey refusal activity:",se)}n("survey-refused",{lead:p.value})},handleNotResponding:async()=>{var P;if(F.value=!1,h&&((P=p.value)!=null&&P.id))try{await h.addActivity(p.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey not responding activity:",se)}n("not-responding",{lead:p.value})},handleReopen:()=>{i.clearSuccessState(),i.resetOutcomeState()}}}const qo=["disabled"],Lo={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:n=>["small","medium"].includes(n)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(n){return(M,i)=>(f(),D("button",{class:Z(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",n.size==="small"?"px-3 py-1.5 text-fluid-xs":"px-4 py-2 text-fluid-sm"]),disabled:n.disabled,style:{background:"linear-gradient(135deg, #6B21A8, #9333EA, #A855F7)"},onClick:i[0]||(i[0]=p=>M.$emit("click",p))},[s(t(_n),{size:n.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,N(n.label),1)],10,qo))}},_o={key:0,class:"flex gap-2 items-center mb-4"},Uo=["disabled"],Fo={key:1,class:"mb-4 space-y-4"},Eo={key:0,class:"bg-slate-900 text-white rounded-card"},Ro={class:"flex items-center justify-between px-4 py-3 border-b border-slate-700"},jo={class:"flex items-center gap-2"},Bo={class:"text-xs font-bold uppercase tracking-wider"},Wo={class:"flex items-center gap-3"},Po={class:"flex items-center gap-2 text-red-400"},zo={class:"text-xs font-mono"},Yo={class:"text-xs font-mono text-red-200"},Ho={key:0,class:"p-4 space-y-4"},Qo={key:0,class:"space-y-1"},Jo={class:"space-y-3 text-sm font-mono"},Go={class:"ml-2"},Zo={class:"ml-2"},Ko={key:0},Xo={class:"ml-2"},ei={key:1},ti={class:"ml-2"},si={key:2},ai={class:"ml-2"},ni={key:1,class:"pt-4 border-t border-slate-700"},li=["model-value"],oi={key:1,class:"bg-blue-50 rounded-card p-4"},ii={class:"flex items-center justify-between"},ri={class:"flex gap-2"},Ga={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0},hideButton:{type:Boolean,default:!1}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(n){const M=n,i=O(!1);return he(()=>M.isCallActive,(p,r)=>{if(p&&!r){i.value=!1;return}p||(i.value=!1)}),(p,r)=>(f(),D("div",null,[!n.hideButton&&!n.isCallActive?(f(),D("div",_o,[e("button",{onClick:r[0]||(r[0]=u=>p.$emit("start-call")),disabled:n.isCallActive,class:Z(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",n.isCallActive?"bg-surface border-E5E7EB text-body opacity-60 cursor-not-allowed":"bg-primary hover:bg-primary/90 border-primary text-white cursor-pointer"])},[r[6]||(r[6]=e("i",{class:"fa-solid fa-phone text-xs cursor-pointer"},null,-1)),I(" "+N(n.contactAttempts>0?"Call Again":"Initiate Call"),1)],10,Uo)])):_("",!0),n.isCallActive||n.callEnded?(f(),D("div",Fo,[n.isCallActive||n.callEnded?(f(),D("div",Eo,[e("div",Ro,[e("div",jo,[r[7]||(r[7]=e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"},null,-1)),e("span",Bo,N(n.isCallActive?"TRANSCRIBING":"CALL SUMMARY"),1)]),e("div",Wo,[n.isCallActive?(f(),D(Me,{key:0},[e("div",Po,[r[8]||(r[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",zo,"REC "+N(n.formattedCallDuration),1)]),e("button",{onClick:r[1]||(r[1]=u=>p.$emit("end-call")),class:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg flex items-center gap-2 transition-colors cursor-pointer"},[...r[9]||(r[9]=[e("i",{class:"fa-solid fa-stop text-xs cursor-pointer"},null,-1),I(" Stop Call ",-1)])]),e("button",{type:"button",class:"flex items-center justify-center px-3 h-8 rounded-btn border border-slate-600 bg-slate-800/80 hover:bg-slate-700 cursor-pointer",onClick:r[2]||(r[2]=u=>i.value=!i.value)},[e("i",{class:Z(["fa-solid text-xs cursor-pointer",i.value?"fa-chevron-up":"fa-chevron-down"])},null,2)])],64)):(f(),D(Me,{key:1},[e("span",Yo," Call duration "+N(n.formattedCallDuration),1),e("button",{type:"button",class:"px-3 h-8 rounded-btn border border-slate-600 bg-slate-800/80 hover:bg-slate-700 text-xs font-semibold cursor-pointer",onClick:r[3]||(r[3]=u=>i.value=!i.value)}," See transcription ")],64))])]),i.value?(f(),D("div",Ho,[n.callEnded&&!n.isCallActive?(f(),D("div",Qo,[...r[10]||(r[10]=[e("h4",{class:"text-xs font-bold uppercase tracking-wider text-slate-300"},"Summary",-1),e("p",{class:"text-sm text-slate-100"}," Lead confirmed their details and the call covered the main inquiry discussed in the transcript below. ",-1)])])):_("",!0),e("div",Jo,[e("div",null,[r[11]||(r[11]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Go,N(n.mockTranscription.leadLines[0]),1)]),e("div",null,[r[12]||(r[12]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Zo,N(n.mockTranscription.salesLines[0]),1)]),n.callDuration>=5?(f(),D("div",Ko,[r[13]||(r[13]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Xo,N(n.mockTranscription.leadLines[1]),1)])):_("",!0),n.callDuration>=8?(f(),D("div",ei,[r[14]||(r[14]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",ti,N(n.mockTranscription.salesLines[1]),1)])):_("",!0),n.callDuration>=12?(f(),D("div",si,[r[15]||(r[15]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",ai,N(n.mockTranscription.leadLines[2]),1)])):_("",!0)]),n.isCallActive?(f(),D("div",ni,[e("textarea",{"model-value":n.callNotes,"onUpdate:modelValue":r[4]||(r[4]=u=>p.$emit("update:call-notes",u)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,li)])):_("",!0)])):_("",!0)])):_("",!0),n.callEnded&&!n.isCallActive?(f(),D("div",oi,[e("div",ii,[r[16]||(r[16]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",ri,[s(Lo,{label:"Extract information",size:"small",onClick:r[5]||(r[5]=u=>p.$emit("extract-information"))})])])])):_("",!0)])):_("",!0)]))}},ui={class:"flex items-center gap-2.5 min-w-0"},di={class:"flex items-center gap-2 min-w-0"},Za={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(n,{emit:M}){const i=n,p=M,r=O(!1),u=$(()=>Dn(i.nextActionDue)),h=$(()=>u.value.type==="overdue"?Va:u.value.type==="urgent"?Hn:Va),b=$(()=>i.isClosed||!i.showDeadlineBanner||r.value?!1:u.value.type==="overdue"||u.value.type==="urgent"),S=()=>{r.value=!0,p("dismissed")};return(o,k)=>b.value?(f(),D("div",{key:0,class:Z(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[u.value.bgClass,u.value.borderClass]])},[e("div",ui,[e("div",{class:Z(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",u.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(f(),de(xa(h.value),{size:12,class:Z(u.value.textClass)},null,8,["class"]))],2),e("div",di,[e("span",{class:Z(["text-[10px] font-bold uppercase tracking-wider",u.value.textClass])},N(u.value.type==="overdue"?"Overdue":"Urgent"),3),k[0]||(k[0]=e("span",{class:"text-fluid-xs text-sub opacity-30"},"•",-1)),e("span",{class:Z(["text-fluid-xs font-medium truncate",u.value.textClass])}," Next Action: "+N(t(An)(n.nextActionDue)),3)])]),e("button",{onClick:S,class:Z(["p-1 rounded-md transition-colors shrink-0",[u.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[s(t(_a),{size:14})],2)],2)):_("",!0)}},ci={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},mi={class:"space-y-4"},pi={class:"flex items-center gap-3"},fi={class:"flex items-center gap-3"},vi={class:"text-fluid-sm font-medium text-heading"},Ka={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(n,{emit:M}){const i=M,p=[{value:"email",label:"via Email"},{value:"sms",label:"via SMS"},{value:"whatsapp",label:"via WhatsApp"}],r=O({immediateConfirmationEnabled:!0,immediateConfirmationChannels:["email"],reminderEnabled:!0,reminderChannels:["email"],salespersonNotification:!0});return he(r,u=>{var b,S;const h={immediateConfirmation:{enabled:u.immediateConfirmationEnabled,channels:u.immediateConfirmationEnabled&&((b=u.immediateConfirmationChannels)==null?void 0:b.length)>0?u.immediateConfirmationChannels:[]},reminder:{enabled:u.reminderEnabled,channels:u.reminderEnabled&&((S=u.reminderChannels)==null?void 0:S.length)>0?u.reminderChannels:[]},salespersonNotification:{enabled:u.salespersonNotification}};i("update",h)},{deep:!0}),(u,h)=>(f(),D("div",ci,[h[7]||(h[7]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Send confirmations and reminders",-1)),e("div",mi,[e("div",pi,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"immediate-confirmation",modelValue:r.value.immediateConfirmationEnabled,"onUpdate:modelValue":h[0]||(h[0]=b=>r.value.immediateConfirmationEnabled=b)},null,8,["modelValue"]),h[5]||(h[5]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation to customer",-1))]),_:1}),r.value.immediateConfirmationEnabled?(f(),de(t(Ye),{key:0,modelValue:r.value.immediateConfirmationChannels,"onUpdate:modelValue":h[1]||(h[1]=b=>r.value.immediateConfirmationChannels=b),items:p,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):_("",!0)]),e("div",fi,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"reminder",modelValue:r.value.reminderEnabled,"onUpdate:modelValue":h[2]||(h[2]=b=>r.value.reminderEnabled=b)},null,8,["modelValue"]),h[6]||(h[6]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder the day before appointment",-1))]),_:1}),r.value.reminderEnabled?(f(),de(t(Ye),{key:0,modelValue:r.value.reminderChannels,"onUpdate:modelValue":h[3]||(h[3]=b=>r.value.reminderChannels=b),items:p,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):_("",!0)]),s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},{default:l(()=>[s(t(Ut),{id:"salesperson-notification",modelValue:r.value.salespersonNotification,"onUpdate:modelValue":h[4]||(h[4]=b=>r.value.salespersonNotification=b)},null,8,["modelValue"]),e("span",vi," Notify "+N(n.salesperson?n.salesperson.name:n.team?n.team.name:"salesperson")+" about appointment ",1)]),_:1})]),yt(u.$slots,"actions")]))}},gi={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},$a={__name:"CloseAsLostForm",props:{showMultipleNoShows:{type:Boolean,default:!1},preselectedReason:{type:String,default:""},closeButtonLabel:{type:String,default:"Close"}},emits:["close","cancel","update:reason"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=O(p.preselectedReason||"");he(()=>p.preselectedReason,S=>{S&&(u.value=S)}),he(u,S=>{r("update:reason",S)});const h=$(()=>!!u.value);function b(){h.value&&r("close",u.value)}return M({reason:u,canSubmit:h,submit:b}),(S,o)=>(f(),D("div",gi,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...o[1]||(o[1]=[I("Reason",-1)])]),_:1}),s(t(Vt),{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=k=>u.value=k)},{default:l(()=>[s(t(Ot),{class:"w-full"},{default:l(()=>[s(t(It),{placeholder:"Select a reason..."})]),_:1}),s(t(Nt),null,{default:l(()=>[n.showMultipleNoShows?(f(),de(t(ve),{key:0,value:"Multiple no shows"},{default:l(()=>[...o[2]||(o[2]=[I("Multiple no shows",-1)])]),_:1})):_("",!0),s(t(ve),{value:"Data cleanup"},{default:l(()=>[...o[3]||(o[3]=[I("Data cleanup",-1)])]),_:1}),s(t(ve),{value:"Unreachable"},{default:l(()=>[...o[4]||(o[4]=[I("Unreachable",-1)])]),_:1}),s(t(ve),{value:"Purchase postponed"},{default:l(()=>[...o[5]||(o[5]=[I("Purchase postponed",-1)])]),_:1}),s(t(ve),{value:"Vehicle sold"},{default:l(()=>[...o[6]||(o[6]=[I("Vehicle sold",-1)])]),_:1}),s(t(ve),{value:"Out of budget"},{default:l(()=>[...o[7]||(o[7]=[I("Out of budget",-1)])]),_:1}),s(t(ve),{value:"Financing rejected"},{default:l(()=>[...o[8]||(o[8]=[I("Financing rejected",-1)])]),_:1}),s(t(ve),{value:"Duplicate"},{default:l(()=>[...o[9]||(o[9]=[I("Duplicate",-1)])]),_:1}),s(t(ve),{value:"Bought elsewhere"},{default:l(()=>[...o[10]||(o[10]=[I("Bought elsewhere",-1)])]),_:1}),s(t(ve),{value:"Not interested"},{default:l(()=>[...o[11]||(o[11]=[I("Not interested",-1)])]),_:1}),s(t(ve),{value:"Budget constraints"},{default:l(()=>[...o[12]||(o[12]=[I("Budget constraints",-1)])]),_:1}),s(t(ve),{value:"Found better price"},{default:l(()=>[...o[13]||(o[13]=[I("Found better price at competitor",-1)])]),_:1}),s(t(ve),{value:"No response"},{default:l(()=>[...o[14]||(o[14]=[I("Customer not responding",-1)])]),_:1}),s(t(ve),{value:"Wrong timing"},{default:l(()=>[...o[15]||(o[15]=[I("Timing not right",-1)])]),_:1}),s(t(ve),{value:"Other"},{default:l(()=>[...o[16]||(o[16]=[I("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}},yi={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},bi={class:"pt-1 px-1"},hi={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},xi={class:"flex items-center gap-3"},wi={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},ki={class:"flex-1 pr-10 min-w-0"},Si={class:"text-sm font-medium text-heading"},Ci={key:0,class:"text-sm text-body mt-1"},$i={key:0,class:"mt-4 bg-white rounded-lg border border-black/5 overflow-hidden shadow-sm"},Di={class:"grid grid-cols-2 gap-3 p-4 text-sm"},Ai={class:"ml-2 font-medium text-heading"},Ti={class:"ml-2 font-medium text-heading"},Oi={class:"ml-2 font-medium text-heading capitalize"},Ii={class:"ml-2 font-medium text-heading"},Ni={class:"flex justify-end mt-4"},Vi={class:"px-4 py-2 flex items-center justify-between text-sm text-sub"},Mi={class:"tabular-nums"},qi={class:"pt-1 px-1"},Li={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},_i={class:"p-4"},Ui={class:"flex justify-between items-start mb-3"},Fi={class:"font-bold text-heading text-sm"},Ei={class:"text-sm text-body mt-0.5"},Ri={key:0,class:"mb-3 bg-surfaceSecondary border border-black/5 rounded-lg p-3"},ji={class:"flex items-center justify-between gap-4 flex-wrap"},Bi={key:0,class:"flex items-center gap-2"},Wi={class:"flex items-center gap-2"},Pi={class:"text-sm text-body"},zi={key:1,class:"flex items-center gap-2"},Yi={class:"text-sm font-semibold text-heading"},Hi={key:0,class:"text-sm text-orange-600 font-medium flex items-center gap-1 ml-2"},Qi={class:"px-4 py-4 space-y-3"},Ji={key:0,class:"space-y-4"},Gi={key:0,class:"space-y-4"},Zi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ki={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Xi={key:0,class:"space-y-3"},er=["value"],tr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},sr={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},ar={class:"flex items-start gap-2"},nr={class:"flex-1"},lr={class:"text-sm font-semibold text-heading mb-1"},or={class:"text-xs text-sub"},ir={key:1,class:"mt-3 grid grid-cols-2 gap-3"},rr={key:1,class:"space-y-4"},ur={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},dr={key:2,class:"space-y-4"},cr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},mr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},pr={class:"space-y-4"},fr={class:"flex gap-4"},vr={class:"space-y-2"},gr={class:"flex items-center gap-2 cursor-pointer"},yr={class:"flex justify-end gap-2 mt-4"},br={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},hr={class:"space-y-2"},xr={key:0,class:"space-y-4"},wr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},kr={class:"grid grid-cols-2 gap-4"},Sr={class:"flex items-center gap-2"},Cr={class:"text-sub"},$r={class:"font-medium text-heading"},Dr={class:"flex items-center gap-2"},Ar={class:"font-medium text-heading"},Tr={key:1,class:"space-y-4"},Or={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ir={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Nr={class:"grid grid-cols-2 gap-4"},Vr={class:"flex items-center gap-2"},Mr={class:"text-sub"},qr={class:"font-medium text-heading"},Lr={class:"flex items-center gap-2"},_r={class:"font-medium text-heading"},Ur={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Fr={class:"font-semibold text-heading text-sm mb-4"},Er={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},Rr={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},jr={class:"p-6"},Br={class:"flex items-center justify-between mb-4"},Wr={class:"text-sm font-semibold text-heading"},Pr={class:"grid grid-cols-7 gap-1 mb-2"},zr={class:"grid grid-cols-7 gap-1"},Yr=["onClick"],Hr={class:"p-6"},Qr={class:"text-sm font-semibold text-heading mb-4"},Jr={key:0,class:"space-y-2"},Gr={key:1,class:"text-sm text-sub py-4 text-center"},Zr={key:2,class:"text-sm text-sub py-4 text-center"},Kr={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Xr={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},eu={class:"ml-2 font-medium text-heading"},tu={class:"ml-2 font-medium text-heading"},su={class:"ml-2 font-medium text-heading capitalize"},au={class:"ml-2 font-medium text-heading"},nu={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},lu={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const{t:i}=ka(),p=n,r=M,u=qt(),h=Dt();wa();const b=Rt(),S=za(()=>p.lead,{}),o=Ja(),{isCallActive:k,callEnded:A,callDuration:c,callNotes:w,callData:g,extractedData:x,mockTranscription:V,formattedCallDuration:C,startCall:R,endCall:F,copyNumber:E}=o,fe=O(null),pe=O(!1),L=O(!1),T=O(!1),q=O(!1),B=$(()=>u.assignableUsers),Y=$(()=>u.assignableTeams),ne=$(()=>h.currentUser),H=O({interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}),ye=O(""),Ie=O(""),ce=O(""),te=O("");$(()=>{var a;const m=new Set;return(a=Y.value)==null||a.forEach(U=>{U.dealership&&m.add(U.dealership)}),Array.from(m).sort()}),$(()=>{var m;return ye.value?((m=Y.value)==null?void 0:m.filter(a=>a.dealership===ye.value))||[]:Y.value||[]}),$(()=>{var a,U;if(!Ie.value)return B.value||[];const m=(a=Y.value)==null?void 0:a.find(v=>v.id===Ie.value);return m?((U=B.value)==null?void 0:U.filter(v=>v.team===m.name||v.teamId===m.id))||[]:B.value||[]});const K=m=>m?m.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"?",re=m=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[m]||"bg-surfaceSecondary text-body",xe=m=>{Ue.value.assignee=m,m.type==="team"&&(ut.value=null),pe.value=!1};$(()=>!!ot.value),$(()=>{if(je.value)return je.value.statusText;const m=p.activities.filter(a=>a.type==="call"||a.type==="outcome").sort((a,U)=>new Date(U.timestamp)-new Date(a.timestamp))[0];return m?m.outcome||m.content||"Outcome logged":null});const De=async()=>{var m;try{const a=H.value,U=[];if(a.interestLevel&&U.push(`Interest level: ${a.interestLevel}`),a.purchaseTimeline&&U.push(`Purchase timeline: ${a.purchaseTimeline}`),a.budgetRange&&U.push(`Budget range: ${a.budgetRange}`),a.hasTradeIn&&a.tradeInModel&&U.push(`Trade-in: ${a.tradeInModel}`),a.financingOption){const ie={FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"};U.push(`Financing: ${ie[a.financingOption]||a.financingOption}`)}a.additionalNotes&&U.push(a.additionalNotes);const v=U.join(`
`);if(v.trim()&&(await b.addActivity(p.lead.id,{type:"note",user:((m=ne.value)==null?void 0:m.name)||"You",action:"enriched lead information",content:v,timestamp:new Date().toISOString()}),r("note-saved",{type:"note",content:v,timestamp:new Date().toISOString(),enrichData:{...a}})),a.interestLevel||a.purchaseTimeline||a.budgetRange){const ie={interestLevel:a.interestLevel,purchaseTimeline:a.purchaseTimeline,budgetRange:a.budgetRange};await b.addActivity(p.lead.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ie),timestamp:new Date().toISOString()}),r("survey-completed",{lead:p.lead,responses:ie})}H.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}}catch(a){console.error("Error saving enriched lead data:",a)}},Ge=()=>{R(),wt(!1)},z=()=>{E(p.lead.customer.phone)},X=m=>{w.value=m},Fe=$(()=>{var m;return((m=S.primaryAction.value)==null?void 0:m.title)||"Call to Verify Contact Details"}),Ee=$(()=>{var m;return((m=S.primaryAction.value)==null?void 0:m.description)||"Begin lead qualification by verifying customer contact information."}),Re=$(()=>p.lead.scheduledAppointment?new Date(p.lead.scheduledAppointment.start)<new Date:!1),$e=$(()=>!!p.lead.scheduledAppointment),Ae=$(()=>$e.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Re.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:p.lead.nextActionDue?`Task Pending - Due ${Tn(p.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),j=S.contactAttempts,W=S.maxContactAttempts,oe=Vo(cs(p,"lead"),g,x,j,W,ne),{showOutcomeSelection:G,selectedOutcome:P,showNoteModal:se,showScheduleAppointmentModal:le,followupChannels:ke,followupChannel:ge,selectedTemplate:Le,rescheduleTime:we,customDate:Ne,customTime:Pe,disqualifyCategory:Ze,disqualifyReason:Je,assignment:Ue,preferences:ue,messageTemplates:ae,messagePreview:be,hasExistingAppointment:Se,selectOutcome:Ce,cancelOutcome:Ve,calculateNextCallDate:Ke,surveyCompleted:Xe,surveyResponses:et,showSurvey:nt,aiSuggestionData:lt,handleAISuggestionClick:xt,callLogDateTime:He,callLogAssignee:ot,confirmCallLogForm:mt,cancelCallLogForm:pt,initCallLogForm:wt,successState:je,successPerformedAt:At,qualificationMethod:ze,qualificationEventType:_e,qualificationDurationMinutes:me,qualificationCustomDuration:Tt,qualificationCalendarMonth:jt,qualificationSelectedDate:Be,qualificationSelectedSlot:it,setQualificationSelectedSlot:Zt,qualificationDateRange:Kt,qualificationCustomDateStart:ft,qualificationCustomDateEnd:rt,availableDatesForRange:kt,qualificationScheduleSlotOptions:St,qualificationDurationValue:ws,qualificationSelectedTeam:qe,qualificationSelectedSalesman:ut,suggestedTeam:ks,communicationPreferences:Ss}=oe;function Ws(m){ge.value=m}function Bt(m){if(!m){we.value=null;return}m==="monday"?xt():we.value=m}function Ps(m){Je.value=m}const zs=m=>{Ss.value=m},Wt=$(()=>{if(!Be.value)return[];const m=Be.value.toISOString().split("T")[0];if(ut.value){const a=Ft(`user-${ut.value.id}`,m);return St.value.filter(U=>a.includes(U))}if(qe.value){const a=Ft(`team-${qe.value.id}`,m);return St.value.filter(U=>a.includes(U))}return St.value||[]});he(Be,()=>{it.value=""}),$(()=>p.activities.filter(m=>m.type==="note"));const Cs=$(()=>(Y.value||[]).slice(0,3)),Ys=$(()=>{if(!Y.value)return[];const m=[...Y.value];if(qe.value){const a=m.findIndex(U=>U.id===qe.value.id);if(a>0){const U=m.splice(a,1)[0];m.unshift(U)}}return m}),$s=$(()=>Ys.value.map(m=>({...m,label:`${m.dealership||"No location"} → ${m.name}`,value:m.id}))),Xt=$(()=>{var U;if(!qe.value)return[];const m=qe.value;return(((U=B.value)==null?void 0:U.filter(v=>v.team===m.name||v.teamId===m.id))||[]).map(v=>({...v,label:v.name,value:v.id}))}),Pt=$({get:()=>{var m;return((m=qe.value)==null?void 0:m.id)||null},set:m=>{var U;if(!m){qe.value=null;return}const a=(U=Y.value)==null?void 0:U.find(v=>v.id===m);qe.value=a||null}}),zt=$({get:()=>{var m;return((m=ut.value)==null?void 0:m.id)||null},set:m=>{if(!m){ut.value=null;return}const a=Xt.value.find(U=>U.id===m);ut.value=a||null}});function Ds(){if(!_e.value||qe.value)return;const m=Y.value;if(!(m!=null&&m.length))return;const a=ks.value;if(a){const U=m.find(v=>v.id===a.id);if(U){qe.value=U;return}}if(p.lead.assignee){const U=m.find(v=>v.name===p.lead.assignee);U&&(qe.value=U)}}he(()=>[_e.value,ks.value,(Y.value??[]).length,p.lead.assignee],()=>{Ds()},{immediate:!0}),he(()=>_e.value&&!qe.value,m=>{m&&un(Ds)},{immediate:!0}),he(_e,m=>{if(m&&!Be.value){const a=new Date;a.setHours(0,0,0,0),Be.value=a,tt.value=a.getMonth(),vt.value=a.getFullYear(),it.value=""}},{immediate:!0}),he(P,m=>{var a,U,v;if(m==="interested"&&ze.value==="assign-only"&&!((a=Ue.value)!=null&&a.assignee))if(p.lead.assignee){const Q=(U=B.value)==null?void 0:U.find(Te=>Te.name===p.lead.assignee),ie=(v=Y.value)==null?void 0:v.find(Te=>Te.name===p.lead.assignee);Q?Ue.value={...Ue.value,assignee:{...Q,type:"user"}}:ie&&(Ue.value={...Ue.value,assignee:{...ie,type:"team"}})}else Cs.value.length>0&&(Ue.value={...Ue.value,assignee:{...Cs.value[0],type:"team"}})}),he(()=>{var m;return(m=Ue.value)==null?void 0:m.assignee},m=>{(m==null?void 0:m.type)!=="team"&&(ut.value=null)}),he(qe,m=>{ut.value=null,m&&_e.value&&es(`team-${m.id}`)}),he(ut,m=>{m?es(`user-${m.id}`):qe.value&&es(`team-${qe.value.id}`)}),he(Be,()=>{it.value=""});const es=m=>{const a=new Date;a.setHours(0,0,0,0);for(let U=0;U<30;U++){const v=new Date(a);if(v.setDate(a.getDate()+U),v.getDay()===0||v.getDay()===6)continue;const Q=v.toISOString().split("T")[0],ie=Ft(m,Q);if(ie&&ie.length>0){Be.value=v,tt.value=v.getMonth(),vt.value=v.getFullYear(),setTimeout(()=>{const Te=St.value.filter(Oe=>ie.includes(Oe));Te.length>0&&(it.value=Te[0])},0);break}}},As=$(()=>!(P.value!=="no-answer"||!ge.value||ge.value!=="dont-send"&&!Le.value||!we.value||we.value==="custom"&&(!Ne.value||!Pe.value)));he(P,m=>{m!=="interested"&&(H.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""},ye.value="",Ie.value="",ce.value="")}),he(ce,m=>{var a,U;if(m){const v=(a=B.value)==null?void 0:a.find(Q=>Q.id===m);if(v){const Q=(U=Y.value)==null?void 0:U.find(ie=>ie.name===v.team||ie.id===v.teamId);Q&&(Ie.value=Q.id,Q.dealership&&(ye.value=Q.dealership))}}}),he(Ie,m=>{var a,U;if(m&&ce.value){const v=(a=B.value)==null?void 0:a.find(ie=>ie.id===ce.value),Q=(U=Y.value)==null?void 0:U.find(ie=>ie.id===m);v&&Q&&v.team!==Q.name&&v.teamId!==Q.id&&(ce.value="")}}),he(ye,m=>{var a;if(m&&Ie.value){const U=(a=Y.value)==null?void 0:a.find(v=>v.id===Ie.value);U&&U.dealership!==m&&(Ie.value="",ce.value="")}}),he(A,m=>{m&&!je.value&&wt(!1)});const Hs=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],Qs=$(()=>Hs.map(m=>({value:m.value,label:m.label}))),tt=O(new Date().getMonth()),vt=O(new Date().getFullYear()),Js=["MON","TUE","WED","THU","FRI","SAT","SUN"],Gs=$(()=>new Date(vt.value,tt.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),Ts=$(()=>{const m=new Date(vt.value,tt.value,1),U=new Date(vt.value,tt.value+1,0).getDate(),v=m.getDay()===0?6:m.getDay()-1,Q=[];for(let ie=0;ie<v;ie++)Q.push(null);for(let ie=1;ie<=U;ie++)Q.push(ie);return Q}),Os=$(()=>{if(!Be.value)return i("forms.schedule.timeSlots.selectDate");const m=Be.value,a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${a[m.getDay()]}, ${U[m.getMonth()]} ${m.getDate()}`}),Zs=m=>{if(!m||!Be.value)return!1;const a=Be.value;return a.getDate()===m&&a.getMonth()===tt.value&&a.getFullYear()===vt.value},Ks=m=>{if(!m)return;const a=new Date(vt.value,tt.value,m);Be.value=a,it.value=""},Is=()=>{tt.value===0?(tt.value=11,vt.value--):tt.value--},Xs=()=>{tt.value===11?(tt.value=0,vt.value++):tt.value++},ea={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},Yt=m=>{me.value=m,Tt.value=""};he(Tt,m=>{m&&(me.value=null)}),he(_e,m=>{if(!m)return;const a=ea[m];a&&(a===15?Yt(15):a===30?Yt(30):a===60?Yt(60):(me.value=null,Tt.value=a.toString()))});const ta=$(()=>ze.value==="assign-only"?!!(_e.value&&qe.value):!!(_e.value&&ws.value&&Be.value&&it.value&&qe.value)),sa=$(()=>!!Je.value);function aa(m){Je.value=m,Ze.value||(Ze.value="Not Valid"),qs()}const Ns=$(()=>P.value==="no-answer"?ge.value==="dont-send"?"Postpone":"Send and postpone":P.value==="not-valid"?Ze.value?`Close as ${Ze.value}`:"Close":P.value==="interested"?"Schedule and qualify":""),na=$(()=>P.value==="no-answer"?As.value:P.value==="not-valid"?sa.value:P.value==="interested"?ta.value:!1),la=()=>{P.value==="no-answer"?Ms():P.value==="not-valid"?qs():P.value==="interested"&&ra()},Vs=Mo(r,o,oe,cs(p,"lead"),j,W,b,ne,H),{logManualCall:oa,handleScheduleAppointmentConfirm:ia,handleQualify:ra,handleNoAnswerConfirm:Ms,handleNotValidConfirm:qs,handleNoteSave:ua,handleReopen:da}=Vs,ca=$(()=>{if(!At.value)return"";const m=At.value,a=String(m.getDate()).padStart(2,"0"),U=String(m.getMonth()+1).padStart(2,"0"),v=String(m.getFullYear()),Q=String(m.getHours()).padStart(2,"0"),ie=String(m.getMinutes()).padStart(2,"0");return`${a}/${U}/${v} ${Q}:${ie}`}),{saveTradeInVehicle:Ls}=On(),y=async m=>{var a,U,v;try{L.value=!1,ue.value.financing=!0;const Q=m.type==="FIN"?"Captive Financing":m.type==="LEA"?"Leasing":"Long-Term Rental",ie=((a=m.fields)==null?void 0:a.monthlyInstalment)||0;await b.addActivity(p.lead.id,{type:"purchase-method",user:((U=ne.value)==null?void 0:U.name)||"You",action:`added a ${Q} purchase method`,content:`${Q}: €${ie.toLocaleString()}/month for ${((v=m.fields)==null?void 0:v.duration)||0} months`,data:{purchaseMethodId:m.id,type:m.type,...m.fields},timestamp:new Date().toISOString()}),r("note-saved",{type:"purchase-method",...m})}catch(Q){console.error("Error saving purchase method:",Q)}},d=async m=>{try{if(T.value=!1,m.vehicleType==="tradein"||p.mode==="tradein"){const a=await Ls("lead",p.lead.id,m.vehicle,m.valuation||{});ue.value.tradeIn=!0,r("note-saved",{type:"tradein",id:a.activity.id,action:"added a trade-in",vehicleId:a.vehicle.id,data:a.activity.data,timestamp:a.activity.timestamp})}else{const{addVehicleToCustomer:a}=await Jt(async()=>{const{addVehicleToCustomer:U}=await import("./contacts-B55v8mIF.js");return{addVehicleToCustomer:U}},__vite__mapDeps([0,1,2]));await a(p.lead.customerId,m.vehicle),r("note-saved",{type:"vehicle",vehicleType:m.vehicleType,...m.vehicle})}}catch(a){console.error("Error saving vehicle:",a)}};return(m,a)=>{var U;return f(),D("div",yi,[t(je)?(f(),D(Me,{key:0},[e("div",bi,[e("div",hi,[e("div",xi,[e("div",wi,[s(t(Ma),{size:16,class:"text-green-600"})]),e("div",ki,[e("p",Si,N(t(je).statusText),1),t(je).reason?(f(),D("p",Ci,N(t(je).reason),1)):_("",!0)])]),t(je).meeting?(f(),D("div",$i,[e("div",Di,[e("div",null,[a[32]||(a[32]=e("span",{class:"text-body"},"Date:",-1)),e("span",Ai,N(t(je).meeting.date),1)]),e("div",null,[a[33]||(a[33]=e("span",{class:"text-body"},"Time:",-1)),e("span",Ti,N(t(je).meeting.time),1)]),e("div",null,[a[34]||(a[34]=e("span",{class:"text-body"},"Type:",-1)),e("span",Oi,N(t(je).meeting.title),1)]),e("div",null,[a[35]||(a[35]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Ii,N(t(je).meeting.location),1)])])])):_("",!0),e("div",Ni,[s(t(ee),{variant:"outline",size:"small",class:"flex items-center gap-2 cursor-pointer",onClick:t(da)},{default:l(()=>[s(t(zn),{size:14}),a[36]||(a[36]=I(" Re-open ",-1))]),_:1},8,["onClick"])])])]),e("div",Vi,[e("span",null,"Updated by "+N(t(je).actorName||"Unknown"),1),e("span",Mi,N(ca.value),1)])],64)):(f(),D(Me,{key:1},[e("div",qi,[e("div",Li,[s(Za,{"next-action-due":n.lead.nextActionDue,"show-deadline-banner":n.showDeadlineBanner,"task-id":n.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",_i,[e("div",Ui,[e("div",null,[e("h4",Fi,N(Fe.value),1),e("p",Ei,N(Ee.value),1)]),e("div",{class:Z(["flex items-center gap-2 px-2 py-1 rounded-btn text-sm font-semibold",Ae.value.class])},N(Ae.value.text),3)]),$e.value||t(j)>0?(f(),D("div",Ri,[e("div",ji,[$e.value?(f(),D("div",Bi,[a[38]||(a[38]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-sm"},null,-1)),e("div",Wi,[a[37]||(a[37]=e("span",{class:"text-sm font-semibold text-heading"},"Scheduled Follow-up Call:",-1)),e("span",Pi,N(t(_t)(n.lead.scheduledAppointment.start))+" at "+N(t(us)(n.lead.scheduledAppointment.start)),1)])])):_("",!0),t(j)>0?(f(),D("div",zi,[a[40]||(a[40]=e("i",{class:"fa-solid fa-phone text-body text-sm"},null,-1)),a[41]||(a[41]=e("span",{class:"text-sm font-semibold text-body"},"Contact Attempts:",-1)),e("span",Yi,N(t(j))+" / "+N(t(W)),1),t(j)>=t(W)-1?(f(),D("div",Hi,[...a[39]||(a[39]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):_("",!0)])):_("",!0)])])):_("",!0),s(Ga,{"is-call-active":t(k),"call-ended":t(A),"call-duration":t(c),"call-notes":t(w),"formatted-call-duration":t(C),"mock-transcription":t(V),"contact-attempts":t(j),"max-contact-attempts":t(W),onStartCall:Ge,onEndCall:t(F),onLogManualCall:t(oa),onExtractInformation:a[0]||(a[0]=v=>q.value=!0),"onUpdate:callNotes":X,onCopyNumber:z},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall"])])])]),e("div",Qi,[t(je)?_("",!0):(f(),D("div",Ji,[e("div",null,[a[45]||(a[45]=e("p",{class:"text-sm font-medium text-heading leading-normal mb-3"},"Log what is happening?",-1)),s(t(Fs),{type:"single",variant:"outline","model-value":t(P),"onUpdate:modelValue":t(Ce),class:"outcome-toggle-group flex flex-wrap gap-3"},{default:l(()=>[s(t(gt),{value:"no-answer",class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[s(t(Pn),{size:18,class:"shrink-0"}),a[42]||(a[42]=e("span",null,"No answer",-1))]),_:1}),s(t(gt),{value:"not-valid",class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[s(t(Yn),{size:18,class:"shrink-0"}),a[43]||(a[43]=e("span",null,"Not valid",-1))]),_:1}),s(t(gt),{value:"interested",class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[s(t(Ma),{size:18,class:"shrink-0"}),a[44]||(a[44]=e("span",null,"Interested",-1))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])]),t(P)==="no-answer"?(f(),D("div",Gi,[e("div",Zi,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[46]||(a[46]=[I("When did you call?",-1)])]),_:1}),s(t(st),{type:"datetime-local",modelValue:t(He),"onUpdate:modelValue":a[1]||(a[1]=v=>$t(He)?He.value=v:null),class:"w-full"},null,8,["modelValue"])]),e("div",Ki,[a[55]||(a[55]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Send follow-up message",-1)),s(t(Fs),{type:"single",variant:"outline","model-value":t(ge),"onUpdate:modelValue":Ws,class:"followup-channel-toggle-group flex flex-wrap gap-2 mb-4"},{default:l(()=>[s(t(gt),{value:"whatsapp",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[47]||(a[47]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1}),s(t(gt),{value:"sms",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[48]||(a[48]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1}),s(t(gt),{value:"email",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[49]||(a[49]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1}),s(t(gt),{value:"dont-send",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[50]||(a[50]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])]),_:1})]),_:1},8,["model-value"]),t(ge)&&t(ge)!=="dont-send"?(f(),D("div",Xi,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[51]||(a[51]=[I("Template",-1)])]),_:1}),s(t(Vt),{modelValue:t(Le),"onUpdate:modelValue":a[2]||(a[2]=v=>$t(Le)?Le.value=v:null)},{default:l(()=>[s(t(Ot),{class:"w-full h-10 min-h-10"},{default:l(()=>[s(t(It),{placeholder:"Select template"})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"followup-1"},{default:l(()=>[...a[52]||(a[52]=[I("Follow-up 1",-1)])]),_:1}),s(t(ve),{value:"followup-2"},{default:l(()=>[...a[53]||(a[53]=[I("Follow-up 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[54]||(a[54]=[I("Message preview",-1)])]),_:1}),e("textarea",{value:t(be),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-body bg-white resize-none",readonly:""},null,8,er)])])):_("",!0)]),e("div",tr,[a[62]||(a[62]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Next call attempt",-1)),s(t(Fs),{type:"single",variant:"outline","model-value":t(we),"onUpdate:modelValue":Bt,class:"reschedule-toggle-group flex flex-wrap gap-2"},{default:l(()=>[s(t(gt),{value:"tomorrow-9am",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[56]||(a[56]=[I(" Tomorrow 9:00 AM ",-1)])]),_:1}),s(t(gt),{value:"monday",class:"inline-flex items-center justify-center gap-1.5 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[57]||(a[57]=[e("i",{class:"fa-solid fa-sparkles text-xs"},null,-1),I(" AI suggestion ",-1)])]),_:1}),s(t(gt),{value:"custom",class:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[...a[58]||(a[58]=[I(" Select time ",-1)])]),_:1})]),_:1},8,["model-value"]),t(we)==="monday"&&t(lt)?(f(),D("div",sr,[e("div",ar,[a[59]||(a[59]=e("i",{class:"fa-solid fa-lightbulb text-blue-600 text-sm mt-0.5"},null,-1)),e("div",nr,[e("p",lr,N(t(lt).formattedDate)+" at "+N(t(lt).time),1),e("p",or,N(t(lt).reason),1)])])])):_("",!0),t(we)==="custom"?(f(),D("div",ir,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[60]||(a[60]=[I("Date",-1)])]),_:1}),s(t(st),{type:"date",modelValue:t(Ne),"onUpdate:modelValue":a[3]||(a[3]=v=>$t(Ne)?Ne.value=v:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[61]||(a[61]=[I("Time",-1)])]),_:1}),s(t(st),{type:"time",modelValue:t(Pe),"onUpdate:modelValue":a[4]||(a[4]=v=>$t(Pe)?Pe.value=v:null),class:"w-full"},null,8,["modelValue"])])])):_("",!0)])])):_("",!0),t(P)==="not-valid"?(f(),D("div",rr,[e("div",ur,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[63]||(a[63]=[I("When did you call?",-1)])]),_:1}),s(t(st),{type:"datetime-local",modelValue:t(He),"onUpdate:modelValue":a[5]||(a[5]=v=>$t(He)?He.value=v:null),class:"w-full"},null,8,["modelValue"])]),s($a,{"preselected-reason":t(Je),"close-button-label":"Close as not valid",onClose:aa,onCancel:t(Ve),"onUpdate:reason":Ps},null,8,["preselected-reason","onCancel"])])):_("",!0),t(P)==="interested"?(f(),D("div",dr,[a[109]||(a[109]=e("div",{class:"text-xs text-sub px-2"},[e("span",{class:"text-red-600"},"*"),I(" Required fields ")],-1)),e("div",cr,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[64]||(a[64]=[I("When did you call?",-1)])]),_:1}),s(t(st),{type:"datetime-local",modelValue:t(He),"onUpdate:modelValue":a[6]||(a[6]=v=>$t(He)?He.value=v:null),class:"w-full"},null,8,["modelValue"])]),e("div",mr,[a[87]||(a[87]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Enrich lead",-1)),e("div",pr,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[65]||(a[65]=[I("Customer interest level?",-1)])]),_:1}),e("div",fr,[s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:l(()=>[Qe(e("input",{type:"radio","onUpdate:modelValue":a[7]||(a[7]=v=>H.value.interestLevel=v),value:"High",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ct,H.value.interestLevel]]),a[66]||(a[66]=e("span",{class:"text-sm text-body"},"High",-1))]),_:1}),s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:l(()=>[Qe(e("input",{type:"radio","onUpdate:modelValue":a[8]||(a[8]=v=>H.value.interestLevel=v),value:"Medium",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ct,H.value.interestLevel]]),a[67]||(a[67]=e("span",{class:"text-sm text-body"},"Medium",-1))]),_:1}),s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:l(()=>[Qe(e("input",{type:"radio","onUpdate:modelValue":a[9]||(a[9]=v=>H.value.interestLevel=v),value:"Low",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[ct,H.value.interestLevel]]),a[68]||(a[68]=e("span",{class:"text-sm text-body"},"Low",-1))]),_:1})])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[69]||(a[69]=[I("Expected purchase timeline?",-1)])]),_:1}),s(t(Vt),{modelValue:H.value.purchaseTimeline,"onUpdate:modelValue":a[10]||(a[10]=v=>H.value.purchaseTimeline=v)},{default:l(()=>[s(t(Ot),{class:"w-full h-10 min-h-10"},{default:l(()=>[s(t(It),{placeholder:"Select timeline"})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"Immediate"},{default:l(()=>[...a[70]||(a[70]=[I("Immediate",-1)])]),_:1}),s(t(ve),{value:"Within 1 month"},{default:l(()=>[...a[71]||(a[71]=[I("Within 1 month",-1)])]),_:1}),s(t(ve),{value:"Within 3 months"},{default:l(()=>[...a[72]||(a[72]=[I("Within 3 months",-1)])]),_:1}),s(t(ve),{value:"Within 6 months"},{default:l(()=>[...a[73]||(a[73]=[I("Within 6 months",-1)])]),_:1}),s(t(ve),{value:"Just browsing"},{default:l(()=>[...a[74]||(a[74]=[I("Just browsing",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[75]||(a[75]=[I("Budget range (if discussed)?",-1)])]),_:1}),s(t(Vt),{modelValue:H.value.budgetRange,"onUpdate:modelValue":a[11]||(a[11]=v=>H.value.budgetRange=v)},{default:l(()=>[s(t(Ot),{class:"w-full h-10 min-h-10"},{default:l(()=>[s(t(It),{placeholder:"Select budget range"})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"Under €30k"},{default:l(()=>[...a[76]||(a[76]=[I("Under €30k",-1)])]),_:1}),s(t(ve),{value:"€30k-€50k"},{default:l(()=>[...a[77]||(a[77]=[I("€30k-€50k",-1)])]),_:1}),s(t(ve),{value:"€50k-€80k"},{default:l(()=>[...a[78]||(a[78]=[I("€50k-€80k",-1)])]),_:1}),s(t(ve),{value:"€80k+"},{default:l(()=>[...a[79]||(a[79]=[I("€80k+",-1)])]),_:1}),s(t(ve),{value:"Not discussed"},{default:l(()=>[...a[80]||(a[80]=[I("Not discussed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",vr,[e("label",gr,[Qe(e("input",{type:"checkbox","onUpdate:modelValue":a[12]||(a[12]=v=>H.value.hasTradeIn=v),class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[ba,H.value.hasTradeIn]]),a[81]||(a[81]=e("span",{class:"text-sm font-medium text-body"},"Trade in?",-1))]),s(t(st),{modelValue:H.value.tradeInModel,"onUpdate:modelValue":a[13]||(a[13]=v=>H.value.tradeInModel=v),disabled:!H.value.hasTradeIn,placeholder:"Car brand and model",class:"w-full h-10 min-h-10"},null,8,["modelValue","disabled"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[82]||(a[82]=[I("Financing?",-1)])]),_:1}),s(t(Vt),{modelValue:H.value.financingOption,"onUpdate:modelValue":a[14]||(a[14]=v=>H.value.financingOption=v)},{default:l(()=>[s(t(Ot),{class:"w-full h-10 min-h-10"},{default:l(()=>[s(t(It),{placeholder:"Select financing option"})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"FIN"},{default:l(()=>[...a[83]||(a[83]=[I("Captive Financing",-1)])]),_:1}),s(t(ve),{value:"LEA"},{default:l(()=>[...a[84]||(a[84]=[I("Leasing",-1)])]),_:1}),s(t(ve),{value:"LTR"},{default:l(()=>[...a[85]||(a[85]=[I("Long-Term Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[86]||(a[86]=[I("Additional notes",-1)])]),_:1}),s(t(at),{modelValue:H.value.additionalNotes,"onUpdate:modelValue":a[15]||(a[15]=v=>H.value.additionalNotes=v),rows:"4",class:"w-full",placeholder:"Any relevant information about customer interest or preferences..."},null,8,["modelValue"])])]),e("div",yr,[s(t(ee),{label:"Save",variant:"primary",size:"small",onClick:De})])]),e("div",br,[a[90]||(a[90]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},[I("Qualification method "),e("span",{class:"text-red-600"},"*")],-1)),e("div",hr,[e("label",{class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(ze)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":a[16]||(a[16]=v=>$t(ze)?ze.value=v:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[ct,t(ze)]]),a[88]||(a[88]=e("span",{class:"text-sm text-heading"},"Assign only",-1))],2),e("label",{class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(ze)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":a[17]||(a[17]=v=>$t(ze)?ze.value=v:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[ct,t(ze)]]),a[89]||(a[89]=e("span",{class:"text-sm text-heading"},"Assign and schedule",-1))],2)])]),t(ze)==="assign-only"?(f(),D("div",xr,[e("div",wr,[a[95]||(a[95]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",kr,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[91]||(a[91]=[I("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:Pt.value,"onUpdate:modelValue":a[18]||(a[18]=v=>Pt.value=v),items:$s.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:v})=>[e("div",Sr,[e("span",Cr,N(v.dealership||"No location"),1),a[92]||(a[92]=e("span",{class:"text-sub"},"→",-1)),e("span",$r,N(v.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[93]||(a[93]=[I("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ye),{modelValue:zt.value,"onUpdate:modelValue":a[19]||(a[19]=v=>zt.value=v),items:Xt.value,disabled:!t(qe),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:v})=>[e("div",Dr,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(v.role)])},N(K(v.name)),3),e("span",Ar,N(v.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[94]||(a[94]=[I("Notes for assignee",-1)])]),_:1}),s(t(at),{modelValue:te.value,"onUpdate:modelValue":a[20]||(a[20]=v=>te.value=v),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])])):_("",!0),t(ze)==="assign-and-schedule"?(f(),D("div",Tr,[e("div",Or,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...a[96]||(a[96]=[I("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:t(_e),"onUpdate:modelValue":a[21]||(a[21]=v=>$t(_e)?_e.value=v:null),items:Qs.value,placeholder:t(i)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:l(({item:v})=>[e("span",null,N(v.label),1)]),_:1},8,["modelValue","items","placeholder"])]),t(_e)?(f(),D("div",Ir,[a[100]||(a[100]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Nr,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[97]||(a[97]=[I("Team",-1)])]),_:1}),s(t(Ye),{modelValue:Pt.value,"onUpdate:modelValue":a[22]||(a[22]=v=>Pt.value=v),items:$s.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:v})=>[e("div",Vr,[e("span",Mr,N(v.dealership||"No location"),1),a[98]||(a[98]=e("span",{class:"text-sub"},"→",-1)),e("span",qr,N(v.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...a[99]||(a[99]=[I("Salesperson (optional)",-1)])]),_:1}),s(t(Ye),{modelValue:zt.value,"onUpdate:modelValue":a[23]||(a[23]=v=>zt.value=v),items:Xt.value,disabled:!t(qe),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:v})=>[e("div",Lr,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(v.role)])},N(K(v.name)),3),e("span",_r,N(v.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):_("",!0),t(_e)&&t(qe)?(f(),D("div",Ur,[e("h5",Fr,[I(N(t(i)("forms.schedule.title"))+" ",1),a[101]||(a[101]=e("span",{class:"text-red-600"},"*",-1))]),e("div",Er,[e("div",Rr,[e("div",jr,[e("div",Br,[e("button",{onClick:Is,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...a[102]||(a[102]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",Wr,N(Gs.value),1),e("button",{onClick:Xs,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...a[103]||(a[103]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",Pr,[(f(),D(Me,null,We(Js,v=>e("div",{key:v,class:"text-center text-xs font-medium text-sub py-2"},N(v),1)),64))]),e("div",zr,[(f(!0),D(Me,null,We(Ts.value,(v,Q)=>(f(),D("div",{key:Q,onClick:ie=>Ks(v),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Zs(v)?"bg-[#0470e9] text-white cursor-pointer":v?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},N(v),11,Yr))),128))])]),e("div",Hr,[e("h6",Qr,N(Os.value),1),t(Be)&&Wt.value.length>0?(f(),D("div",Jr,[s(t(Fs),{type:"single",variant:"outline","model-value":t(it),"onUpdate:modelValue":t(Zt),class:"schedule-slot-toggle-group flex flex-col gap-2 w-full"},{default:l(()=>[(f(!0),D(Me,null,We(Wt.value,v=>(f(),de(t(gt),{key:v,value:v,class:"w-full justify-center px-4 py-2 text-sm font-medium data-[state=on]:border-[1.5px] data-[state=on]:border-[#0470e9] data-[state=on]:bg-[rgba(4,112,233,0.08)] data-[state=on]:text-[#0470e9]"},{default:l(()=>[I(N(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","onUpdate:modelValue"])])):t(Be)&&Wt.value.length===0?(f(),D("div",Gr,N(t(i)("forms.schedule.timeSlots.noSlots")),1)):(f(),D("div",Zr,N(t(i)("forms.schedule.timeSlots.selectDate")),1))])])])])):_("",!0),s(Ka,{appointment:{type:t(_e),date:t(Be),time:t(it),duration:t(ws)},customer:n.lead.customer,salesperson:t(ut),team:t(qe),dealership:(U=t(qe))!=null&&U.dealership?{name:t(qe).dealership}:null,onUpdate:zs},null,8,["appointment","customer","salesperson","team","dealership"])])):_("",!0),t(Se)&&t(ze)==="assign-only"?(f(),D("div",Kr,[a[108]||(a[108]=Ua('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-sm">Existing Appointment</h5></div><span class="text-sm font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Xr,[e("div",null,[a[104]||(a[104]=e("span",{class:"text-body"},"Date:",-1)),e("span",eu,N(t(_t)(n.lead.scheduledAppointment.start)),1)]),e("div",null,[a[105]||(a[105]=e("span",{class:"text-body"},"Time:",-1)),e("span",tu,N(t(us)(n.lead.scheduledAppointment.start)),1)]),e("div",null,[a[106]||(a[106]=e("span",{class:"text-body"},"Type:",-1)),e("span",su,N(n.lead.scheduledAppointment.type),1)]),e("div",null,[a[107]||(a[107]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",au,N(n.lead.scheduledAppointment.assignee),1)])]),s(t(ee),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:a[24]||(a[24]=v=>le.value=!0)})])):_("",!0)])):_("",!0)])),t(P)&&!t(je)?(f(),D("div",nu,[s(t(ee),{variant:"secondary",onClick:t(Ve)},{default:l(()=>[...a[110]||(a[110]=[I(" Cancel ",-1)])]),_:1},8,["onClick"]),s(t(ee),{variant:"primary",disabled:!na.value,onClick:la,class:"bg-primary text-white"},{default:l(()=>[I(N(Ns.value),1)]),_:1},8,["disabled"])])):_("",!0)])],64)),s(Ra,{ref_key:"noteWidgetRef",ref:fe,modal:"",show:t(se),item:null,"task-type":"lead","task-id":n.lead.id,onSave:t(ua),onClose:a[25]||(a[25]=v=>se.value=!1),onCancel:a[26]||(a[26]=v=>se.value=!1)},null,8,["show","task-id","onSave"]),s(No,{show:t(le),"preselected-assignee":t(Ue).assignee,onConfirm:t(ia),onClose:a[27]||(a[27]=v=>le.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),s(Pa,{show:pe.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:xe,onClose:a[28]||(a[28]=v=>pe.value=!1)},null,8,["show"]),s(ja,{show:L.value,"task-type":"lead","task-id":n.lead.id,onSave:y,onClose:a[29]||(a[29]=v=>L.value=!1)},null,8,["show","task-id"]),s(Ba,{show:T.value,mode:"tradein","task-type":"lead","task-id":n.lead.id,"customer-id":n.lead.customerId,onClose:a[30]||(a[30]=v=>T.value=!1),onSave:d},null,8,["show","task-id","customer-id"]),s(Ca,{show:q.value,title:"AI Information Extraction",onClose:a[31]||(a[31]=v=>q.value=!1)},null,8,["show"])])}}},ou={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},iu={class:"flex justify-between items-start mb-3"},ru={class:"text-fluid-xs text-body mt-0.5"},uu={key:0},du={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(n,{emit:M}){const i=n,p=M,r=Rt(),u=()=>{var E;const F=r.currentLead;return F&&F.id===((E=i.lead)==null?void 0:E.id)?F:i.lead},h={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},b=za(cs(i,"lead"),h),{handlePostponed:S,handleValidated:o,handleQualified:k,handleCallAttemptLogged:A,handleNoteSaved:c,handleOpenPurchaseMethod:w,handleOpenTradeIn:g,handleAppointmentScheduled:x,handleDisqualified:V,handleReopen:C}=Bl({getLead:u,leadState:b,emit:p}),R=async F=>{var E;(E=i.lead)!=null&&E.id&&await r.loadLeadById(i.lead.id)};return(F,E)=>(f(),de(Ya,{task:n.lead,"hide-title":"","hide-border":""},{"primary-action":l(()=>[t(b).isClosed.value?_("",!0):(f(),de(Qa,{key:0,task:n.lead,"task-type":"lead",onReassigned:R,class:"mb-3"},null,8,["task"])),!t(b).isClosed.value&&t(b).showLQWidget.value?(f(),de(lu,{key:n.lead.id,lead:n.lead,"show-deadline-banner":t(b).showDeadlineBanner.value,onPostponed:t(S),onValidated:t(o),onQualified:t(k),onDisqualified:t(V),onCallAttemptLogged:t(A),onNoteSaved:t(c),onOpenPurchaseMethod:t(w),onOpenTradeIn:t(g),onAppointmentScheduled:t(x)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!t(b).isClosed.value&&t(b).primaryAction.value?(f(),de(Ha,{key:2,action:t(b).primaryAction.value,"color-scheme":t(b).primaryAction.value.colorScheme,onActionClicked:t(b).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):_("",!0)]),"task-widgets":l(()=>[...E[0]||(E[0]=[])]),"closed-state":l(()=>[t(b).isClosed.value?(f(),D("div",ou,[e("div",iu,[e("div",null,[E[1]||(E[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",ru,[I(" Status: "+N(t(b).displayStage.value)+" ",1),n.lead.disqualifyReason?(f(),D("span",uu," - "+N(n.lead.disqualifyReason),1)):_("",!0)])])]),s(t(ee),{variant:"primary",size:"small",onClick:t(C),class:"flex items-center gap-2"},{default:l(()=>[...E[2]||(E[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):_("",!0)]),_:1},8,["task"]))}},cu={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},mu={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},pu={class:"p-4"},fu={class:"flex justify-between items-start mb-3"},vu={class:"font-bold text-heading text-fluid-sm"},gu={class:"text-fluid-xs text-sub mt-0.5"},yu={class:"flex gap-3 flex-wrap"},Gt={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!1,default:()=>({background:"",border:""})}},setup(n){return(M,i)=>(f(),D("div",cu,[e("div",mu,[e("div",pu,[e("div",fu,[e("div",null,[e("h4",vu,N(n.title),1),e("p",gu,N(n.description),1)]),yt(M.$slots,"badge")]),e("div",yu,[yt(M.$slots,"actions")]),yt(M.$slots,"survey"),yt(M.$slots,"content")])])]))}},bu={key:1,class:"space-y-4"},hu={class:"flex items-center justify-between"},xu={class:"space-y-4"},wu={class:"block text-fluid-sm font-medium text-body"},ku=["onUpdate:modelValue","placeholder"],Su={key:2,class:"space-y-2"},Cu=["onUpdate:modelValue","value"],$u={class:"flex gap-2 flex-wrap justify-end pt-2"},xs={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M,r=O(i.initialExpanded),u=O({});he(()=>i.questions,k=>{const A={};k.forEach(c=>{A[c.key]=""}),u.value=A},{immediate:!0});const h=()=>{p("survey-completed",{...u.value}),o()},b=()=>{p("survey-refused"),o()},S=()=>{p("not-responding"),o()},o=()=>{r.value=!1;const k={};i.questions.forEach(A=>{k[A.key]=""}),u.value=k};return(k,A)=>(f(),D("div",null,[r.value?(f(),D("div",bu,[e("div",hu,[A[4]||(A[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:A[1]||(A[1]=c=>r.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...A[3]||(A[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",xu,[(f(!0),D(Me,null,We(n.questions,(c,w)=>(f(),D("div",{key:w,class:"space-y-2"},[e("label",wu,N(c.label),1),c.type==="text"?Qe((f(),D("textarea",{key:0,"onUpdate:modelValue":g=>u.value[c.key]=g,placeholder:c.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,ku)),[[dn,u.value[c.key]]]):c.type==="select"?(f(),de(t(Vt),{key:1,modelValue:u.value[c.key],"onUpdate:modelValue":g=>u.value[c.key]=g},{default:l(()=>[s(t(Ot),{class:"w-full h-10 min-h-10"},{default:l(()=>[s(t(It),{placeholder:"Select an option..."})]),_:1}),s(t(Nt),null,{default:l(()=>[(f(!0),D(Me,null,We(c.options,g=>(f(),de(t(ve),{key:g,value:g},{default:l(()=>[I(N(g),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):c.type==="radio"?(f(),D("div",Su,[(f(!0),D(Me,null,We(c.options,g=>(f(),D("label",{key:g,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[Qe(e("input",{type:"radio","onUpdate:modelValue":x=>u.value[c.key]=x,value:g,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,Cu),[[ct,u.value[c.key]]]),I(" "+N(g),1)]))),128))])):_("",!0)]))),128)),e("div",$u,[s(t(ee),{label:"Complete Survey",variant:"primary",size:"small",onClick:h,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),s(t(ee),{label:"Customer Refused",variant:"outline",size:"small",onClick:b}),s(t(ee),{label:"Not Responding",variant:"outline",size:"small",onClick:S})])])])):(f(),D("button",{key:0,onClick:A[0]||(A[0]=c=>r.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...A[2]||(A[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},Du={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M,r=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],u=$(()=>{if(!i.opportunity.createdAt)return 0;const A=new Date(i.opportunity.createdAt),w=Math.abs(new Date-A);return Math.ceil(w/(1e3*60*60*24))}),h=()=>{p("create-offer",i.opportunity)},b=()=>{p("review",i.opportunity)},S=A=>{p("survey-completed",{opportunity:i.opportunity,responses:A})},o=()=>{p("survey-refused",{opportunity:i.opportunity})},k=()=>{p("not-responding",{opportunity:i.opportunity})};return(A,c)=>(f(),de(Gt,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${u.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:l(()=>[e("button",{onClick:h,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:b,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Review Opportunity ")]),survey:l(()=>[s(xs,{questions:r,onSurveyCompleted:S,onSurveyRefused:o,onNotResponding:k})]),_:1},8,["description"]))}},Au={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M,r=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],u=$(()=>{if(!i.opportunity.createdAt)return 0;const k=new Date(i.opportunity.createdAt),c=Math.abs(new Date-k);return Math.ceil(c/(1e3*60*60*24))}),h=()=>{p("create-offer",i.opportunity)},b=k=>{p("survey-completed",{opportunity:i.opportunity,responses:k})},S=()=>{p("survey-refused",{opportunity:i.opportunity})},o=()=>{p("not-responding",{opportunity:i.opportunity})};return(k,A)=>(f(),de(Gt,{title:"Unsold Feedback",description:`This opportunity has been open for ${u.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:l(()=>[e("button",{onClick:h,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:l(()=>[s(xs,{questions:r,onSurveyCompleted:b,onSurveyRefused:S,onNotResponding:o})]),_:1},8,["description"]))}},Tu={class:"space-y-4"},Ou={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Iu={class:"flex flex-wrap gap-3"},Nu={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Vu={key:1},Mu={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["appointment-scheduled","close-as-lost","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=O(null),h=O(null),b=$(()=>{var k;return u.value==="schedule"?!1:u.value==="close-lost"&&((k=h.value)==null?void 0:k.canSubmit)||!1});async function S(){var k;u.value==="schedule"?r("appointment-scheduled",{opportunity:p.opportunity}):u.value==="close-lost"&&((k=h.value)==null||k.submit())}function o(k){r("close-as-lost",{opportunity:p.opportunity,reason:k.reason})}return M({canSubmit:b,submit:S}),(k,A)=>(f(),D("div",Tu,[A[6]||(A[6]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"No Follow-Up Task"),e("p",{class:"text-sm text-body"}," 5+ days in negotiation with no future appointment scheduled. Schedule an appointment to move forward or close as lost. ")],-1)),e("div",Ou,[A[4]||(A[4]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Choose Action",-1)),e("div",Iu,[s(t(ee),{variant:"outline",onClick:A[0]||(A[0]=c=>u.value="schedule"),class:Z(["flex-1",u.value==="schedule"?"border-purple-500 bg-purple-50 text-purple-700":""])},{default:l(()=>[...A[2]||(A[2]=[e("i",{class:"fa-solid fa-calendar-plus mr-2"},null,-1),I(" Schedule Appointment ",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:A[1]||(A[1]=c=>u.value="close-lost"),class:Z(["flex-1",u.value==="close-lost"?"border-red-500 bg-red-50 text-red-700":""])},{default:l(()=>[...A[3]||(A[3]=[e("i",{class:"fa-solid fa-xmark mr-2"},null,-1),I(" Close as Lost ",-1)])]),_:1},8,["class"])])]),u.value==="schedule"?(f(),D("div",Nu,[...A[5]||(A[5]=[e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Schedule Appointment",-1),e("p",{class:"text-sm text-sub"}," This will reuse the full schedule appointment form from the Awaiting Appointment stage. ",-1)])])):_("",!0),u.value==="close-lost"?(f(),D("div",Vu,[s($a,{ref_key:"closeFormRef",ref:h,item:n.opportunity,"item-type":"opportunity",onClose:o},null,8,["item"])])):_("",!0)]))}},qu={key:0},Lu={class:"flex items-center justify-between mb-2"},_u={class:"flex items-center gap-2"},Uu={class:"font-semibold text-heading text-sm"},Fu={class:"relative"},Eu={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Ru={class:"w-full h-16 bg-surfaceSecondary flex items-center justify-center overflow-hidden"},ju=["src"],Bu={key:1,class:"fa-solid fa-car text-base text-sub"},Wu={class:"p-2 space-y-1.5"},Pu={class:"font-bold text-heading text-xs leading-tight line-clamp-2 mb-0.5"},zu={class:"text-sm font-bold text-heading"},Yu={class:"text-xs text-sub"},Hu={key:0,class:"pt-1"},Qu={key:1,class:"text-center py-6 px-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},Ju={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted"],setup(n,{emit:M}){const i=b=>b?new Intl.NumberFormat("en-US").format(b):"0",p=b=>{if(!b)return"";const S=new Date(b),k=Math.abs(new Date-S),A=Math.ceil(k/(1e3*60*60*24));return A===0?"today":A===1?"yesterday":A<7?`${A} days ago`:S.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},r=b=>({active:"Active",accepted:"Accepted",archived:"Archived"})[b]||"Active",u=b=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[b]||"bg-gray-600",h=b=>b.status==="accepted"?"border-green-500 border-2":"border-E5E7EB";return(b,S)=>n.offers.length>0?(f(),D("div",qu,[e("div",Lu,[e("div",_u,[S[0]||(S[0]=e("i",{class:"fa-solid fa-file-invoice-dollar text-sub text-xs"},null,-1)),e("h3",Uu,"Offers ("+N(n.offers.length)+")",1)])]),e("div",Fu,[e("div",Eu,[(f(!0),D(Me,null,We(n.offers,o=>{var k;return f(),D("div",{key:o.id,class:Z(["flex-none w-36 snap-start bg-white border rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow relative",h(o)])},[e("div",{class:Z(["absolute top-1 right-1 z-10 text-white text-xs font-bold px-1.5 py-0.5 rounded shadow-sm",u(o.status)])},N(r(o.status)),3),e("div",Ru,[(k=o.data)!=null&&k.image?(f(),D("img",{key:0,src:o.data.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,ju)):(f(),D("i",Bu))]),e("div",Wu,[e("div",null,[e("h4",Pu,N(o.vehicleBrand)+" "+N(o.vehicleModel)+" ("+N(o.vehicleYear)+") ",1),e("p",zu,"€ "+N(i(o.price)),1),e("p",Yu,N(p(o.createdAt)),1)]),o.status==="active"?(f(),D("div",Hu,[s(t(ee),{variant:"primary",size:"small",onClick:Sa(A=>b.$emit("offer-accepted",o),["stop"]),class:"w-full text-xs h-7"},{default:l(()=>[...S[1]||(S[1]=[e("i",{class:"fa-solid fa-check text-xs mr-1"},null,-1),I(" Mark as accepted ",-1)])]),_:1},8,["onClick"])])):_("",!0)])],2)}),128))])])])):(f(),D("div",Qu,[...S[2]||(S[2]=[e("i",{class:"fa-solid fa-file-invoice text-2xl text-sub mb-2"},null,-1),e("p",{class:"text-xs font-medium text-body"},"No offers created yet",-1),e("p",{class:"text-xs text-sub mt-0.5"},"Create an offer to start negotiations",-1)])]))}},Xa=Et(Ju,[["__scopeId","data-v-240d4fdb"]]),Gu={class:"space-y-4"},Zu={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ku={class:"text-sm text-body"},Xu={key:0,class:"mb-4"},ed={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},td={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},sd={key:0,class:"space-y-3"},ad={key:0},nd={class:"flex items-center justify-between gap-2"},ld={class:"text-sub text-xs"},od={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["offer-accepted","offer-deleted","view-offer","send-message"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=O(null),h=O(""),b=O(null),S=$(()=>{const g=p.opportunity.lastActivity||p.opportunity.createdAt;if(!g)return 0;const x=new Date(g),C=Math.abs(new Date-x);return Math.ceil(C/(1e3*60*60*24))}),o=$(()=>!p.opportunity.offers||p.opportunity.offers.length===0?[]:p.opportunity.offers.filter(g=>g.status==="active").map(g=>({id:g.id,label:`${g.vehicleBrand} ${g.vehicleModel} (${g.vehicleYear})`,price:g.price,value:g.id}))),k=$(()=>u.value&&h.value.trim().length>0);function A(g){return g?new Intl.NumberFormat("en-US").format(g):"0"}function c(g){r("offer-accepted",g)}async function w(){k.value&&(r("send-message",{channel:u.value,message:h.value,offerId:b.value}),u.value=null,h.value="",b.value=null)}return M({canSubmit:k,submit:w}),(g,x)=>(f(),D("div",Gu,[e("div",Zu,[x[6]||(x[6]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"Offer Feedback Task",-1)),e("p",Ku," This opportunity has been in negotiation for "+N(S.value)+" days without a contract. Follow up with customer to get feedback and move forward. ",1)]),n.opportunity.offers&&n.opportunity.offers.length>0?(f(),D("div",Xu,[s(Xa,{offers:n.opportunity.offers,"opportunity-id":n.opportunity.id,onOfferAccepted:c},null,8,["offers","opportunity-id"])])):_("",!0),e("div",ed,[x[13]||(x[13]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",td,[s(t(ee),{variant:"outline",onClick:x[0]||(x[0]=V=>u.value="call"),class:Z(["flex items-center justify-center gap-2",u.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...x[7]||(x[7]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:x[1]||(x[1]=V=>u.value="whatsapp"),class:Z(["flex items-center justify-center gap-2",u.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...x[8]||(x[8]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:x[2]||(x[2]=V=>u.value="sms"),class:Z(["flex items-center justify-center gap-2",u.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...x[9]||(x[9]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:x[3]||(x[3]=V=>u.value="email"),class:Z(["flex items-center justify-center gap-2",u.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...x[10]||(x[10]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),u.value?(f(),D("div",sd,[o.value.length>0?(f(),D("div",ad,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[11]||(x[11]=[I("Select offer to reference",-1)])]),_:1}),s(t(Ye),{modelValue:b.value,"onUpdate:modelValue":x[4]||(x[4]=V=>b.value=V),items:o.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:l(({item:V})=>[e("div",nd,[e("span",null,N(V.label),1),e("span",ld,"€ "+N(A(V.price)),1)])]),_:1},8,["modelValue","items"])])):_("",!0),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[12]||(x[12]=[I("Message",-1)])]),_:1}),s(t(at),{modelValue:h.value,"onUpdate:modelValue":x[5]||(x[5]=V=>h.value=V),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):_("",!0)])]))}},id={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M,r=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],u=$(()=>{var g;if(!((g=i.opportunity)!=null&&g.contractDate))return 0;const A=new Date(i.opportunity.contractDate),w=Math.abs(new Date-A);return Math.ceil(w/(1e3*60*60*24))}),h=()=>{p("prepare-delivery",i.opportunity)},b=()=>{p("pre-delivery-checklist",i.opportunity)},S=A=>{p("survey-completed",{opportunity:i.opportunity,responses:A})},o=()=>{p("survey-refused",{opportunity:i.opportunity})},k=()=>{p("not-responding",{opportunity:i.opportunity})};return(A,c)=>(f(),de(Gt,{title:"Contract Feedback",description:`Contract was signed ${u.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:l(()=>[e("button",{onClick:h,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Prepare for Delivery "),e("button",{onClick:b,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:l(()=>[s(xs,{questions:r,onSurveyCompleted:S,onSurveyRefused:o,onNotResponding:k})]),_:1},8,["description"]))}},rd={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M,r=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],u=$(()=>{const k=i.activities.find(g=>{var x;return g.type==="delivery"||((x=g.action)==null?void 0:x.toLowerCase().includes("delivered"))});if(!k||!k.timestamp)return 0;const A=new Date(k.timestamp),w=Math.abs(new Date-A);return Math.ceil(w/(1e3*60*60*24))}),h=()=>{p("delivery-feedback",i.opportunity)},b=k=>{p("survey-completed",{opportunity:i.opportunity,responses:k})},S=()=>{p("survey-refused",{opportunity:i.opportunity})},o=()=>{p("not-responding",{opportunity:i.opportunity})};return(k,A)=>(f(),de(Gt,{title:"Delivery Feedback",description:`Vehicle was delivered ${u.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:l(()=>[e("button",{onClick:h,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Delivery Feedback ")]),survey:l(()=>[s(xs,{questions:r,onSurveyCompleted:b,onSurveyRefused:S,onNotResponding:o})]),_:1},8,["description"]))}},ud={key:0,class:"mt-4 pt-4 border-t border-black/5"},dd={class:"grid grid-cols-2 gap-4"},cd={class:"flex items-center gap-2"},md={class:"text-sub"},pd={class:"font-medium text-heading"},fd={class:"flex items-center gap-2"},vd={class:"font-medium text-heading"},gd={class:"mt-4"},yd={class:"mt-4 flex justify-end"},bd={key:1,class:"mt-4 pt-4 border-t border-black/5"},hd={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},xd={class:"flex justify-end"},wd={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["not-responding","auto-close-lost","set-callback","assigned","close-as-lost"],setup(n,{emit:M}){const i=n,p=M,r=qt(),u=Dt(),h=Mt(),b=O(null),S=O(null),o=O(""),k=$(()=>r.assignableUsers),A=$(()=>r.assignableTeams),c=$(()=>A.value.map(T=>({...T,label:`${T.dealership||"No location"} → ${T.name}`,value:T.id}))),w=$(()=>{var B;if(!b.value)return[];const T=b.value;return(((B=k.value)==null?void 0:B.filter(Y=>Y.team===T.name||Y.teamId===T.id))||[]).map(Y=>({...Y,label:Y.name,value:Y.id}))}),g=$({get:()=>{var T;return((T=b.value)==null?void 0:T.id)||null},set:T=>{var B;if(!T){b.value=null;return}const q=(B=A.value)==null?void 0:B.find(Y=>Y.id===T);b.value=q||null,q&&(S.value=null)}}),x=$({get:()=>{var T;return((T=S.value)==null?void 0:T.id)||null},set:T=>{if(!T){S.value=null;return}const q=w.value.find(B=>B.id===T);S.value=q||null}}),V=T=>T?T.split(" ").map(q=>q[0]).join("").toUpperCase().substring(0,2):"?",C=T=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[T]||"bg-surfaceSecondary text-body";async function R(){var B,Y,ne;if(!b.value)return;const T=((B=S.value)==null?void 0:B.name)||((Y=b.value)==null?void 0:Y.name),q={assignee:T};o.value&&(q.assignmentNote=o.value),await h.updateOpportunity(i.opportunity.id,q),await h.addActivity(i.opportunity.id,{type:"assignment",user:((ne=u.currentUser)==null?void 0:ne.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${T}${o.value?` with note: ${o.value}`:""}`,timestamp:new Date().toISOString()}),p("assigned",{opportunity:i.opportunity,assignee:T,note:o.value}),b.value=null,S.value=null,o.value=""}function F(){p("close-as-lost",{opportunity:i.opportunity,reason:"Multiple no shows"})}hs(()=>{var T,q,B;if(i.opportunity.assignee&&!b.value&&!S.value){const Y=(T=k.value)==null?void 0:T.find(H=>H.name===i.opportunity.assignee),ne=(q=A.value)==null?void 0:q.find(H=>H.name===i.opportunity.assignee);if(Y){const H=(B=A.value)==null?void 0:B.find(ye=>ye.name===Y.team||ye.id===Y.teamId);H&&(b.value=H,S.value=Y)}else ne&&(b.value=ne)}i.opportunity.assignmentNote&&(o.value=i.opportunity.assignmentNote)}),he(()=>i.opportunity.assignee,T=>{var q,B,Y;if(T&&!b.value&&!S.value){const ne=(q=k.value)==null?void 0:q.find(ye=>ye.name===T),H=(B=A.value)==null?void 0:B.find(ye=>ye.name===T);if(ne){const ye=(Y=A.value)==null?void 0:Y.find(Ie=>Ie.name===ne.team||Ie.id===ne.teamId);ye&&(b.value=ye,S.value=ne)}else H&&(b.value=H)}});const E=$(()=>{var T;return((T=i.scheduledAppointment)==null?void 0:T.noShowCount)||0}),fe=$(()=>{const T=E.value;return T===0||T===1?"NS1":T===2?"NS2":T>=3?"NS3":`NS${T}`}),pe=$(()=>{const T=E.value;return T>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":T>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),L=$(()=>{var q;return(q=i.scheduledAppointment)!=null&&q.start?new Date(i.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return(T,q)=>(f(),de(Gt,{title:fe.value,description:`Appointment was scheduled for ${L.value} but customer did not show up. ${pe.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{content:l(()=>[E.value<3?(f(),D("div",ud,[q[8]||(q[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",dd,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...q[3]||(q[3]=[I("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:g.value,"onUpdate:modelValue":q[0]||(q[0]=B=>g.value=B),items:c.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:B})=>[e("div",cd,[e("span",md,N(B.dealership||"No location"),1),q[4]||(q[4]=e("span",{class:"text-sub"},"→",-1)),e("span",pd,N(B.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...q[5]||(q[5]=[I("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ye),{modelValue:x.value,"onUpdate:modelValue":q[1]||(q[1]=B=>x.value=B),items:w.value,disabled:!b.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:B})=>[e("div",fd,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",C(B.role)])},N(V(B.name)),3),e("span",vd,N(B.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",gd,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...q[6]||(q[6]=[I("Note for sellers",-1)])]),_:1}),s(t(at),{modelValue:o.value,"onUpdate:modelValue":q[2]||(q[2]=B=>o.value=B),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the sellers..."},null,8,["modelValue"])]),e("div",yd,[s(t(ee),{variant:"primary",disabled:!b.value,onClick:R,class:"bg-primary"},{default:l(()=>[...q[7]||(q[7]=[I(" Assign ",-1)])]),_:1},8,["disabled"])])])):_("",!0),E.value>=3?(f(),D("div",bd,[e("div",hd,[q[9]||(q[9]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),q[10]||(q[10]=e("p",{class:"text-sm text-body mb-4"}," This is the third no-show. The opportunity should be closed as lost. ",-1)),e("div",xd,[s(t(ee),{label:"Close Opportunity as Lost",variant:"primary",size:"small",onClick:F})])])])):_("",!0)]),_:1},8,["title","description"]))}},kd={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(n,{emit:M}){const i=n,p=M;wa();const r=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],u=$(()=>{const c=i.opportunity.lastActivity||i.opportunity.createdAt;if(!c)return 0;const w=new Date(c),x=Math.abs(new Date-w);return Math.ceil(x/(1e3*60*60*24))}),h=()=>{p("reopen",i.opportunity)},b=()=>{p("close-lost",{opportunity:i.opportunity,reason:"Abandoned - no activity for extended period"})},S=()=>{p("requalify",i.opportunity)},o=c=>{p("survey-completed",{opportunity:i.opportunity,responses:c})},k=()=>{p("survey-refused",{opportunity:i.opportunity})},A=()=>{p("not-responding",{opportunity:i.opportunity})};return(c,w)=>(f(),de(Gt,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${u.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:l(()=>[e("button",{onClick:h,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...w[0]||(w[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),I(" Reopen Opportunity ",-1)])]),e("button",{onClick:b,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),I(" Close as Lost ",-1)])]),e("button",{onClick:S,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...w[2]||(w[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),I(" Requalify as Lead ",-1)])])]),survey:l(()=>[s(xs,{questions:r,onSurveyCompleted:o,onSurveyRefused:k,onNotResponding:A})]),_:1},8,["description"]))}},Sd={OOFB:Du,UFB:Au,NFU:Mu,OFB:od,CFB:id,DFB:rd,NS:wd,ABANDONED:kd};function Cd(n,M,i,p,r){const u=$(()=>{const c=js(n),w=js(M),g=js(i);return{opportunity:c,scheduledAppointment:w,activities:g,hasOffers:c.offers&&c.offers.length>0||(g==null?void 0:g.some(x=>x.type==="offer"))||!1,stage:c.displayStage||c.stage,deliverySubstatus:c.deliverySubstatus||null,formatDateTime:r,hasActiveTaskWidget:!1}}),h=$(()=>{const c=u.value,w=In(c.stage,c);if(!w)return null;const g=Sd[w];return g?{type:w,component:g,props:{opportunity:c.opportunity,appointment:c.scheduledAppointment,activities:c.activities}}:null}),b=$(()=>({...u.value,hasActiveTaskWidget:!!h.value})),S=$(()=>{const c=b.value,w=Nn(c.stage,c);if(!w)return null;const g=p[w.key];return{...w,handler:g||(()=>{})}}),o=$(()=>{const c=b.value;return Vn(c.stage,c).map(g=>{const x=p[g.key];return{...g,handler:x||(()=>{})}})}),k=$(()=>{const c=u.value;return Mn(c.stage)}),A=$(()=>!h.value||!h.value.type?"":qn(h.value.type));return{primaryAction:S,secondaryActions:o,activeTaskWidget:h,taskWidgetTitle:A,isClosed:k}}const $d={class:"relative"},Dd=["disabled"],Ad={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},ga={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(n,{emit:M}){const i=n,p=M,r=O(!1),u=()=>{r.value=!r.value},h=()=>{r.value=!1},b=o=>{o.disabled||(h(),p("action-selected",o),o.handler&&typeof o.handler=="function"&&o.handler())},S=$(()=>(i.actions||[]).map(o=>({key:o.key,label:o.label,disabled:!!o.disabled,onClick:()=>b(o)})));return(o,k)=>{const A=Ea("click-outside");return f(),D("div",$d,[e("button",{onClick:Sa(u,["stop"]),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!n.actions||n.actions.length===0},[k[0]||(k[0]=e("span",null,"More actions",-1)),e("i",{class:Z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":r.value}])},null,2)],8,Dd),r.value&&S.value.length>0?Qe((f(),D("div",Ad,[s(t(La),{items:S.value,className:"w-56"},null,8,["items"])])),[[A,h]]):_("",!0)])}}},Td={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Od={class:"space-y-2"},Id={class:"space-y-2"},Nd={class:"space-y-2"},Vd={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:M}){const i=n,p=M,r=O(""),u=O(""),h=O(""),b=$(()=>new Date().toISOString().split("T")[0]);he(()=>i.show,A=>{if(A){const c=new Date;r.value=c.toISOString().split("T")[0],u.value=c.toTimeString().slice(0,5),h.value=""}});const S=()=>{if(!r.value)return;const A=u.value?`${r.value}T${u.value}:00`:`${r.value}T12:00:00`;p("confirm",{contractDate:A,notes:h.value})},o=()=>{p("cancel")},k=A=>{A||o()};return(A,c)=>(f(),de(t(bs),{open:n.show,"onUpdate:open":k},{default:l(()=>[s(t(ms),null,{default:l(()=>[s(t(ps),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(fs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:l(()=>[s(t(vs),{class:"flex-shrink-0"},{default:l(()=>[s(t(gs),null,{default:l(()=>[...c[3]||(c[3]=[I("Set Contract Signing Date",-1)])]),_:1})]),_:1}),e("div",Td,[e("div",Od,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...c[4]||(c[4]=[I("Contract Date",-1)])]),_:1}),s(t(st),{type:"date",modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=w=>r.value=w),max:b.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Id,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...c[5]||(c[5]=[I("Time (Optional)",-1)])]),_:1}),s(t(st),{type:"time",modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=w=>u.value=w),class:"w-full h-10"},null,8,["modelValue"])]),e("div",Nd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...c[6]||(c[6]=[I("Notes (Optional)",-1)])]),_:1}),s(t(at),{modelValue:h.value,"onUpdate:modelValue":c[2]||(c[2]=w=>h.value=w),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(ys),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:l(()=>[s(t(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:o}),s(t(ee),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!r.value,onClick:S},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Md={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},qd={class:"space-y-2"},Ld={class:"space-y-2"},_d={class:"space-y-2"},Ud={class:"space-y-2"},Fd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:M}){const i=n,p=M,r=O(""),u=O(""),h=O(""),b=O(""),S=$(()=>new Date().toISOString().split("T")[0]);he(()=>i.show,c=>{if(c){const w=new Date;r.value=w.toISOString().split("T")[0],u.value=w.toTimeString().slice(0,5),h.value="",b.value=""}});const o=()=>{if(!r.value||!h.value)return;const c=u.value?`${r.value}T${u.value}:00`:`${r.value}T12:00:00`;p("confirm",{deliveryDate:c,location:h.value,notes:b.value})},k=()=>{p("cancel")},A=c=>{c||k()};return(c,w)=>(f(),de(t(bs),{open:n.show,"onUpdate:open":A},{default:l(()=>[s(t(ms),null,{default:l(()=>[s(t(ps),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(fs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:l(()=>[s(t(vs),{class:"flex-shrink-0"},{default:l(()=>[s(t(gs),null,{default:l(()=>[...w[4]||(w[4]=[I("Mark as Delivered",-1)])]),_:1})]),_:1}),e("div",Md,[e("div",qd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...w[5]||(w[5]=[I("Delivery Date",-1)])]),_:1}),s(t(st),{type:"date",modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=g=>r.value=g),max:S.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Ld,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...w[6]||(w[6]=[I("Time (Optional)",-1)])]),_:1}),s(t(st),{type:"time",modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=g=>u.value=g),class:"w-full h-10"},null,8,["modelValue"])]),e("div",_d,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...w[7]||(w[7]=[I("Delivery Location",-1)])]),_:1}),s(t(Vt),{modelValue:h.value,"onUpdate:modelValue":w[2]||(w[2]=g=>h.value=g)},{default:l(()=>[s(t(Ot),{class:"w-full h-10"},{default:l(()=>[s(t(It),{placeholder:"Select location..."})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"Dealership"},{default:l(()=>[...w[8]||(w[8]=[I("At Dealership",-1)])]),_:1}),s(t(ve),{value:"Customer Address"},{default:l(()=>[...w[9]||(w[9]=[I("Customer Address",-1)])]),_:1}),s(t(ve),{value:"Other"},{default:l(()=>[...w[10]||(w[10]=[I("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Ud,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...w[11]||(w[11]=[I("Delivery Notes",-1)])]),_:1}),s(t(at),{modelValue:b.value,"onUpdate:modelValue":w[3]||(w[3]=g=>b.value=g),rows:"4",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(ys),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:l(()=>[s(t(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),s(t(ee),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!r.value||!h.value,onClick:o},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ed={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Rd={class:"space-y-2"},jd={class:"space-y-2"},qa={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0},preselectedReason:{type:String,default:""}},emits:["confirm","cancel"],setup(n,{emit:M}){const i=n,p=M,r=O(""),u=O("");he(()=>i.show,o=>{o&&(i.preselectedReason?r.value=i.preselectedReason:r.value="",u.value="")}),he(()=>i.preselectedReason,o=>{o&&i.show&&(r.value=o)});const h=()=>{r.value&&p("confirm",{reason:r.value,notes:u.value})},b=()=>{p("cancel")},S=o=>{o||b()};return(o,k)=>(f(),de(t(bs),{open:n.show,"onUpdate:open":S},{default:l(()=>[s(t(ms),null,{default:l(()=>[s(t(ps),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(fs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:l(()=>[s(t(vs),{class:"flex-shrink-0"},{default:l(()=>[s(t(gs),null,{default:l(()=>[...k[2]||(k[2]=[I("Close as Lost",-1)])]),_:1})]),_:1}),e("div",Ed,[e("div",Rd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...k[3]||(k[3]=[I("Reason",-1)])]),_:1}),s(t(Vt),{modelValue:r.value,"onUpdate:modelValue":k[0]||(k[0]=A=>r.value=A)},{default:l(()=>[s(t(Ot),{class:"w-full h-10"},{default:l(()=>[s(t(It),{placeholder:"Select a reason..."})]),_:1}),s(t(Nt),null,{default:l(()=>[s(t(ve),{value:"Multiple no shows"},{default:l(()=>[...k[4]||(k[4]=[I("Multiple no shows",-1)])]),_:1}),s(t(ve),{value:"Not interested"},{default:l(()=>[...k[5]||(k[5]=[I("Not interested",-1)])]),_:1}),s(t(ve),{value:"Budget constraints"},{default:l(()=>[...k[6]||(k[6]=[I("Budget constraints",-1)])]),_:1}),s(t(ve),{value:"Found better price"},{default:l(()=>[...k[7]||(k[7]=[I("Found better price at competitor",-1)])]),_:1}),s(t(ve),{value:"No response"},{default:l(()=>[...k[8]||(k[8]=[I("Customer not responding",-1)])]),_:1}),s(t(ve),{value:"Wrong timing"},{default:l(()=>[...k[9]||(k[9]=[I("Timing not right",-1)])]),_:1}),s(t(ve),{value:"Other"},{default:l(()=>[...k[10]||(k[10]=[I("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",jd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:l(()=>[...k[11]||(k[11]=[I("Additional Notes",-1)])]),_:1}),s(t(at),{modelValue:u.value,"onUpdate:modelValue":k[1]||(k[1]=A=>u.value=A),rows:"5",placeholder:"Add any relevant details about why this opportunity was lost...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])]),s(t(ys),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:l(()=>[s(t(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b}),s(t(ee),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!r.value,onClick:h},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Bd={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(n,{emit:M}){const i=M,p=r=>{r||i("cancel")};return(r,u)=>(f(),de(t(bs),{open:n.show,"onUpdate:open":p},{default:l(()=>[s(t(ms),null,{default:l(()=>[s(t(ps),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(fs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:l(()=>[s(t(vs),{class:"flex-shrink-0"},{default:l(()=>[s(t(gs),null,{default:l(()=>[...u[2]||(u[2]=[I("Requalify as Lead",-1)])]),_:1})]),_:1}),u[3]||(u[3]=e("div",{class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),I(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),I(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),I(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),s(t(ys),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:l(()=>[s(t(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[0]||(u[0]=h=>r.$emit("cancel"))}),s(t(ee),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:u[1]||(u[1]=h=>r.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Wd={class:"space-y-4"},Pd={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},zd={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Yd={class:"grid grid-cols-2 gap-4"},Hd={class:"flex items-center gap-2"},Qd={class:"text-sub"},Jd={class:"font-medium text-heading"},Gd={class:"flex items-center gap-2"},Zd={class:"font-medium text-heading"},Kd={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Xd={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},ec={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},tc={class:"p-6"},sc={class:"flex items-center justify-between mb-4"},ac={class:"text-sm font-semibold text-heading"},nc={class:"grid grid-cols-7 gap-1 mb-2"},lc={class:"grid grid-cols-7 gap-1"},oc=["onClick"],ic={class:"p-6"},rc={class:"text-sm font-semibold text-heading mb-4"},uc={key:0,class:"space-y-2"},dc=["onClick"],cc={key:1,class:"text-sm text-sub py-4 text-center"},mc={key:2,class:"text-sm text-sub py-4 text-center"},pc={class:"flex justify-end gap-2 px-4 pb-4 pt-3"},ya={__name:"OpportunityScheduleForm",props:{opportunity:{type:Object,required:!0},mode:{type:String,validator:n=>["schedule","reschedule"].includes(n),default:"schedule"},initialAppointment:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=qt(),h=O(""),b=O(null),S=O(""),o=O(null),k=O(null),A=O(null),c=O(""),w=O(new Date().getMonth()),g=O(new Date().getFullYear()),x=O({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),V=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],C={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},R=$(()=>V.map(j=>({value:j.value,label:j.label}))),F=$(()=>{const j=[];for(let W=9*60;W<=18*60;W+=30){const oe=String(Math.floor(W/60)).padStart(2,"0"),G=String(W%60).padStart(2,"0");j.push(`${oe}:${G}`)}return j}),E=$(()=>{if(A.value!=null)return A.value;const j=parseInt(c.value,10);return Number.isFinite(j)&&j>0?j:null}),fe=$(()=>p.mode==="reschedule"?"Reschedule and Save":"Schedule and Save"),pe=$(()=>!!(h.value&&b.value&&S.value&&o.value)),L=["MON","TUE","WED","THU","FRI","SAT","SUN"],T=$(()=>new Date(g.value,w.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),q=$(()=>{const j=new Date(g.value,w.value,1),oe=new Date(g.value,w.value+1,0).getDate(),G=j.getDay()===0?6:j.getDay()-1,P=[];for(let se=0;se<G;se++)P.push(null);for(let se=1;se<=oe;se++)P.push(se);return P}),B=$(()=>{if(!b.value)return"Select a date";const j=b.value,W=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${W[j.getDay()]}, ${oe[j.getMonth()]} ${j.getDate()}`}),Y=$(()=>u.assignableUsers),ne=$(()=>u.assignableTeams),H=$(()=>ne.value.map(j=>({...j,label:`${j.dealership||"No location"} → ${j.name}`,value:j.id}))),ye=$(()=>{var oe;if(!o.value)return[];const j=o.value;return(((oe=Y.value)==null?void 0:oe.filter(G=>G.team===j.name||G.teamId===j.id))||[]).map(G=>({...G,label:G.name,value:G.id}))}),Ie=$({get:()=>{var j;return((j=o.value)==null?void 0:j.id)||null},set:j=>{var oe;if(!j){o.value=null,k.value=null;return}const W=(oe=ne.value)==null?void 0:oe.find(G=>G.id===j);o.value=W||null,W&&X(`team-${W.id}`)}}),ce=$({get:()=>{var j;return((j=k.value)==null?void 0:j.id)||null},set:j=>{if(!j){k.value=null;return}const W=ye.value.find(oe=>oe.id===j);k.value=W||null,W&&X(`user-${W.id}`)}}),te=$(()=>{if(!b.value)return[];const j=b.value.toISOString().split("T")[0];if(k.value){const W=Ft(`user-${k.value.id}`,j);return F.value.filter(oe=>W.includes(oe))}if(o.value){const W=Ft(`team-${o.value.id}`,j);return F.value.filter(oe=>W.includes(oe))}return F.value||[]});function K(j){return j?j.split(" ").map(W=>W[0]).join("").toUpperCase().substring(0,2):"?"}function re(j){return{manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"}[j]||"bg-surfaceSecondary text-body"}function xe(j){if(!j)return;const W=new Date(g.value,w.value,j);b.value=W,S.value=""}function De(j){if(!j||!b.value)return!1;const W=b.value;return W.getDate()===j&&W.getMonth()===w.value&&W.getFullYear()===g.value}function Ge(){w.value===0?(w.value=11,g.value--):w.value--}function z(){w.value===11?(w.value=0,g.value++):w.value++}function X(j){const W=new Date;W.setHours(0,0,0,0);for(let oe=0;oe<30;oe++){const G=new Date(W);if(G.setDate(W.getDate()+oe),G.getDay()===0||G.getDay()===6)continue;const P=G.toISOString().split("T")[0],se=Ft(j,P);if(se!=null&&se.length){b.value=G,w.value=G.getMonth(),g.value=G.getFullYear();const le=F.value.filter(ke=>se.includes(ke));le.length&&(S.value=le[0]);break}}}function Fe(j){x.value=j}function Ee(){Re(),r("cancel")}function Re(){h.value="",b.value=null,S.value="",o.value=null,k.value=null,A.value=null,c.value="",x.value={immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}}function $e(j){var W,oe,G;if(j){if(h.value=j.type||"",j.assignee){const P=(W=Y.value)==null?void 0:W.find(le=>le.name===j.assignee),se=(oe=ne.value)==null?void 0:oe.find(le=>le.name===j.assignee);if(P){const le=(G=ne.value)==null?void 0:G.find(ke=>ke.name===P.team||ke.id===P.teamId);le&&(o.value=le,k.value=P)}else se&&(o.value=se)}if(j.start){const P=new Date(j.start),se=new Date(P.getFullYear(),P.getMonth(),P.getDate());b.value=se,w.value=P.getMonth(),g.value=P.getFullYear();const le=P.getHours(),ke=P.getMinutes(),ge=ke<15?0:ke<45?30:60,Le=ge===60?le+1:le,we=ge===60?0:ge,Ne=`${String(Le).padStart(2,"0")}:${String(we).padStart(2,"0")}`;if(F.value.includes(Ne))S.value=Ne;else{const Pe=Le*60+we,Ze=F.value.reduce((Je,Ue)=>{const[ue,ae]=Ue.split(":").map(Number),be=ue*60+ae;if(!Je)return Ue;const[Se,Ce]=Je.split(":").map(Number),Ve=Se*60+Ce;return Math.abs(be-Pe)<Math.abs(Ve-Pe)?Ue:Je},null);S.value=Ze||F.value[0]||""}}if(j.duration){const P=j.duration;P===15?A.value=15:P===30?A.value=30:P===60?A.value=60:(A.value=null,c.value=String(P))}}}he(h,j=>{if(!j)return;const W=C[j];if(W&&(W===15?A.value=15:W===30?A.value=30:W===60?A.value=60:(A.value=null,c.value=String(W)),!b.value)){const oe=new Date;oe.setHours(0,0,0,0),b.value=oe,w.value=oe.getMonth(),g.value=oe.getFullYear()}}),he(b,()=>{S.value=""}),he(()=>p.opportunity.assignee,j=>{var G,P,se;if(!j||o.value||k.value)return;const W=(G=Y.value)==null?void 0:G.find(le=>le.name===j),oe=(P=ne.value)==null?void 0:P.find(le=>le.name===j);if(W){const le=(se=ne.value)==null?void 0:se.find(ke=>ke.name===W.team||ke.id===W.teamId);le&&(o.value=le,k.value=W)}else oe&&(o.value=oe)},{immediate:!0}),hs(()=>{p.mode==="reschedule"&&p.initialAppointment&&$e(p.initialAppointment)});function Ae(){pe.value&&r("submit",{eventType:h.value,selectedDate:b.value,selectedSlot:S.value,selectedTeam:o.value,selectedSalesman:k.value,durationValue:E.value,communicationPreferences:x.value})}return M({resetForm:Re}),(j,W)=>{var oe;return f(),D("div",Wd,[e("div",Pd,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...W[3]||(W[3]=[I("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:h.value,"onUpdate:modelValue":W[0]||(W[0]=G=>h.value=G),items:R.value,placeholder:"Select event type...","value-key":"value",class:"w-full"},{item:l(({item:G})=>[e("span",null,N(G.label),1)]),_:1},8,["modelValue","items"])]),h.value?(f(),D("div",zd,[W[7]||(W[7]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Yd,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...W[4]||(W[4]=[I("Team",-1)])]),_:1}),s(t(Ye),{modelValue:Ie.value,"onUpdate:modelValue":W[1]||(W[1]=G=>Ie.value=G),items:H.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:G})=>[e("div",Hd,[e("span",Qd,N(G.dealership||"No location"),1),W[5]||(W[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Jd,N(G.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...W[6]||(W[6]=[I("Salesperson (optional)",-1)])]),_:1}),s(t(Ye),{modelValue:ce.value,"onUpdate:modelValue":W[2]||(W[2]=G=>ce.value=G),items:ye.value,disabled:!o.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:G})=>[e("div",Gd,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(G.role)])},N(K(G.name)),3),e("span",Zd,N(G.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):_("",!0),h.value&&o.value?(f(),D("div",Kd,[W[10]||(W[10]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},[I("Schedule "),e("span",{class:"text-red-600"},"*")],-1)),e("div",Xd,[e("div",ec,[e("div",tc,[e("div",sc,[e("button",{type:"button",onClick:Ge,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...W[8]||(W[8]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",ac,N(T.value),1),e("button",{type:"button",onClick:z,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...W[9]||(W[9]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",nc,[(f(),D(Me,null,We(L,G=>e("div",{key:G,class:"text-center text-xs font-semibold text-sub py-1"},N(G),1)),64))]),e("div",lc,[(f(!0),D(Me,null,We(q.value,(G,P)=>(f(),D("div",{key:P,onClick:se=>G&&xe(G),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",De(G)?"bg-primary text-white cursor-pointer":G?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},N(G),11,oc))),128))])]),e("div",ic,[e("h6",rc,N(B.value),1),b.value&&te.value.length>0?(f(),D("div",uc,[(f(!0),D(Me,null,We(te.value,G=>(f(),D("button",{key:G,type:"button",onClick:P=>S.value=G,class:Z(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",S.value===G?"border-primary bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-primary/30"])},N(G),11,dc))),128))])):b.value&&te.value.length===0?(f(),D("div",cc," No available time slots for this date ")):(f(),D("div",mc," Select a date to see available time slots "))])])])])):_("",!0),h.value&&o.value?(f(),de(Ka,{key:2,appointment:{type:h.value,date:b.value,time:S.value,duration:E.value},customer:n.opportunity.customer,salesperson:k.value,team:o.value,dealership:(oe=o.value)!=null&&oe.dealership?{name:o.value.dealership}:null,onUpdate:Fe},null,8,["appointment","customer","salesperson","team","dealership"])):_("",!0),e("div",pc,[s(t(ee),{variant:"secondary",onClick:Ee},{default:l(()=>[...W[11]||(W[11]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!pe.value,onClick:Ae,class:"bg-primary"},{default:l(()=>[I(N(fe.value),1)]),_:1},8,["disabled"])])])}}},fc={class:"space-y-4"},vc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},gc={class:"text-sm text-body"},yc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},bc={class:"grid grid-cols-2 gap-4"},hc={class:"flex items-center gap-2"},xc={class:"text-sub"},wc={class:"font-medium text-heading"},kc={class:"flex items-center gap-2"},Sc={class:"font-medium text-heading"},Cc={class:"mt-4"},$c={__name:"NS1Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=qt(),h=Dt(),b=Mt(),S=O(null),o=O(null),k=O(""),A=$(()=>u.assignableUsers),c=$(()=>u.assignableTeams),w=$(()=>c.value.map(L=>({...L,label:`${L.dealership||"No location"} → ${L.name}`,value:L.id}))),g=$(()=>{var q;if(!S.value)return[];const L=S.value;return(((q=A.value)==null?void 0:q.filter(B=>B.team===L.name||B.teamId===L.id))||[]).map(B=>({...B,label:B.name,value:B.id}))}),x=$({get:()=>{var L;return((L=S.value)==null?void 0:L.id)||null},set:L=>{var q;if(!L){S.value=null;return}const T=(q=c.value)==null?void 0:q.find(B=>B.id===L);S.value=T||null,T&&(o.value=null)}}),V=$({get:()=>{var L;return((L=o.value)==null?void 0:L.id)||null},set:L=>{if(!L){o.value=null;return}const T=g.value.find(q=>q.id===L);o.value=T||null}}),C=L=>L?L.split(" ").map(T=>T[0]).join("").toUpperCase().substring(0,2):"?",R=L=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[L]||"bg-surfaceSecondary text-body",F=$(()=>!!S.value);async function E(){var q,B,Y;if(!F.value)return;const L=((q=o.value)==null?void 0:q.name)||((B=S.value)==null?void 0:B.name),T={assignee:L};k.value&&(T.assignmentNote=k.value),await b.updateOpportunity(p.opportunity.id,T),await b.addActivity(p.opportunity.id,{type:"assignment",user:((Y=h.currentUser)==null?void 0:Y.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${L}${k.value?` with note: ${k.value}`:""}`,timestamp:new Date().toISOString()}),r("assigned",{opportunity:p.opportunity,assignee:L,note:k.value})}M({canSubmit:F,submit:E});const fe=$(()=>"Follow up with customer to understand the situation and book another appointment."),pe=$(()=>{var T;return(T=p.scheduledAppointment)!=null&&T.start?new Date(p.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return hs(()=>{var L,T,q;if(p.opportunity.assignee&&!S.value&&!o.value){const B=(L=A.value)==null?void 0:L.find(ne=>ne.name===p.opportunity.assignee),Y=(T=c.value)==null?void 0:T.find(ne=>ne.name===p.opportunity.assignee);if(B){const ne=(q=c.value)==null?void 0:q.find(H=>H.name===B.team||H.id===B.teamId);ne&&(S.value=ne,o.value=B)}else Y&&(S.value=Y)}p.opportunity.assignmentNote&&(k.value=p.opportunity.assignmentNote)}),he(()=>p.opportunity.assignee,L=>{var T,q,B;if(L&&!S.value&&!o.value){const Y=(T=A.value)==null?void 0:T.find(H=>H.name===L),ne=(q=c.value)==null?void 0:q.find(H=>H.name===L);if(Y){const H=(B=c.value)==null?void 0:B.find(ye=>ye.name===Y.team||ye.id===Y.teamId);H&&(S.value=H,o.value=Y)}else ne&&(S.value=ne)}}),(L,T)=>(f(),D("div",fc,[e("div",vc,[T[3]||(T[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"1st No-Show Follow-up Task",-1)),e("p",gc," Appointment was scheduled for "+N(pe.value)+" but customer did not show up. "+N(fe.value),1)]),e("div",yc,[T[8]||(T[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",bc,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[4]||(T[4]=[I("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:x.value,"onUpdate:modelValue":T[0]||(T[0]=q=>x.value=q),items:w.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:q})=>[e("div",hc,[e("span",xc,N(q.dealership||"No location"),1),T[5]||(T[5]=e("span",{class:"text-sub"},"→",-1)),e("span",wc,N(q.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[6]||(T[6]=[I("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ye),{modelValue:V.value,"onUpdate:modelValue":T[1]||(T[1]=q=>V.value=q),items:g.value,disabled:!S.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:q})=>[e("div",kc,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",R(q.role)])},N(C(q.name)),3),e("span",Sc,N(q.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",Cc,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[7]||(T[7]=[I("Notes for assignee",-1)])]),_:1}),s(t(at),{modelValue:k.value,"onUpdate:modelValue":T[2]||(T[2]=q=>k.value=q),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},Dc={class:"space-y-4"},Ac={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Tc={class:"text-sm text-body"},Oc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ic={class:"grid grid-cols-2 gap-4"},Nc={class:"flex items-center gap-2"},Vc={class:"text-sub"},Mc={class:"font-medium text-heading"},qc={class:"flex items-center gap-2"},Lc={class:"font-medium text-heading"},_c={class:"mt-4"},Uc={__name:"NS2Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=qt(),h=Dt(),b=Mt(),S=O(null),o=O(null),k=O(""),A=$(()=>u.assignableUsers),c=$(()=>u.assignableTeams),w=$(()=>c.value.map(L=>({...L,label:`${L.dealership||"No location"} → ${L.name}`,value:L.id}))),g=$(()=>{var q;if(!S.value)return[];const L=S.value;return(((q=A.value)==null?void 0:q.filter(B=>B.team===L.name||B.teamId===L.id))||[]).map(B=>({...B,label:B.name,value:B.id}))}),x=$({get:()=>{var L;return((L=S.value)==null?void 0:L.id)||null},set:L=>{var q;if(!L){S.value=null;return}const T=(q=c.value)==null?void 0:q.find(B=>B.id===L);S.value=T||null,T&&(o.value=null)}}),V=$({get:()=>{var L;return((L=o.value)==null?void 0:L.id)||null},set:L=>{if(!L){o.value=null;return}const T=g.value.find(q=>q.id===L);o.value=T||null}}),C=L=>L?L.split(" ").map(T=>T[0]).join("").toUpperCase().substring(0,2):"?",R=L=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[L]||"bg-surfaceSecondary text-body",F=$(()=>!!S.value);async function E(){var q,B,Y;if(!F.value)return;const L=((q=o.value)==null?void 0:q.name)||((B=S.value)==null?void 0:B.name),T={assignee:L};k.value&&(T.assignmentNote=k.value),await b.updateOpportunity(p.opportunity.id,T),await b.addActivity(p.opportunity.id,{type:"assignment",user:((Y=h.currentUser)==null?void 0:Y.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${L}${k.value?` with note: ${k.value}`:""}`,timestamp:new Date().toISOString()}),r("assigned",{opportunity:p.opportunity,assignee:L,note:k.value})}M({canSubmit:F,submit:E});const fe=$(()=>"This is the second no-show. Please make every effort to reach the customer and reschedule."),pe=$(()=>{var T;return(T=p.scheduledAppointment)!=null&&T.start?new Date(p.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return hs(()=>{var L,T,q;if(p.opportunity.assignee&&!S.value&&!o.value){const B=(L=A.value)==null?void 0:L.find(ne=>ne.name===p.opportunity.assignee),Y=(T=c.value)==null?void 0:T.find(ne=>ne.name===p.opportunity.assignee);if(B){const ne=(q=c.value)==null?void 0:q.find(H=>H.name===B.team||H.id===B.teamId);ne&&(S.value=ne,o.value=B)}else Y&&(S.value=Y)}p.opportunity.assignmentNote&&(k.value=p.opportunity.assignmentNote)}),he(()=>p.opportunity.assignee,L=>{var T,q,B;if(L&&!S.value&&!o.value){const Y=(T=A.value)==null?void 0:T.find(H=>H.name===L),ne=(q=c.value)==null?void 0:q.find(H=>H.name===L);if(Y){const H=(B=c.value)==null?void 0:B.find(ye=>ye.name===Y.team||ye.id===Y.teamId);H&&(S.value=H,o.value=Y)}else ne&&(S.value=ne)}}),(L,T)=>(f(),D("div",Dc,[e("div",Ac,[T[3]||(T[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"2nd No-Show Follow-up Task",-1)),e("p",Tc," Appointment was scheduled for "+N(pe.value)+" but customer did not show up. "+N(fe.value),1)]),e("div",Oc,[T[8]||(T[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",Ic,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[4]||(T[4]=[I("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ye),{modelValue:x.value,"onUpdate:modelValue":T[0]||(T[0]=q=>x.value=q),items:w.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:l(({item:q})=>[e("div",Nc,[e("span",Vc,N(q.dealership||"No location"),1),T[5]||(T[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Mc,N(q.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[6]||(T[6]=[I("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ye),{modelValue:V.value,"onUpdate:modelValue":T[1]||(T[1]=q=>V.value=q),items:g.value,disabled:!S.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:l(({item:q})=>[e("div",qc,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",R(q.role)])},N(C(q.name)),3),e("span",Lc,N(q.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",_c,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:l(()=>[...T[7]||(T[7]=[I("Notes for assignee",-1)])]),_:1}),s(t(at),{modelValue:k.value,"onUpdate:modelValue":T[2]||(T[2]=q=>k.value=q),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},Fc={class:"space-y-4"},Ec={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Rc={class:"text-sm text-body"},jc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Bc={__name:"NS3Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["close-as-lost","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=O(null),h=$(()=>"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed."),b=$(()=>{var c;return(c=p.scheduledAppointment)!=null&&c.start?new Date(p.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),S=$(()=>{var A;return((A=u.value)==null?void 0:A.canSubmit)||!1});function o(){var A;(A=u.value)==null||A.submit()}function k(A){r("close-as-lost",{opportunity:p.opportunity,reason:A})}return M({canSubmit:S,submit:o}),(A,c)=>(f(),D("div",Fc,[e("div",Ec,[c[0]||(c[0]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"3rd No-Show Follow-up Task",-1)),e("p",Rc," Appointment was scheduled for "+N(b.value)+" but customer did not show up. "+N(h.value),1)]),e("div",jc,[c[1]||(c[1]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),s($a,{ref_key:"closeFormRef",ref:u,"show-multiple-no-shows":!0,"preselected-reason":"Multiple no shows","close-button-label":"Close as Lost",onClose:k},null,512)])]))}},Wc={class:"space-y-4"},Pc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},zc={__name:"OfferAssignmentTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["offer-created","cancel"],setup(n,{expose:M,emit:i}){const p=n,r=i,u=O(null),h=$(()=>p.opportunity.requestedCar||p.opportunity.vehicle||null),b=$(()=>{var k;return((k=u.value)==null?void 0:k.isValid)||!1});function S(){var k;(k=u.value)==null||k.submit()}function o(k){r("offer-created",{opportunity:p.opportunity,offerData:k})}return M({canSubmit:b,submit:S}),(k,A)=>(f(),D("div",Wc,[A[0]||(A[0]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"Create Offer"),e("p",{class:"text-sm text-body"}," Customer showed up for the appointment. Create an offer to proceed with the opportunity. ")],-1)),e("div",Pc,[s(Bs,{item:null,"task-type":"opportunity","task-id":n.opportunity.id,"selected-vehicle":h.value,customer:n.opportunity.customer,"hide-header":!0,"hide-actions":!0,ref_key:"offerWidgetRef",ref:u,onSave:o},null,8,["task-id","selected-vehicle","customer"])])]))}},Yc={class:"space-y-6"},Hc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Qc={class:"space-y-6"},Jc={class:"space-y-2"},Gc=["value"],Zc={class:"text-sm text-heading"},Kc={class:"space-y-2"},Xc=["value"],em={class:"text-sm text-heading"},tm={key:0},sm={class:"space-y-2"},am=["value"],nm={class:"text-sm text-heading"},lm={class:"flex items-center gap-2"},om=["onClick"],im={key:0,class:"text-sm text-body ml-2"},rm={class:"space-y-2"},um=["value"],dm={class:"text-sm text-heading"},cm={class:"flex items-center gap-2 mt-2"},mm={class:"space-y-2"},pm=["value"],fm={class:"text-sm text-heading"},vm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},gm={class:"space-y-4"},ym={class:"flex items-center gap-3"},bm={class:"flex items-center gap-3"},hm={class:"flex items-center gap-3"},xm={class:"flex items-center gap-3"},wm={__name:"PostDeliverySurvey",props:{opportunity:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{expose:M,emit:i}){const p=i,r=O({q1:"",q2:"",q3:"",q4:"",q5:null,q6:[],q6Other:!1,q6OtherText:"",q7:"",q8:""}),u=O({negativeSatisfaction:!1,issuesReported:!1,deliveryDelay:!1,highNPS:!1}),h=[{value:"very-satisfied",label:"Very Satisfied"},{value:"satisfied",label:"Satisfied"},{value:"neutral",label:"Neutral"},{value:"unsatisfied",label:"Unsatisfied"},{value:"very-unsatisfied",label:"Very Unsatisfied"}],b=[{value:"perfect",label:"Yes, perfect condition"},{value:"acceptable",label:"Yes, acceptable"},{value:"minor-issues",label:"There are minor issues"},{value:"major-issues",label:"There are major issues"}],S=[{value:"on-time",label:"Yes, on time"},{value:"early",label:"Yes, early"},{value:"delayed-minor",label:"No, delayed (minor - 1-3 days)"},{value:"delayed-major",label:"No, delayed (major - more than 3 days)"}],o=[{value:"keys",label:"Vehicle keys"},{value:"manual",label:"Owner's manual"},{value:"registration",label:"Registration documents"},{value:"warranty",label:"Service warranty information"},{value:"insurance",label:"Insurance documents"}],k=[{value:"definitely-yes",label:"Definitely Yes"},{value:"probably-yes",label:"Probably Yes"},{value:"not-sure",label:"Not Sure"},{value:"probably-not",label:"Probably Not"},{value:"definitely-not",label:"Definitely Not"}],A=$(()=>r.value.q2==="minor-issues"||r.value.q2==="major-issues");he(()=>r.value.q1,g=>{g==="very-unsatisfied"||g==="unsatisfied"?u.value.negativeSatisfaction=!0:u.value.negativeSatisfaction=!1}),he(()=>r.value.q3,g=>{g&&g.trim().length>0?u.value.issuesReported=!0:u.value.issuesReported=!1}),he(()=>r.value.q4,g=>{g==="delayed-major"?u.value.deliveryDelay=!0:u.value.deliveryDelay=!1}),he(()=>r.value.q7,g=>{g==="definitely-yes"?u.value.highNPS=!0:u.value.highNPS=!1});const c=$(()=>{var V,C;if(!r.value.q1||!r.value.q2||A.value&&!((V=r.value.q3)!=null&&V.trim()))return!1;const g=r.value.q6&&r.value.q6.length>0,x=r.value.q6Other&&((C=r.value.q6OtherText)==null?void 0:C.trim());return!(!g&&!x)});return M({submit:()=>{if(!c.value)return;const g={responses:{...r.value},triggerActions:{...u.value},timestamp:new Date().toISOString()};p("submit",g)},isValid:c}),(g,x)=>(f(),D("div",Yc,[e("div",Hc,[x[22]||(x[22]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Post-Delivery Customer Satisfaction Survey",-1)),e("div",Qc,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[13]||(x[13]=[I(" How satisfied are you with your new vehicle delivery experience? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Jc,[(f(),D(Me,null,We(h,V=>e("label",{key:V.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",r.value.q1===V.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":x[0]||(x[0]=C=>r.value.q1=C),type:"radio",value:V.value,class:"shrink-0"},null,8,Gc),[[ct,r.value.q1]]),e("span",Zc,N(V.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[14]||(x[14]=[I(" Is the vehicle in the condition you expected? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Kc,[(f(),D(Me,null,We(b,V=>e("label",{key:V.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",r.value.q2===V.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":x[1]||(x[1]=C=>r.value.q2=C),type:"radio",value:V.value,class:"shrink-0"},null,8,Xc),[[ct,r.value.q2]]),e("span",em,N(V.label),1)],2)),64))])]),A.value?(f(),D("div",tm,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[15]||(x[15]=[I(" Please describe the issues you found: ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(at),{modelValue:r.value.q3,"onUpdate:modelValue":x[2]||(x[2]=V=>r.value.q3=V),rows:"4",placeholder:"Describe the issues...",class:"w-full"},null,8,["modelValue"])])):_("",!0),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[16]||(x[16]=[I(" Was the vehicle delivered on the scheduled date? ",-1)])]),_:1}),e("div",sm,[(f(),D(Me,null,We(S,V=>e("label",{key:V.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",r.value.q4===V.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":x[3]||(x[3]=C=>r.value.q4=C),type:"radio",value:V.value,class:"shrink-0"},null,8,am),[[ct,r.value.q4]]),e("span",nm,N(V.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[17]||(x[17]=[I(" How would you rate the professionalism of our sales team during delivery? ",-1)])]),_:1}),e("div",lm,[(f(),D(Me,null,We(5,V=>e("button",{key:V,onClick:C=>r.value.q5=V,class:Z(["text-2xl transition-colors",r.value.q5>=V?"text-yellow-500":"text-gray-300"])}," ⭐ ",10,om)),64)),r.value.q5?(f(),D("span",im,N(r.value.q5)+" "+N(r.value.q5===1?"star":"stars"),1)):_("",!0)])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[18]||(x[18]=[I(" Did you receive all the required items? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",rm,[(f(),D(Me,null,We(o,V=>e("label",{key:V.value,class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},[Qe(e("input",{"onUpdate:modelValue":x[4]||(x[4]=C=>r.value.q6=C),type:"checkbox",value:V.value,class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,8,um),[[ba,r.value.q6]]),e("span",dm,N(V.label),1)])),64)),e("div",cm,[Qe(e("input",{"onUpdate:modelValue":x[5]||(x[5]=V=>r.value.q6Other=V),type:"checkbox",class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[ba,r.value.q6Other]]),x[19]||(x[19]=e("span",{class:"text-sm text-heading"},"Other:",-1)),r.value.q6Other?(f(),de(t(st),{key:0,modelValue:r.value.q6OtherText,"onUpdate:modelValue":x[6]||(x[6]=V=>r.value.q6OtherText=V),placeholder:"Specify other item",class:"flex-1"},null,8,["modelValue"])):_("",!0)])])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[20]||(x[20]=[I(" Would you recommend our dealership to friends and family? ",-1)])]),_:1}),e("div",mm,[(f(),D(Me,null,We(k,V=>e("label",{key:V.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",r.value.q7===V.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Qe(e("input",{"onUpdate:modelValue":x[7]||(x[7]=C=>r.value.q7=C),type:"radio",value:V.value,class:"shrink-0"},null,8,pm),[[ct,r.value.q7]]),e("span",fm,N(V.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...x[21]||(x[21]=[I(" Internal notes for follow-up actions: ",-1),e("span",{class:"text-xs text-sub ml-1"},"(Private - only for internal staff)",-1)])]),_:1}),s(t(at),{modelValue:r.value.q8,"onUpdate:modelValue":x[8]||(x[8]=V=>r.value.q8=V),rows:"4",placeholder:"Add internal notes...",class:"w-full"},null,8,["modelValue"])])])]),e("div",vm,[x[31]||(x[31]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Trigger Actions (Email Notifications)",-1)),e("div",gm,[e("div",ym,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"trigger-negative-satisfaction",modelValue:u.value.negativeSatisfaction,"onUpdate:modelValue":x[9]||(x[9]=V=>u.value.negativeSatisfaction=V)},null,8,["modelValue"]),x[23]||(x[23]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Sales Manager + Branch Manager ",-1))]),_:1}),x[24]||(x[24]=e("span",{class:"text-xs text-sub"},"(Q1 = Very Unsatisfied/Unsatisfied)",-1))]),e("div",bm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"trigger-issues",modelValue:u.value.issuesReported,"onUpdate:modelValue":x[10]||(x[10]=V=>u.value.issuesReported=V)},null,8,["modelValue"]),x[25]||(x[25]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Service Department ",-1))]),_:1}),x[26]||(x[26]=e("span",{class:"text-xs text-sub"},"(Q3 = Issues reported)",-1))]),e("div",hm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"trigger-delay",modelValue:u.value.deliveryDelay,"onUpdate:modelValue":x[11]||(x[11]=V=>u.value.deliveryDelay=V)},null,8,["modelValue"]),x[27]||(x[27]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Delivery Coordinator ",-1))]),_:1}),x[28]||(x[28]=e("span",{class:"text-xs text-sub"},"(Q4 = Delayed major)",-1))]),e("div",xm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:l(()=>[s(t(Ut),{id:"trigger-nps",modelValue:u.value.highNPS,"onUpdate:modelValue":x[12]||(x[12]=V=>u.value.highNPS=V)},null,8,["modelValue"]),x[29]||(x[29]=e("span",{class:"text-sm font-medium text-heading"}," ✅ Email to Marketing ",-1))]),_:1}),x[30]||(x[30]=e("span",{class:"text-xs text-sub"},"(Q7 = Definitely Yes)",-1))])])])]))}},km={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Sm={class:"pt-1 px-1"},Cm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},$m={class:"p-4"},Dm={class:"mb-3"},Am={class:"text-sm text-body mt-0.5"},Tm={class:"flex flex-wrap gap-3 items-center"},Om={key:0,class:"mt-4"},Im={key:0,class:"mt-4"},Nm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Vm={key:0,class:"mt-4"},Mm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},qm={key:2,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Lm={class:"pt-1 px-1"},_m={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Um={class:"p-4"},Fm={class:"mb-3"},Em={class:"text-sm text-body mt-0.5"},Rm={class:"mb-4"},jm={class:"flex flex-wrap gap-3 items-center"},Bm={key:0,class:"mt-4 space-y-4"},Wm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Pm={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},zm={key:0,class:"space-y-3"},Ym={class:"flex items-center justify-between gap-2"},Hm={class:"text-sub text-xs"},Qm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Jm={key:0,class:"mt-4"},Gm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Zm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Km={key:3,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Xm={class:"pt-1 px-1"},ep={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},tp={class:"p-4"},sp={class:"flex flex-wrap gap-3 items-center"},ap={key:0,class:"mt-4 px-4 pb-4"},np={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},lp={class:"space-y-4"},op={class:"flex justify-end gap-2 mt-4"},ip={key:0,class:"mt-4"},rp={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},up={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},dp={key:0,class:"mt-4 px-4 pb-4"},cp={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mp={class:"space-y-4"},pp={class:"flex justify-end gap-2 mt-4"},fp={key:0,class:"mt-4 px-4 pb-4"},vp={key:0,class:"space-y-4"},gp={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},yp={class:"flex items-start gap-3"},bp={class:"flex-1"},hp={class:"text-sm text-body whitespace-pre-wrap"},xp={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},wp={class:"pt-1 px-1"},kp={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Sp={class:"p-4"},Cp={class:"px-4 py-4"},$p={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Dp={class:"pt-1 px-1"},Ap={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Tp={class:"p-4"},Op={class:"flex flex-wrap gap-3 items-center"},Ip={class:"relative"},Np={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},Vp={key:0,class:"mt-4 px-4 pb-4"},Mp={class:"flex justify-end gap-2 mt-4"},qp={key:2,class:"space-y-3"},Lp={class:"flex items-center gap-2 pb-2 border-b border"},_p={class:"font-semibold text-heading text-fluid-sm"},Up={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled","appointment-cancelled","appointment-no-show"],setup(n,{emit:M}){const i=n,p=M,r=Fa(),u=Mt();qt();const h=Dt(),{t:b}=ka(),S=()=>{var d;const y=u.currentOpportunity;return y&&y.id===((d=i.opportunity)==null?void 0:d.id)?y:i.opportunity},o=$(()=>{var y;return i.scheduledAppointment||((y=i.opportunity)==null?void 0:y.scheduledAppointment)||null}),k=$(()=>{if(o.value&&o.value.start)return!1;const y=me.displayStage.value,d=y===Rs.QUALIFIED,m=y===Rs.AWAITING_APPOINTMENT;return(d||m)&&!me.isClosed.value});$(()=>!o.value||!o.value.start?!1:new Date(o.value.start)<new Date&&o.value.status!=="completed");const A=$(()=>{const y=i.opportunity,d=me.displayStage.value;return y.stage==="Closed Won"||d==="Closed Won"}),c=$(()=>{const y=i.opportunity,d=me.displayStage.value;return y.stage==="Closed Lost"||d==="Closed Lost"?!1:A.value}),w=Ja(),{isCallActive:g,callEnded:x,callDuration:V,callNotes:C,mockTranscription:R,formattedCallDuration:F,startCall:E,endCall:fe,copyNumber:pe}=w,L=()=>{E()},T=()=>{fe()},q=()=>{var y;pe(((y=i.opportunity.customer)==null?void 0:y.phone)||"")},B=y=>{C.value=y},Y=()=>{w.callData.value={channel:"external",notes:"",transcription:null}},ne=O(null),H=()=>{K.value=!1},ye=()=>{var y;(y=ne.value)==null||y.resetForm()};async function Ie(y,d){var ls,os,Qt,is,rs;const{eventType:m,selectedDate:a,selectedSlot:U,selectedTeam:v,selectedSalesman:Q,durationValue:ie,communicationPreferences:Te}=y,Oe=i.opportunity,bt=a,[ma,Ht]=U.split(":").map(Number),Ct=new Date(bt);Ct.setHours(ma,Ht,0,0);const Lt=ie||30,ts=new Date(Ct.getTime()+Lt*6e4),ss=(Q==null?void 0:Q.name)||(v==null?void 0:v.name)||Oe.assignee||"Unassigned",as=(Q==null?void 0:Q.id)||(v==null?void 0:v.id)||null,ns=Q?"user":"team";try{if(d==="reschedule"){const _s={title:`Appointment - ${((ls=Oe.customer)==null?void 0:ls.name)||"Customer"}`,start:Ct.toISOString(),end:ts.toISOString(),type:m,assignee:ss,customerId:Oe.customerId,opportunityId:Oe.id,duration:Lt,status:"pending_confirmation"};let Us={..._s};if((os=o.value)!=null&&os.id){const{updateCalendarEvent:fa}=await Jt(async()=>{const{updateCalendarEvent:en}=await import("./users-CkqXh-gx.js").then(tn=>tn.i);return{updateCalendarEvent:en}},__vite__mapDeps([3,1,2]));await fa(o.value.id,{..._s,status:"pending_confirmation"}),Us.id=o.value.id}else{const fa=await va({..._s,status:"pending_confirmation"});Us={..._s,id:fa.id,status:"pending_confirmation"}}await u.updateOpportunity(Oe.id,{scheduledAppointment:Us}),p("appointment-scheduled",Us),K.value=!1;return}const pa={customerId:Oe.customerId||((Qt=Oe.customer)==null?void 0:Qt.id),customer:((is=Oe.customer)==null?void 0:is.name)||"Unknown",start:Ct.toISOString(),end:ts.toISOString(),type:m,title:`${m} - ${((rs=Oe.customer)==null?void 0:rs.name)||"Customer"}`,assigneeId:as,assigneeType:ns,teamId:(v==null?void 0:v.id)||null,team:(v==null?void 0:v.name)||null,salesperson:(Q==null?void 0:Q.name)||null,salespersonId:(Q==null?void 0:Q.id)||null,duration:Lt,opportunityId:Oe.id},Da=await va(pa),Aa={id:Da.id,start:Ct.toISOString(),end:ts.toISOString(),type:m,assignee:ss,assigneeId:as,assigneeType:ns,duration:Lt,team:(v==null?void 0:v.name)||null,teamId:(v==null?void 0:v.id)||null,salesperson:(Q==null?void 0:Q.name)||null,salespersonId:(Q==null?void 0:Q.id)||null,communications:Te,status:"confirmed"};await u.updateOpportunity(Oe.id,{scheduledAppointment:Aa}),p("appointment-scheduled",{...Aa,calendarEventId:Da.id}),ye()}catch(pa){console.error("Failed to schedule/reschedule appointment:",pa)}}async function ce(){if(o.value)try{const y={...o.value,status:"confirmed"};if(o.value.id){const{updateCalendarEvent:d}=await Jt(async()=>{const{updateCalendarEvent:m}=await import("./users-CkqXh-gx.js").then(a=>a.i);return{updateCalendarEvent:m}},__vite__mapDeps([3,1,2]));await d(o.value.id,{status:"confirmed"})}await u.updateOpportunity(i.opportunity.id,{scheduledAppointment:y}),p("appointment-scheduled",y)}catch(y){console.error("Failed to confirm appointment:",y)}}const te=O(!1),K=O(!1),re=O(!1),xe=O(!1),De=O(""),Ge=O(null),z=O(null),X=O(null),Fe=O(null),Ee=O(!1),Re=O(!1),$e=O(null),Ae=O(""),j=O(null),W=O(null),oe=O(!1),G=O(null),P=O(!1),se=O(!1),le=O(!1),ke=O(!1),ge=O(!1),Le=O(!1),we=O({contractDate:"",contractTime:"",notes:""}),Ne=O({newDeadline:"",reason:""}),Pe=O(null),Ze=O(null),Je=$(()=>[{key:"schedule-appointment",label:"Schedule Appointment",onClick:()=>{P.value=!1,te.value=!0}}]),Ue=$(()=>[{key:"add-offer",label:"Add offer",handler:()=>ea()},{key:"extend-deadline",label:"Extend deadline",handler:()=>aa()},{key:"close-as-lost",label:"Close as Lost",handler:()=>{ge.value=!0}},{key:"schedule-appointment",label:"Schedule appointment",handler:()=>la()}]);function ue(y){}const ae=$(()=>{var d;const y=((d=o.value)==null?void 0:d.noShowCount)||0;return y===0&&re.value?(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning 1 (first no-show)"),1):(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning",y),y)});he([K,re,xe],([y,d,m])=>{console.log("[OpportunityManagementWidget] Section visibility changed:",{showRescheduleSection:y,showNsTaskSection:d,showOfferAssignmentSection:m,nsTaskCount:ae.value})});const be=$(()=>{var m;return((m={1:Ge,2:z,3:X}[ae.value].value)==null?void 0:m.canSubmit)||!1}),Se=$(()=>ae.value===3?"Close as Lost":"Assign and Save"),Ce=$(()=>{var y;return((y=Fe.value)==null?void 0:y.canSubmit)||!1}),Ve=$(()=>!opportunity.offers||opportunity.offers.length===0?[]:opportunity.offers.filter(y=>y.status==="active").map(y=>({id:y.id,label:`${y.vehicleBrand} ${y.vehicleModel} (${y.vehicleYear})`,price:y.price,value:y.id}))),Ke=$(()=>$e.value&&Ae.value.trim().length>0),Xe=O(!1),et=O(!1),nt=O(!1),lt=O(!1),xt=O(!1),He=O(!1),ot=O(!1),mt=O(!1),pt=O(!1),wt=O([]);function je(y){return y?new Intl.NumberFormat("en-US").format(y):"0"}function At(y){return y?new Date(y).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const ze={"schedule-appointment":()=>{te.value=!0},"manage-appointment":()=>{o.value&&(mt.value=!0)},"view-or-schedule-appointment":()=>{o.value?mt.value=!0:te.value=!0},reschedule:()=>{o.value&&(pt.value=!0)},"cancel-appointment":()=>{Kt()},"mark-no-show":()=>{Ms()},"select-vehicle":()=>{He.value=!0},"create-offer":()=>{!i.opportunity.selectedVehicle&&!i.opportunity.vehicle?He.value=!0:Xe.value=!0},"call-prospect":()=>{ot.value=!0},"follow-up-offer":()=>{ot.value=!0},"request-decision":()=>{ot.value=!0},"finalize-contract":()=>{nt.value=!0},"schedule-delivery":()=>{lt.value=!0},"confirm-delivery":()=>{lt.value=!0},"collect-feedback":()=>{ot.value=!0},reschedule:()=>{pt.value=!0},"cancel-appointment":()=>{Kt()},"close-won":()=>{nt.value=!0},"add-offer":()=>{Xe.value=!0},"add-contract":()=>{nt.value=!0},"extend-deadline":()=>{ot.value=!0},"close-lost":()=>{et.value=!0},reopen:()=>{St()},requalify:()=>{xt.value=!0}},_e=Cd(cs(i,"opportunity"),o,cs(i,"activities"),ze,At),me={isClosed:_e.isClosed,primaryAction:$(()=>k.value||o.value&&o.value.start&&(me.displayStage.value===Rs.APPOINTMENT_SCHEDULED||me.displayStage.value===Rs.AWAITING_APPOINTMENT)?null:_e.primaryAction.value),secondaryActions:_e.secondaryActions,activeTaskWidget:$(()=>{if(k.value)return null;const y=_e.activeTaskWidget.value;return y&&y.type==="NS"?null:y}),taskWidgetTitle:_e.taskWidgetTitle,displayStage:$(()=>{var d;const y=ds(i.opportunity,"opportunity");return y||console.warn("No display stage calculated for opportunity:",(d=i.opportunity)==null?void 0:d.id),y}),showDeadlineBanner:$(()=>{var y;return!_e.isClosed.value&&!!((y=i.opportunity)!=null&&y.nextActionDue)})},Tt=async y=>{var d;(d=i.opportunity)!=null&&d.id&&await u.fetchOpportunityById(i.opportunity.id)};function jt(){}function Be(y){He.value=!1,p("vehicle-selected",y),setTimeout(()=>{Xe.value=!0},300)}function it(y){Xe.value=!1,p("offer-created",y)}function Zt(y){te.value=!1,p("appointment-scheduled",{...y,opportunityId:i.opportunity.id,customer:i.opportunity.customer.name})}async function Kt(){if(o.value&&confirm("Are you sure you want to cancel this appointment?"))try{if(o.value.id){const{deleteCalendarEvent:y}=await Jt(async()=>{const{deleteCalendarEvent:d}=await import("./users-CkqXh-gx.js").then(m=>m.i);return{deleteCalendarEvent:d}},__vite__mapDeps([3,1,2]));await y(o.value.id)}await u.updateOpportunity(i.opportunity.id,{scheduledAppointment:null}),p("appointment-cancelled",o.value.id)}catch(y){console.error("Failed to cancel appointment:",y)}}function ft(y){nt.value=!1,u.updateOpportunity(i.opportunity.id,{stage:"Closed Won",contractDate:y.contractDate})}function rt(y){lt.value=!1,u.addActivity(i.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:y})}function kt(y){const d=typeof y=="string"?y:y.reason||y,m=typeof y=="object"?y.notes:"";et.value=!1,De.value="",u.updateOpportunity(i.opportunity.id,{stage:"Closed Lost",lossReason:d,lossNotes:m})}function St(){u.updateOpportunity(i.opportunity.id,{stage:"Qualified"})}function ws(y){xt.value=!1,r.push(`/customer/${y.id}?type=lead`)}function qe(y){mt.value=!1}function ut(y){pt.value=!1}function ks({opportunity:y,callbackDate:d}){u.updateOpportunity(y.id,{callbackDate:d})}function Ss({opportunity:y,assignee:d,note:m}){console.log("Opportunity assigned:",{opportunity:y,assignee:d,note:m})}function Ws(){var m;(m={1:Ge,2:z,3:X}[ae.value].value)==null||m.submit()}function Bt(){re.value=!1}async function Ps({opportunity:y,offerData:d}){var m,a,U,v,Q;try{if((m=o.value)!=null&&m.id){const{updateCalendarEvent:ie}=await Jt(async()=>{const{updateCalendarEvent:Te}=await import("./users-CkqXh-gx.js").then(Oe=>Oe.i);return{updateCalendarEvent:Te}},__vite__mapDeps([3,1,2]));await ie(o.value.id,{status:"completed"})}await u.addOffer(y.id,{vehicleBrand:((a=d.data)==null?void 0:a.brand)||"",vehicleModel:((U=d.data)==null?void 0:U.model)||"",vehicleYear:((v=d.data)==null?void 0:v.year)||"",price:((Q=d.data)==null?void 0:Q.price)||0,data:d.data}),xe.value=!1}catch(ie){console.error("Failed to create offer:",ie)}}function zs(){var y;(y=Fe.value)==null||y.submit()}function Wt(){xe.value=!1}function Cs(){console.log("[OpportunityManagementWidget] handleFollowUpOffer called"),K.value=!1,re.value=!1,xe.value=!1,Re.value=!1,Ee.value=!Ee.value,Ee.value||($e.value=null,Ae.value="",j.value=null)}function Ys(){console.log("[OpportunityManagementWidget] handleAddAnotherOffer called"),K.value=!1,re.value=!1,xe.value=!1,Ee.value=!1,Re.value=!Re.value}async function $s(y){var d;console.log("[OpportunityManagementWidget] handleOfferAccepted called",y);try{await u.markOfferAccepted(opportunity.id,y.id),await u.addActivity(opportunity.id,{type:"offer-acceptance",user:((d=h.currentUser)==null?void 0:d.name)||"You",action:"accepted offer",content:`Offer accepted: ${y.vehicleBrand} ${y.vehicleModel} (${y.vehicleYear}) - € ${y.price.toLocaleString()}`,data:{offerId:y.id},timestamp:new Date().toISOString()}),Ee.value=!1}catch(m){console.error("Failed to mark offer as accepted:",m)}}async function Xt(){var y,d;if(Ke.value){console.log("[OpportunityManagementWidget] handleSendNegotiationMessage called",{channel:$e.value,message:Ae.value,offerId:j.value});try{const m=(y=opportunity.offers)==null?void 0:y.find(U=>U.id===j.value),a=m?`${m.vehicleBrand} ${m.vehicleModel} (€${m.price.toLocaleString()})`:"offer";await u.addActivity(opportunity.id,{type:$e.value,user:((d=h.currentUser)==null?void 0:d.name)||"You",action:`sent ${$e.value}`,content:Ae.value,data:{channel:$e.value,offerId:j.value,offerReference:a},timestamp:new Date().toISOString()}),Ee.value=!1,$e.value=null,Ae.value="",j.value=null}catch(m){console.error("Failed to send negotiation message:",m)}}}function Pt(){Ee.value=!1,$e.value=null,Ae.value="",j.value=null}const zt=$(()=>{var y;return((y=W.value)==null?void 0:y.isValid)||!1});async function Ds(y){var d,m,a,U,v,Q,ie,Te,Oe;console.log("[OpportunityManagementWidget] handleInlineOfferCreated called",y);try{await u.addOffer(opportunity.id,{vehicleBrand:((d=y.data)==null?void 0:d.brand)||"",vehicleModel:((m=y.data)==null?void 0:m.model)||"",vehicleYear:((a=y.data)==null?void 0:a.year)||"",price:((U=y.data)==null?void 0:U.price)||0,data:y.data}),await u.addActivity(opportunity.id,{type:"offer",user:((v=h.currentUser)==null?void 0:v.name)||"You",action:"created an offer",content:`Offer created: ${(Q=y.data)==null?void 0:Q.brand} ${(ie=y.data)==null?void 0:ie.model} (${(Te=y.data)==null?void 0:Te.year}) - € ${(((Oe=y.data)==null?void 0:Oe.price)||0).toLocaleString()}`,data:y.data,timestamp:new Date().toISOString()}),Re.value=!1}catch(bt){console.error("Failed to create offer:",bt)}}function es(){W.value&&W.value.submit()}function As(){Re.value=!1,W.value}const Hs=$(()=>{var y;return((y=G.value)==null?void 0:y.isValid)||!1});async function Qs(y){var d,m,a,U,v;console.log("[OpportunityManagementWidget] handleSurveySubmit called",y);try{const Q=S(),{responses:ie,triggerActions:Te}=y;await u.addActivity(Q.id,{type:"post-delivery-survey",user:((d=h.currentUser)==null?void 0:d.name)||"You",action:"completed post-delivery customer satisfaction survey",content:"Post-Delivery Customer Satisfaction Survey completed",data:{responses:ie,triggerActions:Te,timestamp:y.timestamp},timestamp:y.timestamp});const Oe=[];Te.negativeSatisfaction&&Oe.push(u.addActivity(Q.id,{type:"survey-trigger",user:((m=h.currentUser)==null?void 0:m.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager + Branch Manager (Negative satisfaction)",data:{trigger:"negative-satisfaction",recipients:["Sales Manager","Branch Manager"],surveyResponse:ie.q1},timestamp:new Date().toISOString()})),Te.issuesReported&&Oe.push(u.addActivity(Q.id,{type:"survey-trigger",user:((a=h.currentUser)==null?void 0:a.name)||"You",action:"triggered email notification",content:"Email sent to Service Department (Issues reported)",data:{trigger:"issues-reported",recipients:["Service Department"],issueDescription:ie.q3},timestamp:new Date().toISOString()})),Te.deliveryDelay&&Oe.push(u.addActivity(Q.id,{type:"survey-trigger",user:((U=h.currentUser)==null?void 0:U.name)||"You",action:"triggered email notification",content:"Email sent to Delivery Coordinator (Major delivery delay)",data:{trigger:"delivery-delay",recipients:["Delivery Coordinator"],surveyResponse:ie.q4},timestamp:new Date().toISOString()})),Te.highNPS&&Oe.push(u.addActivity(Q.id,{type:"survey-trigger",user:((v=h.currentUser)==null?void 0:v.name)||"You",action:"triggered email notification",content:"Email sent to Marketing (High NPS - Definitely Yes)",data:{trigger:"high-nps",recipients:["Marketing"],surveyResponse:ie.q7},timestamp:new Date().toISOString()})),await Promise.all(Oe),oe.value=!1}catch(Q){console.error("Failed to submit survey:",Q)}}function tt(){G.value&&G.value.submit()}function vt(){oe.value=!1}const Js=$(()=>new Date().toISOString().split("T")[0]),Gs=$(()=>{const y=new Date;return y.setDate(y.getDate()+1),y.toISOString().split("T")[0]}),Ts=$(()=>!!we.value.contractDate),Os=$(()=>!!Ne.value.newDeadline),Zs=$(()=>{var y;return((y=Pe.value)==null?void 0:y.isValid)||!1});function Ks(){if(le.value=!1,ke.value=!1,Le.value=!1,se.value=!se.value,se.value&&!we.value.contractDate){const y=new Date;we.value.contractDate=y.toISOString().split("T")[0],we.value.contractTime=y.toTimeString().slice(0,5)}}function Is(){se.value=!1,we.value={contractDate:"",contractTime:"",notes:""}}async function Xs(){var y;if(Ts.value)try{const d=S(),m=we.value.contractTime?`${we.value.contractDate}T${we.value.contractTime}:00`:`${we.value.contractDate}T12:00:00`;await u.updateOpportunity(d.id,{contractDate:m,contractNotes:we.value.notes}),await u.addActivity(d.id,{type:"contract",user:((y=h.currentUser)==null?void 0:y.name)||"You",action:"set contract signing date",content:`Contract date set: ${new Date(m).toLocaleString()}`,data:{contractDate:m,notes:we.value.notes},timestamp:new Date().toISOString()}),Is()}catch(d){console.error("Failed to set contract date:",d)}}function ea(){se.value=!1,ke.value=!1,Le.value=!1,le.value=!le.value}function Yt(){le.value=!1}function ta(){Pe.value&&Pe.value.submit()}async function sa(y){var d,m,a,U,v,Q,ie,Te,Oe;try{const bt=S();await u.addOffer(bt.id,{vehicleBrand:((d=y.data)==null?void 0:d.brand)||"",vehicleModel:((m=y.data)==null?void 0:m.model)||"",vehicleYear:((a=y.data)==null?void 0:a.year)||"",price:((U=y.data)==null?void 0:U.price)||0,data:y.data}),await u.addActivity(bt.id,{type:"offer",user:((v=h.currentUser)==null?void 0:v.name)||"You",action:"created an offer",content:`Offer created: ${(Q=y.data)==null?void 0:Q.brand} ${(ie=y.data)==null?void 0:ie.model} (${(Te=y.data)==null?void 0:Te.year}) - € ${(((Oe=y.data)==null?void 0:Oe.price)||0).toLocaleString()}`,data:y.data,timestamp:new Date().toISOString()}),le.value=!1}catch(bt){console.error("Failed to create offer:",bt)}}function aa(){if(se.value=!1,le.value=!1,Le.value=!1,ke.value=!ke.value,ke.value&&!Ne.value.newDeadline){const y=new Date;y.setDate(y.getDate()+1),Ne.value.newDeadline=y.toISOString().split("T")[0]}}function Ns(){ke.value=!1,Ne.value={newDeadline:"",reason:""}}async function na(){var y;if(Os.value)try{const d=S();await u.updateOpportunity(d.id,{deadline:Ne.value.newDeadline,deadlineExtensionReason:Ne.value.reason}),await u.addActivity(d.id,{type:"deadline-extension",user:((y=h.currentUser)==null?void 0:y.name)||"You",action:"extended deadline",content:`Deadline extended to ${new Date(Ne.value.newDeadline).toLocaleDateString()}`,data:{newDeadline:Ne.value.newDeadline,reason:Ne.value.reason},timestamp:new Date().toISOString()}),Ns()}catch(d){console.error("Failed to extend deadline:",d)}}function la(){se.value=!1,le.value=!1,ke.value=!1,Le.value=!Le.value}function Vs(){Le.value=!1}async function oa(y){var ns,ls,os;const{eventType:d,selectedDate:m,selectedSlot:a,selectedTeam:U,selectedSalesman:v,durationValue:Q,communicationPreferences:ie}=y,Te=S(),Oe=m,[bt,ma]=a.split(":").map(Number),Ht=new Date(Oe);Ht.setHours(bt,ma,0,0);const Ct=Q||30,Lt=new Date(Ht.getTime()+Ct*6e4),ts=(v==null?void 0:v.name)||(U==null?void 0:U.name)||Te.assignee||"Unassigned",ss=(v==null?void 0:v.id)||(U==null?void 0:U.id)||null,as=v?"user":"team";try{const Qt={customerId:Te.customerId||((ns=Te.customer)==null?void 0:ns.id),customer:((ls=Te.customer)==null?void 0:ls.name)||"Unknown",start:Ht.toISOString(),end:Lt.toISOString(),type:d,title:`${d} - ${((os=Te.customer)==null?void 0:os.name)||"Customer"}`,assigneeId:ss,assigneeType:as,teamId:(U==null?void 0:U.id)||null,team:(U==null?void 0:U.name)||null,salesperson:(v==null?void 0:v.name)||null,salespersonId:(v==null?void 0:v.id)||null,duration:Ct,opportunityId:Te.id},is=await va(Qt),rs={id:is.id,start:Ht.toISOString(),end:Lt.toISOString(),type:d,assignee:ts,assigneeId:ss,assigneeType:as,duration:Ct,team:(U==null?void 0:U.name)||null,teamId:(U==null?void 0:U.id)||null,salesperson:(v==null?void 0:v.name)||null,salespersonId:(v==null?void 0:v.id)||null,communications:ie,status:"confirmed"};await u.updateOpportunity(Te.id,{scheduledAppointment:rs}),p("appointment-scheduled",{...rs,calendarEventId:is.id}),Vs()}catch(Qt){console.error("Failed to schedule appointment:",Qt)}}function ia(y){const d=typeof y=="string"?y:y.reason||y,m=typeof y=="object"?y.notes:"";ge.value=!1,u.updateOpportunity(i.opportunity.id,{stage:"Closed Lost",lossReason:d,lossNotes:m})}function ra(){!o.value||!o.value.start||(K.value=!0,re.value=!1,xe.value=!1)}function Ms(){var y,d;if(console.log("[OpportunityManagementWidget] handleMarkNoShow called",{hasAppointment:!!o.value,appointmentStatus:(y=o.value)==null?void 0:y.status,noShowCount:(d=o.value)==null?void 0:d.noShowCount}),!o.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,xe.value=!1,re.value=!0,console.log("[OpportunityManagementWidget] Set showNsTaskSection to true"),o.value.status!=="no-show"&&(console.log("[OpportunityManagementWidget] Calling updateAppointmentToNoShow"),ua())}function qs(){var y;if(console.log("[OpportunityManagementWidget] handleMarkShowedUp called",{hasAppointment:!!o.value,appointmentStatus:(y=o.value)==null?void 0:y.status}),!o.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,re.value=!1,xe.value=!0,console.log("[OpportunityManagementWidget] Set showOfferAssignmentSection to true")}async function ua(){var y;if(o.value)try{const m=(o.value.noShowCount||0)+1,a=m===1?"NS1":m===2?"NS2":"NS3";if(o.value.id){const{updateCalendarEvent:v}=await Jt(async()=>{const{updateCalendarEvent:Q}=await import("./users-CkqXh-gx.js").then(ie=>ie.i);return{updateCalendarEvent:Q}},__vite__mapDeps([3,1,2]));await v(o.value.id,{status:"no-show"})}const U={...o.value,status:"no-show",noShowCount:m};await u.updateOpportunity(i.opportunity.id,{scheduledAppointment:U}),await u.addActivity(i.opportunity.id,{type:"ns-task",user:((y=h.currentUser)==null?void 0:y.name)||"You",action:`${a} - marked appointment as no-show`,content:`${a}: Appointment on ${new Date(o.value.start).toLocaleString()} marked as no-show. This is the ${m===1?"first":m===2?"second":"third"} no-show.`,data:{appointmentId:o.value.id,noShowCount:m,nsLabel:a},timestamp:new Date().toISOString()}),p("appointment-no-show",{appointmentId:o.value.id,noShowCount:m,nsLabel:a})}catch(d){console.error("Failed to mark appointment as no-show:",d)}}function da({opportunity:y,reason:d}){et.value=!0}async function ca({opportunity:y,reason:d}){var m;re.value=!1,await u.updateOpportunity(y.id,{stage:"Closed Lost",lossReason:d}),await u.addActivity(y.id,{type:"close-lost",user:((m=h.currentUser)==null?void 0:m.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${d||"N/A"}`,data:{reason:d},timestamp:new Date().toISOString()})}function Ls(y){if(y&&y.handler)y.handler();else if(y&&y.key){const d=ze[y.key];d&&d()}}return hs(async()=>{try{const d=(await Un({})).data||[];wt.value=d.filter(m=>m.stockDays!==null&&m.stockDays!==void 0).slice(0,5)}catch(y){console.error("Failed to load recommended cars:",y),wt.value=[]}o.value&&o.value.status==="no-show"&&(re.value=!0)}),(y,d)=>{const m=Ea("click-outside");return f(),D(Me,null,[s(Ya,{task:n.opportunity,"hide-title":"","hide-border":""},{"deadline-banner":l(()=>[me.isClosed.value?_("",!0):(f(),de(Za,{key:0,"next-action-due":n.opportunity.nextActionDue,"show-deadline-banner":me.showDeadlineBanner.value,"task-id":n.opportunity.id},null,8,["next-action-due","show-deadline-banner","task-id"]))]),"primary-action":l(()=>{var a,U;return[me.isClosed.value?_("",!0):(f(),de(Qa,{key:0,task:n.opportunity,"task-type":"opportunity",onReassigned:Tt,class:"mb-3"},null,8,["task"])),!me.isClosed.value&&o.value&&o.value.start?(f(),D("div",km,[e("div",Sm,[e("div",Cm,[e("div",$m,[e("div",Dm,[d[30]||(d[30]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Appointment",-1)),e("p",Am," Appointment scheduled for "+N((a=o.value)!=null&&a.start?At(o.value.start):"TBD"),1)]),e("div",Tm,[((U=o.value)==null?void 0:U.status)==="pending_confirmation"?(f(),de(t(ee),{key:0,variant:"outline",onClick:ce,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700 cursor-pointer"},{default:l(()=>[...d[31]||(d[31]=[e("i",{class:"fa-solid fa-calendar-check"},null,-1),e("span",null,"Confirm appointment",-1)])]),_:1})):_("",!0),s(t(ee),{variant:"outline",onClick:ra,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",K.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:l(()=>[...d[32]||(d[32]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),e("span",null,"Reschedule",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:Ms,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",re.value?"border-orange-500 bg-orange-50 text-orange-700":""])},{default:l(()=>[...d[33]||(d[33]=[e("i",{class:"fa-solid fa-user-slash"},null,-1),e("span",null,"Mark as No-Show",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:qs,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",xe.value?"border-green-500 bg-green-50 text-green-700":""])},{default:l(()=>[...d[34]||(d[34]=[e("i",{class:"fa-solid fa-user-check"},null,-1),e("span",null,"Mark as Showed Up",-1)])]),_:1},8,["class"]),me.secondaryActions.value&&me.secondaryActions.value.length>0?(f(),de(ga,{key:1,actions:me.secondaryActions.value,onActionSelected:Ls},null,8,["actions"])):_("",!0)])])])]),s(dt,{name:"expand"},{default:l(()=>[K.value?(f(),D("div",Om,[s(ya,{ref_key:"scheduleFormRef",ref:ne,opportunity:n.opportunity,mode:"reschedule","initial-appointment":o.value,onSubmit:d[0]||(d[0]=v=>Ie(v,"reschedule")),onCancel:H},null,8,["opportunity","initial-appointment"])])):_("",!0)]),_:1}),s(dt,{name:"expand"},{default:l(()=>[re.value?(f(),D("div",Im,[ae.value===1?(f(),de($c,{key:0,ref_key:"ns1TaskRef",ref:Ge,opportunity:n.opportunity,"scheduled-appointment":o.value,onAssigned:Ss,onCancel:Bt},null,8,["opportunity","scheduled-appointment"])):ae.value===2?(f(),de(Uc,{key:1,ref_key:"ns2TaskRef",ref:z,opportunity:n.opportunity,"scheduled-appointment":o.value,onAssigned:Ss,onCancel:Bt},null,8,["opportunity","scheduled-appointment"])):ae.value>=3?(f(),de(Bc,{key:2,ref_key:"ns3TaskRef",ref:X,opportunity:n.opportunity,"scheduled-appointment":o.value,onCloseAsLost:ca,onCancel:Bt},null,8,["opportunity","scheduled-appointment"])):_("",!0)])):_("",!0)]),_:1}),re.value?(f(),D("div",Nm,[s(t(ee),{variant:"secondary",onClick:Bt},{default:l(()=>[...d[35]||(d[35]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!be.value,onClick:Ws,class:"bg-primary"},{default:l(()=>[I(N(Se.value),1)]),_:1},8,["disabled"])])):_("",!0),s(dt,{name:"expand"},{default:l(()=>[xe.value?(f(),D("div",Vm,[s(zc,{ref_key:"offerAssignmentTaskRef",ref:Fe,opportunity:n.opportunity,"scheduled-appointment":o.value,onOfferCreated:Ps,onCancel:Wt},null,8,["opportunity","scheduled-appointment"])])):_("",!0)]),_:1}),xe.value?(f(),D("div",Mm,[s(t(ee),{variant:"secondary",onClick:Wt},{default:l(()=>[...d[36]||(d[36]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Ce.value,onClick:zs,class:"bg-primary"},{default:l(()=>[...d[37]||(d[37]=[I(" Create Offer ",-1)])]),_:1},8,["disabled"])])):_("",!0)])):_("",!0),!me.isClosed.value&&n.opportunity.stage==="In Negotiation"&&n.opportunity.negotiationSubstatus!=="Offer Accepted"&&n.opportunity.offers&&n.opportunity.offers.length>0?(f(),D("div",qm,[e("div",Lm,[e("div",_m,[e("div",Um,[e("div",Fm,[d[38]||(d[38]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Offers & Follow Up",-1)),e("p",Em,N(n.opportunity.negotiationSubstatus==="Offer Feedback"?"Request feedback on pending offers":"Follow up with customer about offers"),1)]),e("div",Rm,[s(Xa,{offers:n.opportunity.offers,"opportunity-id":n.opportunity.id,onOfferAccepted:$s},null,8,["offers","opportunity-id"])]),e("div",jm,[s(t(ee),{variant:"outline",onClick:Cs,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",Ee.value?"border-yellow-500 bg-yellow-50 text-yellow-700":""])},{default:l(()=>[d[39]||(d[39]=e("i",{class:"fa-solid fa-phone-volume"},null,-1)),e("span",null,N(n.opportunity.negotiationSubstatus==="Offer Feedback"?"Request Feedback":"Follow Up"),1)]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:Ys,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",Re.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:l(()=>[...d[40]||(d[40]=[e("i",{class:"fa-solid fa-plus"},null,-1),e("span",null,"Add Offer",-1)])]),_:1},8,["class"]),me.secondaryActions.value&&me.secondaryActions.value.length>0?(f(),de(ga,{key:0,actions:me.secondaryActions.value,onActionSelected:Ls},null,8,["actions"])):_("",!0)])])])]),s(dt,{name:"expand"},{default:l(()=>[Ee.value?(f(),D("div",Bm,[e("div",Wm,[d[47]||(d[47]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",Pm,[s(t(ee),{variant:"outline",onClick:d[1]||(d[1]=v=>$e.value="call"),class:Z(["flex items-center justify-center gap-2",$e.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...d[41]||(d[41]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:d[2]||(d[2]=v=>$e.value="whatsapp"),class:Z(["flex items-center justify-center gap-2",$e.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...d[42]||(d[42]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:d[3]||(d[3]=v=>$e.value="sms"),class:Z(["flex items-center justify-center gap-2",$e.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...d[43]||(d[43]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(ee),{variant:"outline",onClick:d[4]||(d[4]=v=>$e.value="email"),class:Z(["flex items-center justify-center gap-2",$e.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:l(()=>[...d[44]||(d[44]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),$e.value?(f(),D("div",zm,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[45]||(d[45]=[I("Select offer to reference",-1)])]),_:1}),s(t(Ye),{modelValue:j.value,"onUpdate:modelValue":d[5]||(d[5]=v=>j.value=v),items:Ve.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:l(({item:v})=>[e("div",Ym,[e("span",null,N(v.label),1),e("span",Hm,"€ "+N(je(v.price)),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[46]||(d[46]=[I("Message",-1)])]),_:1}),s(t(at),{modelValue:Ae.value,"onUpdate:modelValue":d[6]||(d[6]=v=>Ae.value=v),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):_("",!0)])])):_("",!0)]),_:1}),Ee.value?(f(),D("div",Qm,[s(t(ee),{variant:"secondary",onClick:Pt},{default:l(()=>[...d[48]||(d[48]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Ke.value,onClick:Xt,class:"bg-primary"},{default:l(()=>[...d[49]||(d[49]=[I(" Send Message ",-1)])]),_:1},8,["disabled"])])):_("",!0),s(dt,{name:"expand"},{default:l(()=>[Re.value?(f(),D("div",Jm,[e("div",Gm,[s(Bs,{ref_key:"addOfferWidgetRef",ref:W,"task-id":n.opportunity.id,"task-type":"opportunity",customer:n.opportunity.customer,"selected-vehicle":n.opportunity.selectedVehicle||n.opportunity.vehicle||n.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:Ds,onCancel:As},null,8,["task-id","customer","selected-vehicle"])])])):_("",!0)]),_:1}),Re.value?(f(),D("div",Zm,[s(t(ee),{variant:"secondary",onClick:As},{default:l(()=>[...d[50]||(d[50]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!zt.value,onClick:es,class:"bg-primary"},{default:l(()=>[...d[51]||(d[51]=[I(" Create Offer ",-1)])]),_:1},8,["disabled"])])):_("",!0)])):_("",!0),!me.isClosed.value&&n.opportunity.stage==="In Negotiation"&&(n.opportunity.negotiationSubstatus==="Offer Accepted"||me.displayStage.value==="In Negotiation - Contract Pending")?(f(),D("div",Km,[e("div",Xm,[e("div",ep,[e("div",tp,[d[53]||(d[53]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Collect e-signatures, finalize contract"),e("p",{class:"text-sm text-body mt-0.5"}," Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs. ")],-1)),e("div",sp,[s(t(ee),{variant:"outline",onClick:Ks,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",se.value?"border-emerald-500 bg-emerald-50 text-emerald-700":""])},{default:l(()=>[...d[52]||(d[52]=[e("i",{class:"fa-solid fa-file-signature"},null,-1),e("span",null,"Collect Signatures",-1)])]),_:1},8,["class"]),s(ga,{actions:Ue.value,onActionSelected:ue},null,8,["actions"])])])])]),s(dt,{name:"expand"},{default:l(()=>[se.value?(f(),D("div",ap,[e("div",np,[d[57]||(d[57]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Set Contract Signing Date",-1)),e("div",lp,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[54]||(d[54]=[I("Contract Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(st),{type:"date",modelValue:we.value.contractDate,"onUpdate:modelValue":d[7]||(d[7]=v=>we.value.contractDate=v),max:Js.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[55]||(d[55]=[I("Time (Optional)",-1)])]),_:1}),s(t(st),{type:"time",modelValue:we.value.contractTime,"onUpdate:modelValue":d[8]||(d[8]=v=>we.value.contractTime=v),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[56]||(d[56]=[I("Notes (Optional)",-1)])]),_:1}),s(t(at),{modelValue:we.value.notes,"onUpdate:modelValue":d[9]||(d[9]=v=>we.value.notes=v),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full"},null,8,["modelValue"])])])]),e("div",op,[s(t(ee),{variant:"secondary",onClick:Is},{default:l(()=>[...d[58]||(d[58]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Ts.value,onClick:Xs,class:"bg-primary"},{default:l(()=>[...d[59]||(d[59]=[I(" Set Contract Date ",-1)])]),_:1},8,["disabled"])])])):_("",!0)]),_:1}),s(dt,{name:"expand"},{default:l(()=>[le.value?(f(),D("div",ip,[e("div",rp,[s(Bs,{ref_key:"addOfferContractPendingRef",ref:Pe,"task-id":n.opportunity.id,"task-type":"opportunity",customer:n.opportunity.customer,"selected-vehicle":n.opportunity.selectedVehicle||n.opportunity.vehicle||n.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:sa,onCancel:Yt},null,8,["task-id","customer","selected-vehicle"])])])):_("",!0)]),_:1}),le.value?(f(),D("div",up,[s(t(ee),{variant:"secondary",onClick:Yt},{default:l(()=>[...d[60]||(d[60]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Zs.value,onClick:ta,class:"bg-primary"},{default:l(()=>[...d[61]||(d[61]=[I(" Create Offer ",-1)])]),_:1},8,["disabled"])])):_("",!0),s(dt,{name:"expand"},{default:l(()=>[ke.value?(f(),D("div",dp,[e("div",cp,[d[64]||(d[64]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Extend Deadline",-1)),e("div",mp,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[62]||(d[62]=[I("New Deadline Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(st),{type:"date",modelValue:Ne.value.newDeadline,"onUpdate:modelValue":d[10]||(d[10]=v=>Ne.value.newDeadline=v),min:Gs.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:l(()=>[...d[63]||(d[63]=[I("Reason (Optional)",-1)])]),_:1}),s(t(at),{modelValue:Ne.value.reason,"onUpdate:modelValue":d[11]||(d[11]=v=>Ne.value.reason=v),rows:"3",placeholder:"Reason for extending the deadline...",class:"w-full"},null,8,["modelValue"])])])]),e("div",pp,[s(t(ee),{variant:"secondary",onClick:Ns},{default:l(()=>[...d[65]||(d[65]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Os.value,onClick:na,class:"bg-primary"},{default:l(()=>[...d[66]||(d[66]=[I(" Extend Deadline ",-1)])]),_:1},8,["disabled"])])])):_("",!0)]),_:1}),s(dt,{name:"expand"},{default:l(()=>[Le.value?(f(),D("div",fp,[s(ya,{ref_key:"scheduleAppointmentContractPendingFormRef",ref:Ze,opportunity:n.opportunity,mode:"schedule",onSubmit:d[12]||(d[12]=v=>oa(v)),onCancel:Vs},null,8,["opportunity"])])):_("",!0)]),_:1})])):!me.isClosed.value&&me.primaryAction.value?(f(),de(Ha,{key:4,action:me.primaryAction.value,"color-scheme":me.primaryAction.value.colorScheme,onActionClicked:me.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):_("",!0)]}),"task-widgets":l(()=>[k.value?(f(),D("div",vp,[n.opportunity.assignmentNote?(f(),D("div",gp,[e("div",yp,[d[68]||(d[68]=e("i",{class:"fa-solid fa-sticky-note text-blue-600 text-sm mt-0.5"},null,-1)),e("div",bp,[d[67]||(d[67]=e("h5",{class:"font-semibold text-heading text-sm mb-1"},"Note from Assigner",-1)),e("p",hp,N(n.opportunity.assignmentNote),1)])])])):_("",!0),e("div",xp,[e("div",wp,[e("div",kp,[e("div",Sp,[d[69]||(d[69]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Call to Schedule Appointment"),e("p",{class:"text-sm text-body mt-0.5"}," Contact the customer to schedule an appointment ")],-1)),s(Ga,{"is-call-active":t(g),"call-ended":t(x),"call-duration":t(V),"call-notes":t(C),"formatted-call-duration":t(F),"mock-transcription":t(R),"contact-attempts":0,"max-contact-attempts":3,onStartCall:L,onEndCall:T,onLogManualCall:Y,onExtractInformation:d[13]||(d[13]=a=>ot.value=!0),"onUpdate:callNotes":B,onCopyNumber:q},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription"])])])]),e("div",Cp,[s(ya,{ref_key:"scheduleFormRef",ref:ne,opportunity:n.opportunity,mode:"schedule",onSubmit:d[14]||(d[14]=a=>Ie(a,"schedule")),onCancel:ye},null,8,["opportunity"])])])])):_("",!0),c.value?(f(),D("div",$p,[e("div",Dp,[e("div",Ap,[e("div",Tp,[d[73]||(d[73]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Post-Delivery Customer Satisfaction Survey"),e("p",{class:"text-sm text-body mt-0.5"}," Collect feedback from the customer about their delivery experience ")],-1)),e("div",Op,[s(t(ee),{variant:"outline",onClick:d[15]||(d[15]=a=>oe.value=!oe.value),class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors cursor-pointer",oe.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:l(()=>[...d[70]||(d[70]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["class"]),A.value?(f(),de(t(ee),{key:0,variant:"outline",onClick:St,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700 hover:bg-green-100 cursor-pointer"},{default:l(()=>[...d[71]||(d[71]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),e("span",null,"Reopen Opportunity",-1)])]),_:1})):_("",!0),e("div",Ip,[e("button",{onClick:d[16]||(d[16]=Sa(a=>P.value=!P.value,["stop"])),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap cursor-pointer"},[d[72]||(d[72]=e("span",null,"More actions",-1)),e("i",{class:Z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":P.value}])},null,2)]),P.value&&Je.value.length>0?Qe((f(),D("div",Np,[s(t(La),{items:Je.value,className:"w-56"},null,8,["items"])])),[[m,()=>P.value=!1]]):_("",!0)])])])])]),s(dt,{name:"expand"},{default:l(()=>[oe.value?(f(),D("div",Vp,[s(wm,{ref_key:"postDeliverySurveyRef",ref:G,opportunity:n.opportunity,onSubmit:Qs,onCancel:d[17]||(d[17]=a=>oe.value=!1)},null,8,["opportunity"]),e("div",Mp,[s(t(ee),{variant:"secondary",onClick:vt},{default:l(()=>[...d[74]||(d[74]=[I(" Cancel ",-1)])]),_:1}),s(t(ee),{variant:"primary",disabled:!Hs.value,onClick:tt,class:"bg-primary"},{default:l(()=>[...d[75]||(d[75]=[I(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])):_("",!0)]),_:1})])):me.activeTaskWidget.value&&me.activeTaskWidget.value.component?(f(),D("div",qp,[e("div",Lp,[d[76]||(d[76]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",_p,N(me.taskWidgetTitle.value),1)]),(f(),de(xa(me.activeTaskWidget.value.component),ha(me.activeTaskWidget.value.props,{onClose:jt,onSetCallback:ks,onAutoCloseLost:da}),null,16))])):_("",!0)]),"secondary-actions":l(()=>[...d[77]||(d[77]=[])]),_:1},8,["task"]),te.value?(f(),de(Wa,{key:0,show:te.value,customer:n.opportunity.customer,assignee:n.opportunity.assignee,"disabled-fields":["customer"],onCreate:Zt,onCancel:d[18]||(d[18]=a=>te.value=!1)},null,8,["show","customer","assignee"])):_("",!0),He.value?(f(),de(Ln,{key:1,opportunity:n.opportunity,"requested-car":n.opportunity.requestedCar,"recommended-cars":wt.value,onVehicleSelected:Be,onClose:d[19]||(d[19]=a=>He.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):_("",!0),Xe.value?(f(),de(Bs,{key:2,opportunity:n.opportunity,vehicle:n.opportunity.selectedVehicle||n.opportunity.vehicle||n.opportunity.requestedCar,onOfferCreated:it,onClose:d[20]||(d[20]=a=>Xe.value=!1)},null,8,["opportunity","vehicle"])):_("",!0),nt.value?(f(),de(Vd,{key:3,opportunity:n.opportunity,onContractSet:ft,onClose:d[21]||(d[21]=a=>nt.value=!1)},null,8,["opportunity"])):_("",!0),lt.value?(f(),de(Fd,{key:4,opportunity:n.opportunity,onDelivered:rt,onClose:d[22]||(d[22]=a=>lt.value=!1)},null,8,["opportunity"])):_("",!0),et.value?(f(),de(qa,{key:5,opportunity:n.opportunity,"preselected-reason":De.value,onConfirm:kt,onCancel:d[23]||(d[23]=a=>{et.value=!1,De.value=""})},null,8,["opportunity","preselected-reason"])):_("",!0),ge.value?(f(),de(qa,{key:6,opportunity:n.opportunity,onConfirm:ia,onCancel:d[24]||(d[24]=a=>ge.value=!1)},null,8,["opportunity"])):_("",!0),xt.value?(f(),de(Bd,{key:7,opportunity:n.opportunity,onRequalified:ws,onClose:d[25]||(d[25]=a=>xt.value=!1)},null,8,["opportunity"])):_("",!0),ot.value?(f(),de(Ca,{key:8,onClose:d[26]||(d[26]=a=>ot.value=!1)})):_("",!0),mt.value&&o.value?(f(),de(Fn,{key:9,show:mt.value,event:o.value,onClose:d[27]||(d[27]=a=>mt.value=!1),onEdit:d[28]||(d[28]=a=>{mt.value=!1,pt.value=!0}),onDelete:qe},null,8,["show","event"])):_("",!0),pt.value&&o.value?(f(),de(En,{key:10,show:pt.value,event:o.value,customer:n.opportunity.customer,"disabled-fields":["customer"],onSave:ut,onCancel:d[29]||(d[29]=a=>pt.value=!1)},null,8,["show","event","customer"])):_("",!0)],64)}}},Fp=Et(Up,[["__scopeId","data-v-b11a8376"]]);function Kp(n){const M=Rt(),i=Mt(),p=$(()=>n.value?n.value.type==="lead"?du:Fp:null),r=$(()=>n.value?n.value.type==="lead"?{currentActivities:$(()=>M.currentLeadActivities),addActivity:(h,b)=>M.addActivity(h,b),updateActivity:(h,b,S)=>M.updateActivity(h,b,S),deleteActivity:(h,b)=>M.deleteActivity(h,b),updateLead:(h,b)=>M.updateLead(h,b),loadLeadById:h=>M.fetchLeadById(h)}:{currentActivities:$(()=>i.currentOpportunityActivities),addActivity:(h,b)=>i.addActivity(h,b),updateActivity:(h,b,S)=>i.updateActivity(h,b,S),deleteActivity:(h,b)=>i.deleteActivity(h,b),addVehicle:(h,b)=>i.addVehicle(h,b),createOffer:(h,b)=>i.createOffer(h,b),updateOpportunity:(h,b)=>i.updateOpportunity(h,b),loadOpportunityById:h=>i.fetchOpportunityById(h)}:null),u=$(()=>n.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:p,storeAdapter:r,addNewConfig:u}}function Xp(n){const M=Rt(),i=Mt(),p=Dt(),r=$(()=>{const w=(n.value?M.leads:M.leads.filter(V=>!V.isDisqualified)).map(V=>{const C=ds(V,"lead"),R={...V,type:"lead",compositeId:`lead-${V.id}`,displayStage:C};return!R.customer&&V.customer&&(R.customer=V.customer),R}),g=i.opportunities.map(V=>{const C=ds(V,"opportunity"),R={...V,type:"opportunity",compositeId:`opportunity-${V.id}`,displayStage:C};return!R.customer&&V.customer&&(R.customer=V.customer),R});let x=[];return p.isOperator()?x=w:p.isSalesman()?x=g:x=[...w,...g],x}),u=(c,w)=>!w||w.length===0?c:Array.isArray(w)?c.filter(g=>w.includes(g.type)):w==="all"?c:c.filter(g=>g.type===w),h=c=>{const w=new Date,g=new Date(w.getTime()+24*60*60*1e3);return c.filter(x=>{if(!x.nextActionDue)return!1;const V=new Date(x.nextActionDue);return V>=w&&V<=g})},b=c=>c.filter(w=>w.nextActionDue!=null),S=c=>{const w=new Date(Date.now()-36e5);return c.filter(g=>g.type!=="lead"||!g.createdAt?!1:new Date(g.createdAt)>=w)},o=c=>{var g;const w=(g=p.currentUser)==null?void 0:g.name;return w?c.filter(x=>x.assignee===w):[]},k=(c,w)=>{if(!w||w.length===0)return c;let g=[...c];const x=w.filter(V=>V==="lead"||V==="opportunity");return x.length>0&&(g=u(g,x)),w.forEach(V=>{switch(V){case"due-in-24h":g=h(g);break;case"to-be-called":g=b(g);break;case"leads-1h":g=S(g);break;case"assigned-to-me":g=o(g);break}}),g},A=$(()=>{const c=r.value.some(g=>g.type==="lead"),w=r.value.some(g=>g.type==="opportunity");return c&&w});return{allTasks:r,filterByType:u,filterByDueIn24Hours:h,filterByToBeCalled:b,filterByLeadsCreated1Hour:S,filterByAssignedToMe:o,applyFilters:k,shouldShowTypeFilter:A}}export{Zp as D,Gp as T,Kp as a,Xp as u};
