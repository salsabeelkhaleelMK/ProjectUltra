import{u as H,a as V,r as k,c as S,f as Q,b as E,d as a,o as n,e as t,n as O,t as g,g as v,F as I,h as q,i as R,j as M,w as j,k as Y,l as L,m as w,p as B,q as z,s as F,v as J}from"./index-DhXdPUMX.js";import{f as P,a as G}from"./calendar-MUepbrBz.js";import{u as W}from"./users-CzjLCIoh.js";import{_ as K}from"./ReassignUserModal-D0SwpBMR.js";import"./ModalShell-CHgAd1m8.js";function X(){const y=H(),{questions:b,totalQuestionsCount:u,loading:p,loadQuestions:m}=V(),d=k([]),o=k([]),i=k([]),f=k([]),C=k(!1),_=S(()=>{const l=o.value.map(r=>({...r,type:"lead",taskType:"Lead",dueTime:r.nextActionDue?new Date(r.nextActionDue).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:r.nextActionDue?new Date(r.nextActionDue):null})),x=i.value.map(r=>({...r,type:"opportunity",taskType:"Opportunity",dueTime:r.expectedCloseDate?new Date(r.expectedCloseDate).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:r.expectedCloseDate?new Date(r.expectedCloseDate):null}));return[...l,...x]}),$=S(()=>{const l=[],x=d.value.map(e=>({...e,todoType:"appointment",sortTime:new Date(e.start).getTime(),time:new Date(e.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(e.start)}));l.push(...x);const r=_.value.map(e=>{const s=e.dueDate||(e.nextActionDue?new Date(e.nextActionDue):null),T=s&&s<new Date;return{...e,todoType:"task",sortTime:s?s.getTime():0,isOverdue:T,priority:e.priority==="Hot"?1:2}});return l.push(...r),l.sort((e,s)=>e.todoType==="appointment"&&s.todoType!=="appointment"?-1:e.todoType!=="appointment"&&s.todoType==="appointment"?1:e.todoType==="appointment"&&s.todoType==="appointment"?e.sortTime-s.sortTime:e.isOverdue&&!s.isOverdue?-1:!e.isOverdue&&s.isOverdue?1:e.priority!==s.priority?e.priority-s.priority:e.sortTime-s.sortTime)}),h=S(()=>d.value.map(l=>({...l,time:new Date(l.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(l.start)})).sort((l,x)=>l.date.getTime()-x.date.getTime())),D=S(()=>_.value.filter(l=>{const x=l.dueDate||(l.nextActionDue?new Date(l.nextActionDue):null);if(!x)return!1;const r=new Date;r.setHours(0,0,0,0);const e=new Date(r);e.setDate(e.getDate()+1);const s=new Date(x);return s.setHours(0,0,0,0),s>=r&&s<e}).sort((l,x)=>{var c,T;const r=new Date,e=l.dueDate<r,s=x.dueDate<r;return e&&!s?-1:!e&&s?1:l.priority!==x.priority?(l.priority==="Hot"?1:2)-(x.priority==="Hot"?1:2):(((c=l.dueDate)==null?void 0:c.getTime())||0)-(((T=x.dueDate)==null?void 0:T.getTime())||0)})),A=S(()=>b.value);async function N(){C.value=!0;try{await m(),d.value=await P(),y.canAccessLeads()&&(o.value=await Q()),y.canAccessOpportunities()&&(i.value=await E()),f.value=await G(1)}catch(l){console.error("Error loading dashboard:",l)}finally{C.value=!1}}return{notifications:A,totalNotificationsCount:u,appointmentsToday:h,tasksDueToday:D,prioritizedTodos:$,loading:S(()=>C.value||p.value),loadDashboard:N}}const Z={class:"flex items-center gap-2 mb-2"},ee={class:"text-xs text-gray-500"},te={class:"text-xs text-gray-500"},se={class:"ml-auto flex items-center gap-2"},oe={key:1,class:"bg-white border border-gray-200 rounded-lg shadow-lg p-1.5 flex items-center gap-1.5 z-10"},re=["innerHTML"],ne={class:"flex gap-2 flex-wrap justify-end mt-3"},ae={__name:"ActionableQuestionCard",props:{question:{type:Object,required:!0}},emits:["answer-yes","answer-no","reassign","view-task","dismiss"],setup(y,{emit:b}){const u=y,p=b,m=k(!1),d=k(!1),o=H();W();const i=()=>{var e,s,c;const r=((e=u.question.opportunity)==null?void 0:e.assignee)||((s=u.question.lead)==null?void 0:s.assignee);return r?r===((c=o.currentUser)==null?void 0:c.name)?"me":r:"Unknown"},f=()=>{const r=u.question.customer.name,e=u.question.question,s=`<a href="#" class="font-bold text-primary-600 hover:text-primary-700 hover:underline" onclick="event.preventDefault()">${r}</a>`;return e.replace(new RegExp(r,"g"),s)},C=r=>r===1?"bg-red-50 text-red-600 border-red-100":r<=3?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100",_=r=>r===1?"CRITICAL":r<=3?"HIGH":"MEDIUM",$=()=>{if(!u.question.createdAt&&!u.question.appointmentDate)return"Just now";const r=new Date(u.question.createdAt||u.question.appointmentDate),s=new Date-r,c=Math.floor(s/6e4),T=Math.floor(c/60),U=Math.floor(T/24);return c<1?"Just now":c<60?`${c} min ago`:T<24?`${T} hours ago`:U===1?"1 day ago":U<7?`${U} days ago`:`${Math.floor(U/7)} weeks ago`},h=()=>p("answer-yes",u.question),D=()=>p("answer-no",u.question),A=()=>p("reassign",u.question),N=()=>p("view-task",u.question),l=r=>{r.target.tagName==="A"&&(r.preventDefault(),N())},x=()=>{d.value=!0,setTimeout(()=>{p("dismiss",u.question)},200)};return(r,e)=>(n(),a("div",{class:O(["bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all",d.value?"opacity-50":""])},[t("div",Z,[t("span",{class:O(["text-xs font-bold px-2 py-0.5 rounded border whitespace-nowrap",C(y.question.priority)])},g(_(y.question.priority)),3),t("span",ee,g($()),1),t("span",te,"• Owner: "+g(i()),1),t("div",se,[m.value?(n(),a("div",oe,[e[3]||(e[3]=t("span",{class:"text-xs text-gray-600 whitespace-nowrap"},"Dismiss?",-1)),t("button",{onClick:x,class:"px-2 py-0.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded transition-colors"}," Yes "),t("button",{onClick:e[1]||(e[1]=s=>m.value=!1),class:"px-2 py-0.5 text-xs font-medium text-gray-600 hover:text-gray-800 transition-colors"}," No ")])):(n(),a("button",{key:0,onClick:e[0]||(e[0]=s=>m.value=!0),class:"w-7 h-7 flex items-center justify-center rounded text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"Dismiss"},[...e[2]||(e[2]=[t("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]))])]),t("div",{class:"mb-2",onClick:l},[t("p",{class:"font-semibold text-slate-800 text-sm mb-1",innerHTML:f()},null,8,re)]),t("div",ne,[y.question.type==="appointment-followup"?(n(),a(I,{key:0},[t("button",{onClick:h,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),t("button",{onClick:D,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No ")],64)):y.question.type==="ns-followup"?(n(),a(I,{key:1},[t("button",{onClick:h,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),t("button",{onClick:D,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),t("button",{onClick:A,class:"px-3 py-1.5 text-xs font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):y.question.type==="offer-followup"?(n(),a("button",{key:2,onClick:N,class:"px-3 py-1.5 text-xs font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors"}," View Opportunity ")):y.question.type==="stuck-opportunity"?(n(),a(I,{key:3},[t("button",{onClick:h,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),t("button",{onClick:D,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),t("button",{onClick:A,class:"px-3 py-1.5 text-xs font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):y.question.type==="lead-qualification-urgency"?(n(),a(I,{key:4},[t("button",{onClick:h,class:"px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors"}," Yes "),t("button",{onClick:D,class:"px-3 py-1.5 text-xs font-medium text-rose-700 bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg transition-colors"}," No "),t("button",{onClick:A,class:"px-3 py-1.5 text-xs font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"}," Reassign ")],64)):v("",!0)])],2))}},ie={class:"space-y-3"},de={key:0,class:"text-center py-8 text-gray-500"},le=["onClick"],ue={class:"flex items-start justify-between gap-4"},ce={class:"flex-1 min-w-0"},pe={class:"flex items-center gap-2 mb-1"},ge={class:"font-semibold text-slate-800 text-sm mb-1"},ye={class:"text-xs text-gray-600 mb-2"},me={key:0},xe={class:"flex items-center gap-2 text-xs text-gray-500"},be={key:0},fe={key:1},he=["onClick"],ve={__name:"TodaysAppointments",props:{appointments:{type:Array,default:()=>[]}},setup(y){const b=q(),u=d=>{const o=new Date,f=(new Date(d)-o)/(1e3*60*60);return f<0?"bg-red-100 text-red-700 border-red-200":f<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},p=d=>({confirmed:"bg-green-50 text-green-700 border-green-200",scheduled:"bg-blue-50 text-blue-700 border-blue-200",pending:"bg-yellow-50 text-yellow-700 border-yellow-200",cancelled:"bg-red-50 text-red-700 border-red-200","no-show":"bg-gray-50 text-gray-700 border-gray-200"})[d]||"bg-gray-50 text-gray-700 border-gray-200",m=d=>{d.opportunityId?b.push(`/tasks/${d.opportunityId}?type=opportunity`):d.leadId?b.push(`/tasks/${d.leadId}?type=lead`):b.push("/calendar")};return(d,o)=>(n(),a("div",ie,[y.appointments.length===0?(n(),a("div",de,[...o[0]||(o[0]=[t("i",{class:"fa-solid fa-calendar-check text-4xl mb-2 text-gray-300"},null,-1),t("p",{class:"text-sm"},"No appointments scheduled for today",-1)])])):v("",!0),(n(!0),a(I,null,R(y.appointments,i=>(n(),a("div",{key:i.id,onClick:f=>m(i),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[t("div",ue,[t("div",ce,[t("div",pe,[t("span",{class:O(["text-xs font-bold px-2 py-0.5 rounded",u(i.date)])},g(i.time),3),t("span",{class:O(["text-xs font-medium px-2 py-0.5 rounded border",p(i.status)])},g(i.status),3)]),t("h4",ge,g(i.customer||i.title),1),t("p",ye,[M(g(i.type)+" ",1),i.vehicle?(n(),a("span",me," - "+g(i.vehicle),1)):v("",!0)]),t("div",xe,[o[1]||(o[1]=t("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),i.assigneeType==="team"?(n(),a("span",be,g(i.team)+" Team ",1)):(n(),a("span",fe,g(i.assignee||"Unassigned"),1))])]),t("button",{onClick:j(f=>m(i),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...o[2]||(o[2]=[t("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,he)])],8,le))),128))]))}},we={class:"space-y-3"},ke={key:0,class:"text-center py-8 text-gray-500"},_e=["onClick"],$e={class:"flex items-start justify-between gap-4"},De={class:"flex-1 min-w-0"},Te={class:"flex items-center gap-2 mb-1"},Ce={key:0,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 flex items-center gap-1"},Ae={key:1,class:"text-xs font-medium px-2 py-0.5 rounded bg-gray-50 text-gray-700 border border-gray-200"},Ie={key:3,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-100 text-red-700 border border-red-200"},Ne={class:"font-semibold text-slate-800 text-sm mb-1"},Se={class:"text-xs text-gray-600 mb-2"},Oe={key:0},Ue={class:"flex items-center gap-2 text-xs text-gray-500"},Le={key:0,class:"text-gray-500"},Me=["onClick"],He={__name:"TodaysTasks",props:{tasks:{type:Array,default:()=>[]}},setup(y){const b=q(),u=m=>{if(!m)return"bg-gray-100 text-gray-700 border-gray-200";const d=new Date,i=(new Date(m)-d)/(1e3*60*60);return i<0?"bg-red-100 text-red-700 border-red-200":i<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},p=m=>{b.push(`/tasks/${m.id}?type=${m.type}`)};return(m,d)=>(n(),a("div",we,[y.tasks.length===0?(n(),a("div",ke,[...d[0]||(d[0]=[t("i",{class:"fa-solid fa-tasks text-4xl mb-2 text-gray-300"},null,-1),t("p",{class:"text-sm"},"No tasks due today",-1)])])):v("",!0),(n(!0),a(I,null,R(y.tasks,o=>{var i;return n(),a("div",{key:`${o.type}-${o.id}`,onClick:f=>p(o),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[t("div",$e,[t("div",De,[t("div",Te,[o.priority==="Hot"?(n(),a("span",Ce,[...d[1]||(d[1]=[t("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),M(" HOT ",-1)])])):(n(),a("span",Ae," Normal ")),o.dueTime?(n(),a("span",{key:2,class:O(["text-xs font-bold px-2 py-0.5 rounded",u(o.dueDate)])},g(o.dueTime),3)):v("",!0),o.isOverdue?(n(),a("span",Ie," OVERDUE ")):v("",!0)]),t("h4",Ne,g(((i=o.customer)==null?void 0:i.name)||"Unknown Customer"),1),t("p",Se,[M(g(o.taskType)+" ",1),o.requestedCar||o.vehicle?(n(),a("span",Oe," - "+g(o.requestedCar?`${o.requestedCar.brand} ${o.requestedCar.model}`:`${o.vehicle.brand} ${o.vehicle.model}`),1)):v("",!0)]),t("div",Ue,[t("span",{class:O(["px-2 py-0.5 rounded border text-[10px] font-bold uppercase",o.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(o.type==="lead"?"Lead":"Opportunity"),3),o.stage||o.displayStage?(n(),a("span",Le,g(o.displayStage||o.stage),1)):v("",!0)])]),t("button",{onClick:j(f=>p(o),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...d[2]||(d[2]=[t("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,Me)])],8,_e)}),128))]))}},qe={class:"page-container"},Re={class:"p-4 md:p-6 lg:p-8"},Ve={key:0,class:"flex items-center justify-center py-12"},je={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6"},Qe={class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},Ee={class:"p-4 border-b border-gray-100 bg-gray-50/50"},Ye={class:"flex items-center justify-between"},Be={class:"flex items-center gap-2"},ze={key:0,class:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded"},Fe={class:"p-4 space-y-3"},Je={key:0,class:"text-center py-8 text-gray-500"},Pe={class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},Ge={class:"p-4 border-b border-gray-100 bg-gray-50/50"},We={class:"flex items-center justify-between"},Ke={class:"flex items-center gap-2"},Xe={key:0,class:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded"},Ze={class:"p-4"},et={class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},tt={class:"p-4 border-b border-gray-100 bg-gray-50/50"},st={class:"flex items-center justify-between"},ot={class:"flex items-center gap-2"},rt={key:0,class:"text-xs font-bold bg-orange-100 text-orange-700 px-2 py-0.5 rounded"},nt={class:"p-4"},ct={__name:"Home",setup(y){const b=q(),u=H(),{dismissQuestion:p,addFollowUpQuestion:m}=V(),{notifications:d,totalNotificationsCount:o,appointmentsToday:i,tasksDueToday:f,loading:C,loadDashboard:_}=X(),$=k(!1),h=k(null);Y(async()=>{await _()});const D=async e=>{e.type==="appointment-followup"?(p(e.id),m({id:`offer-followup-${e.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${e.customer.name}?`,customer:e.customer,opportunityId:e.opportunityId,opportunity:e.opportunity,createdAt:new Date().toISOString()})):(e.type==="ns-followup"||e.type==="stuck-opportunity"||e.type==="lead-qualification-urgency")&&p(e.id)},A=async e=>{var s;if(e.type==="appointment-followup")try{const c=(s=u.currentUser)==null?void 0:s.id;c&&(await J(e.opportunityId,c),p(e.id),await _())}catch(c){console.error("Error creating NS task:",c)}else e.type==="ns-followup"?p(e.id):e.type==="stuck-opportunity"?b.push(`/tasks/${e.opportunityId}?type=opportunity`):e.type==="lead-qualification-urgency"&&b.push(`/tasks/${e.leadId}?type=lead`)},N=e=>{h.value=e,$.value=!0},l=async e=>{if(h.value)try{const s=h.value.opportunityId||h.value.leadId;h.value.opportunityId&&await z(s,e),p(h.value.id),$.value=!1,h.value=null,await _()}catch(s){console.error("Error reassigning:",s)}},x=e=>{e.opportunityId?b.push(`/tasks/${e.opportunityId}?type=opportunity`):e.leadId&&b.push(`/tasks/${e.leadId}?type=lead`)},r=e=>{u.currentUser&&F(e.id,u.currentUser.id),p(e.id)};return(e,s)=>(n(),a("div",qe,[t("div",Re,[w(C)?(n(),a("div",Ve,[...s[4]||(s[4]=[t("div",{class:"text-gray-500"},"Loading dashboard...",-1)])])):(n(),a("div",je,[t("div",Qe,[t("div",Ee,[t("div",Ye,[t("div",Be,[s[5]||(s[5]=t("i",{class:"fa-solid fa-bolt text-gray-400 text-sm"},null,-1)),s[6]||(s[6]=t("h2",{class:"font-bold text-slate-800 text-sm"},"Quick Actions",-1)),w(o)>0?(n(),a("span",ze,g(w(o)),1)):v("",!0)]),w(o)>5?(n(),a("button",{key:0,onClick:s[0]||(s[0]=c=>e.$router.push("/tasks")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all → ")):v("",!0)])]),t("div",Fe,[w(d).length===0?(n(),a("div",Je,[...s[7]||(s[7]=[t("i",{class:"fa-solid fa-check-circle text-4xl mb-2 text-gray-300"},null,-1),t("p",{class:"text-sm"},"All caught up!",-1),t("p",{class:"text-xs text-gray-400 mt-1"},"No quick actions needed",-1)])])):v("",!0),(n(!0),a(I,null,R(w(d).slice(0,5),c=>(n(),B(ae,{key:c.id,question:c,onAnswerYes:D,onAnswerNo:A,onReassign:N,onViewTask:x,onDismiss:r},null,8,["question"]))),128))])]),t("div",Pe,[t("div",Ge,[t("div",We,[t("div",Ke,[s[8]||(s[8]=t("i",{class:"fa-solid fa-calendar text-gray-400 text-sm"},null,-1)),s[9]||(s[9]=t("h2",{class:"font-bold text-slate-800 text-sm"},"Appointments Today",-1)),w(i).length>0?(n(),a("span",Xe,g(w(i).length),1)):v("",!0)]),t("button",{onClick:s[1]||(s[1]=c=>e.$router.push("/calendar")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View calendar → ")])]),t("div",Ze,[L(ve,{appointments:w(i)},null,8,["appointments"])])]),t("div",et,[t("div",tt,[t("div",st,[t("div",ot,[s[10]||(s[10]=t("i",{class:"fa-solid fa-tasks text-gray-400 text-sm"},null,-1)),s[11]||(s[11]=t("h2",{class:"font-bold text-slate-800 text-sm"},"Tasks Due Today",-1)),w(f).length>0?(n(),a("span",rt,g(w(f).length),1)):v("",!0)]),t("button",{onClick:s[2]||(s[2]=c=>e.$router.push("/tasks")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])]),t("div",nt,[L(He,{tasks:w(f)},null,8,["tasks"])])])]))]),L(K,{show:$.value,onClose:s[3]||(s[3]=c=>$.value=!1),onConfirm:l},null,8,["show"])]))}};export{ct as default};
