import{r as I,R as Fe,h as Ie,c as w,G as Ce,d as r,o as i,e as t,g as y,n as N,w as X,I as we,t as m,p as q,s as k,y as p,P as Se,F as Q,i as Z,a3 as Me,H as je,x as B,z as Oe,k as F,v as $e,J as j,E as S,Q as U,m as de,l as re,a4 as Ue,Z as Ee,V as Be,X as We,K as Y}from"./index-hkpYR6II.js";import{_ as Le}from"./ReassignUserModal-DvAk33dj.js";import{_ as Re}from"./CreateEventModal-Clx83bEn.js";import{z as ue,F as ce,L as me,H as fe,j as pe,K as Ae,C as be,W as ye}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-YF1Jctsa.js";const ze={class:"w-full bg-surface"},Pe={class:"flex items-center justify-between gap-3 md:gap-4"},He={class:"flex items-center gap-3 md:gap-4 flex-1"},Ke=["aria-label"],Ye={class:"min-w-0 flex-1"},Qe={class:"flex items-center gap-2"},Ge={class:"text-xl font-bold uppercase text-brand-dark truncate leading-tight"},Je={class:"flex flex-wrap items-center gap-2 mt-1"},Xe={class:"flex items-center gap-1 ml-2"},Ze={class:"relative"},_e={key:0,class:"absolute top-full right-0 mt-2 z-50"},et={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},tt={class:"flex items-center gap-4"},at={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},st={class:"flex items-center gap-2"},nt={class:"text-meta text-heading font-medium"},lt={class:"flex items-center gap-2"},it={class:"text-meta text-heading font-medium"},ot={class:"flex items-center gap-2"},rt={class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},dt={key:0,class:"fa-solid fa-map-marker-alt text-sub text-xs"},ut={key:1,class:"fa-regular fa-calendar text-sub text-xs"},ct={class:"text-meta text-heading font-medium"},mt={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(e,{emit:d}){const l=e,o=d,f=I(!1),s=I(!1),b=Fe(),h=Ie(),a=w(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...l.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(c=>({...c,onClick:()=>n(c.key)}))),n=D=>{s.value=!1,o("action",D)},u=async(D,c)=>{try{await navigator.clipboard.writeText(D),b.pushToast("success",`${c==="email"?"Email":"Phone"} copied!`)}catch{b.pushToast("error","Failed to copy")}},C=()=>{o("add-tag")},E=()=>{l.customerId&&h.push(`/customer/${l.customerId}`)};return(D,c)=>{const x=Ce("click-outside");return i(),r("div",ze,[t("div",Pe,[t("div",He,[t("button",{onClick:X(E,["stop"]),class:N(["w-14 h-14 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":e.customerId}]),"aria-label":e.customerId?"Open customer profile":"Customer"},[...c[4]||(c[4]=[t("i",{class:"fa-solid fa-user text-xl"},null,-1)])],10,Ke),t("div",Ye,[t("div",Qe,[t("h1",Ge,m(e.name),1),we(D.$slots,"name-action")]),t("div",Je,[we(D.$slots,"tags"),t("button",{onClick:X(C,["stop"]),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...c[5]||(c[5]=[t("i",{class:"fa-solid fa-plus text-xs"},null,-1),t("span",null,"add tag",-1)])])])])]),t("div",Xe,[t("div",Ze,[t("button",{onClick:c[0]||(c[0]=X(T=>s.value=!s.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0","aria-label":"Quick actions"},[...c[6]||(c[6]=[t("i",{class:"fa-solid fa-plus text-base text-body"},null,-1)])]),s.value?q((i(),r("div",_e,[k(p(Se),{items:a.value,className:"w-48"},null,8,["items"])])),[[x,()=>s.value=!1]]):y("",!0)]),t("button",{onClick:c[1]||(c[1]=T=>f.value=!f.value),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0"},[t("i",{class:N(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":f.value}])},null,2)])])]),f.value?(i(),r("div",et,[t("div",tt,[t("div",at,[t("div",st,[c[8]||(c[8]=t("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[t("i",{class:"fa-regular fa-envelope text-sub text-xs"})],-1)),t("span",nt,m(e.email),1),t("button",{onClick:c[2]||(c[2]=X(T=>u(e.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...c[7]||(c[7]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",lt,[c[10]||(c[10]=t("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-phone text-sub text-xs"})],-1)),t("span",it,m(e.phone),1),t("button",{onClick:c[3]||(c[3]=X(T=>u(e.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...c[9]||(c[9]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",ot,[t("div",rt,[e.thirdFieldLabel.toLowerCase().includes("address")?(i(),r("i",dt)):(i(),r("i",ut))]),t("span",ct,m(e.thirdFieldValue),1)])])])])):y("",!0)])}}},ft={class:"flex gap-0 md:gap-8 text-content font-medium text-sub py-1"},pt=["onClick"],bt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(e){const d={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},l=o=>d[o]||"fa-solid fa-circle";return(o,f)=>(i(),r("div",ft,[(i(!0),r(Q,null,Z(e.tabs,s=>(i(),r("div",{key:s.key,onClick:b=>o.$emit("update:modelValue",s.key),class:N(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",e.modelValue===s.key?"border-brand-red text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[t("i",{class:N([l(s.key),"text-base md:text-base",e.modelValue===s.key?"text-brand-darkDarker":"text-sub"])},null,2),t("span",{class:N(["hidden md:inline whitespace-nowrap",e.modelValue===s.key?"text-brand-darkDarker":""])},m(s.label),3)],10,pt))),128))]))}},yt={class:"w-full mb-6"},vt={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},gt={class:"px-4 md:px-6 py-3 border-b border"},xt={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},ht={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},kt={class:"flex items-center gap-1.5"},wt={key:1},Ct={class:"flex items-center gap-2"},St={key:0,class:"p-4 md:p-6"},$t={key:0,class:"space-y-4"},At={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Dt={class:"flex items-center gap-4"},Tt={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border"},Ot=["src"],qt={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},It={class:"font-bold text-heading text-base md:text-lg mb-2"},Nt={class:"flex items-center gap-2 flex-wrap"},Vt={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},Ft={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},Mt={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border text-body text-xs font-semibold rounded-md"},jt={class:"text-xs font-bold text-heading"},Ut={key:0,class:"text-right"},Et={class:"font-bold text-heading text-lg"},Bt={key:0,class:"pt-2"},Wt={class:"bg-surfaceSecondary border border rounded-lg p-3"},Lt={class:"text-sm text-body leading-relaxed"},Rt={key:1,class:"space-y-3"},zt={key:0,class:"flex items-center gap-2"},Pt={class:"text-sm font-semibold text-heading"},Ht={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},Kt={class:"text-sm text-body leading-relaxed"},Yt={key:1,class:"border-t border"},Qt={class:"font-medium"},Gt={key:2,class:"border-t border p-6 bg-surfaceSecondary/30 text-sm animate-fade-in"},Jt={class:"mb-6"},Xt={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Zt={key:0},_t={class:"font-medium text-body"},ea={key:1},ta={class:"font-medium text-body"},aa={key:2},sa={class:"font-medium text-body"},na={class:"font-medium text-body"},la={key:0},ia={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},oa={key:0},ra={class:"font-medium text-body"},da={key:1},ua={class:"font-medium text-body"},ca={key:2},ma={class:"font-medium text-body"},fa={key:3},pa={class:"font-medium text-body"},ba={key:4},ya={class:"font-mono text-xs bg-surface border border px-2 py-1 rounded inline-block text-body"},va={key:5},ga={class:"font-medium text-body"},xa={key:0,class:"mt-6 flex justify-end"},ha={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(e){const d=e,l=I(!1);w(()=>d.deliverySubstatus?Me(d.deliverySubstatus):"");const o=w(()=>d.deliverySubstatus?d.deliverySubstatus==="Delivered"?"green":d.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),f=w(()=>je(d.stage,d.entityType));function s(g){return!g||g.length===0?null:g.filter(H=>H.type==="offer").sort((H,oe)=>new Date(oe.timestamp)-new Date(H.timestamp))[0]||null}function b(g){if(!g)return 0;const v=new Date(g),oe=Math.abs(new Date-v);return Math.ceil(oe/(1e3*60*60*24))}const h=w(()=>{if(d.stage!=="In Negotiation")return null;const g=s(d.activities);if(!g)return null;const v=b(g.timestamp);return v<1?{label:"New Offer",theme:"orange"}:v<3?{label:"Active",theme:"yellow"}:null}),a=w(()=>d.requestedCar&&d.requestedCar.brand&&d.requestedCar.model),n=w(()=>d.requestType||d.requestMessage||a.value),u=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.brand)||""}),C=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.model)||""}),E=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.year)||""}),D=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.image)||""}),c=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.price)||null}),x=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.stockDays)!==void 0?d.requestedCar.stockDays:null}),T=w(()=>{var g,v;return((g=d.requestedCar)==null?void 0:g.dealership)||((v=d.task)==null?void 0:v.dealership)||""}),O=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.registration)||""}),M=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.kilometers)!==void 0?d.requestedCar.kilometers:null}),L=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.fuelType)||""}),_=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.gearType)||""}),ve=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.vin)||""}),xe=w(()=>"Email"),z=w(()=>{var g,v;return((g=d.task)==null?void 0:g.sourceDetails)||((v=d.requestedCar)==null?void 0:v.adCampaign)||""}),ne=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.expectedPurchaseDate)||""}),P=w(()=>{var g;return((g=d.task)==null?void 0:g.fiscalEntity)||""}),G=w(()=>{var g;return((g=d.task)==null?void 0:g.sourceDetails)||""}),ee=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.adMedium)||""}),te=w(()=>{var g;return((g=d.requestedCar)==null?void 0:g.adSource)||""});w(()=>!0);const le=w(()=>!0),ge=w(()=>a.value||d.requestType||d.source||G.value||z.value||ne.value||P.value||ee.value||te.value),ae=g=>new Intl.NumberFormat("en-US").format(g),ie=g=>new Intl.NumberFormat("en-US").format(g);return(g,v)=>(i(),r("div",yt,[t("div",vt,[t("div",gt,[t("div",xt,[n.value?(i(),r("div",ht,[v[2]||(v[2]=t("div",{class:"flex items-center gap-2"},[t("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),t("h3",{class:"font-bold text-heading text-sm"},"Request")],-1)),t("div",kt,[t("span",{class:N(["px-2 py-0.5 rounded text-xs font-medium border",e.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},m(e.entityType==="lead"?"Lead":"Opportunity"),3),t("span",{class:N(["px-2 py-0.5 rounded text-xs font-medium border",f.value])},m(e.stage),3),e.deliverySubstatus?(i(),B(p(Oe),{key:0,text:e.deliverySubstatus,size:"small",theme:o.value},null,8,["text","theme"])):y("",!0),h.value?(i(),B(p(Oe),{key:1,text:h.value.label,size:"small",theme:h.value.theme},null,8,["text","theme"])):y("",!0)])])):(i(),r("div",wt)),t("div",Ct,[v[3]||(v[3]=t("span",{class:"hidden md:inline text-xs text-sub font-medium"},"Owner",-1)),t("button",{onClick:v[0]||(v[0]=H=>g.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},m(e.owner),1)])])]),n.value?(i(),r("div",St,[a.value?(i(),r("div",$t,[t("div",At,[t("div",Dt,[t("div",Tt,[D.value?(i(),r("img",{key:0,src:D.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Ot)):(i(),r("i",qt))]),t("div",null,[t("div",It,m(u.value)+" "+m(C.value)+" ("+m(E.value)+")",1),t("div",Nt,[x.value!==void 0&&x.value!==null?(i(),r("div",Vt,[v[4]||(v[4]=t("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),F(" In stock ("+m(x.value)+" days) ",1)])):a.value?(i(),r("div",Ft,[...v[5]||(v[5]=[t("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),F(" Out of stock ",-1)])])):y("",!0),e.source?(i(),r("div",Mt,[v[6]||(v[6]=t("span",{class:"text-xs text-sub font-medium"},"Source:",-1)),t("span",jt,m(e.source),1)])):y("",!0)])])]),c.value?(i(),r("div",Ut,[v[7]||(v[7]=t("div",{class:"text-xs text-sub font-medium mb-1"},"Price",-1)),t("div",Et,"€ "+m(ae(c.value)),1)])):y("",!0)]),e.requestMessage?(i(),r("div",Bt,[v[8]||(v[8]=t("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),t("div",Wt,[t("p",Lt,m(e.requestMessage),1)])])):y("",!0)])):(i(),r("div",Rt,[e.requestType?(i(),r("div",zt,[v[9]||(v[9]=t("span",{class:"text-xs text-sub font-medium"},"Request Type:",-1)),t("span",Pt,m(e.requestType),1)])):y("",!0),e.requestMessage?(i(),r("div",Ht,[v[10]||(v[10]=t("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),t("p",Kt,m(e.requestMessage),1)])):y("",!0)]))])):y("",!0),ge.value?(i(),r("div",Yt,[t("button",{onClick:v[1]||(v[1]=H=>l.value=!l.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[t("span",Qt,m(l.value?"Hide":"View")+" Details",1),t("i",{class:N(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":l.value}])},null,2)])])):y("",!0),l.value&&ge.value?(i(),r("div",Gt,[t("div",Jt,[v[21]||(v[21]=t("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),t("div",Xt,[e.requestType?(i(),r("div",Zt,[v[11]||(v[11]=t("div",{class:"text-xs text-sub mb-1"},"Request type",-1)),t("div",_t,m(e.requestType),1)])):y("",!0),e.source?(i(),r("div",ea,[v[12]||(v[12]=t("div",{class:"text-xs text-sub mb-1"},"Source",-1)),t("div",ta,m(e.source),1)])):y("",!0),t("div",null,[v[13]||(v[13]=t("div",{class:"text-xs text-sub mb-1"},"Source details",-1)),t("div",{class:N(["font-medium",G.value?"text-body":"text-sub"])},m(G.value||"--"),3)]),T.value?(i(),r("div",aa,[v[14]||(v[14]=t("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),t("div",sa,m(T.value),1)])):y("",!0),t("div",null,[v[15]||(v[15]=t("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),t("div",na,m(xe.value||"Email"),1)]),t("div",null,[v[16]||(v[16]=t("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),t("div",{class:N(["font-medium",z.value?"text-body":"text-sub"])},m(z.value||"--"),3)]),t("div",null,[v[17]||(v[17]=t("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),t("div",{class:N(["font-medium",ee.value?"text-body":"text-sub"])},m(ee.value||"--"),3)]),t("div",null,[v[18]||(v[18]=t("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),t("div",{class:N(["font-medium",te.value?"text-body":"text-sub"])},m(te.value||"--"),3)]),t("div",null,[v[19]||(v[19]=t("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),t("div",{class:N(["font-medium",ne.value?"text-body":"text-sub"])},m(ne.value||"--"),3)]),t("div",null,[v[20]||(v[20]=t("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),t("div",{class:N(["font-medium",P.value?"text-body":"text-sub"])},m(P.value||"--"),3)])])]),a.value?(i(),r("div",la,[v[30]||(v[30]=t("div",{class:"border-t border my-4"},null,-1)),t("div",null,[v[29]||(v[29]=t("div",{class:"flex justify-between items-center mb-4"},[t("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),t("div",ia,[O.value?(i(),r("div",oa,[v[22]||(v[22]=t("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),t("div",ra,m(O.value),1)])):y("",!0),M.value!==void 0&&M.value!==null?(i(),r("div",da,[v[23]||(v[23]=t("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),t("div",ua,m(ie(M.value))+" Km",1)])):y("",!0),L.value?(i(),r("div",ca,[v[24]||(v[24]=t("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),t("div",ma,m(L.value),1)])):y("",!0),_.value?(i(),r("div",fa,[v[25]||(v[25]=t("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),t("div",pa,m(_.value),1)])):y("",!0),ve.value?(i(),r("div",ba,[v[26]||(v[26]=t("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),t("div",ya,m(ve.value),1)])):y("",!0),T.value?(i(),r("div",va,[v[27]||(v[27]=t("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),t("div",ga,m(T.value),1)])):y("",!0)]),le.value?(i(),r("div",xa,[...v[28]||(v[28]=[t("button",{class:"bg-surface border border text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[t("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),F(" View technical specs ")],-1)])])):y("",!0)])])):y("",!0)])):y("",!0)])]))}},ka={key:0,class:"flex-grow border-t border"},wa={key:0,class:"ml-1.5 text-body"},Ca={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Sa={key:1,class:"flex-grow border-t border"},$a={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(e,{emit:d}){const l=e,o=d,f=I(!1),s={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},b=w(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(x=>!s[x]);const c=Object.entries(s).filter(([,x])=>x===l.activeTab).map(([x])=>x);return l.actions.filter(x=>c.includes(x))}),h=w(()=>l.activeTab==="communication"?!0:b.value.length===1),a=w(()=>{if(l.activeTab==="communication")return"add communication";if(!h.value||b.value.length!==1)return"";const c=b.value[0];return{note:"add note",attachment:"add attachment"}[c]||""}),n=w(()=>l.activeTab==="communication"?!0:b.value.length>1),u=w(()=>{const c={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return b.value.map(x=>({key:x,label:c[x]||x,onClick:()=>E(x)}))}),C=w(()=>{if(l.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border";const c="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border";return h.value?`${c} px-4 py-2 h-9`:`${c} w-9 h-9`});w(()=>b.value.some(c=>["email","whatsapp","sms"].includes(c))),w(()=>b.value.some(c=>["addVehicle","configureVehicle"].includes(c))),w(()=>b.value.some(c=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(c)));const E=c=>{f.value=!1,o("action",c)},D=()=>{h.value&&b.value.length===1&&l.activeTab!=="communication"?E(b.value[0]):f.value=!f.value};return(c,x)=>{const T=Ce("click-outside");return e.show?(i(),r("div",{key:0,class:N(["relative flex items-center",e.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[e.inline?y("",!0):(i(),r("div",ka)),t("div",{class:N(["relative",e.inline?"mx-0":"mx-4"])},[t("button",{onClick:X(D,["stop"]),class:N(C.value)},[x[0]||(x[0]=t("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),h.value?(i(),r("span",wa,m(a.value),1)):y("",!0)],2),f.value&&n.value?q((i(),r("div",Ca,[k(p(Se),{items:u.value,className:"w-48"},null,8,["items"])])),[[T,()=>f.value=!1]]):y("",!0)],2),e.inline?y("",!0):(i(),r("div",Sa))],2)):y("",!0)}}},Aa={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Da={class:"flex items-start gap-3"},Ta={class:"flex-1 min-w-0"},Oa={class:"font-bold text-sm text-heading mb-2"},qa={class:"space-y-1.5 text-xs text-gray-600"},Ia={class:"flex items-center gap-2"},Na={class:"flex items-center gap-2"},Va={class:"flex items-center gap-2"},Fa={key:0,class:"mt-2"},Ma={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(e){const d=e,l=w(()=>d.appointmentData.date?new Date(d.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),o=w(()=>d.appointmentData.time?d.appointmentData.time:""),f=s=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[s==null?void 0:s.toLowerCase()]||"bg-surfaceSecondary text-body border border";return(s,b)=>(i(),r("div",Aa,[t("div",Da,[b[3]||(b[3]=t("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-calendar text-sm"})],-1)),t("div",Ta,[t("h4",Oa,m(e.appointmentData.type),1),t("div",qa,[t("div",Ia,[b[0]||(b[0]=t("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),t("span",null,m(l.value),1)]),t("div",Na,[b[1]||(b[1]=t("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),t("span",null,m(o.value),1)]),t("div",Va,[b[2]||(b[2]=t("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),t("span",null,m(e.appointmentData.assignee),1)])]),e.appointmentData.status?(i(),r("div",Fa,[t("span",{class:N(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",f(e.appointmentData.status)])},m(e.appointmentData.status),3)])):y("",!0)])])]))}},ja={class:"bg-surface border border rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Ua={class:"flex-1"},Ea={class:"flex items-center gap-2 mb-1"},Ba={class:"text-meta-bold text-heading"},Wa={class:"text-meta"},La={class:"text-meta"},Ra={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},za={class:"ml-auto relative"},Pa={key:0,class:"absolute right-0 top-full mt-1 z-10"},Ha={key:0,class:"text-content text-body"},Ka={key:1,class:"text-content text-body flex items-center gap-2"},Ya={key:2,class:"mt-2"},Qa={key:0},Ga={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},Ja={key:0},Xa={class:"text-content font-bold text-heading"},Za={key:0,class:"text-meta mt-0.5"},_a={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},es={key:0},ts={key:1},as={key:2},ss={key:3},ns={key:4},ls={key:1},is={class:"text-content font-bold text-heading mb-2"},os={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},rs={key:0},ds={class:"text-body font-medium ml-1"},us={key:1},cs={class:"text-body font-medium ml-1"},ms={key:2},fs={class:"text-body font-medium ml-1"},ps={key:3},bs={class:"text-body font-medium ml-1"},ys={key:4},vs={class:"text-body font-medium ml-1"},gs={key:5},xs={class:"text-body font-medium ml-1"},hs={key:2,class:"flex items-center gap-3"},ks={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},ws=["src"],Cs={class:"flex-1"},Ss={class:"text-content font-bold text-heading"},$s={class:"text-meta"},As={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Ds={key:3,class:"flex items-center gap-3"},Ts={class:"flex-1"},Os={class:"text-content font-bold text-heading"},qs={class:"text-meta"},Is={key:0,class:"text-meta mt-1"},Ns={key:1,class:"text-meta mt-1"},qe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(e,{emit:d}){const l=e,o=d,f=I(!1),s=w(()=>[{key:"edit",label:"Edit",onClick:C},{key:"delete",label:"Delete",onClick:E}]),b=D=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[D]||"fa-solid fa-circle",h=D=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[D]||"bg-surfaceSecondary text-body border",a=D=>{if(!D)return"Just now";const c=new Date(D),T=new Date-c,O=Math.floor(T/6e4),M=Math.floor(O/60),L=Math.floor(M/24);return O<1?"Just now":O<60?`${O} minutes ago`:M<24?`${M} hours ago`:L===1?"Yesterday":L<7?`${L} days ago`:c.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},n=D=>D?new Intl.NumberFormat("en-US").format(D):"0",u=D=>D?new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",C=()=>{f.value=!1,o("edit",l.item)},E=()=>{f.value=!1,confirm("Are you sure you want to delete this item?")&&o("delete",l.item)};return(D,c)=>{const x=Ce("click-outside");return i(),r("div",ja,[t("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",h(e.item.type)])},[t("i",{class:N([b(e.item.type),"text-sm"])},null,2)],2),t("div",Ua,[t("div",Ea,[t("span",Ba,m(e.customerInitials),1),t("span",Wa,m(e.item.action||"added"),1),t("span",La,"• "+m(a(e.item.timestamp)),1),e.item.autoDetected?(i(),r("span",Ra,"Auto-detected")):y("",!0),t("div",za,[t("button",{onClick:c[0]||(c[0]=X(T=>f.value=!f.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...c[1]||(c[1]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),f.value?q((i(),r("div",Pa,[k(p(Se),{items:s.value,className:"w-32"},null,8,["items"])])),[[x,()=>f.value=!1]]):y("",!0)])]),e.item.content?(i(),r("div",Ha,m(e.item.content),1)):y("",!0),e.item.fileName?(i(),r("div",Ka,[c[2]||(c[2]=t("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),t("span",null,m(e.item.fileName),1)])):y("",!0),e.item.data?(i(),r("div",Ya,[e.item.type==="appointment"?(i(),r("div",Qa,[k(Ma,{"appointment-data":e.item.data},null,8,["appointment-data"])])):(i(),r("div",Ga,[e.item.type==="tradein"?(i(),r("div",Ja,[t("h4",Xa,m(e.item.data.brand)+" "+m(e.item.data.model),1),e.item.data.version?(i(),r("p",Za,m(e.item.data.version),1)):y("",!0),t("div",_a,[e.item.data.year?(i(),r("div",es,[c[3]||(c[3]=t("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),F(m(e.item.data.year),1)])):y("",!0),e.item.data.km?(i(),r("div",ts,[c[4]||(c[4]=t("i",{class:"fa-solid fa-road mr-1"},null,-1)),F(m(e.item.data.km)+" km ",1)])):y("",!0),e.item.data.plate?(i(),r("div",as,[c[5]||(c[5]=t("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),F(m(e.item.data.plate),1)])):y("",!0),e.item.data.date?(i(),r("div",ss,[c[6]||(c[6]=t("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),F(m(u(e.item.data.date)),1)])):y("",!0),e.item.data.class?(i(),r("div",ns,[c[7]||(c[7]=t("i",{class:"fa-solid fa-car mr-1"},null,-1)),F(m(e.item.data.class),1)])):y("",!0)])])):e.item.type==="financing"?(i(),r("div",ls,[t("h4",is,m(e.item.data.product),1),t("div",os,[e.item.data.provider?(i(),r("div",rs,[c[8]||(c[8]=t("span",{class:"text-gray-500"},"Provider:",-1)),t("span",ds,m(e.item.data.provider),1)])):y("",!0),e.item.data.total?(i(),r("div",us,[c[9]||(c[9]=t("span",{class:"text-gray-500"},"Total:",-1)),t("span",cs,"€"+m(n(e.item.data.total)),1)])):y("",!0),e.item.data.monthly?(i(),r("div",ms,[c[10]||(c[10]=t("span",{class:"text-gray-500"},"Monthly:",-1)),t("span",fs,"€"+m(n(e.item.data.monthly)),1)])):y("",!0),e.item.data.deposit?(i(),r("div",ps,[c[11]||(c[11]=t("span",{class:"text-gray-500"},"Deposit:",-1)),t("span",bs,"€"+m(n(e.item.data.deposit)),1)])):y("",!0),e.item.data.startDate?(i(),r("div",ys,[c[12]||(c[12]=t("span",{class:"text-gray-500"},"Start:",-1)),t("span",vs,m(u(e.item.data.startDate)),1)])):y("",!0),e.item.data.expDate?(i(),r("div",gs,[c[13]||(c[13]=t("span",{class:"text-gray-500"},"Expires:",-1)),t("span",xs,m(u(e.item.data.expDate)),1)])):y("",!0)])])):e.item.type==="offer"?(i(),r("div",hs,[e.item.data.image?(i(),r("div",ks,[t("img",{src:e.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ws)])):y("",!0),t("div",Cs,[t("h4",Ss,m(e.item.data.brand)+" "+m(e.item.data.model)+" ("+m(e.item.data.year)+")",1),t("p",$s,"€ "+m(n(e.item.data.price)),1)]),e.item.data.isMainOffer?(i(),r("span",As,"Main Offer")):y("",!0)])):e.item.type==="purchase"?(i(),r("div",Ds,[t("div",Ts,[t("h4",Os,m(e.item.data.brand)+" "+m(e.item.data.model)+" ("+m(e.item.data.year)+")",1),t("p",qs,"€ "+m(n(e.item.data.price)),1),e.item.data.purchaseDate?(i(),r("p",Is,"Purchased: "+m(u(e.item.data.purchaseDate)),1)):y("",!0),e.item.data.notes?(i(),r("p",Ns,m(e.item.data.notes),1)):y("",!0)])])):y("",!0)]))])):y("",!0)])])}}},Vs={class:"h-16 px-5 border-b border bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Fs={class:"flex items-center gap-3"},Ms=["title"],js={key:0,class:"fa-solid fa-arrow-left text-sm"},Us={key:1,class:"fa-solid fa-arrow-right text-sm"},Es={key:2,class:"font-bold text-lg text-heading"},Bs={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Ws={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},Ls={key:1,class:"text-center py-8 text-sub relative z-10"},Rs={class:"text-sm"},zs={key:2,class:"space-y-6 relative z-10"},Ps={key:0,class:"mb-4 pl-12"},Hs={class:"text-sm font-semibold text-heading"},Ks={class:"flex gap-4 relative mb-6"},Ys={class:"flex-1 min-w-0"},Qs={class:"text-sm text-slate-700 leading-snug"},Gs={class:"font-bold"},Js={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-body"},Xs={class:"text-xs text-sub mt-1"},Zs={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},_s={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},en={key:1,class:"space-y-4 relative z-10"},tn=["title"],an={key:2,class:"text-center py-8 text-sub relative z-10"},sn={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(e,{emit:d}){const l=e,o=a=>{const n={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return n[a]||n.default},f=a=>{const n={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return n[a]||n.default},s=a=>{if(!a)return"";const n=new Date(a),u=new Date,C=new Date(u);return C.setDate(C.getDate()-1),n.toDateString()===u.toDateString()?"Today":n.toDateString()===C.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},b=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",h=(a,n)=>{if(a===0)return!0;const u=l.activities[a-1];if(!u)return!0;const C=new Date(n.timestamp).toDateString(),E=new Date(u.timestamp).toDateString();return C!==E};return(a,n)=>e.show?(i(),r("div",{key:0,class:N(["bg-surface border-l border shrink-0 flex flex-col transition-all duration-300",[e.collapsed?"w-16":"w-80",e.mobileFullscreen?"xl:relative xl:border-l":""]])},[t("div",Vs,[t("div",Fs,[e.mobileFullscreen?(i(),r("button",{key:0,onClick:n[0]||(n[0]=u=>a.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...n[2]||(n[2]=[t("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):e.showCollapse?(i(),r("button",{key:1,onClick:n[1]||(n[1]=u=>a.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:e.collapsed?"Expand sidebar":"Collapse sidebar"},[e.collapsed?(i(),r("i",js)):(i(),r("i",Us))],8,Ms)):y("",!0),e.collapsed?y("",!0):(i(),r("h2",Es,m(e.title),1))])]),e.collapsed?(i(),r("div",Zs,[e.activities.length>0?(i(),r("div",_s)):y("",!0),e.activities.length>0?(i(),r("div",en,[(i(!0),r(Q,null,Z(e.activities,u=>(i(),r("div",{key:u.id,class:"relative"},[t("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border",f(u.type)]),title:`${u.user} ${u.action}`},[t("i",{class:N([o(u.type),"text-xs"])},null,2)],10,tn)]))),128))])):(i(),r("div",an,[...n[4]||(n[4]=[t("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(i(),r("div",Bs,[e.activities.length>0?(i(),r("div",Ws)):y("",!0),e.activities.length===0?(i(),r("div",Ls,[n[3]||(n[3]=t("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),t("p",Rs,m(e.emptyMessage),1)])):(i(),r("div",zs,[(i(!0),r(Q,null,Z(e.activities,(u,C)=>(i(),r(Q,{key:u.id},[h(C,u)?(i(),r("div",Ps,[t("h3",Hs,m(s(u.timestamp)),1)])):y("",!0),t("div",Ks,[t("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",f(u.type)])},[t("i",{class:N([o(u.type),"text-sm"])},null,2)],2),t("div",Ys,[t("div",Qs,[t("span",Gs,m(u.user),1),F(" "+m(u.action),1)]),u.content?(i(),r("div",Js,m(u.content),1)):y("",!0),t("div",Xs,m(b(u.timestamp)),1)])])],64))),128))]))]))],2)):y("",!0)}},nn={class:"bg-surface border border rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},ln={class:"heading-sub mb-3"},on={class:"mb-3"},rn={class:"flex justify-end gap-2"},dn={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:d}){const l=e,o=d,f=I(""),s=I(""),b=()=>{!f.value.trim()&&!s.value||o("save",{type:"communication",action:`sent via ${l.type}`,content:f.value||`Sent template: ${s.value}`,communicationType:l.type})};return(h,a)=>(i(),r("div",nn,[a[7]||(a[7]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),t("h5",ln,m(e.type==="email"?"Send Email":e.type==="whatsapp"?"Send WhatsApp":e.type==="sms"?"Send SMS":"Send Message"),1),t("div",on,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Template",-1)),q(t("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>s.value=n),class:"input"},[...a[3]||(a[3]=[t("option",{value:""},"Select a template...",-1),t("option",null,"Follow-up",-1),t("option",null,"Meeting Confirmation",-1),t("option",null,"Quote Proposal",-1),t("option",null,"Unable to Reach",-1)])],512),[[$e,s.value]])]),q(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>f.value=n),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[j,f.value]]),t("div",rn,[k(p(U),{variant:"outline",size:"small",onClick:a[2]||(a[2]=n=>h.$emit("cancel"))},{default:S(()=>[...a[5]||(a[5]=[F(" Cancel ",-1)])]),_:1}),k(p(U),{variant:"primary",size:"small",onClick:b},{default:S(()=>[...a[6]||(a[6]=[F(" Send ",-1)])]),_:1})])]))}},un={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},cn={key:1,class:"flex justify-between items-center mb-4"},mn={class:"heading-sub"},fn={key:2,class:"flex justify-end gap-2 mt-6 border-t border pt-4"},pn={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:d,emit:l}){const o=e,f=l,s=I("");de(()=>{o.item&&(s.value=o.item.content||"")});const b=()=>{var h,a;s.value.trim()&&f("save",{id:((h=o.item)==null?void 0:h.id)||Date.now(),type:"note",action:o.item?"updated a note":"added a note",content:s.value,timestamp:((a=o.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!o.item})};return d({submit:b,canSubmit:()=>!!s.value.trim()}),(h,a)=>(i(),r("div",{class:N(["animate-fade-in relative",{"bg-surface border border rounded-xl p-5 shadow-sm mb-6":!e.hideHeader}])},[e.hideHeader?y("",!0):(i(),r("div",un)),e.hideHeader?y("",!0):(i(),r("div",cn,[t("h5",mn,m(e.item?"Edit Note":"Add Note"),1),t("button",{onClick:a[0]||(a[0]=n=>h.$emit("cancel")),class:"text-sub hover:text-body"},[...a[3]||(a[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t("div",null,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Note",-1)),q(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>s.value=n),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[j,s.value]])]),e.hideActions?y("",!0):(i(),r("div",fn,[k(p(U),{variant:"outline",size:"small",onClick:a[2]||(a[2]=n=>h.$emit("cancel"))},{default:S(()=>[...a[5]||(a[5]=[F(" Cancel ",-1)])]),_:1}),k(p(U),{variant:"primary",size:"small",onClick:b},{default:S(()=>[...a[6]||(a[6]=[F(" Save ",-1)])]),_:1})]))],2))}},bn={class:"bg-surface border border rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},yn={class:"flex justify-between items-center mb-4"},vn={class:"heading-sub"},gn={class:"flex items-center gap-3"},xn={key:0,class:"text-sm text-slate-600"},hn={key:1,class:"text-sm text-sub"},kn={class:"flex justify-end gap-2 mt-6 border-t border pt-4"},wn={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:d}){const l=e,o=d,f=I(null),s=I("");de(()=>{l.item&&(s.value=l.item.fileName||"")});const b=a=>{const n=a.target.files[0];n&&(f.value=n,s.value=n.name)},h=()=>{var a,n;!f.value&&!l.item||o("save",{id:((a=l.item)==null?void 0:a.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:s.value,timestamp:((n=l.item)==null?void 0:n.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return(a,n)=>(i(),r("div",bn,[n[8]||(n[8]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),t("div",yn,[t("h5",vn,m(e.item?"Edit Attachment":"Add Attachment"),1),t("button",{onClick:n[0]||(n[0]=u=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...n[3]||(n[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t("div",null,[n[5]||(n[5]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),t("div",gn,[t("input",{type:"file",onChange:b,ref:"fileInput",class:"hidden"},null,544),k(p(U),{variant:"outline",size:"small",onClick:n[1]||(n[1]=u=>a.$refs.fileInput.click()),class:"flex items-center gap-2"},{default:S(()=>[...n[4]||(n[4]=[t("i",{class:"fa-solid fa-paperclip"},null,-1),t("span",null,"Choose File",-1)])]),_:1}),s.value?(i(),r("span",xn,m(s.value),1)):(i(),r("span",hn,"No file selected"))])]),t("div",kn,[k(p(U),{variant:"outline",size:"small",onClick:n[2]||(n[2]=u=>a.$emit("cancel"))},{default:S(()=>[...n[6]||(n[6]=[F(" Cancel ",-1)])]),_:1}),k(p(U),{variant:"primary",size:"small",disabled:!f.value,onClick:h},{default:S(()=>[...n[7]||(n[7]=[F(" Save ",-1)])]),_:1},8,["disabled"])])]))}},Cn={class:"animate-fade-in"},Sn={class:"space-y-4"},$n={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},An={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dn={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Tn=["disabled"],On={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:d,emit:l}){const o=e,f=l,s=I({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});de(()=>{o.item&&o.item.data&&(s.value={startDate:o.item.data.startDate||"",expDate:o.item.data.expDate||"",productName:o.item.data.product||o.item.data.productName||"",deposit:o.item.data.deposit||"",loanAmount:o.item.data.total||o.item.data.loanAmount||""})});const b=()=>{var h,a;s.value.productName&&f("save",{id:((h=o.item)==null?void 0:h.id)||Date.now(),type:"financing",action:o.item?"updated a financing proposal":"added a financing proposal",data:{product:s.value.productName,provider:"Audi Financial",total:s.value.loanAmount||"0",monthly:Math.round(parseFloat(s.value.loanAmount||0)/36).toString(),startDate:s.value.startDate,expDate:s.value.expDate,deposit:s.value.deposit},timestamp:((a=o.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!o.item})};return d({submit:b,isValid:w(()=>!!s.value.productName)}),(h,a)=>(i(),r("div",Cn,[t("div",Sn,[t("div",$n,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),q(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=n=>s.value.startDate=n),class:"input"},null,512),[[j,s.value.startDate]])]),t("div",null,[a[7]||(a[7]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),q(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=n=>s.value.expDate=n),class:"input"},null,512),[[j,s.value.expDate]])])]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),q(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=n=>s.value.productName=n),class:"input"},null,512),[[j,s.value.productName]])]),t("div",An,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),q(t("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=n=>s.value.deposit=n),class:"input"},null,512),[[j,s.value.deposit]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),q(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=n=>s.value.loanAmount=n),class:"input"},null,512),[[j,s.value.loanAmount]])])])]),e.hideActions?y("",!0):(i(),r("div",Dn,[t("button",{onClick:a[5]||(a[5]=n=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),t("button",{onClick:b,disabled:!s.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Tn)]))]))}},qn={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:d}){const l=d,o=I(null),f=w(()=>{var a;return((a=o.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=o.value)==null||a.submit()},b=a=>{a||l("close")},h=a=>{l("save",a),l("close")};return(a,n)=>(i(),B(p(ye),{open:e.show,"onUpdate:open":b},{default:S(()=>[k(p(ue),null,{default:S(()=>[k(p(ce),{class:"fixed inset-0 z-50 bg-black/50"}),k(p(me),{class:"w-full sm:max-w-lg"},{default:S(()=>[k(p(fe),null,{default:S(()=>[k(p(pe),null,{default:S(()=>[...n[2]||(n[2]=[F("Add Financing",-1)])]),_:1}),k(p(Ae),null,{default:S(()=>[...n[3]||(n[3]=[F("Record financing details for this customer",-1)])]),_:1})]),_:1}),k(On,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:o,onSave:h,onCancel:n[0]||(n[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id"]),k(p(be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[k(p(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=u=>a.$emit("close"))}),k(p(U),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},In={class:"animate-fade-in"},Nn={class:"space-y-4"},Vn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mn={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},jn=["disabled"],Un={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:d,emit:l}){const o=e,f=l,s=I({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});de(()=>{o.item&&o.item.data&&(s.value={class:o.item.data.class||"Car",brand:o.item.data.brand||"",model:o.item.data.model||"",version:o.item.data.version||"",km:o.item.data.km||"",plate:o.item.data.plate||"",date:o.item.data.date||""})});const b=()=>{var h,a;s.value.brand&&f("save",{id:((h=o.item)==null?void 0:h.id)||Date.now(),type:"tradein",action:o.item?"updated a trade-in":"added a trade-in",data:{class:s.value.class,brand:s.value.brand,model:s.value.model||"Unknown Model",year:s.value.date?new Date(s.value.date).getFullYear():"Unknown Year",km:s.value.km||"0",plate:s.value.plate||"",date:s.value.date||""},timestamp:((a=o.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!o.item})};return d({submit:b,isValid:w(()=>!!s.value.brand)}),(h,a)=>(i(),r("div",In,[t("div",Nn,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),q(t("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>s.value.class=n),class:"input"},[...a[8]||(a[8]=[t("option",{value:"Car"},"Car",-1),t("option",{value:"Motorcycle"},"Motorcycle",-1),t("option",{value:"Truck"},"Truck",-1)])],512),[[$e,s.value.class]])]),t("div",Vn,[t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),q(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=n=>s.value.brand=n),class:"input"},null,512),[[j,s.value.brand]])]),t("div",null,[a[11]||(a[11]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),q(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=n=>s.value.model=n),class:"input"},null,512),[[j,s.value.model]])])]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),q(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=n=>s.value.version=n),class:"input"},null,512),[[j,s.value.version]])]),t("div",Fn,[t("div",null,[a[13]||(a[13]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),q(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=n=>s.value.km=n),class:"input"},null,512),[[j,s.value.km]])]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),q(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=n=>s.value.plate=n),class:"input"},null,512),[[j,s.value.plate]])])]),t("div",null,[a[15]||(a[15]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),q(t("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=n=>s.value.date=n),class:"input"},null,512),[[j,s.value.date]])])]),e.hideActions?y("",!0):(i(),r("div",Mn,[t("button",{onClick:a[7]||(a[7]=n=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),t("button",{onClick:b,disabled:!s.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,jn)]))]))}},En={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:d}){const l=d,o=I(null),f=w(()=>{var a;return((a=o.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=o.value)==null||a.submit()},b=a=>{a||l("close")},h=a=>{l("save",a),l("close")};return(a,n)=>(i(),B(p(ye),{open:e.show,"onUpdate:open":b},{default:S(()=>[k(p(ue),null,{default:S(()=>[k(p(ce),{class:"fixed inset-0 z-50 bg-black/50"}),k(p(me),{class:"w-full sm:max-w-lg"},{default:S(()=>[k(p(fe),null,{default:S(()=>[k(p(pe),null,{default:S(()=>[...n[2]||(n[2]=[F("Add Trade-In Vehicle",-1)])]),_:1}),k(p(Ae),null,{default:S(()=>[...n[3]||(n[3]=[F("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),k(Un,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:o,onSave:h,onCancel:n[0]||(n[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id"]),k(p(be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[k(p(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=u=>a.$emit("close"))}),k(p(U),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:s},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Bn={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Wn={key:0,class:"flex justify-between items-center mb-4"},Ln={class:"text-sm font-bold text-heading"},Rn={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border"},zn={class:"flex items-center gap-3"},Pn={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},Hn=["src"],Kn={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Yn={class:"font-bold text-sm text-heading"},Qn={class:"text-xs text-sub"},Gn={class:"space-y-4"},Jn={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xn={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Zn=["disabled"],_n={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:d,emit:l}){const o=e,f=l,s=I({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});de(()=>{if(o.selectedVehicle){s.value.price=o.selectedVehicle.price||0,s.value.brand=o.selectedVehicle.brand||"",s.value.model=o.selectedVehicle.model||"",s.value.year=o.selectedVehicle.year||"",s.value.image=o.selectedVehicle.image||"";const n=new Date;n.setDate(n.getDate()+30),s.value.validUntil=n.toISOString().split("T")[0]}o.item&&o.item.data&&(s.value={...s.value,...o.item.data,price:o.item.data.price||o.item.data.total||0,financingType:o.item.data.financingType||o.item.data.paymentMethod||"",notes:o.item.data.notes||o.item.data.description||""})}),re(()=>o.selectedVehicle,n=>{n&&!o.item&&(s.value.price=n.price||0,s.value.brand=n.brand||"",s.value.model=n.model||"",s.value.year=n.year||"",s.value.image=n.image||"")});const b=w(()=>s.value.price>0&&s.value.financingType!==""),h=n=>n?n.toLocaleString("en-US"):"0",a=()=>{var u,C;if(!b.value)return;const n={id:((u=o.item)==null?void 0:u.id)||Date.now(),type:"offer",action:o.item?"updated an offer":"created an offer",data:{brand:s.value.brand,model:s.value.model,year:s.value.year,price:s.value.price,total:s.value.price,paymentMethod:s.value.financingType,financingType:s.value.financingType,downPayment:s.value.downPayment,monthlyPayment:s.value.monthlyPayment,term:s.value.term,interestRate:s.value.interestRate,deliveryDate:s.value.deliveryDate,validUntil:s.value.validUntil,notes:s.value.notes,description:s.value.notes,image:s.value.image},timestamp:((C=o.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!o.item};f("save",n)};return d({submit:a,isValid:b,offerData:s}),(n,u)=>(i(),r("div",Bn,[e.hideHeader?y("",!0):(i(),r("div",Wn,[t("h5",Ln,m(e.item?"Edit Offer":"Create Offer"),1),t("button",{onClick:u[0]||(u[0]=C=>n.$emit("cancel")),class:"text-sub hover:text-body"},[...u[11]||(u[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e.selectedVehicle?(i(),r("div",Rn,[u[12]||(u[12]=t("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),t("div",zn,[t("div",Pn,[e.selectedVehicle.image?(i(),r("img",{key:0,src:e.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Hn)):(i(),r("i",Kn))]),t("div",null,[t("h4",Yn,m(e.selectedVehicle.brand)+" "+m(e.selectedVehicle.model)+" ("+m(e.selectedVehicle.year)+") ",1),t("p",Qn,"Base Price: € "+m(h(e.selectedVehicle.price)),1)])])])):y("",!0),t("div",Gn,[t("div",null,[u[13]||(u[13]=t("label",{class:"block text-xs font-medium text-body mb-1"},[F(" Offer Price (€) "),t("span",{class:"text-red-500"},"*")],-1)),q(t("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=C=>s.value.price=C),class:"input",placeholder:"Enter offer price"},null,512),[[j,s.value.price]])]),t("div",null,[u[15]||(u[15]=t("label",{class:"block text-xs font-medium text-body mb-1"},[F(" Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),q(t("select",{"onUpdate:modelValue":u[2]||(u[2]=C=>s.value.financingType=C),class:"input"},[...u[14]||(u[14]=[t("option",{value:""},"Select payment method",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"finance"},"Finance",-1),t("option",{value:"lease"},"Lease",-1)])],512),[[$e,s.value.financingType]])]),s.value.financingType==="finance"||s.value.financingType==="lease"?(i(),r("div",Jn,[t("div",null,[u[16]||(u[16]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),q(t("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=C=>s.value.downPayment=C),class:"input",placeholder:"0"},null,512),[[j,s.value.downPayment]])]),t("div",null,[u[17]||(u[17]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),q(t("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=C=>s.value.monthlyPayment=C),class:"input",placeholder:"Calculated automatically"},null,512),[[j,s.value.monthlyPayment]])]),t("div",null,[u[18]||(u[18]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),q(t("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=C=>s.value.term=C),class:"input",placeholder:"36"},null,512),[[j,s.value.term]])]),t("div",null,[u[19]||(u[19]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),q(t("input",{type:"number",step:"0.1","onUpdate:modelValue":u[6]||(u[6]=C=>s.value.interestRate=C),class:"input",placeholder:"3.5"},null,512),[[j,s.value.interestRate]])])])):y("",!0),t("div",null,[u[20]||(u[20]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),q(t("input",{type:"date","onUpdate:modelValue":u[7]||(u[7]=C=>s.value.deliveryDate=C),class:"input"},null,512),[[j,s.value.deliveryDate]])]),t("div",null,[u[21]||(u[21]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),q(t("input",{type:"date","onUpdate:modelValue":u[8]||(u[8]=C=>s.value.validUntil=C),class:"input"},null,512),[[j,s.value.validUntil]])]),t("div",null,[u[22]||(u[22]=t("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),q(t("textarea",{"onUpdate:modelValue":u[9]||(u[9]=C=>s.value.notes=C),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[j,s.value.notes]])])]),e.hideActions?y("",!0):(i(),r("div",Xn,[t("button",{onClick:u[10]||(u[10]=C=>n.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),t("button",{onClick:a,disabled:!b.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},m(e.item?"Update Offer":"Create Offer"),9,Zn)]))]))}},el={class:"p-6"},tl={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(e,{emit:d}){const l=d,o=I(null),f=w(()=>{var a;return((a=o.value)==null?void 0:a.isValid)||!1}),s=()=>{var a;(a=o.value)==null||a.submit()},b=a=>{a||l("close")},h=a=>{l("save",a),l("close")};return(a,n)=>(i(),B(p(ye),{open:e.show,"onUpdate:open":b},{default:S(()=>[k(p(ue),null,{default:S(()=>[k(p(ce),{class:"fixed inset-0 z-50 bg-black/50"}),k(p(me),{class:"w-full sm:max-w-2xl p-0"},{default:S(()=>[k(p(fe),{class:"p-6 pb-4 border-b border"},{default:S(()=>[k(p(pe),null,{default:S(()=>[...n[2]||(n[2]=[F("Create Offer",-1)])]),_:1}),k(p(Ae),null,{default:S(()=>[...n[3]||(n[3]=[F("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),t("div",el,[k(_n,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"requested-car":e.requestedCar,"recommended-cars":e.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:o,onSave:h,onCancel:n[0]||(n[0]=u=>a.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),k(p(be),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:S(()=>[k(p(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[1]||(n[1]=u=>a.$emit("close"))}),k(p(U),{label:e.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:s},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},al={class:"space-y-4"},sl={key:0},nl={class:"flex flex-wrap gap-2"},ll=["onClick"],il={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(e,{emit:d}){const l=e,o=d,f=I(""),s=h=>{h||o("close")};re(()=>l.show,h=>{h&&(f.value="")});const b=()=>{const h=f.value.trim();h&&(l.existingTags.includes(h)||(o("add",h),f.value=""))};return(h,a)=>(i(),B(p(ye),{open:e.show,"onUpdate:open":s},{default:S(()=>[k(p(ue),null,{default:S(()=>[k(p(ce),{class:"fixed inset-0 z-50 bg-black/50"}),k(p(me),{class:"w-full sm:max-w-md"},{default:S(()=>[k(p(fe),null,{default:S(()=>[k(p(pe),null,{default:S(()=>[...a[2]||(a[2]=[F("Add Tag",-1)])]),_:1})]),_:1}),t("div",al,[t("div",null,[a[3]||(a[3]=t("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),q(t("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>f.value=n),onKeyup:Ue(b,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[j,f.value]])]),e.existingTags.length>0?(i(),r("div",sl,[a[4]||(a[4]=t("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),t("div",nl,[(i(!0),r(Q,null,Z(e.existingTags,n=>(i(),r("button",{key:n,onClick:u=>f.value=n,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},m(n),9,ll))),128))])])):y("",!0)]),k(p(be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[k(p(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=n=>h.$emit("close"))}),k(p(U),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value.trim(),onClick:b},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},he={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function ol(e){if(!e)return he.default;const d=e.toLowerCase().trim();return he[d]||he.default}function rl({store:e,taskId:d,getTabForItemType:l,isOverviewModalAction:o}){const f=I(null),s=I(null),b=I("overview"),h=I("email"),a=I([]);re(b,()=>{f.value=null,s.value=null});const n=w(()=>[...e.currentActivities.value,...a.value.filter(T=>!T.activityId)].filter(T=>{const O=l(T.type);return b.value==="overview"?O==="overview":O===b.value}).sort((T,O)=>{const M=new Date(T.timestamp||0);return new Date(O.timestamp||0)-M})),u=x=>(s.value=null,b.value==="overview"&&o&&o(x)?{type:"overview-modal",action:x}:(["email","sms","whatsapp","call"].includes(x)?(h.value=x,f.value="communication"):f.value=x,null)),C=async x=>{var T;if(x.isEdit){const O=a.value.findIndex(M=>M.id===x.id);O>-1&&(a.value[O]={...a.value[O],...x}),(T=s.value)!=null&&T.activityId&&await e.updateActivity(d.value,s.value.activityId,{type:x.communicationType||x.type,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}else{const O=x.communicationType||x.type,M=await e.addActivity(d.value,{type:O,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data});a.value.push({id:M.id,type:O==="email"||O==="whatsapp"||O==="sms"?"communication":O,action:x.action,content:x.content,fileName:x.fileName,data:x.data,timestamp:M.timestamp,activityId:M.id})}f.value=null,s.value=null},E=()=>{f.value=null,s.value=null},D=x=>{l(x.type)&&(f.value=x.type==="email"||x.type==="whatsapp"||x.type==="sms"||x.type==="communication"?"communication":x.type,s.value=x)},c=async x=>{try{await e.deleteActivity(d.value,x)}catch(T){throw console.error("Error deleting item:",T),T}};return{activeTab:b,showInlineWidget:f,inlineWidgetType:w(()=>f.value),editingItem:s,isEditing:w(()=>s.value!==null),communicationType:h,inlineContent:a,filteredInlineContent:n,handleAddNewAction:u,handleWidgetSave:C,handleWidgetCancel:E,handleEditItem:D,handleDeleteItem:c}}const dl={class:"flex-1 flex flex-col overflow-hidden h-full"},ul={class:"bg-surface border-b border shrink-0"},cl={class:"px-4 md:px-8 py-3 md:py-4"},ml={class:"flex-1 flex flex-row overflow-hidden"},fl={class:"flex-1 flex flex-col overflow-hidden min-w-0"},pl={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},bl={class:"mb-4"},yl={key:0},vl={key:0},gl={key:1,class:"mb-6"},xl={key:2,class:"space-y-4 mb-6 px-1"},hl={key:1},kl={key:0,class:"space-y-4 mb-6 px-1"},Al={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(e,{emit:d}){const l=e,o=Ee(),f=Ie(),s=w(()=>l.task.id),b=w(()=>l.type==="contact"?"bg-blue-100 text-blue-600":l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),h=w(()=>o.path.startsWith("/tasks")&&!o.path.startsWith("/customer")),a=I(o.path.startsWith("/tasks")&&!o.path.startsWith("/customer"));re(()=>o.path,$=>{a.value=$.startsWith("/tasks")&&!$.startsWith("/customer")});const n=()=>{f.push({path:`/customer/${l.task.id}`,query:{type:l.type}})};function u($){x.value=!1}const C=()=>{T.value=!0},E=async $=>{var R,W,K,V;const A=$.name;l.type==="lead"?await((W=(R=l.storeAdapter).updateLead)==null?void 0:W.call(R,l.task.id,{assignee:A,assigneeType:$.type,teamId:$.type==="team"?$.id:null})):l.type==="opportunity"&&await((V=(K=l.storeAdapter).updateOpportunity)==null?void 0:V.call(K,l.task.id,{assignee:A,assigneeType:$.type,teamId:$.type==="team"?$.id:null})),T.value=!1},D=I(!1),c=I(null),x=I(!1),T=I(!1),O=I(!1),{activeTab:M,showInlineWidget:L,editingItem:_,communicationType:ve,inlineContent:xe,filteredInlineContent:z,handleAddNewAction:ne,handleWidgetSave:P,handleWidgetCancel:G,handleEditItem:ee,handleDeleteItem:te}=rl({store:l.storeAdapter,taskId:s,getTabForItemType:ol,isOverviewModalAction:$=>M.value==="overview"&&l.addNewConfig.overviewActions.includes($)});re(()=>l.task.id,()=>{M.value="overview"});const le=$=>{const A=ne($);A&&A.modalAction&&(c.value=A.modalAction,D.value=!0)},ge=$=>{if($==="appointment"){x.value=!0;return}const A={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes($))c.value=$,D.value=!0;else{const R=A[$];R?(M.value=R,setTimeout(()=>{le($),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):le($)}},ae=()=>{D.value=!1,c.value=null},ie=async $=>{await P($),ae()},g=w(()=>[{key:"overview",label:"Overview"},{key:"note",label:"Notes"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),v=w(()=>[...l.storeAdapter.currentActivities.value,...xe.value]);w(()=>c.value==="financing"?"Add Financing":c.value==="tradein"?"Add Trade-in":c.value==="purchase"?"Create Purchase Offer":"");const H=async $=>{if(l.type==="opportunity")try{await l.storeAdapter.addVehicle(l.task.id,$.vehicleData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(A){console.error("Error selecting vehicle:",A)}},oe=async $=>{if(l.type==="opportunity")try{await l.storeAdapter.createOffer(l.task.id,$.offerData),l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id)}catch(A){console.error("Error creating offer:",A)}},Ne=async $=>{var W,K,V,Te;const A=l.task.tags||[];if(A.includes($)){O.value=!1;return}const R=[...A,$];try{l.type==="lead"?await((K=(W=l.storeAdapter).updateLead)==null?void 0:K.call(W,l.task.id,{tags:R})):l.type==="opportunity"&&await((Te=(V=l.storeAdapter).updateOpportunity)==null?void 0:Te.call(V,l.task.id,{tags:R})),l.type==="lead"&&l.storeAdapter.loadLeadById?await l.storeAdapter.loadLeadById(l.task.id):l.type==="opportunity"&&l.storeAdapter.loadOpportunityById&&await l.storeAdapter.loadOpportunityById(l.task.id),O.value=!1}catch(Ve){console.error("Error adding tag:",Ve)}};return($,A)=>{var R,W,K;return i(),r("div",dl,[t("header",ul,[t("div",cl,[k(mt,{initials:e.task.customer.initials,name:e.task.customer.name,email:e.task.customer.email,phone:e.task.customer.phone,"third-field-value":e.task.customer.address,"avatar-color-class":b.value,"task-type":e.type,"customer-id":((R=e.task.customer)==null?void 0:R.id)||e.task.customerId||e.task.id,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:ge,onAddTag:A[0]||(A[0]=V=>O.value=!0)},{tags:S(()=>[(i(!0),r(Q,null,Z(e.task.tags,V=>(i(),r("span",{key:V,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},m(V),1))),128))]),"name-action":S(()=>[h.value?(i(),r("button",{key:0,onClick:n,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...A[9]||(A[9]=[t("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id"])])]),t("div",ml,[t("div",fl,[t("main",pl,[t("div",bl,[k(bt,{modelValue:p(M),"onUpdate:modelValue":A[1]||(A[1]=V=>Be(M)?M.value=V:null),tabs:g.value,class:"mb-0"},null,8,["modelValue","tabs"])]),p(M)==="overview"?(i(),r("div",yl,[e.type!=="contact"?(i(),r("div",vl,[k(ha,{stage:e.task.displayStage||e.task.stage,owner:e.task.assignee,source:e.task.source||"","delivery-substatus":e.task.deliverySubstatus,activities:e.task.activities||[],"entity-type":e.type,"request-type":e.task.requestType||((W=e.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((K=e.task.requestedCar)==null?void 0:K.requestMessage)||"","requested-car":e.task.requestedCar,task:e.task,onReassign:C},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):y("",!0),we($.$slots,"pinned-extra",{task:e.task}),e.managementWidget?(i(),r("div",gl,[(i(),B(We(e.managementWidget),{lead:e.type==="lead"?e.task:void 0,opportunity:e.type==="opportunity"?e.task:void 0,contact:e.type==="contact"?e.task:void 0,activities:v.value,onCarAdded:A[2]||(A[2]=V=>$.$emit("car-added",V)),onConvertToLead:A[3]||(A[3]=V=>$.$emit("convert-to-lead")),onConvertToOpportunity:A[4]||(A[4]=V=>$.$emit("convert-to-opportunity")),onVehicleSelected:H,onCreateOffer:oe},null,40,["lead","opportunity","contact","activities"]))])):y("",!0),p(z).length>0?(i(),r("div",xl,[(i(!0),r(Q,null,Z(p(z),V=>(i(),B(qe,{key:V.id,item:V,"task-type":e.type,"customer-initials":"SK",onEdit:p(ee),onDelete:p(te)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)])):(i(),r("div",hl,[k($a,{actions:e.addNewConfig.tabActions,"active-tab":p(M),onAction:le},null,8,["actions","active-tab"]),t("div",null,[p(L)==="communication"?(i(),B(dn,{key:0,type:p(ve),"task-type":e.type,"task-id":e.task.id,item:p(_),onSave:p(P),onCancel:p(G)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):y("",!0),p(L)==="note"?(i(),B(pn,{key:1,item:p(_),"task-type":e.type,"task-id":e.task.id,onSave:p(P),onCancel:p(G)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0),p(L)==="attachment"?(i(),B(wn,{key:2,item:p(_),"task-type":e.type,"task-id":e.task.id,onSave:p(P),onCancel:p(G)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0)]),p(z).length>0?(i(),r("div",kl,[(i(!0),r(Q,null,Z(p(z),V=>(i(),B(qe,{key:V.id,item:V,"task-type":e.type,"customer-initials":"SK",onEdit:p(ee),onDelete:p(te)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)]))])]),k(sn,{title:"Activity summary",activities:v.value,collapsed:a.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:A[5]||(A[5]=V=>a.value=!a.value)},null,8,["activities","collapsed"])]),k(qn,{show:c.value==="financing"&&D.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:ie,onClose:ae},null,8,["show","task-type","task-id"]),k(En,{show:c.value==="tradein"&&D.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:ie,onClose:ae},null,8,["show","task-type","task-id"]),k(tl,{show:c.value==="purchase"&&D.value,item:null,"task-type":e.type,"task-id":e.task.id,"requested-car":e.type==="lead"?e.task.requestedCar:null,"recommended-cars":[],onSave:ie,onClose:ae},null,8,["show","task-type","task-id","requested-car"]),k(Le,{show:T.value,onClose:A[6]||(A[6]=V=>T.value=!1),onConfirm:E},null,8,["show"]),x.value?(i(),B(Re,{key:0,show:x.value,customer:e.task.customer,assignee:e.task.assignee,"disabled-fields":["customer"],onCreate:u,onCancel:A[7]||(A[7]=V=>x.value=!1)},null,8,["show","customer","assignee"])):y("",!0),k(il,{show:O.value,"existing-tags":e.task.tags||[],onClose:A[8]||(A[8]=V=>O.value=!1),onAdd:Ne},null,8,["show","existing-tags"])])}}},De={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:e=>e.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:e=>e.scheduledAppointment?`Scheduled for ${e.formatDateTime(e.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:e=>e.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:e=>e.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:e=>e.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:e=>{const d=e.deliverySubstatus;return d==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:d==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},ke={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function J(e){if(!e)return 0;const d=new Date(e),o=Math.abs(new Date-d);return Math.ceil(o/(1e3*60*60*24))}const se={"no-appointment":e=>!e.scheduledAppointment,"has-appointment":e=>!!e.scheduledAppointment,"appointment-past-not-completed":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)<new Date&&e.scheduledAppointment.status!=="completed":!1,"has-future-appointment":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)>new Date:!1,"no-offers":e=>!e.hasOffers,"has-offers":e=>e.hasOffers,"qualified-no-offers-7-13-days":e=>{const d=Y(),l=d.getSetting("oofbMinDays"),o=d.getSetting("oofbMaxDays"),f=J(e.opportunity.createdAt);return f>=l&&f<o+1&&!e.hasOffers},"qualified-no-offers-14-plus-days":e=>{const l=Y().getSetting("ufbDays");return J(e.opportunity.createdAt)>=l&&!e.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const l=Y().getSetting("ofbDays");return J(e.opportunity.lastActivity||e.opportunity.createdAt)>=l&&!e.opportunity.contractDate&&e.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const l=Y().getSetting("nfuDays"),o=J(e.opportunity.lastActivity||e.opportunity.createdAt),f=e.scheduledAppointment&&new Date(e.scheduledAppointment.start)>new Date;return o>=l&&!e.opportunity.contractDate&&!f&&e.hasOffers},"contract-7-plus-days-no-delivery":e=>{var s;if(!e.opportunity.contractDate)return!1;const l=Y().getSetting("cfbDays"),o=J(e.opportunity.contractDate),f=(s=e.activities)==null?void 0:s.some(b=>{var h;return b.type==="delivery"||((h=b.action)==null?void 0:h.toLowerCase().includes("delivered"))});return o>=l&&!f},"delivery-date-set":e=>!!e.opportunity.deliveryDate,"delivery-3-plus-days":e=>{var s;const d=(s=e.activities)==null?void 0:s.find(b=>{var h;return b.type==="delivery"||((h=b.action)==null?void 0:h.toLowerCase().includes("delivered"))});if(!d)return!1;const o=Y().getSetting("dfbDays");return J(d.timestamp)>=o},"is-awaiting-delivery":e=>e.deliverySubstatus==="Awaiting Delivery","is-delivered":e=>e.deliverySubstatus==="Delivered","has-no-delivery":e=>!e.deliverySubstatus||e.deliverySubstatus===null,"is-closed":e=>{const d=e.stage;return d==="Closed Won"||d==="Closed Lost"},"is-closed-with-task-widget":e=>se["is-closed"](e)&&e.hasActiveTaskWidget,"opportunity-abandoned":e=>{if(se["is-closed"](e))return!1;const d=Y(),l=d.getSetting("abandonedOpportunityDays");if(!d.getSetting("abandonedEligibleStages").includes(e.stage))return!1;const f=e.opportunity.lastActivity||e.opportunity.createdAt;return J(f)>=l}};function Dl(e,d){if(se["is-closed-with-task-widget"](d))return[ke.reopen,ke.requalify,ke.closeLost];const l=De[e];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(o=>{if(!o.conditional)return!0;const f=se[o.conditional];return f?f(d):!0})}function Tl(e,d){const l=De[e];if(!l||!l.taskWidgets)return null;const f=Y().getSetting("autoCloseWidgetsOnClose"),s=se["is-closed"]({stage:e});for(const b of l.taskWidgets){if(f&&s&&(b.type==="NFU"||b.type==="OFB"))continue;const h=se[b.condition];if(h&&h(d))return b.type}return null}function Ol(e,d){const l=De[e];if(!l||!l.primaryAction)return null;const o=l.primaryAction;return{...o,title:typeof o.title=="function"?o.title(d):o.title,description:typeof o.description=="function"?o.description(d):o.description,label:typeof o.label=="function"?o.label(d):o.label}}function ql(e){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[e]||"Task"}function Il(e){return e==="Closed Won"||e==="Closed Lost"}const Nl={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(e,{emit:d}){const l=d,o=s=>{s||l("close")},f=()=>{l("close")};return(s,b)=>(i(),B(p(ye),{open:e.show,"onUpdate:open":o},{default:S(()=>[k(p(ue),null,{default:S(()=>[k(p(ce),{class:"fixed inset-0 z-50 bg-black/50"}),k(p(me),{class:"w-full sm:max-w-md"},{default:S(()=>[k(p(fe),null,{default:S(()=>[k(p(pe),null,{default:S(()=>[F(m(e.title),1)]),_:1})]),_:1}),b[0]||(b[0]=t("div",{class:"py-8 flex items-center justify-center"},[t("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),k(p(be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[k(p(U),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Al as _,pn as a,Ol as b,Dl as c,ql as d,_n as e,Nl as f,Tl as g,Il as i};
