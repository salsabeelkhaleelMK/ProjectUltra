import{r as y,H as ee,c as C,p as te,o as v,L as I,h as l,e as h,z as m,B as g,t as F,u as ae,G as se,k as le,K as i,l as K,F as oe,i as ne,g as ie,j as re,m as ue,d as ce,M as de,n as P}from"./index-HNz1us-X.js";import{_ as pe}from"./PageHeader-CWgBBom2.js";import{_ as me}from"./ModalShell-D1HAXo86.js";import{y as ge}from"./components-BRQB_lDP.js";import{u as ye}from"./opportunities-CZX_mc_B.js";import{u as ve}from"./contacts-BYnx_R1b.js";import{g as be,a as xe,d as G}from"./formatters-Br5TsDxy.js";const fe={class:"space-y-4"},Ce={key:0},he={key:1},we={key:2},ke={key:3},Ne=["placeholder"],De={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},Ae={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(b,{emit:D}){const d=b,w=D,n=y({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});ee(()=>d.show,c=>{c&&(n.value={customerName:d.initialData.customerName||"",email:d.initialData.email||"",phone:d.initialData.phone||"",company:d.initialData.company||"",vehicle:d.initialData.vehicle||"",value:d.initialData.value||"",reason:d.initialData.reason||""})});const k=C(()=>({contacts:"Add New Contact","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[d.activeTab]||"Add New Item"),x=C(()=>({contacts:"Contact","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[d.activeTab]||"Item"),L=()=>{w("save",{...n.value}),n.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(c,a)=>(v(),te(me,{show:b.show,title:k.value,subtitle:"Fill in the details below",size:"md",onClose:a[14]||(a[14]=r=>c.$emit("close")),onCancel:a[15]||(a[15]=r=>c.$emit("close"))},{footer:I(()=>[l("div",De,[l("button",{onClick:a[13]||(a[13]=r=>c.$emit("close")),class:"btn-secondary text-sm"}," Cancel "),l("button",{onClick:L,class:"btn-primary"}," Create "+F(x.value),1)])]),default:I(()=>[l("div",fe,[b.activeTab==="contacts"?(v(),h("div",Ce,[a[16]||(a[16]=l("label",{class:"block label-upper mb-2"},"Contact Name",-1)),m(l("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>n.value.customerName=r),type:"text",placeholder:"Enter contact name...",class:"input"},null,512),[[g,n.value.customerName]]),a[17]||(a[17]=l("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),m(l("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>n.value.email=r),type:"email",placeholder:"contact@example.com",class:"input"},null,512),[[g,n.value.email]]),a[18]||(a[18]=l("label",{class:"block label-upper mb-2 mt-4"},"Phone",-1)),m(l("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>n.value.phone=r),type:"tel",placeholder:"+49...",class:"input"},null,512),[[g,n.value.phone]]),a[19]||(a[19]=l("label",{class:"block label-upper mb-2 mt-4"},"Company (optional)",-1)),m(l("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>n.value.company=r),type:"text",placeholder:"Company name...",class:"input"},null,512),[[g,n.value.company]])])):b.activeTab==="open-leads"?(v(),h("div",he,[a[20]||(a[20]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>n.value.customerName=r),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[g,n.value.customerName]]),a[21]||(a[21]=l("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),m(l("input",{"onUpdate:modelValue":a[5]||(a[5]=r=>n.value.email=r),type:"email",placeholder:"customer@example.com",class:"input"},null,512),[[g,n.value.email]]),a[22]||(a[22]=l("label",{class:"block label-upper mb-2 mt-4"},"Requested Vehicle",-1)),m(l("input",{"onUpdate:modelValue":a[6]||(a[6]=r=>n.value.vehicle=r),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"input"},null,512),[[g,n.value.vehicle]])])):b.activeTab==="open-opportunities"||b.activeTab==="in-negotiation"?(v(),h("div",we,[a[23]||(a[23]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":a[7]||(a[7]=r=>n.value.customerName=r),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[g,n.value.customerName]]),a[24]||(a[24]=l("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),m(l("input",{"onUpdate:modelValue":a[8]||(a[8]=r=>n.value.vehicle=r),type:"text",placeholder:"e.g., Porsche Taycan",class:"input"},null,512),[[g,n.value.vehicle]]),a[25]||(a[25]=l("label",{class:"block label-upper mb-2 mt-4"},"Opportunity Value",-1)),m(l("input",{"onUpdate:modelValue":a[9]||(a[9]=r=>n.value.value=r),type:"number",placeholder:"0",class:"input"},null,512),[[g,n.value.value]])])):(v(),h("div",ke,[a[26]||(a[26]=l("label",{class:"block label-upper mb-2"},"Customer Name",-1)),m(l("input",{"onUpdate:modelValue":a[10]||(a[10]=r=>n.value.customerName=r),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[g,n.value.customerName]]),a[27]||(a[27]=l("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),m(l("input",{"onUpdate:modelValue":a[11]||(a[11]=r=>n.value.vehicle=r),type:"text",placeholder:"Vehicle model",class:"input"},null,512),[[g,n.value.vehicle]]),a[28]||(a[28]=l("label",{class:"block label-upper mb-2 mt-4"},"Reason",-1)),m(l("textarea",{"onUpdate:modelValue":a[12]||(a[12]=r=>n.value.reason=r),rows:"3",placeholder:`Reason for ${b.activeTab==="won"?"win":"loss"}...`,class:"input resize-none"},null,8,Ne),[[g,n.value.reason]])]))])]),_:1},8,["show","title"]))}},Se={class:"page-container"},$e={class:"p-4 md:p-8"},Oe={class:"flex items-center gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide"},Te=["onClick"],Ve={class:"text-sm font-medium text-foreground whitespace-nowrap"},Ue={class:"mb-6 flex justify-end"},qe={class:"table-wrapper w-full"},je={__name:"Customers",setup(b){const D=ce();de();const d=ae(),w=se(),n=ye(),k=ve(),x=C(()=>{const e=w.leads.filter(u=>!u.isDisqualified),s=n.opportunities.filter(u=>u.stage!=="Closed Won"&&u.stage!=="Closed Lost"),o=n.opportunities.filter(u=>u.stage==="In Negotiation"||u.stage==="In negotiation"),N=n.opportunities.filter(u=>u.stage==="Closed Won"),A=n.opportunities.filter(u=>u.stage==="Closed Lost");return{contacts:k.contacts.length,openLeads:e.length,openOpportunities:s.length-o.length,inNegotiation:o.length,won:N.length,lost:A.length}}),c=y(d.isOperator()?"open-leads":d.isManager()||d.isSalesman()?"in-negotiation":"contacts");y("");const a=y(!1),r=y(!1),M=y("all"),p=y({status:"",priority:"",source:""}),R=y({pageIndex:0,pageSize:10}),E=y(""),j=y([]),f=y({status:p.value.status||void 0,priority:p.value.priority||void 0,source:p.value.source||void 0});y({}),watch(()=>p.value.status,e=>{f.value.status=e||void 0}),watch(()=>p.value.priority,e=>{f.value.priority=e||void 0}),watch(()=>p.value.source,e=>{f.value.source=e||void 0}),watch(()=>f.value.status,e=>{p.value.status=e||""}),watch(()=>f.value.priority,e=>{p.value.priority=e||""}),watch(()=>f.value.source,e=>{p.value.source=e||""});const W=y({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),Q=C(()=>{const e=[{key:"contacts",label:"Contacts & Accounts",count:x.value.contacts,borderColor:"border-t-purple-600",badgeColor:"bg-purple-600 text-white"},{key:"open-leads",label:"Open Leads",count:x.value.openLeads,borderColor:"border-t-blue-600",badgeColor:"bg-blue-600 text-white"},{key:"open-opportunities",label:"Open opportunities",count:x.value.openOpportunities,borderColor:"border-t-orange-500",badgeColor:"bg-orange-500 text-white"},{key:"in-negotiation",label:"In negotiation",count:x.value.inNegotiation,borderColor:"border-t-blue-500",badgeColor:"bg-blue-500 text-white"},{key:"won",label:"Won",count:x.value.won,borderColor:"border-t-green-500",badgeColor:"bg-green-500 text-white"},{key:"lost",label:"Lost",count:x.value.lost,borderColor:"border-t-red-500",badgeColor:"bg-red-500 text-white"}];return d.isOperator()?e.filter(s=>s.key==="contacts"||s.key==="open-leads"):d.isSalesman()?e.filter(s=>s.key!=="open-leads"):e}),H=()=>{W.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},a.value=!1},J=C(()=>{let e=k.contacts;M.value==="contacts"?e=k.contacts.filter(t=>!t.company||t.company===""):M.value==="accounts"&&(e=k.contacts.filter(t=>t.company&&t.company!==""));const s=e.map(t=>({id:`contact-${t.id}`,stageKey:"contacts",customer:t.name,email:t.email,phone:t.phone,company:t.company||"-",initials:t.initials||t.name.slice(0,2).toUpperCase(),source:t.source||"Marketing",tags:t.tags||[],type:t.company&&t.company!==""?"account":"contact"}));let o=w.leads;r.value?o=w.leads.filter(t=>t.isDisqualified===!0):o=w.leads.filter(t=>!t.isDisqualified);const N=o.map(t=>{var u,S,$,O,T,V,U;return{id:`lead-${t.id}`,stageKey:"open-leads",customer:t.customer.name,email:t.customer.email,initials:t.customer.initials||t.customer.name.slice(0,2).toUpperCase(),nextAction:G(t.nextActionDue)||"No due date",nextActionFull:xe(t.nextActionDue),deadlineStatus:be(t.nextActionDue),car:`${((u=t.requestedCar)==null?void 0:u.brand)||""} ${((S=t.requestedCar)==null?void 0:S.model)||""}`.trim()||"N/A",carStatus:(($=t.requestedCar)==null?void 0:$.stockDays)!==void 0&&((O=t.requestedCar)==null?void 0:O.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((T=t.requestedCar)==null?void 0:T.stockDays)!==void 0&&((V=t.requestedCar)==null?void 0:V.stockDays)!==null?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",requestType:((U=t.requestedCar)==null?void 0:U.requestType)||"Quotation",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:q(t.createdAt),lastActivity:q(t.lastActivity),status:t.status,statusClass:Y(t.status),priority:t.priority||"Normal"}}),A=n.opportunities.map(t=>{var S,$,O,T,V,U;let u="open-opportunities";return t.stage==="In Negotiation"||t.stage==="In negotiation"?u="in-negotiation":t.stage==="Closed Won"?u="won":t.stage==="Closed Lost"&&(u="lost"),{id:`opp-${t.id}`,stageKey:u,customer:t.customer.name,email:t.customer.email,initials:t.customer.initials||t.customer.name.slice(0,2).toUpperCase(),nextAction:G(t.expectedCloseDate)||"No due date",car:`${((S=t.vehicle)==null?void 0:S.brand)||""} ${(($=t.vehicle)==null?void 0:$.model)||""}`.trim()||"N/A",carStatus:((O=t.vehicle)==null?void 0:O.stockDays)!==void 0&&((T=t.vehicle)==null?void 0:T.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((V=t.vehicle)==null?void 0:V.stockDays)!==void 0&&((U=t.vehicle)==null?void 0:U.stockDays)!==null?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",requestType:"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:q(t.createdAt),lastActivity:q(t.lastActivity),status:t.stage,statusClass:u==="in-negotiation"?"bg-orange-100 text-orange-700":u==="won"?"bg-green-100 text-green-700":u==="lost"?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700",priority:t.priority||"Normal"}});return[...s,...N,...A]}),B=C(()=>{let e=J.value.filter(s=>s.stageKey===c.value);return p.value.status&&(e=e.filter(s=>s.status===p.value.status)),p.value.priority&&(e=e.filter(s=>s.priority===p.value.priority)),p.value.source&&(e=e.filter(s=>s.source===p.value.source)),e}),X=e=>{c.value=e},Y=e=>({Valid:"bg-green-100 text-green-700","Not valid":"bg-red-100 text-red-700",Qualified:"bg-gray-100 text-gray-700","Not interested":"bg-red-100 text-red-700",Open:"bg-blue-100 text-blue-700"})[e]||"bg-gray-100 text-gray-700",q=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-";le(async()=>{await k.loadContacts(),await w.loadLeads(),await n.loadOpportunities()});const z=e=>{if(e.stageKey==="contacts"){const o=e.id.split("-")[1];D.push({path:`/customer/${o}`,query:{type:"contact"}});return}const s=e.id.match(/-(\d+)$/);if(c.value==="open-leads"&&e.id.startsWith("lead-")){const o=s?s[1]:e.id.replace("lead-","");D.push({path:`/customer/${o}`,query:{stage:"lead"}})}else if(e.id.startsWith("opp-")){const o=s?s[1]:e.id.replace("opp-","");D.push({path:`/customer/${o}`,query:{stage:"opportunity"}})}else if(e.stageKey==="won"||e.stageKey==="lost"){const o=s?s[1]:e.id.replace("opp-","");D.push({path:`/customer/${o}`,query:{stage:"opportunity"}})}},Z=C(()=>({class:{tr:"cursor-pointer hover:bg-gray-50 transition-colors"}})),_=C(()=>c.value==="contacts"?[{accessorKey:"customer",header:"Contact",meta:{title:"Contact",onOpen:e=>z(e.original)},cell:({row:e})=>{const s=e.original;return i("div",{class:"flex items-center gap-2 md:gap-3"},[i("div",{class:"w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 bg-blue-100 text-blue-600"},s.initials),i("div",{class:"min-w-0"},[i("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},s.customer)])])}},{accessorKey:"company",header:"Company",meta:{title:"Company"},cell:({row:e})=>i("span",{class:"text-sm text-gray-600 truncate block max-w-[100px]"},e.original.company||"-")},{accessorKey:"email",header:"Email",meta:{title:"Email"},cell:({row:e})=>i("div",{class:"text-sm text-gray-600 truncate max-w-[150px]"},e.original.email)},{accessorKey:"phone",header:"Phone",meta:{title:"Phone"},cell:({row:e})=>i("span",{class:"text-sm text-gray-600"},e.original.phone)},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:e})=>i("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},e.original.source)},{accessorKey:"tags",header:"Tags",meta:{title:"Tags"},cell:({row:e})=>{const s=e.original.tags;return s&&s.length>0?i("div",{class:"flex flex-wrap gap-1"},s.map(o=>i("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},o))):i("span",{class:"text-xs text-gray-400"},"-")}},{id:"actions",header:"",meta:{title:"Actions"},cell:()=>i("button",{class:"text-gray-400 hover:text-gray-600"},[i("i",{class:"fa-solid fa-ellipsis-vertical"})])}]:[{accessorKey:"customer",header:"Customer",meta:{title:"Customer",onOpen:e=>z(e.original)},cell:({row:e})=>{const s=e.original;return i("div",{class:"flex items-center gap-2 md:gap-3"},[i("div",{class:"w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 bg-orange-100 text-orange-600"},s.initials),i("div",{class:"min-w-0"},[i("div",{class:"text-sm font-semibold text-gray-900 truncate"},s.customer),i("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},s.email)])])}},{accessorKey:"nextAction",header:"Next action due",meta:{title:"Next action due"},cell:({row:e})=>{var o,N,A;const s=e.original;return s.nextActionFull?i("div",{class:"text-sm"},[i("div",{class:`font-medium mb-0.5 ${((o=s.deadlineStatus)==null?void 0:o.textClass)||"text-gray-600"}`},s.nextActionFull),i("div",{class:`text-xs flex items-center gap-1 ${((N=s.deadlineStatus)==null?void 0:N.textClass)||"text-gray-500"}`},[(A=s.deadlineStatus)!=null&&A.icon?i("i",{class:`fa-solid ${s.deadlineStatus.icon} text-[10px]`}):null,i("span",s.nextAction)])]):"-"}},{accessorKey:"car",header:"Requested car",meta:{title:"Requested car"},cell:({row:e})=>i("div",{class:"flex items-center gap-2"},[i("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"}),i("span",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},e.original.car)])},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:e})=>i("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${e.original.carStatusClass}`},e.original.carStatus)},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:e})=>i("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},e.original.source)},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:e})=>i("div",{class:"flex items-center gap-2"},[i("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},e.original.assigneeInitials),i("span",{class:"text-sm text-gray-600 truncate max-w-[80px] hidden md:inline"},e.original.assignee)])},{accessorKey:"status",header:"Status",meta:{title:"Status"},enableColumnFilter:!0,cell:({row:e})=>i("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${e.original.statusClass}`},e.original.status)},{id:"actions",header:"",meta:{title:"Actions"},cell:()=>i("button",{class:"text-gray-400 hover:text-gray-600"},[i("i",{class:"fa-solid fa-ellipsis-vertical"})])}]);return(e,s)=>(v(),h("div",Se,[K(pe,{title:"Customers",subtitle:"Manage contacts, accounts, leads and opportunities"}),l("div",$e,[l("div",Oe,[(v(!0),h(oe,null,ne(Q.value,o=>(v(),h("button",{key:o.key,onClick:N=>X(o.key),class:P(["flex items-center justify-between gap-3 px-4 py-3 bg-white border border-border rounded-lg cursor-pointer hover:shadow-sm transition-all shrink-0 min-w-[160px] border-t-4",c.value===o.key?o.borderColor:"border-t-border"])},[l("span",Ve,F(o.label),1),l("span",{class:P(["px-2.5 py-1 text-sm font-semibold rounded-full min-w-[32px] text-center",c.value===o.key?o.badgeColor:"bg-muted text-muted-foreground"])},F(o.count),3)],10,Te))),128))]),l("div",Ue,[c.value==="contacts"||c.value==="open-leads"||c.value==="open-opportunities"?(v(),h("button",{key:0,onClick:s[0]||(s[0]=o=>a.value=!0),class:"btn-primary-lg"},[...s[6]||(s[6]=[l("i",{class:"fa-solid fa-plus"},null,-1),re(" Add new ",-1)])])):ie("",!0)]),l("div",qe,[K(ue(ge),{data:B.value,columns:_.value,meta:Z.value,pagination:R.value,"onUpdate:pagination":s[1]||(s[1]=o=>R.value=o),globalFilter:E.value,"onUpdate:globalFilter":s[2]||(s[2]=o=>E.value=o),sorting:j.value,"onUpdate:sorting":s[3]||(s[3]=o=>j.value=o),columnFilters:f.value,"onUpdate:columnFilters":s[4]||(s[4]=o=>f.value=o),paginationOptions:{rowCount:B.value.length},globalFilterOptions:{debounce:300}},{"empty-state":I(()=>[...s[7]||(s[7]=[l("div",{class:"empty-state"},[l("i",{class:"fa-solid fa-inbox empty-state-icon"}),l("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])]),K(Ae,{show:a.value,"active-tab":c.value,"initial-data":W.value,onClose:s[5]||(s[5]=o=>a.value=!1),onSave:H},null,8,["show","active-tab","initial-data"])]))}};export{je as default};
