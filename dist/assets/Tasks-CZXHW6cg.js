import{r as S,d as A,c as r,o as n,a as e,b as v,t as g,z as M,n as N,x as T,y as I,F as K,g as _,B as te,C as me,j as L,D as se,i as le,w as oe,e as U,f as Y,k as j,E as mt,G as pt,T as we,u as ge,H as ke,I as Re,l as De,_ as yt,J as Fe,K as ft,L as gt}from"./index-DOihZbFy.js";import{useOpportunitiesStore as je}from"./opportunities-Eiy6LIZh.js";import{u as vt}from"./users-D6SY3KFZ.js";import{_ as pe}from"./ModalShell-C5oPwjwM.js";import{f as $e,a as Ce,b as fe,c as bt}from"./formatters-CNf1MjAs.js";import{c as xt}from"./calendar-DOw3kFTT.js";const ht={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},wt={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},kt={class:"flex items-center gap-3"},$t={class:"font-bold text-lg text-gray-800"},Ct={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},St={class:"flex gap-2"},Dt={class:"px-5 py-3"},At={class:"relative"},Tt=["placeholder"],qt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Ot=["onClick"],It=["onClick"],Nt={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Vt={class:"flex items-start gap-3.5 pr-6"},Mt={class:"flex-1 min-w-0"},Rt={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Ft={class:"text-gray-600 text-xs mt-1 truncate"},jt={class:"text-right shrink-0"},Ut={class:"flex items-center gap-2 flex-wrap mt-3"},Lt={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change","close"],setup(t,{emit:x}){const s={mounted(u,m){u.clickOutsideEvent=i=>{u===i.target||u.contains(i.target)||m.value()},document.addEventListener("click",u.clickOutsideEvent)},unmounted(u){document.removeEventListener("click",u.clickOutsideEvent)}},c=t,o=S(""),a=A(()=>{let u=c.items;if(c.typeFilter&&c.typeFilter!=="all"&&(u=u.filter(m=>m.type===c.typeFilter)),o.value){const m=o.value.toLowerCase();u=u.filter(i=>{const l=c.getName(i).toLowerCase(),d=c.getVehicleInfo(i).toLowerCase();return l.includes(m)||d.includes(m)})}return u}),p=u=>{const m=u.compositeId||`${u.type||"task"}-${u.id}`||u.id;return c.selectedId===m};return(u,m)=>(n(),r("div",ht,[e("div",wt,[e("div",kt,[t.showMobileClose?(n(),r("button",{key:0,onClick:m[0]||(m[0]=i=>u.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...m[5]||(m[5]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):v("",!0),e("h2",$t,g(t.title),1)]),m[6]||(m[6]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[M(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(n(),r("div",Ct,[e("div",St,[e("button",{onClick:m[1]||(m[1]=i=>u.$emit("filter-change","all")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:m[2]||(m[2]=i=>u.$emit("filter-change","lead")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:m[3]||(m[3]=i=>u.$emit("filter-change","opportunity")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):v("",!0),e("div",Dt,[e("div",At,[m[7]||(m[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),T(e("input",{"onUpdate:modelValue":m[4]||(m[4]=i=>o.value=i),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Tt),[[I,o.value]])])]),e("div",qt,[(n(!0),r(K,null,_(a.value,i=>(n(),r("div",{key:i.id,onClick:l=>u.$emit("select",i.compositeId||`${i.type||"task"}-${i.id}`||i.id),class:N(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",p(i)?typeof t.selectedClass=="function"?t.selectedClass(i):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(i):t.unselectedClass])},[t.showMenu?(n(),r("button",{key:0,onClick:te(l=>u.$emit("menu-click",i.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...m[8]||(m[8]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,It)):v("",!0),t.openMenuId===i.id&&t.showMenu?T((n(),r("div",Nt,[me(u.$slots,"menu",{item:i})])),[[s,()=>u.$emit("menu-close")]]):v("",!0),e("div",Vt,[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(i)])},g(t.getInitials(i)),3),e("div",Mt,[e("div",Rt,g(t.getName(i)),1),e("div",Ft,g(t.getVehicleInfo(i)),1)]),e("div",jt,[me(u.$slots,"meta",{item:i}),me(u.$slots,"footer",{item:i})])]),e("div",Ut,[me(u.$slots,"badges",{item:i})])],10,Ot))),128))])]))}},Et={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Bt={class:"flex items-center gap-3"},Pt={key:2,class:"font-bold text-lg text-gray-800"},Wt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},zt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Qt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Ht={class:"text-sm"},Yt={key:2,class:"space-y-6 relative z-10"},Kt={key:0,class:"mb-4 pl-12"},Jt={class:"text-sm font-semibold text-gray-800"},Gt={class:"flex gap-4 relative mb-6"},Xt={class:"flex-1 min-w-0"},Zt={class:"text-sm text-slate-700 leading-snug"},_t={class:"font-bold"},es={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},ts={class:"text-xs text-gray-400 mt-1"},Ne={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:x}){const s=t,c=m=>{const i={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return i[m]||i.default},o=m=>{const i={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return i[m]||i.default},a=m=>{if(!m)return"";const i=new Date(m),l=new Date,d=new Date(l);return d.setDate(d.getDate()-1),i.toDateString()===l.toDateString()?"Today":i.toDateString()===d.toDateString()?"Yesterday":i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=m=>m?new Date(m).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",u=(m,i)=>{if(m===0)return!0;const l=s.activities[m-1];if(!l)return!0;const d=new Date(i.timestamp).toDateString(),y=new Date(l.timestamp).toDateString();return d!==y};return(m,i)=>t.show?(n(),r("div",{key:0,class:N(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Et,[e("div",Bt,[t.mobileFullscreen?(n(),r("button",{key:0,onClick:i[0]||(i[0]=l=>m.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(n(),r("button",{key:1,onClick:i[1]||(i[1]=l=>m.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:N(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):v("",!0),t.collapsed?v("",!0):(n(),r("h2",Pt,g(t.title),1))])]),t.collapsed?v("",!0):(n(),r("div",Wt,[t.activities.length>0?(n(),r("div",zt)):v("",!0),t.activities.length===0?(n(),r("div",Qt,[i[3]||(i[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Ht,g(t.emptyMessage),1)])):(n(),r("div",Yt,[(n(!0),r(K,null,_(t.activities,(l,d)=>(n(),r(K,{key:l.id},[u(d,l)?(n(),r("div",Kt,[e("h3",Jt,g(a(l.timestamp)),1)])):v("",!0),e("div",Gt,[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",o(l.type)])},[e("i",{class:N([c(l.type),"text-sm"])},null,2)],2),e("div",Xt,[e("div",Zt,[e("span",_t,g(l.user),1),M(" "+g(l.action),1)]),l.content?(n(),r("div",es,g(l.content),1)):v("",!0),e("div",ts,g(p(l.timestamp)),1)])])],64))),128))]))]))],2)):v("",!0)}},ss={class:"w-full"},os={class:"flex items-center justify-between gap-3 md:gap-4"},ls={class:"flex items-center gap-3 md:gap-4 flex-1"},as={class:"min-w-0 flex-1"},ns={class:"heading-main truncate"},is={class:"flex flex-wrap items-center gap-2 mt-1"},rs={class:"flex items-center gap-1 ml-2"},ds={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},us={class:"flex items-center gap-4"},cs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ms={class:"flex items-center gap-2"},ps={class:"text-xs text-gray-900 font-medium"},ys={class:"flex items-center gap-2"},fs={class:"text-xs text-gray-900 font-medium"},gs={class:"flex items-center gap-2"},vs={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},bs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},xs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},hs={class:"text-xs text-gray-900 font-medium"},ws={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ks={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},setup(t){const x=S(!1),s=S(null),c=async(o,a)=>{try{await navigator.clipboard.writeText(o),s.value=a,setTimeout(()=>{s.value=null},1500)}catch(p){console.error("Failed to copy:",p)}};return(o,a)=>(n(),r("div",ss,[e("div",os,[e("div",ls,[e("div",{class:N(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},g(t.initials),3),e("div",as,[e("h1",ns,g(t.name),1),e("div",is,[me(o.$slots,"tags")])])]),e("div",rs,[e("button",{onClick:a[0]||(a[0]=p=>x.value=!x.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:N(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":x.value}])},null,2)])])]),x.value?(n(),r("div",ds,[e("div",us,[e("div",cs,[e("div",ms,[a[4]||(a[4]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ps,g(t.email),1),e("button",{onClick:a[1]||(a[1]=te(p=>c(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...a[3]||(a[3]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ys,[a[6]||(a[6]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",fs,g(t.phone),1),e("button",{onClick:a[2]||(a[2]=te(p=>c(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...a[5]||(a[5]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",gs,[e("div",vs,[t.thirdFieldLabel.toLowerCase().includes("address")?(n(),r("i",bs)):(n(),r("i",xs))]),e("span",hs,g(t.thirdFieldValue),1)])])]),s.value?(n(),r("div",ws,g(s.value==="email"?"Email":"Phone")+" copied! ",1)):v("",!0)])):v("",!0)]))}},$s={class:"flex gap-0 md:gap-8 text-base font-medium text-slate-500 py-1"},Cs=["onClick"],Ss={class:"hidden md:inline whitespace-nowrap"},Ds={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const x={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},s=c=>x[c]||"fa-solid fa-circle";return(c,o)=>(n(),r("div",$s,[(n(!0),r(K,null,_(t.tabs,a=>(n(),r("div",{key:a.key,onClick:p=>c.$emit("update:modelValue",a.key),class:N(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===a.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[e("i",{class:N([s(a.key),"text-base md:text-base"])},null,2),e("span",Ss,g(a.label),1),a.count!==void 0?(n(),r("span",{key:0,class:N(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===a.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},g(a.count),3)):v("",!0)],10,Cs))),128))]))}},As={class:"metadata-bar w-full"},Ts={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},qs={class:"text-xs sm:text-sm font-bold text-gray-800"},Os={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Is={class:"text-xs sm:text-sm font-bold text-gray-800"},Ns={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Vs={class:"text-xs sm:text-sm font-bold text-gray-800"},Ms={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""}},setup(t){return(x,s)=>(n(),r("div",As,[e("div",Ts,[s[0]||(s[0]=e("span",{class:"label-upper text-xs"},"Stage",-1)),e("span",qs,g(t.stage),1)]),s[4]||(s[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Os,[s[1]||(s[1]=e("span",{class:"label-upper text-xs"},"Owner",-1)),e("span",Is,g(t.owner),1)]),t.source?(n(),r(K,{key:0},[s[3]||(s[3]=e("div",{class:"metadata-divider"},null,-1)),e("div",Ns,[s[2]||(s[2]=e("span",{class:"label-upper text-xs"},"Source",-1)),e("span",Vs,g(t.source),1)])],64)):v("",!0)]))}},Rs={key:0,class:"flex-grow border-t border-gray-200"},Fs={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},js={key:0,class:"border-t border-gray-100 my-1"},Us={key:1,class:"flex-grow border-t border-gray-200"},Ve={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","purchase-method","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:x}){const s={mounted(h,f){h.clickOutsideEvent=k=>{h===k.target||h.contains(k.target)||f.value()},document.addEventListener("click",h.clickOutsideEvent)},unmounted(h){document.removeEventListener("click",h.clickOutsideEvent)}},c=t,o=x,a=S(!1),p=A(()=>c.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 md:px-4 py-2 md:py-2 text-xs md:text-sm rounded-lg shadow-sm transition-all flex items-center justify-center gap-1.5 md:gap-2 z-20 relative whitespace-nowrap":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),u={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},m=A(()=>{if(!c.activeTab||c.activeTab==="overview")return c.actions.filter(f=>!u[f]);const h=Object.entries(u).filter(([,f])=>f===c.activeTab).map(([f])=>f);return c.actions.filter(f=>h.includes(f))}),i=A(()=>m.value.some(h=>["email","whatsapp","sms"].includes(h))),l=A(()=>m.value.some(h=>["addVehicle","configureVehicle"].includes(h))),d=A(()=>m.value.some(h=>["note","purchase-method","tradein","attachment","requestedCar"].includes(h))),y=h=>{a.value=!1,o("action",h)};return(h,f)=>t.show?(n(),r("div",{key:0,class:N(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?v("",!0):(n(),r("div",Rs)),e("div",{class:N(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:f[0]||(f[0]=te(k=>a.value=!a.value,["stop"])),class:N(p.value)},[...f[11]||(f[11]=[e("i",{class:"fa-solid fa-plus text-[10px] md:text-xs"},null,-1),e("span",{class:"text-xs md:text-sm"},"Add new",-1)])],2),a.value?T((n(),r("div",Fs,[l.value?(n(),r(K,{key:0},[m.value.includes("addVehicle")?(n(),r("button",{key:0,onClick:f[1]||(f[1]=k=>y("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):v("",!0),m.value.includes("configureVehicle")?(n(),r("button",{key:1,onClick:f[2]||(f[2]=k=>y("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):v("",!0)],64)):v("",!0),d.value?(n(),r(K,{key:1},[l.value?(n(),r("div",js)):v("",!0),m.value.includes("note")?(n(),r("button",{key:1,onClick:f[3]||(f[3]=k=>y("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):v("",!0),m.value.includes("purchase-method")?(n(),r("button",{key:2,onClick:f[4]||(f[4]=k=>y("purchase-method")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase Method ")):v("",!0),m.value.includes("tradein")?(n(),r("button",{key:3,onClick:f[5]||(f[5]=k=>y("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):v("",!0),m.value.includes("requestedCar")?(n(),r("button",{key:4,onClick:f[6]||(f[6]=k=>y("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):v("",!0),m.value.includes("attachment")?(n(),r("button",{key:5,onClick:f[7]||(f[7]=k=>y("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):v("",!0)],64)):v("",!0),i.value?(n(),r(K,{key:2},[f[15]||(f[15]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),m.value.includes("email")?(n(),r("button",{key:0,onClick:f[8]||(f[8]=k=>y("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...f[12]||(f[12]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),M(" Send Email ",-1)])])):v("",!0),m.value.includes("whatsapp")?(n(),r("button",{key:1,onClick:f[9]||(f[9]=k=>y("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...f[13]||(f[13]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),M(" Send WhatsApp ",-1)])])):v("",!0),m.value.includes("sms")?(n(),r("button",{key:2,onClick:f[10]||(f[10]=k=>y("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...f[14]||(f[14]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),M(" Send SMS ",-1)])])):v("",!0)],64)):v("",!0)])),[[s,()=>a.value=!1]]):v("",!0)],2),t.inline?v("",!0):(n(),r("div",Us))],2)):v("",!0)}},Ls={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Es={class:"flex items-start gap-3"},Bs={class:"flex-1 min-w-0"},Ps={class:"font-bold text-sm text-slate-800 mb-2"},Ws={class:"space-y-1.5 text-xs text-gray-600"},zs={class:"flex items-center gap-2"},Qs={class:"flex items-center gap-2"},Hs={class:"flex items-center gap-2"},Ys={key:0,class:"mt-2"},Ks={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const x=t,s=A(()=>x.appointmentData.date?new Date(x.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),c=A(()=>x.appointmentData.time?x.appointmentData.time:""),o=a=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[a==null?void 0:a.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(a,p)=>(n(),r("div",Ls,[e("div",Es,[p[3]||(p[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Bs,[e("h4",Ps,g(t.appointmentData.type),1),e("div",Ws,[e("div",zs,[p[0]||(p[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,g(s.value),1)]),e("div",Qs,[p[1]||(p[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,g(c.value),1)]),e("div",Hs,[p[2]||(p[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,g(t.appointmentData.assignee),1)])]),t.appointmentData.status?(n(),r("div",Ys,[e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",o(t.appointmentData.status)])},g(t.appointmentData.status),3)])):v("",!0)])])]))}},Js={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Gs={class:"flex-1"},Xs={class:"flex items-center gap-2 mb-1"},Zs={class:"text-xs font-bold text-slate-800"},_s={class:"text-[10px] text-gray-400"},eo={class:"text-[10px] text-gray-400"},to={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},so={class:"ml-auto relative"},oo={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},lo={key:0,class:"text-sm text-slate-700"},ao={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},no={key:2,class:"mt-2"},io={key:0},ro={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},uo={key:0},co={class:"text-sm font-bold text-slate-800"},mo={key:0,class:"text-xs text-gray-600 mt-0.5"},po={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},yo={key:0},fo={key:1},go={key:2},vo={key:3},bo={key:4},xo={key:1},ho={class:"text-sm font-bold text-slate-800 mb-2"},wo={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},ko={key:0},$o={class:"text-slate-700 font-medium ml-1"},Co={key:1},So={class:"text-slate-700 font-medium ml-1"},Do={key:2},Ao={class:"text-slate-700 font-medium ml-1"},To={key:3},qo={class:"text-slate-700 font-medium ml-1"},Oo={key:4},Io={class:"text-slate-700 font-medium ml-1"},No={key:5},Vo={class:"text-slate-700 font-medium ml-1"},Mo={key:2,class:"flex items-center gap-3"},Ro={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Fo=["src"],jo={class:"flex-1"},Uo={class:"text-sm font-bold text-slate-800"},Lo={class:"text-xs text-gray-500"},Eo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Bo={key:3,class:"flex items-center gap-3"},Po={class:"flex-1"},Wo={class:"text-sm font-bold text-slate-800"},zo={class:"text-xs text-gray-500"},Qo={key:0,class:"text-xs text-gray-400 mt-1"},Ho={key:1,class:"text-xs text-gray-600 mt-1"},Yo={__name:"TaskCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:x}){const s=t,c=x,o=S(!1),a={mounted(h,f){h.clickOutsideEvent=k=>{h===k.target||h.contains(k.target)||f.value()},setTimeout(()=>{document.addEventListener("click",h.clickOutsideEvent)},0)},unmounted(h){document.removeEventListener("click",h.clickOutsideEvent)}},p=h=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[h]||"fa-solid fa-circle",u=h=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[h]||"bg-gray-100 text-gray-600 border-gray-200",m=h=>{if(!h)return"Just now";const f=new Date(h),C=new Date-f,O=Math.floor(C/6e4),F=Math.floor(O/60),B=Math.floor(F/24);return O<1?"Just now":O<60?`${O} minutes ago`:F<24?`${F} hours ago`:B===1?"Yesterday":B<7?`${B} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},i=h=>h?new Intl.NumberFormat("en-US").format(h):"0",l=h=>h?new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",d=()=>{o.value=!1,c("edit",s.item)},y=()=>{o.value=!1,confirm("Are you sure you want to delete this item?")&&c("delete",s.item)};return(h,f)=>(n(),r("div",Js,[e("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",u(t.item.type)])},[e("i",{class:N([p(t.item.type),"text-sm"])},null,2)],2),e("div",Gs,[e("div",Xs,[e("span",Zs,g(t.customerInitials),1),e("span",_s,g(t.item.action||"added"),1),e("span",eo,"• "+g(m(t.item.timestamp)),1),t.item.autoDetected?(n(),r("span",to,"Auto-detected")):v("",!0),e("div",so,[e("button",{onClick:f[0]||(f[0]=te(k=>o.value=!o.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...f[1]||(f[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),o.value?T((n(),r("div",oo,[e("button",{onClick:d,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),M(" Edit ",-1)])]),e("button",{onClick:y,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...f[3]||(f[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),M(" Delete ",-1)])])])),[[a,()=>o.value=!1]]):v("",!0)])]),t.item.content?(n(),r("div",lo,g(t.item.content),1)):v("",!0),t.item.fileName?(n(),r("div",ao,[f[4]||(f[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,g(t.item.fileName),1)])):v("",!0),t.item.data?(n(),r("div",no,[t.item.type==="appointment"?(n(),r("div",io,[L(Ks,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(n(),r("div",ro,[t.item.type==="tradein"?(n(),r("div",uo,[e("h4",co,g(t.item.data.brand)+" "+g(t.item.data.model),1),t.item.data.version?(n(),r("p",mo,g(t.item.data.version),1)):v("",!0),e("div",po,[t.item.data.year?(n(),r("div",yo,[f[5]||(f[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),M(g(t.item.data.year),1)])):v("",!0),t.item.data.km?(n(),r("div",fo,[f[6]||(f[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),M(g(t.item.data.km)+" km ",1)])):v("",!0),t.item.data.plate?(n(),r("div",go,[f[7]||(f[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),M(g(t.item.data.plate),1)])):v("",!0),t.item.data.date?(n(),r("div",vo,[f[8]||(f[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),M(g(l(t.item.data.date)),1)])):v("",!0),t.item.data.class?(n(),r("div",bo,[f[9]||(f[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),M(g(t.item.data.class),1)])):v("",!0)])])):t.item.type==="financing"?(n(),r("div",xo,[e("h4",ho,g(t.item.data.product),1),e("div",wo,[t.item.data.provider?(n(),r("div",ko,[f[10]||(f[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",$o,g(t.item.data.provider),1)])):v("",!0),t.item.data.total?(n(),r("div",Co,[f[11]||(f[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",So,"€"+g(i(t.item.data.total)),1)])):v("",!0),t.item.data.monthly?(n(),r("div",Do,[f[12]||(f[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Ao,"€"+g(i(t.item.data.monthly)),1)])):v("",!0),t.item.data.deposit?(n(),r("div",To,[f[13]||(f[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",qo,"€"+g(i(t.item.data.deposit)),1)])):v("",!0),t.item.data.startDate?(n(),r("div",Oo,[f[14]||(f[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Io,g(l(t.item.data.startDate)),1)])):v("",!0),t.item.data.expDate?(n(),r("div",No,[f[15]||(f[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Vo,g(l(t.item.data.expDate)),1)])):v("",!0)])])):t.item.type==="offer"?(n(),r("div",Mo,[t.item.data.image?(n(),r("div",Ro,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Fo)])):v("",!0),e("div",jo,[e("h4",Uo,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",Lo,"€ "+g(i(t.item.data.price)),1)]),t.item.data.isMainOffer?(n(),r("span",Eo,"Main Offer")):v("",!0)])):t.item.type==="purchase"?(n(),r("div",Bo,[e("div",Po,[e("h4",Wo,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",zo,"€ "+g(i(t.item.data.price)),1),t.item.data.purchaseDate?(n(),r("p",Qo,"Purchased: "+g(l(t.item.data.purchaseDate)),1)):v("",!0),t.item.data.notes?(n(),r("p",Ho,g(t.item.data.notes),1)):v("",!0)])])):v("",!0)]))])):v("",!0)])]))}},Ko={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Jo={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Go={class:"mb-3"},Xo={class:"flex justify-end gap-2"},Zo={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(""),a=S(""),p=()=>{!o.value.trim()&&!a.value||c("save",{type:"communication",action:`sent via ${s.type}`,content:o.value||`Sent template: ${a.value}`,communicationType:s.type})};return(u,m)=>(n(),r("div",Ko,[m[5]||(m[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Jo,g(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Go,[m[4]||(m[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),T(e("select",{"onUpdate:modelValue":m[0]||(m[0]=i=>a.value=i),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...m[3]||(m[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[se,a.value]])]),T(e("textarea",{"onUpdate:modelValue":m[1]||(m[1]=i=>o.value=i),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[I,o.value]]),e("div",Xo,[e("button",{onClick:m[2]||(m[2]=i=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},_o={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},el={class:"flex justify-between items-center mb-4"},tl={class:"text-sm font-bold text-slate-800"},sl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ol={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S("");le(()=>{s.item&&(o.value=s.item.content||"")});const a=()=>{var p,u;o.value.trim()&&c("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:o.value,timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(p,u)=>(n(),r("div",_o,[u[5]||(u[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",el,[e("h5",tl,g(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:u[0]||(u[0]=m=>p.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[u[4]||(u[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),T(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=m=>o.value=m),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[I,o.value]])]),e("div",sl,[e("button",{onClick:u[2]||(u[2]=m=>p.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:a,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},ll={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},al={class:"flex justify-between items-center mb-4"},nl={class:"text-sm font-bold text-slate-800"},il={class:"flex items-center gap-3"},rl={key:0,class:"text-sm text-slate-600"},dl={key:1,class:"text-sm text-gray-400"},ul={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},cl=["disabled"],ml={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(null),a=S("");le(()=>{s.item&&(a.value=s.item.fileName||"")});const p=m=>{const i=m.target.files[0];i&&(o.value=i,a.value=i.name)},u=()=>{var m,i;!o.value&&!s.item||c("save",{id:((m=s.item)==null?void 0:m.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:a.value,timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(m,i)=>(n(),r("div",ll,[i[6]||(i[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",al,[e("h5",nl,g(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:i[0]||(i[0]=l=>m.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[i[5]||(i[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",il,[e("input",{type:"file",onChange:p,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:i[1]||(i[1]=l=>m.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),M("Choose File ",-1)])]),a.value?(n(),r("span",rl,g(a.value),1)):(n(),r("span",dl,"No file selected"))])]),e("div",ul,[e("button",{onClick:i[2]||(i[2]=l=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:u,disabled:!o.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,cl)])]))}},pl={class:"animate-fade-in"},yl={class:"space-y-4"},fl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vl={class:"block text-xs font-medium text-slate-700 mb-1"},bl={key:0,class:"space-y-4 pt-2 border-t border-gray-100"},xl={key:1,class:"space-y-4 pt-2 border-t border-gray-100"},hl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$l=["value"],Cl={key:2,class:"space-y-4 pt-2 border-t border-gray-100"},Sl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Al={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tl=["value"],ql={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ol=["disabled"],Il={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S({method:"cash",brand:"",model:"",year:"",price:"",purchaseDate:"",productName:"",provider:"",deposit:"",loanTerm:36,leaseTerm:36,residualValue:"",startDate:"",expDate:"",notes:""});le(()=>{s.item&&s.item.data&&(o.value={method:s.item.data.method||"cash",brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||s.item.data.total||"",purchaseDate:s.item.data.purchaseDate||"",productName:s.item.data.productName||s.item.data.product||"",provider:s.item.data.provider||"",deposit:s.item.data.deposit||"",loanTerm:s.item.data.loanTerm||36,leaseTerm:s.item.data.leaseTerm||36,residualValue:s.item.data.residualValue||"",startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",notes:s.item.data.notes||""})});const a=A(()=>{if(o.value.method==="financing"){const i=parseFloat(o.value.price||0)-parseFloat(o.value.deposit||0),l=parseFloat(o.value.loanTerm||36);if(i>0&&l>0)return Math.round(i/l).toString()}return"0"}),p=A(()=>{if(o.value.method==="lease"){const i=parseFloat(o.value.price||0)-parseFloat(o.value.residualValue||0)-parseFloat(o.value.deposit||0),l=parseFloat(o.value.leaseTerm||36);if(i>0&&l>0)return Math.round(i/l).toString()}return"0"}),u=A(()=>{const i=o.value.brand&&o.value.model&&o.value.price;return o.value.method==="cash"?i:o.value.method==="financing"?i&&o.value.productName:o.value.method==="lease"?i&&o.value.provider:!1}),m=()=>{var y,h;if(!u.value)return;const i={cash:"Cash",financing:"Financing",lease:"Lease"}[o.value.method],l=s.item?`updated purchase method: ${i}`:`added purchase method: ${i}`,d={method:o.value.method,brand:o.value.brand,model:o.value.model,year:o.value.year||new Date().getFullYear(),price:o.value.price,notes:o.value.notes||""};o.value.method==="cash"?d.purchaseDate=o.value.purchaseDate||new Date().toISOString().split("T")[0]:o.value.method==="financing"?(d.productName=o.value.productName,d.provider=o.value.provider||"Audi Financial",d.deposit=o.value.deposit,d.loanTerm=o.value.loanTerm,d.monthlyPayment=a.value,d.startDate=o.value.startDate,d.expDate=o.value.expDate):o.value.method==="lease"&&(d.provider=o.value.provider,d.leaseTerm=o.value.leaseTerm,d.deposit=o.value.deposit,d.residualValue=o.value.residualValue,d.monthlyPayment=p.value,d.startDate=o.value.startDate,d.expDate=o.value.expDate),c("save",{id:((y=s.item)==null?void 0:y.id)||Date.now(),type:"purchase-method",action:l,data:d,timestamp:((h=s.item)==null?void 0:h.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(i,l)=>(n(),r("div",pl,[e("div",yl,[e("div",null,[l[21]||(l[21]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Payment Method",-1)),T(e("select",{"onUpdate:modelValue":l[0]||(l[0]=d=>o.value.method=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...l[20]||(l[20]=[e("option",{value:"cash"},"Cash",-1),e("option",{value:"financing"},"Financing",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[se,o.value.method]])]),e("div",fl,[e("div",null,[l[22]||(l[22]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=d=>o.value.brand=d),placeholder:"e.g., Audi",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.brand]])]),e("div",null,[l[23]||(l[23]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=d=>o.value.model=d),placeholder:"e.g., Q4 e-tron",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.model]])])]),e("div",gl,[e("div",null,[l[24]||(l[24]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[3]||(l[3]=d=>o.value.year=d),placeholder:"2024",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.year]])]),e("div",null,[e("label",vl,g(o.value.method==="cash"?"Purchase Price (€)":"Total Amount (€)"),1),T(e("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=d=>o.value.price=d),placeholder:"45000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.price]])])]),o.value.method==="cash"?(n(),r("div",bl,[e("div",null,[l[25]||(l[25]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":l[5]||(l[5]=d=>o.value.purchaseDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.purchaseDate]])])])):v("",!0),o.value.method==="financing"?(n(),r("div",xl,[e("div",hl,[e("div",null,[l[26]||(l[26]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial Product",-1)),T(e("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=d=>o.value.productName=d),placeholder:"e.g., Auto Loan Plus",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.productName]])]),e("div",null,[l[27]||(l[27]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Provider",-1)),T(e("input",{type:"text","onUpdate:modelValue":l[7]||(l[7]=d=>o.value.provider=d),placeholder:"e.g., Audi Financial",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.provider]])])]),e("div",wl,[e("div",null,[l[28]||(l[28]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[8]||(l[8]=d=>o.value.deposit=d),placeholder:"5000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.deposit]])]),e("div",null,[l[29]||(l[29]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Loan Term (months)",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[9]||(l[9]=d=>o.value.loanTerm=d),placeholder:"36",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.loanTerm]])])]),e("div",kl,[e("div",null,[l[30]||(l[30]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":l[10]||(l[10]=d=>o.value.startDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.startDate]])]),e("div",null,[l[31]||(l[31]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"End Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":l[11]||(l[11]=d=>o.value.expDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.expDate]])])]),e("div",null,[l[32]||(l[32]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),e("input",{type:"text",value:a.value,readonly:"",class:"w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,8,$l)])])):v("",!0),o.value.method==="lease"?(n(),r("div",Cl,[e("div",Sl,[e("div",null,[l[33]||(l[33]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Lease Provider",-1)),T(e("input",{type:"text","onUpdate:modelValue":l[12]||(l[12]=d=>o.value.provider=d),placeholder:"e.g., Audi Leasing",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.provider]])]),e("div",null,[l[34]||(l[34]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Lease Term (months)",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[13]||(l[13]=d=>o.value.leaseTerm=d),placeholder:"36",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.leaseTerm]])])]),e("div",Dl,[e("div",null,[l[35]||(l[35]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Down Payment (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[14]||(l[14]=d=>o.value.deposit=d),placeholder:"3000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.deposit]])]),e("div",null,[l[36]||(l[36]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Residual Value (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":l[15]||(l[15]=d=>o.value.residualValue=d),placeholder:"15000",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.residualValue]])])]),e("div",Al,[e("div",null,[l[37]||(l[37]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":l[16]||(l[16]=d=>o.value.startDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.startDate]])]),e("div",null,[l[38]||(l[38]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"End Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":l[17]||(l[17]=d=>o.value.expDate=d),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[I,o.value.expDate]])])]),e("div",null,[l[39]||(l[39]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Monthly Payment (€)",-1)),e("input",{type:"text",value:p.value,readonly:"",class:"w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,8,Tl)])])):v("",!0),e("div",null,[l[40]||(l[40]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes",-1)),T(e("textarea",{"onUpdate:modelValue":l[18]||(l[18]=d=>o.value.notes=d),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Additional details..."},null,512),[[I,o.value.notes]])])]),e("div",ql,[e("button",{onClick:l[19]||(l[19]=d=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{onClick:m,disabled:!u.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"}," Save ",8,Ol)])]))}},Nl={class:"animate-fade-in"},Vl={class:"space-y-4"},Ml={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},jl=["disabled"],Ul={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});le(()=>{s.item&&s.item.data&&(o.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const a=()=>{var p,u;o.value.brand&&c("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:o.value.class,brand:o.value.brand,model:o.value.model||"Unknown Model",year:o.value.date?new Date(o.value.date).getFullYear():"Unknown Year",km:o.value.km||"0",plate:o.value.plate||"",date:o.value.date||""},timestamp:((u=s.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(p,u)=>(n(),r("div",Nl,[e("div",Vl,[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),T(e("select",{"onUpdate:modelValue":u[0]||(u[0]=m=>o.value.class=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...u[8]||(u[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[se,o.value.class]])]),e("div",Ml,[e("div",null,[u[10]||(u[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":u[1]||(u[1]=m=>o.value.brand=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.brand]])]),e("div",null,[u[11]||(u[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=m=>o.value.model=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.model]])])]),e("div",null,[u[12]||(u[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),T(e("input",{type:"text","onUpdate:modelValue":u[3]||(u[3]=m=>o.value.version=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.version]])]),e("div",Rl,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),T(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=m=>o.value.km=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.km]])]),e("div",null,[u[14]||(u[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),T(e("input",{type:"text","onUpdate:modelValue":u[5]||(u[5]=m=>o.value.plate=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.plate]])])]),e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),T(e("input",{type:"date","onUpdate:modelValue":u[6]||(u[6]=m=>o.value.date=m),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,o.value.date]])])]),e("div",Fl,[e("button",{onClick:u[7]||(u[7]=m=>p.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:a,disabled:!o.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,jl)])]))}},Ll=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function El(t){const{store:x,taskId:s,getTabForItemType:c,isOverviewModalAction:o}=t,a=S("overview"),p=S(null),u=S(null),m=S("email"),i=S([]),l=A(()=>[...x.currentActivities.value,...i.value.filter(O=>!O.activityId)].filter(O=>{const F=c(O.type);return a.value==="overview"?F==="overview":F===a.value})),d=C=>(u.value=null,a.value==="overview"&&o(C)?{modalAction:C}:(["email","whatsapp","sms"].includes(C)?(m.value=C,p.value="communication"):p.value=C,null)),y=async C=>{var O;if(C.isEdit){const F=i.value.findIndex(B=>B.id===C.id);F>-1&&(i.value[F]={...i.value[F],...C}),(O=u.value)!=null&&O.activityId&&await x.updateActivity(s.value,u.value.activityId,{type:C.communicationType||C.type,user:"You",action:C.action,content:C.content,fileName:C.fileName,data:C.data})}else{const F=C.communicationType||C.type,B=await x.addActivity(s.value,{type:F,user:"You",action:C.action,content:C.content,fileName:C.fileName,data:C.data});i.value.push({id:B.id,type:F==="email"||F==="whatsapp"||F==="sms"?"communication":F,action:C.action,content:C.content,fileName:C.fileName,data:C.data,timestamp:B.timestamp,activityId:B.id})}p.value=null,u.value=null},h=()=>{p.value=null,u.value=null},f=C=>{u.value=C,p.value=C.type},k=async C=>{const O=i.value.findIndex(F=>F.id===C.id);O>-1&&i.value.splice(O,1),C.activityId&&await x.deleteActivity(s.value,C.activityId)};return oe(a,()=>{p.value=null,u.value=null}),{activeTab:a,showInlineWidget:p,editingItem:u,communicationType:m,inlineContent:i,filteredInlineContent:l,handleAddNewAction:d,handleWidgetSave:y,handleWidgetCancel:h,handleEditItem:f,handleDeleteItem:k}}const Bl={class:"flex-1 flex flex-col overflow-hidden"},Pl={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Wl={class:"px-4 md:px-8 py-4 md:py-6"},zl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Ql={class:"mb-4"},Hl={key:0,class:"mb-6"},Yl={key:1,class:"space-y-6 mb-6"},Kl={key:3},Jl={key:4,class:"space-y-4 mb-6 px-1"},Gl={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Xl={class:"p-6"},Zl={class:"flex justify-between items-center mb-4"},_l={class:"text-sm font-bold text-slate-800"},ea={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const x=t,s=A(()=>x.task.id),c=S(!1),o=S(null),{activeTab:a,showInlineWidget:p,editingItem:u,communicationType:m,inlineContent:i,filteredInlineContent:l,handleAddNewAction:d,handleWidgetSave:y,handleWidgetCancel:h,handleEditItem:f,handleDeleteItem:k}=El({store:x.storeAdapter,taskId:s,getTabForItemType:Ll,isOverviewModalAction:H=>a.value==="overview"&&x.addNewConfig.overviewActions.includes(H)}),C=H=>{const P=d(H);P&&P.modalAction&&(o.value=P.modalAction,c.value=!0)},O=()=>{c.value=!1,o.value=null},F=async H=>{await y(H),O()},B=A(()=>{const H=[...x.storeAdapter.currentActivities.value,...i.value],P=H.length,V=H.filter(ee=>["call","email","sms","whatsapp","communication"].includes(ee.type)).length,Z=H.filter(ee=>ee.type==="note").length,ne=H.filter(ee=>ee.type==="attachment").length;return[{key:"overview",label:"Overview",count:P},{key:"note",label:"Notes",count:Z},{key:"communication",label:"Communication",count:V},{key:"attachment",label:"Attachments",count:ne}]}),ae=A(()=>[...x.storeAdapter.currentActivities.value,...i.value]);return(H,P)=>(n(),r("div",Bl,[e("header",Pl,[e("div",Wl,[L(ks,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:Y(()=>[(n(!0),r(K,null,_(t.task.tags,V=>(n(),r("span",{key:V,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},g(V),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class"])])]),e("main",zl,[e("div",Ql,[L(Ds,{modelValue:j(a),"onUpdate:modelValue":P[0]||(P[0]=V=>mt(a)?a.value=V:null),tabs:B.value,class:"mb-0"},null,8,["modelValue","tabs"])]),j(a)==="overview"?(n(),r("div",Hl,[L(Ms,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||""},null,8,["stage","owner","source"])])):v("",!0),j(a)==="overview"?(n(),r("div",Yl,[(n(),U(pt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:ae.value},null,8,["lead","opportunity","activities"])),t.addNewConfig.overviewActions.length?(n(),U(Ve,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":j(a),onAction:C},null,8,["actions","active-tab"])):v("",!0),me(H.$slots,"pinned-extra",{task:t.task})])):v("",!0),j(a)!=="overview"?(n(),U(Ve,{key:2,actions:t.addNewConfig.tabActions,"active-tab":j(a),onAction:C},null,8,["actions","active-tab"])):v("",!0),j(a)!=="overview"?(n(),r("div",Kl,[j(p)==="communication"?(n(),U(Zo,{key:0,type:j(m),"task-type":t.type,"task-id":t.task.id,onSave:j(y),onCancel:j(h)},null,8,["type","task-type","task-id","onSave","onCancel"])):v("",!0),j(p)==="note"?(n(),U(ol,{key:1,item:j(u),"task-type":t.type,"task-id":t.task.id,onSave:j(y),onCancel:j(h)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0),j(p)==="attachment"?(n(),U(ml,{key:2,item:j(u),"task-type":t.type,"task-id":t.task.id,onSave:j(y),onCancel:j(h)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0)])):v("",!0),j(l).length>0?(n(),r("div",Jl,[(n(!0),r(K,null,_(j(l),V=>(n(),U(Yo,{key:V.id,item:V,"task-type":t.type,"customer-initials":"SK",onEdit:j(f),onDelete:j(k)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):v("",!0)]),(n(),U(we,{to:"body"},[c.value?(n(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:te(O,["self"])},[o.value==="purchase-method"||o.value==="tradein"?(n(),r("div",Gl,[e("div",Xl,[e("div",Zl,[e("h5",_l,g(o.value==="purchase-method"?"Add Purchase Method":"Add Trade-in"),1),e("button",{onClick:O,class:"text-gray-400 hover:text-gray-600"},[...P[1]||(P[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),o.value==="purchase-method"?(n(),U(Il,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:F,onCancel:O},null,8,["task-type","task-id"])):v("",!0),o.value==="tradein"?(n(),U(Ul,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:F,onCancel:O},null,8,["task-type","task-id"])):v("",!0)])])):v("",!0)])):v("",!0)]))]))}},ta={key:0,class:"mb-8"},sa={class:"flex items-center gap-2 mb-4"},oa={class:"font-bold text-gray-800 text-sm"},la={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},aa={class:"p-4"},na={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},ia={class:"text-sm text-slate-700 leading-snug"},ra={class:"flex items-center justify-between"},da={class:"flex items-center gap-4"},ua={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},ca=["src"],ma={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},pa={class:"flex items-center gap-2"},ya={class:"font-bold text-slate-800 text-sm md:text-base"},fa={class:"mt-1.5"},ga={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},va={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},ba={class:"flex items-center gap-4"},xa={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},ha={key:1,class:"text-right"},wa={class:"font-bold text-slate-800"},ka={class:"border-t border-gray-200"},$a={class:"font-medium"},Ca={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Sa={class:"mb-6"},Da={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Aa={key:0},Ta={class:"font-medium text-slate-700"},qa={key:1},Oa={class:"font-medium text-slate-700"},Ia={key:2},Na={class:"font-medium text-slate-700"},Va={class:"font-medium text-slate-700"},Ma={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ra={key:0},Fa={class:"font-medium text-slate-700"},ja={key:1},Ua={class:"font-medium text-slate-700"},La={key:2},Ea={class:"font-medium text-slate-700"},Ba={key:3},Pa={class:"font-medium text-slate-700"},Wa={key:4},za={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Qa={key:5},Ha={class:"font-medium text-slate-700"},Ya={key:0,class:"mt-6 flex justify-end"},Me={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const x=S(!1),s=o=>new Intl.NumberFormat("en-US").format(o),c=o=>new Intl.NumberFormat("en-US").format(o);return(o,a)=>t.show?(n(),r("div",ta,[e("div",sa,[a[1]||(a[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",oa,g(t.label),1)]),e("div",la,[e("div",aa,[t.requestMessage?(n(),r("div",na,[a[2]||(a[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",ia,g(t.requestMessage),1)])):v("",!0),e("div",ra,[e("div",da,[e("div",ua,[t.image?(n(),r("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ca)):(n(),r("i",ma))]),e("div",null,[e("div",pa,[e("div",ya,g(t.brand)+" "+g(t.model)+" ("+g(t.year)+")",1)]),e("div",fa,[t.stockDays!==void 0&&t.stockDays!==null?(n(),r("div",ga,[a[3]||(a[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+g(t.stockDays)+" days) ",1)])):(n(),r("div",va,[...a[4]||(a[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])]))])])]),e("div",ba,[t.showOpenAd&&t.price?(n(),r("button",xa,[...a[5]||(a[5]=[M(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):v("",!0),t.price?(n(),r("div",ha,[a[6]||(a[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",wa,"€ "+g(s(t.price)),1)])):v("",!0)])])]),e("div",ka,[e("button",{onClick:a[0]||(a[0]=p=>x.value=!x.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",$a,g(x.value?"Hide":"View")+" Details",1),e("i",{class:N(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":x.value}])},null,2)])]),x.value?(n(),r("div",Ca,[e("div",Sa,[a[17]||(a[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Da,[t.requestType?(n(),r("div",Aa,[a[7]||(a[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Ta,g(t.requestType),1)])):v("",!0),t.source?(n(),r("div",qa,[a[8]||(a[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Oa,g(t.source),1)])):v("",!0),e("div",null,[a[9]||(a[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:N(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},g(t.sourceDetails||"--"),3)]),t.dealership?(n(),r("div",Ia,[a[10]||(a[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Na,g(t.dealership),1)])):v("",!0),e("div",null,[a[11]||(a[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Va,g(t.channel||"Email"),1)]),e("div",null,[a[12]||(a[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:N(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},g(t.adCampaign||"--"),3)]),e("div",null,[a[13]||(a[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:N(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},g(t.adMedium||"--"),3)]),e("div",null,[a[14]||(a[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:N(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},g(t.adSource||"--"),3)]),e("div",null,[a[15]||(a[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:N(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},g(t.expectedPurchaseDate||"--"),3)]),e("div",null,[a[16]||(a[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:N(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},g(t.fiscalEntity||"--"),3)])])]),a[26]||(a[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[a[25]||(a[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Ma,[t.registration?(n(),r("div",Ra,[a[18]||(a[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Fa,g(t.registration),1)])):v("",!0),t.kilometers!==void 0&&t.kilometers!==null?(n(),r("div",ja,[a[19]||(a[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ua,g(c(t.kilometers))+" Km",1)])):v("",!0),t.fuelType?(n(),r("div",La,[a[20]||(a[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Ea,g(t.fuelType),1)])):v("",!0),t.gearType?(n(),r("div",Ba,[a[21]||(a[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Pa,g(t.gearType),1)])):v("",!0),t.vin?(n(),r("div",Wa,[a[22]||(a[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",za,g(t.vin),1)])):v("",!0),t.dealership?(n(),r("div",Qa,[a[23]||(a[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ha,g(t.dealership),1)])):v("",!0)]),t.showTechnicalSpecs?(n(),r("div",Ya,[...a[24]||(a[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),M(" View technical specs ")],-1)])])):v("",!0)])])):v("",!0)])])):v("",!0)}},Ka={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Ja={class:"grid grid-cols-3 gap-3 mb-4"},Ga={class:"flex gap-3 mb-4"},Se={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:x}){const s=x,c=S(null),o=S(""),a=S(""),p=i=>{c.value=i;const l=new Date;if(i==="later-today"){const d=new Date(l.getTime()+72e5);o.value=d.toISOString().split("T")[0],a.value=d.toTimeString().slice(0,5)}else if(i==="tomorrow"){const d=new Date(l);d.setDate(d.getDate()+1),o.value=d.toISOString().split("T")[0],a.value="09:00"}else if(i==="next-week"){const d=new Date(l);d.setDate(d.getDate()+(7-d.getDay()+1)),o.value=d.toISOString().split("T")[0],a.value="09:00"}},u=()=>{s("confirm",{date:o.value,time:a.value,option:c.value}),s("close"),c.value=null,o.value="",a.value=""},m=()=>{s("close"),c.value=null,o.value="",a.value=""};return(i,l)=>t.show?(n(),r("div",Ka,[e("div",Ja,[e("button",{onClick:l[0]||(l[0]=d=>p("later-today")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":c.value==="later-today"}])},[...l[5]||(l[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:l[1]||(l[1]=d=>p("tomorrow")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":c.value==="tomorrow"}])},[...l[6]||(l[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:l[2]||(l[2]=d=>p("next-week")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":c.value==="next-week"}])},[...l[7]||(l[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",Ga,[T(e("input",{"onUpdate:modelValue":l[3]||(l[3]=d=>o.value=d),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[I,o.value]]),T(e("input",{"onUpdate:modelValue":l[4]||(l[4]=d=>a.value=d),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[I,a.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:m,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:u,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):v("",!0)}},Xa={key:0,class:"space-y-4 animate-fade-in"},Za=["value"],_a={key:0,class:"animate-fade-in"},en={class:"grid grid-cols-4 gap-2"},tn=["onClick"],Ue={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,c=x,o=ge(),a=vt(),p=S(""),u=S(null),m=S(""),i=S(!1),l=S(""),d=A(()=>a.assignableUsers);le(()=>{var k;u.value=((k=o.currentUser)==null?void 0:k.id)||1}),oe(()=>s.show,k=>{k||y()});const y=()=>{var k;p.value="",u.value=((k=o.currentUser)==null?void 0:k.id)||1,m.value="",i.value=!1,l.value=""},h=()=>{if(!p.value||!m.value||!l.value)return;const k=a.getUserById(u.value);c("confirm",{type:p.value,assignee:(k==null?void 0:k.name)||"Unknown",assigneeId:u.value,date:m.value,time:l.value}),y()},f=()=>{y(),c("cancel")};return(k,C)=>t.show?(n(),r("div",Xa,[e("div",null,[C[5]||(C[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),T(e("select",{"onUpdate:modelValue":C[0]||(C[0]=O=>p.value=O),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...C[4]||(C[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[se,p.value]])]),e("div",null,[C[6]||(C[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),T(e("select",{"onUpdate:modelValue":C[1]||(C[1]=O=>u.value=O),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[(n(!0),r(K,null,_(d.value,O=>{var F;return n(),r("option",{key:O.id,value:O.id},g(O.name)+g(O.id===((F=j(o).currentUser)==null?void 0:F.id)?" (Me)":""),9,Za)}),128))],512),[[se,u.value]])]),e("div",null,[C[7]||(C[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":C[2]||(C[2]=O=>m.value=O),onChange:C[3]||(C[3]=O=>i.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[I,m.value]])]),i.value?(n(),r("div",_a,[C[8]||(C[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",en,[(n(),r(K,null,_(["09:00","10:30","11:00","14:30","15:00","16:30"],O=>e("button",{key:O,onClick:F=>l.value=O,class:N(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",l.value===O?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},g(O),11,tn)),64))])])):v("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:f,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:h,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...C[9]||(C[9]=[M(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):v("",!0)}},sn={class:"space-y-6"},on={class:"flex gap-6"},ln={class:"flex items-center gap-2 cursor-pointer"},an={class:"flex items-center gap-2 cursor-pointer"},nn=["disabled"],rn={__name:"DisqualifyModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S("Not Interested"),a=S("");oe(()=>s.show,m=>{m&&(o.value="Not Interested",a.value="")});const p=()=>{c("confirm",{category:o.value,reason:a.value})},u=()=>{c("cancel")};return(m,i)=>(n(),U(pe,{show:t.show,title:"Disqualify Lead",subtitle:"Please select a reason for disqualification.",onCancel:u},{actions:Y(()=>[e("button",{onClick:p,disabled:!o.value||!a.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-6 py-3 rounded-lg text-base transition-colors"}," Confirm Disqualification ",8,nn)]),default:Y(()=>[e("div",sn,[e("div",null,[i[5]||(i[5]=e("label",{class:"block label-upper mb-3"},"Category",-1)),e("div",on,[e("label",ln,[T(e("input",{type:"radio","onUpdate:modelValue":i[0]||(i[0]=l=>o.value=l),value:"Not Valid",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[ke,o.value]]),i[3]||(i[3]=e("span",{class:"text-base text-gray-700"},"Not Valid",-1))]),e("label",an,[T(e("input",{type:"radio","onUpdate:modelValue":i[1]||(i[1]=l=>o.value=l),value:"Not Interested",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[ke,o.value]]),i[4]||(i[4]=e("span",{class:"text-base text-gray-700"},"Not Interested",-1))])])]),e("div",null,[i[7]||(i[7]=e("label",{class:"block label-upper mb-3"},"Failure Reason",-1)),T(e("select",{"onUpdate:modelValue":i[2]||(i[2]=l=>a.value=l),class:"w-full bg-white border-2 border-red-500 rounded-lg px-4 py-3 text-base text-gray-700 focus:outline-none focus:border-red-600 transition-colors"},[...i[6]||(i[6]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[se,a.value]])])])]),_:1},8,["show"]))}},dn={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},un={class:"flex justify-between items-start mb-3"},cn={class:"text-xs text-gray-500 mt-0.5"},mn={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},pn={class:"text-xs text-blue-700"},yn={class:"flex gap-3 flex-wrap"},fn={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},gn={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},vn={class:"flex items-center justify-between mb-4"},bn={__name:"LQWidget",props:{lead:{type:Object,required:!0}},emits:["postponed","validated","qualified","disqualified"],setup(t,{emit:x}){const s=t,c=x,o=S(!1),a=S(!1),p=S(!1),u=S(!1),m=A(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),i=A(()=>s.lead.nextActionDue?new Date(s.lead.nextActionDue)<new Date:!1),l=A(()=>!!s.lead.scheduledAppointment),d=A(()=>l.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:i.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),y=()=>{o.value=!0},h=P=>{c("postponed",P),o.value=!1},f=()=>{a.value=!0},k=()=>{c("validated",{scheduleFollowUp:!1}),a.value=!1},C=()=>{a.value=!1,p.value=!0},O=P=>{c("validated",{scheduleFollowUp:!0,appointmentData:P}),p.value=!1},F=()=>{p.value=!1,c("validated",{scheduleFollowUp:!1})},B=()=>{c("qualified")},ae=()=>{u.value=!0},H=P=>{c("disqualified",P),u.value=!1};return(P,V)=>(n(),r("div",dn,[e("div",un,[e("div",null,[V[3]||(V[3]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",cn,g(m.value),1)]),e("div",{class:N(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",d.value.class])},g(d.value.text),3)]),l.value?(n(),r("div",mn,[V[4]||(V[4]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",pn,g(j($e)(t.lead.scheduledAppointment.start))+" at "+g(j(Ce)(t.lead.scheduledAppointment.start)),1)])):v("",!0),e("div",yn,[e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...V[5]||(V[5]=[M(" Postpone ",-1),e("i",{class:"fa-regular fa-clock text-xs"},null,-1)])]),e("button",{onClick:ae,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...V[6]||(V[6]=[M(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban text-xs"},null,-1)])]),t.lead.stage==="Open Lead"?(n(),r("button",{key:0,onClick:f,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[...V[7]||(V[7]=[M(" Validate ",-1),e("i",{class:"fa-solid fa-check text-xs"},null,-1)])])):v("",!0),e("button",{onClick:B,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-green-200"},[...V[8]||(V[8]=[M(" Qualify ",-1),e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])]),L(Se,{show:o.value,onClose:V[0]||(V[0]=Z=>o.value=!1),onConfirm:h},null,8,["show"]),a.value?(n(),r("div",fn,[e("div",gn,[e("div",vn,[V[10]||(V[10]=e("h3",{class:"text-lg font-bold text-gray-900"},"Validate Lead",-1)),e("button",{onClick:V[1]||(V[1]=Z=>a.value=!1),class:"text-gray-400 hover:text-gray-600"},[...V[9]||(V[9]=[e("i",{class:"fa-solid fa-times"},null,-1)])])]),V[11]||(V[11]=e("p",{class:"text-sm text-gray-600 mb-4"},' Lead will be marked as "Validated". Would you like to schedule a follow-up call? ',-1)),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Just Validate "),e("button",{onClick:C,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Schedule Follow-up ")])])])):v("",!0),p.value?(n(),U(Ue,{key:2,show:p.value,onConfirm:O,onCancel:F},null,8,["show"])):v("",!0),L(rn,{show:u.value,onConfirm:H,onCancel:V[2]||(V[2]=Z=>u.value=!1)},null,8,["show"])]))}},xn={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},hn={class:"p-5 space-y-6"},wn={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},setup(t){const x=t,s=De(),c=Re(),o=ge(),a=async i=>{try{const l=new Date(`${i.date}T${i.time}:00`),d=l.toISOString();await c.modifyLead(x.lead.id,{nextActionDue:d}),await c.addActivity(x.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${$e(l)} at ${Ce(l)}`}),await c.loadLeadById(x.lead.id)}catch(l){console.error("Failed to postpone lead task:",l)}},p=async i=>{try{if(await c.modifyLead(x.lead.id,{stage:"Validated"}),await c.addActivity(x.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),i.scheduleFollowUp&&i.appointmentData){const l=new Date(`${i.appointmentData.date}T${i.appointmentData.time}:00`);await c.scheduleFollowUp(x.lead.id,{dateTime:l.toISOString(),assignee:i.appointmentData.assignee||x.lead.assignee,assigneeId:i.appointmentData.assigneeId||1}),await c.addActivity(x.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${$e(l)} at ${Ce(l)}`})}await c.loadLeadById(x.lead.id)}catch(l){console.error("Failed to validate lead:",l)}},u=async()=>{try{const i=await c.convertLeadToOpportunity(x.lead.id);o.canAccessOpportunities()?s.push({path:`/tasks/${i}`,query:{type:"opportunity"}}):s.push("/tasks/1")}catch(i){console.error("Failed to qualify lead:",i)}},m=async i=>{try{await c.modifyLead(x.lead.id,{isDisqualified:!0,disqualifyReason:i.reason,status:"Disqualified"}),await c.addActivity(x.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${i.category}, Reason: ${i.reason}`}),s.push("/tasks")}catch(l){console.error("Failed to disqualify lead:",l)}};return(i,l)=>t.lead?(n(),r("div",xn,[l[0]||(l[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")])],-1)),e("div",hn,[L(bn,{lead:t.lead,onPostponed:a,onValidated:p,onQualified:u,onDisqualified:m},null,8,["lead"])])])):v("",!0)}},kn={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:x}){const s=x,c=()=>{s("close")};return(o,a)=>(n(),U(pe,{show:t.show,title:t.title,onCancel:c},{footer:Y(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:c,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:Y(()=>[a[0]||(a[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},$n={class:"space-y-4"},Cn=["disabled"],Sn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(""),a=S("");oe(()=>s.show,m=>{m&&(o.value="",a.value="")});const p=()=>{o.value&&c("confirm",{reason:o.value,notes:a.value})},u=()=>{c("cancel")};return(m,i)=>(n(),U(pe,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:u},{actions:Y(()=>[e("button",{onClick:p,disabled:!o.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Cn)]),default:Y(()=>[e("div",$n,[e("div",null,[i[3]||(i[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),T(e("select",{"onUpdate:modelValue":i[0]||(i[0]=l=>o.value=l),class:"input"},[...i[2]||(i[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[se,o.value]])]),e("div",null,[i[4]||(i[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),T(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=l=>a.value=l),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[I,a.value]])])])]),_:1},8,["show"]))}},Dn={class:"space-y-4"},An=["max"],Tn=["disabled"],qn={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(""),a=S(""),p=S(""),u=A(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,l=>{if(l){const d=new Date;o.value=d.toISOString().split("T")[0],a.value=d.toTimeString().slice(0,5),p.value=""}});const m=()=>{if(!o.value)return;const l=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;c("confirm",{contractDate:l,notes:p.value})},i=()=>{c("cancel")};return(l,d)=>(n(),U(pe,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:i},{actions:Y(()=>[e("button",{onClick:m,disabled:!o.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,Tn)]),default:Y(()=>[e("div",Dn,[e("div",null,[d[3]||(d[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=y=>o.value=y),max:u.value,class:"input"},null,8,An),[[I,o.value]])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":d[1]||(d[1]=y=>a.value=y),class:"input"},null,512),[[I,a.value]])]),e("div",null,[d[5]||(d[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),T(e("textarea",{"onUpdate:modelValue":d[2]||(d[2]=y=>p.value=y),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[I,p.value]])])])]),_:1},8,["show"]))}},On={class:"space-y-4"},In=["max"],Nn=["disabled"],Vn={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(""),a=S(""),p=S(""),u=S(""),m=A(()=>new Date().toISOString().split("T")[0]);oe(()=>s.show,d=>{if(d){const y=new Date;o.value=y.toISOString().split("T")[0],a.value=y.toTimeString().slice(0,5),p.value="",u.value=""}});const i=()=>{if(!o.value||!p.value)return;const d=a.value?`${o.value}T${a.value}:00`:`${o.value}T12:00:00`;c("confirm",{deliveryDate:d,location:p.value,notes:u.value})},l=()=>{c("cancel")};return(d,y)=>(n(),U(pe,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:l},{actions:Y(()=>[e("button",{onClick:i,disabled:!o.value||!p.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,Nn)]),default:Y(()=>[e("div",On,[e("div",null,[y[4]||(y[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=h=>o.value=h),max:m.value,class:"input"},null,8,In),[[I,o.value]])]),e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=h=>a.value=h),class:"input"},null,512),[[I,a.value]])]),e("div",null,[y[7]||(y[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),T(e("select",{"onUpdate:modelValue":y[2]||(y[2]=h=>p.value=h),class:"input"},[...y[6]||(y[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[se,p.value]])]),e("div",null,[y[8]||(y[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),T(e("textarea",{"onUpdate:modelValue":y[3]||(y[3]=h=>u.value=h),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[I,u.value]])])])]),_:1},8,["show"]))}},Mn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(x,s)=>(n(),U(pe,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=c=>x.$emit("cancel"))},{header:Y(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:Y(()=>[e("button",{onClick:s[0]||(s[0]=c=>x.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:Y(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),M(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage, probability, and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),M(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),M(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},Rn={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Fn={class:"flex justify-between items-center mb-4"},jn={class:"text-sm font-bold text-slate-800"},Un={key:0,class:"mb-4"},Ln={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},En={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Bn=["src"],Pn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Wn={class:"flex-1 min-w-0"},zn={class:"flex items-center gap-2 flex-wrap"},Qn={class:"font-bold text-sm text-gray-800 truncate"},Hn={class:"text-xs text-gray-500"},Yn={key:0,class:"text-[10px] text-green-600 mt-0.5"},Kn={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Jn=["onClick"],Gn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Xn=["src"],Zn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},_n={class:"flex-1 min-w-0"},ei={class:"flex items-center gap-2 flex-wrap"},ti={class:"font-bold text-sm text-gray-800 truncate"},si={class:"text-xs text-gray-500"},oi={key:0,class:"text-[10px] text-green-600 mt-0.5"},li={key:1,class:"text-center py-4 text-gray-400 text-sm"},ai={class:"mb-4"},ni={key:0,class:"flex items-center gap-2 mb-2"},ii={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ri={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},di={class:"mt-4"},ui={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ci=["disabled"],mi={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,c=x,o=S(null),a=S(null),p=S({brand:"",model:"",year:"",price:"",image:""});le(()=>{s.item&&s.item.data&&(p.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const u=d=>{if(o.value=d,s.requestedCar){const y=d.id&&s.requestedCar.id&&d.id===s.requestedCar.id||d.brand===s.requestedCar.brand&&d.model===s.requestedCar.model&&d.year===s.requestedCar.year;a.value=y?"requested":"recommended"}else a.value="recommended";p.value={brand:d.brand||"",model:d.model||"",year:d.year||new Date().getFullYear(),price:d.price||"",image:d.image||""}},m=A(()=>o.value||p.value.brand&&p.value.model&&p.value.price),i=d=>new Intl.NumberFormat("en-US").format(d),l=()=>{var y,h;const d=o.value||p.value;c("save",{id:((y=s.item)==null?void 0:y.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:d.brand,model:d.model,year:d.year||new Date().getFullYear(),price:d.price,image:d.image||"",isMainOffer:!1},timestamp:((h=s.item)==null?void 0:h.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(d,y)=>{var h,f;return n(),r("div",Rn,[e("div",Fn,[e("h5",jn,g(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:y[0]||(y[0]=k=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...y[8]||(y[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?v("",!0):(n(),r("div",Un,[y[11]||(y[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",Ln,[t.requestedCar?(n(),r("div",{key:0,onClick:y[1]||(y[1]=k=>u(t.requestedCar)),class:N(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((h=o.value)==null?void 0:h.id)===t.requestedCar.id}])},[e("div",En,[t.requestedCar.image?(n(),r("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Bn)):(n(),r("i",Pn))]),e("div",Wn,[e("div",zn,[e("h4",Qn,g(t.requestedCar.brand)+" "+g(t.requestedCar.model)+" ("+g(t.requestedCar.year)+")",1),e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((f=o.value)==null?void 0:f.id)===t.requestedCar.id&&a.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",Hn,"€ "+g(i(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(n(),r("div",Yn," In stock ("+g(t.requestedCar.stockDays)+" days) ",1)):(n(),r("div",Kn," Out of stock "))]),y[9]||(y[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):v("",!0),(n(!0),r(K,null,_(t.recommendedCars,k=>{var C,O;return n(),r("div",{key:k.id,onClick:F=>u(k),class:N(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((C=o.value)==null?void 0:C.id)===k.id}])},[e("div",Gn,[k.image?(n(),r("img",{key:0,src:k.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Xn)):(n(),r("i",Zn))]),e("div",_n,[e("div",ei,[e("h4",ti,g(k.brand)+" "+g(k.model)+" ("+g(k.year)+")",1),e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((O=o.value)==null?void 0:O.id)===k.id&&a.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",si,"€ "+g(i(k.price)),1),k.stockDays!==null&&k.stockDays!==void 0?(n(),r("div",oi," In stock ("+g(k.stockDays)+" days) ",1)):v("",!0)]),y[10]||(y[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Jn)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(n(),r("div",li," No vehicles available ")):v("",!0)])])),e("div",ai,[t.requestedCar||t.recommendedCars.length>0?(n(),r("div",ni,[...y[12]||(y[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):v("",!0),e("div",ii,[e("div",null,[y[13]||(y[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":y[2]||(y[2]=k=>p.value.brand=k),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,p.value.brand]])]),e("div",null,[y[14]||(y[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":y[3]||(y[3]=k=>p.value.model=k),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,p.value.model]])])]),e("div",ri,[e("div",null,[y[15]||(y[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":y[4]||(y[4]=k=>p.value.year=k),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,p.value.year]])]),e("div",null,[y[16]||(y[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":y[5]||(y[5]=k=>p.value.price=k),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[I,p.value.price]])])]),e("div",di,[y[17]||(y[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),T(e("input",{type:"text","onUpdate:modelValue":y[6]||(y[6]=k=>p.value.image=k),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[I,p.value.image]])])]),e("div",ui,[e("button",{onClick:y[7]||(y[7]=k=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:l,disabled:!m.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ci)])])}}},pi={key:0,class:"mb-8"},yi={class:"relative"},fi={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},gi={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},vi=["src"],bi={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},xi={class:"p-4"},hi={class:"font-bold text-gray-800 text-sm mb-1"},wi={class:"text-xs text-gray-500 mb-2"},ki={key:0,class:"flex items-center justify-between"},$i={class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},Ci=["onClick"],Si={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:x}){const s=S([]);le(()=>{s.value=Fe.filter(o=>o.stockDays!==null&&o.stockDays!==void 0).slice(0,5)});const c=o=>new Intl.NumberFormat("en-US").format(o);return(o,a)=>s.value.length>0?(n(),r("div",pi,[a[2]||(a[2]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",yi,[e("div",fi,[(n(!0),r(K,null,_(s.value,p=>(n(),r("div",{key:p.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",gi,[p.image?(n(),r("img",{key:0,src:p.image,alt:"Car",class:"w-full h-full object-cover"},null,8,vi)):(n(),r("i",bi))]),e("div",xi,[e("h4",hi,g(p.brand)+" "+g(p.model)+" ("+g(p.year)+")",1),e("p",wi,"€ "+g(c(p.price)),1),p.stockDays!==null&&p.stockDays!==void 0?(n(),r("div",ki,[e("div",$i,[a[0]||(a[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+g(p.stockDays)+" days) ",1)]),e("button",{onClick:u=>o.$emit("add-to-opportunity",p),class:"w-6 h-6 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-sm transition-colors",title:"Create offer with this car"},[...a[1]||(a[1]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1)])],8,Ci)])):v("",!0)])]))),128))])])])):v("",!0)}},Di=yt(Si,[["__scopeId","data-v-51a0f4a2"]]),Ai={class:"mt-1.5 border-t border-gray-200 pt-1.5"},Ti={key:1},qi={class:"flex items-center justify-between mb-1.5"},Oi={class:"space-y-1.5"},Ii={class:"block label-upper mb-1"},Ni=["onUpdate:modelValue","placeholder"],Vi=["onUpdate:modelValue"],Mi=["value"],Ri={key:2,class:"space-y-0.5"},Fi=["onUpdate:modelValue","value"],ce={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=S(!1),a=S({});oe(()=>s.questions,l=>{const d={};l.forEach(y=>{d[y.key]=""}),a.value=d},{immediate:!0});const p=()=>{c("survey-completed",{...a.value}),i()},u=()=>{c("survey-refused"),i()},m=()=>{c("not-responding"),i()},i=()=>{o.value=!1;const l={};s.questions.forEach(d=>{l[d.key]=""}),a.value=l};return(l,d)=>(n(),r("div",Ai,[o.value?(n(),r("div",Ti,[e("div",qi,[d[4]||(d[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:d[1]||(d[1]=y=>o.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",Oi,[(n(!0),r(K,null,_(t.questions,(y,h)=>(n(),r("div",{key:h,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Ii,g(y.label),1),y.type==="text"?T((n(),r("textarea",{key:0,"onUpdate:modelValue":f=>a.value[y.key]=f,placeholder:y.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Ni)),[[I,a.value[y.key]]]):y.type==="select"?T((n(),r("select",{key:1,"onUpdate:modelValue":f=>a.value[y.key]=f,class:"input text-xs py-1 px-2"},[d[5]||(d[5]=e("option",{value:""},"Select an option...",-1)),(n(!0),r(K,null,_(y.options,f=>(n(),r("option",{key:f,value:f},g(f),9,Mi))),128))],8,Vi)),[[se,a.value[y.key]]]):y.type==="radio"?(n(),r("div",Ri,[(n(!0),r(K,null,_(y.options,f=>(n(),r("label",{key:f,class:"flex items-center text-xs"},[T(e("input",{type:"radio","onUpdate:modelValue":k=>a.value[y.key]=k,value:f,class:"mr-1"},null,8,Fi),[[ke,a.value[y.key]]]),M(" "+g(f),1)]))),128))])):v("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(n(),r("button",{key:0,onClick:d[0]||(d[0]=y=>o.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...d[2]||(d[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},ji={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Ui={class:"flex justify-between items-start mb-3"},Li={class:"text-xs text-gray-500 mt-0.5"},Ei={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],a=A(()=>{if(!s.opportunity.createdAt)return 0;const d=new Date(s.opportunity.createdAt),h=Math.abs(new Date-d);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{c("create-offer",s.opportunity)},u=()=>{c("review",s.opportunity)},m=d=>{c("survey-completed",{opportunity:s.opportunity,responses:d})},i=()=>{c("survey-refused",{opportunity:s.opportunity})},l=()=>{c("not-responding",{opportunity:s.opportunity})};return(d,y)=>(n(),r("div",ji,[e("div",Ui,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Li,"This opportunity has been open for "+g(a.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),L(ce,{questions:o,onSurveyCompleted:m,onSurveyRefused:i,onNotResponding:l})]))}},Bi={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Pi={class:"flex justify-between items-start mb-3"},Wi={class:"text-xs text-gray-500 mt-0.5"},zi={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],a=A(()=>{if(!s.opportunity.createdAt)return 0;const l=new Date(s.opportunity.createdAt),y=Math.abs(new Date-l);return Math.ceil(y/(1e3*60*60*24))}),p=()=>{c("create-offer",s.opportunity)},u=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},m=()=>{c("survey-refused",{opportunity:s.opportunity})},i=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,d)=>(n(),r("div",Bi,[e("div",Pi,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Wi,"This opportunity has been open for "+g(a.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),L(ce,{questions:o,onSurveyCompleted:u,onSurveyRefused:m,onNotResponding:i})]))}},Qi={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Hi={class:"flex justify-between items-start mb-3"},Yi={class:"text-xs text-gray-500 mt-0.5"},Ki={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],a=A(()=>{const l=s.opportunity.lastActivity||s.opportunity.createdAt;if(!l)return 0;const d=new Date(l),h=Math.abs(new Date-d);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{c("create-contract",s.opportunity)},u=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},m=()=>{c("survey-refused",{opportunity:s.opportunity})},i=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,d)=>(n(),r("div",Qi,[e("div",Hi,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Yi,"This opportunity has been in negotiation for "+g(a.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),L(ce,{questions:o,onSurveyCompleted:u,onSurveyRefused:m,onNotResponding:i})]))}},Ji={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Gi={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],a=()=>{c("schedule-closing",s.opportunity)},p=i=>{c("survey-completed",{opportunity:s.opportunity,responses:i})},u=()=>{c("survey-refused",{opportunity:s.opportunity})},m=()=>{c("not-responding",{opportunity:s.opportunity})};return(i,l)=>(n(),r("div",Ji,[l[0]||(l[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:a,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),L(ce,{questions:o,onSurveyCompleted:p,onSurveyRefused:u,onNotResponding:m})]))}},Xi={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Zi={class:"flex justify-between items-start mb-3"},_i={class:"font-bold text-slate-800 text-sm"},er={class:"text-xs text-gray-500 mt-0.5"},tr={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:x}){const s=t,c=x,o=A(()=>{var f;return((f=s.scheduledAppointment)==null?void 0:f.noShowCount)||0}),a=A(()=>{const f=o.value;return f===0?"No-Show Follow-up":f>=3?`No-Show #${f} - Final Warning`:`No-Show #${f} Follow-up`}),p=A(()=>{const f=o.value;return f>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":f>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),u=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],m=A(()=>{var k;return(k=s.scheduledAppointment)!=null&&k.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),i=()=>{c("contact-customer",s.opportunity)},l=()=>{o.value>=3?c("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${o.value} no-shows`}):c("reschedule",s.opportunity)},d=f=>{c("survey-completed",{opportunity:s.opportunity,responses:f})},y=()=>{c("survey-refused",{opportunity:s.opportunity})},h=()=>{c("not-responding",{opportunity:s.opportunity})};return(f,k)=>(n(),r("div",Xi,[e("div",Zi,[e("div",null,[e("h4",_i,g(a.value),1),e("p",er,"Appointment was scheduled for "+g(m.value)+" but customer did not show up. "+g(p.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[0]||(k[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),M(" Book Another Appointment ",-1)])]),e("button",{onClick:i,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...k[1]||(k[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),M(" Contact Customer ",-1)])])]),L(ce,{questions:u,onSurveyCompleted:d,onSurveyRefused:y,onNotResponding:h})]))}},sr={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},or={class:"flex justify-between items-start mb-3"},lr={class:"text-xs text-gray-500 mt-0.5"},ar={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],a=A(()=>{var f;if(!((f=s.opportunity)!=null&&f.contractDate))return 0;const d=new Date(s.opportunity.contractDate),h=Math.abs(new Date-d);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{c("prepare-delivery",s.opportunity)},u=()=>{c("pre-delivery-checklist",s.opportunity)},m=d=>{c("survey-completed",{opportunity:s.opportunity,responses:d})},i=()=>{c("survey-refused",{opportunity:s.opportunity})},l=()=>{c("not-responding",{opportunity:s.opportunity})};return(d,y)=>(n(),r("div",sr,[e("div",or,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",lr,"Contract was signed "+g(a.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),L(ce,{questions:o,onSurveyCompleted:m,onSurveyRefused:i,onNotResponding:l})]))}},nr={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},ir={class:"flex justify-between items-start mb-3"},rr={class:"text-xs text-gray-500 mt-0.5"},dr={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,c=x,o=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],a=A(()=>{const l=s.activities.find(f=>{var k;return f.type==="delivery"||((k=f.action)==null?void 0:k.toLowerCase().includes("delivered"))});if(!l||!l.timestamp)return 0;const d=new Date(l.timestamp),h=Math.abs(new Date-d);return Math.ceil(h/(1e3*60*60*24))}),p=()=>{c("delivery-feedback",s.opportunity)},u=l=>{c("survey-completed",{opportunity:s.opportunity,responses:l})},m=()=>{c("survey-refused",{opportunity:s.opportunity})},i=()=>{c("not-responding",{opportunity:s.opportunity})};return(l,d)=>(n(),r("div",nr,[e("div",ir,[e("div",null,[d[0]||(d[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",rr,"Vehicle was delivered "+g(a.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),L(ce,{questions:o,onSurveyCompleted:u,onSurveyRefused:m,onNotResponding:i})]))}},ur={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},cr={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:x}){const s=t,c=x,o=()=>{c("close-won",s.opportunity)},a=()=>{c("close-lost",s.opportunity)};return(p,u)=>(n(),r("div",ur,[u[2]||(u[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:o,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...u[0]||(u[0]=[M(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:a,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...u[1]||(u[1]=[M(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},mr={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},pr={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},yr={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},fr={class:"p-5 space-y-6"},gr={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},vr={class:"flex gap-3"},br={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},xr={class:"flex items-start gap-3"},hr={class:"flex-1"},wr={class:"font-bold text-slate-800 text-sm mb-1"},kr={key:0},$r={key:1},Cr={class:"text-xs text-gray-600"},Sr={key:0},Dr={key:1},Ar={key:2},Tr={class:"flex justify-between items-start mb-3"},qr={class:"font-bold text-slate-800 text-sm"},Or={key:0},Ir={key:1},Nr={class:"text-xs text-gray-500 mt-0.5"},Vr={key:0},Mr={key:1},Rr={key:0,class:"mt-4"},Fr={class:"[&>div]:mb-0"},jr={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Ur={class:"flex justify-between items-start mb-3"},Lr={class:"text-xs text-gray-500 mt-0.5"},Er={key:0,class:"pt-4"},Br={key:10,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},Pr={key:12,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Wr={class:"flex justify-between items-start mb-3"},zr={class:"text-xs text-gray-500 mt-0.5"},Qr={class:"flex gap-3"},Hr={key:0,class:"pt-4"},Yr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Kr={class:"p-6"},Jr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Gr={class:"p-6"},Xr={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:x}){const s=t,c=x,o=A(()=>{var w,$,R;return((w=s.opportunity)==null?void 0:w.stage)==="Closed"||(($=s.opportunity)==null?void 0:$.stage)==="Closed Lost"||((R=s.opportunity)==null?void 0:R.stage)==="Registration"}),a=S(!1),p=S(!1),u=S(null),m=S(!1),i=S(""),l=S(!1),d=S(!1),y=S(!1),h=S(!1),f=S(!1),k=S([]),C=De(),O=je(),F=ge();le(()=>{k.value=Fe.filter(w=>w.stockDays!==null&&w.stockDays!==void 0).slice(0,5).map(w=>({id:w.id,brand:w.brand,model:w.model,year:w.year,price:w.price,image:w.image||"",stockDays:w.stockDays}))});const B=w=>{i.value=w,m.value=!0},ae=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",H=w=>w?new Date(w).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",P=()=>{a.value=!a.value},V=w=>{a.value=!1},Z=A(()=>{var Q;if(!((Q=s.opportunity)!=null&&Q.createdAt))return 0;const w=new Date(s.opportunity.createdAt),R=Math.abs(new Date-w);return Math.ceil(R/(1e3*60*60*24))}),ne=A(()=>{var $,R;return s.activities.some(Q=>Q.type==="offer")||(($=s.opportunity)==null?void 0:$.stage)==="In Negotiation"||((R=s.opportunity)==null?void 0:R.stage)==="Closed"}),ee=A(()=>s.activities.some(w=>w.type==="appointment")),D=A(()=>{var R,Q,z,J;const w=((R=s.opportunity)==null?void 0:R.contractDate)!==null&&((Q=s.opportunity)==null?void 0:Q.contractDate)!==void 0,$=s.activities.some(G=>{var X,ie;return((X=G.action)==null?void 0:X.toLowerCase().includes("won"))||((ie=G.action)==null?void 0:ie.toLowerCase().includes("contract"))});return w||$||((z=s.opportunity)==null?void 0:z.stage)==="Closed"&&((J=s.opportunity)==null?void 0:J.probability)===100}),q=A(()=>s.activities.some(w=>{var $,R;return w.type==="delivery"||(($=w.action)==null?void 0:$.toLowerCase().includes("delivered"))||((R=w.action)==null?void 0:R.toLowerCase().includes("delivery"))})),W=A(()=>{var $;if((($=s.opportunity)==null?void 0:$.stage)!=="Qualified"||ne.value||s.scheduledAppointment||ee.value)return!1;const w=Z.value;return w>=7&&w<14}),b=A(()=>{var $;return(($=s.opportunity)==null?void 0:$.stage)!=="Qualified"||ne.value||s.scheduledAppointment||ee.value?!1:Z.value>=14}),E=A(()=>{var $;return(($=s.opportunity)==null?void 0:$.stage)!=="Qualified"||ne.value||!s.scheduledAppointment?!1:Z.value>=7}),ye=A(()=>{const w=Z.value;return w>=14?"high":w>=7?"medium":null}),ve=A(()=>{var z;if(((z=s.opportunity)==null?void 0:z.stage)!=="In Negotiation")return!1;const w=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),R=Math.abs(new Date-w),Q=Math.ceil(R/(1e3*60*60*24));return ne.value&&!D.value&&Q>=5}),Ae=A(()=>{var X,ie,Oe;if(((X=s.opportunity)==null?void 0:X.stage)!=="In Negotiation")return!1;const w=((ie=s.opportunity)==null?void 0:ie.contractDate)!==null&&((Oe=s.opportunity)==null?void 0:Oe.contractDate)!==void 0,$=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||ee.value&&s.activities.some(he=>{var Ie;return he.type==="appointment"&&((Ie=he.data)!=null&&Ie.datetime)?new Date(he.data.datetime)>new Date:!1}),R=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),z=Math.abs(new Date-R);return Math.ceil(z/(1e3*60*60*24))>=5&&!w&&!$}),Le=A(()=>{var G,X,ie;if(((G=s.opportunity)==null?void 0:G.stage)!=="Closed"&&((X=s.opportunity)==null?void 0:X.stage)!=="Registration")return!1;const w=(ie=s.opportunity)==null?void 0:ie.contractDate;if(!w||q.value)return!1;const $=new Date(w),Q=Math.abs(new Date-$);return Math.ceil(Q/(1e3*60*60*24))>=7}),Ee=A(()=>{const w=s.activities.find(G=>{var X;return G.type==="delivery"||((X=G.action)==null?void 0:X.toLowerCase().includes("delivered"))});if(!w)return!1;const $=new Date(w.timestamp),Q=Math.abs(new Date-$);return Math.ceil(Q/(1e3*60*60*24))>=3}),Be=A(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const R=s.activities.some(z=>{var J,G,X;return z.type==="appointment"&&(((J=z.data)==null?void 0:J.status)==="completed"||((G=z.action)==null?void 0:G.toLowerCase().includes("completed")))&&((X=z.data)==null?void 0:X.appointmentId)===s.scheduledAppointment.id}),Q=s.scheduledAppointment.status==="no-show";return!R&&!Q}),Pe=A(()=>!o.value),We=A(()=>{var z,J,G;if(((z=s.opportunity)==null?void 0:z.stage)!=="Closed"||!((J=s.opportunity)!=null&&J.contractDate)||q.value||((G=s.opportunity)==null?void 0:G.stage)==="Registration")return!1;const w=new Date(s.opportunity.contractDate),R=Math.abs(new Date-w);return Math.ceil(R/(1e3*60*60*24))>=7}),ze=()=>{B("Add Vehicle from Stock")},Qe=()=>{B("Configure Vehicle")},be=()=>{l.value=!0},Te=()=>{l.value=!1},He=w=>{l.value=!1,c("create-offer",{opportunity:s.opportunity,offerData:w})},Ye=w=>{c("add-to-opportunity",w)},Ke=w=>{B("Review Opportunity")},Je=w=>{y.value=!0},Ge=w=>{y.value=!1},qe=w=>{p.value=!0,u.value=w},xe=()=>{p.value=!1,u.value=null},Xe=w=>{qe("nfu")},Ze=async w=>{var z;xe();const $=`${w.date}T${w.time}:00`,R=new Date($);R.setHours(R.getHours()+1);const Q={type:"appointment",user:((z=F.currentUser)==null?void 0:z.name)||"You",action:"scheduled an appointment",content:`Appointment scheduled: ${w.type} on ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,date:w.date,time:w.time,datetime:$,status:"scheduled"},timestamp:new Date().toISOString()};try{await O.addActivity(s.opportunity.id,Q);const J={title:`${w.type} - ${s.opportunity.customer.name}`,start:$,end:R.toISOString(),type:w.type.toLowerCase().replace(" ","-"),customer:s.opportunity.customer.name,vehicle:`${s.opportunity.vehicle.brand} ${s.opportunity.vehicle.model}`,assignee:w.assignee,assigneeId:w.assigneeId,dealership:s.opportunity.vehicle.dealership||"Main",team:"Sales (New)",status:"confirmed",opportunityId:s.opportunity.id};await xt(J),await O.loadOpportunityById(s.opportunity.id)}catch(J){console.error("Failed to schedule appointment:",J)}},_e=w=>{h.value=!0},et=w=>{B("Pre-Delivery Checklist")},tt=w=>{h.value=!1},st=w=>{B("Delivery Feedback")},ot=()=>{ct()},lt=()=>{d.value=!0},at=w=>{},nt=w=>{d.value=!1},it=()=>{B("Contact Customer")},re=w=>{},de=w=>{},ue=w=>{},rt=async()=>{try{await O.reopenOpportunity(s.opportunity.id),await O.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to reopen opportunity:",w)}},dt=async()=>{try{f.value=!1;const w=await O.convertOpportunityToLead(s.opportunity.id);F.canAccessLeads()?C.push({path:`/tasks/${w}`,query:{type:"lead"}}):C.push("/tasks/1")}catch(w){console.error("Failed to convert opportunity to lead:",w),f.value=!1}},ut=async()=>{try{await O.markAsRegistration(s.opportunity.id),await O.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as registration:",w)}},ct=async()=>{try{await O.markAsClosedWon(s.opportunity.id),await O.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as closed won:",w)}};return(w,$)=>t.opportunity?(n(),r("div",mr,[e("div",pr,[$[9]||($[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next Steps")],-1)),e("span",yr,g(o.value?"Closed":"Active"),1)]),e("div",fr,[o.value?(n(),r("div",gr,[$[12]||($[12]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",vr,[e("button",{onClick:rt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...$[10]||($[10]=[M(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:$[0]||($[0]=R=>f.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...$[11]||($[11]=[M(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):v("",!0),E.value?(n(),r("div",br,[e("div",xr,[$[13]||($[13]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",hr,[e("h4",wr,[ye.value==="high"?(n(),r("span",kr,"High Risk")):(n(),r("span",$r,"At Risk"))]),e("p",Cr,[ye.value==="high"?(n(),r("span",Sr," This opportunity has been open for "+g(Z.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(n(),r("span",Dr," This opportunity has been open for "+g(Z.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):v("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(n(),r("div",Ar,[e("div",{class:N([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",Tr,[e("div",null,[e("h4",qr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(n(),r("span",Or," Vehicle Actions ")):(n(),r("span",Ir," Find Alternative Vehicle "))]),e("p",Nr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(n(),r("span",Vr," The requested vehicle is available. Create an offer or explore other options. ")):(n(),r("span",Mr," The requested vehicle is currently out of stock. Explore alternatives. "))])])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:ze,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:Qe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:be,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(n(),r("div",Rr,[e("div",Fr,[L(Di,{onAddToOpportunity:Ye})])])):v("",!0)],2)])):v("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(n(),r("div",jr,[e("div",Ur,[e("div",null,[$[14]||($[14]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",Lr,g(t.scheduledAppointment.title)+" on "+g(ae(t.scheduledAppointment.start))+" at "+g(H(t.scheduledAppointment.start)),1)])]),e("button",{onClick:P,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),a.value?(n(),r("div",Er,[L(Se,{show:a.value,onClose:$[1]||($[1]=R=>a.value=!1),onConfirm:V},null,8,["show"])])):v("",!0)])):v("",!0),Be.value?(n(),U(tr,{key:4,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:it,onReschedule:w.openRescheduleModal,onAutoCloseLost:at,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity","scheduled-appointment","onReschedule"])):v("",!0),b.value?(n(),U(zi,{key:5,opportunity:t.opportunity,onCreateOffer:be,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),W.value?(n(),U(Ei,{key:6,opportunity:t.opportunity,onCreateOffer:be,onReview:Ke,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),Ae.value?(n(),U(Gi,{key:7,opportunity:t.opportunity,onScheduleClosing:Xe,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),ve.value?(n(),U(Ki,{key:8,opportunity:t.opportunity,onCreateContract:Je,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),Le.value?(n(),U(ar,{key:9,opportunity:t.opportunity,onPrepareDelivery:_e,onPreDeliveryChecklist:et,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity"])):v("",!0),We.value?(n(),r("div",Br,[$[16]||($[16]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:ut,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...$[15]||($[15]=[M(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):v("",!0),Ee.value?(n(),U(dr,{key:11,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:st,onSurveyCompleted:re,onSurveyRefused:de,onNotResponding:ue},null,8,["opportunity","activities"])):v("",!0),o.value?v("",!0):(n(),r("div",Pr,[e("div",Wr,[e("div",null,[$[17]||($[17]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Schedule Appointment",-1)),e("p",zr,g(t.scheduledAppointment?"Reschedule or book a new appointment with the customer.":"Schedule an appointment with the customer to move forward."),1)])]),e("div",Qr,[e("button",{onClick:$[2]||($[2]=R=>qe("general")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},g(t.scheduledAppointment?"Schedule New Appointment":"Schedule Appointment"),1),t.scheduledAppointment?(n(),r("button",{key:0,onClick:P,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Reschedule Existing ")):v("",!0)]),a.value?(n(),r("div",Hr,[L(Se,{show:a.value,onClose:$[3]||($[3]=R=>a.value=!1),onConfirm:V},null,8,["show"])])):v("",!0)])),Pe.value?(n(),U(cr,{key:13,opportunity:t.opportunity,onCloseWon:ot,onCloseLost:lt},null,8,["opportunity"])):v("",!0)]),L(kn,{show:m.value,title:i.value,onClose:$[4]||($[4]=R=>m.value=!1)},null,8,["show","title"]),L(Sn,{show:d.value,onConfirm:nt,onCancel:$[5]||($[5]=R=>d.value=!1)},null,8,["show"]),L(Mn,{show:f.value,onConfirm:dt,onCancel:$[6]||($[6]=R=>f.value=!1)},null,8,["show"]),L(qn,{show:y.value,onConfirm:Ge,onCancel:$[7]||($[7]=R=>y.value=!1)},null,8,["show"]),L(Vn,{show:h.value,onConfirm:tt,onCancel:$[8]||($[8]=R=>h.value=!1)},null,8,["show"]),(n(),U(we,{to:"body"},[l.value?(n(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:te(Te,["self"])},[e("div",Yr,[e("div",Kr,[L(mi,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":k.value,onSave:He,onCancel:Te},null,8,["task-id","requested-car","recommended-cars"])])])])):v("",!0)])),(n(),U(we,{to:"body"},[p.value?(n(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:te(xe,["self"])},[e("div",Jr,[e("div",Gr,[L(Ue,{show:p.value,onConfirm:Ze,onCancel:xe},null,8,["show"])])])])):v("",!0)]))])):v("",!0)}},Zr={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},_r={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},ed={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},td={class:"text-[10px] font-bold uppercase tracking-wide"},sd={key:1,class:"text-right"},od={class:"text-sm font-bold text-gray-900"},ld={class:"mt-1.5"},ad={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},nd={class:"text-[10px] text-gray-500 mt-0.5"},id=["onClick"],rd=["onClick"],dd=["onClick"],ud={class:"flex-1 flex flex-col overflow-hidden"},cd={key:0,class:"lg:hidden xl:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},md={key:1,class:"flex-1 flex items-center justify-center"},pd={key:0,class:"xl:hidden fixed inset-0 z-[60] bg-white"},hd={__name:"Tasks",setup(t){const x=ft(),s=De(),c=Re(),o=je(),a=ge(),p=S("all"),u=S(null),m=S(!1),i=S(!1),l=A(()=>{const q=c.leads.filter(E=>!E.isDisqualified).map(E=>({...E,type:"lead",compositeId:`lead-${E.id}`})),W=o.opportunities.map(E=>({...E,type:"opportunity",compositeId:`opportunity-${E.id}`}));let b=[];return a.isOperator()?b=q:a.isSalesman()?b=W:b=[...q,...W],b.sort((E,ye)=>{const ve=new Date(E.lastActivity||E.createdAt||0);return new Date(ye.lastActivity||ye.createdAt||0)-ve})}),d=A(()=>p.value==="all"?l.value:l.value.filter(D=>D.type===p.value)),y=A(()=>{const D=l.value.some(W=>W.type==="lead"),q=l.value.some(W=>W.type==="opportunity");return D&&q}),h=A(()=>{const D=parseInt(x.params.id),q=x.query.type;if(q)return l.value.find(E=>E.id===D&&E.type===q)||null;const b=(p.value!=="all"?l.value.filter(E=>E.type===p.value):l.value).find(E=>E.id===D);return b||l.value.find(E=>E.id===D)||null}),f=A(()=>h.value?h.value.type==="lead"?c.currentLeadActivities:o.currentOpportunityActivities:[]),k=A(()=>h.value?h.value.type==="lead"?wn:Xr:null),C=A(()=>h.value?h.value.type==="lead"?{currentActivities:A(()=>c.currentLeadActivities),addActivity:(D,q)=>c.addActivity(D,q),updateActivity:(D,q,W)=>c.updateActivity(D,q,W),deleteActivity:(D,q)=>c.deleteActivity(D,q)}:{currentActivities:A(()=>o.currentOpportunityActivities),addActivity:(D,q)=>o.addActivity(D,q),updateActivity:(D,q,W)=>o.updateActivity(D,q,W),deleteActivity:(D,q)=>o.deleteActivity(D,q)}:null),O=A(()=>h.value?h.value.type==="lead"?{overviewActions:["purchase-method","tradein"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["purchase-method","tradein"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),F=A(()=>D=>D.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");le(()=>{c.loadLeads(),o.loadOpportunities();const D=x.params.id;D?ae(D):B()});const B=()=>{const D=d.value[0];D&&s.replace({path:`/tasks/${D.id}`,query:{type:D.type}})};oe(()=>x.params.id,D=>{D?ae(D):B()}),oe(h,D=>{D&&(D.type==="lead"?c.loadLeadById(D.id):o.loadOpportunityById(D.id))},{immediate:!0});const ae=D=>{const q=parseInt(D),W=l.value.find(b=>b.id===q);W&&(W.type==="lead"?c.loadLeadById(q):o.loadOpportunityById(q))},H=D=>{const[q,W]=D.split("-");s.push({path:`/tasks/${W}`,query:{type:q}}),m.value=!1},P=D=>{u.value=u.value===D?null:D},V=D=>{u.value=null},Z=async D=>{u.value=null,D.type==="lead"?await c.modifyLead(D.id,{priority:"Hot"}):D.type==="opportunity"&&await o.modifyOpportunity(D.id,{priority:"Hot"})},ne=async D=>{u.value=null,D.type==="lead"?await c.modifyLead(D.id,{priority:"Normal"}):D.type==="opportunity"&&await o.modifyOpportunity(D.id,{priority:"Normal"})},ee=D=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[D]||"bg-gray-100 text-gray-700 border-gray-200";return(D,q)=>{var W;return n(),r("div",Zr,[e("div",{class:N(["lg:relative lg:block",m.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[L(Lt,{title:"My Tasks",items:d.value,"selected-id":(W=h.value)==null?void 0:W.compositeId,"type-filter":p.value,"selected-class":b=>b.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":F.value,"open-menu-id":u.value,getName:b=>b.customer.name,getInitials:b=>b.customer.initials,getVehicleInfo:b=>b.type==="lead"?`${b.requestedCar.brand} ${b.requestedCar.model}`:`${b.vehicle.brand} ${b.vehicle.model}`,avatarClass:b=>b.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:H,onMenuClick:P,onMenuClose:q[0]||(q[0]=b=>u.value=null),onClose:q[1]||(q[1]=b=>m.value=!1),"show-type-filter":y.value,onFilterChange:q[2]||(q[2]=b=>p.value=b)},{badges:Y(({item:b})=>[e("span",{class:N(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",b.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(b.type==="lead"?"Lead":"Opportunity"),3),b.type==="lead"?(n(),r(K,{key:0},[e("span",_r,g(b.status),1),b.priority==="Hot"?(n(),r("span",ed,[...q[6]||(q[6]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),M(" Hot ",-1)])])):v("",!0)],64)):(n(),r("span",{key:1,class:N(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",ee(b.stage)])},g(b.stage),3))]),meta:Y(({item:b})=>[b.type==="lead"?(n(),r("div",{key:0,class:N(["flex items-center gap-1.5",j(fe)(b.nextActionDue)==="OVERDUE"?"text-red-500":b.priority==="Hot"?"text-orange-500":"text-gray-400"])},[e("i",{class:N(["text-[10px]",j(fe)(b.nextActionDue)==="OVERDUE"?"fa-solid fa-exclamation-triangle":"fa-solid fa-clock"])},null,2),e("span",td,g(j(fe)(b.nextActionDue)==="OVERDUE"?"OVERDUE":`Due in ${j(fe)(b.nextActionDue)}`),1)],2)):(n(),r("div",sd,[e("div",od,"€"+g(j(bt)(b.value)),1),e("div",ld,[e("div",ad,[e("div",{class:N(["h-full rounded-full",b.probability>=70?"bg-green-500":b.probability>=40?"bg-blue-500":"bg-orange-500"]),style:gt({width:`${b.probability}%`})},null,6)]),e("div",nd,g(b.probability)+"% PROB",1)])]))]),menu:Y(({item:b})=>[e("button",{onClick:te(E=>V(b),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[7]||(q[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),M(" Reassign ",-1)])],8,id),b.priority!=="Hot"?(n(),r("button",{key:0,onClick:te(E=>Z(b),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[8]||(q[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),M(" Mark as hot ",-1)])],8,rd)):(n(),r("button",{key:1,onClick:te(E=>ne(b),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...q[9]||(q[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),M(" Unmark as hot ",-1)])],8,dd))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),e("div",ud,[h.value?(n(),r("div",cd,[e("button",{onClick:q[3]||(q[3]=b=>i.value=!i.value),class:"w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-all hover:scale-110",title:"Activity"},[...q[10]||(q[10]=[e("i",{class:"fa-solid fa-clock-rotate-left text-lg"},null,-1)])]),e("button",{onClick:q[4]||(q[4]=b=>m.value=!m.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...q[11]||(q[11]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])])):v("",!0),h.value?(n(),U(ea,{key:2,task:h.value,type:h.value.type,"management-widget":k.value,"store-adapter":C.value,"add-new-config":O.value},{"pinned-extra":Y(({task:b})=>[b.type==="lead"&&b.requestedCar?(n(),U(Me,{key:0,brand:b.requestedCar.brand,model:b.requestedCar.model,year:b.requestedCar.year,image:b.requestedCar.image||"",price:b.requestedCar.price||null,"request-message":b.requestedCar.requestMessage||"","request-type":b.requestedCar.requestType||"",source:b.source||"",dealership:b.requestedCar.dealership||"",registration:b.requestedCar.registration||"",kilometers:b.requestedCar.kilometers||null,"fuel-type":b.requestedCar.fuelType||"","gear-type":b.requestedCar.gearType||"",vin:b.requestedCar.vin||"","stock-days":b.requestedCar.stockDays!==void 0?b.requestedCar.stockDays:null,channel:b.requestedCar.channel||"Email","ad-campaign":b.requestedCar.adCampaign||"","expected-purchase-date":b.requestedCar.expectedPurchaseDate||"","fiscal-entity":b.requestedCar.fiscalEntity||"","source-details":b.requestedCar.sourceDetails||"","ad-medium":b.requestedCar.adMedium||"","ad-source":b.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0),b.type==="opportunity"&&b.vehicle?(n(),U(Me,{key:1,brand:b.vehicle.brand,model:b.vehicle.model,year:b.vehicle.year,image:b.vehicle.image||"",price:b.vehicle.price||null,"request-message":b.vehicle.requestMessage||"","request-type":b.vehicle.requestType||"",source:b.source||"",dealership:b.vehicle.dealership||"",registration:b.vehicle.registration||"",kilometers:b.vehicle.kilometers||null,"fuel-type":b.vehicle.fuelType||"","gear-type":b.vehicle.gearType||"",vin:b.vehicle.vin||"","stock-days":b.vehicle.stockDays!==void 0?b.vehicle.stockDays:null,channel:b.vehicle.channel||"Email","ad-campaign":b.vehicle.adCampaign||"","expected-purchase-date":b.vehicle.expectedPurchaseDate||"","fiscal-entity":b.vehicle.fiscalEntity||"","source-details":b.vehicle.sourceDetails||"","ad-medium":b.vehicle.adMedium||"","ad-source":b.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(n(),r("div",md,[...q[12]||(q[12]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),i.value&&h.value?(n(),r("div",pd,[L(Ne,{title:"Activity summary",activities:f.value,collapsed:!1,"show-collapse":!1,show:!0,"mobile-fullscreen":!0,onClose:q[5]||(q[5]=b=>i.value=!1),class:"flex w-full h-full"},null,8,["activities"])])):v("",!0),L(Ne,{title:"Activity summary",activities:f.value,collapsed:!1,"show-collapse":!1,show:!!h.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{hd as default};
