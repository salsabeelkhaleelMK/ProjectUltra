import{H as ge,h as qe,d as a,o as s,e,n as z,w as je,s as l,y as n,al as bt,t as m,F as Q,i as se,x as P,$ as un,g as u,B as k,a1 as cn,I as Ua,r as N,c as C,am as mn,Y as Gt,k as V,C as _a,l as Le,m as wt,J as za,p as re,j as Da,K as Ne,a8 as fn,v as ja,a9 as Xe,O as vn,G as pn,L as Bt,P as nt,W as qa,a5 as Wa,an as Ht,ao as Ft,ap as yn,aq as gn,ar as xn}from"./index-D-GV69Dn.js";import{u as Ha}from"./opportunities-D_EVVSI9.js";import{u as Ya,_ as hn,f as bn}from"./UnifiedAddForm-vTbw0or0.js";import{z as pe,n as _,b as kn,Z as wn,a as $n,e as _e,J as ze,Y as We,$ as Ga,Q as X,c as de,W as et,U as tt,H as st,j as oe,G as at,f as Qa,F as Ja,L as Ka,g as Za,h as Xa,o as Cn,C as en,d as tn,t as it}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-3RNqBGno.js";import{X as An,Y as Ma,Z as Va,$ as La,m as Ut,n as _t,T as In,j as Sn,k as Tn,l as Dn,s as jn,t as qn,u as Mn,o as Vn,p as Ln,q as On,r as Pe,_ as En,F as Nn,G as Pn,I as Oa,a0 as Rt,a1 as kt,a2 as lt,P as ot,i as sn,w as an,H as nn,a3 as ye,a4 as Ue,C as Fn}from"./OfferCarousel-YtLzEMp2.js";import{_ as Rn}from"./ReassignUserModal-B8fbsoa_.js";import{a as Bn,_ as Un}from"./CreateEventModal-DtWwBW-0.js";import{u as _n,b as zn,c as Wn,d as Hn}from"./users-D9zJDDml.js";import{fetchTasksByCustomerId as Yn,fetchContactsByAccountId as Gn,fetchLeadsByCustomerId as Qn,fetchOpportunitiesByCustomerId as Jn,fetchCustomerCars as Kn}from"./contacts-Doz8YZdN.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=ge("ActivityIcon",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ge("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=ge("BriefcaseIcon",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=ge("Building2Icon",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=ge("CalendarCheckIcon",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=ge("DollarSignIcon",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=ge("HandshakeIcon",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=ge("HashIcon",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=ge("InboxIcon",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ge("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ge("MapPinIcon",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=ge("MessageSquareIcon",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=ge("SmartphoneIcon",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=ge("StarIcon",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=ge("UserPlusIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ll={class:"page-header-main"},ol={class:"page-header-content"},il={class:"flex items-center gap-3 min-w-0 flex-1"},rl={class:"min-w-0 flex-1 flex flex-col justify-center"},dl={class:"flex items-center gap-2 flex-wrap"},ul={class:"text-lg font-semibold text-foreground truncate leading-tight"},cl={class:"flex items-center gap-1.5"},ml={class:"page-header-actions"},fl={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,default:""},phone:{type:String,default:""},thirdFieldValue:{type:String,default:""},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]},showCloseButton:{type:Boolean,default:!1}},emits:["add-tag","close"],setup(t,{emit:o}){const f=t,A=o,q=qe(),$=()=>A("add-tag"),v=()=>{f.customerId&&q.push(`/customer/${f.customerId}`)};return(c,I)=>(s(),a("div",ll,[e("div",ol,[e("div",il,[e("button",{onClick:je(v,["stop"]),class:z(["w-10 h-10 rounded-lg bg-primary text-white flex items-center justify-center cursor-pointer hover:opacity-90 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[l(n(bt),{class:"w-5 h-5"})],2),e("div",rl,[e("div",dl,[e("h1",ul,m(t.name),1),e("div",cl,[(s(!0),a(Q,null,se(t.tags,b=>(s(),P(n(pe),{key:b,text:b,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:je($,["stop"]),class:"text-xs text-muted-foreground hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors whitespace-nowrap"},[l(n(un),{class:"w-3 h-3"}),I[1]||(I[1]=e("span",null,"tag",-1))])])])])]),e("div",ml,[t.showCloseButton?(s(),P(n(_),{key:0,variant:"secondary",size:"icon",onClick:I[0]||(I[0]=je(b=>c.$emit("close"),["stop"]))},{default:k(()=>[l(n(cn),{size:16,class:"text-muted-foreground"})]),_:1})):u("",!0)])])]))}},vl={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},pl={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(o,f)=>(s(),P(n($n),{"model-value":t.modelValue,"onUpdate:modelValue":f[0]||(f[0]=A=>o.$emit("update:modelValue",A))},{default:k(()=>[l(n(kn),{class:"flex shrink-0 border-b border-border bg-white rounded-none w-full relative h-full"},{default:k(()=>[(s(!0),a(Q,null,se(t.tabs,A=>(s(),P(n(wn),{key:A.key,value:A.key,class:z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",t.modelValue===A.key?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:k(()=>[e("span",null,m(A.label),1),A.count!==void 0&&A.count>0?(s(),a("span",{key:0,class:z(["flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full text-xs font-bold leading-none",t.modelValue===A.key?"bg-primary text-white":"bg-gray-200 text-foreground"])},m(A.count),3)):u("",!0),t.modelValue===A.key?(s(),a("span",vl)):u("",!0)]),_:2},1032,["value","class"]))),128))]),_:1})]),_:1},8,["model-value"]))}},Na=Ua(pl,[["__scopeId","data-v-b3f135ea"]]),yl={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},gl={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},xl={class:"flex items-center gap-1.5"},hl={key:1},bl={class:"flex items-center gap-2"},kl={key:0,class:"space-y-4"},wl={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},$l={class:"flex items-center gap-4"},Cl={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-border"},Al=["src"],Il={key:1,class:"fa-solid fa-car text-3xl text-muted-foreground w-full h-full flex items-center justify-center"},Sl={class:"font-bold text-foreground text-base md:text-lg mb-2"},Tl={class:"flex items-center gap-2 flex-wrap"},Dl={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},jl={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},ql={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-muted border border-border text-muted-foreground text-xs font-semibold rounded-md"},Ml={class:"text-xs font-bold text-foreground"},Vl={key:0,class:"text-right"},Ll={class:"font-bold text-foreground text-lg"},Ol={key:0,class:"pt-2"},El={class:"bg-muted border border-border rounded-lg p-3"},Nl={class:"text-sm text-muted-foreground leading-relaxed"},Pl={key:1,class:"space-y-3"},Fl={key:0,class:"flex items-center gap-2"},Rl={class:"text-sm font-semibold text-foreground"},Bl={key:1,class:"bg-muted border border-border rounded-lg p-3"},Ul={class:"text-sm text-muted-foreground leading-relaxed"},_l={key:2,class:"border-t border-border"},zl={class:"font-medium"},Wl={key:3,class:"border-t border-border p-6 bg-muted/30 text-sm animate-fade-in"},Hl={class:"mb-6"},Yl={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Gl={key:0},Ql={class:"font-medium text-muted-foreground"},Jl={key:1},Kl={class:"font-medium text-muted-foreground"},Zl={key:2},Xl={class:"font-medium text-muted-foreground"},eo={class:"font-medium text-muted-foreground"},to={key:0},so={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ao={key:0},no={class:"font-medium text-muted-foreground"},lo={key:1},oo={class:"font-medium text-muted-foreground"},io={key:2},ro={class:"font-medium text-muted-foreground"},uo={key:3},co={class:"font-medium text-muted-foreground"},mo={key:4},fo={class:"font-mono text-xs bg-surface border border-border px-2 py-1 rounded inline-block text-muted-foreground"},vo={key:5},po={class:"font-medium text-muted-foreground"},yo={key:0,class:"mt-6 flex justify-end"},go={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const o=t,f=N(!1);C(()=>o.deliverySubstatus?mn(o.deliverySubstatus):"");const A=C(()=>o.deliverySubstatus?o.deliverySubstatus==="Delivered"?"green":o.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),q=C(()=>Gt(o.stage,o.entityType));function $(O){return!O||O.length===0?null:O.filter(be=>be.type==="offer").sort((be,fe)=>new Date(fe.timestamp)-new Date(be.timestamp))[0]||null}function v(O){if(!O)return 0;const L=new Date(O),fe=Math.abs(new Date-L);return Math.ceil(fe/(1e3*60*60*24))}const c=C(()=>{if(o.stage!=="In Negotiation")return null;const O=$(o.activities);if(!O)return null;const L=v(O.timestamp);return L<1?{label:"New Offer",theme:"orange"}:L<3?{label:"Active",theme:"yellow"}:null}),I=C(()=>o.requestedCar&&o.requestedCar.brand&&o.requestedCar.model),b=C(()=>o.requestType||o.requestMessage||I.value),d=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.brand)||""}),i=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.model)||""}),x=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.year)||""}),D=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.image)||""}),S=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.price)||null}),p=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.stockDays)!==void 0?o.requestedCar.stockDays:null}),r=C(()=>{var O,L;return((O=o.requestedCar)==null?void 0:O.dealership)||((L=o.task)==null?void 0:L.dealership)||""}),g=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.registration)||""}),y=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.kilometers)!==void 0?o.requestedCar.kilometers:null}),M=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.fuelType)||""}),H=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.gearType)||""}),ae=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.vin)||""}),le=C(()=>"Email"),ee=C(()=>{var O,L;return((O=o.task)==null?void 0:O.sourceDetails)||((L=o.requestedCar)==null?void 0:L.adCampaign)||""}),ie=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.expectedPurchaseDate)||""}),E=C(()=>{var O;return((O=o.task)==null?void 0:O.fiscalEntity)||""}),te=C(()=>{var O;return((O=o.task)==null?void 0:O.sourceDetails)||""}),xe=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.adMedium)||""}),Ae=C(()=>{var O;return((O=o.requestedCar)==null?void 0:O.adSource)||""});C(()=>!0);const he=C(()=>!0),K=C(()=>I.value||o.requestType||o.source||te.value||ee.value||ie.value||E.value||xe.value||Ae.value),T=O=>new Intl.NumberFormat("en-US").format(O),W=O=>new Intl.NumberFormat("en-US").format(O);return(O,L)=>(s(),P(n(We),{class:"w-full mb-6 shadow-mk-dashboard-card"},{default:k(()=>[l(n(_e),{class:"px-4 md:px-6 py-3 border-b border-border"},{default:k(()=>[e("div",yl,[b.value?(s(),a("div",gl,[L[2]||(L[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Request")],-1)),e("div",xl,[e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},m(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",q.value])},m(t.stage),3),t.deliverySubstatus?(s(),P(n(pe),{key:0,text:t.deliverySubstatus,size:"small",theme:A.value},null,8,["text","theme"])):u("",!0),c.value?(s(),P(n(pe),{key:1,text:c.value.label,size:"small",theme:c.value.theme},null,8,["text","theme"])):u("",!0)])])):(s(),a("div",hl)),e("div",bl,[L[3]||(L[3]=e("span",{class:"hidden md:inline text-xs text-muted-foreground font-medium"},"Owner",-1)),l(n(_),{onClick:L[0]||(L[0]=be=>O.$emit("reassign")),variant:"link",size:"small",class:"text-xs font-bold"},{default:k(()=>[V(m(t.owner),1)]),_:1})])])]),_:1}),b.value?(s(),P(n(ze),{key:0,class:"p-4 md:p-6"},{default:k(()=>[I.value?(s(),a("div",kl,[e("div",wl,[e("div",$l,[e("div",Cl,[D.value?(s(),a("img",{key:0,src:D.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Al)):(s(),a("i",Il))]),e("div",null,[e("div",Sl,m(d.value)+" "+m(i.value)+" ("+m(x.value)+")",1),e("div",Tl,[p.value!==void 0&&p.value!==null?(s(),a("div",Dl,[L[4]||(L[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+m(p.value)+" days) ",1)])):I.value?(s(),a("div",jl,[...L[5]||(L[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])])):u("",!0),t.source?(s(),a("div",ql,[L[6]||(L[6]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Source:",-1)),e("span",Ml,m(t.source),1)])):u("",!0)])])]),S.value?(s(),a("div",Vl,[L[7]||(L[7]=e("div",{class:"text-xs text-muted-foreground font-medium mb-1"},"Price",-1)),e("div",Ll,"€ "+m(T(S.value)),1)])):u("",!0)]),t.requestMessage?(s(),a("div",Ol,[L[8]||(L[8]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("div",El,[e("p",Nl,m(t.requestMessage),1)])])):u("",!0)])):(s(),a("div",Pl,[t.requestType?(s(),a("div",Fl,[L[9]||(L[9]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Request Type:",-1)),e("span",Rl,m(t.requestType),1)])):u("",!0),t.requestMessage?(s(),a("div",Bl,[L[10]||(L[10]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("p",Ul,m(t.requestMessage),1)])):u("",!0)])),K.value?(s(),a("div",_l,[e("button",{onClick:L[1]||(L[1]=be=>f.value=!f.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-muted-foreground hover:text-foreground hover:bg-muted transition-colors"},[e("span",zl,m(f.value?"Hide":"View")+" Details",1),e("i",{class:z(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":f.value}])},null,2)])])):u("",!0),f.value&&K.value?(s(),a("div",Wl,[e("div",Hl,[L[21]||(L[21]=e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Yl,[t.requestType?(s(),a("div",Gl,[L[11]||(L[11]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Request type",-1)),e("div",Ql,m(t.requestType),1)])):u("",!0),t.source?(s(),a("div",Jl,[L[12]||(L[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source",-1)),e("div",Kl,m(t.source),1)])):u("",!0),e("div",null,[L[13]||(L[13]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source details",-1)),e("div",{class:z(["font-medium",(te.value,"text-muted-foreground")])},m(te.value||"--"),3)]),r.value?(s(),a("div",Zl,[L[14]||(L[14]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",Xl,m(r.value),1)])):u("",!0),e("div",null,[L[15]||(L[15]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Channel",-1)),e("div",eo,m(le.value||"Email"),1)]),e("div",null,[L[16]||(L[16]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdCampaign",-1)),e("div",{class:z(["font-medium",(ee.value,"text-muted-foreground")])},m(ee.value||"--"),3)]),e("div",null,[L[17]||(L[17]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdMedium",-1)),e("div",{class:z(["font-medium",(xe.value,"text-muted-foreground")])},m(xe.value||"--"),3)]),e("div",null,[L[18]||(L[18]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdSource",-1)),e("div",{class:z(["font-medium",(Ae.value,"text-muted-foreground")])},m(Ae.value||"--"),3)]),e("div",null,[L[19]||(L[19]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Expected purchase date",-1)),e("div",{class:z(["font-medium",(ie.value,"text-muted-foreground")])},m(ie.value||"--"),3)]),e("div",null,[L[20]||(L[20]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fiscal entity",-1)),e("div",{class:z(["font-medium",(E.value,"text-muted-foreground")])},m(E.value||"--"),3)])])]),I.value?(s(),a("div",to,[L[30]||(L[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[L[29]||(L[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",so,[g.value?(s(),a("div",ao,[L[22]||(L[22]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Registration",-1)),e("div",no,m(g.value),1)])):u("",!0),y.value!==void 0&&y.value!==null?(s(),a("div",lo,[L[23]||(L[23]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Kilometers",-1)),e("div",oo,m(W(y.value))+" Km",1)])):u("",!0),M.value?(s(),a("div",io,[L[24]||(L[24]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fuel type",-1)),e("div",ro,m(M.value),1)])):u("",!0),H.value?(s(),a("div",uo,[L[25]||(L[25]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Gear type",-1)),e("div",co,m(H.value),1)])):u("",!0),ae.value?(s(),a("div",mo,[L[26]||(L[26]=e("div",{class:"text-xs text-muted-foreground mb-1"},"VIN Number",-1)),e("div",fo,m(ae.value),1)])):u("",!0),r.value?(s(),a("div",vo,[L[27]||(L[27]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",po,m(r.value),1)])):u("",!0)]),he.value?(s(),a("div",yo,[l(n(_),{variant:"outline",size:"small",class:"flex items-center gap-2"},{default:k(()=>[...L[28]||(L[28]=[e("i",{class:"fa-solid fa-list-check text-xs"},null,-1),V(" View technical specs ",-1)])]),_:1})])):u("",!0)])])):u("",!0)])):u("",!0)]),_:1})):u("",!0)]),_:1}))}},xo={class:"rounded-lg flex flex-col h-full bg-muted"},ho={class:"px-4 py-4 flex items-center justify-between shrink-0"},bo={class:"flex items-center gap-2"},ko={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1"},wo={class:"flex items-center gap-2 flex-wrap mb-3"},$o={key:0,class:"space-y-3"},Co={class:"flex items-center gap-3"},Ao={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},Io=["src"],So={key:1,class:"fa-solid fa-car text-2xl text-muted-foreground w-full h-full flex items-center justify-center"},To={class:"flex-1 min-w-0"},Do={class:"font-bold text-foreground text-sm mb-1"},jo={class:"flex items-center gap-2 flex-wrap"},qo={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},Mo={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},Vo={key:0,class:"text-right"},Lo={class:"font-bold text-foreground text-sm"},Oo={class:"flex justify-end pt-2"},Eo={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},No={class:"mt-3 pt-3 space-y-2"},Po={key:0,class:"flex items-center justify-between text-xs"},Fo={class:"text-foreground font-medium"},Ro={key:1,class:"flex items-center justify-between text-xs"},Bo={class:"text-foreground font-medium"},Uo={key:2,class:"pt-2"},_o={class:"bg-muted rounded-lg p-2"},zo={class:"text-xs text-muted-foreground leading-relaxed line-clamp-3"},Pa={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const o=t,f=C(()=>o.task.requestedCar&&o.task.requestedCar.brand&&o.task.requestedCar.model),A=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.brand)||""}),q=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.model)||""}),$=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.year)||""}),v=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.image)||""}),c=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.price)||null}),I=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.stockDays)!==void 0?o.task.requestedCar.stockDays:null}),b=C(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.requestMessage)||""}),d=C(()=>Gt(o.task.displayStage||o.task.stage,o.entityType)),i=C(()=>o.task.deliverySubstatus?o.task.deliverySubstatus==="Delivered"?"green":o.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function x(r){return!r||r.length===0?null:r.filter(y=>y.type==="offer").sort((y,M)=>new Date(M.timestamp)-new Date(y.timestamp))[0]||null}function D(r){if(!r)return 0;const g=new Date(r),M=Math.abs(new Date-g);return Math.ceil(M/(1e3*60*60*24))}const S=C(()=>{if((o.task.displayStage||o.task.stage)!=="In Negotiation")return null;const r=x(o.activities);if(!r)return null;const g=D(r.timestamp);return g<1?{label:"New Offer",theme:"orange"}:g<3?{label:"Active",theme:"yellow"}:null}),p=r=>new Intl.NumberFormat("en-US").format(r);return(r,g)=>{var y,M;return s(),a("div",xo,[e("div",ho,[g[4]||(g[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-foreground"}),e("h2",{class:"text-base font-medium text-foreground leading-6"},"Requested Car")],-1)),e("div",bo,[g[3]||(g[3]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Owner:",-1)),e("button",{onClick:g[0]||(g[0]=H=>r.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},m(t.task.assignee),1)])]),e("div",ko,[e("div",wo,[e("span",{class:z(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},m(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:z(["px-2 py-1 rounded text-xs font-medium border",d.value])},m(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(s(),P(n(pe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:i.value},null,8,["text","theme"])):u("",!0),S.value?(s(),P(n(pe),{key:1,text:S.value.label,size:"small",theme:S.value.theme},null,8,["text","theme"])):u("",!0)]),f.value?(s(),a("div",$o,[e("div",Co,[e("div",Ao,[v.value?(s(),a("img",{key:0,src:v.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Io)):(s(),a("i",So))]),e("div",To,[e("div",Do,m(A.value)+" "+m(q.value)+" ("+m($.value)+")",1),e("div",jo,[I.value!==void 0&&I.value!==null?(s(),a("div",qo,[g[5]||(g[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+m(I.value)+" days) ",1)])):(s(),a("div",Mo,[...g[6]||(g[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),V(" Out of stock ",-1)])]))])]),c.value?(s(),a("div",Vo,[g[7]||(g[7]=e("div",{class:"text-xs text-muted-foreground font-medium"},"Price",-1)),e("div",Lo,"€ "+m(p(c.value)),1)])):u("",!0)]),e("div",Oo,[l(n(_),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:g[1]||(g[1]=H=>r.$emit("add-requested-car")),class:"text-xs"},null,8,["label"])])])):(s(),a("div",Eo,[g[8]||(g[8]=e("i",{class:"fa-solid fa-car text-4xl text-muted-foreground mb-3"},null,-1)),g[9]||(g[9]=e("p",{class:"text-sm text-muted-foreground mb-4"},"No requested car added yet",-1)),l(n(_),{label:"+ Add or update",variant:"outline",size:"small",onClick:g[2]||(g[2]=H=>r.$emit("add-requested-car"))})])),e("div",No,[t.task.source?(s(),a("div",Po,[g[10]||(g[10]=e("span",{class:"text-muted-foreground"},"Source",-1)),e("span",Fo,m(t.task.source),1)])):u("",!0),t.task.requestType||(y=t.task.requestedCar)!=null&&y.requestType?(s(),a("div",Ro,[g[11]||(g[11]=e("span",{class:"text-muted-foreground"},"Request Type",-1)),e("span",Bo,m(t.task.requestType||((M=t.task.requestedCar)==null?void 0:M.requestType)),1)])):u("",!0),b.value?(s(),a("div",Uo,[g[12]||(g[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Message",-1)),e("div",_o,[e("p",zo,m(b.value),1)])])):u("",!0)])])])}}},Wo={class:"rounded-lg flex flex-col h-full bg-muted"},Ho={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},Yo={class:"flex items-center gap-2"},Go={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Qo={class:"bg-white rounded-lg p-3 shadow-nsc-card flex flex-col flex-1 min-h-0"},Jo={key:0,class:"text-center py-6 text-muted-foreground"},Ko={key:1,class:"space-y-2 overflow-y-auto flex-1"},Zo=["onClick"],Xo={class:"flex items-start justify-between gap-2"},ei={class:"flex-1 min-w-0"},ti={class:"flex items-center gap-2 mb-1 flex-wrap"},si={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-muted-foreground"},ai={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},ni={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-muted-foreground"},li={key:1,class:"flex items-center gap-1 text-xs text-muted-foreground"},oi={key:2,class:"flex items-center gap-1 text-xs text-muted-foreground"},ii={class:"truncate max-w-[150px]"},ri={key:3,class:"flex items-center gap-1 text-xs"},di={class:"font-bold text-foreground"},ui={key:2,class:"text-center py-8 text-muted-foreground"},Fa={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const o=t,f=qe(),A=_a(),q=Ha(),$=N(!1),v=N([]),c=N([]),I=C(()=>{var p;return o.task.customerId||((p=o.task.customer)==null?void 0:p.id)||null}),b=async()=>{if(I.value){$.value=!0;try{await Promise.all([A.fetchLeads(),q.fetchOpportunities()]),v.value=A.leads||[],c.value=q.opportunities||[]}catch(p){console.error("Error fetching related tasks:",p)}finally{$.value=!1}}},d=C(()=>{if(!I.value)return[];const p=[];return v.value.forEach(r=>{r.customerId===I.value&&!(r.id===o.task.id&&o.entityType==="lead")&&p.push({...r,type:"lead"})}),c.value.forEach(r=>{r.customerId===I.value&&!(r.id===o.task.id&&o.entityType==="opportunity")&&p.push({...r,type:"opportunity"})}),p.sort((r,g)=>{const y=new Date(r.createdAt||0);return new Date(g.createdAt||0)-y})}),i=p=>{const r=p.requestedCar||p.vehicle;return r&&r.brand&&r.model?`${r.brand} ${r.model}`:null},x=p=>p?new Intl.NumberFormat("en-US").format(p):"0",D=p=>{if(!p)return"";const r=new Date(p),y=new Date-r,M=Math.floor(y/(1e3*60*60*24));return M===0?"Today":M===1?"Yesterday":M<7?`${M} days ago`:M<30?`${Math.floor(M/7)} weeks ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},S=p=>{f.push({path:`/tasks/${p.id}`,query:{type:p.type}})};return Le(()=>o.task.id,()=>{b()},{immediate:!0}),wt(()=>{b()}),(p,r)=>(s(),a("div",Wo,[e("div",Ho,[e("div",Yo,[r[0]||(r[0]=e("i",{class:"fa-solid fa-list text-foreground text-xs"},null,-1)),r[1]||(r[1]=e("h2",{class:"text-xs font-medium text-foreground"},"Other Tasks for This Customer",-1)),d.value.length>0?(s(),a("span",Go,m(d.value.length),1)):u("",!0)])]),e("div",Qo,[$.value?(s(),a("div",Jo,[...r[2]||(r[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):d.value.length>0?(s(),a("div",Ko,[(s(!0),a(Q,null,se(d.value,g=>(s(),a("div",{key:`${g.type}-${g.id}`,class:"flex flex-col p-2 border border-border rounded-lg hover:bg-muted transition-colors cursor-pointer group",onClick:y=>S(g)},[e("div",Xo,[e("div",ei,[e("div",ti,[e("span",{class:z(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",g.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},m(g.type==="lead"?"Lead":"Opp"),3),e("span",{class:z(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",n(Gt)(g.displayStage||g.stage,g.type)])},m(g.displayStage||g.stage),3),g.createdAt?(s(),a("div",si,[e("span",null,m(D(g.createdAt)),1)])):u("",!0)]),e("div",ai,[g.createdAt?(s(),a("div",ni,[r[3]||(r[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,m(D(g.createdAt)),1)])):u("",!0),g.assignee?(s(),a("div",li,[r[4]||(r[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,m(g.assignee),1)])):u("",!0),i(g)?(s(),a("div",oi,[r[5]||(r[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",ii,m(i(g)),1)])):u("",!0),g.type==="opportunity"&&g.value?(s(),a("div",ri,[r[6]||(r[6]=e("i",{class:"fa-solid fa-tag text-muted-foreground opacity-70"},null,-1)),e("span",di,"€ "+m(x(g.value)),1)])):u("",!0)])]),r[7]||(r[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-brand-blue/30 text-muted-foreground hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,Zo))),128))])):(s(),a("div",ui,[...r[8]||(r[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},ci={key:0,class:"flex-grow border-t border"},mi={key:0,class:"ml-1.5 text-muted-foreground"},fi={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},vi={key:1,class:"flex-grow border-t border"},Ra={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:o}){const f=t,A=o,q=N(!1),$={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},v=C(()=>{if(!f.activeTab||f.activeTab==="overview")return f.actions.filter(p=>!$[p]);const S=Object.entries($).filter(([,p])=>p===f.activeTab).map(([p])=>p);return f.actions.filter(p=>S.includes(p))}),c=C(()=>f.activeTab==="communication"?!0:v.value.length===1),I=C(()=>{if(f.activeTab==="communication")return"add communication";if(!c.value||v.value.length!==1)return"";const S=v.value[0];return{note:"add note",attachment:"add attachment"}[S]||""}),b=C(()=>f.activeTab==="communication"?!1:v.value.length>1),d=C(()=>{const S={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return v.value.map(p=>({key:p,label:S[p]||p,onClick:()=>x(p)}))}),i=C(()=>{if(f.inline)return"bg-surface hover:bg-muted text-muted-foreground font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";const S="bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";return c.value?`${S} px-4 py-2 h-9`:`${S} w-9 h-9`});C(()=>v.value.some(S=>["email","whatsapp","sms"].includes(S))),C(()=>v.value.some(S=>["addVehicle","configureVehicle"].includes(S))),C(()=>v.value.some(S=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(S)));const x=S=>{q.value=!1,A("action",S)},D=()=>{if(f.activeTab==="communication"){x("call");return}c.value&&v.value.length===1?x(v.value[0]):q.value=!q.value};return(S,p)=>{const r=za("click-outside");return t.show?(s(),a("div",{key:0,class:z(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?u("",!0):(s(),a("div",ci)),e("div",{class:z(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:je(D,["stop"]),class:z(i.value)},[p[0]||(p[0]=e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1)),c.value?(s(),a("span",mi,m(I.value),1)):u("",!0)],2),q.value&&b.value?re((s(),a("div",fi,[l(n(Ga),{items:d.value,className:"w-48"},null,8,["items"])])),[[r,()=>q.value=!1]]):u("",!0)],2),t.inline?u("",!0):(s(),a("div",vi))],2)):u("",!0)}}},pi={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},yi={class:"flex items-start gap-3"},gi={class:"flex-1 min-w-0"},xi={class:"font-bold text-sm text-foreground mb-2"},hi={class:"space-y-1.5 text-xs text-gray-600"},bi={class:"flex items-center gap-2"},ki={class:"flex items-center gap-2"},wi={class:"flex items-center gap-2"},$i={key:0,class:"mt-2"},Ci={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const o=t,f=C(()=>o.appointmentData.date?new Date(o.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),A=C(()=>o.appointmentData.time?o.appointmentData.time:""),q=$=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[$==null?void 0:$.toLowerCase()]||"bg-muted text-muted-foreground border border-border";return($,v)=>(s(),a("div",pi,[e("div",yi,[v[3]||(v[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",gi,[e("h4",xi,m(t.appointmentData.type),1),e("div",hi,[e("div",bi,[v[0]||(v[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,m(f.value),1)]),e("div",ki,[v[1]||(v[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,m(A.value),1)]),e("div",wi,[v[2]||(v[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,m(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),a("div",$i,[e("span",{class:z(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",q(t.appointmentData.status)])},m(t.appointmentData.status),3)])):u("",!0)])])]))}},Ai={class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in mb-4 feed-item"},Ii={class:"flex-1"},Si={class:"flex items-center gap-2 mb-1"},Ti={class:"text-sm font-bold text-foreground"},Di={class:"text-sm text-muted-foreground"},ji={class:"text-sm text-muted-foreground"},qi={key:0,class:"bg-blue-50 text-blue-600 text-sm px-1 py-0.5 rounded border border-blue-100"},Mi={class:"ml-auto relative"},Vi={key:0,class:"absolute right-0 top-full mt-1 z-10"},Li={key:0,class:"text-sm text-muted-foreground"},Oi={key:1,class:"text-sm text-muted-foreground flex items-center gap-2"},Ei={key:2,class:"mt-2"},Ni={key:0},Pi={key:1,class:"bg-white border border-border rounded-lg p-3"},Fi={key:0},Ri={class:"text-sm font-bold text-foreground"},Bi={key:0,class:"text-sm text-muted-foreground mt-0.5"},Ui={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-muted-foreground mt-2"},_i={key:0},zi={key:1},Wi={key:2},Hi={key:3},Yi={key:4},Gi={key:1},Qi={class:"text-sm font-bold text-foreground mb-2"},Ji={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},Ki={key:0},Zi={class:"text-muted-foreground font-medium ml-1"},Xi={key:1},er={class:"text-muted-foreground font-medium ml-1"},tr={key:2},sr={class:"text-muted-foreground font-medium ml-1"},ar={key:3},nr={class:"text-muted-foreground font-medium ml-1"},lr={key:4},or={class:"text-muted-foreground font-medium ml-1"},ir={key:5},rr={class:"text-muted-foreground font-medium ml-1"},dr={key:2},ur={key:0,class:"inline-block mt-2 bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},cr={key:3,class:"flex items-center gap-3"},mr={class:"flex-1"},fr={class:"text-sm font-bold text-foreground"},vr={class:"text-sm text-muted-foreground"},pr={key:0,class:"text-sm text-muted-foreground mt-1"},yr={key:1,class:"text-sm text-muted-foreground mt-1"},gr={key:4},xr={class:"text-sm font-bold text-foreground mb-2"},hr={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},br={key:0},kr={class:"text-muted-foreground font-medium ml-1"},wr={key:1},$r={class:"text-muted-foreground font-medium ml-1"},Cr={key:2},Ar={class:"text-muted-foreground font-medium ml-1"},Ir={key:3},Sr={class:"text-muted-foreground font-medium ml-1"},Tr={key:4},Dr={class:"text-muted-foreground font-medium ml-1"},jr={key:5},qr={class:"text-muted-foreground font-medium ml-1"},Mr={key:0,class:"flex flex-wrap gap-2 mt-2"},Vr={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Lr={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},Or={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},zt={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:o}){const f=t,A=o,q=N(!1),$=C(()=>[{key:"edit",label:"Edit",onClick:i},{key:"delete",label:"Delete",onClick:x}]),v=D=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[D]||"fa-solid fa-circle",c=D=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-muted text-muted-foreground border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-muted text-muted-foreground border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[D]||"bg-muted text-muted-foreground border",I=D=>{if(!D)return"Just now";const S=new Date(D),r=new Date-S,g=Math.floor(r/6e4),y=Math.floor(g/60),M=Math.floor(y/24);return g<1?"Just now":g<60?`${g} minutes ago`:y<24?`${y} hours ago`:M===1?"Yesterday":M<7?`${M} days ago`:S.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=D=>D?new Intl.NumberFormat("en-US").format(D):"0",d=D=>D?new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",i=()=>{q.value=!1,A("edit",f.item)},x=()=>{q.value=!1,confirm("Are you sure you want to delete this item?")&&A("delete",f.item)};return(D,S)=>{const p=za("click-outside");return s(),a("div",Ai,[e("div",{class:z(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",c(t.item.type)])},[e("i",{class:z([v(t.item.type),"text-sm"])},null,2)],2),e("div",Ii,[e("div",Si,[e("span",Ti,m(t.customerInitials),1),e("span",Di,m(t.item.action||"added"),1),e("span",ji,"• "+m(I(t.item.timestamp)),1),t.item.autoDetected?(s(),a("span",qi,"Auto-detected")):u("",!0),e("div",Mi,[e("button",{onClick:S[0]||(S[0]=je(r=>q.value=!q.value,["stop"])),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...S[1]||(S[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),q.value?re((s(),a("div",Vi,[l(n(Ga),{items:$.value,className:"w-32"},null,8,["items"])])),[[p,()=>q.value=!1]]):u("",!0)])]),t.item.content?(s(),a("div",Li,m(t.item.content),1)):u("",!0),t.item.fileName?(s(),a("div",Oi,[S[2]||(S[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,m(t.item.fileName),1)])):u("",!0),t.item.data?(s(),a("div",Ei,[t.item.type==="appointment"?(s(),a("div",Ni,[l(Ci,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),a("div",Pi,[t.item.type==="tradein"?(s(),a("div",Fi,[e("h4",Ri,m(t.item.data.brand)+" "+m(t.item.data.model),1),t.item.data.version?(s(),a("p",Bi,m(t.item.data.version),1)):u("",!0),e("div",Ui,[t.item.data.year?(s(),a("div",_i,[S[3]||(S[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),V(m(t.item.data.year),1)])):u("",!0),t.item.data.km?(s(),a("div",zi,[S[4]||(S[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),V(m(t.item.data.km)+" km ",1)])):u("",!0),t.item.data.plate?(s(),a("div",Wi,[S[5]||(S[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),V(m(t.item.data.plate),1)])):u("",!0),t.item.data.date?(s(),a("div",Hi,[S[6]||(S[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),V(m(d(t.item.data.date)),1)])):u("",!0),t.item.data.class?(s(),a("div",Yi,[S[7]||(S[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),V(m(t.item.data.class),1)])):u("",!0)])])):t.item.type==="financing"?(s(),a("div",Gi,[e("h4",Qi,m(t.item.data.product),1),e("div",Ji,[t.item.data.provider?(s(),a("div",Ki,[S[8]||(S[8]=e("span",{class:"text-muted-foreground"},"Provider:",-1)),e("span",Zi,m(t.item.data.provider),1)])):u("",!0),t.item.data.total?(s(),a("div",Xi,[S[9]||(S[9]=e("span",{class:"text-muted-foreground"},"Total:",-1)),e("span",er,"€"+m(b(t.item.data.total)),1)])):u("",!0),t.item.data.monthly?(s(),a("div",tr,[S[10]||(S[10]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",sr,"€"+m(b(t.item.data.monthly)),1)])):u("",!0),t.item.data.deposit?(s(),a("div",ar,[S[11]||(S[11]=e("span",{class:"text-muted-foreground"},"Deposit:",-1)),e("span",nr,"€"+m(b(t.item.data.deposit)),1)])):u("",!0),t.item.data.startDate?(s(),a("div",lr,[S[12]||(S[12]=e("span",{class:"text-muted-foreground"},"Start:",-1)),e("span",or,m(d(t.item.data.startDate)),1)])):u("",!0),t.item.data.expDate?(s(),a("div",ir,[S[13]||(S[13]=e("span",{class:"text-muted-foreground"},"Expires:",-1)),e("span",rr,m(d(t.item.data.expDate)),1)])):u("",!0)])])):t.item.type==="offer"?(s(),a("div",dr,[l(An,{offers:[t.item.data],"opportunity-id":t.item.opportunityId||t.item.leadId||""},null,8,["offers","opportunity-id"]),t.item.data.isMainOffer?(s(),a("span",ur,"Main Offer")):u("",!0)])):t.item.type==="purchase"?(s(),a("div",cr,[e("div",mr,[e("h4",fr,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",vr,"€ "+m(b(t.item.data.price)),1),t.item.data.purchaseDate?(s(),a("p",pr,"Purchased: "+m(d(t.item.data.purchaseDate)),1)):u("",!0),t.item.data.notes?(s(),a("p",yr,m(t.item.data.notes),1)):u("",!0)])])):t.item.type==="purchase-method"?(s(),a("div",gr,[e("h4",xr,m(t.item.data.typeLabel||t.item.data.type),1),e("div",hr,[t.item.data.monthlyInstalment?(s(),a("div",br,[S[14]||(S[14]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",kr,"€"+m(b(t.item.data.monthlyInstalment)),1)])):u("",!0),t.item.data.duration?(s(),a("div",wr,[S[15]||(S[15]=e("span",{class:"text-muted-foreground"},"Duration:",-1)),e("span",$r,m(t.item.data.duration)+" months",1)])):u("",!0),t.item.data.downPayment?(s(),a("div",Cr,[S[16]||(S[16]=e("span",{class:"text-muted-foreground"},"Down Payment:",-1)),e("span",Ar,"€"+m(b(t.item.data.downPayment)),1)])):u("",!0),t.item.data.interestRate?(s(),a("div",Ir,[S[17]||(S[17]=e("span",{class:"text-muted-foreground"},"Interest Rate:",-1)),e("span",Sr,m(t.item.data.interestRate)+"%",1)])):u("",!0),t.item.data.mileageLimit?(s(),a("div",Tr,[S[18]||(S[18]=e("span",{class:"text-muted-foreground"},"Mileage Limit:",-1)),e("span",Dr,m(b(t.item.data.mileageLimit))+" km/year",1)])):u("",!0),t.item.data.customerType?(s(),a("div",jr,[S[19]||(S[19]=e("span",{class:"text-muted-foreground"},"Customer Type:",-1)),e("span",qr,m(t.item.data.customerType),1)])):u("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(s(),a("div",Mr,[t.item.data.insuranceIncluded?(s(),a("span",Vr,"Insurance")):u("",!0),t.item.data.maintenanceIncluded?(s(),a("span",Lr,"Maintenance")):u("",!0),t.item.data.registrationTaxesIncluded?(s(),a("span",Or,"Registration/Taxes")):u("",!0)])):u("",!0)])):u("",!0)]))])):u("",!0)])])}}},Er={class:"space-y-3"},Nr={class:"space-y-2"},Pr={class:"flex-1"},Fr={class:"text-xs text-muted-foreground uppercase"},Rr={class:"flex justify-end gap-2 pt-3 border-t border-border"},Ba={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:o}){const f=t,A=o,q=N(""),$=v=>{v==="copy"&&navigator.clipboard.writeText(f.phoneNumber),A("call",{type:"call",option:v,phoneNumber:f.phoneNumber,notes:q.value})};return(v,c)=>(s(),a("div",Er,[e("div",Nr,[c[10]||(c[10]=e("label",{class:"block text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:c[0]||(c[0]=I=>$("outbound")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...c[5]||(c[5]=[Da('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-muted-foreground uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:c[1]||(c[1]=I=>$("pbx")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...c[6]||(c[6]=[Da('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with PBX</p><p class="text-xs text-muted-foreground uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:c[2]||(c[2]=I=>$("copy")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[c[8]||(c[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Pr,[c[7]||(c[7]=e("p",{class:"font-bold text-sm text-foreground uppercase tracking-tight"},"Copy Number",-1)),e("p",Fr,m(t.phoneNumber),1)]),c[9]||(c[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Call Notes",-1)),re(e("textarea",{"onUpdate:modelValue":c[3]||(c[3]=I=>q.value=I),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[Ne,q.value]])]),e("div",Rr,[l(n(_),{label:"Cancel",variant:"outline",size:"small",onClick:c[4]||(c[4]=I=>v.$emit("cancel"))})])]))}},Br={key:0,class:"space-y-4"},Ur={class:"grid grid-cols-4 gap-2"},_r=["onClick"],zr={class:"text-xs font-bold uppercase tracking-wider"},Wr={key:1,class:"space-y-4"},Hr={class:"grid grid-cols-4 gap-2"},Yr=["onClick"],Gr={class:"text-xs font-bold uppercase tracking-wider"},Qr={key:0},Jr={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:o}){const f=t,A=o,q=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],$=N(f.type);Le(()=>f.type,d=>{d?$.value=d:$.value=null}),Le(()=>f.taskId,()=>{$.value=null});const v=C(()=>d=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${$.value===d?"border-brand-dark bg-muted text-brand-dark shadow-nsc-card":"border-border text-muted-foreground hover:border-brand-dark/30 hover:bg-muted/30 hover:text-muted-foreground"}`),c=d=>{A("save",{type:"communication",action:`sent via ${d.type}`,content:d.message,communicationType:d.type,template:d.template,subject:d.subject}),A("send",d)},I=d=>{A("save",{type:"communication",action:`called via ${d.option}`,content:d.notes||"Call attempt logged",communicationType:"call",callOption:d.option}),A("send",{type:"call",option:d.option,phoneNumber:d.phoneNumber,notes:d.notes})},b=()=>{$.value=null,A("cancel")};return(d,i)=>t.inline?(s(),a("div",Wr,[e("div",Hr,[(s(),a(Q,null,se(q,x=>e("button",{key:x.id,onClick:D=>$.value=x.id,class:z(v.value(x.id))},[e("i",{class:z([x.icon,"text-sm"])},null,2),e("span",Gr,m(x.label),1)],10,Yr)),64))]),$.value?(s(),a("div",Qr,[$.value==="email"?(s(),P(Ma,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="sms"?(s(),P(Va,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="whatsapp"?(s(),P(La,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="call"?(s(),P(Ba,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:b},null,8,["phone-number"])):u("",!0)])):u("",!0)])):(s(),a("div",Br,[e("div",Ur,[(s(),a(Q,null,se(q,x=>e("button",{key:x.id,onClick:D=>$.value=x.id,class:z(v.value(x.id))},[e("i",{class:z([x.icon,"text-sm"])},null,2),e("span",zr,m(x.label),1)],10,_r)),64))]),e("div",null,[$.value==="email"?(s(),P(Ma,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="sms"?(s(),P(Va,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="whatsapp"?(s(),P(La,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="call"?(s(),P(Ba,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:b},null,8,["phone-number"])):u("",!0)])]))}},Kr={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},Zr={key:1,class:"flex justify-between items-center mb-4"},Xr={class:"text-sm font-semibold text-foreground"},ed={class:"space-y-4"},td={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},sd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ad={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},nd={class:"border border-border rounded-lg bg-muted"},ld={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},od={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},id={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},dd={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:f}){const A=t,q=f,$=N(!1),v=N({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),c=N({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),I=C(()=>!!v.value.brand&&!!v.value.model&&!!v.value.year);wt(()=>{A.item&&A.item.data&&(v.value={brand:A.item.data.brand||"",model:A.item.data.model||"",year:A.item.data.year||"",version:A.item.data.version||"",vin:A.item.data.vin||"",plates:A.item.data.plate||A.item.data.plates||"",fuelType:A.item.data.fuelType||"",gearType:A.item.data.gearType||"",kilometers:A.item.data.km||A.item.data.kilometers||"",registration:A.item.data.date||A.item.data.registration||""},A.item.data.tradeInPrice!==void 0&&(c.value={tradeInPrice:A.item.data.tradeInPrice||null,evaluationRangeLow:A.item.data.evaluationRangeLow||null,evaluationRangeHigh:A.item.data.evaluationRangeHigh||null,provider:A.item.data.provider||"",evaluationDate:A.item.data.evaluationDate||""},$.value=!0))});const b=()=>{var i,x;if(!I.value)return;const d={id:((i=A.item)==null?void 0:i.id)||Date.now(),type:"tradein",action:A.item?"updated a trade-in":"added a trade-in",timestamp:((x=A.item)==null?void 0:x.timestamp)||new Date().toISOString(),isEdit:!!A.item,data:{brand:v.value.brand,model:v.value.model,year:parseInt(v.value.year)||null,version:v.value.version||null,vin:v.value.vin||null,plate:v.value.plates||null,plates:v.value.plates||null,fuelType:v.value.fuelType||null,gearType:v.value.gearType||null,km:parseInt(v.value.kilometers)||0,kilometers:parseInt(v.value.kilometers)||0,date:v.value.registration||null,registration:v.value.registration||null,tradeInPrice:c.value.tradeInPrice,evaluationRangeLow:c.value.evaluationRangeLow,evaluationRangeHigh:c.value.evaluationRangeHigh,provider:c.value.provider||null,evaluationDate:c.value.evaluationDate||null}};q("save",d)};return o({submit:b,canSubmit:()=>I.value}),(d,i)=>(s(),a("div",{class:z(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?u("",!0):(s(),a("div",Kr)),t.hideHeader?u("",!0):(s(),a("div",Zr,[e("h5",Xr,m(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:i[0]||(i[0]=x=>d.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...i[18]||(i[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",ed,[e("div",td,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[19]||(i[19]=[V("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.brand,"onUpdate:modelValue":i[1]||(i[1]=x=>v.value.brand=x),type:"text",placeholder:"e.g., Volkswagen",required:""},null,8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[20]||(i[20]=[V("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.model,"onUpdate:modelValue":i[2]||(i[2]=x=>v.value.model=x),type:"text",placeholder:"e.g., ID.4",required:""},null,8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[21]||(i[21]=[V("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.year,"onUpdate:modelValue":i[3]||(i[3]=x=>v.value.year=x),type:"number",placeholder:"e.g., 2024",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[22]||(i[22]=[V("Version/Trim",-1)])]),_:1}),l(n(de),{modelValue:v.value.version,"onUpdate:modelValue":i[4]||(i[4]=x=>v.value.version=x),type:"text",placeholder:"e.g., Premium Plus"},null,8,["modelValue"])]),e("div",sd,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[23]||(i[23]=[V("VIN",-1)])]),_:1}),l(n(de),{modelValue:v.value.vin,"onUpdate:modelValue":i[5]||(i[5]=x=>v.value.vin=x),type:"text",placeholder:"Vehicle Identification Number"},null,8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[24]||(i[24]=[V("Plates",-1)])]),_:1}),l(n(de),{modelValue:v.value.plates,"onUpdate:modelValue":i[6]||(i[6]=x=>v.value.plates=x),type:"text",placeholder:"License plate number"},null,8,["modelValue"])])]),e("div",ad,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[25]||(i[25]=[V("Fuel Type",-1)])]),_:1}),l(n(at),{modelValue:v.value.fuelType,"onUpdate:modelValue":i[7]||(i[7]=x=>v.value.fuelType=x)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select fuel type..."})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Petrol"},{default:k(()=>[...i[26]||(i[26]=[V("Petrol",-1)])]),_:1}),l(n(oe),{value:"Diesel"},{default:k(()=>[...i[27]||(i[27]=[V("Diesel",-1)])]),_:1}),l(n(oe),{value:"Electric"},{default:k(()=>[...i[28]||(i[28]=[V("Electric",-1)])]),_:1}),l(n(oe),{value:"Hybrid"},{default:k(()=>[...i[29]||(i[29]=[V("Hybrid",-1)])]),_:1}),l(n(oe),{value:"Plug-in Hybrid"},{default:k(()=>[...i[30]||(i[30]=[V("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[31]||(i[31]=[V("Gear Type",-1)])]),_:1}),l(n(at),{modelValue:v.value.gearType,"onUpdate:modelValue":i[8]||(i[8]=x=>v.value.gearType=x)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select gear type..."})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Manual"},{default:k(()=>[...i[32]||(i[32]=[V("Manual",-1)])]),_:1}),l(n(oe),{value:"Automatic"},{default:k(()=>[...i[33]||(i[33]=[V("Automatic",-1)])]),_:1}),l(n(oe),{value:"CVT"},{default:k(()=>[...i[34]||(i[34]=[V("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[35]||(i[35]=[V("Mileage (km)",-1)])]),_:1}),l(n(de),{modelValue:v.value.kilometers,"onUpdate:modelValue":i[9]||(i[9]=x=>v.value.kilometers=x),modelModifiers:{number:!0},type:"number",placeholder:"0",min:"0"},null,8,["modelValue"])])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[36]||(i[36]=[V("Registration Year/Month",-1)])]),_:1}),l(n(de),{modelValue:v.value.registration,"onUpdate:modelValue":i[10]||(i[10]=x=>v.value.registration=x),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)"},null,8,["modelValue"])]),e("div",nd,[e("button",{type:"button",onClick:i[11]||(i[11]=x=>$.value=!$.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-lg"},[i[37]||(i[37]=e("h3",{class:"text-sm font-medium text-foreground"},"Valuation Information",-1)),e("i",{class:z(["fa-solid transition-transform duration-200 text-muted-foreground",$.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),$.value?(s(),a("div",ld,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[38]||(i[38]=[V("Trade-In Price (€)",-1)])]),_:1}),l(n(de),{modelValue:c.value.tradeInPrice,"onUpdate:modelValue":i[12]||(i[12]=x=>c.value.tradeInPrice=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",od,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[39]||(i[39]=[V("Evaluation Range - Low (€)",-1)])]),_:1}),l(n(de),{modelValue:c.value.evaluationRangeLow,"onUpdate:modelValue":i[13]||(i[13]=x=>c.value.evaluationRangeLow=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[40]||(i[40]=[V("Evaluation Range - High (€)",-1)])]),_:1}),l(n(de),{modelValue:c.value.evaluationRangeHigh,"onUpdate:modelValue":i[14]||(i[14]=x=>c.value.evaluationRangeHigh=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])])]),e("div",id,[e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[41]||(i[41]=[V("Provider",-1)])]),_:1}),l(n(at),{modelValue:c.value.provider,"onUpdate:modelValue":i[15]||(i[15]=x=>c.value.provider=x)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select provider..."})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Eurotax"},{default:k(()=>[...i[42]||(i[42]=[V("Eurotax",-1)])]),_:1}),l(n(oe),{value:"Infocar"},{default:k(()=>[...i[43]||(i[43]=[V("Infocar",-1)])]),_:1}),l(n(oe),{value:"Manual"},{default:k(()=>[...i[44]||(i[44]=[V("Manual",-1)])]),_:1}),l(n(oe),{value:"Other"},{default:k(()=>[...i[45]||(i[45]=[V("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(n(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[46]||(i[46]=[V("Evaluation Date",-1)])]),_:1}),l(n(de),{modelValue:c.value.evaluationDate,"onUpdate:modelValue":i[16]||(i[16]=x=>c.value.evaluationDate=x),type:"date"},null,8,["modelValue"])])])])):u("",!0)])]),t.hideActions?u("",!0):(s(),a("div",rd,[l(n(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:i[17]||(i[17]=x=>d.$emit("cancel"))}),l(n(_),{label:"Save",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!I.value,onClick:b},null,8,["disabled"])]))],2))}},ud={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},cd={key:1,class:"flex justify-between items-center mb-4"},md={class:"text-sm font-semibold text-foreground"},fd={class:"flex gap-2"},vd=["value"],pd={key:0,class:"space-y-4"},yd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gd={class:"relative"},xd={key:0,class:"text-xs text-red-600 mt-1"},hd={class:"relative"},bd={key:0,class:"text-xs text-red-600 mt-1"},kd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wd=["value"],$d={key:0,class:"text-xs text-red-600 mt-1"},Cd={key:0},Ad={class:"relative"},Id={key:1},Sd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Td={class:"relative"},Dd={class:"relative"},jd={class:"flex items-center gap-2"},qd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Md={class:"relative"},Vd={class:"bg-muted p-4 rounded-lg border border-border"},Ld={class:"flex justify-between items-center"},Od={class:"text-lg font-bold text-foreground"},Ed={class:"flex flex-col gap-2"},Nd={class:"flex items-center gap-2"},Pd={class:"flex items-center gap-2"},Fd={key:0,class:"text-xs text-red-600 mt-1"},Rd={class:"bg-muted p-4 rounded-lg border border-border"},Bd={class:"flex justify-between items-center"},Ud={class:"text-lg font-bold text-foreground"},_d={class:"flex flex-col gap-2"},zd={class:"flex items-center gap-2"},Wd={class:"flex items-center gap-2"},Hd={class:"flex items-center gap-2"},Yd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Gd={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:f}){const A=t,q=f,$=N({}),v=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],c=N({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),I=C(()=>{if(c.value.type!=="LEA")return 0;const g=parseFloat(c.value.fields.monthlyInstalment)||0,y=parseInt(c.value.fields.duration)||0,M=parseFloat(c.value.fields.downPayment)||0,H=parseFloat(c.value.fields.finalInstalment)||0;return g*y+M+H}),b=C(()=>{if(c.value.type!=="LTR")return 0;const g=parseFloat(c.value.fields.monthlyInstalment)||0,y=parseInt(c.value.fields.duration)||0,M=parseFloat(c.value.fields.downPayment)||0;return g*y+M}),d=g=>g==="FIN"?[12,24,36,48,60]:g==="LEA"?[24,36,48,60]:g==="LTR"?[12,24,36,48,60]:[],i=g=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[g]||g,x=g=>g?new Intl.NumberFormat("en-US").format(g):"0",D=g=>{delete $.value[g]},S=C(()=>!c.value.type||!c.value.fields.monthlyInstalment||c.value.fields.monthlyInstalment<=0||c.value.fields.downPayment===null||c.value.fields.downPayment===void 0||c.value.fields.downPayment<0||!c.value.fields.duration||c.value.fields.duration<12||c.value.fields.duration>60||c.value.type==="LTR"&&!c.value.fields.customerType?!1:Object.keys($.value).length===0),p=()=>{c.value.type!=="FIN"&&(c.value.fields.effectiveInterestRate=null,c.value.fields.gfv=null),c.value.type!=="LEA"&&(c.value.fields.finalInstalment=null),c.value.type!=="LTR"&&(c.value.fields.customerType="",c.value.fields.registrationTaxesIncluded=!1),c.value.type!=="LEA"&&c.value.type!=="LTR"&&(c.value.fields.mileageLimit=null,c.value.fields.maintenanceIncluded=!1),$.value={}};wt(()=>{A.item&&A.item.data&&(c.value={type:A.item.data.type||"",fields:{monthlyInstalment:A.item.data.monthlyInstalment||null,downPayment:A.item.data.downPayment||null,duration:A.item.data.duration||null,interestRate:A.item.data.interestRate||null,effectiveInterestRate:A.item.data.effectiveInterestRate||null,gfv:A.item.data.gfv||null,mileageLimit:A.item.data.mileageLimit||null,finalInstalment:A.item.data.finalInstalment||null,customerType:A.item.data.customerType||"",insuranceIncluded:A.item.data.insuranceIncluded||!1,maintenanceIncluded:A.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:A.item.data.registrationTaxesIncluded||!1}})});const r=()=>{var ae,le;if(!S.value)return;const g=i(c.value.type),y=c.value.fields.monthlyInstalment||0,M=c.value.fields.duration||0,H={id:((ae=A.item)==null?void 0:ae.id)||Date.now(),type:"purchase-method",action:A.item?"updated a purchase method":"added a purchase method",content:`${g}: €${x(y)}/month for ${M} months`,timestamp:((le=A.item)==null?void 0:le.timestamp)||new Date().toISOString(),isEdit:!!A.item,data:{type:c.value.type,typeLabel:g,monthlyInstalment:c.value.fields.monthlyInstalment,downPayment:c.value.fields.downPayment,duration:c.value.fields.duration,interestRate:c.value.fields.interestRate,effectiveInterestRate:c.value.fields.effectiveInterestRate,gfv:c.value.fields.gfv,mileageLimit:c.value.fields.mileageLimit,finalInstalment:c.value.fields.finalInstalment,customerType:c.value.fields.customerType,insuranceIncluded:c.value.fields.insuranceIncluded,maintenanceIncluded:c.value.fields.maintenanceIncluded,registrationTaxesIncluded:c.value.fields.registrationTaxesIncluded,totalLeasingAmount:I.value,totalRentalAmount:b.value}};q("save",H)};return o({submit:r,canSubmit:()=>S.value}),(g,y)=>(s(),a("div",{class:z(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?u("",!0):(s(),a("div",ud)),t.hideHeader?u("",!0):(s(),a("div",cd,[e("h5",md,m(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:y[0]||(y[0]=M=>g.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...y[23]||(y[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:je(r,["prevent"]),class:"space-y-4"},[e("div",null,[y[24]||(y[24]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-2"},[V("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fd,[(s(),a(Q,null,se(v,M=>e("label",{key:M.value,class:"flex-1 cursor-pointer"},[re(e("input",{type:"radio",value:M.value,"onUpdate:modelValue":y[1]||(y[1]=H=>c.value.type=H),class:"sr-only",onChange:p},null,40,vd),[[fn,c.value.type]]),e("div",{class:z(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",c.value.type===M.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-muted-foreground hover:border-brand-slate"])},m(M.label),3)])),64))])]),c.value.type?(s(),a("div",pd,[e("div",yd,[e("div",null,[y[26]||(y[26]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[V(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",gd,[y[25]||(y[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),re(e("input",{"onUpdate:modelValue":y[2]||(y[2]=M=>c.value.fields.monthlyInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:z(["input pl-8",{"border-red-500":$.value.monthlyInstalment}]),onInput:y[3]||(y[3]=M=>D("monthlyInstalment"))},null,34),[[Ne,c.value.fields.monthlyInstalment,void 0,{number:!0}]])]),$.value.monthlyInstalment?(s(),a("p",xd,m($.value.monthlyInstalment),1)):u("",!0)]),e("div",null,[y[28]||(y[28]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[V(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",hd,[y[27]||(y[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),re(e("input",{"onUpdate:modelValue":y[4]||(y[4]=M=>c.value.fields.downPayment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:z(["input pl-8",{"border-red-500":$.value.downPayment}]),onInput:y[5]||(y[5]=M=>D("downPayment"))},null,34),[[Ne,c.value.fields.downPayment,void 0,{number:!0}]])]),$.value.downPayment?(s(),a("p",bd,m($.value.downPayment),1)):u("",!0)])]),e("div",kd,[e("div",null,[y[30]||(y[30]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[V(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),re(e("select",{"onUpdate:modelValue":y[6]||(y[6]=M=>c.value.fields.duration=M),class:z(["input",{"border-red-500":$.value.duration}]),onChange:y[7]||(y[7]=M=>D("duration"))},[y[29]||(y[29]=e("option",{value:""},"Select duration...",-1)),(s(!0),a(Q,null,se(d(c.value.type),M=>(s(),a("option",{key:M,value:M},m(M)+" months ",9,wd))),128))],34),[[ja,c.value.fields.duration,void 0,{number:!0}]]),$.value.duration?(s(),a("p",$d,m($.value.duration),1)):u("",!0)]),c.value.type==="FIN"||c.value.type==="LEA"?(s(),a("div",Cd,[y[32]||(y[32]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Interest Rate / APR (%)",-1)),e("div",Ad,[re(e("input",{"onUpdate:modelValue":y[8]||(y[8]=M=>c.value.fields.interestRate=M),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:y[9]||(y[9]=M=>D("interestRate"))},null,544),[[Ne,c.value.fields.interestRate,void 0,{number:!0}]]),y[31]||(y[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])])):u("",!0),c.value.type==="LEA"||c.value.type==="LTR"?(s(),a("div",Id,[y[33]||(y[33]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Mileage Limit (annual km)",-1)),re(e("input",{"onUpdate:modelValue":y[10]||(y[10]=M=>c.value.fields.mileageLimit=M),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[Ne,c.value.fields.mileageLimit,void 0,{number:!0}]])])):u("",!0)]),c.value.type==="FIN"?(s(),a(Q,{key:0},[e("div",Sd,[e("div",null,[y[35]||(y[35]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",Td,[re(e("input",{"onUpdate:modelValue":y[11]||(y[11]=M=>c.value.fields.effectiveInterestRate=M),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[Ne,c.value.fields.effectiveInterestRate,void 0,{number:!0}]]),y[34]||(y[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])]),e("div",null,[y[37]||(y[37]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Dd,[y[36]||(y[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),re(e("input",{"onUpdate:modelValue":y[12]||(y[12]=M=>c.value.fields.gfv=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[Ne,c.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",jd,[re(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":y[13]||(y[13]=M=>c.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[38]||(y[38]=e("label",{for:"fin-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))])],64)):u("",!0),c.value.type==="LEA"?(s(),a(Q,{key:1},[e("div",qd,[e("div",null,[y[40]||(y[40]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Final Instalment (€)",-1)),e("div",Md,[y[39]||(y[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),re(e("input",{"onUpdate:modelValue":y[14]||(y[14]=M=>c.value.fields.finalInstalment=M),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[Ne,c.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Vd,[e("div",Ld,[y[41]||(y[41]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Leasing Amount:",-1)),e("span",Od,"€ "+m(x(I.value)),1)]),y[42]||(y[42]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Ed,[e("div",Nd,[re(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":y[15]||(y[15]=M=>c.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[43]||(y[43]=e("label",{for:"lea-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Pd,[re(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":y[16]||(y[16]=M=>c.value.fields.maintenanceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.maintenanceIncluded]]),y[44]||(y[44]=e("label",{for:"lea-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))])])],64)):u("",!0),c.value.type==="LTR"?(s(),a(Q,{key:2},[e("div",null,[y[46]||(y[46]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[V(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),re(e("select",{"onUpdate:modelValue":y[17]||(y[17]=M=>c.value.fields.customerType=M),class:z(["input",{"border-red-500":$.value.customerType}]),onChange:y[18]||(y[18]=M=>D("customerType"))},[...y[45]||(y[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[ja,c.value.fields.customerType]]),$.value.customerType?(s(),a("p",Fd,m($.value.customerType),1)):u("",!0)]),e("div",Rd,[e("div",Bd,[y[47]||(y[47]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),e("span",Ud,"€ "+m(x(b.value)),1)]),y[48]||(y[48]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",_d,[e("div",zd,[re(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":y[19]||(y[19]=M=>c.value.fields.insuranceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[49]||(y[49]=e("label",{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Wd,[re(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":y[20]||(y[20]=M=>c.value.fields.maintenanceIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.maintenanceIncluded]]),y[50]||(y[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))]),e("div",Hd,[re(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":y[21]||(y[21]=M=>c.value.fields.registrationTaxesIncluded=M),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.registrationTaxesIncluded]]),y[51]||(y[51]=e("label",{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):u("",!0)])):u("",!0)],32),t.hideActions?u("",!0):(s(),a("div",Yd,[l(n(_),{label:"Cancel",variant:"outline",size:"small",onClick:y[22]||(y[22]=M=>g.$emit("cancel"))}),l(n(_),{label:"Save",variant:"primary",size:"small",disabled:!S.value,onClick:r},null,8,["disabled"])]))],2))}},Qd={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Jd={class:"space-y-2"},Kd={class:"space-y-2"},Zd={class:"space-y-2"},Xd={class:"space-y-2"},eu={class:"relative"},tu={class:"space-y-2"},su={class:"space-y-2"},au={class:"space-y-2"},nu={class:"border-t border pt-4"},lu={key:0,class:"mt-4 space-y-6"},ou={class:"space-y-2"},iu={class:"space-y-2"},ru={class:"space-y-2"},du={class:"space-y-2"},uu={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:o}){const f=t,A=o,q=b=>{b||A("close")},$=N(!1),v=N({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});Le(()=>f.show,b=>{var d;if(b&&((d=f.task)!=null&&d.requestedCar)){const i=f.task.requestedCar;v.value={brand:i.brand||"",model:i.model||"",year:i.year||new Date().getFullYear(),price:i.price||null,requestType:i.requestType||"Quotation",requestMessage:i.requestMessage||"",image:i.image||"",dealership:i.dealership||"",fuelType:i.fuelType||"",gearType:i.gearType||"",kilometers:i.kilometers||null}}else b&&(v.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const c=C(()=>v.value.brand.trim()&&v.value.model.trim()&&v.value.year>1900),I=()=>{if(!c.value)return;const b={brand:v.value.brand.trim(),model:v.value.model.trim(),year:v.value.year,requestType:v.value.requestType};v.value.price&&(b.price=v.value.price),v.value.requestMessage&&(b.requestMessage=v.value.requestMessage.trim()),v.value.image&&(b.image=v.value.image.trim()),v.value.dealership&&(b.dealership=v.value.dealership.trim()),v.value.fuelType&&(b.fuelType=v.value.fuelType),v.value.gearType&&(b.gearType=v.value.gearType),v.value.kilometers!==null&&(b.kilometers=v.value.kilometers),A("save",b)};return(b,d)=>(s(),P(n(tn),{open:t.show,"onUpdate:open":q},{default:k(()=>[l(n(Qa),null,{default:k(()=>[l(n(Ja),{class:"fixed inset-0 z-50 bg-black/50"}),l(n(Ka),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:k(()=>[l(n(Za),{class:"flex-shrink-0"},{default:k(()=>[l(n(Xa),null,{default:k(()=>{var i;return[V(m((i=t.task)!=null&&i.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("div",Qd,[e("div",Jd,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[13]||(d[13]=[V("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.brand,"onUpdate:modelValue":d[0]||(d[0]=i=>v.value.brand=i),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Kd,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[14]||(d[14]=[V("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.model,"onUpdate:modelValue":d[1]||(d[1]=i=>v.value.model=i),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Zd,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[15]||(d[15]=[V("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(n(de),{modelValue:v.value.year,"onUpdate:modelValue":d[2]||(d[2]=i=>v.value.year=i),modelModifiers:{number:!0},type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Xd,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[16]||(d[16]=[V("Price (Optional)",-1)])]),_:1}),e("div",eu,[d[17]||(d[17]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),l(n(de),{modelValue:v.value.price,"onUpdate:modelValue":d[3]||(d[3]=i=>v.value.price=i),modelModifiers:{number:!0},type:"number",min:"0",step:"1000",placeholder:"45000",class:"w-full h-10 pl-8"},null,8,["modelValue"])])]),e("div",tu,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[18]||(d[18]=[V("Request Type",-1)])]),_:1}),l(n(at),{modelValue:v.value.requestType,"onUpdate:modelValue":d[4]||(d[4]=i=>v.value.requestType=i)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select request type..."})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Quotation"},{default:k(()=>[...d[19]||(d[19]=[V("Quotation",-1)])]),_:1}),l(n(oe),{value:"Test Drive"},{default:k(()=>[...d[20]||(d[20]=[V("Test Drive",-1)])]),_:1}),l(n(oe),{value:"Generic Sales"},{default:k(()=>[...d[21]||(d[21]=[V("Generic Sales",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",su,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[22]||(d[22]=[V("Request Message (Optional)",-1)])]),_:1}),l(n(Cn),{modelValue:v.value.requestMessage,"onUpdate:modelValue":d[5]||(d[5]=i=>v.value.requestMessage=i),rows:"5",placeholder:"Customer's message or notes about the vehicle request...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])]),e("div",au,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[23]||(d[23]=[V("Image URL (Optional)",-1)])]),_:1}),l(n(de),{modelValue:v.value.image,"onUpdate:modelValue":d[6]||(d[6]=i=>v.value.image=i),type:"url",placeholder:"https://example.com/car-image.jpg",class:"w-full h-10"},null,8,["modelValue"]),d[24]||(d[24]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",nu,[e("button",{type:"button",onClick:d[7]||(d[7]=i=>$.value=!$.value),class:"flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"},[e("i",{class:z(["fa-solid",$.value?"fa-chevron-down":"fa-chevron-right"])},null,2),d[25]||(d[25]=V(" Advanced Details (Optional) ",-1))]),$.value?(s(),a("div",lu,[e("div",ou,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[26]||(d[26]=[V("Dealership",-1)])]),_:1}),l(n(de),{modelValue:v.value.dealership,"onUpdate:modelValue":d[8]||(d[8]=i=>v.value.dealership=i),type:"text",placeholder:"e.g., Milano, Berlin",class:"w-full h-10"},null,8,["modelValue"])]),e("div",iu,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[27]||(d[27]=[V("Fuel Type",-1)])]),_:1}),l(n(at),{modelValue:v.value.fuelType,"onUpdate:modelValue":d[9]||(d[9]=i=>v.value.fuelType=i)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select fuel type"})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Petrol"},{default:k(()=>[...d[28]||(d[28]=[V("Petrol",-1)])]),_:1}),l(n(oe),{value:"Diesel"},{default:k(()=>[...d[29]||(d[29]=[V("Diesel",-1)])]),_:1}),l(n(oe),{value:"Electric"},{default:k(()=>[...d[30]||(d[30]=[V("Electric",-1)])]),_:1}),l(n(oe),{value:"Hybrid"},{default:k(()=>[...d[31]||(d[31]=[V("Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ru,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[32]||(d[32]=[V("Gear Type",-1)])]),_:1}),l(n(at),{modelValue:v.value.gearType,"onUpdate:modelValue":d[10]||(d[10]=i=>v.value.gearType=i)},{default:k(()=>[l(n(et),{class:"w-full h-10"},{default:k(()=>[l(n(tt),{placeholder:"Select gear type"})]),_:1}),l(n(st),null,{default:k(()=>[l(n(oe),{value:"Manual"},{default:k(()=>[...d[33]||(d[33]=[V("Manual",-1)])]),_:1}),l(n(oe),{value:"Automatic"},{default:k(()=>[...d[34]||(d[34]=[V("Automatic",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",du,[l(n(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[35]||(d[35]=[V("Kilometers",-1)])]),_:1}),l(n(de),{modelValue:v.value.kilometers,"onUpdate:modelValue":d[11]||(d[11]=i=>v.value.kilometers=i),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"e.g., 50000",class:"w-full h-10"},null,8,["modelValue"])])])):u("",!0)])]),l(n(en),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:k(()=>{var i;return[l(n(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[12]||(d[12]=x=>b.$emit("close"))}),l(n(_),{label:(i=t.task)!=null&&i.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!c.value,onClick:I},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Wt={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function cu(t){if(!t)return Wt.default;const o=t.toLowerCase().trim();return Wt[o]||Wt.default}function mu({store:t,taskId:o,getTabForItemType:f,isOverviewModalAction:A}){const q=N(null),$=N(null),v=N("overview"),c=N(null),I=N([]);Le(v,()=>{q.value=null,$.value=null});const b=C(()=>{var r;return[...((r=t.currentActivities)==null?void 0:r.value)||[],...(I.value||[]).filter(g=>g!=null&&!g.activityId)].filter(g=>g!=null&&g.id!=null&&g.type!=null).filter(g=>{const y=f(g.type);return v.value==="overview"?y==="overview":y===v.value}).sort((g,y)=>{const M=new Date(g.timestamp||0);return new Date(y.timestamp||0)-M})}),d=p=>($.value=null,v.value==="overview"&&A&&A(p)?{type:"overview-modal",action:p}:(["email","sms","whatsapp","call"].includes(p)?(c.value=p,q.value="communication"):q.value=p,null)),i=async p=>{var r;if(p.isEdit){const g=I.value.findIndex(y=>y.id===p.id);g>-1&&(I.value[g]={...I.value[g],...p}),(r=$.value)!=null&&r.activityId&&await t.updateActivity(o.value,$.value.activityId,{type:p.communicationType||p.type,user:"You",action:p.action,content:p.content,fileName:p.fileName,data:p.data})}else{const g=p.communicationType||p.type,y=await t.addActivity(o.value,{type:g,user:"You",action:p.action,content:p.content,fileName:p.fileName,data:p.data});I.value.push({id:y.id,type:g==="email"||g==="whatsapp"||g==="sms"?"communication":g,action:p.action,content:p.content,fileName:p.fileName,data:p.data,timestamp:y.timestamp,activityId:y.id})}q.value=null,$.value=null},x=()=>{q.value=null,$.value=null},D=p=>{f(p.type)&&(q.value=p.type==="email"||p.type==="whatsapp"||p.type==="sms"||p.type==="communication"?"communication":p.type,$.value=p)},S=async p=>{try{await t.deleteActivity(o.value,p)}catch(r){throw console.error("Error deleting item:",r),r}};return{activeTab:v,showInlineWidget:q,inlineWidgetType:C(()=>q.value),editingItem:$,isEditing:C(()=>$.value!==null),communicationType:c,inlineContent:I,filteredInlineContent:b,handleAddNewAction:d,handleWidgetSave:i,handleWidgetCancel:x,handleEditItem:D,handleDeleteItem:S}}const fu={class:"flex-1 flex flex-col overflow-hidden h-full"},vu={key:1,class:"flex-1 flex flex-row overflow-hidden"},pu={class:"flex-1 flex flex-col overflow-hidden min-w-0"},yu={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},gu={class:"mb-4 -mt-1 pb-2"},xu={key:0},hu={key:0},bu={key:1,class:"mb-6"},ku={key:2,class:"space-y-4 mb-6 px-1"},wu={key:1},$u={key:0},Cu={key:1},Au={class:"relative flex items-center py-1 mb-4"},Iu={class:"relative mx-4"},Su={key:0,class:"animate-fade-in relative bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6"},Tu={class:"flex justify-between items-center mb-4"},Du={key:0,class:"space-y-4 mb-6 px-1"},ju={class:"hidden lg:flex flex-col overflow-hidden border-l border-border shrink-0 w-80 h-full"},qu={key:2,class:"flex-1 flex flex-row overflow-hidden"},Mu={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Vu={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Lu={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},Ou={class:"space-y-6"},Eu={key:0},Nu={key:0,class:"lg:col-span-1 space-y-6"},Pu={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Fu={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Ru={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Bu={class:"rounded-lg flex flex-col bg-muted"},Uu={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1 min-h-0"},_u={class:"relative flex-1 min-h-0"},zu={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},Wu={key:1,class:"text-center py-6 text-muted-foreground"},Hu={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},Yu={key:1,class:"flex-1 min-w-0"},Gu={class:"text-sm text-muted-foreground leading-snug"},Qu={class:"font-bold"},Ju={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-muted-foreground"},Ku={class:"text-xs text-muted-foreground mt-1"},Zu={key:2},Xu={key:0,class:"space-y-4 mt-4"},ec={key:1,class:"text-center py-12 text-muted-foreground"},tc={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},showCloseButton:{type:Boolean,default:!1}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created","close"],setup(t,{emit:o}){const f=t,A=o,q=vn(),$=qe(),v=Ya(),c=_n(),I=C(()=>f.task.id),b=C(()=>q.path.startsWith("/tasks")&&!q.path.startsWith("/customer")),d=N("manage"),i=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];N(!1);const x=N(null),D=N(null),S=["note","attachment","tradein","purchase"],p=C(()=>{var G,ne;const h=[],w=new Set,R=["note","attachment","tradein","purchase","purchase-method","financing"];return(ne=(G=f.storeAdapter)==null?void 0:G.currentActivities)!=null&&ne.value&&f.storeAdapter.currentActivities.value.filter(Y=>Y!=null&&Y.id!=null&&R.includes(Y==null?void 0:Y.type)).forEach(Y=>{w.has(Y.id)||(w.add(Y.id),h.push(Y))}),f.task.activities&&f.task.activities.filter(Y=>Y!=null&&Y.id!=null&&R.includes(Y==null?void 0:Y.type)).forEach(Y=>{w.has(Y.id)||(w.add(Y.id),h.push(Y))}),(Ie.value||[]).filter(j=>j!=null&&j.id!=null&&R.includes(j==null?void 0:j.type)).forEach(j=>{w.has(j.id)||(w.add(j.id),h.push(j))}),h.filter(j=>j!=null&&j.id!=null).sort((j,Y)=>{const ve=new Date(j.timestamp||0);return new Date(Y.timestamp||0)-ve})}),r=h=>{D.value=null,x.value=h},g=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:h.type,action:h.action,content:h.content,data:h.data,fileName:h.fileName,timestamp:h.timestamp||new Date().toISOString()}),Ie.value.push({id:h.id||Date.now(),type:h.type,action:h.action,content:h.content,data:h.data,fileName:h.fileName,timestamp:h.timestamp||new Date().toISOString()}),x.value=null,D.value=null}catch(w){console.error("Error saving enrich data:",w)}},y=()=>{x.value=null,D.value=null},M=h=>{D.value=h,x.value=h.type==="purchase-method"?"purchase":h.type},H=async h=>{try{await f.storeAdapter.deleteActivity(f.task.id,h.id);const w=Ie.value.findIndex(R=>R.id===h.id);w!==-1&&Ie.value.splice(w,1)}catch(w){console.error("Error deleting enrich item:",w)}};C(()=>f.task.activities?f.task.activities.filter(h=>h.type==="note"):[]),C(()=>f.task.activities?f.task.activities.filter(h=>["email","call","sms","whatsapp"].includes(h.type)):[]),C(()=>f.task.activities?f.task.activities.filter(h=>h.type==="attachment"):[]),C(()=>f.task.activities?f.task.activities.filter(h=>h.type==="purchase"):[]),C(()=>f.task.activities?f.task.activities.filter(h=>h.type==="tradein"):[]);const ae=()=>{L.value="tradein",O.value=!0},le=()=>{L.value="financing",O.value=!0},ee=C(()=>f.type==="contact"?"bg-blue-100 text-blue-600":f.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),ie=N(q.path.startsWith("/tasks")&&!q.path.startsWith("/customer"));Le(()=>q.path,h=>{ie.value=h.startsWith("/tasks")&&!h.startsWith("/customer")});const E=()=>{$.push({path:`/customer/${f.task.id}`,query:{type:f.type}})};async function te(h){var gt,xt;const w=((gt=f.task.customer)==null?void 0:gt.id)??f.task.id,R=h.time||"10:00",U=R.length===5?`${R}:00`:R,J=`${h.date}T${U}`,[G,ne]=R.split(":").map(Number),j=G+1,Y=`${h.date}T${String(j).padStart(2,"0")}:${String(ne||0).padStart(2,"0")}:00`;let ve=null,Be="user",yt=null,Ke="",Ze=null;if(h.assignee){if(h.assignee.startsWith("user-")){const Te=parseInt(h.assignee.replace("user-",""),10),De=c.getUserById(Te);ve=Te,Be="user",Ke=(De==null?void 0:De.name)||""}else if(h.assignee.startsWith("team-")){const Te=parseInt(h.assignee.replace("team-",""),10),De=c.getTeamById(Te);yt=Te,Be="team",Ze=(De==null?void 0:De.name)||"",Ke=Ze}}const Pt={type:h.type,title:h.title||`${h.type} - ${h.customer||"Customer"}`,customer:h.customer||((xt=f.task.customer)==null?void 0:xt.name)||"",customerId:w,start:J,end:Y,assignee:Ke,assigneeId:ve,assigneeType:Be,teamId:yt,team:Ze,dealership:h.dealership||"",status:"confirmed"};try{await Wn(Pt)}catch(Te){console.error("Failed to create appointment:",Te);return}be.value=!1,fe.value=!1,A("appointment-created")}const xe=()=>{Ce.value=!0},Ae=async h=>{var R,U,J,G;const w=h.name;f.type==="lead"?await((U=(R=f.storeAdapter).updateLead)==null?void 0:U.call(R,f.task.id,{assignee:w,assigneeType:h.type,teamId:h.type==="team"?h.id:null})):f.type==="opportunity"&&await((G=(J=f.storeAdapter).updateOpportunity)==null?void 0:G.call(J,f.task.id,{assignee:w,assigneeType:h.type,teamId:h.type==="team"?h.id:null})),Ce.value=!1},he=()=>{Re.value=!0},K=async h=>{var w,R,U,J;try{f.type==="lead"?await((R=(w=f.storeAdapter).updateLead)==null?void 0:R.call(w,f.task.id,{requestedCar:h})):f.type==="opportunity"&&await((J=(U=f.storeAdapter).updateOpportunity)==null?void 0:J.call(U,f.task.id,{requestedCar:h})),Re.value=!1}catch(G){console.error("Error saving requested car:",G)}};async function T(h){var w,R,U,J,G,ne,j,Y;try{const ve=[...f.task.tradeIns||[],h];f.type==="lead"?(await((R=(w=f.storeAdapter).updateLead)==null?void 0:R.call(w,f.task.id,{tradeIns:ve})),await((J=(U=f.storeAdapter).loadLeadById)==null?void 0:J.call(U,f.task.id))):f.type==="opportunity"&&(await((ne=(G=f.storeAdapter).updateOpportunity)==null?void 0:ne.call(G,f.task.id,{tradeIns:ve})),await((Y=(j=f.storeAdapter).loadOpportunityById)==null?void 0:Y.call(j,f.task.id)))}catch(ve){console.error("Error adding trade-in:",ve)}}async function W(h){var w,R,U,J,G,ne,j,Y;try{const ve=[...f.task.financingOptions||[],h];f.type==="lead"?(await((R=(w=f.storeAdapter).updateLead)==null?void 0:R.call(w,f.task.id,{financingOptions:ve})),await((J=(U=f.storeAdapter).loadLeadById)==null?void 0:J.call(U,f.task.id))):f.type==="opportunity"&&(await((ne=(G=f.storeAdapter).updateOpportunity)==null?void 0:ne.call(G,f.task.id,{financingOptions:ve})),await((Y=(j=f.storeAdapter).loadOpportunityById)==null?void 0:Y.call(j,f.task.id)))}catch(ve){console.error("Error adding financing option:",ve)}}const O=N(!1),L=N(null),be=N(!1),fe=N(!1),Ce=N(!1),Oe=N(!1),Re=N(!1),rt=N([]),He=N(!1),Ye=N(!1),F=N(!1),Z=N(!1),B=N(!1),ke=N(!1),we=N({}),{activeTab:ue,showInlineWidget:$e,editingItem:Ee,communicationType:Ge,inlineContent:Ie,filteredInlineContent:Se,handleAddNewAction:ce,handleWidgetSave:me,handleWidgetCancel:Qe,handleEditItem:dt,handleDeleteItem:ut}=mu({store:f.storeAdapter,taskId:I,getTabForItemType:cu,isOverviewModalAction:h=>ue.value==="overview"&&f.addNewConfig.overviewActions.includes(h)});Le(()=>f.task.id,()=>{ue.value="overview"}),Le(ue,h=>{h!=="appointments"&&(fe.value=!1)});const $t=C(()=>new Date().toISOString().slice(0,10));wt(async()=>{if(!b.value)try{const h=await zn();rt.value=h.dealerships||[]}catch(h){console.error("Failed to fetch calendar filter options:",h)}});const ct=()=>{b.value?d.value="request":ue.value="overview"},Je=h=>{const w=ce(h);w&&w.modalAction&&(L.value=w.modalAction,O.value=!0)},mt=h=>{if(h==="appointment"){be.value=!0;return}if(h==="call"){ke.value=!0;return}if(h==="note"){He.value=!0;return}if(h==="attachment"){Ye.value=!0;return}if(h==="whatsapp"){F.value=!0;return}if(h==="sms"){Z.value=!0;return}if(h==="email"){B.value=!0;return}const w={call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(h))L.value=h,O.value=!0;else{const R=w[h];R?(ue.value=R,setTimeout(()=>{Je(h),setTimeout(()=>{try{const U=document.querySelector(".animate-fade-in");U&&U.parentNode&&U.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Je(h)}},Me=()=>{O.value=!1,L.value=null},Ct=async h=>{var w,R;try{const U=h.type==="FIN"?"Captive Financing":h.type==="LEA"?"Leasing":"Long-Term Rental",J=((w=h.fields)==null?void 0:w.monthlyInstalment)||0,G=((R=h.fields)==null?void 0:R.duration)??null;await me({type:"purchase-method",action:`added a ${U} purchase method`,content:`${U}: €${J.toLocaleString()}/month for ${G||0} months`,data:{purchaseMethodId:h.id,type:h.type,...h.fields}});const ne=G?`${h.type||"Financing"} ${G} months`:U||"Financing";await W({id:`fo-${Date.now()}`,label:ne,termMonths:G||null}),Me()}catch(U){console.error("Error saving purchase method:",U)}},ft=async h=>{var w;if(L.value==="tradein")try{const{saveTradeInVehicle:R}=Nn(),U=await R(f.type,f.task.id,h.vehicle,h.valuation||{});Ie.value.push({id:U.activity.id,type:"tradein",action:"added a trade-in",vehicleId:U.vehicle.id,data:U.activity.data,timestamp:U.activity.timestamp,activityId:U.activity.id});const J=h.vehicle||{},G=[J.brand,J.model].filter(Boolean),ne=(G.length?G.join(" ")+(J.year?` (${J.year})`:""):"Trade-in")||"Trade-in",j=((w=h.valuation)==null?void 0:w.tradeInPrice)??0;await T({id:`ti-${Date.now()}`,label:ne,valuation:typeof j=="number"?j:parseFloat(j)||0}),Me()}catch(R){console.error("Error saving trade-in:",R)}else L.value==="purchase"&&(await me(h),Me())},At=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:"note",content:h.content||h.message,message:h.content||h.message,timestamp:new Date().toISOString()}),He.value=!1}catch(w){console.error("Error saving note:",w)}},It=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:"attachment",fileName:h.fileName,file:h.file,content:`Attachment: ${h.fileName}`,timestamp:new Date().toISOString()}),Ye.value=!1}catch(w){console.error("Error saving attachment:",w)}},St=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:"whatsapp",message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),F.value=!1}catch(w){console.error("Error saving WhatsApp:",w)}},Tt=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:"sms",message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),Z.value=!1}catch(w){console.error("Error saving SMS:",w)}},Dt=async h=>{try{await f.storeAdapter.addActivity(f.task.id,{type:"email",subject:h.subject,message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),B.value=!1}catch(w){console.error("Error saving email:",w)}},jt=()=>{},qt=h=>{we.value[h]=!we.value[h]},Mt=h=>{mt(h)},Vt=C(()=>{const h=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return f.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...h.slice(1),{key:"appointments",label:"Appointments"}]:h}),Ve=C(()=>{var w,R;return[...((R=(w=f.storeAdapter)==null?void 0:w.currentActivities)==null?void 0:R.value)||[],...Ie.value||[]].filter(U=>U!=null&&U.id!=null)});C(()=>L.value==="financing"?"Add Financing":L.value==="tradein"?"Add Trade-in":L.value==="purchase"?"Create Purchase Offer":"");const vt=async h=>{if(f.type==="opportunity")try{await f.storeAdapter.addVehicle(f.task.id,h.vehicleData),f.storeAdapter.loadOpportunityById&&await f.storeAdapter.loadOpportunityById(f.task.id)}catch(w){console.error("Error selecting vehicle:",w)}},pt=async h=>{if(f.type==="opportunity")try{await f.storeAdapter.createOffer(f.task.id,h.offerData),f.storeAdapter.loadOpportunityById&&await f.storeAdapter.loadOpportunityById(f.task.id)}catch(w){console.error("Error creating offer:",w)}},Lt=async h=>{var U,J,G,ne;const w=f.task.tags||[];if(w.includes(h)){Oe.value=!1;return}const R=[...w,h];try{if(f.type==="lead")await((J=(U=f.storeAdapter).updateLead)==null?void 0:J.call(U,f.task.id,{tags:R})),f.storeAdapter.loadLeadById&&await f.storeAdapter.loadLeadById(f.task.id);else if(f.type==="opportunity")await((ne=(G=f.storeAdapter).updateOpportunity)==null?void 0:ne.call(G,f.task.id,{tags:R})),f.storeAdapter.loadOpportunityById&&await f.storeAdapter.loadOpportunityById(f.task.id);else if(f.type==="contact"){const j=q.query.type==="account"?"account":"contact";await v.updateCustomer(f.task.id,{tags:R},j),await v.fetchCustomerById(f.task.id,j),A("tag-updated")}Oe.value=!1}catch(j){console.error("Error adding tag:",j)}},Ot=h=>{const w={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-muted-foreground",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-muted-foreground"};return w[h]||w.default},Et=h=>{const w={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-muted text-muted-foreground",status:"bg-orange-100 text-orange-600",default:"bg-muted text-muted-foreground"};return w[h]||w.default},Nt=h=>h?new Date(h).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(h,w)=>{var R,U,J,G,ne;return s(),a("div",fu,[b.value?u("",!0):(s(),P(fl,{key:0,initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":ee.value,"task-type":t.type,"customer-id":((R=t.task.customer)==null?void 0:R.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"show-close-button":t.showCloseButton,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAddTag:w[0]||(w[0]=j=>Oe.value=!0),onClose:w[1]||(w[1]=j=>h.$emit("close"))},{"name-action":k(()=>[b.value?(s(),a("button",{key:0,onClick:E,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...w[24]||(w[24]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):u("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags","show-close-button"])),b.value?b.value?(s(),a("div",qu,[e("div",Mu,[e("div",Vu,[l(Na,{modelValue:d.value,"onUpdate:modelValue":w[9]||(w[9]=j=>d.value=j),tabs:i,class:"mb-6"},null,8,["modelValue"]),d.value==="manage"?(s(),a("div",Lu,[e("div",Ou,[t.managementWidget?(s(),a("div",Eu,[(s(),P(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ve.value,onCarAdded:w[10]||(w[10]=j=>h.$emit("car-added",j)),onConvertToLead:w[11]||(w[11]=j=>h.$emit("convert-to-lead")),onConvertToOpportunity:w[12]||(w[12]=j=>h.$emit("convert-to-opportunity")),onVehicleSelected:vt,onCreateOffer:pt,onViewHistory:ct},null,40,["lead","opportunity","contact","activities"]))])):u("",!0)]),t.type!=="contact"?(s(),a("div",Nu,[l(Pa,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe,onAddRequestedCar:he},null,8,["task","entity-type","activities"]),l(Fa,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):u("",!0)])):u("",!0),d.value==="request"?(s(),a("div",Pu,[e("div",Fu,[t.type!=="contact"?(s(),P(Pa,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe,onAddRequestedCar:he},null,8,["task","entity-type","activities"])):u("",!0),l(Sn,{task:t.task,"task-type":t.type,"customer-id":((ne=t.task.customer)==null?void 0:ne.id)||t.task.customerId||t.task.id,onAction:mt,onAddTag:w[13]||(w[13]=j=>Oe.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(s(),a("div",Ru,[l(Tn,{items:t.task.tradeIns||[],onOpenAdd:ae},null,8,["items"]),l(Dn,{items:t.task.financingOptions||[],onOpenAdd:le},null,8,["items"])])):u("",!0),t.type!=="contact"?(s(),P(Fa,{key:1,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):u("",!0),e("div",Bu,[w[32]||(w[32]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Activity Summary")])],-1)),e("div",Uu,[e("div",_u,[Ve.value.length>0?(s(),a("div",zu)):u("",!0),Ve.value.length===0?(s(),a("div",Wu,[...w[31]||(w[31]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No activities yet",-1)])])):(s(),a("div",Hu,[(s(!0),a(Q,null,se(Ve.value,j=>(s(),a("div",{key:(j==null?void 0:j.id)||`activity-${(j==null?void 0:j.timestamp)||Date.now()}`,class:"flex gap-4 relative"},[j&&j.type?(s(),a("div",{key:0,class:z(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",Et(j.type)])},[e("i",{class:z([Ot(j.type),"text-sm"])},null,2)],2)):u("",!0),j?(s(),a("div",Yu,[e("div",Gu,[e("span",Qu,m(j.user),1),V(" "+m(j.action),1)]),j.content?(s(),a("div",Ju,m(j.content),1)):u("",!0),e("div",Ku,m(Nt(j.timestamp)),1)])):u("",!0)]))),128))]))])])])])):u("",!0),d.value==="data"?(s(),a("div",Zu,[l(Ra,{actions:S,"active-tab":"data",onAction:r}),e("div",null,[x.value==="note"?(s(),P(Ut,{key:0,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="attachment"?(s(),P(_t,{key:1,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="tradein"?(s(),P(dd,{key:2,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="purchase"?(s(),P(Gd,{key:3,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0)]),p.value.length>0?(s(),a("div",Xu,[(s(!0),a(Q,null,se(p.value,j=>{var Y;return s(),P(zt,{key:(j==null?void 0:j.id)||`enrich-${(j==null?void 0:j.timestamp)||Date.now()}`,item:j,"task-type":t.type,"customer-initials":((Y=t.task.customer)==null?void 0:Y.initials)||"SK",onEdit:M,onDelete:H},null,8,["item","task-type","customer-initials"])}),128))])):x.value?u("",!0):(s(),a("div",ec,[...w[33]||(w[33]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No enrichment data yet",-1),e("p",{class:"text-xs text-muted-foreground mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):u("",!0)])])])):u("",!0):(s(),a("div",vu,[e("div",pu,[e("main",yu,[e("div",gu,[l(Na,{modelValue:n(ue),"onUpdate:modelValue":w[2]||(w[2]=j=>pn(ue)?ue.value=j:null),tabs:Vt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),n(ue)==="overview"?(s(),a("div",xu,[t.type!=="contact"?(s(),a("div",hu,[l(go,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)||"","request-message":((J=t.task.requestedCar)==null?void 0:J.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:xe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):u("",!0),Bt(h.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(s(),a("div",bu,[(s(),P(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ve.value,onCarAdded:w[3]||(w[3]=j=>h.$emit("car-added",j)),onConvertToLead:w[4]||(w[4]=j=>h.$emit("convert-to-lead")),onConvertToOpportunity:w[5]||(w[5]=j=>h.$emit("convert-to-opportunity")),onViewHistory:ct,onVehicleSelected:vt,onCreateOffer:pt},null,40,["lead","opportunity","contact","activities"]))])):u("",!0),n(Se).length>0?(s(),a("div",ku,[(s(!0),a(Q,null,se(n(Se),j=>(s(),P(zt,{key:(j==null?void 0:j.id)||`feed-${(j==null?void 0:j.timestamp)||Date.now()}`,item:j,"task-type":t.type,"customer-initials":"SK",onEdit:n(dt),onDelete:n(ut)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):u("",!0)])):(s(),a("div",wu,[t.type==="contact"&&n(ue)==="negotiations"?(s(),a("div",$u,[Bt(h.$slots,"tab-negotiations")])):t.type==="contact"&&n(ue)==="appointments"?(s(),a("div",Cu,[e("div",Au,[w[26]||(w[26]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",Iu,[fe.value?u("",!0):(s(),a("button",{key:0,onClick:w[6]||(w[6]=je(j=>fe.value=!0,["stop"])),class:"bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-border"},[...w[25]||(w[25]=[e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1),e("span",{class:"ml-1.5 text-muted-foreground"},"add appointment",-1)])]))]),w[27]||(w[27]=e("div",{class:"flex-grow border-t border"},null,-1))]),fe.value?(s(),a("div",Su,[w[30]||(w[30]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),e("div",Tu,[w[29]||(w[29]=e("h5",{class:"text-sm font-semibold text-foreground"},"Add Appointment",-1)),e("button",{type:"button",onClick:w[7]||(w[7]=j=>fe.value=!1),class:"text-muted-foreground hover:text-muted-foreground"},[...w[28]||(w[28]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(s(),P(Bn,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":$t.value,dealerships:rt.value,"show-actions":!0,"reset-trigger":fe.value,onCreate:te,onCancel:w[8]||(w[8]=j=>fe.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):u("",!0),Bt(h.$slots,"tab-appointments")])):(s(),a(Q,{key:2},[l(Ra,{actions:t.addNewConfig.tabActions,"active-tab":n(ue),onAction:Je},null,8,["actions","active-tab"]),e("div",null,[n($e)==="communication"?(s(),P(Jr,{key:0,type:n(Ge),"task-type":t.type,"task-id":t.task.id,"phone-number":((G=t.task.customer)==null?void 0:G.phone)||"",item:n(Ee),onSave:n(me),onCancel:n(Qe)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):u("",!0),n(ue)==="data"&&n($e)==="note"?(s(),P(Ut,{key:1,item:n(Ee),"task-type":t.type,"task-id":t.task.id,onSave:n(me),onCancel:n(Qe)},null,8,["item","task-type","task-id","onSave","onCancel"])):u("",!0),n($e)==="attachment"?(s(),P(_t,{key:2,item:n(Ee),"task-type":t.type,"task-id":t.task.id,onSave:n(me),onCancel:n(Qe)},null,8,["item","task-type","task-id","onSave","onCancel"])):u("",!0)]),n(Se).length>0?(s(),a("div",Du,[(s(!0),a(Q,null,se(n(Se),j=>(s(),P(zt,{key:(j==null?void 0:j.id)||`feed-${(j==null?void 0:j.timestamp)||Date.now()}`,item:j,"task-type":t.type,"customer-initials":"SK",onEdit:n(dt),onDelete:n(ut)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):u("",!0)],64))]))])]),e("div",ju,[l(In,{activities:Ve.value,"expanded-summaries":we.value,onActivityClick:jt,onToggleSummaryExpanded:qt,onAddActivity:Mt},null,8,["activities","expanded-summaries"])])])),l(jn,{show:L.value==="financing"&&O.value,"task-type":t.type,"task-id":t.task.id,onSave:Ct,onClose:Me},null,8,["show","task-type","task-id"]),l(qn,{show:L.value==="tradein"&&O.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:ft,onClose:Me},null,8,["show","task-type","task-id"]),l(Mn,{show:L.value==="purchase"&&O.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,customer:t.task.customer,"recommended-cars":[],onSave:ft,onClose:Me},null,8,["show","task-type","task-id","requested-car","customer"]),l(Rn,{show:Ce.value,onClose:w[14]||(w[14]=j=>Ce.value=!1),onConfirm:Ae},null,8,["show"]),l(uu,{show:Re.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:w[15]||(w[15]=j=>Re.value=!1),onSave:K},null,8,["show","task","task-type","task-id"]),l(Ut,{modal:"",show:He.value,"task-type":t.type,"task-id":t.task.id,onSave:At,onClose:w[16]||(w[16]=j=>He.value=!1)},null,8,["show","task-type","task-id"]),l(_t,{modal:"",show:Ye.value,"task-type":t.type,"task-id":t.task.id,onSave:It,onClose:w[17]||(w[17]=j=>Ye.value=!1)},null,8,["show","task-type","task-id"]),l(Vn,{show:F.value,onSave:St,onClose:w[18]||(w[18]=j=>F.value=!1)},null,8,["show"]),l(Ln,{show:Z.value,onSave:Tt,onClose:w[19]||(w[19]=j=>Z.value=!1)},null,8,["show"]),l(On,{show:B.value,onSave:Dt,onClose:w[20]||(w[20]=j=>B.value=!1)},null,8,["show"]),l(Pe,{show:ke.value,title:"Call Feature",onClose:w[21]||(w[21]=j=>ke.value=!1)},null,8,["show"]),be.value?(s(),P(Un,{key:3,show:be.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:rt.value,onCreate:te,onCancel:w[22]||(w[22]=j=>be.value=!1)},null,8,["show","customer","assignee","dealerships"])):u("",!0),l(En,{show:Oe.value,"existing-tags":t.task.tags||[],onClose:w[23]||(w[23]=j=>Oe.value=!1),onAdd:Lt},null,8,["show","existing-tags"])])}}},sc={class:"flex items-center justify-between mb-4 px-1"},ac={class:"flex items-center gap-2"},nc={key:0,class:"space-y-4 mb-6 px-1"},lc=["onClick"],oc={class:"flex-1 min-w-0"},ic={class:"flex items-center gap-2 mb-1"},rc={class:"text-xs font-bold text-foreground"},dc={class:"ml-auto relative"},uc=["onClick"],cc={class:"text-sm text-muted-foreground"},mc={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},fc={key:0,class:"flex items-center gap-1"},vc={key:1,class:"flex items-center gap-1"},pc={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},yc={class:"flex items-center gap-2 min-w-0"},gc={class:"text-xs text-muted-foreground font-medium truncate"},xc={key:1,class:"text-center py-8 text-muted-foreground mb-6"},hc={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:o}){const f=t,A=qe(),q=I=>{if(!I)return 0;const b=new Date(I),i=Math.abs(new Date-b);return Math.ceil(i/(1e3*60*60*24))},$=I=>{const b=[];return f.allTasks&&f.allTasks.length>0&&f.allTasks.filter(i=>i.leadId===I.id).forEach(i=>{b.push({id:i.id,type:i.title||"Task",description:i.description||i.title})}),I.stage==="Open"&&q(I.createdAt)>=0&&b.push({id:`lead-${I.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),b},v=I=>I==="Open"||I==="Validated"||I==="Contacted"?"blue":"gray",c=I=>{const b=A.resolve({path:`/tasks/${I.id}`,query:{type:"lead"}});window.open(b.href,"_blank")};return(I,b)=>(s(),a("div",null,[e("div",sc,[e("div",ac,[b[1]||(b[1]=e("i",{class:"fa-solid fa-user-circle text-foreground"},null,-1)),b[2]||(b[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Leads",-1)),l(n(pe),{text:String(t.leads.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:b[0]||(b[0]=d=>I.$emit("add-lead")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...b[3]||(b[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),t.leads.length>0?(s(),a("div",nc,[(s(!0),a(Q,null,se(t.leads,d=>(s(),a("div",{key:d.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:i=>c(d)},[b[8]||(b[8]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-orange-100 text-orange-600 border-orange-200"},[e("i",{class:"fa-solid fa-user-circle text-sm"})],-1)),e("div",oc,[e("div",ic,[e("span",rc,"Lead #"+m(d.id),1),l(n(pe),{text:d.stage,size:"small",theme:v(d.stage)},null,8,["text","theme"]),e("div",dc,[e("button",{onClick:je(i=>c(d),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...b[4]||(b[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,uc)])]),e("div",cc,[e("div",mc,[d.assignee?(s(),a("span",fc,[b[5]||(b[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),V(" "+m(d.assignee),1)])):u("",!0),d.requestedCar?(s(),a("span",vc,[b[6]||(b[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),V(" "+m(d.requestedCar.brand)+" "+m(d.requestedCar.model),1)])):u("",!0)]),$(d).length>0?(s(),a("div",pc,[(s(!0),a(Q,null,se($(d),i=>(s(),a("div",{key:i.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",yc,[l(n(pe),{text:i.type,size:"small",theme:i.type==="LQ"?"blue":"gray"},null,8,["text","theme"]),e("span",gc,m(i.description),1)]),b[7]||(b[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):u("",!0)])])],8,lc))),128))])):(s(),a("div",xc,[...b[9]||(b[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))]))}},bc={class:"flex items-center justify-between mb-4 px-1"},kc={class:"flex items-center gap-2"},wc={key:0,class:"space-y-4 mb-6 px-1"},$c=["onClick"],Cc={class:"flex-1 min-w-0"},Ac={class:"flex items-center gap-2 mb-1"},Ic={class:"text-xs font-bold text-foreground"},Sc={class:"ml-auto relative"},Tc=["onClick"],Dc={class:"text-sm text-muted-foreground"},jc={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},qc={key:0,class:"flex items-center gap-1"},Mc={key:1,class:"flex items-center gap-1"},Vc={key:2,class:"flex items-center gap-1"},Lc={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},Oc={class:"flex items-center gap-2 min-w-0"},Ec={class:"text-xs text-muted-foreground font-medium truncate"},Nc={key:1,class:"text-center py-8 text-muted-foreground mb-6"},Pc={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:o}){const f=t,A=qe(),q=b=>{const d=[];f.allTasks&&f.allTasks.length>0&&f.allTasks.filter(p=>p.opportunityId===b.id).forEach(p=>{d.push({id:p.id,type:p.title||"Task",description:p.description||p.title})});const i=f.activities.filter(S=>S.opportunityId===b.id),x={opportunity:b,scheduledAppointment:b.scheduledAppointment||null,activities:i,hasOffers:i.some(S=>S.type==="offer")||!1,stage:b.displayStage||b.stage,deliverySubstatus:b.deliverySubstatus||null},D=Pn(x.stage,x);if(D){const S={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};d.push({id:`opp-${b.id}-${D}`,type:D,description:S[D]||D})}return d},$=b=>({OOFB:"blue",UFB:"gray",NFU:"red",OFB:"blue",CFB:"green",DFB:"blue",NS:"red"})[b]||"gray",v=b=>b==="Qualified"||b==="In Negotiation"?"blue":b==="Closed Won"?"green":b==="Closed Lost"?"red":"gray",c=b=>new Intl.NumberFormat("en-US").format(b),I=b=>{const d=A.resolve({path:`/tasks/${b.id}`,query:{type:"opportunity"}});window.open(d.href,"_blank")};return(b,d)=>(s(),a("div",null,[e("div",bc,[e("div",kc,[d[1]||(d[1]=e("i",{class:"fa-solid fa-briefcase text-foreground"},null,-1)),d[2]||(d[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Opportunities",-1)),l(n(pe),{text:String(t.opportunities.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:d[0]||(d[0]=i=>b.$emit("add-opportunity")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),t.opportunities.length>0?(s(),a("div",wc,[(s(!0),a(Q,null,se(t.opportunities,i=>(s(),a("div",{key:i.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:x=>I(i)},[d[9]||(d[9]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-briefcase text-sm"})],-1)),e("div",Cc,[e("div",Ac,[e("span",Ic,"Opp #"+m(i.id),1),l(n(pe),{text:i.displayStage||i.stage,size:"small",theme:v(i.displayStage||i.stage)},null,8,["text","theme"]),e("div",Sc,[e("button",{onClick:je(x=>I(i),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,Tc)])]),e("div",Dc,[e("div",jc,[i.assignee?(s(),a("span",qc,[d[5]||(d[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),V(" "+m(i.assignee),1)])):u("",!0),i.value?(s(),a("span",Mc,[d[6]||(d[6]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),V(" € "+m(c(i.value)),1)])):u("",!0),i.vehicle?(s(),a("span",Vc,[d[7]||(d[7]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),V(" "+m(i.vehicle.brand)+" "+m(i.vehicle.model),1)])):u("",!0)]),q(i).length>0?(s(),a("div",Lc,[(s(!0),a(Q,null,se(q(i),x=>(s(),a("div",{key:x.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",Oc,[l(n(pe),{text:x.type,size:"small",theme:$(x.type)},null,8,["text","theme"]),e("span",Ec,m(x.description),1)]),d[8]||(d[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):u("",!0)])])],8,$c))),128))])):(s(),a("div",Nc,[...d[10]||(d[10]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))]))}},Fc={key:0,class:"space-y-4 mb-6 px-1"},Rc=["onClick"],Bc={class:"flex-1 min-w-0"},Uc={class:"flex items-center gap-2 mb-1"},_c={class:"text-xs font-bold text-foreground"},zc={class:"text-xs text-muted-foreground"},Wc={class:"ml-auto relative"},Hc=["onClick"],Yc={class:"text-sm text-muted-foreground"},Gc={class:"flex items-center gap-2 mb-1 flex-wrap"},Qc={class:"text-sm font-medium text-foreground mb-1"},Jc={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground"},Kc={class:"flex items-center gap-1"},Zc={key:0,class:"flex items-center gap-1"},Xc={key:1,class:"flex items-center gap-1"},em={key:1,class:"text-center py-8 text-muted-foreground"},tm={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const o=qe(),f=N({}),A={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},q=i=>A[i]||i||"Appointment",$=i=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[i]||"bg-muted text-muted-foreground border-gray-100",v=i=>{const x=(i||"").toLowerCase();return x==="confirmed"?"bg-green-50 text-green-600":x==="cancelled"?"bg-red-50 text-red-600":x==="no-show"?"bg-amber-50 text-amber-600":"bg-muted text-muted-foreground"},c=i=>{if(!i)return"";const x=new Date(i);return x.toLocaleDateString("en-US",{month:"short",day:"numeric",year:x.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},I=i=>{if(!i)return"Just now";const x=new Date(i),S=new Date-x,p=Math.floor(S/6e4),r=Math.floor(p/60),g=Math.floor(r/24);return p<1?"Just now":p<60?`${p} minutes ago`:r<24?`${r} hours ago`:g===1?"Yesterday":g<7?`${g} days ago`:x.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=i=>{var x;return i.customerInitials?i.customerInitials:(x=i.customer)!=null&&x.initials?i.customer.initials:"SK"},d=i=>{i.opportunityId?o.push({path:`/tasks/${i.opportunityId}`,query:{type:"opportunity"}}):i.leadId?o.push({path:`/tasks/${i.leadId}`,query:{type:"lead"}}):o.push({path:"/calendar"})};return(i,x)=>(s(),a("div",null,[t.appointments.length>0?(s(),a("div",Fc,[(s(!0),a(Q,null,se(t.appointments,D=>(s(),a("div",{key:D.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:S=>d(D)},[x[5]||(x[5]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Bc,[e("div",Uc,[e("span",_c,m(b(D)),1),x[1]||(x[1]=e("span",{class:"text-xs text-muted-foreground"},"scheduled",-1)),e("span",zc,"• "+m(I(D.start)),1),e("div",Wc,[e("button",{onClick:je(S=>f.value[D.id]=!f.value[D.id],["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...x[0]||(x[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Hc)])]),e("div",Yc,[e("div",Gc,[e("span",{class:z(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",$(D.type)])},m(q(D.type)),3),D.status?(s(),a("span",{key:0,class:z(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",v(D.status)])},m(D.status),3)):u("",!0)]),e("div",Qc,m(D.title||"Appointment"),1),e("div",Jc,[e("span",Kc,[x[2]||(x[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),V(" "+m(c(D.start)),1)]),D.assignee?(s(),a("span",Zc,[x[3]||(x[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),V(" "+m(D.assignee),1)])):u("",!0),D.vehicle?(s(),a("span",Xc,[x[4]||(x[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),V(" "+m(D.vehicle),1)])):u("",!0)])])])],8,Rc))),128))])):(s(),a("div",em,[...x[6]||(x[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))]))}},sm={key:0,class:"mb-8"},am={class:"relative"},nm={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},lm=["onClick"],om={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},im=["src"],rm={key:1,class:"fa-solid fa-car text-4xl text-muted-foreground"},dm={class:"p-6"},um={class:"font-bold text-foreground text-sm mb-1"},cm={key:0,class:"text-xs text-muted-foreground mb-2"},mm={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},fm={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:o}){const f=o,A=N(!1),q=I=>new Intl.NumberFormat("en-US").format(I),$=I=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[I]||"Car",v=I=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[I]||"bg-gray-600",c=I=>{f("car-click",I),A.value=!0};return(I,b)=>t.cars.length>0?(s(),a("div",sm,[b[2]||(b[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Cars")],-1)),e("div",am,[e("div",nm,[(s(!0),a(Q,null,se(t.cars,(d,i)=>(s(),a("div",{key:d.id,class:"flex-none w-64 snap-start bg-surface border border-border rounded-lg shadow-nsc-card overflow-hidden transition-shadow cursor-pointer relative",onClick:x=>c(d)},[e("div",{class:z(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",v(d.type)])},m($(d.type)),3),e("div",om,[d.image?(s(),a("img",{key:0,src:d.image,alt:"Car",class:"w-full h-full object-cover"},null,8,im)):(s(),a("i",rm))]),e("div",dm,[e("h4",um,m(d.brand)+" "+m(d.model)+" ("+m(d.year)+")",1),d.price?(s(),a("p",cm,"€ "+m(q(d.price)),1)):u("",!0),d.stockDays!==null&&d.stockDays!==void 0?(s(),a("div",mm,[b[1]||(b[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),V(" In stock ("+m(d.stockDays)+" days) ",1)])):u("",!0)])],8,lm))),128))])]),l(Pe,{show:A.value,title:"Car Details",onClose:b[0]||(b[0]=d=>A.value=!1)},null,8,["show"])])):u("",!0)}},vm=Ua(fm,[["__scopeId","data-v-8d3d6751"]]),pm={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},ym={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:o}){const f=t,A=o,q=N(null),$=C(()=>f.type==="lead"?"Add New Lead":"Add New Opportunity");C(()=>`Create a ${f.type} for ${f.contact.name}`);const v=I=>{I||A("close")},c=I=>{A("save",I)};return(I,b)=>(s(),P(n(tn),{open:t.show,"onUpdate:open":v},{default:k(()=>[l(n(Qa),null,{default:k(()=>[l(n(Ja),{class:"fixed inset-0 z-50 bg-black/50"}),l(n(Ka),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:k(()=>[l(n(Za),{class:"flex-shrink-0"},{default:k(()=>[l(n(Xa),null,{default:k(()=>[V(m($.value),1)]),_:1})]),_:1}),e("div",pm,[l(hn,{ref_key:"formRef",ref:q,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:c},null,8,["initial-contact","force-type"])]),l(n(en),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:k(()=>{var d,i,x,D;return[l(n(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[0]||(b[0]=S=>I.$emit("close"))}),l(n(_),{label:(d=q.value)!=null&&d.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((i=q.value)==null?void 0:i.isSubmitting)||!((x=q.value)!=null&&x.canSubmit),onClick:(D=q.value)==null?void 0:D.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},gm={class:"flex items-center gap-2"},xm={key:0,class:"space-y-3 animate-pulse"},hm={key:1,class:"divide-y divide-border"},bm={class:"py-3"},km={key:0,class:"text-sm text-muted-foreground leading-relaxed whitespace-pre-line"},wm={key:1,class:"flex items-center gap-3 py-1 text-muted-foreground"},$m={key:0,class:"py-3"},Cm={class:"flex flex-wrap gap-2"},Am={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=q=>({"fa-solid fa-car":sn,"fa-brands fa-whatsapp":kt,"fa-solid fa-phone":ot,"fa-solid fa-envelope":lt,"fa-solid fa-message":rn,"fa-solid fa-comment":kt,"fa-solid fa-clock":Rt,"fa-solid fa-dollar-sign":ln})[q]||Oa,A=C(()=>{if(o.preferences&&o.preferences.length>0)return o.preferences;const q=[],$=o.customerData;if(!$)return q;if($.preferredVehicleType&&q.push({icon:"fa-solid fa-car",label:`Prefers ${$.preferredVehicleType}s`}),$.preferredChannel){const v={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};q.push({icon:v[$.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${$.preferredChannel}`})}return $.preferredContactTime&&q.push({icon:"fa-solid fa-clock",label:$.preferredContactTime}),$.budgetRange&&q.push({icon:"fa-solid fa-dollar-sign",label:$.budgetRange}),q});return(q,$)=>(s(),P(n(We),{class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",gm,[l(n(Yt),{class:"w-4 h-4 text-foreground"}),l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...$[0]||($[0]=[V("Customer Insights",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>[t.loading?(s(),a("div",xm,[...$[1]||($[1]=[e("div",{class:"space-y-2"},[e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-4 bg-muted rounded w-full"}),e("div",{class:"h-4 bg-muted rounded w-5/6"})],-1),e("div",{class:"flex flex-wrap gap-2 pt-3"},[e("div",{class:"h-6 bg-muted rounded w-24"}),e("div",{class:"h-6 bg-muted rounded w-32"}),e("div",{class:"h-6 bg-muted rounded w-20"})],-1)])])):(s(),a("div",hm,[e("div",bm,[t.summary?(s(),a("p",km,m(t.summary),1)):(s(),a("div",wm,[l(n(Oa),{class:"w-4 h-4 opacity-20"}),$[2]||($[2]=e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1))]))]),A.value&&A.value.length>0?(s(),a("div",$m,[e("div",Cm,[(s(!0),a(Q,null,se(A.value,(v,c)=>(s(),P(n(pe),{key:c,variant:"outline",class:"text-xs font-semibold uppercase tracking-wider"},{default:k(()=>[(s(),P(nt(f(v.icon)),{class:"w-3 h-3 mr-1.5 text-primary"})),V(" "+m(v.label),1)]),_:2},1024))),128))])])):u("",!0)]))]),_:1})]),_:1}))}},Im={class:"flex items-center gap-2"},Sm={key:0,class:"space-y-3 animate-pulse"},Tm={key:1,class:"divide-y divide-border"},Dm={class:"py-3"},jm={class:"text-sm text-muted-foreground leading-relaxed break-words"},qm={key:0,class:"text-muted-foreground"},Mm={class:"font-medium text-foreground"},Vm={class:"text-xs text-muted-foreground ml-1"},Lm={class:"py-3"},Om={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},Em={__name:"SuggestedNextAction",props:{leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=d=>Yt,A=qe(),q=C(()=>{if(!o.leads||o.leads.length===0)return null;const d=o.leads.filter(x=>{if(x.isDisqualified)return!1;const D=qa(x,"lead");return D!=="Closed - Invalid"&&D!=="Closed - Not Interested"&&D!=="Closed - Duplicate"});if(d.length===0)return null;const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=i[x.priority]||0,p=i[D.priority]||0;if(S!==p)return p-S;const r=new Date(x.updatedAt||x.createdAt||0);return new Date(D.updatedAt||D.createdAt||0)-r}),d[0]}),$=C(()=>{if(!o.opportunities||o.opportunities.length===0)return null;const d=o.opportunities.filter(x=>{const D=x.displayStage||x.stage;return D!=="Closed Won"&&D!=="Closed Lost"&&D!=="Abandoned"});if(d.length===0)return null;const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=i[x.priority]||0,p=i[D.priority]||0;if(S!==p)return p-S;const r=new Date(x.updatedAt||x.createdAt||0);return new Date(D.updatedAt||D.createdAt||0)-r}),d[0]}),v=C(()=>{if(!q.value)return null;const d=q.value,i={lead:d,displayStage:qa(d,"lead")},x=an(i);return x?{...x,type:"lead",entityId:d.id,entity:d}:null}),c=C(()=>{if(!$.value)return null;const d=$.value,i=o.activities.filter(S=>S.opportunityId===d.id),x={opportunity:d,scheduledAppointment:d.scheduledAppointment||null,activities:i,hasOffers:i.some(S=>S.type==="offer")||!1,stage:d.displayStage||d.stage,deliverySubstatus:d.deliverySubstatus||null,formatDateTime:S=>{if(!S)return"";const p=new Date(S);return p.toLocaleDateString()+" "+p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},D=nn(x.stage,x);return D?{...D,type:"opportunity",entityId:d.id,entity:d}:null}),I=C(()=>{const d=[];v.value&&d.push({...v.value,id:`lead-${v.value.entityId}`}),c.value&&d.push({...c.value,id:`opp-${c.value.entityId}`});const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=x.entity,p=D.entity,r=i[S==null?void 0:S.priority]||0,g=i[p==null?void 0:p.priority]||0;return r!==g?g-r:x.type==="lead"&&D.type==="opportunity"?-1:x.type==="opportunity"&&D.type==="lead"?1:0}),d}),b=d=>{d.type==="lead"?A.push({path:`/tasks/${d.entityId}`,query:{type:"lead"}}):d.type==="opportunity"&&A.push({path:`/tasks/${d.entityId}`,query:{type:"opportunity"}})};return(d,i)=>t.loading||I.value.length>0?(s(),P(n(We),{key:0,class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",Im,[l(n(Yt),{class:"w-4 h-4 text-foreground"}),l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...i[2]||(i[2]=[V("Suggested Next Action",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>[t.loading?(s(),a("div",Sm,[...i[3]||(i[3]=[e("div",{class:"h-4 bg-muted rounded w-full"},null,-1),e("div",{class:"flex flex-col sm:flex-row gap-2 pt-3"},[e("div",{class:"h-10 bg-muted rounded w-full sm:w-32"}),e("div",{class:"h-10 bg-muted rounded w-full sm:w-32"})],-1)])])):I.value.length>0?(s(),a("div",Tm,[e("div",Dm,[e("p",jm,[(s(!0),a(Q,null,se(I.value,(x,D)=>(s(),a(Q,{key:x.id},[D>0?(s(),a("span",qm," or ")):u("",!0),e("span",Mm,m(x.title),1),e("span",Vm," ("+m(x.type==="lead"?"Lead":"Opp")+" #"+m(x.entityId)+") ",1)],64))),128))])]),e("div",Lm,[e("div",Om,[I.value.length>0?(s(),P(n(_),{key:0,onClick:i[0]||(i[0]=x=>b(I.value[0])),variant:"default",class:"w-full sm:w-auto"},{default:k(()=>[(s(),P(nt(f(I.value[0].icon)),{class:"w-4 h-4 mr-2"})),V(" "+m(I.value[0].label),1)]),_:1})):u("",!0),I.value.length>1?(s(),P(n(_),{key:1,onClick:i[1]||(i[1]=x=>b(I.value[1])),variant:"outline",class:"w-full sm:w-auto"},{default:k(()=>[(s(),P(nt(f(I.value[1].icon)),{class:"w-4 h-4 mr-2"})),V(" "+m(I.value[1].label),1)]),_:1})):u("",!0)])])])):u("",!0)]),_:1})]),_:1})):u("",!0)}},Nm={class:"flex items-center gap-2"},Pm={key:0,class:"space-y-3 animate-pulse"},Fm={class:"divide-y divide-border"},Rm={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Bm={class:"flex items-center gap-3 min-w-0"},Um={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},_m={class:"min-w-0"},zm={class:"text-sm text-muted-foreground truncate"},Wm={class:"text-xs text-muted-foreground truncate"},Hm={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Ym={class:"flex items-center gap-3 min-w-0"},Gm={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Qm={class:"min-w-0"},Jm={class:"text-sm text-muted-foreground truncate"},Km={class:"text-xs text-muted-foreground truncate"},Zm={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Xm={class:"flex items-center gap-3 min-w-0"},ef={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},tf={class:"min-w-0"},sf={class:"text-sm text-muted-foreground truncate"},af={class:"text-xs text-muted-foreground truncate"},nf={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},lf={class:"flex items-center gap-3 min-w-0"},of={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},rf={class:"min-w-0"},df={class:"text-sm text-muted-foreground truncate"},uf={class:"text-xs text-muted-foreground truncate"},cf={key:0,class:"text-center py-6 text-muted-foreground"},mf={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=qe(),A=C(()=>{const r=["email","sms","whatsapp","call"],g=o.activities.filter(y=>r.includes(y.type)).sort((y,M)=>new Date(M.timestamp)-new Date(y.timestamp));return g.length>0?g[0]:null}),q=C(()=>{const r=o.leads.filter(g=>{var y;return!g.isDisqualified&&g.status!=="Disqualified"&&!((y=g.stage)!=null&&y.includes("Closed"))});return r.length>0?r[0]:null}),$=C(()=>{if(!q.value)return null;try{return an({lead:q.value,displayStage:q.value.stage})}catch(r){return console.error("Error getting lead next action:",r),null}}),v=C(()=>{const r=o.opportunities.filter(g=>g.stage!=="Closed Won"&&g.stage!=="Closed Lost");return r.length>0?r[0]:null}),c=C(()=>{if(!v.value)return null;try{const r=o.activities.filter(y=>y.opportunityId===v.value.id)||[];return nn(v.value.stage,{opportunity:v.value,scheduledAppointment:v.value.scheduledAppointment||null,activities:r,hasOffers:r.some(y=>y.type==="offer")||!1,stage:v.value.stage,deliverySubstatus:v.value.deliverySubstatus||null,formatDateTime:y=>y?new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(r){return console.error("Error getting opportunity next action:",r),null}}),I=r=>({email:lt,sms:rn,whatsapp:kt,call:ot})[r]||kt,b=r=>r.type==="call"?r.content||`Call with ${r.user||"customer"}`:r.type==="email"?r.subject||r.content||"Email communication":r.type==="sms"||r.type==="whatsapp"?r.content||`${r.type.toUpperCase()} message`:r.content||"Communication",d=r=>{if(!r)return"";const g=new Date(r),y=new Date,M=Math.abs(y-g),H=Math.ceil(M/(1e3*60*60*24));return H===1?"Today":H===2?"Yesterday":H<=7?`${H-1} days ago`:g.toLocaleDateString("en-US",{month:"short",day:"numeric",year:g.getFullYear()!==y.getFullYear()?"numeric":void 0})},i=r=>{if(!r)return"";const g=new Date(r),y=new Date;if(g.toDateString()===y.toDateString())return`Today at ${g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const H=new Date(y);return H.setDate(H.getDate()+1),g.toDateString()===H.toDateString()?`Tomorrow at ${g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:g.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},x=()=>{var r,g;(r=o.nextAppointment)!=null&&r.opportunityId?f.push({path:`/tasks/${o.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(g=o.nextAppointment)!=null&&g.leadId?f.push({path:`/tasks/${o.nextAppointment.leadId}`,query:{type:"lead"}}):f.push({path:"/calendar"})},D=()=>{var r,g;(r=A.value)!=null&&r.opportunityId?f.push({path:`/tasks/${A.value.opportunityId}`,query:{type:"opportunity"}}):(g=A.value)!=null&&g.leadId&&f.push({path:`/tasks/${A.value.leadId}`,query:{type:"lead"}})},S=()=>{var r;(r=q.value)!=null&&r.id&&f.push({path:`/tasks/${q.value.id}`,query:{type:"lead"}})},p=()=>{var r;(r=v.value)!=null&&r.id&&f.push({path:`/tasks/${v.value.id}`,query:{type:"opportunity"}})};return(r,g)=>(s(),P(n(We),{class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",Nm,[l(n(Rt),{class:"w-4 h-4 text-foreground"}),l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...g[0]||(g[0]=[V("Recent Activities",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>{var y,M,H,ae,le,ee;return[t.loading?(s(),a("div",Pm,[(s(),a(Q,null,se(3,ie=>e("div",{key:`skeleton-${ie}`,class:"flex items-center gap-3 p-3"},[...g[1]||(g[1]=[e("div",{class:"w-8 h-8 bg-muted rounded-full"},null,-1),e("div",{class:"flex-1 space-y-2"},[e("div",{class:"h-3 bg-muted rounded w-1/4"}),e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-3 bg-muted rounded w-1/2"})],-1),e("div",{class:"w-8 h-8 bg-muted rounded"},null,-1)])])),64))])):(s(),a(Q,{key:1},[e("div",Fm,[t.nextAppointment?(s(),a("div",Rm,[e("div",Bm,[e("div",Um,[l(n(el),{class:"w-4 h-4 text-primary"})]),e("div",_m,[g[2]||(g[2]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",zm,m(i(t.nextAppointment.start)),1),e("div",Wm,m(t.nextAppointment.title||"Appointment"),1)])]),l(n(_),{onClick:x,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(n(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),A.value?(s(),a("div",Hm,[e("div",Ym,[e("div",Gm,[(s(),P(nt(I(A.value.type)),{class:"w-4 h-4 text-muted-foreground"}))]),e("div",Qm,[g[3]||(g[3]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",Jm,m(b(A.value)),1),e("div",Km,m(d(A.value.timestamp)),1)])]),l(n(_),{onClick:D,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(n(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),q.value?(s(),a("div",Zm,[e("div",Xm,[e("div",ef,[l(n(bt),{class:"w-4 h-4 text-primary"})]),e("div",tf,[g[4]||(g[4]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",sf,m(((y=$.value)==null?void 0:y.label)||"No action defined"),1),e("div",af,m((M=q.value.requestedCar)==null?void 0:M.brand)+" "+m((H=q.value.requestedCar)==null?void 0:H.model),1)])]),l(n(_),{onClick:S,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(n(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),v.value?(s(),a("div",nf,[e("div",lf,[e("div",of,[l(n(tl),{class:"w-4 h-4 text-primary"})]),e("div",rf,[g[5]||(g[5]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",df,m(((ae=c.value)==null?void 0:ae.label)||"No action defined"),1),e("div",uf,m((le=v.value.vehicle)==null?void 0:le.brand)+" "+m((ee=v.value.vehicle)==null?void 0:ee.model)+" - "+m(v.value.stage),1)])]),l(n(_),{onClick:p,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(n(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0)]),!t.nextAppointment&&!A.value&&!q.value&&!v.value?(s(),a("div",cf,[l(n(sl),{class:"w-8 h-8 mx-auto mb-2 opacity-30"}),g[6]||(g[6]=e("p",{class:"text-xs"},"No recent activities available",-1))])):u("",!0)],64))]}),_:1})]),_:1}))}},ff={class:"flex items-center justify-between"},vf={key:0,class:"space-y-3 animate-pulse"},pf={key:0,class:"mb-4 pb-4 border-b border-border"},yf={class:"flex items-center gap-2 mb-1"},gf={key:0,class:"text-sm text-muted-foreground"},xf={key:1,class:"text-xs text-muted-foreground mt-1"},hf={class:"space-y-4"},bf={key:0,class:"space-y-2"},kf={class:"space-y-2"},wf={key:0,class:"flex items-center gap-3"},$f={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Cf={class:"flex-1 min-w-0"},Af={class:"text-sm text-foreground"},If={key:1,class:"flex items-center gap-3"},Sf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Tf={class:"flex-1 min-w-0"},Df={class:"text-sm text-foreground"},jf={key:2,class:"flex items-center gap-3"},qf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Mf={class:"flex-1 min-w-0"},Vf={class:"text-sm text-foreground"},Lf={key:3,class:"flex items-center gap-3"},Of={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Ef={class:"flex-1 min-w-0"},Nf={class:"text-sm text-foreground"},Pf={key:1,class:"space-y-2"},Ff={class:"space-y-2"},Rf={key:0,class:"flex items-center gap-3 group"},Bf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Uf={class:"flex-1 min-w-0"},_f=["href"],zf={key:1,class:"flex items-center gap-3 group"},Wf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Hf={class:"flex-1 min-w-0"},Yf=["href"],Gf={key:2,class:"flex items-center gap-3 group"},Qf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Jf={class:"flex-1 min-w-0"},Kf=["href"],Zf={key:3,class:"flex items-center gap-3 group"},Xf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ev={class:"flex-1 min-w-0"},tv=["href"],sv={key:4,class:"flex items-center gap-3 group"},av={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},nv={class:"flex-1 min-w-0"},lv=["href"],ov={key:2,class:"space-y-2"},iv={class:"space-y-2"},rv={key:0,class:"flex items-center gap-3 group"},dv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},uv={class:"flex-1 min-w-0"},cv={class:"text-sm text-foreground"},mv={key:1,class:"flex items-center gap-3"},fv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},vv={class:"flex-1 min-w-0"},pv={class:"text-sm text-foreground"},yv={key:2,class:"flex items-center gap-3"},gv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},xv={class:"flex-1 min-w-0"},hv={class:"text-sm text-foreground"},bv={key:0},kv={key:1},wv={key:2},$v={key:3},Cv={key:4},Av={key:5},Iv={key:6},Sv={key:3,class:"flex items-center gap-3 group"},Tv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Dv={class:"flex-1 min-w-0"},jv={class:"text-sm text-foreground"},qv={key:3,class:"space-y-2"},Mv={class:"space-y-1.5"},Vv={key:0,class:"flex items-center gap-2"},Lv={class:"text-xs text-foreground font-medium"},Ov={key:1,class:"flex items-center gap-2 group"},Ev={class:"text-xs text-foreground font-mono"},Nv={key:2,class:"flex items-center gap-2"},Pv={class:"text-xs text-foreground"},Fv={key:3,class:"flex items-center gap-2"},Rv={class:"text-xs text-foreground"},Bv={class:"text-xs text-muted-foreground"},Uv={class:"text-xs text-foreground truncate"},_v={key:4,class:"text-center py-6 text-muted-foreground"},zv={__name:"CustomerContactDetailsCard",props:{firstName:{type:String,default:""},lastName:{type:String,default:""},name:{type:String,default:""},initials:{type:String,default:""},title:{type:String,default:""},salutation:{type:String,default:""},jobTitle:{type:String,default:""},birthDate:{type:String,default:""},gender:{type:String,default:""},placeOfBirth:{type:String,default:""},email:{type:[String,Object],default:()=>""},secondaryEmail:{type:String,default:""},phone:{type:[String,Object],default:()=>""},secondaryPhone:{type:String,default:""},mobilePhone:{type:String,default:""},preferredContactMethod:{type:String,default:""},preferredChannel:{type:String,default:""},address:{type:[String,Object],default:()=>""},streetAddress1:{type:String,default:""},streetAddress2:{type:String,default:""},city:{type:String,default:""},postalCode:{type:String,default:""},region:{type:String,default:""},country:{type:String,default:""},contactCustomFields:{type:Object,default:()=>({})},externalId:{type:String,default:""},createdAt:{type:String,default:""},createdDate:{type:String,default:""},updatedAt:{type:String,default:""},lastUpdatedDate:{type:String,default:""},lastActivityDate:{type:String,default:""},isMasterContact:{type:Boolean,default:!1},accountName:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=Wa(),A=N(!1),q=C(()=>o.firstName||o.lastName?`${o.firstName||""} ${o.lastName||""}`.trim():o.name||""),$=C(()=>typeof o.email=="object"&&o.email!==null?o.email.primary||"":o.email||""),v=C(()=>typeof o.email=="object"&&o.email!==null?o.email.secondary||"":o.secondaryEmail||""),c=C(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.primary||"":o.phone||""),I=C(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.secondary||"":o.secondaryPhone||""),b=C(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.mobile||"":o.mobilePhone||""),d=C(()=>typeof o.address=="object"&&o.address!==null?o.address.streetLine1||"":o.streetAddress1||o.streetAddress||""),i=C(()=>typeof o.address=="object"&&o.address!==null?o.address.streetLine2||"":o.streetAddress2||""),x=C(()=>typeof o.address=="object"&&o.address!==null?o.address.city||"":o.city||""),D=C(()=>typeof o.address=="object"&&o.address!==null?o.address.postalCode||"":o.postalCode||o.zipCode||""),S=C(()=>typeof o.address=="object"&&o.address!==null?o.address.region||"":o.region||o.state||o.county||""),p=C(()=>typeof o.address=="object"&&o.address!==null?o.address.country||"":o.country||""),r=C(()=>typeof o.address=="string"?o.address:""),g=C(()=>!!(d.value||x.value||D.value||S.value||p.value)),y=C(()=>o.createdAt||o.createdDate||""),M=C(()=>o.updatedAt||o.lastUpdatedDate||""),H=C(()=>!!(o.title||o.jobTitle||$.value||v.value||c.value||I.value||b.value||ae.value||g.value||r.value||o.birthDate||o.gender||o.placeOfBirth||o.externalId||y.value||M.value||o.contactCustomFields&&Object.keys(o.contactCustomFields).length>0)),ae=C(()=>o.preferredContactMethod||o.preferredChannel||""),le=ie=>{if(!ie)return"";try{return new Date(ie).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return ie}},ee=async(ie,E)=>{try{await navigator.clipboard.writeText(ie);const te=E==="email"?"Email":E==="phone"?"Phone":E==="address"?"Address":E;f.pushToast("success",`${te} copied!`)}catch{f.pushToast("error","Failed to copy")}};return(ie,E)=>(s(),P(n(We),{class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",ff,[l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[V(m(q.value||"Contact Details"),1)]),_:1}),l(n(_),{onClick:E[0]||(E[0]=te=>A.value=!0),variant:"ghost",size:"sm",class:"text-xs"},{default:k(()=>[...E[10]||(E[10]=[V(" Edit Contact ",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>[t.loading?(s(),a("div",vf,[...E[11]||(E[11]=[e("div",{class:"h-4 bg-muted rounded w-3/4"},null,-1),e("div",{class:"h-4 bg-muted rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-muted rounded w-4/5"},null,-1)])])):(s(),a(Q,{key:1},[t.jobTitle||t.isMasterContact?(s(),a("div",pf,[e("div",yf,[t.isMasterContact?(s(),P(n(pe),{key:0,variant:"outline",class:"text-xs px-1.5 py-0"},{default:k(()=>[l(n(dn),{class:"w-3 h-3 mr-1"}),E[12]||(E[12]=V(" Master Contact ",-1))]),_:1})):u("",!0)]),t.jobTitle?(s(),a("div",gf,m(t.jobTitle),1)):u("",!0),t.accountName&&t.isMasterContact?(s(),a("div",xf," at "+m(t.accountName),1)):u("",!0)])):u("",!0),e("div",hf,[t.title||t.birthDate||t.gender||t.placeOfBirth?(s(),a("div",bf,[E[17]||(E[17]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Personal Info",-1)),e("div",kf,[t.title?(s(),a("div",wf,[e("div",$f,[l(n(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Cf,[E[13]||(E[13]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Title",-1)),e("div",Af,m(t.title),1)])])):u("",!0),t.birthDate?(s(),a("div",If,[e("div",Sf,[l(n(Ht),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Tf,[E[14]||(E[14]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Birth Date",-1)),e("div",Df,m(le(t.birthDate)),1)])])):u("",!0),t.gender?(s(),a("div",jf,[e("div",qf,[l(n(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Mf,[E[15]||(E[15]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Gender",-1)),e("div",Vf,m(t.gender),1)])])):u("",!0),t.placeOfBirth?(s(),a("div",Lf,[e("div",Of,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Ef,[E[16]||(E[16]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Place of Birth",-1)),e("div",Nf,m(t.placeOfBirth),1)])])):u("",!0)])])):u("",!0),$.value||v.value||c.value||I.value||b.value?(s(),a("div",Pf,[E[23]||(E[23]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Contact Methods",-1)),e("div",Ff,[$.value?(s(),a("div",Rf,[e("div",Bf,[l(n(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Uf,[E[18]||(E[18]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Primary Email",-1)),e("a",{href:`mailto:${$.value}`,class:"text-sm text-primary hover:underline truncate block"},m($.value),9,_f)]),l(n(_),{onClick:E[1]||(E[1]=te=>ee($.value,"email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),v.value?(s(),a("div",zf,[e("div",Wf,[l(n(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Hf,[E[19]||(E[19]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Secondary Email",-1)),e("a",{href:`mailto:${v.value}`,class:"text-sm text-primary hover:underline truncate block"},m(v.value),9,Yf)]),l(n(_),{onClick:E[2]||(E[2]=te=>ee(v.value,"email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),c.value?(s(),a("div",Gf,[e("div",Qf,[l(n(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Jf,[E[20]||(E[20]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Primary Phone",-1)),e("a",{href:`tel:${c.value}`,class:"text-sm text-primary hover:underline"},m(c.value),9,Kf)]),l(n(_),{onClick:E[3]||(E[3]=te=>ee(c.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),I.value?(s(),a("div",Zf,[e("div",Xf,[l(n(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ev,[E[21]||(E[21]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Secondary Phone",-1)),e("a",{href:`tel:${I.value}`,class:"text-sm text-primary hover:underline"},m(I.value),9,tv)]),l(n(_),{onClick:E[4]||(E[4]=te=>ee(I.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),b.value?(s(),a("div",sv,[e("div",av,[l(n(al),{class:"w-4 h-4 text-muted-foreground"})]),e("div",nv,[E[22]||(E[22]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Mobile Phone",-1)),e("a",{href:`tel:${b.value}`,class:"text-sm text-primary hover:underline"},m(b.value),9,lv)]),l(n(_),{onClick:E[5]||(E[5]=te=>ee(b.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])])):u("",!0),g.value||r.value?(s(),a("div",ov,[E[26]||(E[26]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Address",-1)),e("div",iv,[d.value?(s(),a("div",rv,[e("div",dv,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",uv,[E[24]||(E[24]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Street Address",-1)),e("div",cv,m(d.value),1)]),l(n(_),{onClick:E[6]||(E[6]=te=>ee(d.value,"address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),i.value?(s(),a("div",mv,[e("div",fv,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",vv,[e("div",pv,m(i.value),1)])])):u("",!0),x.value||D.value||S.value||p.value?(s(),a("div",yv,[e("div",gv,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",xv,[e("div",hv,[x.value?(s(),a("span",bv,m(x.value),1)):u("",!0),x.value&&D.value?(s(),a("span",kv,", ")):u("",!0),D.value?(s(),a("span",wv,m(D.value),1)):u("",!0),(x.value||D.value)&&S.value?(s(),a("span",$v,", ")):u("",!0),S.value?(s(),a("span",Cv,m(S.value),1)):u("",!0),(x.value||D.value||S.value)&&p.value?(s(),a("span",Av,", ")):u("",!0),p.value?(s(),a("span",Iv,m(p.value),1)):u("",!0)])])])):u("",!0),r.value&&!g.value?(s(),a("div",Sv,[e("div",Tv,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Dv,[E[25]||(E[25]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Address",-1)),e("div",jv,m(r.value),1)]),l(n(_),{onClick:E[7]||(E[7]=te=>ee(r.value,"address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])])):u("",!0),t.externalId||y.value||M.value||ae.value||t.contactCustomFields&&Object.keys(t.contactCustomFields).length>0?(s(),a("div",qv,[E[31]||(E[31]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Metadata",-1)),e("div",Mv,[ae.value?(s(),a("div",Vv,[l(n(kt),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[27]||(E[27]=e("span",{class:"text-xs text-muted-foreground"},"Preferred Method:",-1)),e("span",Lv,m(ae.value),1)])):u("",!0),t.externalId?(s(),a("div",Ov,[l(n(on),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[28]||(E[28]=e("span",{class:"text-xs text-muted-foreground"},"External ID:",-1)),e("span",Ev,m(t.externalId),1),l(n(_),{onClick:E[8]||(E[8]=te=>ee(t.externalId,"External ID")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0 h-5 w-5 ml-auto",title:"Copy External ID"},{default:k(()=>[l(n(ye),{class:"w-3 h-3"})]),_:1})])):u("",!0),y.value?(s(),a("div",Nv,[l(n(Ht),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[29]||(E[29]=e("span",{class:"text-xs text-muted-foreground"},"Created:",-1)),e("span",Pv,m(le(y.value)),1)])):u("",!0),M.value?(s(),a("div",Fv,[l(n(Rt),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[30]||(E[30]=e("span",{class:"text-xs text-muted-foreground"},"Last Updated:",-1)),e("span",Rv,m(le(M.value)),1)])):u("",!0),t.contactCustomFields&&Object.keys(t.contactCustomFields).length>0?(s(!0),a(Q,{key:4},se(t.contactCustomFields,(te,xe)=>(s(),a("div",{key:xe,class:"flex items-center gap-2"},[l(n(Ue),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),e("span",Bv,m(xe)+":",1),e("span",Uv,m(te),1)]))),128)):u("",!0)])])):u("",!0),H.value?u("",!0):(s(),a("div",_v,[...E[32]||(E[32]=[e("p",{class:"text-xs"},"No contact details available",-1)])]))])],64))]),_:1}),l(Pe,{show:A.value,title:"Edit Contact",onClose:E[9]||(E[9]=te=>A.value=!1)},null,8,["show"])]),_:1}))}},Wv={class:"flex items-center justify-between"},Hv={key:0,class:"space-y-3 animate-pulse"},Yv={key:1,class:"space-y-4"},Gv={class:"space-y-2"},Qv={class:"space-y-2"},Jv={key:0,class:"flex items-center gap-3"},Kv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Zv={class:"flex-1 min-w-0"},Xv={class:"text-sm font-medium text-foreground"},ep={key:1,class:"flex items-center gap-3"},tp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},sp={class:"flex-1 min-w-0"},ap={class:"text-sm text-foreground"},np={key:2,class:"flex items-center gap-3"},lp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},op={class:"flex-1 min-w-0"},ip={key:3,class:"flex items-center gap-3"},rp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},dp={class:"flex-1 min-w-0"},up={class:"text-sm text-foreground"},cp={key:4,class:"flex items-center gap-3"},mp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},fp={class:"flex-1 min-w-0"},vp={class:"text-sm text-foreground"},pp={key:5,class:"flex items-center gap-3 group"},yp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},gp={class:"flex-1 min-w-0"},xp=["href"],hp={key:6,class:"flex items-center gap-3 group"},bp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},kp={class:"flex-1 min-w-0"},wp=["href"],$p={key:7,class:"flex items-center gap-3 group"},Cp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Ap={class:"flex-1 min-w-0"},Ip=["href"],Sp={key:0,class:"space-y-2"},Tp={class:"space-y-2"},Dp={key:0,class:"flex items-center gap-3 group"},jp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},qp={class:"flex-1 min-w-0"},Mp={class:"text-sm text-foreground"},Vp={key:1,class:"flex items-center gap-3 group"},Lp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Op={class:"flex-1 min-w-0"},Ep={class:"text-sm text-foreground"},Np={key:2,class:"flex items-center gap-3"},Pp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Fp={class:"flex-1 min-w-0"},Rp={class:"text-sm text-foreground"},Bp={key:3,class:"flex items-center gap-3"},Up={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},_p={class:"flex-1 min-w-0"},zp={class:"text-sm text-foreground"},Wp={key:4,class:"flex items-center gap-3"},Hp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Yp={class:"flex-1 min-w-0"},Gp={class:"text-sm text-foreground"},Qp={key:1,class:"space-y-2"},Jp={class:"space-y-2"},Kp={key:0,class:"flex items-center gap-3 group"},Zp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Xp={class:"flex-1 min-w-0"},ey={class:"text-sm text-foreground"},ty={key:1,class:"flex items-center gap-3"},sy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ay={class:"flex-1 min-w-0"},ny={class:"text-sm text-foreground"},ly={key:2,class:"flex items-center gap-3"},oy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},iy={class:"flex-1 min-w-0"},ry={class:"text-sm text-foreground"},dy={key:0},uy={key:1},cy={key:2},my={key:3},fy={key:4},vy={key:5},py={key:6},yy={key:2,class:"space-y-2"},gy={class:"space-y-2"},xy={key:0,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},hy={class:"flex items-center gap-3 flex-1 min-w-0"},by={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ky={class:"flex-1 min-w-0"},wy={class:"text-sm font-medium text-foreground"},$y={key:1,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Cy={class:"flex items-center gap-3 flex-1 min-w-0"},Ay={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Iy={class:"flex-1 min-w-0"},Sy={class:"text-sm font-medium text-foreground"},Ty={key:2,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Dy={class:"flex items-center gap-3 flex-1 min-w-0"},jy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},qy={class:"flex-1 min-w-0"},My={class:"text-sm font-medium text-foreground"},Vy={key:3,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Ly={class:"flex items-center gap-3 flex-1 min-w-0"},Oy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Ey={class:"flex-1 min-w-0"},Ny={class:"text-sm font-medium text-foreground"},Py={key:3,class:"space-y-2"},Fy={class:"flex items-start gap-3"},Ry={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},By={class:"flex-1 min-w-0"},Uy={class:"text-sm text-foreground whitespace-pre-line"},_y={key:4,class:"space-y-2"},zy={class:"flex flex-wrap gap-1.5"},Wy={key:5,class:"space-y-2"},Hy={class:"space-y-2"},Yy={key:0,class:"flex items-center gap-3 group"},Gy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Qy={class:"flex-1 min-w-0"},Jy={class:"text-sm text-foreground font-mono"},Ky={key:1,class:"flex items-center gap-3"},Zy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Xy={class:"flex-1 min-w-0"},eg={class:"text-sm text-foreground"},tg={key:2,class:"flex items-center gap-3"},sg={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ag={class:"flex-1 min-w-0"},ng={class:"text-sm text-foreground"},lg={key:3,class:"flex items-center gap-3"},og={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ig={class:"flex-1 min-w-0"},rg={class:"text-sm text-foreground"},dg={key:4,class:"space-y-1"},ug={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},cg={class:"flex-1 min-w-0"},mg={class:"text-xs text-muted-foreground mb-0.5"},fg={class:"text-sm text-foreground"},vg={key:6,class:"text-center py-6 text-muted-foreground"},pg={__name:"AccountDetailsCard",props:{accountData:{type:Object,default:null},currentContactId:{type:[Number,String],default:null},accountStatus:{type:String,default:"Active"},companyWebsite:{type:String,default:""},companyPhone:{type:String,default:""},companyEmail:{type:String,default:""},companyAddress:{type:[String,Object],default:()=>""},companyStreetAddress1:{type:String,default:""},companyStreetAddress2:{type:String,default:""},companyCity:{type:String,default:""},companyPostalCode:{type:String,default:""},companyRegion:{type:String,default:""},companyCountry:{type:String,default:""},fiscalEntity:{type:[String,Object],default:()=>""},accountExternalId:{type:String,default:""},accountCustomFields:{type:Object,default:()=>({})},accountCreatedAt:{type:String,default:""},createdDate:{type:String,default:""},accountUpdatedAt:{type:String,default:""},lastUpdatedDate:{type:String,default:""},lastActivity:{type:String,default:""},lastActivityDate:{type:String,default:""},relatedContactsCount:{type:[Number,Object],default:void 0},relatedLeadsCount:{type:[Number,Object],default:void 0},relatedOpportunitiesCount:{type:[Number,Object],default:void 0},relatedVehiclesCount:{type:[Number,Object],default:void 0},accountTags:{type:Array,default:()=>[]},paymentTerms:{type:String,default:""},creditLimit:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=Wa(),A=N(!1),q=N(!1),$=N(!1),v=N(!1),c=N(!1),I=C(()=>typeof o.fiscalEntity=="object"&&o.fiscalEntity!==null?o.fiscalEntity.name||"":o.fiscalEntity||""),b=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.streetLine1||"":o.companyStreetAddress1||""),d=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.streetLine2||"":o.companyStreetAddress2||""),i=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.city||"":o.companyCity||""),x=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.postalCode||"":o.companyPostalCode||""),D=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.region||"":o.companyRegion||""),S=C(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.country||"":o.companyCountry||""),p=C(()=>typeof o.relatedContactsCount=="object"&&o.relatedContactsCount!==null?o.relatedContactsCount.count||0:o.relatedContactsCount??0),r=C(()=>typeof o.relatedLeadsCount=="object"&&o.relatedLeadsCount!==null?o.relatedLeadsCount.count||0:o.relatedLeadsCount??0),g=C(()=>typeof o.relatedOpportunitiesCount=="object"&&o.relatedOpportunitiesCount!==null?o.relatedOpportunitiesCount.count||0:o.relatedOpportunitiesCount??0),y=C(()=>typeof o.relatedVehiclesCount=="object"&&o.relatedVehiclesCount!==null?o.relatedVehiclesCount.count||0:o.relatedVehiclesCount??0),M=C(()=>o.accountCreatedAt||o.createdDate||""),H=C(()=>o.accountUpdatedAt||o.lastUpdatedDate||""),ae=C(()=>o.lastActivity||o.lastActivityDate||""),le=C(()=>{var K,T,W,O;return!!((K=o.accountData)!=null&&K.vat||(T=o.accountData)!=null&&T.vatNumber||(W=o.accountData)!=null&&W.taxCode||(O=o.accountData)!=null&&O.fiscalCode||I.value)}),ee=C(()=>!!(b.value||i.value||x.value||D.value||S.value)),ie=C(()=>p.value!==void 0&&p.value!==null||r.value!==void 0&&r.value!==null||g.value!==void 0&&g.value!==null||y.value!==void 0&&y.value!==null),E=C(()=>!!(o.accountExternalId||o.accountCreatedAt||o.accountUpdatedAt||o.lastActivity||o.accountCustomFields&&Object.keys(o.accountCustomFields).length>0)),te=C(()=>{var K,T,W,O;return!!((K=o.accountData)!=null&&K.name||(T=o.accountData)!=null&&T.companyName||le.value||ee.value||ie.value||(W=o.accountData)!=null&&W.description||(O=o.accountData)!=null&&O.notes||o.accountTags&&o.accountTags.length>0||E.value)}),xe=K=>K?typeof K=="string"?K:K.name?K.name:K.firstName&&K.lastName?`${K.firstName} ${K.lastName}`:"Unknown":"Not assigned",Ae=K=>{if(!K)return"";try{return new Date(K).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return K}},he=async(K,T)=>{try{await navigator.clipboard.writeText(K),f.pushToast("success",`${T} copied!`)}catch{f.pushToast("error","Failed to copy")}};return(K,T)=>t.accountData||t.loading?(s(),P(n(We),{key:0,class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",Wv,[l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...T[17]||(T[17]=[V("Account Details",-1)])]),_:1}),l(n(_),{onClick:T[0]||(T[0]=W=>A.value=!0),variant:"ghost",size:"sm",class:"text-xs"},{default:k(()=>[...T[18]||(T[18]=[V(" Edit Account ",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>[t.loading?(s(),a("div",Hv,[...T[19]||(T[19]=[e("div",{class:"h-4 bg-muted rounded w-3/4"},null,-1),e("div",{class:"h-4 bg-muted rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-muted rounded w-4/5"},null,-1),e("div",{class:"h-4 bg-muted rounded w-1/2"},null,-1)])])):t.accountData?(s(),a("div",Yv,[e("div",Gv,[T[28]||(T[28]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Company Info",-1)),e("div",Qv,[t.accountData.name||t.accountData.companyName?(s(),a("div",Jv,[e("div",Kv,[l(n(Ea),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Zv,[T[20]||(T[20]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Name",-1)),e("div",Xv,m(t.accountData.name||t.accountData.companyName),1)]),t.accountData.type?(s(),P(n(pe),{key:0,variant:"outline",class:"text-xs"},{default:k(()=>[V(m(t.accountData.type),1)]),_:1})):u("",!0)])):u("",!0),t.accountData.type?(s(),a("div",ep,[e("div",tp,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",sp,[T[21]||(T[21]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Type",-1)),e("div",ap,m(t.accountData.type==="Company"?"Company Account":"Private Account"),1)])])):u("",!0),t.accountStatus?(s(),a("div",np,[e("div",lp,[l(n(Fn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",op,[T[22]||(T[22]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Status",-1)),l(n(pe),{variant:t.accountStatus==="Active"?"default":"outline",class:"text-xs"},{default:k(()=>[V(m(t.accountStatus),1)]),_:1},8,["variant"])])])):u("",!0),t.accountData.accountOwner||t.accountData.owner?(s(),a("div",ip,[e("div",rp,[l(n(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",dp,[T[23]||(T[23]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Owner",-1)),e("div",up,m(xe(t.accountData.accountOwner||t.accountData.owner)),1)])])):u("",!0),t.accountData.type==="Company"&&t.accountData.numberOfEmployees?(s(),a("div",cp,[e("div",mp,[l(n(Ft),{class:"w-4 h-4 text-muted-foreground"})]),e("div",fp,[T[24]||(T[24]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Employees",-1)),e("div",vp,m(t.accountData.numberOfEmployees),1)])])):u("",!0),t.companyWebsite?(s(),a("div",pp,[e("div",yp,[l(n(yn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",gp,[T[25]||(T[25]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Website",-1)),e("a",{href:t.companyWebsite.startsWith("http")?t.companyWebsite:`https://${t.companyWebsite}`,target:"_blank",rel:"noopener noreferrer",class:"text-sm text-primary hover:underline truncate block"},m(t.companyWebsite),9,xp)]),l(n(_),{onClick:T[1]||(T[1]=W=>he(t.companyWebsite,"Website")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy website"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.companyPhone?(s(),a("div",hp,[e("div",bp,[l(n(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",kp,[T[26]||(T[26]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Phone",-1)),e("a",{href:`tel:${t.companyPhone}`,class:"text-sm text-primary hover:underline"},m(t.companyPhone),9,wp)]),l(n(_),{onClick:T[2]||(T[2]=W=>he(t.companyPhone,"Phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.companyEmail?(s(),a("div",$p,[e("div",Cp,[l(n(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Ap,[T[27]||(T[27]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Email",-1)),e("a",{href:`mailto:${t.companyEmail}`,class:"text-sm text-primary hover:underline truncate block"},m(t.companyEmail),9,Ip)]),l(n(_),{onClick:T[3]||(T[3]=W=>he(t.companyEmail,"Email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])]),le.value?(s(),a("div",Sp,[T[34]||(T[34]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Legal/Business",-1)),e("div",Tp,[t.accountData.vat||t.accountData.vatNumber?(s(),a("div",Dp,[e("div",jp,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",qp,[T[29]||(T[29]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"VAT Number",-1)),e("div",Mp,m(t.accountData.vat||t.accountData.vatNumber),1)]),l(n(_),{onClick:T[4]||(T[4]=W=>he(t.accountData.vat||t.accountData.vatNumber,"VAT")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy VAT"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.accountData.taxCode||t.accountData.fiscalCode?(s(),a("div",Vp,[e("div",Lp,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Op,[T[30]||(T[30]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Tax Code",-1)),e("div",Ep,m(t.accountData.taxCode||t.accountData.fiscalCode),1)]),l(n(_),{onClick:T[5]||(T[5]=W=>he(t.accountData.taxCode||t.accountData.fiscalCode,"Tax Code")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy Tax Code"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),I.value?(s(),a("div",Np,[e("div",Pp,[l(n(Ea),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Fp,[T[31]||(T[31]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Fiscal Entity",-1)),e("div",Rp,m(I.value),1)])])):u("",!0),t.paymentTerms?(s(),a("div",Bp,[e("div",Up,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",_p,[T[32]||(T[32]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Payment Terms",-1)),e("div",zp,m(t.paymentTerms),1)])])):u("",!0),t.creditLimit?(s(),a("div",Wp,[e("div",Hp,[l(n(ln),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Yp,[T[33]||(T[33]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Credit Limit",-1)),e("div",Gp,m(t.creditLimit),1)])])):u("",!0)])])):u("",!0),ee.value?(s(),a("div",Qp,[T[36]||(T[36]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Address",-1)),e("div",Jp,[b.value?(s(),a("div",Kp,[e("div",Zp,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Xp,[T[35]||(T[35]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Street Address",-1)),e("div",ey,m(b.value),1)]),l(n(_),{onClick:T[6]||(T[6]=W=>he(b.value,"Address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),d.value?(s(),a("div",ty,[e("div",sy,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",ay,[e("div",ny,m(d.value),1)])])):u("",!0),i.value||x.value||D.value||S.value?(s(),a("div",ly,[e("div",oy,[l(n(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",iy,[e("div",ry,[i.value?(s(),a("span",dy,m(i.value),1)):u("",!0),i.value&&x.value?(s(),a("span",uy,", ")):u("",!0),x.value?(s(),a("span",cy,m(x.value),1)):u("",!0),(i.value||x.value)&&D.value?(s(),a("span",my,", ")):u("",!0),D.value?(s(),a("span",fy,m(D.value),1)):u("",!0),(i.value||x.value||D.value)&&S.value?(s(),a("span",vy,", ")):u("",!0),S.value?(s(),a("span",py,m(S.value),1)):u("",!0)])])])):u("",!0)])])):u("",!0),ie.value?(s(),a("div",yy,[T[45]||(T[45]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Relationships",-1)),e("div",gy,[p.value!==void 0&&p.value!==null?(s(),a("div",xy,[e("div",hy,[e("div",by,[l(n(Ft),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ky,[T[37]||(T[37]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Contacts",-1)),e("div",wy,m(p.value),1)])]),l(n(_),{onClick:T[7]||(T[7]=W=>q.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[38]||(T[38]=[V(" View All ",-1)])]),_:1})])):u("",!0),r.value!==void 0&&r.value!==null?(s(),a("div",$y,[e("div",Cy,[e("div",Ay,[l(n(nl),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Iy,[T[39]||(T[39]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Leads",-1)),e("div",Sy,m(r.value),1)])]),l(n(_),{onClick:T[8]||(T[8]=W=>$.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[40]||(T[40]=[V(" View All ",-1)])]),_:1})])):u("",!0),g.value!==void 0&&g.value!==null?(s(),a("div",Ty,[e("div",Dy,[e("div",jy,[l(n(Xn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",qy,[T[41]||(T[41]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Opportunities",-1)),e("div",My,m(g.value),1)])]),l(n(_),{onClick:T[9]||(T[9]=W=>v.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[42]||(T[42]=[V(" View All ",-1)])]),_:1})])):u("",!0),y.value!==void 0&&y.value!==null?(s(),a("div",Vy,[e("div",Ly,[e("div",Oy,[l(n(sn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Ey,[T[43]||(T[43]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Vehicles",-1)),e("div",Ny,m(y.value),1)])]),l(n(_),{onClick:T[10]||(T[10]=W=>c.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[44]||(T[44]=[V(" View All ",-1)])]),_:1})])):u("",!0)])])):u("",!0),t.accountData.description||t.accountData.notes?(s(),a("div",Py,[T[47]||(T[47]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Additional Info",-1)),e("div",Fy,[e("div",Ry,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",By,[T[46]||(T[46]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Description",-1)),e("div",Uy,m(t.accountData.description||t.accountData.notes),1)])])])):u("",!0),t.accountTags&&t.accountTags.length>0?(s(),a("div",_y,[T[48]||(T[48]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Tags",-1)),e("div",zy,[(s(!0),a(Q,null,se(t.accountTags,W=>(s(),P(n(pe),{key:W,variant:"outline",class:"text-xs"},{default:k(()=>[V(m(W),1)]),_:2},1024))),128))])])):u("",!0),E.value?(s(),a("div",Wy,[T[53]||(T[53]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Metadata",-1)),e("div",Hy,[t.accountExternalId?(s(),a("div",Yy,[e("div",Gy,[l(n(on),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Qy,[T[49]||(T[49]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"External ID",-1)),e("div",Jy,m(t.accountExternalId),1)]),l(n(_),{onClick:T[11]||(T[11]=W=>he(t.accountExternalId,"External ID")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy External ID"},{default:k(()=>[l(n(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),M.value?(s(),a("div",Ky,[e("div",Zy,[l(n(Ht),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Xy,[T[50]||(T[50]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Created Date",-1)),e("div",eg,m(Ae(M.value)),1)])])):u("",!0),H.value?(s(),a("div",tg,[e("div",sg,[l(n(Rt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ag,[T[51]||(T[51]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Last Updated",-1)),e("div",ng,m(Ae(H.value)),1)])])):u("",!0),ae.value?(s(),a("div",lg,[e("div",og,[l(n(Zn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ig,[T[52]||(T[52]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Last Activity",-1)),e("div",rg,m(Ae(ae.value)),1)])])):u("",!0),t.accountCustomFields&&Object.keys(t.accountCustomFields).length>0?(s(),a("div",dg,[(s(!0),a(Q,null,se(t.accountCustomFields,(W,O)=>(s(),a("div",{key:O,class:"flex items-center gap-3"},[e("div",ug,[l(n(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",cg,[e("div",mg,m(O),1),e("div",fg,m(W),1)])]))),128))])):u("",!0)])])):u("",!0),te.value?u("",!0):(s(),a("div",vg,[...T[54]||(T[54]=[e("p",{class:"text-xs"},"No account details available",-1)])]))])):u("",!0)]),_:1}),l(Pe,{show:A.value,title:"Edit Account",onClose:T[12]||(T[12]=W=>A.value=!1)},null,8,["show"]),l(Pe,{show:q.value,title:"View All Contacts",onClose:T[13]||(T[13]=W=>q.value=!1)},null,8,["show"]),l(Pe,{show:$.value,title:"View All Leads",onClose:T[14]||(T[14]=W=>$.value=!1)},null,8,["show"]),l(Pe,{show:v.value,title:"View All Opportunities",onClose:T[15]||(T[15]=W=>v.value=!1)},null,8,["show"]),l(Pe,{show:c.value,title:"View All Vehicles",onClose:T[16]||(T[16]=W=>c.value=!1)},null,8,["show"])]),_:1})):u("",!0)}},yg={class:"flex items-center gap-2"},gg={key:0,class:"space-y-3 animate-pulse"},xg={key:1,class:"space-y-2"},hg=["onClick"],bg={class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0"},kg={class:"text-xs font-semibold text-primary"},wg={class:"flex-1 min-w-0"},$g={class:"flex items-center gap-2 mb-0.5"},Cg={class:"text-sm font-medium text-foreground truncate"},Ag={key:0,class:"text-xs text-muted-foreground truncate"},Ig={class:"flex items-center gap-3 mt-1"},Sg={key:0,class:"flex items-center gap-1 text-xs text-muted-foreground"},Tg={class:"truncate max-w-32"},Dg={key:1,class:"flex items-center gap-1 text-xs text-muted-foreground"},jg={class:"truncate"},qg={key:2,class:"text-center py-6 text-muted-foreground"},Mg={__name:"RelatedContactsWidget",props:{relatedContacts:{type:Array,default:()=>[]},masterContactId:{type:[Number,String],default:null},currentContactId:{type:[Number,String],default:null},accountData:{type:Object,default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,f=qe(),A=v=>o.masterContactId?String(v)===String(o.masterContactId):!1,q=v=>{if(!v)return"?";const c=v.trim().split(" ");return c.length>=2?(c[0][0]+c[c.length-1][0]).toUpperCase():v.substring(0,2).toUpperCase()},$=v=>{v&&String(v)!==String(o.currentContactId)&&f.push({path:`/customer/${v}`,query:{type:"contact"}})};return(v,c)=>t.accountData||t.loading?(s(),P(n(We),{key:0,class:"h-full"},{default:k(()=>[l(n(_e),null,{default:k(()=>[e("div",yg,[l(n(Ft),{class:"w-4 h-4 text-foreground"}),l(n(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...c[0]||(c[0]=[V("Related Contacts",-1)])]),_:1})])]),_:1}),l(n(ze),null,{default:k(()=>[t.loading?(s(),a("div",gg,[(s(),a(Q,null,se(3,I=>e("div",{key:`skeleton-${I}`,class:"flex items-center gap-3 p-3"},[...c[1]||(c[1]=[e("div",{class:"w-10 h-10 bg-muted rounded-full"},null,-1),e("div",{class:"flex-1 space-y-2"},[e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-3 bg-muted rounded w-1/2"})],-1)])])),64))])):t.relatedContacts&&t.relatedContacts.length>0?(s(),a("div",xg,[(s(!0),a(Q,null,se(t.relatedContacts,I=>(s(),a("div",{key:I.id,onClick:b=>$(I.id),class:"flex items-center gap-3 p-3 hover:bg-muted transition-colors rounded-md cursor-pointer group"},[e("div",bg,[e("span",kg,m(I.initials||q(I.name)),1)]),e("div",wg,[e("div",$g,[e("span",Cg,m(I.name),1),A(I.id)?(s(),P(n(pe),{key:0,variant:"outline",class:"text-xs px-1.5 py-0"},{default:k(()=>[l(n(dn),{class:"w-3 h-3 mr-1"}),c[2]||(c[2]=V(" Master ",-1))]),_:1})):u("",!0)]),I.jobTitle||I.title?(s(),a("div",Ag,m(I.jobTitle||I.title),1)):u("",!0),e("div",Ig,[I.email?(s(),a("div",Sg,[l(n(lt),{class:"w-3 h-3"}),e("span",Tg,m(I.email),1)])):u("",!0),I.phone?(s(),a("div",Dg,[l(n(ot),{class:"w-3 h-3"}),e("span",jg,m(I.phone),1)])):u("",!0)])]),l(n(ht),{class:"w-4 h-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})],8,hg))),128))])):t.loading?u("",!0):(s(),a("div",qg,[l(n(Ft),{class:"w-8 h-8 mx-auto mb-2 opacity-30"}),c[3]||(c[3]=e("p",{class:"text-xs"},"No related contacts found",-1))]))]),_:1})]),_:1})):u("",!0)}},Vg={class:"h-full flex flex-col overflow-hidden bg-surface"},Lg={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 auto-rows-min"},Og={class:"h-auto"},Eg={class:"h-auto"},Ng={key:0,class:"h-auto"},Pg={key:1,class:"h-auto"},Fg={class:"lg:col-span-2 h-auto"},Rg={class:"lg:col-span-2 h-auto"},Bg={key:2,class:"lg:col-span-2 h-auto"},Ug={class:"flex flex-col gap-6 mb-6"},Zg={__name:"CustomerProfile",props:{customerId:{type:Number,required:!0},customerType:{type:String,default:"contact",validator:t=>["contact","account"].includes(t)},showCloseButton:{type:Boolean,default:!1},closeOnConvert:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:o}){const f=t,A=o,q=qe();_a(),Ha();const $=Ya(),v=N(!1),c=N(!1),I=N(!1),b=N(!1),d=N(!1),i=N(!1),x=N(!1),D=N(!1),S=N(null),p=N(null),r=N(null),g=N([]),y=N([]),M=N([]),H=N([]),ae=N([]),le=N([]),ee=N([]),ie=C(()=>"contact"),E=C(()=>p.value||$.currentCustomer),te=C(()=>{var B,ke,we;if(!r.value||!p.value)return((B=p.value)==null?void 0:B.isMasterContact)===!0;const F=r.value.masterContactId||((ke=r.value.masterContact)==null?void 0:ke.id),Z=p.value.id||p.value.contactId;return F&&String(F)===String(Z)||((we=p.value)==null?void 0:we.isMasterContact)===!0}),xe=C(()=>{const F=E.value;return F?{...F,id:F.id,type:"contact",customer:{id:F.id,name:F.name,email:F.email,phone:F.phone,address:F.address||"",initials:F.initials},source:F.source||"Direct",tags:F.tags||[],stage:"Contact",assignee:null,assigneeId:null}:{id:null,type:"contact",summary:null,preferences:[],customer:{id:null,name:"",email:"",phone:"",address:"",initials:"?"},source:"Direct",tags:[],stage:"Contact",assignee:null,assigneeId:null}}),Ae=C(()=>{const F=new Date,Z=(ee.value||[]).filter(B=>(B==null?void 0:B.start)&&new Date(B.start)>=F);return Z.sort((B,ke)=>new Date(B.start)-new Date(ke.start)),Z.length>0?Z[0]:null}),he=C(()=>null),K=C(()=>({currentActivities:C(()=>le.value),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),T=C(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),W=async()=>{var F,Z,B,ke;if(f.customerId)try{v.value=!0,b.value=!0,d.value=!0,i.value=!0,x.value=!0,D.value=!0;const[we,ue]=await Promise.all([$.fetchCustomerById(f.customerId,f.customerType).finally(()=>{v.value=!1}),Yn(f.customerId)]);p.value=we||$.currentCustomer,H.value=ue.data||[];const $e=((F=p.value)==null?void 0:F.accountId)||((Z=p.value)==null?void 0:Z.account_id);if($e)try{if(c.value=!0,r.value=await bn($e),((B=r.value)==null?void 0:B.type)==="Company"||((ke=r.value)==null?void 0:ke.accountType)==="Company")try{I.value=!0;const ce=await Gn($e);g.value=(ce.data||[]).filter(me=>me.id!==f.customerId)}catch(ce){console.error("Failed to load related contacts:",ce),g.value=[]}finally{I.value=!1}else g.value=[]}catch(ce){console.error("Failed to load account data:",ce),r.value=null,g.value=[]}finally{c.value=!1}else r.value=null,g.value=[];const[Ee,Ge,Ie]=await Promise.all([Qn(f.customerId,$e||null).finally(()=>{b.value=!1}),Jn(f.customerId,$e||null).finally(()=>{d.value=!1}),Kn($e||f.customerId).finally(()=>{i.value=!1})]);y.value=Ee.data||[],M.value=Ge.data||[],ae.value=Ie.data||[];const Se=[];for(const ce of y.value)try{const me=await gn(ce.id);Se.push(...me)}catch(me){console.error(`Failed to load activities for lead ${ce.id}:`,me)}for(const ce of M.value)try{const me=await xn(ce.id);Se.push(...me)}catch(me){console.error(`Failed to load activities for opportunity ${ce.id}:`,me)}le.value=Se,x.value=!1;try{ee.value=await Hn(f.customerId)}catch(ce){console.error("Failed to load appointments:",ce),ee.value=[]}finally{D.value=!1}}catch(we){console.error("Error loading customer data:",we),S.value=we.message||"Failed to load customer",v.value=!1,c.value=!1,I.value=!1,b.value=!1,d.value=!1,i.value=!1,x.value=!1,D.value=!1}},O=async F=>{try{await $.addRequestedCar(f.customerId,F),await W()}catch(Z){console.error("Error adding car to customer:",Z),S.value=Z.message||"Failed to add car"}},L=async()=>{try{b.value=!0;const F=await $.convertToLead(f.customerId);f.closeOnConvert&&A("close"),q.push({path:`/tasks/${F.id}`,query:{type:"lead"}})}catch(F){console.error("Error converting to lead:",F),S.value=F.message||"Failed to convert to lead",b.value=!1}},be=async()=>{try{d.value=!0;const F=await $.convertToOpportunity(f.customerId);f.closeOnConvert&&A("close"),q.push({path:`/tasks/${F.id}`,query:{type:"opportunity"}})}catch(F){console.error("Error converting to opportunity:",F),S.value=F.message||"Failed to convert to opportunity",d.value=!1}},fe=N(!1),Ce=N("lead"),Oe=C(()=>{if(!E.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const F=E.value;return{id:F.id,name:F.name||"Unknown",email:F.email||"",phone:F.phone||"",initials:F.initials||"?"}}),Re=F=>{Ce.value=F,fe.value=!0},rt=async F=>{try{if(Ce.value==="lead"?b.value=!0:d.value=!0,fe.value=!1,!f.customerId)throw new Error("Customer ID not found");Ce.value==="lead"?await $.convertToLead(f.customerId):await $.convertToOpportunity(f.customerId),await W()}catch(Z){console.error(`Error adding ${Ce.value}:`,Z),S.value=Z.message||`Failed to add ${Ce.value}`,Ce.value==="lead"?b.value=!1:d.value=!1}},He=async()=>{await W()},Ye=async()=>{await W()};return wt(async()=>{await W()}),Le(()=>f.customerId,F=>{F&&W()}),(F,Z)=>(s(),a("div",Vg,[l(tc,{task:xe.value,type:ie.value,"management-widget":he.value,"store-adapter":K.value,"add-new-config":T.value,"show-close-button":t.showCloseButton,onClose:Z[2]||(Z[2]=B=>F.$emit("close")),onCarAdded:O,onConvertToLead:L,onConvertToOpportunity:be,onTagUpdated:He,onAppointmentCreated:Ye},{"pinned-extra":k(({task:B})=>{var ke,we,ue,$e,Ee,Ge,Ie,Se,ce,me,Qe,dt,ut,$t,ct,Je,mt,Me,Ct,ft,At,It,St,Tt,Dt,jt,qt,Mt,Vt,Ve,vt,pt,Lt,Ot,Et,Nt,h,w,R,U,J,G,ne,j,Y,ve,Be,yt,Ke,Ze,Pt,gt,xt,Te,De,Qt,Jt,Kt,Zt,Xt,es,ts,ss,as,ns,ls,os,is,rs,ds,us,cs,ms,fs,vs,ps,ys,gs,xs,hs,bs,ks,ws,$s,Cs,As,Is,Ss,Ts,Ds,js,qs,Ms,Vs,Ls,Os,Es,Ns,Ps,Fs,Rs,Bs,Us,_s,zs,Ws,Hs,Ys,Gs,Qs,Js,Ks,Zs,Xs,ea,ta,sa,aa,na,la,oa,ia,ra,da,ua,ca,ma,fa,va,pa,ya,ga,xa,ha,ba,ka,wa,$a,Ca,Aa,Ia,Sa,Ta;return[e("div",Lg,[e("div",Og,[l(zv,{name:((ke=p.value)==null?void 0:ke.name)||((we=B==null?void 0:B.customer)==null?void 0:we.name)||"","first-name":((ue=p.value)==null?void 0:ue.firstName)||"","last-name":(($e=p.value)==null?void 0:$e.lastName)||"",initials:((Ee=p.value)==null?void 0:Ee.initials)||((Ge=B==null?void 0:B.customer)==null?void 0:Ge.initials)||"",title:((Ie=p.value)==null?void 0:Ie.title)||((Se=p.value)==null?void 0:Se.salutation)||"",salutation:((ce=p.value)==null?void 0:ce.salutation)||((me=p.value)==null?void 0:me.title)||"","job-title":((Qe=p.value)==null?void 0:Qe.jobTitle)||"","birth-date":((dt=p.value)==null?void 0:dt.birthDate)||"",gender:((ut=p.value)==null?void 0:ut.gender)||"","place-of-birth":(($t=p.value)==null?void 0:$t.placeOfBirth)||"",email:((ct=p.value)==null?void 0:ct.email)||((Je=B==null?void 0:B.customer)==null?void 0:Je.email)||"","secondary-email":((mt=p.value)==null?void 0:mt.secondaryEmail)||"",phone:((Me=p.value)==null?void 0:Me.phone)||((Ct=B==null?void 0:B.customer)==null?void 0:Ct.phone)||"","secondary-phone":((ft=p.value)==null?void 0:ft.secondaryPhone)||"","mobile-phone":((At=p.value)==null?void 0:At.mobilePhone)||"","preferred-contact-method":((It=p.value)==null?void 0:It.preferredContactMethod)||((St=p.value)==null?void 0:St.preferredChannel)||"","preferred-channel":((Tt=p.value)==null?void 0:Tt.preferredChannel)||"",address:((Dt=p.value)==null?void 0:Dt.address)||((jt=B==null?void 0:B.customer)==null?void 0:jt.address)||"","street-address1":((qt=p.value)==null?void 0:qt.streetAddress1)||((Mt=p.value)==null?void 0:Mt.streetAddress)||((Ve=(Vt=p.value)==null?void 0:Vt.address)==null?void 0:Ve.streetLine1)||"","street-address2":((vt=p.value)==null?void 0:vt.streetAddress2)||((Lt=(pt=p.value)==null?void 0:pt.address)==null?void 0:Lt.streetLine2)||"",city:((Ot=p.value)==null?void 0:Ot.city)||((Nt=(Et=p.value)==null?void 0:Et.address)==null?void 0:Nt.city)||"","postal-code":((h=p.value)==null?void 0:h.postalCode)||((w=p.value)==null?void 0:w.zipCode)||((U=(R=p.value)==null?void 0:R.address)==null?void 0:U.postalCode)||"",region:((J=p.value)==null?void 0:J.region)||((G=p.value)==null?void 0:G.state)||((ne=p.value)==null?void 0:ne.county)||((Y=(j=p.value)==null?void 0:j.address)==null?void 0:Y.region)||"",country:((ve=p.value)==null?void 0:ve.country)||((yt=(Be=p.value)==null?void 0:Be.address)==null?void 0:yt.country)||"","contact-custom-fields":((Ke=p.value)==null?void 0:Ke.customFields)||((Ze=p.value)==null?void 0:Ze.contactCustomFields)||{},"external-id":((Pt=p.value)==null?void 0:Pt.externalId)||((gt=p.value)==null?void 0:gt.contactExternalId)||"","created-at":((xt=p.value)==null?void 0:xt.createdAt)||((Te=p.value)==null?void 0:Te.createdDate)||"","created-date":((De=p.value)==null?void 0:De.createdDate)||((Qt=p.value)==null?void 0:Qt.createdAt)||"","updated-at":((Jt=p.value)==null?void 0:Jt.updatedAt)||((Kt=p.value)==null?void 0:Kt.lastUpdatedDate)||((Zt=p.value)==null?void 0:Zt.lastContact)||"","last-updated-date":((Xt=p.value)==null?void 0:Xt.lastUpdatedDate)||((es=p.value)==null?void 0:es.updatedAt)||"","last-activity-date":((ts=p.value)==null?void 0:ts.lastActivityDate)||"","is-master-contact":te.value,"account-name":((ss=r.value)==null?void 0:ss.name)||((as=r.value)==null?void 0:as.companyName)||"",loading:v.value},null,8,["name","first-name","last-name","initials","title","salutation","job-title","birth-date","gender","place-of-birth","email","secondary-email","phone","secondary-phone","mobile-phone","preferred-contact-method","preferred-channel","address","street-address1","street-address2","city","postal-code","region","country","contact-custom-fields","external-id","created-at","created-date","updated-at","last-updated-date","last-activity-date","is-master-contact","account-name","loading"])]),e("div",Eg,[l(Am,{summary:(B==null?void 0:B.summary)||((ns=p.value)==null?void 0:ns.summary),preferences:(B==null?void 0:B.preferences)||((ls=p.value)==null?void 0:ls.preferences),"customer-data":p.value,loading:v.value},null,8,["summary","preferences","customer-data","loading"])]),r.value&&r.value.type==="Company"?(s(),a("div",Ng,[l(pg,{"account-data":r.value,"current-contact-id":t.customerId,"account-status":((os=r.value)==null?void 0:os.status)||((is=r.value)==null?void 0:is.accountStatus)||"Active","company-website":((rs=r.value)==null?void 0:rs.website)||((ds=r.value)==null?void 0:ds.companyWebsite)||"","company-phone":((us=r.value)==null?void 0:us.companyPhone)||((cs=r.value)==null?void 0:cs.phone)||"","company-email":((ms=r.value)==null?void 0:ms.companyEmail)||((fs=r.value)==null?void 0:fs.email)||"","company-address":((vs=r.value)==null?void 0:vs.companyAddress)||((ps=r.value)==null?void 0:ps.address)||"","company-street-address1":((gs=(ys=r.value)==null?void 0:ys.companyAddress)==null?void 0:gs.streetLine1)||((xs=r.value)==null?void 0:xs.streetAddress1)||((hs=r.value)==null?void 0:hs.companyStreetAddress)||((ks=(bs=r.value)==null?void 0:bs.address)==null?void 0:ks.streetLine1)||(typeof((ws=r.value)==null?void 0:ws.address)=="string"?(Cs=($s=r.value)==null?void 0:$s.address)==null?void 0:Cs.split(",")[0]:"")||"","company-street-address2":((Is=(As=r.value)==null?void 0:As.companyAddress)==null?void 0:Is.streetLine2)||((Ss=r.value)==null?void 0:Ss.streetAddress2)||((Ds=(Ts=r.value)==null?void 0:Ts.address)==null?void 0:Ds.streetLine2)||"","company-city":((qs=(js=r.value)==null?void 0:js.companyAddress)==null?void 0:qs.city)||((Ms=r.value)==null?void 0:Ms.city)||((Vs=r.value)==null?void 0:Vs.companyCity)||((Os=(Ls=r.value)==null?void 0:Ls.address)==null?void 0:Os.city)||"","company-postal-code":((Ns=(Es=r.value)==null?void 0:Es.companyAddress)==null?void 0:Ns.postalCode)||((Ps=r.value)==null?void 0:Ps.postalCode)||((Fs=r.value)==null?void 0:Fs.zipCode)||((Rs=r.value)==null?void 0:Rs.companyPostalCode)||((Us=(Bs=r.value)==null?void 0:Bs.address)==null?void 0:Us.postalCode)||"","company-region":((zs=(_s=r.value)==null?void 0:_s.companyAddress)==null?void 0:zs.region)||((Ws=r.value)==null?void 0:Ws.region)||((Hs=r.value)==null?void 0:Hs.state)||((Ys=r.value)==null?void 0:Ys.county)||((Gs=r.value)==null?void 0:Gs.companyRegion)||((Js=(Qs=r.value)==null?void 0:Qs.address)==null?void 0:Js.region)||"","company-country":((Zs=(Ks=r.value)==null?void 0:Ks.companyAddress)==null?void 0:Zs.country)||((Xs=r.value)==null?void 0:Xs.country)||((ea=r.value)==null?void 0:ea.companyCountry)||((sa=(ta=r.value)==null?void 0:ta.address)==null?void 0:sa.country)||"","fiscal-entity":((aa=r.value)==null?void 0:aa.fiscalEntity)||((na=r.value)==null?void 0:na.fiscalEntityName)||"","account-external-id":((la=r.value)==null?void 0:la.externalId)||((oa=r.value)==null?void 0:oa.accountExternalId)||"","account-custom-fields":((ia=r.value)==null?void 0:ia.customFields)||((ra=r.value)==null?void 0:ra.accountCustomFields)||{},"account-created-at":((da=r.value)==null?void 0:da.createdAt)||((ua=r.value)==null?void 0:ua.createdDate)||"","created-date":((ca=r.value)==null?void 0:ca.createdDate)||((ma=r.value)==null?void 0:ma.createdAt)||"","account-updated-at":((fa=r.value)==null?void 0:fa.updatedAt)||((va=r.value)==null?void 0:va.lastUpdatedDate)||((pa=r.value)==null?void 0:pa.lastContact)||"","last-updated-date":((ya=r.value)==null?void 0:ya.lastUpdatedDate)||((ga=r.value)==null?void 0:ga.updatedAt)||"","last-activity":((xa=r.value)==null?void 0:xa.lastActivity)||((ha=r.value)==null?void 0:ha.lastActivityDate)||((ba=r.value)==null?void 0:ba.lastContact)||"","last-activity-date":((ka=r.value)==null?void 0:ka.lastActivityDate)||((wa=r.value)==null?void 0:wa.lastActivity)||"","related-contacts-count":g.value.length,"related-leads-count":y.value.length,"related-opportunities-count":M.value.length,"related-vehicles-count":ae.value.length,"account-tags":(($a=r.value)==null?void 0:$a.tags)||[],"payment-terms":((Ca=r.value)==null?void 0:Ca.paymentTerms)||"","credit-limit":((Aa=r.value)==null?void 0:Aa.creditLimit)||"",loading:c.value},null,8,["account-data","current-contact-id","account-status","company-website","company-phone","company-email","company-address","company-street-address1","company-street-address2","company-city","company-postal-code","company-region","company-country","fiscal-entity","account-external-id","account-custom-fields","account-created-at","created-date","account-updated-at","last-updated-date","last-activity","last-activity-date","related-contacts-count","related-leads-count","related-opportunities-count","related-vehicles-count","account-tags","payment-terms","credit-limit","loading"])])):u("",!0),r.value&&r.value.type==="Company"?(s(),a("div",Pg,[l(Mg,{"related-contacts":g.value,"master-contact-id":((Ia=r.value)==null?void 0:Ia.masterContactId)||((Ta=(Sa=r.value)==null?void 0:Sa.masterContact)==null?void 0:Ta.id),"current-contact-id":t.customerId,"account-data":r.value,loading:I.value},null,8,["related-contacts","master-contact-id","current-contact-id","account-data","loading"])])):u("",!0),e("div",Fg,[l(Em,{leads:y.value,opportunities:M.value,activities:le.value,loading:b.value||d.value||x.value},null,8,["leads","opportunities","activities","loading"])]),e("div",Rg,[l(mf,{"next-appointment":Ae.value,activities:le.value,leads:y.value,opportunities:M.value,"customer-id":t.customerId,loading:x.value||D.value||b.value||d.value},null,8,["next-appointment","activities","leads","opportunities","customer-id","loading"])]),ae.value.length>0||i.value?(s(),a("div",Bg,[l(vm,{cars:ae.value},null,8,["cars"])])):u("",!0)])]}),"tab-negotiations":k(()=>[e("div",Ug,[l(hc,{leads:y.value,"all-tasks":H.value,loading:b.value,onAddLead:Z[0]||(Z[0]=B=>Re("lead"))},null,8,["leads","all-tasks","loading"]),l(Pc,{opportunities:M.value,"all-tasks":H.value,activities:le.value,loading:d.value,onAddOpportunity:Z[1]||(Z[1]=B=>Re("opportunity"))},null,8,["opportunities","all-tasks","activities","loading"])])]),"tab-appointments":k(()=>[l(tm,{appointments:ee.value,loading:D.value},null,8,["appointments","loading"])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config","show-close-button"]),E.value?(s(),P(ym,{key:0,show:fe.value,type:Ce.value,contact:Oe.value,onClose:Z[3]||(Z[3]=B=>fe.value=!1),onSave:rt},null,8,["show","type","contact"])):u("",!0)]))}};export{Zg as _};
