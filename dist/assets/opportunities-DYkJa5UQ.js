const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-aIgEv3db.js","assets/index-Cq_BQFx0.css"])))=>i.map(i=>d[i]);
import{d as T,r as v,c as h,a0 as V}from"./index-aIgEv3db.js";import{a as W,b as m,d as O,e as $,g as f,h as j,i as D,j as Q,k as q,l as z}from"./opportunities-P1PvtTvZ.js";const J=T("opportunities",()=>{const r=v([]),s=v(null),o=v([]),u=v(!1),n=v(null),y=v({stage:null,assignee:null,search:""}),x=h(()=>r.value.length),A=h(()=>{const e={};return r.value.forEach(a=>{e[a.stage]||(e[a.stage]=[]),e[a.stage].push(a)}),e}),b=h(()=>r.value.reduce((e,a)=>e+a.value,0));async function w(){u.value=!0,n.value=null;try{const e=await W(y.value);r.value=e.data}catch(e){n.value=e.message}finally{u.value=!1}}async function L(e){u.value=!0,n.value=null;try{s.value=await m(e),o.value=await O(e);const a=r.value.findIndex(t=>t.id===parseInt(e));a!==-1&&(r.value[a]=s.value)}catch(a){n.value=a.message}finally{u.value=!1}}async function I(e){u.value=!0,n.value=null;try{const a=await $(e);return r.value.unshift(a),a}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function k(e,a){u.value=!0,n.value=null;try{const t=await f(e,a),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function g(e){u.value=!0,n.value=null;try{await j(e),r.value=r.value.filter(a=>a.id!==e)}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function d(e,a){try{const t=await D(e,a);return o.value.unshift(t),t}catch(t){throw n.value=t.message,t}}async function S(e,a,t){try{const i=await Q(e,a,t),l=o.value.findIndex(c=>c.id===parseInt(a));return l!==-1&&(o.value[l]=i),i}catch(i){throw n.value=i.message,i}}async function _(e,a){try{return await q(e,a),o.value=o.value.filter(t=>t.id!==parseInt(a)),{success:!0}}catch(t){throw n.value=t.message,t}}function F(e){y.value={...y.value,...e},w()}async function R(e){var a;u.value=!0,n.value=null;try{const t=r.value.find(p=>p.id===e)||s.value,i={stage:"Qualified"};((t==null?void 0:t.probability)===0||(t==null?void 0:t.probability)===100)&&(i.probability=50);const l=await f(e,i),c=r.value.findIndex(p=>p.id===e);return c!==-1&&(r.value[c]=l),((a=s.value)==null?void 0:a.id)===e&&(s.value=l),await d(e,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${l.stage} stage`}),l}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function B(e){var a;u.value=!0,n.value=null;try{const t=await f(e,{stage:"Registration"}),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function C(e){var a;u.value=!0,n.value=null;try{const t=await f(e,{stage:"Closed",probability:100}),i=r.value.findIndex(l=>l.id===e);return i!==-1&&(r.value[i]=t),((a=s.value)==null?void 0:a.id)===e&&(s.value=t),await d(e,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function E(e,a){u.value=!0,n.value=null;try{const t=await z(e,a);return r.value.unshift(t),t}catch(t){throw n.value=t.message,t}finally{u.value=!1}}async function Y(e){u.value=!0,n.value=null;try{const a=await m(e),t=await O(e),{useLeadsStore:i}=await V(async()=>{const{useLeadsStore:p}=await import("./index-aIgEv3db.js").then(P=>P.a3);return{useLeadsStore:p}},__vite__mapDeps([0,1])),c=await i().createLeadFromOpportunity(a,t);return await g(e),c.id}catch(a){throw n.value=a.message,a}finally{u.value=!1}}return{opportunities:r,currentOpportunity:s,currentOpportunityActivities:o,loading:u,error:n,filters:y,totalOpportunities:x,opportunitiesByStage:A,totalValue:b,loadOpportunities:w,loadOpportunityById:L,addOpportunity:I,modifyOpportunity:k,removeOpportunity:g,addActivity:d,updateActivity:S,deleteActivity:_,setFilters:F,reopenOpportunity:R,markAsRegistration:B,markAsClosedWon:C,createOpportunityFromLead:E,convertOpportunityToLead:Y}});export{J as useOpportunitiesStore};
