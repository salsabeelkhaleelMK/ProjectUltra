import{y as Y}from"./components-D1kWShum.js";import{n as U}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-3RNqBGno.js";import{u as Z,U as ee}from"./useDataTableData-D7InczSP.js";import{I as te,C as se,r as i,c as p,m as ae,d as N,o as B,e as o,s as m,B as g,g as oe,y as n,t as ne,k as I}from"./index-D-GV69Dn.js";import{g as ie,c as le,f as re}from"./OfferCarousel-YtLzEMp2.js";import{u as ue}from"./useCustomersTable-DJeOs6IQ.js";import{u as de}from"./useTableRowSelection-BPyRhPA4.js";import"./sparkles-DqOgHrLF.js";import"./opportunities-D_EVVSI9.js";import"./vehicles-CLPlMvEC.js";const ce={class:"mb-8"},pe={class:"bg-white"},me={class:"mb-4"},ge={class:"data-table-inner table-search-wrapper"},fe={key:0,class:"flex items-center gap-2"},ve={class:"flex items-center gap-2 mr-1"},be={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},xe={__name:"OpenLeadsTab",emits:["row-click"],setup(ye,{emit:L}){const _=L,l=se(),M=i(!1),{selectedCount:R,hasSelection:V,getSelectedRows:$,clearSelection:v}=de(t=>t.id),r=i({pageIndex:0,pageSize:10}),u=i(""),d=i([]),f=i([]),b=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",Q=t=>({Valid:"bg-green-100 text-green-700","Not valid":"bg-red-100 text-red-700",Qualified:"bg-muted text-muted-foreground","Not interested":"bg-red-100 text-red-700",Open:"bg-blue-100 text-blue-700"})[t]||"bg-muted text-muted-foreground",x=p(()=>{let t=l.leads;return M.value?t=l.leads.filter(e=>e.isDisqualified===!0):t=l.leads.filter(e=>!e.isDisqualified),t.map(e=>{var s,a,C,k,w,S,F,q,h,O,A,T;return{id:`lead-${e.id}`,stageKey:"open-leads",customer:((s=e.customer)==null?void 0:s.name)||"Unknown",email:((a=e.customer)==null?void 0:a.email)||"",initials:((C=e.customer)==null?void 0:C.initials)||((w=(k=e.customer)==null?void 0:k.name)==null?void 0:w.slice(0,2).toUpperCase())||"?",nextAction:re(e.nextActionDue)||"No due date",nextActionFull:le(e.nextActionDue),deadlineStatus:ie(e.nextActionDue),car:`${((S=e.requestedCar)==null?void 0:S.brand)||""} ${((F=e.requestedCar)==null?void 0:F.model)||""}`.trim()||"N/A",carStatus:((q=e.requestedCar)==null?void 0:q.stockDays)!==void 0&&((h=e.requestedCar)==null?void 0:h.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((O=e.requestedCar)==null?void 0:O.stockDays)!==void 0&&((A=e.requestedCar)==null?void 0:A.stockDays)!==null?"bg-green-100 text-green-700":"bg-muted text-muted-foreground",requestType:((T=e.requestedCar)==null?void 0:T.requestType)||"Quotation",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:b(e.createdAt),lastActivity:b(e.lastActivity),status:e.status,statusClass:Q(e.status),priority:e.priority||"Normal"}})}),y=t=>{t.id.startsWith("lead-")&&_("row-click",t)},z=i("open-leads"),{columns:D,filterDefinitions:c,tableMeta:G}=ue(z,y),{paginatedData:E,sortedData:j,totalFilteredCount:K}=Z({rawData:x,columns:D,globalFilter:u,columnFilters:d,sorting:f,pagination:r,filterDefs:c,searchableFields:t=>[t.customer,t.email,t.status,t.car,t.source,t.assignee]}),W=p(()=>[...new Set(x.value.map(e=>e.assignee).filter(Boolean))].map(e=>({value:e,label:e}))),H=[{value:"Test Drive",label:"Test Drive"},{value:"Quotation",label:"Quotation"},{value:"Generic sales",label:"Generic sales"}],J=p(()=>{var e,s;const t=(e=c.value)==null?void 0:e.find(a=>a.key==="status");return((s=t==null?void 0:t.options)==null?void 0:s.map(a=>({value:a.value,label:a.label})))??[]}),P=p(()=>{var e,s;const t=(e=c.value)==null?void 0:e.find(a=>a.key==="source");return((s=t==null?void 0:t.options)==null?void 0:s.map(a=>({value:a.value,label:a.label})))??[]}),X=()=>{const t=$(j.value);t.length!==0&&confirm(`Are you sure you want to delete ${t.length} ${t.length===1?"lead":"leads"}?`)&&(t.forEach(e=>{const s=e.id.replace("lead-","");l.deleteLead(s)}),v())};return ae(async()=>{await l.fetchLeads()}),(t,e)=>(B(),N("div",ce,[o("div",pe,[o("div",me,[m(ee,{"active-tab":"leads",placeholder:"Search leads...",pagination:r.value,"assignee-options":W.value,"request-type-options":H,"status-options":J.value,"source-options":P.value,"onUpdate:globalFilter":e[0]||(e[0]=s=>u.value=s),"onUpdate:columnFilters":e[1]||(e[1]=s=>d.value=s),"onUpdate:pagination":e[2]||(e[2]=s=>r.value=s)},null,8,["pagination","assignee-options","status-options","source-options"])]),o("div",ge,[m(n(Y),{data:n(E),columns:n(D),meta:n(G),onRowClick:y,columnFiltersOptions:{filterDefs:n(c)},pagination:r.value,"onUpdate:pagination":e[3]||(e[3]=s=>r.value=s),globalFilter:u.value,"onUpdate:globalFilter":e[4]||(e[4]=s=>u.value=s),sorting:f.value,"onUpdate:sorting":e[5]||(e[5]=s=>f.value=s),columnFilters:d.value,"onUpdate:columnFilters":e[6]||(e[6]=s=>d.value=s),paginationOptions:{rowCount:n(K)},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":g(()=>[...e[7]||(e[7]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":g(()=>[n(V)?(B(),N("div",fe,[o("div",ve,[o("div",be,ne(n(R)),1),e[8]||(e[8]=o("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),e[11]||(e[11]=o("div",{class:"h-4 w-px bg-greys-700"},null,-1)),m(n(U),{variant:"ghost",size:"sm",onClick:X},{default:g(()=>[...e[9]||(e[9]=[o("i",{class:"fa-solid fa-trash mr-2"},null,-1),I(" Delete ",-1)])]),_:1}),m(n(U),{variant:"ghost",size:"sm",onClick:n(v)},{default:g(()=>[...e[10]||(e[10]=[o("i",{class:"fa-solid fa-x mr-2"},null,-1),I(" Close ",-1)])]),_:1},8,["onClick"])])):oe("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Te=te(xe,[["__scopeId","data-v-c852aec6"]]);export{Te as default};
