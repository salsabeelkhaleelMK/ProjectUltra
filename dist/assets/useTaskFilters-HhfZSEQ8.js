const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-BG9sTx9a.js","assets/index-D8nDSNmq.js","assets/index-B2AXF7q7.css","assets/users-CPXYaoWs.js"])))=>i.map(i=>d[i]);
import{n as Y,z as sa,b as na,Z as Tn,X as On,a as aa,f as fs,F as ys,L as gs,g as bs,h as hs,Q as G,C as xs,d as ws,i as jt,W as Vt,U as Mt,H as qt,j as be,G as Lt,c as at,o as lt,$ as bn}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import{H as St,M as Wt,c as S,d as C,o as p,e,g as L,t as I,n as J,F as Le,s,x as me,B as r,y as t,X as Fn,L as la,I as ps,Y as xn,V as wn,r as A,k as T,C as Pt,j as Un,T as pt,O as xt,P as kn,Z as _s,h as _n,u as Tt,S as Fs,q as Je,i as ze,$ as Sn,l as $e,p as Ge,a0 as vt,a1 as In,a2 as oa,a3 as ia,a4 as vs,G as At,a5 as hn,_ as Zt,N as ra,w as Rs,m as ks,K as En,a6 as Us}from"./index-D8nDSNmq.js";import{u as Ft}from"./opportunities-D1cnNxBd.js";import{E as ua,_ as da,T as ca,h as Rn,i as ma,j as pa,k as va,l as fa,m as Cn,P as jn,n as Bn,o as ya,p as ga,q as ba,r as ha,s as xa,t as wa,u as ka,v as Sa,e as Nn,b as Rt,w as ms,g as Ca,c as $a,f as Da,x as Aa,y as Ta,z as Oa,A as Ia,B as Na,C as Va,D as Es,F as Ma}from"./opportunityRules-DnV0W7Tj.js";import{_ as Wn}from"./CreateEventModal-Dcf8GuUu.js";import{_ as Pn}from"./ReassignUserModal-ChhlJNp9.js";import{u as Ut,c as yn}from"./users-CPXYaoWs.js";import{S as Ze}from"./components-Y9EE84YM.js";import{S as qa}from"./sparkles-BOzuQ2gU.js";import{f as La}from"./vehicles-CxdEy1So.js";import{_ as Fa,a as Ua}from"./EditEventModal-DbD5QLnE.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=St("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=St("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=St("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=St("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=St("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=St("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=St("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=St("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=St("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=St("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ya={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Ha={class:"flex items-center justify-between gap-4 w-full h-full"},Qa={class:"flex flex-col min-w-0"},Ja={class:"flex items-center gap-2 min-w-0"},Ga={key:0,class:"text-fluid-lg font-medium text-heading truncate"},Za={key:1,class:"text-fluid-lg font-medium text-heading"},Ka={key:2,class:"flex items-center gap-1.5 shrink-0"},Xa={key:2,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},el={key:0,class:"text-sm text-sub truncate leading-normal mt-0.5"},tl={key:1,class:"text-fluid-sm text-sub"},sl={class:"flex items-center gap-2 shrink-0"},nl={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close"],setup(a){const V=a,o=S(()=>!V.task||!V.filteredTasks.length?!1:V.filteredTasks.findIndex(x=>{const g=V.task.compositeId||V.task.id;return(x.compositeId||x.id)===g})>0),m=S(()=>{if(!V.task||!V.filteredTasks.length)return!1;const c=V.filteredTasks.findIndex(x=>{const g=V.task.compositeId||V.task.id;return(x.compositeId||x.id)===g});return c>=0&&c<V.filteredTasks.length-1}),v=c=>c?c.type==="lead"?"Lead Qualification Task":c.type==="opportunity"?"Opportunity Management Task":"Task Details":"No task selected",d=c=>{var g;if(!c)return"";const x=[];if(c.vehicle||c.requestedCar){const b=c.vehicle||c.requestedCar;b.brand&&b.model?x.push(`${b.brand} ${b.model} (${b.year||"N/A"})`):b.model&&x.push(`${b.model} (${b.year||"N/A"})`)}return c.source&&x.push(c.source),(g=c.customer)!=null&&g.name?x.push(c.customer.name):c.customerName&&x.push(c.customerName),x.join(" • ")},y=c=>c?c.type==="opportunity"?w(c)||c.stage||c.currentStage||"New":c.stage||c.currentStage||c.displayStage||"New":"",f=c=>c?c.stage||c.currentStage||"New":"",w=c=>{if(!c||c.type!=="opportunity")return null;try{return ps(c,"opportunity")}catch{return c.displayStage||c.stage||null}},u=c=>{if(!c||c.type!=="opportunity")return!1;const x=f(c),g=w(c);return g&&x&&g!==x},h=c=>{if(!c)return"bg-gray-50 text-gray-700 border-gray-200";if(c.type==="opportunity"){const g=w(c)||f(c);return $(g,"opportunity")}const x=y(c).toLowerCase();return x.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":x.includes("qualif")?"bg-green-50 text-green-600 border-green-200":x.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":x.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"},$=(c,x="opportunity")=>{if(!c)return"bg-gray-50 text-gray-700 border-gray-200";try{const g=la(c,x);return g.includes("blue")?g+" border-blue-200":g.includes("purple")?g+" border-purple-200":g.includes("yellow")?g+" border-yellow-200":g.includes("pink")?g+" border-pink-200":g.includes("indigo")?g+" border-indigo-200":g.includes("emerald")?g+" border-emerald-200":g.includes("green")?g+" border-green-200":g.includes("red")?g+" border-red-200":(g.includes("gray"),g+" border-gray-200")}catch{const b=c.toLowerCase();return b.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":b.includes("qualif")?"bg-green-50 text-green-600 border-green-200":b.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":b.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}};return(c,x)=>(p(),C("div",Ya,[e("div",Ha,[e("div",Qa,[e("div",Ja,[a.task?(p(),C("h2",Ga,I(v(a.task)),1)):(p(),C("h2",Za," No task selected ")),a.task?(p(),C("div",Ka,[e("span",{class:J(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",a.task.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},I(a.task.type==="lead"?"Lead":"Opportunity"),3),a.task.type==="opportunity"&&u(a.task)?(p(),C(Le,{key:0},[e("span",{class:J(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",$(f(a.task),"opportunity")])},I(f(a.task)),3),e("span",{class:J(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",$(w(a.task),"opportunity")])},I(w(a.task)),3)],64)):(p(),C("span",{key:1,class:J(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",h(a.task)])},I(y(a.task)),3)),a.task.priority==="Hot"?(p(),C("span",Xa," Hot ")):L("",!0)])):L("",!0)]),a.task?(p(),C("p",el,I(d(a.task)),1)):(p(),C("p",tl," Select a task to view details "))]),e("div",sl,[s(t(Y),{variant:"secondary",size:"icon",onClick:x[0]||(x[0]=g=>c.$emit("previous")),disabled:!o.value},{default:r(()=>[s(t(Ea),{size:16,class:"text-body"})]),_:1},8,["disabled"]),s(t(Y),{variant:"secondary",size:"icon",onClick:x[1]||(x[1]=g=>c.$emit("next")),disabled:!m.value},{default:r(()=>[s(t(Ra),{size:16,class:"text-body"})]),_:1},8,["disabled"]),a.isDrawerView?(p(),me(t(Y),{key:0,variant:"secondary",size:"icon",onClick:x[2]||(x[2]=g=>c.$emit("close")),class:"ml-1"},{default:r(()=>[s(t(Fn),{size:16,class:"text-body"})]),_:1})):L("",!0)])])]))}},al=Wt(nl,[["__scopeId","data-v-9ce17f48"]]),ll=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:a=>["lead","opportunity"].includes(a)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(a){return(V,o)=>(p(),C("div",null,[a.managementWidget?(p(),me(wn(a.managementWidget),xn({key:0,lead:a.type==="lead"?a.task:void 0,opportunity:a.type==="opportunity"?a.task:void 0,activities:a.activities},V.$attrs),null,16,["lead","opportunity","activities"])):L("",!0)]))}}),ol=Wt(ll,[["__scopeId","data-v-f5db9491"]]),il={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},rl={key:0,class:"w-full h-20 rounded-btn overflow-hidden mb-4 bg-gray-100"},ul=["src","alt"],dl={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},cl={class:"space-y-2 mb-4"},ml={class:"flex justify-between items-start gap-2"},pl={class:"min-w-0 flex-1"},vl={class:"text-sm font-medium text-heading truncate"},fl={key:0,class:"text-sm text-sub"},yl={key:0,class:"text-sm font-semibold text-heading shrink-0"},gl={key:0,class:"flex gap-3 text-sm text-sub"},bl={key:0},hl={key:1},xl={key:2,class:"mb-4"},wl={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},kl={class:"text-sm text-heading"},Sl={class:"flex gap-2 pt-4 border-t border-black/5"},Cl={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(a){const V=a,o=A(!1),m=S(()=>{const f=[];return V.vehicle.brand&&f.push(V.vehicle.brand),V.vehicle.model&&f.push(V.vehicle.model),V.vehicle.variant&&f.push(V.vehicle.variant),f.join(" ")||"Vehicle Details"}),v=f=>{if(!f)return"0";const w=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)},d=f=>{if(!f)return"0";const w=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)},y=()=>{o.value=!0};return(f,w)=>(p(),C("div",il,[w[4]||(w[4]=e("h3",{class:"text-base font-medium mb-4 text-heading -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),a.imageUrl?(p(),C("div",rl,[e("img",{src:a.imageUrl,alt:`${a.vehicle.brand} ${a.vehicle.model}`,class:"w-full h-full object-cover",onError:y},null,40,ul)])):(p(),C("div",dl,[s(t(_a),{size:48,class:"text-gray-400"})])),e("div",cl,[e("div",ml,[e("div",pl,[e("p",vl,I(m.value),1),a.vehicle.year?(p(),C("p",fl,I(a.vehicle.year),1)):L("",!0)]),a.vehicle.price?(p(),C("p",yl," €"+I(v(a.vehicle.price)),1)):L("",!0)]),a.vehicle.mileage||a.vehicle.fuelType?(p(),C("div",gl,[a.vehicle.mileage?(p(),C("span",bl,I(d(a.vehicle.mileage))+" km",1)):L("",!0),a.vehicle.fuelType?(p(),C("span",hl,I(a.vehicle.fuelType),1)):L("",!0)])):L("",!0)]),a.source?(p(),C("div",xl,[s(t(sa),{variant:"secondary",class:"text-sm"},{default:r(()=>[T(I(a.source),1)]),_:1})])):L("",!0),a.requestMessage?(p(),C("div",wl,[w[2]||(w[2]=e("p",{class:"text-sm text-sub mb-1"},"Request message",-1)),e("p",kl,I(a.requestMessage),1)])):L("",!0),e("div",Sl,[s(t(Y),{variant:"secondary",size:"sm",class:"flex-1",onClick:w[0]||(w[0]=u=>f.$emit("open-ad"))},{default:r(()=>[s(t(ua),{size:16}),w[3]||(w[3]=e("span",null,"Open Ad",-1))]),_:1}),s(t(Y),{variant:"secondary",size:"icon-sm",onClick:w[1]||(w[1]=u=>f.$emit("more-actions"))},{default:r(()=>[s(t(ja),{size:16})]),_:1})])]))}},$l={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},Dl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},Al={class:"flex flex-1 overflow-hidden"},Tl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},Ol={class:"flex-1 overflow-y-auto"},Il={class:"p-2"},Nl={class:"right-sidebar flex flex-col overflow-hidden shrink-0 border-l border-black/5 bg-surface"},Vl={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},Ml={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},ql={class:"flex-1 overflow-y-auto bg-[#F8F8F8]"},Ll={key:1,class:"flex-1 flex items-center justify-center bg-surface"},Fl={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close"],setup(a,{emit:V}){const o=a,m=V,v=Pt(),d=Ft(),y=A("request"),f=A({}),w=A(!1),u=A(!1),h=A(!1),$=A(!1),c=A(!1),x=A(!1),g=A(!1),b=A(!1),N=A(!1),k=A(!1),E=S(()=>{var P;return((P=o.storeAdapter.currentActivities)==null?void 0:P.value)||[]}),F=S(()=>E.value.length),U=S(()=>{var De;if(!((De=o.task)!=null&&De.customer))return 0;const P=o.task.customer.email,ee=o.task.customer.phone,Be=o.task.compositeId||`${o.task.type}-${o.task.id}`;return[...(v.leads||[]).map(Te=>({...Te,type:"lead",compositeId:`lead-${Te.id}`})),...(d.opportunities||[]).map(Te=>({...Te,type:"opportunity",compositeId:`opportunity-${Te.id}`}))].filter(Te=>Te.compositeId===Be||!Te.customer?!1:Te.customer.email===P||Te.customer.phone===ee).length}),ye=()=>{m("task-navigate","previous")},fe=()=>{m("task-navigate","next")},q=P=>{y.value!=="activity"&&(y.value="activity"),console.log("Activity clicked:",P)},D=P=>{f.value[P]=!f.value[P]},M=P=>P&&(P.image||P.imageUrl)||"",j=()=>{console.log("Open ad clicked")},H=()=>{console.log("More actions clicked")},le=P=>{console.log("Contact action:",P)},Q=P=>{P==="note"?w.value=!0:P==="attachment"?u.value=!0:P==="whatsapp"?h.value=!0:P==="sms"?$.value=!0:P==="email"?c.value=!0:P==="call"?x.value=!0:P==="financing"?g.value=!0:P==="tradein"?b.value=!0:P==="purchase"?N.value=!0:P==="appointment"&&(k.value=!0)},xe=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"note",content:P.content||P.message,message:P.content||P.message,timestamp:new Date().toISOString()}),w.value=!1}catch(ee){console.error("Error saving note:",ee)}},Me=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"attachment",fileName:P.fileName,file:P.file,content:`Attachment: ${P.fileName}`,timestamp:new Date().toISOString()}),u.value=!1}catch(ee){console.error("Error saving attachment:",ee)}},pe=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"whatsapp",message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),h.value=!1}catch(ee){console.error("Error saving WhatsApp:",ee)}},te=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"sms",message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),$.value=!1}catch(ee){console.error("Error saving SMS:",ee)}},K=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"email",subject:P.subject,message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),c.value=!1}catch(ee){console.error("Error saving email:",ee)}},re=async P=>{var ee;try{await o.storeAdapter.addActivity(o.task.id,{type:"financing",action:P.action||"added a financing proposal",content:P.content||`Financing: ${((ee=P.data)==null?void 0:ee.product)||"Unknown"}`,data:P.data,timestamp:new Date().toISOString()}),g.value=!1}catch(Be){console.error("Error saving financing:",Be)}},we=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"tradein",action:"added a trade-in",content:P.content||"Trade-in vehicle added",data:P.data,timestamp:new Date().toISOString()}),b.value=!1}catch(ee){console.error("Error saving trade-in:",ee)}},Ie=async P=>{var ee;try{await o.storeAdapter.addActivity(o.task.id,{type:"offer",action:P.action||"created an offer",content:P.content||`Offer: €${((ee=P.data)==null?void 0:ee.price)||0}`,data:P.data,timestamp:new Date().toISOString()}),N.value=!1}catch(Be){console.error("Error saving offer:",Be)}},et=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"appointment",action:"scheduled an appointment",content:`Appointment: ${P.type||"Meeting"} on ${P.date||""}`,data:P,timestamp:new Date().toISOString()}),k.value=!1}catch(ee){console.error("Error saving appointment:",ee)}};return(P,ee)=>{var Be,Re,We,De,Te,R,B,oe,X,W,se,ie,ke;return p(),C("div",$l,[a.task?(p(),C("div",Dl,[s(al,{task:a.task,"filtered-tasks":a.filteredTasks,"is-drawer-view":a.isDrawerView,onPrevious:ye,onNext:fe,onClose:ee[0]||(ee[0]=de=>P.$emit("close"))},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",Al,[e("div",Tl,[e("div",Ol,[e("div",Il,[s(ol,xn({task:a.task,type:a.task.type,"management-widget":a.managementWidget,activities:E.value},P.$attrs),null,16,["task","type","management-widget","activities"])])])]),e("div",Nl,[s(t(aa),{modelValue:y.value,"onUpdate:modelValue":ee[1]||(ee[1]=de=>y.value=de),class:"flex flex-col flex-1 overflow-hidden"},{default:r(()=>[s(t(na),{class:"flex border-b border-black/5 bg-white rounded-none w-full relative h-full"},{default:r(()=>[s(t(Tn),{value:"request",class:J(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",y.value==="request"?"text-heading":"text-sub hover:text-body"])},{default:r(()=>[ee[12]||(ee[12]=e("span",null,"Request",-1)),U.value>0?(p(),C("span",{key:0,class:J(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",y.value==="request"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},I(U.value),3)):L("",!0),y.value==="request"?(p(),C("span",Vl)):L("",!0)]),_:1},8,["class"]),s(t(Tn),{value:"activity",class:J(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",y.value==="activity"?"text-heading":"text-sub hover:text-body"])},{default:r(()=>[ee[13]||(ee[13]=e("span",null,"Activity",-1)),F.value>0?(p(),C("span",{key:0,class:J(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",y.value==="activity"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},I(F.value),3)):L("",!0),y.value==="activity"?(p(),C("span",Ml)):L("",!0)]),_:1},8,["class"])]),_:1}),e("div",ql,[s(t(On),{value:"request",class:"space-y-2 p-2 mt-0"},{default:r(()=>{var de,Fe;return[s(da,{task:a.task,"task-type":a.task.type,"customer-id":a.task.customerId||((de=a.task.customer)==null?void 0:de.id),onAction:le},null,8,["task","task-type","customer-id"]),a.task.requestedCar||a.task.vehicle?(p(),me(Cl,{key:0,vehicle:a.task.requestedCar||a.task.vehicle,"request-message":a.task.requestMessage||((Fe=a.task.requestedCar)==null?void 0:Fe.requestMessage),source:a.task.source,"image-url":M(a.task.requestedCar||a.task.vehicle),onOpenAd:j,onMoreActions:H},null,8,["vehicle","request-message","source","image-url"])):L("",!0)]}),_:1}),s(t(On),{value:"activity",class:"p-2 flex-1 overflow-hidden h-full flex flex-col mt-0"},{default:r(()=>[s(ca,{activities:E.value,"expanded-summaries":f.value,onActivityClick:q,onToggleSummaryExpanded:D,onAddActivity:Q},null,8,["activities","expanded-summaries"])]),_:1})])]),_:1},8,["modelValue"])])])])):(p(),C("div",Ll,[...ee[14]||(ee[14]=[Un('<div class="text-center max-w-sm p-8" data-v-808d9e5c><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-808d9e5c><i class="fa-solid fa-tasks text-2xl text-sub" data-v-808d9e5c></i></div><h3 class="text-fluid-lg font-bold text-heading mb-2" data-v-808d9e5c>No task selected</h3><p class="text-fluid-sm text-sub" data-v-808d9e5c>Select a task from the list to view its details and manage activities</p></div>',1)])])),s(Rn,{modal:"",show:w.value,"task-type":((Be=a.task)==null?void 0:Be.type)||"lead","task-id":(Re=a.task)==null?void 0:Re.id,onSave:xe,onClose:ee[2]||(ee[2]=de=>w.value=!1)},null,8,["show","task-type","task-id"]),s(ma,{modal:"",show:u.value,"task-type":((We=a.task)==null?void 0:We.type)||"lead","task-id":(De=a.task)==null?void 0:De.id,onSave:Me,onClose:ee[3]||(ee[3]=de=>u.value=!1)},null,8,["show","task-type","task-id"]),s(pa,{show:h.value,onSave:pe,onClose:ee[4]||(ee[4]=de=>h.value=!1)},null,8,["show"]),s(va,{show:$.value,onSave:te,onClose:ee[5]||(ee[5]=de=>$.value=!1)},null,8,["show"]),s(fa,{show:c.value,onSave:K,onClose:ee[6]||(ee[6]=de=>c.value=!1)},null,8,["show"]),s(Cn,{show:x.value,title:"Call Feature",onClose:ee[7]||(ee[7]=de=>x.value=!1)},null,8,["show"]),s(jn,{show:g.value,"task-type":((Te=a.task)==null?void 0:Te.type)||"lead","task-id":(R=a.task)==null?void 0:R.id,onSave:re,onClose:ee[8]||(ee[8]=de=>g.value=!1)},null,8,["show","task-type","task-id"]),s(Bn,{show:b.value,mode:"tradein","task-type":((B=a.task)==null?void 0:B.type)||"lead","task-id":(oe=a.task)==null?void 0:oe.id,onSave:we,onClose:ee[9]||(ee[9]=de=>b.value=!1)},null,8,["show","task-type","task-id"]),s(ya,{show:N.value,"task-type":((X=a.task)==null?void 0:X.type)||"lead","task-id":(W=a.task)==null?void 0:W.id,customer:(se=a.task)==null?void 0:se.customer,onSave:Ie,onClose:ee[10]||(ee[10]=de=>N.value=!1)},null,8,["show","task-type","task-id","customer"]),s(Wn,{show:k.value,customer:(ie=a.task)==null?void 0:ie.customer,assignee:(ke=a.task)==null?void 0:ke.assignee,onCreate:et,onCancel:ee[11]||(ee[11]=de=>k.value=!1)},null,8,["show","customer","assignee"])])}}},Hp=Wt(Fl,[["__scopeId","data-v-808d9e5c"]]),Ul={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},_l={__name:"DrawerContainer",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(a,{emit:V}){const o=V,m=()=>{o("close")};return(v,d)=>(p(),C(Le,null,[s(pt,{name:"fade"},{default:r(()=>[a.show?(p(),C("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:m})):L("",!0)]),_:1}),s(pt,{name:"slide-right"},{default:r(()=>[a.show?(p(),C("div",Ul,[xt(v.$slots,"default",{},void 0,!0)])):L("",!0)]),_:3})],64))}},Qp=Wt(_l,[["__scopeId","data-v-6c60a3d5"]]);function zn(a,V={}){const o=kn(),m=S(()=>{const N=typeof a=="function"?a():_s(a);return{lead:N,displayStage:N?ps(N,"lead"):null}}),v=S(()=>m.value.displayStage||"New"),d=S(()=>{const N=m.value;return ga(N)}),y=S(()=>{const N=m.value,k=ba(N);if(!k)return null;const E=V[k.key];return{...k,handler:E||(()=>{})}}),f=S(()=>{const N=m.value;return ha(N).map(E=>{const F=V[E.key];return{...E,handler:F||(()=>{})}})}),w=S(()=>{const N=m.value;return xa(N)}),u=S(()=>{const N=m.value;return wa(N)}),h=S(()=>{const N=m.value;return ka(N)}),$=S(()=>{const N=m.value;return Sa(N)}),c=S(()=>{const k=m.value.lead;return((k==null?void 0:k.contactAttempts)||[]).length||0}),x=S(()=>o.getSetting("maxContactAttempts")),g=S(()=>c.value+1>=x.value),b=S(()=>!0);return{displayStage:v,isClosed:d,primaryAction:y,secondaryActions:f,showLQWidget:w,showDeadlineBanner:u,canPostpone:h,canReassign:b,lqWidgetMode:$,contactAttempts:c,maxContactAttempts:x,shouldShowAutoDisqualifyWarning:g}}function El({getLead:a,leadState:V,emit:o}){const m=_n(),v=Pt(),d=Tt();async function y(k){var F;const E=a();if(E&&V.canPostpone.value)try{const U=new Date(`${k.date}T${k.time}:00`),ye=U.toISOString(),fe={nextActionDue:ye};if((k.assigneeId||k.teamId)&&(fe.assignee=k.assignee||null,fe.assigneeId=k.assigneeId||null,fe.assigneeType=k.assigneeType||"user",fe.teamId=k.teamId||null,fe.team=k.team||null),await v.updateLead(E.id,fe),k.createAppointment){const q=new Date(U);q.setHours(q.getHours()+1),await v.updateLead(E.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${E.customer.name}`,start:ye,end:q.toISOString(),type:"Call",assignee:k.assignee||E.assignee,assigneeId:k.assigneeId||E.assigneeId,assigneeType:k.assigneeType||E.assigneeType||"user",teamId:k.teamId||E.teamId,team:k.team||E.team,status:"scheduled"}}),await v.addActivity(E.id,{type:"appointment",user:((F=d.currentUser)==null?void 0:F.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Rt(U)} at ${ms(U)}`,data:{type:"Call",date:k.date,time:k.time,assignee:k.assignee||E.assignee}})}await v.addActivity(E.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Rt(U)} at ${ms(U)}${k.assignee?` and reassigned to ${k.assignee}`:""}`}),await v.fetchLeadById(E.id)}catch(U){console.error("Failed to postpone lead task:",U)}}async function f(k){const E=a();if(E)try{if(await v.updateLead(E.id,{stage:"Validated"}),await v.addActivity(E.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),k.scheduleFollowUp&&k.appointmentData){const F=new Date(`${k.appointmentData.date}T${k.appointmentData.time}:00`);await v.scheduleFollowUp(E.id,{dateTime:F.toISOString(),assignee:k.appointmentData.assignee||E.assignee,assigneeId:k.appointmentData.assigneeId||null,assigneeType:k.appointmentData.assigneeType||"user",teamId:k.appointmentData.teamId||null,team:k.appointmentData.team||null}),await v.addActivity(E.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Rt(F)} at ${ms(F)}`})}await v.fetchLeadById(E.id)}catch(F){console.error("Failed to validate lead:",F)}}async function w(k){var F,U,ye;const E=a();if(E)try{if((F=k==null?void 0:k.assignment)!=null&&F.assignee){const q=k.assignment.assignee,D={assignee:q.name||q.label||null,assigneeId:q.id||null,assigneeType:q.type||"user"};q.type==="team"&&(D.teamId=q.id||null,D.team=q.name||null),k.assignment.salesperson&&(D.assignee=k.assignment.salesperson.name||k.assignment.salesperson,D.assigneeId=k.assignment.salesperson.id||null,D.assigneeType="user",D.teamId=q.id||null,D.team=q.name||null),await v.updateLead(E.id,D);const M=((U=k.assignment.salesperson)==null?void 0:U.name)||q.name||"Unassigned";await v.addActivity(E.id,{type:"note",user:((ye=d.currentUser)==null?void 0:ye.name)||"You",action:"assigned lead",content:`Lead assigned to ${M}${k.assignment.salesperson&&q.name?` (${q.name} team)`:""}`,timestamp:new Date().toISOString()})}const fe=await v.convertLeadToOpportunity(E.id);d.canAccessOpportunities()?m.push({path:`/tasks/${fe}`,query:{type:"opportunity"}}):m.push("/tasks")}catch(fe){console.error("Failed to qualify lead:",fe)}}async function u(k){const E=a();if(E)try{const F=E.contactAttempts||[];await v.updateLead(E.id,{contactAttempts:[...F,k],lastContactAttempt:k.timestamp,totalContactAttempts:F.length+1}),await v.addActivity(E.id,{type:"call",user:"You",action:`logged call attempt - ${k.outcome}`,content:k.notes||`Call attempt via ${k.channel}`,data:{outcome:k.outcome,channel:k.channel,duration:k.duration}}),await v.fetchLeadById(E.id)}catch(F){console.error("Failed to log call attempt:",F)}}async function h(k){const E=a();if(E)try{await v.addActivity(E.id,{type:"note",user:"You",action:"added a note",content:k.content||k.text||"",data:k}),await v.fetchLeadById(E.id)}catch(F){console.error("Failed to save note:",F)}}function $(){o("open-purchase-method")}function c(){o("open-trade-in")}async function x(k){var F;const E=a();if(E)try{const U=k.datetime?new Date(k.datetime).toISOString().split("T")[0]+"T"+k.time+":00":`${k.date}T${k.time}:00`,ye=new Date(U),fe=k.duration||60;ye.setMinutes(ye.getMinutes()+fe);const q={scheduledAppointment:{id:Date.now(),title:`${k.type} - ${E.customer.name}`,start:U,end:ye.toISOString(),type:k.type,assignee:k.assignee,assigneeId:k.assigneeId||k.salespersonId||k.teamId,assigneeType:k.assigneeType||(k.salespersonId?"user":"team"),teamId:k.teamId||null,team:k.team||null,salesperson:k.salesperson||null,salespersonId:k.salespersonId||null,status:"scheduled",location:k.location||"",notes:k.notes||""}};(k.assigneeId||k.salespersonId||k.teamId)&&(q.assignee=k.assignee||k.salesperson||k.team,q.assigneeId=k.assigneeId||k.salespersonId||k.teamId,q.assigneeType=k.assigneeType||(k.salespersonId?"user":"team"),k.teamId&&(q.teamId=k.teamId,q.team=k.team)),await v.updateLead(E.id,q),await v.addActivity(E.id,{type:"appointment",user:((F=d.currentUser)==null?void 0:F.name)||"You",action:"scheduled an appointment",content:`${k.type} scheduled for ${Rt(new Date(U))} at ${k.time}`,data:{type:k.type,date:k.date||Rt(new Date(U)),time:k.time,assignee:k.assignee,assigneeId:k.assigneeId,team:k.team,salesperson:k.salesperson}}),await v.fetchLeadById(E.id)}catch(U){console.error("Failed to schedule appointment:",U)}}async function g(k){const E=a();if(E&&!(V.isClosed.value&&!k.force))try{const F=V.displayStage.value,U=k.reason==="Duplicate"?Fs.CLOSED_DUPLICATE:k.category==="Not Interested"?Fs.CLOSED_NOT_INTERESTED:Fs.CLOSED_INVALID,ye=Nn(F,U);if(ye){const{updates:fe,activities:q}=ye(E,U,k);await v.updateLead(E.id,fe);for(const D of q)await v.addActivity(E.id,D)}else{const fe=k.reason==="Duplicate";await v.updateLead(E.id,{isDisqualified:!0,disqualifyReason:k.reason,isDuplicate:fe,stage:fe?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await v.addActivity(E.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${k.category}, Reason: ${k.reason}`})}m.push("/tasks")}catch(F){console.error("Failed to disqualify lead:",F)}}async function b(){const k=a();if(k)try{const E=V.displayStage.value,F=Fs.NEW,U=Nn(E,F);if(U){const{updates:ye,activities:fe}=U(k);await v.updateLead(k.id,ye);for(const q of fe)await v.addActivity(k.id,q)}else await v.updateLead(k.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await v.addActivity(k.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await v.fetchLeadById(k.id)}catch(E){console.error("Failed to reopen lead:",E)}}function N(){const k=a();k&&k.opportunityId&&m.push({path:`/tasks/${k.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:y,handleValidated:f,handleQualified:w,handleCallAttemptLogged:u,handleNoteSaved:h,handleOpenPurchaseMethod:$,handleOpenTradeIn:c,handleAppointmentScheduled:x,handleDisqualified:g,handleReopen:b,viewOpportunity:N}}const Rl={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},jl={class:"space-y-6"},Yn={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(a){return(V,o)=>a.task?(p(),C("div",{key:0,class:J(["rounded-lg flex flex-col",a.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[a.hideTitle?L("",!0):(p(),C("div",Rl,[...o[0]||(o[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:J(["bg-white rounded-lg p-2 flex flex-col",a.hideBorder?"shadow-none":"shadow-sm"]),style:Je(a.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[xt(V.$slots,"deadline-banner"),e("div",jl,[xt(V.$slots,"primary-action"),xt(V.$slots,"task-widgets"),xt(V.$slots,"closed-state"),xt(V.$slots,"secondary-actions")])],6)],2)):L("",!0)}},Bl={class:"flex justify-between items-start mb-3"},Wl={class:"font-bold text-gray-900 text-fluid-sm"},Pl={class:"text-fluid-xs text-gray-500 mt-0.5"},zl={class:"flex gap-3 flex-wrap"},Hn={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(a){return(V,o)=>(p(),C("div",{class:J(["rounded-card p-4 relative transition-all duration-300 border",[a.colorScheme.background,a.colorScheme.border]])},[e("div",Bl,[e("div",null,[e("h4",Wl,I(a.action.title),1),e("p",Pl,I(a.action.description),1)])]),e("div",zl,[e("button",{onClick:o[0]||(o[0]=m=>V.$emit("action-clicked")),class:J([a.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:J(a.action.icon)},null,2),T(" "+I(a.action.label),1)],2)])],2))}},Yl={class:"rounded-lg",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Hl={class:"bg-white rounded-lg px-3 py-2 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ql={key:0,class:"flex items-center justify-between gap-2"},Jl={class:"flex items-center gap-2 min-w-0 flex-1"},Gl={class:"min-w-0 flex-1"},Zl={class:"text-sm font-semibold text-greys-900 truncate leading-tight"},Kl={class:"font-normal text-greys-500"},Xl={class:"text-xs text-greys-500 truncate leading-tight"},eo={key:1,class:"space-y-2"},to={class:"flex items-center justify-between gap-2 flex-wrap"},so={class:"flex items-center gap-1.5 shrink-0"},no={key:0,class:"flex gap-1.5 flex-wrap"},ao=["onClick"],lo={__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"}},emits:["reassigned"],setup(a,{emit:V}){const o=a,m=V,v=Ut(),d=Tt(),y=Pt(),f=Ft(),w=A(!1),u=A(null),h=S(()=>d.currentUser),$=S(()=>!!(o.task.assignee||o.task.owner||o.task.assignedTo)),c=S(()=>{var ye;const F=o.task.assignee||o.task.owner||o.task.assignedTo||"Unassigned",U=(ye=v.allUsers)==null?void 0:ye.find(fe=>fe.name===F);return{name:F,team:(U==null?void 0:U.team)||o.task.assigneeTeam||o.task.team||"No team",dealership:(U==null?void 0:U.dealership)||o.task.assigneeDealership||"MotorK Dealership",role:(U==null?void 0:U.role)||o.task.assigneeRole||"salesman"}});S(()=>!h.value||!$.value?!1:c.value.name===h.value.name);const x=S(()=>(v.assignableTeams||[]).slice(0,3)),g=F=>!F||F==="Unassigned"?"?":F.split(" ").map(U=>U[0]).join("").toUpperCase().substring(0,2),b=F=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[F]||"bg-surfaceSecondary text-body",N=async()=>{if(h.value)try{o.taskType==="lead"?await y.updateLead(o.task.id,{assignee:h.value.name,assigneeType:"user",assigneeTeam:h.value.team,assigneeDealership:h.value.dealership,assigneeRole:h.value.role}):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,{assignee:h.value.name,assigneeType:"user",assigneeTeam:h.value.team,assigneeDealership:h.value.dealership,assigneeRole:h.value.role}),m("reassigned",h.value)}catch(F){console.error("Error assigning to self:",F)}},k=async F=>{u.value=F;try{o.taskType==="lead"?await y.updateLead(o.task.id,{assignee:F.name,assigneeType:"team",teamId:F.id,assigneeTeam:F.name}):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,{assignee:F.name,assigneeType:"team",teamId:F.id,assigneeTeam:F.name}),m("reassigned",F)}catch(U){console.error("Error assigning to team:",U)}},E=async F=>{try{const U={assignee:F.name,assigneeType:F.type,assigneeTeam:F.team,assigneeDealership:F.dealership,assigneeRole:F.role};F.type==="team"&&(U.teamId=F.id),o.taskType==="lead"?await y.updateLead(o.task.id,U):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,U),w.value=!1,m("reassigned",F)}catch(U){console.error("Error reassigning:",U)}};return(F,U)=>(p(),C(Le,null,[e("div",Yl,[e("div",Hl,[$.value?(p(),C("div",Ql,[e("div",Jl,[e("div",{class:J(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",b(c.value.role)])},I(g(c.value.name)),3),e("div",Gl,[e("p",Zl,[T(I(c.value.name)+" ",1),e("span",Kl,"• "+I(c.value.team),1)]),e("p",Xl,I(c.value.dealership),1)])]),s(t(Y),{variant:"ghost",size:"sm",onClick:U[0]||(U[0]=ye=>w.value=!0),class:"shrink-0 text-xs px-2 py-1"},{default:r(()=>[...U[3]||(U[3]=[T(" Change ",-1)])]),_:1})])):(p(),C("div",eo,[e("div",to,[U[6]||(U[6]=e("p",{class:"text-sm text-greys-500 font-medium"},"Unassigned",-1)),e("div",so,[s(t(Y),{variant:"primary",size:"sm",onClick:N,class:"!bg-brand-red text-sm px-3 py-1"},{default:r(()=>[...U[4]||(U[4]=[T(" Assign to me ",-1)])]),_:1}),s(t(Y),{variant:"outline",size:"sm",onClick:U[1]||(U[1]=ye=>w.value=!0),class:"text-sm px-3 py-1 border-D1D5DB"},{default:r(()=>[...U[5]||(U[5]=[T(" Assign to someone ",-1)])]),_:1})])]),x.value.length>0?(p(),C("div",no,[(p(!0),C(Le,null,ze(x.value,ye=>{var fe;return p(),C("button",{key:ye.id,class:J(["inline-flex items-center gap-1 px-2 py-0.5 rounded-md border text-xs font-medium transition-all",((fe=u.value)==null?void 0:fe.id)===ye.id?"border-brand-blue bg-blue-50 text-brand-blue":"border-E5E7EB hover:border-brand-blue/30 text-greys-600"]),onClick:q=>k(ye)},[U[7]||(U[7]=e("i",{class:"fa-solid fa-users text-xs"},null,-1)),T(" "+I(ye.name),1)],10,ao)}),128))])):L("",!0)]))])]),s(Pn,{show:w.value,title:$.value?"Reassign task":"Assign task","confirm-label":$.value?"Reassign":"Assign",onClose:U[2]||(U[2]=ye=>w.value=!1),onConfirm:E},null,8,["show","title","confirm-label"])],64))}},Qn=Wt(lo,[["__scopeId","data-v-8fbba5aa"]]),Bt=(a,V)=>{if(!a||!V)return[];const o=new Date(V).getDay();if(o===0||o===6)return[];const[v,d]=a.split("-"),y=parseInt(d);return v==="team"?io(y,V):v==="user"?oo(y,V,o):[]},oo=(a,V,o)=>{const m={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(m[a]||m[1])[o]||[]},io=(a,V)=>{const o=new Date(V).getDay(),m=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return a===1?o===1||o===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:a===2?m.filter((v,d)=>d%2===0):m},ro={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},uo={class:"space-y-3"},co={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mo={class:"font-semibold text-heading text-sm mb-4"},po={class:"mb-4"},vo={class:"mb-4"},fo={class:"flex gap-2"},yo={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={class:"flex items-center justify-between mb-4"},ho={class:"text-sm font-semibold text-heading"},xo={class:"grid grid-cols-7 gap-1 mb-2"},wo={class:"grid grid-cols-7 gap-1"},ko=["onClick"],So={class:"text-sm font-semibold text-heading mb-4"},Co={key:0,class:"space-y-2"},$o=["onClick"],Do={key:1,class:"text-sm text-sub py-4 text-center"},Ao={key:2,class:"text-sm text-sub py-4 text-center"},To={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(a,{emit:V}){const{t:o}=Sn(),m=a,v=V,d=Tt(),y=Ut(),f=A("assign-and-schedule"),w=A(""),u=A(null),h=A(""),$=A(""),c=A("30min"),x=A(new Date().getMonth()),g=A(new Date().getFullYear()),b=A(null);S(()=>y.assignableUsers),S(()=>y.assignableTeams);const N=S(()=>new Date(g.value,x.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),k=S(()=>{const pe=new Date(g.value,x.value,1),K=new Date(g.value,x.value+1,0).getDate(),re=pe.getDay()===0?6:pe.getDay()-1,we=[];for(let Ie=0;Ie<re;Ie++)we.push(null);for(let Ie=1;Ie<=K;Ie++)we.push(Ie);return we}),E=S(()=>[{value:"Showroom Visit",label:o("forms.schedule.eventType.options.showroomVisit")},{value:"Test Drive",label:o("forms.schedule.eventType.options.testDrive")},{value:"Video Call",label:o("forms.schedule.eventType.options.videoCall")},{value:"Home Visit",label:o("forms.schedule.eventType.options.homeVisit")},{value:"Closing Meeting",label:o("forms.schedule.eventType.options.closingMeeting")}]),F=["MON","TUE","WED","THU","FRI","SAT","SUN"],U=S(()=>{if(!b.value||!h.value)return o("forms.schedule.timeSlots.selectDate");const pe=new Date(h.value),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${te[pe.getDay()]}, ${K[pe.getMonth()]} ${pe.getDate()}`}),ye=pe=>{if(!pe||!h.value)return!1;const te=new Date(h.value);return te.getDate()===pe&&te.getMonth()===x.value&&te.getFullYear()===g.value},fe=pe=>{if(!pe)return;const te=new Date(g.value,x.value,pe);h.value=te.toISOString().split("T")[0],b.value=pe,$.value=""},q=()=>{x.value===0?(x.value=11,g.value--):x.value--},D=()=>{x.value===11?(x.value=0,g.value++):x.value++},M=S(()=>!h.value||!u.value?[]:Bt(u.value,h.value)),j=()=>{var pe;if(m.preselectedAssignee){const{type:te,id:K}=m.preselectedAssignee;u.value=`${te}-${K}`}else u.value=`user-${((pe=d.currentUser)==null?void 0:pe.id)||1}`};j();const H=S(()=>f.value==="assign-only"?!0:!!(w.value&&h.value&&$.value&&u.value));$e(()=>m.show,pe=>{pe?j():le()}),$e(h,()=>{$.value=""});const le=()=>{f.value="assign-and-schedule",w.value="",h.value="",$.value="",c.value="30min",b.value=null;const pe=new Date;x.value=pe.getMonth(),g.value=pe.getFullYear()},Q=pe=>{pe||v("close")},xe=()=>{if(!H.value)return;const pe=u.value.startsWith("team-"),te=parseInt(u.value.split("-")[1]);let K={};if(pe){const we=y.getTeamById(te);K={assigneeType:"team",teamId:te,team:(we==null?void 0:we.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const we=y.getUserById(te);K={assigneeType:"user",assigneeId:te,assignee:(we==null?void 0:we.name)||"Unknown",teamId:null,team:null}}const re={...K};f.value==="assign-and-schedule"&&(re.type=w.value,re.date=h.value,re.time=$.value,re.duration=c.value),v("confirm",re),v("close")},Me=()=>{v("close")};return(pe,te)=>(p(),me(t(ws),{open:a.show,"onUpdate:open":Q},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-4xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),{class:"text-fluid-lg"},{default:r(()=>[...te[6]||(te[6]=[T("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",ro,[e("div",uo,[e("label",{class:J(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",f.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Ge(e("input",{type:"radio","onUpdate:modelValue":te[0]||(te[0]=K=>f.value=K),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[vt,f.value]]),te[7]||(te[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:J(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",f.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Ge(e("input",{type:"radio","onUpdate:modelValue":te[1]||(te[1]=K=>f.value=K),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[vt,f.value]]),te[8]||(te[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),f.value==="assign-and-schedule"?(p(),C("div",co,[e("h5",mo,I(t(o)("forms.schedule.title")),1),e("div",po,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[T(I(t(o)("forms.schedule.eventType.label")),1)]),_:1}),s(t(Ze),{modelValue:w.value,"onUpdate:modelValue":te[2]||(te[2]=K=>w.value=K),items:E.value,placeholder:t(o)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:r(({item:K})=>[e("span",null,I(K.label),1)]),_:1},8,["modelValue","items","placeholder"])]),e("div",vo,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[T(I(t(o)("forms.schedule.duration.label")),1)]),_:1}),e("div",fo,[e("button",{onClick:te[3]||(te[3]=K=>c.value="30min"),class:J(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="30min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.30min")),3),e("button",{onClick:te[4]||(te[4]=K=>c.value="60min"),class:J(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="60min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.60min")),3),e("button",{onClick:te[5]||(te[5]=K=>c.value="custom"),class:J(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",c.value==="custom"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.custom")),3)])]),e("div",yo,[e("div",go,[e("div",null,[e("div",bo,[e("button",{onClick:q,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[9]||(te[9]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",ho,I(N.value),1),e("button",{onClick:D,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[10]||(te[10]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",xo,[(p(),C(Le,null,ze(F,K=>e("div",{key:K,class:"text-center text-xs font-medium text-sub py-2"},I(K),1)),64))]),e("div",wo,[(p(!0),C(Le,null,ze(k.value,(K,re)=>(p(),C("div",{key:re,onClick:we=>fe(K),class:J(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg cursor-pointer transition-all",ye(K)?"bg-[#0470e9] text-white":K?"text-body hover:bg-surfaceSecondary":"text-transparent"])},I(K),11,ko))),128))])]),e("div",null,[e("h6",So,I(U.value),1),h.value&&M.value.length>0?(p(),C("div",Co,[(p(!0),C(Le,null,ze(M.value,K=>(p(),C("button",{key:K,onClick:re=>$.value=K,class:J(["w-full py-2 px-4 bg-white border border-black/5 rounded-lg shadow-sm text-sm font-medium text-center transition-all",$.value===K?"border-[#0470e9] bg-surfaceSecondary text-heading":"text-body hover:border-[#0470e9]/30"])},I(K),11,$o))),128))])):h.value&&M.value.length===0?(p(),C("div",Do,I(t(o)("forms.schedule.timeSlots.noSlots")),1)):(p(),C("div",Ao,I(t(o)("forms.schedule.timeSlots.selectDate")),1))])])])])):L("",!0)]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:r(()=>[s(t(In),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:Me}),s(t(In),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!H.value,onClick:xe},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Jn(){const a=oa(),V=A(!1),o=A(!1),m=A(0),v=A(""),d=A(null),y=A({}),f=A(null),w={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},u=S(()=>{const b=Math.floor(m.value/60),N=m.value%60;return`${b.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`}),h=()=>{V.value=!0,m.value=0,o.value=!1,v.value="",d.value=setInterval(()=>{m.value++,m.value>=20&&$()},1e3)},$=()=>{d.value&&(clearInterval(d.value),d.value=null),V.value=!1,o.value=!0,y.value={duration:m.value,notes:v.value,transcription:w,channel:"phone"}},c=async b=>{try{await navigator.clipboard.writeText(b),a.pushToast("success","Phone number copied to clipboard!")}catch{a.pushToast("error","Failed to copy phone number")}},x=b=>(f.value={tradeIn:w.leadLines.some(N=>N.toLowerCase().includes("trade")||N.toLowerCase().includes("exchange"))||!1,financing:w.leadLines.some(N=>N.toLowerCase().includes("financ")||N.toLowerCase().includes("payment")||N.toLowerCase().includes("loan"))||!1},f.value.tradeIn&&b&&(b.value.tradeIn=!0),f.value.financing&&b&&(b.value.financing=!0),f.value),g=()=>{V.value=!1,o.value=!1,m.value=0,v.value="",y.value={},d.value&&(clearInterval(d.value),d.value=null)};return ia(()=>{d.value&&clearInterval(d.value)}),{isCallActive:V,callEnded:o,callDuration:m,callNotes:v,callData:y,extractedData:f,mockTranscription:w,formattedCallDuration:u,startCall:h,endCall:$,copyNumber:c,extractInformation:x,resetCall:g}}function Oo(a,V,o,m,v,d){var Ne,Ye,st;const y=A(!0),f=A(null),w=A(!1),u=A(!1),h=A(!1),$=A(""),c=A(null),x=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],g=A("whatsapp"),b=A("followup-1"),N=A(null),k=A(""),E=A("09:00"),F=A(null),U=A("Not Interested"),ye=A(""),fe=A({dealership:((Ye=(Ne=a.value)==null?void 0:Ne.requestedCar)==null?void 0:Ye.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((st=d==null?void 0:d.value)==null?void 0:st.id)||null}),q=A(null),D=A(null),M=A({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),j=S(()=>{var ae,ge;if(!((ae=a.value)!=null&&ae.requestedCar))return null;const ne=(ge=a.value.requestedCar.condition)==null?void 0:ge.toLowerCase();return ne==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:ne==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),H=A({tradeIn:!1,financing:!1,contactAvailability:!1}),le=A(!1),Q=A(null),xe=A(!0),Me=A(null),pe=A(null),te=A("assign-and-schedule"),K=A(""),re=A(null),we=A(""),Ie=A(null),et=A(""),P=A(""),ee=A(null),Be=A(""),Re=S(()=>{const ne=[];for(let ae=9*60;ae<=18*60;ae+=30){const ge=String(Math.floor(ae/60)).padStart(2,"0"),Se=String(ae%60).padStart(2,"0");ne.push(`${ge}:${Se}`)}return ne}),We=S(()=>{if(re.value!=null)return re.value;const ne=parseInt(we.value,10);return Number.isFinite(ne)&&ne>0?ne:null}),De=S(()=>{if(!Ie.value)return[];const ne=[],ae=new Date;if(ae.setHours(0,0,0,0),Ie.value==="tomorrow"){const ge=new Date(ae);ge.setDate(ge.getDate()+1),ge.getDay()!==0&&ge.getDay()!==6&&ne.push(ge)}else if(Ie.value==="this-week"){const ge=ae.getDay(),Se=new Date(ae);Se.setDate(ae.getDate()-(ge===0?6:ge-1));for(let Ce=0;Ce<5;Ce++){const Ve=new Date(Se);Ve.setDate(Se.getDate()+Ce),Ve>=ae&&ne.push(Ve)}}else if(Ie.value==="custom"&&et.value&&P.value){const ge=new Date(et.value),Se=new Date(P.value),Ce=new Date(ge);for(;Ce<=Se;)Ce.getDay()!==0&&Ce.getDay()!==6&&ne.push(new Date(Ce)),Ce.setDate(Ce.getDate()+1)}return ne}),Te=S(()=>{var Se,Ce,Ve,He,ft,tt,dt;const ne=((Ve=(Ce=(Se=a.value)==null?void 0:Se.customer)==null?void 0:Ce.name)==null?void 0:Ve.split(" ")[0])||"",ae=((ft=(He=a.value)==null?void 0:He.requestedCar)==null?void 0:ft.brand)||"",ge=((dt=(tt=a.value)==null?void 0:tt.requestedCar)==null?void 0:dt.model)||"";return{"followup-1":`Hi ${ne}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${ae} ${ge}?`,"followup-2":`Hello ${ne}, this is regarding your inquiry about the ${ae} ${ge}. Please let me know when you're available for a call.`,custom:""}}),R=S(()=>b.value==="custom"?"Type your custom message...":Te.value[b.value]||""),B=S(()=>{var ne;return!!((ne=a.value)!=null&&ne.scheduledAppointment)}),oe=()=>{const ne=new Date,ae=ne.getHours(),ge=ne.getDay();let Se=new Date,Ce="10:00",Ve="";if(ge===5&&ae>=15)Se.setDate(ne.getDate()+3),Ce="10:00",Ve="Optimal time after weekend, customer likely refreshed";else if(ge===6||ge===0)Se.setDate(ne.getDate()+(ge===6?2:1)),Ce="10:00",Ve="Weekend follow-up avoided, better response rate on weekdays";else if(ae>=17)Se.setDate(ne.getDate()+1),Ce="10:00",Ve="Business hours preferred, higher engagement rate";else if(ae<9)Se=new Date(ne),Se.setHours(10,0,0,0),Ce="10:00",Ve="Peak response time, customers more available mid-morning";else if(ae<14){Se=new Date(ne);const tt=ae+2;Se.setHours(tt,0,0,0),Ce=`${String(tt).padStart(2,"0")}:00`,Ve="Follow-up within same day increases conversion likelihood"}else Se.setDate(ne.getDate()+1),Se.setHours(10,0,0,0),Ce="10:00",Ve="Next morning follow-up maintains momentum";const He=Se.toISOString().split("T")[0],ft=`${He}T${Ce}:00`;return{date:He,time:Ce,dateTime:ft,reason:Ve,formattedDate:Se.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:y,selectedOutcome:f,showNoteModal:w,showScheduleAppointmentModal:u,followupChannels:x,followupChannel:g,selectedTemplate:b,rescheduleTime:N,customDate:k,customTime:E,disqualifyCategory:U,disqualifyReason:ye,assignment:fe,preferences:H,surveyCompleted:le,surveyResponses:Q,showSurvey:xe,aiSuggestionData:F,showCallLogForm:h,callLogDateTime:$,callLogAssignee:c,qualificationSelectedTeam:q,qualificationSelectedSalesman:D,suggestedTeam:j,communicationPreferences:M,messageTemplates:Te,messagePreview:R,hasExistingAppointment:B,selectOutcome:ne=>{if(f.value=ne,!$.value){const ae=new Date,ge=ae.getFullYear(),Se=String(ae.getMonth()+1).padStart(2,"0"),Ce=String(ae.getDate()).padStart(2,"0"),Ve=String(ae.getHours()).padStart(2,"0"),He=String(ae.getMinutes()).padStart(2,"0");$.value=`${ge}-${Se}-${Ce}T${Ve}:${He}`}!c.value&&(d!=null&&d.value)&&(c.value=d.value),ne==="interested"&&(le.value=!1,Q.value=null,xe.value=!0,o!=null&&o.value&&(H.value.tradeIn=o.value.tradeIn||!1,H.value.financing=o.value.financing||!1))},cancelOutcome:()=>{f.value=null,h.value=!1},calculateNextCallDate:()=>{if(N.value==="tomorrow-9am"){const ae=new Date;return ae.setDate(ae.getDate()+1),ae.setHours(9,0,0,0),ae.toISOString()}else if(N.value==="monday"){if(F.value)return new Date(F.value.dateTime).toISOString();const ae=new Date,ge=(8-ae.getDay())%7||7;return ae.setDate(ae.getDate()+ge),ae.setHours(9,0,0,0),ae.toISOString()}else if(N.value==="custom"&&k.value&&E.value)return new Date(`${k.value}T${E.value}:00`).toISOString();const ne=new Date;return ne.setDate(ne.getDate()+1),ne.setHours(9,0,0,0),ne.toISOString()},calculateAISuggestion:oe,handleAISuggestionClick:()=>{N.value="monday",F.value=oe()},resetOutcomeState:()=>{f.value=null,y.value=!0,g.value="whatsapp",b.value="followup-1",N.value=null,k.value="",E.value="09:00",U.value="Not Interested",ye.value="",le.value=!1,Q.value=null,xe.value=!0,F.value=null,h.value=!1,$.value="",c.value=null,Me.value=null,pe.value=null,te.value="assign-only",K.value="",Ie.value=null,et.value="",P.value="",ee.value=null,Be.value="",q.value=null,D.value=null,re.value=null,we.value=""},initCallLogForm:(ne=!1)=>{if(Me.value)return;const ae=new Date,ge=ae.getFullYear(),Se=String(ae.getMonth()+1).padStart(2,"0"),Ce=String(ae.getDate()).padStart(2,"0"),Ve=String(ae.getHours()).padStart(2,"0"),He=String(ae.getMinutes()).padStart(2,"0");$.value=`${ge}-${Se}-${Ce}T${Ve}:${He}`,d!=null&&d.value&&(c.value=d.value),h.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{h.value=!1,$.value="",c.value=null},clearSuccessState:()=>{Me.value=null,pe.value=null},successState:Me,successPerformedAt:pe,qualificationMethod:te,qualificationEventType:K,qualificationDurationMinutes:re,qualificationCustomDuration:we,qualificationDateRange:Ie,qualificationCustomDateStart:et,qualificationCustomDateEnd:P,availableDatesForRange:De,qualificationSelectedDate:ee,qualificationSelectedSlot:Be,qualificationScheduleSlotOptions:Re,qualificationDurationValue:We}}function Io(a,V,o,m,v,d,y,f,w=null){const{callData:u}=V,{showOutcomeSelection:h,selectedOutcome:$,assignment:c,preferences:x,cancelOutcome:g,calculateNextCallDate:b,showScheduleAppointmentModal:N,surveyCompleted:k,surveyResponses:E,showSurvey:F,initCallLogForm:U,callLogDateTime:ye,callLogAssignee:fe,successState:q,successPerformedAt:D,rescheduleTime:M,aiSuggestionData:j,customDate:H,customTime:le,qualificationMethod:Q,qualificationEventType:xe,qualificationDurationValue:Me,qualificationSelectedDate:pe,qualificationSelectedSlot:te,qualificationSelectedTeam:K,qualificationSelectedSalesman:re,communicationPreferences:we}=o,Ie=()=>{var W;return((W=f==null?void 0:f.value)==null?void 0:W.name)||"Unknown"},et=()=>M.value==="tomorrow-9am"?"Tomorrow 9:00 AM":M.value==="monday"&&j.value?`${j.value.formattedDate} at ${j.value.time}`:M.value==="monday"?"Monday":M.value==="custom"&&H.value&&le.value?`${H.value} ${le.value}`:"selected time";return{logManualCall:()=>{u.value={channel:"external",notes:"",transcription:null},U(!0)},handleScheduleAppointmentConfirm:async W=>{N.value=!1,a("appointment-scheduled",W)},handleQualify:async()=>{var Ne,Ye,st,ne,ae,ge,Se,Ce,Ve,He,ft,tt,dt,wt,ot,Ct,Ke,it,yt,gt,$t,Xe,Ot,Qe,Ee;const W={timestamp:new Date().toISOString(),outcome:"interested",channel:((Ne=u.value)==null?void 0:Ne.channel)||"phone",notes:((Ye=u.value)==null?void 0:Ye.notes)||"",transcription:((st=u.value)==null?void 0:st.transcription)||null};a("call-attempt-logged",W),a("validated",{scheduleFollowUp:!1});let se="Unassigned";Q.value==="assign-and-schedule"?re.value?se=re.value.name:K.value&&(se=K.value.name):se=((ae=(ne=c.value)==null?void 0:ne.assignee)==null?void 0:ae.name)||"Unassigned";let ie=null,ke=!1,de=null;if(Q.value==="assign-and-schedule"&&pe.value&&te.value){const ue=pe.value,It=ue.toLocaleDateString(void 0,{month:"long",day:"numeric"}),zt={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[xe.value]||xe.value;ke=!0;const Pe=ue.getFullYear(),rt=String(ue.getMonth()+1).padStart(2,"0"),Cs=String(ue.getDate()).padStart(2,"0"),Xt=`${Pe}-${rt}-${Cs}`;if(de={datetime:ue,date:Xt,time:te.value,type:zt,assignee:se,assigneeId:((ge=re.value)==null?void 0:ge.id)||((Se=K.value)==null?void 0:Se.id)||null,assigneeType:re.value?"user":"team",duration:Me.value,team:((Ce=K.value)==null?void 0:Ce.name)||null,teamId:((Ve=K.value)==null?void 0:Ve.id)||null,salesperson:((He=re.value)==null?void 0:He.name)||null,salespersonId:((ft=re.value)==null?void 0:ft.id)||null},ie={date:It,time:te.value,title:zt,name:((dt=(tt=m.value)==null?void 0:tt.customer)==null?void 0:dt.name)||"",location:se},a("appointment-scheduled",de),we.value){const bt=we.value;if((wt=bt.immediateConfirmation)!=null&&wt.enabled&&((Ct=(ot=bt.immediateConfirmation)==null?void 0:ot.channels)==null?void 0:Ct.length)>0){for(const ct of bt.immediateConfirmation.channels)if(y&&((Ke=m.value)!=null&&Ke.id))try{await y.addActivity(m.value.id,{type:ct,user:Ie(),action:`sent ${ct} confirmation`,content:`Appointment confirmed: ${zt} on ${It} at ${te.value}`,timestamp:new Date().toISOString()})}catch(ut){console.error(`Failed to log ${ct} confirmation:`,ut)}}if((it=bt.reminder)!=null&&it.enabled&&((gt=(yt=bt.reminder)==null?void 0:yt.channels)==null?void 0:gt.length)>0){const ct=new Date(ue);ct.setDate(ct.getDate()-1);const ut=ct.toISOString().split("T")[0];if(y&&(($t=m.value)!=null&&$t.id))try{await y.addActivity(m.value.id,{type:"reminder-scheduled",user:Ie(),action:"scheduled reminder",content:`Reminder scheduled for ${ut} via ${bt.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:ut,channels:bt.reminder.channels}})}catch(Nt){console.error("Failed to schedule reminder:",Nt)}}if((Xe=bt.salespersonNotification)!=null&&Xe.enabled){const ct=((Ot=re.value)==null?void 0:Ot.name)||((Qe=K.value)==null?void 0:Qe.name)||"Team";if(y&&((Ee=m.value)!=null&&Ee.id))try{await y.addActivity(m.value.id,{type:"notification",user:Ie(),action:"sent notification",content:`Notification sent to ${ct} about appointment`,timestamp:new Date().toISOString()})}catch(ut){console.error("Failed to send notification:",ut)}}}}Q.value==="assign-and-schedule"&&(re.value?c.value={...c.value,assignee:{...re.value,type:"user"},assigneeId:re.value.id,salesperson:re.value}:K.value&&(c.value={...c.value,assignee:{...K.value,type:"team"},team:K.value}));const Fe=Q.value==="assign-and-schedule"?{assignee:re.value||K.value,salesperson:re.value||null,team:K.value||null}:c.value;let Oe=null;if(w!=null&&w.value){const ue=w.value;Oe={interestLevel:ue.interestLevel,purchaseTimeline:ue.purchaseTimeline,budgetRange:ue.budgetRange,hasTradeIn:ue.hasTradeIn,tradeInModel:ue.tradeInModel,financingOption:ue.financingOption,additionalNotes:ue.additionalNotes}}else k.value&&E.value&&(Oe=E.value);a("qualified",{assignment:Fe,preferences:x.value,scheduleAppointment:ke,appointmentData:de,surveyData:Oe});let Ae=`Qualified - Assigned to ${se}`;ie&&(Ae=`Qualified - Assigned to ${se}, meeting on ${ie.date} ${ie.time}`),q.value={kind:"qualified",statusText:Ae,meeting:ie,actorName:Ie()},D.value=new Date,g()},handleDisqualifyFromInterested:()=>{var se,ie,ke;const W={timestamp:new Date().toISOString(),outcome:"interested",channel:((se=u.value)==null?void 0:se.channel)||"phone",notes:((ie=u.value)==null?void 0:ie.notes)||"",transcription:((ke=u.value)==null?void 0:ke.transcription)||null};a("call-attempt-logged",W),$.value="not-valid"},handleNoAnswerConfirm:async()=>{var Fe,Oe,Ae,Ne;const W={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Fe=u.value)==null?void 0:Fe.channel)||"phone",notes:((Oe=u.value)==null?void 0:Oe.notes)||"",transcription:((Ae=u.value)==null?void 0:Ae.transcription)||null};a("call-attempt-logged",W);const se=b(),ie=se.split("T")[0],ke=new Date(se).toTimeString().slice(0,5);if(y&&((Ne=m.value)!=null&&Ne.id))try{await y.updateLead(m.value.id,{nextActionDue:se,status:"Pending"})}catch(Ye){console.error('Failed to update lead status to "to be called back":',Ye)}a("postponed",{date:ie,time:ke,createAppointment:!0}),(v==null?void 0:v.value)+1>=(d==null?void 0:d.value)&&a("disqualified",{category:"Not Interested",reason:"Unreachable"});const de=et();q.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${de}`,actorName:Ie()},D.value=new Date,g()},handleNotValidConfirm:()=>{var se,ie,ke;const W={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((se=u.value)==null?void 0:se.channel)||"phone",notes:((ie=u.value)==null?void 0:ie.notes)||"",transcription:((ke=u.value)==null?void 0:ke.transcription)||null};a("call-attempt-logged",W),a("disqualified",{category:o.disqualifyCategory.value,reason:o.disqualifyReason.value}),q.value={kind:"not-interested",statusText:"Closed - Not interested",actorName:Ie()},D.value=new Date,g()},handleNoteSave:W=>{o.showNoteModal.value=!1,a("note-saved",W)},handleSurveyCompleted:async W=>{var se;if(E.value=W,k.value=!0,F.value=!1,y&&((se=m.value)!=null&&se.id))try{await y.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(W),timestamp:new Date().toISOString()})}catch(ie){console.error("Failed to save survey activity:",ie)}a("survey-completed",{lead:m.value,responses:W})},handleSurveyRefused:async()=>{var W;if(F.value=!1,y&&((W=m.value)!=null&&W.id))try{await y.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey refusal activity:",se)}a("survey-refused",{lead:m.value})},handleNotResponding:async()=>{var W;if(F.value=!1,y&&((W=m.value)!=null&&W.id))try{await y.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey not responding activity:",se)}a("not-responding",{lead:m.value})},handleReopen:()=>{o.clearSuccessState(),o.resetOutcomeState()}}}const No=["disabled"],Vo={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:a=>["small","medium"].includes(a)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(a){return(V,o)=>(p(),C("button",{class:J(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",a.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",a.size==="small"?"px-3 py-1.5 text-fluid-xs":"px-4 py-2 text-fluid-sm"]),disabled:a.disabled,style:{background:"linear-gradient(135deg, #6B21A8, #9333EA, #A855F7)"},onClick:o[0]||(o[0]=m=>V.$emit("click",m))},[s(t(qa),{size:a.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,I(a.label),1)],10,No))}},Mo={key:0,class:"flex gap-2 items-center mb-4"},qo=["disabled"],Lo={key:1,class:"mb-4 space-y-4 border-t border pt-4"},Fo={key:0,class:"bg-slate-900 text-white rounded-card p-4"},Uo={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},_o={class:"flex items-center gap-3"},Eo={class:"flex items-center gap-2 text-red-400"},Ro={class:"text-xs font-mono"},jo={class:"space-y-3 text-sm font-mono"},Bo={class:"ml-2"},Wo={class:"ml-2"},Po={key:0},zo={class:"ml-2"},Yo={key:1},Ho={class:"ml-2"},Qo={key:2},Jo={class:"ml-2"},Go={class:"mt-4 pt-4 border-t border-slate-700"},Zo=["model-value"],Ko={key:1,class:"bg-blue-50 rounded-card p-4"},Xo={class:"flex items-center justify-between"},ei={class:"flex gap-2"},Gn={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0},hideButton:{type:Boolean,default:!1}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(a){return(V,o)=>(p(),C("div",null,[!a.hideButton&&!a.isCallActive?(p(),C("div",Mo,[e("button",{onClick:o[0]||(o[0]=m=>V.$emit("start-call")),disabled:a.isCallActive,class:J(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",a.isCallActive?"bg-surface border-E5E7EB text-body opacity-60 cursor-not-allowed":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[o[4]||(o[4]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),T(" "+I(a.contactAttempts>0?"Call Again":"Initiate Call"),1)],10,qo)])):L("",!0),a.isCallActive||a.callEnded?(p(),C("div",Lo,[a.isCallActive?(p(),C("div",Fo,[e("div",Uo,[o[7]||(o[7]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",_o,[e("div",Eo,[o[5]||(o[5]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ro,"REC "+I(a.formattedCallDuration),1)]),e("button",{onClick:o[1]||(o[1]=m=>V.$emit("end-call")),class:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg flex items-center gap-2 transition-colors"},[...o[6]||(o[6]=[e("i",{class:"fa-solid fa-stop"},null,-1),T(" Stop Call ",-1)])])])]),e("div",jo,[e("div",null,[o[8]||(o[8]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Bo,I(a.mockTranscription.leadLines[0]),1)]),e("div",null,[o[9]||(o[9]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Wo,I(a.mockTranscription.salesLines[0]),1)]),a.callDuration>=5?(p(),C("div",Po,[o[10]||(o[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",zo,I(a.mockTranscription.leadLines[1]),1)])):L("",!0),a.callDuration>=8?(p(),C("div",Yo,[o[11]||(o[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ho,I(a.mockTranscription.salesLines[1]),1)])):L("",!0),a.callDuration>=12?(p(),C("div",Qo,[o[12]||(o[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Jo,I(a.mockTranscription.leadLines[2]),1)])):L("",!0)]),e("div",Go,[e("textarea",{"model-value":a.callNotes,"onUpdate:modelValue":o[2]||(o[2]=m=>V.$emit("update:call-notes",m)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Zo)])])):L("",!0),a.callEnded&&!a.isCallActive?(p(),C("div",Ko,[e("div",Xo,[o[13]||(o[13]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",ei,[s(Vo,{label:"Extract information",size:"small",onClick:o[3]||(o[3]=m=>V.$emit("extract-information"))})])])])):L("",!0)])):L("",!0)]))}},ti={class:"flex items-center gap-2.5 min-w-0"},si={class:"flex items-center gap-2 min-w-0"},Zn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(a,{emit:V}){const o=a,m=V,v=A(!1),d=S(()=>Ca(o.nextActionDue)),y=S(()=>d.value.type==="overdue"?Vn:d.value.type==="urgent"?za:Vn),f=S(()=>o.isClosed||!o.showDeadlineBanner||v.value?!1:d.value.type==="overdue"||d.value.type==="urgent"),w=()=>{v.value=!0,m("dismissed")};return(u,h)=>f.value?(p(),C("div",{key:0,class:J(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[d.value.bgClass,d.value.borderClass]])},[e("div",ti,[e("div",{class:J(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",d.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(p(),me(wn(y.value),{size:12,class:J(d.value.textClass)},null,8,["class"]))],2),e("div",si,[e("span",{class:J(["text-[10px] font-bold uppercase tracking-wider",d.value.textClass])},I(d.value.type==="overdue"?"Overdue":"Urgent"),3),h[0]||(h[0]=e("span",{class:"text-fluid-xs text-sub opacity-30"},"•",-1)),e("span",{class:J(["text-fluid-xs font-medium truncate",d.value.textClass])}," Next Action: "+I(t($a)(a.nextActionDue)),3)])]),e("button",{onClick:w,class:J(["p-1 rounded-md transition-colors shrink-0",[d.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[s(t(Fn),{size:14})],2)],2)):L("",!0)}},ni={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},ai={class:"space-y-4"},li={class:"flex items-center gap-3"},oi={class:"flex items-center gap-3"},ii={class:"text-fluid-sm font-medium text-heading"},Kn={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(a,{emit:V}){const o=V,m=[{value:"email",label:"via Email"},{value:"sms",label:"via SMS"},{value:"whatsapp",label:"via WhatsApp"}],v=A({immediateConfirmationEnabled:!0,immediateConfirmationChannels:["email"],reminderEnabled:!0,reminderChannels:["email"],salespersonNotification:!0});return $e(v,d=>{var f,w;const y={immediateConfirmation:{enabled:d.immediateConfirmationEnabled,channels:d.immediateConfirmationEnabled&&((f=d.immediateConfirmationChannels)==null?void 0:f.length)>0?d.immediateConfirmationChannels:[]},reminder:{enabled:d.reminderEnabled,channels:d.reminderEnabled&&((w=d.reminderChannels)==null?void 0:w.length)>0?d.reminderChannels:[]},salespersonNotification:{enabled:d.salespersonNotification}};o("update",y)},{deep:!0}),(d,y)=>(p(),C("div",ni,[y[7]||(y[7]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Send confirmations and reminders",-1)),e("div",ai,[e("div",li,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"immediate-confirmation",modelValue:v.value.immediateConfirmationEnabled,"onUpdate:modelValue":y[0]||(y[0]=f=>v.value.immediateConfirmationEnabled=f)},null,8,["modelValue"]),y[5]||(y[5]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation to customer",-1))]),_:1}),v.value.immediateConfirmationEnabled?(p(),me(t(Ze),{key:0,modelValue:v.value.immediateConfirmationChannels,"onUpdate:modelValue":y[1]||(y[1]=f=>v.value.immediateConfirmationChannels=f),items:m,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),e("div",oi,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"reminder",modelValue:v.value.reminderEnabled,"onUpdate:modelValue":y[2]||(y[2]=f=>v.value.reminderEnabled=f)},null,8,["modelValue"]),y[6]||(y[6]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder the day before appointment",-1))]),_:1}),v.value.reminderEnabled?(p(),me(t(Ze),{key:0,modelValue:v.value.reminderChannels,"onUpdate:modelValue":y[3]||(y[3]=f=>v.value.reminderChannels=f),items:m,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},{default:r(()=>[s(t(jt),{id:"salesperson-notification",modelValue:v.value.salespersonNotification,"onUpdate:modelValue":y[4]||(y[4]=f=>v.value.salespersonNotification=f)},null,8,["modelValue"]),e("span",ii," Notify "+I(a.salesperson?a.salesperson.name:a.team?a.team.name:"salesperson")+" about appointment ",1)]),_:1})]),xt(d.$slots,"actions")]))}},ri={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},$n={__name:"CloseAsLostForm",props:{showMultipleNoShows:{type:Boolean,default:!1},preselectedReason:{type:String,default:""},closeButtonLabel:{type:String,default:"Close"}},emits:["close","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=A(m.preselectedReason||"");$e(()=>m.preselectedReason,w=>{w&&(d.value=w)});const y=S(()=>!!d.value);function f(){y.value&&v("close",d.value)}return V({reason:d,canSubmit:y,submit:f}),(w,u)=>(p(),C("div",ri,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...u[1]||(u[1]=[T("Reason",-1)])]),_:1}),s(t(Lt),{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=h=>d.value=h)},{default:r(()=>[s(t(Vt),{class:"w-full"},{default:r(()=>[s(t(Mt),{placeholder:"Select a reason..."})]),_:1}),s(t(qt),null,{default:r(()=>[a.showMultipleNoShows?(p(),me(t(be),{key:0,value:"Multiple no shows"},{default:r(()=>[...u[2]||(u[2]=[T("Multiple no shows",-1)])]),_:1})):L("",!0),s(t(be),{value:"Data cleanup"},{default:r(()=>[...u[3]||(u[3]=[T("Data cleanup",-1)])]),_:1}),s(t(be),{value:"Unreachable"},{default:r(()=>[...u[4]||(u[4]=[T("Unreachable",-1)])]),_:1}),s(t(be),{value:"Purchase postponed"},{default:r(()=>[...u[5]||(u[5]=[T("Purchase postponed",-1)])]),_:1}),s(t(be),{value:"Vehicle sold"},{default:r(()=>[...u[6]||(u[6]=[T("Vehicle sold",-1)])]),_:1}),s(t(be),{value:"Out of budget"},{default:r(()=>[...u[7]||(u[7]=[T("Out of budget",-1)])]),_:1}),s(t(be),{value:"Financing rejected"},{default:r(()=>[...u[8]||(u[8]=[T("Financing rejected",-1)])]),_:1}),s(t(be),{value:"Duplicate"},{default:r(()=>[...u[9]||(u[9]=[T("Duplicate",-1)])]),_:1}),s(t(be),{value:"Bought elsewhere"},{default:r(()=>[...u[10]||(u[10]=[T("Bought elsewhere",-1)])]),_:1}),s(t(be),{value:"Not interested"},{default:r(()=>[...u[11]||(u[11]=[T("Not interested",-1)])]),_:1}),s(t(be),{value:"Budget constraints"},{default:r(()=>[...u[12]||(u[12]=[T("Budget constraints",-1)])]),_:1}),s(t(be),{value:"Found better price"},{default:r(()=>[...u[13]||(u[13]=[T("Found better price at competitor",-1)])]),_:1}),s(t(be),{value:"No response"},{default:r(()=>[...u[14]||(u[14]=[T("Customer not responding",-1)])]),_:1}),s(t(be),{value:"Wrong timing"},{default:r(()=>[...u[15]||(u[15]=[T("Timing not right",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...u[16]||(u[16]=[T("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}},ui={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},di={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},ci={class:"flex items-center gap-3"},mi={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},pi={class:"text-sm font-medium text-heading flex-1 pr-10"},vi={key:0,class:"mt-4 bg-white rounded-lg border border-black/5 overflow-hidden shadow-sm"},fi={class:"grid grid-cols-2 gap-3 p-4 text-sm"},yi={class:"ml-2 font-medium text-heading"},gi={class:"ml-2 font-medium text-heading"},bi={class:"ml-2 font-medium text-heading capitalize"},hi={class:"ml-2 font-medium text-heading"},xi={class:"flex justify-end mt-4"},wi={class:"px-4 py-2 flex items-center justify-between text-sm text-sub"},ki={class:"tabular-nums"},Si={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ci={class:"p-4"},$i={class:"flex justify-between items-start mb-3"},Di={class:"font-bold text-heading text-sm"},Ai={class:"text-sm text-body mt-0.5"},Ti={key:0,class:"mb-3 bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Oi={class:"flex items-center justify-between gap-4 flex-wrap"},Ii={key:0,class:"flex items-center gap-2"},Ni={class:"flex items-center gap-2"},Vi={class:"text-sm text-body"},Mi={key:1,class:"flex items-center gap-2"},qi={class:"text-sm font-semibold text-heading"},Li={key:0,class:"text-sm text-orange-600 font-medium flex items-center gap-1 ml-2"},Fi={class:"flex items-center gap-2 mb-3"},Ui={class:"text-sm text-body font-medium"},_i={class:"px-4 py-4 space-y-3"},Ei={key:0,class:"space-y-4"},Ri={class:"flex flex-wrap gap-3"},ji={key:0,class:"space-y-4"},Bi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Wi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Pi={class:"grid grid-cols-4 gap-2 mb-4"},zi={key:0,class:"space-y-3"},Yi=["value"],Hi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Qi={class:"grid grid-cols-3 gap-2"},Ji={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Gi={class:"flex items-start gap-2"},Zi={class:"flex-1"},Ki={class:"text-sm font-semibold text-heading mb-1"},Xi={class:"text-xs text-sub"},er={key:1,class:"mt-3 grid grid-cols-2 gap-3"},tr={key:1,class:"space-y-4"},sr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},nr={key:2,class:"space-y-4"},ar={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},lr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},or={class:"space-y-4"},ir={class:"flex gap-4"},rr={class:"space-y-2"},ur={class:"flex items-center gap-2 cursor-pointer"},dr={class:"flex justify-end gap-2 mt-4"},cr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},mr={class:"space-y-2"},pr={key:0,class:"space-y-4"},vr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},fr={class:"grid grid-cols-2 gap-4"},yr={class:"flex items-center gap-2"},gr={class:"text-sub"},br={class:"font-medium text-heading"},hr={class:"flex items-center gap-2"},xr={class:"font-medium text-heading"},wr={key:1,class:"space-y-4"},kr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Sr={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cr={class:"grid grid-cols-2 gap-4"},$r={class:"flex items-center gap-2"},Dr={class:"text-sub"},Ar={class:"font-medium text-heading"},Tr={class:"flex items-center gap-2"},Or={class:"font-medium text-heading"},Ir={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Nr={class:"font-semibold text-heading text-sm mb-4"},Vr={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},Mr={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},qr={class:"p-6"},Lr={class:"flex items-center justify-between mb-4"},Fr={class:"text-sm font-semibold text-heading"},Ur={class:"grid grid-cols-7 gap-1 mb-2"},_r={class:"grid grid-cols-7 gap-1"},Er=["onClick"],Rr={class:"p-6"},jr={class:"text-sm font-semibold text-heading mb-4"},Br={key:0,class:"space-y-2"},Wr=["onClick"],Pr={key:1,class:"text-sm text-sub py-4 text-center"},zr={key:2,class:"text-sm text-sub py-4 text-center"},Yr={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Hr={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},Qr={class:"ml-2 font-medium text-heading"},Jr={class:"ml-2 font-medium text-heading"},Gr={class:"ml-2 font-medium text-heading capitalize"},Zr={class:"ml-2 font-medium text-heading"},Kr={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Xr={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const{t:o}=Sn(),m=a,v=V,d=Ut(),y=Tt();kn();const f=Pt(),w=zn(()=>m.lead,{}),u=Jn(),{isCallActive:h,callEnded:$,callDuration:c,callNotes:x,callData:g,extractedData:b,mockTranscription:N,formattedCallDuration:k,startCall:E,endCall:F,copyNumber:U}=u,ye=A(null),fe=A(!1),q=A(!1),D=A(!1),M=A(!1),j=S(()=>d.assignableUsers),H=S(()=>d.assignableTeams),le=S(()=>y.currentUser),Q=A({interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}),xe=A(""),Me=A(""),pe=A(""),te=A("");S(()=>{var n;const O=new Set;return(n=H.value)==null||n.forEach(Z=>{Z.dealership&&O.add(Z.dealership)}),Array.from(O).sort()}),S(()=>{var O;return xe.value?((O=H.value)==null?void 0:O.filter(n=>n.dealership===xe.value))||[]:H.value||[]}),S(()=>{var n,Z;if(!Me.value)return j.value||[];const O=(n=H.value)==null?void 0:n.find(l=>l.id===Me.value);return O?((Z=j.value)==null?void 0:Z.filter(l=>l.team===O.name||l.teamId===O.id))||[]:j.value||[]});const K=O=>O?O.split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2):"?",re=O=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[O]||"bg-surfaceSecondary text-body",we=O=>{ne.value.assignee=O,O.type==="team"&&(mt.value=null),fe.value=!1};S(()=>!!it.value),S(()=>{if(Xe.value)return Xe.value.statusText;const O=m.activities.filter(n=>n.type==="call"||n.type==="outcome").sort((n,Z)=>new Date(Z.timestamp)-new Date(n.timestamp))[0];return O?O.outcome||O.content||"Outcome logged":null});const Ie=async()=>{var O;try{const n=Q.value,Z=[];if(n.interestLevel&&Z.push(`Interest level: ${n.interestLevel}`),n.purchaseTimeline&&Z.push(`Purchase timeline: ${n.purchaseTimeline}`),n.budgetRange&&Z.push(`Budget range: ${n.budgetRange}`),n.hasTradeIn&&n.tradeInModel&&Z.push(`Trade-in: ${n.tradeInModel}`),n.financingOption){const _={FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"};Z.push(`Financing: ${_[n.financingOption]||n.financingOption}`)}n.additionalNotes&&Z.push(n.additionalNotes);const l=Z.join(`
`);if(l.trim()&&(await f.addActivity(m.lead.id,{type:"note",user:((O=le.value)==null?void 0:O.name)||"You",action:"enriched lead information",content:l,timestamp:new Date().toISOString()}),v("note-saved",{type:"note",content:l,timestamp:new Date().toISOString(),enrichData:{...n}})),n.interestLevel||n.purchaseTimeline||n.budgetRange){const _={interestLevel:n.interestLevel,purchaseTimeline:n.purchaseTimeline,budgetRange:n.budgetRange};await f.addActivity(m.lead.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(_),timestamp:new Date().toISOString()}),v("survey-completed",{lead:m.lead,responses:_})}Q.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}}catch(n){console.error("Error saving enriched lead data:",n)}},et=()=>{E(),$t(!1)},P=()=>{U(m.lead.customer.phone)},ee=O=>{x.value=O},Be=S(()=>{var O;return((O=w.primaryAction.value)==null?void 0:O.title)||"Call to Verify Contact Details"}),Re=S(()=>{var O;return((O=w.primaryAction.value)==null?void 0:O.description)||"Begin lead qualification by verifying customer contact information."}),We=S(()=>m.lead.scheduledAppointment?new Date(m.lead.scheduledAppointment.start)<new Date:!1),De=S(()=>!!m.lead.scheduledAppointment),Te=S(()=>De.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:We.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:m.lead.nextActionDue?`Task Pending - Due ${Da(m.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),R=w.contactAttempts,B=w.maxContactAttempts,oe=Oo(vs(m,"lead"),g,b,R,B,le),{showOutcomeSelection:X,selectedOutcome:W,showNoteModal:se,showScheduleAppointmentModal:ie,followupChannels:ke,followupChannel:de,selectedTemplate:Fe,rescheduleTime:Oe,customDate:Ae,customTime:Ne,disqualifyCategory:Ye,disqualifyReason:st,assignment:ne,preferences:ae,messageTemplates:ge,messagePreview:Se,hasExistingAppointment:Ce,selectOutcome:Ve,cancelOutcome:He,calculateNextCallDate:ft,surveyCompleted:tt,surveyResponses:dt,showSurvey:wt,aiSuggestionData:ot,handleAISuggestionClick:Ct,callLogDateTime:Ke,callLogAssignee:it,confirmCallLogForm:yt,cancelCallLogForm:gt,initCallLogForm:$t,successState:Xe,successPerformedAt:Ot,qualificationMethod:Qe,qualificationEventType:Ee,qualificationDurationMinutes:ue,qualificationCustomDuration:It,qualificationCalendarMonth:zt,qualificationSelectedDate:Pe,qualificationSelectedSlot:rt,qualificationDateRange:Cs,qualificationCustomDateStart:Xt,qualificationCustomDateEnd:bt,availableDatesForRange:ct,qualificationScheduleSlotOptions:ut,qualificationDurationValue:Nt,qualificationSelectedTeam:Ue,qualificationSelectedSalesman:mt,suggestedTeam:js,communicationPreferences:Bs}=oe,$s=O=>{Bs.value=O},es=S(()=>{if(!Pe.value)return[];const O=Pe.value.toISOString().split("T")[0];if(mt.value){const n=Bt(`user-${mt.value.id}`,O);return ut.value.filter(Z=>n.includes(Z))}if(Ue.value){const n=Bt(`team-${Ue.value.id}`,O);return ut.value.filter(Z=>n.includes(Z))}return ut.value||[]});$e(Pe,()=>{rt.value=""}),S(()=>m.activities.filter(O=>O.type==="note"));const _t=S(()=>(H.value||[]).slice(0,3)),Ws=S(()=>{if(!H.value)return[];const O=[...H.value];if(Ue.value){const n=O.findIndex(Z=>Z.id===Ue.value.id);if(n>0){const Z=O.splice(n,1)[0];O.unshift(Z)}}return O}),Ds=S(()=>Ws.value.map(O=>({...O,label:`${O.dealership||"No location"} → ${O.name}`,value:O.id}))),Yt=S(()=>{var Z;if(!Ue.value)return[];const O=Ue.value;return(((Z=j.value)==null?void 0:Z.filter(l=>l.team===O.name||l.teamId===O.id))||[]).map(l=>({...l,label:l.name,value:l.id}))}),Ht=S({get:()=>{var O;return((O=Ue.value)==null?void 0:O.id)||null},set:O=>{var Z;if(!O){Ue.value=null;return}const n=(Z=H.value)==null?void 0:Z.find(l=>l.id===O);Ue.value=n||null}}),Qt=S({get:()=>{var O;return((O=mt.value)==null?void 0:O.id)||null},set:O=>{if(!O){mt.value=null;return}const n=Yt.value.find(Z=>Z.id===O);mt.value=n||null}});$e([Ee,js,H],([O,n,Z])=>{if(O&&n&&Z&&!Ue.value){const l=Z.find(i=>i.id===n.id);l&&(Ue.value=l)}},{immediate:!0}),$e(Ee,O=>{if(O&&!Pe.value){const n=new Date;n.setHours(0,0,0,0),Pe.value=n,nt.value=n.getMonth(),ht.value=n.getFullYear(),rt.value=""}},{immediate:!0}),$e(W,O=>{var n,Z,l;if(O==="interested"&&Qe.value==="assign-only"&&!((n=ne.value)!=null&&n.assignee))if(m.lead.assignee){const i=(Z=j.value)==null?void 0:Z.find(ce=>ce.name===m.lead.assignee),_=(l=H.value)==null?void 0:l.find(ce=>ce.name===m.lead.assignee);i?ne.value={...ne.value,assignee:{...i,type:"user"}}:_&&(ne.value={...ne.value,assignee:{..._,type:"team"}})}else _t.value.length>0&&(ne.value={...ne.value,assignee:{..._t.value[0],type:"team"}})}),$e(()=>{var O;return(O=ne.value)==null?void 0:O.assignee},O=>{(O==null?void 0:O.type)!=="team"&&(mt.value=null)}),$e(Ue,O=>{mt.value=null,O&&Ee.value&&ts(`team-${O.id}`)}),$e(mt,O=>{O?ts(`user-${O.id}`):Ue.value&&ts(`team-${Ue.value.id}`)}),$e(Pe,()=>{rt.value=""});const ts=O=>{const n=new Date;n.setHours(0,0,0,0);for(let Z=0;Z<30;Z++){const l=new Date(n);if(l.setDate(n.getDate()+Z),l.getDay()===0||l.getDay()===6)continue;const i=l.toISOString().split("T")[0],_=Bt(O,i);if(_&&_.length>0){Pe.value=l,nt.value=l.getMonth(),ht.value=l.getFullYear(),setTimeout(()=>{const ce=ut.value.filter(ve=>_.includes(ve));ce.length>0&&(rt.value=ce[0])},0);break}}},Ps=S(()=>!(W.value!=="no-answer"||!de.value||de.value!=="dont-send"&&!Fe.value||!Oe.value||Oe.value==="custom"&&(!Ae.value||!Ne.value)));$e(W,O=>{O!=="interested"&&(Q.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""},xe.value="",Me.value="",pe.value="")}),$e(pe,O=>{var n,Z;if(O){const l=(n=j.value)==null?void 0:n.find(i=>i.id===O);if(l){const i=(Z=H.value)==null?void 0:Z.find(_=>_.name===l.team||_.id===l.teamId);i&&(Me.value=i.id,i.dealership&&(xe.value=i.dealership))}}}),$e(Me,O=>{var n,Z;if(O&&pe.value){const l=(n=j.value)==null?void 0:n.find(_=>_.id===pe.value),i=(Z=H.value)==null?void 0:Z.find(_=>_.id===O);l&&i&&l.team!==i.name&&l.teamId!==i.id&&(pe.value="")}}),$e(xe,O=>{var n;if(O&&Me.value){const Z=(n=H.value)==null?void 0:n.find(l=>l.id===Me.value);Z&&Z.dealership!==O&&(Me.value="",pe.value="")}}),$e($,O=>{O&&!Xe.value&&$t(!1)});const zs=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],Ys=S(()=>zs.map(O=>({value:O.value,label:O.label}))),nt=A(new Date().getMonth()),ht=A(new Date().getFullYear()),As=["MON","TUE","WED","THU","FRI","SAT","SUN"],Hs=S(()=>new Date(ht.value,nt.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),Qs=S(()=>{const O=new Date(ht.value,nt.value,1),Z=new Date(ht.value,nt.value+1,0).getDate(),l=O.getDay()===0?6:O.getDay()-1,i=[];for(let _=0;_<l;_++)i.push(null);for(let _=1;_<=Z;_++)i.push(_);return i}),Js=S(()=>{if(!Pe.value)return o("forms.schedule.timeSlots.selectDate");const O=Pe.value,n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${n[O.getDay()]}, ${Z[O.getMonth()]} ${O.getDate()}`}),Gs=O=>{if(!O||!Pe.value)return!1;const n=Pe.value;return n.getDate()===O&&n.getMonth()===nt.value&&n.getFullYear()===ht.value},Zs=O=>{if(!O)return;const n=new Date(ht.value,nt.value,O);Pe.value=n,rt.value=""},Ks=()=>{nt.value===0?(nt.value=11,ht.value--):nt.value--},Ts=()=>{nt.value===11?(nt.value=0,ht.value++):nt.value++},Os={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},ss=O=>{ue.value=O,It.value=""};$e(It,O=>{O&&(ue.value=null)}),$e(Ee,O=>{if(!O)return;const n=Os[O];n&&(n===15?ss(15):n===30?ss(30):n===60?ss(60):(ue.value=null,It.value=n.toString()))});const Xs=S(()=>Qe.value==="assign-only"?!!(Ee.value&&Ue.value):!!(Ee.value&&Nt.value&&Pe.value&&rt.value&&Ue.value)),Is=S(()=>!!st.value);function en(O){st.value=O,Ye.value||(Ye.value="Not Valid"),ns()}const tn=S(()=>W.value==="no-answer"?de.value==="dont-send"?"Postpone":"Send and postpone":W.value==="not-valid"?Ye.value?`Close as ${Ye.value}`:"Close":W.value==="interested"?"Schedule and qualify":""),Ns=S(()=>W.value==="no-answer"?Ps.value:W.value==="not-valid"?Is.value:W.value==="interested"?Xs.value:!1),sn=()=>{W.value==="no-answer"?on():W.value==="not-valid"?ns():W.value==="interested"&&ln()},nn=Io(v,u,oe,vs(m,"lead"),R,B,f,le,Q),{logManualCall:an,handleScheduleAppointmentConfirm:Vs,handleQualify:ln,handleNoAnswerConfirm:on,handleNotValidConfirm:ns,handleNoteSave:rn,handleReopen:un}=nn,dn=S(()=>{if(!Ot.value)return"";const O=Ot.value,n=String(O.getDate()).padStart(2,"0"),Z=String(O.getMonth()+1).padStart(2,"0"),l=String(O.getFullYear()),i=String(O.getHours()).padStart(2,"0"),_=String(O.getMinutes()).padStart(2,"0");return`${n}/${Z}/${l} ${i}:${_}`}),{saveTradeInVehicle:Ms}=Aa(),cn=async O=>{var n,Z,l;try{q.value=!1,ae.value.financing=!0;const i=O.type==="FIN"?"Captive Financing":O.type==="LEA"?"Leasing":"Long-Term Rental",_=((n=O.fields)==null?void 0:n.monthlyInstalment)||0;await f.addActivity(m.lead.id,{type:"purchase-method",user:((Z=le.value)==null?void 0:Z.name)||"You",action:`added a ${i} purchase method`,content:`${i}: €${_.toLocaleString()}/month for ${((l=O.fields)==null?void 0:l.duration)||0} months`,data:{purchaseMethodId:O.id,type:O.type,...O.fields},timestamp:new Date().toISOString()}),v("note-saved",{type:"purchase-method",...O})}catch(i){console.error("Error saving purchase method:",i)}},mn=async O=>{try{if(D.value=!1,O.vehicleType==="tradein"||m.mode==="tradein"){const n=await Ms("lead",m.lead.id,O.vehicle,O.valuation||{});ae.value.tradeIn=!0,v("note-saved",{type:"tradein",id:n.activity.id,action:"added a trade-in",vehicleId:n.vehicle.id,data:n.activity.data,timestamp:n.activity.timestamp})}else{const{addVehicleToCustomer:n}=await Zt(async()=>{const{addVehicleToCustomer:Z}=await import("./contacts-BG9sTx9a.js");return{addVehicleToCustomer:Z}},__vite__mapDeps([0,1,2]));await n(m.lead.customerId,O.vehicle),v("note-saved",{type:"vehicle",vehicleType:O.vehicleType,...O.vehicle})}}catch(n){console.error("Error saving vehicle:",n)}};return(O,n)=>{var Z;return p(),C("div",ui,[t(Xe)?(p(),C(Le,{key:0},[e("div",di,[e("div",ci,[e("div",mi,[s(t(Mn),{size:16,class:"text-green-600"})]),e("p",pi,I(t(Xe).statusText),1)]),t(Xe).meeting?(p(),C("div",vi,[e("div",fi,[e("div",null,[n[41]||(n[41]=e("span",{class:"text-body"},"Date:",-1)),e("span",yi,I(t(Xe).meeting.date),1)]),e("div",null,[n[42]||(n[42]=e("span",{class:"text-body"},"Time:",-1)),e("span",gi,I(t(Xe).meeting.time),1)]),e("div",null,[n[43]||(n[43]=e("span",{class:"text-body"},"Type:",-1)),e("span",bi,I(t(Xe).meeting.title),1)]),e("div",null,[n[44]||(n[44]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",hi,I(t(Xe).meeting.location),1)])])])):L("",!0),e("div",xi,[s(t(Y),{variant:"outline",size:"small",class:"flex items-center gap-2",onClick:t(un)},{default:r(()=>[s(t(Wa),{size:14}),n[45]||(n[45]=T(" Re-open ",-1))]),_:1},8,["onClick"])])]),e("div",wi,[e("span",null,"Updated by "+I(t(Xe).actorName||"Unknown"),1),e("span",ki,I(dn.value),1)])],64)):(p(),C(Le,{key:1},[e("div",Si,[s(Zn,{"next-action-due":a.lead.nextActionDue,"show-deadline-banner":a.showDeadlineBanner,"task-id":a.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",Ci,[e("div",$i,[e("div",null,[e("h4",Di,I(Be.value),1),e("p",Ai,I(Re.value),1)]),e("div",{class:J(["flex items-center gap-2 px-2 py-1 rounded-btn text-sm font-semibold",Te.value.class])},I(Te.value.text),3)]),De.value||t(R)>0?(p(),C("div",Ti,[e("div",Oi,[De.value?(p(),C("div",Ii,[n[47]||(n[47]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-sm"},null,-1)),e("div",Ni,[n[46]||(n[46]=e("span",{class:"text-sm font-semibold text-heading"},"Scheduled Follow-up Call:",-1)),e("span",Vi,I(t(Rt)(a.lead.scheduledAppointment.start))+" at "+I(t(ms)(a.lead.scheduledAppointment.start)),1)])])):L("",!0),t(R)>0?(p(),C("div",Mi,[n[49]||(n[49]=e("i",{class:"fa-solid fa-phone text-body text-sm"},null,-1)),n[50]||(n[50]=e("span",{class:"text-sm font-semibold text-body"},"Contact Attempts:",-1)),e("span",qi,I(t(R))+" / "+I(t(B)),1),t(R)>=t(B)-1?(p(),C("div",Li,[...n[48]||(n[48]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):L("",!0)])):L("",!0)])])):L("",!0),e("div",Fi,[e("span",Ui,I(a.lead.customer.phone),1),e("button",{onClick:P,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...n[51]||(n[51]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])]),s(Gn,{"is-call-active":t(h),"call-ended":t($),"call-duration":t(c),"call-notes":t(x),"formatted-call-duration":t(k),"mock-transcription":t(N),"contact-attempts":t(R),"max-contact-attempts":t(B),onStartCall:et,onEndCall:t(F),onLogManualCall:t(an),onExtractInformation:n[0]||(n[0]=l=>M.value=!0),"onUpdate:callNotes":ee,onCopyNumber:P},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall"])])]),e("div",_i,[t(Xe)?L("",!0):(p(),C("div",Ei,[e("div",null,[n[55]||(n[55]=e("p",{class:"text-sm font-medium text-heading leading-normal mb-3"},"Log what is happening?",-1)),e("div",Ri,[s(t(Y),{variant:"outline",onClick:n[1]||(n[1]=l=>t(Ve)("no-answer")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Je(t(W)==="no-answer"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Ba),{size:18,class:"shrink-0",style:Je(t(W)==="no-answer"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[52]||(n[52]=e("span",null,"No answer",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[2]||(n[2]=l=>t(Ve)("not-valid")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Je(t(W)==="not-valid"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Pa),{size:18,class:"shrink-0",style:Je(t(W)==="not-valid"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[53]||(n[53]=e("span",null,"Not valid",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[3]||(n[3]=l=>t(Ve)("interested")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Je(t(W)==="interested"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Mn),{size:18,class:"shrink-0",style:Je(t(W)==="interested"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[54]||(n[54]=e("span",null,"Interested",-1))]),_:1},8,["style"])])]),t(W)==="no-answer"?(p(),C("div",ji,[e("div",Bi,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[56]||(n[56]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ke),"onUpdate:modelValue":n[4]||(n[4]=l=>At(Ke)?Ke.value=l:null),class:"w-full"},null,8,["modelValue"])]),e("div",Wi,[n[65]||(n[65]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Send follow-up message",-1)),e("div",Pi,[s(t(Y),{variant:"outline",onClick:n[5]||(n[5]=l=>de.value="whatsapp"),class:"flex items-center justify-center gap-2",style:Je(t(de)==="whatsapp"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-brands fa-whatsapp text-xs",style:Je(t(de)==="whatsapp"?{color:"var(--brand-blue)"}:{})},null,4),n[57]||(n[57]=e("span",null,"WhatsApp",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[6]||(n[6]=l=>de.value="sms"),class:"flex items-center justify-center gap-2",style:Je(t(de)==="sms"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-message text-xs",style:Je(t(de)==="sms"?{color:"var(--brand-blue)"}:{})},null,4),n[58]||(n[58]=e("span",null,"SMS",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[7]||(n[7]=l=>de.value="email"),class:"flex items-center justify-center gap-2",style:Je(t(de)==="email"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-envelope text-xs",style:Je(t(de)==="email"?{color:"var(--brand-blue)"}:{})},null,4),n[59]||(n[59]=e("span",null,"Email",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[8]||(n[8]=l=>de.value="dont-send"),class:"flex items-center justify-center gap-2",style:Je(t(de)==="dont-send"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-xmark text-xs",style:Je(t(de)==="dont-send"?{color:"var(--brand-blue)"}:{})},null,4),n[60]||(n[60]=e("span",null,"Don't send",-1))]),_:1},8,["style"])]),t(de)&&t(de)!=="dont-send"?(p(),C("div",zi,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[61]||(n[61]=[T("Template",-1)])]),_:1}),s(t(Lt),{modelValue:t(Fe),"onUpdate:modelValue":n[9]||(n[9]=l=>At(Fe)?Fe.value=l:null)},{default:r(()=>[s(t(Vt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select template"})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"followup-1"},{default:r(()=>[...n[62]||(n[62]=[T("Follow-up 1",-1)])]),_:1}),s(t(be),{value:"followup-2"},{default:r(()=>[...n[63]||(n[63]=[T("Follow-up 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[64]||(n[64]=[T("Message preview",-1)])]),_:1}),e("textarea",{value:t(Se),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-body bg-white resize-none",readonly:""},null,8,Yi)])])):L("",!0)]),e("div",Hi,[n[72]||(n[72]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Next call attempt",-1)),e("div",Qi,[s(t(Y),{variant:"outline",onClick:n[10]||(n[10]=l=>Oe.value="tomorrow-9am"),class:"px-4 py-2 text-sm font-medium",style:Je(t(Oe)==="tomorrow-9am"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[...n[66]||(n[66]=[T(" Tomorrow 9:00 AM ",-1)])]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:t(Ct),class:"px-4 py-2 text-sm font-medium flex items-center gap-1.5",style:Je(t(Oe)==="monday"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-sparkles text-xs",style:Je(t(Oe)==="monday"?{color:"var(--brand-blue)"}:{})},null,4),n[67]||(n[67]=T(" AI suggestion ",-1))]),_:1},8,["onClick","style"]),s(t(Y),{variant:"outline",onClick:n[11]||(n[11]=l=>Oe.value="custom"),class:"px-4 py-2 text-sm font-medium",style:Je(t(Oe)==="custom"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[...n[68]||(n[68]=[T(" Select time ",-1)])]),_:1},8,["style"])]),t(Oe)==="monday"&&t(ot)?(p(),C("div",Ji,[e("div",Gi,[n[69]||(n[69]=e("i",{class:"fa-solid fa-lightbulb text-blue-600 text-sm mt-0.5"},null,-1)),e("div",Zi,[e("p",Ki,I(t(ot).formattedDate)+" at "+I(t(ot).time),1),e("p",Xi,I(t(ot).reason),1)])])])):L("",!0),t(Oe)==="custom"?(p(),C("div",er,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[70]||(n[70]=[T("Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:t(Ae),"onUpdate:modelValue":n[12]||(n[12]=l=>At(Ae)?Ae.value=l:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[71]||(n[71]=[T("Time",-1)])]),_:1}),s(t(at),{type:"time",modelValue:t(Ne),"onUpdate:modelValue":n[13]||(n[13]=l=>At(Ne)?Ne.value=l:null),class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0),t(W)==="not-valid"?(p(),C("div",tr,[e("div",sr,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[73]||(n[73]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ke),"onUpdate:modelValue":n[14]||(n[14]=l=>At(Ke)?Ke.value=l:null),class:"w-full"},null,8,["modelValue"])]),s($n,{"preselected-reason":t(st),"close-button-label":"Close",onClose:en,onCancel:t(He)},null,8,["preselected-reason","onCancel"])])):L("",!0),t(W)==="interested"?(p(),C("div",nr,[n[119]||(n[119]=e("div",{class:"text-xs text-sub px-2"},[e("span",{class:"text-red-600"},"*"),T(" Required fields ")],-1)),e("div",ar,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[74]||(n[74]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ke),"onUpdate:modelValue":n[15]||(n[15]=l=>At(Ke)?Ke.value=l:null),class:"w-full"},null,8,["modelValue"])]),e("div",lr,[n[97]||(n[97]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Enrich lead",-1)),e("div",or,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[75]||(n[75]=[T("Customer interest level?",-1)])]),_:1}),e("div",ir,[s(t(G),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ge(e("input",{type:"radio","onUpdate:modelValue":n[16]||(n[16]=l=>Q.value.interestLevel=l),value:"High",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[76]||(n[76]=e("span",{class:"text-sm text-body"},"High",-1))]),_:1}),s(t(G),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ge(e("input",{type:"radio","onUpdate:modelValue":n[17]||(n[17]=l=>Q.value.interestLevel=l),value:"Medium",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[77]||(n[77]=e("span",{class:"text-sm text-body"},"Medium",-1))]),_:1}),s(t(G),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ge(e("input",{type:"radio","onUpdate:modelValue":n[18]||(n[18]=l=>Q.value.interestLevel=l),value:"Low",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[78]||(n[78]=e("span",{class:"text-sm text-body"},"Low",-1))]),_:1})])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[79]||(n[79]=[T("Expected purchase timeline?",-1)])]),_:1}),s(t(Lt),{modelValue:Q.value.purchaseTimeline,"onUpdate:modelValue":n[19]||(n[19]=l=>Q.value.purchaseTimeline=l)},{default:r(()=>[s(t(Vt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select timeline"})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"Immediate"},{default:r(()=>[...n[80]||(n[80]=[T("Immediate",-1)])]),_:1}),s(t(be),{value:"Within 1 month"},{default:r(()=>[...n[81]||(n[81]=[T("Within 1 month",-1)])]),_:1}),s(t(be),{value:"Within 3 months"},{default:r(()=>[...n[82]||(n[82]=[T("Within 3 months",-1)])]),_:1}),s(t(be),{value:"Within 6 months"},{default:r(()=>[...n[83]||(n[83]=[T("Within 6 months",-1)])]),_:1}),s(t(be),{value:"Just browsing"},{default:r(()=>[...n[84]||(n[84]=[T("Just browsing",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[85]||(n[85]=[T("Budget range (if discussed)?",-1)])]),_:1}),s(t(Lt),{modelValue:Q.value.budgetRange,"onUpdate:modelValue":n[20]||(n[20]=l=>Q.value.budgetRange=l)},{default:r(()=>[s(t(Vt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select budget range"})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"Under €30k"},{default:r(()=>[...n[86]||(n[86]=[T("Under €30k",-1)])]),_:1}),s(t(be),{value:"€30k-€50k"},{default:r(()=>[...n[87]||(n[87]=[T("€30k-€50k",-1)])]),_:1}),s(t(be),{value:"€50k-€80k"},{default:r(()=>[...n[88]||(n[88]=[T("€50k-€80k",-1)])]),_:1}),s(t(be),{value:"€80k+"},{default:r(()=>[...n[89]||(n[89]=[T("€80k+",-1)])]),_:1}),s(t(be),{value:"Not discussed"},{default:r(()=>[...n[90]||(n[90]=[T("Not discussed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",rr,[e("label",ur,[Ge(e("input",{type:"checkbox","onUpdate:modelValue":n[21]||(n[21]=l=>Q.value.hasTradeIn=l),class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[hn,Q.value.hasTradeIn]]),n[91]||(n[91]=e("span",{class:"text-sm font-medium text-body"},"Trade in?",-1))]),s(t(at),{modelValue:Q.value.tradeInModel,"onUpdate:modelValue":n[22]||(n[22]=l=>Q.value.tradeInModel=l),disabled:!Q.value.hasTradeIn,placeholder:"Car brand and model",class:"w-full h-10 min-h-10"},null,8,["modelValue","disabled"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[92]||(n[92]=[T("Financing?",-1)])]),_:1}),s(t(Lt),{modelValue:Q.value.financingOption,"onUpdate:modelValue":n[23]||(n[23]=l=>Q.value.financingOption=l)},{default:r(()=>[s(t(Vt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select financing option"})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"FIN"},{default:r(()=>[...n[93]||(n[93]=[T("Captive Financing",-1)])]),_:1}),s(t(be),{value:"LEA"},{default:r(()=>[...n[94]||(n[94]=[T("Leasing",-1)])]),_:1}),s(t(be),{value:"LTR"},{default:r(()=>[...n[95]||(n[95]=[T("Long-Term Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[96]||(n[96]=[T("Additional notes",-1)])]),_:1}),s(t(lt),{modelValue:Q.value.additionalNotes,"onUpdate:modelValue":n[24]||(n[24]=l=>Q.value.additionalNotes=l),rows:"4",class:"w-full",placeholder:"Any relevant information about customer interest or preferences..."},null,8,["modelValue"])])]),e("div",dr,[s(t(Y),{label:"Save",variant:"primary",size:"small",onClick:Ie})])]),e("div",cr,[n[100]||(n[100]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},[T("Qualification method "),e("span",{class:"text-red-600"},"*")],-1)),e("div",mr,[e("label",{class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(Qe)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":n[25]||(n[25]=l=>At(Qe)?Qe.value=l:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[vt,t(Qe)]]),n[98]||(n[98]=e("span",{class:"text-sm text-heading"},"Assign only",-1))],2),e("label",{class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(Qe)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":n[26]||(n[26]=l=>At(Qe)?Qe.value=l:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[vt,t(Qe)]]),n[99]||(n[99]=e("span",{class:"text-sm text-heading"},"Assign and schedule",-1))],2)])]),t(Qe)==="assign-only"?(p(),C("div",pr,[e("div",vr,[n[105]||(n[105]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",fr,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[101]||(n[101]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:Ht.value,"onUpdate:modelValue":n[27]||(n[27]=l=>Ht.value=l),items:Ds.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:l})=>[e("div",yr,[e("span",gr,I(l.dealership||"No location"),1),n[102]||(n[102]=e("span",{class:"text-sub"},"→",-1)),e("span",br,I(l.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[103]||(n[103]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ze),{modelValue:Qt.value,"onUpdate:modelValue":n[28]||(n[28]=l=>Qt.value=l),items:Yt.value,disabled:!t(Ue),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:l})=>[e("div",hr,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(l.role)])},I(K(l.name)),3),e("span",xr,I(l.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[104]||(n[104]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:te.value,"onUpdate:modelValue":n[29]||(n[29]=l=>te.value=l),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])])):L("",!0),t(Qe)==="assign-and-schedule"?(p(),C("div",wr,[e("div",kr,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...n[106]||(n[106]=[T("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:t(Ee),"onUpdate:modelValue":n[30]||(n[30]=l=>At(Ee)?Ee.value=l:null),items:Ys.value,placeholder:t(o)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:r(({item:l})=>[e("span",null,I(l.label),1)]),_:1},8,["modelValue","items","placeholder"])]),t(Ee)?(p(),C("div",Sr,[n[110]||(n[110]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Cr,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[107]||(n[107]=[T("Team",-1)])]),_:1}),s(t(Ze),{modelValue:Ht.value,"onUpdate:modelValue":n[31]||(n[31]=l=>Ht.value=l),items:Ds.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:l})=>[e("div",$r,[e("span",Dr,I(l.dealership||"No location"),1),n[108]||(n[108]=e("span",{class:"text-sub"},"→",-1)),e("span",Ar,I(l.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[109]||(n[109]=[T("Salesperson (optional)",-1)])]),_:1}),s(t(Ze),{modelValue:Qt.value,"onUpdate:modelValue":n[32]||(n[32]=l=>Qt.value=l),items:Yt.value,disabled:!t(Ue),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:l})=>[e("div",Tr,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(l.role)])},I(K(l.name)),3),e("span",Or,I(l.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):L("",!0),t(Ee)&&t(Ue)?(p(),C("div",Ir,[e("h5",Nr,[T(I(t(o)("forms.schedule.title"))+" ",1),n[111]||(n[111]=e("span",{class:"text-red-600"},"*",-1))]),e("div",Vr,[e("div",Mr,[e("div",qr,[e("div",Lr,[e("button",{onClick:Ks,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...n[112]||(n[112]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",Fr,I(Hs.value),1),e("button",{onClick:Ts,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...n[113]||(n[113]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",Ur,[(p(),C(Le,null,ze(As,l=>e("div",{key:l,class:"text-center text-xs font-medium text-sub py-2"},I(l),1)),64))]),e("div",_r,[(p(!0),C(Le,null,ze(Qs.value,(l,i)=>(p(),C("div",{key:i,onClick:_=>Zs(l),class:J(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Gs(l)?"bg-[#0470e9] text-white cursor-pointer":l?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},I(l),11,Er))),128))])]),e("div",Rr,[e("h6",jr,I(Js.value),1),t(Pe)&&es.value.length>0?(p(),C("div",Br,[(p(!0),C(Le,null,ze(es.value,l=>(p(),C("button",{key:l,onClick:i=>rt.value=l,class:J(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",t(rt)===l?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(l),11,Wr))),128))])):t(Pe)&&es.value.length===0?(p(),C("div",Pr,I(t(o)("forms.schedule.timeSlots.noSlots")),1)):(p(),C("div",zr,I(t(o)("forms.schedule.timeSlots.selectDate")),1))])])])])):L("",!0),s(Kn,{appointment:{type:t(Ee),date:t(Pe),time:t(rt),duration:t(Nt)},customer:a.lead.customer,salesperson:t(mt),team:t(Ue),dealership:(Z=t(Ue))!=null&&Z.dealership?{name:t(Ue).dealership}:null,onUpdate:$s},null,8,["appointment","customer","salesperson","team","dealership"])])):L("",!0),t(Ce)&&t(Qe)==="assign-only"?(p(),C("div",Yr,[n[118]||(n[118]=Un('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-sm">Existing Appointment</h5></div><span class="text-sm font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Hr,[e("div",null,[n[114]||(n[114]=e("span",{class:"text-body"},"Date:",-1)),e("span",Qr,I(t(Rt)(a.lead.scheduledAppointment.start)),1)]),e("div",null,[n[115]||(n[115]=e("span",{class:"text-body"},"Time:",-1)),e("span",Jr,I(t(ms)(a.lead.scheduledAppointment.start)),1)]),e("div",null,[n[116]||(n[116]=e("span",{class:"text-body"},"Type:",-1)),e("span",Gr,I(a.lead.scheduledAppointment.type),1)]),e("div",null,[n[117]||(n[117]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Zr,I(a.lead.scheduledAppointment.assignee),1)])]),s(t(Y),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:n[33]||(n[33]=l=>ie.value=!0)})])):L("",!0)])):L("",!0)])),t(W)&&!t(Xe)&&t(W)!=="not-valid"?(p(),C("div",Kr,[s(t(Y),{variant:"secondary",onClick:t(He)},{default:r(()=>[...n[120]||(n[120]=[T(" Cancel ",-1)])]),_:1},8,["onClick"]),s(t(Y),{variant:"primary",disabled:!Ns.value,onClick:sn,class:"bg-primary"},{default:r(()=>[T(I(tn.value),1)]),_:1},8,["disabled"])])):L("",!0)])],64)),s(Rn,{ref_key:"noteWidgetRef",ref:ye,modal:"",show:t(se),item:null,"task-type":"lead","task-id":a.lead.id,onSave:t(rn),onClose:n[34]||(n[34]=l=>se.value=!1),onCancel:n[35]||(n[35]=l=>se.value=!1)},null,8,["show","task-id","onSave"]),s(To,{show:t(ie),"preselected-assignee":t(ne).assignee,onConfirm:t(Vs),onClose:n[36]||(n[36]=l=>ie.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),s(Pn,{show:fe.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:we,onClose:n[37]||(n[37]=l=>fe.value=!1)},null,8,["show"]),s(jn,{show:q.value,"task-type":"lead","task-id":a.lead.id,onSave:cn,onClose:n[38]||(n[38]=l=>q.value=!1)},null,8,["show","task-id"]),s(Bn,{show:D.value,mode:"tradein","task-type":"lead","task-id":a.lead.id,"customer-id":a.lead.customerId,onClose:n[39]||(n[39]=l=>D.value=!1),onSave:mn},null,8,["show","task-id","customer-id"]),s(Cn,{show:M.value,title:"AI Information Extraction",onClose:n[40]||(n[40]=l=>M.value=!1)},null,8,["show"])])}}},eu={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},tu={class:"flex justify-between items-start mb-3"},su={class:"text-fluid-xs text-body mt-0.5"},nu={key:0},au={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(a,{emit:V}){const o=a,m=V,v=Pt(),d=()=>{var U;const F=v.currentLead;return F&&F.id===((U=o.lead)==null?void 0:U.id)?F:o.lead},y={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},f=zn(vs(o,"lead"),y),{handlePostponed:w,handleValidated:u,handleQualified:h,handleCallAttemptLogged:$,handleNoteSaved:c,handleOpenPurchaseMethod:x,handleOpenTradeIn:g,handleAppointmentScheduled:b,handleDisqualified:N,handleReopen:k}=El({getLead:d,leadState:f,emit:m}),E=async F=>{var U;(U=o.lead)!=null&&U.id&&await v.loadLeadById(o.lead.id)};return(F,U)=>(p(),me(Yn,{task:a.lead,"hide-title":"","hide-border":""},{"primary-action":r(()=>[t(f).isClosed.value?L("",!0):(p(),me(Qn,{key:0,task:a.lead,"task-type":"lead",onReassigned:E,class:"mb-3"},null,8,["task"])),!t(f).isClosed.value&&t(f).showLQWidget.value?(p(),me(Xr,{key:a.lead.id,lead:a.lead,"show-deadline-banner":t(f).showDeadlineBanner.value,onPostponed:t(w),onValidated:t(u),onQualified:t(h),onDisqualified:t(N),onCallAttemptLogged:t($),onNoteSaved:t(c),onOpenPurchaseMethod:t(x),onOpenTradeIn:t(g),onAppointmentScheduled:t(b)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!t(f).isClosed.value&&t(f).primaryAction.value?(p(),me(Hn,{key:2,action:t(f).primaryAction.value,"color-scheme":t(f).primaryAction.value.colorScheme,onActionClicked:t(f).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]),"task-widgets":r(()=>[...U[0]||(U[0]=[])]),"closed-state":r(()=>[t(f).isClosed.value?(p(),C("div",eu,[e("div",tu,[e("div",null,[U[1]||(U[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",su,[T(" Status: "+I(t(f).displayStage.value)+" ",1),a.lead.disqualifyReason?(p(),C("span",nu," - "+I(a.lead.disqualifyReason),1)):L("",!0)])])]),s(t(Y),{variant:"primary",size:"small",onClick:t(k),class:"flex items-center gap-2"},{default:r(()=>[...U[2]||(U[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):L("",!0)]),_:1},8,["task"]))}},lu={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ou={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},iu={class:"p-4"},ru={class:"flex justify-between items-start mb-3"},uu={class:"font-bold text-heading text-fluid-sm"},du={class:"text-fluid-xs text-sub mt-0.5"},cu={class:"flex gap-3 flex-wrap"},Kt={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!1,default:()=>({background:"",border:""})}},setup(a){return(V,o)=>(p(),C("div",lu,[e("div",ou,[e("div",iu,[e("div",ru,[e("div",null,[e("h4",uu,I(a.title),1),e("p",du,I(a.description),1)]),xt(V.$slots,"badge")]),e("div",cu,[xt(V.$slots,"actions")]),xt(V.$slots,"survey"),xt(V.$slots,"content")])])]))}},mu={key:1,class:"space-y-4"},pu={class:"flex items-center justify-between"},vu={class:"space-y-4"},fu={class:"block text-fluid-sm font-medium text-body"},yu=["onUpdate:modelValue","placeholder"],gu={key:2,class:"space-y-2"},bu=["onUpdate:modelValue","value"],hu={class:"flex gap-2 flex-wrap justify-end pt-2"},Ss={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V,v=A(o.initialExpanded),d=A({});$e(()=>o.questions,h=>{const $={};h.forEach(c=>{$[c.key]=""}),d.value=$},{immediate:!0});const y=()=>{m("survey-completed",{...d.value}),u()},f=()=>{m("survey-refused"),u()},w=()=>{m("not-responding"),u()},u=()=>{v.value=!1;const h={};o.questions.forEach($=>{h[$.key]=""}),d.value=h};return(h,$)=>(p(),C("div",null,[v.value?(p(),C("div",mu,[e("div",pu,[$[4]||($[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:$[1]||($[1]=c=>v.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...$[3]||($[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",vu,[(p(!0),C(Le,null,ze(a.questions,(c,x)=>(p(),C("div",{key:x,class:"space-y-2"},[e("label",fu,I(c.label),1),c.type==="text"?Ge((p(),C("textarea",{key:0,"onUpdate:modelValue":g=>d.value[c.key]=g,placeholder:c.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,yu)),[[ra,d.value[c.key]]]):c.type==="select"?(p(),me(t(Lt),{key:1,modelValue:d.value[c.key],"onUpdate:modelValue":g=>d.value[c.key]=g},{default:r(()=>[s(t(Vt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select an option..."})]),_:1}),s(t(qt),null,{default:r(()=>[(p(!0),C(Le,null,ze(c.options,g=>(p(),me(t(be),{key:g,value:g},{default:r(()=>[T(I(g),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):c.type==="radio"?(p(),C("div",gu,[(p(!0),C(Le,null,ze(c.options,g=>(p(),C("label",{key:g,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[Ge(e("input",{type:"radio","onUpdate:modelValue":b=>d.value[c.key]=b,value:g,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,bu),[[vt,d.value[c.key]]]),T(" "+I(g),1)]))),128))])):L("",!0)]))),128)),e("div",hu,[s(t(Y),{label:"Complete Survey",variant:"primary",size:"small",onClick:y,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),s(t(Y),{label:"Customer Refused",variant:"outline",size:"small",onClick:f}),s(t(Y),{label:"Not Responding",variant:"outline",size:"small",onClick:w})])])])):(p(),C("button",{key:0,onClick:$[0]||($[0]=c=>v.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...$[2]||($[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},xu={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V,v=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],d=S(()=>{if(!o.opportunity.createdAt)return 0;const $=new Date(o.opportunity.createdAt),x=Math.abs(new Date-$);return Math.ceil(x/(1e3*60*60*24))}),y=()=>{m("create-offer",o.opportunity)},f=()=>{m("review",o.opportunity)},w=$=>{m("survey-completed",{opportunity:o.opportunity,responses:$})},u=()=>{m("survey-refused",{opportunity:o.opportunity})},h=()=>{m("not-responding",{opportunity:o.opportunity})};return($,c)=>(p(),me(Kt,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${d.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:r(()=>[e("button",{onClick:y,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Review Opportunity ")]),survey:r(()=>[s(Ss,{questions:v,onSurveyCompleted:w,onSurveyRefused:u,onNotResponding:h})]),_:1},8,["description"]))}},wu={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V,v=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],d=S(()=>{if(!o.opportunity.createdAt)return 0;const h=new Date(o.opportunity.createdAt),c=Math.abs(new Date-h);return Math.ceil(c/(1e3*60*60*24))}),y=()=>{m("create-offer",o.opportunity)},f=h=>{m("survey-completed",{opportunity:o.opportunity,responses:h})},w=()=>{m("survey-refused",{opportunity:o.opportunity})},u=()=>{m("not-responding",{opportunity:o.opportunity})};return(h,$)=>(p(),me(Kt,{title:"Unsold Feedback",description:`This opportunity has been open for ${d.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:r(()=>[e("button",{onClick:y,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:r(()=>[s(Ss,{questions:v,onSurveyCompleted:f,onSurveyRefused:w,onNotResponding:u})]),_:1},8,["description"]))}},ku={class:"space-y-4"},Su={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cu={class:"flex flex-wrap gap-3"},$u={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Du={key:1},Au={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["appointment-scheduled","close-as-lost","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=A(null),y=A(null),f=S(()=>{var h;return d.value==="schedule"?!1:d.value==="close-lost"&&((h=y.value)==null?void 0:h.canSubmit)||!1});async function w(){var h;d.value==="schedule"?v("appointment-scheduled",{opportunity:m.opportunity}):d.value==="close-lost"&&((h=y.value)==null||h.submit())}function u(h){v("close-as-lost",{opportunity:m.opportunity,reason:h.reason})}return V({canSubmit:f,submit:w}),(h,$)=>(p(),C("div",ku,[$[6]||($[6]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"No Follow-Up Task"),e("p",{class:"text-sm text-body"}," 5+ days in negotiation with no future appointment scheduled. Schedule an appointment to move forward or close as lost. ")],-1)),e("div",Su,[$[4]||($[4]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Choose Action",-1)),e("div",Cu,[s(t(Y),{variant:"outline",onClick:$[0]||($[0]=c=>d.value="schedule"),class:J(["flex-1",d.value==="schedule"?"border-purple-500 bg-purple-50 text-purple-700":""])},{default:r(()=>[...$[2]||($[2]=[e("i",{class:"fa-solid fa-calendar-plus mr-2"},null,-1),T(" Schedule Appointment ",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:$[1]||($[1]=c=>d.value="close-lost"),class:J(["flex-1",d.value==="close-lost"?"border-red-500 bg-red-50 text-red-700":""])},{default:r(()=>[...$[3]||($[3]=[e("i",{class:"fa-solid fa-xmark mr-2"},null,-1),T(" Close as Lost ",-1)])]),_:1},8,["class"])])]),d.value==="schedule"?(p(),C("div",$u,[...$[5]||($[5]=[e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Schedule Appointment",-1),e("p",{class:"text-sm text-sub"}," This will reuse the full schedule appointment form from the Awaiting Appointment stage. ",-1)])])):L("",!0),d.value==="close-lost"?(p(),C("div",Du,[s($n,{ref_key:"closeFormRef",ref:y,item:a.opportunity,"item-type":"opportunity",onClose:u},null,8,["item"])])):L("",!0)]))}},Tu={key:0},Ou={class:"flex items-center justify-between mb-2"},Iu={class:"flex items-center gap-2"},Nu={class:"font-semibold text-heading text-sm"},Vu={class:"relative"},Mu={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},qu={class:"w-full h-16 bg-surfaceSecondary flex items-center justify-center overflow-hidden"},Lu=["src"],Fu={key:1,class:"fa-solid fa-car text-base text-sub"},Uu={class:"p-2 space-y-1.5"},_u={class:"font-bold text-heading text-xs leading-tight line-clamp-2 mb-0.5"},Eu={class:"text-sm font-bold text-heading"},Ru={class:"text-xs text-sub"},ju={key:0,class:"pt-1"},Bu={key:1,class:"text-center py-6 px-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},Wu={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted"],setup(a,{emit:V}){const o=f=>f?new Intl.NumberFormat("en-US").format(f):"0",m=f=>{if(!f)return"";const w=new Date(f),h=Math.abs(new Date-w),$=Math.ceil(h/(1e3*60*60*24));return $===0?"today":$===1?"yesterday":$<7?`${$} days ago`:w.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},v=f=>({active:"Active",accepted:"Accepted",archived:"Archived"})[f]||"Active",d=f=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[f]||"bg-gray-600",y=f=>f.status==="accepted"?"border-green-500 border-2":"border-E5E7EB";return(f,w)=>a.offers.length>0?(p(),C("div",Tu,[e("div",Ou,[e("div",Iu,[w[0]||(w[0]=e("i",{class:"fa-solid fa-file-invoice-dollar text-sub text-xs"},null,-1)),e("h3",Nu,"Offers ("+I(a.offers.length)+")",1)])]),e("div",Vu,[e("div",Mu,[(p(!0),C(Le,null,ze(a.offers,u=>{var h;return p(),C("div",{key:u.id,class:J(["flex-none w-36 snap-start bg-white border rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow relative",y(u)])},[e("div",{class:J(["absolute top-1 right-1 z-10 text-white text-xs font-bold px-1.5 py-0.5 rounded shadow-sm",d(u.status)])},I(v(u.status)),3),e("div",qu,[(h=u.data)!=null&&h.image?(p(),C("img",{key:0,src:u.data.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Lu)):(p(),C("i",Fu))]),e("div",Uu,[e("div",null,[e("h4",_u,I(u.vehicleBrand)+" "+I(u.vehicleModel)+" ("+I(u.vehicleYear)+") ",1),e("p",Eu,"€ "+I(o(u.price)),1),e("p",Ru,I(m(u.createdAt)),1)]),u.status==="active"?(p(),C("div",ju,[s(t(Y),{variant:"primary",size:"small",onClick:Rs($=>f.$emit("offer-accepted",u),["stop"]),class:"w-full text-xs h-7"},{default:r(()=>[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-check text-xs mr-1"},null,-1),T(" Mark as accepted ",-1)])]),_:1},8,["onClick"])])):L("",!0)])],2)}),128))])])])):(p(),C("div",Bu,[...w[2]||(w[2]=[e("i",{class:"fa-solid fa-file-invoice text-2xl text-sub mb-2"},null,-1),e("p",{class:"text-xs font-medium text-body"},"No offers created yet",-1),e("p",{class:"text-xs text-sub mt-0.5"},"Create an offer to start negotiations",-1)])]))}},Xn=Wt(Wu,[["__scopeId","data-v-240d4fdb"]]),Pu={class:"space-y-4"},zu={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Yu={class:"text-sm text-body"},Hu={key:0,class:"mb-4"},Qu={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ju={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},Gu={key:0,class:"space-y-3"},Zu={key:0},Ku={class:"flex items-center justify-between gap-2"},Xu={class:"text-sub text-xs"},ed={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["offer-accepted","offer-deleted","view-offer","send-message"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=A(null),y=A(""),f=A(null),w=S(()=>{const g=m.opportunity.lastActivity||m.opportunity.createdAt;if(!g)return 0;const b=new Date(g),k=Math.abs(new Date-b);return Math.ceil(k/(1e3*60*60*24))}),u=S(()=>!m.opportunity.offers||m.opportunity.offers.length===0?[]:m.opportunity.offers.filter(g=>g.status==="active").map(g=>({id:g.id,label:`${g.vehicleBrand} ${g.vehicleModel} (${g.vehicleYear})`,price:g.price,value:g.id}))),h=S(()=>d.value&&y.value.trim().length>0);function $(g){return g?new Intl.NumberFormat("en-US").format(g):"0"}function c(g){v("offer-accepted",g)}async function x(){h.value&&(v("send-message",{channel:d.value,message:y.value,offerId:f.value}),d.value=null,y.value="",f.value=null)}return V({canSubmit:h,submit:x}),(g,b)=>(p(),C("div",Pu,[e("div",zu,[b[6]||(b[6]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"Offer Feedback Task",-1)),e("p",Yu," This opportunity has been in negotiation for "+I(w.value)+" days without a contract. Follow up with customer to get feedback and move forward. ",1)]),a.opportunity.offers&&a.opportunity.offers.length>0?(p(),C("div",Hu,[s(Xn,{offers:a.opportunity.offers,"opportunity-id":a.opportunity.id,onOfferAccepted:c},null,8,["offers","opportunity-id"])])):L("",!0),e("div",Qu,[b[13]||(b[13]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",Ju,[s(t(Y),{variant:"outline",onClick:b[0]||(b[0]=N=>d.value="call"),class:J(["flex items-center justify-center gap-2",d.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[7]||(b[7]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[1]||(b[1]=N=>d.value="whatsapp"),class:J(["flex items-center justify-center gap-2",d.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[8]||(b[8]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[2]||(b[2]=N=>d.value="sms"),class:J(["flex items-center justify-center gap-2",d.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[9]||(b[9]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[3]||(b[3]=N=>d.value="email"),class:J(["flex items-center justify-center gap-2",d.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[10]||(b[10]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),d.value?(p(),C("div",Gu,[u.value.length>0?(p(),C("div",Zu,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[11]||(b[11]=[T("Select offer to reference",-1)])]),_:1}),s(t(Ze),{modelValue:f.value,"onUpdate:modelValue":b[4]||(b[4]=N=>f.value=N),items:u.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:r(({item:N})=>[e("div",Ku,[e("span",null,I(N.label),1),e("span",Xu,"€ "+I($(N.price)),1)])]),_:1},8,["modelValue","items"])])):L("",!0),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[12]||(b[12]=[T("Message",-1)])]),_:1}),s(t(lt),{modelValue:y.value,"onUpdate:modelValue":b[5]||(b[5]=N=>y.value=N),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):L("",!0)])]))}},td={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V,v=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],d=S(()=>{var g;if(!((g=o.opportunity)!=null&&g.contractDate))return 0;const $=new Date(o.opportunity.contractDate),x=Math.abs(new Date-$);return Math.ceil(x/(1e3*60*60*24))}),y=()=>{m("prepare-delivery",o.opportunity)},f=()=>{m("pre-delivery-checklist",o.opportunity)},w=$=>{m("survey-completed",{opportunity:o.opportunity,responses:$})},u=()=>{m("survey-refused",{opportunity:o.opportunity})},h=()=>{m("not-responding",{opportunity:o.opportunity})};return($,c)=>(p(),me(Kt,{title:"Contract Feedback",description:`Contract was signed ${d.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:r(()=>[e("button",{onClick:y,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Prepare for Delivery "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:r(()=>[s(Ss,{questions:v,onSurveyCompleted:w,onSurveyRefused:u,onNotResponding:h})]),_:1},8,["description"]))}},sd={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V,v=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],d=S(()=>{const h=o.activities.find(g=>{var b;return g.type==="delivery"||((b=g.action)==null?void 0:b.toLowerCase().includes("delivered"))});if(!h||!h.timestamp)return 0;const $=new Date(h.timestamp),x=Math.abs(new Date-$);return Math.ceil(x/(1e3*60*60*24))}),y=()=>{m("delivery-feedback",o.opportunity)},f=h=>{m("survey-completed",{opportunity:o.opportunity,responses:h})},w=()=>{m("survey-refused",{opportunity:o.opportunity})},u=()=>{m("not-responding",{opportunity:o.opportunity})};return(h,$)=>(p(),me(Kt,{title:"Delivery Feedback",description:`Vehicle was delivered ${d.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:r(()=>[e("button",{onClick:y,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Delivery Feedback ")]),survey:r(()=>[s(Ss,{questions:v,onSurveyCompleted:f,onSurveyRefused:w,onNotResponding:u})]),_:1},8,["description"]))}},nd={key:0,class:"mt-4 pt-4 border-t border-black/5"},ad={class:"grid grid-cols-2 gap-4"},ld={class:"flex items-center gap-2"},od={class:"text-sub"},id={class:"font-medium text-heading"},rd={class:"flex items-center gap-2"},ud={class:"font-medium text-heading"},dd={class:"mt-4"},cd={class:"mt-4 flex justify-end"},md={key:1,class:"mt-4 pt-4 border-t border-black/5"},pd={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},vd={class:"flex justify-end"},fd={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["not-responding","auto-close-lost","set-callback","assigned","close-as-lost"],setup(a,{emit:V}){const o=a,m=V,v=Ut(),d=Tt(),y=Ft(),f=A(null),w=A(null),u=A(""),h=S(()=>v.assignableUsers),$=S(()=>v.assignableTeams),c=S(()=>$.value.map(D=>({...D,label:`${D.dealership||"No location"} → ${D.name}`,value:D.id}))),x=S(()=>{var j;if(!f.value)return[];const D=f.value;return(((j=h.value)==null?void 0:j.filter(H=>H.team===D.name||H.teamId===D.id))||[]).map(H=>({...H,label:H.name,value:H.id}))}),g=S({get:()=>{var D;return((D=f.value)==null?void 0:D.id)||null},set:D=>{var j;if(!D){f.value=null;return}const M=(j=$.value)==null?void 0:j.find(H=>H.id===D);f.value=M||null,M&&(w.value=null)}}),b=S({get:()=>{var D;return((D=w.value)==null?void 0:D.id)||null},set:D=>{if(!D){w.value=null;return}const M=x.value.find(j=>j.id===D);w.value=M||null}}),N=D=>D?D.split(" ").map(M=>M[0]).join("").toUpperCase().substring(0,2):"?",k=D=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[D]||"bg-surfaceSecondary text-body";async function E(){var j,H,le;if(!f.value)return;const D=((j=w.value)==null?void 0:j.name)||((H=f.value)==null?void 0:H.name),M={assignee:D};u.value&&(M.assignmentNote=u.value),await y.updateOpportunity(o.opportunity.id,M),await y.addActivity(o.opportunity.id,{type:"assignment",user:((le=d.currentUser)==null?void 0:le.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${D}${u.value?` with note: ${u.value}`:""}`,timestamp:new Date().toISOString()}),m("assigned",{opportunity:o.opportunity,assignee:D,note:u.value}),f.value=null,w.value=null,u.value=""}function F(){m("close-as-lost",{opportunity:o.opportunity,reason:"Multiple no shows"})}ks(()=>{var D,M,j;if(o.opportunity.assignee&&!f.value&&!w.value){const H=(D=h.value)==null?void 0:D.find(Q=>Q.name===o.opportunity.assignee),le=(M=$.value)==null?void 0:M.find(Q=>Q.name===o.opportunity.assignee);if(H){const Q=(j=$.value)==null?void 0:j.find(xe=>xe.name===H.team||xe.id===H.teamId);Q&&(f.value=Q,w.value=H)}else le&&(f.value=le)}o.opportunity.assignmentNote&&(u.value=o.opportunity.assignmentNote)}),$e(()=>o.opportunity.assignee,D=>{var M,j,H;if(D&&!f.value&&!w.value){const le=(M=h.value)==null?void 0:M.find(xe=>xe.name===D),Q=(j=$.value)==null?void 0:j.find(xe=>xe.name===D);if(le){const xe=(H=$.value)==null?void 0:H.find(Me=>Me.name===le.team||Me.id===le.teamId);xe&&(f.value=xe,w.value=le)}else Q&&(f.value=Q)}});const U=S(()=>{var D;return((D=o.scheduledAppointment)==null?void 0:D.noShowCount)||0}),ye=S(()=>{const D=U.value;return D===0||D===1?"NS1":D===2?"NS2":D>=3?"NS3":`NS${D}`}),fe=S(()=>{const D=U.value;return D>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":D>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),q=S(()=>{var M;return(M=o.scheduledAppointment)!=null&&M.start?new Date(o.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return(D,M)=>(p(),me(Kt,{title:ye.value,description:`Appointment was scheduled for ${q.value} but customer did not show up. ${fe.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{content:r(()=>[U.value<3?(p(),C("div",nd,[M[8]||(M[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",ad,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[3]||(M[3]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:g.value,"onUpdate:modelValue":M[0]||(M[0]=j=>g.value=j),items:c.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:j})=>[e("div",ld,[e("span",od,I(j.dealership||"No location"),1),M[4]||(M[4]=e("span",{class:"text-sub"},"→",-1)),e("span",id,I(j.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[5]||(M[5]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ze),{modelValue:b.value,"onUpdate:modelValue":M[1]||(M[1]=j=>b.value=j),items:x.value,disabled:!f.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:j})=>[e("div",rd,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",k(j.role)])},I(N(j.name)),3),e("span",ud,I(j.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",dd,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[6]||(M[6]=[T("Note for sellers",-1)])]),_:1}),s(t(lt),{modelValue:u.value,"onUpdate:modelValue":M[2]||(M[2]=j=>u.value=j),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the sellers..."},null,8,["modelValue"])]),e("div",cd,[s(t(Y),{variant:"primary",disabled:!f.value,onClick:E,class:"bg-primary"},{default:r(()=>[...M[7]||(M[7]=[T(" Assign ",-1)])]),_:1},8,["disabled"])])])):L("",!0),U.value>=3?(p(),C("div",md,[e("div",pd,[M[9]||(M[9]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),M[10]||(M[10]=e("p",{class:"text-sm text-body mb-4"}," This is the third no-show. The opportunity should be closed as lost. ",-1)),e("div",vd,[s(t(Y),{label:"Close Opportunity as Lost",variant:"primary",size:"small",onClick:F})])])])):L("",!0)]),_:1},8,["title","description"]))}},yd={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(a,{emit:V}){const o=a,m=V;kn();const v=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],d=S(()=>{const c=o.opportunity.lastActivity||o.opportunity.createdAt;if(!c)return 0;const x=new Date(c),b=Math.abs(new Date-x);return Math.ceil(b/(1e3*60*60*24))}),y=()=>{m("reopen",o.opportunity)},f=()=>{m("close-lost",{opportunity:o.opportunity,reason:"Abandoned - no activity for extended period"})},w=()=>{m("requalify",o.opportunity)},u=c=>{m("survey-completed",{opportunity:o.opportunity,responses:c})},h=()=>{m("survey-refused",{opportunity:o.opportunity})},$=()=>{m("not-responding",{opportunity:o.opportunity})};return(c,x)=>(p(),me(Kt,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${d.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:r(()=>[e("button",{onClick:y,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...x[0]||(x[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),T(" Reopen Opportunity ",-1)])]),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...x[1]||(x[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),T(" Close as Lost ",-1)])]),e("button",{onClick:w,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...x[2]||(x[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),T(" Requalify as Lead ",-1)])])]),survey:r(()=>[s(Ss,{questions:v,onSurveyCompleted:u,onSurveyRefused:h,onNotResponding:$})]),_:1},8,["description"]))}},gd={OOFB:xu,UFB:wu,NFU:Au,OFB:ed,CFB:td,DFB:sd,NS:fd,ABANDONED:yd};function bd(a,V,o,m,v){const d=S(()=>{const c=_s(a),x=_s(V),g=_s(o);return{opportunity:c,scheduledAppointment:x,activities:g,hasOffers:c.offers&&c.offers.length>0||(g==null?void 0:g.some(b=>b.type==="offer"))||!1,stage:c.displayStage||c.stage,deliverySubstatus:c.deliverySubstatus||null,formatDateTime:v,hasActiveTaskWidget:!1}}),y=S(()=>{const c=d.value,x=Ta(c.stage,c);if(!x)return null;const g=gd[x];return g?{type:x,component:g,props:{opportunity:c.opportunity,appointment:c.scheduledAppointment,activities:c.activities}}:null}),f=S(()=>({...d.value,hasActiveTaskWidget:!!y.value})),w=S(()=>{const c=f.value,x=Oa(c.stage,c);if(!x)return null;const g=m[x.key];return{...x,handler:g||(()=>{})}}),u=S(()=>{const c=f.value;return Ia(c.stage,c).map(g=>{const b=m[g.key];return{...g,handler:b||(()=>{})}})}),h=S(()=>{const c=d.value;return Na(c.stage)}),$=S(()=>!y.value||!y.value.type?"":Va(y.value.type));return{primaryAction:w,secondaryActions:u,activeTaskWidget:y,taskWidgetTitle:$,isClosed:h}}const hd={class:"relative"},xd=["disabled"],wd={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},qn={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(a,{emit:V}){const o=a,m=V,v=A(!1),d=()=>{v.value=!v.value},y=()=>{v.value=!1},f=u=>{u.disabled||(y(),m("action-selected",u),u.handler&&typeof u.handler=="function"&&u.handler())},w=S(()=>(o.actions||[]).map(u=>({key:u.key,label:u.label,disabled:!!u.disabled,onClick:()=>f(u)})));return(u,h)=>{const $=En("click-outside");return p(),C("div",hd,[e("button",{onClick:Rs(d,["stop"]),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!a.actions||a.actions.length===0},[h[0]||(h[0]=e("span",null,"More actions",-1)),e("i",{class:J(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":v.value}])},null,2)],8,xd),v.value&&w.value.length>0?Ge((p(),C("div",wd,[s(t(bn),{items:w.value,className:"w-56"},null,8,["items"])])),[[$,y]]):L("",!0)])}}},kd={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Sd={class:"space-y-2"},Cd={class:"space-y-2"},$d={class:"space-y-2"},Dd={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(a,{emit:V}){const o=a,m=V,v=A(""),d=A(""),y=A(""),f=S(()=>new Date().toISOString().split("T")[0]);$e(()=>o.show,$=>{if($){const c=new Date;v.value=c.toISOString().split("T")[0],d.value=c.toTimeString().slice(0,5),y.value=""}});const w=()=>{if(!v.value)return;const $=d.value?`${v.value}T${d.value}:00`:`${v.value}T12:00:00`;m("confirm",{contractDate:$,notes:y.value})},u=()=>{m("cancel")},h=$=>{$||u()};return($,c)=>(p(),me(t(ws),{open:a.show,"onUpdate:open":h},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...c[3]||(c[3]=[T("Set Contract Signing Date",-1)])]),_:1})]),_:1}),e("div",kd,[e("div",Sd,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...c[4]||(c[4]=[T("Contract Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=x=>v.value=x),max:f.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Cd,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...c[5]||(c[5]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=x=>d.value=x),class:"w-full h-10"},null,8,["modelValue"])]),e("div",$d,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...c[6]||(c[6]=[T("Notes (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:y.value,"onUpdate:modelValue":c[2]||(c[2]=x=>y.value=x),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u}),s(t(Y),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!v.value,onClick:w},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ad={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Td={class:"space-y-2"},Od={class:"space-y-2"},Id={class:"space-y-2"},Nd={class:"space-y-2"},Vd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(a,{emit:V}){const o=a,m=V,v=A(""),d=A(""),y=A(""),f=A(""),w=S(()=>new Date().toISOString().split("T")[0]);$e(()=>o.show,c=>{if(c){const x=new Date;v.value=x.toISOString().split("T")[0],d.value=x.toTimeString().slice(0,5),y.value="",f.value=""}});const u=()=>{if(!v.value||!y.value)return;const c=d.value?`${v.value}T${d.value}:00`:`${v.value}T12:00:00`;m("confirm",{deliveryDate:c,location:y.value,notes:f.value})},h=()=>{m("cancel")},$=c=>{c||h()};return(c,x)=>(p(),me(t(ws),{open:a.show,"onUpdate:open":$},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...x[4]||(x[4]=[T("Mark as Delivered",-1)])]),_:1})]),_:1}),e("div",Ad,[e("div",Td,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[5]||(x[5]=[T("Delivery Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:v.value,"onUpdate:modelValue":x[0]||(x[0]=g=>v.value=g),max:w.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Od,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[6]||(x[6]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:d.value,"onUpdate:modelValue":x[1]||(x[1]=g=>d.value=g),class:"w-full h-10"},null,8,["modelValue"])]),e("div",Id,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[7]||(x[7]=[T("Delivery Location",-1)])]),_:1}),s(t(Lt),{modelValue:y.value,"onUpdate:modelValue":x[2]||(x[2]=g=>y.value=g)},{default:r(()=>[s(t(Vt),{class:"w-full h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select location..."})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"Dealership"},{default:r(()=>[...x[8]||(x[8]=[T("At Dealership",-1)])]),_:1}),s(t(be),{value:"Customer Address"},{default:r(()=>[...x[9]||(x[9]=[T("Customer Address",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...x[10]||(x[10]=[T("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Nd,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[11]||(x[11]=[T("Delivery Notes",-1)])]),_:1}),s(t(lt),{modelValue:f.value,"onUpdate:modelValue":x[3]||(x[3]=g=>f.value=g),rows:"4",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:h}),s(t(Y),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!v.value||!y.value,onClick:u},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Md={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},qd={class:"space-y-2"},Ld={class:"space-y-2"},Ln={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0},preselectedReason:{type:String,default:""}},emits:["confirm","cancel"],setup(a,{emit:V}){const o=a,m=V,v=A(""),d=A("");$e(()=>o.show,u=>{u&&(o.preselectedReason?v.value=o.preselectedReason:v.value="",d.value="")}),$e(()=>o.preselectedReason,u=>{u&&o.show&&(v.value=u)});const y=()=>{v.value&&m("confirm",{reason:v.value,notes:d.value})},f=()=>{m("cancel")},w=u=>{u||f()};return(u,h)=>(p(),me(t(ws),{open:a.show,"onUpdate:open":w},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...h[2]||(h[2]=[T("Close as Lost",-1)])]),_:1})]),_:1}),e("div",Md,[e("div",qd,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[3]||(h[3]=[T("Reason",-1)])]),_:1}),s(t(Lt),{modelValue:v.value,"onUpdate:modelValue":h[0]||(h[0]=$=>v.value=$)},{default:r(()=>[s(t(Vt),{class:"w-full h-10"},{default:r(()=>[s(t(Mt),{placeholder:"Select a reason..."})]),_:1}),s(t(qt),null,{default:r(()=>[s(t(be),{value:"Multiple no shows"},{default:r(()=>[...h[4]||(h[4]=[T("Multiple no shows",-1)])]),_:1}),s(t(be),{value:"Not interested"},{default:r(()=>[...h[5]||(h[5]=[T("Not interested",-1)])]),_:1}),s(t(be),{value:"Budget constraints"},{default:r(()=>[...h[6]||(h[6]=[T("Budget constraints",-1)])]),_:1}),s(t(be),{value:"Found better price"},{default:r(()=>[...h[7]||(h[7]=[T("Found better price at competitor",-1)])]),_:1}),s(t(be),{value:"No response"},{default:r(()=>[...h[8]||(h[8]=[T("Customer not responding",-1)])]),_:1}),s(t(be),{value:"Wrong timing"},{default:r(()=>[...h[9]||(h[9]=[T("Timing not right",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...h[10]||(h[10]=[T("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Ld,[s(t(G),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[11]||(h[11]=[T("Additional Notes",-1)])]),_:1}),s(t(lt),{modelValue:d.value,"onUpdate:modelValue":h[1]||(h[1]=$=>d.value=$),rows:"5",placeholder:"Add any relevant details about why this opportunity was lost...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f}),s(t(Y),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!v.value,onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Fd={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(a,{emit:V}){const o=V,m=v=>{v||o("cancel")};return(v,d)=>(p(),me(t(ws),{open:a.show,"onUpdate:open":m},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...d[2]||(d[2]=[T("Requalify as Lead",-1)])]),_:1})]),_:1}),d[3]||(d[3]=e("div",{class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),T(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),T(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),T(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[0]||(d[0]=y=>v.$emit("cancel"))}),s(t(Y),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:d[1]||(d[1]=y=>v.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ud={class:"space-y-4"},_d={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ed={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Rd={class:"grid grid-cols-2 gap-4"},jd={class:"flex items-center gap-2"},Bd={class:"text-sub"},Wd={class:"font-medium text-heading"},Pd={class:"flex items-center gap-2"},zd={class:"font-medium text-heading"},Yd={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Hd={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},Qd={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},Jd={class:"p-6"},Gd={class:"flex items-center justify-between mb-4"},Zd={class:"text-sm font-semibold text-heading"},Kd={class:"grid grid-cols-7 gap-1 mb-2"},Xd={class:"grid grid-cols-7 gap-1"},ec=["onClick"],tc={class:"p-6"},sc={class:"text-sm font-semibold text-heading mb-4"},nc={key:0,class:"space-y-2"},ac=["onClick"],lc={key:1,class:"text-sm text-sub py-4 text-center"},oc={key:2,class:"text-sm text-sub py-4 text-center"},ic={class:"flex justify-end gap-2 px-4 pb-4 pt-3"},gn={__name:"OpportunityScheduleForm",props:{opportunity:{type:Object,required:!0},mode:{type:String,validator:a=>["schedule","reschedule"].includes(a),default:"schedule"},initialAppointment:{type:Object,default:null}},emits:["submit","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=Ut(),y=A(""),f=A(null),w=A(""),u=A(null),h=A(null),$=A(null),c=A(""),x=A(new Date().getMonth()),g=A(new Date().getFullYear()),b=A({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),N=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],k={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},E=S(()=>N.map(R=>({value:R.value,label:R.label}))),F=S(()=>{const R=[];for(let B=9*60;B<=18*60;B+=30){const oe=String(Math.floor(B/60)).padStart(2,"0"),X=String(B%60).padStart(2,"0");R.push(`${oe}:${X}`)}return R}),U=S(()=>{if($.value!=null)return $.value;const R=parseInt(c.value,10);return Number.isFinite(R)&&R>0?R:null}),ye=S(()=>m.mode==="reschedule"?"Reschedule and Save":"Schedule and Save"),fe=S(()=>!!(y.value&&f.value&&w.value&&u.value)),q=["MON","TUE","WED","THU","FRI","SAT","SUN"],D=S(()=>new Date(g.value,x.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),M=S(()=>{const R=new Date(g.value,x.value,1),oe=new Date(g.value,x.value+1,0).getDate(),X=R.getDay()===0?6:R.getDay()-1,W=[];for(let se=0;se<X;se++)W.push(null);for(let se=1;se<=oe;se++)W.push(se);return W}),j=S(()=>{if(!f.value)return"Select a date";const R=f.value,B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${B[R.getDay()]}, ${oe[R.getMonth()]} ${R.getDate()}`}),H=S(()=>d.assignableUsers),le=S(()=>d.assignableTeams),Q=S(()=>le.value.map(R=>({...R,label:`${R.dealership||"No location"} → ${R.name}`,value:R.id}))),xe=S(()=>{var oe;if(!u.value)return[];const R=u.value;return(((oe=H.value)==null?void 0:oe.filter(X=>X.team===R.name||X.teamId===R.id))||[]).map(X=>({...X,label:X.name,value:X.id}))}),Me=S({get:()=>{var R;return((R=u.value)==null?void 0:R.id)||null},set:R=>{var oe;if(!R){u.value=null,h.value=null;return}const B=(oe=le.value)==null?void 0:oe.find(X=>X.id===R);u.value=B||null,B&&ee(`team-${B.id}`)}}),pe=S({get:()=>{var R;return((R=h.value)==null?void 0:R.id)||null},set:R=>{if(!R){h.value=null;return}const B=xe.value.find(oe=>oe.id===R);h.value=B||null,B&&ee(`user-${B.id}`)}}),te=S(()=>{if(!f.value)return[];const R=f.value.toISOString().split("T")[0];if(h.value){const B=Bt(`user-${h.value.id}`,R);return F.value.filter(oe=>B.includes(oe))}if(u.value){const B=Bt(`team-${u.value.id}`,R);return F.value.filter(oe=>B.includes(oe))}return F.value||[]});function K(R){return R?R.split(" ").map(B=>B[0]).join("").toUpperCase().substring(0,2):"?"}function re(R){return{manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"}[R]||"bg-surfaceSecondary text-body"}function we(R){if(!R)return;const B=new Date(g.value,x.value,R);f.value=B,w.value=""}function Ie(R){if(!R||!f.value)return!1;const B=f.value;return B.getDate()===R&&B.getMonth()===x.value&&B.getFullYear()===g.value}function et(){x.value===0?(x.value=11,g.value--):x.value--}function P(){x.value===11?(x.value=0,g.value++):x.value++}function ee(R){const B=new Date;B.setHours(0,0,0,0);for(let oe=0;oe<30;oe++){const X=new Date(B);if(X.setDate(B.getDate()+oe),X.getDay()===0||X.getDay()===6)continue;const W=X.toISOString().split("T")[0],se=Bt(R,W);if(se!=null&&se.length){f.value=X,x.value=X.getMonth(),g.value=X.getFullYear();const ie=F.value.filter(ke=>se.includes(ke));ie.length&&(w.value=ie[0]);break}}}function Be(R){b.value=R}function Re(){We(),v("cancel")}function We(){y.value="",f.value=null,w.value="",u.value=null,h.value=null,$.value=null,c.value="",b.value={immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}}function De(R){var B,oe,X;if(R){if(y.value=R.type||"",R.assignee){const W=(B=H.value)==null?void 0:B.find(ie=>ie.name===R.assignee),se=(oe=le.value)==null?void 0:oe.find(ie=>ie.name===R.assignee);if(W){const ie=(X=le.value)==null?void 0:X.find(ke=>ke.name===W.team||ke.id===W.teamId);ie&&(u.value=ie,h.value=W)}else se&&(u.value=se)}if(R.start){const W=new Date(R.start),se=new Date(W.getFullYear(),W.getMonth(),W.getDate());f.value=se,x.value=W.getMonth(),g.value=W.getFullYear();const ie=W.getHours(),ke=W.getMinutes(),de=ke<15?0:ke<45?30:60,Fe=de===60?ie+1:ie,Oe=de===60?0:de,Ae=`${String(Fe).padStart(2,"0")}:${String(Oe).padStart(2,"0")}`;if(F.value.includes(Ae))w.value=Ae;else{const Ne=Fe*60+Oe,Ye=F.value.reduce((st,ne)=>{const[ae,ge]=ne.split(":").map(Number),Se=ae*60+ge;if(!st)return ne;const[Ce,Ve]=st.split(":").map(Number),He=Ce*60+Ve;return Math.abs(Se-Ne)<Math.abs(He-Ne)?ne:st},null);w.value=Ye||F.value[0]||""}}if(R.duration){const W=R.duration;W===15?$.value=15:W===30?$.value=30:W===60?$.value=60:($.value=null,c.value=String(W))}}}$e(y,R=>{if(!R)return;const B=k[R];if(B&&(B===15?$.value=15:B===30?$.value=30:B===60?$.value=60:($.value=null,c.value=String(B)),!f.value)){const oe=new Date;oe.setHours(0,0,0,0),f.value=oe,x.value=oe.getMonth(),g.value=oe.getFullYear()}}),$e(f,()=>{w.value=""}),$e(()=>m.opportunity.assignee,R=>{var X,W,se;if(!R||u.value||h.value)return;const B=(X=H.value)==null?void 0:X.find(ie=>ie.name===R),oe=(W=le.value)==null?void 0:W.find(ie=>ie.name===R);if(B){const ie=(se=le.value)==null?void 0:se.find(ke=>ke.name===B.team||ke.id===B.teamId);ie&&(u.value=ie,h.value=B)}else oe&&(u.value=oe)},{immediate:!0}),ks(()=>{m.mode==="reschedule"&&m.initialAppointment&&De(m.initialAppointment)});function Te(){fe.value&&v("submit",{eventType:y.value,selectedDate:f.value,selectedSlot:w.value,selectedTeam:u.value,selectedSalesman:h.value,durationValue:U.value,communicationPreferences:b.value})}return V({resetForm:We}),(R,B)=>{var oe;return p(),C("div",Ud,[e("div",_d,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...B[3]||(B[3]=[T("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:y.value,"onUpdate:modelValue":B[0]||(B[0]=X=>y.value=X),items:E.value,placeholder:"Select event type...","value-key":"value",class:"w-full"},{item:r(({item:X})=>[e("span",null,I(X.label),1)]),_:1},8,["modelValue","items"])]),y.value?(p(),C("div",Ed,[B[7]||(B[7]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Rd,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...B[4]||(B[4]=[T("Team",-1)])]),_:1}),s(t(Ze),{modelValue:Me.value,"onUpdate:modelValue":B[1]||(B[1]=X=>Me.value=X),items:Q.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:X})=>[e("div",jd,[e("span",Bd,I(X.dealership||"No location"),1),B[5]||(B[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Wd,I(X.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...B[6]||(B[6]=[T("Salesperson (optional)",-1)])]),_:1}),s(t(Ze),{modelValue:pe.value,"onUpdate:modelValue":B[2]||(B[2]=X=>pe.value=X),items:xe.value,disabled:!u.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:X})=>[e("div",Pd,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(X.role)])},I(K(X.name)),3),e("span",zd,I(X.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):L("",!0),y.value&&u.value?(p(),C("div",Yd,[B[10]||(B[10]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},[T("Schedule "),e("span",{class:"text-red-600"},"*")],-1)),e("div",Hd,[e("div",Qd,[e("div",Jd,[e("div",Gd,[e("button",{type:"button",onClick:et,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...B[8]||(B[8]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",Zd,I(D.value),1),e("button",{type:"button",onClick:P,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...B[9]||(B[9]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",Kd,[(p(),C(Le,null,ze(q,X=>e("div",{key:X,class:"text-center text-xs font-semibold text-sub py-1"},I(X),1)),64))]),e("div",Xd,[(p(!0),C(Le,null,ze(M.value,(X,W)=>(p(),C("div",{key:W,onClick:se=>X&&we(X),class:J(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Ie(X)?"bg-primary text-white cursor-pointer":X?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},I(X),11,ec))),128))])]),e("div",tc,[e("h6",sc,I(j.value),1),f.value&&te.value.length>0?(p(),C("div",nc,[(p(!0),C(Le,null,ze(te.value,X=>(p(),C("button",{key:X,type:"button",onClick:W=>w.value=X,class:J(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",w.value===X?"border-primary bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-primary/30"])},I(X),11,ac))),128))])):f.value&&te.value.length===0?(p(),C("div",lc," No available time slots for this date ")):(p(),C("div",oc," Select a date to see available time slots "))])])])])):L("",!0),y.value&&u.value?(p(),me(Kn,{key:2,appointment:{type:y.value,date:f.value,time:w.value,duration:U.value},customer:a.opportunity.customer,salesperson:h.value,team:u.value,dealership:(oe=u.value)!=null&&oe.dealership?{name:u.value.dealership}:null,onUpdate:Be},null,8,["appointment","customer","salesperson","team","dealership"])):L("",!0),e("div",ic,[s(t(Y),{variant:"secondary",onClick:Re},{default:r(()=>[...B[11]||(B[11]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!fe.value,onClick:Te,class:"bg-primary"},{default:r(()=>[T(I(ye.value),1)]),_:1},8,["disabled"])])])}}},rc={class:"space-y-4"},uc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},dc={class:"text-sm text-body"},cc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mc={class:"grid grid-cols-2 gap-4"},pc={class:"flex items-center gap-2"},vc={class:"text-sub"},fc={class:"font-medium text-heading"},yc={class:"flex items-center gap-2"},gc={class:"font-medium text-heading"},bc={class:"mt-4"},hc={__name:"NS1Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=Ut(),y=Tt(),f=Ft(),w=A(null),u=A(null),h=A(""),$=S(()=>d.assignableUsers),c=S(()=>d.assignableTeams),x=S(()=>c.value.map(q=>({...q,label:`${q.dealership||"No location"} → ${q.name}`,value:q.id}))),g=S(()=>{var M;if(!w.value)return[];const q=w.value;return(((M=$.value)==null?void 0:M.filter(j=>j.team===q.name||j.teamId===q.id))||[]).map(j=>({...j,label:j.name,value:j.id}))}),b=S({get:()=>{var q;return((q=w.value)==null?void 0:q.id)||null},set:q=>{var M;if(!q){w.value=null;return}const D=(M=c.value)==null?void 0:M.find(j=>j.id===q);w.value=D||null,D&&(u.value=null)}}),N=S({get:()=>{var q;return((q=u.value)==null?void 0:q.id)||null},set:q=>{if(!q){u.value=null;return}const D=g.value.find(M=>M.id===q);u.value=D||null}}),k=q=>q?q.split(" ").map(D=>D[0]).join("").toUpperCase().substring(0,2):"?",E=q=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[q]||"bg-surfaceSecondary text-body",F=S(()=>!!w.value);async function U(){var M,j,H;if(!F.value)return;const q=((M=u.value)==null?void 0:M.name)||((j=w.value)==null?void 0:j.name),D={assignee:q};h.value&&(D.assignmentNote=h.value),await f.updateOpportunity(m.opportunity.id,D),await f.addActivity(m.opportunity.id,{type:"assignment",user:((H=y.currentUser)==null?void 0:H.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${q}${h.value?` with note: ${h.value}`:""}`,timestamp:new Date().toISOString()}),v("assigned",{opportunity:m.opportunity,assignee:q,note:h.value})}V({canSubmit:F,submit:U});const ye=S(()=>"Follow up with customer to understand the situation and book another appointment."),fe=S(()=>{var D;return(D=m.scheduledAppointment)!=null&&D.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ks(()=>{var q,D,M;if(m.opportunity.assignee&&!w.value&&!u.value){const j=(q=$.value)==null?void 0:q.find(le=>le.name===m.opportunity.assignee),H=(D=c.value)==null?void 0:D.find(le=>le.name===m.opportunity.assignee);if(j){const le=(M=c.value)==null?void 0:M.find(Q=>Q.name===j.team||Q.id===j.teamId);le&&(w.value=le,u.value=j)}else H&&(w.value=H)}m.opportunity.assignmentNote&&(h.value=m.opportunity.assignmentNote)}),$e(()=>m.opportunity.assignee,q=>{var D,M,j;if(q&&!w.value&&!u.value){const H=(D=$.value)==null?void 0:D.find(Q=>Q.name===q),le=(M=c.value)==null?void 0:M.find(Q=>Q.name===q);if(H){const Q=(j=c.value)==null?void 0:j.find(xe=>xe.name===H.team||xe.id===H.teamId);Q&&(w.value=Q,u.value=H)}else le&&(w.value=le)}}),(q,D)=>(p(),C("div",rc,[e("div",uc,[D[3]||(D[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"1st No-Show Follow-up Task",-1)),e("p",dc," Appointment was scheduled for "+I(fe.value)+" but customer did not show up. "+I(ye.value),1)]),e("div",cc,[D[8]||(D[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",mc,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[4]||(D[4]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:b.value,"onUpdate:modelValue":D[0]||(D[0]=M=>b.value=M),items:x.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",pc,[e("span",vc,I(M.dealership||"No location"),1),D[5]||(D[5]=e("span",{class:"text-sub"},"→",-1)),e("span",fc,I(M.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[6]||(D[6]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ze),{modelValue:N.value,"onUpdate:modelValue":D[1]||(D[1]=M=>N.value=M),items:g.value,disabled:!w.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",yc,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",E(M.role)])},I(k(M.name)),3),e("span",gc,I(M.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",bc,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[7]||(D[7]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:h.value,"onUpdate:modelValue":D[2]||(D[2]=M=>h.value=M),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},xc={class:"space-y-4"},wc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},kc={class:"text-sm text-body"},Sc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cc={class:"grid grid-cols-2 gap-4"},$c={class:"flex items-center gap-2"},Dc={class:"text-sub"},Ac={class:"font-medium text-heading"},Tc={class:"flex items-center gap-2"},Oc={class:"font-medium text-heading"},Ic={class:"mt-4"},Nc={__name:"NS2Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=Ut(),y=Tt(),f=Ft(),w=A(null),u=A(null),h=A(""),$=S(()=>d.assignableUsers),c=S(()=>d.assignableTeams),x=S(()=>c.value.map(q=>({...q,label:`${q.dealership||"No location"} → ${q.name}`,value:q.id}))),g=S(()=>{var M;if(!w.value)return[];const q=w.value;return(((M=$.value)==null?void 0:M.filter(j=>j.team===q.name||j.teamId===q.id))||[]).map(j=>({...j,label:j.name,value:j.id}))}),b=S({get:()=>{var q;return((q=w.value)==null?void 0:q.id)||null},set:q=>{var M;if(!q){w.value=null;return}const D=(M=c.value)==null?void 0:M.find(j=>j.id===q);w.value=D||null,D&&(u.value=null)}}),N=S({get:()=>{var q;return((q=u.value)==null?void 0:q.id)||null},set:q=>{if(!q){u.value=null;return}const D=g.value.find(M=>M.id===q);u.value=D||null}}),k=q=>q?q.split(" ").map(D=>D[0]).join("").toUpperCase().substring(0,2):"?",E=q=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[q]||"bg-surfaceSecondary text-body",F=S(()=>!!w.value);async function U(){var M,j,H;if(!F.value)return;const q=((M=u.value)==null?void 0:M.name)||((j=w.value)==null?void 0:j.name),D={assignee:q};h.value&&(D.assignmentNote=h.value),await f.updateOpportunity(m.opportunity.id,D),await f.addActivity(m.opportunity.id,{type:"assignment",user:((H=y.currentUser)==null?void 0:H.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${q}${h.value?` with note: ${h.value}`:""}`,timestamp:new Date().toISOString()}),v("assigned",{opportunity:m.opportunity,assignee:q,note:h.value})}V({canSubmit:F,submit:U});const ye=S(()=>"This is the second no-show. Please make every effort to reach the customer and reschedule."),fe=S(()=>{var D;return(D=m.scheduledAppointment)!=null&&D.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ks(()=>{var q,D,M;if(m.opportunity.assignee&&!w.value&&!u.value){const j=(q=$.value)==null?void 0:q.find(le=>le.name===m.opportunity.assignee),H=(D=c.value)==null?void 0:D.find(le=>le.name===m.opportunity.assignee);if(j){const le=(M=c.value)==null?void 0:M.find(Q=>Q.name===j.team||Q.id===j.teamId);le&&(w.value=le,u.value=j)}else H&&(w.value=H)}m.opportunity.assignmentNote&&(h.value=m.opportunity.assignmentNote)}),$e(()=>m.opportunity.assignee,q=>{var D,M,j;if(q&&!w.value&&!u.value){const H=(D=$.value)==null?void 0:D.find(Q=>Q.name===q),le=(M=c.value)==null?void 0:M.find(Q=>Q.name===q);if(H){const Q=(j=c.value)==null?void 0:j.find(xe=>xe.name===H.team||xe.id===H.teamId);Q&&(w.value=Q,u.value=H)}else le&&(w.value=le)}}),(q,D)=>(p(),C("div",xc,[e("div",wc,[D[3]||(D[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"2nd No-Show Follow-up Task",-1)),e("p",kc," Appointment was scheduled for "+I(fe.value)+" but customer did not show up. "+I(ye.value),1)]),e("div",Sc,[D[8]||(D[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",Cc,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[4]||(D[4]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Ze),{modelValue:b.value,"onUpdate:modelValue":D[0]||(D[0]=M=>b.value=M),items:x.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",$c,[e("span",Dc,I(M.dealership||"No location"),1),D[5]||(D[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Ac,I(M.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[6]||(D[6]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Ze),{modelValue:N.value,"onUpdate:modelValue":D[1]||(D[1]=M=>N.value=M),items:g.value,disabled:!w.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",Tc,[e("div",{class:J(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",E(M.role)])},I(k(M.name)),3),e("span",Oc,I(M.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",Ic,[s(t(G),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[7]||(D[7]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:h.value,"onUpdate:modelValue":D[2]||(D[2]=M=>h.value=M),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},Vc={class:"space-y-4"},Mc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},qc={class:"text-sm text-body"},Lc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Fc={__name:"NS3Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["close-as-lost","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=A(null),y=S(()=>"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed."),f=S(()=>{var c;return(c=m.scheduledAppointment)!=null&&c.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),w=S(()=>{var $;return(($=d.value)==null?void 0:$.canSubmit)||!1});function u(){var $;($=d.value)==null||$.submit()}function h($){v("close-as-lost",{opportunity:m.opportunity,reason:$})}return V({canSubmit:w,submit:u}),($,c)=>(p(),C("div",Vc,[e("div",Mc,[c[0]||(c[0]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"3rd No-Show Follow-up Task",-1)),e("p",qc," Appointment was scheduled for "+I(f.value)+" but customer did not show up. "+I(y.value),1)]),e("div",Lc,[c[1]||(c[1]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),s($n,{ref_key:"closeFormRef",ref:d,"show-multiple-no-shows":!0,"preselected-reason":"Multiple no shows","close-button-label":"Close as Lost",onClose:h},null,512)])]))}},Uc={class:"space-y-4"},_c={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ec={__name:"OfferAssignmentTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["offer-created","cancel"],setup(a,{expose:V,emit:o}){const m=a,v=o,d=A(null),y=S(()=>m.opportunity.requestedCar||m.opportunity.vehicle||null),f=S(()=>{var h;return((h=d.value)==null?void 0:h.isValid)||!1});function w(){var h;(h=d.value)==null||h.submit()}function u(h){v("offer-created",{opportunity:m.opportunity,offerData:h})}return V({canSubmit:f,submit:w}),(h,$)=>(p(),C("div",Uc,[$[0]||($[0]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"Create Offer"),e("p",{class:"text-sm text-body"}," Customer showed up for the appointment. Create an offer to proceed with the opportunity. ")],-1)),e("div",_c,[s(Es,{item:null,"task-type":"opportunity","task-id":a.opportunity.id,"selected-vehicle":y.value,customer:a.opportunity.customer,"hide-header":!0,"hide-actions":!0,ref_key:"offerWidgetRef",ref:d,onSave:u},null,8,["task-id","selected-vehicle","customer"])])]))}},Rc={class:"space-y-6"},jc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Bc={class:"space-y-6"},Wc={class:"space-y-2"},Pc=["value"],zc={class:"text-sm text-heading"},Yc={class:"space-y-2"},Hc=["value"],Qc={class:"text-sm text-heading"},Jc={key:0},Gc={class:"space-y-2"},Zc=["value"],Kc={class:"text-sm text-heading"},Xc={class:"flex items-center gap-2"},em=["onClick"],tm={key:0,class:"text-sm text-body ml-2"},sm={class:"space-y-2"},nm=["value"],am={class:"text-sm text-heading"},lm={class:"flex items-center gap-2 mt-2"},om={class:"space-y-2"},im=["value"],rm={class:"text-sm text-heading"},um={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},dm={class:"space-y-4"},cm={class:"flex items-center gap-3"},mm={class:"flex items-center gap-3"},pm={class:"flex items-center gap-3"},vm={class:"flex items-center gap-3"},fm={__name:"PostDeliverySurvey",props:{opportunity:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{expose:V,emit:o}){const m=o,v=A({q1:"",q2:"",q3:"",q4:"",q5:null,q6:[],q6Other:!1,q6OtherText:"",q7:"",q8:""}),d=A({negativeSatisfaction:!1,issuesReported:!1,deliveryDelay:!1,highNPS:!1}),y=[{value:"very-satisfied",label:"Very Satisfied"},{value:"satisfied",label:"Satisfied"},{value:"neutral",label:"Neutral"},{value:"unsatisfied",label:"Unsatisfied"},{value:"very-unsatisfied",label:"Very Unsatisfied"}],f=[{value:"perfect",label:"Yes, perfect condition"},{value:"acceptable",label:"Yes, acceptable"},{value:"minor-issues",label:"There are minor issues"},{value:"major-issues",label:"There are major issues"}],w=[{value:"on-time",label:"Yes, on time"},{value:"early",label:"Yes, early"},{value:"delayed-minor",label:"No, delayed (minor - 1-3 days)"},{value:"delayed-major",label:"No, delayed (major - more than 3 days)"}],u=[{value:"keys",label:"Vehicle keys"},{value:"manual",label:"Owner's manual"},{value:"registration",label:"Registration documents"},{value:"warranty",label:"Service warranty information"},{value:"insurance",label:"Insurance documents"}],h=[{value:"definitely-yes",label:"Definitely Yes"},{value:"probably-yes",label:"Probably Yes"},{value:"not-sure",label:"Not Sure"},{value:"probably-not",label:"Probably Not"},{value:"definitely-not",label:"Definitely Not"}],$=S(()=>v.value.q2==="minor-issues"||v.value.q2==="major-issues");$e(()=>v.value.q1,g=>{g==="very-unsatisfied"||g==="unsatisfied"?d.value.negativeSatisfaction=!0:d.value.negativeSatisfaction=!1}),$e(()=>v.value.q3,g=>{g&&g.trim().length>0?d.value.issuesReported=!0:d.value.issuesReported=!1}),$e(()=>v.value.q4,g=>{g==="delayed-major"?d.value.deliveryDelay=!0:d.value.deliveryDelay=!1}),$e(()=>v.value.q7,g=>{g==="definitely-yes"?d.value.highNPS=!0:d.value.highNPS=!1});const c=S(()=>{var N,k;if(!v.value.q1||!v.value.q2||$.value&&!((N=v.value.q3)!=null&&N.trim()))return!1;const g=v.value.q6&&v.value.q6.length>0,b=v.value.q6Other&&((k=v.value.q6OtherText)==null?void 0:k.trim());return!(!g&&!b)});return V({submit:()=>{if(!c.value)return;const g={responses:{...v.value},triggerActions:{...d.value},timestamp:new Date().toISOString()};m("submit",g)},isValid:c}),(g,b)=>(p(),C("div",Rc,[e("div",jc,[b[22]||(b[22]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Post-Delivery Customer Satisfaction Survey",-1)),e("div",Bc,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[13]||(b[13]=[T(" How satisfied are you with your new vehicle delivery experience? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Wc,[(p(),C(Le,null,ze(y,N=>e("label",{key:N.value,class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",v.value.q1===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":b[0]||(b[0]=k=>v.value.q1=k),type:"radio",value:N.value,class:"shrink-0"},null,8,Pc),[[vt,v.value.q1]]),e("span",zc,I(N.label),1)],2)),64))])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[14]||(b[14]=[T(" Is the vehicle in the condition you expected? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Yc,[(p(),C(Le,null,ze(f,N=>e("label",{key:N.value,class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",v.value.q2===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":b[1]||(b[1]=k=>v.value.q2=k),type:"radio",value:N.value,class:"shrink-0"},null,8,Hc),[[vt,v.value.q2]]),e("span",Qc,I(N.label),1)],2)),64))])]),$.value?(p(),C("div",Jc,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[15]||(b[15]=[T(" Please describe the issues you found: ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(lt),{modelValue:v.value.q3,"onUpdate:modelValue":b[2]||(b[2]=N=>v.value.q3=N),rows:"4",placeholder:"Describe the issues...",class:"w-full"},null,8,["modelValue"])])):L("",!0),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[16]||(b[16]=[T(" Was the vehicle delivered on the scheduled date? ",-1)])]),_:1}),e("div",Gc,[(p(),C(Le,null,ze(w,N=>e("label",{key:N.value,class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",v.value.q4===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":b[3]||(b[3]=k=>v.value.q4=k),type:"radio",value:N.value,class:"shrink-0"},null,8,Zc),[[vt,v.value.q4]]),e("span",Kc,I(N.label),1)],2)),64))])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[17]||(b[17]=[T(" How would you rate the professionalism of our sales team during delivery? ",-1)])]),_:1}),e("div",Xc,[(p(),C(Le,null,ze(5,N=>e("button",{key:N,onClick:k=>v.value.q5=N,class:J(["text-2xl transition-colors",v.value.q5>=N?"text-yellow-500":"text-gray-300"])}," ⭐ ",10,em)),64)),v.value.q5?(p(),C("span",tm,I(v.value.q5)+" "+I(v.value.q5===1?"star":"stars"),1)):L("",!0)])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[18]||(b[18]=[T(" Did you receive all the required items? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",sm,[(p(),C(Le,null,ze(u,N=>e("label",{key:N.value,class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},[Ge(e("input",{"onUpdate:modelValue":b[4]||(b[4]=k=>v.value.q6=k),type:"checkbox",value:N.value,class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,8,nm),[[hn,v.value.q6]]),e("span",am,I(N.label),1)])),64)),e("div",lm,[Ge(e("input",{"onUpdate:modelValue":b[5]||(b[5]=N=>v.value.q6Other=N),type:"checkbox",class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[hn,v.value.q6Other]]),b[19]||(b[19]=e("span",{class:"text-sm text-heading"},"Other:",-1)),v.value.q6Other?(p(),me(t(at),{key:0,modelValue:v.value.q6OtherText,"onUpdate:modelValue":b[6]||(b[6]=N=>v.value.q6OtherText=N),placeholder:"Specify other item",class:"flex-1"},null,8,["modelValue"])):L("",!0)])])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[20]||(b[20]=[T(" Would you recommend our dealership to friends and family? ",-1)])]),_:1}),e("div",om,[(p(),C(Le,null,ze(h,N=>e("label",{key:N.value,class:J(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",v.value.q7===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ge(e("input",{"onUpdate:modelValue":b[7]||(b[7]=k=>v.value.q7=k),type:"radio",value:N.value,class:"shrink-0"},null,8,im),[[vt,v.value.q7]]),e("span",rm,I(N.label),1)],2)),64))])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[21]||(b[21]=[T(" Internal notes for follow-up actions: ",-1),e("span",{class:"text-xs text-sub ml-1"},"(Private - only for internal staff)",-1)])]),_:1}),s(t(lt),{modelValue:v.value.q8,"onUpdate:modelValue":b[8]||(b[8]=N=>v.value.q8=N),rows:"4",placeholder:"Add internal notes...",class:"w-full"},null,8,["modelValue"])])])]),e("div",um,[b[31]||(b[31]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Trigger Actions (Email Notifications)",-1)),e("div",dm,[e("div",cm,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-negative-satisfaction",modelValue:d.value.negativeSatisfaction,"onUpdate:modelValue":b[9]||(b[9]=N=>d.value.negativeSatisfaction=N)},null,8,["modelValue"]),b[23]||(b[23]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Sales Manager + Branch Manager ",-1))]),_:1}),b[24]||(b[24]=e("span",{class:"text-xs text-sub"},"(Q1 = Very Unsatisfied/Unsatisfied)",-1))]),e("div",mm,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-issues",modelValue:d.value.issuesReported,"onUpdate:modelValue":b[10]||(b[10]=N=>d.value.issuesReported=N)},null,8,["modelValue"]),b[25]||(b[25]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Service Department ",-1))]),_:1}),b[26]||(b[26]=e("span",{class:"text-xs text-sub"},"(Q3 = Issues reported)",-1))]),e("div",pm,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-delay",modelValue:d.value.deliveryDelay,"onUpdate:modelValue":b[11]||(b[11]=N=>d.value.deliveryDelay=N)},null,8,["modelValue"]),b[27]||(b[27]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Delivery Coordinator ",-1))]),_:1}),b[28]||(b[28]=e("span",{class:"text-xs text-sub"},"(Q4 = Delayed major)",-1))]),e("div",vm,[s(t(G),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-nps",modelValue:d.value.highNPS,"onUpdate:modelValue":b[12]||(b[12]=N=>d.value.highNPS=N)},null,8,["modelValue"]),b[29]||(b[29]=e("span",{class:"text-sm font-medium text-heading"}," ✅ Email to Marketing ",-1))]),_:1}),b[30]||(b[30]=e("span",{class:"text-xs text-sub"},"(Q7 = Definitely Yes)",-1))])])])]))}},ym={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},gm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},bm={class:"p-4"},hm={class:"mb-3"},xm={class:"text-sm text-body mt-0.5"},wm={class:"flex flex-wrap gap-3 items-center"},km={key:0,class:"mt-4"},Sm={key:0,class:"mt-4"},Cm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},$m={key:0,class:"mt-4"},Dm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Am={key:2,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Tm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Om={class:"p-4"},Im={class:"mb-3"},Nm={class:"text-sm text-body mt-0.5"},Vm={class:"mb-4"},Mm={class:"flex flex-wrap gap-3 items-center"},qm={key:0,class:"mt-4 space-y-4"},Lm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Fm={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},Um={key:0,class:"space-y-3"},_m={class:"flex items-center justify-between gap-2"},Em={class:"text-sub text-xs"},Rm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},jm={key:0,class:"mt-4"},Bm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Wm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Pm={key:3,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},zm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ym={class:"p-4"},Hm={class:"flex flex-wrap gap-3 items-center"},Qm={class:"relative"},Jm={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},Gm={key:0,class:"mt-4 px-4 pb-4"},Zm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Km={class:"space-y-4"},Xm={class:"flex justify-end gap-2 mt-4"},ep={key:0,class:"mt-4"},tp={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},sp={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},np={key:0,class:"mt-4 px-4 pb-4"},ap={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},lp={class:"space-y-4"},op={class:"flex justify-end gap-2 mt-4"},ip={key:0,class:"mt-4 px-4 pb-4"},rp={key:0,class:"space-y-4"},up={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},dp={class:"flex items-start gap-3"},cp={class:"flex-1"},mp={class:"text-sm text-body whitespace-pre-wrap"},pp={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},vp={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},fp={class:"p-4"},yp={class:"flex items-center gap-2 mb-3"},gp={class:"text-sm text-body font-medium"},bp={class:"px-4 py-4"},hp={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},xp={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},wp={class:"p-4"},kp={class:"flex flex-wrap gap-3 items-center"},Sp={class:"relative"},Cp={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},$p={key:0,class:"mt-4 px-4 pb-4"},Dp={class:"flex justify-end gap-2 mt-4"},Ap={key:2,class:"space-y-3"},Tp={class:"flex items-center gap-2 pb-2 border-b border"},Op={class:"font-semibold text-heading text-fluid-sm"},Ip={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},Np={class:"flex justify-between items-start mb-3"},Vp={class:"text-fluid-xs text-body mt-0.5"},Mp={key:0},qp={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled","appointment-cancelled","appointment-no-show"],setup(a,{emit:V}){const o=a,m=V,v=_n(),d=Ft();Ut();const y=Tt(),{t:f}=Sn(),w=()=>{var i;const l=d.currentOpportunity;return l&&l.id===((i=o.opportunity)==null?void 0:i.id)?l:o.opportunity},u=S(()=>{var l;return o.scheduledAppointment||((l=o.opportunity)==null?void 0:l.scheduledAppointment)||null}),h=S(()=>{if(u.value&&u.value.start)return!1;const l=ue.displayStage.value,i=l===Us.QUALIFIED,_=l===Us.AWAITING_APPOINTMENT;return(i||_)&&!ue.isClosed.value});S(()=>!u.value||!u.value.start?!1:new Date(u.value.start)<new Date&&u.value.status!=="completed");const $=S(()=>{const l=o.opportunity,i=ue.displayStage.value;return l.stage==="Closed Won"||i==="Closed Won"}),c=S(()=>{const l=o.opportunity,i=ue.displayStage.value;return l.stage==="Closed Lost"||i==="Closed Lost"?!1:$.value}),x=Jn(),{isCallActive:g,callEnded:b,callDuration:N,callNotes:k,mockTranscription:E,formattedCallDuration:F,startCall:U,endCall:ye,copyNumber:fe}=x,q=()=>{U()},D=()=>{ye()},M=()=>{var l;fe(((l=o.opportunity.customer)==null?void 0:l.phone)||"")},j=l=>{k.value=l},H=()=>{x.callData.value={channel:"external",notes:"",transcription:null}},le=A(null),Q=()=>{K.value=!1},xe=()=>{var l;(l=le.value)==null||l.resetForm()};async function Me(l,i){var rs,us,Gt,ds,cs;const{eventType:_,selectedDate:ce,selectedSlot:ve,selectedTeam:z,selectedSalesman:he,durationValue:je,communicationPreferences:_e}=l,qe=o.opportunity,kt=ce,[pn,Jt]=ve.split(":").map(Number),Dt=new Date(kt);Dt.setHours(pn,Jt,0,0);const Et=je||30,as=new Date(Dt.getTime()+Et*6e4),ls=(he==null?void 0:he.name)||(z==null?void 0:z.name)||qe.assignee||"Unassigned",os=(he==null?void 0:he.id)||(z==null?void 0:z.id)||null,is=he?"user":"team";try{if(i==="reschedule"){const qs={title:`Appointment - ${((rs=qe.customer)==null?void 0:rs.name)||"Customer"}`,start:Dt.toISOString(),end:as.toISOString(),type:_,assignee:ls,customerId:qe.customerId,opportunityId:qe.id,duration:Et,status:"pending_confirmation"};let Ls={...qs};if((us=u.value)!=null&&us.id){const{updateCalendarEvent:fn}=await Zt(async()=>{const{updateCalendarEvent:ea}=await import("./users-CPXYaoWs.js").then(ta=>ta.i);return{updateCalendarEvent:ea}},__vite__mapDeps([3,1,2]));await fn(u.value.id,{...qs,status:"pending_confirmation"}),Ls.id=u.value.id}else{const fn=await yn({...qs,status:"pending_confirmation"});Ls={...qs,id:fn.id,status:"pending_confirmation"}}await d.updateOpportunity(qe.id,{scheduledAppointment:Ls}),m("appointment-scheduled",Ls),K.value=!1;return}const vn={customerId:qe.customerId||((Gt=qe.customer)==null?void 0:Gt.id),customer:((ds=qe.customer)==null?void 0:ds.name)||"Unknown",start:Dt.toISOString(),end:as.toISOString(),type:_,title:`${_} - ${((cs=qe.customer)==null?void 0:cs.name)||"Customer"}`,assigneeId:os,assigneeType:is,teamId:(z==null?void 0:z.id)||null,team:(z==null?void 0:z.name)||null,salesperson:(he==null?void 0:he.name)||null,salespersonId:(he==null?void 0:he.id)||null,duration:Et,opportunityId:qe.id},Dn=await yn(vn),An={id:Dn.id,start:Dt.toISOString(),end:as.toISOString(),type:_,assignee:ls,assigneeId:os,assigneeType:is,duration:Et,team:(z==null?void 0:z.name)||null,teamId:(z==null?void 0:z.id)||null,salesperson:(he==null?void 0:he.name)||null,salespersonId:(he==null?void 0:he.id)||null,communications:_e,status:"confirmed"};await d.updateOpportunity(qe.id,{scheduledAppointment:An}),m("appointment-scheduled",{...An,calendarEventId:Dn.id}),xe()}catch(vn){console.error("Failed to schedule/reschedule appointment:",vn)}}async function pe(){if(u.value)try{const l={...u.value,status:"confirmed"};if(u.value.id){const{updateCalendarEvent:i}=await Zt(async()=>{const{updateCalendarEvent:_}=await import("./users-CPXYaoWs.js").then(ce=>ce.i);return{updateCalendarEvent:_}},__vite__mapDeps([3,1,2]));await i(u.value.id,{status:"confirmed"})}await d.updateOpportunity(o.opportunity.id,{scheduledAppointment:l}),m("appointment-scheduled",l)}catch(l){console.error("Failed to confirm appointment:",l)}}const te=A(!1),K=A(!1),re=A(!1),we=A(!1),Ie=A(""),et=A(null),P=A(null),ee=A(null),Be=A(null),Re=A(!1),We=A(!1),De=A(null),Te=A(""),R=A(null),B=A(null),oe=A(!1),X=A(null),W=A(!1),se=A(!1),ie=A(!1),ke=A(!1),de=A(!1),Fe=A(!1),Oe=A(!1),Ae=A({contractDate:"",contractTime:"",notes:""}),Ne=A({newDeadline:"",reason:""}),Ye=A(null),st=A(null),ne=S(()=>[{key:"schedule-appointment",label:"Schedule Appointment",onClick:()=>{W.value=!1,te.value=!0}}]),ae=S(()=>[{key:"add-offer",label:"Add offer",onClick:()=>{Oe.value=!1,tn()}},{key:"extend-deadline",label:"Extend deadline",onClick:()=>{Oe.value=!1,an()}},{key:"close-as-lost",label:"Close as Lost",onClick:()=>{Oe.value=!1,de.value=!0}},{key:"schedule-appointment",label:"Schedule appointment",onClick:()=>{Oe.value=!1,on()}}]),ge=S(()=>{var i;const l=((i=u.value)==null?void 0:i.noShowCount)||0;return l===0&&re.value?(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning 1 (first no-show)"),1):(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning",l),l)});$e([K,re,we],([l,i,_])=>{console.log("[OpportunityManagementWidget] Section visibility changed:",{showRescheduleSection:l,showNsTaskSection:i,showOfferAssignmentSection:_,nsTaskCount:ge.value})});const Se=S(()=>{var _;return((_={1:et,2:P,3:ee}[ge.value].value)==null?void 0:_.canSubmit)||!1}),Ce=S(()=>ge.value===3?"Close as Lost":"Assign and Save"),Ve=S(()=>{var l;return((l=Be.value)==null?void 0:l.canSubmit)||!1}),He=S(()=>!opportunity.offers||opportunity.offers.length===0?[]:opportunity.offers.filter(l=>l.status==="active").map(l=>({id:l.id,label:`${l.vehicleBrand} ${l.vehicleModel} (${l.vehicleYear})`,price:l.price,value:l.id}))),ft=S(()=>De.value&&Te.value.trim().length>0),tt=A(!1),dt=A(!1),wt=A(!1),ot=A(!1),Ct=A(!1),Ke=A(!1),it=A(!1),yt=A(!1),gt=A(!1),$t=A([]);function Xe(l){return l?new Intl.NumberFormat("en-US").format(l):"0"}function Ot(l){return l?new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const Qe={"schedule-appointment":()=>{te.value=!0},"manage-appointment":()=>{u.value&&(yt.value=!0)},"view-or-schedule-appointment":()=>{u.value?yt.value=!0:te.value=!0},reschedule:()=>{u.value&&(gt.value=!0)},"cancel-appointment":()=>{Xt()},"mark-no-show":()=>{Ms()},"select-vehicle":()=>{Ke.value=!0},"create-offer":()=>{!o.opportunity.selectedVehicle&&!o.opportunity.vehicle?Ke.value=!0:tt.value=!0},"call-prospect":()=>{it.value=!0},"follow-up-offer":()=>{it.value=!0},"request-decision":()=>{it.value=!0},"finalize-contract":()=>{wt.value=!0},"schedule-delivery":()=>{ot.value=!0},"confirm-delivery":()=>{ot.value=!0},"collect-feedback":()=>{it.value=!0},reschedule:()=>{gt.value=!0},"cancel-appointment":()=>{Xt()},"close-won":()=>{wt.value=!0},"add-offer":()=>{tt.value=!0},"add-contract":()=>{wt.value=!0},"extend-deadline":()=>{it.value=!0},"close-lost":()=>{dt.value=!0},reopen:()=>{Nt()},requalify:()=>{Ct.value=!0}},Ee=bd(vs(o,"opportunity"),u,vs(o,"activities"),Qe,Ot),ue={isClosed:Ee.isClosed,primaryAction:S(()=>h.value||u.value&&u.value.start&&(ue.displayStage.value===Us.APPOINTMENT_SCHEDULED||ue.displayStage.value===Us.AWAITING_APPOINTMENT)?null:Ee.primaryAction.value),secondaryActions:Ee.secondaryActions,activeTaskWidget:S(()=>{if(h.value)return null;const l=Ee.activeTaskWidget.value;return l&&l.type==="NS"?null:l}),taskWidgetTitle:Ee.taskWidgetTitle,displayStage:S(()=>{var i;const l=ps(o.opportunity,"opportunity");return l||console.warn("No display stage calculated for opportunity:",(i=o.opportunity)==null?void 0:i.id),l}),showDeadlineBanner:S(()=>{var l;return!Ee.isClosed.value&&!!((l=o.opportunity)!=null&&l.nextActionDue)})},It=async l=>{var i;(i=o.opportunity)!=null&&i.id&&await d.fetchOpportunityById(o.opportunity.id)};function zt(){}function Pe(l){Ke.value=!1,m("vehicle-selected",l),setTimeout(()=>{tt.value=!0},300)}function rt(l){tt.value=!1,m("offer-created",l)}function Cs(l){te.value=!1,m("appointment-scheduled",{...l,opportunityId:o.opportunity.id,customer:o.opportunity.customer.name})}async function Xt(){if(u.value&&confirm("Are you sure you want to cancel this appointment?"))try{if(u.value.id){const{deleteCalendarEvent:l}=await Zt(async()=>{const{deleteCalendarEvent:i}=await import("./users-CPXYaoWs.js").then(_=>_.i);return{deleteCalendarEvent:i}},__vite__mapDeps([3,1,2]));await l(u.value.id)}await d.updateOpportunity(o.opportunity.id,{scheduledAppointment:null}),m("appointment-cancelled",u.value.id)}catch(l){console.error("Failed to cancel appointment:",l)}}function bt(l){wt.value=!1,d.updateOpportunity(o.opportunity.id,{stage:"Closed Won",contractDate:l.contractDate})}function ct(l){ot.value=!1,d.addActivity(o.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:l})}function ut(l){const i=typeof l=="string"?l:l.reason||l,_=typeof l=="object"?l.notes:"";dt.value=!1,Ie.value="",d.updateOpportunity(o.opportunity.id,{stage:"Closed Lost",lossReason:i,lossNotes:_})}function Nt(){d.updateOpportunity(o.opportunity.id,{stage:"Qualified"})}function Ue(l){Ct.value=!1,v.push(`/customer/${l.id}?type=lead`)}function mt(l){yt.value=!1}function js(l){gt.value=!1}function Bs({opportunity:l,callbackDate:i}){d.updateOpportunity(l.id,{callbackDate:i})}function $s({opportunity:l,assignee:i,note:_}){console.log("Opportunity assigned:",{opportunity:l,assignee:i,note:_})}function es(){var _;(_={1:et,2:P,3:ee}[ge.value].value)==null||_.submit()}function _t(){re.value=!1}async function Ws({opportunity:l,offerData:i}){var _,ce,ve,z,he;try{if((_=u.value)!=null&&_.id){const{updateCalendarEvent:je}=await Zt(async()=>{const{updateCalendarEvent:_e}=await import("./users-CPXYaoWs.js").then(qe=>qe.i);return{updateCalendarEvent:_e}},__vite__mapDeps([3,1,2]));await je(u.value.id,{status:"completed"})}await d.addOffer(l.id,{vehicleBrand:((ce=i.data)==null?void 0:ce.brand)||"",vehicleModel:((ve=i.data)==null?void 0:ve.model)||"",vehicleYear:((z=i.data)==null?void 0:z.year)||"",price:((he=i.data)==null?void 0:he.price)||0,data:i.data}),we.value=!1}catch(je){console.error("Failed to create offer:",je)}}function Ds(){var l;(l=Be.value)==null||l.submit()}function Yt(){we.value=!1}function Ht(){console.log("[OpportunityManagementWidget] handleFollowUpOffer called"),K.value=!1,re.value=!1,we.value=!1,We.value=!1,Re.value=!Re.value,Re.value||(De.value=null,Te.value="",R.value=null)}function Qt(){console.log("[OpportunityManagementWidget] handleAddAnotherOffer called"),K.value=!1,re.value=!1,we.value=!1,Re.value=!1,We.value=!We.value}async function ts(l){var i;console.log("[OpportunityManagementWidget] handleOfferAccepted called",l);try{await d.markOfferAccepted(opportunity.id,l.id),await d.addActivity(opportunity.id,{type:"offer-acceptance",user:((i=y.currentUser)==null?void 0:i.name)||"You",action:"accepted offer",content:`Offer accepted: ${l.vehicleBrand} ${l.vehicleModel} (${l.vehicleYear}) - € ${l.price.toLocaleString()}`,data:{offerId:l.id},timestamp:new Date().toISOString()}),Re.value=!1}catch(_){console.error("Failed to mark offer as accepted:",_)}}async function Ps(){var l,i;if(ft.value){console.log("[OpportunityManagementWidget] handleSendNegotiationMessage called",{channel:De.value,message:Te.value,offerId:R.value});try{const _=(l=opportunity.offers)==null?void 0:l.find(ve=>ve.id===R.value),ce=_?`${_.vehicleBrand} ${_.vehicleModel} (€${_.price.toLocaleString()})`:"offer";await d.addActivity(opportunity.id,{type:De.value,user:((i=y.currentUser)==null?void 0:i.name)||"You",action:`sent ${De.value}`,content:Te.value,data:{channel:De.value,offerId:R.value,offerReference:ce},timestamp:new Date().toISOString()}),Re.value=!1,De.value=null,Te.value="",R.value=null}catch(_){console.error("Failed to send negotiation message:",_)}}}function zs(){Re.value=!1,De.value=null,Te.value="",R.value=null}const Ys=S(()=>{var l;return((l=B.value)==null?void 0:l.isValid)||!1});async function nt(l){var i,_,ce,ve,z,he,je,_e,qe;console.log("[OpportunityManagementWidget] handleInlineOfferCreated called",l);try{await d.addOffer(opportunity.id,{vehicleBrand:((i=l.data)==null?void 0:i.brand)||"",vehicleModel:((_=l.data)==null?void 0:_.model)||"",vehicleYear:((ce=l.data)==null?void 0:ce.year)||"",price:((ve=l.data)==null?void 0:ve.price)||0,data:l.data}),await d.addActivity(opportunity.id,{type:"offer",user:((z=y.currentUser)==null?void 0:z.name)||"You",action:"created an offer",content:`Offer created: ${(he=l.data)==null?void 0:he.brand} ${(je=l.data)==null?void 0:je.model} (${(_e=l.data)==null?void 0:_e.year}) - € ${(((qe=l.data)==null?void 0:qe.price)||0).toLocaleString()}`,data:l.data,timestamp:new Date().toISOString()}),We.value=!1}catch(kt){console.error("Failed to create offer:",kt)}}function ht(){B.value&&B.value.submit()}function As(){We.value=!1,B.value}const Hs=S(()=>{var l;return((l=X.value)==null?void 0:l.isValid)||!1});async function Qs(l){var i,_,ce,ve,z;console.log("[OpportunityManagementWidget] handleSurveySubmit called",l);try{const he=w(),{responses:je,triggerActions:_e}=l;await d.addActivity(he.id,{type:"post-delivery-survey",user:((i=y.currentUser)==null?void 0:i.name)||"You",action:"completed post-delivery customer satisfaction survey",content:"Post-Delivery Customer Satisfaction Survey completed",data:{responses:je,triggerActions:_e,timestamp:l.timestamp},timestamp:l.timestamp});const qe=[];_e.negativeSatisfaction&&qe.push(d.addActivity(he.id,{type:"survey-trigger",user:((_=y.currentUser)==null?void 0:_.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager + Branch Manager (Negative satisfaction)",data:{trigger:"negative-satisfaction",recipients:["Sales Manager","Branch Manager"],surveyResponse:je.q1},timestamp:new Date().toISOString()})),_e.issuesReported&&qe.push(d.addActivity(he.id,{type:"survey-trigger",user:((ce=y.currentUser)==null?void 0:ce.name)||"You",action:"triggered email notification",content:"Email sent to Service Department (Issues reported)",data:{trigger:"issues-reported",recipients:["Service Department"],issueDescription:je.q3},timestamp:new Date().toISOString()})),_e.deliveryDelay&&qe.push(d.addActivity(he.id,{type:"survey-trigger",user:((ve=y.currentUser)==null?void 0:ve.name)||"You",action:"triggered email notification",content:"Email sent to Delivery Coordinator (Major delivery delay)",data:{trigger:"delivery-delay",recipients:["Delivery Coordinator"],surveyResponse:je.q4},timestamp:new Date().toISOString()})),_e.highNPS&&qe.push(d.addActivity(he.id,{type:"survey-trigger",user:((z=y.currentUser)==null?void 0:z.name)||"You",action:"triggered email notification",content:"Email sent to Marketing (High NPS - Definitely Yes)",data:{trigger:"high-nps",recipients:["Marketing"],surveyResponse:je.q7},timestamp:new Date().toISOString()})),await Promise.all(qe),oe.value=!1}catch(he){console.error("Failed to submit survey:",he)}}function Js(){X.value&&X.value.submit()}function Gs(){oe.value=!1}const Zs=S(()=>new Date().toISOString().split("T")[0]),Ks=S(()=>{const l=new Date;return l.setDate(l.getDate()+1),l.toISOString().split("T")[0]}),Ts=S(()=>!!Ae.value.contractDate),Os=S(()=>!!Ne.value.newDeadline),ss=S(()=>{var l;return((l=Ye.value)==null?void 0:l.isValid)||!1});function Xs(){if(ie.value=!1,ke.value=!1,Fe.value=!1,se.value=!se.value,se.value&&!Ae.value.contractDate){const l=new Date;Ae.value.contractDate=l.toISOString().split("T")[0],Ae.value.contractTime=l.toTimeString().slice(0,5)}}function Is(){se.value=!1,Ae.value={contractDate:"",contractTime:"",notes:""}}async function en(){var l;if(Ts.value)try{const i=w(),_=Ae.value.contractTime?`${Ae.value.contractDate}T${Ae.value.contractTime}:00`:`${Ae.value.contractDate}T12:00:00`;await d.updateOpportunity(i.id,{contractDate:_,contractNotes:Ae.value.notes}),await d.addActivity(i.id,{type:"contract",user:((l=y.currentUser)==null?void 0:l.name)||"You",action:"set contract signing date",content:`Contract date set: ${new Date(_).toLocaleString()}`,data:{contractDate:_,notes:Ae.value.notes},timestamp:new Date().toISOString()}),Is()}catch(i){console.error("Failed to set contract date:",i)}}function tn(){se.value=!1,ke.value=!1,Fe.value=!1,ie.value=!ie.value}function Ns(){ie.value=!1}function sn(){Ye.value&&Ye.value.submit()}async function nn(l){var i,_,ce,ve,z,he,je,_e,qe;try{const kt=w();await d.addOffer(kt.id,{vehicleBrand:((i=l.data)==null?void 0:i.brand)||"",vehicleModel:((_=l.data)==null?void 0:_.model)||"",vehicleYear:((ce=l.data)==null?void 0:ce.year)||"",price:((ve=l.data)==null?void 0:ve.price)||0,data:l.data}),await d.addActivity(kt.id,{type:"offer",user:((z=y.currentUser)==null?void 0:z.name)||"You",action:"created an offer",content:`Offer created: ${(he=l.data)==null?void 0:he.brand} ${(je=l.data)==null?void 0:je.model} (${(_e=l.data)==null?void 0:_e.year}) - € ${(((qe=l.data)==null?void 0:qe.price)||0).toLocaleString()}`,data:l.data,timestamp:new Date().toISOString()}),ie.value=!1}catch(kt){console.error("Failed to create offer:",kt)}}function an(){if(se.value=!1,ie.value=!1,Fe.value=!1,ke.value=!ke.value,ke.value&&!Ne.value.newDeadline){const l=new Date;l.setDate(l.getDate()+1),Ne.value.newDeadline=l.toISOString().split("T")[0]}}function Vs(){ke.value=!1,Ne.value={newDeadline:"",reason:""}}async function ln(){var l;if(Os.value)try{const i=w();await d.updateOpportunity(i.id,{deadline:Ne.value.newDeadline,deadlineExtensionReason:Ne.value.reason}),await d.addActivity(i.id,{type:"deadline-extension",user:((l=y.currentUser)==null?void 0:l.name)||"You",action:"extended deadline",content:`Deadline extended to ${new Date(Ne.value.newDeadline).toLocaleDateString()}`,data:{newDeadline:Ne.value.newDeadline,reason:Ne.value.reason},timestamp:new Date().toISOString()}),Vs()}catch(i){console.error("Failed to extend deadline:",i)}}function on(){se.value=!1,ie.value=!1,ke.value=!1,Fe.value=!Fe.value}function ns(){Fe.value=!1}async function rn(l){var is,rs,us;const{eventType:i,selectedDate:_,selectedSlot:ce,selectedTeam:ve,selectedSalesman:z,durationValue:he,communicationPreferences:je}=l,_e=w(),qe=_,[kt,pn]=ce.split(":").map(Number),Jt=new Date(qe);Jt.setHours(kt,pn,0,0);const Dt=he||30,Et=new Date(Jt.getTime()+Dt*6e4),as=(z==null?void 0:z.name)||(ve==null?void 0:ve.name)||_e.assignee||"Unassigned",ls=(z==null?void 0:z.id)||(ve==null?void 0:ve.id)||null,os=z?"user":"team";try{const Gt={customerId:_e.customerId||((is=_e.customer)==null?void 0:is.id),customer:((rs=_e.customer)==null?void 0:rs.name)||"Unknown",start:Jt.toISOString(),end:Et.toISOString(),type:i,title:`${i} - ${((us=_e.customer)==null?void 0:us.name)||"Customer"}`,assigneeId:ls,assigneeType:os,teamId:(ve==null?void 0:ve.id)||null,team:(ve==null?void 0:ve.name)||null,salesperson:(z==null?void 0:z.name)||null,salespersonId:(z==null?void 0:z.id)||null,duration:Dt,opportunityId:_e.id},ds=await yn(Gt),cs={id:ds.id,start:Jt.toISOString(),end:Et.toISOString(),type:i,assignee:as,assigneeId:ls,assigneeType:os,duration:Dt,team:(ve==null?void 0:ve.name)||null,teamId:(ve==null?void 0:ve.id)||null,salesperson:(z==null?void 0:z.name)||null,salespersonId:(z==null?void 0:z.id)||null,communications:je,status:"confirmed"};await d.updateOpportunity(_e.id,{scheduledAppointment:cs}),m("appointment-scheduled",{...cs,calendarEventId:ds.id}),ns()}catch(Gt){console.error("Failed to schedule appointment:",Gt)}}function un(l){const i=typeof l=="string"?l:l.reason||l,_=typeof l=="object"?l.notes:"";de.value=!1,d.updateOpportunity(o.opportunity.id,{stage:"Closed Lost",lossReason:i,lossNotes:_})}function dn(){!u.value||!u.value.start||(K.value=!0,re.value=!1,we.value=!1)}function Ms(){var l,i;if(console.log("[OpportunityManagementWidget] handleMarkNoShow called",{hasAppointment:!!u.value,appointmentStatus:(l=u.value)==null?void 0:l.status,noShowCount:(i=u.value)==null?void 0:i.noShowCount}),!u.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,we.value=!1,re.value=!0,console.log("[OpportunityManagementWidget] Set showNsTaskSection to true"),u.value.status!=="no-show"&&(console.log("[OpportunityManagementWidget] Calling updateAppointmentToNoShow"),mn())}function cn(){var l;if(console.log("[OpportunityManagementWidget] handleMarkShowedUp called",{hasAppointment:!!u.value,appointmentStatus:(l=u.value)==null?void 0:l.status}),!u.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,re.value=!1,we.value=!0,console.log("[OpportunityManagementWidget] Set showOfferAssignmentSection to true")}async function mn(){var l;if(u.value)try{const _=(u.value.noShowCount||0)+1,ce=_===1?"NS1":_===2?"NS2":"NS3";if(u.value.id){const{updateCalendarEvent:z}=await Zt(async()=>{const{updateCalendarEvent:he}=await import("./users-CPXYaoWs.js").then(je=>je.i);return{updateCalendarEvent:he}},__vite__mapDeps([3,1,2]));await z(u.value.id,{status:"no-show"})}const ve={...u.value,status:"no-show",noShowCount:_};await d.updateOpportunity(o.opportunity.id,{scheduledAppointment:ve}),await d.addActivity(o.opportunity.id,{type:"ns-task",user:((l=y.currentUser)==null?void 0:l.name)||"You",action:`${ce} - marked appointment as no-show`,content:`${ce}: Appointment on ${new Date(u.value.start).toLocaleString()} marked as no-show. This is the ${_===1?"first":_===2?"second":"third"} no-show.`,data:{appointmentId:u.value.id,noShowCount:_,nsLabel:ce},timestamp:new Date().toISOString()}),m("appointment-no-show",{appointmentId:u.value.id,noShowCount:_,nsLabel:ce})}catch(i){console.error("Failed to mark appointment as no-show:",i)}}function O({opportunity:l,reason:i}){dt.value=!0}async function n({opportunity:l,reason:i}){var _;re.value=!1,await d.updateOpportunity(l.id,{stage:"Closed Lost",lossReason:i}),await d.addActivity(l.id,{type:"close-lost",user:((_=y.currentUser)==null?void 0:_.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${i||"N/A"}`,data:{reason:i},timestamp:new Date().toISOString()})}function Z(l){if(l&&l.handler)l.handler();else if(l&&l.key){const i=Qe[l.key];i&&i()}}return ks(async()=>{try{const i=(await La({})).data||[];$t.value=i.filter(_=>_.stockDays!==null&&_.stockDays!==void 0).slice(0,5)}catch(l){console.error("Failed to load recommended cars:",l),$t.value=[]}u.value&&u.value.status==="no-show"&&(re.value=!0)}),(l,i)=>{const _=En("click-outside");return p(),C(Le,null,[s(Yn,{task:a.opportunity,"hide-title":"","hide-border":""},{"deadline-banner":r(()=>[ue.isClosed.value?L("",!0):(p(),me(Zn,{key:0,"next-action-due":a.opportunity.nextActionDue,"show-deadline-banner":ue.showDeadlineBanner.value,"task-id":a.opportunity.id},null,8,["next-action-due","show-deadline-banner","task-id"]))]),"primary-action":r(()=>{var ce,ve;return[ue.isClosed.value?L("",!0):(p(),me(Qn,{key:0,task:a.opportunity,"task-type":"opportunity",onReassigned:It,class:"mb-3"},null,8,["task"])),!ue.isClosed.value&&u.value&&u.value.start?(p(),C("div",ym,[e("div",gm,[e("div",bm,[e("div",hm,[i[31]||(i[31]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Appointment",-1)),e("p",xm," Appointment scheduled for "+I((ce=u.value)!=null&&ce.start?Ot(u.value.start):"TBD"),1)]),e("div",wm,[((ve=u.value)==null?void 0:ve.status)==="pending_confirmation"?(p(),me(t(Y),{key:0,variant:"outline",onClick:pe,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700"},{default:r(()=>[...i[32]||(i[32]=[e("i",{class:"fa-solid fa-calendar-check"},null,-1),e("span",null,"Confirm appointment",-1)])]),_:1})):L("",!0),s(t(Y),{variant:"outline",onClick:dn,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",K.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[33]||(i[33]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),e("span",null,"Reschedule",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:Ms,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",re.value?"border-orange-500 bg-orange-50 text-orange-700":""])},{default:r(()=>[...i[34]||(i[34]=[e("i",{class:"fa-solid fa-user-slash"},null,-1),e("span",null,"Mark as No-Show",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:cn,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",we.value?"border-green-500 bg-green-50 text-green-700":""])},{default:r(()=>[...i[35]||(i[35]=[e("i",{class:"fa-solid fa-user-check"},null,-1),e("span",null,"Mark as Showed Up",-1)])]),_:1},8,["class"]),ue.secondaryActions.value&&ue.secondaryActions.value.length>0?(p(),me(qn,{key:1,actions:ue.secondaryActions.value,onActionSelected:Z},null,8,["actions"])):L("",!0)])])]),s(pt,{name:"expand"},{default:r(()=>[K.value?(p(),C("div",km,[s(gn,{ref_key:"scheduleFormRef",ref:le,opportunity:a.opportunity,mode:"reschedule","initial-appointment":u.value,onSubmit:i[0]||(i[0]=z=>Me(z,"reschedule")),onCancel:Q},null,8,["opportunity","initial-appointment"])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[re.value?(p(),C("div",Sm,[ge.value===1?(p(),me(hc,{key:0,ref_key:"ns1TaskRef",ref:et,opportunity:a.opportunity,"scheduled-appointment":u.value,onAssigned:$s,onCancel:_t},null,8,["opportunity","scheduled-appointment"])):ge.value===2?(p(),me(Nc,{key:1,ref_key:"ns2TaskRef",ref:P,opportunity:a.opportunity,"scheduled-appointment":u.value,onAssigned:$s,onCancel:_t},null,8,["opportunity","scheduled-appointment"])):ge.value>=3?(p(),me(Fc,{key:2,ref_key:"ns3TaskRef",ref:ee,opportunity:a.opportunity,"scheduled-appointment":u.value,onCloseAsLost:n,onCancel:_t},null,8,["opportunity","scheduled-appointment"])):L("",!0)])):L("",!0)]),_:1}),re.value?(p(),C("div",Cm,[s(t(Y),{variant:"secondary",onClick:_t},{default:r(()=>[...i[36]||(i[36]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Se.value,onClick:es,class:"bg-primary"},{default:r(()=>[T(I(Ce.value),1)]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[we.value?(p(),C("div",$m,[s(Ec,{ref_key:"offerAssignmentTaskRef",ref:Be,opportunity:a.opportunity,"scheduled-appointment":u.value,onOfferCreated:Ws,onCancel:Yt},null,8,["opportunity","scheduled-appointment"])])):L("",!0)]),_:1}),we.value?(p(),C("div",Dm,[s(t(Y),{variant:"secondary",onClick:Yt},{default:r(()=>[...i[37]||(i[37]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ve.value,onClick:Ds,class:"bg-primary"},{default:r(()=>[...i[38]||(i[38]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0)])):L("",!0),!ue.isClosed.value&&a.opportunity.stage==="In Negotiation"&&a.opportunity.negotiationSubstatus!=="Offer Accepted"&&a.opportunity.offers&&a.opportunity.offers.length>0?(p(),C("div",Am,[e("div",Tm,[e("div",Om,[e("div",Im,[i[39]||(i[39]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Offers & Follow Up",-1)),e("p",Nm,I(a.opportunity.negotiationSubstatus==="Offer Feedback"?"Request feedback on pending offers":"Follow up with customer about offers"),1)]),e("div",Vm,[s(Xn,{offers:a.opportunity.offers,"opportunity-id":a.opportunity.id,onOfferAccepted:ts},null,8,["offers","opportunity-id"])]),e("div",Mm,[s(t(Y),{variant:"outline",onClick:Ht,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",Re.value?"border-yellow-500 bg-yellow-50 text-yellow-700":""])},{default:r(()=>[i[40]||(i[40]=e("i",{class:"fa-solid fa-phone-volume"},null,-1)),e("span",null,I(a.opportunity.negotiationSubstatus==="Offer Feedback"?"Request Feedback":"Follow Up"),1)]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:Qt,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",We.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[41]||(i[41]=[e("i",{class:"fa-solid fa-plus"},null,-1),e("span",null,"Add Offer",-1)])]),_:1},8,["class"]),ue.secondaryActions.value&&ue.secondaryActions.value.length>0?(p(),me(qn,{key:0,actions:ue.secondaryActions.value,onActionSelected:Z},null,8,["actions"])):L("",!0)])])]),s(pt,{name:"expand"},{default:r(()=>[Re.value?(p(),C("div",qm,[e("div",Lm,[i[48]||(i[48]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",Fm,[s(t(Y),{variant:"outline",onClick:i[1]||(i[1]=z=>De.value="call"),class:J(["flex items-center justify-center gap-2",De.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[42]||(i[42]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[2]||(i[2]=z=>De.value="whatsapp"),class:J(["flex items-center justify-center gap-2",De.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[43]||(i[43]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[3]||(i[3]=z=>De.value="sms"),class:J(["flex items-center justify-center gap-2",De.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[44]||(i[44]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[4]||(i[4]=z=>De.value="email"),class:J(["flex items-center justify-center gap-2",De.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[45]||(i[45]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),De.value?(p(),C("div",Um,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[46]||(i[46]=[T("Select offer to reference",-1)])]),_:1}),s(t(Ze),{modelValue:R.value,"onUpdate:modelValue":i[5]||(i[5]=z=>R.value=z),items:He.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:r(({item:z})=>[e("div",_m,[e("span",null,I(z.label),1),e("span",Em,"€ "+I(Xe(z.price)),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[47]||(i[47]=[T("Message",-1)])]),_:1}),s(t(lt),{modelValue:Te.value,"onUpdate:modelValue":i[6]||(i[6]=z=>Te.value=z),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0)]),_:1}),Re.value?(p(),C("div",Rm,[s(t(Y),{variant:"secondary",onClick:zs},{default:r(()=>[...i[49]||(i[49]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!ft.value,onClick:Ps,class:"bg-primary"},{default:r(()=>[...i[50]||(i[50]=[T(" Send Message ",-1)])]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[We.value?(p(),C("div",jm,[e("div",Bm,[s(Es,{ref_key:"addOfferWidgetRef",ref:B,"task-id":a.opportunity.id,"task-type":"opportunity",customer:a.opportunity.customer,"selected-vehicle":a.opportunity.selectedVehicle||a.opportunity.vehicle||a.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:nt,onCancel:As},null,8,["task-id","customer","selected-vehicle"])])])):L("",!0)]),_:1}),We.value?(p(),C("div",Wm,[s(t(Y),{variant:"secondary",onClick:As},{default:r(()=>[...i[51]||(i[51]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ys.value,onClick:ht,class:"bg-primary"},{default:r(()=>[...i[52]||(i[52]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0)])):L("",!0),!ue.isClosed.value&&a.opportunity.stage==="In Negotiation"&&(a.opportunity.negotiationSubstatus==="Offer Accepted"||ue.displayStage.value==="In Negotiation - Contract Pending")?(p(),C("div",Pm,[e("div",zm,[e("div",Ym,[i[55]||(i[55]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Collect e-signatures, finalize contract"),e("p",{class:"text-sm text-body mt-0.5"}," Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs. ")],-1)),e("div",Hm,[s(t(Y),{variant:"outline",onClick:Xs,class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",se.value?"border-emerald-500 bg-emerald-50 text-emerald-700":""])},{default:r(()=>[...i[53]||(i[53]=[e("i",{class:"fa-solid fa-file-signature"},null,-1),e("span",null,"Collect Signatures",-1)])]),_:1},8,["class"]),e("div",Qm,[e("button",{onClick:i[7]||(i[7]=Rs(z=>Oe.value=!Oe.value,["stop"])),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap"},[i[54]||(i[54]=e("span",null,"More actions",-1)),e("i",{class:J(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":Oe.value}])},null,2)]),Oe.value&&ae.value.length>0?Ge((p(),C("div",Jm,[s(t(bn),{items:ae.value,className:"w-56"},null,8,["items"])])),[[_,()=>Oe.value=!1]]):L("",!0)])])])]),s(pt,{name:"expand"},{default:r(()=>[se.value?(p(),C("div",Gm,[e("div",Zm,[i[59]||(i[59]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Set Contract Signing Date",-1)),e("div",Km,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[56]||(i[56]=[T("Contract Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(at),{type:"date",modelValue:Ae.value.contractDate,"onUpdate:modelValue":i[8]||(i[8]=z=>Ae.value.contractDate=z),max:Zs.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[57]||(i[57]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:Ae.value.contractTime,"onUpdate:modelValue":i[9]||(i[9]=z=>Ae.value.contractTime=z),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[58]||(i[58]=[T("Notes (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:Ae.value.notes,"onUpdate:modelValue":i[10]||(i[10]=z=>Ae.value.notes=z),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full"},null,8,["modelValue"])])])]),e("div",Xm,[s(t(Y),{variant:"secondary",onClick:Is},{default:r(()=>[...i[60]||(i[60]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ts.value,onClick:en,class:"bg-primary"},{default:r(()=>[...i[61]||(i[61]=[T(" Set Contract Date ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[ie.value?(p(),C("div",ep,[e("div",tp,[s(Es,{ref_key:"addOfferContractPendingRef",ref:Ye,"task-id":a.opportunity.id,"task-type":"opportunity",customer:a.opportunity.customer,"selected-vehicle":a.opportunity.selectedVehicle||a.opportunity.vehicle||a.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:nn,onCancel:Ns},null,8,["task-id","customer","selected-vehicle"])])])):L("",!0)]),_:1}),ie.value?(p(),C("div",sp,[s(t(Y),{variant:"secondary",onClick:Ns},{default:r(()=>[...i[62]||(i[62]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!ss.value,onClick:sn,class:"bg-primary"},{default:r(()=>[...i[63]||(i[63]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[ke.value?(p(),C("div",np,[e("div",ap,[i[66]||(i[66]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Extend Deadline",-1)),e("div",lp,[e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[64]||(i[64]=[T("New Deadline Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(at),{type:"date",modelValue:Ne.value.newDeadline,"onUpdate:modelValue":i[11]||(i[11]=z=>Ne.value.newDeadline=z),min:Ks.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[s(t(G),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[65]||(i[65]=[T("Reason (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:Ne.value.reason,"onUpdate:modelValue":i[12]||(i[12]=z=>Ne.value.reason=z),rows:"3",placeholder:"Reason for extending the deadline...",class:"w-full"},null,8,["modelValue"])])])]),e("div",op,[s(t(Y),{variant:"secondary",onClick:Vs},{default:r(()=>[...i[67]||(i[67]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Os.value,onClick:ln,class:"bg-primary"},{default:r(()=>[...i[68]||(i[68]=[T(" Extend Deadline ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[Fe.value?(p(),C("div",ip,[s(gn,{ref_key:"scheduleAppointmentContractPendingFormRef",ref:st,opportunity:a.opportunity,mode:"schedule",onSubmit:i[13]||(i[13]=z=>rn(z)),onCancel:ns},null,8,["opportunity"])])):L("",!0)]),_:1})])):!ue.isClosed.value&&ue.primaryAction.value?(p(),me(Hn,{key:4,action:ue.primaryAction.value,"color-scheme":ue.primaryAction.value.colorScheme,onActionClicked:ue.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]}),"task-widgets":r(()=>{var ce;return[h.value?(p(),C("div",rp,[a.opportunity.assignmentNote?(p(),C("div",up,[e("div",dp,[i[70]||(i[70]=e("i",{class:"fa-solid fa-sticky-note text-blue-600 text-sm mt-0.5"},null,-1)),e("div",cp,[i[69]||(i[69]=e("h5",{class:"font-semibold text-heading text-sm mb-1"},"Note from Assigner",-1)),e("p",mp,I(a.opportunity.assignmentNote),1)])])])):L("",!0),e("div",pp,[e("div",vp,[e("div",fp,[i[72]||(i[72]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Call to Schedule Appointment"),e("p",{class:"text-sm text-body mt-0.5"}," Contact the customer to schedule an appointment ")],-1)),e("div",yp,[e("span",gp,I(((ce=a.opportunity.customer)==null?void 0:ce.phone)||"N/A"),1),e("button",{onClick:M,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...i[71]||(i[71]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])]),s(Gn,{"is-call-active":t(g),"call-ended":t(b),"call-duration":t(N),"call-notes":t(k),"formatted-call-duration":t(F),"mock-transcription":t(E),"contact-attempts":0,"max-contact-attempts":3,onStartCall:q,onEndCall:D,onLogManualCall:H,onExtractInformation:i[14]||(i[14]=ve=>it.value=!0),"onUpdate:callNotes":j,onCopyNumber:M},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription"])])]),e("div",bp,[s(gn,{ref_key:"scheduleFormRef",ref:le,opportunity:a.opportunity,mode:"schedule",onSubmit:i[15]||(i[15]=ve=>Me(ve,"schedule")),onCancel:xe},null,8,["opportunity"])])])])):L("",!0),c.value?(p(),C("div",hp,[e("div",xp,[e("div",wp,[i[76]||(i[76]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Post-Delivery Customer Satisfaction Survey"),e("p",{class:"text-sm text-body mt-0.5"}," Collect feedback from the customer about their delivery experience ")],-1)),e("div",kp,[s(t(Y),{variant:"outline",onClick:i[16]||(i[16]=ve=>oe.value=!oe.value),class:J(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",oe.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[73]||(i[73]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["class"]),$.value?(p(),me(t(Y),{key:0,variant:"outline",onClick:Nt,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700 hover:bg-green-100"},{default:r(()=>[...i[74]||(i[74]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),e("span",null,"Reopen Opportunity",-1)])]),_:1})):L("",!0),e("div",Sp,[e("button",{onClick:i[17]||(i[17]=Rs(ve=>W.value=!W.value,["stop"])),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap"},[i[75]||(i[75]=e("span",null,"More actions",-1)),e("i",{class:J(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":W.value}])},null,2)]),W.value&&ne.value.length>0?Ge((p(),C("div",Cp,[s(t(bn),{items:ne.value,className:"w-56"},null,8,["items"])])),[[_,()=>W.value=!1]]):L("",!0)])])])]),s(pt,{name:"expand"},{default:r(()=>[oe.value?(p(),C("div",$p,[s(fm,{ref_key:"postDeliverySurveyRef",ref:X,opportunity:a.opportunity,onSubmit:Qs,onCancel:i[18]||(i[18]=ve=>oe.value=!1)},null,8,["opportunity"]),e("div",Dp,[s(t(Y),{variant:"secondary",onClick:Gs},{default:r(()=>[...i[77]||(i[77]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Hs.value,onClick:Js,class:"bg-primary"},{default:r(()=>[...i[78]||(i[78]=[T(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1})])):ue.activeTaskWidget.value&&ue.activeTaskWidget.value.component?(p(),C("div",Ap,[e("div",Tp,[i[79]||(i[79]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Op,I(ue.taskWidgetTitle.value),1)]),(p(),me(wn(ue.activeTaskWidget.value.component),xn(ue.activeTaskWidget.value.props,{onClose:zt,onSetCallback:Bs,onAutoCloseLost:O}),null,16))])):L("",!0)]}),"closed-state":r(()=>[ue.isClosed.value?(p(),C("div",Ip,[e("div",Np,[e("div",null,[i[80]||(i[80]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed",-1)),e("p",Vp,[T(" Status: "+I(ue.displayStage.value)+" ",1),a.opportunity.lossReason?(p(),C("span",Mp," - "+I(a.opportunity.lossReason),1)):L("",!0)])])]),$.value?L("",!0):(p(),me(t(Y),{key:0,variant:"primary",size:"small",onClick:Nt,class:"flex items-center gap-2"},{default:r(()=>[...i[81]||(i[81]=[e("span",null,"Reopen Opportunity",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}))])):L("",!0)]),"secondary-actions":r(()=>[...i[82]||(i[82]=[])]),_:1},8,["task"]),te.value?(p(),me(Wn,{key:0,show:te.value,customer:a.opportunity.customer,assignee:a.opportunity.assignee,"disabled-fields":["customer"],onCreate:Cs,onCancel:i[19]||(i[19]=ce=>te.value=!1)},null,8,["show","customer","assignee"])):L("",!0),Ke.value?(p(),me(Ma,{key:1,opportunity:a.opportunity,"requested-car":a.opportunity.requestedCar,"recommended-cars":$t.value,onVehicleSelected:Pe,onClose:i[20]||(i[20]=ce=>Ke.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):L("",!0),tt.value?(p(),me(Es,{key:2,opportunity:a.opportunity,vehicle:a.opportunity.selectedVehicle||a.opportunity.vehicle||a.opportunity.requestedCar,onOfferCreated:rt,onClose:i[21]||(i[21]=ce=>tt.value=!1)},null,8,["opportunity","vehicle"])):L("",!0),wt.value?(p(),me(Dd,{key:3,opportunity:a.opportunity,onContractSet:bt,onClose:i[22]||(i[22]=ce=>wt.value=!1)},null,8,["opportunity"])):L("",!0),ot.value?(p(),me(Vd,{key:4,opportunity:a.opportunity,onDelivered:ct,onClose:i[23]||(i[23]=ce=>ot.value=!1)},null,8,["opportunity"])):L("",!0),dt.value?(p(),me(Ln,{key:5,opportunity:a.opportunity,"preselected-reason":Ie.value,onConfirm:ut,onCancel:i[24]||(i[24]=ce=>{dt.value=!1,Ie.value=""})},null,8,["opportunity","preselected-reason"])):L("",!0),de.value?(p(),me(Ln,{key:6,opportunity:a.opportunity,onConfirm:un,onCancel:i[25]||(i[25]=ce=>de.value=!1)},null,8,["opportunity"])):L("",!0),Ct.value?(p(),me(Fd,{key:7,opportunity:a.opportunity,onRequalified:Ue,onClose:i[26]||(i[26]=ce=>Ct.value=!1)},null,8,["opportunity"])):L("",!0),it.value?(p(),me(Cn,{key:8,onClose:i[27]||(i[27]=ce=>it.value=!1)})):L("",!0),yt.value&&u.value?(p(),me(Fa,{key:9,show:yt.value,event:u.value,onClose:i[28]||(i[28]=ce=>yt.value=!1),onEdit:i[29]||(i[29]=ce=>{yt.value=!1,gt.value=!0}),onDelete:mt},null,8,["show","event"])):L("",!0),gt.value&&u.value?(p(),me(Ua,{key:10,show:gt.value,event:u.value,customer:a.opportunity.customer,"disabled-fields":["customer"],onSave:js,onCancel:i[30]||(i[30]=ce=>gt.value=!1)},null,8,["show","event","customer"])):L("",!0)],64)}}},Lp=Wt(qp,[["__scopeId","data-v-b18e8fa2"]]);function Jp(a){const V=Pt(),o=Ft(),m=S(()=>a.value?a.value.type==="lead"?au:Lp:null),v=S(()=>a.value?a.value.type==="lead"?{currentActivities:S(()=>V.currentLeadActivities),addActivity:(y,f)=>V.addActivity(y,f),updateActivity:(y,f,w)=>V.updateActivity(y,f,w),deleteActivity:(y,f)=>V.deleteActivity(y,f),updateLead:(y,f)=>V.updateLead(y,f),loadLeadById:y=>V.fetchLeadById(y)}:{currentActivities:S(()=>o.currentOpportunityActivities),addActivity:(y,f)=>o.addActivity(y,f),updateActivity:(y,f,w)=>o.updateActivity(y,f,w),deleteActivity:(y,f)=>o.deleteActivity(y,f),addVehicle:(y,f)=>o.addVehicle(y,f),createOffer:(y,f)=>o.createOffer(y,f),updateOpportunity:(y,f)=>o.updateOpportunity(y,f),loadOpportunityById:y=>o.fetchOpportunityById(y)}:null),d=S(()=>a.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:m,storeAdapter:v,addNewConfig:d}}function Gp(a){const V=Pt(),o=Ft(),m=Tt(),v=S(()=>{const x=(a.value?V.leads:V.leads.filter(N=>!N.isDisqualified)).map(N=>{const k=ps(N,"lead"),E={...N,type:"lead",compositeId:`lead-${N.id}`,displayStage:k};return!E.customer&&N.customer&&(E.customer=N.customer),E}),g=o.opportunities.map(N=>{const k=ps(N,"opportunity"),E={...N,type:"opportunity",compositeId:`opportunity-${N.id}`,displayStage:k};return!E.customer&&N.customer&&(E.customer=N.customer),E});let b=[];return m.isOperator()?b=x:m.isSalesman()?b=g:b=[...x,...g],b}),d=(c,x)=>!x||x.length===0?c:Array.isArray(x)?c.filter(g=>x.includes(g.type)):x==="all"?c:c.filter(g=>g.type===x),y=c=>{const x=new Date,g=new Date(x.getTime()+24*60*60*1e3);return c.filter(b=>{if(!b.nextActionDue)return!1;const N=new Date(b.nextActionDue);return N>=x&&N<=g})},f=c=>c.filter(x=>x.nextActionDue!=null),w=c=>{const x=new Date(Date.now()-36e5);return c.filter(g=>g.type!=="lead"||!g.createdAt?!1:new Date(g.createdAt)>=x)},u=c=>{var g;const x=(g=m.currentUser)==null?void 0:g.name;return x?c.filter(b=>b.assignee===x):[]},h=(c,x)=>{if(!x||x.length===0)return c;let g=[...c];const b=x.filter(N=>N==="lead"||N==="opportunity");return b.length>0&&(g=d(g,b)),x.forEach(N=>{switch(N){case"due-in-24h":g=y(g);break;case"to-be-called":g=f(g);break;case"leads-1h":g=w(g);break;case"assigned-to-me":g=u(g);break}}),g},$=S(()=>{const c=v.value.some(g=>g.type==="lead"),x=v.value.some(g=>g.type==="opportunity");return c&&x});return{allTasks:v,filterByType:d,filterByDueIn24Hours:y,filterByToBeCalled:f,filterByLeadsCreated1Hour:w,filterByAssignedToMe:u,applyFilters:h,shouldShowTypeFilter:$}}export{Qp as D,Hp as T,Jp as a,Gp as u};
