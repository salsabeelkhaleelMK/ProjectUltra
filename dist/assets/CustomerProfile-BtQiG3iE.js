import{H as ge,h as Ve,d as n,o as s,e,n as z,w as je,s as l,y as a,al as bt,t as f,F as G,i as ee,x as P,ai as un,g as u,B as k,$ as cn,I as Ka,r as N,c as I,am as mn,Y as Gt,k as M,C as Qa,l as qe,m as wt,J as Ja,p as de,j as Ea,K as Ne,a7 as fn,v as Na,a8 as Xe,E as vn,O as pn,G as yn,L as Bt,P as nt,W as Pa,a4 as Za,an as Ht,ao as Ft,ap as gn,aq as xn,ar as hn}from"./index-BrrG4Zms.js";import{u as Xa}from"./opportunities-BPg57aoi.js";import{u as en,_ as bn,f as kn}from"./UnifiedAddForm-BFt8oQo9.js";import{z as pe,n as _,b as wn,Z as $n,a as Cn,e as _e,J as ze,Y as We,$ as tn,Q as X,c as ie,W as et,U as tt,H as st,j as oe,G as at,f as Kt,F as Qt,L as Jt,g as Zt,h as Xt,o as An,C as es,d as ts,t as it}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js";import{W as In,X as Fa,Y as Ra,Z as Ba,l as Ut,m as _t,T as Sn,_ as Tn,j as Dn,k as jn,r as qn,s as Vn,t as Mn,n as On,o as Ln,p as En,q as Pe,D as Nn,F as Pn,I as Ua,$ as Rt,a0 as kt,a1 as lt,P as ot,i as sn,v as an,G as nn,a2 as ye,a3 as Ue,C as Fn}from"./OfferCarousel-BgF_S9jC.js";import{_ as Rn}from"./ReassignUserModal-DCLjOtM0.js";import{a as Bn,_ as Un}from"./CreateEventModal-CoiF22IC.js";import{u as _n,b as zn,c as Wn,d as Hn}from"./users-OdWvBllN.js";import{fetchTasksByCustomerId as Yn,fetchContactsByAccountId as Gn,fetchLeadsByCustomerId as Kn,fetchOpportunitiesByCustomerId as Qn,fetchCustomerCars as Jn}from"./contacts-UHPRiXzI.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=ge("ActivityIcon",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ge("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=ge("BriefcaseIcon",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=ge("Building2Icon",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=ge("CalendarCheckIcon",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=ge("DollarSignIcon",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=ge("HandshakeIcon",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=ge("HashIcon",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=ge("InboxIcon",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ge("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ge("MapPinIcon",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=ge("MessageSquareIcon",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=ge("SmartphoneIcon",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=ge("StarIcon",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=ge("UserPlusIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ll={class:"page-header-main"},ol={class:"page-header-content"},il={class:"flex items-center gap-3 min-w-0 flex-1"},rl={class:"min-w-0 flex-1 flex flex-col justify-center"},dl={class:"flex items-center gap-2 flex-wrap"},ul={class:"text-lg font-semibold text-foreground truncate leading-tight"},cl={class:"flex items-center gap-1.5"},ml={class:"page-header-actions"},fl={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,default:""},phone:{type:String,default:""},thirdFieldValue:{type:String,default:""},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]},showCloseButton:{type:Boolean,default:!1}},emits:["add-tag","close"],setup(t,{emit:o}){const m=t,A=o,j=Ve(),$=()=>A("add-tag"),v=()=>{m.customerId&&j.push(`/customer/${m.customerId}`)};return(c,w)=>(s(),n("div",ll,[e("div",ol,[e("div",il,[e("button",{onClick:je(v,["stop"]),class:z(["w-10 h-10 rounded-lg bg-primary text-white flex items-center justify-center cursor-pointer hover:opacity-90 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[l(a(bt),{class:"w-5 h-5"})],2),e("div",rl,[e("div",dl,[e("h1",ul,f(t.name),1),e("div",cl,[(s(!0),n(G,null,ee(t.tags,b=>(s(),P(a(pe),{key:b,text:b,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:je($,["stop"]),class:"text-xs text-muted-foreground hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors whitespace-nowrap"},[l(a(un),{class:"w-3 h-3"}),w[1]||(w[1]=e("span",null,"tag",-1))])])])])]),e("div",ml,[t.showCloseButton?(s(),P(a(_),{key:0,variant:"secondary",size:"icon",onClick:w[0]||(w[0]=je(b=>c.$emit("close"),["stop"]))},{default:k(()=>[l(a(cn),{size:16,class:"text-muted-foreground"})]),_:1})):u("",!0)])])]))}},vl={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},pl={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(o,m)=>(s(),P(a(Cn),{"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=A=>o.$emit("update:modelValue",A))},{default:k(()=>[l(a(wn),{class:"flex shrink-0 border-b border-border bg-white rounded-none w-full relative h-full"},{default:k(()=>[(s(!0),n(G,null,ee(t.tabs,A=>(s(),P(a($n),{key:A.key,value:A.key,class:z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",t.modelValue===A.key?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:k(()=>[e("span",null,f(A.label),1),A.count!==void 0&&A.count>0?(s(),n("span",{key:0,class:z(["flex items-center justify-center min-w-5 h-5 px-1.5 rounded-full text-xs font-bold leading-none",t.modelValue===A.key?"bg-primary text-white":"bg-gray-200 text-foreground"])},f(A.count),3)):u("",!0),t.modelValue===A.key?(s(),n("span",vl)):u("",!0)]),_:2},1032,["value","class"]))),128))]),_:1})]),_:1},8,["model-value"]))}},za=Ka(pl,[["__scopeId","data-v-b3f135ea"]]),yl={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},gl={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},xl={class:"flex items-center gap-1.5"},hl={key:1},bl={class:"flex items-center gap-2"},kl={key:0,class:"space-y-4"},wl={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},$l={class:"flex items-center gap-4"},Cl={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-border"},Al=["src"],Il={key:1,class:"fa-solid fa-car text-3xl text-muted-foreground w-full h-full flex items-center justify-center"},Sl={class:"font-bold text-foreground text-base md:text-lg mb-2"},Tl={class:"flex items-center gap-2 flex-wrap"},Dl={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},jl={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},ql={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-muted border border-border text-muted-foreground text-xs font-semibold rounded-md"},Vl={class:"text-xs font-bold text-foreground"},Ml={key:0,class:"text-right"},Ol={class:"font-bold text-foreground text-lg"},Ll={key:0,class:"pt-2"},El={class:"bg-muted border border-border rounded-lg p-3"},Nl={class:"text-sm text-muted-foreground leading-relaxed"},Pl={key:1,class:"space-y-3"},Fl={key:0,class:"flex items-center gap-2"},Rl={class:"text-sm font-semibold text-foreground"},Bl={key:1,class:"bg-muted border border-border rounded-lg p-3"},Ul={class:"text-sm text-muted-foreground leading-relaxed"},_l={key:2,class:"border-t border-border"},zl={class:"font-medium"},Wl={key:3,class:"border-t border-border p-6 bg-muted/30 text-sm animate-fade-in"},Hl={class:"mb-6"},Yl={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Gl={key:0},Kl={class:"font-medium text-muted-foreground"},Ql={key:1},Jl={class:"font-medium text-muted-foreground"},Zl={key:2},Xl={class:"font-medium text-muted-foreground"},eo={class:"font-medium text-muted-foreground"},to={key:0},so={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ao={key:0},no={class:"font-medium text-muted-foreground"},lo={key:1},oo={class:"font-medium text-muted-foreground"},io={key:2},ro={class:"font-medium text-muted-foreground"},uo={key:3},co={class:"font-medium text-muted-foreground"},mo={key:4},fo={class:"font-mono text-xs bg-surface border border-border px-2 py-1 rounded inline-block text-muted-foreground"},vo={key:5},po={class:"font-medium text-muted-foreground"},yo={key:0,class:"mt-6 flex justify-end"},go={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const o=t,m=N(!1);I(()=>o.deliverySubstatus?mn(o.deliverySubstatus):"");const A=I(()=>o.deliverySubstatus?o.deliverySubstatus==="Delivered"?"green":o.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),j=I(()=>Gt(o.stage,o.entityType));function $(L){return!L||L.length===0?null:L.filter(be=>be.type==="offer").sort((be,fe)=>new Date(fe.timestamp)-new Date(be.timestamp))[0]||null}function v(L){if(!L)return 0;const O=new Date(L),fe=Math.abs(new Date-O);return Math.ceil(fe/(1e3*60*60*24))}const c=I(()=>{if(o.stage!=="In Negotiation")return null;const L=$(o.activities);if(!L)return null;const O=v(L.timestamp);return O<1?{label:"New Offer",theme:"orange"}:O<3?{label:"Active",theme:"yellow"}:null}),w=I(()=>o.requestedCar&&o.requestedCar.brand&&o.requestedCar.model),b=I(()=>o.requestType||o.requestMessage||w.value),d=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.brand)||""}),i=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.model)||""}),x=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.year)||""}),D=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.image)||""}),S=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.price)||null}),p=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.stockDays)!==void 0?o.requestedCar.stockDays:null}),r=I(()=>{var L,O;return((L=o.requestedCar)==null?void 0:L.dealership)||((O=o.task)==null?void 0:O.dealership)||""}),g=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.registration)||""}),y=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.kilometers)!==void 0?o.requestedCar.kilometers:null}),V=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.fuelType)||""}),H=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.gearType)||""}),ae=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.vin)||""}),le=I(()=>"Email"),te=I(()=>{var L,O;return((L=o.task)==null?void 0:L.sourceDetails)||((O=o.requestedCar)==null?void 0:O.adCampaign)||""}),re=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.expectedPurchaseDate)||""}),E=I(()=>{var L;return((L=o.task)==null?void 0:L.fiscalEntity)||""}),se=I(()=>{var L;return((L=o.task)==null?void 0:L.sourceDetails)||""}),xe=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.adMedium)||""}),Ae=I(()=>{var L;return((L=o.requestedCar)==null?void 0:L.adSource)||""});I(()=>!0);const he=I(()=>!0),J=I(()=>w.value||o.requestType||o.source||se.value||te.value||re.value||E.value||xe.value||Ae.value),T=L=>new Intl.NumberFormat("en-US").format(L),W=L=>new Intl.NumberFormat("en-US").format(L);return(L,O)=>(s(),P(a(We),{class:"w-full mb-6 shadow-mk-dashboard-card"},{default:k(()=>[l(a(_e),{class:"px-4 md:px-6 py-3 border-b border-border"},{default:k(()=>[e("div",yl,[b.value?(s(),n("div",gl,[O[2]||(O[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Request")],-1)),e("div",xl,[e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},f(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:z(["px-2 py-0.5 rounded text-xs font-medium border",j.value])},f(t.stage),3),t.deliverySubstatus?(s(),P(a(pe),{key:0,text:t.deliverySubstatus,size:"small",theme:A.value},null,8,["text","theme"])):u("",!0),c.value?(s(),P(a(pe),{key:1,text:c.value.label,size:"small",theme:c.value.theme},null,8,["text","theme"])):u("",!0)])])):(s(),n("div",hl)),e("div",bl,[O[3]||(O[3]=e("span",{class:"hidden md:inline text-xs text-muted-foreground font-medium"},"Owner",-1)),l(a(_),{onClick:O[0]||(O[0]=be=>L.$emit("reassign")),variant:"link",size:"small",class:"text-xs font-bold"},{default:k(()=>[M(f(t.owner),1)]),_:1})])])]),_:1}),b.value?(s(),P(a(ze),{key:0,class:"p-4 md:p-6"},{default:k(()=>[w.value?(s(),n("div",kl,[e("div",wl,[e("div",$l,[e("div",Cl,[D.value?(s(),n("img",{key:0,src:D.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Al)):(s(),n("i",Il))]),e("div",null,[e("div",Sl,f(d.value)+" "+f(i.value)+" ("+f(x.value)+")",1),e("div",Tl,[p.value!==void 0&&p.value!==null?(s(),n("div",Dl,[O[4]||(O[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+f(p.value)+" days) ",1)])):w.value?(s(),n("div",jl,[...O[5]||(O[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])])):u("",!0),t.source?(s(),n("div",ql,[O[6]||(O[6]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Source:",-1)),e("span",Vl,f(t.source),1)])):u("",!0)])])]),S.value?(s(),n("div",Ml,[O[7]||(O[7]=e("div",{class:"text-xs text-muted-foreground font-medium mb-1"},"Price",-1)),e("div",Ol,"€ "+f(T(S.value)),1)])):u("",!0)]),t.requestMessage?(s(),n("div",Ll,[O[8]||(O[8]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("div",El,[e("p",Nl,f(t.requestMessage),1)])])):u("",!0)])):(s(),n("div",Pl,[t.requestType?(s(),n("div",Fl,[O[9]||(O[9]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Request Type:",-1)),e("span",Rl,f(t.requestType),1)])):u("",!0),t.requestMessage?(s(),n("div",Bl,[O[10]||(O[10]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("p",Ul,f(t.requestMessage),1)])):u("",!0)])),J.value?(s(),n("div",_l,[e("button",{onClick:O[1]||(O[1]=be=>m.value=!m.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-muted-foreground hover:text-foreground hover:bg-muted transition-colors"},[e("span",zl,f(m.value?"Hide":"View")+" Details",1),e("i",{class:z(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":m.value}])},null,2)])])):u("",!0),m.value&&J.value?(s(),n("div",Wl,[e("div",Hl,[O[21]||(O[21]=e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Yl,[t.requestType?(s(),n("div",Gl,[O[11]||(O[11]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Request type",-1)),e("div",Kl,f(t.requestType),1)])):u("",!0),t.source?(s(),n("div",Ql,[O[12]||(O[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source",-1)),e("div",Jl,f(t.source),1)])):u("",!0),e("div",null,[O[13]||(O[13]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source details",-1)),e("div",{class:z(["font-medium",(se.value,"text-muted-foreground")])},f(se.value||"--"),3)]),r.value?(s(),n("div",Zl,[O[14]||(O[14]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",Xl,f(r.value),1)])):u("",!0),e("div",null,[O[15]||(O[15]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Channel",-1)),e("div",eo,f(le.value||"Email"),1)]),e("div",null,[O[16]||(O[16]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdCampaign",-1)),e("div",{class:z(["font-medium",(te.value,"text-muted-foreground")])},f(te.value||"--"),3)]),e("div",null,[O[17]||(O[17]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdMedium",-1)),e("div",{class:z(["font-medium",(xe.value,"text-muted-foreground")])},f(xe.value||"--"),3)]),e("div",null,[O[18]||(O[18]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdSource",-1)),e("div",{class:z(["font-medium",(Ae.value,"text-muted-foreground")])},f(Ae.value||"--"),3)]),e("div",null,[O[19]||(O[19]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Expected purchase date",-1)),e("div",{class:z(["font-medium",(re.value,"text-muted-foreground")])},f(re.value||"--"),3)]),e("div",null,[O[20]||(O[20]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fiscal entity",-1)),e("div",{class:z(["font-medium",(E.value,"text-muted-foreground")])},f(E.value||"--"),3)])])]),w.value?(s(),n("div",to,[O[30]||(O[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[O[29]||(O[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",so,[g.value?(s(),n("div",ao,[O[22]||(O[22]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Registration",-1)),e("div",no,f(g.value),1)])):u("",!0),y.value!==void 0&&y.value!==null?(s(),n("div",lo,[O[23]||(O[23]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Kilometers",-1)),e("div",oo,f(W(y.value))+" Km",1)])):u("",!0),V.value?(s(),n("div",io,[O[24]||(O[24]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fuel type",-1)),e("div",ro,f(V.value),1)])):u("",!0),H.value?(s(),n("div",uo,[O[25]||(O[25]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Gear type",-1)),e("div",co,f(H.value),1)])):u("",!0),ae.value?(s(),n("div",mo,[O[26]||(O[26]=e("div",{class:"text-xs text-muted-foreground mb-1"},"VIN Number",-1)),e("div",fo,f(ae.value),1)])):u("",!0),r.value?(s(),n("div",vo,[O[27]||(O[27]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",po,f(r.value),1)])):u("",!0)]),he.value?(s(),n("div",yo,[l(a(_),{variant:"outline",size:"small",class:"flex items-center gap-2"},{default:k(()=>[...O[28]||(O[28]=[e("i",{class:"fa-solid fa-list-check text-xs"},null,-1),M(" View technical specs ",-1)])]),_:1})])):u("",!0)])])):u("",!0)])):u("",!0)]),_:1})):u("",!0)]),_:1}))}},xo={class:"rounded-lg flex flex-col h-full bg-muted"},ho={class:"px-4 py-4 flex items-center justify-between shrink-0"},bo={class:"flex items-center gap-2"},ko={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1"},wo={class:"flex items-center gap-2 flex-wrap mb-3"},$o={key:0,class:"space-y-3"},Co={class:"flex items-center gap-3"},Ao={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},Io=["src"],So={key:1,class:"fa-solid fa-car text-2xl text-muted-foreground w-full h-full flex items-center justify-center"},To={class:"flex-1 min-w-0"},Do={class:"font-bold text-foreground text-sm mb-1"},jo={class:"flex items-center gap-2 flex-wrap"},qo={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},Vo={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},Mo={key:0,class:"text-right"},Oo={class:"font-bold text-foreground text-sm"},Lo={class:"flex justify-end pt-2"},Eo={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},No={class:"mt-3 pt-3 space-y-2"},Po={key:0,class:"flex items-center justify-between text-xs"},Fo={class:"text-foreground font-medium"},Ro={key:1,class:"flex items-center justify-between text-xs"},Bo={class:"text-foreground font-medium"},Uo={key:2,class:"pt-2"},_o={class:"bg-muted rounded-lg p-2"},zo={class:"text-xs text-muted-foreground leading-relaxed line-clamp-3"},Wa={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const o=t,m=I(()=>o.task.requestedCar&&o.task.requestedCar.brand&&o.task.requestedCar.model),A=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.brand)||""}),j=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.model)||""}),$=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.year)||""}),v=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.image)||""}),c=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.price)||null}),w=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.stockDays)!==void 0?o.task.requestedCar.stockDays:null}),b=I(()=>{var r;return((r=o.task.requestedCar)==null?void 0:r.requestMessage)||""}),d=I(()=>Gt(o.task.displayStage||o.task.stage,o.entityType)),i=I(()=>o.task.deliverySubstatus?o.task.deliverySubstatus==="Delivered"?"green":o.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function x(r){return!r||r.length===0?null:r.filter(y=>y.type==="offer").sort((y,V)=>new Date(V.timestamp)-new Date(y.timestamp))[0]||null}function D(r){if(!r)return 0;const g=new Date(r),V=Math.abs(new Date-g);return Math.ceil(V/(1e3*60*60*24))}const S=I(()=>{if((o.task.displayStage||o.task.stage)!=="In Negotiation")return null;const r=x(o.activities);if(!r)return null;const g=D(r.timestamp);return g<1?{label:"New Offer",theme:"orange"}:g<3?{label:"Active",theme:"yellow"}:null}),p=r=>new Intl.NumberFormat("en-US").format(r);return(r,g)=>{var y,V;return s(),n("div",xo,[e("div",ho,[g[4]||(g[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-foreground"}),e("h2",{class:"text-base font-medium text-foreground leading-6"},"Requested Car")],-1)),e("div",bo,[g[3]||(g[3]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Owner:",-1)),e("button",{onClick:g[0]||(g[0]=H=>r.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},f(t.task.assignee),1)])]),e("div",ko,[e("div",wo,[e("span",{class:z(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},f(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:z(["px-2 py-1 rounded text-xs font-medium border",d.value])},f(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(s(),P(a(pe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:i.value},null,8,["text","theme"])):u("",!0),S.value?(s(),P(a(pe),{key:1,text:S.value.label,size:"small",theme:S.value.theme},null,8,["text","theme"])):u("",!0)]),m.value?(s(),n("div",$o,[e("div",Co,[e("div",Ao,[v.value?(s(),n("img",{key:0,src:v.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Io)):(s(),n("i",So))]),e("div",To,[e("div",Do,f(A.value)+" "+f(j.value)+" ("+f($.value)+")",1),e("div",jo,[w.value!==void 0&&w.value!==null?(s(),n("div",qo,[g[5]||(g[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+f(w.value)+" days) ",1)])):(s(),n("div",Vo,[...g[6]||(g[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])]))])]),c.value?(s(),n("div",Mo,[g[7]||(g[7]=e("div",{class:"text-xs text-muted-foreground font-medium"},"Price",-1)),e("div",Oo,"€ "+f(p(c.value)),1)])):u("",!0)]),e("div",Lo,[l(a(_),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:g[1]||(g[1]=H=>r.$emit("add-requested-car")),class:"text-xs"},null,8,["label"])])])):(s(),n("div",Eo,[g[8]||(g[8]=e("i",{class:"fa-solid fa-car text-4xl text-muted-foreground mb-3"},null,-1)),g[9]||(g[9]=e("p",{class:"text-sm text-muted-foreground mb-4"},"No requested car added yet",-1)),l(a(_),{label:"+ Add or update",variant:"outline",size:"small",onClick:g[2]||(g[2]=H=>r.$emit("add-requested-car"))})])),e("div",No,[t.task.source?(s(),n("div",Po,[g[10]||(g[10]=e("span",{class:"text-muted-foreground"},"Source",-1)),e("span",Fo,f(t.task.source),1)])):u("",!0),t.task.requestType||(y=t.task.requestedCar)!=null&&y.requestType?(s(),n("div",Ro,[g[11]||(g[11]=e("span",{class:"text-muted-foreground"},"Request Type",-1)),e("span",Bo,f(t.task.requestType||((V=t.task.requestedCar)==null?void 0:V.requestType)),1)])):u("",!0),b.value?(s(),n("div",Uo,[g[12]||(g[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Message",-1)),e("div",_o,[e("p",zo,f(b.value),1)])])):u("",!0)])])])}}},Wo={class:"rounded-lg flex flex-col h-full bg-muted"},Ho={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},Yo={class:"flex items-center gap-2"},Go={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Ko={class:"bg-white rounded-lg p-3 shadow-nsc-card flex flex-col flex-1 min-h-0"},Qo={key:0,class:"text-center py-6 text-muted-foreground"},Jo={key:1,class:"space-y-2 overflow-y-auto flex-1"},Zo=["onClick"],Xo={class:"flex items-start justify-between gap-2"},ei={class:"flex-1 min-w-0"},ti={class:"flex items-center gap-2 mb-1 flex-wrap"},si={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-muted-foreground"},ai={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},ni={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-muted-foreground"},li={key:1,class:"flex items-center gap-1 text-xs text-muted-foreground"},oi={key:2,class:"flex items-center gap-1 text-xs text-muted-foreground"},ii={class:"truncate max-w-[150px]"},ri={key:3,class:"flex items-center gap-1 text-xs"},di={class:"font-bold text-foreground"},ui={key:2,class:"text-center py-8 text-muted-foreground"},Ha={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const o=t,m=Ve(),A=Qa(),j=Xa(),$=N(!1),v=N([]),c=N([]),w=I(()=>{var p;return o.task.customerId||((p=o.task.customer)==null?void 0:p.id)||null}),b=async()=>{if(w.value){$.value=!0;try{await Promise.all([A.fetchLeads(),j.fetchOpportunities()]),v.value=A.leads||[],c.value=j.opportunities||[]}catch(p){console.error("Error fetching related tasks:",p)}finally{$.value=!1}}},d=I(()=>{if(!w.value)return[];const p=[];return v.value.forEach(r=>{r.customerId===w.value&&!(r.id===o.task.id&&o.entityType==="lead")&&p.push({...r,type:"lead"})}),c.value.forEach(r=>{r.customerId===w.value&&!(r.id===o.task.id&&o.entityType==="opportunity")&&p.push({...r,type:"opportunity"})}),p.sort((r,g)=>{const y=new Date(r.createdAt||0);return new Date(g.createdAt||0)-y})}),i=p=>{const r=p.requestedCar||p.vehicle;return r&&r.brand&&r.model?`${r.brand} ${r.model}`:null},x=p=>p?new Intl.NumberFormat("en-US").format(p):"0",D=p=>{if(!p)return"";const r=new Date(p),y=new Date-r,V=Math.floor(y/(1e3*60*60*24));return V===0?"Today":V===1?"Yesterday":V<7?`${V} days ago`:V<30?`${Math.floor(V/7)} weeks ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},S=p=>{m.push({path:`/tasks/${p.id}`,query:{type:p.type}})};return qe(()=>o.task.id,()=>{b()},{immediate:!0}),wt(()=>{b()}),(p,r)=>(s(),n("div",Wo,[e("div",Ho,[e("div",Yo,[r[0]||(r[0]=e("i",{class:"fa-solid fa-list text-foreground text-xs"},null,-1)),r[1]||(r[1]=e("h2",{class:"text-xs font-medium text-foreground"},"Other Tasks for This Customer",-1)),d.value.length>0?(s(),n("span",Go,f(d.value.length),1)):u("",!0)])]),e("div",Ko,[$.value?(s(),n("div",Qo,[...r[2]||(r[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):d.value.length>0?(s(),n("div",Jo,[(s(!0),n(G,null,ee(d.value,g=>(s(),n("div",{key:`${g.type}-${g.id}`,class:"flex flex-col p-2 border border-border rounded-lg hover:bg-muted transition-colors cursor-pointer group",onClick:y=>S(g)},[e("div",Xo,[e("div",ei,[e("div",ti,[e("span",{class:z(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",g.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},f(g.type==="lead"?"Lead":"Opp"),3),e("span",{class:z(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",a(Gt)(g.displayStage||g.stage,g.type)])},f(g.displayStage||g.stage),3),g.createdAt?(s(),n("div",si,[e("span",null,f(D(g.createdAt)),1)])):u("",!0)]),e("div",ai,[g.createdAt?(s(),n("div",ni,[r[3]||(r[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,f(D(g.createdAt)),1)])):u("",!0),g.assignee?(s(),n("div",li,[r[4]||(r[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,f(g.assignee),1)])):u("",!0),i(g)?(s(),n("div",oi,[r[5]||(r[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",ii,f(i(g)),1)])):u("",!0),g.type==="opportunity"&&g.value?(s(),n("div",ri,[r[6]||(r[6]=e("i",{class:"fa-solid fa-tag text-muted-foreground opacity-70"},null,-1)),e("span",di,"€ "+f(x(g.value)),1)])):u("",!0)])]),r[7]||(r[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-brand-blue/30 text-muted-foreground hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,Zo))),128))])):(s(),n("div",ui,[...r[8]||(r[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},ci={key:0,class:"flex-grow border-t border"},mi={key:0,class:"ml-1.5 text-muted-foreground"},fi={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},vi={key:1,class:"flex-grow border-t border"},Ya={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:o}){const m=t,A=o,j=N(!1),$={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},v=I(()=>{if(!m.activeTab||m.activeTab==="overview")return m.actions.filter(p=>!$[p]);const S=Object.entries($).filter(([,p])=>p===m.activeTab).map(([p])=>p);return m.actions.filter(p=>S.includes(p))}),c=I(()=>m.activeTab==="communication"?!0:v.value.length===1),w=I(()=>{if(m.activeTab==="communication")return"add communication";if(!c.value||v.value.length!==1)return"";const S=v.value[0];return{note:"add note",attachment:"add attachment"}[S]||""}),b=I(()=>m.activeTab==="communication"?!1:v.value.length>1),d=I(()=>{const S={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return v.value.map(p=>({key:p,label:S[p]||p,onClick:()=>x(p)}))}),i=I(()=>{if(m.inline)return"bg-surface hover:bg-muted text-muted-foreground font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";const S="bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";return c.value?`${S} px-4 py-2 h-9`:`${S} w-9 h-9`});I(()=>v.value.some(S=>["email","whatsapp","sms"].includes(S))),I(()=>v.value.some(S=>["addVehicle","configureVehicle"].includes(S))),I(()=>v.value.some(S=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(S)));const x=S=>{j.value=!1,A("action",S)},D=()=>{if(m.activeTab==="communication"){x("call");return}c.value&&v.value.length===1?x(v.value[0]):j.value=!j.value};return(S,p)=>{const r=Ja("click-outside");return t.show?(s(),n("div",{key:0,class:z(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?u("",!0):(s(),n("div",ci)),e("div",{class:z(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:je(D,["stop"]),class:z(i.value)},[p[0]||(p[0]=e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1)),c.value?(s(),n("span",mi,f(w.value),1)):u("",!0)],2),j.value&&b.value?de((s(),n("div",fi,[l(a(tn),{items:d.value,className:"w-48"},null,8,["items"])])),[[r,()=>j.value=!1]]):u("",!0)],2),t.inline?u("",!0):(s(),n("div",vi))],2)):u("",!0)}}},pi={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},yi={class:"flex items-start gap-3"},gi={class:"flex-1 min-w-0"},xi={class:"font-bold text-sm text-foreground mb-2"},hi={class:"space-y-1.5 text-xs text-gray-600"},bi={class:"flex items-center gap-2"},ki={class:"flex items-center gap-2"},wi={class:"flex items-center gap-2"},$i={key:0,class:"mt-2"},Ci={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const o=t,m=I(()=>o.appointmentData.date?new Date(o.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),A=I(()=>o.appointmentData.time?o.appointmentData.time:""),j=$=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[$==null?void 0:$.toLowerCase()]||"bg-muted text-muted-foreground border border-border";return($,v)=>(s(),n("div",pi,[e("div",yi,[v[3]||(v[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",gi,[e("h4",xi,f(t.appointmentData.type),1),e("div",hi,[e("div",bi,[v[0]||(v[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,f(m.value),1)]),e("div",ki,[v[1]||(v[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,f(A.value),1)]),e("div",wi,[v[2]||(v[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,f(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),n("div",$i,[e("span",{class:z(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",j(t.appointmentData.status)])},f(t.appointmentData.status),3)])):u("",!0)])])]))}},Ai={class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in mb-4 feed-item"},Ii={class:"flex-1"},Si={class:"flex items-center gap-2 mb-1"},Ti={class:"text-sm font-bold text-foreground"},Di={class:"text-sm text-muted-foreground"},ji={class:"text-sm text-muted-foreground"},qi={key:0,class:"bg-blue-50 text-blue-600 text-sm px-1 py-0.5 rounded border border-blue-100"},Vi={class:"ml-auto relative"},Mi={key:0,class:"absolute right-0 top-full mt-1 z-10"},Oi={key:0,class:"text-sm text-muted-foreground"},Li={key:1,class:"text-sm text-muted-foreground flex items-center gap-2"},Ei={key:2,class:"mt-2"},Ni={key:0},Pi={key:1,class:"bg-white border border-border rounded-lg p-3"},Fi={key:0},Ri={class:"text-sm font-bold text-foreground"},Bi={key:0,class:"text-sm text-muted-foreground mt-0.5"},Ui={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-muted-foreground mt-2"},_i={key:0},zi={key:1},Wi={key:2},Hi={key:3},Yi={key:4},Gi={key:1},Ki={class:"text-sm font-bold text-foreground mb-2"},Qi={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},Ji={key:0},Zi={class:"text-muted-foreground font-medium ml-1"},Xi={key:1},er={class:"text-muted-foreground font-medium ml-1"},tr={key:2},sr={class:"text-muted-foreground font-medium ml-1"},ar={key:3},nr={class:"text-muted-foreground font-medium ml-1"},lr={key:4},or={class:"text-muted-foreground font-medium ml-1"},ir={key:5},rr={class:"text-muted-foreground font-medium ml-1"},dr={key:2},ur={key:0,class:"inline-block mt-2 bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},cr={key:3,class:"flex items-center gap-3"},mr={class:"flex-1"},fr={class:"text-sm font-bold text-foreground"},vr={class:"text-sm text-muted-foreground"},pr={key:0,class:"text-sm text-muted-foreground mt-1"},yr={key:1,class:"text-sm text-muted-foreground mt-1"},gr={key:4},xr={class:"text-sm font-bold text-foreground mb-2"},hr={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},br={key:0},kr={class:"text-muted-foreground font-medium ml-1"},wr={key:1},$r={class:"text-muted-foreground font-medium ml-1"},Cr={key:2},Ar={class:"text-muted-foreground font-medium ml-1"},Ir={key:3},Sr={class:"text-muted-foreground font-medium ml-1"},Tr={key:4},Dr={class:"text-muted-foreground font-medium ml-1"},jr={key:5},qr={class:"text-muted-foreground font-medium ml-1"},Vr={key:0,class:"flex flex-wrap gap-2 mt-2"},Mr={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Or={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},Lr={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},zt={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:o}){const m=t,A=o,j=N(!1),$=I(()=>[{key:"edit",label:"Edit",onClick:i},{key:"delete",label:"Delete",onClick:x}]),v=D=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[D]||"fa-solid fa-circle",c=D=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-muted text-muted-foreground border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-muted text-muted-foreground border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[D]||"bg-muted text-muted-foreground border",w=D=>{if(!D)return"Just now";const S=new Date(D),r=new Date-S,g=Math.floor(r/6e4),y=Math.floor(g/60),V=Math.floor(y/24);return g<1?"Just now":g<60?`${g} minutes ago`:y<24?`${y} hours ago`:V===1?"Yesterday":V<7?`${V} days ago`:S.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=D=>D?new Intl.NumberFormat("en-US").format(D):"0",d=D=>D?new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",i=()=>{j.value=!1,A("edit",m.item)},x=()=>{j.value=!1,confirm("Are you sure you want to delete this item?")&&A("delete",m.item)};return(D,S)=>{const p=Ja("click-outside");return s(),n("div",Ai,[e("div",{class:z(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",c(t.item.type)])},[e("i",{class:z([v(t.item.type),"text-sm"])},null,2)],2),e("div",Ii,[e("div",Si,[e("span",Ti,f(t.customerInitials),1),e("span",Di,f(t.item.action||"added"),1),e("span",ji,"• "+f(w(t.item.timestamp)),1),t.item.autoDetected?(s(),n("span",qi,"Auto-detected")):u("",!0),e("div",Vi,[e("button",{onClick:S[0]||(S[0]=je(r=>j.value=!j.value,["stop"])),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...S[1]||(S[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),j.value?de((s(),n("div",Mi,[l(a(tn),{items:$.value,className:"w-32"},null,8,["items"])])),[[p,()=>j.value=!1]]):u("",!0)])]),t.item.content?(s(),n("div",Oi,f(t.item.content),1)):u("",!0),t.item.fileName?(s(),n("div",Li,[S[2]||(S[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,f(t.item.fileName),1)])):u("",!0),t.item.data?(s(),n("div",Ei,[t.item.type==="appointment"?(s(),n("div",Ni,[l(Ci,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),n("div",Pi,[t.item.type==="tradein"?(s(),n("div",Fi,[e("h4",Ri,f(t.item.data.brand)+" "+f(t.item.data.model),1),t.item.data.version?(s(),n("p",Bi,f(t.item.data.version),1)):u("",!0),e("div",Ui,[t.item.data.year?(s(),n("div",_i,[S[3]||(S[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),M(f(t.item.data.year),1)])):u("",!0),t.item.data.km?(s(),n("div",zi,[S[4]||(S[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),M(f(t.item.data.km)+" km ",1)])):u("",!0),t.item.data.plate?(s(),n("div",Wi,[S[5]||(S[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),M(f(t.item.data.plate),1)])):u("",!0),t.item.data.date?(s(),n("div",Hi,[S[6]||(S[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),M(f(d(t.item.data.date)),1)])):u("",!0),t.item.data.class?(s(),n("div",Yi,[S[7]||(S[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),M(f(t.item.data.class),1)])):u("",!0)])])):t.item.type==="financing"?(s(),n("div",Gi,[e("h4",Ki,f(t.item.data.product),1),e("div",Qi,[t.item.data.provider?(s(),n("div",Ji,[S[8]||(S[8]=e("span",{class:"text-muted-foreground"},"Provider:",-1)),e("span",Zi,f(t.item.data.provider),1)])):u("",!0),t.item.data.total?(s(),n("div",Xi,[S[9]||(S[9]=e("span",{class:"text-muted-foreground"},"Total:",-1)),e("span",er,"€"+f(b(t.item.data.total)),1)])):u("",!0),t.item.data.monthly?(s(),n("div",tr,[S[10]||(S[10]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",sr,"€"+f(b(t.item.data.monthly)),1)])):u("",!0),t.item.data.deposit?(s(),n("div",ar,[S[11]||(S[11]=e("span",{class:"text-muted-foreground"},"Deposit:",-1)),e("span",nr,"€"+f(b(t.item.data.deposit)),1)])):u("",!0),t.item.data.startDate?(s(),n("div",lr,[S[12]||(S[12]=e("span",{class:"text-muted-foreground"},"Start:",-1)),e("span",or,f(d(t.item.data.startDate)),1)])):u("",!0),t.item.data.expDate?(s(),n("div",ir,[S[13]||(S[13]=e("span",{class:"text-muted-foreground"},"Expires:",-1)),e("span",rr,f(d(t.item.data.expDate)),1)])):u("",!0)])])):t.item.type==="offer"?(s(),n("div",dr,[l(In,{offers:[t.item.data],"opportunity-id":t.item.opportunityId||t.item.leadId||""},null,8,["offers","opportunity-id"]),t.item.data.isMainOffer?(s(),n("span",ur,"Main Offer")):u("",!0)])):t.item.type==="purchase"?(s(),n("div",cr,[e("div",mr,[e("h4",fr,f(t.item.data.brand)+" "+f(t.item.data.model)+" ("+f(t.item.data.year)+")",1),e("p",vr,"€ "+f(b(t.item.data.price)),1),t.item.data.purchaseDate?(s(),n("p",pr,"Purchased: "+f(d(t.item.data.purchaseDate)),1)):u("",!0),t.item.data.notes?(s(),n("p",yr,f(t.item.data.notes),1)):u("",!0)])])):t.item.type==="purchase-method"?(s(),n("div",gr,[e("h4",xr,f(t.item.data.typeLabel||t.item.data.type),1),e("div",hr,[t.item.data.monthlyInstalment?(s(),n("div",br,[S[14]||(S[14]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",kr,"€"+f(b(t.item.data.monthlyInstalment)),1)])):u("",!0),t.item.data.duration?(s(),n("div",wr,[S[15]||(S[15]=e("span",{class:"text-muted-foreground"},"Duration:",-1)),e("span",$r,f(t.item.data.duration)+" months",1)])):u("",!0),t.item.data.downPayment?(s(),n("div",Cr,[S[16]||(S[16]=e("span",{class:"text-muted-foreground"},"Down Payment:",-1)),e("span",Ar,"€"+f(b(t.item.data.downPayment)),1)])):u("",!0),t.item.data.interestRate?(s(),n("div",Ir,[S[17]||(S[17]=e("span",{class:"text-muted-foreground"},"Interest Rate:",-1)),e("span",Sr,f(t.item.data.interestRate)+"%",1)])):u("",!0),t.item.data.mileageLimit?(s(),n("div",Tr,[S[18]||(S[18]=e("span",{class:"text-muted-foreground"},"Mileage Limit:",-1)),e("span",Dr,f(b(t.item.data.mileageLimit))+" km/year",1)])):u("",!0),t.item.data.customerType?(s(),n("div",jr,[S[19]||(S[19]=e("span",{class:"text-muted-foreground"},"Customer Type:",-1)),e("span",qr,f(t.item.data.customerType),1)])):u("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(s(),n("div",Vr,[t.item.data.insuranceIncluded?(s(),n("span",Mr,"Insurance")):u("",!0),t.item.data.maintenanceIncluded?(s(),n("span",Or,"Maintenance")):u("",!0),t.item.data.registrationTaxesIncluded?(s(),n("span",Lr,"Registration/Taxes")):u("",!0)])):u("",!0)])):u("",!0)]))])):u("",!0)])])}}},Er={class:"space-y-3"},Nr={class:"space-y-2"},Pr={class:"flex-1"},Fr={class:"text-xs text-muted-foreground uppercase"},Rr={class:"flex justify-end gap-2 pt-3 border-t border-border"},Ga={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:o}){const m=t,A=o,j=N(""),$=v=>{v==="copy"&&navigator.clipboard.writeText(m.phoneNumber),A("call",{type:"call",option:v,phoneNumber:m.phoneNumber,notes:j.value})};return(v,c)=>(s(),n("div",Er,[e("div",Nr,[c[10]||(c[10]=e("label",{class:"block text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:c[0]||(c[0]=w=>$("outbound")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...c[5]||(c[5]=[Ea('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-muted-foreground uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:c[1]||(c[1]=w=>$("pbx")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...c[6]||(c[6]=[Ea('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with PBX</p><p class="text-xs text-muted-foreground uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:c[2]||(c[2]=w=>$("copy")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[c[8]||(c[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Pr,[c[7]||(c[7]=e("p",{class:"font-bold text-sm text-foreground uppercase tracking-tight"},"Copy Number",-1)),e("p",Fr,f(t.phoneNumber),1)]),c[9]||(c[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Call Notes",-1)),de(e("textarea",{"onUpdate:modelValue":c[3]||(c[3]=w=>j.value=w),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[Ne,j.value]])]),e("div",Rr,[l(a(_),{label:"Cancel",variant:"outline",size:"small",onClick:c[4]||(c[4]=w=>v.$emit("cancel"))})])]))}},Br={key:0,class:"space-y-4"},Ur={class:"grid grid-cols-4 gap-2"},_r=["onClick"],zr={class:"text-xs font-bold uppercase tracking-wider"},Wr={key:1,class:"space-y-4"},Hr={class:"grid grid-cols-4 gap-2"},Yr=["onClick"],Gr={class:"text-xs font-bold uppercase tracking-wider"},Kr={key:0},Qr={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:o}){const m=t,A=o,j=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],$=N(m.type);qe(()=>m.type,d=>{d?$.value=d:$.value=null}),qe(()=>m.taskId,()=>{$.value=null});const v=I(()=>d=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${$.value===d?"border-brand-dark bg-muted text-brand-dark shadow-nsc-card":"border-border text-muted-foreground hover:border-brand-dark/30 hover:bg-muted/30 hover:text-muted-foreground"}`),c=d=>{A("save",{type:"communication",action:`sent via ${d.type}`,content:d.message,communicationType:d.type,template:d.template,subject:d.subject}),A("send",d)},w=d=>{A("save",{type:"communication",action:`called via ${d.option}`,content:d.notes||"Call attempt logged",communicationType:"call",callOption:d.option}),A("send",{type:"call",option:d.option,phoneNumber:d.phoneNumber,notes:d.notes})},b=()=>{$.value=null,A("cancel")};return(d,i)=>t.inline?(s(),n("div",Wr,[e("div",Hr,[(s(),n(G,null,ee(j,x=>e("button",{key:x.id,onClick:D=>$.value=x.id,class:z(v.value(x.id))},[e("i",{class:z([x.icon,"text-sm"])},null,2),e("span",Gr,f(x.label),1)],10,Yr)),64))]),$.value?(s(),n("div",Kr,[$.value==="email"?(s(),P(Fa,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="sms"?(s(),P(Ra,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="whatsapp"?(s(),P(Ba,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="call"?(s(),P(Ga,{key:3,"phone-number":t.phoneNumber,onCall:w,onCancel:b},null,8,["phone-number"])):u("",!0)])):u("",!0)])):(s(),n("div",Br,[e("div",Ur,[(s(),n(G,null,ee(j,x=>e("button",{key:x.id,onClick:D=>$.value=x.id,class:z(v.value(x.id))},[e("i",{class:z([x.icon,"text-sm"])},null,2),e("span",zr,f(x.label),1)],10,_r)),64))]),e("div",null,[$.value==="email"?(s(),P(Fa,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="sms"?(s(),P(Ra,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="whatsapp"?(s(),P(Ba,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:c,onCancel:b},null,8,["initial-template","initial-message"])):$.value==="call"?(s(),P(Ga,{key:3,"phone-number":t.phoneNumber,onCall:w,onCancel:b},null,8,["phone-number"])):u("",!0)])]))}},Jr={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},Zr={key:1,class:"flex justify-between items-center mb-4"},Xr={class:"text-sm font-semibold text-foreground"},ed={class:"space-y-4"},td={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},sd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ad={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},nd={class:"border border-border rounded-lg bg-muted"},ld={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},od={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},id={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},dd={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:m}){const A=t,j=m,$=N(!1),v=N({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),c=N({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),w=I(()=>!!v.value.brand&&!!v.value.model&&!!v.value.year);wt(()=>{A.item&&A.item.data&&(v.value={brand:A.item.data.brand||"",model:A.item.data.model||"",year:A.item.data.year||"",version:A.item.data.version||"",vin:A.item.data.vin||"",plates:A.item.data.plate||A.item.data.plates||"",fuelType:A.item.data.fuelType||"",gearType:A.item.data.gearType||"",kilometers:A.item.data.km||A.item.data.kilometers||"",registration:A.item.data.date||A.item.data.registration||""},A.item.data.tradeInPrice!==void 0&&(c.value={tradeInPrice:A.item.data.tradeInPrice||null,evaluationRangeLow:A.item.data.evaluationRangeLow||null,evaluationRangeHigh:A.item.data.evaluationRangeHigh||null,provider:A.item.data.provider||"",evaluationDate:A.item.data.evaluationDate||""},$.value=!0))});const b=()=>{var i,x;if(!w.value)return;const d={id:((i=A.item)==null?void 0:i.id)||Date.now(),type:"tradein",action:A.item?"updated a trade-in":"added a trade-in",timestamp:((x=A.item)==null?void 0:x.timestamp)||new Date().toISOString(),isEdit:!!A.item,data:{brand:v.value.brand,model:v.value.model,year:parseInt(v.value.year)||null,version:v.value.version||null,vin:v.value.vin||null,plate:v.value.plates||null,plates:v.value.plates||null,fuelType:v.value.fuelType||null,gearType:v.value.gearType||null,km:parseInt(v.value.kilometers)||0,kilometers:parseInt(v.value.kilometers)||0,date:v.value.registration||null,registration:v.value.registration||null,tradeInPrice:c.value.tradeInPrice,evaluationRangeLow:c.value.evaluationRangeLow,evaluationRangeHigh:c.value.evaluationRangeHigh,provider:c.value.provider||null,evaluationDate:c.value.evaluationDate||null}};j("save",d)};return o({submit:b,canSubmit:()=>w.value}),(d,i)=>(s(),n("div",{class:z(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?u("",!0):(s(),n("div",Jr)),t.hideHeader?u("",!0):(s(),n("div",Zr,[e("h5",Xr,f(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:i[0]||(i[0]=x=>d.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...i[18]||(i[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",ed,[e("div",td,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[19]||(i[19]=[M("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.brand,"onUpdate:modelValue":i[1]||(i[1]=x=>v.value.brand=x),type:"text",placeholder:"e.g., Volkswagen",required:""},null,8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[20]||(i[20]=[M("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.model,"onUpdate:modelValue":i[2]||(i[2]=x=>v.value.model=x),type:"text",placeholder:"e.g., ID.4",required:""},null,8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[21]||(i[21]=[M("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.year,"onUpdate:modelValue":i[3]||(i[3]=x=>v.value.year=x),type:"number",placeholder:"e.g., 2024",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[22]||(i[22]=[M("Version/Trim",-1)])]),_:1}),l(a(ie),{modelValue:v.value.version,"onUpdate:modelValue":i[4]||(i[4]=x=>v.value.version=x),type:"text",placeholder:"e.g., Premium Plus"},null,8,["modelValue"])]),e("div",sd,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[23]||(i[23]=[M("VIN",-1)])]),_:1}),l(a(ie),{modelValue:v.value.vin,"onUpdate:modelValue":i[5]||(i[5]=x=>v.value.vin=x),type:"text",placeholder:"Vehicle Identification Number"},null,8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[24]||(i[24]=[M("Plates",-1)])]),_:1}),l(a(ie),{modelValue:v.value.plates,"onUpdate:modelValue":i[6]||(i[6]=x=>v.value.plates=x),type:"text",placeholder:"License plate number"},null,8,["modelValue"])])]),e("div",ad,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[25]||(i[25]=[M("Fuel Type",-1)])]),_:1}),l(a(at),{modelValue:v.value.fuelType,"onUpdate:modelValue":i[7]||(i[7]=x=>v.value.fuelType=x)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select fuel type..."})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Petrol"},{default:k(()=>[...i[26]||(i[26]=[M("Petrol",-1)])]),_:1}),l(a(oe),{value:"Diesel"},{default:k(()=>[...i[27]||(i[27]=[M("Diesel",-1)])]),_:1}),l(a(oe),{value:"Electric"},{default:k(()=>[...i[28]||(i[28]=[M("Electric",-1)])]),_:1}),l(a(oe),{value:"Hybrid"},{default:k(()=>[...i[29]||(i[29]=[M("Hybrid",-1)])]),_:1}),l(a(oe),{value:"Plug-in Hybrid"},{default:k(()=>[...i[30]||(i[30]=[M("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[31]||(i[31]=[M("Gear Type",-1)])]),_:1}),l(a(at),{modelValue:v.value.gearType,"onUpdate:modelValue":i[8]||(i[8]=x=>v.value.gearType=x)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select gear type..."})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Manual"},{default:k(()=>[...i[32]||(i[32]=[M("Manual",-1)])]),_:1}),l(a(oe),{value:"Automatic"},{default:k(()=>[...i[33]||(i[33]=[M("Automatic",-1)])]),_:1}),l(a(oe),{value:"CVT"},{default:k(()=>[...i[34]||(i[34]=[M("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[35]||(i[35]=[M("Mileage (km)",-1)])]),_:1}),l(a(ie),{modelValue:v.value.kilometers,"onUpdate:modelValue":i[9]||(i[9]=x=>v.value.kilometers=x),modelModifiers:{number:!0},type:"number",placeholder:"0",min:"0"},null,8,["modelValue"])])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[36]||(i[36]=[M("Registration Year/Month",-1)])]),_:1}),l(a(ie),{modelValue:v.value.registration,"onUpdate:modelValue":i[10]||(i[10]=x=>v.value.registration=x),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)"},null,8,["modelValue"])]),e("div",nd,[e("button",{type:"button",onClick:i[11]||(i[11]=x=>$.value=!$.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-lg"},[i[37]||(i[37]=e("h3",{class:"text-sm font-medium text-foreground"},"Valuation Information",-1)),e("i",{class:z(["fa-solid transition-transform duration-200 text-muted-foreground",$.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),$.value?(s(),n("div",ld,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[38]||(i[38]=[M("Trade-In Price (€)",-1)])]),_:1}),l(a(ie),{modelValue:c.value.tradeInPrice,"onUpdate:modelValue":i[12]||(i[12]=x=>c.value.tradeInPrice=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",od,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[39]||(i[39]=[M("Evaluation Range - Low (€)",-1)])]),_:1}),l(a(ie),{modelValue:c.value.evaluationRangeLow,"onUpdate:modelValue":i[13]||(i[13]=x=>c.value.evaluationRangeLow=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[40]||(i[40]=[M("Evaluation Range - High (€)",-1)])]),_:1}),l(a(ie),{modelValue:c.value.evaluationRangeHigh,"onUpdate:modelValue":i[14]||(i[14]=x=>c.value.evaluationRangeHigh=x),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])])]),e("div",id,[e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[41]||(i[41]=[M("Provider",-1)])]),_:1}),l(a(at),{modelValue:c.value.provider,"onUpdate:modelValue":i[15]||(i[15]=x=>c.value.provider=x)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select provider..."})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Eurotax"},{default:k(()=>[...i[42]||(i[42]=[M("Eurotax",-1)])]),_:1}),l(a(oe),{value:"Infocar"},{default:k(()=>[...i[43]||(i[43]=[M("Infocar",-1)])]),_:1}),l(a(oe),{value:"Manual"},{default:k(()=>[...i[44]||(i[44]=[M("Manual",-1)])]),_:1}),l(a(oe),{value:"Other"},{default:k(()=>[...i[45]||(i[45]=[M("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[l(a(X),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:k(()=>[...i[46]||(i[46]=[M("Evaluation Date",-1)])]),_:1}),l(a(ie),{modelValue:c.value.evaluationDate,"onUpdate:modelValue":i[16]||(i[16]=x=>c.value.evaluationDate=x),type:"date"},null,8,["modelValue"])])])])):u("",!0)])]),t.hideActions?u("",!0):(s(),n("div",rd,[l(a(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:i[17]||(i[17]=x=>d.$emit("cancel"))}),l(a(_),{label:"Save",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!w.value,onClick:b},null,8,["disabled"])]))],2))}},ud={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},cd={key:1,class:"flex justify-between items-center mb-4"},md={class:"text-sm font-semibold text-foreground"},fd={class:"flex gap-2"},vd=["value"],pd={key:0,class:"space-y-4"},yd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gd={class:"relative"},xd={key:0,class:"text-xs text-red-600 mt-1"},hd={class:"relative"},bd={key:0,class:"text-xs text-red-600 mt-1"},kd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wd=["value"],$d={key:0,class:"text-xs text-red-600 mt-1"},Cd={key:0},Ad={class:"relative"},Id={key:1},Sd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Td={class:"relative"},Dd={class:"relative"},jd={class:"flex items-center gap-2"},qd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vd={class:"relative"},Md={class:"bg-muted p-4 rounded-lg border border-border"},Od={class:"flex justify-between items-center"},Ld={class:"text-lg font-bold text-foreground"},Ed={class:"flex flex-col gap-2"},Nd={class:"flex items-center gap-2"},Pd={class:"flex items-center gap-2"},Fd={key:0,class:"text-xs text-red-600 mt-1"},Rd={class:"bg-muted p-4 rounded-lg border border-border"},Bd={class:"flex justify-between items-center"},Ud={class:"text-lg font-bold text-foreground"},_d={class:"flex flex-col gap-2"},zd={class:"flex items-center gap-2"},Wd={class:"flex items-center gap-2"},Hd={class:"flex items-center gap-2"},Yd={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Gd={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:m}){const A=t,j=m,$=N({}),v=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],c=N({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),w=I(()=>{if(c.value.type!=="LEA")return 0;const g=parseFloat(c.value.fields.monthlyInstalment)||0,y=parseInt(c.value.fields.duration)||0,V=parseFloat(c.value.fields.downPayment)||0,H=parseFloat(c.value.fields.finalInstalment)||0;return g*y+V+H}),b=I(()=>{if(c.value.type!=="LTR")return 0;const g=parseFloat(c.value.fields.monthlyInstalment)||0,y=parseInt(c.value.fields.duration)||0,V=parseFloat(c.value.fields.downPayment)||0;return g*y+V}),d=g=>g==="FIN"?[12,24,36,48,60]:g==="LEA"?[24,36,48,60]:g==="LTR"?[12,24,36,48,60]:[],i=g=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[g]||g,x=g=>g?new Intl.NumberFormat("en-US").format(g):"0",D=g=>{delete $.value[g]},S=I(()=>!c.value.type||!c.value.fields.monthlyInstalment||c.value.fields.monthlyInstalment<=0||c.value.fields.downPayment===null||c.value.fields.downPayment===void 0||c.value.fields.downPayment<0||!c.value.fields.duration||c.value.fields.duration<12||c.value.fields.duration>60||c.value.type==="LTR"&&!c.value.fields.customerType?!1:Object.keys($.value).length===0),p=()=>{c.value.type!=="FIN"&&(c.value.fields.effectiveInterestRate=null,c.value.fields.gfv=null),c.value.type!=="LEA"&&(c.value.fields.finalInstalment=null),c.value.type!=="LTR"&&(c.value.fields.customerType="",c.value.fields.registrationTaxesIncluded=!1),c.value.type!=="LEA"&&c.value.type!=="LTR"&&(c.value.fields.mileageLimit=null,c.value.fields.maintenanceIncluded=!1),$.value={}};wt(()=>{A.item&&A.item.data&&(c.value={type:A.item.data.type||"",fields:{monthlyInstalment:A.item.data.monthlyInstalment||null,downPayment:A.item.data.downPayment||null,duration:A.item.data.duration||null,interestRate:A.item.data.interestRate||null,effectiveInterestRate:A.item.data.effectiveInterestRate||null,gfv:A.item.data.gfv||null,mileageLimit:A.item.data.mileageLimit||null,finalInstalment:A.item.data.finalInstalment||null,customerType:A.item.data.customerType||"",insuranceIncluded:A.item.data.insuranceIncluded||!1,maintenanceIncluded:A.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:A.item.data.registrationTaxesIncluded||!1}})});const r=()=>{var ae,le;if(!S.value)return;const g=i(c.value.type),y=c.value.fields.monthlyInstalment||0,V=c.value.fields.duration||0,H={id:((ae=A.item)==null?void 0:ae.id)||Date.now(),type:"purchase-method",action:A.item?"updated a purchase method":"added a purchase method",content:`${g}: €${x(y)}/month for ${V} months`,timestamp:((le=A.item)==null?void 0:le.timestamp)||new Date().toISOString(),isEdit:!!A.item,data:{type:c.value.type,typeLabel:g,monthlyInstalment:c.value.fields.monthlyInstalment,downPayment:c.value.fields.downPayment,duration:c.value.fields.duration,interestRate:c.value.fields.interestRate,effectiveInterestRate:c.value.fields.effectiveInterestRate,gfv:c.value.fields.gfv,mileageLimit:c.value.fields.mileageLimit,finalInstalment:c.value.fields.finalInstalment,customerType:c.value.fields.customerType,insuranceIncluded:c.value.fields.insuranceIncluded,maintenanceIncluded:c.value.fields.maintenanceIncluded,registrationTaxesIncluded:c.value.fields.registrationTaxesIncluded,totalLeasingAmount:w.value,totalRentalAmount:b.value}};j("save",H)};return o({submit:r,canSubmit:()=>S.value}),(g,y)=>(s(),n("div",{class:z(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?u("",!0):(s(),n("div",ud)),t.hideHeader?u("",!0):(s(),n("div",cd,[e("h5",md,f(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:y[0]||(y[0]=V=>g.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...y[23]||(y[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:je(r,["prevent"]),class:"space-y-4"},[e("div",null,[y[24]||(y[24]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-2"},[M("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fd,[(s(),n(G,null,ee(v,V=>e("label",{key:V.value,class:"flex-1 cursor-pointer"},[de(e("input",{type:"radio",value:V.value,"onUpdate:modelValue":y[1]||(y[1]=H=>c.value.type=H),class:"sr-only",onChange:p},null,40,vd),[[fn,c.value.type]]),e("div",{class:z(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",c.value.type===V.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-muted-foreground hover:border-brand-slate"])},f(V.label),3)])),64))])]),c.value.type?(s(),n("div",pd,[e("div",yd,[e("div",null,[y[26]||(y[26]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",gd,[y[25]||(y[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),de(e("input",{"onUpdate:modelValue":y[2]||(y[2]=V=>c.value.fields.monthlyInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:z(["input pl-8",{"border-red-500":$.value.monthlyInstalment}]),onInput:y[3]||(y[3]=V=>D("monthlyInstalment"))},null,34),[[Ne,c.value.fields.monthlyInstalment,void 0,{number:!0}]])]),$.value.monthlyInstalment?(s(),n("p",xd,f($.value.monthlyInstalment),1)):u("",!0)]),e("div",null,[y[28]||(y[28]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",hd,[y[27]||(y[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),de(e("input",{"onUpdate:modelValue":y[4]||(y[4]=V=>c.value.fields.downPayment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:z(["input pl-8",{"border-red-500":$.value.downPayment}]),onInput:y[5]||(y[5]=V=>D("downPayment"))},null,34),[[Ne,c.value.fields.downPayment,void 0,{number:!0}]])]),$.value.downPayment?(s(),n("p",bd,f($.value.downPayment),1)):u("",!0)])]),e("div",kd,[e("div",null,[y[30]||(y[30]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),de(e("select",{"onUpdate:modelValue":y[6]||(y[6]=V=>c.value.fields.duration=V),class:z(["input",{"border-red-500":$.value.duration}]),onChange:y[7]||(y[7]=V=>D("duration"))},[y[29]||(y[29]=e("option",{value:""},"Select duration...",-1)),(s(!0),n(G,null,ee(d(c.value.type),V=>(s(),n("option",{key:V,value:V},f(V)+" months ",9,wd))),128))],34),[[Na,c.value.fields.duration,void 0,{number:!0}]]),$.value.duration?(s(),n("p",$d,f($.value.duration),1)):u("",!0)]),c.value.type==="FIN"||c.value.type==="LEA"?(s(),n("div",Cd,[y[32]||(y[32]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Interest Rate / APR (%)",-1)),e("div",Ad,[de(e("input",{"onUpdate:modelValue":y[8]||(y[8]=V=>c.value.fields.interestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:y[9]||(y[9]=V=>D("interestRate"))},null,544),[[Ne,c.value.fields.interestRate,void 0,{number:!0}]]),y[31]||(y[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])])):u("",!0),c.value.type==="LEA"||c.value.type==="LTR"?(s(),n("div",Id,[y[33]||(y[33]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Mileage Limit (annual km)",-1)),de(e("input",{"onUpdate:modelValue":y[10]||(y[10]=V=>c.value.fields.mileageLimit=V),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[Ne,c.value.fields.mileageLimit,void 0,{number:!0}]])])):u("",!0)]),c.value.type==="FIN"?(s(),n(G,{key:0},[e("div",Sd,[e("div",null,[y[35]||(y[35]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",Td,[de(e("input",{"onUpdate:modelValue":y[11]||(y[11]=V=>c.value.fields.effectiveInterestRate=V),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[Ne,c.value.fields.effectiveInterestRate,void 0,{number:!0}]]),y[34]||(y[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])]),e("div",null,[y[37]||(y[37]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Dd,[y[36]||(y[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),de(e("input",{"onUpdate:modelValue":y[12]||(y[12]=V=>c.value.fields.gfv=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[Ne,c.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",jd,[de(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":y[13]||(y[13]=V=>c.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[38]||(y[38]=e("label",{for:"fin-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))])],64)):u("",!0),c.value.type==="LEA"?(s(),n(G,{key:1},[e("div",qd,[e("div",null,[y[40]||(y[40]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Final Instalment (€)",-1)),e("div",Vd,[y[39]||(y[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),de(e("input",{"onUpdate:modelValue":y[14]||(y[14]=V=>c.value.fields.finalInstalment=V),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[Ne,c.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Md,[e("div",Od,[y[41]||(y[41]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Leasing Amount:",-1)),e("span",Ld,"€ "+f(x(w.value)),1)]),y[42]||(y[42]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Ed,[e("div",Nd,[de(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":y[15]||(y[15]=V=>c.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[43]||(y[43]=e("label",{for:"lea-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Pd,[de(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":y[16]||(y[16]=V=>c.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.maintenanceIncluded]]),y[44]||(y[44]=e("label",{for:"lea-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))])])],64)):u("",!0),c.value.type==="LTR"?(s(),n(G,{key:2},[e("div",null,[y[46]||(y[46]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),de(e("select",{"onUpdate:modelValue":y[17]||(y[17]=V=>c.value.fields.customerType=V),class:z(["input",{"border-red-500":$.value.customerType}]),onChange:y[18]||(y[18]=V=>D("customerType"))},[...y[45]||(y[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[Na,c.value.fields.customerType]]),$.value.customerType?(s(),n("p",Fd,f($.value.customerType),1)):u("",!0)]),e("div",Rd,[e("div",Bd,[y[47]||(y[47]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),e("span",Ud,"€ "+f(x(b.value)),1)]),y[48]||(y[48]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",_d,[e("div",zd,[de(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":y[19]||(y[19]=V=>c.value.fields.insuranceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.insuranceIncluded]]),y[49]||(y[49]=e("label",{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Wd,[de(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":y[20]||(y[20]=V=>c.value.fields.maintenanceIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.maintenanceIncluded]]),y[50]||(y[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))]),e("div",Hd,[de(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":y[21]||(y[21]=V=>c.value.fields.registrationTaxesIncluded=V),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Xe,c.value.fields.registrationTaxesIncluded]]),y[51]||(y[51]=e("label",{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):u("",!0)])):u("",!0)],32),t.hideActions?u("",!0):(s(),n("div",Yd,[l(a(_),{label:"Cancel",variant:"outline",size:"small",onClick:y[22]||(y[22]=V=>g.$emit("cancel"))}),l(a(_),{label:"Save",variant:"primary",size:"small",disabled:!S.value,onClick:r},null,8,["disabled"])]))],2))}},Kd={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Qd={class:"space-y-2"},Jd={class:"space-y-2"},Zd={class:"space-y-2"},Xd={class:"space-y-2"},eu={class:"relative"},tu={class:"space-y-2"},su={class:"space-y-2"},au={class:"space-y-2"},nu={class:"border-t border pt-4"},lu={key:0,class:"mt-4 space-y-6"},ou={class:"space-y-2"},iu={class:"space-y-2"},ru={class:"space-y-2"},du={class:"space-y-2"},uu={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:o}){const m=t,A=o,j=b=>{b||A("close")},$=N(!1),v=N({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});qe(()=>m.show,b=>{var d;if(b&&((d=m.task)!=null&&d.requestedCar)){const i=m.task.requestedCar;v.value={brand:i.brand||"",model:i.model||"",year:i.year||new Date().getFullYear(),price:i.price||null,requestType:i.requestType||"Quotation",requestMessage:i.requestMessage||"",image:i.image||"",dealership:i.dealership||"",fuelType:i.fuelType||"",gearType:i.gearType||"",kilometers:i.kilometers||null}}else b&&(v.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const c=I(()=>v.value.brand.trim()&&v.value.model.trim()&&v.value.year>1900),w=()=>{if(!c.value)return;const b={brand:v.value.brand.trim(),model:v.value.model.trim(),year:v.value.year,requestType:v.value.requestType};v.value.price&&(b.price=v.value.price),v.value.requestMessage&&(b.requestMessage=v.value.requestMessage.trim()),v.value.image&&(b.image=v.value.image.trim()),v.value.dealership&&(b.dealership=v.value.dealership.trim()),v.value.fuelType&&(b.fuelType=v.value.fuelType),v.value.gearType&&(b.gearType=v.value.gearType),v.value.kilometers!==null&&(b.kilometers=v.value.kilometers),A("save",b)};return(b,d)=>(s(),P(a(ts),{open:t.show,"onUpdate:open":j},{default:k(()=>[l(a(Kt),null,{default:k(()=>[l(a(Qt),{class:"fixed inset-0 z-50 bg-black/50"}),l(a(Jt),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:k(()=>[l(a(Zt),{class:"flex-shrink-0"},{default:k(()=>[l(a(Xt),null,{default:k(()=>{var i;return[M(f((i=t.task)!=null&&i.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("div",Kd,[e("div",Qd,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[13]||(d[13]=[M("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.brand,"onUpdate:modelValue":d[0]||(d[0]=i=>v.value.brand=i),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Jd,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[14]||(d[14]=[M("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.model,"onUpdate:modelValue":d[1]||(d[1]=i=>v.value.model=i),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Zd,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[15]||(d[15]=[M("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(a(ie),{modelValue:v.value.year,"onUpdate:modelValue":d[2]||(d[2]=i=>v.value.year=i),modelModifiers:{number:!0},type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Xd,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[16]||(d[16]=[M("Price (Optional)",-1)])]),_:1}),e("div",eu,[d[17]||(d[17]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),l(a(ie),{modelValue:v.value.price,"onUpdate:modelValue":d[3]||(d[3]=i=>v.value.price=i),modelModifiers:{number:!0},type:"number",min:"0",step:"1000",placeholder:"45000",class:"w-full h-10 pl-8"},null,8,["modelValue"])])]),e("div",tu,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[18]||(d[18]=[M("Request Type",-1)])]),_:1}),l(a(at),{modelValue:v.value.requestType,"onUpdate:modelValue":d[4]||(d[4]=i=>v.value.requestType=i)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select request type..."})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Quotation"},{default:k(()=>[...d[19]||(d[19]=[M("Quotation",-1)])]),_:1}),l(a(oe),{value:"Test Drive"},{default:k(()=>[...d[20]||(d[20]=[M("Test Drive",-1)])]),_:1}),l(a(oe),{value:"Generic Sales"},{default:k(()=>[...d[21]||(d[21]=[M("Generic Sales",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",su,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[22]||(d[22]=[M("Request Message (Optional)",-1)])]),_:1}),l(a(An),{modelValue:v.value.requestMessage,"onUpdate:modelValue":d[5]||(d[5]=i=>v.value.requestMessage=i),rows:"5",placeholder:"Customer's message or notes about the vehicle request...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])]),e("div",au,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[23]||(d[23]=[M("Image URL (Optional)",-1)])]),_:1}),l(a(ie),{modelValue:v.value.image,"onUpdate:modelValue":d[6]||(d[6]=i=>v.value.image=i),type:"url",placeholder:"https://example.com/car-image.jpg",class:"w-full h-10"},null,8,["modelValue"]),d[24]||(d[24]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",nu,[e("button",{type:"button",onClick:d[7]||(d[7]=i=>$.value=!$.value),class:"flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"},[e("i",{class:z(["fa-solid",$.value?"fa-chevron-down":"fa-chevron-right"])},null,2),d[25]||(d[25]=M(" Advanced Details (Optional) ",-1))]),$.value?(s(),n("div",lu,[e("div",ou,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[26]||(d[26]=[M("Dealership",-1)])]),_:1}),l(a(ie),{modelValue:v.value.dealership,"onUpdate:modelValue":d[8]||(d[8]=i=>v.value.dealership=i),type:"text",placeholder:"e.g., Milano, Berlin",class:"w-full h-10"},null,8,["modelValue"])]),e("div",iu,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[27]||(d[27]=[M("Fuel Type",-1)])]),_:1}),l(a(at),{modelValue:v.value.fuelType,"onUpdate:modelValue":d[9]||(d[9]=i=>v.value.fuelType=i)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select fuel type"})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Petrol"},{default:k(()=>[...d[28]||(d[28]=[M("Petrol",-1)])]),_:1}),l(a(oe),{value:"Diesel"},{default:k(()=>[...d[29]||(d[29]=[M("Diesel",-1)])]),_:1}),l(a(oe),{value:"Electric"},{default:k(()=>[...d[30]||(d[30]=[M("Electric",-1)])]),_:1}),l(a(oe),{value:"Hybrid"},{default:k(()=>[...d[31]||(d[31]=[M("Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ru,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[32]||(d[32]=[M("Gear Type",-1)])]),_:1}),l(a(at),{modelValue:v.value.gearType,"onUpdate:modelValue":d[10]||(d[10]=i=>v.value.gearType=i)},{default:k(()=>[l(a(et),{class:"w-full h-10"},{default:k(()=>[l(a(tt),{placeholder:"Select gear type"})]),_:1}),l(a(st),null,{default:k(()=>[l(a(oe),{value:"Manual"},{default:k(()=>[...d[33]||(d[33]=[M("Manual",-1)])]),_:1}),l(a(oe),{value:"Automatic"},{default:k(()=>[...d[34]||(d[34]=[M("Automatic",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",du,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...d[35]||(d[35]=[M("Kilometers",-1)])]),_:1}),l(a(ie),{modelValue:v.value.kilometers,"onUpdate:modelValue":d[11]||(d[11]=i=>v.value.kilometers=i),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"e.g., 50000",class:"w-full h-10"},null,8,["modelValue"])])])):u("",!0)])]),l(a(es),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:k(()=>{var i;return[l(a(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[12]||(d[12]=x=>b.$emit("close"))}),l(a(_),{label:(i=t.task)!=null&&i.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!c.value,onClick:w},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},cu={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},mu={class:"space-y-2"},fu={key:0,class:"space-y-2"},vu={class:"flex flex-wrap gap-2"},pu=["onClick"],yu={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:o}){const m=t,A=o,j=N(""),$=c=>{c||A("close")};qe(()=>m.show,c=>{c&&(j.value="")});const v=()=>{const c=j.value.trim();c&&(m.existingTags.includes(c)||(A("add",c),j.value=""))};return(c,w)=>(s(),P(a(ts),{open:t.show,"onUpdate:open":$},{default:k(()=>[l(a(Kt),null,{default:k(()=>[l(a(Qt),{class:"fixed inset-0 z-50 bg-black/50"}),l(a(Jt),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:k(()=>[l(a(Zt),{class:"flex-shrink-0"},{default:k(()=>[l(a(Xt),null,{default:k(()=>[...w[2]||(w[2]=[M("Add Tag",-1)])]),_:1})]),_:1}),e("div",cu,[e("div",mu,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...w[3]||(w[3]=[M("Tag Name",-1)])]),_:1}),l(a(ie),{modelValue:j.value,"onUpdate:modelValue":w[0]||(w[0]=b=>j.value=b),onKeyup:vn(v,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full h-10",autofocus:""},null,8,["modelValue"])]),t.existingTags.length>0?(s(),n("div",fu,[l(a(X),{class:"block text-sm font-semibold text-foreground"},{default:k(()=>[...w[4]||(w[4]=[M("Existing Tags",-1)])]),_:1}),e("div",vu,[(s(!0),n(G,null,ee(t.existingTags,b=>(s(),n("button",{key:b,onClick:d=>j.value=b,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},f(b),9,pu))),128))])])):u("",!0)]),l(a(es),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:k(()=>[l(a(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:w[1]||(w[1]=b=>c.$emit("close"))}),l(a(_),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!j.value.trim(),onClick:v},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Wt={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function gu(t){if(!t)return Wt.default;const o=t.toLowerCase().trim();return Wt[o]||Wt.default}function xu({store:t,taskId:o,getTabForItemType:m,isOverviewModalAction:A}){const j=N(null),$=N(null),v=N("overview"),c=N(null),w=N([]);qe(v,()=>{j.value=null,$.value=null});const b=I(()=>{var r;return[...((r=t.currentActivities)==null?void 0:r.value)||[],...(w.value||[]).filter(g=>g!=null&&!g.activityId)].filter(g=>g!=null&&g.id!=null&&g.type!=null).filter(g=>{const y=m(g.type);return v.value==="overview"?y==="overview":y===v.value}).sort((g,y)=>{const V=new Date(g.timestamp||0);return new Date(y.timestamp||0)-V})}),d=p=>($.value=null,v.value==="overview"&&A&&A(p)?{type:"overview-modal",action:p}:(["email","sms","whatsapp","call"].includes(p)?(c.value=p,j.value="communication"):j.value=p,null)),i=async p=>{var r;if(p.isEdit){const g=w.value.findIndex(y=>y.id===p.id);g>-1&&(w.value[g]={...w.value[g],...p}),(r=$.value)!=null&&r.activityId&&await t.updateActivity(o.value,$.value.activityId,{type:p.communicationType||p.type,user:"You",action:p.action,content:p.content,fileName:p.fileName,data:p.data})}else{const g=p.communicationType||p.type,y=await t.addActivity(o.value,{type:g,user:"You",action:p.action,content:p.content,fileName:p.fileName,data:p.data});w.value.push({id:y.id,type:g==="email"||g==="whatsapp"||g==="sms"?"communication":g,action:p.action,content:p.content,fileName:p.fileName,data:p.data,timestamp:y.timestamp,activityId:y.id})}j.value=null,$.value=null},x=()=>{j.value=null,$.value=null},D=p=>{m(p.type)&&(j.value=p.type==="email"||p.type==="whatsapp"||p.type==="sms"||p.type==="communication"?"communication":p.type,$.value=p)},S=async p=>{try{await t.deleteActivity(o.value,p)}catch(r){throw console.error("Error deleting item:",r),r}};return{activeTab:v,showInlineWidget:j,inlineWidgetType:I(()=>j.value),editingItem:$,isEditing:I(()=>$.value!==null),communicationType:c,inlineContent:w,filteredInlineContent:b,handleAddNewAction:d,handleWidgetSave:i,handleWidgetCancel:x,handleEditItem:D,handleDeleteItem:S}}const hu={class:"flex-1 flex flex-col overflow-hidden h-full"},bu={key:1,class:"flex-1 flex flex-row overflow-hidden"},ku={class:"flex-1 flex flex-col overflow-hidden min-w-0"},wu={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},$u={class:"mb-4 -mt-1 pb-2"},Cu={key:0},Au={key:0},Iu={key:1,class:"mb-6"},Su={key:2,class:"space-y-4 mb-6 px-1"},Tu={key:1},Du={key:0},ju={key:1},qu={class:"relative flex items-center py-1 mb-4"},Vu={class:"relative mx-4"},Mu={key:0,class:"animate-fade-in relative bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6"},Ou={class:"flex justify-between items-center mb-4"},Lu={key:0,class:"space-y-4 mb-6 px-1"},Eu={class:"hidden lg:flex flex-col overflow-hidden border-l border-border shrink-0 w-80 h-full"},Nu={key:2,class:"flex-1 flex flex-row overflow-hidden"},Pu={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Fu={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Ru={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},Bu={class:"space-y-6"},Uu={key:0},_u={key:0,class:"lg:col-span-1 space-y-6"},zu={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Wu={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Hu={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Yu={class:"rounded-lg flex flex-col bg-muted"},Gu={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1 min-h-0"},Ku={class:"relative flex-1 min-h-0"},Qu={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},Ju={key:1,class:"text-center py-6 text-muted-foreground"},Zu={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},Xu={key:1,class:"flex-1 min-w-0"},ec={class:"text-sm text-muted-foreground leading-snug"},tc={class:"font-bold"},sc={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-muted-foreground"},ac={class:"text-xs text-muted-foreground mt-1"},nc={key:2},lc={key:0,class:"space-y-4 mt-4"},oc={key:1,class:"text-center py-12 text-muted-foreground"},ic={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},showCloseButton:{type:Boolean,default:!1}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created","close"],setup(t,{emit:o}){const m=t,A=o,j=pn(),$=Ve(),v=en(),c=_n(),w=I(()=>m.task.id),b=I(()=>j.path.startsWith("/tasks")&&!j.path.startsWith("/customer")),d=N("manage"),i=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];N(!1);const x=N(null),D=N(null),S=["note","attachment","tradein","purchase"],p=I(()=>{var K,ne;const h=[],C=new Set,R=["note","attachment","tradein","purchase","purchase-method","financing"];return(ne=(K=m.storeAdapter)==null?void 0:K.currentActivities)!=null&&ne.value&&m.storeAdapter.currentActivities.value.filter(Y=>Y!=null&&Y.id!=null&&R.includes(Y==null?void 0:Y.type)).forEach(Y=>{C.has(Y.id)||(C.add(Y.id),h.push(Y))}),m.task.activities&&m.task.activities.filter(Y=>Y!=null&&Y.id!=null&&R.includes(Y==null?void 0:Y.type)).forEach(Y=>{C.has(Y.id)||(C.add(Y.id),h.push(Y))}),(Ie.value||[]).filter(q=>q!=null&&q.id!=null&&R.includes(q==null?void 0:q.type)).forEach(q=>{C.has(q.id)||(C.add(q.id),h.push(q))}),h.filter(q=>q!=null&&q.id!=null).sort((q,Y)=>{const ve=new Date(q.timestamp||0);return new Date(Y.timestamp||0)-ve})}),r=h=>{D.value=null,x.value=h},g=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:h.type,action:h.action,content:h.content,data:h.data,fileName:h.fileName,timestamp:h.timestamp||new Date().toISOString()}),Ie.value.push({id:h.id||Date.now(),type:h.type,action:h.action,content:h.content,data:h.data,fileName:h.fileName,timestamp:h.timestamp||new Date().toISOString()}),x.value=null,D.value=null}catch(C){console.error("Error saving enrich data:",C)}},y=()=>{x.value=null,D.value=null},V=h=>{D.value=h,x.value=h.type==="purchase-method"?"purchase":h.type},H=async h=>{try{await m.storeAdapter.deleteActivity(m.task.id,h.id);const C=Ie.value.findIndex(R=>R.id===h.id);C!==-1&&Ie.value.splice(C,1)}catch(C){console.error("Error deleting enrich item:",C)}};I(()=>m.task.activities?m.task.activities.filter(h=>h.type==="note"):[]),I(()=>m.task.activities?m.task.activities.filter(h=>["email","call","sms","whatsapp"].includes(h.type)):[]),I(()=>m.task.activities?m.task.activities.filter(h=>h.type==="attachment"):[]),I(()=>m.task.activities?m.task.activities.filter(h=>h.type==="purchase"):[]),I(()=>m.task.activities?m.task.activities.filter(h=>h.type==="tradein"):[]);const ae=()=>{O.value="tradein",L.value=!0},le=()=>{O.value="financing",L.value=!0},te=I(()=>m.type==="contact"?"bg-blue-100 text-blue-600":m.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),re=N(j.path.startsWith("/tasks")&&!j.path.startsWith("/customer"));qe(()=>j.path,h=>{re.value=h.startsWith("/tasks")&&!h.startsWith("/customer")});const E=()=>{$.push({path:`/customer/${m.task.id}`,query:{type:m.type}})};async function se(h){var gt,xt;const C=((gt=m.task.customer)==null?void 0:gt.id)??m.task.id,R=h.time||"10:00",U=R.length===5?`${R}:00`:R,Q=`${h.date}T${U}`,[K,ne]=R.split(":").map(Number),q=K+1,Y=`${h.date}T${String(q).padStart(2,"0")}:${String(ne||0).padStart(2,"0")}:00`;let ve=null,Be="user",yt=null,Je="",Ze=null;if(h.assignee){if(h.assignee.startsWith("user-")){const Te=parseInt(h.assignee.replace("user-",""),10),De=c.getUserById(Te);ve=Te,Be="user",Je=(De==null?void 0:De.name)||""}else if(h.assignee.startsWith("team-")){const Te=parseInt(h.assignee.replace("team-",""),10),De=c.getTeamById(Te);yt=Te,Be="team",Ze=(De==null?void 0:De.name)||"",Je=Ze}}const Pt={type:h.type,title:h.title||`${h.type} - ${h.customer||"Customer"}`,customer:h.customer||((xt=m.task.customer)==null?void 0:xt.name)||"",customerId:C,start:Q,end:Y,assignee:Je,assigneeId:ve,assigneeType:Be,teamId:yt,team:Ze,dealership:h.dealership||"",status:"confirmed"};try{await Wn(Pt)}catch(Te){console.error("Failed to create appointment:",Te);return}be.value=!1,fe.value=!1,A("appointment-created")}const xe=()=>{Ce.value=!0},Ae=async h=>{var R,U,Q,K;const C=h.name;m.type==="lead"?await((U=(R=m.storeAdapter).updateLead)==null?void 0:U.call(R,m.task.id,{assignee:C,assigneeType:h.type,teamId:h.type==="team"?h.id:null})):m.type==="opportunity"&&await((K=(Q=m.storeAdapter).updateOpportunity)==null?void 0:K.call(Q,m.task.id,{assignee:C,assigneeType:h.type,teamId:h.type==="team"?h.id:null})),Ce.value=!1},he=()=>{Re.value=!0},J=async h=>{var C,R,U,Q;try{m.type==="lead"?await((R=(C=m.storeAdapter).updateLead)==null?void 0:R.call(C,m.task.id,{requestedCar:h})):m.type==="opportunity"&&await((Q=(U=m.storeAdapter).updateOpportunity)==null?void 0:Q.call(U,m.task.id,{requestedCar:h})),Re.value=!1}catch(K){console.error("Error saving requested car:",K)}};async function T(h){var C,R,U,Q,K,ne,q,Y;try{const ve=[...m.task.tradeIns||[],h];m.type==="lead"?(await((R=(C=m.storeAdapter).updateLead)==null?void 0:R.call(C,m.task.id,{tradeIns:ve})),await((Q=(U=m.storeAdapter).loadLeadById)==null?void 0:Q.call(U,m.task.id))):m.type==="opportunity"&&(await((ne=(K=m.storeAdapter).updateOpportunity)==null?void 0:ne.call(K,m.task.id,{tradeIns:ve})),await((Y=(q=m.storeAdapter).loadOpportunityById)==null?void 0:Y.call(q,m.task.id)))}catch(ve){console.error("Error adding trade-in:",ve)}}async function W(h){var C,R,U,Q,K,ne,q,Y;try{const ve=[...m.task.financingOptions||[],h];m.type==="lead"?(await((R=(C=m.storeAdapter).updateLead)==null?void 0:R.call(C,m.task.id,{financingOptions:ve})),await((Q=(U=m.storeAdapter).loadLeadById)==null?void 0:Q.call(U,m.task.id))):m.type==="opportunity"&&(await((ne=(K=m.storeAdapter).updateOpportunity)==null?void 0:ne.call(K,m.task.id,{financingOptions:ve})),await((Y=(q=m.storeAdapter).loadOpportunityById)==null?void 0:Y.call(q,m.task.id)))}catch(ve){console.error("Error adding financing option:",ve)}}const L=N(!1),O=N(null),be=N(!1),fe=N(!1),Ce=N(!1),Le=N(!1),Re=N(!1),rt=N([]),He=N(!1),Ye=N(!1),F=N(!1),Z=N(!1),B=N(!1),ke=N(!1),we=N({}),{activeTab:ue,showInlineWidget:$e,editingItem:Ee,communicationType:Ge,inlineContent:Ie,filteredInlineContent:Se,handleAddNewAction:ce,handleWidgetSave:me,handleWidgetCancel:Ke,handleEditItem:dt,handleDeleteItem:ut}=xu({store:m.storeAdapter,taskId:w,getTabForItemType:gu,isOverviewModalAction:h=>ue.value==="overview"&&m.addNewConfig.overviewActions.includes(h)});qe(()=>m.task.id,()=>{ue.value="overview"}),qe(ue,h=>{h!=="appointments"&&(fe.value=!1)});const $t=I(()=>new Date().toISOString().slice(0,10));wt(async()=>{if(!b.value)try{const h=await zn();rt.value=h.dealerships||[]}catch(h){console.error("Failed to fetch calendar filter options:",h)}});const ct=()=>{b.value?d.value="request":ue.value="overview"},Qe=h=>{const C=ce(h);C&&C.modalAction&&(O.value=C.modalAction,L.value=!0)},mt=h=>{if(h==="appointment"){be.value=!0;return}if(h==="call"){ke.value=!0;return}if(h==="note"){He.value=!0;return}if(h==="attachment"){Ye.value=!0;return}if(h==="whatsapp"){F.value=!0;return}if(h==="sms"){Z.value=!0;return}if(h==="email"){B.value=!0;return}const C={call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(h))O.value=h,L.value=!0;else{const R=C[h];R?(ue.value=R,setTimeout(()=>{Qe(h),setTimeout(()=>{try{const U=document.querySelector(".animate-fade-in");U&&U.parentNode&&U.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Qe(h)}},Me=()=>{L.value=!1,O.value=null},Ct=async h=>{var C,R;try{const U=h.type==="FIN"?"Captive Financing":h.type==="LEA"?"Leasing":"Long-Term Rental",Q=((C=h.fields)==null?void 0:C.monthlyInstalment)||0,K=((R=h.fields)==null?void 0:R.duration)??null;await me({type:"purchase-method",action:`added a ${U} purchase method`,content:`${U}: €${Q.toLocaleString()}/month for ${K||0} months`,data:{purchaseMethodId:h.id,type:h.type,...h.fields}});const ne=K?`${h.type||"Financing"} ${K} months`:U||"Financing";await W({id:`fo-${Date.now()}`,label:ne,termMonths:K||null}),Me()}catch(U){console.error("Error saving purchase method:",U)}},ft=async h=>{var C;if(O.value==="tradein")try{const{saveTradeInVehicle:R}=Nn(),U=await R(m.type,m.task.id,h.vehicle,h.valuation||{});Ie.value.push({id:U.activity.id,type:"tradein",action:"added a trade-in",vehicleId:U.vehicle.id,data:U.activity.data,timestamp:U.activity.timestamp,activityId:U.activity.id});const Q=h.vehicle||{},K=[Q.brand,Q.model].filter(Boolean),ne=(K.length?K.join(" ")+(Q.year?` (${Q.year})`:""):"Trade-in")||"Trade-in",q=((C=h.valuation)==null?void 0:C.tradeInPrice)??0;await T({id:`ti-${Date.now()}`,label:ne,valuation:typeof q=="number"?q:parseFloat(q)||0}),Me()}catch(R){console.error("Error saving trade-in:",R)}else O.value==="purchase"&&(await me(h),Me())},At=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:"note",content:h.content||h.message,message:h.content||h.message,timestamp:new Date().toISOString()}),He.value=!1}catch(C){console.error("Error saving note:",C)}},It=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:"attachment",fileName:h.fileName,file:h.file,content:`Attachment: ${h.fileName}`,timestamp:new Date().toISOString()}),Ye.value=!1}catch(C){console.error("Error saving attachment:",C)}},St=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:"whatsapp",message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),F.value=!1}catch(C){console.error("Error saving WhatsApp:",C)}},Tt=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:"sms",message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),Z.value=!1}catch(C){console.error("Error saving SMS:",C)}},Dt=async h=>{try{await m.storeAdapter.addActivity(m.task.id,{type:"email",subject:h.subject,message:h.message,content:h.message,template:h.template,timestamp:new Date().toISOString()}),B.value=!1}catch(C){console.error("Error saving email:",C)}},jt=()=>{},qt=h=>{we.value[h]=!we.value[h]},Vt=h=>{mt(h)},Mt=I(()=>{const h=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return m.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...h.slice(1),{key:"appointments",label:"Appointments"}]:h}),Oe=I(()=>{var C,R;return[...((R=(C=m.storeAdapter)==null?void 0:C.currentActivities)==null?void 0:R.value)||[],...Ie.value||[]].filter(U=>U!=null&&U.id!=null)});I(()=>O.value==="financing"?"Add Financing":O.value==="tradein"?"Add Trade-in":O.value==="purchase"?"Create Purchase Offer":"");const vt=async h=>{if(m.type==="opportunity")try{await m.storeAdapter.addVehicle(m.task.id,h.vehicleData),m.storeAdapter.loadOpportunityById&&await m.storeAdapter.loadOpportunityById(m.task.id)}catch(C){console.error("Error selecting vehicle:",C)}},pt=async h=>{if(m.type==="opportunity")try{await m.storeAdapter.createOffer(m.task.id,h.offerData),m.storeAdapter.loadOpportunityById&&await m.storeAdapter.loadOpportunityById(m.task.id)}catch(C){console.error("Error creating offer:",C)}},Ot=async h=>{var U,Q,K,ne;const C=m.task.tags||[];if(C.includes(h)){Le.value=!1;return}const R=[...C,h];try{if(m.type==="lead")await((Q=(U=m.storeAdapter).updateLead)==null?void 0:Q.call(U,m.task.id,{tags:R})),m.storeAdapter.loadLeadById&&await m.storeAdapter.loadLeadById(m.task.id);else if(m.type==="opportunity")await((ne=(K=m.storeAdapter).updateOpportunity)==null?void 0:ne.call(K,m.task.id,{tags:R})),m.storeAdapter.loadOpportunityById&&await m.storeAdapter.loadOpportunityById(m.task.id);else if(m.type==="contact"){const q=j.query.type==="account"?"account":"contact";await v.updateCustomer(m.task.id,{tags:R},q),await v.fetchCustomerById(m.task.id,q),A("tag-updated")}Le.value=!1}catch(q){console.error("Error adding tag:",q)}},Lt=h=>{const C={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-muted-foreground",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-muted-foreground"};return C[h]||C.default},Et=h=>{const C={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-muted text-muted-foreground",status:"bg-orange-100 text-orange-600",default:"bg-muted text-muted-foreground"};return C[h]||C.default},Nt=h=>h?new Date(h).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(h,C)=>{var R,U,Q,K,ne;return s(),n("div",hu,[b.value?u("",!0):(s(),P(fl,{key:0,initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":te.value,"task-type":t.type,"customer-id":((R=t.task.customer)==null?void 0:R.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"show-close-button":t.showCloseButton,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAddTag:C[0]||(C[0]=q=>Le.value=!0),onClose:C[1]||(C[1]=q=>h.$emit("close"))},{"name-action":k(()=>[b.value?(s(),n("button",{key:0,onClick:E,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...C[24]||(C[24]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):u("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags","show-close-button"])),b.value?b.value?(s(),n("div",Nu,[e("div",Pu,[e("div",Fu,[l(za,{modelValue:d.value,"onUpdate:modelValue":C[9]||(C[9]=q=>d.value=q),tabs:i,class:"mb-6"},null,8,["modelValue"]),d.value==="manage"?(s(),n("div",Ru,[e("div",Bu,[t.managementWidget?(s(),n("div",Uu,[(s(),P(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Oe.value,onCarAdded:C[10]||(C[10]=q=>h.$emit("car-added",q)),onConvertToLead:C[11]||(C[11]=q=>h.$emit("convert-to-lead")),onConvertToOpportunity:C[12]||(C[12]=q=>h.$emit("convert-to-opportunity")),onVehicleSelected:vt,onCreateOffer:pt,onViewHistory:ct},null,40,["lead","opportunity","contact","activities"]))])):u("",!0)]),t.type!=="contact"?(s(),n("div",_u,[l(Wa,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe,onAddRequestedCar:he},null,8,["task","entity-type","activities"]),l(Ha,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):u("",!0)])):u("",!0),d.value==="request"?(s(),n("div",zu,[e("div",Wu,[t.type!=="contact"?(s(),P(Wa,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:xe,onAddRequestedCar:he},null,8,["task","entity-type","activities"])):u("",!0),l(Tn,{task:t.task,"task-type":t.type,"customer-id":((ne=t.task.customer)==null?void 0:ne.id)||t.task.customerId||t.task.id,onAction:mt,onAddTag:C[13]||(C[13]=q=>Le.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(s(),n("div",Hu,[l(Dn,{items:t.task.tradeIns||[],onOpenAdd:ae},null,8,["items"]),l(jn,{items:t.task.financingOptions||[],onOpenAdd:le},null,8,["items"])])):u("",!0),t.type!=="contact"?(s(),P(Ha,{key:1,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):u("",!0),e("div",Yu,[C[32]||(C[32]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Activity Summary")])],-1)),e("div",Gu,[e("div",Ku,[Oe.value.length>0?(s(),n("div",Qu)):u("",!0),Oe.value.length===0?(s(),n("div",Ju,[...C[31]||(C[31]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No activities yet",-1)])])):(s(),n("div",Zu,[(s(!0),n(G,null,ee(Oe.value,q=>(s(),n("div",{key:(q==null?void 0:q.id)||`activity-${(q==null?void 0:q.timestamp)||Date.now()}`,class:"flex gap-4 relative"},[q&&q.type?(s(),n("div",{key:0,class:z(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",Et(q.type)])},[e("i",{class:z([Lt(q.type),"text-sm"])},null,2)],2)):u("",!0),q?(s(),n("div",Xu,[e("div",ec,[e("span",tc,f(q.user),1),M(" "+f(q.action),1)]),q.content?(s(),n("div",sc,f(q.content),1)):u("",!0),e("div",ac,f(Nt(q.timestamp)),1)])):u("",!0)]))),128))]))])])])])):u("",!0),d.value==="data"?(s(),n("div",nc,[l(Ya,{actions:S,"active-tab":"data",onAction:r}),e("div",null,[x.value==="note"?(s(),P(Ut,{key:0,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="attachment"?(s(),P(_t,{key:1,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="tradein"?(s(),P(dd,{key:2,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0),x.value==="purchase"?(s(),P(Gd,{key:3,item:D.value,"task-type":t.type,"task-id":t.task.id,onSave:g,onCancel:y},null,8,["item","task-type","task-id"])):u("",!0)]),p.value.length>0?(s(),n("div",lc,[(s(!0),n(G,null,ee(p.value,q=>{var Y;return s(),P(zt,{key:(q==null?void 0:q.id)||`enrich-${(q==null?void 0:q.timestamp)||Date.now()}`,item:q,"task-type":t.type,"customer-initials":((Y=t.task.customer)==null?void 0:Y.initials)||"SK",onEdit:V,onDelete:H},null,8,["item","task-type","customer-initials"])}),128))])):x.value?u("",!0):(s(),n("div",oc,[...C[33]||(C[33]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No enrichment data yet",-1),e("p",{class:"text-xs text-muted-foreground mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):u("",!0)])])])):u("",!0):(s(),n("div",bu,[e("div",ku,[e("main",wu,[e("div",$u,[l(za,{modelValue:a(ue),"onUpdate:modelValue":C[2]||(C[2]=q=>yn(ue)?ue.value=q:null),tabs:Mt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),a(ue)==="overview"?(s(),n("div",Cu,[t.type!=="contact"?(s(),n("div",Au,[l(go,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)||"","request-message":((Q=t.task.requestedCar)==null?void 0:Q.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:xe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):u("",!0),Bt(h.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(s(),n("div",Iu,[(s(),P(nt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Oe.value,onCarAdded:C[3]||(C[3]=q=>h.$emit("car-added",q)),onConvertToLead:C[4]||(C[4]=q=>h.$emit("convert-to-lead")),onConvertToOpportunity:C[5]||(C[5]=q=>h.$emit("convert-to-opportunity")),onViewHistory:ct,onVehicleSelected:vt,onCreateOffer:pt},null,40,["lead","opportunity","contact","activities"]))])):u("",!0),a(Se).length>0?(s(),n("div",Su,[(s(!0),n(G,null,ee(a(Se),q=>(s(),P(zt,{key:(q==null?void 0:q.id)||`feed-${(q==null?void 0:q.timestamp)||Date.now()}`,item:q,"task-type":t.type,"customer-initials":"SK",onEdit:a(dt),onDelete:a(ut)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):u("",!0)])):(s(),n("div",Tu,[t.type==="contact"&&a(ue)==="negotiations"?(s(),n("div",Du,[Bt(h.$slots,"tab-negotiations")])):t.type==="contact"&&a(ue)==="appointments"?(s(),n("div",ju,[e("div",qu,[C[26]||(C[26]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",Vu,[fe.value?u("",!0):(s(),n("button",{key:0,onClick:C[6]||(C[6]=je(q=>fe.value=!0,["stop"])),class:"bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-border"},[...C[25]||(C[25]=[e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1),e("span",{class:"ml-1.5 text-muted-foreground"},"add appointment",-1)])]))]),C[27]||(C[27]=e("div",{class:"flex-grow border-t border"},null,-1))]),fe.value?(s(),n("div",Mu,[C[30]||(C[30]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),e("div",Ou,[C[29]||(C[29]=e("h5",{class:"text-sm font-semibold text-foreground"},"Add Appointment",-1)),e("button",{type:"button",onClick:C[7]||(C[7]=q=>fe.value=!1),class:"text-muted-foreground hover:text-muted-foreground"},[...C[28]||(C[28]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(s(),P(Bn,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":$t.value,dealerships:rt.value,"show-actions":!0,"reset-trigger":fe.value,onCreate:se,onCancel:C[8]||(C[8]=q=>fe.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):u("",!0),Bt(h.$slots,"tab-appointments")])):(s(),n(G,{key:2},[l(Ya,{actions:t.addNewConfig.tabActions,"active-tab":a(ue),onAction:Qe},null,8,["actions","active-tab"]),e("div",null,[a($e)==="communication"?(s(),P(Qr,{key:0,type:a(Ge),"task-type":t.type,"task-id":t.task.id,"phone-number":((K=t.task.customer)==null?void 0:K.phone)||"",item:a(Ee),onSave:a(me),onCancel:a(Ke)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):u("",!0),a(ue)==="data"&&a($e)==="note"?(s(),P(Ut,{key:1,item:a(Ee),"task-type":t.type,"task-id":t.task.id,onSave:a(me),onCancel:a(Ke)},null,8,["item","task-type","task-id","onSave","onCancel"])):u("",!0),a($e)==="attachment"?(s(),P(_t,{key:2,item:a(Ee),"task-type":t.type,"task-id":t.task.id,onSave:a(me),onCancel:a(Ke)},null,8,["item","task-type","task-id","onSave","onCancel"])):u("",!0)]),a(Se).length>0?(s(),n("div",Lu,[(s(!0),n(G,null,ee(a(Se),q=>(s(),P(zt,{key:(q==null?void 0:q.id)||`feed-${(q==null?void 0:q.timestamp)||Date.now()}`,item:q,"task-type":t.type,"customer-initials":"SK",onEdit:a(dt),onDelete:a(ut)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):u("",!0)],64))]))])]),e("div",Eu,[l(Sn,{activities:Oe.value,"expanded-summaries":we.value,onActivityClick:jt,onToggleSummaryExpanded:qt,onAddActivity:Vt},null,8,["activities","expanded-summaries"])])])),l(qn,{show:O.value==="financing"&&L.value,"task-type":t.type,"task-id":t.task.id,onSave:Ct,onClose:Me},null,8,["show","task-type","task-id"]),l(Vn,{show:O.value==="tradein"&&L.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:ft,onClose:Me},null,8,["show","task-type","task-id"]),l(Mn,{show:O.value==="purchase"&&L.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,customer:t.task.customer,"recommended-cars":[],onSave:ft,onClose:Me},null,8,["show","task-type","task-id","requested-car","customer"]),l(Rn,{show:Ce.value,onClose:C[14]||(C[14]=q=>Ce.value=!1),onConfirm:Ae},null,8,["show"]),l(uu,{show:Re.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:C[15]||(C[15]=q=>Re.value=!1),onSave:J},null,8,["show","task","task-type","task-id"]),l(Ut,{modal:"",show:He.value,"task-type":t.type,"task-id":t.task.id,onSave:At,onClose:C[16]||(C[16]=q=>He.value=!1)},null,8,["show","task-type","task-id"]),l(_t,{modal:"",show:Ye.value,"task-type":t.type,"task-id":t.task.id,onSave:It,onClose:C[17]||(C[17]=q=>Ye.value=!1)},null,8,["show","task-type","task-id"]),l(On,{show:F.value,onSave:St,onClose:C[18]||(C[18]=q=>F.value=!1)},null,8,["show"]),l(Ln,{show:Z.value,onSave:Tt,onClose:C[19]||(C[19]=q=>Z.value=!1)},null,8,["show"]),l(En,{show:B.value,onSave:Dt,onClose:C[20]||(C[20]=q=>B.value=!1)},null,8,["show"]),l(Pe,{show:ke.value,title:"Call Feature",onClose:C[21]||(C[21]=q=>ke.value=!1)},null,8,["show"]),be.value?(s(),P(Un,{key:3,show:be.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:rt.value,onCreate:se,onCancel:C[22]||(C[22]=q=>be.value=!1)},null,8,["show","customer","assignee","dealerships"])):u("",!0),l(yu,{show:Le.value,"existing-tags":t.task.tags||[],onClose:C[23]||(C[23]=q=>Le.value=!1),onAdd:Ot},null,8,["show","existing-tags"])])}}},rc={class:"flex items-center justify-between mb-4 px-1"},dc={class:"flex items-center gap-2"},uc={key:0,class:"space-y-4 mb-6 px-1"},cc=["onClick"],mc={class:"flex-1 min-w-0"},fc={class:"flex items-center gap-2 mb-1"},vc={class:"text-xs font-bold text-foreground"},pc={class:"ml-auto relative"},yc=["onClick"],gc={class:"text-sm text-muted-foreground"},xc={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},hc={key:0,class:"flex items-center gap-1"},bc={key:1,class:"flex items-center gap-1"},kc={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},wc={class:"flex items-center gap-2 min-w-0"},$c={class:"text-xs text-muted-foreground font-medium truncate"},Cc={key:1,class:"text-center py-8 text-muted-foreground mb-6"},Ac={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:o}){const m=t,A=Ve(),j=w=>{if(!w)return 0;const b=new Date(w),i=Math.abs(new Date-b);return Math.ceil(i/(1e3*60*60*24))},$=w=>{const b=[];return m.allTasks&&m.allTasks.length>0&&m.allTasks.filter(i=>i.leadId===w.id).forEach(i=>{b.push({id:i.id,type:i.title||"Task",description:i.description||i.title})}),w.stage==="Open"&&j(w.createdAt)>=0&&b.push({id:`lead-${w.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),b},v=w=>w==="Open"||w==="Validated"||w==="Contacted"?"blue":"gray",c=w=>{const b=A.resolve({path:`/tasks/${w.id}`,query:{type:"lead"}});window.open(b.href,"_blank")};return(w,b)=>(s(),n("div",null,[e("div",rc,[e("div",dc,[b[1]||(b[1]=e("i",{class:"fa-solid fa-user-circle text-foreground"},null,-1)),b[2]||(b[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Leads",-1)),l(a(pe),{text:String(t.leads.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:b[0]||(b[0]=d=>w.$emit("add-lead")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...b[3]||(b[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),t.leads.length>0?(s(),n("div",uc,[(s(!0),n(G,null,ee(t.leads,d=>(s(),n("div",{key:d.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:i=>c(d)},[b[8]||(b[8]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-orange-100 text-orange-600 border-orange-200"},[e("i",{class:"fa-solid fa-user-circle text-sm"})],-1)),e("div",mc,[e("div",fc,[e("span",vc,"Lead #"+f(d.id),1),l(a(pe),{text:d.stage,size:"small",theme:v(d.stage)},null,8,["text","theme"]),e("div",pc,[e("button",{onClick:je(i=>c(d),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...b[4]||(b[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,yc)])]),e("div",gc,[e("div",xc,[d.assignee?(s(),n("span",hc,[b[5]||(b[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+f(d.assignee),1)])):u("",!0),d.requestedCar?(s(),n("span",bc,[b[6]||(b[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+f(d.requestedCar.brand)+" "+f(d.requestedCar.model),1)])):u("",!0)]),$(d).length>0?(s(),n("div",kc,[(s(!0),n(G,null,ee($(d),i=>(s(),n("div",{key:i.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",wc,[l(a(pe),{text:i.type,size:"small",theme:i.type==="LQ"?"blue":"gray"},null,8,["text","theme"]),e("span",$c,f(i.description),1)]),b[7]||(b[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):u("",!0)])])],8,cc))),128))])):(s(),n("div",Cc,[...b[9]||(b[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))]))}},Ic={class:"flex items-center justify-between mb-4 px-1"},Sc={class:"flex items-center gap-2"},Tc={key:0,class:"space-y-4 mb-6 px-1"},Dc=["onClick"],jc={class:"flex-1 min-w-0"},qc={class:"flex items-center gap-2 mb-1"},Vc={class:"text-xs font-bold text-foreground"},Mc={class:"ml-auto relative"},Oc=["onClick"],Lc={class:"text-sm text-muted-foreground"},Ec={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},Nc={key:0,class:"flex items-center gap-1"},Pc={key:1,class:"flex items-center gap-1"},Fc={key:2,class:"flex items-center gap-1"},Rc={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},Bc={class:"flex items-center gap-2 min-w-0"},Uc={class:"text-xs text-muted-foreground font-medium truncate"},_c={key:1,class:"text-center py-8 text-muted-foreground mb-6"},zc={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:o}){const m=t,A=Ve(),j=b=>{const d=[];m.allTasks&&m.allTasks.length>0&&m.allTasks.filter(p=>p.opportunityId===b.id).forEach(p=>{d.push({id:p.id,type:p.title||"Task",description:p.description||p.title})});const i=m.activities.filter(S=>S.opportunityId===b.id),x={opportunity:b,scheduledAppointment:b.scheduledAppointment||null,activities:i,hasOffers:i.some(S=>S.type==="offer")||!1,stage:b.displayStage||b.stage,deliverySubstatus:b.deliverySubstatus||null},D=Pn(x.stage,x);if(D){const S={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};d.push({id:`opp-${b.id}-${D}`,type:D,description:S[D]||D})}return d},$=b=>({OOFB:"blue",UFB:"gray",NFU:"red",OFB:"blue",CFB:"green",DFB:"blue",NS:"red"})[b]||"gray",v=b=>b==="Qualified"||b==="In Negotiation"?"blue":b==="Closed Won"?"green":b==="Closed Lost"?"red":"gray",c=b=>new Intl.NumberFormat("en-US").format(b),w=b=>{const d=A.resolve({path:`/tasks/${b.id}`,query:{type:"opportunity"}});window.open(d.href,"_blank")};return(b,d)=>(s(),n("div",null,[e("div",Ic,[e("div",Sc,[d[1]||(d[1]=e("i",{class:"fa-solid fa-briefcase text-foreground"},null,-1)),d[2]||(d[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Opportunities",-1)),l(a(pe),{text:String(t.opportunities.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:d[0]||(d[0]=i=>b.$emit("add-opportunity")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),t.opportunities.length>0?(s(),n("div",Tc,[(s(!0),n(G,null,ee(t.opportunities,i=>(s(),n("div",{key:i.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:x=>w(i)},[d[9]||(d[9]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-briefcase text-sm"})],-1)),e("div",jc,[e("div",qc,[e("span",Vc,"Opp #"+f(i.id),1),l(a(pe),{text:i.displayStage||i.stage,size:"small",theme:v(i.displayStage||i.stage)},null,8,["text","theme"]),e("div",Mc,[e("button",{onClick:je(x=>w(i),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,Oc)])]),e("div",Lc,[e("div",Ec,[i.assignee?(s(),n("span",Nc,[d[5]||(d[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+f(i.assignee),1)])):u("",!0),i.value?(s(),n("span",Pc,[d[6]||(d[6]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),M(" € "+f(c(i.value)),1)])):u("",!0),i.vehicle?(s(),n("span",Fc,[d[7]||(d[7]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+f(i.vehicle.brand)+" "+f(i.vehicle.model),1)])):u("",!0)]),j(i).length>0?(s(),n("div",Rc,[(s(!0),n(G,null,ee(j(i),x=>(s(),n("div",{key:x.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",Bc,[l(a(pe),{text:x.type,size:"small",theme:$(x.type)},null,8,["text","theme"]),e("span",Uc,f(x.description),1)]),d[8]||(d[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):u("",!0)])])],8,Dc))),128))])):(s(),n("div",_c,[...d[10]||(d[10]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))]))}},Wc={key:0,class:"space-y-4 mb-6 px-1"},Hc=["onClick"],Yc={class:"flex-1 min-w-0"},Gc={class:"flex items-center gap-2 mb-1"},Kc={class:"text-xs font-bold text-foreground"},Qc={class:"text-xs text-muted-foreground"},Jc={class:"ml-auto relative"},Zc=["onClick"],Xc={class:"text-sm text-muted-foreground"},em={class:"flex items-center gap-2 mb-1 flex-wrap"},tm={class:"text-sm font-medium text-foreground mb-1"},sm={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground"},am={class:"flex items-center gap-1"},nm={key:0,class:"flex items-center gap-1"},lm={key:1,class:"flex items-center gap-1"},om={key:1,class:"text-center py-8 text-muted-foreground"},im={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const o=Ve(),m=N({}),A={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},j=i=>A[i]||i||"Appointment",$=i=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[i]||"bg-muted text-muted-foreground border-gray-100",v=i=>{const x=(i||"").toLowerCase();return x==="confirmed"?"bg-green-50 text-green-600":x==="cancelled"?"bg-red-50 text-red-600":x==="no-show"?"bg-amber-50 text-amber-600":"bg-muted text-muted-foreground"},c=i=>{if(!i)return"";const x=new Date(i);return x.toLocaleDateString("en-US",{month:"short",day:"numeric",year:x.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},w=i=>{if(!i)return"Just now";const x=new Date(i),S=new Date-x,p=Math.floor(S/6e4),r=Math.floor(p/60),g=Math.floor(r/24);return p<1?"Just now":p<60?`${p} minutes ago`:r<24?`${r} hours ago`:g===1?"Yesterday":g<7?`${g} days ago`:x.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=i=>{var x;return i.customerInitials?i.customerInitials:(x=i.customer)!=null&&x.initials?i.customer.initials:"SK"},d=i=>{i.opportunityId?o.push({path:`/tasks/${i.opportunityId}`,query:{type:"opportunity"}}):i.leadId?o.push({path:`/tasks/${i.leadId}`,query:{type:"lead"}}):o.push({path:"/calendar"})};return(i,x)=>(s(),n("div",null,[t.appointments.length>0?(s(),n("div",Wc,[(s(!0),n(G,null,ee(t.appointments,D=>(s(),n("div",{key:D.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:S=>d(D)},[x[5]||(x[5]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Yc,[e("div",Gc,[e("span",Kc,f(b(D)),1),x[1]||(x[1]=e("span",{class:"text-xs text-muted-foreground"},"scheduled",-1)),e("span",Qc,"• "+f(w(D.start)),1),e("div",Jc,[e("button",{onClick:je(S=>m.value[D.id]=!m.value[D.id],["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...x[0]||(x[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Zc)])]),e("div",Xc,[e("div",em,[e("span",{class:z(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",$(D.type)])},f(j(D.type)),3),D.status?(s(),n("span",{key:0,class:z(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",v(D.status)])},f(D.status),3)):u("",!0)]),e("div",tm,f(D.title||"Appointment"),1),e("div",sm,[e("span",am,[x[2]||(x[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),M(" "+f(c(D.start)),1)]),D.assignee?(s(),n("span",nm,[x[3]||(x[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+f(D.assignee),1)])):u("",!0),D.vehicle?(s(),n("span",lm,[x[4]||(x[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+f(D.vehicle),1)])):u("",!0)])])])],8,Hc))),128))])):(s(),n("div",om,[...x[6]||(x[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))]))}},rm={key:0,class:"mb-8"},dm={class:"relative"},um={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},cm=["onClick"],mm={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},fm=["src"],vm={key:1,class:"fa-solid fa-car text-4xl text-muted-foreground"},pm={class:"p-6"},ym={class:"font-bold text-foreground text-sm mb-1"},gm={key:0,class:"text-xs text-muted-foreground mb-2"},xm={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},hm={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:o}){const m=o,A=N(!1),j=w=>new Intl.NumberFormat("en-US").format(w),$=w=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[w]||"Car",v=w=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[w]||"bg-gray-600",c=w=>{m("car-click",w),A.value=!0};return(w,b)=>t.cars.length>0?(s(),n("div",rm,[b[2]||(b[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Cars")],-1)),e("div",dm,[e("div",um,[(s(!0),n(G,null,ee(t.cars,(d,i)=>(s(),n("div",{key:d.id,class:"flex-none w-64 snap-start bg-surface border border-border rounded-lg shadow-nsc-card overflow-hidden transition-shadow cursor-pointer relative",onClick:x=>c(d)},[e("div",{class:z(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",v(d.type)])},f($(d.type)),3),e("div",mm,[d.image?(s(),n("img",{key:0,src:d.image,alt:"Car",class:"w-full h-full object-cover"},null,8,fm)):(s(),n("i",vm))]),e("div",pm,[e("h4",ym,f(d.brand)+" "+f(d.model)+" ("+f(d.year)+")",1),d.price?(s(),n("p",gm,"€ "+f(j(d.price)),1)):u("",!0),d.stockDays!==null&&d.stockDays!==void 0?(s(),n("div",xm,[b[1]||(b[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+f(d.stockDays)+" days) ",1)])):u("",!0)])],8,cm))),128))])]),l(Pe,{show:A.value,title:"Car Details",onClose:b[0]||(b[0]=d=>A.value=!1)},null,8,["show"])])):u("",!0)}},bm=Ka(hm,[["__scopeId","data-v-8d3d6751"]]),km={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},wm={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:o}){const m=t,A=o,j=N(null),$=I(()=>m.type==="lead"?"Add New Lead":"Add New Opportunity");I(()=>`Create a ${m.type} for ${m.contact.name}`);const v=w=>{w||A("close")},c=w=>{A("save",w)};return(w,b)=>(s(),P(a(ts),{open:t.show,"onUpdate:open":v},{default:k(()=>[l(a(Kt),null,{default:k(()=>[l(a(Qt),{class:"fixed inset-0 z-50 bg-black/50"}),l(a(Jt),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:k(()=>[l(a(Zt),{class:"flex-shrink-0"},{default:k(()=>[l(a(Xt),null,{default:k(()=>[M(f($.value),1)]),_:1})]),_:1}),e("div",km,[l(bn,{ref_key:"formRef",ref:j,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:c},null,8,["initial-contact","force-type"])]),l(a(es),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:k(()=>{var d,i,x,D;return[l(a(_),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:b[0]||(b[0]=S=>w.$emit("close"))}),l(a(_),{label:(d=j.value)!=null&&d.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((i=j.value)==null?void 0:i.isSubmitting)||!((x=j.value)!=null&&x.canSubmit),onClick:(D=j.value)==null?void 0:D.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$m={class:"flex items-center gap-2"},Cm={key:0,class:"space-y-3 animate-pulse"},Am={key:1,class:"divide-y divide-border"},Im={class:"py-3"},Sm={key:0,class:"text-sm text-muted-foreground leading-relaxed whitespace-pre-line"},Tm={key:1,class:"flex items-center gap-3 py-1 text-muted-foreground"},Dm={key:0,class:"py-3"},jm={class:"flex flex-wrap gap-2"},qm={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=j=>({"fa-solid fa-car":sn,"fa-brands fa-whatsapp":kt,"fa-solid fa-phone":ot,"fa-solid fa-envelope":lt,"fa-solid fa-message":rn,"fa-solid fa-comment":kt,"fa-solid fa-clock":Rt,"fa-solid fa-dollar-sign":ln})[j]||Ua,A=I(()=>{if(o.preferences&&o.preferences.length>0)return o.preferences;const j=[],$=o.customerData;if(!$)return j;if($.preferredVehicleType&&j.push({icon:"fa-solid fa-car",label:`Prefers ${$.preferredVehicleType}s`}),$.preferredChannel){const v={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};j.push({icon:v[$.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${$.preferredChannel}`})}return $.preferredContactTime&&j.push({icon:"fa-solid fa-clock",label:$.preferredContactTime}),$.budgetRange&&j.push({icon:"fa-solid fa-dollar-sign",label:$.budgetRange}),j});return(j,$)=>(s(),P(a(We),{class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",$m,[l(a(Yt),{class:"w-4 h-4 text-foreground"}),l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...$[0]||($[0]=[M("Customer Insights",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>[t.loading?(s(),n("div",Cm,[...$[1]||($[1]=[e("div",{class:"space-y-2"},[e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-4 bg-muted rounded w-full"}),e("div",{class:"h-4 bg-muted rounded w-5/6"})],-1),e("div",{class:"flex flex-wrap gap-2 pt-3"},[e("div",{class:"h-6 bg-muted rounded w-24"}),e("div",{class:"h-6 bg-muted rounded w-32"}),e("div",{class:"h-6 bg-muted rounded w-20"})],-1)])])):(s(),n("div",Am,[e("div",Im,[t.summary?(s(),n("p",Sm,f(t.summary),1)):(s(),n("div",Tm,[l(a(Ua),{class:"w-4 h-4 opacity-20"}),$[2]||($[2]=e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1))]))]),A.value&&A.value.length>0?(s(),n("div",Dm,[e("div",jm,[(s(!0),n(G,null,ee(A.value,(v,c)=>(s(),P(a(pe),{key:c,variant:"outline",class:"text-xs font-semibold uppercase tracking-wider"},{default:k(()=>[(s(),P(nt(m(v.icon)),{class:"w-3 h-3 mr-1.5 text-primary"})),M(" "+f(v.label),1)]),_:2},1024))),128))])])):u("",!0)]))]),_:1})]),_:1}))}},Vm={class:"flex items-center gap-2"},Mm={key:0,class:"space-y-3 animate-pulse"},Om={key:1,class:"divide-y divide-border"},Lm={class:"py-3"},Em={class:"text-sm text-muted-foreground leading-relaxed break-words"},Nm={key:0,class:"text-muted-foreground"},Pm={class:"font-medium text-foreground"},Fm={class:"text-xs text-muted-foreground ml-1"},Rm={class:"py-3"},Bm={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},Um={__name:"SuggestedNextAction",props:{leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=d=>Yt,A=Ve(),j=I(()=>{if(!o.leads||o.leads.length===0)return null;const d=o.leads.filter(x=>{if(x.isDisqualified)return!1;const D=Pa(x,"lead");return D!=="Closed - Invalid"&&D!=="Closed - Not Interested"&&D!=="Closed - Duplicate"});if(d.length===0)return null;const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=i[x.priority]||0,p=i[D.priority]||0;if(S!==p)return p-S;const r=new Date(x.updatedAt||x.createdAt||0);return new Date(D.updatedAt||D.createdAt||0)-r}),d[0]}),$=I(()=>{if(!o.opportunities||o.opportunities.length===0)return null;const d=o.opportunities.filter(x=>{const D=x.displayStage||x.stage;return D!=="Closed Won"&&D!=="Closed Lost"&&D!=="Abandoned"});if(d.length===0)return null;const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=i[x.priority]||0,p=i[D.priority]||0;if(S!==p)return p-S;const r=new Date(x.updatedAt||x.createdAt||0);return new Date(D.updatedAt||D.createdAt||0)-r}),d[0]}),v=I(()=>{if(!j.value)return null;const d=j.value,i={lead:d,displayStage:Pa(d,"lead")},x=an(i);return x?{...x,type:"lead",entityId:d.id,entity:d}:null}),c=I(()=>{if(!$.value)return null;const d=$.value,i=o.activities.filter(S=>S.opportunityId===d.id),x={opportunity:d,scheduledAppointment:d.scheduledAppointment||null,activities:i,hasOffers:i.some(S=>S.type==="offer")||!1,stage:d.displayStage||d.stage,deliverySubstatus:d.deliverySubstatus||null,formatDateTime:S=>{if(!S)return"";const p=new Date(S);return p.toLocaleDateString()+" "+p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},D=nn(x.stage,x);return D?{...D,type:"opportunity",entityId:d.id,entity:d}:null}),w=I(()=>{const d=[];v.value&&d.push({...v.value,id:`lead-${v.value.entityId}`}),c.value&&d.push({...c.value,id:`opp-${c.value.entityId}`});const i={Hot:3,Medium:2,Low:1};return d.sort((x,D)=>{const S=x.entity,p=D.entity,r=i[S==null?void 0:S.priority]||0,g=i[p==null?void 0:p.priority]||0;return r!==g?g-r:x.type==="lead"&&D.type==="opportunity"?-1:x.type==="opportunity"&&D.type==="lead"?1:0}),d}),b=d=>{d.type==="lead"?A.push({path:`/tasks/${d.entityId}`,query:{type:"lead"}}):d.type==="opportunity"&&A.push({path:`/tasks/${d.entityId}`,query:{type:"opportunity"}})};return(d,i)=>t.loading||w.value.length>0?(s(),P(a(We),{key:0,class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",Vm,[l(a(Yt),{class:"w-4 h-4 text-foreground"}),l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...i[2]||(i[2]=[M("Suggested Next Action",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>[t.loading?(s(),n("div",Mm,[...i[3]||(i[3]=[e("div",{class:"h-4 bg-muted rounded w-full"},null,-1),e("div",{class:"flex flex-col sm:flex-row gap-2 pt-3"},[e("div",{class:"h-10 bg-muted rounded w-full sm:w-32"}),e("div",{class:"h-10 bg-muted rounded w-full sm:w-32"})],-1)])])):w.value.length>0?(s(),n("div",Om,[e("div",Lm,[e("p",Em,[(s(!0),n(G,null,ee(w.value,(x,D)=>(s(),n(G,{key:x.id},[D>0?(s(),n("span",Nm," or ")):u("",!0),e("span",Pm,f(x.title),1),e("span",Fm," ("+f(x.type==="lead"?"Lead":"Opp")+" #"+f(x.entityId)+") ",1)],64))),128))])]),e("div",Rm,[e("div",Bm,[w.value.length>0?(s(),P(a(_),{key:0,onClick:i[0]||(i[0]=x=>b(w.value[0])),variant:"default",class:"w-full sm:w-auto"},{default:k(()=>[(s(),P(nt(m(w.value[0].icon)),{class:"w-4 h-4 mr-2"})),M(" "+f(w.value[0].label),1)]),_:1})):u("",!0),w.value.length>1?(s(),P(a(_),{key:1,onClick:i[1]||(i[1]=x=>b(w.value[1])),variant:"outline",class:"w-full sm:w-auto"},{default:k(()=>[(s(),P(nt(m(w.value[1].icon)),{class:"w-4 h-4 mr-2"})),M(" "+f(w.value[1].label),1)]),_:1})):u("",!0)])])])):u("",!0)]),_:1})]),_:1})):u("",!0)}},_m={class:"flex items-center gap-2"},zm={key:0,class:"space-y-3 animate-pulse"},Wm={class:"divide-y divide-border"},Hm={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Ym={class:"flex items-center gap-3 min-w-0"},Gm={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},Km={class:"min-w-0"},Qm={class:"text-sm text-muted-foreground truncate"},Jm={class:"text-xs text-muted-foreground truncate"},Zm={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Xm={class:"flex items-center gap-3 min-w-0"},ef={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},tf={class:"min-w-0"},sf={class:"text-sm text-muted-foreground truncate"},af={class:"text-xs text-muted-foreground truncate"},nf={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},lf={class:"flex items-center gap-3 min-w-0"},of={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},rf={class:"min-w-0"},df={class:"text-sm text-muted-foreground truncate"},uf={class:"text-xs text-muted-foreground truncate"},cf={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},mf={class:"flex items-center gap-3 min-w-0"},ff={class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},vf={class:"min-w-0"},pf={class:"text-sm text-muted-foreground truncate"},yf={class:"text-xs text-muted-foreground truncate"},gf={key:0,class:"text-center py-6 text-muted-foreground"},xf={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=Ve(),A=I(()=>{const r=["email","sms","whatsapp","call"],g=o.activities.filter(y=>r.includes(y.type)).sort((y,V)=>new Date(V.timestamp)-new Date(y.timestamp));return g.length>0?g[0]:null}),j=I(()=>{const r=o.leads.filter(g=>{var y;return!g.isDisqualified&&g.status!=="Disqualified"&&!((y=g.stage)!=null&&y.includes("Closed"))});return r.length>0?r[0]:null}),$=I(()=>{if(!j.value)return null;try{return an({lead:j.value,displayStage:j.value.stage})}catch(r){return console.error("Error getting lead next action:",r),null}}),v=I(()=>{const r=o.opportunities.filter(g=>g.stage!=="Closed Won"&&g.stage!=="Closed Lost");return r.length>0?r[0]:null}),c=I(()=>{if(!v.value)return null;try{const r=o.activities.filter(y=>y.opportunityId===v.value.id)||[];return nn(v.value.stage,{opportunity:v.value,scheduledAppointment:v.value.scheduledAppointment||null,activities:r,hasOffers:r.some(y=>y.type==="offer")||!1,stage:v.value.stage,deliverySubstatus:v.value.deliverySubstatus||null,formatDateTime:y=>y?new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(r){return console.error("Error getting opportunity next action:",r),null}}),w=r=>({email:lt,sms:rn,whatsapp:kt,call:ot})[r]||kt,b=r=>r.type==="call"?r.content||`Call with ${r.user||"customer"}`:r.type==="email"?r.subject||r.content||"Email communication":r.type==="sms"||r.type==="whatsapp"?r.content||`${r.type.toUpperCase()} message`:r.content||"Communication",d=r=>{if(!r)return"";const g=new Date(r),y=new Date,V=Math.abs(y-g),H=Math.ceil(V/(1e3*60*60*24));return H===1?"Today":H===2?"Yesterday":H<=7?`${H-1} days ago`:g.toLocaleDateString("en-US",{month:"short",day:"numeric",year:g.getFullYear()!==y.getFullYear()?"numeric":void 0})},i=r=>{if(!r)return"";const g=new Date(r),y=new Date;if(g.toDateString()===y.toDateString())return`Today at ${g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const H=new Date(y);return H.setDate(H.getDate()+1),g.toDateString()===H.toDateString()?`Tomorrow at ${g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:g.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},x=()=>{var r,g;(r=o.nextAppointment)!=null&&r.opportunityId?m.push({path:`/tasks/${o.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(g=o.nextAppointment)!=null&&g.leadId?m.push({path:`/tasks/${o.nextAppointment.leadId}`,query:{type:"lead"}}):m.push({path:"/calendar"})},D=()=>{var r,g;(r=A.value)!=null&&r.opportunityId?m.push({path:`/tasks/${A.value.opportunityId}`,query:{type:"opportunity"}}):(g=A.value)!=null&&g.leadId&&m.push({path:`/tasks/${A.value.leadId}`,query:{type:"lead"}})},S=()=>{var r;(r=j.value)!=null&&r.id&&m.push({path:`/tasks/${j.value.id}`,query:{type:"lead"}})},p=()=>{var r;(r=v.value)!=null&&r.id&&m.push({path:`/tasks/${v.value.id}`,query:{type:"opportunity"}})};return(r,g)=>(s(),P(a(We),{class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",_m,[l(a(Rt),{class:"w-4 h-4 text-foreground"}),l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...g[0]||(g[0]=[M("Recent Activities",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>{var y,V,H,ae,le,te;return[t.loading?(s(),n("div",zm,[(s(),n(G,null,ee(3,re=>e("div",{key:`skeleton-${re}`,class:"flex items-center gap-3 p-3"},[...g[1]||(g[1]=[e("div",{class:"w-8 h-8 bg-muted rounded-full"},null,-1),e("div",{class:"flex-1 space-y-2"},[e("div",{class:"h-3 bg-muted rounded w-1/4"}),e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-3 bg-muted rounded w-1/2"})],-1),e("div",{class:"w-8 h-8 bg-muted rounded"},null,-1)])])),64))])):(s(),n(G,{key:1},[e("div",Wm,[t.nextAppointment?(s(),n("div",Hm,[e("div",Ym,[e("div",Gm,[l(a(el),{class:"w-4 h-4 text-primary"})]),e("div",Km,[g[2]||(g[2]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",Qm,f(i(t.nextAppointment.start)),1),e("div",Jm,f(t.nextAppointment.title||"Appointment"),1)])]),l(a(_),{onClick:x,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(a(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),A.value?(s(),n("div",Zm,[e("div",Xm,[e("div",ef,[(s(),P(nt(w(A.value.type)),{class:"w-4 h-4 text-muted-foreground"}))]),e("div",tf,[g[3]||(g[3]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",sf,f(b(A.value)),1),e("div",af,f(d(A.value.timestamp)),1)])]),l(a(_),{onClick:D,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(a(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),j.value?(s(),n("div",nf,[e("div",lf,[e("div",of,[l(a(bt),{class:"w-4 h-4 text-primary"})]),e("div",rf,[g[4]||(g[4]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",df,f(((y=$.value)==null?void 0:y.label)||"No action defined"),1),e("div",uf,f((V=j.value.requestedCar)==null?void 0:V.brand)+" "+f((H=j.value.requestedCar)==null?void 0:H.model),1)])]),l(a(_),{onClick:S,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(a(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0),v.value?(s(),n("div",cf,[e("div",mf,[e("div",ff,[l(a(tl),{class:"w-4 h-4 text-primary"})]),e("div",vf,[g[5]||(g[5]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",pf,f(((ae=c.value)==null?void 0:ae.label)||"No action defined"),1),e("div",yf,f((le=v.value.vehicle)==null?void 0:le.brand)+" "+f((te=v.value.vehicle)==null?void 0:te.model)+" - "+f(v.value.stage),1)])]),l(a(_),{onClick:p,variant:"outline",size:"icon",title:"View Details"},{default:k(()=>[l(a(ht),{class:"w-4 h-4"})]),_:1})])):u("",!0)]),!t.nextAppointment&&!A.value&&!j.value&&!v.value?(s(),n("div",gf,[l(a(sl),{class:"w-8 h-8 mx-auto mb-2 opacity-30"}),g[6]||(g[6]=e("p",{class:"text-xs"},"No recent activities available",-1))])):u("",!0)],64))]}),_:1})]),_:1}))}},hf={class:"flex items-center justify-between"},bf={key:0,class:"space-y-3 animate-pulse"},kf={key:0,class:"mb-4 pb-4 border-b border-border"},wf={class:"flex items-center gap-2 mb-1"},$f={key:0,class:"text-sm text-muted-foreground"},Cf={key:1,class:"text-xs text-muted-foreground mt-1"},Af={class:"space-y-4"},If={key:0,class:"space-y-2"},Sf={class:"space-y-2"},Tf={key:0,class:"flex items-center gap-3"},Df={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},jf={class:"flex-1 min-w-0"},qf={class:"text-sm text-foreground"},Vf={key:1,class:"flex items-center gap-3"},Mf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Of={class:"flex-1 min-w-0"},Lf={class:"text-sm text-foreground"},Ef={key:2,class:"flex items-center gap-3"},Nf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Pf={class:"flex-1 min-w-0"},Ff={class:"text-sm text-foreground"},Rf={key:3,class:"flex items-center gap-3"},Bf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Uf={class:"flex-1 min-w-0"},_f={class:"text-sm text-foreground"},zf={key:1,class:"space-y-2"},Wf={class:"space-y-2"},Hf={key:0,class:"flex items-center gap-3 group"},Yf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Gf={class:"flex-1 min-w-0"},Kf=["href"],Qf={key:1,class:"flex items-center gap-3 group"},Jf={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Zf={class:"flex-1 min-w-0"},Xf=["href"],ev={key:2,class:"flex items-center gap-3 group"},tv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},sv={class:"flex-1 min-w-0"},av=["href"],nv={key:3,class:"flex items-center gap-3 group"},lv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ov={class:"flex-1 min-w-0"},iv=["href"],rv={key:4,class:"flex items-center gap-3 group"},dv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},uv={class:"flex-1 min-w-0"},cv=["href"],mv={key:2,class:"space-y-2"},fv={class:"space-y-2"},vv={key:0,class:"flex items-center gap-3 group"},pv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},yv={class:"flex-1 min-w-0"},gv={class:"text-sm text-foreground"},xv={key:1,class:"flex items-center gap-3"},hv={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},bv={class:"flex-1 min-w-0"},kv={class:"text-sm text-foreground"},wv={key:2,class:"flex items-center gap-3"},$v={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Cv={class:"flex-1 min-w-0"},Av={class:"text-sm text-foreground"},Iv={key:0},Sv={key:1},Tv={key:2},Dv={key:3},jv={key:4},qv={key:5},Vv={key:6},Mv={key:3,class:"flex items-center gap-3 group"},Ov={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Lv={class:"flex-1 min-w-0"},Ev={class:"text-sm text-foreground"},Nv={key:3,class:"space-y-2"},Pv={class:"space-y-1.5"},Fv={key:0,class:"flex items-center gap-2"},Rv={class:"text-xs text-foreground font-medium"},Bv={key:1,class:"flex items-center gap-2 group"},Uv={class:"text-xs text-foreground font-mono"},_v={key:2,class:"flex items-center gap-2"},zv={class:"text-xs text-foreground"},Wv={key:3,class:"flex items-center gap-2"},Hv={class:"text-xs text-foreground"},Yv={class:"text-xs text-muted-foreground"},Gv={class:"text-xs text-foreground truncate"},Kv={key:4,class:"text-center py-6 text-muted-foreground"},Qv={__name:"CustomerContactDetailsCard",props:{firstName:{type:String,default:""},lastName:{type:String,default:""},name:{type:String,default:""},initials:{type:String,default:""},title:{type:String,default:""},salutation:{type:String,default:""},jobTitle:{type:String,default:""},birthDate:{type:String,default:""},gender:{type:String,default:""},placeOfBirth:{type:String,default:""},email:{type:[String,Object],default:()=>""},secondaryEmail:{type:String,default:""},phone:{type:[String,Object],default:()=>""},secondaryPhone:{type:String,default:""},mobilePhone:{type:String,default:""},preferredContactMethod:{type:String,default:""},preferredChannel:{type:String,default:""},address:{type:[String,Object],default:()=>""},streetAddress1:{type:String,default:""},streetAddress2:{type:String,default:""},city:{type:String,default:""},postalCode:{type:String,default:""},region:{type:String,default:""},country:{type:String,default:""},contactCustomFields:{type:Object,default:()=>({})},externalId:{type:String,default:""},createdAt:{type:String,default:""},createdDate:{type:String,default:""},updatedAt:{type:String,default:""},lastUpdatedDate:{type:String,default:""},lastActivityDate:{type:String,default:""},isMasterContact:{type:Boolean,default:!1},accountName:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=Za(),A=N(!1),j=I(()=>o.firstName||o.lastName?`${o.firstName||""} ${o.lastName||""}`.trim():o.name||""),$=I(()=>typeof o.email=="object"&&o.email!==null?o.email.primary||"":o.email||""),v=I(()=>typeof o.email=="object"&&o.email!==null?o.email.secondary||"":o.secondaryEmail||""),c=I(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.primary||"":o.phone||""),w=I(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.secondary||"":o.secondaryPhone||""),b=I(()=>typeof o.phone=="object"&&o.phone!==null?o.phone.mobile||"":o.mobilePhone||""),d=I(()=>typeof o.address=="object"&&o.address!==null?o.address.streetLine1||"":o.streetAddress1||o.streetAddress||""),i=I(()=>typeof o.address=="object"&&o.address!==null?o.address.streetLine2||"":o.streetAddress2||""),x=I(()=>typeof o.address=="object"&&o.address!==null?o.address.city||"":o.city||""),D=I(()=>typeof o.address=="object"&&o.address!==null?o.address.postalCode||"":o.postalCode||o.zipCode||""),S=I(()=>typeof o.address=="object"&&o.address!==null?o.address.region||"":o.region||o.state||o.county||""),p=I(()=>typeof o.address=="object"&&o.address!==null?o.address.country||"":o.country||""),r=I(()=>typeof o.address=="string"?o.address:""),g=I(()=>!!(d.value||x.value||D.value||S.value||p.value)),y=I(()=>o.createdAt||o.createdDate||""),V=I(()=>o.updatedAt||o.lastUpdatedDate||""),H=I(()=>!!(o.title||o.jobTitle||$.value||v.value||c.value||w.value||b.value||ae.value||g.value||r.value||o.birthDate||o.gender||o.placeOfBirth||o.externalId||y.value||V.value||o.contactCustomFields&&Object.keys(o.contactCustomFields).length>0)),ae=I(()=>o.preferredContactMethod||o.preferredChannel||""),le=re=>{if(!re)return"";try{return new Date(re).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return re}},te=async(re,E)=>{try{await navigator.clipboard.writeText(re);const se=E==="email"?"Email":E==="phone"?"Phone":E==="address"?"Address":E;m.pushToast("success",`${se} copied!`)}catch{m.pushToast("error","Failed to copy")}};return(re,E)=>(s(),P(a(We),{class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",hf,[l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[M(f(j.value||"Contact Details"),1)]),_:1}),l(a(_),{onClick:E[0]||(E[0]=se=>A.value=!0),variant:"ghost",size:"sm",class:"text-xs"},{default:k(()=>[...E[10]||(E[10]=[M(" Edit Contact ",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>[t.loading?(s(),n("div",bf,[...E[11]||(E[11]=[e("div",{class:"h-4 bg-muted rounded w-3/4"},null,-1),e("div",{class:"h-4 bg-muted rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-muted rounded w-4/5"},null,-1)])])):(s(),n(G,{key:1},[t.jobTitle||t.isMasterContact?(s(),n("div",kf,[e("div",wf,[t.isMasterContact?(s(),P(a(pe),{key:0,variant:"outline",class:"text-xs px-1.5 py-0"},{default:k(()=>[l(a(dn),{class:"w-3 h-3 mr-1"}),E[12]||(E[12]=M(" Master Contact ",-1))]),_:1})):u("",!0)]),t.jobTitle?(s(),n("div",$f,f(t.jobTitle),1)):u("",!0),t.accountName&&t.isMasterContact?(s(),n("div",Cf," at "+f(t.accountName),1)):u("",!0)])):u("",!0),e("div",Af,[t.title||t.birthDate||t.gender||t.placeOfBirth?(s(),n("div",If,[E[17]||(E[17]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Personal Info",-1)),e("div",Sf,[t.title?(s(),n("div",Tf,[e("div",Df,[l(a(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",jf,[E[13]||(E[13]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Title",-1)),e("div",qf,f(t.title),1)])])):u("",!0),t.birthDate?(s(),n("div",Vf,[e("div",Mf,[l(a(Ht),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Of,[E[14]||(E[14]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Birth Date",-1)),e("div",Lf,f(le(t.birthDate)),1)])])):u("",!0),t.gender?(s(),n("div",Ef,[e("div",Nf,[l(a(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Pf,[E[15]||(E[15]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Gender",-1)),e("div",Ff,f(t.gender),1)])])):u("",!0),t.placeOfBirth?(s(),n("div",Rf,[e("div",Bf,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Uf,[E[16]||(E[16]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Place of Birth",-1)),e("div",_f,f(t.placeOfBirth),1)])])):u("",!0)])])):u("",!0),$.value||v.value||c.value||w.value||b.value?(s(),n("div",zf,[E[23]||(E[23]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Contact Methods",-1)),e("div",Wf,[$.value?(s(),n("div",Hf,[e("div",Yf,[l(a(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Gf,[E[18]||(E[18]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Primary Email",-1)),e("a",{href:`mailto:${$.value}`,class:"text-sm text-primary hover:underline truncate block"},f($.value),9,Kf)]),l(a(_),{onClick:E[1]||(E[1]=se=>te($.value,"email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),v.value?(s(),n("div",Qf,[e("div",Jf,[l(a(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Zf,[E[19]||(E[19]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Secondary Email",-1)),e("a",{href:`mailto:${v.value}`,class:"text-sm text-primary hover:underline truncate block"},f(v.value),9,Xf)]),l(a(_),{onClick:E[2]||(E[2]=se=>te(v.value,"email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),c.value?(s(),n("div",ev,[e("div",tv,[l(a(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",sv,[E[20]||(E[20]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Primary Phone",-1)),e("a",{href:`tel:${c.value}`,class:"text-sm text-primary hover:underline"},f(c.value),9,av)]),l(a(_),{onClick:E[3]||(E[3]=se=>te(c.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),w.value?(s(),n("div",nv,[e("div",lv,[l(a(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ov,[E[21]||(E[21]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Secondary Phone",-1)),e("a",{href:`tel:${w.value}`,class:"text-sm text-primary hover:underline"},f(w.value),9,iv)]),l(a(_),{onClick:E[4]||(E[4]=se=>te(w.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),b.value?(s(),n("div",rv,[e("div",dv,[l(a(al),{class:"w-4 h-4 text-muted-foreground"})]),e("div",uv,[E[22]||(E[22]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Mobile Phone",-1)),e("a",{href:`tel:${b.value}`,class:"text-sm text-primary hover:underline"},f(b.value),9,cv)]),l(a(_),{onClick:E[5]||(E[5]=se=>te(b.value,"phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])])):u("",!0),g.value||r.value?(s(),n("div",mv,[E[26]||(E[26]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Address",-1)),e("div",fv,[d.value?(s(),n("div",vv,[e("div",pv,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",yv,[E[24]||(E[24]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Street Address",-1)),e("div",gv,f(d.value),1)]),l(a(_),{onClick:E[6]||(E[6]=se=>te(d.value,"address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),i.value?(s(),n("div",xv,[e("div",hv,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",bv,[e("div",kv,f(i.value),1)])])):u("",!0),x.value||D.value||S.value||p.value?(s(),n("div",wv,[e("div",$v,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",Cv,[e("div",Av,[x.value?(s(),n("span",Iv,f(x.value),1)):u("",!0),x.value&&D.value?(s(),n("span",Sv,", ")):u("",!0),D.value?(s(),n("span",Tv,f(D.value),1)):u("",!0),(x.value||D.value)&&S.value?(s(),n("span",Dv,", ")):u("",!0),S.value?(s(),n("span",jv,f(S.value),1)):u("",!0),(x.value||D.value||S.value)&&p.value?(s(),n("span",qv,", ")):u("",!0),p.value?(s(),n("span",Vv,f(p.value),1)):u("",!0)])])])):u("",!0),r.value&&!g.value?(s(),n("div",Mv,[e("div",Ov,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Lv,[E[25]||(E[25]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Address",-1)),e("div",Ev,f(r.value),1)]),l(a(_),{onClick:E[7]||(E[7]=se=>te(r.value,"address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])])):u("",!0),t.externalId||y.value||V.value||ae.value||t.contactCustomFields&&Object.keys(t.contactCustomFields).length>0?(s(),n("div",Nv,[E[31]||(E[31]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Metadata",-1)),e("div",Pv,[ae.value?(s(),n("div",Fv,[l(a(kt),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[27]||(E[27]=e("span",{class:"text-xs text-muted-foreground"},"Preferred Method:",-1)),e("span",Rv,f(ae.value),1)])):u("",!0),t.externalId?(s(),n("div",Bv,[l(a(on),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[28]||(E[28]=e("span",{class:"text-xs text-muted-foreground"},"External ID:",-1)),e("span",Uv,f(t.externalId),1),l(a(_),{onClick:E[8]||(E[8]=se=>te(t.externalId,"External ID")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0 h-5 w-5 ml-auto",title:"Copy External ID"},{default:k(()=>[l(a(ye),{class:"w-3 h-3"})]),_:1})])):u("",!0),y.value?(s(),n("div",_v,[l(a(Ht),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[29]||(E[29]=e("span",{class:"text-xs text-muted-foreground"},"Created:",-1)),e("span",zv,f(le(y.value)),1)])):u("",!0),V.value?(s(),n("div",Wv,[l(a(Rt),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),E[30]||(E[30]=e("span",{class:"text-xs text-muted-foreground"},"Last Updated:",-1)),e("span",Hv,f(le(V.value)),1)])):u("",!0),t.contactCustomFields&&Object.keys(t.contactCustomFields).length>0?(s(!0),n(G,{key:4},ee(t.contactCustomFields,(se,xe)=>(s(),n("div",{key:xe,class:"flex items-center gap-2"},[l(a(Ue),{class:"w-3.5 h-3.5 text-muted-foreground shrink-0"}),e("span",Yv,f(xe)+":",1),e("span",Gv,f(se),1)]))),128)):u("",!0)])])):u("",!0),H.value?u("",!0):(s(),n("div",Kv,[...E[32]||(E[32]=[e("p",{class:"text-xs"},"No contact details available",-1)])]))])],64))]),_:1}),l(Pe,{show:A.value,title:"Edit Contact",onClose:E[9]||(E[9]=se=>A.value=!1)},null,8,["show"])]),_:1}))}},Jv={class:"flex items-center justify-between"},Zv={key:0,class:"space-y-3 animate-pulse"},Xv={key:1,class:"space-y-4"},ep={class:"space-y-2"},tp={class:"space-y-2"},sp={key:0,class:"flex items-center gap-3"},ap={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},np={class:"flex-1 min-w-0"},lp={class:"text-sm font-medium text-foreground"},op={key:1,class:"flex items-center gap-3"},ip={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},rp={class:"flex-1 min-w-0"},dp={class:"text-sm text-foreground"},up={key:2,class:"flex items-center gap-3"},cp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},mp={class:"flex-1 min-w-0"},fp={key:3,class:"flex items-center gap-3"},vp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},pp={class:"flex-1 min-w-0"},yp={class:"text-sm text-foreground"},gp={key:4,class:"flex items-center gap-3"},xp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},hp={class:"flex-1 min-w-0"},bp={class:"text-sm text-foreground"},kp={key:5,class:"flex items-center gap-3 group"},wp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},$p={class:"flex-1 min-w-0"},Cp=["href"],Ap={key:6,class:"flex items-center gap-3 group"},Ip={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Sp={class:"flex-1 min-w-0"},Tp=["href"],Dp={key:7,class:"flex items-center gap-3 group"},jp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},qp={class:"flex-1 min-w-0"},Vp=["href"],Mp={key:0,class:"space-y-2"},Op={class:"space-y-2"},Lp={key:0,class:"flex items-center gap-3 group"},Ep={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Np={class:"flex-1 min-w-0"},Pp={class:"text-sm text-foreground"},Fp={key:1,class:"flex items-center gap-3 group"},Rp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Bp={class:"flex-1 min-w-0"},Up={class:"text-sm text-foreground"},_p={key:2,class:"flex items-center gap-3"},zp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Wp={class:"flex-1 min-w-0"},Hp={class:"text-sm text-foreground"},Yp={key:3,class:"flex items-center gap-3"},Gp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Kp={class:"flex-1 min-w-0"},Qp={class:"text-sm text-foreground"},Jp={key:4,class:"flex items-center gap-3"},Zp={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Xp={class:"flex-1 min-w-0"},ey={class:"text-sm text-foreground"},ty={key:1,class:"space-y-2"},sy={class:"space-y-2"},ay={key:0,class:"flex items-center gap-3 group"},ny={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},ly={class:"flex-1 min-w-0"},oy={class:"text-sm text-foreground"},iy={key:1,class:"flex items-center gap-3"},ry={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},dy={class:"flex-1 min-w-0"},uy={class:"text-sm text-foreground"},cy={key:2,class:"flex items-center gap-3"},my={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},fy={class:"flex-1 min-w-0"},vy={class:"text-sm text-foreground"},py={key:0},yy={key:1},gy={key:2},xy={key:3},hy={key:4},by={key:5},ky={key:6},wy={key:2,class:"space-y-2"},$y={class:"space-y-2"},Cy={key:0,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Ay={class:"flex items-center gap-3 flex-1 min-w-0"},Iy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Sy={class:"flex-1 min-w-0"},Ty={class:"text-sm font-medium text-foreground"},Dy={key:1,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},jy={class:"flex items-center gap-3 flex-1 min-w-0"},qy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Vy={class:"flex-1 min-w-0"},My={class:"text-sm font-medium text-foreground"},Oy={key:2,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Ly={class:"flex items-center gap-3 flex-1 min-w-0"},Ey={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Ny={class:"flex-1 min-w-0"},Py={class:"text-sm font-medium text-foreground"},Fy={key:3,class:"flex items-center justify-between gap-3 p-2 hover:bg-muted/50 rounded-md transition-colors"},Ry={class:"flex items-center gap-3 flex-1 min-w-0"},By={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Uy={class:"flex-1 min-w-0"},_y={class:"text-sm font-medium text-foreground"},zy={key:3,class:"space-y-2"},Wy={class:"flex items-start gap-3"},Hy={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},Yy={class:"flex-1 min-w-0"},Gy={class:"text-sm text-foreground whitespace-pre-line"},Ky={key:4,class:"space-y-2"},Qy={class:"flex flex-wrap gap-1.5"},Jy={key:5,class:"space-y-2"},Zy={class:"space-y-2"},Xy={key:0,class:"flex items-center gap-3 group"},eg={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},tg={class:"flex-1 min-w-0"},sg={class:"text-sm text-foreground font-mono"},ag={key:1,class:"flex items-center gap-3"},ng={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},lg={class:"flex-1 min-w-0"},og={class:"text-sm text-foreground"},ig={key:2,class:"flex items-center gap-3"},rg={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},dg={class:"flex-1 min-w-0"},ug={class:"text-sm text-foreground"},cg={key:3,class:"flex items-center gap-3"},mg={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},fg={class:"flex-1 min-w-0"},vg={class:"text-sm text-foreground"},pg={key:4,class:"space-y-1"},yg={class:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0"},gg={class:"flex-1 min-w-0"},xg={class:"text-xs text-muted-foreground mb-0.5"},hg={class:"text-sm text-foreground"},bg={key:6,class:"text-center py-6 text-muted-foreground"},kg={__name:"AccountDetailsCard",props:{accountData:{type:Object,default:null},currentContactId:{type:[Number,String],default:null},accountStatus:{type:String,default:"Active"},companyWebsite:{type:String,default:""},companyPhone:{type:String,default:""},companyEmail:{type:String,default:""},companyAddress:{type:[String,Object],default:()=>""},companyStreetAddress1:{type:String,default:""},companyStreetAddress2:{type:String,default:""},companyCity:{type:String,default:""},companyPostalCode:{type:String,default:""},companyRegion:{type:String,default:""},companyCountry:{type:String,default:""},fiscalEntity:{type:[String,Object],default:()=>""},accountExternalId:{type:String,default:""},accountCustomFields:{type:Object,default:()=>({})},accountCreatedAt:{type:String,default:""},createdDate:{type:String,default:""},accountUpdatedAt:{type:String,default:""},lastUpdatedDate:{type:String,default:""},lastActivity:{type:String,default:""},lastActivityDate:{type:String,default:""},relatedContactsCount:{type:[Number,Object],default:void 0},relatedLeadsCount:{type:[Number,Object],default:void 0},relatedOpportunitiesCount:{type:[Number,Object],default:void 0},relatedVehiclesCount:{type:[Number,Object],default:void 0},accountTags:{type:Array,default:()=>[]},paymentTerms:{type:String,default:""},creditLimit:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=Za(),A=N(!1),j=N(!1),$=N(!1),v=N(!1),c=N(!1),w=I(()=>typeof o.fiscalEntity=="object"&&o.fiscalEntity!==null?o.fiscalEntity.name||"":o.fiscalEntity||""),b=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.streetLine1||"":o.companyStreetAddress1||""),d=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.streetLine2||"":o.companyStreetAddress2||""),i=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.city||"":o.companyCity||""),x=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.postalCode||"":o.companyPostalCode||""),D=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.region||"":o.companyRegion||""),S=I(()=>typeof o.companyAddress=="object"&&o.companyAddress!==null?o.companyAddress.country||"":o.companyCountry||""),p=I(()=>typeof o.relatedContactsCount=="object"&&o.relatedContactsCount!==null?o.relatedContactsCount.count||0:o.relatedContactsCount??0),r=I(()=>typeof o.relatedLeadsCount=="object"&&o.relatedLeadsCount!==null?o.relatedLeadsCount.count||0:o.relatedLeadsCount??0),g=I(()=>typeof o.relatedOpportunitiesCount=="object"&&o.relatedOpportunitiesCount!==null?o.relatedOpportunitiesCount.count||0:o.relatedOpportunitiesCount??0),y=I(()=>typeof o.relatedVehiclesCount=="object"&&o.relatedVehiclesCount!==null?o.relatedVehiclesCount.count||0:o.relatedVehiclesCount??0),V=I(()=>o.accountCreatedAt||o.createdDate||""),H=I(()=>o.accountUpdatedAt||o.lastUpdatedDate||""),ae=I(()=>o.lastActivity||o.lastActivityDate||""),le=I(()=>{var J,T,W,L;return!!((J=o.accountData)!=null&&J.vat||(T=o.accountData)!=null&&T.vatNumber||(W=o.accountData)!=null&&W.taxCode||(L=o.accountData)!=null&&L.fiscalCode||w.value)}),te=I(()=>!!(b.value||i.value||x.value||D.value||S.value)),re=I(()=>p.value!==void 0&&p.value!==null||r.value!==void 0&&r.value!==null||g.value!==void 0&&g.value!==null||y.value!==void 0&&y.value!==null),E=I(()=>!!(o.accountExternalId||o.accountCreatedAt||o.accountUpdatedAt||o.lastActivity||o.accountCustomFields&&Object.keys(o.accountCustomFields).length>0)),se=I(()=>{var J,T,W,L;return!!((J=o.accountData)!=null&&J.name||(T=o.accountData)!=null&&T.companyName||le.value||te.value||re.value||(W=o.accountData)!=null&&W.description||(L=o.accountData)!=null&&L.notes||o.accountTags&&o.accountTags.length>0||E.value)}),xe=J=>J?typeof J=="string"?J:J.name?J.name:J.firstName&&J.lastName?`${J.firstName} ${J.lastName}`:"Unknown":"Not assigned",Ae=J=>{if(!J)return"";try{return new Date(J).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return J}},he=async(J,T)=>{try{await navigator.clipboard.writeText(J),m.pushToast("success",`${T} copied!`)}catch{m.pushToast("error","Failed to copy")}};return(J,T)=>t.accountData||t.loading?(s(),P(a(We),{key:0,class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",Jv,[l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...T[17]||(T[17]=[M("Account Details",-1)])]),_:1}),l(a(_),{onClick:T[0]||(T[0]=W=>A.value=!0),variant:"ghost",size:"sm",class:"text-xs"},{default:k(()=>[...T[18]||(T[18]=[M(" Edit Account ",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>[t.loading?(s(),n("div",Zv,[...T[19]||(T[19]=[e("div",{class:"h-4 bg-muted rounded w-3/4"},null,-1),e("div",{class:"h-4 bg-muted rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-muted rounded w-4/5"},null,-1),e("div",{class:"h-4 bg-muted rounded w-1/2"},null,-1)])])):t.accountData?(s(),n("div",Xv,[e("div",ep,[T[28]||(T[28]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Company Info",-1)),e("div",tp,[t.accountData.name||t.accountData.companyName?(s(),n("div",sp,[e("div",ap,[l(a(_a),{class:"w-4 h-4 text-muted-foreground"})]),e("div",np,[T[20]||(T[20]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Name",-1)),e("div",lp,f(t.accountData.name||t.accountData.companyName),1)]),t.accountData.type?(s(),P(a(pe),{key:0,variant:"outline",class:"text-xs"},{default:k(()=>[M(f(t.accountData.type),1)]),_:1})):u("",!0)])):u("",!0),t.accountData.type?(s(),n("div",op,[e("div",ip,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",rp,[T[21]||(T[21]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Type",-1)),e("div",dp,f(t.accountData.type==="Company"?"Company Account":"Private Account"),1)])])):u("",!0),t.accountStatus?(s(),n("div",up,[e("div",cp,[l(a(Fn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",mp,[T[22]||(T[22]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Status",-1)),l(a(pe),{variant:t.accountStatus==="Active"?"default":"outline",class:"text-xs"},{default:k(()=>[M(f(t.accountStatus),1)]),_:1},8,["variant"])])])):u("",!0),t.accountData.accountOwner||t.accountData.owner?(s(),n("div",fp,[e("div",vp,[l(a(bt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",pp,[T[23]||(T[23]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Account Owner",-1)),e("div",yp,f(xe(t.accountData.accountOwner||t.accountData.owner)),1)])])):u("",!0),t.accountData.type==="Company"&&t.accountData.numberOfEmployees?(s(),n("div",gp,[e("div",xp,[l(a(Ft),{class:"w-4 h-4 text-muted-foreground"})]),e("div",hp,[T[24]||(T[24]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Employees",-1)),e("div",bp,f(t.accountData.numberOfEmployees),1)])])):u("",!0),t.companyWebsite?(s(),n("div",kp,[e("div",wp,[l(a(gn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",$p,[T[25]||(T[25]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Website",-1)),e("a",{href:t.companyWebsite.startsWith("http")?t.companyWebsite:`https://${t.companyWebsite}`,target:"_blank",rel:"noopener noreferrer",class:"text-sm text-primary hover:underline truncate block"},f(t.companyWebsite),9,Cp)]),l(a(_),{onClick:T[1]||(T[1]=W=>he(t.companyWebsite,"Website")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy website"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.companyPhone?(s(),n("div",Ap,[e("div",Ip,[l(a(ot),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Sp,[T[26]||(T[26]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Phone",-1)),e("a",{href:`tel:${t.companyPhone}`,class:"text-sm text-primary hover:underline"},f(t.companyPhone),9,Tp)]),l(a(_),{onClick:T[2]||(T[2]=W=>he(t.companyPhone,"Phone")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy phone"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.companyEmail?(s(),n("div",Dp,[e("div",jp,[l(a(lt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",qp,[T[27]||(T[27]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Company Email",-1)),e("a",{href:`mailto:${t.companyEmail}`,class:"text-sm text-primary hover:underline truncate block"},f(t.companyEmail),9,Vp)]),l(a(_),{onClick:T[3]||(T[3]=W=>he(t.companyEmail,"Email")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy email"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0)])]),le.value?(s(),n("div",Mp,[T[34]||(T[34]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Legal/Business",-1)),e("div",Op,[t.accountData.vat||t.accountData.vatNumber?(s(),n("div",Lp,[e("div",Ep,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Np,[T[29]||(T[29]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"VAT Number",-1)),e("div",Pp,f(t.accountData.vat||t.accountData.vatNumber),1)]),l(a(_),{onClick:T[4]||(T[4]=W=>he(t.accountData.vat||t.accountData.vatNumber,"VAT")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy VAT"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),t.accountData.taxCode||t.accountData.fiscalCode?(s(),n("div",Fp,[e("div",Rp,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Bp,[T[30]||(T[30]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Tax Code",-1)),e("div",Up,f(t.accountData.taxCode||t.accountData.fiscalCode),1)]),l(a(_),{onClick:T[5]||(T[5]=W=>he(t.accountData.taxCode||t.accountData.fiscalCode,"Tax Code")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy Tax Code"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),w.value?(s(),n("div",_p,[e("div",zp,[l(a(_a),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Wp,[T[31]||(T[31]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Fiscal Entity",-1)),e("div",Hp,f(w.value),1)])])):u("",!0),t.paymentTerms?(s(),n("div",Yp,[e("div",Gp,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Kp,[T[32]||(T[32]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Payment Terms",-1)),e("div",Qp,f(t.paymentTerms),1)])])):u("",!0),t.creditLimit?(s(),n("div",Jp,[e("div",Zp,[l(a(ln),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Xp,[T[33]||(T[33]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Credit Limit",-1)),e("div",ey,f(t.creditLimit),1)])])):u("",!0)])])):u("",!0),te.value?(s(),n("div",ty,[T[36]||(T[36]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Address",-1)),e("div",sy,[b.value?(s(),n("div",ay,[e("div",ny,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground"})]),e("div",ly,[T[35]||(T[35]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Street Address",-1)),e("div",oy,f(b.value),1)]),l(a(_),{onClick:T[6]||(T[6]=W=>he(b.value,"Address")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy address"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),d.value?(s(),n("div",iy,[e("div",ry,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",dy,[e("div",uy,f(d.value),1)])])):u("",!0),i.value||x.value||D.value||S.value?(s(),n("div",cy,[e("div",my,[l(a(Fe),{class:"w-4 h-4 text-muted-foreground opacity-0"})]),e("div",fy,[e("div",vy,[i.value?(s(),n("span",py,f(i.value),1)):u("",!0),i.value&&x.value?(s(),n("span",yy,", ")):u("",!0),x.value?(s(),n("span",gy,f(x.value),1)):u("",!0),(i.value||x.value)&&D.value?(s(),n("span",xy,", ")):u("",!0),D.value?(s(),n("span",hy,f(D.value),1)):u("",!0),(i.value||x.value||D.value)&&S.value?(s(),n("span",by,", ")):u("",!0),S.value?(s(),n("span",ky,f(S.value),1)):u("",!0)])])])):u("",!0)])])):u("",!0),re.value?(s(),n("div",wy,[T[45]||(T[45]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Relationships",-1)),e("div",$y,[p.value!==void 0&&p.value!==null?(s(),n("div",Cy,[e("div",Ay,[e("div",Iy,[l(a(Ft),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Sy,[T[37]||(T[37]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Contacts",-1)),e("div",Ty,f(p.value),1)])]),l(a(_),{onClick:T[7]||(T[7]=W=>j.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[38]||(T[38]=[M(" View All ",-1)])]),_:1})])):u("",!0),r.value!==void 0&&r.value!==null?(s(),n("div",Dy,[e("div",jy,[e("div",qy,[l(a(nl),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Vy,[T[39]||(T[39]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Leads",-1)),e("div",My,f(r.value),1)])]),l(a(_),{onClick:T[8]||(T[8]=W=>$.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[40]||(T[40]=[M(" View All ",-1)])]),_:1})])):u("",!0),g.value!==void 0&&g.value!==null?(s(),n("div",Oy,[e("div",Ly,[e("div",Ey,[l(a(Xn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Ny,[T[41]||(T[41]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Opportunities",-1)),e("div",Py,f(g.value),1)])]),l(a(_),{onClick:T[9]||(T[9]=W=>v.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[42]||(T[42]=[M(" View All ",-1)])]),_:1})])):u("",!0),y.value!==void 0&&y.value!==null?(s(),n("div",Fy,[e("div",Ry,[e("div",By,[l(a(sn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Uy,[T[43]||(T[43]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Related Vehicles",-1)),e("div",_y,f(y.value),1)])]),l(a(_),{onClick:T[10]||(T[10]=W=>c.value=!0),variant:"ghost",size:"sm",class:"text-xs shrink-0"},{default:k(()=>[...T[44]||(T[44]=[M(" View All ",-1)])]),_:1})])):u("",!0)])])):u("",!0),t.accountData.description||t.accountData.notes?(s(),n("div",zy,[T[47]||(T[47]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Additional Info",-1)),e("div",Wy,[e("div",Hy,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",Yy,[T[46]||(T[46]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Description",-1)),e("div",Gy,f(t.accountData.description||t.accountData.notes),1)])])])):u("",!0),t.accountTags&&t.accountTags.length>0?(s(),n("div",Ky,[T[48]||(T[48]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Tags",-1)),e("div",Qy,[(s(!0),n(G,null,ee(t.accountTags,W=>(s(),P(a(pe),{key:W,variant:"outline",class:"text-xs"},{default:k(()=>[M(f(W),1)]),_:2},1024))),128))])])):u("",!0),E.value?(s(),n("div",Jy,[T[53]||(T[53]=e("h4",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wide"},"Metadata",-1)),e("div",Zy,[t.accountExternalId?(s(),n("div",Xy,[e("div",eg,[l(a(on),{class:"w-4 h-4 text-muted-foreground"})]),e("div",tg,[T[49]||(T[49]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"External ID",-1)),e("div",sg,f(t.accountExternalId),1)]),l(a(_),{onClick:T[11]||(T[11]=W=>he(t.accountExternalId,"External ID")),variant:"ghost",size:"icon",class:"opacity-0 group-hover:opacity-100 transition-opacity shrink-0",title:"Copy External ID"},{default:k(()=>[l(a(ye),{class:"w-4 h-4"})]),_:1})])):u("",!0),V.value?(s(),n("div",ag,[e("div",ng,[l(a(Ht),{class:"w-4 h-4 text-muted-foreground"})]),e("div",lg,[T[50]||(T[50]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Created Date",-1)),e("div",og,f(Ae(V.value)),1)])])):u("",!0),H.value?(s(),n("div",ig,[e("div",rg,[l(a(Rt),{class:"w-4 h-4 text-muted-foreground"})]),e("div",dg,[T[51]||(T[51]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Last Updated",-1)),e("div",ug,f(Ae(H.value)),1)])])):u("",!0),ae.value?(s(),n("div",cg,[e("div",mg,[l(a(Zn),{class:"w-4 h-4 text-muted-foreground"})]),e("div",fg,[T[52]||(T[52]=e("div",{class:"text-xs text-muted-foreground mb-0.5"},"Last Activity",-1)),e("div",vg,f(Ae(ae.value)),1)])])):u("",!0),t.accountCustomFields&&Object.keys(t.accountCustomFields).length>0?(s(),n("div",pg,[(s(!0),n(G,null,ee(t.accountCustomFields,(W,L)=>(s(),n("div",{key:L,class:"flex items-center gap-3"},[e("div",yg,[l(a(Ue),{class:"w-4 h-4 text-muted-foreground"})]),e("div",gg,[e("div",xg,f(L),1),e("div",hg,f(W),1)])]))),128))])):u("",!0)])])):u("",!0),se.value?u("",!0):(s(),n("div",bg,[...T[54]||(T[54]=[e("p",{class:"text-xs"},"No account details available",-1)])]))])):u("",!0)]),_:1}),l(Pe,{show:A.value,title:"Edit Account",onClose:T[12]||(T[12]=W=>A.value=!1)},null,8,["show"]),l(Pe,{show:j.value,title:"View All Contacts",onClose:T[13]||(T[13]=W=>j.value=!1)},null,8,["show"]),l(Pe,{show:$.value,title:"View All Leads",onClose:T[14]||(T[14]=W=>$.value=!1)},null,8,["show"]),l(Pe,{show:v.value,title:"View All Opportunities",onClose:T[15]||(T[15]=W=>v.value=!1)},null,8,["show"]),l(Pe,{show:c.value,title:"View All Vehicles",onClose:T[16]||(T[16]=W=>c.value=!1)},null,8,["show"])]),_:1})):u("",!0)}},wg={class:"flex items-center gap-2"},$g={key:0,class:"space-y-3 animate-pulse"},Cg={key:1,class:"space-y-2"},Ag=["onClick"],Ig={class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0"},Sg={class:"text-xs font-semibold text-primary"},Tg={class:"flex-1 min-w-0"},Dg={class:"flex items-center gap-2 mb-0.5"},jg={class:"text-sm font-medium text-foreground truncate"},qg={key:0,class:"text-xs text-muted-foreground truncate"},Vg={class:"flex items-center gap-3 mt-1"},Mg={key:0,class:"flex items-center gap-1 text-xs text-muted-foreground"},Og={class:"truncate max-w-32"},Lg={key:1,class:"flex items-center gap-1 text-xs text-muted-foreground"},Eg={class:"truncate"},Ng={key:2,class:"text-center py-6 text-muted-foreground"},Pg={__name:"RelatedContactsWidget",props:{relatedContacts:{type:Array,default:()=>[]},masterContactId:{type:[Number,String],default:null},currentContactId:{type:[Number,String],default:null},accountData:{type:Object,default:null},loading:{type:Boolean,default:!1}},setup(t){const o=t,m=Ve(),A=v=>o.masterContactId?String(v)===String(o.masterContactId):!1,j=v=>{if(!v)return"?";const c=v.trim().split(" ");return c.length>=2?(c[0][0]+c[c.length-1][0]).toUpperCase():v.substring(0,2).toUpperCase()},$=v=>{v&&String(v)!==String(o.currentContactId)&&m.push({path:`/customer/${v}`,query:{type:"contact"}})};return(v,c)=>t.accountData||t.loading?(s(),P(a(We),{key:0,class:"h-full"},{default:k(()=>[l(a(_e),null,{default:k(()=>[e("div",wg,[l(a(Ft),{class:"w-4 h-4 text-foreground"}),l(a(it),{class:"text-sm font-semibold leading-5"},{default:k(()=>[...c[0]||(c[0]=[M("Related Contacts",-1)])]),_:1})])]),_:1}),l(a(ze),null,{default:k(()=>[t.loading?(s(),n("div",$g,[(s(),n(G,null,ee(3,w=>e("div",{key:`skeleton-${w}`,class:"flex items-center gap-3 p-3"},[...c[1]||(c[1]=[e("div",{class:"w-10 h-10 bg-muted rounded-full"},null,-1),e("div",{class:"flex-1 space-y-2"},[e("div",{class:"h-4 bg-muted rounded w-3/4"}),e("div",{class:"h-3 bg-muted rounded w-1/2"})],-1)])])),64))])):t.relatedContacts&&t.relatedContacts.length>0?(s(),n("div",Cg,[(s(!0),n(G,null,ee(t.relatedContacts,w=>(s(),n("div",{key:w.id,onClick:b=>$(w.id),class:"flex items-center gap-3 p-3 hover:bg-muted transition-colors rounded-md cursor-pointer group"},[e("div",Ig,[e("span",Sg,f(w.initials||j(w.name)),1)]),e("div",Tg,[e("div",Dg,[e("span",jg,f(w.name),1),A(w.id)?(s(),P(a(pe),{key:0,variant:"outline",class:"text-xs px-1.5 py-0"},{default:k(()=>[l(a(dn),{class:"w-3 h-3 mr-1"}),c[2]||(c[2]=M(" Master ",-1))]),_:1})):u("",!0)]),w.jobTitle||w.title?(s(),n("div",qg,f(w.jobTitle||w.title),1)):u("",!0),e("div",Vg,[w.email?(s(),n("div",Mg,[l(a(lt),{class:"w-3 h-3"}),e("span",Og,f(w.email),1)])):u("",!0),w.phone?(s(),n("div",Lg,[l(a(ot),{class:"w-3 h-3"}),e("span",Eg,f(w.phone),1)])):u("",!0)])]),l(a(ht),{class:"w-4 h-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})],8,Ag))),128))])):t.loading?u("",!0):(s(),n("div",Ng,[l(a(Ft),{class:"w-8 h-8 mx-auto mb-2 opacity-30"}),c[3]||(c[3]=e("p",{class:"text-xs"},"No related contacts found",-1))]))]),_:1})]),_:1})):u("",!0)}},Fg={class:"h-full flex flex-col overflow-hidden bg-surface"},Rg={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 auto-rows-min"},Bg={class:"h-auto"},Ug={class:"h-auto"},_g={key:0,class:"h-auto"},zg={key:1,class:"h-auto"},Wg={class:"lg:col-span-2 h-auto"},Hg={class:"lg:col-span-2 h-auto"},Yg={key:2,class:"lg:col-span-2 h-auto"},Gg={class:"flex flex-col gap-6 mb-6"},n1={__name:"CustomerProfile",props:{customerId:{type:Number,required:!0},customerType:{type:String,default:"contact",validator:t=>["contact","account"].includes(t)},showCloseButton:{type:Boolean,default:!1},closeOnConvert:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:o}){const m=t,A=o,j=Ve();Qa(),Xa();const $=en(),v=N(!1),c=N(!1),w=N(!1),b=N(!1),d=N(!1),i=N(!1),x=N(!1),D=N(!1),S=N(null),p=N(null),r=N(null),g=N([]),y=N([]),V=N([]),H=N([]),ae=N([]),le=N([]),te=N([]),re=I(()=>"contact"),E=I(()=>p.value||$.currentCustomer),se=I(()=>{var B,ke,we;if(!r.value||!p.value)return((B=p.value)==null?void 0:B.isMasterContact)===!0;const F=r.value.masterContactId||((ke=r.value.masterContact)==null?void 0:ke.id),Z=p.value.id||p.value.contactId;return F&&String(F)===String(Z)||((we=p.value)==null?void 0:we.isMasterContact)===!0}),xe=I(()=>{const F=E.value;return F?{...F,id:F.id,type:"contact",customer:{id:F.id,name:F.name,email:F.email,phone:F.phone,address:F.address||"",initials:F.initials},source:F.source||"Direct",tags:F.tags||[],stage:"Contact",assignee:null,assigneeId:null}:{id:null,type:"contact",summary:null,preferences:[],customer:{id:null,name:"",email:"",phone:"",address:"",initials:"?"},source:"Direct",tags:[],stage:"Contact",assignee:null,assigneeId:null}}),Ae=I(()=>{const F=new Date,Z=(te.value||[]).filter(B=>(B==null?void 0:B.start)&&new Date(B.start)>=F);return Z.sort((B,ke)=>new Date(B.start)-new Date(ke.start)),Z.length>0?Z[0]:null}),he=I(()=>null),J=I(()=>({currentActivities:I(()=>le.value),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),T=I(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),W=async()=>{var F,Z,B,ke;if(m.customerId)try{v.value=!0,b.value=!0,d.value=!0,i.value=!0,x.value=!0,D.value=!0;const[we,ue]=await Promise.all([$.fetchCustomerById(m.customerId,m.customerType).finally(()=>{v.value=!1}),Yn(m.customerId)]);p.value=we||$.currentCustomer,H.value=ue.data||[];const $e=((F=p.value)==null?void 0:F.accountId)||((Z=p.value)==null?void 0:Z.account_id);if($e)try{if(c.value=!0,r.value=await kn($e),((B=r.value)==null?void 0:B.type)==="Company"||((ke=r.value)==null?void 0:ke.accountType)==="Company")try{w.value=!0;const ce=await Gn($e);g.value=(ce.data||[]).filter(me=>me.id!==m.customerId)}catch(ce){console.error("Failed to load related contacts:",ce),g.value=[]}finally{w.value=!1}else g.value=[]}catch(ce){console.error("Failed to load account data:",ce),r.value=null,g.value=[]}finally{c.value=!1}else r.value=null,g.value=[];const[Ee,Ge,Ie]=await Promise.all([Kn(m.customerId,$e||null).finally(()=>{b.value=!1}),Qn(m.customerId,$e||null).finally(()=>{d.value=!1}),Jn($e||m.customerId).finally(()=>{i.value=!1})]);y.value=Ee.data||[],V.value=Ge.data||[],ae.value=Ie.data||[];const Se=[];for(const ce of y.value)try{const me=await xn(ce.id);Se.push(...me)}catch(me){console.error(`Failed to load activities for lead ${ce.id}:`,me)}for(const ce of V.value)try{const me=await hn(ce.id);Se.push(...me)}catch(me){console.error(`Failed to load activities for opportunity ${ce.id}:`,me)}le.value=Se,x.value=!1;try{te.value=await Hn(m.customerId)}catch(ce){console.error("Failed to load appointments:",ce),te.value=[]}finally{D.value=!1}}catch(we){console.error("Error loading customer data:",we),S.value=we.message||"Failed to load customer",v.value=!1,c.value=!1,w.value=!1,b.value=!1,d.value=!1,i.value=!1,x.value=!1,D.value=!1}},L=async F=>{try{await $.addRequestedCar(m.customerId,F),await W()}catch(Z){console.error("Error adding car to customer:",Z),S.value=Z.message||"Failed to add car"}},O=async()=>{try{b.value=!0;const F=await $.convertToLead(m.customerId);m.closeOnConvert&&A("close"),j.push({path:`/tasks/${F.id}`,query:{type:"lead"}})}catch(F){console.error("Error converting to lead:",F),S.value=F.message||"Failed to convert to lead",b.value=!1}},be=async()=>{try{d.value=!0;const F=await $.convertToOpportunity(m.customerId);m.closeOnConvert&&A("close"),j.push({path:`/tasks/${F.id}`,query:{type:"opportunity"}})}catch(F){console.error("Error converting to opportunity:",F),S.value=F.message||"Failed to convert to opportunity",d.value=!1}},fe=N(!1),Ce=N("lead"),Le=I(()=>{if(!E.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const F=E.value;return{id:F.id,name:F.name||"Unknown",email:F.email||"",phone:F.phone||"",initials:F.initials||"?"}}),Re=F=>{Ce.value=F,fe.value=!0},rt=async F=>{try{if(Ce.value==="lead"?b.value=!0:d.value=!0,fe.value=!1,!m.customerId)throw new Error("Customer ID not found");Ce.value==="lead"?await $.convertToLead(m.customerId):await $.convertToOpportunity(m.customerId),await W()}catch(Z){console.error(`Error adding ${Ce.value}:`,Z),S.value=Z.message||`Failed to add ${Ce.value}`,Ce.value==="lead"?b.value=!1:d.value=!1}},He=async()=>{await W()},Ye=async()=>{await W()};return wt(async()=>{await W()}),qe(()=>m.customerId,F=>{F&&W()}),(F,Z)=>(s(),n("div",Fg,[l(ic,{task:xe.value,type:re.value,"management-widget":he.value,"store-adapter":J.value,"add-new-config":T.value,"show-close-button":t.showCloseButton,onClose:Z[2]||(Z[2]=B=>F.$emit("close")),onCarAdded:L,onConvertToLead:O,onConvertToOpportunity:be,onTagUpdated:He,onAppointmentCreated:Ye},{"pinned-extra":k(({task:B})=>{var ke,we,ue,$e,Ee,Ge,Ie,Se,ce,me,Ke,dt,ut,$t,ct,Qe,mt,Me,Ct,ft,At,It,St,Tt,Dt,jt,qt,Vt,Mt,Oe,vt,pt,Ot,Lt,Et,Nt,h,C,R,U,Q,K,ne,q,Y,ve,Be,yt,Je,Ze,Pt,gt,xt,Te,De,ss,as,ns,ls,os,is,rs,ds,us,cs,ms,fs,vs,ps,ys,gs,xs,hs,bs,ks,ws,$s,Cs,As,Is,Ss,Ts,Ds,js,qs,Vs,Ms,Os,Ls,Es,Ns,Ps,Fs,Rs,Bs,Us,_s,zs,Ws,Hs,Ys,Gs,Ks,Qs,Js,Zs,Xs,ea,ta,sa,aa,na,la,oa,ia,ra,da,ua,ca,ma,fa,va,pa,ya,ga,xa,ha,ba,ka,wa,$a,Ca,Aa,Ia,Sa,Ta,Da,ja,qa,Va,Ma,Oa,La;return[e("div",Rg,[e("div",Bg,[l(Qv,{name:((ke=p.value)==null?void 0:ke.name)||((we=B==null?void 0:B.customer)==null?void 0:we.name)||"","first-name":((ue=p.value)==null?void 0:ue.firstName)||"","last-name":(($e=p.value)==null?void 0:$e.lastName)||"",initials:((Ee=p.value)==null?void 0:Ee.initials)||((Ge=B==null?void 0:B.customer)==null?void 0:Ge.initials)||"",title:((Ie=p.value)==null?void 0:Ie.title)||((Se=p.value)==null?void 0:Se.salutation)||"",salutation:((ce=p.value)==null?void 0:ce.salutation)||((me=p.value)==null?void 0:me.title)||"","job-title":((Ke=p.value)==null?void 0:Ke.jobTitle)||"","birth-date":((dt=p.value)==null?void 0:dt.birthDate)||"",gender:((ut=p.value)==null?void 0:ut.gender)||"","place-of-birth":(($t=p.value)==null?void 0:$t.placeOfBirth)||"",email:((ct=p.value)==null?void 0:ct.email)||((Qe=B==null?void 0:B.customer)==null?void 0:Qe.email)||"","secondary-email":((mt=p.value)==null?void 0:mt.secondaryEmail)||"",phone:((Me=p.value)==null?void 0:Me.phone)||((Ct=B==null?void 0:B.customer)==null?void 0:Ct.phone)||"","secondary-phone":((ft=p.value)==null?void 0:ft.secondaryPhone)||"","mobile-phone":((At=p.value)==null?void 0:At.mobilePhone)||"","preferred-contact-method":((It=p.value)==null?void 0:It.preferredContactMethod)||((St=p.value)==null?void 0:St.preferredChannel)||"","preferred-channel":((Tt=p.value)==null?void 0:Tt.preferredChannel)||"",address:((Dt=p.value)==null?void 0:Dt.address)||((jt=B==null?void 0:B.customer)==null?void 0:jt.address)||"","street-address1":((qt=p.value)==null?void 0:qt.streetAddress1)||((Vt=p.value)==null?void 0:Vt.streetAddress)||((Oe=(Mt=p.value)==null?void 0:Mt.address)==null?void 0:Oe.streetLine1)||"","street-address2":((vt=p.value)==null?void 0:vt.streetAddress2)||((Ot=(pt=p.value)==null?void 0:pt.address)==null?void 0:Ot.streetLine2)||"",city:((Lt=p.value)==null?void 0:Lt.city)||((Nt=(Et=p.value)==null?void 0:Et.address)==null?void 0:Nt.city)||"","postal-code":((h=p.value)==null?void 0:h.postalCode)||((C=p.value)==null?void 0:C.zipCode)||((U=(R=p.value)==null?void 0:R.address)==null?void 0:U.postalCode)||"",region:((Q=p.value)==null?void 0:Q.region)||((K=p.value)==null?void 0:K.state)||((ne=p.value)==null?void 0:ne.county)||((Y=(q=p.value)==null?void 0:q.address)==null?void 0:Y.region)||"",country:((ve=p.value)==null?void 0:ve.country)||((yt=(Be=p.value)==null?void 0:Be.address)==null?void 0:yt.country)||"","contact-custom-fields":((Je=p.value)==null?void 0:Je.customFields)||((Ze=p.value)==null?void 0:Ze.contactCustomFields)||{},"external-id":((Pt=p.value)==null?void 0:Pt.externalId)||((gt=p.value)==null?void 0:gt.contactExternalId)||"","created-at":((xt=p.value)==null?void 0:xt.createdAt)||((Te=p.value)==null?void 0:Te.createdDate)||"","created-date":((De=p.value)==null?void 0:De.createdDate)||((ss=p.value)==null?void 0:ss.createdAt)||"","updated-at":((as=p.value)==null?void 0:as.updatedAt)||((ns=p.value)==null?void 0:ns.lastUpdatedDate)||((ls=p.value)==null?void 0:ls.lastContact)||"","last-updated-date":((os=p.value)==null?void 0:os.lastUpdatedDate)||((is=p.value)==null?void 0:is.updatedAt)||"","last-activity-date":((rs=p.value)==null?void 0:rs.lastActivityDate)||"","is-master-contact":se.value,"account-name":((ds=r.value)==null?void 0:ds.name)||((us=r.value)==null?void 0:us.companyName)||"",loading:v.value},null,8,["name","first-name","last-name","initials","title","salutation","job-title","birth-date","gender","place-of-birth","email","secondary-email","phone","secondary-phone","mobile-phone","preferred-contact-method","preferred-channel","address","street-address1","street-address2","city","postal-code","region","country","contact-custom-fields","external-id","created-at","created-date","updated-at","last-updated-date","last-activity-date","is-master-contact","account-name","loading"])]),e("div",Ug,[l(qm,{summary:(B==null?void 0:B.summary)||((cs=p.value)==null?void 0:cs.summary),preferences:(B==null?void 0:B.preferences)||((ms=p.value)==null?void 0:ms.preferences),"customer-data":p.value,loading:v.value},null,8,["summary","preferences","customer-data","loading"])]),r.value&&r.value.type==="Company"?(s(),n("div",_g,[l(kg,{"account-data":r.value,"current-contact-id":t.customerId,"account-status":((fs=r.value)==null?void 0:fs.status)||((vs=r.value)==null?void 0:vs.accountStatus)||"Active","company-website":((ps=r.value)==null?void 0:ps.website)||((ys=r.value)==null?void 0:ys.companyWebsite)||"","company-phone":((gs=r.value)==null?void 0:gs.companyPhone)||((xs=r.value)==null?void 0:xs.phone)||"","company-email":((hs=r.value)==null?void 0:hs.companyEmail)||((bs=r.value)==null?void 0:bs.email)||"","company-address":((ks=r.value)==null?void 0:ks.companyAddress)||((ws=r.value)==null?void 0:ws.address)||"","company-street-address1":((Cs=($s=r.value)==null?void 0:$s.companyAddress)==null?void 0:Cs.streetLine1)||((As=r.value)==null?void 0:As.streetAddress1)||((Is=r.value)==null?void 0:Is.companyStreetAddress)||((Ts=(Ss=r.value)==null?void 0:Ss.address)==null?void 0:Ts.streetLine1)||(typeof((Ds=r.value)==null?void 0:Ds.address)=="string"?(qs=(js=r.value)==null?void 0:js.address)==null?void 0:qs.split(",")[0]:"")||"","company-street-address2":((Ms=(Vs=r.value)==null?void 0:Vs.companyAddress)==null?void 0:Ms.streetLine2)||((Os=r.value)==null?void 0:Os.streetAddress2)||((Es=(Ls=r.value)==null?void 0:Ls.address)==null?void 0:Es.streetLine2)||"","company-city":((Ps=(Ns=r.value)==null?void 0:Ns.companyAddress)==null?void 0:Ps.city)||((Fs=r.value)==null?void 0:Fs.city)||((Rs=r.value)==null?void 0:Rs.companyCity)||((Us=(Bs=r.value)==null?void 0:Bs.address)==null?void 0:Us.city)||"","company-postal-code":((zs=(_s=r.value)==null?void 0:_s.companyAddress)==null?void 0:zs.postalCode)||((Ws=r.value)==null?void 0:Ws.postalCode)||((Hs=r.value)==null?void 0:Hs.zipCode)||((Ys=r.value)==null?void 0:Ys.companyPostalCode)||((Ks=(Gs=r.value)==null?void 0:Gs.address)==null?void 0:Ks.postalCode)||"","company-region":((Js=(Qs=r.value)==null?void 0:Qs.companyAddress)==null?void 0:Js.region)||((Zs=r.value)==null?void 0:Zs.region)||((Xs=r.value)==null?void 0:Xs.state)||((ea=r.value)==null?void 0:ea.county)||((ta=r.value)==null?void 0:ta.companyRegion)||((aa=(sa=r.value)==null?void 0:sa.address)==null?void 0:aa.region)||"","company-country":((la=(na=r.value)==null?void 0:na.companyAddress)==null?void 0:la.country)||((oa=r.value)==null?void 0:oa.country)||((ia=r.value)==null?void 0:ia.companyCountry)||((da=(ra=r.value)==null?void 0:ra.address)==null?void 0:da.country)||"","fiscal-entity":((ua=r.value)==null?void 0:ua.fiscalEntity)||((ca=r.value)==null?void 0:ca.fiscalEntityName)||"","account-external-id":((ma=r.value)==null?void 0:ma.externalId)||((fa=r.value)==null?void 0:fa.accountExternalId)||"","account-custom-fields":((va=r.value)==null?void 0:va.customFields)||((pa=r.value)==null?void 0:pa.accountCustomFields)||{},"account-created-at":((ya=r.value)==null?void 0:ya.createdAt)||((ga=r.value)==null?void 0:ga.createdDate)||"","created-date":((xa=r.value)==null?void 0:xa.createdDate)||((ha=r.value)==null?void 0:ha.createdAt)||"","account-updated-at":((ba=r.value)==null?void 0:ba.updatedAt)||((ka=r.value)==null?void 0:ka.lastUpdatedDate)||((wa=r.value)==null?void 0:wa.lastContact)||"","last-updated-date":(($a=r.value)==null?void 0:$a.lastUpdatedDate)||((Ca=r.value)==null?void 0:Ca.updatedAt)||"","last-activity":((Aa=r.value)==null?void 0:Aa.lastActivity)||((Ia=r.value)==null?void 0:Ia.lastActivityDate)||((Sa=r.value)==null?void 0:Sa.lastContact)||"","last-activity-date":((Ta=r.value)==null?void 0:Ta.lastActivityDate)||((Da=r.value)==null?void 0:Da.lastActivity)||"","related-contacts-count":g.value.length,"related-leads-count":y.value.length,"related-opportunities-count":V.value.length,"related-vehicles-count":ae.value.length,"account-tags":((ja=r.value)==null?void 0:ja.tags)||[],"payment-terms":((qa=r.value)==null?void 0:qa.paymentTerms)||"","credit-limit":((Va=r.value)==null?void 0:Va.creditLimit)||"",loading:c.value},null,8,["account-data","current-contact-id","account-status","company-website","company-phone","company-email","company-address","company-street-address1","company-street-address2","company-city","company-postal-code","company-region","company-country","fiscal-entity","account-external-id","account-custom-fields","account-created-at","created-date","account-updated-at","last-updated-date","last-activity","last-activity-date","related-contacts-count","related-leads-count","related-opportunities-count","related-vehicles-count","account-tags","payment-terms","credit-limit","loading"])])):u("",!0),r.value&&r.value.type==="Company"?(s(),n("div",zg,[l(Pg,{"related-contacts":g.value,"master-contact-id":((Ma=r.value)==null?void 0:Ma.masterContactId)||((La=(Oa=r.value)==null?void 0:Oa.masterContact)==null?void 0:La.id),"current-contact-id":t.customerId,"account-data":r.value,loading:w.value},null,8,["related-contacts","master-contact-id","current-contact-id","account-data","loading"])])):u("",!0),e("div",Wg,[l(Um,{leads:y.value,opportunities:V.value,activities:le.value,loading:b.value||d.value||x.value},null,8,["leads","opportunities","activities","loading"])]),e("div",Hg,[l(xf,{"next-appointment":Ae.value,activities:le.value,leads:y.value,opportunities:V.value,"customer-id":t.customerId,loading:x.value||D.value||b.value||d.value},null,8,["next-appointment","activities","leads","opportunities","customer-id","loading"])]),ae.value.length>0||i.value?(s(),n("div",Yg,[l(bm,{cars:ae.value},null,8,["cars"])])):u("",!0)])]}),"tab-negotiations":k(()=>[e("div",Gg,[l(Ac,{leads:y.value,"all-tasks":H.value,loading:b.value,onAddLead:Z[0]||(Z[0]=B=>Re("lead"))},null,8,["leads","all-tasks","loading"]),l(zc,{opportunities:V.value,"all-tasks":H.value,activities:le.value,loading:d.value,onAddOpportunity:Z[1]||(Z[1]=B=>Re("opportunity"))},null,8,["opportunities","all-tasks","activities","loading"])])]),"tab-appointments":k(()=>[l(im,{appointments:te.value,loading:D.value},null,8,["appointments","loading"])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config","show-close-button"]),E.value?(s(),P(wm,{key:0,show:fe.value,type:Ce.value,contact:Le.value,onClose:Z[3]||(Z[3]=B=>fe.value=!1),onSave:rt},null,8,["show","type","contact"])):u("",!0)]))}};export{n1 as _};
