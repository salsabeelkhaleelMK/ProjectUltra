import{H as Ae,I as Te,J as _e,c as F,r as U,K as De,d as C,o as b,g as N,p as ae,e as u,w as le,F as J,i as X,t as O,n as z,k as ge,L as et,s as E,B as j,T as we,M as fe,l as se,y as M,N as tt,x as Z,O as ee,P as oe,Q as I,u as Ie,C as st,R as nt,m as at,j as lt,h as rt,S as ke}from"./index-D8nDSNmq.js";import{u as ot}from"./opportunities-D1cnNxBd.js";import{u as Le}from"./users-CPXYaoWs.js";import{n as re,z as pe}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import{L as it,O as ut,g as ye,f as ct,a as dt,b as pt,c as Me,d as Ne,e as gt}from"./opportunityRules-DnV0W7Tj.js";import{y as ft}from"./components-Y9EE84YM.js";import{u as yt,a as Ce,T as Se,D as mt}from"./useTaskFilters-HhfZSEQ8.js";import{_ as vt}from"./ReassignUserModal-ChhlJNp9.js";import"./sparkles-BOzuQ2gU.js";import"./vehicles-CxdEy1So.js";import"./CreateEventModal-Dcf8GuUu.js";import"./EditEventModal-DbD5QLnE.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=Ae("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Ae("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function ht(e){if(!e)return null;if(e.title)return e.title;const m=e.type||(e.customer?"opportunity":"lead"),a=Te(e,m);if(m==="lead"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const x=it[a];if(!x||!x.primaryAction)return null;const s=x.primaryAction,f=typeof s=="function"?s({lead:e,displayStage:a}):s;return f&&(f.label||f.title)||null}if(m==="opportunity"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const x=ut[a];if(!x||!x.primaryAction)return null;const s=x.primaryAction,f=typeof s=="function"?s({deliverySubstatus:e.deliverySubstatus||_e(e,e.activities||[]),hasOffers:!!(e.offers&&e.offers.length>0)||!!(e.activities&&e.activities.some(v=>v.type==="offer")),scheduledAppointment:e.scheduledAppointment,formatDateTime:v=>new Date(v).toLocaleDateString()}):s;return f&&(f.label||f.title)||null}return null}const bt=["onClick"],xt={class:"flex flex-col min-w-0 flex-1 pr-4"},wt={class:"flex items-center gap-1 mb-0.5"},kt={key:0,class:"font-bold text-heading text-fluid-base truncate"},Ct={class:"flex items-center gap-2 overflow-hidden"},St={class:"text-sub text-fluid-sm truncate"},$t={class:"flex flex-wrap items-center gap-2 mt-2"},At={key:2,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},Tt={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(e,{emit:m}){const a=e,x=F(()=>a.item.compositeId||`${a.item.type||"task"}-${a.item.id}`||a.item.id),s=F(()=>a.selected),f=F(()=>s.value?typeof a.selectedClass=="function"?a.selectedClass(a.item):a.selectedClass:typeof a.unselectedClass=="function"?a.unselectedClass(a.item):a.unselectedClass),v=i=>i?i.stage||i.currentStage||"New":"",d=i=>{if(!i||i.type!=="opportunity")return null;try{return Te(i,"opportunity")}catch{return i.displayStage||i.stage||null}},p=i=>i?i.type==="opportunity"?d(i)||i.stage||i.currentStage||"New":i.stage||i.currentStage||i.displayStage||"New":"",y=i=>{if(!i||i.type!=="opportunity")return!1;const c=v(i),S=d(i);return S&&c&&S!==c},n=(i,c="opportunity")=>{if(!i)return"bg-gray-50 text-gray-700 border-gray-200";try{const S=et(i,c);return S.includes("blue")?S+" border-blue-200":S.includes("purple")?S+" border-purple-200":S.includes("yellow")?S+" border-yellow-200":S.includes("pink")?S+" border-pink-200":S.includes("indigo")?S+" border-indigo-200":S.includes("emerald")?S+" border-emerald-200":S.includes("green")?S+" border-green-200":S.includes("red")?S+" border-red-200":(S.includes("gray"),S+" border-gray-200")}catch{const A=i.toLowerCase();return A.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":A.includes("qualif")?"bg-green-50 text-green-600 border-green-200":A.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":A.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}},o=F(()=>{const i=a.item;if(!i)return"bg-gray-50 text-gray-700 border-gray-200";if(i.type==="opportunity"){const S=d(i)||v(i);return n(S,"opportunity")}const c=p(i).toLowerCase();return c.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":c.includes("qualif")?"bg-green-50 text-green-600 border-green-200":c.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":c.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"}),k=F(()=>ht(a.item)),$=F(()=>{const i=a.item.nextActionDue||a.item.dueDate;if(!i)return null;const c=ye(i);return{text:ct(i),status:c}}),D=F(()=>$.value?$.value.status.textClass.replace("text-","bg-"):""),P=U(null);return(i,c)=>{const S=De("click-outside");return b(),C("div",{ref_key:"cardRef",ref:P,onClick:c[2]||(c[2]=A=>i.$emit("select",x.value)),class:z(["bg-white rounded-xl p-4 flex items-center justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-all border group",f.value])},[e.showMenu?(b(),C("button",{key:0,onClick:c[0]||(c[0]=le(A=>i.$emit("menu-click",e.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 z-10"},[...c[3]||(c[3]=[u("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):N("",!0),e.openMenuId===e.item.id&&e.showMenu?ae((b(),C("div",{key:1,class:"absolute right-2 top-7 z-50 w-40 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:c[1]||(c[1]=le(()=>{},["stop"]))},[(b(!0),C(J,null,X(e.menuItems,A=>(b(),C("button",{key:A.key,onClick:A.onClick,class:"w-full px-3 py-2 text-left text-xs text-heading hover:bg-surfaceSecondary flex items-center gap-2"},O(A.label),9,bt))),128))])),[[S,()=>i.$emit("menu-close")]]):N("",!0),u("div",xt,[u("div",wt,[k.value?(b(),C("h3",kt,O(k.value),1)):N("",!0),$.value?(b(),C("span",{key:1,class:z(["flex items-center gap-1 text-[10px] font-bold uppercase leading-none shrink-0",$.value.status.textClass])},[u("span",{class:z(["w-1.5 h-1.5 rounded-full",D.value])},null,2),ge(" "+O($.value.text),1)],2)):N("",!0)]),u("div",Ct,[u("span",St,O(e.getName(e.item)),1)]),u("div",$t,[u("span",{class:z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",e.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},O(e.item.type==="lead"?"Lead":"Opportunity"),3),e.item.type==="opportunity"&&y(e.item)?(b(),C(J,{key:0},[u("span",{class:z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",n(v(e.item),"opportunity")])},O(v(e.item)),3),u("span",{class:z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",n(d(e.item),"opportunity")])},O(d(e.item)),3)],64)):p(e.item)?(b(),C("span",{key:1,class:z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",o.value])},O(p(e.item)),3)):N("",!0),e.item.priority==="Hot"?(b(),C("span",At," Hot ")):N("",!0)])])],2)}}},Dt={key:0,class:"flex flex-col gap-2"},It={class:"flex items-center gap-1.5 flex-wrap"},Lt={class:"relative",ref:"filterContainer"},Mt={key:0,class:"filter-indicator"},Nt=["onClick"],Ft=["onClick"],Ot={key:0,class:"flex items-center gap-1.5 flex-wrap"},qt=["onClick"],Bt={key:0,class:"task-filter-badge"},Ut={key:1,class:"relative",ref:"filterContainer"},Rt={key:0,class:"filter-indicator"},Ht=["onClick"],Vt=["onClick"],Wt={key:2,class:"flex items-center gap-1.5 flex-wrap"},zt=["onClick"],Et={key:0,class:"task-filter-badge"},$e={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:"recent-first"},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(e,{emit:m}){const a=e,x=m,s=U(!1),f=()=>{s.value=!s.value},v=()=>{s.value=!1},d=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],p=i=>{const c=d.find(S=>S.key===i);return c?c.label:i},y=i=>{s.value=!1;const c=[...a.activeFilters],S=c.indexOf(i);S>-1?c.splice(S,1):c.push(i),x("filter-change",c)},n=i=>{const c=[...a.activeFilters],S=c.indexOf(i);S>-1&&(c.splice(S,1),x("filter-change",c))},o=i=>{s.value=!1,x("sort-change",i)},k=()=>{x("sort-change","recent-first")},$=F(()=>{const i=a.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First"},...i?[{key:"urgent-first",label:"Urgent first"}]:[],{key:"assigned-to-me",label:"Assigned to me"},{key:"assigned-to-my-team",label:"Assigned to my team"}]}),D=F(()=>a.sortOption&&a.sortOption!==""),P=F(()=>{const i=$.value.find(c=>c.key===a.sortOption);return i?i.label:a.sortOption});return(i,c)=>{const S=De("click-outside");return!e.buttonOnly&&!e.chipsOnly?(b(),C("div",Dt,[u("div",It,[ae((b(),C("div",Lt,[u("button",{onClick:f,class:"filter-dropdown-button"},[c[2]||(c[2]=u("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(b(),C("span",Mt)):N("",!0)]),E(we,{name:"dropdown-fade"},{default:j(()=>[s.value?(b(),C("div",{key:0,class:"absolute left-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:c[0]||(c[0]=le(()=>{},["stop"]))},[(b(),C(J,null,X(d,A=>u("button",{key:A.key,onClick:Y=>y(A.key),class:z(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes(A.key)}])},[u("span",null,O(A.label),1)],10,Nt)),64)),c[3]||(c[3]=u("div",{class:"border-t border-black/10 my-1"},null,-1)),(b(!0),C(J,null,X($.value,A=>(b(),C("button",{key:A.key,onClick:Y=>o(A.key),class:z(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":A.key===e.sortOption}])},[u("span",null,O(A.label),1)],10,Ft))),128))])):N("",!0)]),_:1})])),[[S,v]]),e.activeFilters.length>0||D.value?(b(),C("div",Ot,[(b(!0),C(J,null,X(e.activeFilters,A=>(b(),C("div",{key:A,class:"task-filter-badge"},[u("span",null,O(p(A)),1),u("button",{onClick:Y=>n(A),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...c[4]||(c[4]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])],8,qt)]))),128)),D.value?(b(),C("div",Bt,[u("span",null,O(P.value),1),u("button",{onClick:k,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...c[5]||(c[5]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])])])):N("",!0)])):N("",!0)])])):e.buttonOnly?ae((b(),C("div",Ut,[u("button",{onClick:f,class:"filter-dropdown-button"},[c[6]||(c[6]=u("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(b(),C("span",Rt)):N("",!0)]),E(we,{name:"dropdown-fade"},{default:j(()=>[s.value?(b(),C("div",{key:0,class:"absolute right-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:c[1]||(c[1]=le(()=>{},["stop"]))},[(b(),C(J,null,X(d,A=>u("button",{key:A.key,onClick:Y=>y(A.key),class:z(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes(A.key)}])},[u("span",null,O(A.label),1)],10,Ht)),64)),c[7]||(c[7]=u("div",{class:"border-t border-black/10 my-1"},null,-1)),(b(!0),C(J,null,X($.value,A=>(b(),C("button",{key:A.key,onClick:Y=>o(A.key),class:z(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":A.key===e.sortOption}])},[u("span",null,O(A.label),1)],10,Vt))),128))])):N("",!0)]),_:1})])),[[S,v]]):e.chipsOnly&&(e.activeFilters.length>0||D.value)?(b(),C("div",Wt,[(b(!0),C(J,null,X(e.activeFilters,A=>(b(),C("div",{key:A,class:"task-filter-badge"},[u("span",null,O(p(A)),1),u("button",{onClick:Y=>n(A),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...c[8]||(c[8]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])],8,zt)]))),128)),D.value?(b(),C("div",Et,[u("span",null,O(P.value),1),u("button",{onClick:k,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...c[9]||(c[9]=[u("i",{class:"fa-solid fa-xmark"},null,-1)])])])):N("",!0)])):N("",!0)}}},jt={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},Pt={class:"page-header shrink-0"},Qt={class:"page-header-main"},Kt={class:"page-header-content"},Yt={class:"page-header-title-container"},Gt={class:"page-header-title"},Jt={class:"page-header-actions"},Xt={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},Zt={class:"px-5 py-3"},_t={class:"flex items-center gap-2"},es={class:"relative flex-1"},ts=["placeholder"],ss={key:0,class:"mt-2"},ns={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:e=>e.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(e,{emit:m}){const a=e,x=m,s=U(a.initialSearchQuery),f=U(null),v=U("recent-first");se(()=>a.initialSearchQuery,n=>{s.value=n});const d=F(()=>{let n=a.items;const o=a.activeFilters.filter($=>$==="lead"||$==="opportunity");if(o.length>0&&(n=n.filter($=>!!($.type&&o.includes($.type)))),!s.value.trim())return n;const k=s.value.toLowerCase().trim();return n.filter($=>{const D=a.getName($).toLowerCase(),P=a.getVehicleInfo($).toLowerCase();return D.includes(k)||P.includes(k)})}),p=n=>a.selectedId?(n.compositeId||`${n.type||"task"}-${n.id}`)===a.selectedId:!1,y=n=>{v.value=n,x("sort-change",n)};return(n,o)=>(b(),C("div",jt,[u("header",Pt,[u("div",Qt,[u("div",Kt,[u("div",Yt,[u("h1",Gt,O(e.title),1)]),u("div",Jt,[u("div",Xt,[E(M(re),{variant:"secondary",size:"icon",onClick:o[0]||(o[0]=k=>n.$emit("view-change","card")),class:z(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:j(()=>[E(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"]),E(M(re),{variant:"secondary",size:"icon",onClick:o[1]||(o[1]=k=>n.$emit("view-change","table")),class:z(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:j(()=>[E(M(Oe),{size:14})]),_:1},8,["class","aria-pressed"])])])])])]),u("div",Zt,[u("div",_t,[u("div",es,[o[8]||(o[8]=u("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),ae(u("input",{"onUpdate:modelValue":o[2]||(o[2]=k=>s.value=k),type:"text",placeholder:e.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,ts),[[tt,s.value]])]),E($e,{"active-filters":e.activeFilters,"sort-option":v.value,"button-only":!0,onFilterChange:o[3]||(o[3]=k=>n.$emit("filter-change",k)),onSortChange:y},null,8,["active-filters","sort-option"])]),e.activeFilters.length>0?(b(),C("div",ss,[E($e,{"active-filters":e.activeFilters,"sort-option":v.value,"chips-only":!0,onFilterChange:o[4]||(o[4]=k=>n.$emit("filter-change",k)),onSortChange:y},null,8,["active-filters","sort-option"])])):N("",!0)]),u("div",{ref_key:"scrollContainer",ref:f,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(b(!0),C(J,null,X(d.value,k=>(b(),Z(Tt,{key:k.compositeId||`${k.type||"task"}-${k.id}`,item:k,selected:p(k),"selected-class":e.selectedClass,"unselected-class":e.unselectedClass,"show-menu":e.showMenu,"open-menu-id":e.openMenuId,getName:e.getName,getVehicleInfo:e.getVehicleInfo,"menu-items":e.getMenuItems?e.getMenuItems(k):null,onSelect:o[5]||(o[5]=$=>n.$emit("select",$)),onMenuClick:o[6]||(o[6]=$=>n.$emit("menu-click",$)),onMenuClose:o[7]||(o[7]=$=>n.$emit("menu-close"))},{location:j(({item:$})=>[ee(n.$slots,"location",{item:$},void 0,!0)]),source:j(({item:$})=>[ee(n.$slots,"source",{item:$},void 0,!0)]),owner:j(({item:$})=>[ee(n.$slots,"owner",{item:$},void 0,!0)]),dates:j(({item:$})=>[ee(n.$slots,"dates",{item:$},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},as=fe(ns,[["__scopeId","data-v-4410084b"]]);function qe(e,m=[],a,x){const s=oe(),f=s.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},v=s.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},d=ls(e,m),p=rs(e,m),y=os(e),n=is(e),o=f.intent+f.behavioral+f.temporal,k={intent:f.intent/o*100,behavioral:f.behavioral/o*100,temporal:f.temporal/o*100},$=d/40*k.intent,D=p/35*k.behavioral,P=y/25*k.temporal,i=Math.min(100,Math.max(0,$+D+P+n));let c="COLD";return i>=v.hot?c="HOT":i>=v.warm?c="WARM":i>=v.standard&&(c="STANDARD"),{score:Math.round(i*10)/10,level:c,breakdown:{intent:Math.round(d*10)/10,behavioral:Math.round(p*10)/10,temporal:Math.round(y*10)/10,quality:Math.round(n*10)/10,total:Math.round(i*10)/10}}}function ls(e,m){var x;let a=0;return(e.requestType==="Test Drive"||((x=e.scheduledAppointment)==null?void 0:x.type)==="test-drive"||m.some(s=>s.type==="test-drive"||s.type==="appointment"))&&(a=Math.max(a,40)),m.some(s=>s.type==="financing")&&(a=Math.max(a,35)),m.some(s=>s.type==="tradein")&&(a=Math.max(a,30)),(e.source==="Walk-in"||m.some(s=>{var f,v,d;return((f=s.content)==null?void 0:f.toLowerCase().includes("location"))||((v=s.content)==null?void 0:v.toLowerCase().includes("dealership"))||((d=s.content)==null?void 0:d.toLowerCase().includes("visit"))}))&&(a=Math.max(a,25)),e.requestedCar&&(e.requestedCar.requestMessage||m.some(s=>{var f,v;return((f=s.content)==null?void 0:f.toLowerCase().includes("configur"))||s.type==="attachment"&&((v=s.fileName)==null?void 0:v.toLowerCase().includes("config"))}))&&(a=Math.max(a,20)),m.some(s=>{var v;const f=((v=s.content)==null?void 0:v.toLowerCase())||"";return f.includes("compare")||f.includes("versus")||f.includes("vs")||f.includes("alternative")})&&(a=Math.max(a,15)),Math.min(a,40)}function rs(e,m){let a=0;const x=new Set(m.map(d=>{if(!d.timestamp)return null;const p=new Date(d.timestamp);return`${p.getFullYear()}-${p.getMonth()}-${p.getDate()}`}).filter(Boolean)),s=Math.min(x.size*10,35);a+=s,e.contactAttempts&&e.contactAttempts.length>1&&(a+=20);const f=m.reduce((d,p)=>{var y;return d+(((y=p.content)==null?void 0:y.length)||0)},0),v=Math.min(Math.floor(f/50),25);return a+=v,m.some(d=>{var p,y,n;return d.type==="attachment"&&(((p=d.fileName)==null?void 0:p.toLowerCase().includes("brochure"))||((y=d.fileName)==null?void 0:y.toLowerCase().includes("spec"))||((n=d.fileName)==null?void 0:n.toLowerCase().includes("pdf")))})&&(a+=15),Math.min(a,35)}function os(e){let m=0;if(!e.createdAt)return 0;const a=new Date,x=new Date(e.createdAt),s=(a.getTime()-x.getTime())/(1e3*60*60);s<2?m+=25:s<24?m+=15:s<48?m+=5:m-=10;const f=x.getDay(),v=x.getHours();if((f===0||f===6||v<9||v>17)&&(m+=10),e.contactAttempts&&e.contactAttempts.length===3&&(m+=50),e.lastActivity){const d=new Date(e.lastActivity);(a.getTime()-d.getTime())/(1e3*60*60*24)>3&&(m+=20)}return Math.min(Math.max(m,0),25)}function is(e){var a,x,s,f,v,d,p;let m=0;return(a=e.customer)!=null&&a.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer.email)&&(m+=10),(x=e.customer)!=null&&x.phone&&/^\+?[\d\s\-()]+$/.test(e.customer.phone)&&e.customer.phone.length>=10&&(m+=10),(s=e.customer)!=null&&s.name&&((f=e.customer)!=null&&f.email)&&((v=e.customer)!=null&&v.phone)&&((d=e.customer)!=null&&d.address)&&(m+=5),(e.isDuplicate||e.isDisqualified||!((p=e.customer)!=null&&p.name))&&(m-=20),m}function Be(e){switch(e){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Ue(e){switch(e){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function us({typeFilter:e,showTypeFilter:m,tasks:a}){return{filterDefinitions:F(()=>{const s=[];m.value&&s.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),s.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),s.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),e.value==="lead"&&s.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),s.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const f=[...new Set(a.value.map(d=>d.assignee).filter(Boolean))];f.length>0&&s.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:f.map(d=>({value:d,label:d})),aiHint:"Person assigned to the task",pinned:!0});const v=[...new Set(a.value.map(d=>{const p=d.type==="lead"?d.requestedCar:d.vehicle;return p==null?void 0:p.brand}).filter(Boolean))];return v.length>0&&s.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:v.map(d=>({value:d,label:d})),aiHint:"Car brand requested by customer"}),s.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),s})}}const cs={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},ds={class:"page-header shrink-0"},ps={class:"page-header-main"},gs={class:"page-header-content"},fs={class:"page-header-actions"},ys={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},ms={class:"flex-1 overflow-y-auto p-4 md:p-8"},vs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","toggle-closed","reassign","close","view-change"],setup(e,{emit:m}){const a=e,x=m,s=oe();U("");const f=U({pageIndex:0,pageSize:10}),v=U(""),d=U([]),p=U([]),y=U({}),{filterDefinitions:n}=us({typeFilter:F(()=>"all"),showTypeFilter:F(()=>!0),tasks:F(()=>a.tasks)}),o=F(()=>a.tasks),k=r=>r.compositeId===a.currentTaskId||r.compositeId===a.highlightId,$=r=>{if(r.type==="lead")return r.requestedCar?`${r.requestedCar.brand} ${r.requestedCar.model}`:"No vehicle specified";const l=r.vehicle||r.requestedCar;return l?`${l.brand} ${l.model}`:"No vehicle specified"},D=r=>{if(!r)return"Not set";const l=new Date,w=new Date(r),H=new Date(l.getFullYear(),l.getMonth(),l.getDate()),q=new Date(w.getFullYear(),w.getMonth(),w.getDate())-H,Q=Math.ceil(q/(1e3*60*60*24));return Q===0?"Today":Q===1?"Tomorrow":Q===-1?"Yesterday":Q>1&&Q<=7?`In ${Q} days`:Q<-1&&Q>=-7?`${Math.abs(Q)} days ago`:Me(r)},P=r=>{const l=r.type==="lead"?r.requestedCar:r.vehicle;if(!l)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const w=l.stockDays!==void 0&&l.stockDays!==null;return{status:w?"In Stock":"Out of Stock",class:w?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},i=r=>{var l;return r.type==="lead"?((l=r.requestedCar)==null?void 0:l.requestType)||r.requestType||"N/A":r.requestType||"Opportunity"},c=r=>{const l=r.type==="lead"?r.requestedCar:r.vehicle||r.requestedCar;return l==null?void 0:l.price},S=F(()=>[{id:"type",accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:r=>A(r.original)},cell:({row:r})=>{const l=r.original,w=l.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${w}`},l.type==="lead"?"Lead":"Opportunity")}},{id:"customer",accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:r})=>{const l=r.original;return I("div",{class:"flex items-center gap-2 md:gap-3"},[I("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${l.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},l.customer.initials),I("div",{class:"min-w-0"},[I("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},l.customer.name),I("div",{class:"text-meta truncate hidden sm:block"},l.customer.phone||"N/A")])])}},{id:"carInfo",accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:r})=>{const l=r.original,w=$(l),H=P(l),V=i(l),q=l.type==="lead"?l.requestedCar:l.vehicle||l.requestedCar;if(w==="No vehicle specified")return I("span",{class:"text-meta"},"N/A");const Q=q!=null&&q.condition?q.condition.charAt(0).toUpperCase()+q.condition.slice(1).toLowerCase():null,ne=q!=null&&q.kilometers?`${q.kilometers.toLocaleString()} km`:null,K=l.quotationNumber||l.quotation||null,W=V&&V!=="N/A"&&(V!=="Quotation"||K);return I("div",{class:"flex flex-col gap-1"},[I("div",{class:"flex items-center gap-2"},[I("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),I("span",{class:"text-content font-medium text-heading truncate max-w-32"},w)]),I("div",{class:"flex items-center gap-2 flex-wrap"},[I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${H.class}`},H.status),Q&&I("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},Q),ne&&I("span",{class:"text-meta text-xs"},ne),W&&I("span",{class:"text-meta text-xs"},V)])])}},{id:"dueDate",accessorKey:"nextActionDue",header:"Due Date",meta:{title:"Due Date"},cell:({row:r})=>{const w=r.original.nextActionDue;if(!w)return I("span",{class:"text-meta"},"Not set");const H=ye(w);return I("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${H.bgClass} ${H.textClass} ${H.borderClass}`},D(w))}},{id:"price",accessorKey:"price",accessorFn:r=>c(r)??0,header:"Price",meta:{title:"Price"},cell:({row:r})=>{const l=r.original,w=c(l);return w==null||w===""?I("span",{class:"text-meta"},"â€”"):I("span",{class:"text-content font-medium text-heading"},`â‚¬ ${dt(w)}`)}},{id:"source",accessorKey:"source",header:"Lead Source",meta:{title:"Lead Source"},cell:({row:r})=>{const l=r.original;return I("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},l.source||"N/A")}},{id:"contactAttempts",accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:r})=>{var H;const w=((H=r.original.contactAttempts)==null?void 0:H.length)||0;return I("span",{class:"text-content font-medium text-heading"},w)}},{id:"assignee",accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:r})=>{const l=r.original,w=a.getOwnerInfo(l);return I("div",{class:"flex items-center gap-2"},[I("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},w.initials),I("span",{class:"text-meta truncate max-w-20"},w.name)])}},{id:"createdAt",accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:r})=>{const l=r.original;return l.createdAt?I("span",{class:"text-meta"},pt(l.createdAt)):I("span",{class:"text-meta"},"N/A")}},{id:"status",accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:r})=>{const l=r.original,w=l.type==="lead"?l.status:l.displayStage||l.stage,H=a.getStageBadgeClass(w);return I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${H}`},w)}},...s.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:r})=>{const l=r.original;if(l.type!=="lead")return I("span",{class:"text-meta"},"â€”");let w=l.urgencyLevel;w||(w=qe(l).level);const H=Ue(w),V=Be(w);return I("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${H}`},[I("span",{},V),I("span",{},w)])}}]:[]]),A=r=>{v.value=String(r.id),x("select",r.compositeId)},Y=F(()=>({class:{tr:r=>{const l="cursor-pointer hover:bg-surfaceSecondary transition-colors",w=r.original;return k(w)?`${l} bg-blue-50 border-l-4 border-l-blue-500`:l}}}));return(r,l)=>(b(),C("div",cs,[u("header",ds,[u("div",ps,[u("div",gs,[l[9]||(l[9]=u("div",{class:"page-header-title-container"},[u("h1",{class:"page-header-title"},"Tasks")],-1)),u("div",fs,[u("div",ys,[E(M(re),{variant:"secondary",size:"icon",onClick:l[0]||(l[0]=w=>r.$emit("view-change","card")),class:z(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:j(()=>[E(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"]),E(M(re),{variant:"secondary",size:"icon",onClick:l[1]||(l[1]=w=>r.$emit("view-change","table")),class:z(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:j(()=>[E(M(Oe),{size:14})]),_:1},8,["class","aria-pressed"])]),u("button",{onClick:l[2]||(l[2]=w=>r.$emit("toggle-closed",!e.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...l[8]||(l[8]=[u("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),u("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),u("div",ms,[E(M(ft),{data:o.value,columns:S.value,meta:Y.value,onRowClick:A,columnFiltersOptions:{filterDefs:M(n)},pagination:f.value,"onUpdate:pagination":l[3]||(l[3]=w=>f.value=w),globalFilter:v.value,"onUpdate:globalFilter":l[4]||(l[4]=w=>v.value=w),sorting:d.value,"onUpdate:sorting":l[5]||(l[5]=w=>d.value=w),columnFilters:p.value,"onUpdate:columnFilters":l[6]||(l[6]=w=>p.value=w),columnVisibility:y.value,"onUpdate:columnVisibility":l[7]||(l[7]=w=>y.value=w),paginationOptions:{rowCount:o.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!1},class:"h-full"},{"empty-state":j(()=>[...l[10]||(l[10]=[u("div",{class:"empty-state"},[u("i",{class:"fa-solid fa-tasks empty-state-icon"}),u("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","columnVisibility","paginationOptions"])])]))}},hs=fe(vs,[["__scopeId","data-v-29cab866"]]),bs={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},xs={class:"px-4 py-3 flex items-center justify-between gap-3"},ws=["aria-label"],ks={key:0,class:"flex-1 flex items-center justify-center"},Cs={key:1,class:"flex items-center gap-2"},Ss={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(e,{emit:m}){const a=m,x=()=>{a("back")};return(s,f)=>e.show?(b(),C("div",bs,[u("div",xs,[u("button",{onClick:x,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":e.backLabel},[...f[0]||(f[0]=[u("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,ws),s.$slots.title?(b(),C("div",ks,[ee(s.$slots,"title")])):N("",!0),s.$slots.actions?(b(),C("div",Cs,[ee(s.$slots,"actions")])):N("",!0)])])):N("",!0)}};function $s(){const e=n=>{if(!n)return"No deadline";const o=ye(n);return o.type==="overdue"?"OVERDUE":o.type==="today"||o.type==="urgent"?o.relativeTime:Me(n)},m=n=>{const o=n.type==="lead"?n.requestedCar:n.vehicle;return!o||!o.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[o.type]||{type:o.type.toLowerCase(),label:o.type}},a=n=>n?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[n.type]||"bg-gray-50 text-gray-700":"",x=n=>{if(!n||!n.assignee)return{name:"Unassigned",initials:"?"};const o=n.assigneeInitials||n.assignee.split(" ").map(k=>k[0]).join("");return{name:n.assignee,initials:o}},s=n=>{if(!n||!n.customer||!n.customer.address)return null;const k=n.customer.address.split(",");return k.length>1&&k[k.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:e,getVehicleType:m,getVehicleTypeBadgeClass:a,getOwnerInfo:x,getCustomerCity:s,getLocationDisplay:n=>{const o=s(n),k=n.source||"Unknown";return o?`${o} â€¢ ${k}`:k},getAssigneeInitials:n=>{if(!n)return"?";const o=n.split(" ");return o.length>=2?(o[0][0]+o[o.length-1][0]).toUpperCase():n.substring(0,2).toUpperCase()},getVehicleStatusDisplay:n=>{const o=n.type==="lead"?n.requestedCar:n.vehicle;if(!o)return"No vehicle";const k=m(n),$=k?k.label:o.type||"Unknown";let D="";return o.kilometers!==void 0&&o.kilometers!==null&&(o.kilometers>=1e3?D=`${(o.kilometers/1e3).toFixed(0)}k`:D=`${o.kilometers}`),D?`${$} / ${D}`:$},getTaskStatusDisplay:n=>n.type==="lead"?n.status||"Unknown":n.stage||"Unknown",getStageBadgeClass:Ne,getUnselectedClass:n=>n.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function As(){const e=Ie(),m=Le(),a=oe();return{sortTasks:(s,f)=>{if(f==="none")return[...s].sort((v,d)=>{const p=new Date(v.lastActivity||v.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-p});if(f==="urgent-first")return a.getSetting("urgencyEnabled")!==!1?[...s.map(p=>{if(p.type==="lead"&&!p.urgencyScore){const y=qe(p);return{...p,urgencyScore:y.score,urgencyLevel:y.level}}return p})].sort((p,y)=>{if(p.type==="lead"&&y.type==="lead"){const k=p.urgencyScore||0,$=y.urgencyScore||0;if(k!==$)return $-k;const D=new Date(p.createdAt||0);return new Date(y.createdAt||0)-D}if(p.type==="lead"&&y.type==="opportunity")return-1;if(p.type==="opportunity"&&y.type==="lead")return 1;if(p.priority==="Hot"&&y.priority!=="Hot")return-1;if(p.priority!=="Hot"&&y.priority==="Hot")return 1;const n=new Date(p.lastActivity||p.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-n}):[...s].sort((d,p)=>{if(d.priority==="Hot"&&p.priority!=="Hot")return-1;if(d.priority!=="Hot"&&p.priority==="Hot")return 1;const y=new Date(d.lastActivity||d.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-y});if(f==="assigned-to-me"){const v=e.currentUser.name;return[...s.filter(p=>p.assignee===v)].sort((p,y)=>{const n=new Date(p.lastActivity||p.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-n})}if(f==="assigned-to-my-team"){const v=e.currentUser;let d=[];return v.role==="manager"?d=m.users.map(y=>y.name):v.role==="salesman"?d=m.users.filter(y=>y.role==="salesman").map(y=>y.name):v.role==="operator"&&(d=m.users.filter(y=>y.role==="operator").map(y=>y.name)),[...s.filter(y=>d.includes(y.assignee))].sort((y,n)=>{const o=new Date(y.lastActivity||y.createdAt||0);return new Date(n.lastActivity||n.createdAt||0)-o})}return s}}}const Ts={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Ds={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Is={key:0,class:"flex items-center gap-2"},Ls={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Ms={class:"text-gray-600 font-medium"},Ns={key:1},Fs={key:0},Os={key:1},qs={key:2},Bs={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Us={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Rs={__name:"Tasks",setup(e){const m=nt(),a=rt(),x=st(),s=ot(),f=Ie();Le();const v=oe(),{getDateDisplay:d,getVehicleType:p,getVehicleTypeBadgeClass:y,getOwnerInfo:n,getCustomerCity:o,getAssigneeInitials:k,getUnselectedClass:$}=$s(),D=U(localStorage.getItem("tasksViewMode")||"table"),P=U(""),i=F(()=>m.query.highlight||null);se(D,t=>{localStorage.setItem("tasksViewMode",t)});const c=(t,h="")=>{D.value;const T=W.value;if(D.value=t,t==="card"&&h&&(P.value=h),t==="table"&&T)P.value="",a.push({path:"/tasks",query:{highlight:T.compositeId}});else if(t==="card"&&i.value){const[R,g]=i.value.split("-");a.push({path:`/tasks/${g}`,query:{type:R}})}else t==="card"&&!i.value&&!W.value&&a.push({path:"/tasks"})},S=U(["opportunity"]),A=U("none"),Y=U(!1),r=U(null);U(!1);const l=U(!1),w=U(null),H=U(!1),V=U(null),{allTasks:q,applyFilters:Q}=yt(Y),{sortTasks:ne}=As(),K=F(()=>{let t=Q(q.value,S.value);return t=ne(t,A.value),t}),W=F(()=>{if(!m.params.id)return null;const t=parseInt(m.params.id);if(isNaN(t))return null;const h=m.query.type;if(h){const B=`${h}-${t}`;return q.value.find(te=>te.compositeId===B)||null}const T=S.value.filter(B=>B==="lead"||B==="opportunity"),R=T.length>0?q.value.filter(B=>T.includes(B.type)):q.value,g=`lead-${t}`,L=`opportunity-${t}`,G=R.find(B=>B.compositeId===g||B.compositeId===L);return G||q.value.find(B=>B.compositeId===g||B.compositeId===L)||null});F(()=>W.value?W.value.type==="lead"?x.currentLeadActivities:s.currentOpportunityActivities:[]);const ie=Ce(W),Re=ie.managementWidget,He=ie.storeAdapter,Ve=ie.addNewConfig,We=F(()=>V.value),ue=Ce(We),me=F(()=>ue.managementWidget.value),ve=F(()=>ue.storeAdapter.value),ze=F(()=>ue.addNewConfig.value),Ee=$;at(()=>{x.fetchLeads(),s.fetchOpportunities();const t=m.params.id;t&&he(t)}),se(()=>m.params.id,t=>{t&&he(t)}),se(W,t=>{t&&(t.type==="lead"?x.fetchLeadById(t.id):s.fetchOpportunityById(t.id))},{immediate:!0}),se(V,t=>{t&&(t.type==="lead"?x.fetchLeadById(t.id):s.fetchOpportunityById(t.id))},{immediate:!0});const he=t=>{const h=parseInt(t),T=q.value.find(R=>R.id===h);T&&(T.type==="lead"?x.fetchLeadById(h):s.fetchOpportunityById(h))},_=t=>{const[h,T]=t.split("-");if(D.value==="table"){const R=q.value.find(g=>g.compositeId===t);R&&(V.value=R,H.value=!0,R.type==="lead"?x.fetchLeadById(R.id):s.fetchOpportunityById(R.id));return}D.value="card",a.push({path:`/tasks/${T}`,query:{type:h}})},ce=()=>{if(H.value){de();return}a.push({path:"/tasks"})},de=()=>{H.value=!1,V.value=null},je=t=>{if(!W.value)return;const h=K.value.findIndex(T=>{const R=W.value.compositeId||`${W.value.type}-${W.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===R});if(h!==-1){if(t==="previous"&&h>0){const T=K.value[h-1];_(T.compositeId)}else if(t==="next"&&h<K.value.length-1){const T=K.value[h+1];_(T.compositeId)}}},Pe=t=>{if(!V.value)return;const h=K.value.findIndex(T=>{const R=V.value.compositeId||`${V.value.type}-${V.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===R});if(h!==-1){if(t==="previous"&&h>0){const T=K.value[h-1];_(T.compositeId)}else if(t==="next"&&h<K.value.length-1){const T=K.value[h+1];_(T.compositeId)}}},be=t=>{r.value=r.value===t?null:t},xe=t=>{w.value=t,l.value=!0,r.value=null},Qe=t=>{A.value=t},Ke=async t=>{if(!w.value)return;const h=w.value,T=t.name;h.type==="lead"?await x.updateLead(h.id,{assignee:T,assigneeType:t.type,teamId:t.type==="team"?t.id:null}):h.type==="opportunity"&&await s.updateOpportunity(h.id,{assignee:T,assigneeType:t.type,teamId:t.type==="team"?t.id:null}),l.value=!1,w.value=null},Ye=async t=>{r.value=null,t.type==="lead"?await x.updateLead(t.id,{priority:"Hot"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{priority:"Hot"})},Ge=async t=>{r.value=null,t.type==="lead"?await x.updateLead(t.id,{priority:"Normal"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{priority:"Normal"})},Je=async t=>{r.value=null;const h=f.user;h&&(t.type==="lead"?await x.updateLead(t.id,{assignee:h.name,assigneeType:"user"}):t.type==="opportunity"&&await s.updateOpportunity(t.id,{assignee:h.name,assigneeType:"user"}))},Xe=async t=>{if(r.value=null,t.type==="lead")try{const h=t.displayStage||t.stage||ke.NEW,T=ke.NEW,R=gt(h,T);if(R){const{updates:g,activities:L}=R(t);await x.updateLead(t.id,g);for(const G of L)await x.addActivity(t.id,G)}else await x.updateLead(t.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await x.addActivity(t.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await x.fetchLeadById(t.id)}catch(h){console.error("Failed to reopen lead:",h)}},Ze=t=>{var T;const h=[];return t.type==="lead"&&t.isDisqualified===!0&&h.push({key:"reopen",label:"Reopen Lead",onClick:()=>Xe(t)}),h.push({key:"reassign",label:"Reassign",onClick:()=>xe(t)}),t.assignee!==((T=f.user)==null?void 0:T.name)&&h.push({key:"assign-me",label:"Assign to me",onClick:()=>Je(t)}),t.priority!=="Hot"?h.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Ye(t)}):h.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Ge(t)}),h};return(t,h)=>{var T,R;return b(),C("div",Ts,[E(Ss,{show:!!W.value||D.value==="table"&&!!V.value,"back-label":"Back to task list",onBack:ce},null,8,["show"]),D.value==="card"?(b(),C("div",Ds,[u("div",{class:z(["flex flex-col overflow-hidden",W.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[E(as,{title:"Tasks",items:K.value,"selected-id":(T=W.value)==null?void 0:T.compositeId,"view-mode":D.value,"initial-search-query":P.value,onViewChange:c,"selected-class":g=>g.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":M(Ee),"open-menu-id":r.value,getName:g=>{const L=g.customer;return L&&L.name?L.name:L&&!L.name&&L.email&&L.email.split("@")[0]||"Unknown"},getInitials:g=>{const L=g.customer;return L&&L.initials?L.initials:L&&L.name&&L.name.split(" ").map(B=>B[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:g=>{if(g.type==="lead"){if(!g.requestedCar)return"No vehicle specified";const B=g.requestedCar,te=[`${B.brand} ${B.model}`];return B.kilometers!==void 0&&B.kilometers!==null&&te.push(`${B.kilometers} km`),B.status&&te.push(B.status),te.join(" â€¢ ")}const L=g.vehicle||g.requestedCar;if(!L)return"No vehicle specified";const G=[`${L.brand} ${L.model}`];return L.kilometers!==void 0&&L.kilometers!==null&&G.push(`${L.kilometers} km`),L.status&&G.push(L.status),G.join(" â€¢ ")},avatarClass:g=>g.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":Ze,"show-mobile-close":!1,onSelect:_,onMenuClick:be,onMenuClose:h[0]||(h[0]=g=>r.value=null),onClose:ce,"active-filters":S.value,onFilterChange:h[1]||(h[1]=g=>S.value=g),onSortChange:Qe},{badges:j(({item:g})=>[g&&g.type?(b(),Z(M(pe),{key:0,text:g.type==="lead"?"Lead":"Opportunity",size:"small",theme:g.type==="lead"?"blue":"gray"},null,8,["text","theme"])):N("",!0),g&&g.type==="lead"&&M(v).getSetting("urgencyEnabled")!==!1&&g.urgencyLevel?(b(),Z(M(pe),{key:1,text:`${M(Be)(g.urgencyLevel)} ${g.urgencyLevel}`,size:"small",class:z(M(Ue)(g.urgencyLevel))},null,8,["text","class"])):N("",!0),g&&g.priority==="Hot"&&(M(v).getSetting("urgencyEnabled")===!1||g.type!=="lead")?(b(),Z(M(pe),{key:2,text:"HOT",size:"small",theme:"red"})):N("",!0)]),location:j(({item:g})=>[ge(O(M(o)(g)||"Unknown"),1)]),source:j(({item:g})=>{var L;return[ge(O(g.source||((L=g.customer)==null?void 0:L.source)||"Unknown"),1)]}),owner:j(({item:g})=>[g.assignee?(b(),C("div",Is,[u("div",Ls,O(M(k)(g.assignee)),1),u("span",Ms,O(g.assignee),1)])):(b(),C("span",Ns,"Unassigned"))]),dates:j(({item:g})=>[g.type==="lead"&&g.nextActionDue?(b(),C("span",Fs,"Due: "+O(M(d)(g.nextActionDue)),1)):g.type==="opportunity"&&g.nextActionDue?(b(),C("span",Os,"Due: "+O(M(d)(g.nextActionDue)),1)):(b(),C("span",qs,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),W.value?(b(),Z(Se,{key:0,task:W.value,"management-widget":M(Re),"store-adapter":M(He),"add-new-config":M(Ve),"filtered-tasks":K.value,onTaskNavigate:je},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0),W.value?N("",!0):(b(),C("div",Bs,[...h[5]||(h[5]=[lt('<div class="flex-1 flex items-center justify-center p-8" data-v-7da87568><div class="text-center max-w-sm" data-v-7da87568><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-7da87568><i class="fa-solid fa-tasks text-2xl text-sub" data-v-7da87568></i></div><h3 class="text-content-bold mb-2" data-v-7da87568>No task selected</h3><p class="text-meta" data-v-7da87568>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):N("",!0),D.value==="table"?(b(),C("div",Us,[E(hs,{tasks:M(q),"current-task-id":(R=V.value)==null?void 0:R.compositeId,"highlight-id":i.value,"show-closed":Y.value,"show-mobile-close":!1,"open-menu-id":r.value,"get-vehicle-type":M(p),"get-vehicle-type-badge-class":M(y),"get-owner-info":M(n),"get-stage-badge-class":M(Ne),"view-mode":D.value,onSelect:_,onMenuClick:be,onMenuClose:h[2]||(h[2]=g=>r.value=null),onToggleClosed:h[3]||(h[3]=g=>Y.value=g),onReassign:xe,onClose:ce,onViewChange:c,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):N("",!0),D.value==="table"?(b(),Z(mt,{key:2,show:H.value,onClose:de},{default:j(()=>[V.value&&me.value&&ve.value?(b(),Z(Se,{key:0,task:V.value,"management-widget":me.value,"store-adapter":ve.value,"add-new-config":ze.value,"filtered-tasks":M(q),"is-drawer-view":!0,onTaskNavigate:Pe,onClose:de},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0)]),_:1},8,["show"])):N("",!0),E(vt,{show:l.value,onClose:h[4]||(h[4]=g=>l.value=!1),onConfirm:Ke},null,8,["show"])])}}},Xs=fe(Rs,[["__scopeId","data-v-7da87568"]]);export{Xs as default};
