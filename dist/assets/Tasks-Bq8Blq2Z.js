import{d as x,o as m,F as re,i as ce,n as j,e,_ as st,r as O,c as L,G as ot,g as D,s as I,w as Se,E as T,p as z,y as n,P as mt,T as yt,H as gt,I as X,t as S,k as F,l as ve,x as E,J as ae,K as _e,L as _,M as Nt,N as ft,j as Ke,O as se,R as $e,S as Qe,h as nt,D as He,u as je,m as Ge,v as we,Q as pe,U as Mt,V as Rt,W as Ue,X as Be,Y as et,z as Ye,Z as Ft,$ as Vt}from"./index-DqXOZZRa.js";import{u as Je}from"./opportunities-kOQOLZpi.js";import{u as Xe}from"./users-BeZFi7uU.js";import{y as Bt}from"./components-BWQMLLDb.js";import{u as Ie}from"./settings-B0uvb4uj.js";import{_ as Ut,a as Wt,g as jt,b as Et,c as Pt,i as Ht,d as zt,e as Qt,f as Yt}from"./ComingSoonModal-BGpcrLCR.js";import{f as We,a as Pe,g as vt,b as bt,c as ht,d as xt}from"./formatters-DjeI4Z8-.js";import{z as Le,F as Oe,L as qe,H as Ne,j as Me,K as ze,C as Re,W as Fe}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CzLkKHlp.js";import{f as wt}from"./vehicles-Bi6TDOds.js";import{_ as Kt}from"./CreateEventModal-CxP5T0Mk.js";import{_ as Gt,a as Jt}from"./EditEventModal-CdLqD0Tn.js";import{_ as Xt}from"./ReassignUserModal-Da6cQ3cL.js";const Zt={class:"flex items-center bg-gray-100 rounded-full p-1"},_t=["onClick"],kt={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:t=>t.every(r=>r.value&&r.icon&&r.label)}},emits:["update:view"],setup(t){return(r,s)=>(m(),x("div",Zt,[(m(!0),x(re,null,ce(t.options,a=>(m(),x("button",{key:a.value,onClick:l=>r.$emit("update:view",a.value),class:j(["w-8 h-8 flex items-center justify-center rounded-full transition-colors",t.view===a.value?"bg-white text-indigo-600 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-800"])},[e("i",{class:j([a.icon,"text-xs"])},null,2)],10,_t))),128))]))}},es={class:"flex items-center gap-2"},ts={key:0,class:"flex gap-2"},ss={class:"relative ml-auto",ref:"sortContainer"},os={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},ns={key:0,class:"absolute right-0 mt-2 z-50"},ls={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:r}){const s=t,a=r,l=O(!1),o=()=>{l.value=!l.value},c=b=>{l.value=!1,a("sort-change",b)},u=L(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>c("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>c("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>c("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>c("assigned-to-my-team")}]);return(b,p)=>{const d=ot("click-outside");return m(),x("div",es,[t.showTypeFilter?(m(),x("div",ts,[e("button",{onClick:p[0]||(p[0]=i=>b.$emit("filter-change","all")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:p[1]||(p[1]=i=>b.$emit("filter-change","lead")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:p[2]||(p[2]=i=>b.$emit("filter-change","opportunity")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):D("",!0),e("div",ss,[e("button",{onClick:Se(o,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[p[3]||(p[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(m(),x("span",os)):D("",!0)]),I(yt,{name:"dropdown"},{default:T(()=>[l.value?z((m(),x("div",ns,[I(n(mt),{items:u.value,className:"w-56"},null,8,["items"])])),[[d,()=>l.value=!1]]):D("",!0)]),_:1})],512)])}}},as=st(ls,[["__scopeId","data-v-6dd1e093"]]),is={key:1,class:"absolute right-3 top-8 w-40 bg-white border border-gray-200 rounded-sm shadow-xl z-50 overflow-hidden animate-fade-in"},rs={class:"flex gap-2 mb-1"},ds={key:1,class:"px-2 py-0.5 rounded text-xs font-medium bg-red-50 text-red-700 border border-red-200"},us={class:"font-bold text-gray-900 text-base line-clamp-2 pt-1"},cs={class:"flex gap-3 text-xs text-gray-500 mt-1"},ps={class:"flex items-center gap-1.5"},ms={class:"flex items-center gap-1.5"},ys={class:"pt-1 bg-gray-100 mt-2 mb-2"},gs={class:"flex justify-between text-xs px-3 py-1.5"},fs={class:"font-medium text-gray-900"},vs={class:"font-medium text-gray-900"},bs={key:2,class:"flex items-center justify-between pt-1 border-t border-gray-100"},hs={class:"text-xs text-gray-400 flex items-center gap-2"},xs={class:"w-5 h-5 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0"},ws={class:"text-gray-600 font-medium"},ks={key:1},Cs={class:"text-xs text-gray-400 font-medium"},$s={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0}},emits:["select","menu-click","menu-close"],setup(t,{emit:r}){const s=t,a=L(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),l=L(()=>s.selected),o=L(()=>l.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),c=L(()=>{const p=s.item.displayStage||s.item.stage;return p?gt(p,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),u=p=>{if(!p)return"?";const d=p.split(" ");return d.length>=2?(d[0][0]+d[d.length-1][0]).toUpperCase():p.substring(0,2).toUpperCase()},b=O(null);return(p,d)=>{const i=ot("click-outside");return m(),x("div",{ref_key:"cardRef",ref:b,onClick:d[1]||(d[1]=y=>p.$emit("select",a.value)),class:j(["bg-white rounded-lg p-3 h-44 flex flex-col justify-between hover:shadow-sm cursor-pointer relative",o.value])},[t.showMenu?(m(),x("button",{key:0,onClick:d[0]||(d[0]=Se(y=>p.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-3 right-3 text-gray-300 hover:text-gray-600"},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):D("",!0),t.openMenuId===t.item.id&&t.showMenu?z((m(),x("div",is,[X(p.$slots,"menu",{item:t.item})])),[[i,()=>p.$emit("menu-close")]]):D("",!0),e("div",null,[e("div",rs,[e("span",{class:j(["px-2 py-0.5 rounded text-xs font-medium border",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},S(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(m(),x("span",{key:0,class:j(["px-2 py-0.5 rounded text-xs font-medium border",c.value])},S(t.item.displayStage||t.item.stage),3)):D("",!0),t.item.priority==="Hot"?(m(),x("span",ds," Hot ")):D("",!0)]),e("h3",us,S(t.getName(t.item)),1),e("div",cs,[e("span",ps,[d[3]||(d[3]=e("i",{class:"fa-solid fa-location-dot"},null,-1)),X(p.$slots,"location",{item:t.item})]),e("span",ms,[d[4]||(d[4]=e("i",{class:"fa-solid fa-globe"},null,-1)),X(p.$slots,"source",{item:t.item},()=>{var y;return[F(S(t.item.source||((y=t.item.customer)==null?void 0:y.source)||"Unknown"),1)]})])])]),e("div",ys,[e("div",gs,[e("span",fs,S(t.getVehicleInfo(t.item)),1),e("span",vs,[X(p.$slots,"vehicle-status",{item:t.item})])])]),p.$slots.owner||p.$slots.dates?(m(),x("div",bs,[e("div",hs,[X(p.$slots,"owner",{item:t.item},()=>[t.item.assignee?(m(),x(re,{key:0},[e("div",xs,S(u(t.item.assignee)),1),e("span",ws,S(t.item.assignee),1)],64)):(m(),x("span",ks,"Unassigned"))])]),e("div",Cs,[X(p.$slots,"dates",{item:t.item})])])):D("",!0)],2)}}},Ss={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},As={class:"page-header shrink-0"},Ds={class:"page-header-main"},Ts={class:"page-header-content"},Is={class:"page-header-title"},Ls={class:"flex items-center gap-3"},Os={class:"px-5 py-3"},qs={class:"relative"},Ns=["placeholder"],Ms={key:0,class:"px-5 pb-3"},Rs={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:r}){const s=t,a=r,l=O(""),o=O("none"),c=L(()=>{let i=s.items;if(s.typeFilter&&s.typeFilter!=="all"&&(i=i.filter(y=>y.type===s.typeFilter)),l.value){const y=l.value.toLowerCase();i=i.filter(w=>{const h=s.getName(w).toLowerCase(),N=s.getVehicleInfo(w).toLowerCase();return h.includes(y)||N.includes(y)})}return i}),u=i=>{const y=i.compositeId||`${i.type||"task"}-${i.id}`||i.id;return s.selectedId===y},b=i=>{o.value=i,a("sort-change",i)},p=O(null),d=O(null);return ve(()=>s.selectedId,async i=>{if(i&&d.value){await _e();try{const y=d.value.$el||d.value;y&&y.parentNode&&y.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}}},{immediate:!0}),ve(c,async()=>{s.selectedId&&d.value&&(await _e(),setTimeout(()=>{try{const i=d.value.$el||d.value;i&&i.parentNode&&i.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}},100))},{immediate:!0}),(i,y)=>(m(),x("div",Ss,[e("header",As,[e("div",Ds,[e("div",Ts,[e("div",null,[e("h1",Is,S(t.title),1)]),e("div",Ls,[t.viewMode?(m(),E(kt,{key:0,view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":y[0]||(y[0]=w=>i.$emit("view-change",w))},null,8,["view"])):D("",!0)])])])]),e("div",Os,[e("div",qs,[y[6]||(y[6]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),z(e("input",{"onUpdate:modelValue":y[1]||(y[1]=w=>l.value=w),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ns),[[ae,l.value]])])]),t.showTypeFilter?(m(),x("div",Ms,[I(as,{"type-filter":t.typeFilter,"sort-option":o.value,"show-type-filter":!0,onFilterChange:y[2]||(y[2]=w=>i.$emit("filter-change",w)),onSortChange:b},null,8,["type-filter","sort-option"])])):D("",!0),e("div",{ref_key:"scrollContainer",ref:p,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide bg-gray-50/50"},[(m(!0),x(re,null,ce(c.value,w=>(m(),E($s,{key:w.compositeId||`${w.type||"task"}-${w.id}`,ref_for:!0,ref:h=>{u(w)&&h&&(d.value=h.$el||h)},item:w,selected:u(w),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,onSelect:y[3]||(y[3]=h=>i.$emit("select",h)),onMenuClick:y[4]||(y[4]=h=>i.$emit("menu-click",h)),onMenuClose:y[5]||(y[5]=h=>i.$emit("menu-close"))},{location:T(({item:h})=>[X(i.$slots,"location",{item:h},void 0,!0)]),source:T(({item:h})=>[X(i.$slots,"source",{item:h},void 0,!0)]),"vehicle-status":T(({item:h})=>[X(i.$slots,"vehicle-status",{item:h},void 0,!0)]),owner:T(({item:h})=>[X(i.$slots,"owner",{item:h},void 0,!0)]),dates:T(({item:h})=>[X(i.$slots,"dates",{item:h},void 0,!0)]),menu:T(({item:h})=>[X(i.$slots,"menu",{item:h},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo"]))),128))],512)]))}},Fs=st(Rs,[["__scopeId","data-v-a1e436ae"]]);function Ct(t,r=[],s,a){const l=Ie(),o=l.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},c=l.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},u=Vs(t,r),b=Bs(t,r),p=Us(t),d=Ws(t),i=o.intent+o.behavioral+o.temporal,y={intent:o.intent/i*100,behavioral:o.behavioral/i*100,temporal:o.temporal/i*100},w=u/40*y.intent,h=b/35*y.behavioral,N=p/25*y.temporal,R=Math.min(100,Math.max(0,w+h+N+d));let C="COLD";return R>=c.hot?C="HOT":R>=c.warm?C="WARM":R>=c.standard&&(C="STANDARD"),{score:Math.round(R*10)/10,level:C,breakdown:{intent:Math.round(u*10)/10,behavioral:Math.round(b*10)/10,temporal:Math.round(p*10)/10,quality:Math.round(d*10)/10,total:Math.round(R*10)/10}}}function Vs(t,r){var a;let s=0;return(t.requestType==="Test Drive"||((a=t.scheduledAppointment)==null?void 0:a.type)==="test-drive"||r.some(l=>l.type==="test-drive"||l.type==="appointment"))&&(s=Math.max(s,40)),r.some(l=>l.type==="financing")&&(s=Math.max(s,35)),r.some(l=>l.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||r.some(l=>{var o,c,u;return((o=l.content)==null?void 0:o.toLowerCase().includes("location"))||((c=l.content)==null?void 0:c.toLowerCase().includes("dealership"))||((u=l.content)==null?void 0:u.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||r.some(l=>{var o,c;return((o=l.content)==null?void 0:o.toLowerCase().includes("configur"))||l.type==="attachment"&&((c=l.fileName)==null?void 0:c.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),r.some(l=>{var c;const o=((c=l.content)==null?void 0:c.toLowerCase())||"";return o.includes("compare")||o.includes("versus")||o.includes("vs")||o.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function Bs(t,r){let s=0;const a=new Set(r.map(u=>{if(!u.timestamp)return null;const b=new Date(u.timestamp);return`${b.getFullYear()}-${b.getMonth()}-${b.getDate()}`}).filter(Boolean)),l=Math.min(a.size*10,35);s+=l,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const o=r.reduce((u,b)=>{var p;return u+(((p=b.content)==null?void 0:p.length)||0)},0),c=Math.min(Math.floor(o/50),25);return s+=c,r.some(u=>{var b,p,d;return u.type==="attachment"&&(((b=u.fileName)==null?void 0:b.toLowerCase().includes("brochure"))||((p=u.fileName)==null?void 0:p.toLowerCase().includes("spec"))||((d=u.fileName)==null?void 0:d.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function Us(t){let r=0;if(!t.createdAt)return 0;const s=new Date,a=new Date(t.createdAt),l=(s.getTime()-a.getTime())/(1e3*60*60);l<2?r+=25:l<24?r+=15:l<48?r+=5:r-=10;const o=a.getDay(),c=a.getHours();if((o===0||o===6||c<9||c>17)&&(r+=10),t.contactAttempts&&t.contactAttempts.length===3&&(r+=50),t.lastActivity){const u=new Date(t.lastActivity);(s.getTime()-u.getTime())/(1e3*60*60*24)>3&&(r+=20)}return Math.min(Math.max(r,0),25)}function Ws(t){var s,a,l,o,c,u,b;let r=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(r+=10),(a=t.customer)!=null&&a.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(r+=10),(l=t.customer)!=null&&l.name&&((o=t.customer)!=null&&o.email)&&((c=t.customer)!=null&&c.phone)&&((u=t.customer)!=null&&u.address)&&(r+=5),(t.isDuplicate||t.isDisqualified||!((b=t.customer)!=null&&b.name))&&(r-=20),r}function $t(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function St(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function js({typeFilter:t,showTypeFilter:r,tasks:s}){return{filterDefinitions:L(()=>{const l=[];r.value&&l.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),l.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),l.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&l.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),l.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const o=[...new Set(s.value.map(u=>u.assignee).filter(Boolean))];o.length>0&&l.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:o.map(u=>({value:u,label:u})),aiHint:"Person assigned to the task",pinned:!0});const c=[...new Set(s.value.map(u=>{const b=u.type==="lead"?u.requestedCar:u.vehicle;return b==null?void 0:b.brand}).filter(Boolean))];return c.length>0&&l.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:c.map(u=>({value:u,label:u})),aiHint:"Car brand requested by customer"}),l.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),l})}}const Es={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},Ps={class:"page-header shrink-0"},Hs={class:"page-header-main"},zs={class:"page-header-content"},Qs={class:"flex items-center gap-3"},Ys={class:"flex-1 overflow-y-auto p-4 md:p-8"},Ks={class:"table-wrapper w-full"},Gs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:r}){const s=t,a=r,l=Ie();O("");const o=O({pageIndex:0,pageSize:10}),c=O(""),u=O([]),b=O([{id:"status",value:["Valid","Qualified","Open Lead"],operator:"in"},{id:"type",value:"lead",operator:"eq"},{id:"source",value:["Marketing","Website"],operator:"in"},{id:"assignee",value:void 0},{id:"urgencyLevel",value:void 0}]);O({});const{filterDefinitions:p}=js({typeFilter:L(()=>s.typeFilter),showTypeFilter:L(()=>s.showTypeFilter),tasks:L(()=>s.tasks)}),d=L(()=>s.tasks),i=k=>k.compositeId===s.currentTaskId||k.compositeId===s.highlightId,y=k=>{if(k.type==="lead")return k.requestedCar?`${k.requestedCar.brand} ${k.requestedCar.model}`:"No vehicle specified";const v=k.vehicle||k.requestedCar;return v?`${v.brand} ${v.model}`:"No vehicle specified"},w=k=>{const v=k.type==="lead"?k.requestedCar:k.vehicle;if(!v)return{status:"N/A",class:"bg-gray-100 text-gray-700"};const g=v.stockDays!==void 0&&v.stockDays!==null;return{status:g?"In Stock":"Out of Stock",class:g?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}},h=k=>{var v;return k.type==="lead"?((v=k.requestedCar)==null?void 0:v.requestType)||k.requestType||"N/A":k.requestType||"Opportunity"},N=L(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:k=>R(k.original)},cell:({row:k})=>{const v=k.original,g=v.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${g}`},v.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:k})=>{const v=k.original;return _("div",{class:"flex items-center gap-2 md:gap-3"},[_("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${v.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},v.customer.initials),_("div",{class:"min-w-0"},[_("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},v.customer.name),_("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},v.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:k})=>{const v=k.original,g=y(v);return g==="No vehicle specified"?_("span",{class:"text-sm text-gray-400"},"N/A"):_("div",{class:"flex items-center gap-2"},[_("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"}),_("span",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},g)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:k})=>{const v=k.original,g=w(v);return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${g.class}`},g.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:k})=>{const v=k.original,g=h(v);return _("span",{class:"text-sm text-gray-600"},g)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:k})=>{const v=k.original;return _("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},v.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:k})=>{const v=k.original,g=s.getOwnerInfo(v);return _("div",{class:"flex items-center gap-2"},[_("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-600 shrink-0"},g.initials),_("span",{class:"text-sm text-gray-600 truncate max-w-[80px]"},g.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:k})=>{const v=k.original,g=v.type==="lead"?v.status:v.displayStage||v.stage,A=s.getStageBadgeClass(g);return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${A}`},g)}},...s.typeFilter==="lead"&&l.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:k})=>{const v=k.original;if(v.type!=="lead")return _("span",{class:"text-sm text-gray-400"},"â€”");let g=v.urgencyLevel;g||(g=Ct(v).level);const A=St(g),V=$t(g);return _("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${A}`},[_("span",{},V),_("span",{},g)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:k})=>{const v=k.original;return _("button",{class:"text-gray-400 hover:text-gray-600",onClick:g=>{g.stopPropagation(),a("menu-click",v.id)}},[_("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),R=k=>{a("select",k.compositeId)},C=L(()=>({class:{tr:k=>{const v="cursor-pointer hover:bg-gray-50 transition-colors",g=k.original;return i(g)?`${v} bg-blue-50 border-l-4 border-l-blue-500`:v}}}));return ve(()=>[s.highlightId,s.tasks],async([k])=>{k&&s.tasks.length>0&&(await _e(),setTimeout(()=>{var v,g;try{const A=document.querySelector(".table-wrapper");if(!A)return;const V=s.tasks.find(Y=>Y.compositeId===k);if(!V)return;const P=(v=V.customer)==null?void 0:v.name;if(P){const Y=A.querySelectorAll('tbody tr, [role="row"]');for(const Z of Y)if(Z&&Z.parentNode&&((g=Z.textContent)!=null&&g.includes(P))){Z.scrollIntoView({behavior:"smooth",block:"nearest"});break}}}catch{}},500))},{immediate:!0}),(k,v)=>(m(),x("div",Es,[e("header",Ps,[e("div",Hs,[e("div",zs,[v[7]||(v[7]=e("div",null,[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Qs,[e("button",{onClick:v[0]||(v[0]=g=>k.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 hover:border-indigo-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all"},[...v[6]||(v[6]=[e("i",{class:"fa-solid fa-eye-slash text-gray-400 group-hover:text-indigo-500"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])]),I(kt,{view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":v[1]||(v[1]=g=>k.$emit("view-change",g))},null,8,["view"])])])])]),e("div",Ys,[e("div",Ks,[I(n(Bt),{data:d.value,columns:N.value,meta:C.value,onRowClick:R,columnFiltersOptions:{filterDefs:n(p)},pagination:o.value,"onUpdate:pagination":v[2]||(v[2]=g=>o.value=g),globalFilter:c.value,"onUpdate:globalFilter":v[3]||(v[3]=g=>c.value=g),sorting:u.value,"onUpdate:sorting":v[4]||(v[4]=g=>u.value=g),columnFilters:b.value,"onUpdate:columnFilters":v[5]||(v[5]=g=>b.value=g),paginationOptions:{rowCount:d.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{toolbar:T(()=>[...v[8]||(v[8]=[e("div",{class:"flex justify-end"},[e("button",{class:"group flex items-center gap-2 rounded-2xl border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 hover:border-purple-100 hover:bg-purple-50 hover:text-purple-600 transition-all"},[e("i",{class:"fa-solid fa-arrow-left text-gray-400 group-hover:text-purple-500"}),e("span",{class:"hidden sm:inline"},"Switch back to old design")])],-1)])]),"empty-state":T(()=>[...v[9]||(v[9]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Js={key:0,class:"mb-8"},Xs={class:"flex items-center gap-2 mb-4"},Zs={class:"font-bold text-gray-800 text-sm"},_s={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},eo={class:"p-4"},to={class:"flex items-center justify-between"},so={class:"flex items-center gap-4"},oo={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},no=["src"],lo={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},ao={class:"flex items-center gap-2"},io={class:"font-bold text-gray-900 text-sm md:text-base"},ro={class:"mt-1.5 flex items-center gap-2"},uo={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},co={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},po={key:2,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},mo={class:"flex items-center gap-4"},yo={key:0,class:"text-right"},go={class:"font-bold text-gray-900"},fo={key:0,class:"mt-4 pt-4 border-t border-gray-200"},vo={class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},bo={class:"text-sm text-gray-700 leading-relaxed"},ho={class:"border-t border-gray-200"},xo={class:"font-medium"},wo={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},ko={class:"mb-6"},Co={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},$o={key:0},So={class:"font-medium text-gray-700"},Ao={key:1},Do={class:"font-medium text-gray-700"},To={key:2},Io={class:"font-medium text-gray-700"},Lo={class:"font-medium text-gray-700"},Oo={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},qo={key:0},No={class:"font-medium text-gray-700"},Mo={key:1},Ro={class:"font-medium text-gray-700"},Fo={key:2},Vo={class:"font-medium text-gray-700"},Bo={key:3},Uo={class:"font-medium text-gray-700"},Wo={key:4},jo={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Eo={key:5},Po={class:"font-medium text-gray-700"},Ho={key:0,class:"mt-6 flex justify-end"},zo={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const r=O(!1),s=l=>new Intl.NumberFormat("en-US").format(l),a=l=>new Intl.NumberFormat("en-US").format(l);return(l,o)=>t.show?(m(),x("div",Js,[e("div",Xs,[o[1]||(o[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",Zs,S(t.label),1)]),e("div",_s,[e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[t.image?(m(),x("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,no)):(m(),x("i",lo))]),e("div",null,[e("div",ao,[e("div",io,S(t.brand)+" "+S(t.model)+" ("+S(t.year)+")",1)]),e("div",ro,[t.stockDays!==void 0&&t.stockDays!==null?(m(),x("div",uo,[o[2]||(o[2]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),F(" In stock ("+S(t.stockDays)+" days) ",1)])):(m(),x("div",co,[...o[3]||(o[3]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),F(" Out of stock ",-1)])])),t.showOpenAd&&t.price?(m(),x("button",po,[...o[4]||(o[4]=[F(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-xs text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):D("",!0)])])]),e("div",mo,[t.price?(m(),x("div",yo,[o[5]||(o[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",go,"â‚¬ "+S(s(t.price)),1)])):D("",!0)])]),t.requestMessage?(m(),x("div",fo,[o[6]||(o[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-2"},"Request Message",-1)),e("div",vo,[e("p",bo,S(t.requestMessage),1)])])):D("",!0)]),e("div",ho,[e("button",{onClick:o[0]||(o[0]=c=>r.value=!r.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",xo,S(r.value?"Hide":"View")+" Details",1),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":r.value}])},null,2)])]),r.value?(m(),x("div",wo,[e("div",ko,[o[17]||(o[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Co,[t.requestType?(m(),x("div",$o,[o[7]||(o[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",So,S(t.requestType),1)])):D("",!0),t.source?(m(),x("div",Ao,[o[8]||(o[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Do,S(t.source),1)])):D("",!0),e("div",null,[o[9]||(o[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:j(["font-medium",t.sourceDetails?"text-gray-700":"text-gray-400"])},S(t.sourceDetails||"--"),3)]),t.dealership?(m(),x("div",To,[o[10]||(o[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Io,S(t.dealership),1)])):D("",!0),e("div",null,[o[11]||(o[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Lo,S(t.channel||"Email"),1)]),e("div",null,[o[12]||(o[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:j(["font-medium",t.adCampaign?"text-gray-700":"text-gray-400"])},S(t.adCampaign||"--"),3)]),e("div",null,[o[13]||(o[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:j(["font-medium",t.adMedium?"text-gray-700":"text-gray-400"])},S(t.adMedium||"--"),3)]),e("div",null,[o[14]||(o[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:j(["font-medium",t.adSource?"text-gray-700":"text-gray-400"])},S(t.adSource||"--"),3)]),e("div",null,[o[15]||(o[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:j(["font-medium",t.expectedPurchaseDate?"text-gray-700":"text-gray-400"])},S(t.expectedPurchaseDate||"--"),3)]),e("div",null,[o[16]||(o[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:j(["font-medium",t.fiscalEntity?"text-gray-700":"text-gray-400"])},S(t.fiscalEntity||"--"),3)])])]),o[26]||(o[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[o[25]||(o[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Oo,[t.registration?(m(),x("div",qo,[o[18]||(o[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",No,S(t.registration),1)])):D("",!0),t.kilometers!==void 0&&t.kilometers!==null?(m(),x("div",Mo,[o[19]||(o[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ro,S(a(t.kilometers))+" Km",1)])):D("",!0),t.fuelType?(m(),x("div",Fo,[o[20]||(o[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Vo,S(t.fuelType),1)])):D("",!0),t.gearType?(m(),x("div",Bo,[o[21]||(o[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Uo,S(t.gearType),1)])):D("",!0),t.vin?(m(),x("div",Wo,[o[22]||(o[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",jo,S(t.vin),1)])):D("",!0),t.dealership?(m(),x("div",Eo,[o[23]||(o[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Po,S(t.dealership),1)])):D("",!0)]),t.showTechnicalSpecs?(m(),x("div",Ho,[...o[24]||(o[24]=[e("button",{class:"bg-white border border-gray-200 text-gray-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),F(" View technical specs ")],-1)])])):D("",!0)])])):D("",!0)])])):D("",!0)}},Qo={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border-gray-200"},Yo={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-gray-200"},ut={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},vehicleWidgetData:{type:Object,default:null}},setup(t){return(r,s)=>t.task?(m(),x("div",Qo,[I(Ut,{task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},{"pinned-extra":T(({task:a})=>[t.vehicleWidgetData?(m(),E(zo,Nt(ft({key:0},t.vehicleWidgetData)),null,16)):D("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):(m(),x("div",Yo,[...s[0]||(s[0]=[Ke('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gray-100 flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-gray-400"></i></div><h3 class="text-base font-semibold text-gray-900 mb-2">No task selected</h3><p class="text-sm text-gray-500">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},Ko={key:0,class:"lg:hidden border-b border-gray-200 shrink-0",style:{"background-color":"#f5f5f5"}},Go={class:"px-4 py-3 flex items-center justify-between gap-3"},Jo=["aria-label"],Xo={key:0,class:"flex-1 flex items-center justify-center"},Zo={key:1,class:"flex items-center gap-2"},_o={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:r}){const s=r,a=()=>{s("back")};return(l,o)=>t.show?(m(),x("div",Ko,[e("div",Go,[e("button",{onClick:a,class:"w-11 h-11 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...o[0]||(o[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Jo),l.$slots.title?(m(),x("div",Xo,[X(l.$slots,"title")])):D("",!0),l.$slots.actions?(m(),x("div",Zo,[X(l.$slots,"actions")])):D("",!0)])])):D("",!0)}},Ce={[se.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[se.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[se.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[se.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[se.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[se.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},ct={toClosed:(t,r,s)=>{const a={isDisqualified:!0,disqualifyReason:(s==null?void 0:s.reason)||null,disqualifyCategory:(s==null?void 0:s.category)||null,scheduledAppointment:null,nextActionDue:null};(s==null?void 0:s.reason)==="Duplicate"?(a.isDuplicate=!0,a.stage="Closed Failed"):(s==null?void 0:s.category)==="Not Interested"?a.stage="Not Interested":a.stage="Not Valid",a.status="Disqualified";const l=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(s==null?void 0:s.category)||"Unknown"}, Reason: ${(s==null?void 0:s.reason)||"Unknown"}`}];return t.scheduledAppointment&&l.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:a,activities:l}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function tt(t,r){return r.startsWith("Closed")?ct.toClosed:t.startsWith("Closed")&&!r.startsWith("Closed")?ct.reopen:null}function en(t){var o,c,u;const r=t.lead;if(!r)return null;const s=$e(r,"lead");if(!s)return((o=Ce[se.NEW])==null?void 0:o.primaryAction)||null;const a=Ce[s];if(!a)return((c=Ce[se.NEW])==null?void 0:c.primaryAction)||null;if(!a.primaryAction)return((u=Ce[se.NEW])==null?void 0:u.primaryAction)||null;const l=a.primaryAction;return typeof l=="function"?l({lead:r,displayStage:s}):l}function tn(t){const r=t.lead;if(!r)return[];const s=$e(r,"lead"),a=Ce[s];return a?a.secondaryActions||[]:[]}function lt(t){const r=t.lead;if(!r||!(r.isDisqualified===!0))return!1;const a=$e(r,"lead");return a===se.CLOSED_INVALID||a===se.CLOSED_NOT_INTERESTED||a===se.CLOSED_DUPLICATE}function sn(t){const r=t.lead;if(!r||lt(t))return!1;const s=$e(r,"lead"),a=Ce[s];return a?typeof a.showLQWidget=="function"?a.showLQWidget(r):a.showLQWidget??!1:!1}function on(t){const r=t.lead;if(!r||lt(t))return!1;const s=$e(r,"lead"),a=Ce[s];return a?a.showDeadlineBanner&&r.nextActionDue:!1}function nn(t){const r=t.lead;if(!r)return!1;const s=$e(r,"lead"),a=Ce[s];return a?a.canPostpone??!1:!1}function ln(t){const r=t.lead;if(!r)return"qualification";const s=$e(r,"lead"),a=Ce[s];return a&&a.lqWidgetMode||"qualification"}function At(t,r={}){const s=Ie(),a=L(()=>{const R=typeof t=="function"?t():Qe(t);return{lead:R,displayStage:R?$e(R,"lead"):null}}),l=L(()=>a.value.displayStage||"New"),o=L(()=>{const R=a.value;return lt(R)}),c=L(()=>{const R=a.value,C=en(R);if(!C)return null;const k=r[C.key];return{...C,handler:k||(()=>console.warn(`No handler for action: ${C.key}`))}}),u=L(()=>{const R=a.value;return tn(R).map(k=>{const v=r[k.key];return{...k,handler:v||(()=>console.warn(`No handler for action: ${k.key}`))}})}),b=L(()=>{const R=a.value;return sn(R)}),p=L(()=>{const R=a.value;return on(R)}),d=L(()=>{const R=a.value;return nn(R)}),i=L(()=>{const R=a.value;return ln(R)}),y=L(()=>{const C=a.value.lead;return((C==null?void 0:C.contactAttempts)||[]).length||0}),w=L(()=>s.getSetting("maxContactAttempts")),h=L(()=>y.value+1>=w.value),N=L(()=>!0);return{displayStage:l,isClosed:o,primaryAction:c,secondaryActions:u,showLQWidget:b,showDeadlineBanner:p,canPostpone:d,canReassign:N,lqWidgetMode:i,contactAttempts:y,maxContactAttempts:w,shouldShowAutoDisqualifyWarning:h}}function an({getLead:t,leadState:r,emit:s}){const a=nt(),l=He(),o=je();async function c(C){var v;const k=t();if(k){if(!r.canPostpone.value){console.warn("Cannot postpone in current state");return}try{const g=new Date(`${C.date}T${C.time}:00`),A=g.toISOString(),V={nextActionDue:A};if((C.assigneeId||C.teamId)&&(V.assignee=C.assignee||null,V.assigneeId=C.assigneeId||null,V.assigneeType=C.assigneeType||"user",V.teamId=C.teamId||null,V.team=C.team||null),await l.updateLead(k.id,V),C.createAppointment){const P=new Date(g);P.setHours(P.getHours()+1),await l.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${k.customer.name}`,start:A,end:P.toISOString(),type:"Call",assignee:C.assignee||k.assignee,assigneeId:C.assigneeId||k.assigneeId,assigneeType:C.assigneeType||k.assigneeType||"user",teamId:C.teamId||k.teamId,team:C.team||k.team,status:"scheduled"}}),await l.addActivity(k.id,{type:"appointment",user:((v=o.currentUser)==null?void 0:v.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${We(g)} at ${Pe(g)}`,data:{type:"Call",date:C.date,time:C.time,assignee:C.assignee||k.assignee}})}await l.addActivity(k.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${We(g)} at ${Pe(g)}${C.assignee?` and reassigned to ${C.assignee}`:""}`}),await l.fetchLeadById(k.id)}catch(g){console.error("Failed to postpone lead task:",g)}}}async function u(C){const k=t();if(k)try{if(await l.updateLead(k.id,{stage:"Validated"}),await l.addActivity(k.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),C.scheduleFollowUp&&C.appointmentData){const v=new Date(`${C.appointmentData.date}T${C.appointmentData.time}:00`);await l.scheduleFollowUp(k.id,{dateTime:v.toISOString(),assignee:C.appointmentData.assignee||k.assignee,assigneeId:C.appointmentData.assigneeId||null,assigneeType:C.appointmentData.assigneeType||"user",teamId:C.appointmentData.teamId||null,team:C.appointmentData.team||null}),await l.addActivity(k.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${We(v)} at ${Pe(v)}`})}await l.fetchLeadById(k.id)}catch(v){console.error("Failed to validate lead:",v)}}async function b(){const C=t();if(C)try{const k=await l.convertLeadToOpportunity(C.id);o.canAccessOpportunities()?a.push({path:`/tasks/${k}`,query:{type:"opportunity"}}):a.push("/tasks")}catch(k){console.error("Failed to qualify lead:",k)}}async function p(C){const k=t();if(k)try{const v=k.contactAttempts||[];await l.updateLead(k.id,{contactAttempts:[...v,C],lastContactAttempt:C.timestamp,totalContactAttempts:v.length+1}),await l.addActivity(k.id,{type:"call",user:"You",action:`logged call attempt - ${C.outcome}`,content:C.notes||`Call attempt via ${C.channel}`,data:{outcome:C.outcome,channel:C.channel,duration:C.duration}}),await l.fetchLeadById(k.id)}catch(v){console.error("Failed to log call attempt:",v)}}async function d(C){const k=t();if(k)try{await l.addActivity(k.id,{type:"note",user:"You",action:"added a note",content:C.content||C.text||"",data:C}),await l.fetchLeadById(k.id)}catch(v){console.error("Failed to save note:",v)}}function i(){s("open-purchase-method")}function y(){s("open-trade-in")}async function w(C){var v;const k=t();if(k)try{const g=`${C.date}T${C.time}:00`,A=new Date(g);A.setHours(A.getHours()+1),await l.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`${C.type} - ${k.customer.name}`,start:g,end:A.toISOString(),type:C.type,assignee:C.assignee,assigneeId:C.assigneeId,status:"scheduled",location:C.location||"",notes:C.notes||""}}),await l.addActivity(k.id,{type:"appointment",user:((v=o.currentUser)==null?void 0:v.name)||"You",action:"scheduled an appointment",content:`${C.type} scheduled for ${C.date} at ${C.time}`,data:{type:C.type,date:C.date,time:C.time,assignee:C.assignee}}),await l.fetchLeadById(k.id)}catch(g){console.error("Failed to schedule appointment:",g)}}async function h(C){const k=t();if(k){if(r.isClosed.value&&!C.force){console.warn("Lead already closed");return}try{const v=r.displayStage.value,g=C.reason==="Duplicate"?se.CLOSED_DUPLICATE:C.category==="Not Interested"?se.CLOSED_NOT_INTERESTED:se.CLOSED_INVALID,A=tt(v,g);if(A){const{updates:V,activities:P}=A(k,g,C);await l.updateLead(k.id,V);for(const Y of P)await l.addActivity(k.id,Y)}else{const V=C.reason==="Duplicate";await l.updateLead(k.id,{isDisqualified:!0,disqualifyReason:C.reason,isDuplicate:V,stage:V?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await l.addActivity(k.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${C.category}, Reason: ${C.reason}`})}a.push("/tasks")}catch(v){console.error("Failed to disqualify lead:",v)}}}async function N(){const C=t();if(C)try{const k=r.displayStage.value,v=se.NEW,g=tt(k,v);if(g){const{updates:A,activities:V}=g(C);await l.updateLead(C.id,A);for(const P of V)await l.addActivity(C.id,P)}else await l.updateLead(C.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await l.addActivity(C.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await l.fetchLeadById(C.id)}catch(k){console.error("Failed to reopen lead:",k)}}function R(){const C=t();C&&C.opportunityId&&a.push({path:`/tasks/${C.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:c,handleValidated:u,handleQualified:b,handleCallAttemptLogged:p,handleNoteSaved:d,handleOpenPurchaseMethod:i,handleOpenTradeIn:y,handleAppointmentScheduled:w,handleDisqualified:h,handleReopen:N,viewOpportunity:R}}const rn={class:"p-5 space-y-6"},Dt={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(r,s)=>t.task?(m(),x("div",{key:0,class:j(["bg-white border border-gray-200 rounded-xl shadow-sm",t.containerClass])},[s[0]||(s[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Manage next steps")])],-1)),X(r.$slots,"deadline-banner"),e("div",rn,[X(r.$slots,"primary-action"),X(r.$slots,"task-widgets"),X(r.$slots,"closed-state"),X(r.$slots,"secondary-actions")])],2)):D("",!0)}},dn={class:"flex justify-between items-start mb-3"},un={class:"font-bold text-gray-900 text-sm"},cn={class:"text-xs text-gray-500 mt-0.5"},pn={class:"flex gap-3 flex-wrap"},Tt={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(r,s)=>(m(),x("div",{class:j(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",dn,[e("div",null,[e("h4",un,S(t.action.title),1),e("p",cn,S(t.action.description),1)])]),e("div",pn,[e("button",{onClick:s[0]||(s[0]=a=>r.$emit("action-clicked")),class:j([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:j(t.action.icon)},null,2),F(" "+S(t.action.label),1)],2)])],2))}},mn={class:"flex items-center gap-3"},yn={class:"flex-1"},gn={key:0,class:"text-xs font-normal opacity-75"},fn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:r}){const s=t,a=r,l=O(!1),o=L(()=>vt(s.nextActionDue)),c=L(()=>s.isClosed||!s.showDeadlineBanner||l.value?!1:o.value.type==="overdue"||o.value.type==="urgent"),u=()=>{l.value=!0,a("dismissed")};return(b,p)=>c.value?(m(),x("div",{key:0,class:j(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[o.value.bgClass,o.value.borderClass]])},[e("div",mn,[e("div",{class:j(["w-9 h-9 rounded-lg flex items-center justify-center",[o.value.bgClass,o.value.borderClass,"border"]])},[e("i",{class:j(["text-base",[`fa-solid ${o.value.icon}`,o.value.textClass]])},null,2)],2),e("div",yn,[p[0]||(p[0]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:j(["text-sm font-bold",o.value.textClass])},[F(S(n(bt)(t.nextActionDue))+" ",1),o.value.type!=="overdue"?(m(),x("span",gn," ("+S(n(ht)(t.nextActionDue))+") ",1)):D("",!0)],2)]),o.value.type==="overdue"?(m(),x("div",{key:0,class:j(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...p[1]||(p[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),F(" Overdue ",-1)])],2)):o.value.type==="urgent"?(m(),x("div",{key:1,class:j(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),F(" Urgent ",-1)])],2)):D("",!0)]),e("button",{onClick:u,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...p[3]||(p[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):D("",!0)}},vn={class:"space-y-4"},bn={label:"Teams"},hn=["value"],xn={label:"Users"},wn=["value"],kn={key:0,class:"text-xs text-gray-500 mt-1"},Cn={key:0,class:"animate-fade-in"},$n={class:"grid grid-cols-4 gap-2"},Sn=["onClick"],An={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(t,{emit:r}){const s=t,a=r,l=je(),o=Xe(),c=O(""),u=O(null),b=O(""),p=O(!1),d=O(""),i=L(()=>o.assignableUsers),y=L(()=>o.assignableTeams),w=L(()=>u.value&&u.value.startsWith("team-")),h=L(()=>!!(c.value&&b.value&&d.value&&u.value));Ge(()=>{var v;u.value=`user-${((v=l.currentUser)==null?void 0:v.id)||1}`}),ve(()=>s.show,v=>{v||N()});const N=()=>{var v;c.value="",u.value=`user-${((v=l.currentUser)==null?void 0:v.id)||1}`,b.value="",p.value=!1,d.value=""},R=v=>{v||a("close")},C=()=>{if(!h.value)return;const v=u.value.startsWith("team-"),g=parseInt(u.value.split("-")[1]);let A={};if(v){const V=o.getTeamById(g);A={assigneeType:"team",teamId:g,team:(V==null?void 0:V.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const V=o.getUserById(g);A={assigneeType:"user",assigneeId:g,assignee:(V==null?void 0:V.name)||"Unknown",teamId:null,team:null}}a("confirm",{type:c.value,date:b.value,time:d.value,...A}),a("close")},k=()=>{a("close")};return(v,g)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":R},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...g[4]||(g[4]=[F("Schedule Appointment",-1)])]),_:1}),I(n(ze),null,{default:T(()=>[...g[5]||(g[5]=[F("Book an appointment with the customer",-1)])]),_:1})]),_:1}),e("div",vn,[e("div",null,[g[7]||(g[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),z(e("select",{"onUpdate:modelValue":g[0]||(g[0]=A=>c.value=A),class:"input"},[...g[6]||(g[6]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[we,c.value]])]),e("div",null,[g[9]||(g[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),z(e("select",{"onUpdate:modelValue":g[1]||(g[1]=A=>u.value=A),class:"input"},[e("optgroup",bn,[(m(!0),x(re,null,ce(y.value,A=>(m(),x("option",{key:`team-${A.id}`,value:`team-${A.id}`},S(A.name)+" Team ",9,hn))),128))]),e("optgroup",xn,[(m(!0),x(re,null,ce(i.value,A=>{var V;return m(),x("option",{key:`user-${A.id}`,value:`user-${A.id}`},S(A.name)+S(A.id===((V=n(l).currentUser)==null?void 0:V.id)?" (Me)":""),9,wn)}),128))])],512),[[we,u.value]]),w.value?(m(),x("p",kn,[...g[8]||(g[8]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),F(" Any available team member will be assigned ",-1)])])):D("",!0)]),e("div",null,[g[10]||(g[10]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":g[2]||(g[2]=A=>b.value=A),onChange:g[3]||(g[3]=A=>p.value=!0),class:"input"},null,544),[[ae,b.value]])]),p.value?(m(),x("div",Cn,[g[11]||(g[11]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",$n,[(m(),x(re,null,ce(["09:00","10:30","11:00","14:30","15:00","16:30"],A=>e("button",{key:A,onClick:V=>d.value=A,class:j(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",d.value===A?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},S(A),11,Sn)),64))])])):D("",!0)]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),I(n(pe),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!h.value,onClick:C},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Dn={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},Tn={key:0,class:"flex justify-between items-center mb-4"},In={class:"font-semibold text-gray-900 text-sm"},Ln={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(r,s)=>(m(),x("div",Dn,[t.title?(m(),x("div",Tn,[e("h5",In,S(t.title),1),t.showClose?(m(),x("button",{key:0,onClick:s[0]||(s[0]=a=>r.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):D("",!0)])):D("",!0),X(r.$slots,"default")]))}};function On(){const t=Mt(),r=O(!1),s=O(!1),a=O(0),l=O(""),o=O(null),c=O({}),u=O(null),b={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},p=L(()=>{const N=Math.floor(a.value/60),R=a.value%60;return`${N.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`}),d=()=>{r.value=!0,a.value=0,s.value=!1,l.value="",o.value=setInterval(()=>{a.value++,a.value>=20&&i()},1e3)},i=()=>{o.value&&(clearInterval(o.value),o.value=null),r.value=!1,s.value=!0,c.value={duration:a.value,notes:l.value,transcription:b,channel:"phone"}},y=async N=>{try{await navigator.clipboard.writeText(N),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},w=N=>(u.value={tradeIn:b.leadLines.some(R=>R.toLowerCase().includes("trade")||R.toLowerCase().includes("exchange"))||!1,financing:b.leadLines.some(R=>R.toLowerCase().includes("financ")||R.toLowerCase().includes("payment")||R.toLowerCase().includes("loan"))||!1},u.value.tradeIn&&N&&(N.value.tradeIn=!0),u.value.financing&&N&&(N.value.financing=!0),u.value),h=()=>{r.value=!1,s.value=!1,a.value=0,l.value="",c.value={},o.value&&(clearInterval(o.value),o.value=null)};return Rt(()=>{o.value&&clearInterval(o.value)}),{isCallActive:r,callEnded:s,callDuration:a,callNotes:l,callData:c,extractedData:u,mockTranscription:b,formattedCallDuration:p,startCall:d,endCall:i,copyNumber:y,extractInformation:w,resetCall:h}}function qn(t,r,s,a,l,o){var ye,fe,he;const c=O(!1),u=O(null),b=O(!1),p=O(null),d=O(!1),i=O(!1),y=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],w=O("whatsapp"),h=O("followup-1"),N=O("custom"),R=O(""),C=O("09:00"),k=O("Not Interested"),v=O(""),g=O({dealership:((fe=(ye=t.value)==null?void 0:ye.requestedCar)==null?void 0:fe.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((he=o==null?void 0:o.value)==null?void 0:he.id)||null}),A=O({tradeIn:!1,financing:!1,contactAvailability:!1}),V=L(()=>{var xe,ue,te,ne,me,W,U;const K=((te=(ue=(xe=t.value)==null?void 0:xe.customer)==null?void 0:ue.name)==null?void 0:te.split(" ")[0])||"",G=((me=(ne=t.value)==null?void 0:ne.requestedCar)==null?void 0:me.brand)||"",ge=((U=(W=t.value)==null?void 0:W.requestedCar)==null?void 0:U.model)||"";return{"followup-1":`Hi ${K}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${G} ${ge}?`,"followup-2":`Hello ${K}, this is regarding your inquiry about the ${G} ${ge}. Please let me know when you're available for a call.`,custom:""}}),P=L(()=>h.value==="custom"?"Type your custom message...":V.value[h.value]||""),Y=L(()=>{var K;return!!((K=t.value)!=null&&K.scheduledAppointment)});return{showOutcomeSelection:c,selectedOutcome:u,appointmentScheduled:b,scheduledAppointmentData:p,showNoteModal:d,showScheduleAppointmentModal:i,followupChannels:y,followupChannel:w,selectedTemplate:h,rescheduleTime:N,customDate:R,customTime:C,disqualifyCategory:k,disqualifyReason:v,assignment:g,preferences:A,messageTemplates:V,messagePreview:P,hasExistingAppointment:Y,selectOutcome:K=>{u.value=K,K==="interested"&&(s!=null&&s.value)&&(A.value.tradeIn=s.value.tradeIn||!1,A.value.financing=s.value.financing||!1)},cancelOutcome:()=>{u.value=null,c.value=!1,b.value=!1,p.value=null},calculateNextCallDate:()=>{if(N.value==="tomorrow-9am"){const G=new Date;return G.setDate(G.getDate()+1),G.setHours(9,0,0,0),G.toISOString()}else if(N.value==="monday"){const G=new Date,ge=(8-G.getDay())%7||7;return G.setDate(G.getDate()+ge),G.setHours(9,0,0,0),G.toISOString()}else if(N.value==="custom"&&R.value&&C.value)return new Date(`${R.value}T${C.value}:00`).toISOString();const K=new Date;return K.setDate(K.getDate()+1),K.setHours(9,0,0,0),K.toISOString()},resetOutcomeState:()=>{u.value=null,c.value=!1,b.value=!1,p.value=null,w.value="whatsapp",h.value="followup-1",N.value="custom",R.value="",C.value="09:00",k.value="Not Interested",v.value=""}}}function Nn(t,r,s,a,l,o){const{callData:c}=r,{showOutcomeSelection:u,selectedOutcome:b,appointmentScheduled:p,scheduledAppointmentData:d,assignment:i,preferences:y,cancelOutcome:w,calculateNextCallDate:h,showScheduleAppointmentModal:N}=s;return{logManualCall:()=>{c.value={channel:"external",notes:"",transcription:null},u.value=!0},handleScheduleAppointmentConfirm:async P=>{d.value=P,p.value=!0,N.value=!1,t("appointment-scheduled",P)},handleQualify:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((Y=c.value)==null?void 0:Y.channel)||"phone",notes:((Z=c.value)==null?void 0:Z.notes)||"",transcription:((oe=c.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:i.value,preferences:y.value,scheduleAppointment:p.value,appointmentData:d.value}),w()},handleDisqualifyFromInterested:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((Y=c.value)==null?void 0:Y.channel)||"phone",notes:((Z=c.value)==null?void 0:Z.notes)||"",transcription:((oe=c.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),b.value="not-valid"},handleNoAnswerConfirm:async()=>{var be,H,ye;const P={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((be=c.value)==null?void 0:be.channel)||"phone",notes:((H=c.value)==null?void 0:H.notes)||"",transcription:((ye=c.value)==null?void 0:ye.transcription)||null};t("call-attempt-logged",P);const Y=h(),Z=Y.split("T")[0],oe=new Date(Y).toTimeString().slice(0,5);t("postponed",{date:Z,time:oe,createAppointment:!0}),(l==null?void 0:l.value)+1>=(o==null?void 0:o.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),w()},handleNotValidConfirm:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((Y=c.value)==null?void 0:Y.channel)||"phone",notes:((Z=c.value)==null?void 0:Z.notes)||"",transcription:((oe=c.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),w()},handleNoteSave:P=>{s.showNoteModal.value=!1,t("note-saved",P)}}}const Mn={key:0,class:"flex gap-2 items-center mb-4"},Rn=["disabled"],Fn={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Vn=["disabled"],Bn={key:1,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Un={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Wn={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},jn={class:"flex items-center gap-2 text-red-400"},En={class:"text-xs font-mono"},Pn={class:"space-y-3 text-sm font-mono"},Hn={class:"ml-2"},zn={class:"ml-2"},Qn={key:0},Yn={class:"ml-2"},Kn={key:1},Gn={class:"ml-2"},Jn={key:2},Xn={class:"ml-2"},Zn={class:"mt-4 pt-4 border-t border-slate-700"},_n=["model-value"],el={class:"mt-4 flex justify-end"},tl={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},sl={class:"flex items-center justify-between"},ol={class:"flex gap-2"},nl={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes"],setup(t){return(r,s)=>(m(),x("div",null,[!t.showOutcomeSelection&&!t.isCallActive&&!t.callEnded?(m(),x("div",Mn,[e("button",{onClick:s[0]||(s[0]=a=>r.$emit("start-call")),disabled:t.isCallActive,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone"},null,-1)),F(" "+S(t.contactAttempts>0?"Call Again":"Initiate Call")+" ",1),t.contactAttempts>0?(m(),x("span",Fn,S(t.contactAttempts+1)+"/"+S(t.maxContactAttempts),1)):D("",!0)],8,Rn),e("button",{onClick:s[1]||(s[1]=a=>r.$emit("log-manual-call")),disabled:t.isCallActive,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),F(" Log Call Outcome ",-1)])],8,Vn)])):D("",!0),t.isCallActive||t.callEnded?(m(),x("div",Bn,[t.isCallActive?(m(),x("div",Un,[e("div",Wn,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",jn,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",En,"REC "+S(t.formattedCallDuration),1)])]),e("div",Pn,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Hn,S(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",zn,S(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(m(),x("div",Qn,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Yn,S(t.mockTranscription.leadLines[1]),1)])):D("",!0),t.callDuration>=8?(m(),x("div",Kn,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Gn,S(t.mockTranscription.salesLines[1]),1)])):D("",!0),t.callDuration>=12?(m(),x("div",Jn,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Xn,S(t.mockTranscription.leadLines[2]),1)])):D("",!0)]),e("div",Zn,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=a=>r.$emit("update:call-notes",a)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,_n)]),e("div",el,[e("button",{onClick:s[3]||(s[3]=a=>r.$emit("end-call")),class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[15]||(s[15]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),F(" End Call ",-1)])])])])):D("",!0),t.callEnded&&!t.isCallActive?(m(),x("div",tl,[e("div",sl,[s[18]||(s[18]=e("div",null,[e("h4",{class:"font-bold text-gray-900 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",ol,[e("button",{onClick:s[4]||(s[4]=a=>r.$emit("extract-information")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[16]||(s[16]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),F(" Extract information ",-1)])]),e("button",{onClick:s[5]||(s[5]=a=>r.$emit("log-manual-call")),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[17]||(s[17]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),F(" Log outcome ",-1)])])])])])):D("",!0)])):D("",!0)]))}},ll={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},al={class:"flex justify-between items-start mb-3"},il={class:"font-bold text-gray-900 text-sm"},rl={class:"text-xs text-gray-500 mt-0.5"},dl={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},ul={class:"text-xs text-blue-700"},cl={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},pl={class:"flex items-center justify-between"},ml={class:"flex items-center gap-2"},yl={class:"text-xs font-bold text-gray-900"},gl={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},fl={class:"flex items-center gap-2 mb-3"},vl={class:"text-sm text-gray-700 font-medium"},bl={key:2,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},hl={class:"grid grid-cols-3 gap-2"},xl={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},wl={class:"grid grid-cols-4 gap-2"},kl=["onClick"],Cl={key:0},$l={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Sl={class:"text-xs text-gray-700"},Al={class:"grid grid-cols-3 gap-2"},Dl={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Tl={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},Il={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Ll={class:"flex gap-4"},Ol={class:"flex items-center gap-2 cursor-pointer"},ql={class:"flex items-center gap-2 cursor-pointer"},Nl={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},Ml=["disabled"],Rl={key:2,class:"space-y-4"},Fl={class:"bg-white border border-gray-200 rounded-lg p-4"},Vl={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Bl=["value"],Ul=["value"],Wl=["value"],jl={class:"bg-white border border-gray-200 rounded-lg p-4"},El={class:"flex gap-2"},Pl={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Hl={class:"grid grid-cols-2 gap-3 text-sm mb-3"},zl={class:"ml-2 font-medium text-gray-900"},Ql={class:"ml-2 font-medium text-gray-900"},Yl={class:"ml-2 font-medium text-gray-900 capitalize"},Kl={class:"ml-2 font-medium text-gray-900"},Gl={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},Jl={class:"space-y-2"},Xl=["checked"],Zl=["checked","disabled"],_l={class:"flex-1"},ea={class:"text-xs text-gray-500 mt-0.5"},ta={class:"space-y-3"},sa={class:"grid grid-cols-2 gap-3 text-sm"},oa={class:"ml-2 font-medium text-gray-900"},na={class:"ml-2 font-medium text-gray-900"},la={class:"ml-2 font-medium text-gray-900 capitalize"},aa={class:"ml-2 font-medium text-gray-900"},ia={key:0,class:"text-sm"},ra={class:"ml-2 font-medium text-gray-900"},da={key:1,class:"text-sm"},ua={class:"mt-1 text-gray-700"},ca={class:"flex justify-between items-center pt-3 border-t border-gray-200"},pa={class:"flex gap-2"},ma={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:r}){const s=t,a=ie=>{ie||(me.value=!1)},l=r,o=Xe(),c=je();Ie();const u=At(()=>s.lead,{}),b=On(),{isCallActive:p,callEnded:d,callDuration:i,callNotes:y,callData:w,extractedData:h,mockTranscription:N,formattedCallDuration:R,startCall:C,endCall:k,extractInformation:v}=b,g=O(null),A=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],V=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],P=L(()=>o.assignableUsers),Y=L(()=>c.currentUser),Z=()=>{C()},oe=ie=>{y.value=ie},be=L(()=>{var ie;return((ie=u.primaryAction.value)==null?void 0:ie.title)||"Call to Verify Contact Details"}),H=L(()=>{var ie;return((ie=u.primaryAction.value)==null?void 0:ie.description)||"Begin lead qualification by verifying customer contact information."}),ye=L(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),fe=L(()=>!!s.lead.scheduledAppointment),he=L(()=>fe.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:ye.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${ht(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),K=u.contactAttempts,G=u.maxContactAttempts,ge=qn(Ue(s,"lead"),w,h,K,G,Y),{showOutcomeSelection:xe,selectedOutcome:ue,appointmentScheduled:te,scheduledAppointmentData:ne,showNoteModal:me,showScheduleAppointmentModal:W,followupChannels:U,followupChannel:ee,selectedTemplate:Ee,rescheduleTime:ke,customDate:$,customTime:B,disqualifyCategory:J,disqualifyReason:le,assignment:q,messagePreview:Q,hasExistingAppointment:de,selectOutcome:Te,cancelOutcome:Ve}=ge;L(()=>s.activities.filter(ie=>ie.type==="note"));const It=Nn(l,b,ge,Ue(s,"lead"),K,G),{logManualCall:Lt,handleScheduleAppointmentConfirm:Ot,handleQualify:at,handleDisqualifyFromInterested:it,handleNoAnswerConfirm:rt,handleNotValidConfirm:dt,handleNoteSave:qt}=It;return(ie,f)=>(m(),x("div",ll,[e("div",al,[e("div",null,[e("h4",il,S(be.value),1),e("p",rl,S(H.value),1)]),e("div",{class:j(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",he.value.class])},S(he.value.text),3)]),fe.value?(m(),x("div",dl,[f[33]||(f[33]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",ul,S(n(We)(t.lead.scheduledAppointment.start))+" at "+S(n(Pe)(t.lead.scheduledAppointment.start)),1)])):D("",!0),n(K)>0?(m(),x("div",cl,[e("div",pl,[e("div",ml,[f[34]||(f[34]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),f[35]||(f[35]=e("span",{class:"text-xs font-semibold text-gray-700"},"Contact Attempts:",-1)),e("span",yl,S(n(K))+" / "+S(n(G)),1)]),n(K)>=n(G)-1?(m(),x("div",gl,[...f[36]||(f[36]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),F(" One more attempt before auto-disqualification ",-1)])])):D("",!0)])])):D("",!0),e("div",fl,[e("span",vl,S(t.lead.customer.phone),1),e("button",{onClick:f[0]||(f[0]=(...M)=>ie.copyNumber&&ie.copyNumber(...M)),class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...f[37]||(f[37]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),I(nl,{"is-call-active":n(p),"call-ended":n(d),"call-duration":n(i),"call-notes":n(y),"formatted-call-duration":n(R),"mock-transcription":n(N),"show-outcome-selection":n(xe),"contact-attempts":n(K),"max-contact-attempts":n(G),onStartCall:Z,onEndCall:n(k),onLogManualCall:n(Lt),onExtractInformation:n(v),"onUpdate:callNotes":oe},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),n(xe)?(m(),x("div",bl,[e("div",null,[f[41]||(f[41]=e("h4",{class:"font-semibold text-gray-900 mb-2 text-sm"},"What's the outcome?",-1)),e("div",hl,[e("button",{onClick:f[1]||(f[1]=M=>n(Te)("no-answer")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",n(ue)==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...f[38]||(f[38]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:f[2]||(f[2]=M=>n(Te)("not-valid")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",n(ue)==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...f[39]||(f[39]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:f[3]||(f[3]=M=>n(Te)("interested")),class:j(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",n(ue)==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...f[40]||(f[40]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),n(ue)==="no-answer"?(m(),x("div",xl,[f[49]||(f[49]=e("h5",{class:"font-semibold text-gray-900 text-sm"},"Send follow-up message",-1)),e("div",wl,[(m(!0),x(re,null,ce(n(U),M=>(m(),x("button",{key:M.value,onClick:Ze=>ee.value=M.value,class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",n(ee)===M.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},S(M.label),11,kl))),128))]),n(ee)&&n(ee)!=="dont-send"?(m(),x("div",Cl,[f[44]||(f[44]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),z(e("select",{"onUpdate:modelValue":f[4]||(f[4]=M=>Be(Ee)?Ee.value=M:null),class:"input"},[...f[42]||(f[42]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[we,n(Ee)]]),e("div",$l,[f[43]||(f[43]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",Sl,S(n(Q)),1)])])):D("",!0),e("div",null,[f[47]||(f[47]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-2"},"Next call attempt",-1)),e("div",Al,[e("button",{onClick:f[5]||(f[5]=M=>ke.value="tomorrow-9am"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",n(ke)==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:f[6]||(f[6]=M=>ke.value="monday"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",n(ke)==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:f[7]||(f[7]=M=>ke.value="custom"),class:j(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",n(ke)==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),n(ke)==="custom"?(m(),x("div",Dl,[e("div",null,[f[45]||(f[45]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":f[8]||(f[8]=M=>Be($)?$.value=M:null),class:"input"},null,512),[[ae,n($)]])]),e("div",null,[f[46]||(f[46]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),z(e("input",{type:"time","onUpdate:modelValue":f[9]||(f[9]=M=>Be(B)?B.value=M:null),class:"input"},null,512),[[ae,n(B)]])])])):D("",!0)]),e("div",Tl,[e("button",{onClick:f[10]||(f[10]=(...M)=>n(Ve)&&n(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:f[11]||(f[11]=(...M)=>n(rt)&&n(rt)(...M)),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...f[48]||(f[48]=[F(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):D("",!0),n(ue)==="not-valid"?(m(),x("div",Il,[e("div",null,[f[52]||(f[52]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",Ll,[e("label",Ol,[z(e("input",{type:"radio","onUpdate:modelValue":f[12]||(f[12]=M=>Be(J)?J.value=M:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,n(J)]]),f[50]||(f[50]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",ql,[z(e("input",{type:"radio","onUpdate:modelValue":f[13]||(f[13]=M=>Be(J)?J.value=M:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,n(J)]]),f[51]||(f[51]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[f[54]||(f[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),z(e("select",{"onUpdate:modelValue":f[14]||(f[14]=M=>Be(le)?le.value=M:null),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...f[53]||(f[53]=[Ke('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[we,n(le)]])]),e("div",Nl,[e("button",{onClick:f[15]||(f[15]=(...M)=>n(Ve)&&n(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:f[16]||(f[16]=(...M)=>n(dt)&&n(dt)(...M)),disabled:!n(J)||!n(le),class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,Ml)])])):D("",!0),n(ue)==="interested"?(m(),x("div",Rl,[e("div",Fl,[f[58]||(f[58]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-3"},"Assign to salesman",-1)),e("div",Vl,[e("div",null,[f[55]||(f[55]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),z(e("select",{"onUpdate:modelValue":f[17]||(f[17]=M=>n(q).dealership=M),class:"input"},[(m(),x(re,null,ce(A,M=>e("option",{key:M,value:M},S(M),9,Bl)),64))],512),[[we,n(q).dealership]])]),e("div",null,[f[56]||(f[56]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),z(e("select",{"onUpdate:modelValue":f[18]||(f[18]=M=>n(q).team=M),class:"input"},[(m(),x(re,null,ce(V,M=>e("option",{key:M,value:M},S(M),9,Ul)),64))],512),[[we,n(q).team]])]),e("div",null,[f[57]||(f[57]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),z(e("select",{"onUpdate:modelValue":f[19]||(f[19]=M=>n(q).assigneeId=M),class:"input"},[(m(!0),x(re,null,ce(P.value,M=>(m(),x("option",{key:M.id,value:M.id},S(M.name)+S(M.id===Y.value.id?" (Me)":""),9,Wl))),128))],512),[[we,n(q).assigneeId]])])])]),e("div",jl,[f[62]||(f[62]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-3"},"Customer preferences",-1)),e("div",El,[e("button",{onClick:f[20]||(f[20]=M=>l("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...f[59]||(f[59]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add purchase method ",-1)])]),e("button",{onClick:f[21]||(f[21]=M=>l("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...f[60]||(f[60]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add trade-in ",-1)])]),e("button",{onClick:f[22]||(f[22]=M=>me.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...f[61]||(f[61]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),F(" Add note ",-1)])])])]),n(de)&&!n(te)?(m(),x("div",Pl,[f[68]||(f[68]=Ke('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-gray-900">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Hl,[e("div",null,[f[63]||(f[63]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",zl,S(n(We)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[f[64]||(f[64]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Ql,S(n(Pe)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[f[65]||(f[65]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Yl,S(t.lead.scheduledAppointment.type),1)]),e("div",null,[f[66]||(f[66]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Kl,S(t.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:f[23]||(f[23]=M=>W.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...f[67]||(f[67]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),F(" Reschedule Appointment ",-1)])])])):D("",!0),n(de)?D("",!0):(m(),x("div",Gl,[f[71]||(f[71]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",Jl,[e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!n(te)}])},[e("input",{type:"radio",checked:!n(te),onChange:f[24]||(f[24]=()=>{te.value=!1,ne.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Xl),f[69]||(f[69]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-gray-900"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:j(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":n(te)}]),onClick:f[26]||(f[26]=M=>!n(te)&&(W.value=!0))},[e("input",{type:"radio",checked:n(te),disabled:!n(te),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Zl),e("div",_l,[f[70]||(f[70]=e("div",{class:"text-sm font-semibold text-gray-900"},"Schedule Appointment",-1)),e("div",ea,S(n(te)?"Appointment scheduled":"Book a meeting or test drive"),1)]),n(te)?(m(),x("button",{key:0,onClick:f[25]||(f[25]=Se(M=>W.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):D("",!0)],2)])])),n(te)?(m(),E(Ln,{key:2,title:"Scheduled Appointment","show-close":!1},{default:T(()=>[e("div",ta,[e("div",sa,[e("div",null,[f[72]||(f[72]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",oa,S(n(We)(n(ne).datetime)),1)]),e("div",null,[f[73]||(f[73]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",na,S(n(ne).time),1)]),e("div",null,[f[74]||(f[74]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",la,S(n(ne).type),1)]),e("div",null,[f[75]||(f[75]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",aa,S(n(ne).assignee),1)])]),n(ne).location?(m(),x("div",ia,[f[76]||(f[76]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",ra,S(n(ne).location),1)])):D("",!0),n(ne).notes?(m(),x("div",da,[f[77]||(f[77]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",ua,S(n(ne).notes),1)])):D("",!0)])]),_:1})):D("",!0),e("div",ca,[e("button",{onClick:f[27]||(f[27]=(...M)=>n(Ve)&&n(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",pa,[e("button",{onClick:f[28]||(f[28]=(...M)=>n(it)&&n(it)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...f[78]||(f[78]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),F(" Disqualify ",-1)])]),e("button",{onClick:f[29]||(f[29]=(...M)=>n(at)&&n(at)(...M)),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...f[79]||(f[79]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),F(" Qualify ",-1)])])])])])):D("",!0)])):D("",!0),I(n(Fe),{open:n(me),"onUpdate:open":a},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-2xl"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...f[80]||(f[80]=[F("Add Note",-1)])]),_:1})]),_:1}),I(Wt,{ref_key:"noteWidgetRef",ref:g,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(qt),onCancel:f[30]||(f[30]=M=>me.value=!1)},null,8,["task-id","onSave"]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>{var M,Ze;return[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f[31]||(f[31]=Xi=>me.value=!1)}),I(n(pe),{label:"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!((M=g.value)!=null&&M.canSubmit()),onClick:(Ze=g.value)==null?void 0:Ze.submit},null,8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),I(An,{show:n(W),onConfirm:n(Ot),onClose:f[32]||(f[32]=M=>W.value=!1)},null,8,["show","onConfirm"])]))}},ya={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},ga={class:"flex justify-between items-start mb-3"},fa={class:"text-xs text-gray-500 mt-0.5"},va={key:0},ba={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:r}){const s=t,a=r,l=He(),o=()=>{var v;const k=l.currentLead;return k&&k.id===((v=s.lead)==null?void 0:v.id)?k:s.lead},c={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},u=At(Ue(s,"lead"),c),{handlePostponed:b,handleValidated:p,handleQualified:d,handleCallAttemptLogged:i,handleNoteSaved:y,handleOpenPurchaseMethod:w,handleOpenTradeIn:h,handleAppointmentScheduled:N,handleDisqualified:R,handleReopen:C}=an({getLead:o,leadState:u,emit:a});return(k,v)=>(m(),E(Dt,{task:t.lead},{"deadline-banner":T(()=>[I(fn,{"next-action-due":t.lead.nextActionDue,"is-closed":n(u).isClosed.value,"show-deadline-banner":n(u).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":T(()=>[!n(u).isClosed.value&&n(u).showLQWidget.value?(m(),E(ma,{key:t.lead.id,lead:t.lead,onPostponed:n(b),onValidated:n(p),onQualified:n(d),onDisqualified:n(R),onCallAttemptLogged:n(i),onNoteSaved:n(y),onOpenPurchaseMethod:n(w),onOpenTradeIn:n(h),onAppointmentScheduled:n(N)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(u).isClosed.value&&n(u).primaryAction.value?(m(),E(Tt,{key:1,action:n(u).primaryAction.value,"color-scheme":n(u).primaryAction.value.colorScheme,onActionClicked:n(u).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):D("",!0)]),"task-widgets":T(()=>[...v[1]||(v[1]=[])]),"closed-state":T(()=>[n(u).isClosed.value?(m(),x("div",ya,[e("div",ga,[e("div",null,[v[2]||(v[2]=e("h4",{class:"font-bold text-gray-900 text-sm"},"Lead Closed",-1)),e("p",fa,[F(" Status: "+S(n(u).displayStage.value)+" ",1),t.lead.disqualifyReason?(m(),x("span",va," - "+S(t.lead.disqualifyReason),1)):D("",!0)])])]),e("button",{onClick:v[0]||(v[0]=(...g)=>n(C)&&n(C)(...g)),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...v[3]||(v[3]=[F(" Reopen Lead ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):D("",!0)]),_:1},8,["task"]))}},ha={class:"flex justify-between items-start mb-3"},xa={class:"font-bold text-gray-900 text-sm"},wa={class:"text-xs text-gray-500 mt-0.5"},ka={class:"flex gap-3 flex-wrap"},Ae={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(r,s)=>(m(),x("div",{class:j(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",ha,[e("div",null,[e("h4",xa,S(t.title),1),e("p",wa,S(t.description),1)]),X(r.$slots,"badge")]),e("div",ka,[X(r.$slots,"actions")]),X(r.$slots,"survey"),X(r.$slots,"content")],2))}},Ca={class:"mt-1.5 border-t border-gray-200 pt-1.5"},$a={key:1},Sa={class:"flex items-center justify-between mb-1.5"},Aa={class:"space-y-1.5"},Da={class:"block label-upper mb-1"},Ta=["onUpdate:modelValue","placeholder"],Ia=["onUpdate:modelValue"],La=["value"],Oa={key:2,class:"space-y-0.5"},qa=["onUpdate:modelValue","value"],De={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=O(!1),o=O({});ve(()=>s.questions,d=>{const i={};d.forEach(y=>{i[y.key]=""}),o.value=i},{immediate:!0});const c=()=>{a("survey-completed",{...o.value}),p()},u=()=>{a("survey-refused"),p()},b=()=>{a("not-responding"),p()},p=()=>{l.value=!1;const d={};s.questions.forEach(i=>{d[i.key]=""}),o.value=d};return(d,i)=>(m(),x("div",Ca,[l.value?(m(),x("div",$a,[e("div",Sa,[i[4]||(i[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:i[1]||(i[1]=y=>l.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-chevron-up text-xs"},null,-1)])])]),e("div",Aa,[(m(!0),x(re,null,ce(t.questions,(y,w)=>(m(),x("div",{key:w,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Da,S(y.label),1),y.type==="text"?z((m(),x("textarea",{key:0,"onUpdate:modelValue":h=>o.value[y.key]=h,placeholder:y.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Ta)),[[ae,o.value[y.key]]]):y.type==="select"?z((m(),x("select",{key:1,"onUpdate:modelValue":h=>o.value[y.key]=h,class:"input text-xs py-1 px-2"},[i[5]||(i[5]=e("option",{value:""},"Select an option...",-1)),(m(!0),x(re,null,ce(y.options,h=>(m(),x("option",{key:h,value:h},S(h),9,La))),128))],8,Ia)),[[we,o.value[y.key]]]):y.type==="radio"?(m(),x("div",Oa,[(m(!0),x(re,null,ce(y.options,h=>(m(),x("label",{key:h,class:"flex items-center text-xs"},[z(e("input",{type:"radio","onUpdate:modelValue":N=>o.value[y.key]=N,value:h,class:"mr-1"},null,8,qa),[[et,o.value[y.key]]]),F(" "+S(h),1)]))),128))])):D("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:b,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(m(),x("button",{key:0,onClick:i[0]||(i[0]=y=>l.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...i[2]||(i[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1)])]))]))}},Na={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],o=L(()=>{if(!s.opportunity.createdAt)return 0;const i=new Date(s.opportunity.createdAt),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),c=()=>{a("create-offer",s.opportunity)},u=()=>{a("review",s.opportunity)},b=i=>{a("survey-completed",{opportunity:s.opportunity,responses:i})},p=()=>{a("survey-refused",{opportunity:s.opportunity})},d=()=>{a("not-responding",{opportunity:s.opportunity})};return(i,y)=>(m(),E(Ae,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${o.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:b,onSurveyRefused:p,onNotResponding:d})]),_:1},8,["description"]))}},Ma={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],o=L(()=>{if(!s.opportunity.createdAt)return 0;const d=new Date(s.opportunity.createdAt),y=Math.abs(new Date-d);return Math.ceil(y/(1e3*60*60*24))}),c=()=>{a("create-offer",s.opportunity)},u=d=>{a("survey-completed",{opportunity:s.opportunity,responses:d})},b=()=>{a("survey-refused",{opportunity:s.opportunity})},p=()=>{a("not-responding",{opportunity:s.opportunity})};return(d,i)=>(m(),E(Ae,{title:"Unsold Feedback",description:`This opportunity has been open for ${o.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:u,onSurveyRefused:b,onNotResponding:p})]),_:1},8,["description"]))}},Ra={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],o=()=>{a("schedule-closing",s.opportunity)},c=p=>{a("survey-completed",{opportunity:s.opportunity,responses:p})},u=()=>{a("survey-refused",{opportunity:s.opportunity})},b=()=>{a("not-responding",{opportunity:s.opportunity})};return(p,d)=>(m(),E(Ae,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:T(()=>[e("button",{onClick:o,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:c,onSurveyRefused:u,onNotResponding:b})]),_:1}))}},Fa={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],o=L(()=>{const d=s.opportunity.lastActivity||s.opportunity.createdAt;if(!d)return 0;const i=new Date(d),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),c=()=>{a("create-contract",s.opportunity)},u=d=>{a("survey-completed",{opportunity:s.opportunity,responses:d})},b=()=>{a("survey-refused",{opportunity:s.opportunity})},p=()=>{a("not-responding",{opportunity:s.opportunity})};return(d,i)=>(m(),E(Ae,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${o.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:u,onSurveyRefused:b,onNotResponding:p})]),_:1},8,["description"]))}},Va={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],o=L(()=>{var h;if(!((h=s.opportunity)!=null&&h.contractDate))return 0;const i=new Date(s.opportunity.contractDate),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),c=()=>{a("prepare-delivery",s.opportunity)},u=()=>{a("pre-delivery-checklist",s.opportunity)},b=i=>{a("survey-completed",{opportunity:s.opportunity,responses:i})},p=()=>{a("survey-refused",{opportunity:s.opportunity})},d=()=>{a("not-responding",{opportunity:s.opportunity})};return(i,y)=>(m(),E(Ae,{title:"Contract Feedback",description:`Contract was signed ${o.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:b,onSurveyRefused:p,onNotResponding:d})]),_:1},8,["description"]))}},Ba={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r,l=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],o=L(()=>{const d=s.activities.find(h=>{var N;return h.type==="delivery"||((N=h.action)==null?void 0:N.toLowerCase().includes("delivered"))});if(!d||!d.timestamp)return 0;const i=new Date(d.timestamp),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),c=()=>{a("delivery-feedback",s.opportunity)},u=d=>{a("survey-completed",{opportunity:s.opportunity,responses:d})},b=()=>{a("survey-refused",{opportunity:s.opportunity})},p=()=>{a("not-responding",{opportunity:s.opportunity})};return(d,i)=>(m(),E(Ae,{title:"Delivery Feedback",description:`Vehicle was delivered ${o.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:u,onSurveyRefused:b,onNotResponding:p})]),_:1},8,["description"]))}},Ua={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:r}){const s=t,a=r,l=L(()=>{var h;return((h=s.scheduledAppointment)==null?void 0:h.noShowCount)||0}),o=L(()=>{const h=l.value;return h===0?"No-Show Follow-up":h>=3?`No-Show #${h} - Final Warning`:`No-Show #${h} Follow-up`}),c=L(()=>{const h=l.value;return h>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":h>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),u=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],b=L(()=>{var N;return(N=s.scheduledAppointment)!=null&&N.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),p=()=>{a("contact-customer",s.opportunity)},d=()=>{const h=l.value;if(h>=3)a("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${h} no-shows`});else if(h===1||h===2){const N=new Date;N.setDate(N.getDate()+2),a("set-callback",{opportunity:s.opportunity,callbackDate:N.toISOString()})}else a("reschedule",s.opportunity)},i=h=>{a("survey-completed",{opportunity:s.opportunity,responses:h})},y=()=>{a("survey-refused",{opportunity:s.opportunity})},w=()=>{a("not-responding",{opportunity:s.opportunity})};return(h,N)=>(m(),E(Ae,{title:o.value,description:`Appointment was scheduled for ${b.value} but customer did not show up. ${c.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:T(()=>[e("button",{onClick:d,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...N[0]||(N[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),F(" Book Another Appointment ",-1)])]),e("button",{onClick:p,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...N[1]||(N[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),F(" Contact Customer ",-1)])])]),survey:T(()=>[I(De,{questions:u,onSurveyCompleted:i,onSurveyRefused:y,onNotResponding:w})]),_:1},8,["title","description"]))}},Wa={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:r}){const s=t,a=r;Ie();const l=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],o=L(()=>{const y=s.opportunity.lastActivity||s.opportunity.createdAt;if(!y)return 0;const w=new Date(y),N=Math.abs(new Date-w);return Math.ceil(N/(1e3*60*60*24))}),c=()=>{a("reopen",s.opportunity)},u=()=>{a("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},b=()=>{a("requalify",s.opportunity)},p=y=>{a("survey-completed",{opportunity:s.opportunity,responses:y})},d=()=>{a("survey-refused",{opportunity:s.opportunity})},i=()=>{a("not-responding",{opportunity:s.opportunity})};return(y,w)=>(m(),E(Ae,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${o.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-gray-50/50",border:"border-gray-100"}},{actions:T(()=>[e("button",{onClick:c,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...w[0]||(w[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),F(" Reopen Opportunity ",-1)])]),e("button",{onClick:u,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),F(" Close as Lost ",-1)])]),e("button",{onClick:b,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...w[2]||(w[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),F(" Requalify as Lead ",-1)])])]),survey:T(()=>[I(De,{questions:l,onSurveyCompleted:p,onSurveyRefused:d,onNotResponding:i})]),_:1},8,["description"]))}},ja={OOFB:Na,UFB:Ma,NFU:Ra,OFB:Fa,CFB:Va,DFB:Ba,NS:Ua,ABANDONED:Wa};function Ea(t,r,s,a,l){const o=L(()=>{const y=Qe(t),w=Qe(r),h=Qe(s);return{opportunity:y,scheduledAppointment:w,activities:h,hasOffers:(h==null?void 0:h.some(N=>N.type==="offer"))||!1,stage:y.displayStage||y.stage,deliverySubstatus:y.deliverySubstatus||null,formatDateTime:l,hasActiveTaskWidget:!1}}),c=L(()=>{const y=o.value,w=jt(y.stage,y);if(!w)return null;const h=ja[w];return h?{type:w,component:h,props:{opportunity:y.opportunity,appointment:y.scheduledAppointment,activities:y.activities}}:(console.warn(`No component found for widget type: ${w}`),null)}),u=L(()=>({...o.value,hasActiveTaskWidget:!!c.value})),b=L(()=>{const y=u.value,w=Et(y.stage,y);if(!w)return null;const h=a[w.key];return{...w,handler:h||(()=>console.warn(`No handler for action: ${w.key}`))}}),p=L(()=>{const y=u.value;return Pt(y.stage,y).map(h=>{const N=a[h.key];return{...h,handler:N||(()=>console.warn(`No handler for action: ${h.key}`))}})}),d=L(()=>{const y=o.value;return Ht(y.stage)}),i=L(()=>!c.value||!c.value.type?"":zt(c.value.type));return{primaryAction:b,secondaryActions:p,activeTaskWidget:c,taskWidgetTitle:i,isClosed:d}}const Pa={class:"relative"},Ha=["disabled"],za={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-50",style:{"z-index":"9999"}},Qa={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:r}){const s=t,a=r,l=O(!1),o=()=>{l.value=!l.value},c=()=>{l.value=!1},u=p=>{p.disabled||(c(),a("action-selected",p),p.handler&&typeof p.handler=="function"&&p.handler())},b=L(()=>(s.actions||[]).map(p=>({key:p.key,label:p.label,disabled:!!p.disabled,onClick:()=>u(p)})));return(p,d)=>{const i=ot("click-outside");return z((m(),x("div",Pa,[e("button",{onClick:o,class:"w-auto bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[d[0]||(d[0]=e("span",null,"More actions",-1)),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":l.value}])},null,2)],8,Ha),I(yt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:T(()=>[l.value?(m(),x("div",za,[I(n(mt),{items:b.value,className:"min-w-full"},null,8,["items"])])):D("",!0)]),_:1})])),[[i,c]])}}},Ya={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},Ka=["src","alt"],Ga={key:1,class:"w-full h-full flex items-center justify-center"},Ja={class:"flex items-center justify-between mb-1.5"},Xa={class:"text-sm font-bold text-gray-900"},Za={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},_a={class:"text-xs text-gray-500 mb-1.5"},ei={key:0,class:"text-xs text-green-600 font-medium mb-2"},ti={key:1,class:"text-xs text-orange-600 font-medium mb-2"},pt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const r=t,s=L(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[r.badge]||"gray"),a=l=>l?l.toLocaleString("en-US"):"0";return(l,o)=>(m(),x("div",{onClick:o[1]||(o[1]=c=>l.$emit("select")),class:j(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":t.selected}])},[e("div",Ya,[t.vehicle.image?(m(),x("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Ka)):(m(),x("div",Ga,[...o[2]||(o[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",Ja,[I(n(Ye),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",Xa,"â‚¬"+S(a(t.vehicle.price)),1)]),e("h4",Za,S(t.vehicle.brand)+" "+S(t.vehicle.model),1),e("p",_a,S(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(m(),x("div",ei,[o[3]||(o[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),F(" In stock ("+S(t.stockDays)+" days) ",1)])):(m(),x("div",ti,[...o[4]||(o[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),F(" Out of stock ",-1)])])),e("button",{onClick:o[0]||(o[0]=Se(c=>l.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},si={class:"space-y-6"},oi={key:0},ni={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},li={class:"mb-4"},ai={class:"relative"},ii={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},ri={key:1,class:"text-center py-8 text-gray-500"},di={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},ui={key:0,class:"mt-4 space-y-3"},ci={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},pi={class:"flex justify-end"},mi=["disabled"],yi={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:r}){const s=t,a=r,l=v=>{v||a("close")},o=O(""),c=O(!1),u=O(null),b=O(null),p=O(null),d=O([]),i=O({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Ge(async()=>{try{const v=await wt({});d.value=v.data||[]}catch(v){console.error("Failed to load vehicles:",v),d.value=[]}});const y=L(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),w=L(()=>{const v=[];if(s.requestedVehicle&&y.value&&v.push({...s.requestedVehicle,isRequested:!0}),d.value&&d.value.length>0){const g=d.value.filter(V=>s.requestedVehicle?V.brand!==s.requestedVehicle.brand||V.model!==s.requestedVehicle.model:!0),A=s.requestedVehicle&&y.value?3:4;v.push(...g.slice(0,A))}return v}),h=L(()=>{if(!d.value||d.value.length===0)return[];let v=[...d.value];if(o.value){const g=o.value.toLowerCase();v=v.filter(A=>A.brand.toLowerCase().includes(g)||A.model.toLowerCase().includes(g)||A.year.toString().includes(g))}return v}),N=L(()=>i.value.brand&&i.value.model&&i.value.year&&i.value.price>0),R=(v,g)=>{u.value=v,b.value=v.id||`custom-${Date.now()}`,p.value=g},C=()=>{if(!N.value)return;const v={...i.value,id:`custom-${Date.now()}`,isCustom:!0};R(v,"custom")},k=()=>{u.value&&(a("vehicle-selected",{vehicle:u.value,type:p.value}),a("close"),u.value=null,b.value=null,p.value=null,o.value="",c.value=!1,i.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(v,g)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":l},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-6xl"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...g[7]||(g[7]=[F("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",si,[w.value.length?(m(),x("div",oi,[g[8]||(g[8]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),F(" Recommended Vehicles ")],-1)),e("div",ni,[(m(!0),x(re,null,ce(w.value,A=>(m(),E(pt,{key:A.id,vehicle:A,badge:A.isRequested?"Requested":"Recommended","stock-days":A.stockDays,selected:b.value===A.id,onSelect:V=>R(A,A.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):D("",!0),e("div",null,[g[11]||(g[11]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),F(" Browse Stock ")],-1)),e("div",li,[e("div",ai,[g[9]||(g[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),z(e("input",{"onUpdate:modelValue":g[0]||(g[0]=A=>o.value=A),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ae,o.value]])])]),h.value.length?(m(),x("div",ii,[(m(!0),x(re,null,ce(h.value,A=>(m(),E(pt,{key:A.id,vehicle:A,badge:"In Stock","stock-days":A.stockDays,selected:b.value===A.id,onSelect:V=>R(A,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(m(),x("div",ri,[...g[10]||(g[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[g[19]||(g[19]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),F(" Configure Custom Vehicle ")],-1)),e("div",di,[g[18]||(g[18]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:g[1]||(g[1]=A=>c.value=!c.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[g[12]||(g[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),F(" "+S(c.value?"Hide Configuration":"Build Custom Configuration"),1)]),c.value?(m(),x("div",ui,[e("div",ci,[e("div",null,[g[13]||(g[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),z(e("input",{"onUpdate:modelValue":g[2]||(g[2]=A=>i.value.brand=A),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ae,i.value.brand]])]),e("div",null,[g[14]||(g[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),z(e("input",{"onUpdate:modelValue":g[3]||(g[3]=A=>i.value.model=A),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ae,i.value.model]])]),e("div",null,[g[15]||(g[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),z(e("input",{"onUpdate:modelValue":g[4]||(g[4]=A=>i.value.year=A),type:"number",class:"input",placeholder:"2024"},null,512),[[ae,i.value.year]])]),e("div",null,[g[16]||(g[16]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (â‚¬)",-1)),z(e("input",{"onUpdate:modelValue":g[5]||(g[5]=A=>i.value.price=A),type:"number",class:"input",placeholder:"98000"},null,512),[[ae,i.value.price]])])]),e("div",pi,[e("button",{onClick:C,disabled:!N.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...g[17]||(g[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),F(" Use Custom Configuration ",-1)])],8,mi)])])):D("",!0)])])]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:g[6]||(g[6]=A=>v.$emit("close"))}),u.value?(m(),E(n(pe),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k})):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},gi={class:"space-y-4"},fi=["max"],vi={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,a=r,l=O(""),o=O(""),c=O(""),u=L(()=>new Date().toISOString().split("T")[0]);ve(()=>s.show,i=>{if(i){const y=new Date;l.value=y.toISOString().split("T")[0],o.value=y.toTimeString().slice(0,5),c.value=""}});const b=()=>{if(!l.value)return;const i=o.value?`${l.value}T${o.value}:00`:`${l.value}T12:00:00`;a("confirm",{contractDate:i,notes:c.value})},p=()=>{a("cancel")},d=i=>{i||p()};return(i,y)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":d},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...y[3]||(y[3]=[F("Set Contract Signing Date",-1)])]),_:1}),I(n(ze),null,{default:T(()=>[...y[4]||(y[4]=[F("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",gi,[e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=w=>l.value=w),max:u.value,class:"input"},null,8,fi),[[ae,l.value]])]),e("div",null,[y[6]||(y[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),z(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=w=>o.value=w),class:"input"},null,512),[[ae,o.value]])]),e("div",null,[y[7]||(y[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),z(e("textarea",{"onUpdate:modelValue":y[2]||(y[2]=w=>c.value=w),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ae,c.value]])])]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:p}),I(n(pe),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!l.value,onClick:b},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},bi={class:"space-y-4"},hi=["max"],xi={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,a=r,l=O(""),o=O(""),c=O(""),u=O(""),b=L(()=>new Date().toISOString().split("T")[0]);ve(()=>s.show,y=>{if(y){const w=new Date;l.value=w.toISOString().split("T")[0],o.value=w.toTimeString().slice(0,5),c.value="",u.value=""}});const p=()=>{if(!l.value||!c.value)return;const y=o.value?`${l.value}T${o.value}:00`:`${l.value}T12:00:00`;a("confirm",{deliveryDate:y,location:c.value,notes:u.value})},d=()=>{a("cancel")},i=y=>{y||d()};return(y,w)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":i},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...w[4]||(w[4]=[F("Mark as Delivered",-1)])]),_:1}),I(n(ze),null,{default:T(()=>[...w[5]||(w[5]=[F("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",bi,[e("div",null,[w[6]||(w[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":w[0]||(w[0]=h=>l.value=h),max:b.value,class:"input"},null,8,hi),[[ae,l.value]])]),e("div",null,[w[7]||(w[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),z(e("input",{type:"time","onUpdate:modelValue":w[1]||(w[1]=h=>o.value=h),class:"input"},null,512),[[ae,o.value]])]),e("div",null,[w[9]||(w[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),z(e("select",{"onUpdate:modelValue":w[2]||(w[2]=h=>c.value=h),class:"input"},[...w[8]||(w[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[we,c.value]])]),e("div",null,[w[10]||(w[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),z(e("textarea",{"onUpdate:modelValue":w[3]||(w[3]=h=>u.value=h),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ae,u.value]])])]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),I(n(pe),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!l.value||!c.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},wi={class:"space-y-4"},ki={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=t,a=r,l=O(""),o=O("");ve(()=>s.show,p=>{p&&(l.value="",o.value="")});const c=()=>{l.value&&a("confirm",{reason:l.value,notes:o.value})},u=()=>{a("cancel")},b=p=>{p||u()};return(p,d)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":b},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...d[2]||(d[2]=[F("Close as Lost",-1)])]),_:1}),I(n(ze),null,{default:T(()=>[...d[3]||(d[3]=[F("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",wi,[e("div",null,[d[5]||(d[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),z(e("select",{"onUpdate:modelValue":d[0]||(d[0]=i=>l.value=i),class:"input"},[...d[4]||(d[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[we,l.value]])]),e("div",null,[d[6]||(d[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),z(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=i=>o.value=i),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ae,o.value]])])]),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u}),I(n(pe),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!l.value,onClick:c},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ci={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:r}){const s=r,a=l=>{l||s("cancel")};return(l,o)=>(m(),E(n(Fe),{open:t.show,"onUpdate:open":a},{default:T(()=>[I(n(Le),null,{default:T(()=>[I(n(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),I(n(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[I(n(Ne),null,{default:T(()=>[I(n(Me),null,{default:T(()=>[...o[2]||(o[2]=[F("Requalify as Lead",-1)])]),_:1}),I(n(ze),null,{default:T(()=>[...o[3]||(o[3]=[F("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),o[4]||(o[4]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-sm text-gray-600"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),F(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),F(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),F(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),I(n(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[I(n(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:o[0]||(o[0]=c=>l.$emit("cancel"))}),I(n(pe),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:o[1]||(o[1]=c=>l.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$i={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},Si={class:"flex gap-3"},Ai={key:0,class:"space-y-3"},Di={class:"flex items-center gap-2 pb-2 border-b border-gray-200"},Ti={class:"font-semibold text-gray-900 text-sm"},Ii={key:0,class:"flex justify-end"},Li={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:r}){const s=t,a=r,l=nt(),o=Je(),c=O(!1),u=O(!1),b=O(!1),p=O(!1),d=O(!1),i=O(!1),y=O(!1),w=O(!1),h=O(!1),N=O(!1),R=O([]),C=L(()=>{var W,U;return((W=s.opportunity)==null?void 0:W.displayStage)||((U=s.opportunity)==null?void 0:U.stage)||"Qualified"});L(()=>gt(C.value,"opportunity"));function k(W){return W?new Date(W).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const v={"schedule-appointment":()=>{c.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?h.value=!0:c.value=!0},"select-vehicle":()=>{y.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?y.value=!0:u.value=!0},"call-prospect":()=>{w.value=!0},"follow-up-offer":()=>{w.value=!0},"request-decision":()=>{w.value=!0},"finalize-contract":()=>{p.value=!0},"schedule-delivery":()=>{d.value=!0},"confirm-delivery":()=>{d.value=!0},"collect-feedback":()=>{w.value=!0},reschedule:()=>{N.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&fe()},"close-won":()=>{p.value=!0},"add-offer":()=>{u.value=!0},"add-contract":()=>{p.value=!0},"extend-deadline":()=>{w.value=!0},"close-lost":()=>{b.value=!0},reopen:()=>{ge()},requalify:()=>{i.value=!0}},{primaryAction:g,secondaryActions:A,activeTaskWidget:V,taskWidgetTitle:P,isClosed:Y}=Ea(Ue(s,"opportunity"),Ue(s,"scheduledAppointment"),Ue(s,"activities"),v,k);function Z(W){}function oe(){}function be(W){y.value=!1,a("vehicle-selected",W),setTimeout(()=>{u.value=!0},300)}function H(W){u.value=!1,a("offer-created",W)}function ye(W){c.value=!1,a("appointment-scheduled",{...W,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function fe(){s.scheduledAppointment&&a("appointment-cancelled",s.scheduledAppointment.id)}function he(W){p.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:W.contractDate})}function K(W){d.value=!1,o.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:W})}function G(W){b.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:W})}function ge(){o.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function xe(W){i.value=!1,l.push(`/customer/${W.id}?type=lead`)}function ue(W){h.value=!1}function te(W){N.value=!1}function ne(W){o.updateOpportunity(s.opportunity.id,{callbackDate:W.callbackDate})}function me(W){o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:W.reason||"Multiple no-shows (NS3)"})}return Ge(async()=>{try{const U=(await wt({})).data||[];R.value=U.filter(ee=>ee.stockDays!==null&&ee.stockDays!==void 0).slice(0,5)}catch(W){console.error("Failed to load recommended cars:",W),R.value=[]}}),(W,U)=>(m(),x(re,null,[I(Dt,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":T(()=>[n(Y)&&!n(V)?(m(),x("div",$i,[U[15]||(U[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-gray-900 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Si,[e("button",{onClick:ge,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...U[13]||(U[13]=[F(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:U[0]||(U[0]=ee=>i.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...U[14]||(U[14]=[F(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):D("",!0)]),"primary-action":T(()=>[!n(Y)&&n(g)?(m(),E(Tt,{key:0,action:n(g),"color-scheme":n(g).colorScheme,onActionClicked:U[1]||(U[1]=ee=>n(g).handler())},null,8,["action","color-scheme"])):D("",!0)]),"task-widgets":T(()=>[n(V)&&n(V).component?(m(),x("div",Ai,[e("div",Di,[U[16]||(U[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Ti,S(n(P)),1)]),(m(),E(Ft(n(V).component),ft(n(V).props,{onClose:oe,onSetCallback:ne,onAutoCloseLost:me}),null,16))])):D("",!0)]),"secondary-actions":T(()=>[n(A).length>0?(m(),x("div",Ii,[I(Qa,{actions:n(A),onActionSelected:Z},null,8,["actions"])])):D("",!0)]),_:1},8,["task"]),c.value?(m(),E(Kt,{key:0,show:c.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:ye,onCancel:U[2]||(U[2]=ee=>c.value=!1)},null,8,["show","customer","assignee"])):D("",!0),y.value?(m(),E(yi,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":R.value,onVehicleSelected:be,onClose:U[3]||(U[3]=ee=>y.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):D("",!0),u.value?(m(),E(Qt,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:H,onClose:U[4]||(U[4]=ee=>u.value=!1)},null,8,["opportunity","vehicle"])):D("",!0),p.value?(m(),E(vi,{key:3,opportunity:t.opportunity,onContractSet:he,onClose:U[5]||(U[5]=ee=>p.value=!1)},null,8,["opportunity"])):D("",!0),d.value?(m(),E(xi,{key:4,opportunity:t.opportunity,onDelivered:K,onClose:U[6]||(U[6]=ee=>d.value=!1)},null,8,["opportunity"])):D("",!0),b.value?(m(),E(ki,{key:5,opportunity:t.opportunity,onClosed:G,onClose:U[7]||(U[7]=ee=>b.value=!1)},null,8,["opportunity"])):D("",!0),i.value?(m(),E(Ci,{key:6,opportunity:t.opportunity,onRequalified:xe,onClose:U[8]||(U[8]=ee=>i.value=!1)},null,8,["opportunity"])):D("",!0),w.value?(m(),E(Yt,{key:7,onClose:U[9]||(U[9]=ee=>w.value=!1)})):D("",!0),h.value&&t.scheduledAppointment?(m(),E(Gt,{key:8,show:h.value,event:t.scheduledAppointment,onClose:U[10]||(U[10]=ee=>h.value=!1),onEdit:U[11]||(U[11]=ee=>{h.value=!1,N.value=!0}),onDelete:ue},null,8,["show","event"])):D("",!0),N.value&&t.scheduledAppointment?(m(),E(Jt,{key:9,show:N.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:te,onCancel:U[12]||(U[12]=ee=>N.value=!1)},null,8,["show","event","customer"])):D("",!0)],64))}};function Oi(t){const r=He(),s=Je(),a=L(()=>t.value?t.value.type==="lead"?ba:Li:null),l=L(()=>t.value?t.value.type==="lead"?{currentActivities:L(()=>r.currentLeadActivities),addActivity:(c,u)=>r.addActivity(c,u),updateActivity:(c,u,b)=>r.updateActivity(c,u,b),deleteActivity:(c,u)=>r.deleteActivity(c,u),updateLead:(c,u)=>r.updateLead(c,u),loadLeadById:c=>r.fetchLeadById(c)}:{currentActivities:L(()=>s.currentOpportunityActivities),addActivity:(c,u)=>s.addActivity(c,u),updateActivity:(c,u,b)=>s.updateActivity(c,u,b),deleteActivity:(c,u)=>s.deleteActivity(c,u),addVehicle:(c,u)=>s.addVehicle(c,u),createOffer:(c,u)=>s.createOffer(c,u),updateOpportunity:(c,u)=>s.updateOpportunity(c,u),loadOpportunityById:c=>s.fetchOpportunityById(c)}:null),o=L(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:a,storeAdapter:l,addNewConfig:o}}function qi(){const t=d=>{if(!d)return"No deadline";const i=vt(d);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:bt(d)},r=d=>{const i=d.type==="lead"?d.requestedCar:d.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},s=d=>d?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[d.type]||"bg-gray-50 text-gray-700":"",a=d=>{if(!d||!d.assignee)return{name:"Unassigned",initials:"?"};const i=d.assigneeInitials||d.assignee.split(" ").map(y=>y[0]).join("");return{name:d.assignee,initials:i}},l=d=>{if(!d||!d.customer||!d.customer.address)return null;const y=d.customer.address.split(",");return y.length>1&&y[y.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:r,getVehicleTypeBadgeClass:s,getOwnerInfo:a,getCustomerCity:l,getLocationDisplay:d=>{const i=l(d),y=d.source||"Unknown";return i?`${i} â€¢ ${y}`:y},getAssigneeInitials:d=>{if(!d)return"?";const i=d.split(" ");return i.length>=2?(i[0][0]+i[i.length-1][0]).toUpperCase():d.substring(0,2).toUpperCase()},getVehicleStatusDisplay:d=>{const i=d.type==="lead"?d.requestedCar:d.vehicle;if(!i)return"No vehicle";const y=r(d),w=y?y.label:i.type||"Unknown";let h="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?h=`${(i.kilometers/1e3).toFixed(0)}k`:h=`${i.kilometers}`),h?`${w} / ${h}`:w},getTaskStatusDisplay:d=>d.type==="lead"?d.status||"Unknown":d.stage||"Unknown",getStageBadgeClass:xt,getUnselectedClass:d=>d.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Ni(t){const r=He(),s=Je(),a=je(),l=L(()=>{const b=(t.value?r.leads:r.leads.filter(i=>!i.isDisqualified)).map(i=>{const y=$e(i,"lead"),w={...i,type:"lead",compositeId:`lead-${i.id}`,displayStage:y};return!w.customer&&i.customer&&(w.customer=i.customer),w}),p=s.opportunities.map(i=>{const y={...i,type:"opportunity",compositeId:`opportunity-${i.id}`};return!y.customer&&i.customer&&(y.customer=i.customer),y});let d=[];return a.isOperator()?d=b:a.isSalesman()?d=p:d=[...b,...p],d}),o=(u,b)=>b==="all"?u:u.filter(p=>p.type===b),c=L(()=>{const u=l.value.some(p=>p.type==="lead"),b=l.value.some(p=>p.type==="opportunity");return u&&b});return{allTasks:l,filterByType:o,shouldShowTypeFilter:c}}function Mi(){const t=je(),r=Xe(),s=Ie();return{sortTasks:(l,o)=>{if(o==="none")return[...l].sort((c,u)=>{const b=new Date(c.lastActivity||c.createdAt||0);return new Date(u.lastActivity||u.createdAt||0)-b});if(o==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...l.map(b=>{if(b.type==="lead"&&!b.urgencyScore){const p=Ct(b);return{...b,urgencyScore:p.score,urgencyLevel:p.level}}return b})].sort((b,p)=>{if(b.type==="lead"&&p.type==="lead"){const y=b.urgencyScore||0,w=p.urgencyScore||0;if(y!==w)return w-y;const h=new Date(b.createdAt||0);return new Date(p.createdAt||0)-h}if(b.type==="lead"&&p.type==="opportunity")return-1;if(b.type==="opportunity"&&p.type==="lead")return 1;if(b.priority==="Hot"&&p.priority!=="Hot")return-1;if(b.priority!=="Hot"&&p.priority==="Hot")return 1;const d=new Date(b.lastActivity||b.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-d}):[...l].sort((u,b)=>{if(u.priority==="Hot"&&b.priority!=="Hot")return-1;if(u.priority!=="Hot"&&b.priority==="Hot")return 1;const p=new Date(u.lastActivity||u.createdAt||0);return new Date(b.lastActivity||b.createdAt||0)-p});if(o==="assigned-to-me"){const c=t.currentUser.name;return[...l.filter(b=>b.assignee===c)].sort((b,p)=>{const d=new Date(b.lastActivity||b.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-d})}if(o==="assigned-to-my-team"){const c=t.currentUser;let u=[];return c.role==="manager"?u=r.users.map(p=>p.name):c.role==="salesman"?u=r.users.filter(p=>p.role==="salesman").map(p=>p.name):c.role==="operator"&&(u=r.users.filter(p=>p.role==="operator").map(p=>p.name)),[...l.filter(p=>u.includes(p.assignee))].sort((p,d)=>{const i=new Date(p.lastActivity||p.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-i})}return l}}}const Ri={class:"h-full flex flex-col lg:flex-row overflow-hidden",style:{"background-color":"#f5f5f5"}},Fi={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Vi={key:0,class:"flex items-center gap-2"},Bi={class:"w-5 h-5 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0"},Ui={class:"text-gray-600 font-medium"},Wi={key:1},ji={key:0},Ei={key:1},Pi={key:2},Hi=["onClick"],zi=["onClick"],Qi=["onClick"],Yi=["onClick"],Ki={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-gray-200"},Gi={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Ji={__name:"Tasks",setup(t){const r=Vt(),s=nt(),a=He(),l=Je();je(),Xe();const o=Ie(),{getDateDisplay:c,getVehicleType:u,getVehicleTypeBadgeClass:b,getOwnerInfo:p,getCustomerCity:d,getAssigneeInitials:i,getVehicleStatusDisplay:y,getUnselectedClass:w}=qi(),h=O(localStorage.getItem("tasksViewMode")||"table"),N=L(()=>r.query.highlight||null);ve(h,$=>{localStorage.setItem("tasksViewMode",$)});const R=$=>{h.value;const B=H.value;if(h.value=$,$==="table"&&B)s.push({path:"/tasks",query:{highlight:B.compositeId}});else if($==="card"&&N.value){const[J,le]=N.value.split("-");s.push({path:`/tasks/${le}`,query:{type:J}})}else $==="card"&&!N.value&&!H.value&&s.push({path:"/tasks"})},C=O("all"),k=O("none"),v=O(!1),g=O(null);O(!1);const A=O(!1),V=O(null),{allTasks:P,filterByType:Y,shouldShowTypeFilter:Z}=Ni(v),{sortTasks:oe}=Mi(),be=L(()=>{let $=Y(P.value,C.value);return $=oe($,k.value),$}),H=L(()=>{if(!r.params.id)return null;const $=parseInt(r.params.id);if(isNaN($))return null;const B=r.query.type;if(B){const de=`${B}-${$}`;return P.value.find(Te=>Te.compositeId===de)||null}const J=C.value!=="all"?P.value.filter(de=>de.type===C.value):P.value,le=`lead-${$}`,q=`opportunity-${$}`,Q=J.find(de=>de.compositeId===le||de.compositeId===q);return Q||P.value.find(de=>de.compositeId===le||de.compositeId===q)||null});L(()=>H.value?H.value.type==="lead"?a.currentLeadActivities:l.currentOpportunityActivities:[]);const ye=L(()=>{if(!H.value)return null;let $=null;if(H.value.type==="lead"){const B=H.value.requestedCar;B&&B.brand&&B.model&&($=B)}else H.value.type==="opportunity"&&($=H.value.vehicle||H.value.requestedCar);return!$||!$.brand||!$.model?null:{show:!0,label:"Requested Car",brand:$.brand,model:$.model,year:$.year,image:$.image||"",price:$.price||null,requestMessage:$.requestMessage||"",requestType:H.value.requestType||$.requestType||"",source:H.value.source||$.source||"",dealership:$.dealership||"",registration:$.registration||"",kilometers:$.kilometers!==void 0?$.kilometers:null,fuelType:$.fuelType||"",gearType:$.gearType||"",vin:$.vin||"",stockDays:$.stockDays!==void 0?$.stockDays:null,showOpenAd:!0,showTechnicalSpecs:!0,channel:"Email",adCampaign:H.value.sourceDetails||$.adCampaign||"",expectedPurchaseDate:$.expectedPurchaseDate||"",fiscalEntity:H.value.fiscalEntity||"",sourceDetails:H.value.sourceDetails||"",adMedium:$.adMedium||"",adSource:$.adSource||""}}),fe=Oi(H),he=fe.managementWidget,K=fe.storeAdapter,G=fe.addNewConfig,ge=w;Ge(()=>{a.fetchLeads(),l.fetchOpportunities();const $=r.params.id;$&&xe($)}),ve(()=>r.params.id,$=>{$&&xe($)}),ve(H,$=>{$&&($.type==="lead"?a.fetchLeadById($.id):l.fetchOpportunityById($.id))},{immediate:!0});const xe=$=>{const B=parseInt($),J=P.value.find(le=>le.id===B);J&&(J.type==="lead"?a.fetchLeadById(B):l.fetchOpportunityById(B))},ue=$=>{const[B,J]=$.split("-");s.push({path:`/tasks/${J}`,query:{type:B}})},te=()=>{s.push({path:"/tasks"})},ne=$=>{g.value=g.value===$?null:$},me=$=>{V.value=$,A.value=!0,g.value=null},W=$=>{k.value=$},U=async $=>{if(!V.value)return;const B=V.value,J=$.name;B.type==="lead"?await a.updateLead(B.id,{assignee:J,assigneeType:$.type,teamId:$.type==="team"?$.id:null}):B.type==="opportunity"&&await l.updateOpportunity(B.id,{assignee:J,assigneeType:$.type,teamId:$.type==="team"?$.id:null}),A.value=!1,V.value=null},ee=async $=>{g.value=null,$.type==="lead"?await a.updateLead($.id,{priority:"Hot"}):$.type==="opportunity"&&await l.updateOpportunity($.id,{priority:"Hot"})},Ee=async $=>{g.value=null,$.type==="lead"?await a.updateLead($.id,{priority:"Normal"}):$.type==="opportunity"&&await l.updateOpportunity($.id,{priority:"Normal"})},ke=async $=>{if(g.value=null,$.type==="lead")try{const B=$.displayStage||$.stage||se.NEW,J=se.NEW,le=tt(B,J);if(le){const{updates:q,activities:Q}=le($);await a.updateLead($.id,q);for(const de of Q)await a.addActivity($.id,de)}else await a.updateLead($.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await a.addActivity($.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await a.fetchLeadById($.id)}catch(B){console.error("Failed to reopen lead:",B)}};return($,B)=>{var J,le;return m(),x("div",Ri,[I(_o,{show:!!H.value,"back-label":"Back to task list",onBack:te},null,8,["show"]),h.value==="card"?(m(),x("div",Fi,[e("div",{class:j(["flex flex-col overflow-hidden",H.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[I(Fs,{title:"Tasks",items:be.value,"selected-id":(J=H.value)==null?void 0:J.compositeId,"type-filter":C.value,"view-mode":h.value,"selected-class":q=>q.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":n(ge),"open-menu-id":g.value,getName:q=>{const Q=q.customer;return Q&&Q.name?Q.name:Q&&!Q.name&&Q.email&&Q.email.split("@")[0]||"Unknown"},getInitials:q=>{const Q=q.customer;return Q&&Q.initials?Q.initials:Q&&Q.name&&Q.name.split(" ").map(Te=>Te[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:q=>{if(q.type==="lead")return q.requestedCar?`${q.requestedCar.brand} ${q.requestedCar.model}`:"No vehicle specified";const Q=q.vehicle||q.requestedCar;return Q?`${Q.brand} ${Q.model}`:"No vehicle specified"},avatarClass:q=>q.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!1,onSelect:ue,onMenuClick:ne,onMenuClose:B[0]||(B[0]=q=>g.value=null),onClose:te,"show-type-filter":n(Z),onFilterChange:B[1]||(B[1]=q=>C.value=q),onSortChange:W,onViewChange:R},{badges:T(({item:q})=>[q&&q.type?(m(),E(n(Ye),{key:0,text:q.type==="lead"?"Lead":"Opportunity",size:"small",theme:q.type==="lead"?"blue":"gray"},null,8,["text","theme"])):D("",!0),q&&q.type==="lead"&&n(o).getSetting("urgencyEnabled")!==!1&&q.urgencyLevel?(m(),E(n(Ye),{key:1,text:`${n($t)(q.urgencyLevel)} ${q.urgencyLevel}`,size:"small",class:j(n(St)(q.urgencyLevel))},null,8,["text","class"])):D("",!0),q&&q.priority==="Hot"&&(n(o).getSetting("urgencyEnabled")===!1||q.type!=="lead")?(m(),E(n(Ye),{key:2,text:"HOT",size:"small",theme:"red"})):D("",!0)]),location:T(({item:q})=>[F(S(n(d)(q)||"Unknown"),1)]),source:T(({item:q})=>{var Q;return[F(S(q.source||((Q=q.customer)==null?void 0:Q.source)||"Unknown"),1)]}),"vehicle-status":T(({item:q})=>[F(S(n(y)(q)),1)]),owner:T(({item:q})=>[q.assignee?(m(),x("div",Vi,[e("div",Bi,S(n(i)(q.assignee)),1),e("span",Ui,S(q.assignee),1)])):(m(),x("span",Wi,"Unassigned"))]),dates:T(({item:q})=>[q.type==="lead"&&q.nextActionDue?(m(),x("span",ji,"Due: "+S(n(c)(q.nextActionDue)),1)):q.type==="opportunity"&&q.nextActionDue?(m(),x("span",Ei,"Due: "+S(n(c)(q.nextActionDue)),1)):(m(),x("span",Pi,"Due: No deadline"))]),menu:T(({item:q})=>[q.type==="lead"&&q.isDisqualified===!0?(m(),x("button",{key:0,onClick:Se(Q=>ke(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[6]||(B[6]=[e("i",{class:"fa-solid fa-rotate-left text-blue-500"},null,-1),F(" Reopen Lead ",-1)])],8,Hi)):D("",!0),e("button",{onClick:Se(Q=>me(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[7]||(B[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),F(" Reassign ",-1)])],8,zi),q.priority!=="Hot"?(m(),x("button",{key:1,onClick:Se(Q=>ee(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[8]||(B[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),F(" Mark as hot ",-1)])],8,Qi)):(m(),x("button",{key:2,onClick:Se(Q=>Ee(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[9]||(B[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),F(" Unmark as hot ",-1)])],8,Yi))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),H.value?(m(),E(ut,{key:0,task:H.value,"management-widget":n(he),"store-adapter":n(K),"add-new-config":n(G),"vehicle-widget-data":ye.value},null,8,["task","management-widget","store-adapter","add-new-config","vehicle-widget-data"])):D("",!0),H.value?D("",!0):(m(),x("div",Ki,[...B[10]||(B[10]=[Ke('<div class="flex-1 flex items-center justify-center p-8" data-v-65247a35><div class="text-center max-w-sm" data-v-65247a35><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gray-100 flex items-center justify-center" data-v-65247a35><i class="fa-solid fa-tasks text-2xl text-gray-400" data-v-65247a35></i></div><h3 class="text-base font-semibold text-gray-900 mb-2" data-v-65247a35>No task selected</h3><p class="text-sm text-gray-500" data-v-65247a35>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):D("",!0),h.value==="table"?(m(),x("div",Gi,[I(Gs,{tasks:be.value,"current-task-id":(le=H.value)==null?void 0:le.compositeId,"highlight-id":N.value,"type-filter":C.value,"sort-option":k.value,"show-type-filter":n(Z),"show-closed":v.value,"show-mobile-close":!1,"open-menu-id":g.value,"get-vehicle-type":n(u),"get-vehicle-type-badge-class":n(b),"get-owner-info":n(p),"get-stage-badge-class":n(xt),"view-mode":h.value,onSelect:ue,onMenuClick:ne,onMenuClose:B[2]||(B[2]=q=>g.value=null),onFilterChange:B[3]||(B[3]=q=>C.value=q),onSortChange:W,onToggleClosed:B[4]||(B[4]=q=>v.value=q),onReassign:me,onClose:te,onViewChange:R,class:j(H.value?"hidden lg:flex shrink-0":"flex-1 w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode","class"]),H.value?(m(),E(ut,{key:0,task:H.value,"management-widget":n(he),"store-adapter":n(K),"add-new-config":n(G),"vehicle-widget-data":ye.value},null,8,["task","management-widget","store-adapter","add-new-config","vehicle-widget-data"])):D("",!0)])):D("",!0),I(Xt,{show:A.value,onClose:B[5]||(B[5]=q=>A.value=!1),onConfirm:U},null,8,["show"])])}}},ur=st(Ji,[["__scopeId","data-v-65247a35"]]);export{ur as default};
