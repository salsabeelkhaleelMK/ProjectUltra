import{k as de,l as ke,d as et,r as C,c as F,a as l,h as s,b as e,j as c,t as m,e as N,n as V,w as L,v as Q,F as J,f as Z,i as Y,p as Se,g as Be,_ as Pe,q as Ae,s as Ie,x as H,o as ce,y as Ye,z as He,A as tt,B as U,C as De,D as ze,E as Me,T as be,G as Re,H as st,I as Qe,u as ot,J as lt}from"./index-Nv2arjUI.js";const me=(t=300)=>new Promise(g=>setTimeout(g,t)),at=async(t={})=>{await me();let g=[...de];if(t.stage&&(g=g.filter(a=>a.stage===t.stage)),t.assignee&&(g=g.filter(a=>a.assignee===t.assignee)),t.search){const a=t.search.toLowerCase();g=g.filter(p=>p.customer.name.toLowerCase().includes(a)||p.vehicle.brand.toLowerCase().includes(a)||p.vehicle.model.toLowerCase().includes(a))}return{data:g,total:g.length}},nt=async t=>{await me();const g=de.find(a=>a.id===parseInt(t));if(!g)throw new Error("Opportunity not found");return g},it=async t=>(await me(),ke.filter(g=>g.opportunityId===parseInt(t))),rt=async t=>{await me();const g={id:de.length+1,...t,createdAt:new Date().toISOString()};return de.push(g),g},dt=async(t,g)=>{await me();const a=de.findIndex(p=>p.id===parseInt(t));if(a===-1)throw new Error("Opportunity not found");return de[a]={...de[a],...g},de[a]},ut=async t=>{await me();const g=de.findIndex(a=>a.id===parseInt(t));if(g===-1)throw new Error("Opportunity not found");return de.splice(g,1),{success:!0}},ct=async(t,g)=>{await me();const a={id:ke.length+1,opportunityId:parseInt(t),timestamp:new Date().toISOString(),...g};return ke.push(a),a},mt=async(t,g,a)=>{await me();const p=ke.find(o=>o.id===parseInt(g)&&o.opportunityId===parseInt(t));if(!p)throw new Error("Activity not found");return Object.assign(p,a,{timestamp:new Date().toISOString()}),p},pt=async(t,g)=>{await me();const a=ke.findIndex(p=>p.id===parseInt(g)&&p.opportunityId===parseInt(t));if(a===-1)throw new Error("Activity not found");return ke.splice(a,1),{success:!0}},Ke=et("opportunities",()=>{const t=C([]),g=C(null),a=C([]),p=C(!1),o=C(null),y=C({stage:null,assignee:null,search:""}),d=F(()=>t.value.length),i=F(()=>{const T={};return t.value.forEach(M=>{T[M.stage]||(T[M.stage]=[]),T[M.stage].push(M)}),T}),r=F(()=>t.value.reduce((T,M)=>T+M.value,0));async function u(){p.value=!0,o.value=null;try{const T=await at(y.value);t.value=T.data}catch(T){o.value=T.message}finally{p.value=!1}}async function v(T){p.value=!0,o.value=null;try{g.value=await nt(T),a.value=await it(T);const M=t.value.findIndex(D=>D.id===parseInt(T));M!==-1&&(t.value[M]=g.value)}catch(M){o.value=M.message}finally{p.value=!1}}async function f(T){p.value=!0,o.value=null;try{const M=await rt(T);return t.value.unshift(M),M}catch(M){throw o.value=M.message,M}finally{p.value=!1}}async function w(T,M){p.value=!0,o.value=null;try{const D=await dt(T,M),j=t.value.findIndex(B=>B.id===T);return j!==-1&&(t.value[j]=D),D}catch(D){throw o.value=D.message,D}finally{p.value=!1}}async function A(T){p.value=!0,o.value=null;try{await ut(T),t.value=t.value.filter(M=>M.id!==T)}catch(M){throw o.value=M.message,M}finally{p.value=!1}}async function k(T,M){try{const D=await ct(T,M);return a.value.unshift(D),D}catch(D){throw o.value=D.message,D}}async function I(T,M,D){try{const j=await mt(T,M,D),B=a.value.findIndex(O=>O.id===parseInt(M));return B!==-1&&(a.value[B]=j),j}catch(j){throw o.value=j.message,j}}async function E(T,M){try{return await pt(T,M),a.value=a.value.filter(D=>D.id!==parseInt(M)),{success:!0}}catch(D){throw o.value=D.message,D}}function _(T){y.value={...y.value,...T},u()}return{opportunities:t,currentOpportunity:g,currentOpportunityActivities:a,loading:p,error:o,filters:y,totalOpportunities:d,opportunitiesByStage:i,totalValue:r,loadOpportunities:u,loadOpportunityById:v,addOpportunity:f,modifyOpportunity:w,removeOpportunity:A,addActivity:k,updateActivity:I,deleteActivity:E,setFilters:_}}),yt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 max-h-[40vh] lg:max-h-none"},ft={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},gt={class:"font-bold text-lg text-gray-800"},vt={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},bt={class:"flex gap-2"},xt={class:"px-5 py-3"},ht={class:"relative"},wt=["placeholder"],kt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},$t=["onClick"],Ct=["onClick"],St={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Dt={class:"flex items-start gap-3.5 pr-6"},At={class:"flex-1 min-w-0"},It={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Ot={class:"text-gray-600 text-xs mt-1 truncate"},Tt={class:"text-right shrink-0"},qt={class:"flex items-center gap-2 flex-wrap mt-3"},jt={__name:"EntityListSidebar",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change"],setup(t,{emit:g}){const a={mounted(i,r){i.clickOutsideEvent=u=>{i===u.target||i.contains(u.target)||r.value()},document.addEventListener("click",i.clickOutsideEvent)},unmounted(i){document.removeEventListener("click",i.clickOutsideEvent)}},p=t,o=C(""),y=F(()=>{let i=p.items;if(p.typeFilter&&p.typeFilter!=="all"&&(i=i.filter(r=>r.type===p.typeFilter)),o.value){const r=o.value.toLowerCase();i=i.filter(u=>{const v=p.getName(u).toLowerCase(),f=p.getVehicleInfo(u).toLowerCase();return v.includes(r)||f.includes(r)})}return i}),d=i=>{const r=i.compositeId||`${i.type||"task"}-${i.id}`||i.id;return p.selectedId===r};return(i,r)=>(s(),l("div",yt,[e("div",ft,[e("h2",gt,m(t.title),1),r[4]||(r[4]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[N(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(s(),l("div",vt,[e("div",bt,[e("button",{onClick:r[0]||(r[0]=u=>i.$emit("filter-change","all")),class:V(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:r[1]||(r[1]=u=>i.$emit("filter-change","lead")),class:V(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:r[2]||(r[2]=u=>i.$emit("filter-change","opportunity")),class:V(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):c("",!0),e("div",xt,[e("div",ht,[r[5]||(r[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),L(e("input",{"onUpdate:modelValue":r[3]||(r[3]=u=>o.value=u),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,wt),[[Q,o.value]])])]),e("div",kt,[(s(!0),l(J,null,Z(y.value,u=>(s(),l("div",{key:u.id,onClick:v=>i.$emit("select",u.compositeId||`${u.type||"task"}-${u.id}`||u.id),class:V(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",d(u)?typeof t.selectedClass=="function"?t.selectedClass(u):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(u):t.unselectedClass])},[t.showMenu?(s(),l("button",{key:0,onClick:Y(v=>i.$emit("menu-click",u.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...r[6]||(r[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,Ct)):c("",!0),t.openMenuId===u.id&&t.showMenu?L((s(),l("div",St,[Se(i.$slots,"menu",{item:u})])),[[a,()=>i.$emit("menu-close")]]):c("",!0),e("div",Dt,[e("div",{class:V(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(u)])},m(t.getInitials(u)),3),e("div",At,[e("div",It,m(t.getName(u)),1),e("div",Ot,m(t.getVehicleInfo(u)),1)]),e("div",Tt,[Se(i.$slots,"meta",{item:u}),Se(i.$slots,"footer",{item:u})])]),e("div",qt,[Se(i.$slots,"badges",{item:u})])],10,$t))),128))])]))}},Mt={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center gap-3"},Nt={key:1,class:"font-bold text-lg text-gray-800"},Vt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Ft={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Et={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Ut={class:"text-sm"},Lt={key:2,class:"space-y-6 relative z-10"},Bt={key:0,class:"mb-4 pl-12"},Pt={class:"text-sm font-semibold text-gray-800"},Rt={class:"flex gap-4 relative mb-6"},Wt={class:"flex-1 min-w-0"},zt={class:"text-sm text-slate-700 leading-snug"},Yt={class:"font-bold"},Ht={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},Qt={class:"text-xs text-gray-400 mt-1"},Kt={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0}},emits:["toggle-collapse"],setup(t,{emit:g}){const a=t,p=r=>{const u={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return u[r]||u.default},o=r=>{const u={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return u[r]||u.default},y=r=>{if(!r)return"";const u=new Date(r),v=new Date,f=new Date(v);return f.setDate(f.getDate()-1),u.toDateString()===v.toDateString()?"Today":u.toDateString()===f.toDateString()?"Yesterday":u.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},d=r=>r?new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",i=(r,u)=>{if(r===0)return!0;const v=a.activities[r-1];if(!v)return!0;const f=new Date(u.timestamp).toDateString(),w=new Date(v.timestamp).toDateString();return f!==w};return(r,u)=>t.show?(s(),l("div",{key:0,class:V(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",t.collapsed?"w-16":"w-80"])},[e("div",Mt,[t.showCollapse?(s(),l("button",{key:0,onClick:u[0]||(u[0]=v=>r.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:V(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):c("",!0),t.collapsed?c("",!0):(s(),l("h2",Nt,m(t.title),1))]),t.collapsed?c("",!0):(s(),l("div",Vt,[t.activities.length>0?(s(),l("div",Ft)):c("",!0),t.activities.length===0?(s(),l("div",Et,[u[1]||(u[1]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Ut,m(t.emptyMessage),1)])):(s(),l("div",Lt,[(s(!0),l(J,null,Z(t.activities,(v,f)=>(s(),l(J,{key:v.id},[i(f,v)?(s(),l("div",Bt,[e("h3",Pt,m(y(v.timestamp)),1)])):c("",!0),e("div",Rt,[e("div",{class:V(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",o(v.type)])},[e("i",{class:V([p(v.type),"text-sm"])},null,2)],2),e("div",Wt,[e("div",zt,[e("span",Yt,m(v.user),1),N(" "+m(v.action),1)]),v.content?(s(),l("div",Ht,m(v.content),1)):c("",!0),e("div",Qt,m(d(v.timestamp)),1)])])],64))),128))]))]))],2)):c("",!0)}},Jt={class:"w-full"},Gt={class:"flex items-center justify-between gap-3 md:gap-4"},Xt={class:"flex items-center gap-3 md:gap-4 flex-1"},Zt={class:"min-w-0 flex-1"},_t={class:"text-lg md:text-xl font-bold text-gray-900 truncate"},es={class:"flex flex-wrap items-center gap-2 mt-1"},ts={class:"flex items-center gap-1 ml-2"},ss={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},os={class:"flex items-center gap-4"},ls={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},as={class:"flex items-center gap-2"},ns={class:"text-xs text-gray-900 font-medium"},is={class:"flex items-center gap-2"},rs={class:"text-xs text-gray-900 font-medium"},ds={class:"flex items-center gap-2"},us={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},cs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},ms={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},ps={class:"text-xs text-gray-900 font-medium"},ys={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},Je={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},emits:["action"],setup(t,{emit:g}){const a=C(!1),p=C(null),o=async(y,d)=>{try{await navigator.clipboard.writeText(y),p.value=d,setTimeout(()=>{p.value=null},1500)}catch(i){console.error("Failed to copy:",i)}};return(y,d)=>(s(),l("div",Jt,[e("div",Gt,[e("div",Xt,[e("div",{class:V(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},m(t.initials),3),e("div",Zt,[e("h1",_t,m(t.name),1),e("div",es,[Se(y.$slots,"tags")])])]),e("div",ts,[d[3]||(d[3]=Be('<button class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 transition-colors" title="Call"><i class="fa-solid fa-phone text-xs"></i></button><button class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 transition-colors" title="Email"><i class="fa-regular fa-envelope text-xs"></i></button><button class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 transition-colors" title="WhatsApp"><i class="fa-brands fa-whatsapp text-xs"></i></button><button class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 text-slate-500 hover:bg-gray-200 transition-colors" title="SMS"><i class="fa-regular fa-comment-dots text-xs"></i></button>',4)),e("button",{onClick:d[0]||(d[0]=i=>a.value=!a.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:V(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":a.value}])},null,2)])])]),a.value?(s(),l("div",ss,[e("div",os,[e("div",ls,[e("div",as,[d[5]||(d[5]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ns,m(t.email),1),e("button",{onClick:d[1]||(d[1]=Y(i=>o(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...d[4]||(d[4]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",is,[d[7]||(d[7]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",rs,m(t.phone),1),e("button",{onClick:d[2]||(d[2]=Y(i=>o(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...d[6]||(d[6]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ds,[e("div",us,[t.thirdFieldLabel.toLowerCase().includes("address")?(s(),l("i",cs)):(s(),l("i",ms))]),e("span",ps,m(t.thirdFieldValue),1)])])]),p.value?(s(),l("div",ys,m(p.value==="email"?"Email":"Phone")+" copied! ",1)):c("",!0)])):c("",!0)]))}},fs={class:"flex gap-8 text-sm font-medium text-gray-500 py-1 overflow-x-auto scrollbar-hide"},gs=["onClick"],Ge={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(g,a)=>(s(),l("div",fs,[(s(!0),l(J,null,Z(t.tabs,p=>(s(),l("div",{key:p.key,onClick:o=>g.$emit("update:modelValue",p.key),class:V(["pb-2 border-b-2 cursor-pointer whitespace-nowrap transition-all",t.modelValue===p.key?"border-slate-700 text-slate-800":"border-transparent hover:text-gray-700 hover:border-gray-300"])},[N(m(p.label)+" ",1),p.count!==void 0?(s(),l("span",{key:0,class:V(["ml-1 text-[10px] px-1.5 py-0.5 rounded-full",t.modelValue===p.key?"bg-gray-200 text-gray-800":"bg-gray-100 text-gray-600"])},m(p.count),3)):c("",!0)],10,gs))),128))]))}},vs={key:0,class:"mb-8"},bs={class:"flex items-center gap-2 mb-4"},xs={class:"font-bold text-gray-800 text-sm"},hs={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 group overflow-hidden"},ws={class:"block p-4 cursor-pointer select-none bg-white hover:bg-gray-50 transition-colors"},ks={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},$s={class:"text-sm text-slate-700 leading-snug"},Cs={class:"flex items-center justify-between"},Ss={class:"flex items-center gap-4"},Ds={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},As=["src"],Is={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},Os={class:"flex items-center gap-2"},Ts={class:"font-bold text-slate-800 text-sm md:text-base"},qs={class:"flex items-center gap-4"},js={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},Ms={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},Ns={key:2,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},Vs={key:3,class:"text-right"},Fs={class:"font-bold text-slate-800"},Es={class:"border-t border-gray-100 p-6 bg-gray-50/30 content-sweep text-sm"},Us={class:"mb-6"},Ls={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Bs={key:0},Ps={class:"font-medium text-slate-700"},Rs={key:1},Ws={class:"font-medium text-slate-700"},zs={key:2},Ys={class:"font-medium text-slate-700"},Hs={class:"font-medium text-slate-700"},Qs={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ks={key:0},Js={class:"font-medium text-slate-700"},Gs={key:1},Xs={class:"font-medium text-slate-700"},Zs={key:2},_s={class:"font-medium text-slate-700"},eo={key:3},to={class:"font-medium text-slate-700"},so={key:4},oo={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},lo={key:5},ao={class:"font-medium text-slate-700"},no={key:0,class:"mt-6 flex justify-end"},io={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const g=p=>new Intl.NumberFormat("en-US").format(p),a=p=>new Intl.NumberFormat("en-US").format(p);return(p,o)=>t.show?(s(),l("div",vs,[e("div",bs,[o[0]||(o[0]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",xs,m(t.label),1)]),e("details",hs,[e("summary",ws,[t.requestMessage?(s(),l("div",ks,[o[1]||(o[1]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",$s,m(t.requestMessage),1)])):c("",!0),e("div",Cs,[e("div",Ss,[e("div",Ds,[t.image?(s(),l("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,As)):(s(),l("i",Is))]),e("div",null,[e("div",Os,[e("div",Ts,m(t.brand)+" "+m(t.model)+" ("+m(t.year)+")",1)])])]),e("div",qs,[t.showOpenAd&&t.price?(s(),l("button",js,[...o[2]||(o[2]=[N(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):c("",!0),t.stockDays!==void 0&&t.stockDays!==null?(s(),l("div",Ms,[o[3]||(o[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+m(t.stockDays)+" days) ",1)])):(s(),l("div",Ns,[...o[4]||(o[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])),t.price?(s(),l("div",Vs,[o[5]||(o[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",Fs,"€ "+m(g(t.price)),1)])):c("",!0),o[6]||(o[6]=e("i",{class:"fa-solid fa-chevron-down chevron-car text-gray-400 text-sm ml-2"},null,-1))])])]),e("div",Es,[e("div",Us,[o[17]||(o[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Ls,[t.requestType?(s(),l("div",Bs,[o[7]||(o[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Ps,m(t.requestType),1)])):c("",!0),t.source?(s(),l("div",Rs,[o[8]||(o[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Ws,m(t.source),1)])):c("",!0),e("div",null,[o[9]||(o[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:V(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},m(t.sourceDetails||"--"),3)]),t.dealership?(s(),l("div",zs,[o[10]||(o[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ys,m(t.dealership),1)])):c("",!0),e("div",null,[o[11]||(o[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Hs,m(t.channel||"Email"),1)]),e("div",null,[o[12]||(o[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:V(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},m(t.adCampaign||"--"),3)]),e("div",null,[o[13]||(o[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:V(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},m(t.adMedium||"--"),3)]),e("div",null,[o[14]||(o[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:V(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},m(t.adSource||"--"),3)]),e("div",null,[o[15]||(o[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:V(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},m(t.expectedPurchaseDate||"--"),3)]),e("div",null,[o[16]||(o[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:V(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},m(t.fiscalEntity||"--"),3)])])]),o[26]||(o[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[o[25]||(o[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Qs,[t.registration?(s(),l("div",Ks,[o[18]||(o[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Js,m(t.registration),1)])):c("",!0),t.kilometers!==void 0&&t.kilometers!==null?(s(),l("div",Gs,[o[19]||(o[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Xs,m(a(t.kilometers))+" Km",1)])):c("",!0),t.fuelType?(s(),l("div",Zs,[o[20]||(o[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",_s,m(t.fuelType),1)])):c("",!0),t.gearType?(s(),l("div",eo,[o[21]||(o[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",to,m(t.gearType),1)])):c("",!0),t.vin?(s(),l("div",so,[o[22]||(o[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",oo,m(t.vin),1)])):c("",!0),t.dealership?(s(),l("div",lo,[o[23]||(o[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",ao,m(t.dealership),1)])):c("",!0)]),t.showTechnicalSpecs?(s(),l("div",no,[...o[24]||(o[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):c("",!0)])])])])):c("",!0)}},Ve=Pe(io,[["__scopeId","data-v-6257657e"]]),ro={key:0,class:"flex-grow border-t border-gray-200"},uo={key:0,class:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},co={key:0,class:"border-t border-gray-100 my-1"},mo={key:1,class:"flex-grow border-t border-gray-200"},Ne={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:g}){const a={mounted(A,k){A.clickOutsideEvent=I=>{A===I.target||A.contains(I.target)||k.value()},document.addEventListener("click",A.clickOutsideEvent)},unmounted(A){document.removeEventListener("click",A.clickOutsideEvent)}},p=t,o=g,y=C(!1),d=F(()=>p.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-1.5 text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),i={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},r=F(()=>{if(!p.activeTab||p.activeTab==="overview")return p.actions.filter(k=>!i[k]);const A=Object.entries(i).filter(([,k])=>k===p.activeTab).map(([k])=>k);return p.actions.filter(k=>A.includes(k))}),u=F(()=>r.value.some(A=>["email","whatsapp","sms"].includes(A))),v=F(()=>r.value.some(A=>["addVehicle","configureVehicle"].includes(A))),f=F(()=>r.value.some(A=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(A))),w=A=>{y.value=!1,o("action",A)};return(A,k)=>t.show?(s(),l("div",{key:0,class:V(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?c("",!0):(s(),l("div",ro)),e("div",{class:V(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:k[0]||(k[0]=Y(I=>y.value=!y.value,["stop"])),class:V(d.value)},[...k[12]||(k[12]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),N(" Add new ",-1)])],2),y.value?L((s(),l("div",uo,[v.value?(s(),l(J,{key:0},[r.value.includes("addVehicle")?(s(),l("button",{key:0,onClick:k[1]||(k[1]=I=>w("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):c("",!0),r.value.includes("configureVehicle")?(s(),l("button",{key:1,onClick:k[2]||(k[2]=I=>w("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):c("",!0)],64)):c("",!0),f.value?(s(),l(J,{key:1},[v.value?(s(),l("div",co)):c("",!0),r.value.includes("note")?(s(),l("button",{key:1,onClick:k[3]||(k[3]=I=>w("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):c("",!0),r.value.includes("financing")?(s(),l("button",{key:2,onClick:k[4]||(k[4]=I=>w("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):c("",!0),r.value.includes("tradein")?(s(),l("button",{key:3,onClick:k[5]||(k[5]=I=>w("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):c("",!0),r.value.includes("requestedCar")?(s(),l("button",{key:4,onClick:k[6]||(k[6]=I=>w("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):c("",!0),r.value.includes("purchase")?(s(),l("button",{key:5,onClick:k[7]||(k[7]=I=>w("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):c("",!0),r.value.includes("attachment")?(s(),l("button",{key:6,onClick:k[8]||(k[8]=I=>w("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):c("",!0)],64)):c("",!0),u.value?(s(),l(J,{key:2},[k[16]||(k[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),r.value.includes("email")?(s(),l("button",{key:0,onClick:k[9]||(k[9]=I=>w("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...k[13]||(k[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),N(" Send Email ",-1)])])):c("",!0),r.value.includes("whatsapp")?(s(),l("button",{key:1,onClick:k[10]||(k[10]=I=>w("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...k[14]||(k[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),N(" Send WhatsApp ",-1)])])):c("",!0),r.value.includes("sms")?(s(),l("button",{key:2,onClick:k[11]||(k[11]=I=>w("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...k[15]||(k[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),N(" Send SMS ",-1)])])):c("",!0)],64)):c("",!0)])),[[a,()=>y.value=!1]]):c("",!0)],2),t.inline?c("",!0):(s(),l("div",mo))],2)):c("",!0)}},po={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},yo={class:"grid grid-cols-3 gap-3 mb-4"},fo={class:"flex gap-3 mb-4"},Fe={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:g}){const a=g,p=C(null),o=C(""),y=C(""),d=u=>{p.value=u;const v=new Date;if(u==="later-today"){const f=new Date(v.getTime()+72e5);o.value=f.toISOString().split("T")[0],y.value=f.toTimeString().slice(0,5)}else if(u==="tomorrow"){const f=new Date(v);f.setDate(f.getDate()+1),o.value=f.toISOString().split("T")[0],y.value="09:00"}else if(u==="next-week"){const f=new Date(v);f.setDate(f.getDate()+(7-f.getDay()+1)),o.value=f.toISOString().split("T")[0],y.value="09:00"}},i=()=>{a("confirm",{date:o.value,time:y.value,option:p.value}),a("close"),p.value=null,o.value="",y.value=""},r=()=>{a("close"),p.value=null,o.value="",y.value=""};return(u,v)=>t.show?(s(),l("div",po,[v[8]||(v[8]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},"Reschedule to...",-1)),e("div",yo,[e("button",{onClick:v[0]||(v[0]=f=>d("later-today")),class:V(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":p.value==="later-today"}])},[...v[5]||(v[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:v[1]||(v[1]=f=>d("tomorrow")),class:V(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":p.value==="tomorrow"}])},[...v[6]||(v[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:v[2]||(v[2]=f=>d("next-week")),class:V(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":p.value==="next-week"}])},[...v[7]||(v[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",fo,[L(e("input",{"onUpdate:modelValue":v[3]||(v[3]=f=>o.value=f),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[Q,o.value]]),L(e("input",{"onUpdate:modelValue":v[4]||(v[4]=f=>y.value=f),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[Q,y.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:r,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:i,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):c("",!0)}},go={key:0,class:"space-y-4 animate-fade-in"},vo={key:0,class:"animate-fade-in"},bo={class:"grid grid-cols-4 gap-2"},xo=["onClick"],Oe={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C(""),y=C("Michael Thomas (Me)"),d=C(""),i=C(!1),r=C("");Ae(()=>a.show,w=>{w||u()});const u=()=>{o.value="",y.value="Michael Thomas (Me)",d.value="",i.value=!1,r.value=""},v=()=>{!o.value||!d.value||!r.value||(p("confirm",{type:o.value,assignee:y.value,date:d.value,time:r.value}),u())},f=()=>{u(),p("cancel")};return(w,A)=>t.show?(s(),l("div",go,[e("div",null,[A[5]||(A[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),L(e("select",{"onUpdate:modelValue":A[0]||(A[0]=k=>o.value=k),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...A[4]||(A[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[Ie,o.value]])]),e("div",null,[A[7]||(A[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),L(e("select",{"onUpdate:modelValue":A[1]||(A[1]=k=>y.value=k),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...A[6]||(A[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[Ie,y.value]])]),e("div",null,[A[8]||(A[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),L(e("input",{type:"date","onUpdate:modelValue":A[2]||(A[2]=k=>d.value=k),onChange:A[3]||(A[3]=k=>i.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[Q,d.value]])]),i.value?(s(),l("div",vo,[A[9]||(A[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",bo,[(s(),l(J,null,Z(["09:00","10:30","11:00","14:30","15:00","16:30"],k=>e("button",{key:k,onClick:I=>r.value=k,class:V(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",r.value===k?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},m(k),11,xo)),64))])])):c("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:f,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:v,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...A[10]||(A[10]=[N(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):c("",!0)}},ho={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},wo={class:"flex items-start gap-3"},ko={class:"flex-1 min-w-0"},$o={class:"font-bold text-sm text-slate-800 mb-2"},Co={class:"space-y-1.5 text-xs text-gray-600"},So={class:"flex items-center gap-2"},Do={class:"flex items-center gap-2"},Ao={class:"flex items-center gap-2"},Io={key:0,class:"mt-2"},Oo={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const g=t,a=F(()=>g.appointmentData.date?new Date(g.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),p=F(()=>g.appointmentData.time?g.appointmentData.time:""),o=y=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[y==null?void 0:y.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(y,d)=>(s(),l("div",ho,[e("div",wo,[d[3]||(d[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",ko,[e("h4",$o,m(t.appointmentData.type),1),e("div",Co,[e("div",So,[d[0]||(d[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,m(a.value),1)]),e("div",Do,[d[1]||(d[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,m(p.value),1)]),e("div",Ao,[d[2]||(d[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,m(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),l("div",Io,[e("span",{class:V(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",o(t.appointmentData.status)])},m(t.appointmentData.status),3)])):c("",!0)])])]))}},To={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},qo={class:"flex-1"},jo={class:"flex items-center gap-2 mb-1"},Mo={class:"text-xs font-bold text-slate-800"},No={class:"text-[10px] text-gray-400"},Vo={class:"text-[10px] text-gray-400"},Fo={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},Eo={class:"ml-auto flex items-center gap-2"},Uo={key:0,class:"text-sm text-slate-700"},Lo={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},Bo={key:2,class:"mt-2"},Po={key:0},Ro={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},Wo={key:0,class:"flex justify-between items-start"},zo={class:"text-sm font-bold text-slate-800"},Yo={class:"text-xs text-gray-500 mt-1 flex gap-3"},Ho={key:0},Qo={key:1},Ko={key:1,class:"flex justify-between items-center mb-2"},Jo={class:"text-sm font-bold text-slate-800"},Go={key:2,class:"flex items-center gap-3"},Xo={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Zo=["src"],_o={class:"flex-1"},el={class:"text-sm font-bold text-slate-800"},tl={class:"text-xs text-gray-500"},sl={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},ol={key:3,class:"flex items-center gap-3"},ll={class:"flex-1"},al={class:"text-sm font-bold text-slate-800"},nl={class:"text-xs text-gray-500"},il={key:0,class:"text-xs text-gray-400 mt-1"},rl={key:1,class:"text-xs text-gray-600 mt-1"},Ee={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:g}){const a=t,p=g;C(!1);const o=v=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[v]||"fa-solid fa-circle",y=v=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[v]||"bg-gray-100 text-gray-600 border-gray-200",d=v=>{if(!v)return"Just now";const f=new Date(v),A=new Date-f,k=Math.floor(A/6e4),I=Math.floor(k/60),E=Math.floor(I/24);return k<1?"Just now":k<60?`${k} minutes ago`:I<24?`${I} hours ago`:E===1?"Yesterday":E<7?`${E} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},i=v=>v?new Intl.NumberFormat("en-US").format(v):"0",r=v=>v?new Date(v).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",u=()=>{confirm("Are you sure you want to delete this item?")&&p("delete",a.item)};return(v,f)=>(s(),l("div",To,[e("div",{class:V(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",y(t.item.type)])},[e("i",{class:V([o(t.item.type),"text-sm"])},null,2)],2),e("div",qo,[e("div",jo,[e("span",Mo,m(t.customerInitials),1),e("span",No,m(t.item.action||"added"),1),e("span",Vo,"• "+m(d(t.item.timestamp)),1),t.item.autoDetected?(s(),l("span",Fo,"Auto-detected")):c("",!0),e("div",Eo,[e("button",{onClick:f[0]||(f[0]=w=>v.$emit("edit",t.item)),class:"text-gray-400 hover:text-blue-600 transition-colors p-1",title:"Edit"},[...f[1]||(f[1]=[e("i",{class:"fa-solid fa-pencil text-xs"},null,-1)])]),e("button",{onClick:u,class:"text-gray-400 hover:text-red-600 transition-colors p-1",title:"Delete"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])])])]),t.item.content?(s(),l("div",Uo,m(t.item.content),1)):c("",!0),t.item.fileName?(s(),l("div",Lo,[f[3]||(f[3]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,m(t.item.fileName),1)])):c("",!0),t.item.data?(s(),l("div",Bo,[t.item.type==="appointment"?(s(),l("div",Po,[H(Oo,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),l("div",Ro,[t.item.type==="tradein"?(s(),l("div",Wo,[e("div",null,[e("h4",zo,m(t.item.data.brand)+" "+m(t.item.data.model),1),e("div",Yo,[t.item.data.year?(s(),l("span",Ho,[f[4]||(f[4]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(m(t.item.data.year),1)])):c("",!0),t.item.data.km?(s(),l("span",Qo,[f[5]||(f[5]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(m(t.item.data.km)+" km",1)])):c("",!0)])]),f[6]||(f[6]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Pending Eval",-1))])):t.item.type==="financing"?(s(),l("div",Ko,[e("h4",Jo,m(t.item.data.product),1),f[7]||(f[7]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Draft",-1))])):t.item.type==="offer"?(s(),l("div",Go,[t.item.data.image?(s(),l("div",Xo,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Zo)])):c("",!0),e("div",_o,[e("h4",el,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",tl,"€ "+m(i(t.item.data.price)),1)]),t.item.data.isMainOffer?(s(),l("span",sl,"Main Offer")):c("",!0)])):t.item.type==="purchase"?(s(),l("div",ol,[e("div",ll,[e("h4",al,m(t.item.data.brand)+" "+m(t.item.data.model)+" ("+m(t.item.data.year)+")",1),e("p",nl,"€ "+m(i(t.item.data.price)),1),t.item.data.purchaseDate?(s(),l("p",il,"Purchased: "+m(r(t.item.data.purchaseDate)),1)):c("",!0),t.item.data.notes?(s(),l("p",rl,m(t.item.data.notes),1)):c("",!0)])])):c("",!0)]))])):c("",!0)])]))}},dl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},ul={class:"flex justify-between items-center mb-4"},cl={class:"text-sm font-bold text-slate-800"},ml={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Xe={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C("");ce(()=>{a.item&&(o.value=a.item.content||"")});const y=()=>{var d,i;o.value.trim()&&p("save",{id:((d=a.item)==null?void 0:d.id)||Date.now(),type:"note",action:a.item?"updated a note":"added a note",content:o.value,timestamp:((i=a.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(d,i)=>(s(),l("div",dl,[i[5]||(i[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",ul,[e("h5",cl,m(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:i[0]||(i[0]=r=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[i[4]||(i[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),L(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=r=>o.value=r),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[Q,o.value]])]),e("div",ml,[e("button",{onClick:i[2]||(i[2]=r=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:y,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},pl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},yl={class:"flex justify-between items-center mb-4"},fl={class:"text-sm font-bold text-slate-800"},gl={class:"flex items-center gap-3"},vl={key:0,class:"text-sm text-slate-600"},bl={key:1,class:"text-sm text-gray-400"},xl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},hl=["disabled"],Ze={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C(null),y=C("");ce(()=>{a.item&&(y.value=a.item.fileName||"")});const d=r=>{const u=r.target.files[0];u&&(o.value=u,y.value=u.name)},i=()=>{var r,u;!o.value&&!a.item||p("save",{id:((r=a.item)==null?void 0:r.id)||Date.now(),type:"attachment",action:a.item?"updated an attachment":"added an attachment",fileName:y.value,timestamp:((u=a.item)==null?void 0:u.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(r,u)=>(s(),l("div",pl,[u[6]||(u[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",yl,[e("h5",fl,m(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:u[0]||(u[0]=v=>r.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",gl,[e("input",{type:"file",onChange:d,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:u[1]||(u[1]=v=>r.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),N("Choose File ",-1)])]),y.value?(s(),l("span",vl,m(y.value),1)):(s(),l("span",bl,"No file selected"))])]),e("div",xl,[e("button",{onClick:u[2]||(u[2]=v=>r.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:i,disabled:!o.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,hl)])]))}},wl={class:"animate-fade-in"},kl={class:"space-y-4"},$l={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Sl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Dl=["disabled"],Ue={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});ce(()=>{a.item&&a.item.data&&(o.value={class:a.item.data.class||"Car",brand:a.item.data.brand||"",model:a.item.data.model||"",version:a.item.data.version||"",km:a.item.data.km||"",plate:a.item.data.plate||"",date:a.item.data.date||""})});const y=()=>{var d,i;o.value.brand&&p("save",{id:((d=a.item)==null?void 0:d.id)||Date.now(),type:"tradein",action:a.item?"updated a trade-in":"added a trade-in",data:{class:o.value.class,brand:o.value.brand,model:o.value.model||"Unknown Model",year:o.value.date?new Date(o.value.date).getFullYear():"Unknown Year",km:o.value.km||"0",plate:o.value.plate||"",date:o.value.date||""},timestamp:((i=a.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(d,i)=>(s(),l("div",wl,[e("div",kl,[e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),L(e("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>o.value.class=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...i[8]||(i[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[Ie,o.value.class]])]),e("div",$l,[e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),L(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=r=>o.value.brand=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.brand]])]),e("div",null,[i[11]||(i[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),L(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=r=>o.value.model=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.model]])])]),e("div",null,[i[12]||(i[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),L(e("input",{type:"text","onUpdate:modelValue":i[3]||(i[3]=r=>o.value.version=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.version]])]),e("div",Cl,[e("div",null,[i[13]||(i[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),L(e("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=r=>o.value.km=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.km]])]),e("div",null,[i[14]||(i[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),L(e("input",{type:"text","onUpdate:modelValue":i[5]||(i[5]=r=>o.value.plate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.plate]])])]),e("div",null,[i[15]||(i[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),L(e("input",{type:"date","onUpdate:modelValue":i[6]||(i[6]=r=>o.value.date=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.date]])])]),e("div",Sl,[e("button",{onClick:i[7]||(i[7]=r=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!o.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Dl)])]))}},Al={class:"animate-fade-in"},Il={class:"space-y-4"},Ol={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ql={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},jl=["disabled"],Le={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});ce(()=>{a.item&&a.item.data&&(o.value={startDate:a.item.data.startDate||"",expDate:a.item.data.expDate||"",productName:a.item.data.product||a.item.data.productName||"",deposit:a.item.data.deposit||"",loanAmount:a.item.data.total||a.item.data.loanAmount||""})});const y=()=>{var d,i;o.value.productName&&p("save",{id:((d=a.item)==null?void 0:d.id)||Date.now(),type:"financing",action:a.item?"updated a financing proposal":"added a financing proposal",data:{product:o.value.productName,provider:"Audi Financial",total:o.value.loanAmount||"0",monthly:Math.round(parseFloat(o.value.loanAmount||0)/36).toString(),startDate:o.value.startDate,expDate:o.value.expDate,deposit:o.value.deposit},timestamp:((i=a.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(d,i)=>(s(),l("div",Al,[e("div",Il,[e("div",Ol,[e("div",null,[i[6]||(i[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),L(e("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=r=>o.value.startDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.startDate]])]),e("div",null,[i[7]||(i[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),L(e("input",{type:"date","onUpdate:modelValue":i[1]||(i[1]=r=>o.value.expDate=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.expDate]])])]),e("div",null,[i[8]||(i[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),L(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=r=>o.value.productName=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.productName]])]),e("div",Tl,[e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),L(e("input",{type:"number","onUpdate:modelValue":i[3]||(i[3]=r=>o.value.deposit=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.deposit]])]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),L(e("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=r=>o.value.loanAmount=r),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,o.value.loanAmount]])])])]),e("div",ql,[e("button",{onClick:i[5]||(i[5]=r=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!o.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,jl)])]))}},Ml={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},Nl={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Vl={class:"mb-3"},Fl={class:"flex justify-end gap-2"},_e={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C(""),y=C(""),d=()=>{!o.value.trim()&&!y.value||p("save",{type:"communication",action:`sent via ${a.type}`,content:o.value||`Sent template: ${y.value}`,communicationType:a.type})};return(i,r)=>(s(),l("div",Ml,[r[5]||(r[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",Nl,m(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Vl,[r[4]||(r[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),L(e("select",{"onUpdate:modelValue":r[0]||(r[0]=u=>y.value=u),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...r[3]||(r[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[Ie,y.value]])]),L(e("textarea",{"onUpdate:modelValue":r[1]||(r[1]=u=>o.value=u),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[Q,o.value]]),e("div",Fl,[e("button",{onClick:r[2]||(r[2]=u=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:d,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},El={class:"flex-1 flex flex-col overflow-hidden"},Ul={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Ll={class:"px-4 md:px-8 py-4 md:py-6"},Bl={class:"relative ml-1"},Pl={key:0,class:"absolute top-full left-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg z-50 p-1 overflow-hidden"},Rl=["onClick"],Wl={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},zl={class:"flex items-center justify-between mb-4"},Yl={key:0,class:"mb-6"},Hl={class:"flex items-center bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden w-full"},Ql={class:"flex items-center gap-2 px-3 py-1.5"},Kl={class:"text-xs font-bold text-gray-800"},Jl={class:"flex items-center gap-2 px-3 py-1.5"},Gl={class:"text-xs font-bold text-gray-800"},Xl={class:"flex items-center gap-2 px-3 py-1.5"},Zl={class:"text-xs font-bold text-gray-800"},_l={key:1,class:"space-y-6 mb-6"},ea={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},ta={class:"p-5 space-y-6"},sa={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},oa={class:"flex justify-between items-start mb-3"},la={class:"text-xs text-gray-500 mt-0.5"},aa={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},na={key:0},ia={key:1},ra={class:"flex gap-3 flex-wrap"},da={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},ua={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},ca={class:"flex items-center gap-1.5"},ma={class:"text-xs font-mono text-red-400"},pa={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},ya={class:"font-bold"},fa={key:1,class:"mt-3 space-y-2"},ga={class:"text-xs text-slate-600 leading-relaxed"},va={key:2,class:"mt-3 relative z-10"},ba={class:"relative"},xa=["onKeyup"],ha={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},wa=["disabled"],ka={key:0,class:"fa-solid fa-spinner fa-spin"},$a={key:1,class:"fa-solid fa-magic"},Ca={class:"bg-gray-50 border-t border-gray-200"},Sa={class:"p-4 flex justify-end gap-3"},Da={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Aa={class:"mb-5"},Ia={class:"flex flex-col gap-2"},Oa={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},Ta=["checked"],qa={key:3},ja={key:4,class:"space-y-4 mb-6 px-1"},Ma={key:5,class:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Na={class:"p-5 space-y-6"},Va={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Fa={class:"flex justify-between items-start mb-3"},Ea={class:"text-xs text-gray-500 mt-0.5"},Ua={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},La={key:0},Ba={key:1},Pa={class:"flex gap-3 flex-wrap"},Ra={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},Wa={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},za={class:"flex items-center gap-1.5"},Ya={class:"text-xs font-mono text-red-400"},Ha={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},Qa={class:"font-bold"},Ka={key:1,class:"mt-3 space-y-2"},Ja={class:"text-xs text-slate-600 leading-relaxed"},Ga={key:2,class:"mt-3 relative z-10"},Xa={class:"relative"},Za=["onKeyup"],_a={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},en=["disabled"],tn={key:0,class:"fa-solid fa-spinner fa-spin"},sn={key:1,class:"fa-solid fa-magic"},on={class:"bg-gray-50 border-t border-gray-200"},ln={class:"p-4 flex justify-end gap-3"},an={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},nn={class:"mb-5"},rn={class:"flex flex-col gap-2"},dn={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},un=["checked"],cn={key:6,class:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},mn={class:"p-6 flex flex-col items-center justify-center text-center"},pn={class:"bg-white border border-gray-200 rounded-lg px-4 py-2 flex items-center gap-2 text-sm text-slate-700 shadow-sm"},yn={class:"font-medium"},fn={key:7,class:"space-y-4 mb-6 px-1"},gn={class:"bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden transform transition-all scale-100"},vn={class:"p-5 border-b border-gray-100 bg-gray-50/50"},bn={class:"font-bold text-slate-800 text-lg"},xn={class:"p-5"},hn={class:"bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden transform transition-all scale-100"},wn={class:"p-5 border-b border-gray-100 bg-gray-50/50"},kn={class:"font-bold text-slate-800 text-lg"},$n={class:"p-5"},Cn={class:"bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 overflow-hidden transform transition-all scale-100"},Sn={class:"p-5"},Dn={class:"mb-4"},An={class:"flex gap-4"},In={class:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer"},On={class:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer"},Tn={class:"p-4 bg-gray-50 flex justify-end gap-3"},qn={__name:"LeadContent",props:{lead:{type:Object,required:!0}},setup(t){const g=t,a=Ye(),p=He(),o=C(!1),y=C("overview"),d=C(!1),i=C(!1),r=C(!1),u=C(!1),v=C([]),f=C([]),w=C(0),A=C([]),k=C(""),I=C(null),E=C(null),_=C("email");C("");const T=C("qualify"),M=C("not-interested"),D=C("Data cleanup"),j=C(null),B=C(null),O=C(0),P=C(!1),pe=C([]),se=C(!1),le=C(!1),ae=C(!1),ye=[{speaker:"Sales",text:"Good morning, am I speaking with Mr. Adams?"},{speaker:"Lead",text:"Yes, this is Josh Adams speaking."},{speaker:"Sales",text:"Hi Josh, Michael here regarding your Audi A6 inquiry."},{speaker:"Lead",text:"Oh, hi Michael! Yes, I was waiting for your call."},{speaker:"Sales",text:"Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"},{speaker:"Lead",text:"Yes, I actually have a BMW X3, 2018 model with about 45,000 km.",action:{type:"tradein",data:{brand:"BMW",model:"X3",year:"2018",km:"45,000",auto:!0}}},{speaker:"Sales",text:"Excellent, we can certainly evaluate that. And regarding payment?"},{speaker:"Lead",text:"I'd like to put down €5,000 and finance the rest over 3 years.",action:{type:"financing",data:{product:"Standard Loan",provider:"Audi Financial",total:"14,000",monthly:"420",auto:!0}}},{speaker:"Sales",text:"Understood. I'll note that down and prepare the proposal.",action:{type:"note",data:"Customer requests 3-year financing with €5k deposit."}},{speaker:"Lead",text:"Sounds amazing. Let's proceed with the paperwork."}],$e=x=>x==="note"?"note":["call","email","sms","whatsapp","communication"].includes(x)?"communication":x==="attachment"?"attachment":"overview",fe=F(()=>[...p.currentLeadActivities,...v.value.filter(n=>!n.activityId)].filter(n=>{const S=$e(n.type);return y.value==="overview"?S==="overview":S===y.value})),we=F(()=>{const x=[...p.currentLeadActivities,...v.value],n=x.length,S=x.filter(he=>["call","email","sms","whatsapp","communication"].includes(he.type)).length,K=x.filter(he=>he.type==="note").length,je=x.filter(he=>he.type==="attachment").length;return[{key:"overview",label:"Overview",count:n},{key:"note",label:"Notes",count:K},{key:"communication",label:"Communication",count:S},{key:"attachment",label:"Attachments",count:je}]}),b=F(()=>{var n;const x=["tradein","financing"];return(n=g.lead)!=null&&n.requestedCar||x.push("requestedCar"),x}),h=[{name:"Sport",color:"bg-red-400"},{name:"Blacklist",color:"bg-indigo-400"},{name:"Green",color:"bg-green-400"},{name:"Premium",color:"bg-blue-400"},{name:"Rent",color:"bg-purple-400"},{name:"Automation",color:"bg-orange-400"},{name:"Complete Profile",color:"bg-lime-400"}],R=x=>{E.value=null,y.value==="overview"?x==="tradein"?le.value=!0:x==="financing"?ae.value=!0:x==="requestedCar"&&(I.value=null):["email","whatsapp","sms"].includes(x)?(_.value=x,I.value="communication"):I.value=x},ee=x=>{if(E.value=x,y.value==="overview"){if(x.type==="tradein"){le.value=!0,ae.value=!1;return}if(x.type==="financing"){ae.value=!0,le.value=!1;return}}I.value=x.type},ne=async x=>{const n=v.value.findIndex(S=>S.id===x.id);n>-1&&v.value.splice(n,1),x.activityId&&await p.deleteActivity(g.lead.id,x.activityId)},G=async x=>{var n,S;if(x.isEdit){const K=v.value.findIndex(he=>he.id===x.id);K>-1&&(v.value[K]={...v.value[K],...x});const je=((n=E.value)==null?void 0:n.activityId)||((S=E.value)==null?void 0:S.id)||x.id;je&&await p.updateActivity(g.lead.id,je,{type:x.communicationType||x.type,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}else{const K=x.communicationType||x.type;await p.addActivity(g.lead.id,{type:K,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}I.value=null,E.value=null,le.value=!1,ae.value=!1},oe=()=>{I.value=null,E.value=null,le.value=!1,ae.value=!1};Ae(y,()=>{I.value=null,E.value=null});const ge=x=>{d.value=!1},ve=async x=>{if(!g.lead.tags.includes(x)){const n=[...g.lead.tags,x];await p.modifyLead(g.lead.id,{tags:n})}o.value=!1},xe=x=>{const n=Math.floor(x/60),S=x%60;return`${n.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`},W=()=>{u.value=!u.value,u.value?(w.value=0,O.value=0,A.value=[],P.value=!1,pe.value=[],j.value=setInterval(()=>{w.value++},1e3),B.value=setInterval(()=>{if(O.value<ye.length){const x=ye[O.value];A.value.push({speaker:x.speaker,text:x.text}),O.value++,A.value.length>4&&A.value.shift()}else clearInterval(B.value),clearInterval(j.value),P.value=!0,Ce()},2500)):(j.value&&clearInterval(j.value),B.value&&clearInterval(B.value),P.value=!1,f.value.length>0&&Ce())},Ce=async()=>{for(const x of f.value){const n={id:Date.now()+Math.random(),type:"note",action:"added a note",content:x,timestamp:new Date().toISOString()};v.value.push(n),await p.addActivity(g.lead.id,{type:"note",user:"You",action:"added a note",content:x})}f.value=[]},Te=async()=>{se.value=!0,await new Promise(x=>setTimeout(x,800));for(let x=0;x<ye.length;x++){const n=ye[x];n.action&&!pe.value.includes(x)&&(n.action.type==="tradein"?z(n.action.data):n.action.type==="financing"?X(n.action.data):n.action.type==="note"&&q(n.action.data),pe.value.push(x))}se.value=!1,u.value=!1,P.value=!1},qe=()=>{navigator.clipboard.writeText(g.lead.customer.phone)},$=()=>{k.value.trim()&&(f.value.push(k.value),k.value="")},q=x=>{const n={id:Date.now(),type:"note",action:"added a note",content:x,timestamp:new Date().toISOString(),autoDetected:!0};v.value.push(n)},z=x=>{const n={id:Date.now(),type:"tradein",action:"added a trade-in",data:x,timestamp:new Date().toISOString(),autoDetected:x.auto||!1};v.value.push(n)},X=x=>{const n={id:Date.now(),type:"financing",action:"added a financing proposal",data:x,timestamp:new Date().toISOString(),autoDetected:x.auto||!1};v.value.push(n)},te=async()=>{i.value=!1,a.push("/tasks")},ue=x=>{i.value=!1,T.value="qualify",a.push("/tasks")},ie=async()=>{await p.modifyLead(g.lead.id,{isDisqualified:!0,disqualifyReason:D.value,stage:"Disqualified"}),r.value=!1},re={mounted(x,n){x.clickOutsideEvent=S=>{x===S.target||x.contains(S.target)||n.value()},document.addEventListener("click",x.clickOutsideEvent)},unmounted(x){document.removeEventListener("click",x.clickOutsideEvent)}};return tt(()=>{j.value&&clearInterval(j.value),B.value&&clearInterval(B.value)}),(x,n)=>(s(),l("div",El,[e("header",Ul,[e("div",Ll,[H(Je,{initials:t.lead.customer.initials,name:t.lead.customer.name,"avatar-color-class":"bg-orange-100 text-orange-600",email:t.lead.customer.email,phone:t.lead.customer.phone,"third-field-value":t.lead.customer.address,"email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:De(()=>[(s(!0),l(J,null,Z(t.lead.tags,S=>(s(),l("span",{key:S,class:"px-2 py-0.5 rounded-full border bg-blue-50 border-blue-100 text-blue-700 text-xs font-semibold"},m(S),1))),128)),e("div",Bl,[e("button",{onClick:n[0]||(n[0]=Y(S=>o.value=!o.value,["stop"])),class:"text-[10px] md:text-xs font-semibold text-blue-600 hover:text-blue-700 hover:underline flex items-center gap-1 transition-colors outline-none"}," + Add tag "),o.value?L((s(),l("div",Pl,[n[27]||(n[27]=e("div",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider px-3 py-2"},"Select Tag",-1)),(s(),l(J,null,Z(h,S=>e("button",{key:S.name,onClick:K=>ve(S.name),class:"w-full text-left px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-gray-50 rounded flex items-center gap-2 transition-colors"},[e("span",{class:V(["w-2 h-2 rounded-full",S.color])},null,2),N(" "+m(S.name),1)],8,Rl)),64))])),[[re,()=>o.value=!1]]):c("",!0)])]),_:1},8,["initials","name","email","phone","third-field-value"])])]),e("main",Wl,[e("div",zl,[H(Ge,{modelValue:y.value,"onUpdate:modelValue":n[1]||(n[1]=S=>y.value=S),tabs:we.value,class:"mb-0"},null,8,["modelValue","tabs"]),y.value==="overview"?(s(),U(Ne,{key:0,actions:b.value,"active-tab":y.value,inline:!0,onAction:R},null,8,["actions","active-tab"])):c("",!0)]),y.value==="overview"?(s(),l("div",Yl,[e("div",Hl,[e("div",Ql,[n[28]||(n[28]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Stage",-1)),e("span",Kl,m(t.lead.stage),1)]),n[31]||(n[31]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Jl,[n[29]||(n[29]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Owner",-1)),e("span",Gl,m(t.lead.assignee),1)]),n[32]||(n[32]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Xl,[n[30]||(n[30]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Source",-1)),e("span",Zl,m(t.lead.source),1)])])])):c("",!0),y.value==="overview"?(s(),l("div",_l,[t.lead.isDisqualified?c("",!0):(s(),l("div",ea,[n[52]||(n[52]=Be('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage this lead</h3></div><span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium">Task pending</span></div>',1)),e("div",ta,[e("div",sa,[e("div",oa,[e("div",null,[n[33]||(n[33]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Step: Initial Contact",-1)),e("p",la,"Call customer to discuss "+m(t.lead.requestedCar.brand)+" "+m(t.lead.requestedCar.model)+" interest.",1)]),e("div",aa,[u.value?(s(),l("span",ia,[...n[35]||(n[35]=[N("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(s(),l("span",na,[...n[34]||(n[34]=[N("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",ra,[e("button",{onClick:W,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[N(m(t.lead.customer.phone)+" Call ",1),n[36]||(n[36]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:qe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...n[37]||(n[37]=[N(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),u.value&&!P.value?(s(),l("div",da,[e("div",ua,[n[39]||(n[39]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",ca,[n[38]||(n[38]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",ma,"REC "+m(xe(w.value)),1)])]),e("div",pa,[(s(!0),l(J,null,Z(A.value,(S,K)=>(s(),l("div",{key:K,class:V(["text-xs font-mono transition-all duration-500",S.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",ya,m(S.speaker)+":",1),n[40]||(n[40]=N()),e("span",null,m(S.text),1)],2))),128))])])):c("",!0),u.value&&!P.value&&f.value.length>0?(s(),l("div",fa,[(s(!0),l(J,null,Z(f.value,(S,K)=>(s(),l("div",{key:K,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[n[41]||(n[41]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",ga,m(S),1)]))),128))])):c("",!0),u.value&&!P.value?(s(),l("div",va,[e("div",ba,[L(e("textarea",{"onUpdate:modelValue":n[2]||(n[2]=S=>k.value=S),onKeyup:ze(Y($,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,xa),[[Q,k.value]]),e("button",{onClick:$,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...n[42]||(n[42]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):c("",!0),u.value&&P.value?(s(),l("div",ha,[n[43]||(n[43]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:Te,disabled:se.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[se.value?(s(),l("i",ka)):(s(),l("i",$a)),e("span",null,m(se.value?"Extracting...":"Extract information from transcription"),1)],8,wa)])):c("",!0)])]),e("div",Ca,[e("div",Sa,[e("button",{onClick:n[3]||(n[3]=S=>r.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...n[44]||(n[44]=[N(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:n[4]||(n[4]=S=>{d.value=!d.value,i.value=!1}),class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...n[45]||(n[45]=[N(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:n[5]||(n[5]=S=>{i.value=!i.value,d.value=!1}),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...n[46]||(n[46]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])]),H(Fe,{show:d.value,onClose:n[6]||(n[6]=S=>d.value=!1),onConfirm:ge},null,8,["show"]),i.value?(s(),l("div",Da,[n[51]||(n[51]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Create Opportunity",-1)),e("div",Aa,[n[49]||(n[49]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",Ia,[e("label",Oa,[L(e("input",{type:"radio","onUpdate:modelValue":n[7]||(n[7]=S=>T.value=S),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[Me,T.value]]),n[47]||(n[47]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:n[9]||(n[9]=Y(S=>T.value=T.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:T.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:n[8]||(n[8]=Y(()=>{},["stop"]))},null,8,Ta),n[48]||(n[48]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),T.value==="schedule"?(s(),U(Oe,{key:0,show:T.value==="schedule",onConfirm:ue,onCancel:n[10]||(n[10]=S=>T.value="qualify")},null,8,["show"])):c("",!0),T.value!=="schedule"?(s(),l("button",{key:1,onClick:te,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...n[50]||(n[50]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):c("",!0)])):c("",!0)])])),t.lead&&t.lead.requestedCar?(s(),U(Ve,{key:1,brand:t.lead.requestedCar.brand,model:t.lead.requestedCar.model,year:t.lead.requestedCar.year,image:t.lead.requestedCar.image||"",price:t.lead.requestedCar.price||null,"request-message":t.lead.requestedCar.requestMessage||"","request-type":"Lead",source:t.lead.source||"",dealership:t.lead.requestedCar.dealership||"",registration:t.lead.requestedCar.registration||"",kilometers:t.lead.requestedCar.kilometers!==void 0?t.lead.requestedCar.kilometers:null,"fuel-type":t.lead.requestedCar.fuelType||"","gear-type":t.lead.requestedCar.gearType||"",vin:t.lead.requestedCar.vin||"","stock-days":t.lead.requestedCar.stockDays!==void 0?t.lead.requestedCar.stockDays:null,"fiscal-entity":t.lead.fiscalEntity||"","source-details":t.lead.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):c("",!0)])):c("",!0),y.value!=="overview"?(s(),U(Ne,{key:2,actions:["note","tradein","financing","attachment","email","whatsapp","sms"],"active-tab":y.value,onAction:R},null,8,["active-tab"])):c("",!0),y.value!=="overview"?(s(),l("div",qa,[I.value==="communication"?(s(),U(_e,{key:0,type:_.value,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["type","task-id"])):c("",!0),I.value==="note"?(s(),U(Xe,{key:1,item:E.value,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])):c("",!0),I.value==="attachment"?(s(),U(Ze,{key:2,item:E.value,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])):c("",!0),I.value==="tradein"?(s(),U(Ue,{key:3,item:E.value,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])):c("",!0),I.value==="financing"?(s(),U(Le,{key:4,item:E.value,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])):c("",!0)])):c("",!0),fe.value.length>0?(s(),l("div",ja,[(s(!0),l(J,null,Z(fe.value,S=>(s(),U(Ee,{key:S.id,item:S,"task-type":"lead","customer-initials":"SK",onEdit:ee,onDelete:ne},null,8,["item"]))),128))])):c("",!0),y.value==="overview"&&t.lead.isDisqualified?(s(),l("div",Ma,[n[72]||(n[72]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage this lead"),e("span",{class:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium"},"Task pending")],-1)),e("div",Na,[e("div",Va,[e("div",Fa,[e("div",null,[n[53]||(n[53]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Step: Initial Contact",-1)),e("p",Ea,"Call customer to discuss "+m(t.lead.requestedCar.brand)+" "+m(t.lead.requestedCar.model)+" interest.",1)]),e("div",Ua,[u.value?(s(),l("span",Ba,[...n[55]||(n[55]=[N("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(s(),l("span",La,[...n[54]||(n[54]=[N("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",Pa,[e("button",{onClick:W,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[N(m(t.lead.customer.phone)+" Call ",1),n[56]||(n[56]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:qe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...n[57]||(n[57]=[N(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),u.value&&!P.value?(s(),l("div",Ra,[e("div",Wa,[n[59]||(n[59]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",za,[n[58]||(n[58]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",Ya,"REC "+m(xe(w.value)),1)])]),e("div",Ha,[(s(!0),l(J,null,Z(A.value,(S,K)=>(s(),l("div",{key:K,class:V(["text-xs font-mono transition-all duration-500",S.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",Qa,m(S.speaker)+":",1),n[60]||(n[60]=N()),e("span",null,m(S.text),1)],2))),128))])])):c("",!0),u.value&&!P.value&&f.value.length>0?(s(),l("div",Ka,[(s(!0),l(J,null,Z(f.value,(S,K)=>(s(),l("div",{key:K,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[n[61]||(n[61]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",Ja,m(S),1)]))),128))])):c("",!0),u.value&&!P.value?(s(),l("div",Ga,[e("div",Xa,[L(e("textarea",{"onUpdate:modelValue":n[11]||(n[11]=S=>k.value=S),onKeyup:ze(Y($,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,Za),[[Q,k.value]]),e("button",{onClick:$,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...n[62]||(n[62]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):c("",!0),u.value&&P.value?(s(),l("div",_a,[n[63]||(n[63]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:Te,disabled:se.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[se.value?(s(),l("i",tn)):(s(),l("i",sn)),e("span",null,m(se.value?"Extracting...":"Extract information from transcription"),1)],8,en)])):c("",!0)])]),e("div",on,[e("div",ln,[e("button",{onClick:n[12]||(n[12]=S=>r.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...n[64]||(n[64]=[N(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:n[13]||(n[13]=S=>{d.value=!d.value,i.value=!1}),class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...n[65]||(n[65]=[N(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:n[14]||(n[14]=S=>{i.value=!i.value,d.value=!1}),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...n[66]||(n[66]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])]),H(Fe,{show:d.value,onClose:n[15]||(n[15]=S=>d.value=!1),onConfirm:ge},null,8,["show"]),i.value?(s(),l("div",an,[n[71]||(n[71]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Create Opportunity",-1)),e("div",nn,[n[69]||(n[69]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",rn,[e("label",dn,[L(e("input",{type:"radio","onUpdate:modelValue":n[16]||(n[16]=S=>T.value=S),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[Me,T.value]]),n[67]||(n[67]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:n[18]||(n[18]=Y(S=>T.value=T.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:T.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:n[17]||(n[17]=Y(()=>{},["stop"]))},null,8,un),n[68]||(n[68]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),T.value==="schedule"?(s(),U(Oe,{key:0,show:T.value==="schedule",onConfirm:ue,onCancel:n[19]||(n[19]=S=>T.value="qualify")},null,8,["show"])):c("",!0),T.value!=="schedule"?(s(),l("button",{key:1,onClick:te,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...n[70]||(n[70]=[N(" Create Opportunity ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):c("",!0)])):c("",!0)])])):c("",!0),t.lead.isDisqualified?(s(),l("div",cn,[e("div",mn,[n[74]||(n[74]=e("div",{class:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-3"},[e("i",{class:"fa-solid fa-ban text-red-500 text-xl"})],-1)),n[75]||(n[75]=e("h3",{class:"font-bold text-slate-800 text-lg"},"Lead Disqualified",-1)),n[76]||(n[76]=e("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"This lead has been marked as lost.",-1)),e("div",pn,[n[73]||(n[73]=e("span",{class:"text-gray-400 text-xs uppercase font-bold tracking-wider"},"Reason:",-1)),e("span",yn,m(t.lead.disqualifyReason||"Not specified"),1)])])])):c("",!0),fe.value.length>0?(s(),l("div",fn,[(s(!0),l(J,null,Z(fe.value,S=>(s(),U(Ee,{key:S.id,item:S,"task-type":"lead","customer-initials":"SK",onEdit:ee,onDelete:ne},null,8,["item"]))),128))])):c("",!0)]),(s(),U(be,{to:"body"},[le.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in",onClick:n[20]||(n[20]=Y(S=>le.value=!1,["self"]))},[e("div",gn,[e("div",vn,[e("h3",bn,m(E.value&&E.value.type==="tradein"?"Edit Trade-in":"Add Trade-in"),1),n[77]||(n[77]=e("p",{class:"text-xs text-gray-500 mt-1"},"Capture trade-in details for this lead.",-1))]),e("div",xn,[H(Ue,{item:E.value&&E.value.type==="tradein"?E.value:null,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])])])])):c("",!0)])),(s(),U(be,{to:"body"},[ae.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in",onClick:n[21]||(n[21]=Y(S=>ae.value=!1,["self"]))},[e("div",hn,[e("div",wn,[e("h3",kn,m(E.value&&E.value.type==="financing"?"Edit Financing Proposal":"Add Financing Proposal"),1),n[78]||(n[78]=e("p",{class:"text-xs text-gray-500 mt-1"},"Create a financing proposal for this lead.",-1))]),e("div",$n,[H(Le,{item:E.value&&E.value.type==="financing"?E.value:null,"task-type":"lead","task-id":t.lead.id,onSave:G,onCancel:oe},null,8,["item","task-id"])])])])):c("",!0)])),(s(),U(be,{to:"body"},[r.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in",onClick:n[26]||(n[26]=Y(S=>r.value=!1,["self"]))},[e("div",Cn,[n[84]||(n[84]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-slate-800 text-lg"},"Disqualify Lead"),e("p",{class:"text-xs text-gray-500 mt-1"},"Please select a reason for disqualification.")],-1)),e("div",Sn,[e("div",Dn,[n[81]||(n[81]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2"},"Category",-1)),e("div",An,[e("label",In,[L(e("input",{type:"radio","onUpdate:modelValue":n[22]||(n[22]=S=>M.value=S),value:"not-valid",class:"w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300"},null,512),[[Me,M.value]]),n[79]||(n[79]=N(" Not Valid ",-1))]),e("label",On,[L(e("input",{type:"radio","onUpdate:modelValue":n[23]||(n[23]=S=>M.value=S),value:"not-interested",class:"w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300"},null,512),[[Me,M.value]]),n[80]||(n[80]=N(" Not Interested ",-1))])])]),n[83]||(n[83]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2"},"Failure Reason",-1)),L(e("select",{"onUpdate:modelValue":n[24]||(n[24]=S=>D.value=S),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 shadow-sm"},[...n[82]||(n[82]=[e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[Ie,D.value]])]),e("div",Tn,[e("button",{onClick:n[25]||(n[25]=S=>r.value=!1),class:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-white hover:text-slate-800 border border-transparent hover:border-gray-200 rounded-lg transition-all"}," Cancel "),e("button",{onClick:ie,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg shadow-sm shadow-red-200 transition-all"}," Confirm Disqualification ")])])])):c("",!0)]))]))}},jn={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 overflow-hidden"},Mn={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Nn={class:"text-lg font-bold text-gray-900"},We={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:g}){const a=g,p=()=>{a("close")};return(o,y)=>(s(),U(be,{to:"body"},[t.show?(s(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Y(p,["self"])},[e("div",jn,[e("div",Mn,[e("h3",Nn,m(t.title),1),e("button",{onClick:p,class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"},[...y[0]||(y[0]=[e("i",{class:"fa-solid fa-times text-sm"},null,-1)])])]),y[1]||(y[1]=e("div",{class:"px-6 py-12 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:p,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])])])):c("",!0)]))}},Vn={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Fn={class:"flex justify-between items-center mb-4"},En={class:"text-sm font-bold text-slate-800"},Un={key:0,class:"mb-4"},Ln={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},Bn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Pn=["src"],Rn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Wn={class:"flex-1 min-w-0"},zn={class:"flex items-center gap-2 flex-wrap"},Yn={class:"font-bold text-sm text-gray-800 truncate"},Hn={class:"text-xs text-gray-500"},Qn={key:0,class:"text-[10px] text-green-600 mt-0.5"},Kn={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Jn=["onClick"],Gn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Xn=["src"],Zn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},_n={class:"flex-1 min-w-0"},ei={class:"flex items-center gap-2 flex-wrap"},ti={class:"font-bold text-sm text-gray-800 truncate"},si={class:"text-xs text-gray-500"},oi={key:0,class:"text-[10px] text-green-600 mt-0.5"},li={key:1,class:"text-center py-4 text-gray-400 text-sm"},ai={class:"mb-4"},ni={key:0,class:"flex items-center gap-2 mb-2"},ii={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ri={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},di={class:"mt-4"},ui={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ci=["disabled"],mi={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:g}){const a=t,p=g,o=C(null),y=C(null),d=C({brand:"",model:"",year:"",price:"",image:""});ce(()=>{a.item&&a.item.data&&(d.value={brand:a.item.data.brand||"",model:a.item.data.model||"",year:a.item.data.year||"",price:a.item.data.price||"",image:a.item.data.image||""})});const i=f=>{if(o.value=f,a.requestedCar){const w=f.id&&a.requestedCar.id&&f.id===a.requestedCar.id||f.brand===a.requestedCar.brand&&f.model===a.requestedCar.model&&f.year===a.requestedCar.year;y.value=w?"requested":"recommended"}else y.value="recommended";d.value={brand:f.brand||"",model:f.model||"",year:f.year||new Date().getFullYear(),price:f.price||"",image:f.image||""}},r=F(()=>o.value||d.value.brand&&d.value.model&&d.value.price),u=f=>new Intl.NumberFormat("en-US").format(f),v=()=>{var w,A;const f=o.value||d.value;p("save",{id:((w=a.item)==null?void 0:w.id)||Date.now(),type:"offer",action:a.item?"updated an offer":"added an offer",data:{brand:f.brand,model:f.model,year:f.year||new Date().getFullYear(),price:f.price,image:f.image||"",isMainOffer:!1},timestamp:((A=a.item)==null?void 0:A.timestamp)||new Date().toISOString(),isEdit:!!a.item})};return(f,w)=>{var A,k;return s(),l("div",Vn,[e("div",Fn,[e("h5",En,m(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:w[0]||(w[0]=I=>f.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...w[8]||(w[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?c("",!0):(s(),l("div",Un,[w[11]||(w[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",Ln,[t.requestedCar?(s(),l("div",{key:0,onClick:w[1]||(w[1]=I=>i(t.requestedCar)),class:V(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((A=o.value)==null?void 0:A.id)===t.requestedCar.id}])},[e("div",Bn,[t.requestedCar.image?(s(),l("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Pn)):(s(),l("i",Rn))]),e("div",Wn,[e("div",zn,[e("h4",Yn,m(t.requestedCar.brand)+" "+m(t.requestedCar.model)+" ("+m(t.requestedCar.year)+")",1),e("span",{class:V(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((k=o.value)==null?void 0:k.id)===t.requestedCar.id&&y.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",Hn,"€ "+m(u(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(s(),l("div",Qn," In stock ("+m(t.requestedCar.stockDays)+" days) ",1)):(s(),l("div",Kn," Out of stock "))]),w[9]||(w[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):c("",!0),(s(!0),l(J,null,Z(t.recommendedCars,I=>{var E,_;return s(),l("div",{key:I.id,onClick:T=>i(I),class:V(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((E=o.value)==null?void 0:E.id)===I.id}])},[e("div",Gn,[I.image?(s(),l("img",{key:0,src:I.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Xn)):(s(),l("i",Zn))]),e("div",_n,[e("div",ei,[e("h4",ti,m(I.brand)+" "+m(I.model)+" ("+m(I.year)+")",1),e("span",{class:V(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((_=o.value)==null?void 0:_.id)===I.id&&y.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",si,"€ "+m(u(I.price)),1),I.stockDays!==null&&I.stockDays!==void 0?(s(),l("div",oi," In stock ("+m(I.stockDays)+" days) ",1)):c("",!0)]),w[10]||(w[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Jn)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(s(),l("div",li," No vehicles available ")):c("",!0)])])),e("div",ai,[t.requestedCar||t.recommendedCars.length>0?(s(),l("div",ni,[...w[12]||(w[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):c("",!0),e("div",ii,[e("div",null,[w[13]||(w[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),L(e("input",{type:"text","onUpdate:modelValue":w[2]||(w[2]=I=>d.value.brand=I),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,d.value.brand]])]),e("div",null,[w[14]||(w[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),L(e("input",{type:"text","onUpdate:modelValue":w[3]||(w[3]=I=>d.value.model=I),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,d.value.model]])])]),e("div",ri,[e("div",null,[w[15]||(w[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),L(e("input",{type:"number","onUpdate:modelValue":w[4]||(w[4]=I=>d.value.year=I),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,d.value.year]])]),e("div",null,[w[16]||(w[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),L(e("input",{type:"number","onUpdate:modelValue":w[5]||(w[5]=I=>d.value.price=I),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[Q,d.value.price]])])]),e("div",di,[w[17]||(w[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),L(e("input",{type:"text","onUpdate:modelValue":w[6]||(w[6]=I=>d.value.image=I),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[Q,d.value.image]])])]),e("div",ui,[e("button",{onClick:w[7]||(w[7]=I=>f.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:v,disabled:!r.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ci)])])}}},pi={key:0,class:"mb-8"},yi={class:"relative"},fi={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},gi={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},vi=["src"],bi={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},xi={class:"p-4"},hi={class:"font-bold text-gray-800 text-sm mb-1"},wi={class:"text-xs text-gray-500 mb-2"},ki={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},$i=["onClick"],Ci={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:g}){const a=C([]);ce(()=>{a.value=Re.filter(o=>o.stockDays!==null&&o.stockDays!==void 0).slice(0,5)});const p=o=>new Intl.NumberFormat("en-US").format(o);return(o,y)=>a.value.length>0?(s(),l("div",pi,[y[1]||(y[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",yi,[e("div",fi,[(s(!0),l(J,null,Z(a.value,d=>(s(),l("div",{key:d.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",gi,[d.image?(s(),l("img",{key:0,src:d.image,alt:"Car",class:"w-full h-full object-cover"},null,8,vi)):(s(),l("i",bi))]),e("div",xi,[e("h4",hi,m(d.brand)+" "+m(d.model)+" ("+m(d.year)+")",1),e("p",wi,"€ "+m(p(d.price)),1),d.stockDays!==null&&d.stockDays!==void 0?(s(),l("div",ki,[y[0]||(y[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+m(d.stockDays)+" days) ",1)])):c("",!0),e("button",{onClick:i=>o.$emit("add-to-opportunity",d),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,$i)])]))),128))])])])):c("",!0)}},Si=Pe(Ci,[["__scopeId","data-v-0d800814"]]),Di={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Ai={class:"flex justify-between items-start mb-3"},Ii={class:"text-xs text-gray-500 mt-0.5"},Oi={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review"],setup(t,{emit:g}){const a=t,p=g,o=F(()=>{if(!a.opportunity.createdAt)return 0;const i=new Date(a.opportunity.createdAt),u=Math.abs(new Date-i);return Math.ceil(u/(1e3*60*60*24))}),y=()=>{p("create-offer",a.opportunity)},d=()=>{p("review",a.opportunity)};return(i,r)=>(s(),l("div",Di,[e("div",Ai,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Ii,"This opportunity has been open for "+m(o.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:y,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")])]))}},Ti={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},qi={class:"flex justify-between items-start mb-3"},ji={class:"text-xs text-gray-500 mt-0.5"},Mi={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","mark-unsold"],setup(t,{emit:g}){const a=t,p=g,o=F(()=>{const i=a.opportunity.lastActivity||a.opportunity.createdAt;if(!i)return 0;const r=new Date(i),v=Math.abs(new Date-r);return Math.ceil(v/(1e3*60*60*24))}),y=()=>{p("create-contract",a.opportunity)},d=()=>{p("mark-unsold",a.opportunity)};return(i,r)=>(s(),l("div",Ti,[e("div",qi,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",ji,"This opportunity has been in negotiation for "+m(o.value)+" days without a contract. The previous follow-up didn't result in progress. Consider creating a contract or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:y,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Mark as Unsold ")])]))}},Ni={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Vi={class:"flex justify-between items-start mb-3"},Fi={class:"text-xs text-gray-500 mt-0.5"},Ei={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract"],setup(t,{emit:g}){const a=t,p=g,o=F(()=>{const d=a.opportunity.lastActivity||a.opportunity.createdAt;if(!d)return 0;const i=new Date(d),u=Math.abs(new Date-i);return Math.ceil(u/(1e3*60*60*24))}),y=()=>{p("create-contract",a.opportunity)};return(d,i)=>(s(),l("div",Ni,[e("div",Vi,[e("div",null,[i[0]||(i[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Fi,"This opportunity has been in negotiation for "+m(o.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:y,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")])]))}},Ui={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Li={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-opportunity","schedule-closing"],setup(t,{emit:g}){const a=t,p=g,o=()=>{p("close-opportunity",a.opportunity)},y=()=>{p("schedule-closing",a.opportunity)};return(d,i)=>(s(),l("div",Ui,[i[0]||(i[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:o,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Close Opportunity "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Schedule Closing Meeting ")])]))}},Bi={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Pi={class:"flex justify-between items-start mb-3"},Ri={class:"text-xs text-gray-500 mt-0.5"},Wi={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist"],setup(t,{emit:g}){const a=t,p=g,o=F(()=>{var v;if(!((v=a.opportunity)!=null&&v.contractDate))return 0;const i=new Date(a.opportunity.contractDate),u=Math.abs(new Date-i);return Math.ceil(u/(1e3*60*60*24))}),y=()=>{p("prepare-delivery",a.opportunity)},d=()=>{p("pre-delivery-checklist",a.opportunity)};return(i,r)=>(s(),l("div",Bi,[e("div",Pi,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Ri,"Contract was signed "+m(o.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:y,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")])]))}},zi={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Yi={class:"flex justify-between items-start mb-3"},Hi={class:"text-xs text-gray-500 mt-0.5"},Qi={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback"],setup(t,{emit:g}){const a=t,p=g,o=F(()=>{const d=a.activities.find(v=>{var f;return v.type==="delivery"||((f=v.action)==null?void 0:f.toLowerCase().includes("delivered"))});if(!d||!d.timestamp)return 0;const i=new Date(d.timestamp),u=Math.abs(new Date-i);return Math.ceil(u/(1e3*60*60*24))}),y=()=>{p("delivery-feedback",a.opportunity)};return(d,i)=>(s(),l("div",zi,[e("div",Yi,[e("div",null,[i[0]||(i[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Hi,"Vehicle was delivered "+m(o.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:y,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]))}},Ki={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Ji={class:"p-5 space-y-6"},Gi={key:0,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},Xi={class:"flex items-start gap-3"},Zi={class:"flex-1"},_i={class:"font-bold text-slate-800 text-sm mb-1"},er={key:0},tr={key:1},sr={class:"text-xs text-gray-600"},or={key:0},lr={key:1},ar={key:1},nr={class:"flex justify-between items-start mb-3"},ir={class:"font-bold text-slate-800 text-sm"},rr={key:0},dr={key:1},ur={class:"text-xs text-gray-500 mt-0.5"},cr={key:0},mr={key:1},pr={class:"flex gap-3 flex-wrap"},yr={key:0,class:"mt-4"},fr={class:"[&>div]:mb-0"},gr={key:2,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},vr={class:"flex justify-between items-start mb-3"},br={class:"text-xs text-gray-500 mt-0.5"},xr={key:0,class:"pt-4"},hr={key:3,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},wr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},kr={class:"p-6"},$r={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Cr={class:"p-6"},Sr={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:g}){const a=t,p=g,o=C(!1),y=C(!1),d=C(null),i=C(!1),r=C(""),u=C(!1),v=C([]);ce(()=>{v.value=Re.filter($=>$.stockDays!==null&&$.stockDays!==void 0).slice(0,5).map($=>({id:$.id,brand:$.brand,model:$.model,year:$.year,price:$.price,image:$.image||"",stockDays:$.stockDays}))});const f=$=>{r.value=$,i.value=!0},w=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",A=$=>$?new Date($).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",k=()=>{o.value=!o.value},I=$=>{o.value=!1},E=F(()=>{var X;if(!((X=a.opportunity)!=null&&X.createdAt))return 0;const $=new Date(a.opportunity.createdAt),z=Math.abs(new Date-$);return Math.ceil(z/(1e3*60*60*24))}),_=F(()=>{var q,z;return a.activities.some(X=>X.type==="offer")||((q=a.opportunity)==null?void 0:q.stage)==="In Negotiation"||((z=a.opportunity)==null?void 0:z.stage)==="Closed"}),T=F(()=>a.activities.some($=>$.type==="appointment")),M=F(()=>{var q,z;return a.activities.some(X=>{var te,ue;return((te=X.action)==null?void 0:te.toLowerCase().includes("won"))||((ue=X.action)==null?void 0:ue.toLowerCase().includes("contract"))})||((q=a.opportunity)==null?void 0:q.stage)==="Closed"&&((z=a.opportunity)==null?void 0:z.probability)===100}),D=F(()=>a.activities.some($=>{var q,z;return $.type==="delivery"||((q=$.action)==null?void 0:q.toLowerCase().includes("delivered"))||((z=$.action)==null?void 0:z.toLowerCase().includes("delivery"))})),j=F(()=>{var q;if(((q=a.opportunity)==null?void 0:q.stage)!=="Qualified"||_.value||a.scheduledAppointment||T.value)return!1;const $=E.value;return $>=7&&$<14}),B=F(()=>{var ie,re,x;if(((ie=a.opportunity)==null?void 0:ie.stage)!=="In Negotiation")return!1;const $=((re=a.opportunity)==null?void 0:re.contractDate)!==null&&((x=a.opportunity)==null?void 0:x.contractDate)!==void 0,q=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),X=Math.abs(new Date-q),te=Math.ceil(X/(1e3*60*60*24));return!$&&te>=10}),O=F(()=>{var q;return((q=a.opportunity)==null?void 0:q.stage)!=="Qualified"||_.value||!a.scheduledAppointment?!1:E.value>=7}),P=F(()=>{const $=E.value;return $>=14?"high":$>=7?"medium":null}),pe=F(()=>{var te;if(((te=a.opportunity)==null?void 0:te.stage)!=="In Negotiation")return!1;const $=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),z=Math.abs(new Date-$),X=Math.ceil(z/(1e3*60*60*24));return!M.value&&X>=5}),se=F(()=>{var re,x,n;if(((re=a.opportunity)==null?void 0:re.stage)!=="In Negotiation")return!1;const $=((x=a.opportunity)==null?void 0:x.contractDate)!==null&&((n=a.opportunity)==null?void 0:n.contractDate)!==void 0,q=a.scheduledAppointment&&new Date(a.scheduledAppointment.start)>new Date||T.value&&a.activities.some(S=>{var K;return S.type==="appointment"&&((K=S.data)!=null&&K.datetime)?new Date(S.data.datetime)>new Date:!1}),z=a.opportunity.lastActivity?new Date(a.opportunity.lastActivity):new Date(a.opportunity.createdAt),te=Math.abs(new Date-z);return Math.ceil(te/(1e3*60*60*24))>=5&&!$&&!q}),le=F(()=>{var ie;const $=(ie=a.opportunity)==null?void 0:ie.contractDate;if(!$||D.value)return!1;const q=new Date($),X=Math.abs(new Date-q);return Math.ceil(X/(1e3*60*60*24))>=7}),ae=F(()=>{const $=a.activities.find(ie=>{var re;return ie.type==="delivery"||((re=ie.action)==null?void 0:re.toLowerCase().includes("delivered"))});if(!$)return!1;const q=new Date($.timestamp),X=Math.abs(new Date-q);return Math.ceil(X/(1e3*60*60*24))>=3}),ye=()=>{p("add-vehicle",a.opportunity)},$e=()=>{f("Add Vehicle from Stock")},fe=()=>{f("Configure Vehicle")},we=()=>{u.value=!0},b=()=>{u.value=!1},h=$=>{u.value=!1,p("create-offer",{opportunity:a.opportunity,offerData:$})},R=$=>{p("add-to-opportunity",$)},ee=$=>{f("Review Opportunity")},ne=$=>{f("Mark as Unsold")},G=$=>{f("Create Contract")},oe=$=>{f("Close Opportunity")},ge=$=>{y.value=!0,d.value=$},ve=()=>{y.value=!1,d.value=null},xe=$=>{ge("nfu")},W=$=>{ve();const q={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${$.type} on ${$.date} at ${$.time}`,data:{type:$.type,assignee:$.assignee,date:$.date,time:$.time,datetime:`${$.date}T${$.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};p("appointment-created",q)},Ce=$=>{f("Prepare for Delivery")},Te=$=>{f("Pre-Delivery Checklist")},qe=$=>{f("Delivery Feedback")};return($,q)=>t.opportunity?(s(),l("div",Ki,[q[8]||(q[8]=Be('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage this opportunity</h3></div><span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium">Active</span></div>',1)),e("div",Ji,[O.value?(s(),l("div",Gi,[e("div",Xi,[q[5]||(q[5]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",Zi,[e("h4",_i,[P.value==="high"?(s(),l("span",er,"High Risk")):(s(),l("span",tr,"At Risk"))]),e("p",sr,[P.value==="high"?(s(),l("span",or," This opportunity has been open for "+m(E.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(s(),l("span",lr," This opportunity has been open for "+m(E.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):c("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(s(),l("div",ar,[e("div",{class:V([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",nr,[e("div",null,[e("h4",ir,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),l("span",rr," Add Vehicle ")):(s(),l("span",dr," Find Alternative "))]),e("p",ur,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),l("span",cr," The requested vehicle is available. Add it to the opportunity to proceed. ")):(s(),l("span",mr," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",pr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(s(),l("button",{key:0,onClick:ye,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):c("",!0),e("button",{onClick:$e,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:fe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:q[0]||(q[0]=z=>$.$emit("add-tradein")),class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Add trade-in "),e("button",{onClick:q[1]||(q[1]=z=>$.$emit("add-financing")),class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Add financing "),e("button",{onClick:we,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(s(),l("div",yr,[e("div",fr,[H(Si,{onAddToOpportunity:R})])])):c("",!0)],2)])):c("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(s(),l("div",gr,[e("div",vr,[e("div",null,[q[6]||(q[6]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",br,m(t.scheduledAppointment.title)+" on "+m(w(t.scheduledAppointment.start))+" at "+m(A(t.scheduledAppointment.start)),1)])]),e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),o.value?(s(),l("div",xr,[H(Fe,{show:o.value,onClose:q[2]||(q[2]=z=>o.value=!1),onConfirm:I},null,8,["show"])])):c("",!0)])):t.opportunity.stage==="Qualified"&&!T.value?(s(),l("div",hr,[q[7]||(q[7]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:q[3]||(q[3]=z=>ge("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):c("",!0),B.value?(s(),U(Mi,{key:4,opportunity:t.opportunity,onCreateContract:G,onMarkUnsold:ne},null,8,["opportunity"])):c("",!0),j.value?(s(),U(Oi,{key:5,opportunity:t.opportunity,onCreateOffer:we,onReview:ee},null,8,["opportunity"])):c("",!0),se.value?(s(),U(Li,{key:6,opportunity:t.opportunity,onCloseOpportunity:oe,onScheduleClosing:xe},null,8,["opportunity"])):c("",!0),pe.value?(s(),U(Ei,{key:7,opportunity:t.opportunity,onCreateContract:G},null,8,["opportunity"])):c("",!0),le.value?(s(),U(Wi,{key:8,opportunity:t.opportunity,onPrepareDelivery:Ce,onPreDeliveryChecklist:Te},null,8,["opportunity"])):c("",!0),ae.value?(s(),U(Qi,{key:9,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:qe},null,8,["opportunity","activities"])):c("",!0)]),H(We,{show:i.value,title:r.value,onClose:q[4]||(q[4]=z=>i.value=!1)},null,8,["show","title"]),(s(),U(be,{to:"body"},[u.value?(s(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Y(b,["self"])},[e("div",wr,[e("div",kr,[H(mi,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":v.value,onSave:h,onCancel:b},null,8,["task-id","requested-car","recommended-cars"])])])])):c("",!0)])),(s(),U(be,{to:"body"},[y.value?(s(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Y(ve,["self"])},[e("div",$r,[e("div",Cr,[H(Oe,{show:y.value,onConfirm:W,onCancel:ve},null,8,["show"])])])])):c("",!0)]))])):c("",!0)}},Dr={key:0,class:"mb-8"},Ar={class:"relative"},Ir={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Or=["onClick"],Tr={key:0,class:"absolute top-2 right-2 z-10 bg-purple-600 text-white text-[10px] font-bold px-2 py-1 rounded-md shadow-sm"},qr={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},jr=["src"],Mr={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},Nr={class:"p-4"},Vr={class:"font-bold text-gray-800 text-sm mb-1"},Fr={class:"text-xs text-gray-500 mb-2"},Er={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},Ur={__name:"OffersCarousel",setup(t){const g=C(!1),a=C([]);ce(()=>{a.value=Re.filter(y=>y.stockDays!==null&&y.stockDays!==void 0).slice(0,5)});const p=y=>new Intl.NumberFormat("en-US").format(y),o=y=>{g.value=!0};return(y,d)=>a.value.length>0?(s(),l("div",Dr,[d[2]||(d[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Offers")],-1)),e("div",Ar,[e("div",Ir,[(s(!0),l(J,null,Z(a.value,(i,r)=>(s(),l("div",{key:i.id,class:"flex-none w-64 snap-start bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:u=>o()},[r===0?(s(),l("div",Tr," Main Offer ")):c("",!0),e("div",qr,[i.image?(s(),l("img",{key:0,src:i.image,alt:"Car",class:"w-full h-full object-cover"},null,8,jr)):(s(),l("i",Mr))]),e("div",Nr,[e("h4",Vr,m(i.brand)+" "+m(i.model)+" ("+m(i.year)+")",1),e("p",Fr,"€ "+m(p(i.price)),1),i.stockDays!==null&&i.stockDays!==void 0?(s(),l("div",Er,[d[1]||(d[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+m(i.stockDays)+" days) ",1)])):c("",!0)])],8,Or))),128))])]),H(We,{show:g.value,title:"Offer Details",onClose:d[0]||(d[0]=i=>g.value=!1)},null,8,["show"])])):c("",!0)}},Lr=Pe(Ur,[["__scopeId","data-v-806b0af7"]]),Br={class:"flex-1 flex flex-col overflow-hidden"},Pr={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},Rr={class:"px-4 md:px-8 py-4 md:py-6"},Wr={class:"relative ml-1"},zr={key:0,class:"absolute top-full left-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg z-50 p-1 overflow-hidden"},Yr=["onClick"],Hr={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Qr={class:"flex items-center justify-between mb-4"},Kr={key:0,class:"mb-6"},Jr={class:"flex items-center bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden w-full"},Gr={class:"flex items-center gap-2 px-3 py-1.5"},Xr={class:"text-xs font-bold text-gray-800"},Zr={class:"flex items-center gap-2 px-3 py-1.5"},_r={class:"flex items-center gap-2"},ed={class:"w-16 bg-gray-200 rounded-full h-2"},td={class:"text-xs font-bold text-gray-800"},sd={class:"flex items-center gap-2 px-3 py-1.5"},od={class:"text-xs font-bold text-gray-800"},ld={key:0,class:"w-px h-4 bg-gray-200"},ad={key:1,class:"flex items-center gap-2 px-3 py-1.5"},nd={class:"text-xs font-bold text-gray-800"},id={key:1,class:"space-y-6 mb-6"},rd={key:0},dd={key:3},ud={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 mb-6"},cd={key:4,class:"space-y-4 mb-6 px-1"},md={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto"},pd={class:"p-6"},yd={class:"flex items-center justify-between mb-4"},fd={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto"},gd={class:"p-6"},vd={class:"flex items-center justify-between mb-4"},bd={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},xd={class:"p-6"},hd={__name:"OpportunityContent",props:{opportunity:{type:Object,required:!0}},setup(t){const g=t,a=Ke(),p=C(!1),o=C(!1),y=C(""),d=C(!1),i=C("overview"),r=C(null),u=C(null),v=C("email"),f=C([]),w=C(!1),A=C(!1),k=b=>b==="note"?"note":["call","email","sms","whatsapp","communication"].includes(b)?"communication":b==="attachment"?"attachment":"overview",I=[{name:"Sport",color:"bg-red-400"},{name:"Blacklist",color:"bg-indigo-400"},{name:"Green",color:"bg-green-400"},{name:"Premium",color:"bg-blue-400"},{name:"Rent",color:"bg-purple-400"},{name:"Automation",color:"bg-orange-400"},{name:"Complete Profile",color:"bg-lime-400"}],E=F(()=>[...a.currentOpportunityActivities,...f.value.filter(h=>!h.activityId)].filter(h=>{const R=k(h.type);return i.value==="overview"?R==="overview":R===i.value})),_=F(()=>{const b=[...a.currentOpportunityActivities,...f.value],h=b.length,R=b.filter(G=>["call","email","sms","whatsapp","communication"].includes(G.type)).length,ee=b.filter(G=>G.type==="note").length,ne=b.filter(G=>G.type==="attachment").length;return[{key:"overview",label:"Overview",count:h},{key:"note",label:"Notes",count:ee},{key:"communication",label:"Communication",count:R},{key:"attachment",label:"Attachments",count:ne}]}),T=F(()=>["tradein","financing"]),M=F(()=>["note","attachment","email","whatsapp","sms"]),D=b=>{u.value=null,i.value==="overview"?b==="tradein"?(w.value=!0,A.value=!1):b==="financing"&&(A.value=!0,w.value=!1):b==="scheduleAppointment"?d.value?d.value=!1:d.value=!0:["addVehicle","configureVehicle"].includes(b)?(y.value=b.replace(/([A-Z])/g," $1").trim(),o.value=!0):["email","whatsapp","sms"].includes(b)?(v.value=b,r.value="communication"):r.value=b},j=b=>{if(u.value=b,i.value==="overview"){if(b.type==="tradein"){w.value=!0;return}if(b.type==="financing"){A.value=!0;return}}r.value=b.type},B=async b=>{const h=f.value.findIndex(R=>R.id===b.id);h>-1&&f.value.splice(h,1),b.activityId&&await a.deleteActivity(g.opportunity.id,b.activityId)},O=async b=>{var h;if(b.isEdit){const R=f.value.findIndex(ee=>ee.id===b.id);R>-1&&(f.value[R]={...f.value[R],...b}),(h=u.value)!=null&&h.activityId&&await a.updateActivity(g.opportunity.id,u.value.activityId,{type:b.communicationType||b.type,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data})}else{const R=b.communicationType||b.type,ee={id:b.id,type:R==="email"||R==="whatsapp"||R==="sms"?"communication":R,action:b.action,content:b.content,fileName:b.fileName,data:b.data,timestamp:b.timestamp,autoDetected:b.autoDetected||!1,communicationType:b.communicationType};f.value.push(ee);const ne=await a.addActivity(g.opportunity.id,{type:R,user:"You",action:b.action,content:b.content,fileName:b.fileName,data:b.data});ee.activityId=ne.id,R==="offer"&&opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id))}r.value=null,u.value=null},P=()=>{r.value=null,u.value=null},pe=async b=>{if(!g.opportunity.tags.includes(b)){const h=[...g.opportunity.tags||[],b];await a.modifyOpportunity(g.opportunity.id,{tags:h})}p.value=!1};Ae(i,()=>{r.value=null,u.value=null,d.value=!1});const se=async b=>{d.value=!1;const h={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${b.type} on ${b.date} at ${b.time}`,data:{type:b.type,assignee:b.assignee,date:b.date,time:b.time,datetime:`${b.date}T${b.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};f.value.push({id:Date.now(),...h}),await a.addActivity(g.opportunity.id,{type:"appointment",user:"You",action:h.action,content:h.content,data:h.data})},le=async b=>{f.value.push({id:Date.now(),...b}),await a.addActivity(g.opportunity.id,{type:"appointment",user:b.user,action:b.action,content:b.content,data:b.data})},ae=async b=>{if(!(opportunity!=null&&opportunity.id))return;const h={type:"offer",user:"You",action:"created an offer",content:`Offer created for ${b.brand} ${b.model}${b.year?` (${b.year})`:""}`,data:{vehicle:b,price:b.price,isMainOffer:!0}};await a.addActivity(opportunity.id,h),opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id)),f.value.push({id:Date.now(),type:"offer",action:"created an offer",content:h.content,data:h.data,timestamp:new Date().toISOString()})},ye=()=>{},$e=()=>{},fe=({opportunity:b,offerData:h})=>{O(h)},we=async b=>{if(!(opportunity!=null&&opportunity.id))return;const h={type:"offer",user:"You",action:"created an offer",content:`Offer created for ${b.brand} ${b.model}${b.year?` (${b.year})`:""}`,data:{vehicle:b,price:b.price,isMainOffer:!1}};await a.addActivity(opportunity.id,h),opportunity.stage==="Qualified"&&(await a.modifyOpportunity(opportunity.id,{stage:"In Negotiation",lastActivity:new Date().toISOString()}),await a.loadOpportunityById(opportunity.id)),f.value.push({id:Date.now(),type:"offer",action:"created an offer",content:h.content,data:h.data,timestamp:new Date().toISOString()})};return(b,h)=>{var ee,ne,G,oe,ge,ve,xe;const R=st("click-outside");return s(),l("div",Br,[e("header",Pr,[e("div",Rr,[H(Je,{initials:t.opportunity.customer.initials,name:t.opportunity.customer.name,"avatar-color-class":"bg-purple-100 text-purple-600",email:t.opportunity.customer.email,phone:t.opportunity.customer.phone,"third-field-value":t.opportunity.customer.address,"email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:De(()=>[(s(!0),l(J,null,Z(t.opportunity.tags,W=>(s(),l("span",{key:W,class:"px-2 py-0.5 rounded-full border bg-blue-50 border-blue-100 text-blue-700 text-xs font-semibold"},m(W),1))),128)),e("div",Wr,[e("button",{onClick:h[0]||(h[0]=Y(W=>p.value=!p.value,["stop"])),class:"text-[10px] md:text-xs font-semibold text-blue-600 hover:text-blue-700 hover:underline flex items-center gap-1 transition-colors outline-none"}," + Add tag "),p.value?L((s(),l("div",zr,[h[14]||(h[14]=e("div",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider px-3 py-2"},"Select Tag",-1)),(s(),l(J,null,Z(I,W=>e("button",{key:W.name,onClick:Ce=>pe(W.name),class:"w-full text-left px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-gray-50 rounded flex items-center gap-2 transition-colors"},[e("span",{class:V(["w-2 h-2 rounded-full",W.color])},null,2),N(" "+m(W.name),1)],8,Yr)),64))])),[[R,()=>p.value=!1]]):c("",!0)])]),_:1},8,["initials","name","email","phone","third-field-value"])])]),e("main",Hr,[e("div",Qr,[H(Ge,{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=W=>i.value=W),tabs:_.value,class:"mb-0"},null,8,["modelValue","tabs"]),i.value==="overview"?(s(),U(Ne,{key:0,actions:T.value,"active-tab":i.value,inline:!0,onAction:D},null,8,["actions","active-tab"])):c("",!0)]),i.value==="overview"?(s(),l("div",Kr,[e("div",Jr,[e("div",Gr,[h[15]||(h[15]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Stage",-1)),e("span",Xr,m(t.opportunity.stage),1)]),h[19]||(h[19]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",Zr,[h[16]||(h[16]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Probability",-1)),e("div",_r,[e("div",ed,[e("div",{class:V(["h-2 rounded-full transition-all",t.opportunity.probability>=70?"bg-green-500":t.opportunity.probability>=40?"bg-orange-500":"bg-red-500"]),style:Qe({width:t.opportunity.probability+"%"})},null,6)]),e("span",td,m(t.opportunity.probability)+"%",1)])]),h[20]||(h[20]=e("div",{class:"w-px h-4 bg-gray-200"},null,-1)),e("div",sd,[h[17]||(h[17]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Owner",-1)),e("span",od,m(t.opportunity.assignee),1)]),t.opportunity.source?(s(),l("div",ld)):c("",!0),t.opportunity.source?(s(),l("div",ad,[h[18]||(h[18]=e("span",{class:"text-[10px] text-gray-400 font-bold uppercase"},"Source",-1)),e("span",nd,m(t.opportunity.source),1)])):c("",!0)])])):c("",!0),i.value==="overview"?(s(),l("div",id,[H(Sr,{opportunity:t.opportunity,"scheduled-appointment":((ee=t.opportunity)==null?void 0:ee.scheduledAppointment)||null,activities:[...ot(a).currentOpportunityActivities,...f.value],onAddVehicle:ae,onAddVehicleFromStock:ye,onConfigureVehicle:$e,onCreateOffer:fe,onAddToOpportunity:we,onAppointmentCreated:le},null,8,["opportunity","scheduled-appointment","activities"]),((ne=t.opportunity)==null?void 0:ne.stage)==="In Negotiation"||((G=t.opportunity)==null?void 0:G.stage)==="Closed"?(s(),l("div",rd,[H(Lr)])):c("",!0),t.opportunity&&t.opportunity.vehicle&&!(((oe=t.opportunity)==null?void 0:oe.stage)==="In Negotiation"||((ge=t.opportunity)==null?void 0:ge.stage)==="Closed")?(s(),U(Ve,{key:1,brand:t.opportunity.vehicle.brand,model:t.opportunity.vehicle.model,year:t.opportunity.vehicle.year,image:t.opportunity.vehicle.image||"",price:t.opportunity.vehicle.price||null,"request-message":t.opportunity.vehicle.requestMessage||"","request-type":"Opportunity",source:t.opportunity.source||"",dealership:t.opportunity.vehicle.dealership||"",registration:t.opportunity.vehicle.registration||"",kilometers:t.opportunity.vehicle.kilometers!==void 0?t.opportunity.vehicle.kilometers:null,"fuel-type":t.opportunity.vehicle.fuelType||"","gear-type":t.opportunity.vehicle.gearType||"",vin:t.opportunity.vehicle.vin||"","stock-days":t.opportunity.vehicle.stockDays!==void 0?t.opportunity.vehicle.stockDays:null,"fiscal-entity":t.opportunity.vehicle.fiscalEntity||"","source-details":t.opportunity.vehicle.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):c("",!0),t.opportunity&&t.opportunity.vehicle&&(((ve=t.opportunity)==null?void 0:ve.stage)==="In Negotiation"||((xe=t.opportunity)==null?void 0:xe.stage)==="Closed")?(s(),U(Ve,{key:2,brand:t.opportunity.vehicle.brand,model:t.opportunity.vehicle.model,year:t.opportunity.vehicle.year,image:t.opportunity.vehicle.image||"",price:t.opportunity.vehicle.price||null,"request-message":t.opportunity.vehicle.requestMessage||"","request-type":"Opportunity",source:t.opportunity.source||"",dealership:t.opportunity.vehicle.dealership||"",registration:t.opportunity.vehicle.registration||"",kilometers:t.opportunity.vehicle.kilometers!==void 0?t.opportunity.vehicle.kilometers:null,"fuel-type":t.opportunity.vehicle.fuelType||"","gear-type":t.opportunity.vehicle.gearType||"",vin:t.opportunity.vehicle.vin||"","stock-days":t.opportunity.vehicle.stockDays!==void 0?t.opportunity.vehicle.stockDays:null,"fiscal-entity":t.opportunity.vehicle.fiscalEntity||"","source-details":t.opportunity.vehicle.sourceDetails||""},null,8,["brand","model","year","image","price","request-message","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","fiscal-entity","source-details"])):c("",!0)])):c("",!0),i.value!=="overview"?(s(),U(Ne,{key:2,actions:M.value,"active-tab":i.value,onAction:D},null,8,["actions","active-tab"])):c("",!0),i.value!=="overview"?(s(),l("div",dd,[d.value?(s(),l("div",ud,[H(Oe,{show:d.value,onConfirm:se,onCancel:h[2]||(h[2]=W=>d.value=!1)},null,8,["show"])])):c("",!0),r.value==="communication"?(s(),U(_e,{key:1,type:v.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:O,onCancel:P},null,8,["type","task-id"])):c("",!0),r.value==="note"?(s(),U(Xe,{key:2,item:u.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:O,onCancel:P},null,8,["item","task-id"])):c("",!0),r.value==="attachment"?(s(),U(Ze,{key:3,item:u.value,"task-type":"opportunity","task-id":t.opportunity.id,onSave:O,onCancel:P},null,8,["item","task-id"])):c("",!0)])):c("",!0),E.value.length>0?(s(),l("div",cd,[(s(!0),l(J,null,Z(E.value,W=>(s(),U(Ee,{key:W.id,item:W,"task-type":"opportunity","customer-initials":"SK",onEdit:j,onDelete:B},null,8,["item"]))),128))])):c("",!0),(s(),U(be,{to:"body"},[w.value?(s(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:h[6]||(h[6]=Y(()=>{w.value=!1,u.value=null},["self"]))},[e("div",md,[e("div",pd,[e("div",yd,[h[22]||(h[22]=e("h3",{class:"text-base font-semibold text-slate-900"},"Add trade-in",-1)),e("button",{class:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",onClick:h[3]||(h[3]=()=>{w.value=!1,u.value=null})},[...h[21]||(h[21]=[e("i",{class:"fa-solid fa-xmark text-sm text-gray-500"},null,-1)])])]),H(Ue,{item:u.value&&u.value.type==="tradein"?u.value:null,"task-type":"opportunity","task-id":t.opportunity.id,onSave:h[4]||(h[4]=W=>O({...W,type:"tradein"})),onCancel:h[5]||(h[5]=()=>{w.value=!1,u.value=null})},null,8,["item","task-id"])])])])):c("",!0),A.value?(s(),l("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:h[10]||(h[10]=Y(()=>{A.value=!1,u.value=null},["self"]))},[e("div",fd,[e("div",gd,[e("div",vd,[h[24]||(h[24]=e("h3",{class:"text-base font-semibold text-slate-900"},"Add financing",-1)),e("button",{class:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",onClick:h[7]||(h[7]=()=>{A.value=!1,u.value=null})},[...h[23]||(h[23]=[e("i",{class:"fa-solid fa-xmark text-sm text-gray-500"},null,-1)])])]),H(Le,{item:u.value&&u.value.type==="financing"?u.value:null,"task-type":"opportunity","task-id":t.opportunity.id,onSave:h[8]||(h[8]=W=>O({...W,type:"financing"})),onCancel:h[9]||(h[9]=()=>{A.value=!1,u.value=null})},null,8,["item","task-id"])])])])):c("",!0)]))]),H(We,{show:o.value,title:y.value,onClose:h[11]||(h[11]=W=>o.value=!1)},null,8,["show","title"]),(s(),U(be,{to:"body"},[d.value?(s(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:h[13]||(h[13]=Y(W=>d.value=!1,["self"]))},[e("div",bd,[e("div",xd,[H(Oe,{show:d.value,onConfirm:se,onCancel:h[12]||(h[12]=W=>d.value=!1)},null,8,["show"])])])])):c("",!0)]))])}}},wd={__name:"TaskDetailContent",props:{task:{type:Object,required:!0}},setup(t){return(g,a)=>t.task.type==="lead"?(s(),U(qn,{key:0,lead:t.task},null,8,["lead"])):t.task.type==="opportunity"?(s(),U(hd,{key:1,opportunity:t.task},null,8,["opportunity"])):c("",!0)}},kd={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},$d={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},Cd={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},Sd={key:0,class:"fa-solid fa-clock text-[10px]"},Dd={class:"text-[10px] font-bold uppercase tracking-wide"},Ad={key:1,class:"text-right"},Id={class:"text-sm font-bold text-gray-900"},Od={class:"mt-1.5"},Td={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},qd={class:"text-[10px] text-gray-500 mt-0.5"},jd=["onClick"],Md=["onClick"],Nd=["onClick"],Vd={class:"flex-1 flex flex-col overflow-hidden"},Fd={key:0,class:"flex-1 flex items-center justify-center"},Ud={__name:"TaskDetail",setup(t){const g=lt(),a=Ye(),p=He(),o=Ke(),y=C("all"),d=C(null),i=F(()=>{const D=p.leads.map(B=>({...B,type:"lead",compositeId:`lead-${B.id}`})),j=o.opportunities.map(B=>({...B,type:"opportunity",compositeId:`opportunity-${B.id}`}));return[...D,...j].sort((B,O)=>{const P=new Date(B.lastActivity||B.createdAt||0);return new Date(O.lastActivity||O.createdAt||0)-P})}),r=F(()=>y.value==="all"?i.value:i.value.filter(D=>D.type===y.value)),u=F(()=>{const D=parseInt(g.params.id),j=g.query.type;if(j)return i.value.find(P=>P.id===D&&P.type===j)||null;const O=(y.value!=="all"?i.value.filter(P=>P.type===y.value):i.value).find(P=>P.id===D);return O||i.value.find(P=>P.id===D)||null}),v=F(()=>u.value?u.value.type==="lead"?p.currentLeadActivities:o.currentOpportunityActivities:[]),f=F(()=>D=>D.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");ce(()=>{p.loadLeads(),o.loadOpportunities();const D=g.params.id;D&&w(D)}),Ae(()=>g.params.id,D=>{D&&w(D)}),Ae(u,D=>{D&&(D.type==="lead"?p.loadLeadById(D.id):o.loadOpportunityById(D.id))},{immediate:!0});const w=D=>{const j=parseInt(D),B=i.value.find(O=>O.id===j);B&&(B.type==="lead"?p.loadLeadById(j):o.loadOpportunityById(j))},A=D=>{const[j,B]=D.split("-");a.push({path:`/tasks/${B}`,query:{type:j}})},k=D=>new Intl.NumberFormat("en-US").format(D),I=D=>{d.value=d.value===D?null:D},E=D=>{d.value=null,console.log("Reassign task",D.id,D.type)},_=async D=>{d.value=null,D.type==="lead"?await p.modifyLead(D.id,{priority:"Hot"}):D.type==="opportunity"&&await o.modifyOpportunity(D.id,{priority:"Hot"})},T=async D=>{d.value=null,D.type==="lead"?await p.modifyLead(D.id,{priority:"Normal"}):D.type==="opportunity"&&await o.modifyOpportunity(D.id,{priority:"Normal"})},M=D=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[D]||"bg-gray-100 text-gray-700 border-gray-200";return(D,j)=>{var B;return s(),l("div",kd,[H(jt,{title:"Tasks",items:r.value,"selected-id":(B=u.value)==null?void 0:B.compositeId,"type-filter":y.value,"selected-class":O=>O.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":f.value,"open-menu-id":d.value,getName:O=>O.customer.name,getInitials:O=>O.customer.initials,getVehicleInfo:O=>O.type==="lead"?`${O.requestedCar.brand} ${O.requestedCar.model}`:`${O.vehicle.brand} ${O.vehicle.model}`,avatarClass:O=>O.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600",onSelect:A,onMenuClick:I,onMenuClose:j[0]||(j[0]=O=>d.value=null),"show-type-filter":!0,onFilterChange:j[1]||(j[1]=O=>y.value=O)},{badges:De(({item:O})=>[e("span",{class:V(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",O.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},m(O.type==="lead"?"Lead":"Opportunity"),3),O.type==="lead"?(s(),l(J,{key:0},[e("span",$d,m(O.status),1),O.priority==="Hot"?(s(),l("span",Cd,[...j[2]||(j[2]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),N(" Hot ",-1)])])):c("",!0)],64)):(s(),l("span",{key:1,class:V(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",M(O.stage)])},m(O.stage),3))]),meta:De(({item:O})=>[O.type==="lead"?(s(),l("div",{key:0,class:V(["flex items-center gap-1.5",O.priority==="Hot"?"text-red-500":"text-gray-400"])},[O.priority==="Hot"?(s(),l("i",Sd)):c("",!0),e("span",Dd," Due in "+m(O.nextActionDue),1)],2)):(s(),l("div",Ad,[e("div",Id,"€"+m(k(O.value)),1),e("div",Od,[e("div",Td,[e("div",{class:V(["h-full rounded-full",O.probability>=70?"bg-green-500":O.probability>=40?"bg-blue-500":"bg-orange-500"]),style:Qe({width:`${O.probability}%`})},null,6)]),e("div",qd,m(O.probability)+"% PROB",1)])]))]),menu:De(({item:O})=>[e("button",{onClick:Y(P=>E(O),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...j[3]||(j[3]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),N(" Reassign ",-1)])],8,jd),O.priority!=="Hot"?(s(),l("button",{key:0,onClick:Y(P=>_(O),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...j[4]||(j[4]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),N(" Mark as hot ",-1)])],8,Md)):(s(),l("button",{key:1,onClick:Y(P=>T(O),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...j[5]||(j[5]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),N(" Unmark as hot ",-1)])],8,Nd))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass"]),e("div",Vd,[u.value?(s(),U(wd,{key:1,task:u.value},null,8,["task"])):(s(),l("div",Fd,[...j[6]||(j[6]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),H(Kt,{title:"Activity summary",activities:v.value,collapsed:!1,"show-collapse":!1,show:!!u.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{Ud as default};
