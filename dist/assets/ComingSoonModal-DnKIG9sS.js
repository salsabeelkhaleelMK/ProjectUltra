import{R as $,_ as fe,a4 as he,h as we,C as xe,c as F,d as k,o as w,e,g as P,t as S,F as q,i as K,n as B,G as W,r as V,m as J,l as j,x as Y,D as I,s as x,y as g,k as M,w as se,p as b,K as T,Q as L,af as ke,ac as Te,u as Se,a3 as Ce,v as U,a6 as ae,ag as Ie,ah as Ae,ai as Pe,aj as Ve,j as ie,M as R}from"./index-H5Cqf6fX.js";import{u as Le}from"./opportunities-DEbYZ9Ha.js";import{z as X,F as Z,L as _,H as ee,j as te,K as re,C as le,W as ne}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-1_jAZFgo.js";import{u as De}from"./vehicles-By7ZQa14.js";function hl(t){if(!t)return"";const o=new Date(t),l=new Date;if(o<l)return"OVERDUE";if(o.toDateString()===l.toDateString()){const r=o-l,i=Math.floor(r/(1e3*60*60)),m=Math.floor(r%(1e3*60*60)/(1e3*60));return i>0?`${i}h ${m}m`:`${m}m`}return o.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function wl(t){return(typeof t=="string"?new Date(t):t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function xl(t){return(typeof t=="string"?new Date(t):t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function pe(t){return(t==null?void 0:t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function kl(t){if(!t)return"No deadline";const o=new Date(t);if(o<new Date)return"OVERDUE";const n=o.toLocaleDateString("en-US",{month:"short",day:"numeric"}),r=o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${n}, ${r}`}function Tl(t){if(!t)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const o=new Date(t),l=new Date,n=(o-l)/(1e3*60*60);if(n<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(n<2){const r=Math.floor((o-l)/6e4),i=Math.floor(r/60),m=r%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:i>0?`${i}h ${m}m`:`${m}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(n<24){const r=Math.floor(n),i=Math.floor((n-r)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${r}h ${i}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const r=Math.ceil(n/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${r} day${r!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function Sl(t){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[t]||"bg-gray-100 text-gray-700"}const E={[$.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[$.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[$.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[$.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[$.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[$.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},me={toClosed:(t,o,l)=>{const n={isDisqualified:!0,disqualifyReason:(l==null?void 0:l.reason)||null,disqualifyCategory:(l==null?void 0:l.category)||null,scheduledAppointment:null,nextActionDue:null};(l==null?void 0:l.reason)==="Duplicate"?(n.isDuplicate=!0,n.stage="Closed Failed"):(l==null?void 0:l.category)==="Not Interested"?n.stage="Not Interested":n.stage="Not Valid",n.status="Disqualified";const r=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(l==null?void 0:l.category)||"Unknown"}, Reason: ${(l==null?void 0:l.reason)||"Unknown"}`}];return t.scheduledAppointment&&r.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:n,activities:r}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Cl(t,o){return o.startsWith("Closed")?me.toClosed:t.startsWith("Closed")&&!o.startsWith("Closed")?me.reopen:null}const de={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const o=t.deliverySubstatus;return o==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:o==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},oe={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},Me={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},Oe={class:"flex flex-col"},$e={class:"space-y-3"},Fe={class:"flex items-start justify-between gap-2"},Ue={class:"text-sm font-medium text-greys-900 leading-5 text-right wrap-break-word min-w-0 flex-1"},Ee={class:"flex items-start justify-between gap-2"},Re={class:"text-sm font-medium text-greys-900 leading-5 text-right wrap-break-word min-w-0 flex-1"},Be={class:"flex items-start justify-between gap-2"},Ne={class:"text-sm font-medium text-greys-900 leading-5 text-right wrap-break-word min-w-0 flex-1"},qe={key:0,class:"flex items-start justify-between gap-2"},We={class:"text-sm font-medium text-greys-900 leading-5 text-right wrap-break-word min-w-0 flex-1"},je={key:0,class:"mt-4 pt-4 border-t border-black/5"},ze={class:"space-y-0.5"},Qe=["onClick"],He={class:"text-[10px] font-medium text-greys-900 truncate shrink-0 min-w-0"},Ye={class:"text-[10px] text-greys-600 truncate flex-1 min-w-0"},Ge={key:0,class:"text-[10px] font-bold text-greys-900 shrink-0"},Ke={class:"text-[10px] text-greys-400 shrink-0"},Je={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(t){const o=t;he();const l=we(),n=xe(),r=Le();F(()=>o.task.negotiations||o.task.activeNegotiations||0);const i=F(()=>{if(!o.task.customer)return[];const c=o.task.customer.email,f=o.task.customer.phone,s=o.task.compositeId;return[...(n.leads||[]).map(A=>({...A,type:"lead",compositeId:`lead-${A.id}`})),...(r.opportunities||[]).map(A=>({...A,type:"opportunity",compositeId:`opportunity-${A.id}`}))].filter(A=>A.compositeId===s||!A.customer?!1:A.customer.email===c||A.customer.phone===f).sort((A,O)=>new Date(O.createdAt||0)-new Date(A.createdAt||0)).slice(0,3)}),m=c=>{const[f,s]=c.compositeId.split("-");l.push({path:`/tasks/${s}`,query:{type:f}})},p=c=>c.stage||c.currentStage||"Unknown",d=c=>{const f=c.createdAt||c.nextActionDue||c.updatedAt;if(!f)return"";try{return new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},v=c=>{const f=c.requestedCar||c.vehicle;if(!f)return"No vehicle";const s=f.brand||"",y=f.model||"",A=f.year?`(${f.year})`:"";return`${s} ${y} ${A}`.trim()||"Vehicle info N/A"},a=c=>c?c>=1e3?"€"+(c/1e3).toFixed(0)+"k":"€"+c:"€0";return(c,f)=>{var s,y,A,O;return w(),k("div",Me,[f[5]||(f[5]=e("h3",{class:"text-base font-medium text-greys-900 mb-4 leading-6"},"Customer information",-1)),e("div",Oe,[e("div",$e,[e("div",Fe,[f[0]||(f[0]=e("p",{class:"text-sm text-greys-500 leading-5 shrink-0"},"Customer",-1)),e("p",Ue,S(((s=t.task.customer)==null?void 0:s.name)||"Unknown"),1)]),e("div",Ee,[f[1]||(f[1]=e("p",{class:"text-sm text-greys-500 leading-5 shrink-0"},"Email",-1)),e("p",Re,S(((y=t.task.customer)==null?void 0:y.email)||"N/A"),1)]),e("div",Be,[f[2]||(f[2]=e("p",{class:"text-sm text-greys-500 leading-5 shrink-0"},"Phone",-1)),e("p",Ne,S(((A=t.task.customer)==null?void 0:A.phone)||"N/A"),1)]),(O=t.task.customer)!=null&&O.address?(w(),k("div",qe,[f[3]||(f[3]=e("p",{class:"text-sm text-greys-500 leading-5 shrink-0"},"Address",-1)),e("p",We,S(t.task.customer.address),1)])):P("",!0)]),i.value.length>0?(w(),k("div",je,[f[4]||(f[4]=e("h4",{class:"text-[11px] font-bold uppercase tracking-wider text-greys-500 mb-2"},"Other customer requests",-1)),e("div",ze,[(w(!0),k(q,null,K(i.value,D=>(w(),k("div",{key:D.compositeId,onClick:ue=>m(D),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:B(["text-[9px] font-bold uppercase px-1 py-0.5 rounded leading-none shrink-0",D.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},S(D.type==="lead"?"Lead":"Opp"),3),e("span",He,S(p(D)),1),e("span",Ye,S(v(D)),1),D.type==="opportunity"&&D.estimatedValue?(w(),k("span",Ge,S(a(D.estimatedValue)),1)):P("",!0),e("span",Ke,S(d(D)),1)],8,Qe))),128))])])):P("",!0)])])}}},Il=fe(Je,[["__scopeId","data-v-92d84c80"]]);function Al(t){var i,m,p;const o=t.lead;if(!o)return null;const l=W(o,"lead");if(!l)return((i=E[$.NEW])==null?void 0:i.primaryAction)||null;const n=E[l];if(!n)return((m=E[$.NEW])==null?void 0:m.primaryAction)||null;if(!n.primaryAction)return((p=E[$.NEW])==null?void 0:p.primaryAction)||null;const r=n.primaryAction;return typeof r=="function"?r({lead:o,displayStage:l}):r}function Pl(t){const o=t.lead;if(!o)return[];const l=W(o,"lead"),n=E[l];return n?n.secondaryActions||[]:[]}function ye(t){const o=t.lead;if(!o||!(o.isDisqualified===!0))return!1;const n=W(o,"lead");return n===$.CLOSED_INVALID||n===$.CLOSED_NOT_INTERESTED||n===$.CLOSED_DUPLICATE}function Vl(t){const o=t.lead;if(!o||ye(t))return!1;const l=W(o,"lead"),n=E[l];return n?typeof n.showLQWidget=="function"?n.showLQWidget(o):n.showLQWidget??!1:!1}function Ll(t){const o=t.lead;if(!o||ye(t))return!1;const l=W(o,"lead"),n=E[l];return n?n.showDeadlineBanner&&o.nextActionDue:!1}function Dl(t){const o=t.lead;if(!o)return!1;const l=W(o,"lead"),n=E[l];return n?n.canPostpone??!1:!1}function Ml(t){const o=t.lead;if(!o)return"qualification";const l=W(o,"lead"),n=E[l];return n&&n.lqWidgetMode||"qualification"}const Xe={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Ze={key:1,class:"flex justify-between items-center mb-4"},_e={class:"text-fluid-sm font-semibold text-heading"},et={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Ol={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(t,{expose:o,emit:l}){const n=t,r=l,i=V(""),m=V(!1);J(()=>{n.item&&(i.value=n.item.content||n.item.message||"")}),j(()=>n.item,a=>{a&&(i.value=a.content||a.message||"")},{deep:!0}),j(()=>n.show,a=>{n.modal&&!a&&setTimeout(()=>{i.value=n.item&&(n.item.content||n.item.message)||"",m.value=!1},300)});const p=async()=>{var a,c;if(i.value.trim()){m.value=!0;try{const f={id:((a=n.item)==null?void 0:a.id)||Date.now(),type:"note",action:n.item?"updated a note":"added a note",content:i.value,message:i.value,timestamp:((c=n.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!n.item};r("save",f),n.modal&&r("close")}finally{m.value=!1}}},d=()=>{r("cancel"),n.modal&&r("close")},v=a=>{a||r("close")};return o({submit:p,canSubmit:()=>!!i.value.trim()}),(a,c)=>t.modal?(w(),Y(g(ne),{key:0,open:t.show,"onUpdate:open":v},{default:I(()=>[x(g(X),null,{default:I(()=>[x(g(Z),{class:"fixed inset-0 z-50 bg-black/50"}),x(g(_),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:I(()=>[x(g(ee),null,{default:I(()=>[x(g(te),null,{default:I(()=>[M(S(t.item?"Edit Note":"Add Note"),1)]),_:1}),t.item?P("",!0):(w(),Y(g(re),{key:0},{default:I(()=>[...c[2]||(c[2]=[M(" Add a note to document important information ",-1)])]),_:1}))]),_:1}),e("form",{onSubmit:se(p,["prevent"]),class:"space-y-4"},[e("div",null,[c[3]||(c[3]=e("label",{class:"block label-upper mb-2"},[M(" Note "),e("span",{class:"text-brand-red"},"*")],-1)),b(e("textarea",{"onUpdate:modelValue":c[0]||(c[0]=f=>i.value=f),class:"input",rows:"6",placeholder:"Type your note here...",required:""},null,512),[[T,i.value]])])],32),x(g(le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:I(()=>[x(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),x(g(L),{label:m.value?"Saving...":t.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!i.value.trim()||m.value,onClick:p},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(w(),k("div",{key:1,class:B(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?P("",!0):(w(),k("div",Xe)),t.hideHeader?P("",!0):(w(),k("div",Ze,[e("h5",_e,S(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:d,class:"text-sub hover:text-body"},[...c[4]||(c[4]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[c[5]||(c[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),b(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=f=>i.value=f),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[T,i.value]])]),t.hideActions?P("",!0):(w(),k("div",et,[x(g(L),{label:"Cancel",variant:"outline",size:"small",onClick:d}),x(g(L),{label:"Save",variant:"primary",size:"small",onClick:p})]))],2))}};class tt extends ke{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(o={}){await new Promise(n=>setTimeout(n,300));let l=[...this.dataSource];return o.leadId!==void 0&&(l=l.filter(n=>n.leadId===parseInt(o.leadId))),o.opportunityId!==void 0&&(l=l.filter(n=>n.opportunityId===parseInt(o.opportunityId))),o.type&&(l=l.filter(n=>n.type===o.type)),o.offerId!==void 0&&(l=l.filter(n=>n.offerId===parseInt(o.offerId))),o.vehicleId!==void 0&&(l=l.filter(n=>n.vehicleId===parseInt(o.vehicleId))),l}async findAllByLeadId(o){return this.findAll({leadId:o})}async findAllByOpportunityId(o){return this.findAll({opportunityId:o})}async findById(o){return await new Promise(n=>setTimeout(n,300)),this.dataSource.find(n=>n.id===parseInt(o))||null}async create(o){await new Promise(r=>setTimeout(r,300));const n={id:this.dataSource.length>0?Math.max(...this.dataSource.map(r=>r.id))+1:1,type:o.type,leadId:o.leadId!==void 0?parseInt(o.leadId):void 0,opportunityId:o.opportunityId!==void 0?parseInt(o.opportunityId):void 0,offerId:o.offerId!==void 0?parseInt(o.offerId):void 0,vehicleId:o.vehicleId!==void 0?parseInt(o.vehicleId):void 0,fields:o.fields||{},currency:o.currency||"EUR",offerValidFrom:o.offerValidFrom||null,offerValidTo:o.offerValidTo||null,status:o.status||"active",createdAt:o.createdAt||new Date().toISOString(),createdBy:o.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(n),n}async update(o,l){await new Promise(r=>setTimeout(r,300));const n=this.dataSource.find(r=>r.id===parseInt(o));if(!n)throw new Error("Purchase method not found");return Object.assign(n,l,{updatedAt:new Date().toISOString()}),n}async delete(o){await new Promise(n=>setTimeout(n,300));const l=this.dataSource.findIndex(n=>n.id===parseInt(o));if(l===-1)throw new Error("Purchase method not found");return this.dataSource.splice(l,1),{success:!0}}}class lt{constructor(){this.repository=new tt}calculateTotal(o){const{type:l,fields:n}=o;if(!n)return 0;const r=parseFloat(n.monthlyInstalment)||0,i=parseFloat(n.downPayment)||0,m=parseInt(n.duration)||0;switch(l){case"FIN":return r*m+i;case"LEA":const p=parseFloat(n.finalInstalment)||0;return r*m+i+p;case"LTR":return r*m+i;default:return 0}}validate(o){const l=[],{type:n,fields:r}=o;if((!n||!["FIN","LEA","LTR"].includes(n))&&l.push("Purchase method type is required and must be FIN, LEA, or LTR"),!r)return l.push("Purchase method fields are required"),{isValid:!1,errors:l};const i=parseFloat(r.monthlyInstalment);(!i||i<=0)&&l.push("Monthly Instalment must be greater than 0");const m=parseFloat(r.downPayment);(m==null||m<0)&&l.push("Down Payment must be greater than or equal to 0");const p=parseInt(r.duration);if((!p||p<12||p>60)&&l.push("Duration must be between 12 and 60 months"),n==="FIN"){const d=parseFloat(r.interestRate);d!=null&&(d<0||d>99.99)&&l.push("Interest Rate must be between 0 and 99.99%");const v=parseFloat(r.effectiveInterestRate);v!=null&&(v<0||v>99.99)&&l.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(n==="LEA"){const d=parseFloat(r.mileageLimit);d!=null&&d<=0&&l.push("Mileage Limit must be greater than 0 if provided");const v=parseFloat(r.finalInstalment);v!=null&&v<0&&l.push("Final Instalment must be greater than or equal to 0");const a=parseFloat(r.interestRate);a!=null&&(a<0||a>99.99)&&l.push("Interest Rate must be between 0 and 99.99%")}if(n==="LTR"){const d=parseFloat(r.mileageLimit);d!=null&&d<=0&&l.push("Mileage Limit must be greater than 0 if provided"),(!r.customerType||!["Private","Business","Fleet"].includes(r.customerType))&&l.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:l.length===0,errors:l}}async findAll(o={}){return await this.repository.findAll(o)}async findById(o){return await this.repository.findById(o)}async create(o){const l=this.validate(o);if(!l.isValid)throw new Error(`Validation failed: ${l.errors.join(", ")}`);const n=await this.repository.create(o),r=this.calculateTotal(n);return n.fields={...n.fields,totalAmount:r},await this.repository.update(n.id,{fields:n.fields})}async update(o,l){const n=await this.repository.findById(o);if(!n)throw new Error("Purchase method not found");const r={...n,...l,fields:{...n.fields,...l.fields}},i=this.validate(r);if(!i.isValid)throw new Error(`Validation failed: ${i.errors.join(", ")}`);const m=this.calculateTotal(r);return r.fields.totalAmount=m,await this.repository.update(o,{...l,fields:r.fields})}async delete(o){return await this.repository.delete(o)}}const Q=new lt,G=(t=300)=>new Promise(o=>setTimeout(o,t)),nt=async(t={})=>(await G(),await Q.findAll(t)),at=async t=>(await G(),await Q.findById(t)),ot=async t=>(await G(),await Q.create(t)),st=async(t,o)=>(await G(),await Q.update(t,o)),it=async t=>(await G(),await Q.delete(t)),rt=Te("purchaseMethods",()=>{const t=V([]),o=V(null),l=V(!1),n=V(null),r=F(()=>f=>t.value.filter(s=>s.type===f)),i=F(()=>f=>t.value.filter(s=>s.leadId===parseInt(f))),m=F(()=>f=>t.value.filter(s=>s.opportunityId===parseInt(f)));return{purchaseMethods:t,currentPurchaseMethod:o,loading:l,error:n,purchaseMethodsByType:r,purchaseMethodsByLead:i,purchaseMethodsByOpportunity:m,fetchPurchaseMethods:async(f={})=>{l.value=!0,n.value=null;try{const s=await nt(f);return t.value=s,s}catch(s){throw n.value=s.message,s}finally{l.value=!1}},fetchPurchaseMethodById:async f=>{l.value=!0,n.value=null;try{return o.value=await at(f),o.value}catch(s){throw n.value=s.message,s}finally{l.value=!1}},createPurchaseMethod:async f=>{l.value=!0,n.value=null;try{const s=await ot(f);return t.value.push(s),s}catch(s){throw n.value=s.message,s}finally{l.value=!1}},updatePurchaseMethod:async(f,s)=>{var y;l.value=!0,n.value=null;try{const A=await st(f,s),O=t.value.findIndex(D=>D.id===f);return O!==-1&&(t.value[O]=A),((y=o.value)==null?void 0:y.id)===f&&(o.value=A),A}catch(A){throw n.value=A.message,A}finally{l.value=!1}},deletePurchaseMethod:async f=>{var s;l.value=!0,n.value=null;try{await it(f),t.value=t.value.filter(y=>y.id!==f),((s=o.value)==null?void 0:s.id)===f&&(o.value=null)}catch(y){throw n.value=y.message,y}finally{l.value=!1}}}}),dt={class:"flex gap-2"},ut=["value"],ct={key:0,class:"space-y-4"},pt={class:"text-h3-card text-heading mb-4"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ft={class:"relative"},yt={key:0,class:"text-xs text-red-600 mt-1"},vt={class:"relative"},bt={key:0,class:"text-xs text-red-600 mt-1"},gt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ht=["value"],wt={key:0,class:"text-xs text-red-600 mt-1"},xt={key:0,class:"text-xs text-red-600 mt-1"},kt={key:0,class:"text-xs text-red-600 mt-1"},Tt={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},St={class:"flex justify-between items-center"},Ct={class:"text-lg font-bold text-heading"},It={class:"flex flex-col gap-2"},At={class:"flex items-center gap-2"},Pt={class:"flex items-center gap-2"},Vt={class:"flex items-center gap-2"},Lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},Dt={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},Mt={class:"list-disc list-inside text-sm text-red-700 space-y-1"},Ot={key:0},$t={key:1},Ft={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:t=>["lead","opportunity"].includes(t)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,n=o,r=rt(),i=Se(),m=V(!1),p=V({}),d=V([]),v=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],a=V({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),c=F(()=>!!l.purchaseMethod);F(()=>{if(a.value.type!=="LEA")return 0;const C=parseFloat(a.value.fields.monthlyInstalment)||0,u=parseInt(a.value.fields.duration)||0,h=parseFloat(a.value.fields.downPayment)||0,H=parseFloat(a.value.fields.finalInstalment)||0;return C*u+h+H});const f=F(()=>{if(a.value.type!=="LTR")return 0;const C=parseFloat(a.value.fields.monthlyInstalment)||0,u=parseInt(a.value.fields.duration)||0,h=parseFloat(a.value.fields.downPayment)||0;return C*u+h}),s=C=>C==="FIN"?[12,24,36,48,60]:C==="LEA"?[24,36,48,60]:C==="LTR"?[12,24,36,48,60]:[],y=C=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[C]||C,A=C=>{const u=a.value.fields[C];switch(C){case"monthlyInstalment":!u||u<=0?p.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete p.value.monthlyInstalment;break;case"downPayment":u==null||u<0?p.value.downPayment="Down Payment must be greater than or equal to 0":delete p.value.downPayment;break;case"duration":a.value.type==="LTR"&&(!u||u<12||u>60)?p.value.duration="Duration must be between 12 and 60 months":delete p.value.duration;break;case"customerType":a.value.type==="LTR"&&(!u||!["Private","Business","Fleet"].includes(u))?p.value.customerType="Customer Type is required":delete p.value.customerType;break}},O=C=>{delete p.value[C]},D=()=>{d.value=[],p.value={};const C=Q.validate({type:a.value.type,fields:a.value.fields});return C.isValid||(d.value=C.errors,C.errors.forEach(u=>{u.includes("Monthly Instalment")?p.value.monthlyInstalment=u:u.includes("Down Payment")?p.value.downPayment=u:u.includes("Duration")?p.value.duration=u:u.includes("Customer Type")&&(p.value.customerType=u)})),C.isValid},ue=F(()=>!a.value.type||!a.value.fields.monthlyInstalment||a.value.fields.monthlyInstalment<=0||a.value.fields.downPayment===null||a.value.fields.downPayment===void 0||a.value.fields.downPayment<0||a.value.type==="LTR"&&(!a.value.fields.duration||a.value.fields.duration<12||a.value.fields.duration>60)||a.value.type==="LTR"&&!a.value.fields.customerType?!1:Object.keys(p.value).length===0),ve=()=>{a.value.type!=="FIN"&&(a.value.fields.effectiveInterestRate=null,a.value.fields.gfv=null),a.value.type!=="LEA"&&(a.value.fields.finalInstalment=null),a.value.type!=="LTR"&&(a.value.fields.customerType="",a.value.fields.registrationTaxesIncluded=!1),a.value.type!=="LEA"&&a.value.type!=="LTR"&&(a.value.fields.mileageLimit=null,a.value.fields.maintenanceIncluded=!1),p.value={},d.value=[]},ce=async()=>{var C;if(D()){m.value=!0;try{const u={type:a.value.type,fields:{...a.value.fields},currency:a.value.currency,offerValidFrom:a.value.offerValidFrom||null,offerValidTo:a.value.offerValidTo||null,createdBy:((C=i.currentUser)==null?void 0:C.id)||null};l.taskType==="lead"?u.leadId=parseInt(l.taskId):l.taskType==="opportunity"&&(u.opportunityId=parseInt(l.taskId)),l.vehicleId&&(u.vehicleId=parseInt(l.vehicleId)),l.offerId&&(u.offerId=parseInt(l.offerId));let h;c.value?h=await r.updatePurchaseMethod(l.purchaseMethod.id,u):h=await r.createPurchaseMethod(u);const H=y(h.type),ge=pe(h.fields.monthlyInstalment||0);n("save",{...h,successMessage:`Purchase Method Added: ${H} - €${ge}/month`}),n("close")}catch(u){d.value=[u.message||"Failed to save purchase method"]}finally{m.value=!1}}},be=C=>{C||n("close")};return J(()=>{l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null})}),j(()=>l.show,C=>{C?l.purchaseMethod&&(a.value={type:l.purchaseMethod.type||"",fields:{...a.value.fields,...l.purchaseMethod.fields},currency:l.purchaseMethod.currency||"EUR",offerValidFrom:l.purchaseMethod.offerValidFrom||null,offerValidTo:l.purchaseMethod.offerValidTo||null}):setTimeout(()=>{a.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},p.value={},d.value=[],m.value=!1},300)}),(C,u)=>(w(),Y(g(ne),{open:t.show,"onUpdate:open":be},{default:I(()=>[x(g(X),null,{default:I(()=>[x(g(Z),{class:"fixed inset-0 z-50 bg-black/50"}),x(g(_),{class:"w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto"},{default:I(()=>[x(g(ee),null,{default:I(()=>[x(g(te),null,{default:I(()=>[M(S(c.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1}),x(g(re),null,{default:I(()=>[M(S(c.value?"Update purchase method details":"Select purchase method type and fill in the details"),1)]),_:1})]),_:1}),e("form",{onSubmit:se(ce,["prevent"]),class:"space-y-6"},[e("div",null,[u[19]||(u[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",dt,[(w(),k(q,null,K(v,h=>e("label",{key:h.value,class:"flex-1 cursor-pointer"},[b(e("input",{type:"radio",value:h.value,"onUpdate:modelValue":u[0]||(u[0]=H=>a.value.type=H),class:"sr-only",onChange:ve},null,40,ut),[[Ce,a.value.type]]),e("div",{class:B(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",a.value.type===h.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},S(h.label),3)])),64))])]),a.value.type?(w(),k("div",ct,[e("h3",pt,S(y(a.value.type))+" Details ",1),e("div",mt,[e("div",null,[u[21]||(u[21]=e("label",{class:"block label-upper mb-2"},[M(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",ft,[u[20]||(u[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),b(e("input",{"onUpdate:modelValue":u[1]||(u[1]=h=>a.value.fields.monthlyInstalment=h),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:B(["input pl-8",{"border-red-500":p.value.monthlyInstalment}]),onInput:u[2]||(u[2]=h=>O("monthlyInstalment")),onBlur:u[3]||(u[3]=h=>A("monthlyInstalment"))},null,34),[[T,a.value.fields.monthlyInstalment,void 0,{number:!0}]])]),p.value.monthlyInstalment?(w(),k("p",yt,S(p.value.monthlyInstalment),1)):P("",!0),u[22]||(u[22]=e("p",{class:"text-xs text-sub mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[u[24]||(u[24]=e("label",{class:"block label-upper mb-2"},[M(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",vt,[u[23]||(u[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),b(e("input",{"onUpdate:modelValue":u[4]||(u[4]=h=>a.value.fields.downPayment=h),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:B(["input pl-8",{"border-red-500":p.value.downPayment}]),onInput:u[5]||(u[5]=h=>O("downPayment")),onBlur:u[6]||(u[6]=h=>A("downPayment"))},null,34),[[T,a.value.fields.downPayment,void 0,{number:!0}]])]),p.value.downPayment?(w(),k("p",bt,S(p.value.downPayment),1)):P("",!0),u[25]||(u[25]=e("p",{class:"text-xs text-sub mt-1"},"Amount at contract signing",-1))])]),a.value.type==="LTR"?(w(),k("div",gt,[e("div",null,[u[27]||(u[27]=e("label",{class:"block label-upper mb-2"},[M(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),b(e("select",{"onUpdate:modelValue":u[7]||(u[7]=h=>a.value.fields.duration=h),class:B(["input",{"border-red-500":p.value.duration}]),onChange:u[8]||(u[8]=h=>O("duration"))},[u[26]||(u[26]=e("option",{value:""},"Select duration...",-1)),(w(!0),k(q,null,K(s(a.value.type),h=>(w(),k("option",{key:h,value:h},S(h)+" months ",9,ht))),128))],34),[[U,a.value.fields.duration,void 0,{number:!0}]]),p.value.duration?(w(),k("p",wt,S(p.value.duration),1)):P("",!0)]),e("div",null,[u[28]||(u[28]=e("label",{class:"block label-upper mb-2"},"Unlock Kilometers",-1)),b(e("input",{"onUpdate:modelValue":u[9]||(u[9]=h=>a.value.fields.mileageLimit=h),type:"number",min:"0",placeholder:"0",class:B(["input",{"border-red-500":p.value.mileageLimit}]),onInput:u[10]||(u[10]=h=>O("mileageLimit"))},null,34),[[T,a.value.fields.mileageLimit,void 0,{number:!0}]]),p.value.mileageLimit?(w(),k("p",xt,S(p.value.mileageLimit),1)):P("",!0)])])):P("",!0),a.value.type==="LTR"?(w(),k(q,{key:1},[e("div",null,[u[30]||(u[30]=e("label",{class:"block label-upper mb-2"},[M(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),b(e("select",{"onUpdate:modelValue":u[11]||(u[11]=h=>a.value.fields.customerType=h),class:B(["input",{"border-red-500":p.value.customerType}]),onChange:u[12]||(u[12]=h=>O("customerType"))},[...u[29]||(u[29]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[U,a.value.fields.customerType]]),p.value.customerType?(w(),k("p",kt,S(p.value.customerType),1)):P("",!0)]),e("div",Tt,[e("div",St,[u[31]||(u[31]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",Ct,"€ "+S(g(pe)(f.value)),1)]),u[32]||(u[32]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",It,[e("div",At,[b(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":u[13]||(u[13]=h=>a.value.fields.insuranceIncluded=h),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ae,a.value.fields.insuranceIncluded]]),u[33]||(u[33]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Pt,[b(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":u[14]||(u[14]=h=>a.value.fields.maintenanceIncluded=h),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ae,a.value.fields.maintenanceIncluded]]),u[34]||(u[34]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Vt,[b(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":u[15]||(u[15]=h=>a.value.fields.registrationTaxesIncluded=h),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ae,a.value.fields.registrationTaxesIncluded]]),u[35]||(u[35]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):P("",!0),e("div",Lt,[e("div",null,[u[36]||(u[36]=e("label",{class:"block label-upper mb-2"},"Offer Valid From",-1)),b(e("input",{"onUpdate:modelValue":u[16]||(u[16]=h=>a.value.offerValidFrom=h),type:"date",class:"input"},null,512),[[T,a.value.offerValidFrom]])]),e("div",null,[u[37]||(u[37]=e("label",{class:"block label-upper mb-2"},"Offer Valid To",-1)),b(e("input",{"onUpdate:modelValue":u[17]||(u[17]=h=>a.value.offerValidTo=h),type:"date",class:"input"},null,512),[[T,a.value.offerValidTo]])])])])):P("",!0),d.value.length>0?(w(),k("div",Dt,[u[38]||(u[38]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Mt,[(w(!0),k(q,null,K(d.value,h=>(w(),k("li",{key:h},S(h),1))),128))])])):P("",!0)],32),x(g(le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:I(()=>[x(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[18]||(u[18]=h=>C.$emit("close"))}),x(g(L),{label:c.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!ue.value||m.value,onClick:ce},{default:I(()=>[m.value?(w(),k("span",Ot,"Saving...")):(w(),k("span",$t,S(c.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$l=fe(Ft,[["__scopeId","data-v-85cb445e"]]),Ut={key:0,class:"space-y-4 py-4"},Et={class:"grid grid-cols-1 gap-3"},Rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Nt=["max"],qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Wt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},jt=["max"],zt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ht={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:t=>["vehicle","tradein"].includes(t)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:o}){const l=t,n=o,r=V(l.mode==="tradein"?"tradein":null);j(()=>l.mode,f=>{f==="tradein"?r.value="tradein":l.item||(r.value=null)});const i=F(()=>l.mode==="tradein"||r.value==="tradein"),m=()=>l.mode==="tradein"||r.value==="tradein"?"Add Trade-In Vehicle":r.value==="drove"?"Add Drove Vehicle":r.value==="requested"?"Add Requested Vehicle":"Add Vehicle",p=()=>l.mode==="tradein"||r.value==="tradein"?"Record details of the customer's trade-in vehicle":r.value==="drove"?"Record details of a vehicle the customer drove":r.value==="requested"?"Record details of a vehicle the customer requested":"Fill in the details for the new vehicle",d=V({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});J(()=>{l.item&&l.item.data&&(d.value={brand:l.item.data.brand||"",model:l.item.data.model||"",year:l.item.data.year||"",version:l.item.data.version||"",vin:l.item.data.vin||"",plates:l.item.data.plate||l.item.data.plates||"",fuelType:l.item.data.fuelType||"",gearType:l.item.data.gearType||"",kilometers:l.item.data.km||l.item.data.kilometers||"",registration:l.item.data.date||l.item.data.registration||"",owner:l.item.data.owner||"",ownershipType:l.item.data.ownershipType||"",ownedSince:l.item.data.ownedSince||"",warrantyInfo:l.item.data.warrantyInfo||"",note:l.item.data.note||"",stockDays:null})}),j(()=>l.show,f=>{f||(r.value=null,d.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const v=F(()=>!!d.value.brand&&!!d.value.model&&!!d.value.year),a=f=>{f||n("close")},c=()=>{if(!v.value)return;const f={vehicle:{brand:d.value.brand,model:d.value.model,year:parseInt(d.value.year)||null,version:d.value.version||null,vin:d.value.vin||null,plates:d.value.plates||null,fuelType:d.value.fuelType||null,gearType:d.value.gearType||null,kilometers:parseInt(d.value.kilometers)||0,registration:d.value.registration||null,owner:d.value.owner||null,ownershipType:d.value.ownershipType||null,ownedSince:d.value.ownedSince||null,warrantyInfo:d.value.warrantyInfo||null,note:d.value.note||null,stockDays:null,status:"Available"}};r.value&&(f.vehicleType=r.value),l.item&&(f.id=l.item.id,f.isEdit=!0,f.timestamp=l.item.timestamp||new Date().toISOString()),n("save",f)};return(f,s)=>(w(),Y(g(ne),{open:t.show,"onUpdate:open":a},{default:I(()=>[x(g(X),null,{default:I(()=>[x(g(Z),{class:"fixed inset-0 z-50 bg-black/50"}),x(g(_),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:I(()=>[x(g(ee),null,{default:I(()=>[x(g(te),null,{default:I(()=>[M(S(m()),1)]),_:1}),x(g(re),null,{default:I(()=>[M(S(p()),1)]),_:1})]),_:1}),t.mode==="vehicle"&&!t.item&&!r.value?(w(),k("div",Ut,[s[26]||(s[26]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Et,[x(g(L),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:s[0]||(s[0]=y=>r.value="drove")}),x(g(L),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:s[1]||(s[1]=y=>r.value="requested")}),x(g(L),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:s[2]||(s[2]=y=>r.value="tradein")})])])):(w(),k("form",{key:1,onSubmit:se(c,["prevent"]),class:"space-y-4"},[i.value?(w(),k(q,{key:0},[e("div",Rt,[e("div",null,[s[27]||(s[27]=e("label",{class:"block label-upper mb-2"},"Brand *",-1)),b(e("input",{"onUpdate:modelValue":s[3]||(s[3]=y=>d.value.brand=y),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[T,d.value.brand]])]),e("div",null,[s[28]||(s[28]=e("label",{class:"block label-upper mb-2"},"Model *",-1)),b(e("input",{"onUpdate:modelValue":s[4]||(s[4]=y=>d.value.model=y),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[T,d.value.model]])])]),e("div",Bt,[e("div",null,[s[29]||(s[29]=e("label",{class:"block label-upper mb-2"},"Year (or registration year) *",-1)),b(e("input",{"onUpdate:modelValue":s[5]||(s[5]=y=>d.value.year=y),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,Nt),[[T,d.value.year]])]),e("div",null,[s[30]||(s[30]=e("label",{class:"block label-upper mb-2"},"Kilometers",-1)),b(e("input",{"onUpdate:modelValue":s[6]||(s[6]=y=>d.value.kilometers=y),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[T,d.value.kilometers,void 0,{number:!0}]])])]),e("div",qt,[e("div",null,[s[32]||(s[32]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),b(e("select",{"onUpdate:modelValue":s[7]||(s[7]=y=>d.value.fuelType=y),class:"input"},[...s[31]||(s[31]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[U,d.value.fuelType]])]),e("div",null,[s[34]||(s[34]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),b(e("select",{"onUpdate:modelValue":s[8]||(s[8]=y=>d.value.gearType=y),class:"input"},[...s[33]||(s[33]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[U,d.value.gearType]])])]),e("div",null,[s[35]||(s[35]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),b(e("input",{"onUpdate:modelValue":s[9]||(s[9]=y=>d.value.plates=y),type:"text",placeholder:"License plate number",class:"input"},null,512),[[T,d.value.plates]]),s[36]||(s[36]=e("p",{class:"text-xs text-sub mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",null,[s[37]||(s[37]=e("label",{class:"block label-upper mb-2"},"Note",-1)),b(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=y=>d.value.note=y),rows:"4",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"input resize-none"},null,512),[[T,d.value.note]])])],64)):(w(),k(q,{key:1},[e("div",Wt,[e("div",null,[s[38]||(s[38]=e("label",{class:"block label-upper mb-2"},"Brand",-1)),b(e("input",{"onUpdate:modelValue":s[11]||(s[11]=y=>d.value.brand=y),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[T,d.value.brand]])]),e("div",null,[s[39]||(s[39]=e("label",{class:"block label-upper mb-2"},"Model",-1)),b(e("input",{"onUpdate:modelValue":s[12]||(s[12]=y=>d.value.model=y),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[T,d.value.model]])]),e("div",null,[s[40]||(s[40]=e("label",{class:"block label-upper mb-2"},"Year",-1)),b(e("input",{"onUpdate:modelValue":s[13]||(s[13]=y=>d.value.year=y),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,jt),[[T,d.value.year]])])]),e("div",null,[s[41]||(s[41]=e("label",{class:"block label-upper mb-2"},"Version/Trim",-1)),b(e("input",{"onUpdate:modelValue":s[14]||(s[14]=y=>d.value.version=y),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[T,d.value.version]])]),e("div",zt,[e("div",null,[s[42]||(s[42]=e("label",{class:"block label-upper mb-2"},"VIN",-1)),b(e("input",{"onUpdate:modelValue":s[15]||(s[15]=y=>d.value.vin=y),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[T,d.value.vin]])]),e("div",null,[s[43]||(s[43]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),b(e("input",{"onUpdate:modelValue":s[16]||(s[16]=y=>d.value.plates=y),type:"text",placeholder:"License plate number",class:"input"},null,512),[[T,d.value.plates]])])]),e("div",Qt,[e("div",null,[s[45]||(s[45]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),b(e("select",{"onUpdate:modelValue":s[17]||(s[17]=y=>d.value.fuelType=y),class:"input"},[...s[44]||(s[44]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[U,d.value.fuelType]])]),e("div",null,[s[47]||(s[47]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),b(e("select",{"onUpdate:modelValue":s[18]||(s[18]=y=>d.value.gearType=y),class:"input"},[...s[46]||(s[46]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[U,d.value.gearType]])]),e("div",null,[s[48]||(s[48]=e("label",{class:"block label-upper mb-2"},"Mileage (km)",-1)),b(e("input",{"onUpdate:modelValue":s[19]||(s[19]=y=>d.value.kilometers=y),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[T,d.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[s[49]||(s[49]=e("label",{class:"block label-upper mb-2"},"Registration Year/Month",-1)),b(e("input",{"onUpdate:modelValue":s[20]||(s[20]=y=>d.value.registration=y),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[T,d.value.registration]])]),e("div",Ht,[e("div",null,[s[50]||(s[50]=e("label",{class:"block label-upper mb-2"},"Owned Since",-1)),b(e("input",{"onUpdate:modelValue":s[21]||(s[21]=y=>d.value.ownedSince=y),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[T,d.value.ownedSince]])]),e("div",null,[s[51]||(s[51]=e("label",{class:"block label-upper mb-2"},"Owner",-1)),b(e("input",{"onUpdate:modelValue":s[22]||(s[22]=y=>d.value.owner=y),type:"text",placeholder:"Owner name",class:"input"},null,512),[[T,d.value.owner]])])]),e("div",Yt,[e("div",null,[s[53]||(s[53]=e("label",{class:"block label-upper mb-2"},"Ownership Type",-1)),b(e("select",{"onUpdate:modelValue":s[23]||(s[23]=y=>d.value.ownershipType=y),class:"input"},[...s[52]||(s[52]=[e("option",{value:""},"Select ownership type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Company"},"Company",-1),e("option",{value:"Lease"},"Lease",-1),e("option",{value:"Fleet"},"Fleet",-1)])],512),[[U,d.value.ownershipType]])])]),e("div",null,[s[54]||(s[54]=e("label",{class:"block label-upper mb-2"},"Warranty Info",-1)),b(e("textarea",{"onUpdate:modelValue":s[24]||(s[24]=y=>d.value.warrantyInfo=y),rows:"3",placeholder:"Warranty information...",class:"input"},null,512),[[T,d.value.warrantyInfo]])])],64))],32)),x(g(le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:I(()=>[x(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[25]||(s[25]=y=>f.$emit("close"))}),x(g(L),{label:i.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!v.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Ul(){const t=De();return{saveTradeInVehicle:async(n,r,i,m={})=>{try{const p=await t.addVehicle(i),d={type:"tradein",action:"added a trade-in",vehicleId:p.id,data:{brand:i.brand,model:i.model,version:i.version||null,year:i.year,kilometers:i.kilometers||0,plates:i.plates||null,registration:i.registration||null,vin:i.vin||null,fuelType:i.fuelType||null,gearType:i.gearType||null,tradeInPrice:m.tradeInPrice||null,evaluationRangeLow:m.evaluationRangeLow||null,evaluationRangeHigh:m.evaluationRangeHigh||null,provider:m.provider||null,evaluationDate:m.evaluationDate||null,priceToBuy:m.priceToBuy||null,priceToSell:m.priceToSell||null,priceOfVehicle:m.priceOfVehicle||null,priceOfOptionals:m.priceOfOptionals||null,listOfOptionals:m.listOfOptionals||null}};let v;if(n==="lead")v=await Pe(r,d);else if(n==="opportunity")v=await Ve(r,d);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:p,activity:v}}catch(p){throw console.error("Error saving trade-in vehicle:",p),p}},updateTradeInVehicle:async(n,r,i,m,p,d={})=>{try{const v=await t.modifyVehicle(i,p),a={data:{brand:p.brand,model:p.model,version:p.version||null,year:p.year,kilometers:p.kilometers||0,plates:p.plates||null,registration:p.registration||null,vin:p.vin||null,fuelType:p.fuelType||null,gearType:p.gearType||null,tradeInPrice:d.tradeInPrice||null,evaluationRangeLow:d.evaluationRangeLow||null,evaluationRangeHigh:d.evaluationRangeHigh||null,provider:d.provider||null,evaluationDate:d.evaluationDate||null,priceToBuy:d.priceToBuy||null,priceToSell:d.priceToSell||null,priceOfVehicle:d.priceOfVehicle||null,priceOfOptionals:d.priceOfOptionals||null,listOfOptionals:d.listOfOptionals||null}};let c;if(n==="lead")c=await Ie(r,m,a);else if(n==="opportunity")c=await Ae(r,m,a);else throw new Error(`Invalid taskType: ${n}`);return{vehicle:v,activity:c}}catch(v){throw console.error("Error updating trade-in vehicle:",v),v}}}}const Gt={class:"space-y-3"},Kt={class:"flex justify-end gap-2"},El={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,n=o,r=V(l.initialTemplate),i=V(""),m=V(l.initialMessage),p={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},d=()=>{r.value&&p[r.value]&&(i.value=p[r.value].subject,m.value=p[r.value].message)},v=()=>{m.value.trim()&&n("send",{type:"email",template:r.value,subject:i.value,message:m.value})};return(a,c)=>(w(),k("div",Gt,[e("div",null,[c[5]||(c[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),b(e("select",{"onUpdate:modelValue":c[0]||(c[0]=f=>r.value=f),onChange:d,class:"input"},[...c[4]||(c[4]=[ie('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[U,r.value]])]),e("div",null,[c[6]||(c[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),b(e("input",{"onUpdate:modelValue":c[1]||(c[1]=f=>i.value=f),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[T,i.value]])]),e("div",null,[c[7]||(c[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),b(e("textarea",{"onUpdate:modelValue":c[2]||(c[2]=f=>m.value=f),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[T,m.value]])]),e("div",Kt,[x(g(L),{label:"Cancel",variant:"outline",size:"small",onClick:c[3]||(c[3]=f=>a.$emit("cancel"))}),x(g(L),{label:"Send Email",variant:"primary",size:"small",onClick:v})])]))}},Jt={class:"space-y-3"},Xt={class:"text-fluid-xs text-sub mt-1"},Zt={class:"flex justify-end gap-2"},Rl={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,n=o,r=V(l.initialTemplate),i=V(l.initialMessage),m={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},p=()=>{r.value&&m[r.value]&&(i.value=m[r.value])},d=()=>{i.value.trim()&&n("send",{type:"sms",template:r.value,message:i.value})};return(v,a)=>(w(),k("div",Jt,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=c=>r.value=c),onChange:p,class:"input"},[...a[3]||(a[3]=[ie('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[U,r.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),b(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=c=>i.value=c),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[T,i.value]]),e("p",Xt,S(i.value.length)+"/160 characters",1)]),e("div",Zt,[x(g(L),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=c=>v.$emit("cancel"))}),x(g(L),{label:"Send SMS",variant:"primary",size:"small",onClick:d})])]))}},_t={class:"space-y-3"},el={class:"flex justify-end gap-2"},Bl={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:o}){const l=t,n=o,r=V(l.initialTemplate),i=V(l.initialMessage),m={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},p=()=>{r.value&&m[r.value]&&(i.value=m[r.value])},d=()=>{i.value.trim()&&n("send",{type:"whatsapp",template:r.value,message:i.value})};return(v,a)=>(w(),k("div",_t,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=c=>r.value=c),onChange:p,class:"input"},[...a[3]||(a[3]=[ie('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[U,r.value]])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),b(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=c=>i.value=c),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[T,i.value]])]),e("div",el,[x(g(L),{label:"Cancel",variant:"outline",size:"small",onClick:a[2]||(a[2]=c=>v.$emit("cancel"))}),x(g(L),{label:"Send WhatsApp",variant:"outline",size:"small",onClick:d})])]))}};function N(t){if(!t)return 0;const o=new Date(t),n=Math.abs(new Date-o);return Math.ceil(n/(1e3*60*60*24))}const z={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const o=R(),l=o.getSetting("oofbMinDays"),n=o.getSetting("oofbMaxDays"),r=N(t.opportunity.createdAt);return r>=l&&r<n+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const l=R().getSetting("ufbDays");return N(t.opportunity.createdAt)>=l&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=R().getSetting("ofbDays");return N(t.opportunity.lastActivity||t.opportunity.createdAt)>=l&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const l=R().getSetting("nfuDays"),n=N(t.opportunity.lastActivity||t.opportunity.createdAt),r=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return n>=l&&!t.opportunity.contractDate&&!r&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var i;if(!t.opportunity.contractDate)return!1;const l=R().getSetting("cfbDays"),n=N(t.opportunity.contractDate),r=(i=t.activities)==null?void 0:i.some(m=>{var p;return m.type==="delivery"||((p=m.action)==null?void 0:p.toLowerCase().includes("delivered"))});return n>=l&&!r},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var i;const o=(i=t.activities)==null?void 0:i.find(m=>{var p;return m.type==="delivery"||((p=m.action)==null?void 0:p.toLowerCase().includes("delivered"))});if(!o)return!1;const n=R().getSetting("dfbDays");return N(o.timestamp)>=n},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const o=t.stage;return o==="Closed Won"||o==="Closed Lost"},"is-closed-with-task-widget":t=>z["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(z["is-closed"](t))return!1;const o=R(),l=o.getSetting("abandonedOpportunityDays");if(!o.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const r=t.opportunity.lastActivity||t.opportunity.createdAt;return N(r)>=l}};function Nl(t,o){if(z["is-closed-with-task-widget"](o))return[oe.reopen,oe.requalify,oe.closeLost];const l=de[t];return!l||!l.secondaryActions?[]:l.secondaryActions.filter(n=>{if(!n.conditional)return!0;const r=z[n.conditional];return r?r(o):!0})}function ql(t,o){const l=de[t];if(!l||!l.taskWidgets)return null;const r=R().getSetting("autoCloseWidgetsOnClose"),i=z["is-closed"]({stage:t});for(const m of l.taskWidgets){if(r&&i&&(m.type==="NFU"||m.type==="OFB"))continue;const p=z[m.condition];if(p&&p(o))return m.type}return null}function Wl(t,o){const l=de[t];if(!l||!l.primaryAction)return null;const n=l.primaryAction;return{...n,title:typeof n.title=="function"?n.title(o):n.title,description:typeof n.description=="function"?n.description(o):n.description,label:typeof n.label=="function"?n.label(o):n.label}}function jl(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function zl(t){return t==="Closed Won"||t==="Closed Lost"}const tl={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},ll={key:0,class:"flex justify-between items-center mb-4"},nl={class:"text-sm font-bold text-heading"},al={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},ol={class:"flex items-center gap-3"},sl={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},il=["src"],rl={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},dl={class:"font-bold text-sm text-heading"},ul={class:"text-xs text-sub"},cl={class:"space-y-4"},pl={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ml={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},fl=["disabled"],Ql={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:o,emit:l}){const n=t,r=l,i=V({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});J(()=>{if(n.selectedVehicle){i.value.price=n.selectedVehicle.price||0,i.value.brand=n.selectedVehicle.brand||"",i.value.model=n.selectedVehicle.model||"",i.value.year=n.selectedVehicle.year||"",i.value.image=n.selectedVehicle.image||"";const v=new Date;v.setDate(v.getDate()+30),i.value.validUntil=v.toISOString().split("T")[0]}n.item&&n.item.data&&(i.value={...i.value,...n.item.data,price:n.item.data.price||n.item.data.total||0,financingType:n.item.data.financingType||n.item.data.paymentMethod||"",notes:n.item.data.notes||n.item.data.description||""})}),j(()=>n.selectedVehicle,v=>{v&&!n.item&&(i.value.price=v.price||0,i.value.brand=v.brand||"",i.value.model=v.model||"",i.value.year=v.year||"",i.value.image=v.image||"")});const m=F(()=>i.value.price>0&&i.value.financingType!==""),p=v=>v?v.toLocaleString("en-US"):"0",d=()=>{var a,c;if(!m.value)return;const v={id:((a=n.item)==null?void 0:a.id)||Date.now(),type:"offer",action:n.item?"updated an offer":"created an offer",data:{brand:i.value.brand,model:i.value.model,year:i.value.year,price:i.value.price,total:i.value.price,paymentMethod:i.value.financingType,financingType:i.value.financingType,downPayment:i.value.downPayment,monthlyPayment:i.value.monthlyPayment,term:i.value.term,interestRate:i.value.interestRate,deliveryDate:i.value.deliveryDate,validUntil:i.value.validUntil,notes:i.value.notes,description:i.value.notes,image:i.value.image},timestamp:((c=n.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!n.item};r("save",v)};return o({submit:d,isValid:m,offerData:i}),(v,a)=>(w(),k("div",tl,[t.hideHeader?P("",!0):(w(),k("div",ll,[e("h5",nl,S(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:a[0]||(a[0]=c=>v.$emit("cancel")),class:"text-sub hover:text-body"},[...a[11]||(a[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(w(),k("div",al,[a[12]||(a[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",ol,[e("div",sl,[t.selectedVehicle.image?(w(),k("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,il)):(w(),k("i",rl))]),e("div",null,[e("h4",dl,S(t.selectedVehicle.brand)+" "+S(t.selectedVehicle.model)+" ("+S(t.selectedVehicle.year)+") ",1),e("p",ul,"Base Price: € "+S(p(t.selectedVehicle.price)),1)])])])):P("",!0),e("div",cl,[e("div",null,[a[13]||(a[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[M(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=c=>i.value.price=c),class:"input",placeholder:"Enter offer price"},null,512),[[T,i.value.price]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[M(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),b(e("select",{"onUpdate:modelValue":a[2]||(a[2]=c=>i.value.financingType=c),class:"input"},[...a[14]||(a[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[U,i.value.financingType]])]),i.value.financingType==="finance"||i.value.financingType==="lease"?(w(),k("div",pl,[e("div",null,[a[16]||(a[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),b(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=c=>i.value.downPayment=c),class:"input",placeholder:"0"},null,512),[[T,i.value.downPayment]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),b(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=c=>i.value.monthlyPayment=c),class:"input",placeholder:"Calculated automatically"},null,512),[[T,i.value.monthlyPayment]])]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),b(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=c=>i.value.term=c),class:"input",placeholder:"36"},null,512),[[T,i.value.term]])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),b(e("input",{type:"number",step:"0.1","onUpdate:modelValue":a[6]||(a[6]=c=>i.value.interestRate=c),class:"input",placeholder:"3.5"},null,512),[[T,i.value.interestRate]])])])):P("",!0),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),b(e("input",{type:"date","onUpdate:modelValue":a[7]||(a[7]=c=>i.value.deliveryDate=c),class:"input"},null,512),[[T,i.value.deliveryDate]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),b(e("input",{type:"date","onUpdate:modelValue":a[8]||(a[8]=c=>i.value.validUntil=c),class:"input"},null,512),[[T,i.value.validUntil]])]),e("div",null,[a[22]||(a[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),b(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=c=>i.value.notes=c),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[T,i.value.notes]])])]),t.hideActions?P("",!0):(w(),k("div",ml,[e("button",{onClick:a[10]||(a[10]=c=>v.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:d,disabled:!m.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},S(t.item?"Update Offer":"Create Offer"),9,fl)]))]))}},Hl={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:o}){const l=o,n=i=>{i||l("close")},r=()=>{l("close")};return(i,m)=>(w(),Y(g(ne),{open:t.show,"onUpdate:open":n},{default:I(()=>[x(g(X),null,{default:I(()=>[x(g(Z),{class:"fixed inset-0 z-50 bg-black/50"}),x(g(_),{class:"w-full sm:max-w-md"},{default:I(()=>[x(g(ee),null,{default:I(()=>[x(g(te),null,{default:I(()=>[M(S(t.title),1)]),_:1})]),_:1}),m[0]||(m[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),x(g(le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:I(()=>[x(g(L),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:r})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{E as L,de as O,$l as P,Il as T,El as _,wl as a,Sl as b,kl as c,Cl as d,Al as e,hl as f,Tl as g,Pl as h,ye as i,Ll as j,Dl as k,Ml as l,xl as m,Rl as n,Bl as o,Ol as p,Fl as q,ql as r,Vl as s,Wl as t,Ul as u,Nl as v,zl as w,jl as x,Ql as y,Hl as z};
