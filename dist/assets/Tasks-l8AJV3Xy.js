import{_ as z,r as T,e as p,o as u,g as x,h as t,n as v,l as L,w as V,H as M,z as H,T as me,F as P,i as Y,c as A,I as j,t as h,B as re,J as B,K as le,j as E,m as S,L as ve,G as xe,u as he,M as be,k as we,p as _,d as Ce}from"./index-Be589Dcd.js";import{u as $e}from"./opportunities-BEKDyPzK.js";import{u as Te,_ as Se}from"./ReassignUserModal-CCRTMl9B.js";import{_ as qe}from"./PageHeader-DBtxXtqo.js";import{g as F,a as W,b as oe}from"./formatters-Br5TsDxy.js";import{u as Ie,_ as ke,a as ie}from"./useTaskShell-C8GzfPgZ.js";import"./ModalShell-BDXG1RnS.js";const De={class:"flex items-center gap-2"},Me={key:0,class:"flex gap-2"},Oe={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},Ae={key:0,class:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Fe={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0}},emits:["filter-change","sort-change"],setup(i,{emit:w}){const I=w,g=T(!1),C=()=>{g.value=!g.value},b=m=>{g.value=!1,I("sort-change",m)},k={mounted(m,r){m.clickOutsideEvent=n=>{m===n.target||m.contains(n.target)||r.value(n)},document.addEventListener("click",m.clickOutsideEvent)},unmounted(m){document.removeEventListener("click",m.clickOutsideEvent)}};return(m,r)=>(u(),p("div",De,[i.showTypeFilter?(u(),p("div",Me,[t("button",{onClick:r[0]||(r[0]=n=>m.$emit("filter-change","all")),class:v(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",i.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),t("button",{onClick:r[1]||(r[1]=n=>m.$emit("filter-change","lead")),class:v(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",i.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),t("button",{onClick:r[2]||(r[2]=n=>m.$emit("filter-change","opportunity")),class:v(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",i.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):x("",!0),t("div",{class:v(["relative",i.showTypeFilter?"ml-auto":""]),ref:"sortContainer"},[t("button",{onClick:V(C,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[r[7]||(r[7]=t("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),i.sortOption&&i.sortOption!=="recent-first"?(u(),p("span",Oe)):x("",!0)]),L(me,{name:"dropdown"},{default:M(()=>[g.value?H((u(),p("div",Ae,[t("button",{onClick:r[3]||(r[3]=n=>b("recent-first")),class:v(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":i.sortOption==="recent-first"}])},[t("i",{class:v(["fa-solid fa-check text-[10px] w-3",i.sortOption==="recent-first"?"opacity-100":"opacity-0"])},null,2),r[8]||(r[8]=t("span",null,"Most Recent First",-1))],2),t("button",{onClick:r[4]||(r[4]=n=>b("urgent-first")),class:v(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":i.sortOption==="urgent-first"}])},[t("i",{class:v(["fa-solid fa-check text-[10px] w-3",i.sortOption==="urgent-first"?"opacity-100":"opacity-0"])},null,2),r[9]||(r[9]=t("span",null,"Urgent first",-1))],2),t("button",{onClick:r[5]||(r[5]=n=>b("assigned-to-me")),class:v(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":i.sortOption==="assigned-to-me"}])},[t("i",{class:v(["fa-solid fa-check text-[10px] w-3",i.sortOption==="assigned-to-me"?"opacity-100":"opacity-0"])},null,2),r[10]||(r[10]=t("span",null,"Assigned to me",-1))],2),t("button",{onClick:r[6]||(r[6]=n=>b("assigned-to-my-team")),class:v(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":i.sortOption==="assigned-to-my-team"}])},[t("i",{class:v(["fa-solid fa-check text-[10px] w-3",i.sortOption==="assigned-to-my-team"?"opacity-100":"opacity-0"])},null,2),r[11]||(r[11]=t("span",null,"Assigned to my team",-1))],2)])),[[k,()=>g.value=!1]]):x("",!0)]),_:1})],2)]))}},ae=z(Fe,[["__scopeId","data-v-59aa697a"]]),Le={class:"flex bg-gray-100 p-1 rounded-lg w-fit"},Ve=["onClick"],ne={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:i=>i.every(w=>w.value&&w.icon&&w.label)}},emits:["update:view"],setup(i){return(w,I)=>(u(),p("div",Le,[(u(!0),p(P,null,Y(i.options,g=>(u(),p("button",{key:g.value,onClick:C=>w.$emit("update:view",g.value),class:v(["p-1.5 rounded-md transition-all duration-200",i.view===g.value?"bg-white shadow-sm text-gray-900":"text-gray-400 hover:text-gray-600"])},[t("i",{class:v([g.icon,"text-base"])},null,2)],10,Ve))),128))]))}},Ne={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},Be={class:"px-4 md:px-8 py-4 md:py-6 border-b border-gray-100 bg-gray-50/50 shrink-0"},Ee={class:"flex items-center justify-between gap-3"},Ue={class:"flex items-center gap-3"},je={class:"page-header-title"},He={key:0,class:"hidden lg:flex"},Re={key:0,class:"px-5 py-3 bg-white border-b border-gray-100"},_e={class:"px-5 py-3"},ze={class:"relative"},Pe=["placeholder"],Qe=["onClick"],We={key:0,class:"absolute right-2 top-10 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Ye={class:"space-y-3"},Ge={class:"space-y-2"},Je={class:"flex items-start gap-3"},Ke={class:"flex-1 min-w-0"},Xe={class:"flex items-center justify-between gap-2 mb-0.5"},Ze={class:"font-bold text-gray-900 text-sm leading-tight truncate"},et={class:"text-right shrink-0"},tt={class:"flex items-center gap-2 mt-1"},st={class:"text-gray-600 text-xs truncate flex-1 min-w-0"},lt=["onClick"],it={class:"space-y-2"},rt={class:"flex items-center justify-between gap-3"},ot={class:"flex items-center gap-1.5 flex-wrap"},at={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(i,{emit:w}){const I={mounted(d,f){d.clickOutsideEvent=a=>{d===a.target||d.contains(a.target)||f.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},g=i,C=w,b=T(""),k=T("none"),m=A(()=>{let d=g.items;if(g.typeFilter&&g.typeFilter!=="all"&&(d=d.filter(f=>f.type===g.typeFilter)),b.value){const f=b.value.toLowerCase();d=d.filter(a=>{const q=g.getName(a).toLowerCase(),N=g.getVehicleInfo(a).toLowerCase();return q.includes(f)||N.includes(f)})}return d}),r=d=>{const f=d.compositeId||`${d.type||"task"}-${d.id}`||d.id;return g.selectedId===f},n=d=>{k.value=d,C("sort-change",d)},$=T(null),o=T(null);return j(()=>g.selectedId,async d=>{d&&o.value&&(await le(),o.value.scrollIntoView({behavior:"smooth",block:"nearest"}))},{immediate:!0}),j(m,async()=>{g.selectedId&&o.value&&(await le(),setTimeout(()=>{o.value&&o.value.scrollIntoView({behavior:"smooth",block:"nearest"})},100))},{immediate:!0}),(d,f)=>(u(),p("div",Ne,[t("div",Be,[t("div",Ee,[t("div",Ue,[i.showMobileClose?(u(),p("button",{key:0,onClick:f[0]||(f[0]=a=>d.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...f[4]||(f[4]=[t("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):x("",!0),t("h2",je,h(i.title),1)]),i.viewMode?(u(),p("div",He,[L(ne,{view:i.viewMode,options:[{value:"card",icon:"fa-solid fa-list",label:"Cards"},{value:"table",icon:"fa-solid fa-table",label:"Table"}],"onUpdate:view":f[1]||(f[1]=a=>d.$emit("view-change",a))},null,8,["view"])])):x("",!0)])]),i.showTypeFilter?(u(),p("div",Re,[L(ae,{"type-filter":i.typeFilter,"sort-option":k.value,"show-type-filter":i.showTypeFilter,onFilterChange:f[2]||(f[2]=a=>d.$emit("filter-change",a)),onSortChange:n},null,8,["type-filter","sort-option","show-type-filter"])])):x("",!0),t("div",_e,[t("div",ze,[f[5]||(f[5]=t("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),H(t("input",{"onUpdate:modelValue":f[3]||(f[3]=a=>b.value=a),type:"text",placeholder:i.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Pe),[[re,b.value]])])]),t("div",{ref_key:"scrollContainer",ref:$,class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},[(u(!0),p(P,null,Y(m.value,a=>(u(),p("div",{key:a.id,ref_for:!0,ref:q=>{r(a)&&(o.value=q)},onClick:q=>d.$emit("select",a.compositeId||`${a.type||"task"}-${a.id}`||a.id),class:v(["rounded-lg px-4 py-3 cursor-pointer transition-all relative group",r(a)?typeof i.selectedClass=="function"?i.selectedClass(a):i.selectedClass:typeof i.unselectedClass=="function"?i.unselectedClass(a):i.unselectedClass])},[i.openMenuId===a.id&&i.showMenu?H((u(),p("div",We,[B(d.$slots,"menu",{item:a},void 0,!0)])),[[I,()=>d.$emit("menu-close")]]):x("",!0),t("div",Ye,[t("div",Ge,[t("div",Je,[t("div",{class:v(["w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0",i.avatarClass(a)])},h(i.getInitials(a)),3),t("div",Ke,[t("div",Xe,[t("div",Ze,h(i.getName(a)),1),t("div",et,[B(d.$slots,"meta",{item:a},void 0,!0)])]),t("div",tt,[t("div",st,h(i.getVehicleInfo(a)),1),B(d.$slots,"vehicle-type",{item:a},void 0,!0)])]),i.showMenu?(u(),p("button",{key:0,onClick:V(q=>d.$emit("menu-click",a.id),["stop"]),class:"w-7 h-7 flex items-center justify-center rounded-md hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors shrink-0"},[...f[6]||(f[6]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,lt)):x("",!0)])]),f[7]||(f[7]=t("div",{class:"border-t border-gray-100"},null,-1)),t("div",it,[t("div",rt,[B(d.$slots,"owner",{item:a},void 0,!0),B(d.$slots,"dates",{item:a},void 0,!0)]),t("div",ot,[B(d.$slots,"badges",{item:a},void 0,!0)])])])],10,Qe))),128))],512)]))}},nt=z(at,[["__scopeId","data-v-86fe16a5"]]),dt={class:"page-container"},ut={class:"p-4 md:p-8"},ct={class:"mb-6 flex flex-col md:flex-row gap-4 items-start md:items-center"},pt={class:"relative flex-1 max-w-md"},gt=["placeholder"],yt={class:"card overflow-hidden"},ft={class:"overflow-x-auto -mx-4 md:mx-0"},mt={class:"w-full"},vt={class:"divide-y divide-gray-100"},xt=["onClick"],ht={class:"px-3 md:px-6 py-3 whitespace-nowrap"},bt={class:"flex items-center gap-2 md:gap-3"},wt={class:"min-w-0"},Ct={class:"text-content-bold truncate max-w-[120px] md:max-w-none"},$t={class:"text-meta truncate hidden sm:block"},Tt={class:"px-3 md:px-6 py-3 whitespace-nowrap"},St={class:"flex items-center gap-2"},qt={class:"min-w-0"},It={class:"text-content font-medium truncate max-w-[120px]"},kt={class:"flex items-center gap-1 mt-0.5"},Dt={class:"px-3 md:px-6 py-3 whitespace-nowrap hidden sm:table-cell"},Mt={class:"px-3 md:px-6 py-3 whitespace-nowrap"},Ot={class:"flex flex-col gap-1"},At={key:0,class:"badge-ui bg-red-50 text-red-700 font-semibold flex items-center gap-1 w-fit"},Ft={class:"px-3 md:px-6 py-3 whitespace-nowrap hidden lg:table-cell"},Lt={class:"text-content"},Vt={class:"px-3 md:px-6 py-3 whitespace-nowrap hidden md:table-cell"},Nt={class:"flex items-center gap-2"},Bt={class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},Et={class:"text-content text-gray-600 truncate max-w-[80px]"},Ut={class:"px-3 md:px-6 py-3 whitespace-nowrap hidden xl:table-cell"},jt={key:0,class:"text-content font-semibold text-gray-900"},Ht={key:1,class:"text-gray-400"},Rt=["onClick"],_t={key:0,class:"absolute right-2 mt-2 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},zt=["onClick"],Pt={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","reassign","close","view-change"],setup(i,{emit:w}){const I=i,g=T(""),C=A(()=>{if(!g.value.trim())return I.tasks;const r=g.value.toLowerCase();return I.tasks.filter(n=>{var $,o;return n.customer.name.toLowerCase().includes(r)||(($=n.customer.email)==null?void 0:$.toLowerCase().includes(r))||k(n).toLowerCase().includes(r)||((o=n.assignee)==null?void 0:o.toLowerCase().includes(r))})}),b=r=>r.compositeId===I.currentTaskId,k=r=>r.type==="lead"?r.requestedCar?`${r.requestedCar.brand} ${r.requestedCar.model}`:"No vehicle specified":r.vehicle?`${r.vehicle.brand} ${r.vehicle.model}`:"No vehicle specified",m=r=>{if(!r)return"Not set";const n=new Date,$=new Date(r),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()),f=new Date($.getFullYear(),$.getMonth(),$.getDate())-o,a=Math.ceil(f/(1e3*60*60*24));return a===0?"Today":a===1?"Tomorrow":a===-1?"Yesterday":a>1&&a<=7?`In ${a} days`:a<-1&&a>=-7?`${Math.abs(a)} days ago`:W(r)};return(r,n)=>{const $=ve("click-outside");return u(),p("div",dt,[L(qe,{title:"Tasks",subtitle:"Manage your leads and opportunities"},{actions:M(()=>[L(ne,{view:i.viewMode,options:[{value:"card",icon:"fa-solid fa-list",label:"Cards"},{value:"table",icon:"fa-solid fa-table",label:"Table"}],"onUpdate:view":n[0]||(n[0]=o=>r.$emit("view-change",o))},null,8,["view"])]),_:1}),t("div",ut,[t("div",ct,[t("div",pt,[n[6]||(n[6]=t("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),H(t("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>g.value=o),type:"text",placeholder:i.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,gt),[[re,g.value]])]),L(ae,{"type-filter":i.typeFilter,"sort-option":i.sortOption,"show-type-filter":i.showTypeFilter,onFilterChange:n[2]||(n[2]=o=>r.$emit("filter-change",o)),onSortChange:n[3]||(n[3]=o=>r.$emit("sort-change",o))},null,8,["type-filter","sort-option","show-type-filter"])]),t("div",yt,[t("div",ft,[t("table",mt,[n[11]||(n[11]=t("thead",{class:"bg-gray-50 border-b border-gray-200 sticky top-0"},[t("tr",null,[t("th",{class:"px-3 md:px-6 py-3 text-left"},[t("input",{type:"checkbox",class:"rounded"})]),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Customer"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Vehicle"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap hidden sm:table-cell"},"Type"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap"},"Stage/Status"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap hidden lg:table-cell"},"Next Action"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap hidden md:table-cell"},"Owner"),t("th",{class:"px-3 md:px-6 py-3 text-left label-upper whitespace-nowrap hidden xl:table-cell"},"Value"),t("th",{class:"px-3 md:px-6 py-3"})])],-1)),t("tbody",vt,[(u(!0),p(P,null,Y(C.value,o=>(u(),p("tr",{key:o.compositeId,onClick:d=>r.$emit("select",o.compositeId),class:v(["hover:bg-gray-50 cursor-pointer transition-colors",{"bg-blue-50":b(o)}])},[t("td",{class:"px-3 md:px-6 py-3 whitespace-nowrap",onClick:n[4]||(n[4]=V(()=>{},["stop"]))},[...n[7]||(n[7]=[t("input",{type:"checkbox",class:"rounded"},null,-1)])]),t("td",ht,[t("div",bt,[t("div",{class:v(["w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0",o.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"])},h(o.customer.initials),3),t("div",wt,[t("div",Ct,h(o.customer.name),1),t("div",$t,h(o.customer.email),1)])])]),t("td",Tt,[t("div",St,[t("div",qt,[t("div",It,h(k(o)),1),t("div",kt,[i.getVehicleType(o)?(u(),p("span",{key:0,class:v(["text-[10px] font-medium px-1.5 py-0.5 rounded-md",i.getVehicleTypeBadgeClass(i.getVehicleType(o))])},h(i.getVehicleType(o).label),3)):x("",!0)])])])]),t("td",Dt,[t("span",{class:v(["badge-ui font-semibold",o.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"])},h(o.type==="lead"?"Lead":"Opportunity"),3)]),t("td",Mt,[t("div",Ot,[t("span",{class:v(["badge-ui font-semibold",I.getStageBadgeClass(o.type==="lead"?o.status:o.stage)])},h(o.type==="lead"?o.status:o.stage),3),o.type==="lead"&&o.priority==="Hot"?(u(),p("span",At,[...n[8]||(n[8]=[t("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),E(" Hot ",-1)])])):x("",!0)])]),t("td",Ft,[t("div",Lt,[t("div",{class:v(["font-medium mb-0.5",S(F)(o.nextActionDue).textClass])},h(S(W)(o.nextActionDue)),3),t("div",{class:v(["text-xs flex items-center gap-1",S(F)(o.nextActionDue).textClass])},[S(F)(o.nextActionDue).icon?(u(),p("i",{key:0,class:v(`fa-solid ${S(F)(o.nextActionDue).icon} text-[10px]`)},null,2)):x("",!0),t("span",null,h(m(o.nextActionDue)),1)],2)])]),t("td",Vt,[t("div",Nt,[t("div",Bt,h(i.getOwnerInfo(o).initials),1),t("span",Et,h(i.getOwnerInfo(o).name),1)])]),t("td",Ut,[o.type==="opportunity"?(u(),p("div",jt," €"+h(S(oe)(o.value)),1)):(u(),p("div",Ht,"-"))]),t("td",{class:"px-3 md:px-6 py-3 whitespace-nowrap",onClick:n[5]||(n[5]=V(()=>{},["stop"]))},[t("button",{onClick:d=>r.$emit("menu-click",o.id),class:"text-gray-400 hover:text-gray-600"},[...n[9]||(n[9]=[t("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])],8,Rt),i.openMenuId===o.id?H((u(),p("div",_t,[t("button",{onClick:d=>r.$emit("reassign",o),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2"},[...n[10]||(n[10]=[t("i",{class:"fa-solid fa-user-plus w-4 text-gray-400"},null,-1),E(" Reassign ",-1)])],8,zt)])),[[$,()=>r.$emit("menu-close")]]):x("",!0)])],10,xt))),128))])])])])])])}}},Qt=z(Pt,[["__scopeId","data-v-922959b7"]]),Wt={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},Yt={key:0,class:"bg-red-50 text-red-700 text-[10px] font-semibold uppercase px-2 py-0.5 rounded-md flex items-center gap-1"},Gt={class:"bg-gray-100 text-gray-700 text-[10px] font-medium px-2 py-0.5 rounded-md"},Jt={key:0,class:"text-right"},Kt={class:"text-sm font-semibold text-gray-900"},Xt={key:0,class:"flex items-center gap-1.5"},Zt={class:"text-xs text-gray-600 truncate"},es={class:"text-xs font-medium leading-tight"},ts=["onClick"],ss=["onClick"],ls=["onClick"],is={key:2,class:"flex-1 flex flex-col overflow-hidden"},rs={class:"lg:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},os=["title"],as={key:0,class:"flex-1 flex items-center justify-center"},ns={__name:"Tasks",setup(i){const w=be(),I=Ce(),g=xe(),C=$e(),b=he(),k=Te(),m=T(localStorage.getItem("tasksViewMode")||"table");j(m,s=>{localStorage.setItem("tasksViewMode",s)});const r=s=>{if(!s)return"No deadline";const l=F(s);return l.type==="overdue"?"OVERDUE":l.type==="today"||l.type==="urgent"?l.relativeTime:W(s)},n=s=>{const l=s.type==="lead"?s.requestedCar:s.vehicle;return!l||!l.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[l.type]||{type:l.type.toLowerCase(),label:l.type}},$=s=>s?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[s.type]||"bg-gray-50 text-gray-700":"",o=s=>{if(!s||!s.assignee)return{name:"Unassigned",initials:"?"};const l=s.assigneeInitials||s.assignee.split(" ").map(c=>c[0]).join("");return{name:s.assignee,initials:l}},d=T("all"),f=T("none"),a=T(null),q=T(!1),N=T(!1),R=T(null),O=A(()=>{const l=g.leads.filter(e=>!e.isDisqualified).map(e=>({...e,type:"lead",compositeId:`lead-${e.id}`})),c=C.opportunities.map(e=>({...e,type:"opportunity",compositeId:`opportunity-${e.id}`}));let y=[];return b.isOperator()?y=l:b.isSalesman()?y=c:y=[...l,...c],y}),G=A(()=>{let s=O.value;if(d.value!=="all"&&(s=s.filter(l=>l.type===d.value)),f.value==="urgent-first")s=[...s].sort((l,c)=>{if(l.priority==="Hot"&&c.priority!=="Hot")return-1;if(l.priority!=="Hot"&&c.priority==="Hot")return 1;const y=new Date(l.lastActivity||l.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-y});else if(f.value==="assigned-to-me"){const l=b.currentUser.name;s=s.filter(c=>c.assignee===l),s=[...s].sort((c,y)=>{const e=new Date(c.lastActivity||c.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-e})}else if(f.value==="assigned-to-my-team"){const l=b.currentUser;let c=[];l.role==="manager"?c=k.users.map(y=>y.name):l.role==="salesman"?c=k.users.filter(y=>y.role==="salesman").map(y=>y.name):l.role==="operator"&&(c=k.users.filter(y=>y.role==="operator").map(y=>y.name)),s=s.filter(y=>c.includes(y.assignee)),s=[...s].sort((y,e)=>{const U=new Date(y.lastActivity||y.createdAt||0);return new Date(e.lastActivity||e.createdAt||0)-U})}else s=[...s].sort((l,c)=>{const y=new Date(l.lastActivity||l.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-y});return s}),J=A(()=>{const s=O.value.some(c=>c.type==="lead"),l=O.value.some(c=>c.type==="opportunity");return s&&l}),D=A(()=>{const s=parseInt(w.params.id),l=w.query.type;if(l)return O.value.find(e=>e.id===s&&e.type===l)||null;const y=(d.value!=="all"?O.value.filter(e=>e.type===d.value):O.value).find(e=>e.id===s);return y||O.value.find(e=>e.id===s)||null});A(()=>D.value?D.value.type==="lead"?g.currentLeadActivities:C.currentOpportunityActivities:[]);const Q=Ie(D),de=Q.managementWidget,ue=Q.storeAdapter,ce=Q.addNewConfig,pe=A(()=>s=>s.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");we(()=>{g.loadLeads(),C.loadOpportunities();const s=w.params.id;s&&K(s)}),j(()=>w.params.id,s=>{s&&K(s)}),j(D,s=>{s&&(s.type==="lead"?g.loadLeadById(s.id):C.loadOpportunityById(s.id))},{immediate:!0});const K=s=>{const l=parseInt(s),c=O.value.find(y=>y.id===l);c&&(c.type==="lead"?g.loadLeadById(l):C.loadOpportunityById(l))},X=s=>{const[l,c]=s.split("-");I.push({path:`/tasks/${c}`,query:{type:l}}),q.value=!1},Z=s=>{a.value=a.value===s?null:s},ee=s=>{R.value=s,N.value=!0,a.value=null},te=s=>{f.value=s},ge=async s=>{if(!R.value)return;const l=R.value,c=s.name;l.type==="lead"?await g.modifyLead(l.id,{assignee:c,assigneeType:s.type,teamId:s.type==="team"?s.id:null}):l.type==="opportunity"&&await C.updateOpportunity(l.id,{assignee:c,assigneeType:s.type,teamId:s.type==="team"?s.id:null}),N.value=!1,R.value=null},ye=async s=>{a.value=null,s.type==="lead"?await g.modifyLead(s.id,{priority:"Hot"}):s.type==="opportunity"&&await C.modifyOpportunity(s.id,{priority:"Hot"})},fe=async s=>{a.value=null,s.type==="lead"?await g.modifyLead(s.id,{priority:"Normal"}):s.type==="opportunity"&&await C.modifyOpportunity(s.id,{priority:"Normal"})},se=s=>({Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"})[s]||"bg-gray-100 text-gray-700";return(s,l)=>{var c,y;return u(),p("div",Wt,[m.value==="card"?(u(),p("div",{key:0,class:v(["lg:relative lg:block",q.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[L(nt,{title:"Tasks",items:G.value,"selected-id":(c=D.value)==null?void 0:c.compositeId,"type-filter":d.value,"view-mode":m.value,"selected-class":e=>e.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":pe.value,"open-menu-id":a.value,getName:e=>e.customer.name,getInitials:e=>e.customer.initials,getVehicleInfo:e=>e.type==="lead"?e.requestedCar?`${e.requestedCar.brand} ${e.requestedCar.model}`:"No vehicle specified":e.vehicle?`${e.vehicle.brand} ${e.vehicle.model}`:"No vehicle specified",avatarClass:e=>e.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:X,onMenuClick:Z,onMenuClose:l[0]||(l[0]=e=>a.value=null),onClose:l[1]||(l[1]=e=>q.value=!1),"show-type-filter":J.value,onFilterChange:l[2]||(l[2]=e=>d.value=e),onSortChange:te,onViewChange:l[3]||(l[3]=e=>m.value=e)},{badges:M(({item:e})=>[t("span",{class:v(["text-[10px] font-semibold uppercase px-2 py-0.5 rounded-md",e.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"])},h(e.type==="lead"?"Lead":"Opportunity"),3),e.type==="lead"?(u(),p(P,{key:0},[e.priority==="Hot"?(u(),p("span",Yt,[...l[11]||(l[11]=[t("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),E(" Hot ",-1)])])):x("",!0),t("span",Gt,h(e.status),1)],64)):(u(),p("span",{key:1,class:v(["text-[10px] font-semibold uppercase px-2 py-0.5 rounded-md",se(e.stage)])},h(e.stage),3))]),meta:M(({item:e})=>[e.type==="opportunity"?(u(),p("div",Jt,[t("div",Kt,"€"+h(S(oe)(e.value)),1)])):x("",!0)]),"vehicle-type":M(({item:e})=>[n(e)?(u(),p("span",{key:0,class:v(["text-[10px] font-medium px-1.5 py-0.5 rounded-md shrink-0",$(n(e))])},h(n(e).label),3)):x("",!0)]),owner:M(({item:e})=>[e.assignee?(u(),p("div",Xt,[l[12]||(l[12]=t("i",{class:"fa-solid fa-user text-[10px] text-gray-400"},null,-1)),t("span",Zt,h(e.assignee),1)])):x("",!0)]),dates:M(({item:e})=>[e.type==="lead"&&e.nextActionDue?(u(),p("div",{key:0,class:v(["flex items-center gap-1.5",S(F)(e.nextActionDue).textClass])},[S(F)(e.nextActionDue).type!=="overdue"?(u(),p("i",{key:0,class:v(["text-[10px]",S(F)(e.nextActionDue).iconClass])},null,2)):x("",!0),t("span",es,h(r(e.nextActionDue)),1)],2)):x("",!0)]),menu:M(({item:e})=>[t("button",{onClick:V(U=>ee(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[13]||(l[13]=[t("i",{class:"fa-solid fa-share text-gray-400"},null,-1),E(" Reassign ",-1)])],8,ts),e.priority!=="Hot"?(u(),p("button",{key:0,onClick:V(U=>ye(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[14]||(l[14]=[t("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),E(" Mark as hot ",-1)])],8,ss)):(u(),p("button",{key:1,onClick:V(U=>fe(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...l[15]||(l[15]=[t("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),E(" Unmark as hot ",-1)])],8,ls))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2)):x("",!0),m.value==="table"?(u(),_(Qt,{key:1,tasks:G.value,"current-task-id":(y=D.value)==null?void 0:y.compositeId,"type-filter":d.value,"sort-option":f.value,"show-type-filter":J.value,"show-mobile-close":!0,"open-menu-id":a.value,"get-vehicle-type":n,"get-vehicle-type-badge-class":$,"get-owner-info":o,"get-stage-badge-class":se,"view-mode":m.value,onSelect:X,onMenuClick:Z,onMenuClose:l[4]||(l[4]=e=>a.value=null),onFilterChange:l[5]||(l[5]=e=>d.value=e),onSortChange:te,onReassign:ee,onClose:l[6]||(l[6]=e=>q.value=!1),onViewChange:l[7]||(l[7]=e=>m.value=e)},null,8,["tasks","current-task-id","type-filter","sort-option","show-type-filter","open-menu-id","view-mode"])):x("",!0),m.value==="card"?(u(),p("div",is,[t("div",rs,[t("button",{onClick:l[8]||(l[8]=e=>m.value=m.value==="card"?"table":"card"),class:"w-14 h-14 bg-gray-700 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all hover:scale-110",title:m.value==="card"?"Switch to Table":"Switch to Cards"},[t("i",{class:v(m.value==="card"?"fa-solid fa-table text-lg":"fa-solid fa-list text-lg")},null,2)],8,os),t("button",{onClick:l[9]||(l[9]=e=>q.value=!q.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...l[16]||(l[16]=[t("i",{class:"fa-solid fa-list text-lg"},null,-1)])])]),!D.value&&m.value==="card"?(u(),p("div",as,[...l[17]||(l[17]=[t("div",{class:"text-center"},[t("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),t("p",{class:"text-gray-500"},"Select a task to view details")],-1)])])):D.value&&m.value==="card"?(u(),_(ke,{key:1,task:D.value,type:D.value.type,"management-widget":S(de),"store-adapter":S(ue),"add-new-config":S(ce)},{"pinned-extra":M(({task:e})=>[e.type==="lead"&&e.requestedCar?(u(),_(ie,{key:0,brand:e.requestedCar.brand,model:e.requestedCar.model,year:e.requestedCar.year,image:e.requestedCar.image||"",price:e.requestedCar.price||null,"request-message":e.requestedCar.requestMessage||"","request-type":e.requestedCar.requestType||"",source:e.source||"",dealership:e.requestedCar.dealership||"",registration:e.requestedCar.registration||"",kilometers:e.requestedCar.kilometers||null,"fuel-type":e.requestedCar.fuelType||"","gear-type":e.requestedCar.gearType||"",vin:e.requestedCar.vin||"","stock-days":e.requestedCar.stockDays!==void 0?e.requestedCar.stockDays:null,channel:e.requestedCar.channel||"Email","ad-campaign":e.requestedCar.adCampaign||"","expected-purchase-date":e.requestedCar.expectedPurchaseDate||"","fiscal-entity":e.requestedCar.fiscalEntity||"","source-details":e.requestedCar.sourceDetails||"","ad-medium":e.requestedCar.adMedium||"","ad-source":e.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):x("",!0),e.type==="opportunity"&&e.vehicle?(u(),_(ie,{key:1,brand:e.vehicle.brand,model:e.vehicle.model,year:e.vehicle.year,image:e.vehicle.image||"",price:e.vehicle.price||null,"request-message":e.vehicle.requestMessage||"","request-type":e.vehicle.requestType||"",source:e.source||"",dealership:e.vehicle.dealership||"",registration:e.vehicle.registration||"",kilometers:e.vehicle.kilometers||null,"fuel-type":e.vehicle.fuelType||"","gear-type":e.vehicle.gearType||"",vin:e.vehicle.vin||"","stock-days":e.vehicle.stockDays!==void 0?e.vehicle.stockDays:null,channel:e.vehicle.channel||"Email","ad-campaign":e.vehicle.adCampaign||"","expected-purchase-date":e.vehicle.expectedPurchaseDate||"","fiscal-entity":e.vehicle.fiscalEntity||"","source-details":e.vehicle.sourceDetails||"","ad-medium":e.vehicle.adMedium||"","ad-source":e.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):x("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):x("",!0)])):x("",!0),L(Se,{show:N.value,onClose:l[10]||(l[10]=e=>N.value=!1),onConfirm:ge},null,8,["show"])])}}},vs=z(ns,[["__scopeId","data-v-8117b7bf"]]);export{vs as default};
