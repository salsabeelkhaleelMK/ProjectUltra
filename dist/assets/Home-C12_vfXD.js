import{u as j,a as B,r as _,c as T,f as Q,b as R,d as L,e as a,o as n,g as x,h as s,F as V,i as H,n as I,t as p,j as U,w as E,k as M,l as A,m as c,p as F,q as z,s as Y,v as W}from"./index-Be589Dcd.js";import{f as G,a as J}from"./calendar-d7ctcJMA.js";import{_ as K}from"./ActionableQuestionCard-BTmBfZfg.js";import{_ as P}from"./ReassignUserModal-CCRTMl9B.js";import{_ as X}from"./PageHeader-DBtxXtqo.js";import{f as Z}from"./formatters-Br5TsDxy.js";import"./ModalShell-BDXG1RnS.js";function q(){const h=j(),{questions:b,totalQuestionsCount:v,loading:y,loadQuestions:g}=B(),i=_([]),o=_([]),r=_([]),f=_([]),k=_(!1),$=T(()=>{const d=o.value.map(l=>({...l,type:"lead",taskType:"Lead",dueTime:l.nextActionDue?new Date(l.nextActionDue).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:l.nextActionDue?new Date(l.nextActionDue):null})),m=r.value.map(l=>({...l,type:"opportunity",taskType:"Opportunity",dueTime:l.expectedCloseDate?new Date(l.expectedCloseDate).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null,dueDate:l.expectedCloseDate?new Date(l.expectedCloseDate):null}));return[...d,...m]}),D=T(()=>{const d=[],m=i.value.map(e=>({...e,todoType:"appointment",sortTime:new Date(e.start).getTime(),time:new Date(e.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(e.start)}));d.push(...m);const l=$.value.map(e=>{const t=e.dueDate||(e.nextActionDue?new Date(e.nextActionDue):null),C=t&&t<new Date;return{...e,todoType:"task",sortTime:t?t.getTime():0,isOverdue:C,priority:e.priority==="Hot"?1:2}});return d.push(...l),d.sort((e,t)=>e.todoType==="appointment"&&t.todoType!=="appointment"?-1:e.todoType!=="appointment"&&t.todoType==="appointment"?1:e.todoType==="appointment"&&t.todoType==="appointment"?e.sortTime-t.sortTime:e.isOverdue&&!t.isOverdue?-1:!e.isOverdue&&t.isOverdue?1:e.priority!==t.priority?e.priority-t.priority:e.sortTime-t.sortTime)}),w=T(()=>i.value.map(d=>({...d,time:new Date(d.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),date:new Date(d.start)})).sort((d,m)=>d.date.getTime()-m.date.getTime())),S=T(()=>$.value.filter(d=>{const m=d.dueDate||(d.nextActionDue?new Date(d.nextActionDue):null);if(!m)return!1;const l=new Date;l.setHours(0,0,0,0);const e=new Date(l);e.setDate(e.getDate()+1);const t=new Date(m);return t.setHours(0,0,0,0),t>=l&&t<e}).sort((d,m)=>{var u,C;const l=new Date,e=d.dueDate<l,t=m.dueDate<l;return e&&!t?-1:!e&&t?1:d.priority!==m.priority?(d.priority==="Hot"?1:2)-(m.priority==="Hot"?1:2):(((u=d.dueDate)==null?void 0:u.getTime())||0)-(((C=m.dueDate)==null?void 0:C.getTime())||0)})),O=T(()=>b.value);async function N(){k.value=!0;try{await g(),i.value=await G(),h.canAccessLeads()&&(o.value=await Q()),h.canAccessOpportunities()&&(r.value=await R()),f.value=await J(1)}catch(d){console.error("Error loading dashboard:",d)}finally{k.value=!1}}return{notifications:O,totalNotificationsCount:v,appointmentsToday:w,tasksDueToday:S,prioritizedTodos:D,loading:T(()=>k.value||y.value),loadDashboard:N}}const ee={class:"space-y-3"},te={key:0,class:"text-center py-8 text-gray-500"},se=["onClick"],oe={class:"flex items-start justify-between gap-4"},re={class:"flex-1 min-w-0"},ne={class:"flex items-center gap-2 mb-1"},ae={class:"font-semibold text-slate-800 text-sm mb-1"},ie={class:"text-xs text-gray-600 mb-2"},de={key:0},le={class:"flex items-center gap-2 text-xs text-gray-500"},ue={key:0},ce={key:1},pe=["onClick"],ye={__name:"TodaysAppointments",props:{appointments:{type:Array,default:()=>[]}},setup(h){const b=L(),v=i=>{const o=new Date,f=(new Date(i)-o)/(1e3*60*60);return f<0?"bg-red-100 text-red-700 border-red-200":f<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},y=i=>({confirmed:"bg-green-50 text-green-700 border-green-200",scheduled:"bg-blue-50 text-blue-700 border-blue-200",pending:"bg-yellow-50 text-yellow-700 border-yellow-200",cancelled:"bg-red-50 text-red-700 border-red-200","no-show":"bg-gray-50 text-gray-700 border-gray-200"})[i]||"bg-gray-50 text-gray-700 border-gray-200",g=i=>{i.opportunityId?b.push(`/tasks/${i.opportunityId}?type=opportunity`):i.leadId?b.push(`/tasks/${i.leadId}?type=lead`):b.push("/calendar")};return(i,o)=>(n(),a("div",ee,[h.appointments.length===0?(n(),a("div",te,[...o[0]||(o[0]=[s("i",{class:"fa-solid fa-calendar-check text-4xl mb-2 text-gray-300"},null,-1),s("p",{class:"text-sm"},"No appointments scheduled for today",-1)])])):x("",!0),(n(!0),a(V,null,H(h.appointments,r=>(n(),a("div",{key:r.id,onClick:f=>g(r),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[s("div",oe,[s("div",re,[s("div",ne,[s("span",{class:I(["text-xs font-bold px-2 py-0.5 rounded",v(r.date)])},p(r.time),3),s("span",{class:I(["text-xs font-medium px-2 py-0.5 rounded border",y(r.status)])},p(r.status),3)]),s("h4",ae,p(r.customer||r.title),1),s("p",ie,[U(p(r.type)+" ",1),r.vehicle?(n(),a("span",de," - "+p(r.vehicle),1)):x("",!0)]),s("div",le,[o[1]||(o[1]=s("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),r.assigneeType==="team"?(n(),a("span",ue,p(r.team)+" Team ",1)):(n(),a("span",ce,p(r.assignee||"Unassigned"),1))])]),s("button",{onClick:E(f=>g(r),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...o[2]||(o[2]=[s("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,pe)])],8,se))),128))]))}},me={class:"space-y-3"},ge={key:0,class:"text-center py-8 text-gray-500"},fe=["onClick"],xe={class:"flex items-start justify-between gap-4"},be={class:"flex-1 min-w-0"},he={class:"flex items-center gap-2 mb-1"},ve={key:0,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 flex items-center gap-1"},we={key:1,class:"text-xs font-medium px-2 py-0.5 rounded bg-gray-50 text-gray-700 border border-gray-200"},_e={key:3,class:"text-xs font-bold px-2 py-0.5 rounded bg-red-100 text-red-700 border border-red-200"},$e={class:"font-semibold text-slate-800 text-sm mb-1"},De={class:"text-xs text-gray-600 mb-2"},Te={key:0},ke={class:"flex items-center gap-2 text-xs text-gray-500"},Ce={key:0,class:"text-gray-500"},Ae=["onClick"],Ie={__name:"TodaysTasks",props:{tasks:{type:Array,default:()=>[]}},setup(h){const b=L(),v=g=>{if(!g)return"bg-gray-100 text-gray-700 border-gray-200";const i=new Date,r=(new Date(g)-i)/(1e3*60*60);return r<0?"bg-red-100 text-red-700 border-red-200":r<2?"bg-orange-100 text-orange-700 border-orange-200":"bg-blue-100 text-blue-700 border-blue-200"},y=g=>{b.push(`/tasks/${g.id}?type=${g.type}`)};return(g,i)=>(n(),a("div",me,[h.tasks.length===0?(n(),a("div",ge,[...i[0]||(i[0]=[s("i",{class:"fa-solid fa-tasks text-4xl mb-2 text-gray-300"},null,-1),s("p",{class:"text-sm"},"No tasks due today",-1)])])):x("",!0),(n(!0),a(V,null,H(h.tasks,o=>{var r;return n(),a("div",{key:`${o.type}-${o.id}`,onClick:f=>y(o),class:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-sm transition-all cursor-pointer"},[s("div",xe,[s("div",be,[s("div",he,[o.priority==="Hot"?(n(),a("span",ve,[...i[1]||(i[1]=[s("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),U(" HOT ",-1)])])):(n(),a("span",we," Normal ")),o.dueTime?(n(),a("span",{key:2,class:I(["text-xs font-bold px-2 py-0.5 rounded",v(o.dueDate)])},p(o.dueTime),3)):x("",!0),o.isOverdue?(n(),a("span",_e," OVERDUE ")):x("",!0)]),s("h4",$e,p(((r=o.customer)==null?void 0:r.name)||"Unknown Customer"),1),s("p",De,[U(p(o.taskType)+" ",1),o.requestedCar||o.vehicle?(n(),a("span",Te," - "+p(o.requestedCar?`${o.requestedCar.brand} ${o.requestedCar.model}`:`${o.vehicle.brand} ${o.vehicle.model}`),1)):x("",!0)]),s("div",ke,[s("span",{class:I(["px-2 py-0.5 rounded border text-[10px] font-bold uppercase",o.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},p(o.type==="lead"?"Lead":"Opportunity"),3),o.stage?(n(),a("span",Ce,p(o.stage),1)):x("",!0)])]),s("button",{onClick:E(f=>y(o),["stop"]),class:"text-gray-400 hover:text-blue-600 transition-colors"},[...i[2]||(i[2]=[s("i",{class:"fa-solid fa-chevron-right"},null,-1)])],8,Ae)])],8,fe)}),128))]))}},Se={class:"page-container"},Oe={class:"p-4 md:p-6 lg:p-8"},Ne={key:0,class:"flex items-center justify-center py-12"},Ue={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6"},Le={key:0,class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},Ve={class:"p-4 border-b border-gray-100 bg-gray-50/50"},He={class:"flex items-center justify-between"},je={class:"flex items-center gap-2"},Be={key:0,class:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded"},Ee={class:"p-4 space-y-3"},Qe={class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},Re={class:"p-4 border-b border-gray-100 bg-gray-50/50"},Me={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-2"},ze={key:0,class:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded"},Ye={class:"p-4"},We={class:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden"},Ge={class:"p-4 border-b border-gray-100 bg-gray-50/50"},Je={class:"flex items-center justify-between"},Ke={class:"flex items-center gap-2"},Pe={key:0,class:"text-xs font-bold bg-orange-100 text-orange-700 px-2 py-0.5 rounded"},Xe={class:"p-4"},Ze={key:2,class:"bg-white rounded-xl border border-gray-100 shadow-sm p-12 text-center"},at={__name:"Home",setup(h){const b=L(),v=j(),{dismissQuestion:y,addFollowUpQuestion:g}=B(),{notifications:i,totalNotificationsCount:o,appointmentsToday:r,tasksDueToday:f,loading:k,loadDashboard:$}=q(),D=_(!1),w=_(null);M(async()=>{await $()});const S=async e=>{e.type==="appointment-followup"?(y(e.id),g({id:`offer-followup-${e.opportunityId}`,type:"offer-followup",priority:5,question:`What was the offer given to ${e.customer.name}?`,customer:e.customer,opportunityId:e.opportunityId,opportunity:e.opportunity,createdAt:new Date().toISOString()})):(e.type==="ns-followup"||e.type==="stuck-opportunity"||e.type==="lead-qualification-urgency")&&y(e.id)},O=async e=>{var t;if(e.type==="appointment-followup")try{const u=(t=v.currentUser)==null?void 0:t.id;u&&(await W(e.opportunityId,u),y(e.id),await $())}catch(u){console.error("Error creating NS task:",u)}else e.type==="ns-followup"?y(e.id):e.type==="stuck-opportunity"?b.push(`/tasks/${e.opportunityId}?type=opportunity`):e.type==="lead-qualification-urgency"&&b.push(`/tasks/${e.leadId}?type=lead`)},N=e=>{w.value=e,D.value=!0},d=async e=>{if(w.value)try{const t=w.value.opportunityId||w.value.leadId;w.value.opportunityId&&await z(t,e),y(w.value.id),D.value=!1,w.value=null,await $()}catch(t){console.error("Error reassigning:",t)}},m=e=>{e.opportunityId?b.push(`/tasks/${e.opportunityId}?type=opportunity`):e.leadId&&b.push(`/tasks/${e.leadId}?type=lead`)},l=e=>{v.currentUser&&Y(e.id,v.currentUser.id),y(e.id)};return(e,t)=>(n(),a("div",Se,[A(X,{title:"Dashboard",subtitle:c(Z)(new Date)},null,8,["subtitle"]),s("div",Oe,[c(k)?(n(),a("div",Ne,[...t[5]||(t[5]=[s("div",{class:"text-gray-500"},"Loading dashboard...",-1)])])):(n(),a("div",Ue,[c(i).length>0?(n(),a("div",Le,[s("div",Ve,[s("div",He,[s("div",je,[t[6]||(t[6]=s("i",{class:"fa-solid fa-bell text-gray-400 text-sm"},null,-1)),t[7]||(t[7]=s("h2",{class:"font-bold text-slate-800 text-sm"},"Notifications",-1)),c(o)>0?(n(),a("span",Be,p(c(o)),1)):x("",!0)]),c(o)>5?(n(),a("button",{key:0,onClick:t[0]||(t[0]=u=>e.$router.push("/tasks")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all → ")):x("",!0)])]),s("div",Ee,[(n(!0),a(V,null,H(c(i).slice(0,5),u=>(n(),F(K,{key:u.id,question:u,onAnswerYes:S,onAnswerNo:O,onReassign:N,onViewTask:m,onDismiss:l},null,8,["question"]))),128))])])):x("",!0),s("div",Qe,[s("div",Re,[s("div",Me,[s("div",Fe,[t[8]||(t[8]=s("i",{class:"fa-solid fa-calendar text-gray-400 text-sm"},null,-1)),t[9]||(t[9]=s("h2",{class:"font-bold text-slate-800 text-sm"},"Appointments Today",-1)),c(r).length>0?(n(),a("span",ze,p(c(r).length),1)):x("",!0)]),s("button",{onClick:t[1]||(t[1]=u=>e.$router.push("/calendar")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View calendar → ")])]),s("div",Ye,[A(ye,{appointments:c(r)},null,8,["appointments"])])]),s("div",We,[s("div",Ge,[s("div",Je,[s("div",Ke,[t[10]||(t[10]=s("i",{class:"fa-solid fa-tasks text-gray-400 text-sm"},null,-1)),t[11]||(t[11]=s("h2",{class:"font-bold text-slate-800 text-sm"},"Tasks Due Today",-1)),c(f).length>0?(n(),a("span",Pe,p(c(f).length),1)):x("",!0)]),s("button",{onClick:t[2]||(t[2]=u=>e.$router.push("/tasks")),class:"text-xs font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])]),s("div",Xe,[A(Ie,{tasks:c(f)},null,8,["tasks"])])])])),c(i).length===0&&c(r).length===0&&c(f).length===0?(n(),a("div",Ze,[t[12]||(t[12]=s("i",{class:"fa-solid fa-check-circle text-6xl text-emerald-400 mb-4"},null,-1)),t[13]||(t[13]=s("h3",{class:"text-xl font-semibold text-slate-800 mb-2"},"All caught up!",-1)),t[14]||(t[14]=s("p",{class:"text-sm text-gray-600 mb-6"},"No appointments or tasks scheduled for today.",-1)),s("button",{onClick:t[3]||(t[3]=u=>e.$router.push("/tasks")),class:"px-4 py-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"}," View all tasks → ")])):x("",!0)]),A(P,{show:D.value,onClose:t[4]||(t[4]=u=>D.value=!1),onConfirm:d},null,8,["show"])]))}};export{at as default};
