import{a8 as L,c as A,r as T,l as O,m as J,J as Z,p as n,d as r,o as u,e as l,g,Z as R,K as c,F as X,i as _,t as m,k as q,y as h,j as F,v as M,n as B,s as j,a9 as N,w as ee}from"./index-DmX4Eg8G.js";import{u as le}from"./opportunities-XVgMwMKa.js";function te({contactMode:x,selectedContact:D,contactFormData:y}){const d=L({name:"",email:""}),U=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),E=A(()=>x.value==="existing"?!!D.value:!!(y.name&&y.email));return{errors:d,canSubmit:E,validateEmail:U,validateContactForm:()=>{if(d.name="",d.email="",x.value==="new"){let i=!0;return y.name.trim()||(d.name="Contact name is required",i=!1),y.email.trim()?U(y.email)||(d.email="Please enter a valid email address",i=!1):(d.email="Email is required",i=!1),i}else return!!D.value},clearErrors:()=>{d.name="",d.email=""}}}function se({contactMode:x,selectedContact:D,contactFormData:y,vehicleFormData:d,markAsLead:U,markAsOpportunity:E,validateContactForm:b,onSubmit:v}){const i=T(!1),o=f=>Object.entries(f).reduce((S,[w,C])=>{if(C!==null&&C!==""&&C!==void 0){if(w==="year"&&C===new Date().getFullYear())return S;S[w]=C}return S},{}),p=()=>x.value==="new"?{name:y.name.trim(),email:y.email.trim(),phone:y.phone.trim(),company:y.company.trim()}:null,s=()=>{if(!b())return;i.value=!0;const f=o(d),S=p(),w={contactMode:x.value,selectedContact:D.value,contactData:S,vehicleData:Object.keys(f).length>0?f:null,markAsLead:U.value,markAsOpportunity:E.value};v&&v(w)},k=()=>{i.value=!1};return{isSubmitting:A(()=>i.value),handleSubmit:s,resetSubmitting:k}}const ae={class:"bg-surface border border-E5E7EB rounded-lg p-6 mb-6"},oe={key:0},ne={class:"flex gap-6 mb-6"},ie={class:"flex items-center gap-2 cursor-pointer"},re={class:"flex items-center gap-2 cursor-pointer"},ue={key:0,class:"space-y-4"},de={class:"relative"},pe={class:"relative"},me={key:0,class:"absolute z-50 w-full mt-2 bg-surface border border-E5E7EB rounded-lg shadow-lg max-h-80 overflow-y-auto"},be=["onClick"],ve={class:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold shrink-0"},ce={class:"flex-1 min-w-0"},ye={class:"font-semibold text-gray-800 truncate"},fe={class:"text-meta truncate"},ge={key:0,class:"text-xs text-gray-400 truncate"},xe={key:1,class:"absolute z-50 w-full mt-2 bg-surface border border-E5E7EB rounded-lg shadow-lg p-4"},ke={class:"text-center text-gray-500"},we={class:"text-sm"},Ee={key:0,class:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4"},Se={class:"flex items-center justify-between"},Ve={class:"flex items-center gap-3"},Ce={class:"w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold"},Te={class:"font-bold text-gray-800"},De={class:"text-content text-gray-600"},Ue={key:0,class:"text-xs text-gray-500"},he={key:1,class:"space-y-4"},qe=["required"],Me={key:0,class:"text-red-500 text-xs mt-1"},Be=["required"],Ae={key:0,class:"text-red-500 text-xs mt-1"},Pe={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-4"},Fe={class:"flex items-center gap-3"},Le={class:"w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold"},Oe={class:"font-bold text-gray-800"},Re={class:"text-sm text-gray-600"},je={key:0,class:"text-xs text-gray-500"},Ne={class:"bg-surface border border-E5E7EB rounded-lg p-6 mb-6"},Ie={class:"mb-6"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ye=["max"],He={class:"md:col-span-2"},ze={class:"mb-6"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-6 mb-6"},Ge={key:0,class:"space-y-3"},Je={key:1,class:"p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-3"},Ze={class:"text-sm font-medium text-blue-900"},Xe={key:2,class:"mt-3 flex items-start gap-2 text-xs text-orange-600 bg-orange-50 border border-orange-200 rounded-lg p-3"},_e={key:3,class:"text-xs text-gray-500 mt-3 italic"},al={__name:"UnifiedAddForm",props:{initialContact:{type:Object,default:null},hideContactSelection:{type:Boolean,default:!1},forceType:{type:String,default:""}},emits:["submit"],setup(x,{expose:D,emit:y}){const d=x,U=y,E=le(),b=T(d.initialContact?"existing":"new"),v=T(""),i=T(!1),o=T(d.initialContact||null),p=L({name:"",email:"",phone:"",company:""}),s=L({brand:"",model:"",year:new Date().getFullYear(),price:null,requestMessage:"",requestType:"",source:"",dealership:"",channel:"Email",fuelType:"",gearType:"",kilometers:null,stockDays:null}),k=T(d.forceType==="lead"),f=T(d.forceType==="opportunity");O(()=>d.forceType,a=>{a==="lead"?(k.value=!0,f.value=!1):a==="opportunity"&&(k.value=!1,f.value=!0)}),O(()=>d.initialContact,a=>{a&&(o.value=a,v.value=a.name,b.value="existing")},{immediate:!0});let S=null;const{errors:w,canSubmit:C,validateContactForm:I,clearErrors:W}=te({contactMode:b,selectedContact:o,contactFormData:p});J(()=>{E.customers.length===0&&E.fetchCustomers()});const P=A(()=>{if(!v.value.trim())return E.customers.slice(0,10);const a=v.value.toLowerCase();return E.customers.filter(e=>e.name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)||e.company&&e.company.toLowerCase().includes(a)).slice(0,10)}),V=A(()=>!!(s.brand||s.model||s.year!==new Date().getFullYear()||s.price||s.requestMessage||s.requestType||s.source||s.dealership||s.fuelType||s.gearType||s.kilometers||s.stockDays)),{isSubmitting:Y,handleSubmit:H,resetSubmitting:z}=se({contactMode:b,selectedContact:o,contactFormData:p,vehicleFormData:s,markAsLead:k,markAsOpportunity:f,validateContactForm:I,onSubmit:a=>{U("submit",a)}}),Q=()=>{clearTimeout(S),S=setTimeout(()=>{i.value=!0},300)},$=a=>{o.value=a,v.value=a.name,i.value=!1},K=()=>{o.value=null,v.value="",i.value=!1};return D({resetSubmitting:z,submit:H,clear:()=>{b.value="new",o.value=null,v.value="",i.value=!1,p.name="",p.email="",p.phone="",p.company="",Object.keys(s).forEach(a=>{a==="year"?s[a]=new Date().getFullYear():a==="channel"?s[a]="Email":typeof s[a]=="number"?s[a]=null:s[a]=""}),k.value=!1,f.value=!1,W()},canSubmit:C,isSubmitting:Y}),(a,e)=>{const G=Z("click-outside");return n((u(),r("form",{onSubmit:e[23]||(e[23]=ee((...t)=>a.handleSubmit&&a.handleSubmit(...t),["prevent"])),class:"max-w-4xl mx-auto"},[l("div",ae,[e[36]||(e[36]=l("h3",{class:"font-bold text-gray-800 mb-4"},"Contact Information",-1)),x.hideContactSelection?o.value?(u(),r("div",Pe,[l("div",Fe,[l("div",Le,m(o.value.initials),1),l("div",null,[l("div",Oe,m(o.value.name),1),l("div",Re,m(o.value.email),1),o.value.company?(u(),r("div",je,m(o.value.company),1)):g("",!0)])])])):g("",!0):(u(),r("div",oe,[l("div",ne,[l("label",ie,[n(l("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),value:"new",class:"w-4 h-4 text-blue-600"},null,512),[[R,b.value]]),e[24]||(e[24]=l("span",{class:"text-sm font-medium text-body"},"New Contact",-1))]),l("label",re,[n(l("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),value:"existing",class:"w-4 h-4 text-blue-600"},null,512),[[R,b.value]]),e[25]||(e[25]=l("span",{class:"text-sm font-medium text-body"},"Existing Contact",-1))])]),b.value==="existing"?(u(),r("div",ue,[l("div",de,[e[29]||(e[29]=l("label",{class:"block label-upper mb-2"},"Search Contact",-1)),l("div",pe,[e[26]||(e[26]=l("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),n(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),onInput:Q,onFocus:e[3]||(e[3]=t=>i.value=!0),type:"text",placeholder:"Search by name, email, or company...",class:"input pl-10"},null,544),[[c,v.value]])]),i.value&&P.value.length>0?(u(),r("div",me,[(u(!0),r(X,null,_(P.value,t=>(u(),r("div",{key:t.id,onClick:ll=>$(t),class:"flex items-center gap-3 p-4 hover:bg-surfaceSecondary cursor-pointer transition-colors border-b border last:border-b-0"},[l("div",ve,m(t.initials),1),l("div",ce,[l("div",ye,m(t.name),1),l("div",fe,m(t.email),1),t.company?(u(),r("div",ge,m(t.company),1)):g("",!0)]),e[27]||(e[27]=l("i",{class:"fa-solid fa-chevron-right text-gray-400 text-sm"},null,-1))],8,be))),128))])):g("",!0),i.value&&v.value&&P.value.length===0?(u(),r("div",xe,[l("div",ke,[e[28]||(e[28]=l("i",{class:"fa-solid fa-search text-2xl mb-2"},null,-1)),l("p",we,'No contacts found matching "'+m(v.value)+'"',1)])])):g("",!0)]),o.value?(u(),r("div",Ee,[l("div",Se,[l("div",Ve,[l("div",Ce,m(o.value.initials),1),l("div",null,[l("div",Te,m(o.value.name),1),l("div",De,m(o.value.email),1),o.value.company?(u(),r("div",Ue,m(o.value.company),1)):g("",!0)])]),l("button",{type:"button",onClick:K,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...e[30]||(e[30]=[l("i",{class:"fa-solid fa-xmark text-xl"},null,-1)])])])])):g("",!0)])):(u(),r("div",he,[l("div",null,[e[31]||(e[31]=l("label",{class:"block label-upper mb-2"},[q(" Contact Name "),l("span",{class:"text-red-500"},"*")],-1)),n(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>p.name=t),type:"text",placeholder:"Enter contact name...",class:"input",required:b.value==="new"},null,8,qe),[[c,p.name]]),h(w).name?(u(),r("p",Me,m(h(w).name),1)):g("",!0)]),l("div",null,[e[32]||(e[32]=l("label",{class:"block label-upper mb-2"},[q(" Email "),l("span",{class:"text-red-500"},"*")],-1)),n(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>p.email=t),type:"email",placeholder:"contact@example.com",class:"input",required:b.value==="new"},null,8,Be),[[c,p.email]]),h(w).email?(u(),r("p",Ae,m(h(w).email),1)):g("",!0)]),l("div",null,[e[33]||(e[33]=l("label",{class:"block label-upper mb-2"},"Phone",-1)),n(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>p.phone=t),type:"tel",placeholder:"+49...",class:"input"},null,512),[[c,p.phone]])]),l("div",null,[e[34]||(e[34]=l("label",{class:"block label-upper mb-2"},"Company (optional)",-1)),n(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>p.company=t),type:"text",placeholder:"Company name...",class:"input"},null,512),[[c,p.company]]),e[35]||(e[35]=l("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty for individual contacts",-1))])]))]))]),l("div",Ne,[e[59]||(e[59]=l("h3",{class:"font-bold text-gray-800 mb-4"},[q(" Vehicle Details "),l("span",{class:"text-meta font-normal"},"(Optional)")],-1)),l("div",Ie,[e[42]||(e[42]=l("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Basic Information",-1)),l("div",We,[l("div",null,[e[37]||(e[37]=l("label",{class:"block label-upper mb-2"},"Brand",-1)),n(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>s.brand=t),type:"text",placeholder:"e.g., Volkswagen",class:"input"},null,512),[[c,s.brand]])]),l("div",null,[e[38]||(e[38]=l("label",{class:"block label-upper mb-2"},"Model",-1)),n(l("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>s.model=t),type:"text",placeholder:"e.g., ID.4",class:"input"},null,512),[[c,s.model]])]),l("div",null,[e[39]||(e[39]=l("label",{class:"block label-upper mb-2"},"Year",-1)),n(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>s.year=t),type:"number",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"input"},null,8,Ye),[[c,s.year]])]),l("div",null,[e[40]||(e[40]=l("label",{class:"block label-upper mb-2"},"Price",-1)),n(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>s.price=t),type:"number",min:"0",placeholder:"e.g., 45000",class:"input"},null,512),[[c,s.price]])]),l("div",He,[e[41]||(e[41]=l("label",{class:"block label-upper mb-2"},"Request Message",-1)),n(l("textarea",{"onUpdate:modelValue":e[12]||(e[12]=t=>s.requestMessage=t),rows:"3",placeholder:"Customer's message or notes...",class:"input resize-none"},null,512),[[c,s.requestMessage]])])])]),l("div",ze,[e[50]||(e[50]=l("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Request Details",-1)),l("div",Qe,[l("div",null,[e[44]||(e[44]=l("label",{class:"block label-upper mb-2"},"Request Type",-1)),n(l("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>s.requestType=t),class:"input"},[...e[43]||(e[43]=[F('<option value="">Select type</option><option value="Quotation">Quotation</option><option value="Test Drive">Test Drive</option><option value="Information">Information</option><option value="Purchase">Purchase</option>',5)])],512),[[M,s.requestType]])]),l("div",null,[e[46]||(e[46]=l("label",{class:"block label-upper mb-2"},"Source",-1)),n(l("select",{"onUpdate:modelValue":e[14]||(e[14]=t=>s.source=t),class:"input"},[...e[45]||(e[45]=[F('<option value="">Select source</option><option value="Marketing">Marketing</option><option value="Website">Website</option><option value="Phone">Phone</option><option value="Walk-in">Walk-in</option><option value="Referral">Referral</option>',6)])],512),[[M,s.source]])]),l("div",null,[e[47]||(e[47]=l("label",{class:"block label-upper mb-2"},"Dealership",-1)),n(l("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>s.dealership=t),type:"text",placeholder:"e.g., Berlin Mitte",class:"input"},null,512),[[c,s.dealership]])]),l("div",null,[e[49]||(e[49]=l("label",{class:"block label-upper mb-2"},"Channel",-1)),n(l("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>s.channel=t),class:"input"},[...e[48]||(e[48]=[l("option",{value:"Email"},"Email",-1),l("option",{value:"Phone"},"Phone",-1),l("option",{value:"WhatsApp"},"WhatsApp",-1),l("option",{value:"SMS"},"SMS",-1)])],512),[[M,s.channel]])])])]),l("div",null,[e[58]||(e[58]=l("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"Vehicle Details",-1)),l("div",$e,[l("div",null,[e[52]||(e[52]=l("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),n(l("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>s.fuelType=t),class:"input"},[...e[51]||(e[51]=[F('<option value="">Select fuel type</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[M,s.fuelType]])]),l("div",null,[e[54]||(e[54]=l("label",{class:"block label-upper mb-2"},"Gear Type",-1)),n(l("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>s.gearType=t),class:"input"},[...e[53]||(e[53]=[l("option",{value:""},"Select gear type",-1),l("option",{value:"Manual"},"Manual",-1),l("option",{value:"Automatic"},"Automatic",-1),l("option",{value:"Semi-Automatic"},"Semi-Automatic",-1)])],512),[[M,s.gearType]])]),l("div",null,[e[55]||(e[55]=l("label",{class:"block label-upper mb-2"},"Kilometers",-1)),n(l("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>s.kilometers=t),type:"number",min:"0",placeholder:"e.g., 50000",class:"input"},null,512),[[c,s.kilometers]])]),l("div",null,[e[56]||(e[56]=l("label",{class:"block label-upper mb-2"},"Stock Days",-1)),n(l("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>s.stockDays=t),type:"number",min:"0",placeholder:"Days in stock",class:"input"},null,512),[[c,s.stockDays]]),e[57]||(e[57]=l("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty if out of stock",-1))])])])]),l("div",Ke,[e[66]||(e[66]=l("h3",{class:"font-bold text-gray-800 mb-4"},"Create Task (Optional)",-1)),e[67]||(e[67]=l("p",{class:"text-meta mb-4"},[q(" Convert this contact to a lead or opportunity. "),l("span",{class:"font-semibold"},"Requires vehicle details to be filled.")],-1)),x.forceType?(u(),r("div",Je,[e[63]||(e[63]=l("i",{class:"fa-solid fa-info-circle text-blue-600"},null,-1)),l("div",null,[l("p",Ze," Converting to "+m(x.forceType==="lead"?"Lead":"Opportunity"),1),e[62]||(e[62]=l("p",{class:"text-xs text-blue-700"},"Vehicle details are required for this action.",-1))])])):(u(),r("div",Ge,[l("div",{class:B(["flex items-center gap-3 p-3 bg-surface border border-E5E7EB rounded-lg transition-all",V.value?"cursor-pointer hover:bg-blue-50 hover:border-blue-300":"cursor-not-allowed opacity-60"])},[j(h(N),{modelValue:k.value,"onUpdate:modelValue":e[21]||(e[21]=t=>k.value=t),disabled:!V.value,label:""},null,8,["modelValue","disabled"]),l("div",null,[l("span",{class:B(["font-medium",V.value?"text-gray-800":"text-gray-400"])}," Mark as Lead ",2),e[60]||(e[60]=l("p",{class:"text-xs text-gray-500"},"Create a new lead task with vehicle details",-1))])],2),l("div",{class:B(["flex items-center gap-3 p-3 bg-surface border border-E5E7EB rounded-lg transition-all",V.value?"cursor-pointer hover:bg-purple-50 hover:border-purple-300":"cursor-not-allowed opacity-60"])},[j(h(N),{modelValue:f.value,"onUpdate:modelValue":e[22]||(e[22]=t=>f.value=t),disabled:!V.value,label:""},null,8,["modelValue","disabled"]),l("div",null,[l("span",{class:B(["font-medium",V.value?"text-gray-800":"text-gray-400"])}," Mark as Opportunity ",2),e[61]||(e[61]=l("p",{class:"text-xs text-gray-500"},"Create a new opportunity task with vehicle details",-1))])],2)])),V.value?g("",!0):(u(),r("div",Xe,[...e[64]||(e[64]=[l("i",{class:"fa-solid fa-exclamation-triangle mt-0.5"},null,-1),l("span",null,"Fill in vehicle details above to enable lead/opportunity creation",-1)])])),!k.value&&!f.value&&V.value?(u(),r("p",_e,[...e[65]||(e[65]=[l("i",{class:"fa-solid fa-info-circle mr-1"},null,-1),q(" If neither is selected, only the contact and vehicle information will be saved ",-1)])])):g("",!0)])],32)),[[G,()=>i.value=!1]])}}};export{al as _};
