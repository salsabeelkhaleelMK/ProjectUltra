import{h as W,d as n,o as r,e as t,g as v,t as u,w as G,k as N,F as A,i as O,n as S,_ as ae,r as h,s as T,c as _,x as D,D as V,y as re,C as oe,X as le,m as ne,l as ie,E as X}from"./index-4t0q-YoU.js";import{u as de}from"./opportunities-DBOjrln3.js";import{u as ce,f as ue,a as pe,b as me,c as fe}from"./customers-DNroEOnp.js";import{g as ge,e as ye,f as be}from"./ComingSoonModal-BiUL9UwQ.js";import{Q as ve}from"./index-B_XAiWWB.js";import{_ as xe}from"./ModalShell-CCJo1Yaq.js";import{_ as he}from"./UnifiedAddForm-lag-MeuZ.js";import"./settings-Buo-UMP2.js";import"./ReassignUserModal-C2VIE97n.js";import"./users-B2Q7ljfB.js";import"./CreateEventModal-BR-2QR2U.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-Dd2SCa0l.js";import"./index-Ct-3v9pQ-BMtYOyzV.js";const ke={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6"},we={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},_e={class:"flex items-center gap-2"},Ce={key:0,class:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded"},$e={key:0,class:"p-6 text-center text-gray-400"},Te={key:1,class:"p-4 space-y-3"},Ae=["onClick"],Oe={class:"flex items-center justify-between mb-2"},Se={class:"flex-1 min-w-0"},Fe={class:"flex items-center gap-2 mb-1"},Le={class:"font-semibold text-slate-800 text-sm"},Be={class:"flex items-center gap-3 text-xs text-gray-500"},Ie={key:0},De={key:1},Ne={key:0,class:"mt-2 space-y-2 border-t border-gray-200 pt-2"},qe={class:"flex items-center gap-2"},Ee={class:"text-xs text-slate-700 font-medium"},Me={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(p,{emit:x}){const m=p,d=W(),l=s=>{if(!s)return 0;const e=new Date(s),i=Math.abs(new Date-e);return Math.ceil(i/(1e3*60*60*24))},f=s=>{const e=[];return m.allTasks&&m.allTasks.length>0&&m.allTasks.filter(i=>i.leadId===s.id).forEach(i=>{e.push({id:i.id,type:i.title||"Task",description:i.description||i.title})}),s.stage==="Open Lead"&&l(s.createdAt)>=0&&e.push({id:`lead-${s.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),e},b=s=>({LQ:"bg-orange-100 text-orange-700 border border-orange-200"})[s]||"bg-gray-100 text-gray-700 border border-gray-200",k=s=>({"Open Lead":"bg-orange-100 text-orange-700 border border-orange-200",Validated:"bg-blue-100 text-blue-700 border border-blue-200",Contacted:"bg-blue-100 text-blue-700 border border-blue-200"})[s]||"bg-gray-100 text-gray-700 border border-gray-200",g=s=>{const e=d.resolve({path:`/tasks/${s.id}`,query:{type:"lead"}});window.open(e.href,"_blank")};return(s,e)=>(r(),n("div",ke,[t("div",we,[t("div",_e,[e[1]||(e[1]=t("i",{class:"fa-solid fa-user-circle text-gray-400 text-xs"},null,-1)),e[2]||(e[2]=t("h3",{class:"font-bold text-slate-800 text-sm"},"Leads",-1)),p.leads.length>0?(r(),n("span",Ce,u(p.leads.length),1)):v("",!0)]),t("button",{onClick:e[0]||(e[0]=G(a=>s.$emit("add-lead"),["stop"])),class:"text-xs font-bold text-blue-600 hover:text-blue-700 flex items-center gap-1 transition-colors"},[...e[3]||(e[3]=[t("i",{class:"fa-solid fa-plus-circle"},null,-1),N(" Add Lead ",-1)])])]),p.leads.length===0?(r(),n("div",$e,[...e[4]||(e[4]=[t("i",{class:"fa-solid fa-inbox text-2xl mb-2"},null,-1),t("p",{class:"text-sm"},"No leads associated with this customer",-1)])])):(r(),n("div",Te,[(r(!0),n(A,null,O(p.leads,a=>(r(),n("div",{key:a.id,class:"flex flex-col p-3 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg cursor-pointer transition-colors",onClick:i=>g(a)},[t("div",Oe,[t("div",Se,[t("div",Fe,[t("span",Le,"Lead #"+u(a.id),1),t("span",{class:S(["text-xs px-2 py-0.5 rounded-full font-medium",k(a.stage)])},u(a.stage),3)]),t("div",Be,[a.assignee?(r(),n("span",Ie,u(a.assignee),1)):v("",!0),a.requestedCar?(r(),n("span",De,u(a.requestedCar.brand)+" "+u(a.requestedCar.model),1)):v("",!0)])]),e[5]||(e[5]=t("i",{class:"fa-solid fa-external-link text-gray-400 text-xs ml-2"},null,-1))]),f(a).length>0?(r(),n("div",Ne,[(r(!0),n(A,null,O(f(a),i=>(r(),n("div",{key:i.id,class:"flex items-center justify-between p-2 bg-white border border-gray-100 rounded-md shadow-sm"},[t("div",qe,[t("span",{class:S(["text-[10px] px-1.5 py-0.5 rounded-full font-bold uppercase tracking-wider",b(i.type)])},u(i.type),3),t("span",Ee,u(i.description),1)]),e[6]||(e[6]=t("i",{class:"fa-solid fa-chevron-right text-[10px] text-gray-300"},null,-1))]))),128))])):v("",!0)],8,Ae))),128))]))]))}},Re={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6"},je={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},Ue={class:"flex items-center gap-2"},Ve={key:0,class:"text-xs font-bold bg-purple-100 text-purple-700 px-2 py-0.5 rounded"},We={key:0,class:"p-6 text-center text-gray-400"},Qe={key:1,class:"p-4 space-y-3"},ze=["onClick"],Pe={class:"flex items-center justify-between mb-2"},Xe={class:"flex-1 min-w-0"},Ge={class:"flex items-center gap-2 mb-1"},He={class:"font-semibold text-slate-800 text-sm"},Je={class:"flex items-center gap-3 text-xs text-gray-500"},Ke={key:0},Ye={key:1},Ze={key:2},et={key:0,class:"mt-2 space-y-2 border-t border-gray-200 pt-2"},tt={class:"flex items-center gap-2"},st={class:"text-xs text-slate-700 font-medium"},at={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(p,{emit:x}){const m=p,d=W(),l=s=>{const e=[];m.allTasks&&m.allTasks.length>0&&m.allTasks.filter($=>$.opportunityId===s.id).forEach($=>{e.push({id:$.id,type:$.title||"Task",description:$.description||$.title})});const a=m.activities.filter(y=>y.opportunityId===s.id),i={opportunity:s,scheduledAppointment:s.scheduledAppointment||null,activities:a,hasOffers:a.some(y=>y.type==="offer")||!1,stage:s.displayStage||s.stage,deliverySubstatus:s.deliverySubstatus||null},C=ge(i.stage,i);if(C){const y={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};e.push({id:`opp-${s.id}-${C}`,type:C,description:y[C]||C})}return e},f=s=>({OOFB:"bg-blue-100 text-blue-700 border border-blue-200",UFB:"bg-purple-100 text-purple-700 border border-purple-200",NFU:"bg-red-100 text-red-700 border border-red-200",OFB:"bg-yellow-100 text-yellow-700 border border-yellow-200",CFB:"bg-green-100 text-green-700 border border-green-200",DFB:"bg-teal-100 text-teal-700 border border-teal-200",NS:"bg-pink-100 text-pink-700 border border-pink-200"})[s]||"bg-gray-100 text-gray-700 border border-gray-200",b=s=>new Intl.NumberFormat("en-US").format(s),k=s=>({Qualified:"bg-purple-100 text-purple-700 border border-purple-200","In Negotiation":"bg-blue-100 text-blue-700 border border-blue-200","Closed Won":"bg-green-100 text-green-700 border border-green-200","Closed Lost":"bg-red-100 text-red-700 border border-red-200"})[s]||"bg-gray-100 text-gray-700 border border-gray-200",g=s=>{const e=d.resolve({path:`/tasks/${s.id}`,query:{type:"opportunity"}});window.open(e.href,"_blank")};return(s,e)=>(r(),n("div",Re,[t("div",je,[t("div",Ue,[e[1]||(e[1]=t("i",{class:"fa-solid fa-briefcase text-gray-400 text-xs"},null,-1)),e[2]||(e[2]=t("h3",{class:"font-bold text-slate-800 text-sm"},"Opportunities",-1)),p.opportunities.length>0?(r(),n("span",Ve,u(p.opportunities.length),1)):v("",!0)]),t("button",{onClick:e[0]||(e[0]=G(a=>s.$emit("add-opportunity"),["stop"])),class:"text-xs font-bold text-purple-600 hover:text-purple-700 flex items-center gap-1 transition-colors"},[...e[3]||(e[3]=[t("i",{class:"fa-solid fa-plus-circle"},null,-1),N(" Add Opportunity ",-1)])])]),p.opportunities.length===0?(r(),n("div",We,[...e[4]||(e[4]=[t("i",{class:"fa-solid fa-inbox text-2xl mb-2"},null,-1),t("p",{class:"text-sm"},"No opportunities associated with this customer",-1)])])):(r(),n("div",Qe,[(r(!0),n(A,null,O(p.opportunities,a=>(r(),n("div",{key:a.id,class:"flex flex-col p-3 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg cursor-pointer transition-colors",onClick:i=>g(a)},[t("div",Pe,[t("div",Xe,[t("div",Ge,[t("span",He,"Opportunity #"+u(a.id),1),t("span",{class:S(["text-xs px-2 py-0.5 rounded-full font-medium",k(a.stage)])},u(a.displayStage||a.stage),3)]),t("div",Je,[a.assignee?(r(),n("span",Ke,u(a.assignee),1)):v("",!0),a.value?(r(),n("span",Ye,"€ "+u(b(a.value)),1)):v("",!0),a.vehicle?(r(),n("span",Ze,u(a.vehicle.brand)+" "+u(a.vehicle.model),1)):v("",!0)])]),e[5]||(e[5]=t("i",{class:"fa-solid fa-external-link text-gray-400 text-xs ml-2"},null,-1))]),l(a).length>0?(r(),n("div",et,[(r(!0),n(A,null,O(l(a),i=>(r(),n("div",{key:i.id,class:"flex items-center justify-between p-2 bg-white border border-gray-100 rounded-md shadow-sm"},[t("div",tt,[t("span",{class:S(["text-[10px] px-1.5 py-0.5 rounded-full font-bold uppercase tracking-wider",f(i.type)])},u(i.type),3),t("span",st,u(i.description),1)]),e[6]||(e[6]=t("i",{class:"fa-solid fa-chevron-right text-[10px] text-gray-300"},null,-1))]))),128))])):v("",!0)],8,ze))),128))]))]))}},rt={key:0,class:"mb-8"},ot={class:"relative"},lt={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},nt=["onClick"],it={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},dt=["src"],ct={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},ut={class:"p-4"},pt={class:"font-bold text-gray-800 text-sm mb-1"},mt={key:0,class:"text-xs text-gray-500 mb-2"},ft={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},gt={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(p,{emit:x}){const m=x,d=h(!1),l=g=>new Intl.NumberFormat("en-US").format(g),f=g=>({requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[g]||"Car",b=g=>({requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[g]||"bg-gray-600",k=g=>{m("car-click",g),d.value=!0};return(g,s)=>p.cars.length>0?(r(),n("div",rt,[s[2]||(s[2]=t("div",{class:"flex items-center gap-2 mb-4"},[t("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),t("h3",{class:"font-bold text-gray-800 text-sm"},"Cars")],-1)),t("div",ot,[t("div",lt,[(r(!0),n(A,null,O(p.cars,(e,a)=>(r(),n("div",{key:e.id,class:"flex-none w-64 snap-start bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:i=>k(e)},[t("div",{class:S(["absolute top-2 right-2 z-10 text-white text-[10px] font-bold px-2 py-1 rounded-md shadow-sm",b(e.type)])},u(f(e.type)),3),t("div",it,[e.image?(r(),n("img",{key:0,src:e.image,alt:"Car",class:"w-full h-full object-cover"},null,8,dt)):(r(),n("i",ct))]),t("div",ut,[t("h4",pt,u(e.brand)+" "+u(e.model)+" ("+u(e.year)+")",1),e.price?(r(),n("p",mt,"€ "+u(l(e.price)),1)):v("",!0),e.stockDays!==null&&e.stockDays!==void 0?(r(),n("div",ft,[s[1]||(s[1]=t("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+u(e.stockDays)+" days) ",1)])):v("",!0)])],8,nt))),128))])]),T(ye,{show:d.value,title:"Car Details",onClose:s[0]||(s[0]=e=>d.value=!1)},null,8,["show"])])):v("",!0)}},yt=ae(gt,[["__scopeId","data-v-56310396"]]),bt={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(p,{emit:x}){const m=p,d=x,l=h(null),f=_(()=>m.type==="lead"?"Add New Lead":"Add New Opportunity"),b=_(()=>`Create a ${m.type} for ${m.contact.name}`),k=g=>{d("save",g)};return(g,s)=>(r(),D(xe,{show:p.show,title:f.value,subtitle:b.value,size:"lg",onClose:s[0]||(s[0]=e=>g.$emit("close")),onCancel:s[1]||(s[1]=e=>g.$emit("close"))},{actions:V(()=>{var e,a,i,C;return[T(re(ve),{label:(e=l.value)!=null&&e.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm",disabled:((a=l.value)==null?void 0:a.isSubmitting)||!((i=l.value)!=null&&i.canSubmit),onClick:(C=l.value)==null?void 0:C.submit},null,8,["label","disabled","onClick"])]}),default:V(()=>[T(he,{ref_key:"formRef",ref:l,"initial-contact":p.contact,"hide-contact-selection":!0,"force-type":p.type,onSubmit:k},null,8,["initial-contact","force-type"])]),_:1},8,["show","title","subtitle"]))}},vt={class:"bg-white border border-gray-200 p-6 mb-6"},xt={class:"flex items-start gap-3 mb-4"},ht={class:"flex-1"},kt={key:0,class:"text-sm text-gray-700 leading-relaxed whitespace-pre-line"},wt={key:1,class:"text-sm text-gray-500 italic"},_t={key:0,class:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-100"},Ct={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null}},setup(p){const x=p,m=_(()=>{if(x.preferences&&x.preferences.length>0)return x.preferences;const d=[],l=x.customerData;if(!l)return d;if(l.preferredVehicleType&&d.push({icon:"fa-solid fa-car",label:`Prefers ${l.preferredVehicleType}s`}),l.preferredChannel){const f={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};d.push({icon:f[l.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${l.preferredChannel}`})}return l.preferredContactTime&&d.push({icon:"fa-solid fa-clock",label:l.preferredContactTime}),l.budgetRange&&d.push({icon:"fa-solid fa-dollar-sign",label:l.budgetRange}),d});return(d,l)=>(r(),n("div",vt,[t("div",xt,[l[1]||(l[1]=t("div",{class:"flex-shrink-0 mt-1"},[t("i",{class:"fa-solid fa-lightbulb text-2xl text-amber-500"})],-1)),t("div",ht,[l[0]||(l[0]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Customer Insights",-1)),p.summary?(r(),n("p",kt,u(p.summary),1)):(r(),n("p",wt," No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior. "))])]),m.value&&m.value.length>0?(r(),n("div",_t,[(r(!0),n(A,null,O(m.value,(f,b)=>(r(),n("span",{key:b,class:"inline-flex items-center gap-1.5 px-3 py-1 bg-blue-50 text-blue-700 text-xs font-medium rounded-full"},[t("i",{class:S([f.icon,"text-xs"])},null,2),N(" "+u(f.label),1)]))),128))])):v("",!0)]))}},$t={class:"h-full flex flex-col overflow-hidden bg-white"},Tt={key:0,class:"flex-1 flex items-center justify-center"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ut={__name:"Customer",setup(p){const x=le(),m=W();oe(),de();const d=ce(),l=h(!1),f=h(null),b=h(null),k=h([]),g=h([]),s=h([]),e=h([]),a=h([]),i=_(()=>parseInt(x.params.id)),C=_(()=>"contact"),y=_(()=>{const o=b.value||d.currentCustomer;return o?{...o,id:o.id,type:"contact",customer:{id:o.id,name:o.name,email:o.email,phone:o.phone,address:o.address||"",initials:o.initials},source:o.source||"Direct",tags:o.tags||[],stage:"Contact",assignee:null,assigneeId:null}:null}),$=_(()=>null),H=_(()=>({currentActivities:_(()=>[]),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),J=_(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),Q=async(o=null)=>{const c=o||i.value;if(c)try{const w=x.query.type==="account"?"account":"contact",[B,I,E,te,se]=await Promise.all([d.loadCustomerById(c,w),ue(c),pe(c),me(c),fe(c)]);b.value=B||d.currentCustomer,k.value=I.data||[],g.value=E.data||[],s.value=te.data||[],e.value=se.data||[];const M=[];k.value.forEach(R=>{const j=X.filter(U=>U.leadId===R.id);M.push(...j)}),g.value.forEach(R=>{const j=X.filter(U=>U.opportunityId===R.id);M.push(...j)}),a.value=M}catch(w){console.error("Error loading customer data:",w)}},q=async()=>{if(!i.value){f.value="No task ID provided";return}l.value=!0,f.value=null;try{await Q()}catch(o){f.value=o.message||"Failed to load task",console.error("Error loading task:",o)}finally{l.value=!1}},K=async o=>{var c;try{const w=((c=y.value)==null?void 0:c.type)==="contact"?"contact":"account";await d.addRequestedCar(i.value,o),await q()}catch(w){console.error("Error adding car to customer:",w),f.value=w.message||"Failed to add car"}},Y=async()=>{try{l.value=!0;const o=await d.convertToLead(i.value);m.push({path:`/tasks/${o.id}`,query:{type:"lead"}})}catch(o){console.error("Error converting to lead:",o),f.value=o.message||"Failed to convert to lead",l.value=!1}},Z=async()=>{try{l.value=!0;const o=await d.convertToOpportunity(i.value);m.push({path:`/tasks/${o.id}`,query:{type:"opportunity"}})}catch(o){console.error("Error converting to opportunity:",o),f.value=o.message||"Failed to convert to opportunity",l.value=!1}},F=h(!1),L=h("lead"),z=_(()=>{if(!y.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const o=y.value;return{id:o.id,name:o.name||"Unknown",email:o.email||"",phone:o.phone||"",initials:o.initials||"?"}}),P=o=>{console.log("openAddModal called with type:",o,"task:",y.value),L.value=o,F.value=!0,console.log("showAddModal set to:",F.value,"contact:",z.value)},ee=async o=>{try{l.value=!0,F.value=!1;const c=i.value;if(!c)throw new Error("Customer ID not found");L.value==="lead"?await d.convertToLead(c):await d.convertToOpportunity(c),await Q(c),l.value=!1}catch(c){console.error(`Error adding ${L.value}:`,c),f.value=c.message||`Failed to add ${L.value}`,l.value=!1}};return ne(async()=>{await q()}),ie(()=>x.params.id,o=>{o&&q()}),(o,c)=>(r(),n("div",$t,[l.value||!y.value||y.value&&y.value.id!==i.value?(r(),n("div",Tt,[...c[3]||(c[3]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):(r(),D(be,{key:1,task:y.value,type:C.value,"management-widget":$.value,"store-adapter":H.value,"add-new-config":J.value,onCarAdded:K,onConvertToLead:Y,onConvertToOpportunity:Z},{"pinned-extra":V(({task:w})=>{var B,I;return[T(Ct,{summary:w.summary||((B=b.value)==null?void 0:B.summary),preferences:w.preferences||((I=b.value)==null?void 0:I.preferences),"customer-data":b.value},null,8,["summary","preferences","customer-data"]),e.value.length>0?(r(),D(yt,{key:0,cars:e.value},null,8,["cars"])):v("",!0),t("div",At,[T(Me,{leads:k.value,"all-tasks":s.value,onAddLead:c[0]||(c[0]=E=>P("lead"))},null,8,["leads","all-tasks"]),T(at,{opportunities:g.value,"all-tasks":s.value,activities:a.value,onAddOpportunity:c[1]||(c[1]=E=>P("opportunity"))},null,8,["opportunities","all-tasks","activities"])])]}),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])),y.value?(r(),D(bt,{key:2,show:F.value,type:L.value,contact:z.value,onClose:c[2]||(c[2]=w=>F.value=!1),onSave:ee},null,8,["show","type","contact"])):v("",!0)]))}};export{Ut as default};
