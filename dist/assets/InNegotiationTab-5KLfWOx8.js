import{y as h}from"./components-Ci9ddle2.js";import{u as B}from"./opportunities-CySWWyzd.js";import{g as T,c as M,f as $}from"./ComingSoonModal-ClD5EuQ6.js";import{u as q}from"./useCustomersTable-CD9F3w9b.js";import{r as s,c as R,m as V,d as z,o as E,s as G,B as K,e as i,y as n}from"./index-Db_3peLd.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import"./sparkles-CCfcFWX8.js";import"./vehicles-ygxbygEI.js";const L={class:"table-wrapper w-full"},Z={__name:"InNegotiationTab",emits:["row-click"],setup(W,{emit:A}){const o=B(),r=s({pageIndex:0,pageSize:10}),l=s(""),u=s([]),c=s([]),m=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",d=R(()=>o.opportunities.filter(t=>t.stage==="In Negotiation"||t.stage==="In negotiation").map(t=>{var a,f,p,y,v,b,D,k,x,F,C,w;const e=((a=t.scheduledAppointment)==null?void 0:a.start)||null;return{id:`opp-${t.id}`,stageKey:"in-negotiation",customer:((f=t.customer)==null?void 0:f.name)||"Unknown",email:((p=t.customer)==null?void 0:p.email)||"",initials:((y=t.customer)==null?void 0:y.initials)||((b=(v=t.customer)==null?void 0:v.name)==null?void 0:b.slice(0,2).toUpperCase())||"?",nextAction:$(t.expectedCloseDate)||"No due date",nextActionFull:M(t.expectedCloseDate),deadlineStatus:T(t.expectedCloseDate),car:`${((D=t.vehicle)==null?void 0:D.brand)||""} ${((k=t.vehicle)==null?void 0:k.model)||""}`.trim()||"N/A",carStatus:((x=t.vehicle)==null?void 0:x.stockDays)!==void 0&&((F=t.vehicle)==null?void 0:F.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((C=t.vehicle)==null?void 0:C.stockDays)!==void 0&&((w=t.vehicle)==null?void 0:w.stockDays)!==null?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body",requestType:t.requestType||"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:m(t.createdAt),lastAppointment:e?m(e):"N/A",status:t.stage,statusClass:"bg-orange-100 text-orange-700",priority:t.priority||"Normal"}})),N=A,g=t=>{t.id.startsWith("opp-")&&N("row-click",t)},S=s("in-negotiation"),{columns:O,filterDefinitions:U,tableMeta:I}=q(S,g);return V(async()=>{await o.fetchOpportunities()}),(t,e)=>(E(),z("div",L,[G(n(h),{data:d.value,columns:n(O),meta:n(I),onRowClick:g,columnFiltersOptions:{filterDefs:n(U)},pagination:r.value,"onUpdate:pagination":e[0]||(e[0]=a=>r.value=a),globalFilter:l.value,"onUpdate:globalFilter":e[1]||(e[1]=a=>l.value=a),sorting:u.value,"onUpdate:sorting":e[2]||(e[2]=a=>u.value=a),columnFilters:c.value,"onUpdate:columnFilters":e[3]||(e[3]=a=>c.value=a),paginationOptions:{rowCount:d.value.length},globalFilterOptions:{debounce:300}},{"empty-state":K(()=>[...e[4]||(e[4]=[i("div",{class:"empty-state"},[i("i",{class:"fa-solid fa-inbox empty-state-icon"}),i("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{Z as default};
