import{r as N,R as Ze,h as Ee,c as $,H as Fe,d as i,o as l,e,g as c,n as I,w as Z,I as je,t as u,p as M,s as C,y as v,P as We,F as P,i as Q,a4 as it,G as _e,x as W,z as De,k as L,v as Te,J as j,E as O,Q as R,m as pe,l as fe,a5 as rt,Z as dt,V as ut,X as Ye,O as K,N as ne,K as ee}from"./index-C1t3cTDZ.js";import{_ as ct}from"./ReassignUserModal-BH2sTskf.js";import{_ as mt}from"./CreateEventModal-DJUWCUS8.js";import{z as be,F as ye,L as ve,H as ge,j as xe,K as Ue,C as he,W as ke}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DZxbj_nS.js";const ft={class:"w-full bg-surface"},pt={class:"flex items-center justify-between gap-3 md:gap-4"},bt={class:"flex items-center gap-3 md:gap-4 flex-1"},yt=["aria-label"],vt={class:"min-w-0 flex-1"},gt={class:"flex items-center gap-2"},xt={class:"text-xl font-bold uppercase text-brand-dark truncate leading-tight"},ht={class:"flex flex-wrap items-center gap-2 mt-1"},kt={class:"flex items-center gap-1 ml-2"},wt={class:"relative"},$t={key:0,class:"absolute top-full right-0 mt-2 z-50"},Ct={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},St={class:"flex items-center gap-4"},At={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},Dt={class:"flex items-center gap-2"},Tt={class:"text-meta text-heading font-medium"},Ot={class:"flex items-center gap-2"},qt={class:"text-meta text-heading font-medium"},It={class:"flex items-center gap-2"},Nt={class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},Lt={key:0,class:"fa-solid fa-map-marker-alt text-sub text-xs"},Mt={key:1,class:"fa-regular fa-calendar text-sub text-xs"},Vt={class:"text-meta text-heading font-medium"},jt={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:d}){const n=t,r=d,p=N(!1),o=N(!1),y=Ze(),h=Ee(),s=$(()=>[{key:"note",label:"Note"},{key:"financing",label:"Financing"},{key:"tradein",label:"Trade-in"},{key:"purchase",label:"Purchase"},{key:"attachment",label:"Attachment"},{key:"whatsapp",label:"WhatsApp msg"},{key:"email",label:"Email"},{key:"sms",label:"SMS"},{key:"call",label:"Call"},...n.taskType==="opportunity"?[{key:"appointment",label:"Appointment"}]:[]].map(b=>({...b,onClick:()=>a(b.key)}))),a=q=>{o.value=!1,r("action",q)},m=async(q,b)=>{try{await navigator.clipboard.writeText(q),y.pushToast("success",`${b==="email"?"Email":"Phone"} copied!`)}catch{y.pushToast("error","Failed to copy")}},D=()=>{r("add-tag")},E=()=>{n.customerId&&h.push(`/customer/${n.customerId}`)};return(q,b)=>{const k=Fe("click-outside");return l(),i("div",ft,[e("div",pt,[e("div",bt,[e("button",{onClick:Z(E,["stop"]),class:I(["w-14 h-14 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...b[4]||(b[4]=[e("i",{class:"fa-solid fa-user text-xl"},null,-1)])],10,yt),e("div",vt,[e("div",gt,[e("h1",xt,u(t.name),1),je(q.$slots,"name-action")]),e("div",ht,[je(q.$slots,"tags"),e("button",{onClick:Z(D,["stop"]),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...b[5]||(b[5]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])]),e("div",kt,[e("div",wt,[e("button",{onClick:b[0]||(b[0]=Z(A=>o.value=!o.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0","aria-label":"Quick actions"},[...b[6]||(b[6]=[e("i",{class:"fa-solid fa-plus text-base text-body"},null,-1)])]),o.value?M((l(),i("div",$t,[C(v(We),{items:s.value,className:"w-48"},null,8,["items"])])),[[k,()=>o.value=!1]]):c("",!0)]),e("button",{onClick:b[1]||(b[1]=A=>p.value=!p.value),class:"w-9 h-9 flex items-center justify-center bg-surface border border rounded-lg hover:bg-surfaceSecondary shrink-0"},[e("i",{class:I(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":p.value}])},null,2)])])]),p.value?(l(),i("div",Ct,[e("div",St,[e("div",At,[e("div",Dt,[b[8]||(b[8]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-xs"})],-1)),e("span",Tt,u(t.email),1),e("button",{onClick:b[2]||(b[2]=Z(A=>m(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...b[7]||(b[7]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Ot,[b[10]||(b[10]=e("div",{class:"w-6 h-6 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-xs"})],-1)),e("span",qt,u(t.phone),1),e("button",{onClick:b[3]||(b[3]=Z(A=>m(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...b[9]||(b[9]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",It,[e("div",Nt,[t.thirdFieldLabel.toLowerCase().includes("address")?(l(),i("i",Lt)):(l(),i("i",Mt))]),e("span",Vt,u(t.thirdFieldValue),1)])])])])):c("",!0)])}}},Et={class:"flex gap-0 md:gap-8 text-content font-medium text-sub py-1"},Ft=["onClick"],Ke={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const d={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-thumbtack",manage:"fa-solid fa-gear",data:"fa-solid fa-database",notes:"fa-solid fa-note-sticky"},n=r=>d[r]||"fa-solid fa-circle";return(r,p)=>(l(),i("div",Et,[(l(!0),i(P,null,Q(t.tabs,o=>(l(),i("div",{key:o.key,onClick:y=>r.$emit("update:modelValue",o.key),class:I(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",t.modelValue===o.key?"border-brand-red text-brand-darkDarker":"border-transparent hover:text-body hover:border-slate-200"])},[e("i",{class:I([n(o.key),"text-base md:text-base",t.modelValue===o.key?"text-brand-darkDarker":"text-sub"])},null,2),e("span",{class:I(["hidden md:inline whitespace-nowrap",t.modelValue===o.key?"text-brand-darkDarker":""])},u(o.label),3)],10,Ft))),128))]))}},Wt={class:"w-full mb-6"},Ut={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Bt={class:"px-4 md:px-6 py-3 border-b border"},Rt={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},Pt={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},zt={class:"flex items-center gap-1.5"},Qt={key:1},Ht={class:"flex items-center gap-2"},Yt={key:0,class:"p-4 md:p-6"},Kt={key:0,class:"space-y-4"},Gt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Jt={class:"flex items-center gap-4"},Xt={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border"},Zt=["src"],_t={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},es={class:"font-bold text-heading text-base md:text-lg mb-2"},ts={class:"flex items-center gap-2 flex-wrap"},ss={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},as={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},ns={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border text-body text-xs font-semibold rounded-md"},ls={class:"text-xs font-bold text-heading"},os={key:0,class:"text-right"},is={class:"font-bold text-heading text-lg"},rs={key:0,class:"pt-2"},ds={class:"bg-surfaceSecondary border border rounded-lg p-3"},us={class:"text-sm text-body leading-relaxed"},cs={key:1,class:"space-y-3"},ms={key:0,class:"flex items-center gap-2"},fs={class:"text-sm font-semibold text-heading"},ps={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},bs={class:"text-sm text-body leading-relaxed"},ys={key:1,class:"border-t border"},vs={class:"font-medium"},gs={key:2,class:"border-t border p-6 bg-surfaceSecondary/30 text-sm animate-fade-in"},xs={class:"mb-6"},hs={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ks={key:0},ws={class:"font-medium text-body"},$s={key:1},Cs={class:"font-medium text-body"},Ss={key:2},As={class:"font-medium text-body"},Ds={class:"font-medium text-body"},Ts={key:0},Os={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},qs={key:0},Is={class:"font-medium text-body"},Ns={key:1},Ls={class:"font-medium text-body"},Ms={key:2},Vs={class:"font-medium text-body"},js={key:3},Es={class:"font-medium text-body"},Fs={key:4},Ws={class:"font-mono text-xs bg-surface border border px-2 py-1 rounded inline-block text-body"},Us={key:5},Bs={class:"font-medium text-body"},Rs={key:0,class:"mt-6 flex justify-end"},Ps={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const d=t,n=N(!1);$(()=>d.deliverySubstatus?it(d.deliverySubstatus):"");const r=$(()=>d.deliverySubstatus?d.deliverySubstatus==="Delivered"?"green":d.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),p=$(()=>_e(d.stage,d.entityType));function o(w){return!w||w.length===0?null:w.filter(B=>B.type==="offer").sort((B,se)=>new Date(se.timestamp)-new Date(B.timestamp))[0]||null}function y(w){if(!w)return 0;const x=new Date(w),se=Math.abs(new Date-x);return Math.ceil(se/(1e3*60*60*24))}const h=$(()=>{if(d.stage!=="In Negotiation")return null;const w=o(d.activities);if(!w)return null;const x=y(w.timestamp);return x<1?{label:"New Offer",theme:"orange"}:x<3?{label:"Active",theme:"yellow"}:null}),s=$(()=>d.requestedCar&&d.requestedCar.brand&&d.requestedCar.model),a=$(()=>d.requestType||d.requestMessage||s.value),m=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.brand)||""}),D=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.model)||""}),E=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.year)||""}),q=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.image)||""}),b=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.price)||null}),k=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.stockDays)!==void 0?d.requestedCar.stockDays:null}),A=$(()=>{var w,x;return((w=d.requestedCar)==null?void 0:w.dealership)||((x=d.task)==null?void 0:x.dealership)||""}),T=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.registration)||""}),V=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.kilometers)!==void 0?d.requestedCar.kilometers:null}),F=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.fuelType)||""}),le=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.gearType)||""}),we=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.vin)||""}),oe=$(()=>"Email"),de=$(()=>{var w,x;return((w=d.task)==null?void 0:w.sourceDetails)||((x=d.requestedCar)==null?void 0:x.adCampaign)||""}),ue=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.expectedPurchaseDate)||""}),G=$(()=>{var w;return((w=d.task)==null?void 0:w.fiscalEntity)||""}),ce=$(()=>{var w;return((w=d.task)==null?void 0:w.sourceDetails)||""}),me=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.adMedium)||""}),ie=$(()=>{var w;return((w=d.requestedCar)==null?void 0:w.adSource)||""});$(()=>!0);const Oe=$(()=>!0),J=$(()=>s.value||d.requestType||d.source||ce.value||de.value||ue.value||G.value||me.value||ie.value),z=w=>new Intl.NumberFormat("en-US").format(w),te=w=>new Intl.NumberFormat("en-US").format(w);return(w,x)=>(l(),i("div",Wt,[e("div",Ut,[e("div",Bt,[e("div",Rt,[a.value?(l(),i("div",Pt,[x[2]||(x[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),e("h3",{class:"font-bold text-heading text-sm"},"Request")],-1)),e("div",zt,[e("span",{class:I(["px-2 py-0.5 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-0.5 rounded text-xs font-medium border",p.value])},u(t.stage),3),t.deliverySubstatus?(l(),W(v(De),{key:0,text:t.deliverySubstatus,size:"small",theme:r.value},null,8,["text","theme"])):c("",!0),h.value?(l(),W(v(De),{key:1,text:h.value.label,size:"small",theme:h.value.theme},null,8,["text","theme"])):c("",!0)])])):(l(),i("div",Qt)),e("div",Ht,[x[3]||(x[3]=e("span",{class:"hidden md:inline text-xs text-sub font-medium"},"Owner",-1)),e("button",{onClick:x[0]||(x[0]=B=>w.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},u(t.owner),1)])])]),a.value?(l(),i("div",Yt,[s.value?(l(),i("div",Kt,[e("div",Gt,[e("div",Jt,[e("div",Xt,[q.value?(l(),i("img",{key:0,src:q.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Zt)):(l(),i("i",_t))]),e("div",null,[e("div",es,u(m.value)+" "+u(D.value)+" ("+u(E.value)+")",1),e("div",ts,[k.value!==void 0&&k.value!==null?(l(),i("div",ss,[x[4]||(x[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),L(" In stock ("+u(k.value)+" days) ",1)])):s.value?(l(),i("div",as,[...x[5]||(x[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),L(" Out of stock ",-1)])])):c("",!0),t.source?(l(),i("div",ns,[x[6]||(x[6]=e("span",{class:"text-xs text-sub font-medium"},"Source:",-1)),e("span",ls,u(t.source),1)])):c("",!0)])])]),b.value?(l(),i("div",os,[x[7]||(x[7]=e("div",{class:"text-xs text-sub font-medium mb-1"},"Price",-1)),e("div",is,"€ "+u(z(b.value)),1)])):c("",!0)]),t.requestMessage?(l(),i("div",rs,[x[8]||(x[8]=e("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",ds,[e("p",us,u(t.requestMessage),1)])])):c("",!0)])):(l(),i("div",cs,[t.requestType?(l(),i("div",ms,[x[9]||(x[9]=e("span",{class:"text-xs text-sub font-medium"},"Request Type:",-1)),e("span",fs,u(t.requestType),1)])):c("",!0),t.requestMessage?(l(),i("div",ps,[x[10]||(x[10]=e("div",{class:"text-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",bs,u(t.requestMessage),1)])):c("",!0)]))])):c("",!0),J.value?(l(),i("div",ys,[e("button",{onClick:x[1]||(x[1]=B=>n.value=!n.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",vs,u(n.value?"Hide":"View")+" Details",1),e("i",{class:I(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":n.value}])},null,2)])])):c("",!0),n.value&&J.value?(l(),i("div",gs,[e("div",xs,[x[21]||(x[21]=e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",hs,[t.requestType?(l(),i("div",ks,[x[11]||(x[11]=e("div",{class:"text-xs text-sub mb-1"},"Request type",-1)),e("div",ws,u(t.requestType),1)])):c("",!0),t.source?(l(),i("div",$s,[x[12]||(x[12]=e("div",{class:"text-xs text-sub mb-1"},"Source",-1)),e("div",Cs,u(t.source),1)])):c("",!0),e("div",null,[x[13]||(x[13]=e("div",{class:"text-xs text-sub mb-1"},"Source details",-1)),e("div",{class:I(["font-medium",ce.value?"text-body":"text-sub"])},u(ce.value||"--"),3)]),A.value?(l(),i("div",Ss,[x[14]||(x[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",As,u(A.value),1)])):c("",!0),e("div",null,[x[15]||(x[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",Ds,u(oe.value||"Email"),1)]),e("div",null,[x[16]||(x[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:I(["font-medium",de.value?"text-body":"text-sub"])},u(de.value||"--"),3)]),e("div",null,[x[17]||(x[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:I(["font-medium",me.value?"text-body":"text-sub"])},u(me.value||"--"),3)]),e("div",null,[x[18]||(x[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:I(["font-medium",ie.value?"text-body":"text-sub"])},u(ie.value||"--"),3)]),e("div",null,[x[19]||(x[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:I(["font-medium",ue.value?"text-body":"text-sub"])},u(ue.value||"--"),3)]),e("div",null,[x[20]||(x[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:I(["font-medium",G.value?"text-body":"text-sub"])},u(G.value||"--"),3)])])]),s.value?(l(),i("div",Ts,[x[30]||(x[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[x[29]||(x[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Os,[T.value?(l(),i("div",qs,[x[22]||(x[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Is,u(T.value),1)])):c("",!0),V.value!==void 0&&V.value!==null?(l(),i("div",Ns,[x[23]||(x[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",Ls,u(te(V.value))+" Km",1)])):c("",!0),F.value?(l(),i("div",Ms,[x[24]||(x[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",Vs,u(F.value),1)])):c("",!0),le.value?(l(),i("div",js,[x[25]||(x[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Es,u(le.value),1)])):c("",!0),we.value?(l(),i("div",Fs,[x[26]||(x[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Ws,u(we.value),1)])):c("",!0),A.value?(l(),i("div",Us,[x[27]||(x[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Bs,u(A.value),1)])):c("",!0)]),Oe.value?(l(),i("div",Rs,[...x[28]||(x[28]=[e("button",{class:"bg-surface border border text-body hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-sub group-hover:text-blue-500"}),L(" View technical specs ")],-1)])])):c("",!0)])])):c("",!0)])):c("",!0)])]))}},zs={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden h-full"},Qs={class:"p-6"},Hs={class:"flex items-center justify-between mb-4"},Ys={class:"flex items-center gap-2"},Ks={class:"flex items-center gap-2 flex-wrap mb-4"},Gs={key:0,class:"space-y-3"},Js={class:"flex items-center gap-3"},Xs={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},Zs=["src"],_s={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},ea={class:"flex-1 min-w-0"},ta={class:"font-bold text-heading text-sm mb-1"},sa={class:"flex items-center gap-2 flex-wrap"},aa={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},na={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},la={key:0,class:"text-right"},oa={class:"font-bold text-heading text-base"},ia={class:"mt-4 pt-4 space-y-2"},ra={key:0,class:"flex items-center justify-between text-xs"},da={class:"text-heading font-medium"},ua={key:1,class:"flex items-center justify-between text-xs"},ca={class:"text-heading font-medium"},ma={key:2,class:"pt-2"},fa={class:"bg-surfaceSecondary rounded-lg p-2"},pa={class:"text-xs text-body leading-relaxed line-clamp-3"},ba={__name:"RequestCard",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign"],setup(t){const d=t,n=$(()=>d.task.requestedCar&&d.task.requestedCar.brand&&d.task.requestedCar.model),r=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.brand)||""}),p=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.model)||""}),o=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.year)||""}),y=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.image)||""}),h=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.price)||null}),s=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.stockDays)!==void 0?d.task.requestedCar.stockDays:null}),a=$(()=>{var A;return((A=d.task.requestedCar)==null?void 0:A.requestMessage)||""}),m=$(()=>_e(d.task.displayStage||d.task.stage,d.entityType)),D=$(()=>d.task.deliverySubstatus?d.task.deliverySubstatus==="Delivered"?"green":d.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function E(A){return!A||A.length===0?null:A.filter(V=>V.type==="offer").sort((V,F)=>new Date(F.timestamp)-new Date(V.timestamp))[0]||null}function q(A){if(!A)return 0;const T=new Date(A),F=Math.abs(new Date-T);return Math.ceil(F/(1e3*60*60*24))}const b=$(()=>{if((d.task.displayStage||d.task.stage)!=="In Negotiation")return null;const A=E(d.activities);if(!A)return null;const T=q(A.timestamp);return T<1?{label:"New Offer",theme:"orange"}:T<3?{label:"Active",theme:"yellow"}:null}),k=A=>new Intl.NumberFormat("en-US").format(A);return(A,T)=>{var V,F;return l(),i("div",zs,[e("div",Qs,[e("div",Hs,[T[2]||(T[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Request")],-1)),e("div",Ys,[T[1]||(T[1]=e("span",{class:"text-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:T[0]||(T[0]=le=>A.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},u(t.task.assignee),1)])]),e("div",Ks,[e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},u(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:I(["px-2 py-1 rounded text-xs font-medium border",m.value])},u(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(l(),W(v(De),{key:0,text:t.task.deliverySubstatus,size:"small",theme:D.value},null,8,["text","theme"])):c("",!0),b.value?(l(),W(v(De),{key:1,text:b.value.label,size:"small",theme:b.value.theme},null,8,["text","theme"])):c("",!0)]),n.value?(l(),i("div",Gs,[e("div",Js,[e("div",Xs,[y.value?(l(),i("img",{key:0,src:y.value,alt:"Car",class:"w-full h-full object-cover"},null,8,Zs)):(l(),i("i",_s))]),e("div",ea,[e("div",ta,u(r.value)+" "+u(p.value)+" ("+u(o.value)+")",1),e("div",sa,[s.value!==void 0&&s.value!==null?(l(),i("div",aa,[T[3]||(T[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),L(" In stock ("+u(s.value)+" days) ",1)])):(l(),i("div",na,[...T[4]||(T[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),L(" Out of stock ",-1)])]))])]),h.value?(l(),i("div",la,[T[5]||(T[5]=e("div",{class:"text-xs text-sub font-medium"},"Price",-1)),e("div",oa,"€ "+u(k(h.value)),1)])):c("",!0)])])):c("",!0),e("div",ia,[t.task.source?(l(),i("div",ra,[T[6]||(T[6]=e("span",{class:"text-sub"},"Source",-1)),e("span",da,u(t.task.source),1)])):c("",!0),t.task.requestType||(V=t.task.requestedCar)!=null&&V.requestType?(l(),i("div",ua,[T[7]||(T[7]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",ca,u(t.task.requestType||((F=t.task.requestedCar)==null?void 0:F.requestType)),1)])):c("",!0),a.value?(l(),i("div",ma,[T[8]||(T[8]=e("div",{class:"text-xs text-sub mb-1"},"Message",-1)),e("div",fa,[e("p",pa,u(a.value),1)])])):c("",!0)])])])}}},ya={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden h-full"},va={class:"p-6"},ga={class:"flex items-center mb-4"},xa={class:"flex items-center gap-3 flex-1 min-w-0"},ha=["aria-label"],ka={class:"flex-1 min-w-0"},wa={class:"flex items-center gap-2"},$a={class:"text-lg font-bold uppercase text-brand-dark truncate"},Ca={class:"flex flex-wrap items-center gap-1.5 mt-1"},Sa={class:"space-y-3 pt-4"},Aa={class:"flex items-center gap-2"},Da={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},Ta={class:"flex items-center gap-2"},Oa={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},qa={class:"flex items-center gap-2"},Ia={class:"text-sm text-heading font-medium flex-1 min-w-0 truncate"},Na={__name:"ContactInfoCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},emits:["action","add-tag"],setup(t,{emit:d}){const n=t,r=Ze(),p=Ee(),o=async(s,a)=>{try{await navigator.clipboard.writeText(s),r.pushToast("success",`${a==="email"?"Email":"Phone"} copied!`)}catch{r.pushToast("error","Failed to copy")}},y=()=>{n.customerId&&p.push(`/customer/${n.customerId}`)},h=()=>{n.customerId&&p.push(`/customer/${n.customerId}`)};return(s,a)=>{var m,D,E,q;return l(),i("div",ya,[e("div",va,[e("div",ga,[e("div",xa,[e("button",{onClick:Z(y,["stop"]),class:I(["w-12 h-12 rounded bg-brand-darkDarker text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0",{"cursor-pointer":t.customerId}]),"aria-label":t.customerId?"Open customer profile":"Customer"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-user text-lg"},null,-1)])],10,ha),e("div",ka,[e("div",wa,[e("h3",$a,u(((m=t.task.customer)==null?void 0:m.name)||"Unknown"),1),e("button",{onClick:h,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])]),e("div",Ca,[(l(!0),i(P,null,Q(t.task.tags,b=>(l(),i("span",{key:b,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},u(b),1))),128)),e("button",{onClick:a[0]||(a[0]=Z(b=>s.$emit("add-tag"),["stop"])),class:"text-xs text-brand-red hover:text-brand-red-dark font-medium hover:underline flex items-center gap-1"},[...a[5]||(a[5]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])])])]),e("div",Sa,[e("div",Aa,[a[7]||(a[7]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-sub text-sm"})],-1)),e("span",Da,u(((D=t.task.customer)==null?void 0:D.email)||""),1),e("button",{onClick:a[1]||(a[1]=Z(b=>{var k;return o(((k=t.task.customer)==null?void 0:k.email)||"","email")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy email"},[...a[6]||(a[6]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",Ta,[a[9]||(a[9]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-sub text-sm"})],-1)),e("span",Oa,u(((E=t.task.customer)==null?void 0:E.phone)||""),1),e("button",{onClick:a[2]||(a[2]=Z(b=>{var k;return o(((k=t.task.customer)==null?void 0:k.phone)||"","phone")},["stop"])),class:"w-7 h-7 flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors shrink-0",title:"Copy phone"},[...a[8]||(a[8]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),e("div",qa,[a[10]||(a[10]=e("div",{class:"w-8 h-8 rounded bg-surfaceSecondary flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-map-marker-alt text-sub text-sm"})],-1)),e("span",Ia,u(((q=t.task.customer)==null?void 0:q.address)||""),1)])])])])}}},La={key:0,class:"flex-grow border-t border"},Ma={key:0,class:"ml-1.5 text-body"},Va={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},ja={key:1,class:"flex-grow border-t border"},Ea={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:d}){const n=t,r=d,p=N(!1),o={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},y=$(()=>{if(!n.activeTab||n.activeTab==="overview")return n.actions.filter(k=>!o[k]);const b=Object.entries(o).filter(([,k])=>k===n.activeTab).map(([k])=>k);return n.actions.filter(k=>b.includes(k))}),h=$(()=>n.activeTab==="communication"?!0:y.value.length===1),s=$(()=>{if(n.activeTab==="communication")return"add communication";if(!h.value||y.value.length!==1)return"";const b=y.value[0];return{note:"add note",attachment:"add attachment"}[b]||""}),a=$(()=>n.activeTab==="communication"?!0:y.value.length>1),m=$(()=>{const b={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return y.value.map(k=>({key:k,label:b[k]||k,onClick:()=>E(k)}))}),D=$(()=>{if(n.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border";const b="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border";return h.value?`${b} px-4 py-2 h-9`:`${b} w-9 h-9`});$(()=>y.value.some(b=>["email","whatsapp","sms"].includes(b))),$(()=>y.value.some(b=>["addVehicle","configureVehicle"].includes(b))),$(()=>y.value.some(b=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(b)));const E=b=>{p.value=!1,r("action",b)},q=()=>{h.value&&y.value.length===1&&n.activeTab!=="communication"?E(y.value[0]):p.value=!p.value};return(b,k)=>{const A=Fe("click-outside");return t.show?(l(),i("div",{key:0,class:I(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?c("",!0):(l(),i("div",La)),e("div",{class:I(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:Z(q,["stop"]),class:I(D.value)},[k[0]||(k[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),h.value?(l(),i("span",Ma,u(s.value),1)):c("",!0)],2),p.value&&a.value?M((l(),i("div",Va,[C(v(We),{items:m.value,className:"w-48"},null,8,["items"])])),[[A,()=>p.value=!1]]):c("",!0)],2),t.inline?c("",!0):(l(),i("div",ja))],2)):c("",!0)}}},Fa={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Wa={class:"flex items-start gap-3"},Ua={class:"flex-1 min-w-0"},Ba={class:"font-bold text-sm text-heading mb-2"},Ra={class:"space-y-1.5 text-xs text-gray-600"},Pa={class:"flex items-center gap-2"},za={class:"flex items-center gap-2"},Qa={class:"flex items-center gap-2"},Ha={key:0,class:"mt-2"},Ya={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const d=t,n=$(()=>d.appointmentData.date?new Date(d.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),r=$(()=>d.appointmentData.time?d.appointmentData.time:""),p=o=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[o==null?void 0:o.toLowerCase()]||"bg-surfaceSecondary text-body border border";return(o,y)=>(l(),i("div",Fa,[e("div",Wa,[y[3]||(y[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Ua,[e("h4",Ba,u(t.appointmentData.type),1),e("div",Ra,[e("div",Pa,[y[0]||(y[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,u(n.value),1)]),e("div",za,[y[1]||(y[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,u(r.value),1)]),e("div",Qa,[y[2]||(y[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,u(t.appointmentData.assignee),1)])]),t.appointmentData.status?(l(),i("div",Ha,[e("span",{class:I(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",p(t.appointmentData.status)])},u(t.appointmentData.status),3)])):c("",!0)])])]))}},Ka={class:"bg-surface border border rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Ga={class:"flex-1"},Ja={class:"flex items-center gap-2 mb-1"},Xa={class:"text-meta-bold text-heading"},Za={class:"text-meta"},_a={class:"text-meta"},en={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},tn={class:"ml-auto relative"},sn={key:0,class:"absolute right-0 top-full mt-1 z-10"},an={key:0,class:"text-content text-body"},nn={key:1,class:"text-content text-body flex items-center gap-2"},ln={key:2,class:"mt-2"},on={key:0},rn={key:1,class:"bg-surfaceSecondary border border rounded-lg p-3"},dn={key:0},un={class:"text-content font-bold text-heading"},cn={key:0,class:"text-meta mt-0.5"},mn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},fn={key:0},pn={key:1},bn={key:2},yn={key:3},vn={key:4},gn={key:1},xn={class:"text-content font-bold text-heading mb-2"},hn={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},kn={key:0},wn={class:"text-body font-medium ml-1"},$n={key:1},Cn={class:"text-body font-medium ml-1"},Sn={key:2},An={class:"text-body font-medium ml-1"},Dn={key:3},Tn={class:"text-body font-medium ml-1"},On={key:4},qn={class:"text-body font-medium ml-1"},In={key:5},Nn={class:"text-body font-medium ml-1"},Ln={key:2,class:"flex items-center gap-3"},Mn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Vn=["src"],jn={class:"flex-1"},En={class:"text-content font-bold text-heading"},Fn={class:"text-meta"},Wn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Un={key:3,class:"flex items-center gap-3"},Bn={class:"flex-1"},Rn={class:"text-content font-bold text-heading"},Pn={class:"text-meta"},zn={key:0,class:"text-meta mt-1"},Qn={key:1,class:"text-meta mt-1"},Ge={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:d}){const n=t,r=d,p=N(!1),o=$(()=>[{key:"edit",label:"Edit",onClick:D},{key:"delete",label:"Delete",onClick:E}]),y=q=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[q]||"fa-solid fa-circle",h=q=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[q]||"bg-surfaceSecondary text-body border",s=q=>{if(!q)return"Just now";const b=new Date(q),A=new Date-b,T=Math.floor(A/6e4),V=Math.floor(T/60),F=Math.floor(V/24);return T<1?"Just now":T<60?`${T} minutes ago`:V<24?`${V} hours ago`:F===1?"Yesterday":F<7?`${F} days ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},a=q=>q?new Intl.NumberFormat("en-US").format(q):"0",m=q=>q?new Date(q).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",D=()=>{p.value=!1,r("edit",n.item)},E=()=>{p.value=!1,confirm("Are you sure you want to delete this item?")&&r("delete",n.item)};return(q,b)=>{const k=Fe("click-outside");return l(),i("div",Ka,[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",h(t.item.type)])},[e("i",{class:I([y(t.item.type),"text-sm"])},null,2)],2),e("div",Ga,[e("div",Ja,[e("span",Xa,u(t.customerInitials),1),e("span",Za,u(t.item.action||"added"),1),e("span",_a,"• "+u(s(t.item.timestamp)),1),t.item.autoDetected?(l(),i("span",en,"Auto-detected")):c("",!0),e("div",tn,[e("button",{onClick:b[0]||(b[0]=Z(A=>p.value=!p.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...b[1]||(b[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),p.value?M((l(),i("div",sn,[C(v(We),{items:o.value,className:"w-32"},null,8,["items"])])),[[k,()=>p.value=!1]]):c("",!0)])]),t.item.content?(l(),i("div",an,u(t.item.content),1)):c("",!0),t.item.fileName?(l(),i("div",nn,[b[2]||(b[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,u(t.item.fileName),1)])):c("",!0),t.item.data?(l(),i("div",ln,[t.item.type==="appointment"?(l(),i("div",on,[C(Ya,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(l(),i("div",rn,[t.item.type==="tradein"?(l(),i("div",dn,[e("h4",un,u(t.item.data.brand)+" "+u(t.item.data.model),1),t.item.data.version?(l(),i("p",cn,u(t.item.data.version),1)):c("",!0),e("div",mn,[t.item.data.year?(l(),i("div",fn,[b[3]||(b[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),L(u(t.item.data.year),1)])):c("",!0),t.item.data.km?(l(),i("div",pn,[b[4]||(b[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),L(u(t.item.data.km)+" km ",1)])):c("",!0),t.item.data.plate?(l(),i("div",bn,[b[5]||(b[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),L(u(t.item.data.plate),1)])):c("",!0),t.item.data.date?(l(),i("div",yn,[b[6]||(b[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),L(u(m(t.item.data.date)),1)])):c("",!0),t.item.data.class?(l(),i("div",vn,[b[7]||(b[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),L(u(t.item.data.class),1)])):c("",!0)])])):t.item.type==="financing"?(l(),i("div",gn,[e("h4",xn,u(t.item.data.product),1),e("div",hn,[t.item.data.provider?(l(),i("div",kn,[b[8]||(b[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",wn,u(t.item.data.provider),1)])):c("",!0),t.item.data.total?(l(),i("div",$n,[b[9]||(b[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Cn,"€"+u(a(t.item.data.total)),1)])):c("",!0),t.item.data.monthly?(l(),i("div",Sn,[b[10]||(b[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",An,"€"+u(a(t.item.data.monthly)),1)])):c("",!0),t.item.data.deposit?(l(),i("div",Dn,[b[11]||(b[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Tn,"€"+u(a(t.item.data.deposit)),1)])):c("",!0),t.item.data.startDate?(l(),i("div",On,[b[12]||(b[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",qn,u(m(t.item.data.startDate)),1)])):c("",!0),t.item.data.expDate?(l(),i("div",In,[b[13]||(b[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Nn,u(m(t.item.data.expDate)),1)])):c("",!0)])])):t.item.type==="offer"?(l(),i("div",Ln,[t.item.data.image?(l(),i("div",Mn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Vn)])):c("",!0),e("div",jn,[e("h4",En,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",Fn,"€ "+u(a(t.item.data.price)),1)]),t.item.data.isMainOffer?(l(),i("span",Wn,"Main Offer")):c("",!0)])):t.item.type==="purchase"?(l(),i("div",Un,[e("div",Bn,[e("h4",Rn,u(t.item.data.brand)+" "+u(t.item.data.model)+" ("+u(t.item.data.year)+")",1),e("p",Pn,"€ "+u(a(t.item.data.price)),1),t.item.data.purchaseDate?(l(),i("p",zn,"Purchased: "+u(m(t.item.data.purchaseDate)),1)):c("",!0),t.item.data.notes?(l(),i("p",Qn,u(t.item.data.notes),1)):c("",!0)])])):c("",!0)]))])):c("",!0)])])}}},Hn={class:"h-16 px-5 border-b border bg-surfaceSecondary/50 flex items-center justify-between gap-3"},Yn={class:"flex items-center gap-3"},Kn=["title"],Gn={key:0,class:"fa-solid fa-arrow-left text-sm"},Jn={key:1,class:"fa-solid fa-arrow-right text-sm"},Xn={key:2,class:"font-bold text-lg text-heading"},Zn={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},_n={key:0,class:"absolute left-[2.4375rem] top-0 bottom-0 w-0.5 bg-border z-0"},el={key:1,class:"text-center py-8 text-sub relative z-10"},tl={class:"text-sm"},sl={key:2,class:"space-y-6 relative z-10"},al={key:0,class:"mb-4 pl-12"},nl={class:"text-sm font-semibold text-heading"},ll={class:"flex gap-4 relative mb-6"},ol={class:"flex-1 min-w-0"},il={class:"text-sm text-slate-700 leading-snug"},rl={class:"font-bold"},dl={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-body"},ul={class:"text-xs text-sub mt-1"},cl={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},ml={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-border -translate-x-1/2 z-0"},fl={key:1,class:"space-y-4 relative z-10"},pl=["title"],bl={key:2,class:"text-center py-8 text-sub relative z-10"},Je={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:d}){const n=t,r=s=>{const a={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return a[s]||a.default},p=s=>{const a={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return a[s]||a.default},o=s=>{if(!s)return"";const a=new Date(s),m=new Date,D=new Date(m);return D.setDate(D.getDate()-1),a.toDateString()===m.toDateString()?"Today":a.toDateString()===D.toDateString()?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},y=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",h=(s,a)=>{if(s===0)return!0;const m=n.activities[s-1];if(!m)return!0;const D=new Date(a.timestamp).toDateString(),E=new Date(m.timestamp).toDateString();return D!==E};return(s,a)=>t.show?(l(),i("div",{key:0,class:I(["bg-surface border-l border shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Hn,[e("div",Yn,[t.mobileFullscreen?(l(),i("button",{key:0,onClick:a[0]||(a[0]=m=>s.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors"},[...a[2]||(a[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(l(),i("button",{key:1,onClick:a[1]||(a[1]=m=>s.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-sub hover:text-heading hover:bg-surfaceSecondary transition-colors shrink-0",title:t.collapsed?"Expand sidebar":"Collapse sidebar"},[t.collapsed?(l(),i("i",Gn)):(l(),i("i",Jn))],8,Kn)):c("",!0),t.collapsed?c("",!0):(l(),i("h2",Xn,u(t.title),1))])]),t.collapsed?(l(),i("div",cl,[t.activities.length>0?(l(),i("div",ml)):c("",!0),t.activities.length>0?(l(),i("div",fl,[(l(!0),i(P,null,Q(t.activities,m=>(l(),i("div",{key:m.id,class:"relative"},[e("div",{class:I(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface border-2 border",p(m.type)]),title:`${m.user} ${m.action}`},[e("i",{class:I([r(m.type),"text-xs"])},null,2)],10,pl)]))),128))])):(l(),i("div",bl,[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(l(),i("div",Zn,[t.activities.length>0?(l(),i("div",_n)):c("",!0),t.activities.length===0?(l(),i("div",el,[a[3]||(a[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",tl,u(t.emptyMessage),1)])):(l(),i("div",sl,[(l(!0),i(P,null,Q(t.activities,(m,D)=>(l(),i(P,{key:m.id},[h(D,m)?(l(),i("div",al,[e("h3",nl,u(o(m.timestamp)),1)])):c("",!0),e("div",ll,[e("div",{class:I(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",p(m.type)])},[e("i",{class:I([r(m.type),"text-sm"])},null,2)],2),e("div",ol,[e("div",il,[e("span",rl,u(m.user),1),L(" "+u(m.action),1)]),m.content?(l(),i("div",dl,u(m.content),1)):c("",!0),e("div",ul,u(y(m.timestamp)),1)])])],64))),128))]))]))],2)):c("",!0)}},yl={class:"bg-surface border border rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},vl={class:"heading-sub mb-3"},gl={class:"mb-3"},xl={class:"flex justify-end gap-2"},hl={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:d}){const n=t,r=d,p=N(""),o=N(""),y=()=>{!p.value.trim()&&!o.value||r("save",{type:"communication",action:`sent via ${n.type}`,content:p.value||`Sent template: ${o.value}`,communicationType:n.type})};return(h,s)=>(l(),i("div",yl,[s[7]||(s[7]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),e("h5",vl,u(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",gl,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Template",-1)),M(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.value=a),class:"input"},[...s[3]||(s[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[Te,o.value]])]),M(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>p.value=a),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[j,p.value]]),e("div",xl,[C(v(R),{variant:"outline",size:"small",onClick:s[2]||(s[2]=a=>h.$emit("cancel"))},{default:O(()=>[...s[5]||(s[5]=[L(" Cancel ",-1)])]),_:1}),C(v(R),{variant:"primary",size:"small",onClick:y},{default:O(()=>[...s[6]||(s[6]=[L(" Send ",-1)])]),_:1})])]))}},kl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},wl={key:1,class:"flex justify-between items-center mb-4"},$l={class:"heading-sub"},Cl={key:2,class:"flex justify-end gap-2 mt-6 border-t border pt-4"},Sl={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:n}){const r=t,p=n,o=N("");pe(()=>{r.item&&(o.value=r.item.content||"")});const y=()=>{var h,s;o.value.trim()&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"note",action:r.item?"updated a note":"added a note",content:o.value,timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,canSubmit:()=>!!o.value.trim()}),(h,s)=>(l(),i("div",{class:I(["animate-fade-in relative",{"bg-surface border border rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?c("",!0):(l(),i("div",kl)),t.hideHeader?c("",!0):(l(),i("div",wl,[e("h5",$l,u(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:s[0]||(s[0]=a=>h.$emit("cancel")),class:"text-sub hover:text-body"},[...s[3]||(s[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Note",-1)),M(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.value=a),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[j,o.value]])]),t.hideActions?c("",!0):(l(),i("div",Cl,[C(v(R),{variant:"outline",size:"small",onClick:s[2]||(s[2]=a=>h.$emit("cancel"))},{default:O(()=>[...s[5]||(s[5]=[L(" Cancel ",-1)])]),_:1}),C(v(R),{variant:"primary",size:"small",onClick:y},{default:O(()=>[...s[6]||(s[6]=[L(" Save ",-1)])]),_:1})]))],2))}},Al={class:"bg-surface border border rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Dl={class:"flex justify-between items-center mb-4"},Tl={class:"heading-sub"},Ol={class:"flex items-center gap-3"},ql={key:0,class:"text-sm text-slate-600"},Il={key:1,class:"text-sm text-sub"},Nl={class:"flex justify-end gap-2 mt-6 border-t border pt-4"},Ll={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:d}){const n=t,r=d,p=N(null),o=N("");pe(()=>{n.item&&(o.value=n.item.fileName||"")});const y=s=>{const a=s.target.files[0];a&&(p.value=a,o.value=a.name)},h=()=>{var s,a;!p.value&&!n.item||r("save",{id:((s=n.item)==null?void 0:s.id)||Date.now(),type:"attachment",action:n.item?"updated an attachment":"added an attachment",fileName:o.value,timestamp:((a=n.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!n.item})};return(s,a)=>(l(),i("div",Al,[a[8]||(a[8]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border rotate-45"},null,-1)),e("div",Dl,[e("h5",Tl,u(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:a[0]||(a[0]=m=>s.$emit("cancel")),class:"text-sub hover:text-body"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Ol,[e("input",{type:"file",onChange:y,ref:"fileInput",class:"hidden"},null,544),C(v(R),{variant:"outline",size:"small",onClick:a[1]||(a[1]=m=>s.$refs.fileInput.click()),class:"flex items-center gap-2"},{default:O(()=>[...a[4]||(a[4]=[e("i",{class:"fa-solid fa-paperclip"},null,-1),e("span",null,"Choose File",-1)])]),_:1}),o.value?(l(),i("span",ql,u(o.value),1)):(l(),i("span",Il,"No file selected"))])]),e("div",Nl,[C(v(R),{variant:"outline",size:"small",onClick:a[2]||(a[2]=m=>s.$emit("cancel"))},{default:O(()=>[...a[6]||(a[6]=[L(" Cancel ",-1)])]),_:1}),C(v(R),{variant:"primary",size:"small",disabled:!p.value,onClick:h},{default:O(()=>[...a[7]||(a[7]=[L(" Save ",-1)])]),_:1},8,["disabled"])])]))}},Ml={class:"animate-fade-in"},Vl={class:"space-y-4"},jl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},El={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Wl=["disabled"],Ul={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:n}){const r=t,p=n,o=N({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});pe(()=>{r.item&&r.item.data&&(o.value={startDate:r.item.data.startDate||"",expDate:r.item.data.expDate||"",productName:r.item.data.product||r.item.data.productName||"",deposit:r.item.data.deposit||"",loanAmount:r.item.data.total||r.item.data.loanAmount||""})});const y=()=>{var h,s;o.value.productName&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"financing",action:r.item?"updated a financing proposal":"added a financing proposal",data:{product:o.value.productName,provider:"Audi Financial",total:o.value.loanAmount||"0",monthly:Math.round(parseFloat(o.value.loanAmount||0)/36).toString(),startDate:o.value.startDate,expDate:o.value.expDate,deposit:o.value.deposit},timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,isValid:$(()=>!!o.value.productName)}),(h,s)=>(l(),i("div",Ml,[e("div",Vl,[e("div",jl,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Start date",-1)),M(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=a=>o.value.startDate=a),class:"input"},null,512),[[j,o.value.startDate]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expiration date",-1)),M(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=a=>o.value.expDate=a),class:"input"},null,512),[[j,o.value.expDate]])])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Financial product name",-1)),M(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>o.value.productName=a),class:"input"},null,512),[[j,o.value.productName]])]),e("div",El,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Deposit",-1)),M(e("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=a=>o.value.deposit=a),class:"input"},null,512),[[j,o.value.deposit]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Total loan amount",-1)),M(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>o.value.loanAmount=a),class:"input"},null,512),[[j,o.value.loanAmount]])])])]),t.hideActions?c("",!0):(l(),i("div",Fl,[e("button",{onClick:s[5]||(s[5]=a=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!o.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Wl)]))]))}},Bl={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:d}){const n=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),o=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||n("close")},h=s=>{n("save",s),n("close")};return(s,a)=>(l(),W(v(ke),{open:t.show,"onUpdate:open":y},{default:O(()=>[C(v(be),null,{default:O(()=>[C(v(ye),{class:"fixed inset-0 z-50 bg-black/50"}),C(v(ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(v(ge),null,{default:O(()=>[C(v(xe),null,{default:O(()=>[...a[2]||(a[2]=[L("Add Financing",-1)])]),_:1}),C(v(Ue),null,{default:O(()=>[...a[3]||(a[3]=[L("Record financing details for this customer",-1)])]),_:1})]),_:1}),C(Ul,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=m=>s.$emit("close"))},null,8,["item","task-type","task-id"]),C(v(he),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(v(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=m=>s.$emit("close"))}),C(v(R),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:o},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Rl={class:"animate-fade-in"},Pl={class:"space-y-4"},zl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ql={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Hl={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Yl=["disabled"],Kl={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:n}){const r=t,p=n,o=N({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});pe(()=>{r.item&&r.item.data&&(o.value={class:r.item.data.class||"Car",brand:r.item.data.brand||"",model:r.item.data.model||"",version:r.item.data.version||"",km:r.item.data.km||"",plate:r.item.data.plate||"",date:r.item.data.date||""})});const y=()=>{var h,s;o.value.brand&&p("save",{id:((h=r.item)==null?void 0:h.id)||Date.now(),type:"tradein",action:r.item?"updated a trade-in":"added a trade-in",data:{class:o.value.class,brand:o.value.brand,model:o.value.model||"Unknown Model",year:o.value.date?new Date(o.value.date).getFullYear():"Unknown Year",km:o.value.km||"0",plate:o.value.plate||"",date:o.value.date||""},timestamp:((s=r.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!r.item})};return d({submit:y,isValid:$(()=>!!o.value.brand)}),(h,s)=>(l(),i("div",Rl,[e("div",Pl,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),M(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.value.class=a),class:"input"},[...s[8]||(s[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[Te,o.value.class]])]),e("div",zl,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),M(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>o.value.brand=a),class:"input"},null,512),[[j,o.value.brand]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),M(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>o.value.model=a),class:"input"},null,512),[[j,o.value.model]])])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),M(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=a=>o.value.version=a),class:"input"},null,512),[[j,o.value.version]])]),e("div",Ql,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),M(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=a=>o.value.km=a),class:"input"},null,512),[[j,o.value.km]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),M(e("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=a=>o.value.plate=a),class:"input"},null,512),[[j,o.value.plate]])])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),M(e("input",{type:"date","onUpdate:modelValue":s[6]||(s[6]=a=>o.value.date=a),class:"input"},null,512),[[j,o.value.date]])])]),t.hideActions?c("",!0):(l(),i("div",Hl,[e("button",{onClick:s[7]||(s[7]=a=>h.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!o.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Yl)]))]))}},Gl={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(t,{emit:d}){const n=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),o=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||n("close")},h=s=>{n("save",s),n("close")};return(s,a)=>(l(),W(v(ke),{open:t.show,"onUpdate:open":y},{default:O(()=>[C(v(be),null,{default:O(()=>[C(v(ye),{class:"fixed inset-0 z-50 bg-black/50"}),C(v(ve),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(v(ge),null,{default:O(()=>[C(v(xe),null,{default:O(()=>[...a[2]||(a[2]=[L("Add Trade-In Vehicle",-1)])]),_:1}),C(v(Ue),null,{default:O(()=>[...a[3]||(a[3]=[L("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),C(Kl,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=m=>s.$emit("close"))},null,8,["item","task-type","task-id"]),C(v(he),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(v(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=m=>s.$emit("close"))}),C(v(R),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:o},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Jl={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},Xl={key:0,class:"flex justify-between items-center mb-4"},Zl={class:"text-sm font-bold text-heading"},_l={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border"},eo={class:"flex items-center gap-3"},to={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},so=["src"],ao={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},no={class:"font-bold text-sm text-heading"},lo={class:"text-xs text-sub"},oo={class:"space-y-4"},io={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ro={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},uo=["disabled"],co={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:d,emit:n}){const r=t,p=n,o=N({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});pe(()=>{if(r.selectedVehicle){o.value.price=r.selectedVehicle.price||0,o.value.brand=r.selectedVehicle.brand||"",o.value.model=r.selectedVehicle.model||"",o.value.year=r.selectedVehicle.year||"",o.value.image=r.selectedVehicle.image||"";const a=new Date;a.setDate(a.getDate()+30),o.value.validUntil=a.toISOString().split("T")[0]}r.item&&r.item.data&&(o.value={...o.value,...r.item.data,price:r.item.data.price||r.item.data.total||0,financingType:r.item.data.financingType||r.item.data.paymentMethod||"",notes:r.item.data.notes||r.item.data.description||""})}),fe(()=>r.selectedVehicle,a=>{a&&!r.item&&(o.value.price=a.price||0,o.value.brand=a.brand||"",o.value.model=a.model||"",o.value.year=a.year||"",o.value.image=a.image||"")});const y=$(()=>o.value.price>0&&o.value.financingType!==""),h=a=>a?a.toLocaleString("en-US"):"0",s=()=>{var m,D;if(!y.value)return;const a={id:((m=r.item)==null?void 0:m.id)||Date.now(),type:"offer",action:r.item?"updated an offer":"created an offer",data:{brand:o.value.brand,model:o.value.model,year:o.value.year,price:o.value.price,total:o.value.price,paymentMethod:o.value.financingType,financingType:o.value.financingType,downPayment:o.value.downPayment,monthlyPayment:o.value.monthlyPayment,term:o.value.term,interestRate:o.value.interestRate,deliveryDate:o.value.deliveryDate,validUntil:o.value.validUntil,notes:o.value.notes,description:o.value.notes,image:o.value.image},timestamp:((D=r.item)==null?void 0:D.timestamp)||new Date().toISOString(),isEdit:!!r.item};p("save",a)};return d({submit:s,isValid:y,offerData:o}),(a,m)=>(l(),i("div",Jl,[t.hideHeader?c("",!0):(l(),i("div",Xl,[e("h5",Zl,u(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:m[0]||(m[0]=D=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...m[11]||(m[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(l(),i("div",_l,[m[12]||(m[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",eo,[e("div",to,[t.selectedVehicle.image?(l(),i("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,so)):(l(),i("i",ao))]),e("div",null,[e("h4",no,u(t.selectedVehicle.brand)+" "+u(t.selectedVehicle.model)+" ("+u(t.selectedVehicle.year)+") ",1),e("p",lo,"Base Price: € "+u(h(t.selectedVehicle.price)),1)])])])):c("",!0),e("div",oo,[e("div",null,[m[13]||(m[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[L(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),M(e("input",{type:"number","onUpdate:modelValue":m[1]||(m[1]=D=>o.value.price=D),class:"input",placeholder:"Enter offer price"},null,512),[[j,o.value.price]])]),e("div",null,[m[15]||(m[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[L(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),M(e("select",{"onUpdate:modelValue":m[2]||(m[2]=D=>o.value.financingType=D),class:"input"},[...m[14]||(m[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[Te,o.value.financingType]])]),o.value.financingType==="finance"||o.value.financingType==="lease"?(l(),i("div",io,[e("div",null,[m[16]||(m[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),M(e("input",{type:"number","onUpdate:modelValue":m[3]||(m[3]=D=>o.value.downPayment=D),class:"input",placeholder:"0"},null,512),[[j,o.value.downPayment]])]),e("div",null,[m[17]||(m[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),M(e("input",{type:"number","onUpdate:modelValue":m[4]||(m[4]=D=>o.value.monthlyPayment=D),class:"input",placeholder:"Calculated automatically"},null,512),[[j,o.value.monthlyPayment]])]),e("div",null,[m[18]||(m[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),M(e("input",{type:"number","onUpdate:modelValue":m[5]||(m[5]=D=>o.value.term=D),class:"input",placeholder:"36"},null,512),[[j,o.value.term]])]),e("div",null,[m[19]||(m[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),M(e("input",{type:"number",step:"0.1","onUpdate:modelValue":m[6]||(m[6]=D=>o.value.interestRate=D),class:"input",placeholder:"3.5"},null,512),[[j,o.value.interestRate]])])])):c("",!0),e("div",null,[m[20]||(m[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),M(e("input",{type:"date","onUpdate:modelValue":m[7]||(m[7]=D=>o.value.deliveryDate=D),class:"input"},null,512),[[j,o.value.deliveryDate]])]),e("div",null,[m[21]||(m[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),M(e("input",{type:"date","onUpdate:modelValue":m[8]||(m[8]=D=>o.value.validUntil=D),class:"input"},null,512),[[j,o.value.validUntil]])]),e("div",null,[m[22]||(m[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),M(e("textarea",{"onUpdate:modelValue":m[9]||(m[9]=D=>o.value.notes=D),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[j,o.value.notes]])])]),t.hideActions?c("",!0):(l(),i("div",ro,[e("button",{onClick:m[10]||(m[10]=D=>a.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:s,disabled:!y.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},u(t.item?"Update Offer":"Create Offer"),9,uo)]))]))}},mo={class:"p-6"},fo={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:d}){const n=d,r=N(null),p=$(()=>{var s;return((s=r.value)==null?void 0:s.isValid)||!1}),o=()=>{var s;(s=r.value)==null||s.submit()},y=s=>{s||n("close")},h=s=>{n("save",s),n("close")};return(s,a)=>(l(),W(v(ke),{open:t.show,"onUpdate:open":y},{default:O(()=>[C(v(be),null,{default:O(()=>[C(v(ye),{class:"fixed inset-0 z-50 bg-black/50"}),C(v(ve),{class:"w-full sm:max-w-2xl p-0"},{default:O(()=>[C(v(ge),{class:"p-6 pb-4 border-b border"},{default:O(()=>[C(v(xe),null,{default:O(()=>[...a[2]||(a[2]=[L("Create Offer",-1)])]),_:1}),C(v(Ue),null,{default:O(()=>[...a[3]||(a[3]=[L("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",mo,[C(co,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:r,onSave:h,onCancel:a[0]||(a[0]=m=>s.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),C(v(he),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:O(()=>[C(v(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=m=>s.$emit("close"))}),C(v(R),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value,onClick:o},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},po={class:"space-y-4"},bo={key:0},yo={class:"flex flex-wrap gap-2"},vo=["onClick"],go={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:d}){const n=t,r=d,p=N(""),o=h=>{h||r("close")};fe(()=>n.show,h=>{h&&(p.value="")});const y=()=>{const h=p.value.trim();h&&(n.existingTags.includes(h)||(r("add",h),p.value=""))};return(h,s)=>(l(),W(v(ke),{open:t.show,"onUpdate:open":o},{default:O(()=>[C(v(be),null,{default:O(()=>[C(v(ye),{class:"fixed inset-0 z-50 bg-black/50"}),C(v(ve),{class:"w-full sm:max-w-md"},{default:O(()=>[C(v(ge),null,{default:O(()=>[C(v(xe),null,{default:O(()=>[...s[2]||(s[2]=[L("Add Tag",-1)])]),_:1})]),_:1}),e("div",po,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),M(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>p.value=a),onKeyup:rt(y,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[j,p.value]])]),t.existingTags.length>0?(l(),i("div",bo,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",yo,[(l(!0),i(P,null,Q(t.existingTags,a=>(l(),i("button",{key:a,onClick:m=>p.value=a,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},u(a),9,vo))),128))])])):c("",!0)]),C(v(he),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(v(R),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=a=>h.$emit("close"))}),C(v(R),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value.trim(),onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Me={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function xo(t){if(!t)return Me.default;const d=t.toLowerCase().trim();return Me[d]||Me.default}function ho({store:t,taskId:d,getTabForItemType:n,isOverviewModalAction:r}){const p=N(null),o=N(null),y=N("overview"),h=N("email"),s=N([]);fe(y,()=>{p.value=null,o.value=null});const a=$(()=>[...t.currentActivities.value,...s.value.filter(A=>!A.activityId)].filter(A=>{const T=n(A.type);return y.value==="overview"?T==="overview":T===y.value}).sort((A,T)=>{const V=new Date(A.timestamp||0);return new Date(T.timestamp||0)-V})),m=k=>(o.value=null,y.value==="overview"&&r&&r(k)?{type:"overview-modal",action:k}:(["email","sms","whatsapp","call"].includes(k)?(h.value=k,p.value="communication"):p.value=k,null)),D=async k=>{var A;if(k.isEdit){const T=s.value.findIndex(V=>V.id===k.id);T>-1&&(s.value[T]={...s.value[T],...k}),(A=o.value)!=null&&A.activityId&&await t.updateActivity(d.value,o.value.activityId,{type:k.communicationType||k.type,user:"You",action:k.action,content:k.content,fileName:k.fileName,data:k.data})}else{const T=k.communicationType||k.type,V=await t.addActivity(d.value,{type:T,user:"You",action:k.action,content:k.content,fileName:k.fileName,data:k.data});s.value.push({id:V.id,type:T==="email"||T==="whatsapp"||T==="sms"?"communication":T,action:k.action,content:k.content,fileName:k.fileName,data:k.data,timestamp:V.timestamp,activityId:V.id})}p.value=null,o.value=null},E=()=>{p.value=null,o.value=null},q=k=>{n(k.type)&&(p.value=k.type==="email"||k.type==="whatsapp"||k.type==="sms"||k.type==="communication"?"communication":k.type,o.value=k)},b=async k=>{try{await t.deleteActivity(d.value,k)}catch(A){throw console.error("Error deleting item:",A),A}};return{activeTab:y,showInlineWidget:p,inlineWidgetType:$(()=>p.value),editingItem:o,isEditing:$(()=>o.value!==null),communicationType:h,inlineContent:s,filteredInlineContent:a,handleAddNewAction:m,handleWidgetSave:D,handleWidgetCancel:E,handleEditItem:q,handleDeleteItem:b}}const ko={class:"flex-1 flex flex-col overflow-hidden h-full"},wo={class:"bg-surface border-b border shrink-0"},$o={key:0,class:"px-4 md:px-8 py-3 md:py-4"},Co={key:0,class:"flex-1 flex flex-row overflow-hidden"},So={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Ao={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Do={class:"mb-4"},To={key:0},Oo={key:0},qo={key:1,class:"mb-6"},Io={key:2,class:"space-y-4 mb-6 px-1"},No={key:1},Lo={key:0,class:"space-y-4 mb-6 px-1"},Mo={key:1,class:"flex-1 flex flex-row overflow-hidden"},Vo={class:"flex-1 flex flex-col overflow-hidden min-w-0"},jo={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Eo={key:0,class:"space-y-6"},Fo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Wo={key:1,class:"space-y-6"},Uo={key:0},Bo={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Ro={class:"p-6"},Po={class:"grid grid-cols-4 gap-2 mb-4"},zo={key:0,class:"space-y-3"},Qo={key:0,class:"space-y-2"},Ho={key:1,class:"mt-6 pt-6 border-t border"},Yo={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ko={class:"flex items-center gap-2 mb-1"},Go={class:"text-xs font-semibold text-heading"},Jo={class:"text-xs text-sub"},Xo={class:"text-sm text-body"},Zo={key:2,class:"space-y-6"},_o={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},ei={class:"p-6"},ti={class:"space-y-2 max-h-[300px] overflow-y-auto"},si={key:0,class:"text-center py-6 text-sub text-sm"},ai={class:"text-xs text-sub mb-1"},ni={class:"text-sm text-body"},li={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},oi={class:"p-6"},ii={class:"space-y-2 max-h-[300px] overflow-y-auto"},ri={key:0,class:"text-center py-6 text-sub text-sm"},di={class:"flex-1 min-w-0"},ui={class:"text-sm font-medium text-heading truncate"},ci={class:"text-xs text-sub"},mi={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},fi={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},pi={class:"p-6"},bi={class:"space-y-2 max-h-[300px] overflow-y-auto"},yi={key:0,class:"text-center py-6 text-sub text-sm"},vi={class:"flex items-center justify-between mb-1"},gi={class:"text-xs text-sub"},xi={key:0,class:"text-sm font-medium text-heading"},hi={key:0},ki={key:1,class:"grid grid-cols-2 gap-2 mt-2 text-xs text-body"},wi={key:0},$i={key:1},Ci={key:2,class:"text-xs text-body mt-2"},Si={class:"bg-surface border border rounded-xl shadow-sm overflow-hidden"},Ai={class:"p-6"},Di={class:"space-y-2 max-h-[300px] overflow-y-auto"},Ti={key:0,class:"text-center py-6 text-sub text-sm"},Oi={class:"flex items-center justify-between mb-1"},qi={class:"text-xs text-sub"},Ii={key:0,class:"text-sm font-medium text-heading"},Ni={key:0},Li={key:1,class:"text-sm text-body mt-1"},Mi={key:2,class:"text-xs text-body mt-2"},Wi={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(t,{emit:d}){const n=t,r=dt(),p=Ee(),o=$(()=>n.task.id),y=$(()=>r.path.startsWith("/tasks")&&!r.path.startsWith("/customer")),h=N("request"),s=[{key:"request",label:"Request"},{key:"manage",label:"Manage"},{key:"data",label:"Data"}],a=N(null),m=N(""),D=N(""),E=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="note"):[]),q=$(()=>n.task.activities?n.task.activities.filter(S=>["email","call","sms","whatsapp"].includes(S.type)):[]),b=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="attachment"):[]),k=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="purchase"):[]),A=$(()=>n.task.activities?n.task.activities.filter(S=>S.type==="tradein"):[]),T=()=>{z.value="purchase",J.value=!0},V=()=>{z.value="tradein",J.value=!0},F=S=>{if(!S)return"";const f=new Date(S),U=new Date-f,Y=Math.floor(U/6e4),X=Math.floor(U/36e5),g=Math.floor(U/864e5);return Y<1?"Just now":Y<60?`${Y}m ago`:X<24?`${X}h ago`:g<7?`${g}d ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},le=S=>S?new Intl.NumberFormat("en-US").format(S):"0",we=S=>S?new Intl.NumberFormat("en-US").format(S):"0",oe=S=>{a.value=a.value===S?null:S,m.value="",D.value=""},de=async()=>{if(!a.value)return;let S=a.value;if(S==="call"){await n.storeAdapter.addActivity(n.task.id,{type:"call",content:"Call logged",timestamp:new Date().toISOString()}),a.value=null;return}if(["whatsapp","sms","email"].includes(S)){if(!D.value)return;const f=S==="whatsapp"?"whatsapp":S==="sms"?"sms":"email";await n.storeAdapter.addActivity(n.task.id,{type:f,content:`Template: ${D.value}`,timestamp:new Date().toISOString()}),a.value=null,D.value=""}},ue=$(()=>n.type==="contact"?"bg-blue-100 text-blue-600":n.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),G=N(r.path.startsWith("/tasks")&&!r.path.startsWith("/customer"));fe(()=>r.path,S=>{G.value=S.startsWith("/tasks")&&!S.startsWith("/customer")});const ce=()=>{p.push({path:`/customer/${n.task.id}`,query:{type:n.type}})};function me(S){te.value=!1}const ie=()=>{w.value=!0},Oe=async S=>{var H,U,Y,X;const f=S.name;n.type==="lead"?await((U=(H=n.storeAdapter).updateLead)==null?void 0:U.call(H,n.task.id,{assignee:f,assigneeType:S.type,teamId:S.type==="team"?S.id:null})):n.type==="opportunity"&&await((X=(Y=n.storeAdapter).updateOpportunity)==null?void 0:X.call(Y,n.task.id,{assignee:f,assigneeType:S.type,teamId:S.type==="team"?S.id:null})),w.value=!1},J=N(!1),z=N(null),te=N(!1),w=N(!1),x=N(!1),{activeTab:B,showInlineWidget:se,editingItem:qe,communicationType:tt,inlineContent:st,filteredInlineContent:$e,handleAddNewAction:at,handleWidgetSave:Ce,handleWidgetCancel:Ie,handleEditItem:Re,handleDeleteItem:Pe}=ho({store:n.storeAdapter,taskId:o,getTabForItemType:xo,isOverviewModalAction:S=>B.value==="overview"&&n.addNewConfig.overviewActions.includes(S)});fe(()=>n.task.id,()=>{B.value="overview"});const Ne=S=>{const f=at(S);f&&f.modalAction&&(z.value=f.modalAction,J.value=!0)},ze=S=>{if(S==="appointment"){te.value=!0;return}const f={note:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(S))z.value=S,J.value=!0;else{const H=f[S];H?(B.value=H,setTimeout(()=>{Ne(S),setTimeout(()=>{try{const U=document.querySelector(".animate-fade-in");U&&U.parentNode&&U.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Ne(S)}},Se=()=>{J.value=!1,z.value=null},Le=async S=>{await Ce(S),Se()},nt=$(()=>[{key:"overview",label:"Overview"},{key:"data",label:"Data"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}]),Ae=$(()=>[...n.storeAdapter.currentActivities.value,...st.value]);$(()=>z.value==="financing"?"Add Financing":z.value==="tradein"?"Add Trade-in":z.value==="purchase"?"Create Purchase Offer":"");const Qe=async S=>{if(n.type==="opportunity")try{await n.storeAdapter.addVehicle(n.task.id,S.vehicleData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(f){console.error("Error selecting vehicle:",f)}},He=async S=>{if(n.type==="opportunity")try{await n.storeAdapter.createOffer(n.task.id,S.offerData),n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id)}catch(f){console.error("Error creating offer:",f)}},lt=async S=>{var U,Y,X,g;const f=n.task.tags||[];if(f.includes(S)){x.value=!1;return}const H=[...f,S];try{n.type==="lead"?await((Y=(U=n.storeAdapter).updateLead)==null?void 0:Y.call(U,n.task.id,{tags:H})):n.type==="opportunity"&&await((g=(X=n.storeAdapter).updateOpportunity)==null?void 0:g.call(X,n.task.id,{tags:H})),n.type==="lead"&&n.storeAdapter.loadLeadById?await n.storeAdapter.loadLeadById(n.task.id):n.type==="opportunity"&&n.storeAdapter.loadOpportunityById&&await n.storeAdapter.loadOpportunityById(n.task.id),x.value=!1}catch(ot){console.error("Error adding tag:",ot)}};return(S,f)=>{var H,U,Y,X;return l(),i("div",ko,[e("header",wo,[y.value?c("",!0):(l(),i("div",$o,[C(jt,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":ue.value,"task-type":t.type,"customer-id":((H=t.task.customer)==null?void 0:H.id)||t.task.customerId||t.task.id,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:ze,onAddTag:f[0]||(f[0]=g=>x.value=!0)},{tags:O(()=>[(l(!0),i(P,null,Q(t.task.tags,g=>(l(),i("span",{key:g,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},u(g),1))),128))]),"name-action":O(()=>[y.value?(l(),i("button",{key:0,onClick:ce,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...f[20]||(f[20]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):c("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id"])]))]),y.value?y.value?(l(),i("div",Mo,[e("div",Vo,[e("div",jo,[C(Ke,{modelValue:h.value,"onUpdate:modelValue":f[6]||(f[6]=g=>h.value=g),tabs:s,class:"mb-6"},null,8,["modelValue"]),h.value==="request"?(l(),i("div",Eo,[e("div",Fo,[t.type!=="contact"?(l(),W(ba,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:ie},null,8,["task","entity-type","activities"])):c("",!0),C(Na,{task:t.task,"task-type":t.type,"customer-id":((X=t.task.customer)==null?void 0:X.id)||t.task.customerId||t.task.id,onAction:ze,onAddTag:f[7]||(f[7]=g=>x.value=!0)},null,8,["task","task-type","customer-id"])])])):c("",!0),h.value==="manage"?(l(),i("div",Wo,[t.managementWidget?(l(),i("div",Uo,[(l(),W(Ye(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ae.value,onCarAdded:f[8]||(f[8]=g=>S.$emit("car-added",g)),onConvertToLead:f[9]||(f[9]=g=>S.$emit("convert-to-lead")),onConvertToOpportunity:f[10]||(f[10]=g=>S.$emit("convert-to-opportunity")),onVehicleSelected:Qe,onCreateOffer:He},null,40,["lead","opportunity","contact","activities"]))])):c("",!0),e("div",Bo,[e("div",Ro,[f[27]||(f[27]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-comments text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Communicate")],-1)),e("div",Po,[e("button",{onClick:f[11]||(f[11]=g=>oe("call")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="call"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[21]||(f[21]=[e("i",{class:"fa-solid fa-phone text-base"},null,-1),e("span",{class:"text-xs"},"Call",-1)])],2),e("button",{onClick:f[12]||(f[12]=g=>oe("whatsapp")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="whatsapp"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[22]||(f[22]=[e("i",{class:"fa-brands fa-whatsapp text-base"},null,-1),e("span",{class:"text-xs"},"WhatsApp",-1)])],2),e("button",{onClick:f[13]||(f[13]=g=>oe("sms")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="sms"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[23]||(f[23]=[e("i",{class:"fa-solid fa-message text-base"},null,-1),e("span",{class:"text-xs"},"SMS",-1)])],2),e("button",{onClick:f[14]||(f[14]=g=>oe("email")),class:I(["bg-surface border-2 rounded-lg py-3 px-3 flex flex-col items-center justify-center gap-1.5 text-sm font-medium transition-all",a.value==="email"?"border-brand-red bg-red-50 text-brand-red":"border text-body hover:border-red-300 hover:bg-red-50/50"])},[...f[24]||(f[24]=[e("i",{class:"fa-solid fa-envelope text-base"},null,-1),e("span",{class:"text-xs"},"Email",-1)])],2)]),a.value?(l(),i("div",zo,[["whatsapp","sms","email"].includes(a.value)?(l(),i("div",Qo,[f[26]||(f[26]=e("label",{class:"block text-xs font-medium text-body"},"Select Template",-1)),M(e("select",{"onUpdate:modelValue":f[15]||(f[15]=g=>D.value=g),class:"w-full bg-surface border border rounded-lg px-3 py-2 text-sm text-body focus:outline-none focus:border-brand-red"},[...f[25]||(f[25]=[e("option",{value:""},"Select a template...",-1),e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[Te,D.value]]),e("button",{onClick:de,class:"px-4 py-2 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors"}," Send "+u(a.value==="whatsapp"?"WhatsApp":a.value==="sms"?"SMS":"Email"),1)])):c("",!0)])):c("",!0),q.value.length>0?(l(),i("div",Ho,[e("div",Yo,[(l(!0),i(P,null,Q(q.value,g=>(l(),i("div",{key:g.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",Ko,[e("span",Go,u(g.type),1),e("span",Jo,u(F(g.timestamp)),1)]),e("p",Xo,u(g.content),1)]))),128))])])):c("",!0)])])])):c("",!0),h.value==="data"?(l(),i("div",Zo,[e("div",_o,[e("div",ei,[f[29]||(f[29]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-note-sticky text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Notes")],-1)),e("div",ti,[E.value.length===0?(l(),i("div",si,[...f[28]||(f[28]=[e("i",{class:"fa-solid fa-note-sticky text-2xl mb-2"},null,-1),e("p",null,"No notes yet",-1)])])):c("",!0),(l(!0),i(P,null,Q(E.value,g=>(l(),i("div",{key:g.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",ai,u(F(g.timestamp)),1),e("p",ni,u(g.content),1)]))),128))])])]),e("div",li,[e("div",oi,[f[32]||(f[32]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-paperclip text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Attachments")],-1)),e("div",ii,[b.value.length===0?(l(),i("div",ri,[...f[30]||(f[30]=[e("i",{class:"fa-solid fa-paperclip text-2xl mb-2"},null,-1),e("p",null,"No attachments yet",-1)])])):c("",!0),(l(!0),i(P,null,Q(b.value,g=>(l(),i("div",{key:g.id,class:"p-3 bg-surfaceSecondary border border rounded-lg flex items-center gap-3"},[f[31]||(f[31]=e("i",{class:"fa-solid fa-file text-sub text-lg"},null,-1)),e("div",di,[e("div",ui,u(g.filename),1),e("div",ci,u(F(g.timestamp)),1)])]))),128))])])]),e("div",mi,[e("div",fi,[e("div",pi,[e("div",{class:"flex items-center justify-between mb-4"},[f[34]||(f[34]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Trade-in")],-1)),e("button",{onClick:V,class:"px-3 py-1.5 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors flex items-center gap-1.5"},[...f[33]||(f[33]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",bi,[A.value.length===0?(l(),i("div",yi,[...f[35]||(f[35]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-2xl mb-2"},null,-1),e("p",null,"No trade-ins yet",-1)])])):c("",!0),(l(!0),i(P,null,Q(A.value,g=>(l(),i("div",{key:g.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",vi,[e("div",gi,u(F(g.timestamp)),1)]),g.data&&g.data.brand?(l(),i("div",xi,[L(u(g.data.brand)+" "+u(g.data.model)+" ",1),g.data.version?(l(),i("span",hi,u(g.data.version),1)):c("",!0)])):c("",!0),g.data&&(g.data.kilometers||g.data.price)?(l(),i("div",ki,[g.data.kilometers?(l(),i("div",wi,[f[36]||(f[36]=e("span",{class:"text-sub"},"KM:",-1)),L(" "+u(we(g.data.kilometers)),1)])):c("",!0),g.data.price?(l(),i("div",$i,[f[37]||(f[37]=e("span",{class:"text-sub"},"Price:",-1)),L(" € "+u(le(g.data.price)),1)])):c("",!0)])):c("",!0),g.content?(l(),i("div",Ci,u(g.content),1)):c("",!0)]))),128))])])]),e("div",Si,[e("div",Ai,[e("div",{class:"flex items-center justify-between mb-4"},[f[39]||(f[39]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-shopping-cart text-sub text-sm"}),e("h3",{class:"font-bold text-heading text-base"},"Purchase")],-1)),e("button",{onClick:T,class:"px-3 py-1.5 text-xs font-medium bg-brand-red text-white rounded-lg hover:bg-brand-redDark transition-colors flex items-center gap-1.5"},[...f[38]||(f[38]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add New",-1)])])]),e("div",Di,[k.value.length===0?(l(),i("div",Ti,[...f[40]||(f[40]=[e("i",{class:"fa-solid fa-shopping-cart text-2xl mb-2"},null,-1),e("p",null,"No purchases yet",-1)])])):c("",!0),(l(!0),i(P,null,Q(k.value,g=>(l(),i("div",{key:g.id,class:"p-3 bg-surfaceSecondary border border rounded-lg"},[e("div",Oi,[e("div",qi,u(F(g.timestamp)),1)]),g.data&&g.data.brand?(l(),i("div",Ii,[L(u(g.data.brand)+" "+u(g.data.model)+" ",1),g.data.year?(l(),i("span",Ni,"("+u(g.data.year)+")",1)):c("",!0)])):c("",!0),g.data&&g.data.price?(l(),i("div",Li," € "+u(le(g.data.price)),1)):c("",!0),g.content?(l(),i("div",Mi,u(g.content),1)):c("",!0)]))),128))])])])])])):c("",!0)])]),C(Je,{title:"Activity summary",activities:Ae.value,collapsed:G.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:f[16]||(f[16]=g=>G.value=!G.value)},null,8,["activities","collapsed"])])):c("",!0):(l(),i("div",Co,[e("div",So,[e("main",Ao,[e("div",Do,[C(Ke,{modelValue:v(B),"onUpdate:modelValue":f[1]||(f[1]=g=>ut(B)?B.value=g:null),tabs:nt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),v(B)==="overview"?(l(),i("div",To,[t.type!=="contact"?(l(),i("div",Oo,[C(Ps,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((U=t.task.requestedCar)==null?void 0:U.requestType)||"","request-message":((Y=t.task.requestedCar)==null?void 0:Y.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:ie},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):c("",!0),je(S.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(l(),i("div",qo,[(l(),W(Ye(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Ae.value,onCarAdded:f[2]||(f[2]=g=>S.$emit("car-added",g)),onConvertToLead:f[3]||(f[3]=g=>S.$emit("convert-to-lead")),onConvertToOpportunity:f[4]||(f[4]=g=>S.$emit("convert-to-opportunity")),onVehicleSelected:Qe,onCreateOffer:He},null,40,["lead","opportunity","contact","activities"]))])):c("",!0),v($e).length>0?(l(),i("div",Io,[(l(!0),i(P,null,Q(v($e),g=>(l(),W(Ge,{key:g.id,item:g,"task-type":t.type,"customer-initials":"SK",onEdit:v(Re),onDelete:v(Pe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):c("",!0)])):(l(),i("div",No,[C(Ea,{actions:t.addNewConfig.tabActions,"active-tab":v(B),onAction:Ne},null,8,["actions","active-tab"]),e("div",null,[v(se)==="communication"?(l(),W(hl,{key:0,type:v(tt),"task-type":t.type,"task-id":t.task.id,item:v(qe),onSave:v(Ce),onCancel:v(Ie)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):c("",!0),v(B)==="data"&&v(se)==="note"?(l(),W(Sl,{key:1,item:v(qe),"task-type":t.type,"task-id":t.task.id,onSave:v(Ce),onCancel:v(Ie)},null,8,["item","task-type","task-id","onSave","onCancel"])):c("",!0),v(se)==="attachment"?(l(),W(Ll,{key:2,item:v(qe),"task-type":t.type,"task-id":t.task.id,onSave:v(Ce),onCancel:v(Ie)},null,8,["item","task-type","task-id","onSave","onCancel"])):c("",!0)]),v($e).length>0?(l(),i("div",Lo,[(l(!0),i(P,null,Q(v($e),g=>(l(),W(Ge,{key:g.id,item:g,"task-type":t.type,"customer-initials":"SK",onEdit:v(Re),onDelete:v(Pe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):c("",!0)]))])]),C(Je,{title:"Activity summary",activities:Ae.value,collapsed:G.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:f[5]||(f[5]=g=>G.value=!G.value)},null,8,["activities","collapsed"])])),C(Bl,{show:z.value==="financing"&&J.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Le,onClose:Se},null,8,["show","task-type","task-id"]),C(Gl,{show:z.value==="tradein"&&J.value,item:null,"task-type":t.type,"task-id":t.task.id,onSave:Le,onClose:Se},null,8,["show","task-type","task-id"]),C(fo,{show:z.value==="purchase"&&J.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:Le,onClose:Se},null,8,["show","task-type","task-id","requested-car"]),C(ct,{show:w.value,onClose:f[17]||(f[17]=g=>w.value=!1),onConfirm:Oe},null,8,["show"]),te.value?(l(),W(mt,{key:2,show:te.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],onCreate:me,onCancel:f[18]||(f[18]=g=>te.value=!1)},null,8,["show","customer","assignee"])):c("",!0),C(go,{show:x.value,"existing-tags":t.task.tags||[],onClose:f[19]||(f[19]=g=>x.value=!1),onAdd:lt},null,8,["show","existing-tags"])])}}},_={[K.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[K.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[K.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[K.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[K.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[K.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Xe={toClosed:(t,d,n)=>{const r={isDisqualified:!0,disqualifyReason:(n==null?void 0:n.reason)||null,disqualifyCategory:(n==null?void 0:n.category)||null,scheduledAppointment:null,nextActionDue:null};(n==null?void 0:n.reason)==="Duplicate"?(r.isDuplicate=!0,r.stage="Closed Failed"):(n==null?void 0:n.category)==="Not Interested"?r.stage="Not Interested":r.stage="Not Valid",r.status="Disqualified";const p=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(n==null?void 0:n.category)||"Unknown"}, Reason: ${(n==null?void 0:n.reason)||"Unknown"}`}];return t.scheduledAppointment&&p.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:r,activities:p}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Ui(t,d){return d.startsWith("Closed")?Xe.toClosed:t.startsWith("Closed")&&!d.startsWith("Closed")?Xe.reopen:null}function Bi(t){var o,y,h;const d=t.lead;if(!d)return null;const n=ne(d,"lead");if(!n)return((o=_[K.NEW])==null?void 0:o.primaryAction)||null;const r=_[n];if(!r)return((y=_[K.NEW])==null?void 0:y.primaryAction)||null;if(!r.primaryAction)return((h=_[K.NEW])==null?void 0:h.primaryAction)||null;const p=r.primaryAction;return typeof p=="function"?p({lead:d,displayStage:n}):p}function Ri(t){const d=t.lead;if(!d)return[];const n=ne(d,"lead"),r=_[n];return r?r.secondaryActions||[]:[]}function et(t){const d=t.lead;if(!d||!(d.isDisqualified===!0))return!1;const r=ne(d,"lead");return r===K.CLOSED_INVALID||r===K.CLOSED_NOT_INTERESTED||r===K.CLOSED_DUPLICATE}function Pi(t){const d=t.lead;if(!d||et(t))return!1;const n=ne(d,"lead"),r=_[n];return r?typeof r.showLQWidget=="function"?r.showLQWidget(d):r.showLQWidget??!1:!1}function zi(t){const d=t.lead;if(!d||et(t))return!1;const n=ne(d,"lead"),r=_[n];return r?r.showDeadlineBanner&&d.nextActionDue:!1}function Qi(t){const d=t.lead;if(!d)return!1;const n=ne(d,"lead"),r=_[n];return r?r.canPostpone??!1:!1}function Hi(t){const d=t.lead;if(!d)return"qualification";const n=ne(d,"lead"),r=_[n];return r&&r.lqWidgetMode||"qualification"}const Be={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const d=t.deliverySubstatus;return d==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:d==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ve={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function ae(t){if(!t)return 0;const d=new Date(t),r=Math.abs(new Date-d);return Math.ceil(r/(1e3*60*60*24))}const re={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const d=ee(),n=d.getSetting("oofbMinDays"),r=d.getSetting("oofbMaxDays"),p=ae(t.opportunity.createdAt);return p>=n&&p<r+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const n=ee().getSetting("ufbDays");return ae(t.opportunity.createdAt)>=n&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=ee().getSetting("ofbDays");return ae(t.opportunity.lastActivity||t.opportunity.createdAt)>=n&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const n=ee().getSetting("nfuDays"),r=ae(t.opportunity.lastActivity||t.opportunity.createdAt),p=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return r>=n&&!t.opportunity.contractDate&&!p&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var o;if(!t.opportunity.contractDate)return!1;const n=ee().getSetting("cfbDays"),r=ae(t.opportunity.contractDate),p=(o=t.activities)==null?void 0:o.some(y=>{var h;return y.type==="delivery"||((h=y.action)==null?void 0:h.toLowerCase().includes("delivered"))});return r>=n&&!p},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var o;const d=(o=t.activities)==null?void 0:o.find(y=>{var h;return y.type==="delivery"||((h=y.action)==null?void 0:h.toLowerCase().includes("delivered"))});if(!d)return!1;const r=ee().getSetting("dfbDays");return ae(d.timestamp)>=r},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const d=t.stage;return d==="Closed Won"||d==="Closed Lost"},"is-closed-with-task-widget":t=>re["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(re["is-closed"](t))return!1;const d=ee(),n=d.getSetting("abandonedOpportunityDays");if(!d.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const p=t.opportunity.lastActivity||t.opportunity.createdAt;return ae(p)>=n}};function Yi(t,d){if(re["is-closed-with-task-widget"](d))return[Ve.reopen,Ve.requalify,Ve.closeLost];const n=Be[t];return!n||!n.secondaryActions?[]:n.secondaryActions.filter(r=>{if(!r.conditional)return!0;const p=re[r.conditional];return p?p(d):!0})}function Ki(t,d){const n=Be[t];if(!n||!n.taskWidgets)return null;const p=ee().getSetting("autoCloseWidgetsOnClose"),o=re["is-closed"]({stage:t});for(const y of n.taskWidgets){if(p&&o&&(y.type==="NFU"||y.type==="OFB"))continue;const h=re[y.condition];if(h&&h(d))return y.type}return null}function Gi(t,d){const n=Be[t];if(!n||!n.primaryAction)return null;const r=n.primaryAction;return{...r,title:typeof r.title=="function"?r.title(d):r.title,description:typeof r.description=="function"?r.description(d):r.description,label:typeof r.label=="function"?r.label(d):r.label}}function Ji(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function Xi(t){return t==="Closed Won"||t==="Closed Lost"}const Zi={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:d}){const n=d,r=o=>{o||n("close")},p=()=>{n("close")};return(o,y)=>(l(),W(v(ke),{open:t.show,"onUpdate:open":r},{default:O(()=>[C(v(be),null,{default:O(()=>[C(v(ye),{class:"fixed inset-0 z-50 bg-black/50"}),C(v(ve),{class:"w-full sm:max-w-md"},{default:O(()=>[C(v(ge),null,{default:O(()=>[C(v(xe),null,{default:O(()=>[L(u(t.title),1)]),_:1})]),_:1}),y[0]||(y[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),C(v(he),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(v(R),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:p})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Wi as _,Ri as a,zi as b,Qi as c,Hi as d,Ui as e,Sl as f,Bi as g,Ki as h,et as i,Gi as j,Yi as k,Xi as l,Ji as m,co as n,Zi as o,Pi as s};
