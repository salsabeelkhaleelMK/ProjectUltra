import{k as te,l as ce,d as rt,r as $,c as T,a,h as o,b as e,j as v,t as f,e as j,n as N,w as E,v as z,F as Q,f as _,i as K,p as ue,g as Me,q as je,s as B,x as pe,o as me,y as ae,z as ve,A as W,u as U,B as it,C as dt,_ as Le,D as Fe,E as ut,G as Ve,T as ye,H as Ee,I as ct,J as pt}from"./index-vDfOg4W5.js";const oe=(t=300)=>new Promise(g=>setTimeout(g,t)),yt=async(t={})=>{await oe();let g=[...te];if(t.stage&&(g=g.filter(s=>s.stage===t.stage)),t.assignee&&(g=g.filter(s=>s.assignee===t.assignee)),t.search){const s=t.search.toLowerCase();g=g.filter(l=>l.customer.name.toLowerCase().includes(s)||l.vehicle.brand.toLowerCase().includes(s)||l.vehicle.model.toLowerCase().includes(s))}return{data:g,total:g.length}},mt=async t=>{await oe();const g=te.find(s=>s.id===parseInt(t));if(!g)throw new Error("Opportunity not found");return g},gt=async t=>(await oe(),ce.filter(g=>g.opportunityId===parseInt(t))),ft=async t=>{await oe();const g={id:te.length+1,...t,createdAt:new Date().toISOString()};return te.push(g),g},he=async(t,g)=>{await oe();const s=te.findIndex(l=>l.id===parseInt(t));if(s===-1)throw new Error("Opportunity not found");return te[s]={...te[s],...g},te[s]},vt=async t=>{await oe();const g=te.findIndex(s=>s.id===parseInt(t));if(g===-1)throw new Error("Opportunity not found");return te.splice(g,1),{success:!0}},bt=async(t,g)=>{await oe();const s={id:ce.length+1,opportunityId:parseInt(t),timestamp:new Date().toISOString(),...g};return ce.push(s),s},xt=async(t,g,s)=>{await oe();const l=ce.find(n=>n.id===parseInt(g)&&n.opportunityId===parseInt(t));if(!l)throw new Error("Activity not found");return Object.assign(l,s,{timestamp:new Date().toISOString()}),l},ht=async(t,g)=>{await oe();const s=ce.findIndex(l=>l.id===parseInt(g)&&l.opportunityId===parseInt(t));if(s===-1)throw new Error("Activity not found");return ce.splice(s,1),{success:!0}},Ue=rt("opportunities",()=>{const t=$([]),g=$(null),s=$([]),l=$(!1),n=$(null),c=$({stage:null,assignee:null,search:""}),d=T(()=>t.value.length),y=T(()=>{const I={};return t.value.forEach(q=>{I[q.stage]||(I[q.stage]=[]),I[q.stage].push(q)}),I}),p=T(()=>t.value.reduce((I,q)=>I+q.value,0));async function i(){l.value=!0,n.value=null;try{const I=await yt(c.value);t.value=I.data}catch(I){n.value=I.message}finally{l.value=!1}}async function m(I){l.value=!0,n.value=null;try{g.value=await mt(I),s.value=await gt(I);const q=t.value.findIndex(b=>b.id===parseInt(I));q!==-1&&(t.value[q]=g.value)}catch(q){n.value=q.message}finally{l.value=!1}}async function r(I){l.value=!0,n.value=null;try{const q=await ft(I);return t.value.unshift(q),q}catch(q){throw n.value=q.message,q}finally{l.value=!1}}async function u(I,q){l.value=!0,n.value=null;try{const b=await he(I,q),O=t.value.findIndex(M=>M.id===I);return O!==-1&&(t.value[O]=b),b}catch(b){throw n.value=b.message,b}finally{l.value=!1}}async function k(I){l.value=!0,n.value=null;try{await vt(I),t.value=t.value.filter(q=>q.id!==I)}catch(q){throw n.value=q.message,q}finally{l.value=!1}}async function h(I,q){try{const b=await bt(I,q);return s.value.unshift(b),b}catch(b){throw n.value=b.message,b}}async function C(I,q,b){try{const O=await xt(I,q,b),M=s.value.findIndex(x=>x.id===parseInt(q));return M!==-1&&(s.value[M]=O),O}catch(O){throw n.value=O.message,O}}async function A(I,q){try{return await ht(I,q),s.value=s.value.filter(b=>b.id!==parseInt(q)),{success:!0}}catch(b){throw n.value=b.message,b}}function F(I){c.value={...c.value,...I},i()}async function R(I){var q;l.value=!0,n.value=null;try{const b=t.value.find(P=>P.id===I)||g.value,O={stage:"Qualified"};((b==null?void 0:b.probability)===0||(b==null?void 0:b.probability)===100)&&(O.probability=50);const M=await he(I,O),x=t.value.findIndex(P=>P.id===I);return x!==-1&&(t.value[x]=M),((q=g.value)==null?void 0:q.id)===I&&(g.value=M),await h(I,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${M.stage} stage`}),M}catch(b){throw n.value=b.message,b}finally{l.value=!1}}async function G(I){var q;l.value=!0,n.value=null;try{const b=await he(I,{stage:"Registration"}),O=t.value.findIndex(M=>M.id===I);return O!==-1&&(t.value[O]=b),((q=g.value)==null?void 0:q.id)===I&&(g.value=b),await h(I,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),b}catch(b){throw n.value=b.message,b}finally{l.value=!1}}async function se(I){var q;l.value=!0,n.value=null;try{const b=await he(I,{stage:"Closed",probability:100}),O=t.value.findIndex(M=>M.id===I);return O!==-1&&(t.value[O]=b),((q=g.value)==null?void 0:q.id)===I&&(g.value=b),await h(I,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),b}catch(b){throw n.value=b.message,b}finally{l.value=!1}}return{opportunities:t,currentOpportunity:g,currentOpportunityActivities:s,loading:l,error:n,filters:c,totalOpportunities:d,opportunitiesByStage:y,totalValue:p,loadOpportunities:i,loadOpportunityById:m,addOpportunity:r,modifyOpportunity:u,removeOpportunity:k,addActivity:h,updateActivity:C,deleteActivity:A,setFilters:F,reopenOpportunity:R,markAsRegistration:G,markAsClosedWon:se}}),wt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 max-h-[40vh] lg:max-h-none"},kt={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},Ct={class:"font-bold text-lg text-gray-800"},$t={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},St={class:"flex gap-2"},Dt={class:"px-5 py-3"},At={class:"relative"},It=["placeholder"],Ot={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Tt=["onClick"],qt=["onClick"],Nt={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Rt={class:"flex items-start gap-3.5 pr-6"},Mt={class:"flex-1 min-w-0"},jt={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Lt={class:"text-gray-600 text-xs mt-1 truncate"},Ft={class:"text-right shrink-0"},Vt={class:"flex items-center gap-2 flex-wrap mt-3"},Et={__name:"EntityListSidebar",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change"],setup(t,{emit:g}){const s={mounted(y,p){y.clickOutsideEvent=i=>{y===i.target||y.contains(i.target)||p.value()},document.addEventListener("click",y.clickOutsideEvent)},unmounted(y){document.removeEventListener("click",y.clickOutsideEvent)}},l=t,n=$(""),c=T(()=>{let y=l.items;if(l.typeFilter&&l.typeFilter!=="all"&&(y=y.filter(p=>p.type===l.typeFilter)),n.value){const p=n.value.toLowerCase();y=y.filter(i=>{const m=l.getName(i).toLowerCase(),r=l.getVehicleInfo(i).toLowerCase();return m.includes(p)||r.includes(p)})}return y}),d=y=>{const p=y.compositeId||`${y.type||"task"}-${y.id}`||y.id;return l.selectedId===p};return(y,p)=>(o(),a("div",wt,[e("div",kt,[e("h2",Ct,f(t.title),1),p[4]||(p[4]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[j(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(o(),a("div",$t,[e("div",St,[e("button",{onClick:p[0]||(p[0]=i=>y.$emit("filter-change","all")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:p[1]||(p[1]=i=>y.$emit("filter-change","lead")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:p[2]||(p[2]=i=>y.$emit("filter-change","opportunity")),class:N(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):v("",!0),e("div",Dt,[e("div",At,[p[5]||(p[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),E(e("input",{"onUpdate:modelValue":p[3]||(p[3]=i=>n.value=i),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,It),[[z,n.value]])])]),e("div",Ot,[(o(!0),a(Q,null,_(c.value,i=>(o(),a("div",{key:i.id,onClick:m=>y.$emit("select",i.compositeId||`${i.type||"task"}-${i.id}`||i.id),class:N(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",d(i)?typeof t.selectedClass=="function"?t.selectedClass(i):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(i):t.unselectedClass])},[t.showMenu?(o(),a("button",{key:0,onClick:K(m=>y.$emit("menu-click",i.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...p[6]||(p[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,qt)):v("",!0),t.openMenuId===i.id&&t.showMenu?E((o(),a("div",Nt,[ue(y.$slots,"menu",{item:i})])),[[s,()=>y.$emit("menu-close")]]):v("",!0),e("div",Rt,[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(i)])},f(t.getInitials(i)),3),e("div",Mt,[e("div",jt,f(t.getName(i)),1),e("div",Lt,f(t.getVehicleInfo(i)),1)]),e("div",Ft,[ue(y.$slots,"meta",{item:i}),ue(y.$slots,"footer",{item:i})])]),e("div",Vt,[ue(y.$slots,"badges",{item:i})])],10,Tt))),128))])]))}},Ut={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center gap-3"},Wt={key:1,class:"font-bold text-lg text-gray-800"},Bt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Pt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},zt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Qt={class:"text-sm"},Yt={key:2,class:"space-y-6 relative z-10"},Ht={key:0,class:"mb-4 pl-12"},Jt={class:"text-sm font-semibold text-gray-800"},Kt={class:"flex gap-4 relative mb-6"},Gt={class:"flex-1 min-w-0"},Xt={class:"text-sm text-slate-700 leading-snug"},Zt={class:"font-bold"},_t={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},es={class:"text-xs text-gray-400 mt-1"},ts={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0}},emits:["toggle-collapse"],setup(t,{emit:g}){const s=t,l=p=>{const i={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return i[p]||i.default},n=p=>{const i={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return i[p]||i.default},c=p=>{if(!p)return"";const i=new Date(p),m=new Date,r=new Date(m);return r.setDate(r.getDate()-1),i.toDateString()===m.toDateString()?"Today":i.toDateString()===r.toDateString()?"Yesterday":i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},d=p=>p?new Date(p).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",y=(p,i)=>{if(p===0)return!0;const m=s.activities[p-1];if(!m)return!0;const r=new Date(i.timestamp).toDateString(),u=new Date(m.timestamp).toDateString();return r!==u};return(p,i)=>t.show?(o(),a("div",{key:0,class:N(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",t.collapsed?"w-16":"w-80"])},[e("div",Ut,[t.showCollapse?(o(),a("button",{key:0,onClick:i[0]||(i[0]=m=>p.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:N(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):v("",!0),t.collapsed?v("",!0):(o(),a("h2",Wt,f(t.title),1))]),t.collapsed?v("",!0):(o(),a("div",Bt,[t.activities.length>0?(o(),a("div",Pt)):v("",!0),t.activities.length===0?(o(),a("div",zt,[i[1]||(i[1]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Qt,f(t.emptyMessage),1)])):(o(),a("div",Yt,[(o(!0),a(Q,null,_(t.activities,(m,r)=>(o(),a(Q,{key:m.id},[y(r,m)?(o(),a("div",Ht,[e("h3",Jt,f(c(m.timestamp)),1)])):v("",!0),e("div",Kt,[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",n(m.type)])},[e("i",{class:N([l(m.type),"text-sm"])},null,2)],2),e("div",Gt,[e("div",Xt,[e("span",Zt,f(m.user),1),j(" "+f(m.action),1)]),m.content?(o(),a("div",_t,f(m.content),1)):v("",!0),e("div",es,f(d(m.timestamp)),1)])])],64))),128))]))]))],2)):v("",!0)}},ss={class:"w-full"},os={class:"flex items-center justify-between gap-3 md:gap-4"},ns={class:"flex items-center gap-3 md:gap-4 flex-1"},as={class:"min-w-0 flex-1"},ls={class:"heading-main truncate"},rs={class:"flex flex-wrap items-center gap-2 mt-1"},is={class:"flex items-center gap-1 ml-2"},ds={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},us={class:"flex items-center gap-4"},cs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ps={class:"flex items-center gap-2"},ys={class:"text-xs text-gray-900 font-medium"},ms={class:"flex items-center gap-2"},gs={class:"text-xs text-gray-900 font-medium"},fs={class:"flex items-center gap-2"},vs={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},bs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},xs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},hs={class:"text-xs text-gray-900 font-medium"},ws={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ks={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},emits:["action"],setup(t,{emit:g}){const s=$(!1),l=$(null),n=async(c,d)=>{try{await navigator.clipboard.writeText(c),l.value=d,setTimeout(()=>{l.value=null},1500)}catch(y){console.error("Failed to copy:",y)}};return(c,d)=>(o(),a("div",ss,[e("div",os,[e("div",ns,[e("div",{class:N(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},f(t.initials),3),e("div",as,[e("h1",ls,f(t.name),1),e("div",rs,[ue(c.$slots,"tags")])])]),e("div",is,[d[3]||(d[3]=Me('<button class="btn-action-circle" title="Call"><i class="fa-solid fa-phone text-xs"></i></button><button class="btn-action-circle" title="Email"><i class="fa-regular fa-envelope text-xs"></i></button><button class="btn-action-circle" title="WhatsApp"><i class="fa-brands fa-whatsapp text-xs"></i></button><button class="btn-action-circle" title="SMS"><i class="fa-regular fa-comment-dots text-xs"></i></button>',4)),e("button",{onClick:d[0]||(d[0]=y=>s.value=!s.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:N(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":s.value}])},null,2)])])]),s.value?(o(),a("div",ds,[e("div",us,[e("div",cs,[e("div",ps,[d[5]||(d[5]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ys,f(t.email),1),e("button",{onClick:d[1]||(d[1]=K(y=>n(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...d[4]||(d[4]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ms,[d[7]||(d[7]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",gs,f(t.phone),1),e("button",{onClick:d[2]||(d[2]=K(y=>n(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...d[6]||(d[6]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",fs,[e("div",vs,[t.thirdFieldLabel.toLowerCase().includes("address")?(o(),a("i",bs)):(o(),a("i",xs))]),e("span",hs,f(t.thirdFieldValue),1)])])]),l.value?(o(),a("div",ws,f(l.value==="email"?"Email":"Phone")+" copied! ",1)):v("",!0)])):v("",!0)]))}},Cs={class:"flex gap-8 text-base font-medium text-slate-500 py-1 overflow-x-auto scrollbar-hide"},$s=["onClick"],Ss={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(g,s)=>(o(),a("div",Cs,[(o(!0),a(Q,null,_(t.tabs,l=>(o(),a("div",{key:l.key,onClick:n=>g.$emit("update:modelValue",l.key),class:N(["pb-2 border-b-2 cursor-pointer whitespace-nowrap transition-colors",t.modelValue===l.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[j(f(l.label)+" ",1),l.count!==void 0?(o(),a("span",{key:0,class:N(["ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===l.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},f(l.count),3)):v("",!0)],10,$s))),128))]))}},Ds={class:"metadata-bar w-full"},As={class:"flex items-center gap-2 px-3 py-1.5"},Is={class:"text-xs font-bold text-gray-800"},Os={key:0,class:"flex items-center gap-2 px-3 py-1.5"},Ts={class:"flex items-center gap-2"},qs={class:"w-16 bg-gray-200 rounded-full h-2"},Ns={class:"text-xs font-bold text-gray-800"},Rs={key:1,class:"metadata-divider"},Ms={class:"flex items-center gap-2 px-3 py-1.5"},js={class:"text-xs font-bold text-gray-800"},Ls={class:"flex items-center gap-2 px-3 py-1.5"},Fs={class:"text-xs font-bold text-gray-800"},Vs={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},probability:{type:Number,default:null}},setup(t){const g=t,s=T(()=>g.probability!==null&&g.probability!==void 0),l=T(()=>g.probability>=70?"bg-green-500":g.probability>=40?"bg-orange-500":"bg-red-500");return(n,c)=>(o(),a("div",Ds,[e("div",As,[c[0]||(c[0]=e("span",{class:"label-upper"},"Stage",-1)),e("span",Is,f(t.stage),1)]),c[5]||(c[5]=e("div",{class:"metadata-divider"},null,-1)),s.value?(o(),a("div",Os,[c[1]||(c[1]=e("span",{class:"label-upper"},"Probability",-1)),e("div",Ts,[e("div",qs,[e("div",{class:N(["h-2 rounded-full transition-all",l.value]),style:je({width:t.probability+"%"})},null,6)]),e("span",Ns,f(t.probability)+"%",1)])])):v("",!0),s.value?(o(),a("div",Rs)):v("",!0),e("div",Ms,[c[2]||(c[2]=e("span",{class:"label-upper"},"Owner",-1)),e("span",js,f(t.owner),1)]),t.source?(o(),a(Q,{key:2},[c[4]||(c[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Ls,[c[3]||(c[3]=e("span",{class:"label-upper"},"Source",-1)),e("span",Fs,f(t.source),1)])],64)):v("",!0)]))}},Es={key:0,class:"flex-grow border-t border-gray-200"},Us={key:0,class:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Ws={key:0,class:"border-t border-gray-100 my-1"},Bs={key:1,class:"flex-grow border-t border-gray-200"},Ne={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:g}){const s={mounted(k,h){k.clickOutsideEvent=C=>{k===C.target||k.contains(C.target)||h.value()},document.addEventListener("click",k.clickOutsideEvent)},unmounted(k){document.removeEventListener("click",k.clickOutsideEvent)}},l=t,n=g,c=$(!1),d=T(()=>l.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-1.5 text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),y={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},p=T(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(h=>!y[h]);const k=Object.entries(y).filter(([,h])=>h===l.activeTab).map(([h])=>h);return l.actions.filter(h=>k.includes(h))}),i=T(()=>p.value.some(k=>["email","whatsapp","sms"].includes(k))),m=T(()=>p.value.some(k=>["addVehicle","configureVehicle"].includes(k))),r=T(()=>p.value.some(k=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(k))),u=k=>{c.value=!1,n("action",k)};return(k,h)=>t.show?(o(),a("div",{key:0,class:N(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?v("",!0):(o(),a("div",Es)),e("div",{class:N(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:h[0]||(h[0]=K(C=>c.value=!c.value,["stop"])),class:N(d.value)},[...h[12]||(h[12]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),j(" Add new ",-1)])],2),c.value?E((o(),a("div",Us,[m.value?(o(),a(Q,{key:0},[p.value.includes("addVehicle")?(o(),a("button",{key:0,onClick:h[1]||(h[1]=C=>u("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):v("",!0),p.value.includes("configureVehicle")?(o(),a("button",{key:1,onClick:h[2]||(h[2]=C=>u("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):v("",!0)],64)):v("",!0),r.value?(o(),a(Q,{key:1},[m.value?(o(),a("div",Ws)):v("",!0),p.value.includes("note")?(o(),a("button",{key:1,onClick:h[3]||(h[3]=C=>u("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):v("",!0),p.value.includes("financing")?(o(),a("button",{key:2,onClick:h[4]||(h[4]=C=>u("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):v("",!0),p.value.includes("tradein")?(o(),a("button",{key:3,onClick:h[5]||(h[5]=C=>u("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):v("",!0),p.value.includes("requestedCar")?(o(),a("button",{key:4,onClick:h[6]||(h[6]=C=>u("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):v("",!0),p.value.includes("purchase")?(o(),a("button",{key:5,onClick:h[7]||(h[7]=C=>u("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):v("",!0),p.value.includes("attachment")?(o(),a("button",{key:6,onClick:h[8]||(h[8]=C=>u("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):v("",!0)],64)):v("",!0),i.value?(o(),a(Q,{key:2},[h[16]||(h[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),p.value.includes("email")?(o(),a("button",{key:0,onClick:h[9]||(h[9]=C=>u("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[13]||(h[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),j(" Send Email ",-1)])])):v("",!0),p.value.includes("whatsapp")?(o(),a("button",{key:1,onClick:h[10]||(h[10]=C=>u("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[14]||(h[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),j(" Send WhatsApp ",-1)])])):v("",!0),p.value.includes("sms")?(o(),a("button",{key:2,onClick:h[11]||(h[11]=C=>u("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...h[15]||(h[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),j(" Send SMS ",-1)])])):v("",!0)],64)):v("",!0)])),[[s,()=>c.value=!1]]):v("",!0)],2),t.inline?v("",!0):(o(),a("div",Bs))],2)):v("",!0)}},Ps={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},zs={class:"flex items-start gap-3"},Qs={class:"flex-1 min-w-0"},Ys={class:"font-bold text-sm text-slate-800 mb-2"},Hs={class:"space-y-1.5 text-xs text-gray-600"},Js={class:"flex items-center gap-2"},Ks={class:"flex items-center gap-2"},Gs={class:"flex items-center gap-2"},Xs={key:0,class:"mt-2"},Zs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const g=t,s=T(()=>g.appointmentData.date?new Date(g.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),l=T(()=>g.appointmentData.time?g.appointmentData.time:""),n=c=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[c==null?void 0:c.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(c,d)=>(o(),a("div",Ps,[e("div",zs,[d[3]||(d[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Qs,[e("h4",Ys,f(t.appointmentData.type),1),e("div",Hs,[e("div",Js,[d[0]||(d[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,f(s.value),1)]),e("div",Ks,[d[1]||(d[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,f(l.value),1)]),e("div",Gs,[d[2]||(d[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,f(t.appointmentData.assignee),1)])]),t.appointmentData.status?(o(),a("div",Xs,[e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",n(t.appointmentData.status)])},f(t.appointmentData.status),3)])):v("",!0)])])]))}},_s={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},eo={class:"flex-1"},to={class:"flex items-center gap-2 mb-1"},so={class:"text-xs font-bold text-slate-800"},oo={class:"text-[10px] text-gray-400"},no={class:"text-[10px] text-gray-400"},ao={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},lo={class:"ml-auto flex items-center gap-2"},ro={key:0,class:"text-sm text-slate-700"},io={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},uo={key:2,class:"mt-2"},co={key:0},po={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},yo={key:0,class:"flex justify-between items-start"},mo={class:"text-sm font-bold text-slate-800"},go={class:"text-xs text-gray-500 mt-1 flex gap-3"},fo={key:0},vo={key:1},bo={key:1,class:"flex justify-between items-center mb-2"},xo={class:"text-sm font-bold text-slate-800"},ho={key:2,class:"flex items-center gap-3"},wo={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},ko=["src"],Co={class:"flex-1"},$o={class:"text-sm font-bold text-slate-800"},So={class:"text-xs text-gray-500"},Do={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Ao={key:3,class:"flex items-center gap-3"},Io={class:"flex-1"},Oo={class:"text-sm font-bold text-slate-800"},To={class:"text-xs text-gray-500"},qo={key:0,class:"text-xs text-gray-400 mt-1"},No={key:1,class:"text-xs text-gray-600 mt-1"},Ro={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:g}){const s=t,l=g;$(!1);const n=m=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[m]||"fa-solid fa-circle",c=m=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[m]||"bg-gray-100 text-gray-600 border-gray-200",d=m=>{if(!m)return"Just now";const r=new Date(m),k=new Date-r,h=Math.floor(k/6e4),C=Math.floor(h/60),A=Math.floor(C/24);return h<1?"Just now":h<60?`${h} minutes ago`:C<24?`${C} hours ago`:A===1?"Yesterday":A<7?`${A} days ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},y=m=>m?new Intl.NumberFormat("en-US").format(m):"0",p=m=>m?new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",i=()=>{confirm("Are you sure you want to delete this item?")&&l("delete",s.item)};return(m,r)=>(o(),a("div",_s,[e("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",c(t.item.type)])},[e("i",{class:N([n(t.item.type),"text-sm"])},null,2)],2),e("div",eo,[e("div",to,[e("span",so,f(t.customerInitials),1),e("span",oo,f(t.item.action||"added"),1),e("span",no,"• "+f(d(t.item.timestamp)),1),t.item.autoDetected?(o(),a("span",ao,"Auto-detected")):v("",!0),e("div",lo,[e("button",{onClick:r[0]||(r[0]=u=>m.$emit("edit",t.item)),class:"text-gray-400 hover:text-blue-600 transition-colors p-1",title:"Edit"},[...r[1]||(r[1]=[e("i",{class:"fa-solid fa-pencil text-xs"},null,-1)])]),e("button",{onClick:i,class:"text-gray-400 hover:text-red-600 transition-colors p-1",title:"Delete"},[...r[2]||(r[2]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])])])]),t.item.content?(o(),a("div",ro,f(t.item.content),1)):v("",!0),t.item.fileName?(o(),a("div",io,[r[3]||(r[3]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,f(t.item.fileName),1)])):v("",!0),t.item.data?(o(),a("div",uo,[t.item.type==="appointment"?(o(),a("div",co,[B(Zs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(o(),a("div",po,[t.item.type==="tradein"?(o(),a("div",yo,[e("div",null,[e("h4",mo,f(t.item.data.brand)+" "+f(t.item.data.model),1),e("div",go,[t.item.data.year?(o(),a("span",fo,[r[4]||(r[4]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),j(f(t.item.data.year),1)])):v("",!0),t.item.data.km?(o(),a("span",vo,[r[5]||(r[5]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),j(f(t.item.data.km)+" km",1)])):v("",!0)])]),r[6]||(r[6]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Pending Eval",-1))])):t.item.type==="financing"?(o(),a("div",bo,[e("h4",xo,f(t.item.data.product),1),r[7]||(r[7]=e("span",{class:"bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded"},"Draft",-1))])):t.item.type==="offer"?(o(),a("div",ho,[t.item.data.image?(o(),a("div",wo,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ko)])):v("",!0),e("div",Co,[e("h4",$o,f(t.item.data.brand)+" "+f(t.item.data.model)+" ("+f(t.item.data.year)+")",1),e("p",So,"€ "+f(y(t.item.data.price)),1)]),t.item.data.isMainOffer?(o(),a("span",Do,"Main Offer")):v("",!0)])):t.item.type==="purchase"?(o(),a("div",Ao,[e("div",Io,[e("h4",Oo,f(t.item.data.brand)+" "+f(t.item.data.model)+" ("+f(t.item.data.year)+")",1),e("p",To,"€ "+f(y(t.item.data.price)),1),t.item.data.purchaseDate?(o(),a("p",qo,"Purchased: "+f(p(t.item.data.purchaseDate)),1)):v("",!0),t.item.data.notes?(o(),a("p",No,f(t.item.data.notes),1)):v("",!0)])])):v("",!0)]))])):v("",!0)])]))}},Mo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},jo={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},Lo={class:"mb-3"},Fo={class:"flex justify-end gap-2"},Vo={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(""),c=$(""),d=()=>{!n.value.trim()&&!c.value||l("save",{type:"communication",action:`sent via ${s.type}`,content:n.value||`Sent template: ${c.value}`,communicationType:s.type})};return(y,p)=>(o(),a("div",Mo,[p[5]||(p[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",jo,f(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",Lo,[p[4]||(p[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),E(e("select",{"onUpdate:modelValue":p[0]||(p[0]=i=>c.value=i),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...p[3]||(p[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[pe,c.value]])]),E(e("textarea",{"onUpdate:modelValue":p[1]||(p[1]=i=>n.value=i),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[z,n.value]]),e("div",Fo,[e("button",{onClick:p[2]||(p[2]=i=>y.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:d,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},Eo={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Uo={class:"flex justify-between items-center mb-4"},Wo={class:"text-sm font-bold text-slate-800"},Bo={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Po={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$("");me(()=>{s.item&&(n.value=s.item.content||"")});const c=()=>{var d,y;n.value.trim()&&l("save",{id:((d=s.item)==null?void 0:d.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:n.value,timestamp:((y=s.item)==null?void 0:y.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(d,y)=>(o(),a("div",Eo,[y[5]||(y[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Uo,[e("h5",Wo,f(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:y[0]||(y[0]=p=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...y[3]||(y[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[y[4]||(y[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),E(e("textarea",{"onUpdate:modelValue":y[1]||(y[1]=p=>n.value=p),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[z,n.value]])]),e("div",Bo,[e("button",{onClick:y[2]||(y[2]=p=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},zo={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Qo={class:"flex justify-between items-center mb-4"},Yo={class:"text-sm font-bold text-slate-800"},Ho={class:"flex items-center gap-3"},Jo={key:0,class:"text-sm text-slate-600"},Ko={key:1,class:"text-sm text-gray-400"},Go={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Xo=["disabled"],Zo={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(null),c=$("");me(()=>{s.item&&(c.value=s.item.fileName||"")});const d=p=>{const i=p.target.files[0];i&&(n.value=i,c.value=i.name)},y=()=>{var p,i;!n.value&&!s.item||l("save",{id:((p=s.item)==null?void 0:p.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:c.value,timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(p,i)=>(o(),a("div",zo,[i[6]||(i[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Qo,[e("h5",Yo,f(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:i[0]||(i[0]=m=>p.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[i[5]||(i[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",Ho,[e("input",{type:"file",onChange:d,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:i[1]||(i[1]=m=>p.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),j("Choose File ",-1)])]),c.value?(o(),a("span",Jo,f(c.value),1)):(o(),a("span",Ko,"No file selected"))])]),e("div",Go,[e("button",{onClick:i[2]||(i[2]=m=>p.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:y,disabled:!n.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Xo)])]))}},_o=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function en(t){const{store:g,taskId:s,getTabForItemType:l,isOverviewModalAction:n}=t,c=$("overview"),d=$(null),y=$(null),p=$("email"),i=$([]),m=T(()=>[...g.currentActivities.value,...i.value.filter(F=>!F.activityId)].filter(F=>{const R=l(F.type);return c.value==="overview"?R==="overview":R===c.value})),r=A=>(y.value=null,c.value==="overview"&&n(A)?{modalAction:A}:(["email","whatsapp","sms"].includes(A)?(p.value=A,d.value="communication"):d.value=A,null)),u=async A=>{var F;if(A.isEdit){const R=i.value.findIndex(G=>G.id===A.id);R>-1&&(i.value[R]={...i.value[R],...A}),(F=y.value)!=null&&F.activityId&&await g.updateActivity(s.value,y.value.activityId,{type:A.communicationType||A.type,user:"You",action:A.action,content:A.content,fileName:A.fileName,data:A.data})}else{const R=A.communicationType||A.type,G=await g.addActivity(s.value,{type:R,user:"You",action:A.action,content:A.content,fileName:A.fileName,data:A.data});i.value.push({id:G.id,type:R==="email"||R==="whatsapp"||R==="sms"?"communication":R,action:A.action,content:A.content,fileName:A.fileName,data:A.data,timestamp:G.timestamp,activityId:G.id})}d.value=null,y.value=null},k=()=>{d.value=null,y.value=null},h=A=>{y.value=A,d.value=A.type},C=async A=>{const F=i.value.findIndex(R=>R.id===A.id);F>-1&&i.value.splice(F,1),A.activityId&&await g.deleteActivity(s.value,A.activityId)};return ae(c,()=>{d.value=null,y.value=null}),{activeTab:c,showInlineWidget:d,editingItem:y,communicationType:p,inlineContent:i,filteredInlineContent:m,handleAddNewAction:r,handleWidgetSave:u,handleWidgetCancel:k,handleEditItem:h,handleDeleteItem:C}}const tn={class:"flex-1 flex flex-col overflow-hidden"},sn={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},on={class:"px-4 md:px-8 py-4 md:py-6"},nn={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},an={class:"flex items-center justify-between mb-4"},ln={key:0,class:"mb-6"},rn={key:1,class:"space-y-6 mb-6"},dn={key:3},un={key:4,class:"space-y-4 mb-6 px-1"},cn={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const g=t,s=T(()=>g.task.id),{activeTab:l,showInlineWidget:n,editingItem:c,communicationType:d,inlineContent:y,filteredInlineContent:p,handleAddNewAction:i,handleWidgetSave:m,handleWidgetCancel:r,handleEditItem:u,handleDeleteItem:k}=en({store:g.storeAdapter,taskId:s,getTabForItemType:_o,isOverviewModalAction:A=>l.value==="overview"&&g.addNewConfig.overviewActions.includes(A)}),h=T(()=>{const A=[...g.storeAdapter.currentActivities.value,...y.value],F=A.length,R=A.filter(I=>["call","email","sms","whatsapp","communication"].includes(I.type)).length,G=A.filter(I=>I.type==="note").length,se=A.filter(I=>I.type==="attachment").length;return[{key:"overview",label:"Overview",count:F},{key:"note",label:"Notes",count:G},{key:"communication",label:"Communication",count:R},{key:"attachment",label:"Attachments",count:se}]}),C=T(()=>[...g.storeAdapter.currentActivities.value,...y.value]);return(A,F)=>(o(),a("div",tn,[e("header",sn,[e("div",on,[B(ks,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:ve(()=>[(o(!0),a(Q,null,_(t.task.tags,R=>(o(),a("span",{key:R,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},f(R),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class"])])]),e("main",nn,[e("div",an,[B(Ss,{modelValue:U(l),"onUpdate:modelValue":F[0]||(F[0]=R=>it(l)?l.value=R:null),tabs:h.value,class:"mb-0"},null,8,["modelValue","tabs"]),U(l)==="overview"&&t.addNewConfig.overviewActions.length?(o(),W(Ne,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":U(l),inline:!0,onAction:U(i)},null,8,["actions","active-tab","onAction"])):v("",!0)]),U(l)==="overview"?(o(),a("div",ln,[B(Vs,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||"",probability:t.task.probability},null,8,["stage","owner","source","probability"])])):v("",!0),U(l)==="overview"?(o(),a("div",rn,[(o(),W(dt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:C.value},null,8,["lead","opportunity","activities"])),ue(A.$slots,"pinned-extra",{task:t.task})])):v("",!0),U(l)!=="overview"?(o(),W(Ne,{key:2,actions:t.addNewConfig.tabActions,"active-tab":U(l),onAction:U(i)},null,8,["actions","active-tab","onAction"])):v("",!0),U(l)!=="overview"?(o(),a("div",dn,[U(n)==="communication"?(o(),W(Vo,{key:0,type:U(d),"task-type":t.type,"task-id":t.task.id,onSave:U(m),onCancel:U(r)},null,8,["type","task-type","task-id","onSave","onCancel"])):v("",!0),U(n)==="note"?(o(),W(Po,{key:1,item:U(c),"task-type":t.type,"task-id":t.task.id,onSave:U(m),onCancel:U(r)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0),U(n)==="attachment"?(o(),W(Zo,{key:2,item:U(c),"task-type":t.type,"task-id":t.task.id,onSave:U(m),onCancel:U(r)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0)])):v("",!0),U(p).length>0?(o(),a("div",un,[(o(!0),a(Q,null,_(U(p),R=>(o(),W(Ro,{key:R.id,item:R,"task-type":t.type,"customer-initials":"SK",onEdit:U(u),onDelete:U(k)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):v("",!0)])]))}},pn={key:0,class:"mb-8"},yn={class:"flex items-center gap-2 mb-4"},mn={class:"font-bold text-gray-800 text-sm"},gn={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 group overflow-hidden"},fn={class:"block p-4 cursor-pointer select-none bg-white hover:bg-gray-50 transition-colors"},vn={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},bn={class:"text-sm text-slate-700 leading-snug"},xn={class:"flex items-center justify-between"},hn={class:"flex items-center gap-4"},wn={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},kn=["src"],Cn={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},$n={class:"flex items-center gap-2"},Sn={class:"font-bold text-slate-800 text-sm md:text-base"},Dn={class:"mt-1.5"},An={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},In={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},On={class:"flex items-center gap-4"},Tn={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},qn={key:1,class:"text-right"},Nn={class:"font-bold text-slate-800"},Rn={class:"border-t border-gray-100 p-6 bg-gray-50/30 content-sweep text-sm"},Mn={class:"mb-6"},jn={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ln={key:0},Fn={class:"font-medium text-slate-700"},Vn={key:1},En={class:"font-medium text-slate-700"},Un={key:2},Wn={class:"font-medium text-slate-700"},Bn={class:"font-medium text-slate-700"},Pn={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},zn={key:0},Qn={class:"font-medium text-slate-700"},Yn={key:1},Hn={class:"font-medium text-slate-700"},Jn={key:2},Kn={class:"font-medium text-slate-700"},Gn={key:3},Xn={class:"font-medium text-slate-700"},Zn={key:4},_n={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},ea={key:5},ta={class:"font-medium text-slate-700"},sa={key:0,class:"mt-6 flex justify-end"},oa={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const g=l=>new Intl.NumberFormat("en-US").format(l),s=l=>new Intl.NumberFormat("en-US").format(l);return(l,n)=>t.show?(o(),a("div",pn,[e("div",yn,[n[0]||(n[0]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",mn,f(t.label),1)]),e("details",gn,[e("summary",fn,[t.requestMessage?(o(),a("div",vn,[n[1]||(n[1]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",bn,f(t.requestMessage),1)])):v("",!0),e("div",xn,[e("div",hn,[e("div",wn,[t.image?(o(),a("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,kn)):(o(),a("i",Cn))]),e("div",null,[e("div",$n,[e("div",Sn,f(t.brand)+" "+f(t.model)+" ("+f(t.year)+")",1)]),e("div",Dn,[t.stockDays!==void 0&&t.stockDays!==null?(o(),a("div",An,[n[2]||(n[2]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),j(" In stock ("+f(t.stockDays)+" days) ",1)])):(o(),a("div",In,[...n[3]||(n[3]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),j(" Out of stock ",-1)])]))])])]),e("div",On,[t.showOpenAd&&t.price?(o(),a("button",Tn,[...n[4]||(n[4]=[j(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):v("",!0),t.price?(o(),a("div",qn,[n[5]||(n[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",Nn,"€ "+f(g(t.price)),1)])):v("",!0),n[6]||(n[6]=e("i",{class:"fa-solid fa-chevron-down chevron-car text-gray-400 text-sm ml-2"},null,-1))])])]),e("div",Rn,[e("div",Mn,[n[17]||(n[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",jn,[t.requestType?(o(),a("div",Ln,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Fn,f(t.requestType),1)])):v("",!0),t.source?(o(),a("div",Vn,[n[8]||(n[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",En,f(t.source),1)])):v("",!0),e("div",null,[n[9]||(n[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:N(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},f(t.sourceDetails||"--"),3)]),t.dealership?(o(),a("div",Un,[n[10]||(n[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Wn,f(t.dealership),1)])):v("",!0),e("div",null,[n[11]||(n[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Bn,f(t.channel||"Email"),1)]),e("div",null,[n[12]||(n[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:N(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},f(t.adCampaign||"--"),3)]),e("div",null,[n[13]||(n[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:N(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},f(t.adMedium||"--"),3)]),e("div",null,[n[14]||(n[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:N(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},f(t.adSource||"--"),3)]),e("div",null,[n[15]||(n[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:N(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},f(t.expectedPurchaseDate||"--"),3)]),e("div",null,[n[16]||(n[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:N(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},f(t.fiscalEntity||"--"),3)])])]),n[26]||(n[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[n[25]||(n[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Pn,[t.registration?(o(),a("div",zn,[n[18]||(n[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Qn,f(t.registration),1)])):v("",!0),t.kilometers!==void 0&&t.kilometers!==null?(o(),a("div",Yn,[n[19]||(n[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Hn,f(s(t.kilometers))+" Km",1)])):v("",!0),t.fuelType?(o(),a("div",Jn,[n[20]||(n[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Kn,f(t.fuelType),1)])):v("",!0),t.gearType?(o(),a("div",Gn,[n[21]||(n[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Xn,f(t.gearType),1)])):v("",!0),t.vin?(o(),a("div",Zn,[n[22]||(n[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",_n,f(t.vin),1)])):v("",!0),t.dealership?(o(),a("div",ea,[n[23]||(n[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",ta,f(t.dealership),1)])):v("",!0)]),t.showTechnicalSpecs?(o(),a("div",sa,[...n[24]||(n[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),j(" View technical specs ")],-1)])])):v("",!0)])])])])):v("",!0)}},Re=Le(oa,[["__scopeId","data-v-b2c30deb"]]),na={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},aa={class:"grid grid-cols-3 gap-3 mb-4"},la={class:"flex gap-3 mb-4"},We={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:g}){const s=g,l=$(null),n=$(""),c=$(""),d=i=>{l.value=i;const m=new Date;if(i==="later-today"){const r=new Date(m.getTime()+72e5);n.value=r.toISOString().split("T")[0],c.value=r.toTimeString().slice(0,5)}else if(i==="tomorrow"){const r=new Date(m);r.setDate(r.getDate()+1),n.value=r.toISOString().split("T")[0],c.value="09:00"}else if(i==="next-week"){const r=new Date(m);r.setDate(r.getDate()+(7-r.getDay()+1)),n.value=r.toISOString().split("T")[0],c.value="09:00"}},y=()=>{s("confirm",{date:n.value,time:c.value,option:l.value}),s("close"),l.value=null,n.value="",c.value=""},p=()=>{s("close"),l.value=null,n.value="",c.value=""};return(i,m)=>t.show?(o(),a("div",na,[m[8]||(m[8]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},"Reschedule to...",-1)),e("div",aa,[e("button",{onClick:m[0]||(m[0]=r=>d("later-today")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":l.value==="later-today"}])},[...m[5]||(m[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:m[1]||(m[1]=r=>d("tomorrow")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":l.value==="tomorrow"}])},[...m[6]||(m[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:m[2]||(m[2]=r=>d("next-week")),class:N(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":l.value==="next-week"}])},[...m[7]||(m[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",la,[E(e("input",{"onUpdate:modelValue":m[3]||(m[3]=r=>n.value=r),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[z,n.value]]),E(e("input",{"onUpdate:modelValue":m[4]||(m[4]=r=>c.value=r),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[z,c.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:p,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:y,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):v("",!0)}},ra={key:0,class:"space-y-4 animate-fade-in"},ia={key:0,class:"animate-fade-in"},da={class:"grid grid-cols-4 gap-2"},ua=["onClick"],Be={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(""),c=$("Michael Thomas (Me)"),d=$(""),y=$(!1),p=$("");ae(()=>s.show,u=>{u||i()});const i=()=>{n.value="",c.value="Michael Thomas (Me)",d.value="",y.value=!1,p.value=""},m=()=>{!n.value||!d.value||!p.value||(l("confirm",{type:n.value,assignee:c.value,date:d.value,time:p.value}),i())},r=()=>{i(),l("cancel")};return(u,k)=>t.show?(o(),a("div",ra,[e("div",null,[k[5]||(k[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),E(e("select",{"onUpdate:modelValue":k[0]||(k[0]=h=>n.value=h),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...k[4]||(k[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[pe,n.value]])]),e("div",null,[k[7]||(k[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),E(e("select",{"onUpdate:modelValue":k[1]||(k[1]=h=>c.value=h),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...k[6]||(k[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[pe,c.value]])]),e("div",null,[k[8]||(k[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":k[2]||(k[2]=h=>d.value=h),onChange:k[3]||(k[3]=h=>y.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[z,d.value]])]),y.value?(o(),a("div",ia,[k[9]||(k[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",da,[(o(),a(Q,null,_(["09:00","10:30","11:00","14:30","15:00","16:30"],h=>e("button",{key:h,onClick:C=>p.value=h,class:N(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",p.value===h?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},f(h),11,ua)),64))])])):v("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:r,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:m,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...k[10]||(k[10]=[j(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):v("",!0)}},ca={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},pa={class:"p-5 space-y-6"},ya={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},ma={class:"flex justify-between items-start mb-3"},ga={class:"text-xs text-gray-500 mt-0.5"},fa={class:"flex items-center gap-2 text-orange-600 bg-white border border-orange-100 px-2 py-1 rounded text-xs font-semibold shadow-sm transition-colors"},va={key:0},ba={key:1},xa={class:"flex gap-3 flex-wrap"},ha={key:0,class:"mt-4 bg-slate-900 border border-slate-700 rounded-lg p-4 shadow-inner relative overflow-hidden"},wa={class:"flex justify-between items-center mb-3 border-b border-slate-700 pb-2"},ka={class:"flex items-center gap-1.5"},Ca={class:"text-xs font-mono text-red-400"},$a={class:"space-y-2 h-32 overflow-y-auto flex flex-col justify-end scrollbar-hide"},Sa={class:"font-bold"},Da={key:1,class:"mt-3 space-y-2"},Aa={class:"text-xs text-slate-600 leading-relaxed"},Ia={key:2,class:"mt-3 relative z-10"},Oa={class:"relative"},Ta=["onKeyup"],qa={key:3,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4"},Na=["disabled"],Ra={key:0,class:"fa-solid fa-spinner fa-spin"},Ma={key:1,class:"fa-solid fa-magic"},ja={class:"bg-gray-50 border-t border-gray-200"},La={class:"p-4 flex justify-end gap-3"},Fa={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Va={class:"mb-5"},Ea={class:"flex flex-col gap-2"},Ua={class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},Wa=["checked"],Ba={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},setup(t){const g=t,s=Fe(),l=$(!1),n=$(!1),c=$(!1),d=$(!1),y=$([]),p=$(0),i=$([]),m=$(""),r=$("qualify"),u=$(null),k=$(null),h=$(0),C=$(!1),A=$([]),F=$(!1),R=[{speaker:"Sales",text:"Good morning, am I speaking with Mr. Adams?"},{speaker:"Lead",text:"Yes, this is Josh Adams speaking."},{speaker:"Sales",text:"Hi Josh, Michael here regarding your Audi A6 inquiry."},{speaker:"Lead",text:"Oh, hi Michael! Yes, I was waiting for your call."},{speaker:"Sales",text:"Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"},{speaker:"Lead",text:"Yes, I actually have a BMW X3, 2018 model with about 45,000 km.",action:{type:"tradein",data:{brand:"BMW",model:"X3",year:"2018",km:"45,000",auto:!0}}},{speaker:"Sales",text:"Excellent, we can certainly evaluate that. And regarding payment?"},{speaker:"Lead",text:"I'd like to put down €5,000 and finance the rest over 3 years.",action:{type:"financing",data:{product:"Standard Loan",provider:"Audi Financial",total:"14,000",monthly:"420",auto:!0}}},{speaker:"Sales",text:"Understood. I'll note that down and prepare the proposal.",action:{type:"note",data:"Customer requests 3-year financing with €5k deposit."}},{speaker:"Lead",text:"Sounds amazing. Let's proceed with the paperwork."}],G=V=>{const D=Math.floor(V/60),Y=V%60;return`${D.toString().padStart(2,"0")}:${Y.toString().padStart(2,"0")}`},se=()=>{d.value=!d.value,d.value?(p.value=0,h.value=0,i.value=[],C.value=!1,A.value=[],u.value=setInterval(()=>{p.value++},1e3),k.value=setInterval(()=>{if(h.value<R.length){const V=R[h.value];i.value.push({speaker:V.speaker,text:V.text}),h.value++,i.value.length>4&&i.value.shift()}else clearInterval(k.value),clearInterval(u.value),C.value=!0,I()},2500)):(u.value&&clearInterval(u.value),k.value&&clearInterval(k.value),C.value=!1,y.value.length>0&&I())},I=async()=>{for(const V of y.value)await s.addActivity(g.lead.id,{type:"note",user:"You",action:"added a note",content:V});y.value=[]},q=async()=>{F.value=!0,await new Promise(V=>setTimeout(V,800));for(let V=0;V<R.length;V++){const D=R[V];D.action&&!A.value.includes(V)&&(D.action.type==="tradein"?x(D.action.data):D.action.type==="financing"?P(D.action.data):D.action.type==="note"&&M(D.action.data),A.value.push(V))}F.value=!1,d.value=!1,C.value=!1},b=()=>{navigator.clipboard.writeText(g.lead.customer.phone)},O=()=>{m.value.trim()&&(y.value.push(m.value),m.value="")},M=V=>{s.addActivity(g.lead.id,{type:"note",user:"You",action:"added a note",content:V,data:{autoDetected:!0}})},x=V=>{s.addActivity(g.lead.id,{type:"tradein",user:"You",action:"added a trade-in",data:{...V,autoDetected:V.auto||!1}})},P=V=>{s.addActivity(g.lead.id,{type:"financing",user:"You",action:"added a financing proposal",data:{...V,autoDetected:V.auto||!1}})},be=()=>{l.value=!l.value,n.value=!1},xe=()=>{n.value=!n.value,l.value=!1},we=V=>{l.value=!1},ke=V=>{r.value="qualify",n.value=!1},Ce=()=>{n.value=!1},$e=async()=>{try{await s.requalifyLead(g.lead.id),await s.loadLeadById(g.lead.id)}catch(V){console.error("Failed to requalify lead:",V)}};return(V,D)=>t.lead?(o(),a("div",ca,[D[27]||(D[27]=Me('<div class="p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"><div class="flex items-center gap-2"><i class="fa-solid fa-thumbtack text-gray-400 text-xs"></i><h3 class="font-bold text-slate-800 text-sm">Manage Next steps</h3></div><span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium">Task pending</span></div>',1)),e("div",pa,[e("div",ya,[e("div",ma,[e("div",null,[D[7]||(D[7]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Initial Contact",-1)),e("p",ga," Call customer to discuss "+f(t.lead.requestedCar.brand)+" "+f(t.lead.requestedCar.model)+" interest. ",1)]),e("div",fa,[d.value?(o(),a("span",ba,[...D[9]||(D[9]=[j("In Call ",-1),e("i",{class:"fa-solid fa-phone-volume animate-pulse"},null,-1)])])):(o(),a("span",va,[...D[8]||(D[8]=[j("To be contacted ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]))])]),e("div",xa,[e("button",{onClick:se,class:"bg-slate-700 hover:bg-slate-800 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[j(f(t.lead.customer.phone)+" Call ",1),D[10]||(D[10]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1))]),e("button",{onClick:b,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...D[11]||(D[11]=[j(" Copy number ",-1),e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),d.value&&!C.value?(o(),a("div",ha,[e("div",wa,[D[13]||(D[13]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-wave-square text-blue-400 text-xs"}),e("span",{class:"text-[10px] font-bold uppercase text-slate-400 tracking-wider"},"Transcribing")],-1)),e("div",ka,[D[12]||(D[12]=e("span",{class:"relative flex h-2 w-2"},[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})],-1)),e("span",Ca,"REC "+f(G(p.value)),1)])]),e("div",$a,[(o(!0),a(Q,null,_(i.value,(Y,ge)=>(o(),a("div",{key:ge,class:N(["text-xs font-mono transition-all duration-500",Y.speaker==="Sales"?"text-gray-400":"text-slate-300"])},[e("span",Sa,f(Y.speaker)+":",1),D[14]||(D[14]=j()),e("span",null,f(Y.text),1)],2))),128))])])):v("",!0),d.value&&!C.value&&y.value.length>0?(o(),a("div",Da,[(o(!0),a(Q,null,_(y.value,(Y,ge)=>(o(),a("div",{key:ge,class:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm animate-fade-in"},[D[15]||(D[15]=e("div",{class:"flex items-center gap-2 mb-1"},[e("div",{class:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold"},"MT"),e("span",{class:"text-[10px] font-bold text-slate-700"},"You"),e("span",{class:"text-[10px] text-gray-400"},"• Just now")],-1)),e("p",Aa,f(Y),1)]))),128))])):v("",!0),d.value&&!C.value?(o(),a("div",Ia,[e("div",Oa,[E(e("textarea",{"onUpdate:modelValue":D[0]||(D[0]=Y=>m.value=Y),onKeyup:ut(K(O,["ctrl"]),["enter"]),placeholder:"Add a quick note about this call...",rows:"3",class:"w-full bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-xs text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none"},null,40,Ta),[[z,m.value]]),e("button",{onClick:O,class:"absolute right-2 bottom-2 text-gray-400 hover:text-gray-600 p-1.5 transition-colors",title:"Save Note"},[...D[16]||(D[16]=[e("i",{class:"fa-solid fa-paper-plane text-xs"},null,-1)])])])])):v("",!0),d.value&&C.value?(o(),a("div",qa,[D[17]||(D[17]=e("div",{class:"flex items-center justify-between mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Extract information from the transcription")])],-1)),e("button",{onClick:q,disabled:F.value,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors flex items-center justify-center gap-2"},[F.value?(o(),a("i",Ra)):(o(),a("i",Ma)),e("span",null,f(F.value?"Extracting...":"Extract information from transcription"),1)],8,Na)])):v("",!0)])]),e("div",ja,[e("div",La,[t.lead.isDisqualified?(o(),a("button",{key:0,onClick:$e,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...D[18]||(D[18]=[j(" Requalify ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])):(o(),a(Q,{key:1},[e("button",{onClick:D[1]||(D[1]=Y=>c.value=!0),class:"bg-white hover:bg-red-50 text-slate-700 hover:text-red-600 border border-gray-200 hover:border-red-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...D[19]||(D[19]=[j(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban"},null,-1)])]),e("button",{onClick:be,class:"bg-white hover:bg-gray-50 text-slate-700 border border-gray-200 font-medium px-4 py-2.5 rounded-lg text-sm shadow-sm transition-colors flex items-center gap-2"},[...D[20]||(D[20]=[j(" Postpone ",-1),e("i",{class:"fa-regular fa-clock"},null,-1)])]),e("button",{onClick:xe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2.5 rounded-lg text-sm shadow-lg shadow-green-200 transition-colors flex items-center gap-2"},[...D[21]||(D[21]=[j(" Qualify ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])],64))]),B(We,{show:l.value,onClose:D[2]||(D[2]=Y=>l.value=!1),onConfirm:we},null,8,["show"]),n.value?(o(),a("div",Fa,[D[26]||(D[26]=e("h5",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4"},"Qualify",-1)),e("div",Va,[D[24]||(D[24]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Next Step",-1)),e("div",Ea,[e("label",Ua,[E(e("input",{type:"radio","onUpdate:modelValue":D[3]||(D[3]=Y=>r.value=Y),value:"qualify",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[Ve,r.value]]),D[22]||(D[22]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Qualify without appointment"),e("span",{class:"text-[10px] text-gray-400"},"Proceed directly to opportunity stage")],-1))]),e("label",{onClick:D[5]||(D[5]=K(Y=>r.value=r.value==="schedule"?"qualify":"schedule",["prevent"])),class:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors bg-white shadow-sm"},[e("input",{type:"radio",checked:r.value==="schedule",class:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300",onClick:D[4]||(D[4]=K(()=>{},["stop"]))},null,8,Wa),D[23]||(D[23]=e("div",{class:"flex flex-col"},[e("span",{class:"text-sm font-medium text-slate-700"},"Schedule Appointment"),e("span",{class:"text-[10px] text-gray-400"},"Book a meeting or test drive")],-1))])])]),r.value==="schedule"?(o(),W(Be,{key:0,show:r.value==="schedule",onConfirm:ke,onCancel:D[6]||(D[6]=Y=>r.value="qualify")},null,8,["show"])):v("",!0),r.value!=="schedule"?(o(),a("button",{key:1,onClick:Ce,class:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg text-sm transition-colors shadow-md shadow-green-100 flex items-center justify-center gap-2 mt-4"},[...D[25]||(D[25]=[j(" Qualify ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])):v("",!0)])):v("",!0)])])):v("",!0)}},Pa={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 overflow-hidden"},za={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Qa={class:"text-lg font-bold text-gray-900"},Ya={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:g}){const s=g,l=()=>{s("close")};return(n,c)=>(o(),W(ye,{to:"body"},[t.show?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(l,["self"])},[e("div",Pa,[e("div",za,[e("h3",Qa,f(t.title),1),e("button",{onClick:l,class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"},[...c[0]||(c[0]=[e("i",{class:"fa-solid fa-times text-sm"},null,-1)])])]),c[1]||(c[1]=e("div",{class:"px-6 py-12 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:l,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])])])):v("",!0)]))}},Ha={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},Ja={class:"p-5 space-y-4"},Ka={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},Ga=["disabled"],Xa={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(""),c=$("");ae(()=>s.show,p=>{p&&(n.value="",c.value="")});const d=()=>{n.value&&l("confirm",{reason:n.value,notes:c.value})},y=()=>{l("cancel")};return(p,i)=>(o(),W(ye,{to:"body"},[t.show?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(y,["self"])},[e("div",Ha,[i[5]||(i[5]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Close as Lost"),e("p",{class:"text-xs text-gray-500 mt-1"},"Document why this opportunity didn't close")],-1)),e("div",Ja,[e("div",null,[i[3]||(i[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),E(e("select",{"onUpdate:modelValue":i[0]||(i[0]=m=>n.value=m),class:"input"},[...i[2]||(i[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[pe,n.value]])]),e("div",null,[i[4]||(i[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),E(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=m=>c.value=m),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[z,c.value]])])]),e("div",Ka,[e("button",{onClick:y,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:d,disabled:!n.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Ga)])])])):v("",!0)]))}},Za={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},_a={class:"p-5 space-y-4"},el=["max"],tl={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},sl=["disabled"],ol={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(""),c=$(""),d=$(""),y=T(()=>new Date().toISOString().split("T")[0]);ae(()=>s.show,m=>{if(m){const r=new Date;n.value=r.toISOString().split("T")[0],c.value=r.toTimeString().slice(0,5),d.value=""}});const p=()=>{if(!n.value)return;const m=c.value?`${n.value}T${c.value}:00`:`${n.value}T12:00:00`;l("confirm",{contractDate:m,notes:d.value})},i=()=>{l("cancel")};return(m,r)=>(o(),W(ye,{to:"body"},[t.show?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(i,["self"])},[e("div",Za,[r[6]||(r[6]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Set Contract Signing Date"),e("p",{class:"text-xs text-gray-500 mt-1"},"Record when the contract was signed to track delivery timeline")],-1)),e("div",_a,[e("div",null,[r[3]||(r[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":r[0]||(r[0]=u=>n.value=u),max:y.value,class:"input"},null,8,el),[[z,n.value]])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),E(e("input",{type:"time","onUpdate:modelValue":r[1]||(r[1]=u=>c.value=u),class:"input"},null,512),[[z,c.value]])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),E(e("textarea",{"onUpdate:modelValue":r[2]||(r[2]=u=>d.value=u),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[z,d.value]])])]),e("div",tl,[e("button",{onClick:i,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:p,disabled:!n.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,sl)])])])):v("",!0)]))}},nl={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-fade-in"},al={class:"p-5 space-y-4"},ll=["max"],rl={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},il=["disabled"],dl={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(""),c=$(""),d=$(""),y=$(""),p=T(()=>new Date().toISOString().split("T")[0]);ae(()=>s.show,r=>{if(r){const u=new Date;n.value=u.toISOString().split("T")[0],c.value=u.toTimeString().slice(0,5),d.value="",y.value=""}});const i=()=>{if(!n.value||!d.value)return;const r=c.value?`${n.value}T${c.value}:00`:`${n.value}T12:00:00`;l("confirm",{deliveryDate:r,location:d.value,notes:y.value})},m=()=>{l("cancel")};return(r,u)=>(o(),W(ye,{to:"body"},[t.show?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(m,["self"])},[e("div",nl,[u[9]||(u[9]=e("div",{class:"p-5 border-b border-gray-100 bg-gray-50/50"},[e("h3",{class:"font-bold text-lg text-gray-900"},"Mark as Delivered"),e("p",{class:"text-xs text-gray-500 mt-1"},"Record the vehicle delivery date and details")],-1)),e("div",al,[e("div",null,[u[4]||(u[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),E(e("input",{type:"date","onUpdate:modelValue":u[0]||(u[0]=k=>n.value=k),max:p.value,class:"input"},null,8,ll),[[z,n.value]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),E(e("input",{type:"time","onUpdate:modelValue":u[1]||(u[1]=k=>c.value=k),class:"input"},null,512),[[z,c.value]])]),e("div",null,[u[7]||(u[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),E(e("select",{"onUpdate:modelValue":u[2]||(u[2]=k=>d.value=k),class:"input"},[...u[6]||(u[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[pe,d.value]])]),e("div",null,[u[8]||(u[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),E(e("textarea",{"onUpdate:modelValue":u[3]||(u[3]=k=>y.value=k),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[z,y.value]])])]),e("div",rl,[e("button",{onClick:m,class:"btn-secondary text-sm"}," Cancel "),e("button",{onClick:i,disabled:!n.value||!d.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,il)])])])):v("",!0)]))}},ul={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},cl={class:"flex justify-between items-center mb-4"},pl={class:"text-sm font-bold text-slate-800"},yl={key:0,class:"mb-4"},ml={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},gl={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},fl=["src"],vl={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},bl={class:"flex-1 min-w-0"},xl={class:"flex items-center gap-2 flex-wrap"},hl={class:"font-bold text-sm text-gray-800 truncate"},wl={class:"text-xs text-gray-500"},kl={key:0,class:"text-[10px] text-green-600 mt-0.5"},Cl={key:1,class:"text-[10px] text-orange-600 mt-0.5"},$l=["onClick"],Sl={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Dl=["src"],Al={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Il={class:"flex-1 min-w-0"},Ol={class:"flex items-center gap-2 flex-wrap"},Tl={class:"font-bold text-sm text-gray-800 truncate"},ql={class:"text-xs text-gray-500"},Nl={key:0,class:"text-[10px] text-green-600 mt-0.5"},Rl={key:1,class:"text-center py-4 text-gray-400 text-sm"},Ml={class:"mb-4"},jl={key:0,class:"flex items-center gap-2 mb-2"},Ll={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Vl={class:"mt-4"},El={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ul=["disabled"],Wl={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:g}){const s=t,l=g,n=$(null),c=$(null),d=$({brand:"",model:"",year:"",price:"",image:""});me(()=>{s.item&&s.item.data&&(d.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const y=r=>{if(n.value=r,s.requestedCar){const u=r.id&&s.requestedCar.id&&r.id===s.requestedCar.id||r.brand===s.requestedCar.brand&&r.model===s.requestedCar.model&&r.year===s.requestedCar.year;c.value=u?"requested":"recommended"}else c.value="recommended";d.value={brand:r.brand||"",model:r.model||"",year:r.year||new Date().getFullYear(),price:r.price||"",image:r.image||""}},p=T(()=>n.value||d.value.brand&&d.value.model&&d.value.price),i=r=>new Intl.NumberFormat("en-US").format(r),m=()=>{var u,k;const r=n.value||d.value;l("save",{id:((u=s.item)==null?void 0:u.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:r.brand,model:r.model,year:r.year||new Date().getFullYear(),price:r.price,image:r.image||"",isMainOffer:!1},timestamp:((k=s.item)==null?void 0:k.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(r,u)=>{var k,h;return o(),a("div",ul,[e("div",cl,[e("h5",pl,f(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:u[0]||(u[0]=C=>r.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...u[8]||(u[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?v("",!0):(o(),a("div",yl,[u[11]||(u[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",ml,[t.requestedCar?(o(),a("div",{key:0,onClick:u[1]||(u[1]=C=>y(t.requestedCar)),class:N(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((k=n.value)==null?void 0:k.id)===t.requestedCar.id}])},[e("div",gl,[t.requestedCar.image?(o(),a("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,fl)):(o(),a("i",vl))]),e("div",bl,[e("div",xl,[e("h4",hl,f(t.requestedCar.brand)+" "+f(t.requestedCar.model)+" ("+f(t.requestedCar.year)+")",1),e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((h=n.value)==null?void 0:h.id)===t.requestedCar.id&&c.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",wl,"€ "+f(i(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(o(),a("div",kl," In stock ("+f(t.requestedCar.stockDays)+" days) ",1)):(o(),a("div",Cl," Out of stock "))]),u[9]||(u[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):v("",!0),(o(!0),a(Q,null,_(t.recommendedCars,C=>{var A,F;return o(),a("div",{key:C.id,onClick:R=>y(C),class:N(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((A=n.value)==null?void 0:A.id)===C.id}])},[e("div",Sl,[C.image?(o(),a("img",{key:0,src:C.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Dl)):(o(),a("i",Al))]),e("div",Il,[e("div",Ol,[e("h4",Tl,f(C.brand)+" "+f(C.model)+" ("+f(C.year)+")",1),e("span",{class:N(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((F=n.value)==null?void 0:F.id)===C.id&&c.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",ql,"€ "+f(i(C.price)),1),C.stockDays!==null&&C.stockDays!==void 0?(o(),a("div",Nl," In stock ("+f(C.stockDays)+" days) ",1)):v("",!0)]),u[10]||(u[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,$l)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(o(),a("div",Rl," No vehicles available ")):v("",!0)])])),e("div",Ml,[t.requestedCar||t.recommendedCars.length>0?(o(),a("div",jl,[...u[12]||(u[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):v("",!0),e("div",Ll,[e("div",null,[u[13]||(u[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),E(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=C=>d.value.brand=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,d.value.brand]])]),e("div",null,[u[14]||(u[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),E(e("input",{type:"text","onUpdate:modelValue":u[3]||(u[3]=C=>d.value.model=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,d.value.model]])])]),e("div",Fl,[e("div",null,[u[15]||(u[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),E(e("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=C=>d.value.year=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,d.value.year]])]),e("div",null,[u[16]||(u[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),E(e("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=C=>d.value.price=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[z,d.value.price]])])]),e("div",Vl,[u[17]||(u[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),E(e("input",{type:"text","onUpdate:modelValue":u[6]||(u[6]=C=>d.value.image=C),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[z,d.value.image]])])]),e("div",El,[e("button",{onClick:u[7]||(u[7]=C=>r.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:m,disabled:!p.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Ul)])])}}},Bl={key:0,class:"mb-8"},Pl={class:"relative"},zl={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},Ql={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},Yl=["src"],Hl={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},Jl={class:"p-4"},Kl={class:"font-bold text-gray-800 text-sm mb-1"},Gl={class:"text-xs text-gray-500 mb-2"},Xl={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},Zl=["onClick"],_l={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:g}){const s=$([]);me(()=>{s.value=Ee.filter(n=>n.stockDays!==null&&n.stockDays!==void 0).slice(0,5)});const l=n=>new Intl.NumberFormat("en-US").format(n);return(n,c)=>s.value.length>0?(o(),a("div",Bl,[c[1]||(c[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",Pl,[e("div",zl,[(o(!0),a(Q,null,_(s.value,d=>(o(),a("div",{key:d.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",Ql,[d.image?(o(),a("img",{key:0,src:d.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Yl)):(o(),a("i",Hl))]),e("div",Jl,[e("h4",Kl,f(d.brand)+" "+f(d.model)+" ("+f(d.year)+")",1),e("p",Gl,"€ "+f(l(d.price)),1),d.stockDays!==null&&d.stockDays!==void 0?(o(),a("div",Xl,[c[0]||(c[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),j(" In stock ("+f(d.stockDays)+" days) ",1)])):v("",!0),e("button",{onClick:y=>n.$emit("add-to-opportunity",d),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,Zl)])]))),128))])])])):v("",!0)}},er=Le(_l,[["__scopeId","data-v-0d800814"]]),tr={class:"mt-1.5 border-t border-gray-200 pt-1.5"},sr={key:1},or={class:"flex items-center justify-between mb-1.5"},nr={class:"space-y-1.5"},ar={class:"block label-upper mb-1"},lr=["onUpdate:modelValue","placeholder"],rr=["onUpdate:modelValue"],ir=["value"],dr={key:2,class:"space-y-0.5"},ur=["onUpdate:modelValue","value"],de={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=$(!1),c=$({});ae(()=>s.questions,m=>{const r={};m.forEach(u=>{r[u.key]=""}),c.value=r},{immediate:!0});const d=()=>{l("survey-completed",{...c.value}),i()},y=()=>{l("survey-refused"),i()},p=()=>{l("not-responding"),i()},i=()=>{n.value=!1;const m={};s.questions.forEach(r=>{m[r.key]=""}),c.value=m};return(m,r)=>(o(),a("div",tr,[n.value?(o(),a("div",sr,[e("div",or,[r[4]||(r[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:r[1]||(r[1]=u=>n.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...r[3]||(r[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",nr,[(o(!0),a(Q,null,_(t.questions,(u,k)=>(o(),a("div",{key:k,class:"bg-gray-50 rounded-md p-1.5"},[e("label",ar,f(u.label),1),u.type==="text"?E((o(),a("textarea",{key:0,"onUpdate:modelValue":h=>c.value[u.key]=h,placeholder:u.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,lr)),[[z,c.value[u.key]]]):u.type==="select"?E((o(),a("select",{key:1,"onUpdate:modelValue":h=>c.value[u.key]=h,class:"input text-xs py-1 px-2"},[r[5]||(r[5]=e("option",{value:""},"Select an option...",-1)),(o(!0),a(Q,null,_(u.options,h=>(o(),a("option",{key:h,value:h},f(h),9,ir))),128))],8,rr)),[[pe,c.value[u.key]]]):u.type==="radio"?(o(),a("div",dr,[(o(!0),a(Q,null,_(u.options,h=>(o(),a("label",{key:h,class:"flex items-center text-xs"},[E(e("input",{type:"radio","onUpdate:modelValue":C=>c.value[u.key]=C,value:h,class:"mr-1"},null,8,ur),[[Ve,c.value[u.key]]]),j(" "+f(h),1)]))),128))])):v("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:d,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:p,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(o(),a("button",{key:0,onClick:r[0]||(r[0]=u=>n.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...r[2]||(r[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},cr={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},pr={class:"flex justify-between items-start mb-3"},yr={class:"text-xs text-gray-500 mt-0.5"},mr={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],c=T(()=>{if(!s.opportunity.createdAt)return 0;const u=new Date(s.opportunity.createdAt),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),d=()=>{l("create-offer",s.opportunity)},y=()=>{l("review",s.opportunity)},p=()=>{l("close-lost",s.opportunity)},i=u=>{l("survey-completed",{opportunity:s.opportunity,responses:u})},m=()=>{l("survey-refused",{opportunity:s.opportunity})},r=()=>{l("not-responding",{opportunity:s.opportunity})};return(u,k)=>(o(),a("div",cr,[e("div",pr,[e("div",null,[k[0]||(k[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",yr,"This opportunity has been open for "+f(c.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity "),e("button",{onClick:p,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),B(de,{questions:n,onSurveyCompleted:i,onSurveyRefused:m,onNotResponding:r})]))}},gr={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},fr={class:"flex justify-between items-start mb-3"},vr={class:"text-xs text-gray-500 mt-0.5"},br={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","mark-unsold","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],c=T(()=>{if(!s.opportunity.createdAt)return 0;const r=new Date(s.opportunity.createdAt),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),d=()=>{l("create-offer",s.opportunity)},y=()=>{l("mark-unsold",s.opportunity)},p=r=>{l("survey-completed",{opportunity:s.opportunity,responses:r})},i=()=>{l("survey-refused",{opportunity:s.opportunity})},m=()=>{l("not-responding",{opportunity:s.opportunity})};return(r,u)=>(o(),a("div",gr,[e("div",fr,[e("div",null,[u[0]||(u[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",vr,"This opportunity has been open for "+f(c.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),B(de,{questions:n,onSurveyCompleted:p,onSurveyRefused:i,onNotResponding:m})]))}},xr={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},hr={class:"flex justify-between items-start mb-3"},wr={class:"text-xs text-gray-500 mt-0.5"},kr={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],c=T(()=>{const r=s.opportunity.lastActivity||s.opportunity.createdAt;if(!r)return 0;const u=new Date(r),h=Math.abs(new Date-u);return Math.ceil(h/(1e3*60*60*24))}),d=()=>{l("create-contract",s.opportunity)},y=()=>{l("close-lost",s.opportunity)},p=r=>{l("survey-completed",{opportunity:s.opportunity,responses:r})},i=()=>{l("survey-refused",{opportunity:s.opportunity})},m=()=>{l("not-responding",{opportunity:s.opportunity})};return(r,u)=>(o(),a("div",xr,[e("div",hr,[e("div",null,[u[0]||(u[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",wr,"This opportunity has been in negotiation for "+f(c.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract "),e("button",{onClick:y,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),B(de,{questions:n,onSurveyCompleted:p,onSurveyRefused:i,onNotResponding:m})]))}},Cr={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},$r={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-lost","schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],c=()=>{l("close-lost",s.opportunity)},d=()=>{l("schedule-closing",s.opportunity)},y=m=>{l("survey-completed",{opportunity:s.opportunity,responses:m})},p=()=>{l("survey-refused",{opportunity:s.opportunity})},i=()=>{l("not-responding",{opportunity:s.opportunity})};return(m,r)=>(o(),a("div",Cr,[r[0]||(r[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting "),e("button",{onClick:c,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),B(de,{questions:n,onSurveyCompleted:y,onSurveyRefused:p,onNotResponding:i})]))}},Sr={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Dr={class:"flex justify-between items-start mb-3"},Ar={class:"text-xs text-gray-500 mt-0.5"},Ir={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","close-lost","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Close as lost","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],c=T(()=>{var k;return(k=s.scheduledAppointment)!=null&&k.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),d=()=>{l("contact-customer",s.opportunity)},y=()=>{l("reschedule",s.opportunity)},p=()=>{l("close-lost",s.opportunity)},i=u=>{l("survey-completed",{opportunity:s.opportunity,responses:u})},m=()=>{l("survey-refused",{opportunity:s.opportunity})},r=()=>{l("not-responding",{opportunity:s.opportunity})};return(u,k)=>(o(),a("div",Sr,[e("div",Dr,[e("div",null,[k[0]||(k[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"No-Show Follow-up",-1)),e("p",Ar,"Appointment was scheduled for "+f(c.value)+" but customer did not show up. Follow up with customer to understand the situation.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Contact Customer "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Reschedule "),e("button",{onClick:p,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Close as Lost ")]),B(de,{questions:n,onSurveyCompleted:i,onSurveyRefused:m,onNotResponding:r})]))}},Or={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Tr={class:"flex justify-between items-start mb-3"},qr={class:"text-xs text-gray-500 mt-0.5"},Nr={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],c=T(()=>{var h;if(!((h=s.opportunity)!=null&&h.contractDate))return 0;const r=new Date(s.opportunity.contractDate),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),d=()=>{l("prepare-delivery",s.opportunity)},y=()=>{l("pre-delivery-checklist",s.opportunity)},p=r=>{l("survey-completed",{opportunity:s.opportunity,responses:r})},i=()=>{l("survey-refused",{opportunity:s.opportunity})},m=()=>{l("not-responding",{opportunity:s.opportunity})};return(r,u)=>(o(),a("div",Or,[e("div",Tr,[e("div",null,[u[0]||(u[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",qr,"Contract was signed "+f(c.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:d,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:y,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),B(de,{questions:n,onSurveyCompleted:p,onSurveyRefused:i,onNotResponding:m})]))}},Rr={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Mr={class:"flex justify-between items-start mb-3"},jr={class:"text-xs text-gray-500 mt-0.5"},Lr={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:g}){const s=t,l=g,n=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],c=T(()=>{const m=s.activities.find(h=>{var C;return h.type==="delivery"||((C=h.action)==null?void 0:C.toLowerCase().includes("delivered"))});if(!m||!m.timestamp)return 0;const r=new Date(m.timestamp),k=Math.abs(new Date-r);return Math.ceil(k/(1e3*60*60*24))}),d=()=>{l("delivery-feedback",s.opportunity)},y=m=>{l("survey-completed",{opportunity:s.opportunity,responses:m})},p=()=>{l("survey-refused",{opportunity:s.opportunity})},i=()=>{l("not-responding",{opportunity:s.opportunity})};return(m,r)=>(o(),a("div",Rr,[e("div",Mr,[e("div",null,[r[0]||(r[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",jr,"Vehicle was delivered "+f(c.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:d,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),B(de,{questions:n,onSurveyCompleted:y,onSurveyRefused:p,onNotResponding:i})]))}},Fr={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},Vr={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},Er={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},Ur={class:"p-5 space-y-6"},Wr={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Br={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},Pr={class:"flex items-start gap-3"},zr={class:"flex-1"},Qr={class:"font-bold text-slate-800 text-sm mb-1"},Yr={key:0},Hr={key:1},Jr={class:"text-xs text-gray-600"},Kr={key:0},Gr={key:1},Xr={key:2},Zr={class:"flex justify-between items-start mb-3"},_r={class:"font-bold text-slate-800 text-sm"},ei={key:0},ti={key:1},si={class:"text-xs text-gray-500 mt-0.5"},oi={key:0},ni={key:1},ai={class:"flex gap-3 flex-wrap"},li={key:0,class:"mt-4"},ri={class:"[&>div]:mb-0"},ii={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},di={class:"flex justify-between items-start mb-3"},ui={class:"text-xs text-gray-500 mt-0.5"},ci={key:0,class:"pt-4"},pi={key:4,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},yi={key:5,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},mi={class:"flex justify-between items-start mb-3"},gi={class:"text-xs text-gray-500 mt-0.5"},fi={key:12,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},vi={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},bi={class:"p-6"},xi={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},hi={class:"p-6"},wi={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:g}){const s=t,l=g,n=T(()=>{var w,S,L;return((w=s.opportunity)==null?void 0:w.stage)==="Closed"||((S=s.opportunity)==null?void 0:S.stage)==="Closed Lost"||((L=s.opportunity)==null?void 0:L.stage)==="Registration"}),c=$(!1),d=$(!1),y=$(null),p=$(!1),i=$(""),m=$(!1),r=$(!1),u=$(!1),k=$(!1),h=$([]),C=Ue();me(()=>{h.value=Ee.filter(w=>w.stockDays!==null&&w.stockDays!==void 0).slice(0,5).map(w=>({id:w.id,brand:w.brand,model:w.model,year:w.year,price:w.price,image:w.image||"",stockDays:w.stockDays}))});const A=w=>{i.value=w,p.value=!0},F=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",R=w=>w?new Date(w).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",G=()=>{c.value=!c.value},se=w=>{c.value=!1},I=T(()=>{var H;if(!((H=s.opportunity)!=null&&H.createdAt))return 0;const w=new Date(s.opportunity.createdAt),L=Math.abs(new Date-w);return Math.ceil(L/(1e3*60*60*24))}),q=T(()=>{var S,L;return s.activities.some(H=>H.type==="offer")||((S=s.opportunity)==null?void 0:S.stage)==="In Negotiation"||((L=s.opportunity)==null?void 0:L.stage)==="Closed"}),b=T(()=>s.activities.some(w=>w.type==="appointment")),O=T(()=>{var L,H,J,ee;const w=((L=s.opportunity)==null?void 0:L.contractDate)!==null&&((H=s.opportunity)==null?void 0:H.contractDate)!==void 0,S=s.activities.some(X=>{var Z,ne;return((Z=X.action)==null?void 0:Z.toLowerCase().includes("won"))||((ne=X.action)==null?void 0:ne.toLowerCase().includes("contract"))});return w||S||((J=s.opportunity)==null?void 0:J.stage)==="Closed"&&((ee=s.opportunity)==null?void 0:ee.probability)===100}),M=T(()=>s.activities.some(w=>{var S,L;return w.type==="delivery"||((S=w.action)==null?void 0:S.toLowerCase().includes("delivered"))||((L=w.action)==null?void 0:L.toLowerCase().includes("delivery"))})),x=T(()=>{var S;if(((S=s.opportunity)==null?void 0:S.stage)!=="Qualified"||q.value||s.scheduledAppointment||b.value)return!1;const w=I.value;return w>=7&&w<14}),P=T(()=>{var S;return((S=s.opportunity)==null?void 0:S.stage)!=="Qualified"||q.value||s.scheduledAppointment||b.value?!1:I.value>=14}),be=T(()=>{var S;return((S=s.opportunity)==null?void 0:S.stage)!=="Qualified"||q.value||!s.scheduledAppointment?!1:I.value>=7}),xe=T(()=>{const w=I.value;return w>=14?"high":w>=7?"medium":null}),we=T(()=>{var J;if(((J=s.opportunity)==null?void 0:J.stage)!=="In Negotiation")return!1;const w=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),L=Math.abs(new Date-w),H=Math.ceil(L/(1e3*60*60*24));return!O.value&&H>=5}),ke=T(()=>{var Z,ne,Te;if(((Z=s.opportunity)==null?void 0:Z.stage)!=="In Negotiation")return!1;const w=((ne=s.opportunity)==null?void 0:ne.contractDate)!==null&&((Te=s.opportunity)==null?void 0:Te.contractDate)!==void 0,S=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||b.value&&s.activities.some(Ae=>{var qe;return Ae.type==="appointment"&&((qe=Ae.data)!=null&&qe.datetime)?new Date(Ae.data.datetime)>new Date:!1}),L=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),J=Math.abs(new Date-L);return Math.ceil(J/(1e3*60*60*24))>=5&&!w&&!S}),Ce=T(()=>{var X,Z,ne;if(((X=s.opportunity)==null?void 0:X.stage)!=="Closed"&&((Z=s.opportunity)==null?void 0:Z.stage)!=="Registration")return!1;const w=(ne=s.opportunity)==null?void 0:ne.contractDate;if(!w||M.value)return!1;const S=new Date(w),H=Math.abs(new Date-S);return Math.ceil(H/(1e3*60*60*24))>=7}),$e=T(()=>{const w=s.activities.find(X=>{var Z;return X.type==="delivery"||((Z=X.action)==null?void 0:Z.toLowerCase().includes("delivered"))});if(!w)return!1;const S=new Date(w.timestamp),H=Math.abs(new Date-S);return Math.ceil(H/(1e3*60*60*24))>=3}),V=T(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const L=s.activities.some(J=>{var ee,X,Z;return J.type==="appointment"&&(((ee=J.data)==null?void 0:ee.status)==="completed"||((X=J.action)==null?void 0:X.toLowerCase().includes("completed")))&&((Z=J.data)==null?void 0:Z.appointmentId)===s.scheduledAppointment.id}),H=s.scheduledAppointment.status==="no-show";return!L&&!H}),D=T(()=>{var w,S,L;return!(((w=s.opportunity)==null?void 0:w.stage)!=="In Negotiation"||!((S=s.opportunity)!=null&&S.contractDate)||((L=s.opportunity)==null?void 0:L.stage)==="Closed")}),Y=T(()=>{var J,ee,X;if(((J=s.opportunity)==null?void 0:J.stage)!=="Closed"||!((ee=s.opportunity)!=null&&ee.contractDate)||M.value||((X=s.opportunity)==null?void 0:X.stage)==="Registration")return!1;const w=new Date(s.opportunity.contractDate),L=Math.abs(new Date-w);return Math.ceil(L/(1e3*60*60*24))>=7}),ge=()=>{l("add-vehicle",s.opportunity)},Pe=()=>{A("Add Vehicle from Stock")},ze=()=>{A("Configure Vehicle")},Se=()=>{m.value=!0},Ie=()=>{m.value=!1},Qe=w=>{m.value=!1,l("create-offer",{opportunity:s.opportunity,offerData:w})},Ye=w=>{l("add-to-opportunity",w)},He=w=>{A("Review Opportunity")},Je=w=>{u.value=!0},Ke=w=>{u.value=!1,console.log("Contract date set:",w)},Oe=w=>{d.value=!0,y.value=w},De=()=>{d.value=!1,y.value=null},Ge=w=>{Oe("nfu")},Xe=w=>{De();const S={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${w.type} on ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,date:w.date,time:w.time,datetime:`${w.date}T${w.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};l("appointment-created",S)},Ze=w=>{k.value=!0},_e=w=>{A("Pre-Delivery Checklist")},et=w=>{k.value=!1,console.log("Vehicle marked as delivered:",w)},tt=w=>{A("Delivery Feedback")},fe=()=>{r.value=!0},st=w=>{r.value=!1,console.log("Closing opportunity as lost:",w)},ot=()=>{A("Contact Customer")},le=w=>{console.log("Survey completed:",w)},re=w=>{console.log("Survey refused:",w)},ie=w=>{console.log("Customer not responding:",w)},nt=async()=>{try{await C.reopenOpportunity(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to reopen opportunity:",w)}},at=async()=>{try{await C.markAsRegistration(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as registration:",w)}},lt=async()=>{try{await C.markAsClosedWon(s.opportunity.id),await C.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as closed won:",w)}};return(w,S)=>t.opportunity?(o(),a("div",Fr,[e("div",Vr,[S[6]||(S[6]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next steps")],-1)),e("span",Er,f(n.value?"Closed":"Active"),1)]),e("div",Ur,[n.value?(o(),a("div",Wr,[S[8]||(S[8]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process.")])],-1)),e("button",{onClick:nt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...S[7]||(S[7]=[j(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):v("",!0),be.value?(o(),a("div",Br,[e("div",Pr,[S[9]||(S[9]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",zr,[e("h4",Qr,[xe.value==="high"?(o(),a("span",Yr,"High Risk")):(o(),a("span",Hr,"At Risk"))]),e("p",Jr,[xe.value==="high"?(o(),a("span",Kr," This opportunity has been open for "+f(I.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(o(),a("span",Gr," This opportunity has been open for "+f(I.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):v("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(o(),a("div",Xr,[e("div",{class:N([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",Zr,[e("div",null,[e("h4",_r,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(o(),a("span",ei," Add Vehicle ")):(o(),a("span",ti," Find Alternative "))]),e("p",si,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(o(),a("span",oi," The requested vehicle is available. Add it to the opportunity to proceed. ")):(o(),a("span",ni," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",ai,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(o(),a("button",{key:0,onClick:ge,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):v("",!0),e("button",{onClick:Pe,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:ze,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:Se,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(o(),a("div",li,[e("div",ri,[B(er,{onAddToOpportunity:Ye})])])):v("",!0)],2)])):v("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(o(),a("div",ii,[e("div",di,[e("div",null,[S[10]||(S[10]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",ui,f(t.scheduledAppointment.title)+" on "+f(F(t.scheduledAppointment.start))+" at "+f(R(t.scheduledAppointment.start)),1)])]),e("button",{onClick:G,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),c.value?(o(),a("div",ci,[B(We,{show:c.value,onClose:S[0]||(S[0]=L=>c.value=!1),onConfirm:se},null,8,["show"])])):v("",!0)])):t.opportunity.stage==="Qualified"&&!b.value?(o(),a("div",pi,[S[11]||(S[11]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:S[1]||(S[1]=L=>Oe("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):v("",!0),D.value?(o(),a("div",yi,[e("div",mi,[e("div",null,[S[12]||(S[12]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",gi," Contract was signed on "+f(F(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:lt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...S[13]||(S[13]=[j(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):v("",!0),V.value?(o(),W(Ir,{key:6,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:ot,onReschedule:w.openRescheduleModal,onCloseLost:fe,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity","scheduled-appointment","onReschedule"])):v("",!0),P.value?(o(),W(br,{key:7,opportunity:t.opportunity,onCreateOffer:Se,onMarkUnsold:fe,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity"])):v("",!0),x.value?(o(),W(mr,{key:8,opportunity:t.opportunity,onCreateOffer:Se,onReview:He,onCloseLost:fe,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity"])):v("",!0),ke.value?(o(),W($r,{key:9,opportunity:t.opportunity,onCloseLost:fe,onScheduleClosing:Ge,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity"])):v("",!0),we.value?(o(),W(kr,{key:10,opportunity:t.opportunity,onCreateContract:Je,onCloseLost:fe,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity"])):v("",!0),Ce.value?(o(),W(Nr,{key:11,opportunity:t.opportunity,onPrepareDelivery:Ze,onPreDeliveryChecklist:_e,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity"])):v("",!0),Y.value?(o(),a("div",fi,[S[15]||(S[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:at,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...S[14]||(S[14]=[j(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):v("",!0),$e.value?(o(),W(Lr,{key:13,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:tt,onSurveyCompleted:le,onSurveyRefused:re,onNotResponding:ie},null,8,["opportunity","activities"])):v("",!0)]),B(Ya,{show:p.value,title:i.value,onClose:S[2]||(S[2]=L=>p.value=!1)},null,8,["show","title"]),B(Xa,{show:r.value,onConfirm:st,onCancel:S[3]||(S[3]=L=>r.value=!1)},null,8,["show"]),B(ol,{show:u.value,onConfirm:Ke,onCancel:S[4]||(S[4]=L=>u.value=!1)},null,8,["show"]),B(dl,{show:k.value,onConfirm:et,onCancel:S[5]||(S[5]=L=>k.value=!1)},null,8,["show"]),(o(),W(ye,{to:"body"},[m.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(Ie,["self"])},[e("div",vi,[e("div",bi,[B(Wl,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":h.value,onSave:Qe,onCancel:Ie},null,8,["task-id","requested-car","recommended-cars"])])])])):v("",!0)])),(o(),W(ye,{to:"body"},[d.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:K(De,["self"])},[e("div",xi,[e("div",hi,[B(Be,{show:d.value,onConfirm:Xe,onCancel:De},null,8,["show"])])])])):v("",!0)]))])):v("",!0)}},ki={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},Ci={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},$i={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},Si={key:0,class:"fa-solid fa-clock text-[10px]"},Di={class:"text-[10px] font-bold uppercase tracking-wide"},Ai={key:1,class:"text-right"},Ii={class:"text-sm font-bold text-gray-900"},Oi={class:"mt-1.5"},Ti={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},qi={class:"text-[10px] text-gray-500 mt-0.5"},Ni=["onClick"],Ri=["onClick"],Mi=["onClick"],ji={class:"flex-1 flex flex-col overflow-hidden"},Li={key:0,class:"flex-1 flex items-center justify-center"},Vi={__name:"TaskDetail",setup(t){const g=ct(),s=pt(),l=Fe(),n=Ue(),c=$("all"),d=$(null),y=T(()=>{const b=l.leads.map(M=>({...M,type:"lead",compositeId:`lead-${M.id}`})),O=n.opportunities.map(M=>({...M,type:"opportunity",compositeId:`opportunity-${M.id}`}));return[...b,...O].sort((M,x)=>{const P=new Date(M.lastActivity||M.createdAt||0);return new Date(x.lastActivity||x.createdAt||0)-P})}),p=T(()=>c.value==="all"?y.value:y.value.filter(b=>b.type===c.value)),i=T(()=>{const b=parseInt(g.params.id),O=g.query.type;if(O)return y.value.find(P=>P.id===b&&P.type===O)||null;const x=(c.value!=="all"?y.value.filter(P=>P.type===c.value):y.value).find(P=>P.id===b);return x||y.value.find(P=>P.id===b)||null}),m=T(()=>i.value?i.value.type==="lead"?l.currentLeadActivities:n.currentOpportunityActivities:[]),r=T(()=>i.value?i.value.type==="lead"?Ba:wi:null),u=T(()=>i.value?i.value.type==="lead"?{currentActivities:T(()=>l.currentLeadActivities),addActivity:b=>l.addLeadActivity(i.value.id,b),updateActivity:(b,O)=>l.updateLeadActivity(i.value.id,b,O),deleteActivity:b=>l.deleteLeadActivity(i.value.id,b)}:{currentActivities:T(()=>n.currentOpportunityActivities),addActivity:b=>n.addOpportunityActivity(i.value.id,b),updateActivity:(b,O)=>n.updateOpportunityActivity(i.value.id,b,O),deleteActivity:b=>n.deleteOpportunityActivity(i.value.id,b)}:null),k=T(()=>i.value?i.value.type==="lead"?{overviewActions:["appointment","reschedule"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["appointment","reschedule","vehicle","offer","financing","trade-in","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),h=T(()=>b=>b.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");me(()=>{l.loadLeads(),n.loadOpportunities();const b=g.params.id;b&&C(b)}),ae(()=>g.params.id,b=>{b&&C(b)}),ae(i,b=>{b&&(b.type==="lead"?l.loadLeadById(b.id):n.loadOpportunityById(b.id))},{immediate:!0});const C=b=>{const O=parseInt(b),M=y.value.find(x=>x.id===O);M&&(M.type==="lead"?l.loadLeadById(O):n.loadOpportunityById(O))},A=b=>{const[O,M]=b.split("-");s.push({path:`/tasks/${M}`,query:{type:O}})},F=b=>new Intl.NumberFormat("en-US").format(b),R=b=>{d.value=d.value===b?null:b},G=b=>{d.value=null},se=async b=>{d.value=null,b.type==="lead"?await l.modifyLead(b.id,{priority:"Hot"}):b.type==="opportunity"&&await n.modifyOpportunity(b.id,{priority:"Hot"})},I=async b=>{d.value=null,b.type==="lead"?await l.modifyLead(b.id,{priority:"Normal"}):b.type==="opportunity"&&await n.modifyOpportunity(b.id,{priority:"Normal"})},q=b=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[b]||"bg-gray-100 text-gray-700 border-gray-200";return(b,O)=>{var M;return o(),a("div",ki,[B(Et,{title:"Tasks",items:p.value,"selected-id":(M=i.value)==null?void 0:M.compositeId,"type-filter":c.value,"selected-class":x=>x.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":h.value,"open-menu-id":d.value,getName:x=>x.customer.name,getInitials:x=>x.customer.initials,getVehicleInfo:x=>x.type==="lead"?`${x.requestedCar.brand} ${x.requestedCar.model}`:`${x.vehicle.brand} ${x.vehicle.model}`,avatarClass:x=>x.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600",onSelect:A,onMenuClick:R,onMenuClose:O[0]||(O[0]=x=>d.value=null),"show-type-filter":!0,onFilterChange:O[1]||(O[1]=x=>c.value=x)},{badges:ve(({item:x})=>[e("span",{class:N(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",x.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},f(x.type==="lead"?"Lead":"Opportunity"),3),x.type==="lead"?(o(),a(Q,{key:0},[e("span",Ci,f(x.status),1),x.priority==="Hot"?(o(),a("span",$i,[...O[2]||(O[2]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),j(" Hot ",-1)])])):v("",!0)],64)):(o(),a("span",{key:1,class:N(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",q(x.stage)])},f(x.stage),3))]),meta:ve(({item:x})=>[x.type==="lead"?(o(),a("div",{key:0,class:N(["flex items-center gap-1.5",x.priority==="Hot"?"text-red-500":"text-gray-400"])},[x.priority==="Hot"?(o(),a("i",Si)):v("",!0),e("span",Di," Due in "+f(x.nextActionDue),1)],2)):(o(),a("div",Ai,[e("div",Ii,"€"+f(F(x.value)),1),e("div",Oi,[e("div",Ti,[e("div",{class:N(["h-full rounded-full",x.probability>=70?"bg-green-500":x.probability>=40?"bg-blue-500":"bg-orange-500"]),style:je({width:`${x.probability}%`})},null,6)]),e("div",qi,f(x.probability)+"% PROB",1)])]))]),menu:ve(({item:x})=>[e("button",{onClick:K(P=>G(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...O[3]||(O[3]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),j(" Reassign ",-1)])],8,Ni),x.priority!=="Hot"?(o(),a("button",{key:0,onClick:K(P=>se(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...O[4]||(O[4]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),j(" Mark as hot ",-1)])],8,Ri)):(o(),a("button",{key:1,onClick:K(P=>I(x),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...O[5]||(O[5]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),j(" Unmark as hot ",-1)])],8,Mi))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass"]),e("div",ji,[i.value?(o(),W(cn,{key:1,task:i.value,type:i.value.type,"management-widget":r.value,"store-adapter":u.value,"add-new-config":k.value},{"pinned-extra":ve(({task:x})=>[x.type==="lead"&&x.requestedCar?(o(),W(Re,{key:0,brand:x.requestedCar.brand,model:x.requestedCar.model,year:x.requestedCar.year,image:x.requestedCar.image||"",price:x.requestedCar.price||null,"request-message":x.requestedCar.requestMessage||"","request-type":x.requestedCar.requestType||"",source:x.source||"",dealership:x.requestedCar.dealership||"",registration:x.requestedCar.registration||"",kilometers:x.requestedCar.kilometers||null,"fuel-type":x.requestedCar.fuelType||"","gear-type":x.requestedCar.gearType||"",vin:x.requestedCar.vin||"","stock-days":x.requestedCar.stockDays!==void 0?x.requestedCar.stockDays:null,channel:x.requestedCar.channel||"Email","ad-campaign":x.requestedCar.adCampaign||"","expected-purchase-date":x.requestedCar.expectedPurchaseDate||"","fiscal-entity":x.requestedCar.fiscalEntity||"","source-details":x.requestedCar.sourceDetails||"","ad-medium":x.requestedCar.adMedium||"","ad-source":x.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0),x.type==="opportunity"&&x.vehicle?(o(),W(Re,{key:1,brand:x.vehicle.brand,model:x.vehicle.model,year:x.vehicle.year,image:x.vehicle.image||"",price:x.vehicle.price||null,"request-message":x.vehicle.requestMessage||"","request-type":x.vehicle.requestType||"",source:x.source||"",dealership:x.vehicle.dealership||"",registration:x.vehicle.registration||"",kilometers:x.vehicle.kilometers||null,"fuel-type":x.vehicle.fuelType||"","gear-type":x.vehicle.gearType||"",vin:x.vehicle.vin||"","stock-days":x.vehicle.stockDays!==void 0?x.vehicle.stockDays:null,channel:x.vehicle.channel||"Email","ad-campaign":x.vehicle.adCampaign||"","expected-purchase-date":x.vehicle.expectedPurchaseDate||"","fiscal-entity":x.vehicle.fiscalEntity||"","source-details":x.vehicle.sourceDetails||"","ad-medium":x.vehicle.adMedium||"","ad-source":x.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(o(),a("div",Li,[...O[6]||(O[6]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),B(ts,{title:"Activity summary",activities:m.value,collapsed:!1,"show-collapse":!1,show:!!i.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{Vi as default};
