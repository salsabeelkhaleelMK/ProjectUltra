import{E as xe,c as A,G as ht,r as q,H as ut,d as y,o as r,g as D,p as le,e,w as Qe,x as P,y as n,P as ct,n as H,t as S,I as pe,k as R,F as ce,_ as we,s as C,D as O,T as xt,l as be,J as ye,i as ge,K as Se,L as de,M as Ge,j as Ye,N as Ke,q as yt,U as Qt,O as Yt,R as Gt,S as Kt,V as tt,W as kt,h as pt,C as ze,u as Ie,X as Ue,v as $e,Q as ee,Y as Jt,Z as Zt,$ as Ve,a0 as He,a1 as it,z as st,m as mt,a2 as Xt}from"./index-B6fu4vW4.js";import{a as nt}from"./opportunities-Cpo2JN0p.js";import{u as Je}from"./users-BOT_jg40.js";import{y as es}from"./components-BOXotWV0.js";import{_ as ts,E as ss,T as ns,i as ls,g as as,a as os,s as is,b as rs,c as ds,d as us,e as rt,f as cs,h as ps,j as ms,k as fs,l as ys,m as gs,n as vs,o as bs,p as hs,q as xs,r as ks}from"./ComingSoonModal-BEAkA8MK.js";import{n as Ce,V as ws,R as Cs,z as $s,a as Oe,F as qe,L as Ne,H as Me,j as Ee,K as Ze,C as Le,W as Be}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-K7ki7z-B.js";import{f as Re,a as Pe,g as wt,b as Ct,c as $t,d as St}from"./formatters-DjeI4Z8-.js";import{_ as At}from"./ReassignUserModal-CoERerCP.js";import{f as Dt}from"./vehicles-DWgKGMVe.js";import{_ as Ss}from"./CreateEventModal-U-8LM8Mz.js";import{_ as As,a as Ds}from"./EditEventModal-NBRK6Jzl.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=xe("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=xe("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=xe("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=xe("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=xe("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=xe("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=xe("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=xe("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=xe("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=xe("PaperclipIcon",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=xe("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=xe("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=xe("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=xe("TagIcon",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Bs={key:1,class:"absolute right-3 top-8 z-50"},Fs={class:"flex gap-2 mb-0.5"},js={key:1,class:"px-2 py-0.5 rounded text-fluid-xs font-medium bg-red-50 text-red-700 border border-red-200"},Us={class:"font-bold text-gray-900 text-fluid-sm line-clamp-2 pt-0.5"},Vs={class:"flex gap-3 text-fluid-xs mt-0.5 mb-1"},Rs={class:"flex items-center gap-1.5"},zs={class:"flex items-center gap-1.5"},Ws={key:0,class:"text-fluid-xs text-gray-600 pb-3"},Hs={key:2,class:"flex items-center justify-between pt-1 border-t border-black/5"},Ps={class:"text-fluid-xs flex items-center gap-2"},_s={class:"rounded-full bg-black text-white font-medium flex items-center justify-center text-fluid-xs shrink-0 w-3 h-3"},Qs={class:"text-gray-600 font-medium"},Ys={key:1},Gs={class:"text-fluid-xs font-medium"},Ks={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-black/5 hover:border-blue-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:m}){const s=t,c=A(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),l=A(()=>s.selected),i=A(()=>l.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),o=A(()=>{const d=s.item.displayStage||s.item.stage;return d?ht(d,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),a=d=>{if(!d)return"?";const u=d.split(" ");return u.length>=2?(u[0][0]+u[u.length-1][0]).toUpperCase():d.substring(0,2).toUpperCase()},p=q(null);return(d,u)=>{const f=ut("click-outside");return r(),y("div",{ref_key:"cardRef",ref:p,onClick:u[1]||(u[1]=g=>d.$emit("select",c.value)),class:H(["bg-white rounded-xl p-2.5 min-h-32 flex flex-col justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-shadow",i.value])},[t.showMenu?(r(),y("button",{key:0,onClick:u[0]||(u[0]=Qe(g=>d.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-3 right-3 text-gray-300 hover:text-gray-600"},[...u[2]||(u[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):D("",!0),t.openMenuId===t.item.id&&t.showMenu?le((r(),y("div",Bs,[t.menuItems&&t.menuItems.length>0?(r(),P(n(ct),{key:0,items:t.menuItems,className:"w-40"},null,8,["items"])):D("",!0)])),[[f,()=>d.$emit("menu-close")]]):D("",!0),e("div",null,[e("div",Fs,[e("span",{class:H(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},S(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(r(),y("span",{key:0,class:H(["px-2 py-0.5 rounded text-fluid-xs font-medium border",o.value])},S(t.item.displayStage||t.item.stage),3)):D("",!0),t.item.priority==="Hot"?(r(),y("span",js," Hot ")):D("",!0)]),e("h3",Us,S(t.getName(t.item)),1),e("div",Vs,[e("span",Rs,[u[3]||(u[3]=e("i",{class:"fa-solid fa-location-dot text-fluid-xs"},null,-1)),pe(d.$slots,"location",{item:t.item})]),e("span",zs,[u[4]||(u[4]=e("i",{class:"fa-solid fa-globe text-fluid-xs"},null,-1)),pe(d.$slots,"source",{item:t.item},()=>{var g;return[R(S(t.item.source||((g=t.item.customer)==null?void 0:g.source)||"Unknown"),1)]})])]),t.getVehicleInfo?(r(),y("p",Ws,S(t.getVehicleInfo(t.item)),1)):D("",!0)]),d.$slots.owner||d.$slots.dates?(r(),y("div",Hs,[e("div",Ps,[pe(d.$slots,"owner",{item:t.item},()=>[t.item.assignee?(r(),y(ce,{key:0},[e("div",_s,S(a(t.item.assignee)),1),e("span",Qs,S(t.item.assignee),1)],64)):(r(),y("span",Ys,"Unassigned"))])]),e("div",Gs,[pe(d.$slots,"dates",{item:t.item})])])):D("",!0)],2)}}},Js={class:"flex items-center gap-2"},Zs={key:0,class:"flex gap-2"},Xs={class:"relative ml-auto",ref:"sortContainer"},en={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-brand-dark"},tn={key:0,class:"absolute right-0 mt-2 z-50 sort-dropdown-wrapper"},sn={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:m}){const s=t,c=m,l=q(!1),i=()=>{l.value=!l.value},o=p=>{l.value=!1,c("sort-change",p)},a=A(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>o("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>o("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>o("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>o("assigned-to-my-team")}].map(d=>({...d,className:d.key===s.sortOption?"sort-item-selected":""})));return(p,d)=>{const u=ut("click-outside");return r(),y("div",Js,[t.showTypeFilter?(r(),y("div",Zs,[e("button",{onClick:d[0]||(d[0]=f=>p.$emit("filter-change","all")),class:H(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:d[1]||(d[1]=f=>p.$emit("filter-change","lead")),class:H(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:d[2]||(d[2]=f=>p.$emit("filter-change","opportunity")),class:H(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):D("",!0),e("div",Xs,[e("button",{onClick:Qe(i,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[d[3]||(d[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(r(),y("span",en)):D("",!0)]),C(xt,{name:"dropdown"},{default:O(()=>[l.value?le((r(),y("div",tn,[C(n(ct),{items:a.value,className:"w-56"},null,8,["items"])])),[[u,()=>l.value=!1]]):D("",!0)]),_:1})],512)])}}},nn=we(sn,[["__scopeId","data-v-dba5cff9"]]),ln={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},an={class:"page-header shrink-0"},on={class:"page-header-main"},rn={class:"page-header-content"},dn={class:"page-header-title-container"},un={class:"page-header-title"},cn={class:"page-header-actions"},pn={class:"bg-white border border-black/5 p-0.5 rounded-lg inline-flex gap-0.5"},mn={class:"px-5 py-3"},fn={class:"relative"},yn=["placeholder"],gn={key:0,class:"px-5 pb-3"},vn={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},typeFilter:{type:String,default:"all"},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:t=>t.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},showTypeFilter:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:m}){const s=t,c=m,l=q(s.initialSearchQuery),i=q(null),o=q("recent-first");be(()=>s.initialSearchQuery,u=>{l.value=u});const a=A(()=>{if(!l.value.trim())return s.items;const u=l.value.toLowerCase().trim();return s.items.filter(f=>{const g=s.getName(f).toLowerCase(),x=s.getVehicleInfo(f).toLowerCase();return g.includes(u)||x.includes(u)})}),p=u=>s.selectedId?(u.compositeId||`${u.type||"task"}-${u.id}`)===s.selectedId:!1,d=u=>{o.value=u,c("sort-change",u)};return(u,f)=>(r(),y("div",ln,[e("header",an,[e("div",on,[e("div",rn,[e("div",dn,[e("h1",un,S(t.title),1)]),e("div",cn,[e("div",pn,[e("button",{onClick:f[0]||(f[0]=g=>u.$emit("view-change","table")),class:H(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[C(n(Ot),{size:14})],2),e("button",{onClick:f[1]||(f[1]=g=>u.$emit("view-change","card")),class:H(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[C(n(Tt),{size:14})],2)])])])])]),e("div",mn,[e("div",fn,[f[7]||(f[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),le(e("input",{"onUpdate:modelValue":f[2]||(f[2]=g=>l.value=g),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-lg pl-9 pr-3 py-2 text-fluid-sm"},null,8,yn),[[ye,l.value]])])]),t.showTypeFilter?(r(),y("div",gn,[C(nn,{"type-filter":t.typeFilter,"sort-option":o.value,"show-type-filter":!0,onFilterChange:f[3]||(f[3]=g=>u.$emit("filter-change",g)),onSortChange:d},null,8,["type-filter","sort-option"])])):D("",!0),e("div",{ref_key:"scrollContainer",ref:i,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(r(!0),y(ce,null,ge(a.value,g=>(r(),P(Ks,{key:g.compositeId||`${g.type||"task"}-${g.id}`,item:g,selected:p(g),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(g):null,onSelect:f[4]||(f[4]=x=>u.$emit("select",x)),onMenuClick:f[5]||(f[5]=x=>u.$emit("menu-click",x)),onMenuClose:f[6]||(f[6]=x=>u.$emit("menu-close"))},{location:O(({item:x})=>[pe(u.$slots,"location",{item:x},void 0,!0)]),source:O(({item:x})=>[pe(u.$slots,"source",{item:x},void 0,!0)]),owner:O(({item:x})=>[pe(u.$slots,"owner",{item:x},void 0,!0)]),dates:O(({item:x})=>[pe(u.$slots,"dates",{item:x},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},bn=we(vn,[["__scopeId","data-v-f606b725"]]);function qt(t,m=[],s,c){const l=Se(),i=l.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},o=l.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},a=hn(t,m),p=xn(t,m),d=kn(t),u=wn(t),f=i.intent+i.behavioral+i.temporal,g={intent:i.intent/f*100,behavioral:i.behavioral/f*100,temporal:i.temporal/f*100},x=a/40*g.intent,v=p/35*g.behavioral,I=d/25*g.temporal,T=Math.min(100,Math.max(0,x+v+I+u));let h="COLD";return T>=o.hot?h="HOT":T>=o.warm?h="WARM":T>=o.standard&&(h="STANDARD"),{score:Math.round(T*10)/10,level:h,breakdown:{intent:Math.round(a*10)/10,behavioral:Math.round(p*10)/10,temporal:Math.round(d*10)/10,quality:Math.round(u*10)/10,total:Math.round(T*10)/10}}}function hn(t,m){var c;let s=0;return(t.requestType==="Test Drive"||((c=t.scheduledAppointment)==null?void 0:c.type)==="test-drive"||m.some(l=>l.type==="test-drive"||l.type==="appointment"))&&(s=Math.max(s,40)),m.some(l=>l.type==="financing")&&(s=Math.max(s,35)),m.some(l=>l.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||m.some(l=>{var i,o,a;return((i=l.content)==null?void 0:i.toLowerCase().includes("location"))||((o=l.content)==null?void 0:o.toLowerCase().includes("dealership"))||((a=l.content)==null?void 0:a.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||m.some(l=>{var i,o;return((i=l.content)==null?void 0:i.toLowerCase().includes("configur"))||l.type==="attachment"&&((o=l.fileName)==null?void 0:o.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),m.some(l=>{var o;const i=((o=l.content)==null?void 0:o.toLowerCase())||"";return i.includes("compare")||i.includes("versus")||i.includes("vs")||i.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function xn(t,m){let s=0;const c=new Set(m.map(a=>{if(!a.timestamp)return null;const p=new Date(a.timestamp);return`${p.getFullYear()}-${p.getMonth()}-${p.getDate()}`}).filter(Boolean)),l=Math.min(c.size*10,35);s+=l,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const i=m.reduce((a,p)=>{var d;return a+(((d=p.content)==null?void 0:d.length)||0)},0),o=Math.min(Math.floor(i/50),25);return s+=o,m.some(a=>{var p,d,u;return a.type==="attachment"&&(((p=a.fileName)==null?void 0:p.toLowerCase().includes("brochure"))||((d=a.fileName)==null?void 0:d.toLowerCase().includes("spec"))||((u=a.fileName)==null?void 0:u.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function kn(t){let m=0;if(!t.createdAt)return 0;const s=new Date,c=new Date(t.createdAt),l=(s.getTime()-c.getTime())/(1e3*60*60);l<2?m+=25:l<24?m+=15:l<48?m+=5:m-=10;const i=c.getDay(),o=c.getHours();if((i===0||i===6||o<9||o>17)&&(m+=10),t.contactAttempts&&t.contactAttempts.length===3&&(m+=50),t.lastActivity){const a=new Date(t.lastActivity);(s.getTime()-a.getTime())/(1e3*60*60*24)>3&&(m+=20)}return Math.min(Math.max(m,0),25)}function wn(t){var s,c,l,i,o,a,p;let m=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(m+=10),(c=t.customer)!=null&&c.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(m+=10),(l=t.customer)!=null&&l.name&&((i=t.customer)!=null&&i.email)&&((o=t.customer)!=null&&o.phone)&&((a=t.customer)!=null&&a.address)&&(m+=5),(t.isDuplicate||t.isDisqualified||!((p=t.customer)!=null&&p.name))&&(m-=20),m}function Nt(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Mt(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Cn({typeFilter:t,showTypeFilter:m,tasks:s}){return{filterDefinitions:A(()=>{const l=[];m.value&&l.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),l.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),l.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&l.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),l.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const i=[...new Set(s.value.map(a=>a.assignee).filter(Boolean))];i.length>0&&l.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:i.map(a=>({value:a,label:a})),aiHint:"Person assigned to the task",pinned:!0});const o=[...new Set(s.value.map(a=>{const p=a.type==="lead"?a.requestedCar:a.vehicle;return p==null?void 0:p.brand}).filter(Boolean))];return o.length>0&&l.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:o.map(a=>({value:a,label:a})),aiHint:"Car brand requested by customer"}),l.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),l})}}const $n={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},Sn={class:"page-header shrink-0"},An={class:"page-header-main"},Dn={class:"page-header-content"},Tn={class:"page-header-actions"},In={class:"bg-white border border-black/5 p-0.5 rounded-lg inline-flex gap-0.5"},On={class:"flex-1 overflow-y-auto p-4 md:p-8"},qn={class:"table-wrapper w-full"},Nn={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:m}){const s=t,c=m,l=Se();q("");const i=q({pageIndex:0,pageSize:10}),o=q(""),a=q([]),p=q([{id:"status",value:["Valid","Qualified","Open Lead"],operator:"in"},{id:"type",value:"lead",operator:"eq"},{id:"source",value:["Marketing","Website"],operator:"in"},{id:"assignee",value:void 0},{id:"urgencyLevel",value:void 0}]);q({});const{filterDefinitions:d}=Cn({typeFilter:A(()=>s.typeFilter),showTypeFilter:A(()=>s.showTypeFilter),tasks:A(()=>s.tasks)}),u=A(()=>s.tasks),f=k=>k.compositeId===s.currentTaskId||k.compositeId===s.highlightId,g=k=>{if(k.type==="lead")return k.requestedCar?`${k.requestedCar.brand} ${k.requestedCar.model}`:"No vehicle specified";const b=k.vehicle||k.requestedCar;return b?`${b.brand} ${b.model}`:"No vehicle specified"},x=k=>{const b=k.type==="lead"?k.requestedCar:k.vehicle;if(!b)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const w=b.stockDays!==void 0&&b.stockDays!==null;return{status:w?"In Stock":"Out of Stock",class:w?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},v=k=>{var b;return k.type==="lead"?((b=k.requestedCar)==null?void 0:b.requestType)||k.requestType||"N/A":k.requestType||"Opportunity"},I=A(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:k=>T(k.original)},cell:({row:k})=>{const b=k.original,w=b.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return de("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${w}`},b.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:k})=>{const b=k.original;return de("div",{class:"flex items-center gap-2 md:gap-3"},[de("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${b.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},b.customer.initials),de("div",{class:"min-w-0"},[de("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},b.customer.name),de("div",{class:"text-meta truncate hidden sm:block"},b.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:k})=>{const b=k.original,w=g(b);return w==="No vehicle specified"?de("span",{class:"text-meta"},"N/A"):de("div",{class:"flex items-center gap-2"},[de("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),de("span",{class:"text-content font-medium text-heading truncate max-w-32"},w)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:k})=>{const b=k.original,w=x(b);return de("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${w.class}`},w.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:k})=>{const b=k.original,w=v(b);return de("span",{class:"text-meta"},w)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:k})=>{const b=k.original;return de("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},b.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:k})=>{const b=k.original,w=s.getOwnerInfo(b);return de("div",{class:"flex items-center gap-2"},[de("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},w.initials),de("span",{class:"text-meta truncate max-w-20"},w.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:k})=>{const b=k.original,w=b.type==="lead"?b.status:b.displayStage||b.stage,L=s.getStageBadgeClass(w);return de("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${L}`},w)}},...s.typeFilter==="lead"&&l.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:k})=>{const b=k.original;if(b.type!=="lead")return de("span",{class:"text-meta"},"â€”");let w=b.urgencyLevel;w||(w=qt(b).level);const L=Mt(w),Y=Nt(w);return de("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${L}`},[de("span",{},Y),de("span",{},w)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:k})=>{const b=k.original;return de("button",{class:"text-sub hover:text-body",onClick:w=>{w.stopPropagation(),c("menu-click",b.id)}},[de("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),T=k=>{o.value=String(k.id),c("select",k.compositeId)},h=A(()=>({class:{tr:k=>{const b="cursor-pointer hover:bg-surfaceSecondary transition-colors",w=k.original;return f(w)?`${b} bg-blue-50 border-l-4 border-l-blue-500`:b}}}));return(k,b)=>(r(),y("div",$n,[e("header",Sn,[e("div",An,[e("div",Dn,[b[8]||(b[8]=e("div",{class:"page-header-title-container"},[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Tn,[e("div",In,[e("button",{onClick:b[0]||(b[0]=w=>k.$emit("view-change","table")),class:H(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[C(n(Ot),{size:14})],2),e("button",{onClick:b[1]||(b[1]=w=>k.$emit("view-change","card")),class:H(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[C(n(Tt),{size:14})],2)]),e("button",{onClick:b[2]||(b[2]=w=>k.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...b[7]||(b[7]=[e("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),e("div",On,[e("div",qn,[C(n(es),{data:u.value,columns:I.value,meta:h.value,onRowClick:T,columnFiltersOptions:{filterDefs:n(d)},pagination:i.value,"onUpdate:pagination":b[3]||(b[3]=w=>i.value=w),globalFilter:o.value,"onUpdate:globalFilter":b[4]||(b[4]=w=>o.value=w),sorting:a.value,"onUpdate:sorting":b[5]||(b[5]=w=>a.value=w),columnFilters:p.value,"onUpdate:columnFilters":b[6]||(b[6]=w=>p.value=w),paginationOptions:{rowCount:u.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{toolbar:O(()=>[...b[9]||(b[9]=[e("div",{class:"flex justify-end"},[e("button",{class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-4 py-2 text-sm font-medium text-body hover:border-purple-100 hover:bg-purple-50 hover:text-purple-600 transition-all"},[e("i",{class:"fa-solid fa-arrow-left text-sub group-hover:text-purple-500"}),e("span",{class:"hidden sm:inline"},"Switch back to old design")])],-1)])]),"empty-state":O(()=>[...b[10]||(b[10]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Mn={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border bg-surface"},En={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-black/5 bg-surface"},Ln={__name:"TaskDetailViewCompact",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},setup(t){return(m,s)=>t.task?(r(),y("div",Mn,[C(ts,Ge({task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},m.$attrs),null,16,["task","type","management-widget","store-adapter","add-new-config"])])):(r(),y("div",En,[...s[0]||(s[0]=[Ye('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-sub"></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2">No task selected</h3><p class="text-fluid-sm text-sub">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},Bn={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Fn={class:"flex items-center justify-between gap-4 w-full h-full"},jn={class:"flex flex-col gap-0.5 min-w-0"},Un={class:"text-fluid-lg font-medium text-greys-900"},Vn={key:0,class:"text-fluid-sm text-greys-500 truncate"},Rn={key:1,class:"text-fluid-sm text-greys-500"},zn={class:"flex items-center gap-2 shrink-0"},Wn={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]}},emits:["previous","next"],setup(t){const m=t,s=A(()=>!m.task||!m.filteredTasks.length?!1:m.filteredTasks.findIndex(a=>{const p=m.task.compositeId||m.task.id;return(a.compositeId||a.id)===p})>0),c=A(()=>{if(!m.task||!m.filteredTasks.length)return!1;const o=m.filteredTasks.findIndex(a=>{const p=m.task.compositeId||m.task.id;return(a.compositeId||a.id)===p});return o>=0&&o<m.filteredTasks.length-1}),l=o=>o?o.type==="lead"?"Lead Qualification Task":o.type==="opportunity"?"Opportunity Management Task":"Task Details":"",i=o=>{var p;if(!o)return"";const a=[];if(o.vehicle||o.requestedCar){const d=o.vehicle||o.requestedCar;d.brand&&d.model?a.push(`${d.brand} ${d.model} (${d.year||"N/A"})`):d.model&&a.push(`${d.model} (${d.year||"N/A"})`)}return o.source&&a.push(o.source),(p=o.customer)!=null&&p.name?a.push(o.customer.name):o.customerName&&a.push(o.customerName),a.join(" â€¢ ")};return(o,a)=>(r(),y("div",Bn,[e("div",Fn,[e("div",jn,[e("h2",Un,S(l(t.task)),1),t.task?(r(),y("p",Vn,S(i(t.task)),1)):(r(),y("p",Rn," Select a task to view details "))]),e("div",zn,[C(n(Ce),{variant:"secondary",size:"icon",onClick:a[0]||(a[0]=p=>o.$emit("previous")),disabled:!s.value},{default:O(()=>[C(n(Is),{size:16})]),_:1},8,["disabled"]),C(n(Ce),{variant:"secondary",size:"icon",onClick:a[1]||(a[1]=p=>o.$emit("next")),disabled:!c.value},{default:O(()=>[C(n(Os),{size:16})]),_:1},8,["disabled"])])])]))}},Hn=we(Wn,[["__scopeId","data-v-8eea4260"]]),Pn={class:"grid grid-cols-3 gap-4"},_n={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                    0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                    0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Qn={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},Yn={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                    0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                    0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Gn={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},Kn={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                    0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                    0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Jn={class:"flex items-center gap-2 min-w-0 flex-1 justify-end"},Zn={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0"},Xn={__name:"TaskInfoCards",props:{task:{type:Object,required:!0},type:{type:String,required:!0}},setup(t){const m=t,s=A(()=>m.task.displayStage?m.task.displayStage:m.task.stage?m.task.stage.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"N/A"),c=A(()=>m.task.assignee||m.task.owner||m.task.assignedTo||""),l=i=>{if(!i)return"U";const o=i.trim().split(" ");return o.length>=2?`${o[0][0]}${o[1][0]}`.toUpperCase():i.substring(0,2).toUpperCase()};return(i,o)=>(r(),y("div",Pn,[e("div",_n,[o[0]||(o[0]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Stage",-1)),e("p",Qn,S(s.value),1)]),e("div",Yn,[o[1]||(o[1]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Source",-1)),e("p",Gn,S(t.task.source||"N/A"),1)]),e("div",Kn,[o[2]||(o[2]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Owner",-1)),e("div",Jn,[c.value?(r(),P(n(Cs),{key:0,class:"h-5 w-5 shrink-0"},{default:O(()=>[C(n(ws),{class:"bg-orange-500 text-white text-xs"},{default:O(()=>[R(S(l(c.value)),1)]),_:1})]),_:1})):D("",!0),e("p",Zn,S(c.value||"Unassigned"),1)])])]))}},el=we(Xn,[["__scopeId","data-v-15a853e9"]]),tl=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:t=>["lead","opportunity"].includes(t)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(t){return(m,s)=>(r(),y("div",null,[t.managementWidget?(r(),P(Ke(t.managementWidget),Ge({key:0,lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:t.activities},m.$attrs),null,16,["lead","opportunity","activities"])):D("",!0)]))}}),sl=we(tl,[["__scopeId","data-v-f5db9491"]]),nl={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                  0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                  0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},ll={key:0,class:"w-full h-40 rounded-lg overflow-hidden mb-4 bg-gray-100"},al=["src","alt"],ol={key:1,class:"w-full h-40 rounded-lg overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},il={class:"space-y-2 mb-4"},rl={class:"flex justify-between items-start gap-2"},dl={class:"min-w-0 flex-1"},ul={class:"text-sm font-medium text-greys-900 truncate"},cl={key:0,class:"text-xs text-greys-500"},pl={key:0,class:"text-sm font-semibold text-greys-900 shrink-0"},ml={key:0,class:"flex gap-3 text-xs text-greys-500"},fl={key:0},yl={key:1},gl={key:2,class:"mb-4"},vl={key:3,class:"rounded-lg p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},bl={class:"text-sm text-greys-900"},hl={class:"flex gap-2 pt-4 border-t border-black/5"},xl={__name:"TaskRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(t){const m=t,s=q(!1),c=A(()=>{const a=[];return m.vehicle.brand&&a.push(m.vehicle.brand),m.vehicle.model&&a.push(m.vehicle.model),m.vehicle.variant&&a.push(m.vehicle.variant),a.join(" ")||"Vehicle Details"}),l=a=>{if(!a)return"0";const p=typeof a=="string"?parseFloat(a):a;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(p)},i=a=>{if(!a)return"0";const p=typeof a=="string"?parseFloat(a):a;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(p)},o=()=>{s.value=!0};return(a,p)=>(r(),y("div",nl,[p[4]||(p[4]=e("h3",{class:"text-base font-medium mb-4 text-greys-900"},"Requested Car",-1)),t.imageUrl?(r(),y("div",ll,[e("img",{src:t.imageUrl,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover",onError:o},null,40,al)])):(r(),y("div",ol,[C(n(Ts),{size:48,class:"text-gray-400"})])),e("div",il,[e("div",rl,[e("div",dl,[e("p",ul,S(c.value),1),t.vehicle.year?(r(),y("p",cl,S(t.vehicle.year),1)):D("",!0)]),t.vehicle.price?(r(),y("p",pl," â‚¬"+S(l(t.vehicle.price)),1)):D("",!0)]),t.vehicle.mileage||t.vehicle.fuelType?(r(),y("div",ml,[t.vehicle.mileage?(r(),y("span",fl,S(i(t.vehicle.mileage))+" km",1)):D("",!0),t.vehicle.fuelType?(r(),y("span",yl,S(t.vehicle.fuelType),1)):D("",!0)])):D("",!0)]),t.source?(r(),y("div",gl,[C(n($s),{variant:"secondary",class:"text-xs"},{default:O(()=>[R(S(t.source),1)]),_:1})])):D("",!0),t.requestMessage?(r(),y("div",vl,[p[2]||(p[2]=e("p",{class:"text-xs text-greys-500 mb-1"},"Request message",-1)),e("p",bl,S(t.requestMessage),1)])):D("",!0),e("div",hl,[C(n(Ce),{variant:"secondary",size:"sm",class:"flex-1",onClick:p[0]||(p[0]=d=>a.$emit("open-ad"))},{default:O(()=>[C(n(ss),{size:16}),p[3]||(p[3]=e("span",null,"Open Ad",-1))]),_:1}),C(n(Ce),{variant:"secondary",size:"icon-sm",onClick:p[1]||(p[1]=d=>a.$emit("more-actions"))},{default:O(()=>[C(n(Ns),{size:16})]),_:1})])]))}},kl=we(xl,[["__scopeId","data-v-09574481"]]),wl={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                  0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                  0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Cl={key:0,class:"space-y-6"},$l={class:"text-sm text-greys-500 font-medium"},Sl={class:"space-y-4"},Al=["onClick"],Dl={class:"flex-1 min-w-0"},Tl={class:"text-sm leading-5"},Il={class:"font-normal text-greys-900"},Ol={class:"text-greys-500"},ql={class:"text-sm text-greys-900"},Nl=["onClick"],Ml=["onClick"],El={class:"text-xs text-greys-500 mt-1"},Ll={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Bl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded"],setup(t,{emit:m}){const s=t,c=m,l=A(()=>[...s.activities].sort((v,I)=>{const T=new Date(v.timestamp||v.createdAt||0).getTime();return new Date(I.timestamp||I.createdAt||0).getTime()-T})),i=v=>({note:dt,email:It,whatsapp:_e,sms:_e,call:Es,meeting:Yt,task:gt,status_change:Ls,assignment:Qt})[v]||gt,o=v=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;",sms:"background-color: #f3e8ff;",call:"background-color: #dbeafe;",meeting:"background-color: #e0e7ff;",task:"background-color: #f5f5f5;",status_change:"background-color: #fef3c7;",assignment:"background-color: #e5e7eb;"})[v]||"background-color: #f5f5f5;",a=v=>({note:"text-orange-600",email:"text-blue-600",whatsapp:"text-green-600",sms:"text-purple-600",call:"text-blue-500",meeting:"text-indigo-600",task:"text-gray-600",status_change:"text-yellow-600",assignment:"text-gray-500"})[v]||"text-gray-600",p=v=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;"})[v]||"background-color: #f5f5f5;",d=v=>["note","email","whatsapp"].includes(v.type)&&v.content,u=v=>v.content?s.expandedSummaries[v.id]?v.content:v.content.length>100?v.content.substring(0,100)+"...":v.content:"",f=v=>{if(!v||v.length===0)return"";const I=v[0],T=I.timestamp||I.createdAt;if(!T)return"Recent Activity";const h=new Date(T),k=new Date,b=new Date(k);return b.setDate(b.getDate()-1),h.toDateString()===k.toDateString()?"Today":h.toDateString()===b.toDateString()?"Yesterday":h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:h.getFullYear()!==k.getFullYear()?"numeric":void 0})},g=v=>{["note","email","whatsapp"].includes(v.type)&&c("activity-click",v)},x=v=>{c("toggle-summary-expanded",v)};return(v,I)=>(r(),y("div",wl,[I[1]||(I[1]=e("h3",{class:"text-base font-medium mb-4 text-greys-900"},"Activity",-1)),l.value.length>0?(r(),y("div",Cl,[e("h3",$l,S(f(l.value)),1),e("div",Sl,[(r(!0),y(ce,null,ge(l.value,T=>(r(),y("div",{key:T.id,class:H(["flex gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":T.type==="note"||T.type==="email"||T.type==="whatsapp"}]),onClick:h=>g(T)},[e("div",{class:"size-8 rounded-md flex items-center justify-center shrink-0",style:yt(o(T.type))},[(r(),P(Ke(i(T.type)),{size:16,class:H(a(T.type))},null,8,["class"]))],4),e("div",Dl,[e("p",Tl,[e("span",Il,S(T.user),1),e("span",Ol,S(T.action),1)]),T.content&&d(T)?(r(),y("div",{key:0,class:"mt-2 rounded-lg p-4",style:yt(p(T.type))},[e("p",ql,S(u(T)),1),T.content.length>100&&!t.expandedSummaries[T.id]?(r(),y("button",{key:0,onClick:Qe(h=>x(T.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show more ",8,Nl)):T.content.length>100&&t.expandedSummaries[T.id]?(r(),y("button",{key:1,onClick:Qe(h=>x(T.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show less ",8,Ml)):D("",!0)],4)):D("",!0),e("p",El,S(T.time),1)])],10,Al))),128))])])):(r(),y("div",Ll,[C(n(qs),{size:32,class:"text-greys-400 mb-2"}),I[0]||(I[0]=e("p",{class:"text-sm text-greys-500"},"No activity yet",-1))]))]))}},Fl=we(Bl,[["__scopeId","data-v-d02bc273"]]),jl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},Ul={class:"flex flex-1 overflow-hidden"},Vl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},Rl={class:"px-6 py-0 shrink-0"},zl={class:"flex items-stretch h-12 gap-4 border-b border-black/5"},Wl=["onClick"],Hl={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"},Pl={class:"flex-1 overflow-y-auto"},_l={key:0,class:"p-6 space-y-4"},Ql={key:1,class:"p-6 space-y-4"},Yl={class:"px-4 py-2 flex items-center justify-between"},Gl={class:"flex items-center gap-2"},Kl={class:"text-base font-medium text-greys-500"},Jl={class:"text-sm text-greys-500"},Zl={class:"p-4 overflow-hidden",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                              0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                              0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},Xl={class:"text-sm font-medium text-greys-900"},ea={class:"text-sm mt-1 text-greys-700"},ta={key:0,class:"flex justify-end mt-4"},sa={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},na={key:2,class:"p-6 space-y-4"},la={class:"px-4 py-2 flex items-center justify-between"},aa={class:"flex items-center gap-2"},oa={class:"text-base font-medium text-greys-500"},ia={class:"text-sm text-greys-500"},ra={class:"p-4 overflow-hidden",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":`0 0 0 1px rgba(14, 63, 126, 0.04), 0 1px 1px -0.5px rgba(42, 51, 69, 0.04), 
                              0 3px 3px -1.5px rgba(42, 51, 70, 0.04), 0 6px 6px -3px rgba(42, 51, 70, 0.04), 
                              0 12px 12px -6px rgba(14, 63, 126, 0.04), 0 24px 24px -12px rgba(14, 63, 126, 0.04)`}},da={class:"text-sm text-greys-900"},ua={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},ca={key:3,class:"p-6"},pa={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},ma={class:"right-sidebar flex flex-col overflow-y-auto shrink-0 border-l border-black/5",style:{"background-color":"#F8F8F8"}},fa={class:"space-y-2 p-2"},ya={key:1,class:"flex-1 flex items-center justify-center bg-surface"},ga={__name:"TaskDetailViewTabbed",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t,{emit:m}){const s=t,c=m,l=q("overview"),i=q({}),o=[{key:"overview",label:"Overview"},{key:"communication",label:"Communication"},{key:"notes",label:"Notes"},{key:"attachments",label:"Attachments"}],a=A(()=>{var N;return((N=s.storeAdapter.currentActivities)==null?void 0:N.value)||[]}),p=A(()=>a.value.filter(N=>["email","whatsapp","sms","call"].includes(N.type))),d=A(()=>a.value.filter(N=>N.type==="note")),u=A(()=>a.value.filter(N=>N.type==="attachment")),f=N=>N==="overview"?1:N==="communication"?p.value.length:N==="notes"?d.value.length:N==="attachments"?u.value.length:0,g=()=>{c("task-navigate","previous")},x=()=>{c("task-navigate","next")},v=q(null),I=q({}),T=q({});let h=null;const k=N=>{h!==null&&(window.clearTimeout(h),h=null),v.value=N,N&&(h=window.setTimeout(()=>{v.value=null,h=null},900))},b=async()=>{if(v.value){if(await Kt(),v.value.tab==="notes"&&l.value==="notes"){const N=I.value[v.value.id];N&&typeof N.scrollIntoView=="function"&&N.scrollIntoView({behavior:"smooth",block:"center"})}if(v.value.tab==="communication"&&l.value==="communication"){const N=T.value[v.value.id];N&&typeof N.scrollIntoView=="function"&&N.scrollIntoView({behavior:"smooth",block:"center"})}}},w=(N,K)=>{K?I.value[N]=K:delete I.value[N]},L=(N,K)=>{K?T.value[N]=K:delete T.value[N]},Y=N=>v.value?v.value.tab==="notes"&&v.value.type==="note"&&v.value.id===N.id:!1,G=N=>v.value?v.value.tab==="communication"&&(v.value.type==="email"||v.value.type==="whatsapp")&&v.value.id===N.id:!1;be(()=>[v.value,l.value],()=>{v.value&&b()}),Gt(()=>{h!==null&&(window.clearTimeout(h),h=null)});const ne=N=>{N.type==="note"?(l.value="notes",k({tab:"notes",type:"note",id:N.id})):["email","whatsapp","sms","call"].includes(N.type)?(l.value="communication",k({tab:"communication",type:N.type,id:N.id})):N.type==="attachment"&&(l.value="attachments",k(null))},oe=N=>{i.value[N]=!i.value[N]},J=N=>N==="email"?It:_e,B=N=>N==="email"?"text-blue-600":N==="whatsapp"?"text-green-600":N==="sms"?"text-purple-600":"text-gray-600",F=N=>{const K=N.from==="lead"||N.direction==="incoming";return N.type==="whatsapp"?K?"Received WhatsApp message":"Sent WhatsApp message":N.type==="email"?K?"Received Email":"Sent Email":N.type==="sms"?K?"Received SMS":"Sent SMS":"Message"},j=N=>N&&(N.image||N.imageUrl)||"",E=()=>{console.log("Open ad clicked")},V=()=>{console.log("More actions clicked")},W=N=>{console.log("Contact action:",N)};return(N,K)=>{var ve,he;return t.task?(r(),y("div",jl,[C(Hn,{task:t.task,"filtered-tasks":t.filteredTasks,onPrevious:g,onNext:x},null,8,["task","filtered-tasks"]),e("div",Ul,[e("div",Vl,[e("div",Rl,[e("div",zl,[(r(),y(ce,null,ge(o,Q=>e("button",{key:Q.key,onClick:me=>l.value=Q.key,class:"relative flex items-center gap-1.5 px-0 h-full"},[e("span",{class:H(["text-sm font-medium",l.value===Q.key?"text-greys-900":"text-greys-500"])},S(Q.label),3),e("span",{class:H(["px-2 py-0.5 rounded-lg text-sm",l.value===Q.key?"bg-blue-50 text-blue-600 font-bold":"bg-surfaceSecondary text-greys-600 font-medium"])},S(f(Q.key)),3),l.value===Q.key?(r(),y("span",Hl)):D("",!0)],8,Wl)),64))])]),e("div",Pl,[l.value==="overview"?(r(),y("div",_l,[C(el,{task:t.task,type:t.task.type},null,8,["task","type"]),C(sl,Ge({task:t.task,type:t.task.type,"management-widget":t.managementWidget,activities:a.value},N.$attrs),null,16,["task","type","management-widget","activities"])])):D("",!0),l.value==="communication"?(r(),y("div",Ql,[(r(!0),y(ce,null,ge(p.value,Q=>(r(),y("div",{key:Q.id,ref_for:!0,ref:me=>L(Q.id,me),class:H(["bg-greys-100 rounded-lg p-1",G(Q)&&Q.type==="whatsapp"?"highlight-whatsapp":"",G(Q)&&Q.type==="email"?"highlight-email":""]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[e("div",Yl,[e("div",Gl,[(r(),P(Ke(J(Q.type)),{size:18,class:H(B(Q.type))},null,8,["class"])),e("h3",Kl,S(F(Q)),1)]),e("span",Jl,S(Q.timestamp||Q.time),1)]),e("div",Zl,[e("p",Xl,S(Q.senderName||Q.user),1),e("p",ea,S(Q.content),1),Q.from==="lead"||Q.direction==="incoming"?(r(),y("div",ta,[C(n(Ce),{size:"sm"},{default:O(()=>[...K[0]||(K[0]=[R("Reply",-1)])]),_:1})])):D("",!0)])],2))),128)),p.value.length===0?(r(),y("div",sa,[C(n(_e),{size:48,class:"text-greys-400 mb-4"}),K[2]||(K[2]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No communication yet",-1)),K[3]||(K[3]=e("p",{class:"text-sm text-greys-500 mb-4"},"Start a conversation with the customer",-1)),C(n(Ce),null,{default:O(()=>[...K[1]||(K[1]=[R("Send message",-1)])]),_:1})])):D("",!0)])):D("",!0),l.value==="notes"?(r(),y("div",na,[(r(!0),y(ce,null,ge(d.value,Q=>(r(),y("div",{key:Q.id,ref_for:!0,ref:me=>w(Q.id,me),class:H(["bg-[#fef7ee] rounded-lg p-1",Y(Q)?"highlight-note":""])},[e("div",la,[e("div",aa,[C(n(dt),{size:18,class:"text-orange-600"}),e("h3",oa,"Note by "+S(Q.user),1)]),e("span",ia,S(Q.timestamp||Q.time),1)]),e("div",ra,[e("p",da,S(Q.content),1)])],2))),128)),d.value.length===0?(r(),y("div",ua,[C(n(dt),{size:48,class:"text-greys-400 mb-4"}),K[5]||(K[5]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No notes yet",-1)),K[6]||(K[6]=e("p",{class:"text-sm text-greys-500 mb-4"},"Add a note to keep track of important information",-1)),C(n(Ce),null,{default:O(()=>[...K[4]||(K[4]=[R("Add note",-1)])]),_:1})])):D("",!0)])):D("",!0),l.value==="attachments"?(r(),y("div",ca,[u.value.length===0?(r(),y("div",pa,[C(n(Ms),{size:48,class:"text-greys-400 mb-4"}),K[8]||(K[8]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No attachments yet",-1)),K[9]||(K[9]=e("p",{class:"text-sm text-greys-500 mb-4"},"Upload files related to this task",-1)),C(n(Ce),null,{default:O(()=>[...K[7]||(K[7]=[R("Add attachment",-1)])]),_:1})])):D("",!0)])):D("",!0)])]),e("div",ma,[e("div",fa,[C(ns,{task:t.task,"task-type":t.task.type,"customer-id":t.task.customerId||((ve=t.task.customer)==null?void 0:ve.id),onAction:W},null,8,["task","task-type","customer-id"]),t.task.requestedCar||t.task.vehicle?(r(),P(kl,{key:0,vehicle:t.task.requestedCar||t.task.vehicle,"request-message":t.task.requestMessage||((he=t.task.requestedCar)==null?void 0:he.requestMessage),source:t.task.source,"image-url":j(t.task.requestedCar||t.task.vehicle),onOpenAd:E,onMoreActions:V},null,8,["vehicle","request-message","source","image-url"])):D("",!0),C(Fl,{activities:a.value,"expanded-summaries":i.value,onActivityClick:ne,onToggleSummaryExpanded:oe},null,8,["activities","expanded-summaries"])])])])])):(r(),y("div",ya,[...K[10]||(K[10]=[Ye('<div class="text-center max-w-sm p-8" data-v-10cadf7c><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center" data-v-10cadf7c><i class="fa-solid fa-tasks text-2xl text-sub" data-v-10cadf7c></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2" data-v-10cadf7c>No task selected</h3><p class="text-fluid-sm text-sub" data-v-10cadf7c>Select a task from the list to view its details and manage activities</p></div>',1)])]))}}},va=we(ga,[["__scopeId","data-v-10cadf7c"]]),ba={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},ha={key:0,class:"absolute top-3 right-[18px] z-50 flex items-center gap-1 bg-white border border-E5E7EB rounded-md shadow-sm p-0.5"},xa={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t){const m=Se(),s=A(()=>m.getSetting("taskDetailsViewMode")||"compact"),c=A(()=>s.value==="tabbed"?va:Ln),l=i=>{m.setSetting("taskDetailsViewMode",i)};return(i,o)=>(r(),y("div",ba,[t.task?(r(),y("div",ha,[e("button",{onClick:o[0]||(o[0]=a=>l("compact")),class:H(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="compact"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Compact View"},[...o[3]||(o[3]=[e("i",{class:"fa-solid fa-list text-[10px] mr-1"},null,-1),R(" Compact ",-1)])],2),e("button",{onClick:o[1]||(o[1]=a=>l("tabbed")),class:H(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="tabbed"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Tabbed View"},[...o[4]||(o[4]=[e("i",{class:"fa-solid fa-table-columns text-[10px] mr-1"},null,-1),R(" Tabbed ",-1)])],2)])):D("",!0),(r(),P(Ke(c.value),Ge({task:t.task,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig,"filtered-tasks":t.filteredTasks},i.$attrs,{onTaskNavigate:o[2]||(o[2]=a=>i.$emit("task-navigate",a))}),null,16,["task","management-widget","store-adapter","add-new-config","filtered-tasks"]))]))}},vt=we(xa,[["__scopeId","data-v-9ac5c3fc"]]),ka={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},wa={class:"px-4 py-3 flex items-center justify-between gap-3"},Ca=["aria-label"],$a={key:0,class:"flex-1 flex items-center justify-center"},Sa={key:1,class:"flex items-center gap-2"},Aa={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:m}){const s=m,c=()=>{s("back")};return(l,i)=>t.show?(r(),y("div",ka,[e("div",wa,[e("button",{onClick:c,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...i[0]||(i[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Ca),l.$slots.title?(r(),y("div",$a,[pe(l.$slots,"title")])):D("",!0),l.$slots.actions?(r(),y("div",Sa,[pe(l.$slots,"actions")])):D("",!0)])])):D("",!0)}};function Et(t,m={}){const s=Se(),c=A(()=>{const T=typeof t=="function"?t():tt(t);return{lead:T,displayStage:T?kt(T,"lead"):null}}),l=A(()=>c.value.displayStage||"New"),i=A(()=>{const T=c.value;return ls(T)}),o=A(()=>{const T=c.value,h=as(T);if(!h)return null;const k=m[h.key];return{...h,handler:k||(()=>{})}}),a=A(()=>{const T=c.value;return os(T).map(k=>{const b=m[k.key];return{...k,handler:b||(()=>{})}})}),p=A(()=>{const T=c.value;return is(T)}),d=A(()=>{const T=c.value;return rs(T)}),u=A(()=>{const T=c.value;return ds(T)}),f=A(()=>{const T=c.value;return us(T)}),g=A(()=>{const h=c.value.lead;return((h==null?void 0:h.contactAttempts)||[]).length||0}),x=A(()=>s.getSetting("maxContactAttempts")),v=A(()=>g.value+1>=x.value),I=A(()=>!0);return{displayStage:l,isClosed:i,primaryAction:o,secondaryActions:a,showLQWidget:p,showDeadlineBanner:d,canPostpone:u,canReassign:I,lqWidgetMode:f,contactAttempts:g,maxContactAttempts:x,shouldShowAutoDisqualifyWarning:v}}function Da({getLead:t,leadState:m,emit:s}){const c=pt(),l=ze(),i=Ie();async function o(h){var b;const k=t();if(k&&m.canPostpone.value)try{const w=new Date(`${h.date}T${h.time}:00`),L=w.toISOString(),Y={nextActionDue:L};if((h.assigneeId||h.teamId)&&(Y.assignee=h.assignee||null,Y.assigneeId=h.assigneeId||null,Y.assigneeType=h.assigneeType||"user",Y.teamId=h.teamId||null,Y.team=h.team||null),await l.updateLead(k.id,Y),h.createAppointment){const G=new Date(w);G.setHours(G.getHours()+1),await l.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${k.customer.name}`,start:L,end:G.toISOString(),type:"Call",assignee:h.assignee||k.assignee,assigneeId:h.assigneeId||k.assigneeId,assigneeType:h.assigneeType||k.assigneeType||"user",teamId:h.teamId||k.teamId,team:h.team||k.team,status:"scheduled"}}),await l.addActivity(k.id,{type:"appointment",user:((b=i.currentUser)==null?void 0:b.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Re(w)} at ${Pe(w)}`,data:{type:"Call",date:h.date,time:h.time,assignee:h.assignee||k.assignee}})}await l.addActivity(k.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Re(w)} at ${Pe(w)}${h.assignee?` and reassigned to ${h.assignee}`:""}`}),await l.fetchLeadById(k.id)}catch(w){console.error("Failed to postpone lead task:",w)}}async function a(h){const k=t();if(k)try{if(await l.updateLead(k.id,{stage:"Validated"}),await l.addActivity(k.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),h.scheduleFollowUp&&h.appointmentData){const b=new Date(`${h.appointmentData.date}T${h.appointmentData.time}:00`);await l.scheduleFollowUp(k.id,{dateTime:b.toISOString(),assignee:h.appointmentData.assignee||k.assignee,assigneeId:h.appointmentData.assigneeId||null,assigneeType:h.appointmentData.assigneeType||"user",teamId:h.appointmentData.teamId||null,team:h.appointmentData.team||null}),await l.addActivity(k.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Re(b)} at ${Pe(b)}`})}await l.fetchLeadById(k.id)}catch(b){console.error("Failed to validate lead:",b)}}async function p(){const h=t();if(h)try{const k=await l.convertLeadToOpportunity(h.id);i.canAccessOpportunities()?c.push({path:`/tasks/${k}`,query:{type:"opportunity"}}):c.push("/tasks")}catch(k){console.error("Failed to qualify lead:",k)}}async function d(h){const k=t();if(k)try{const b=k.contactAttempts||[];await l.updateLead(k.id,{contactAttempts:[...b,h],lastContactAttempt:h.timestamp,totalContactAttempts:b.length+1}),await l.addActivity(k.id,{type:"call",user:"You",action:`logged call attempt - ${h.outcome}`,content:h.notes||`Call attempt via ${h.channel}`,data:{outcome:h.outcome,channel:h.channel,duration:h.duration}}),await l.fetchLeadById(k.id)}catch(b){console.error("Failed to log call attempt:",b)}}async function u(h){const k=t();if(k)try{await l.addActivity(k.id,{type:"note",user:"You",action:"added a note",content:h.content||h.text||"",data:h}),await l.fetchLeadById(k.id)}catch(b){console.error("Failed to save note:",b)}}function f(){s("open-purchase-method")}function g(){s("open-trade-in")}async function x(h){var b;const k=t();if(k)try{const w=`${h.date}T${h.time}:00`,L=new Date(w);L.setHours(L.getHours()+1),await l.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`${h.type} - ${k.customer.name}`,start:w,end:L.toISOString(),type:h.type,assignee:h.assignee,assigneeId:h.assigneeId,status:"scheduled",location:h.location||"",notes:h.notes||""}}),await l.addActivity(k.id,{type:"appointment",user:((b=i.currentUser)==null?void 0:b.name)||"You",action:"scheduled an appointment",content:`${h.type} scheduled for ${h.date} at ${h.time}`,data:{type:h.type,date:h.date,time:h.time,assignee:h.assignee}}),await l.fetchLeadById(k.id)}catch(w){console.error("Failed to schedule appointment:",w)}}async function v(h){const k=t();if(k&&!(m.isClosed.value&&!h.force))try{const b=m.displayStage.value,w=h.reason==="Duplicate"?Ue.CLOSED_DUPLICATE:h.category==="Not Interested"?Ue.CLOSED_NOT_INTERESTED:Ue.CLOSED_INVALID,L=rt(b,w);if(L){const{updates:Y,activities:G}=L(k,w,h);await l.updateLead(k.id,Y);for(const ne of G)await l.addActivity(k.id,ne)}else{const Y=h.reason==="Duplicate";await l.updateLead(k.id,{isDisqualified:!0,disqualifyReason:h.reason,isDuplicate:Y,stage:Y?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await l.addActivity(k.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${h.category}, Reason: ${h.reason}`})}c.push("/tasks")}catch(b){console.error("Failed to disqualify lead:",b)}}async function I(){const h=t();if(h)try{const k=m.displayStage.value,b=Ue.NEW,w=rt(k,b);if(w){const{updates:L,activities:Y}=w(h);await l.updateLead(h.id,L);for(const G of Y)await l.addActivity(h.id,G)}else await l.updateLead(h.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await l.addActivity(h.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await l.fetchLeadById(h.id)}catch(k){console.error("Failed to reopen lead:",k)}}function T(){const h=t();h&&h.opportunityId&&c.push({path:`/tasks/${h.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:o,handleValidated:a,handleQualified:p,handleCallAttemptLogged:d,handleNoteSaved:u,handleOpenPurchaseMethod:f,handleOpenTradeIn:g,handleAppointmentScheduled:x,handleDisqualified:v,handleReopen:I,viewOpportunity:T}}const Ta={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ia={class:"space-y-6"},Lt={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(m,s)=>t.task?(r(),y("div",{key:0,class:H(["rounded-card flex flex-col",t.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[s[0]||(s[0]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")])],-1)),e("div",Ta,[pe(m.$slots,"deadline-banner"),e("div",Ia,[pe(m.$slots,"primary-action"),pe(m.$slots,"task-widgets"),pe(m.$slots,"closed-state"),pe(m.$slots,"secondary-actions")])])],2)):D("",!0)}},Oa={class:"flex justify-between items-start mb-3"},qa={class:"font-bold text-gray-900 text-fluid-sm"},Na={class:"text-fluid-xs text-gray-500 mt-0.5"},Ma={class:"flex gap-3 flex-wrap"},Bt={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(m,s)=>(r(),y("div",{class:H(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Oa,[e("div",null,[e("h4",qa,S(t.action.title),1),e("p",Na,S(t.action.description),1)])]),e("div",Ma,[e("button",{onClick:s[0]||(s[0]=c=>m.$emit("action-clicked")),class:H([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:H(t.action.icon)},null,2),R(" "+S(t.action.label),1)],2)])],2))}},Ea={class:"flex items-center gap-3"},La={class:"flex-1"},Ba={key:0,class:"text-fluid-xs font-normal opacity-75"},Fa={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:m}){const s=t,c=m,l=q(!1),i=A(()=>wt(s.nextActionDue)),o=A(()=>s.isClosed||!s.showDeadlineBanner||l.value?!1:i.value.type==="overdue"||i.value.type==="urgent"),a=()=>{l.value=!0,c("dismissed")};return(p,d)=>o.value?(r(),y("div",{key:0,class:H(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[i.value.bgClass,i.value.borderClass]])},[e("div",Ea,[e("div",{class:H(["w-9 h-9 rounded-lg flex items-center justify-center",[i.value.bgClass,i.value.borderClass,"border"]])},[e("i",{class:H(["text-sm",[`fa-solid ${i.value.icon}`,i.value.textClass]])},null,2)],2),e("div",La,[d[0]||(d[0]=e("div",{class:"text-fluid-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:H(["text-fluid-sm font-bold",i.value.textClass])},[R(S(n(Ct)(t.nextActionDue))+" ",1),i.value.type!=="overdue"?(r(),y("span",Ba," ("+S(n($t)(t.nextActionDue))+") ",1)):D("",!0)],2)]),i.value.type==="overdue"?(r(),y("div",{key:0,class:H(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...d[1]||(d[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),R(" Overdue ",-1)])],2)):i.value.type==="urgent"?(r(),y("div",{key:1,class:H(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[i.value.bgClass,i.value.textClass,i.value.borderClass,"border"]])},[...d[2]||(d[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),R(" Urgent ",-1)])],2)):D("",!0)]),e("button",{onClick:a,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):D("",!0)}},lt=(t,m)=>{if(!t||!m)return[];const s=new Date(m).getDay();if(s===0||s===6)return[];const[l,i]=t.split("-"),o=parseInt(i);return l==="team"?Ua(o,m):l==="user"?ja(o,m,s):[]},ja=(t,m,s)=>{const c={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(c[t]||c[1])[s]||[]},Ua=(t,m)=>{const s=new Date(m).getDay(),c=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return t===1?s===1||s===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:t===2?c.filter((l,i)=>i%2===0):c},Ft=(t,m)=>{const s=lt(t,m);return s.length===0?"none":s.length<=3?"limited":"good"},jt=(t,m,s)=>{const c=[];return s.forEach(l=>{const i=`${l.type}-${l.id}`;if(i===t)return;const o=lt(i,m);o.length>0&&c.push({...l,assigneeId:i,availableSlots:o,slotCount:o.length})}),c.sort((l,i)=>i.slotCount-l.slotCount)},Va={class:"space-y-4"},Ra=["min"],za={key:0,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},Wa={class:"flex items-center justify-between mb-2"},Ha={key:0,class:"flex items-center gap-3"},Pa={key:0,class:"fa-solid fa-users text-fluid-sm"},_a={key:1},Qa={class:"flex-1"},Ya={class:"font-medium text-fluid-sm text-heading"},Ga={class:"text-fluid-xs text-sub capitalize"},Ka={key:1,class:"animate-fade-in"},Ja={label:"Teams"},Za=["value"],Xa={label:"Users"},eo=["value"],to={key:1},so={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-3 animate-fade-in"},no={class:"flex items-start gap-2"},lo={class:"flex-1"},ao={class:"text-fluid-xs text-amber-700 mt-1"},oo={key:0,class:"mt-3 pt-3 border-t border-amber-200"},io={class:"space-y-1"},ro=["onClick"],uo={class:"text-fluid-sm font-medium text-heading"},co={class:"text-fluid-xs text-sub"},po={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-3 animate-fade-in"},mo={key:2,class:"bg-green-50 border border-green-200 rounded-lg p-3 animate-fade-in"},fo={key:2,class:"animate-fade-in"},yo={class:"grid grid-cols-4 gap-2"},go=["onClick"],vo={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(t,{emit:m}){const s=t,c=m,l=Ie(),i=Je(),o=q(""),a=q(null),p=q(""),d=q(""),u=q(!1),f=q(!1),g=A(()=>i.assignableUsers),x=A(()=>i.assignableTeams),v=A(()=>new Date().toISOString().split("T")[0]),I=A(()=>a.value&&a.value.startsWith("team-")),T=A(()=>{if(!a.value)return{};const[j,E]=a.value.split("-"),V=parseInt(E);if(j==="team"){const W=i.getTeamById(V);return{name:(W==null?void 0:W.name)||"Unknown Team",subtitle:"Team",avatarClass:"bg-green-100 text-green-700",initials:""}}else{const W=i.getUserById(V);return{name:(W==null?void 0:W.name)||"Unknown",subtitle:(W==null?void 0:W.role)||"User",avatarClass:Y(W==null?void 0:W.role),initials:L(W==null?void 0:W.name)}}}),h=A(()=>!p.value||!a.value?[]:lt(a.value,p.value)),k=A(()=>!p.value||!a.value?null:Ft(a.value,p.value)),b=A(()=>{if(!p.value||!a.value)return[];if(k.value!=="none")return[];const j=[...x.value.map(E=>({...E,type:"team"})),...g.value.map(E=>({...E,type:"user"}))];return jt(a.value,p.value,j)}),w=A(()=>!!(o.value&&p.value&&d.value&&a.value)),L=j=>j?j.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2):"?",Y=j=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[j]||"bg-surfaceSecondary text-body",G=j=>{a.value=j.assigneeId,f.value=!1,u.value=!1};be(()=>s.show,j=>{j?ne():oe()}),be(p,()=>{d.value="",f.value=!1}),be(a,()=>{d.value="",f.value=!1});const ne=()=>{var j;if(s.preselectedAssignee){const{type:E,id:V}=s.preselectedAssignee;a.value=`${E}-${V}`}else a.value=`user-${((j=l.currentUser)==null?void 0:j.id)||1}`},oe=()=>{var j;o.value="",a.value=`user-${((j=l.currentUser)==null?void 0:j.id)||1}`,p.value="",showTimeslots.value=!1,d.value=""},J=j=>{j||c("close")},B=()=>{if(!w.value)return;const j=a.value.startsWith("team-"),E=parseInt(a.value.split("-")[1]);let V={};if(j){const W=i.getTeamById(E);V={assigneeType:"team",teamId:E,team:(W==null?void 0:W.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const W=i.getUserById(E);V={assigneeType:"user",assigneeId:E,assignee:(W==null?void 0:W.name)||"Unknown",teamId:null,team:null}}c("confirm",{type:o.value,date:p.value,time:d.value,...V}),c("close")},F=()=>{c("close")};return(j,E)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":J},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),{class:"text-fluid-lg"},{default:O(()=>[...E[5]||(E[5]=[R("Schedule Appointment",-1)])]),_:1}),C(n(Ze),{class:"text-fluid-xs"},{default:O(()=>[...E[6]||(E[6]=[R("Book an appointment with the customer",-1)])]),_:1})]),_:1}),e("div",Va,[e("div",null,[E[8]||(E[8]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Appointment Type",-1)),le(e("select",{"onUpdate:modelValue":E[0]||(E[0]=V=>o.value=V),class:"input text-fluid-sm"},[...E[7]||(E[7]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[$e,o.value]])]),e("div",null,[E[9]||(E[9]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Select Date",-1)),le(e("input",{type:"date","onUpdate:modelValue":E[1]||(E[1]=V=>p.value=V),min:v.value,class:"input text-fluid-sm"},null,8,Ra),[[ye,p.value]])]),a.value?(r(),y("div",za,[e("div",Wa,[E[10]||(E[10]=e("label",{class:"text-fluid-xs font-medium text-sub"},"Assigned to",-1)),e("button",{onClick:E[2]||(E[2]=V=>u.value=!u.value),class:"text-fluid-xs text-sub hover:text-brand-dark hover:underline font-medium transition-colors"},S(u.value?"Cancel":"Change"),1)]),u.value?(r(),y("div",Ka,[le(e("select",{"onUpdate:modelValue":E[3]||(E[3]=V=>a.value=V),class:"input text-fluid-sm"},[e("optgroup",Ja,[(r(!0),y(ce,null,ge(x.value,V=>(r(),y("option",{key:`team-${V.id}`,value:`team-${V.id}`},S(V.name)+" Team ",9,Za))),128))]),e("optgroup",Xa,[(r(!0),y(ce,null,ge(g.value,V=>{var W;return r(),y("option",{key:`user-${V.id}`,value:`user-${V.id}`},S(V.name)+S(V.id===((W=n(l).currentUser)==null?void 0:W.id)?" (Me)":""),9,eo)}),128))])],512),[[$e,a.value]])])):(r(),y("div",Ha,[e("div",{class:H(["w-9 h-9 rounded-full flex items-center justify-center font-semibold text-fluid-sm",T.value.avatarClass])},[I.value?(r(),y("i",Pa)):(r(),y("span",_a,S(T.value.initials),1))],2),e("div",Qa,[e("p",Ya,S(T.value.name),1),e("p",Ga,S(T.value.subtitle),1)])]))])):D("",!0),p.value&&a.value?(r(),y("div",to,[k.value==="none"?(r(),y("div",so,[e("div",no,[E[13]||(E[13]=e("i",{class:"fa-solid fa-calendar-xmark text-amber-600 mt-0.5"},null,-1)),e("div",lo,[E[12]||(E[12]=e("p",{class:"text-fluid-sm font-medium text-amber-900"},"No availability on this date",-1)),e("p",ao,[E[11]||(E[11]=R(" Try selecting a different date or ",-1)),e("button",{onClick:E[4]||(E[4]=V=>f.value=!f.value),class:"underline font-medium"}," view other "+S(I.value?"teams":"salespeople"),1)])])]),f.value&&b.value.length>0?(r(),y("div",oo,[E[14]||(E[14]=e("p",{class:"text-fluid-xs font-medium text-amber-900 mb-2"},"Available alternatives:",-1)),e("div",io,[(r(!0),y(ce,null,ge(b.value.slice(0,3),V=>(r(),y("button",{key:V.assigneeId,onClick:W=>G(V),class:"w-full text-left p-2 rounded bg-white hover:bg-amber-50 border border-amber-200 transition-colors"},[e("p",uo,S(V.name),1),e("p",co,S(V.slotCount)+" slots available",1)],8,ro))),128))])])):D("",!0)])):k.value==="limited"?(r(),y("div",po,[...E[15]||(E[15]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-blue-600"}),e("p",{class:"text-fluid-sm text-blue-700"},[e("span",{class:"font-medium"},"Limited availability"),R(" - Book soon! ")])],-1)])])):k.value==="good"?(r(),y("div",mo,[...E[16]||(E[16]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle text-green-600"}),e("p",{class:"text-fluid-sm text-green-700"},[e("span",{class:"font-medium"},"Good availability"),R(" on this date ")])],-1)])])):D("",!0)])):D("",!0),h.value.length>0?(r(),y("div",fo,[E[17]||(E[17]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-2"},"Available Time Slots",-1)),e("div",yo,[(r(!0),y(ce,null,ge(h.value,V=>(r(),y("button",{key:V,onClick:W=>d.value=V,class:H(["py-2 border rounded-lg text-fluid-xs font-medium transition-all",d.value===V?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB text-body hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"])},S(V),11,go))),128))])])):D("",!0)]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:F}),C(n(ee),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!w.value,onClick:B},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},bo={class:"bg-surface border border-E5E7EB rounded-lg p-6 space-y-4"},ho={class:"flex items-center justify-between mb-2"},xo={class:"space-y-4"},ko=["min"],wo={key:0,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},Co={class:"flex items-center justify-between mb-2"},$o={key:0,class:"flex items-center gap-3"},So={key:0,class:"fa-solid fa-users text-fluid-sm"},Ao={key:1},Do={class:"flex-1"},To={class:"font-medium text-fluid-sm text-heading"},Io={class:"text-fluid-xs text-sub capitalize"},Oo={key:1,class:"animate-fade-in"},qo={label:"Teams"},No=["value"],Mo={label:"Users"},Eo=["value"],Lo={key:1},Bo={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-3 animate-fade-in"},Fo={class:"flex items-start gap-2"},jo={class:"flex-1"},Uo={class:"text-fluid-xs text-amber-700 mt-1"},Vo={key:0,class:"mt-3 pt-3 border-t border-amber-200"},Ro={class:"space-y-1"},zo=["onClick"],Wo={class:"text-fluid-sm font-medium text-heading"},Ho={class:"text-fluid-xs text-sub"},Po={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-3 animate-fade-in"},_o={key:2,class:"bg-green-50 border border-green-200 rounded-lg p-3 animate-fade-in"},Qo={key:2,class:"animate-fade-in"},Yo={class:"grid grid-cols-4 gap-2"},Go=["onClick"],Ko={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Jo={__name:"ScheduleAppointmentInline",props:{preselectedAssignee:{type:Object,default:null},canCancel:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,c=m,l=Ie(),i=Je(),o=q(""),a=q(null),p=q(""),d=q(""),u=q(!1),f=q(!1),g=A(()=>i.assignableUsers),x=A(()=>i.assignableTeams),v=A(()=>new Date().toISOString().split("T")[0]),I=A(()=>a.value||(s.preselectedAssignee?`${s.preselectedAssignee.type}-${s.preselectedAssignee.id}`:null)),T=A(()=>{if(!I.value)return{};const[J,B]=I.value.split("-"),F=parseInt(B);if(J==="team"){const j=i.getTeamById(F);return{name:(j==null?void 0:j.name)||"Unknown Team",subtitle:"Team",avatarClass:"bg-green-100 text-green-700",initials:"",isTeam:!0}}else{const j=i.getUserById(F);return{name:(j==null?void 0:j.name)||"Unknown",subtitle:(j==null?void 0:j.role)||"User",avatarClass:Y(j==null?void 0:j.role),initials:L(j==null?void 0:j.name),isTeam:!1}}}),h=A(()=>!p.value||!I.value?[]:lt(I.value,p.value)),k=A(()=>!p.value||!I.value?null:Ft(I.value,p.value)),b=A(()=>{if(!p.value||!I.value)return[];if(k.value!=="none")return[];const J=[...x.value.map(B=>({...B,type:"team"})),...g.value.map(B=>({...B,type:"user"}))];return jt(I.value,p.value,J)}),w=A(()=>!!(o.value&&p.value&&d.value&&I.value)),L=J=>J?J.split(" ").map(B=>B[0]).join("").toUpperCase().substring(0,2):"?",Y=J=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[J]||"bg-surfaceSecondary text-body",G=J=>{a.value=J.assigneeId,f.value=!1,u.value=!1};be(p,()=>{d.value="",f.value=!1}),be(()=>I.value,()=>{d.value="",f.value=!1}),be(()=>s.preselectedAssignee,J=>{J&&!a.value&&(a.value=`${J.type}-${J.id}`)},{immediate:!0});const ne=()=>{if(!w.value)return;const[J,B]=I.value.split("-"),F=parseInt(B),j=J==="team";let E={};if(j){const V=i.getTeamById(F);E={assigneeType:"team",teamId:F,team:(V==null?void 0:V.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const V=i.getUserById(F);E={assigneeType:"user",assigneeId:F,assignee:(V==null?void 0:V.name)||"Unknown",teamId:null,team:null}}c("confirm",{type:o.value,date:p.value,time:d.value,...E}),o.value="",p.value="",d.value="",u.value=!1,f.value=!1},oe=()=>{c("cancel")};return(J,B)=>(r(),y("div",bo,[e("div",ho,[B[6]||(B[6]=e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Schedule Appointment",-1)),t.canCancel?(r(),y("button",{key:0,onClick:oe,class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...B[5]||(B[5]=[e("i",{class:"fa-solid fa-times"},null,-1)])])):D("",!0)]),e("div",xo,[e("div",null,[B[8]||(B[8]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Appointment Type",-1)),le(e("select",{"onUpdate:modelValue":B[0]||(B[0]=F=>o.value=F),class:"input text-fluid-sm"},[...B[7]||(B[7]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[$e,o.value]])]),e("div",null,[B[9]||(B[9]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Select Date",-1)),le(e("input",{type:"date","onUpdate:modelValue":B[1]||(B[1]=F=>p.value=F),min:v.value,class:"input text-fluid-sm"},null,8,ko),[[ye,p.value]])]),I.value?(r(),y("div",wo,[e("div",Co,[B[10]||(B[10]=e("label",{class:"text-fluid-xs font-medium text-sub"},"Assigned to",-1)),e("button",{onClick:B[2]||(B[2]=F=>u.value=!u.value),class:"text-fluid-xs text-sub hover:text-brand-dark hover:underline font-medium transition-colors"},S(u.value?"Cancel":"Change"),1)]),u.value?(r(),y("div",Oo,[le(e("select",{"onUpdate:modelValue":B[3]||(B[3]=F=>a.value=F),class:"input text-fluid-sm"},[e("optgroup",qo,[(r(!0),y(ce,null,ge(x.value,F=>(r(),y("option",{key:`team-${F.id}`,value:`team-${F.id}`},S(F.name)+" Team ",9,No))),128))]),e("optgroup",Mo,[(r(!0),y(ce,null,ge(g.value,F=>{var j;return r(),y("option",{key:`user-${F.id}`,value:`user-${F.id}`},S(F.name)+S(F.id===((j=n(l).currentUser)==null?void 0:j.id)?" (Me)":""),9,Eo)}),128))])],512),[[$e,a.value]])])):(r(),y("div",$o,[e("div",{class:H(["w-9 h-9 rounded-full flex items-center justify-center font-semibold text-fluid-sm",T.value.avatarClass])},[T.value.isTeam?(r(),y("i",So)):(r(),y("span",Ao,S(T.value.initials),1))],2),e("div",Do,[e("p",To,S(T.value.name),1),e("p",Io,S(T.value.subtitle),1)])]))])):D("",!0),p.value&&a.value?(r(),y("div",Lo,[k.value==="none"?(r(),y("div",Bo,[e("div",Fo,[B[13]||(B[13]=e("i",{class:"fa-solid fa-calendar-xmark text-amber-600 mt-0.5"},null,-1)),e("div",jo,[B[12]||(B[12]=e("p",{class:"text-fluid-sm font-medium text-amber-900"},"No availability on this date",-1)),e("p",Uo,[B[11]||(B[11]=R(" Try selecting a different date or ",-1)),e("button",{onClick:B[4]||(B[4]=F=>f.value=!f.value),class:"underline font-medium"}," view other "+S(T.value.isTeam?"teams":"salespeople"),1)])])]),f.value&&b.value.length>0?(r(),y("div",Vo,[B[14]||(B[14]=e("p",{class:"text-fluid-xs font-medium text-amber-900 mb-2"},"Available alternatives:",-1)),e("div",Ro,[(r(!0),y(ce,null,ge(b.value.slice(0,3),F=>(r(),y("button",{key:F.assigneeId,onClick:j=>G(F),class:"w-full text-left p-2 rounded bg-white hover:bg-amber-50 border border-amber-200 transition-colors"},[e("p",Wo,S(F.name),1),e("p",Ho,S(F.slotCount)+" slots available",1)],8,zo))),128))])])):D("",!0)])):k.value==="limited"?(r(),y("div",Po,[...B[15]||(B[15]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-blue-600"}),e("p",{class:"text-fluid-sm text-blue-700"},[e("span",{class:"font-medium"},"Limited availability"),R(" - Book soon! ")])],-1)])])):k.value==="good"?(r(),y("div",_o,[...B[16]||(B[16]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle text-green-600"}),e("p",{class:"text-fluid-sm text-green-700"},[e("span",{class:"font-medium"},"Good availability"),R(" on this date ")])],-1)])])):D("",!0)])):D("",!0),h.value.length>0?(r(),y("div",Qo,[B[17]||(B[17]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-2"},"Available Time Slots",-1)),e("div",Yo,[(r(!0),y(ce,null,ge(h.value,F=>(r(),y("button",{key:F,onClick:j=>d.value=F,class:H(["py-2 border rounded-lg text-fluid-xs font-medium transition-all",d.value===F?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB text-body hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"])},S(F),11,Go))),128))])])):D("",!0),e("div",Ko,[t.canCancel?(r(),P(n(ee),{key:0,label:"Cancel",variant:"outline",size:"small",class:"text-fluid-sm",onClick:oe})):D("",!0),C(n(ee),{label:"Confirm Appointment",variant:"primary",size:"small",class:"text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!w.value,onClick:ne},null,8,["disabled"])])])]))}},Zo={class:"space-y-3"},Xo={class:"space-y-2"},ei={key:0,class:"font-semibold text-heading text-fluid-sm mb-2"},ti={class:"grid grid-cols-4 gap-2"},si={key:0},ni={__name:"CommunicationSelector",props:{title:{type:String,default:"Send follow-up message"},showEmail:{type:Boolean,default:!0},showSMS:{type:Boolean,default:!0},showWhatsApp:{type:Boolean,default:!0},showDontSend:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel","dont-send"],setup(t,{emit:m}){const s=m,c=q(null),l=A(()=>p=>`bg-surface border-2 rounded-lg h-10 flex items-center justify-center gap-2 text-fluid-xs font-medium transition-all ${c.value===p?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB text-body hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"}`),i=p=>{p==="dont-send"?(c.value="dont-send",s("dont-send")):c.value=p},o=p=>{s("send",p),c.value=null},a=()=>{c.value=null,s("cancel")};return(p,d)=>(r(),y("div",Zo,[e("div",Xo,[t.title?(r(),y("h5",ei,S(t.title),1)):D("",!0),e("div",ti,[t.showEmail?(r(),y("button",{key:0,onClick:d[0]||(d[0]=u=>i("email")),class:H(l.value("email"))},[...d[4]||(d[4]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])],2)):D("",!0),t.showSMS?(r(),y("button",{key:1,onClick:d[1]||(d[1]=u=>i("sms")),class:H(l.value("sms"))},[...d[5]||(d[5]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])],2)):D("",!0),t.showWhatsApp?(r(),y("button",{key:2,onClick:d[2]||(d[2]=u=>i("whatsapp")),class:H(l.value("whatsapp"))},[...d[6]||(d[6]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])],2)):D("",!0),t.showDontSend?(r(),y("button",{key:3,onClick:d[3]||(d[3]=u=>i("dont-send")),class:H(l.value("dont-send"))},[...d[7]||(d[7]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])],2)):D("",!0)])]),c.value&&c.value!=="dont-send"?(r(),y("div",si,[c.value==="email"?(r(),P(cs,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:a},null,8,["initial-template","initial-message"])):c.value==="sms"?(r(),P(ps,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:a},null,8,["initial-template","initial-message"])):c.value==="whatsapp"?(r(),P(ms,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:a},null,8,["initial-template","initial-message"])):D("",!0)])):D("",!0)]))}};function li(){const t=Jt(),m=q(!1),s=q(!1),c=q(0),l=q(""),i=q(null),o=q({}),a=q(null),p={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},d=A(()=>{const I=Math.floor(c.value/60),T=c.value%60;return`${I.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`}),u=()=>{m.value=!0,c.value=0,s.value=!1,l.value="",i.value=setInterval(()=>{c.value++,c.value>=20&&f()},1e3)},f=()=>{i.value&&(clearInterval(i.value),i.value=null),m.value=!1,s.value=!0,o.value={duration:c.value,notes:l.value,transcription:p,channel:"phone"}},g=async I=>{try{await navigator.clipboard.writeText(I),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},x=I=>(a.value={tradeIn:p.leadLines.some(T=>T.toLowerCase().includes("trade")||T.toLowerCase().includes("exchange"))||!1,financing:p.leadLines.some(T=>T.toLowerCase().includes("financ")||T.toLowerCase().includes("payment")||T.toLowerCase().includes("loan"))||!1},a.value.tradeIn&&I&&(I.value.tradeIn=!0),a.value.financing&&I&&(I.value.financing=!0),a.value),v=()=>{m.value=!1,s.value=!1,c.value=0,l.value="",o.value={},i.value&&(clearInterval(i.value),i.value=null)};return Zt(()=>{i.value&&clearInterval(i.value)}),{isCallActive:m,callEnded:s,callDuration:c,callNotes:l,callData:o,extractedData:a,mockTranscription:p,formattedCallDuration:d,startCall:u,endCall:f,copyNumber:g,extractInformation:x,resetCall:v}}function ai(t,m,s,c,l,i){var j,E,V;const o=q(!1),a=q(null),p=q(!1),d=q(null),u=q(!1),f=q(!1),g=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],x=q("whatsapp"),v=q("followup-1"),I=q(null),T=q(""),h=q("09:00"),k=q("Not Interested"),b=q(""),w=q({dealership:((E=(j=t.value)==null?void 0:j.requestedCar)==null?void 0:E.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((V=i==null?void 0:i.value)==null?void 0:V.id)||null}),L=q({tradeIn:!1,financing:!1,contactAvailability:!1}),Y=A(()=>{var ve,he,Q,me,ke,Z,z;const W=((Q=(he=(ve=t.value)==null?void 0:ve.customer)==null?void 0:he.name)==null?void 0:Q.split(" ")[0])||"",N=((ke=(me=t.value)==null?void 0:me.requestedCar)==null?void 0:ke.brand)||"",K=((z=(Z=t.value)==null?void 0:Z.requestedCar)==null?void 0:z.model)||"";return{"followup-1":`Hi ${W}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${N} ${K}?`,"followup-2":`Hello ${W}, this is regarding your inquiry about the ${N} ${K}. Please let me know when you're available for a call.`,custom:""}}),G=A(()=>v.value==="custom"?"Type your custom message...":Y.value[v.value]||""),ne=A(()=>{var W;return!!((W=t.value)!=null&&W.scheduledAppointment)});return{showOutcomeSelection:o,selectedOutcome:a,appointmentScheduled:p,scheduledAppointmentData:d,showNoteModal:u,showScheduleAppointmentModal:f,followupChannels:g,followupChannel:x,selectedTemplate:v,rescheduleTime:I,customDate:T,customTime:h,disqualifyCategory:k,disqualifyReason:b,assignment:w,preferences:L,messageTemplates:Y,messagePreview:G,hasExistingAppointment:ne,selectOutcome:W=>{a.value=W,W==="interested"&&(s!=null&&s.value)&&(L.value.tradeIn=s.value.tradeIn||!1,L.value.financing=s.value.financing||!1)},cancelOutcome:()=>{a.value=null,o.value=!1,p.value=!1,d.value=null},calculateNextCallDate:()=>{if(I.value==="tomorrow-9am"){const N=new Date;return N.setDate(N.getDate()+1),N.setHours(9,0,0,0),N.toISOString()}else if(I.value==="monday"){const N=new Date,K=(8-N.getDay())%7||7;return N.setDate(N.getDate()+K),N.setHours(9,0,0,0),N.toISOString()}else if(I.value==="custom"&&T.value&&h.value)return new Date(`${T.value}T${h.value}:00`).toISOString();const W=new Date;return W.setDate(W.getDate()+1),W.setHours(9,0,0,0),W.toISOString()},resetOutcomeState:()=>{a.value=null,o.value=!1,p.value=!1,d.value=null,x.value="whatsapp",v.value="followup-1",I.value=null,T.value="",h.value="09:00",k.value="Not Interested",b.value=""}}}function oi(t,m,s,c,l,i){const{callData:o}=m,{showOutcomeSelection:a,selectedOutcome:p,appointmentScheduled:d,scheduledAppointmentData:u,assignment:f,preferences:g,cancelOutcome:x,calculateNextCallDate:v,showScheduleAppointmentModal:I}=s;return{logManualCall:()=>{o.value={channel:"external",notes:"",transcription:null},a.value=!0},handleScheduleAppointmentConfirm:async G=>{u.value=G,d.value=!0,I.value=!1,t("appointment-scheduled",G)},handleQualify:()=>{var ne,oe,J;const G={timestamp:new Date().toISOString(),outcome:"interested",channel:((ne=o.value)==null?void 0:ne.channel)||"phone",notes:((oe=o.value)==null?void 0:oe.notes)||"",transcription:((J=o.value)==null?void 0:J.transcription)||null};t("call-attempt-logged",G),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:f.value,preferences:g.value,scheduleAppointment:d.value,appointmentData:u.value}),x()},handleDisqualifyFromInterested:()=>{var ne,oe,J;const G={timestamp:new Date().toISOString(),outcome:"interested",channel:((ne=o.value)==null?void 0:ne.channel)||"phone",notes:((oe=o.value)==null?void 0:oe.notes)||"",transcription:((J=o.value)==null?void 0:J.transcription)||null};t("call-attempt-logged",G),p.value="not-valid"},handleNoAnswerConfirm:async()=>{var B,F,j;const G={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((B=o.value)==null?void 0:B.channel)||"phone",notes:((F=o.value)==null?void 0:F.notes)||"",transcription:((j=o.value)==null?void 0:j.transcription)||null};t("call-attempt-logged",G);const ne=v(),oe=ne.split("T")[0],J=new Date(ne).toTimeString().slice(0,5);t("postponed",{date:oe,time:J,createAppointment:!0}),(l==null?void 0:l.value)+1>=(i==null?void 0:i.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),x()},handleNotValidConfirm:()=>{var ne,oe,J;const G={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((ne=o.value)==null?void 0:ne.channel)||"phone",notes:((oe=o.value)==null?void 0:oe.notes)||"",transcription:((J=o.value)==null?void 0:J.transcription)||null};t("call-attempt-logged",G),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),x()},handleNoteSave:G=>{s.showNoteModal.value=!1,t("note-saved",G)}}}const ii={key:0,class:"flex gap-2 items-center mb-4"},ri=["disabled"],di=["disabled"],ui={key:1,class:"mb-4 space-y-4 border-t border pt-4"},ci={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},pi={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},mi={class:"flex items-center gap-2 text-red-400"},fi={class:"text-xs font-mono"},yi={class:"space-y-3 text-sm font-mono"},gi={class:"ml-2"},vi={class:"ml-2"},bi={key:0},hi={class:"ml-2"},xi={key:1},ki={class:"ml-2"},wi={key:2},Ci={class:"ml-2"},$i={class:"mt-4 pt-4 border-t border-slate-700"},Si=["model-value"],Ai={class:"mt-4 flex justify-end"},Di={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ti={class:"flex items-center justify-between"},Ii={class:"flex gap-2"},Oi={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(m,s)=>(r(),y("div",null,[!t.showOutcomeSelection&&!t.isCallActive&&!t.callEnded?(r(),y("div",ii,[e("button",{disabled:t.isCallActive,onClick:s[0]||(s[0]=c=>m.$emit("start-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),R(" "+S(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],8,ri),e("button",{disabled:t.isCallActive,onClick:s[1]||(s[1]=c=>m.$emit("log-manual-call")),class:"bg-surface hover:bg-surfaceSecondary disabled:bg-surfaceSecondary disabled:cursor-not-allowed border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),R(" Log Call Outcome ",-1)])],8,di)])):D("",!0),t.isCallActive||t.callEnded?(r(),y("div",ui,[t.isCallActive?(r(),y("div",ci,[e("div",pi,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",mi,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",fi,"REC "+S(t.formattedCallDuration),1)])]),e("div",yi,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",gi,S(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",vi,S(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(r(),y("div",bi,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",hi,S(t.mockTranscription.leadLines[1]),1)])):D("",!0),t.callDuration>=8?(r(),y("div",xi,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",ki,S(t.mockTranscription.salesLines[1]),1)])):D("",!0),t.callDuration>=12?(r(),y("div",wi,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ci,S(t.mockTranscription.leadLines[2]),1)])):D("",!0)]),e("div",$i,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=c=>m.$emit("update:call-notes",c)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Si)]),e("div",Ai,[C(n(ee),{label:"End Call",variant:"primary",size:"small",onClick:s[3]||(s[3]=c=>m.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):D("",!0),t.callEnded&&!t.isCallActive?(r(),y("div",Di,[e("div",Ti,[s[15]||(s[15]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",Ii,[C(n(ee),{label:"Extract information",variant:"primary",size:"small",onClick:s[4]||(s[4]=c=>m.$emit("extract-information")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),C(n(ee),{label:"Log outcome",variant:"outline",size:"small",onClick:s[5]||(s[5]=c=>m.$emit("log-manual-call"))})])])])):D("",!0)])):D("",!0)]))}},qi={class:"bg-surfaceSecondary/50 rounded-lg p-6 relative transition-all duration-300"},Ni={class:"flex justify-between items-start mb-3"},Mi={class:"font-bold text-heading text-fluid-sm"},Ei={class:"text-fluid-xs mt-0.5"},Li={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},Bi={class:"text-fluid-xs text-blue-700"},Fi={key:1,class:"mb-3 bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},ji={class:"flex items-center justify-between"},Ui={class:"flex items-center gap-2"},Vi={class:"text-fluid-xs font-semibold text-heading"},Ri={key:0,class:"text-fluid-xs text-orange-600 font-medium flex items-center gap-1"},zi={class:"flex items-center gap-2 mb-3"},Wi={class:"text-fluid-sm text-body font-medium"},Hi={key:2,class:"mt-4 space-y-4 border-t border-E5E7EB pt-4"},Pi={class:"grid grid-cols-3 gap-2"},_i={key:0,class:"space-y-4"},Qi={class:"bg-surface border border-E5E7EB rounded-lg p-6"},Yi={class:"bg-surface border border-E5E7EB rounded-lg p-6"},Gi={class:"grid grid-cols-3 gap-2"},Ki={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Ji={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Zi={key:1,class:"space-y-4 bg-surface border border-E5E7EB rounded-lg p-6"},Xi={class:"flex gap-4"},er={class:"flex items-center gap-2 cursor-pointer"},tr={class:"flex items-center gap-2 cursor-pointer"},sr={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},nr={key:2,class:"space-y-4"},lr={class:"bg-surface border border-E5E7EB rounded-lg p-6"},ar={class:"flex gap-2"},or={class:"bg-surface border border-E5E7EB rounded-lg p-6"},ir={class:"flex items-center justify-between mb-4"},rr={key:0,class:"flex items-center gap-3 p-3 bg-surfaceSecondary rounded-lg border border-E5E7EB"},dr={key:0,class:"fa-solid fa-users text-fluid-sm"},ur={key:1},cr={class:"flex-1"},pr={class:"font-medium text-fluid-sm text-heading"},mr={class:"text-fluid-xs text-sub capitalize"},fr={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},yr={class:"grid grid-cols-2 gap-3 text-sm mb-3"},gr={class:"ml-2 font-medium text-heading"},vr={class:"ml-2 font-medium text-heading"},br={class:"ml-2 font-medium text-heading capitalize"},hr={class:"ml-2 font-medium text-heading"},xr={key:1},kr={key:3,class:"bg-green-50 border border-green-200 rounded-lg p-6"},wr={class:"flex items-start justify-between mb-3"},Cr={class:"grid grid-cols-2 gap-3 text-fluid-sm"},$r={class:"ml-2 font-medium text-heading"},Sr={class:"ml-2 font-medium text-heading"},Ar={class:"ml-2 font-medium text-heading capitalize"},Dr={class:"ml-2 font-medium text-heading"},Tr={class:"flex justify-between items-center pt-3 border-t border-E5E7EB"},Ir={class:"flex gap-2"},Or={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:m}){const s=t,c=ae=>{ae||(Te.value=!1)},l=m,i=Je(),o=Ie();Se();const a=ze(),p=Et(()=>s.lead,{}),d=li(),{isCallActive:u,callEnded:f,callDuration:g,callNotes:x,callData:v,extractedData:I,mockTranscription:T,formattedCallDuration:h,startCall:k,endCall:b,copyNumber:w,extractInformation:L}=d,Y=q(null),G=q(!1),ne=q(!1);A(()=>i.assignableUsers);const oe=A(()=>o.currentUser),J=ae=>ae?ae.split(" ").map($=>$[0]).join("").toUpperCase().substring(0,2):"?",B=ae=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[ae]||"bg-surfaceSecondary text-body",F=ae=>{re.value.assignee=ae,G.value=!1},j=()=>{k()},E=()=>{w(s.lead.customer.phone)},V=ae=>{x.value=ae},W=A(()=>{var ae;return((ae=p.primaryAction.value)==null?void 0:ae.title)||"Call to Verify Contact Details"}),N=A(()=>{var ae;return((ae=p.primaryAction.value)==null?void 0:ae.description)||"Begin lead qualification by verifying customer contact information."}),K=A(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),ve=A(()=>!!s.lead.scheduledAppointment),he=A(()=>ve.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:K.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${$t(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),Q=p.contactAttempts,me=p.maxContactAttempts,ke=ai(Ve(s,"lead"),v,I,Q,me,oe),{showOutcomeSelection:Z,selectedOutcome:z,appointmentScheduled:ie,scheduledAppointmentData:Fe,showNoteModal:Te,showScheduleAppointmentModal:We,followupChannel:M,selectedTemplate:_,rescheduleTime:te,customDate:fe,customTime:U,disqualifyCategory:X,disqualifyReason:ue,assignment:re,hasExistingAppointment:je,selectOutcome:at,cancelOutcome:ot}=ke;A(()=>s.activities.filter(ae=>ae.type==="note"));const Ut=oi(l,d,ke,Ve(s,"lead"),Q,me),{logManualCall:Vt,handleScheduleAppointmentConfirm:ft,handleQualify:Rt,handleDisqualifyFromInterested:zt,handleNoAnswerConfirm:Wt,handleNotValidConfirm:Ht,handleNoteSave:Pt}=Ut,_t=async ae=>{var $;try{M.value=ae.type,_.value=ae.template||"";const se={email:"sent an email",sms:"sent an SMS",whatsapp:"sent a WhatsApp message"},Xe=(($=oe.value)==null?void 0:$.name)||"You";let et=ae.message||"";ae.type==="email"&&ae.subject&&(et=`${ae.subject}: ${et}`),await a.addActivity(s.lead.id,{type:ae.type,user:Xe,action:se[ae.type]||"sent a message",content:et,timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save follow-up communication:",se)}};return(ae,$)=>(r(),y("div",qi,[e("div",Ni,[e("div",null,[e("h4",Mi,S(W.value),1),e("p",Ei,S(N.value),1)]),e("div",{class:H(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",he.value.class])},S(he.value.text),3)]),ve.value?(r(),y("div",Li,[$[26]||($[26]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-fluid-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",Bi,S(n(Re)(t.lead.scheduledAppointment.start))+" at "+S(n(Pe)(t.lead.scheduledAppointment.start)),1)])):D("",!0),n(Q)>0?(r(),y("div",Fi,[e("div",ji,[e("div",Ui,[$[27]||($[27]=e("i",{class:"fa-solid fa-phone text-body text-xs"},null,-1)),$[28]||($[28]=e("span",{class:"text-fluid-xs font-semibold text-body"},"Contact Attempts:",-1)),e("span",Vi,S(n(Q))+" / "+S(n(me)),1)]),n(Q)>=n(me)-1?(r(),y("div",Ri,[...$[29]||($[29]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),R(" One more attempt before auto-disqualification ",-1)])])):D("",!0)])])):D("",!0),e("div",zi,[e("span",Wi,S(t.lead.customer.phone),1),e("button",{onClick:E,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...$[30]||($[30]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),C(Oi,{"is-call-active":n(u),"call-ended":n(f),"call-duration":n(g),"call-notes":n(x),"formatted-call-duration":n(h),"mock-transcription":n(T),"show-outcome-selection":n(Z),"contact-attempts":n(Q),"max-contact-attempts":n(me),onStartCall:j,onEndCall:n(b),onLogManualCall:n(Vt),onExtractInformation:n(L),"onUpdate:callNotes":V,onCopyNumber:E},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),n(Z)?(r(),y("div",Hi,[e("div",null,[$[34]||($[34]=e("h4",{class:"font-semibold text-heading mb-2 text-fluid-sm"},"What's the outcome?",-1)),e("div",Pi,[e("button",{onClick:$[0]||($[0]=se=>n(at)("no-answer")),class:H(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(z)==="no-answer"?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"])},[...$[31]||($[31]=[e("i",{class:"fa-solid fa-phone-slash text-sm"},null,-1),e("span",null,"No answer",-1)])],2),e("button",{onClick:$[1]||($[1]=se=>n(at)("not-valid")),class:H(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(z)==="not-valid"?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"])},[...$[32]||($[32]=[e("i",{class:"fa-solid fa-ban text-sm"},null,-1),e("span",null,"Not valid",-1)])],2),e("button",{onClick:$[2]||($[2]=se=>n(at)("interested")),class:H(["bg-surface border-2 rounded-lg py-3 px-4 flex flex-col items-center justify-center gap-1.5 text-fluid-xs font-medium text-body transition-all",n(z)==="interested"?"border-brand-dark bg-surfaceSecondary text-brand-dark":"border-E5E7EB hover:border-brand-dark/30 hover:bg-surfaceSecondary/50"])},[...$[33]||($[33]=[e("i",{class:"fa-solid fa-check-circle text-sm"},null,-1),e("span",null,"Interested",-1)])],2)])]),n(z)==="no-answer"?(r(),y("div",_i,[e("div",Qi,[C(ni,{title:"Send follow-up message","show-email":!0,"show-sms":!0,"show-whatsapp":!0,"show-dont-send":!0,onSend:_t,onDontSend:$[3]||($[3]=()=>{n(M).value="dont-send"}),onCancel:$[4]||($[4]=()=>{n(z).value=null})})]),e("div",Yi,[$[37]||($[37]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-2"},"Next call attempt",-1)),e("div",Gi,[e("button",{onClick:$[5]||($[5]=se=>te.value="tomorrow-9am"),class:H(["bg-surface border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-body transition-all",n(te)==="tomorrow-9am"?"border-primary-700 bg-primary-50 text-primary-700":"border-E5E7EB hover:border-primary-300 hover:bg-primary-50/50"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:$[6]||($[6]=se=>te.value="monday"),class:H(["bg-surface border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-body transition-all",n(te)==="monday"?"border-primary-700 bg-primary-50 text-primary-700":"border-E5E7EB hover:border-primary-300 hover:bg-primary-50/50"])}," Monday ",2),e("button",{onClick:$[7]||($[7]=se=>te.value="custom"),class:H(["bg-surface border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-body transition-all",n(te)==="custom"?"border-primary-700 bg-primary-50 text-primary-700":"border-E5E7EB hover:border-primary-300 hover:bg-primary-50/50"])}," Select time ",2)]),n(te)==="custom"?(r(),y("div",Ki,[e("div",null,[$[35]||($[35]=e("label",{class:"block text-fluid-xs font-semibold mb-1.5"},"Date",-1)),le(e("input",{type:"date","onUpdate:modelValue":$[8]||($[8]=se=>He(fe)?fe.value=se:null),class:"input"},null,512),[[ye,n(fe)]])]),e("div",null,[$[36]||($[36]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Time",-1)),le(e("input",{type:"time","onUpdate:modelValue":$[9]||($[9]=se=>He(U)?U.value=se:null),class:"input"},null,512),[[ye,n(U)]])])])):D("",!0)]),e("div",Ji,[C(n(ee),{label:"Cancel",variant:"outline",size:"small",onClick:n(ot)},null,8,["onClick"]),C(n(ee),{label:"Send and reschedule",variant:"primary",size:"small",onClick:n(Wt),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])):D("",!0),n(z)==="not-valid"?(r(),y("div",Zi,[e("div",null,[$[40]||($[40]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"Category",-1)),e("div",Xi,[e("label",er,[le(e("input",{type:"radio","onUpdate:modelValue":$[10]||($[10]=se=>He(X)?X.value=se:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[it,n(X)]]),$[38]||($[38]=e("span",{class:"text-fluid-sm text-body"},"Not Valid",-1))]),e("label",tr,[le(e("input",{type:"radio","onUpdate:modelValue":$[11]||($[11]=se=>He(X)?X.value=se:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[it,n(X)]]),$[39]||($[39]=e("span",{class:"text-fluid-sm text-body"},"Not Interested",-1))])])]),e("div",null,[$[42]||($[42]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Failure Reason",-1)),le(e("select",{"onUpdate:modelValue":$[12]||($[12]=se=>He(ue)?ue.value=se:null),class:"w-full bg-surface border-2 border-red-500 rounded-lg px-3 py-2 text-fluid-sm text-body focus:outline-none focus:border-red-600"},[...$[41]||($[41]=[Ye('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[$e,n(ue)]])]),e("div",sr,[C(n(ee),{label:"Cancel",variant:"outline",size:"small",onClick:n(ot)},null,8,["onClick"]),C(n(ee),{label:"Confirm Disqualification",variant:"primary",size:"small",disabled:!n(X)||!n(ue),onClick:n(Ht),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"},null,8,["disabled","onClick"])])])):D("",!0),n(z)==="interested"?(r(),y("div",nr,[e("div",lr,[$[43]||($[43]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Customer preferences",-1)),e("div",ar,[C(n(ee),{label:"+ Add purchase method",variant:"primary",size:"small",onClick:$[13]||($[13]=se=>l("open-purchase-method")),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),C(n(ee),{label:"+ Add trade-in",variant:"primary",size:"small",onClick:$[14]||($[14]=se=>l("open-trade-in")),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),C(n(ee),{label:"+ Add note",variant:"primary",size:"small",onClick:$[15]||($[15]=se=>Te.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"})])]),e("div",or,[e("div",ir,[$[44]||($[44]=e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Assign to salesman",-1)),C(n(ee),{label:"Change",variant:"outline",size:"small",class:"text-fluid-xs",onClick:$[16]||($[16]=se=>G.value=!0)})]),n(re).assignee?(r(),y("div",rr,[e("div",{class:H(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-fluid-sm",n(re).assignee.type==="team"?"bg-green-100 text-green-700":B(n(re).assignee.role)])},[n(re).assignee.type==="team"?(r(),y("i",dr)):(r(),y("span",ur,S(J(n(re).assignee.name)),1))],2),e("div",cr,[e("p",pr,S(n(re).assignee.name),1),e("p",mr,S(n(re).assignee.type==="team"?"Team":n(re).assignee.role),1)])])):(r(),y("button",{key:1,onClick:$[17]||($[17]=se=>G.value=!0),class:"w-full p-4 border-2 border-dashed border-E5E7EB rounded-lg hover:border-brand-red hover:bg-red-50/50 transition-colors text-center"},[...$[45]||($[45]=[e("i",{class:"fa-solid fa-user-plus text-2xl text-sub mb-2"},null,-1),e("p",{class:"text-fluid-sm font-medium text-body"},"Click to assign to salesman",-1)])]))]),n(je)&&!n(ie)?(r(),y("div",fr,[$[50]||($[50]=Ye('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="heading-sub">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",yr,[e("div",null,[$[46]||($[46]=e("span",{class:"text-body"},"Date:",-1)),e("span",gr,S(n(Re)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[$[47]||($[47]=e("span",{class:"text-body"},"Time:",-1)),e("span",vr,S(n(Pe)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[$[48]||($[48]=e("span",{class:"text-body"},"Type:",-1)),e("span",br,S(t.lead.scheduledAppointment.type),1)]),e("div",null,[$[49]||($[49]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",hr,S(t.lead.scheduledAppointment.assignee),1)])]),C(n(ee),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:$[18]||($[18]=se=>We.value=!0)})])):D("",!0),!n(je)&&!ne.value&&!n(ie)?(r(),y("div",xr,[e("button",{onClick:$[19]||($[19]=se=>ne.value=!0),class:"w-full p-4 border-2 border-dashed border-E5E7EB rounded-lg hover:border-blue-300 hover:bg-blue-50/50 transition-colors text-center"},[...$[51]||($[51]=[e("i",{class:"fa-solid fa-calendar-plus text-2xl text-blue-600 mb-2"},null,-1),e("p",{class:"text-fluid-sm font-medium text-heading"},"Schedule Appointment",-1),e("p",{class:"text-fluid-xs text-sub mt-1"},"Book a meeting or test drive (optional)",-1)])])])):D("",!0),ne.value&&!n(ie)?(r(),P(Jo,{key:2,"preselected-assignee":n(re).assignee,"can-cancel":!0,onConfirm:n(ft),onCancel:$[20]||($[20]=se=>ne.value=!1)},null,8,["preselected-assignee","onConfirm"])):D("",!0),n(ie)?(r(),y("div",kr,[e("div",wr,[$[52]||($[52]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-calendar-check text-green-600"}),e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Appointment Scheduled")],-1)),e("button",{onClick:$[21]||($[21]=()=>{ne.value=!0,ie.value=!1}),class:"text-fluid-xs text-green-700 hover:underline font-medium"}," Reschedule ")]),e("div",Cr,[e("div",null,[$[53]||($[53]=e("span",{class:"text-body"},"Date:",-1)),e("span",$r,S(n(Re)(n(Fe).datetime)),1)]),e("div",null,[$[54]||($[54]=e("span",{class:"text-body"},"Time:",-1)),e("span",Sr,S(n(Fe).time),1)]),e("div",null,[$[55]||($[55]=e("span",{class:"text-body"},"Type:",-1)),e("span",Ar,S(n(Fe).type),1)]),e("div",null,[$[56]||($[56]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Dr,S(n(Fe).assignee),1)])])])):D("",!0),e("div",Tr,[C(n(ee),{label:"Cancel",variant:"outline",size:"small",onClick:n(ot)},null,8,["onClick"]),e("div",Ir,[C(n(ee),{label:"Disqualify",variant:"outline",size:"small",onClick:n(zt)},null,8,["onClick"]),C(n(ee),{label:"Qualify",variant:"primary",size:"small",onClick:n(Rt),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"},null,8,["onClick"])])])])):D("",!0)])):D("",!0),C(n(Be),{open:n(Te),"onUpdate:open":c},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-2xl"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...$[57]||($[57]=[R("Add Note",-1)])]),_:1})]),_:1}),C(fs,{ref_key:"noteWidgetRef",ref:Y,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(Pt),onCancel:$[22]||($[22]=se=>Te.value=!1)},null,8,["task-id","onSave"]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>{var se,Xe;return[C(n(ee),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:$[23]||($[23]=et=>Te.value=!1)},{default:O(()=>[...$[58]||($[58]=[R(" Cancel ",-1)])]),_:1}),C(n(ee),{variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!((se=Y.value)!=null&&se.canSubmit()),onClick:(Xe=Y.value)==null?void 0:Xe.submit},{default:O(()=>[...$[59]||($[59]=[R(" Save Note ",-1)])]),_:1},8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),C(vo,{show:n(We),"preselected-assignee":n(re).assignee,onConfirm:n(ft),onClose:$[24]||($[24]=se=>We.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),C(At,{show:G.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:F,onClose:$[25]||($[25]=se=>G.value=!1)},null,8,["show"])]))}},qr={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},Nr={class:"flex justify-between items-start mb-3"},Mr={class:"text-fluid-xs text-gray-500 mt-0.5"},Er={key:0},Lr={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:m}){const s=t,c=m,l=ze(),i=()=>{var b;const k=l.currentLead;return k&&k.id===((b=s.lead)==null?void 0:b.id)?k:s.lead},o={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},a=Et(Ve(s,"lead"),o),{handlePostponed:p,handleValidated:d,handleQualified:u,handleCallAttemptLogged:f,handleNoteSaved:g,handleOpenPurchaseMethod:x,handleOpenTradeIn:v,handleAppointmentScheduled:I,handleDisqualified:T,handleReopen:h}=Da({getLead:i,leadState:a,emit:c});return(k,b)=>(r(),P(Lt,{task:t.lead},{"deadline-banner":O(()=>[C(Fa,{"next-action-due":t.lead.nextActionDue,"is-closed":n(a).isClosed.value,"show-deadline-banner":n(a).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":O(()=>[!n(a).isClosed.value&&n(a).showLQWidget.value?(r(),P(Or,{key:t.lead.id,lead:t.lead,onPostponed:n(p),onValidated:n(d),onQualified:n(u),onDisqualified:n(T),onCallAttemptLogged:n(f),onNoteSaved:n(g),onOpenPurchaseMethod:n(x),onOpenTradeIn:n(v),onAppointmentScheduled:n(I)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(a).isClosed.value&&n(a).primaryAction.value?(r(),P(Bt,{key:1,action:n(a).primaryAction.value,"color-scheme":n(a).primaryAction.value.colorScheme,onActionClicked:n(a).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):D("",!0)]),"task-widgets":O(()=>[...b[0]||(b[0]=[])]),"closed-state":O(()=>[n(a).isClosed.value?(r(),y("div",qr,[e("div",Nr,[e("div",null,[b[1]||(b[1]=e("h4",{class:"font-bold text-gray-900 text-fluid-sm"},"Lead Closed",-1)),e("p",Mr,[R(" Status: "+S(n(a).displayStage.value)+" ",1),t.lead.disqualifyReason?(r(),y("span",Er," - "+S(t.lead.disqualifyReason),1)):D("",!0)])])]),C(n(ee),{variant:"primary",size:"small",onClick:n(h),class:"flex items-center gap-2"},{default:O(()=>[...b[2]||(b[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):D("",!0)]),_:1},8,["task"]))}},Br={class:"flex justify-between items-start mb-3"},Fr={class:"font-bold text-heading text-fluid-sm"},jr={class:"text-fluid-xs text-sub mt-0.5"},Ur={class:"flex gap-3 flex-wrap"},Ae={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(m,s)=>(r(),y("div",{class:H(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Br,[e("div",null,[e("h4",Fr,S(t.title),1),e("p",jr,S(t.description),1)]),pe(m.$slots,"badge")]),e("div",Ur,[pe(m.$slots,"actions")]),pe(m.$slots,"survey"),pe(m.$slots,"content")],2))}},Vr={class:"mt-1.5 border-t border pt-1.5"},Rr={key:1},zr={class:"flex items-center justify-between mb-1.5"},Wr={class:"space-y-1.5"},Hr={class:"block label-upper mb-1"},Pr=["onUpdate:modelValue","placeholder"],_r=["onUpdate:modelValue"],Qr=["value"],Yr={key:2,class:"space-y-0.5"},Gr=["onUpdate:modelValue","value"],De={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=q(!1),i=q({});be(()=>s.questions,u=>{const f={};u.forEach(g=>{f[g.key]=""}),i.value=f},{immediate:!0});const o=()=>{c("survey-completed",{...i.value}),d()},a=()=>{c("survey-refused"),d()},p=()=>{c("not-responding"),d()},d=()=>{l.value=!1;const u={};s.questions.forEach(f=>{u[f.key]=""}),i.value=u};return(u,f)=>(r(),y("div",Vr,[l.value?(r(),y("div",Rr,[e("div",zr,[f[4]||(f[4]=e("h5",{class:"text-xs font-semibold text-body"},"Survey / Feedback",-1)),e("button",{onClick:f[1]||(f[1]=g=>l.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...f[3]||(f[3]=[e("i",{class:"fa-solid fa-chevron-up text-xs"},null,-1)])])]),e("div",Wr,[(r(!0),y(ce,null,ge(t.questions,(g,x)=>(r(),y("div",{key:x,class:"bg-surfaceSecondary rounded-md p-1.5"},[e("label",Hr,S(g.label),1),g.type==="text"?le((r(),y("textarea",{key:0,"onUpdate:modelValue":v=>i.value[g.key]=v,placeholder:g.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Pr)),[[ye,i.value[g.key]]]):g.type==="select"?le((r(),y("select",{key:1,"onUpdate:modelValue":v=>i.value[g.key]=v,class:"input text-xs py-1 px-2"},[f[5]||(f[5]=e("option",{value:""},"Select an option...",-1)),(r(!0),y(ce,null,ge(g.options,v=>(r(),y("option",{key:v,value:v},S(v),9,Qr))),128))],8,_r)),[[$e,i.value[g.key]]]):g.type==="radio"?(r(),y("div",Yr,[(r(!0),y(ce,null,ge(g.options,v=>(r(),y("label",{key:v,class:"flex items-center text-xs"},[le(e("input",{type:"radio","onUpdate:modelValue":I=>i.value[g.key]=I,value:v,class:"mr-1"},null,8,Gr),[[it,i.value[g.key]]]),R(" "+S(v),1)]))),128))])):D("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:o,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:a,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:p,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(r(),y("button",{key:0,onClick:f[0]||(f[0]=g=>l.value=!0),class:"w-full flex items-center justify-between text-xs text-sub hover:text-body py-0.5 transition-colors"},[...f[2]||(f[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1)])]))]))}},Kr={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],i=A(()=>{if(!s.opportunity.createdAt)return 0;const f=new Date(s.opportunity.createdAt),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),o=()=>{c("create-offer",s.opportunity)},a=()=>{c("review",s.opportunity)},p=f=>{c("survey-completed",{opportunity:s.opportunity,responses:f})},d=()=>{c("survey-refused",{opportunity:s.opportunity})},u=()=>{c("not-responding",{opportunity:s.opportunity})};return(f,g)=>(r(),P(Ae,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${i.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:a,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:p,onSurveyRefused:d,onNotResponding:u})]),_:1},8,["description"]))}},Jr={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],i=A(()=>{if(!s.opportunity.createdAt)return 0;const u=new Date(s.opportunity.createdAt),g=Math.abs(new Date-u);return Math.ceil(g/(1e3*60*60*24))}),o=()=>{c("create-offer",s.opportunity)},a=u=>{c("survey-completed",{opportunity:s.opportunity,responses:u})},p=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(u,f)=>(r(),P(Ae,{title:"Unsold Feedback",description:`This opportunity has been open for ${i.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:a,onSurveyRefused:p,onNotResponding:d})]),_:1},8,["description"]))}},Zr={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],i=()=>{c("schedule-closing",s.opportunity)},o=d=>{c("survey-completed",{opportunity:s.opportunity,responses:d})},a=()=>{c("survey-refused",{opportunity:s.opportunity})},p=()=>{c("not-responding",{opportunity:s.opportunity})};return(d,u)=>(r(),P(Ae,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:O(()=>[e("button",{onClick:i,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:o,onSurveyRefused:a,onNotResponding:p})]),_:1}))}},Xr={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],i=A(()=>{const u=s.opportunity.lastActivity||s.opportunity.createdAt;if(!u)return 0;const f=new Date(u),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),o=()=>{c("create-contract",s.opportunity)},a=u=>{c("survey-completed",{opportunity:s.opportunity,responses:u})},p=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(u,f)=>(r(),P(Ae,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${i.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:a,onSurveyRefused:p,onNotResponding:d})]),_:1},8,["description"]))}},ed={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],i=A(()=>{var v;if(!((v=s.opportunity)!=null&&v.contractDate))return 0;const f=new Date(s.opportunity.contractDate),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),o=()=>{c("prepare-delivery",s.opportunity)},a=()=>{c("pre-delivery-checklist",s.opportunity)},p=f=>{c("survey-completed",{opportunity:s.opportunity,responses:f})},d=()=>{c("survey-refused",{opportunity:s.opportunity})},u=()=>{c("not-responding",{opportunity:s.opportunity})};return(f,g)=>(r(),P(Ae,{title:"Contract Feedback",description:`Contract was signed ${i.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:a,class:"bg-surface border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:p,onSurveyRefused:d,onNotResponding:u})]),_:1},8,["description"]))}},td={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m,l=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],i=A(()=>{const u=s.activities.find(v=>{var I;return v.type==="delivery"||((I=v.action)==null?void 0:I.toLowerCase().includes("delivered"))});if(!u||!u.timestamp)return 0;const f=new Date(u.timestamp),x=Math.abs(new Date-f);return Math.ceil(x/(1e3*60*60*24))}),o=()=>{c("delivery-feedback",s.opportunity)},a=u=>{c("survey-completed",{opportunity:s.opportunity,responses:u})},p=()=>{c("survey-refused",{opportunity:s.opportunity})},d=()=>{c("not-responding",{opportunity:s.opportunity})};return(u,f)=>(r(),P(Ae,{title:"Delivery Feedback",description:`Vehicle was delivered ${i.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:a,onSurveyRefused:p,onNotResponding:d})]),_:1},8,["description"]))}},sd={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:m}){const s=t,c=m,l=A(()=>{var v;return((v=s.scheduledAppointment)==null?void 0:v.noShowCount)||0}),i=A(()=>{const v=l.value;return v===0?"No-Show Follow-up":v>=3?`No-Show #${v} - Final Warning`:`No-Show #${v} Follow-up`}),o=A(()=>{const v=l.value;return v>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":v>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),a=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],p=A(()=>{var I;return(I=s.scheduledAppointment)!=null&&I.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),d=()=>{c("contact-customer",s.opportunity)},u=()=>{const v=l.value;if(v>=3)c("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${v} no-shows`});else if(v===1||v===2){const I=new Date;I.setDate(I.getDate()+2),c("set-callback",{opportunity:s.opportunity,callbackDate:I.toISOString()})}else c("reschedule",s.opportunity)},f=v=>{c("survey-completed",{opportunity:s.opportunity,responses:v})},g=()=>{c("survey-refused",{opportunity:s.opportunity})},x=()=>{c("not-responding",{opportunity:s.opportunity})};return(v,I)=>(r(),P(Ae,{title:i.value,description:`Appointment was scheduled for ${p.value} but customer did not show up. ${o.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:O(()=>[e("button",{onClick:u,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...I[0]||(I[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),R(" Book Another Appointment ",-1)])]),e("button",{onClick:d,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...I[1]||(I[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),R(" Contact Customer ",-1)])])]),survey:O(()=>[C(De,{questions:a,onSurveyCompleted:f,onSurveyRefused:g,onNotResponding:x})]),_:1},8,["title","description"]))}},nd={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,c=m;Se();const l=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],i=A(()=>{const g=s.opportunity.lastActivity||s.opportunity.createdAt;if(!g)return 0;const x=new Date(g),I=Math.abs(new Date-x);return Math.ceil(I/(1e3*60*60*24))}),o=()=>{c("reopen",s.opportunity)},a=()=>{c("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},p=()=>{c("requalify",s.opportunity)},d=g=>{c("survey-completed",{opportunity:s.opportunity,responses:g})},u=()=>{c("survey-refused",{opportunity:s.opportunity})},f=()=>{c("not-responding",{opportunity:s.opportunity})};return(g,x)=>(r(),P(Ae,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${i.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...x[0]||(x[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),R(" Reopen Opportunity ",-1)])]),e("button",{onClick:a,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...x[1]||(x[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),R(" Close as Lost ",-1)])]),e("button",{onClick:p,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...x[2]||(x[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),R(" Requalify as Lead ",-1)])])]),survey:O(()=>[C(De,{questions:l,onSurveyCompleted:d,onSurveyRefused:u,onNotResponding:f})]),_:1},8,["description"]))}},ld={OOFB:Kr,UFB:Jr,NFU:Zr,OFB:Xr,CFB:ed,DFB:td,NS:sd,ABANDONED:nd};function ad(t,m,s,c,l){const i=A(()=>{const g=tt(t),x=tt(m),v=tt(s);return{opportunity:g,scheduledAppointment:x,activities:v,hasOffers:(v==null?void 0:v.some(I=>I.type==="offer"))||!1,stage:g.displayStage||g.stage,deliverySubstatus:g.deliverySubstatus||null,formatDateTime:l,hasActiveTaskWidget:!1}}),o=A(()=>{const g=i.value,x=ys(g.stage,g);if(!x)return null;const v=ld[x];return v?{type:x,component:v,props:{opportunity:g.opportunity,appointment:g.scheduledAppointment,activities:g.activities}}:null}),a=A(()=>({...i.value,hasActiveTaskWidget:!!o.value})),p=A(()=>{const g=a.value,x=gs(g.stage,g);if(!x)return null;const v=c[x.key];return{...x,handler:v||(()=>{})}}),d=A(()=>{const g=a.value;return vs(g.stage,g).map(v=>{const I=c[v.key];return{...v,handler:I||(()=>{})}})}),u=A(()=>{const g=i.value;return bs(g.stage)}),f=A(()=>!o.value||!o.value.type?"":hs(o.value.type));return{primaryAction:p,secondaryActions:d,activeTaskWidget:o,taskWidgetTitle:f,isClosed:u}}const od={class:"relative"},id=["disabled"],rd={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-50 dropdown-menu-small"},dd={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:m}){const s=t,c=m,l=q(!1),i=()=>{l.value=!l.value},o=()=>{l.value=!1},a=d=>{d.disabled||(o(),c("action-selected",d),d.handler&&typeof d.handler=="function"&&d.handler())},p=A(()=>(s.actions||[]).map(d=>({key:d.key,label:d.label,disabled:!!d.disabled,onClick:()=>a(d)})));return(d,u)=>{const f=ut("click-outside");return le((r(),y("div",od,[e("button",{onClick:i,class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[u[0]||(u[0]=e("span",null,"More actions",-1)),e("i",{class:H(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":l.value}])},null,2)],8,id),C(xt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:O(()=>[l.value?(r(),y("div",rd,[C(n(ct),{items:p.value,className:"min-w-full"},null,8,["items"])])):D("",!0)]),_:1})])),[[f,o]])}}},ud={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},cd=["src","alt"],pd={key:1,class:"w-full h-full flex items-center justify-center"},md={class:"flex items-center justify-between mb-1.5"},fd={class:"text-sm font-bold text-heading"},yd={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},gd={class:"text-xs text-sub mb-1.5"},vd={key:0,class:"text-xs text-green-600 font-medium mb-2"},bd={key:1,class:"text-xs text-orange-600 font-medium mb-2"},bt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const m=t,s=A(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[m.badge]||"gray"),c=l=>l?l.toLocaleString("en-US"):"0";return(l,i)=>(r(),y("div",{onClick:i[1]||(i[1]=o=>l.$emit("select")),class:H(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",ud,[t.vehicle.image?(r(),y("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,cd)):(r(),y("div",pd,[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",md,[C(n(st),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",fd,"â‚¬"+S(c(t.vehicle.price)),1)]),e("h4",yd,S(t.vehicle.brand)+" "+S(t.vehicle.model),1),e("p",gd,S(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(r(),y("div",vd,[i[3]||(i[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),R(" In stock ("+S(t.stockDays)+" days) ",1)])):(r(),y("div",bd,[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),R(" Out of stock ",-1)])])),e("button",{onClick:i[0]||(i[0]=Qe(o=>l.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},hd={class:"space-y-6"},xd={key:0},kd={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},wd={class:"mb-4"},Cd={class:"relative"},$d={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Sd={key:1,class:"text-center py-8 text-sub"},Ad={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},Dd={key:0,class:"mt-4 space-y-3"},Td={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Id={class:"flex justify-end"},Od=["disabled"],qd={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:m}){const s=t,c=m,l=b=>{b||c("close")},i=q(""),o=q(!1),a=q(null),p=q(null),d=q(null),u=q([]),f=q({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});mt(async()=>{try{const b=await Dt({});u.value=b.data||[]}catch(b){console.error("Failed to load vehicles:",b),u.value=[]}});const g=A(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),x=A(()=>{const b=[];if(s.requestedVehicle&&g.value&&b.push({...s.requestedVehicle,isRequested:!0}),u.value&&u.value.length>0){const w=u.value.filter(Y=>s.requestedVehicle?Y.brand!==s.requestedVehicle.brand||Y.model!==s.requestedVehicle.model:!0),L=s.requestedVehicle&&g.value?3:4;b.push(...w.slice(0,L))}return b}),v=A(()=>{if(!u.value||u.value.length===0)return[];let b=[...u.value];if(i.value){const w=i.value.toLowerCase();b=b.filter(L=>L.brand.toLowerCase().includes(w)||L.model.toLowerCase().includes(w)||L.year.toString().includes(w))}return b}),I=A(()=>f.value.brand&&f.value.model&&f.value.year&&f.value.price>0),T=(b,w)=>{a.value=b,p.value=b.id||`custom-${Date.now()}`,d.value=w},h=()=>{if(!I.value)return;const b={...f.value,id:`custom-${Date.now()}`,isCustom:!0};T(b,"custom")},k=()=>{a.value&&(c("vehicle-selected",{vehicle:a.value,type:d.value}),c("close"),a.value=null,p.value=null,d.value=null,i.value="",o.value=!1,f.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(b,w)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":l},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-6xl"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...w[7]||(w[7]=[R("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",hd,[x.value.length?(r(),y("div",xd,[w[8]||(w[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),R(" Recommended Vehicles ")],-1)),e("div",kd,[(r(!0),y(ce,null,ge(x.value,L=>(r(),P(bt,{key:L.id,vehicle:L,badge:L.isRequested?"Requested":"Recommended","stock-days":L.stockDays,selected:p.value===L.id,onSelect:Y=>T(L,L.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):D("",!0),e("div",null,[w[11]||(w[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),R(" Browse Stock ")],-1)),e("div",wd,[e("div",Cd,[w[9]||(w[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),le(e("input",{"onUpdate:modelValue":w[0]||(w[0]=L=>i.value=L),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ye,i.value]])])]),v.value.length?(r(),y("div",$d,[(r(!0),y(ce,null,ge(v.value,L=>(r(),P(bt,{key:L.id,vehicle:L,badge:"In Stock","stock-days":L.stockDays,selected:p.value===L.id,onSelect:Y=>T(L,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(r(),y("div",Sd,[...w[10]||(w[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[w[19]||(w[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),R(" Configure Custom Vehicle ")],-1)),e("div",Ad,[w[18]||(w[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:w[1]||(w[1]=L=>o.value=!o.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[w[12]||(w[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),R(" "+S(o.value?"Hide Configuration":"Build Custom Configuration"),1)]),o.value?(r(),y("div",Dd,[e("div",Td,[e("div",null,[w[13]||(w[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),le(e("input",{"onUpdate:modelValue":w[2]||(w[2]=L=>f.value.brand=L),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ye,f.value.brand]])]),e("div",null,[w[14]||(w[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),le(e("input",{"onUpdate:modelValue":w[3]||(w[3]=L=>f.value.model=L),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ye,f.value.model]])]),e("div",null,[w[15]||(w[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),le(e("input",{"onUpdate:modelValue":w[4]||(w[4]=L=>f.value.year=L),type:"number",class:"input",placeholder:"2024"},null,512),[[ye,f.value.year]])]),e("div",null,[w[16]||(w[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (â‚¬)",-1)),le(e("input",{"onUpdate:modelValue":w[5]||(w[5]=L=>f.value.price=L),type:"number",class:"input",placeholder:"98000"},null,512),[[ye,f.value.price]])])]),e("div",Id,[e("button",{onClick:h,disabled:!I.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...w[17]||(w[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),R(" Use Custom Configuration ",-1)])],8,Od)])])):D("",!0)])])]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:w[6]||(w[6]=L=>b.$emit("close"))}),a.value?(r(),P(n(ee),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:k})):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Nd={class:"space-y-4"},Md=["max"],Ed={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,c=m,l=q(""),i=q(""),o=q(""),a=A(()=>new Date().toISOString().split("T")[0]);be(()=>s.show,f=>{if(f){const g=new Date;l.value=g.toISOString().split("T")[0],i.value=g.toTimeString().slice(0,5),o.value=""}});const p=()=>{if(!l.value)return;const f=i.value?`${l.value}T${i.value}:00`:`${l.value}T12:00:00`;c("confirm",{contractDate:f,notes:o.value})},d=()=>{c("cancel")},u=f=>{f||d()};return(f,g)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":u},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...g[3]||(g[3]=[R("Set Contract Signing Date",-1)])]),_:1}),C(n(Ze),null,{default:O(()=>[...g[4]||(g[4]=[R("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",Nd,[e("div",null,[g[5]||(g[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),le(e("input",{type:"date","onUpdate:modelValue":g[0]||(g[0]=x=>l.value=x),max:a.value,class:"input"},null,8,Md),[[ye,l.value]])]),e("div",null,[g[6]||(g[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),le(e("input",{type:"time","onUpdate:modelValue":g[1]||(g[1]=x=>i.value=x),class:"input"},null,512),[[ye,i.value]])]),e("div",null,[g[7]||(g[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),le(e("textarea",{"onUpdate:modelValue":g[2]||(g[2]=x=>o.value=x),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ye,o.value]])])]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),C(n(ee),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!l.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ld={class:"space-y-4"},Bd=["max"],Fd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,c=m,l=q(""),i=q(""),o=q(""),a=q(""),p=A(()=>new Date().toISOString().split("T")[0]);be(()=>s.show,g=>{if(g){const x=new Date;l.value=x.toISOString().split("T")[0],i.value=x.toTimeString().slice(0,5),o.value="",a.value=""}});const d=()=>{if(!l.value||!o.value)return;const g=i.value?`${l.value}T${i.value}:00`:`${l.value}T12:00:00`;c("confirm",{deliveryDate:g,location:o.value,notes:a.value})},u=()=>{c("cancel")},f=g=>{g||u()};return(g,x)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":f},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...x[4]||(x[4]=[R("Mark as Delivered",-1)])]),_:1}),C(n(Ze),null,{default:O(()=>[...x[5]||(x[5]=[R("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",Ld,[e("div",null,[x[6]||(x[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),le(e("input",{type:"date","onUpdate:modelValue":x[0]||(x[0]=v=>l.value=v),max:p.value,class:"input"},null,8,Bd),[[ye,l.value]])]),e("div",null,[x[7]||(x[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),le(e("input",{type:"time","onUpdate:modelValue":x[1]||(x[1]=v=>i.value=v),class:"input"},null,512),[[ye,i.value]])]),e("div",null,[x[9]||(x[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),le(e("select",{"onUpdate:modelValue":x[2]||(x[2]=v=>o.value=v),class:"input"},[...x[8]||(x[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[$e,o.value]])]),e("div",null,[x[10]||(x[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),le(e("textarea",{"onUpdate:modelValue":x[3]||(x[3]=v=>a.value=v),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ye,a.value]])])]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u}),C(n(ee),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!l.value||!o.value,onClick:d},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},jd={class:"space-y-4"},Ud={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,c=m,l=q(""),i=q("");be(()=>s.show,d=>{d&&(l.value="",i.value="")});const o=()=>{l.value&&c("confirm",{reason:l.value,notes:i.value})},a=()=>{c("cancel")},p=d=>{d||a()};return(d,u)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":p},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...u[2]||(u[2]=[R("Close as Lost",-1)])]),_:1}),C(n(Ze),null,{default:O(()=>[...u[3]||(u[3]=[R("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",jd,[e("div",null,[u[5]||(u[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),le(e("select",{"onUpdate:modelValue":u[0]||(u[0]=f=>l.value=f),class:"input"},[...u[4]||(u[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[$e,l.value]])]),e("div",null,[u[6]||(u[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),le(e("textarea",{"onUpdate:modelValue":u[1]||(u[1]=f=>i.value=f),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ye,i.value]])])]),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a}),C(n(ee),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!l.value,onClick:o},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Vd={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=m,c=l=>{l||s("cancel")};return(l,i)=>(r(),P(n(Be),{open:t.show,"onUpdate:open":c},{default:O(()=>[C(n(Oe),null,{default:O(()=>[C(n(qe),{class:"fixed inset-0 z-50 bg-black/50"}),C(n(Ne),{class:"w-full sm:max-w-lg"},{default:O(()=>[C(n(Me),null,{default:O(()=>[C(n(Ee),null,{default:O(()=>[...i[2]||(i[2]=[R("Requalify as Lead",-1)])]),_:1}),C(n(Ze),null,{default:O(()=>[...i[3]||(i[3]=[R("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),i[4]||(i[4]=e("div",{class:"space-y-6 max-h-screen-60 overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),R(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),R(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),R(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),C(n(Le),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[C(n(ee),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[0]||(i[0]=o=>l.$emit("cancel"))}),C(n(ee),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:i[1]||(i[1]=o=>l.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Rd={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},zd={class:"flex gap-3"},Wd={key:0,class:"space-y-3"},Hd={class:"flex items-center gap-2 pb-2 border-b border"},Pd={class:"font-semibold text-heading text-fluid-sm"},_d={key:0,class:"flex justify-end"},Qd={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:m}){const s=t,c=m,l=pt(),i=nt(),o=q(!1),a=q(!1),p=q(!1),d=q(!1),u=q(!1),f=q(!1),g=q(!1),x=q(!1),v=q(!1),I=q(!1),T=q([]),h=A(()=>{var Z,z;return((Z=s.opportunity)==null?void 0:Z.displayStage)||((z=s.opportunity)==null?void 0:z.stage)||"Qualified"});A(()=>ht(h.value,"opportunity"));function k(Z){return Z?new Date(Z).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const b={"schedule-appointment":()=>{o.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?v.value=!0:o.value=!0},"select-vehicle":()=>{g.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?g.value=!0:a.value=!0},"call-prospect":()=>{x.value=!0},"follow-up-offer":()=>{x.value=!0},"request-decision":()=>{x.value=!0},"finalize-contract":()=>{d.value=!0},"schedule-delivery":()=>{u.value=!0},"confirm-delivery":()=>{u.value=!0},"collect-feedback":()=>{x.value=!0},reschedule:()=>{I.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&E()},"close-won":()=>{d.value=!0},"add-offer":()=>{a.value=!0},"add-contract":()=>{d.value=!0},"extend-deadline":()=>{x.value=!0},"close-lost":()=>{p.value=!0},reopen:()=>{K()},requalify:()=>{f.value=!0}},{primaryAction:w,secondaryActions:L,activeTaskWidget:Y,taskWidgetTitle:G,isClosed:ne}=ad(Ve(s,"opportunity"),Ve(s,"scheduledAppointment"),Ve(s,"activities"),b,k);function oe(Z){}function J(){}function B(Z){g.value=!1,c("vehicle-selected",Z),setTimeout(()=>{a.value=!0},300)}function F(Z){a.value=!1,c("offer-created",Z)}function j(Z){o.value=!1,c("appointment-scheduled",{...Z,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function E(){s.scheduledAppointment&&c("appointment-cancelled",s.scheduledAppointment.id)}function V(Z){d.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:Z.contractDate})}function W(Z){u.value=!1,i.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:Z})}function N(Z){p.value=!1,i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:Z})}function K(){i.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function ve(Z){f.value=!1,l.push(`/customer/${Z.id}?type=lead`)}function he(Z){v.value=!1}function Q(Z){I.value=!1}function me(Z){i.updateOpportunity(s.opportunity.id,{callbackDate:Z.callbackDate})}function ke(Z){i.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:Z.reason||"Multiple no-shows (NS3)"})}return mt(async()=>{try{const z=(await Dt({})).data||[];T.value=z.filter(ie=>ie.stockDays!==null&&ie.stockDays!==void 0).slice(0,5)}catch(Z){console.error("Failed to load recommended cars:",Z),T.value=[]}}),(Z,z)=>(r(),y(ce,null,[C(Lt,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":O(()=>[n(ne)&&!n(Y)?(r(),y("div",Rd,[z[15]||(z[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed"),e("p",{class:"text-fluid-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",zd,[C(n(ee),{variant:"primary",size:"small",onClick:K,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700"},{default:O(()=>[...z[13]||(z[13]=[e("span",null,"Reopen",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}),C(n(ee),{variant:"outline",size:"small",onClick:z[0]||(z[0]=ie=>f.value=!0),class:"flex items-center gap-2 bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300"},{default:O(()=>[...z[14]||(z[14]=[e("span",null,"Requalify as Lead",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])]),_:1})])])):D("",!0)]),"primary-action":O(()=>[!n(ne)&&n(w)?(r(),P(Bt,{key:0,action:n(w),"color-scheme":n(w).colorScheme,onActionClicked:z[1]||(z[1]=ie=>n(w).handler())},null,8,["action","color-scheme"])):D("",!0)]),"task-widgets":O(()=>[n(Y)&&n(Y).component?(r(),y("div",Wd,[e("div",Hd,[z[16]||(z[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Pd,S(n(G)),1)]),(r(),P(Ke(n(Y).component),Ge(n(Y).props,{onClose:J,onSetCallback:me,onAutoCloseLost:ke}),null,16))])):D("",!0)]),"secondary-actions":O(()=>[n(L).length>0?(r(),y("div",_d,[C(dd,{actions:n(L),onActionSelected:oe},null,8,["actions"])])):D("",!0)]),_:1},8,["task"]),o.value?(r(),P(Ss,{key:0,show:o.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:j,onCancel:z[2]||(z[2]=ie=>o.value=!1)},null,8,["show","customer","assignee"])):D("",!0),g.value?(r(),P(qd,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":T.value,onVehicleSelected:B,onClose:z[3]||(z[3]=ie=>g.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):D("",!0),a.value?(r(),P(xs,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:F,onClose:z[4]||(z[4]=ie=>a.value=!1)},null,8,["opportunity","vehicle"])):D("",!0),d.value?(r(),P(Ed,{key:3,opportunity:t.opportunity,onContractSet:V,onClose:z[5]||(z[5]=ie=>d.value=!1)},null,8,["opportunity"])):D("",!0),u.value?(r(),P(Fd,{key:4,opportunity:t.opportunity,onDelivered:W,onClose:z[6]||(z[6]=ie=>u.value=!1)},null,8,["opportunity"])):D("",!0),p.value?(r(),P(Ud,{key:5,opportunity:t.opportunity,onClosed:N,onClose:z[7]||(z[7]=ie=>p.value=!1)},null,8,["opportunity"])):D("",!0),f.value?(r(),P(Vd,{key:6,opportunity:t.opportunity,onRequalified:ve,onClose:z[8]||(z[8]=ie=>f.value=!1)},null,8,["opportunity"])):D("",!0),x.value?(r(),P(ks,{key:7,onClose:z[9]||(z[9]=ie=>x.value=!1)})):D("",!0),v.value&&t.scheduledAppointment?(r(),P(As,{key:8,show:v.value,event:t.scheduledAppointment,onClose:z[10]||(z[10]=ie=>v.value=!1),onEdit:z[11]||(z[11]=ie=>{v.value=!1,I.value=!0}),onDelete:he},null,8,["show","event"])):D("",!0),I.value&&t.scheduledAppointment?(r(),P(Ds,{key:9,show:I.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:Q,onCancel:z[12]||(z[12]=ie=>I.value=!1)},null,8,["show","event","customer"])):D("",!0)],64))}};function Yd(t){const m=ze(),s=nt(),c=A(()=>t.value?t.value.type==="lead"?Lr:Qd:null),l=A(()=>t.value?t.value.type==="lead"?{currentActivities:A(()=>m.currentLeadActivities),addActivity:(o,a)=>m.addActivity(o,a),updateActivity:(o,a,p)=>m.updateActivity(o,a,p),deleteActivity:(o,a)=>m.deleteActivity(o,a),updateLead:(o,a)=>m.updateLead(o,a),loadLeadById:o=>m.fetchLeadById(o)}:{currentActivities:A(()=>s.currentOpportunityActivities),addActivity:(o,a)=>s.addActivity(o,a),updateActivity:(o,a,p)=>s.updateActivity(o,a,p),deleteActivity:(o,a)=>s.deleteActivity(o,a),addVehicle:(o,a)=>s.addVehicle(o,a),createOffer:(o,a)=>s.createOffer(o,a),updateOpportunity:(o,a)=>s.updateOpportunity(o,a),loadOpportunityById:o=>s.fetchOpportunityById(o)}:null),i=A(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:c,storeAdapter:l,addNewConfig:i}}function Gd(){const t=u=>{if(!u)return"No deadline";const f=wt(u);return f.type==="overdue"?"OVERDUE":f.type==="today"||f.type==="urgent"?f.relativeTime:Ct(u)},m=u=>{const f=u.type==="lead"?u.requestedCar:u.vehicle;return!f||!f.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[f.type]||{type:f.type.toLowerCase(),label:f.type}},s=u=>u?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[u.type]||"bg-gray-50 text-gray-700":"",c=u=>{if(!u||!u.assignee)return{name:"Unassigned",initials:"?"};const f=u.assigneeInitials||u.assignee.split(" ").map(g=>g[0]).join("");return{name:u.assignee,initials:f}},l=u=>{if(!u||!u.customer||!u.customer.address)return null;const g=u.customer.address.split(",");return g.length>1&&g[g.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:m,getVehicleTypeBadgeClass:s,getOwnerInfo:c,getCustomerCity:l,getLocationDisplay:u=>{const f=l(u),g=u.source||"Unknown";return f?`${f} â€¢ ${g}`:g},getAssigneeInitials:u=>{if(!u)return"?";const f=u.split(" ");return f.length>=2?(f[0][0]+f[f.length-1][0]).toUpperCase():u.substring(0,2).toUpperCase()},getVehicleStatusDisplay:u=>{const f=u.type==="lead"?u.requestedCar:u.vehicle;if(!f)return"No vehicle";const g=m(u),x=g?g.label:f.type||"Unknown";let v="";return f.kilometers!==void 0&&f.kilometers!==null&&(f.kilometers>=1e3?v=`${(f.kilometers/1e3).toFixed(0)}k`:v=`${f.kilometers}`),v?`${x} / ${v}`:x},getTaskStatusDisplay:u=>u.type==="lead"?u.status||"Unknown":u.stage||"Unknown",getStageBadgeClass:St,getUnselectedClass:u=>u.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Kd(t){const m=ze(),s=nt(),c=Ie(),l=A(()=>{const p=(t.value?m.leads:m.leads.filter(f=>!f.isDisqualified)).map(f=>{const g=kt(f,"lead"),x={...f,type:"lead",compositeId:`lead-${f.id}`,displayStage:g};return!x.customer&&f.customer&&(x.customer=f.customer),x}),d=s.opportunities.map(f=>{const g={...f,type:"opportunity",compositeId:`opportunity-${f.id}`};return!g.customer&&f.customer&&(g.customer=f.customer),g});let u=[];return c.isOperator()?u=p:c.isSalesman()?u=d:u=[...p,...d],u}),i=(a,p)=>p==="all"?a:a.filter(d=>d.type===p),o=A(()=>{const a=l.value.some(d=>d.type==="lead"),p=l.value.some(d=>d.type==="opportunity");return a&&p});return{allTasks:l,filterByType:i,shouldShowTypeFilter:o}}function Jd(){const t=Ie(),m=Je(),s=Se();return{sortTasks:(l,i)=>{if(i==="none")return[...l].sort((o,a)=>{const p=new Date(o.lastActivity||o.createdAt||0);return new Date(a.lastActivity||a.createdAt||0)-p});if(i==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...l.map(p=>{if(p.type==="lead"&&!p.urgencyScore){const d=qt(p);return{...p,urgencyScore:d.score,urgencyLevel:d.level}}return p})].sort((p,d)=>{if(p.type==="lead"&&d.type==="lead"){const g=p.urgencyScore||0,x=d.urgencyScore||0;if(g!==x)return x-g;const v=new Date(p.createdAt||0);return new Date(d.createdAt||0)-v}if(p.type==="lead"&&d.type==="opportunity")return-1;if(p.type==="opportunity"&&d.type==="lead")return 1;if(p.priority==="Hot"&&d.priority!=="Hot")return-1;if(p.priority!=="Hot"&&d.priority==="Hot")return 1;const u=new Date(p.lastActivity||p.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-u}):[...l].sort((a,p)=>{if(a.priority==="Hot"&&p.priority!=="Hot")return-1;if(a.priority!=="Hot"&&p.priority==="Hot")return 1;const d=new Date(a.lastActivity||a.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-d});if(i==="assigned-to-me"){const o=t.currentUser.name;return[...l.filter(p=>p.assignee===o)].sort((p,d)=>{const u=new Date(p.lastActivity||p.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-u})}if(i==="assigned-to-my-team"){const o=t.currentUser;let a=[];return o.role==="manager"?a=m.users.map(d=>d.name):o.role==="salesman"?a=m.users.filter(d=>d.role==="salesman").map(d=>d.name):o.role==="operator"&&(a=m.users.filter(d=>d.role==="operator").map(d=>d.name)),[...l.filter(d=>a.includes(d.assignee))].sort((d,u)=>{const f=new Date(d.lastActivity||d.createdAt||0);return new Date(u.lastActivity||u.createdAt||0)-f})}return l}}}const Zd={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Xd={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},eu={key:0,class:"flex items-center gap-2"},tu={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},su={class:"text-gray-600 font-medium"},nu={key:1},lu={key:0},au={key:1},ou={key:2},iu={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},ru={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},du={__name:"Tasks",setup(t){const m=Xt(),s=pt(),c=ze(),l=nt();Ie(),Je();const i=Se(),{getDateDisplay:o,getVehicleType:a,getVehicleTypeBadgeClass:p,getOwnerInfo:d,getCustomerCity:u,getAssigneeInitials:f,getUnselectedClass:g}=Gd(),x=q(localStorage.getItem("tasksViewMode")||"table"),v=q(""),I=A(()=>m.query.highlight||null);be(x,M=>{localStorage.setItem("tasksViewMode",M)});const T=(M,_="")=>{x.value;const te=F.value;if(x.value=M,M==="card"&&_&&(v.value=_),M==="table"&&te)v.value="",s.push({path:"/tasks",query:{highlight:te.compositeId}});else if(M==="card"&&I.value){const[fe,U]=I.value.split("-");s.push({path:`/tasks/${U}`,query:{type:fe}})}else M==="card"&&!I.value&&!F.value&&s.push({path:"/tasks"})},h=q("all"),k=q("none"),b=q(!1),w=q(null);q(!1);const L=q(!1),Y=q(null),{allTasks:G,filterByType:ne,shouldShowTypeFilter:oe}=Kd(b),{sortTasks:J}=Jd(),B=A(()=>{let M=ne(G.value,h.value);return M=J(M,k.value),M}),F=A(()=>{if(!m.params.id)return null;const M=parseInt(m.params.id);if(isNaN(M))return null;const _=m.query.type;if(_){const ue=`${_}-${M}`;return G.value.find(re=>re.compositeId===ue)||null}const te=h.value!=="all"?G.value.filter(ue=>ue.type===h.value):G.value,fe=`lead-${M}`,U=`opportunity-${M}`,X=te.find(ue=>ue.compositeId===fe||ue.compositeId===U);return X||G.value.find(ue=>ue.compositeId===fe||ue.compositeId===U)||null});A(()=>F.value?F.value.type==="lead"?c.currentLeadActivities:l.currentOpportunityActivities:[]);const j=Yd(F),E=j.managementWidget,V=j.storeAdapter,W=j.addNewConfig,N=g;mt(()=>{c.fetchLeads(),l.fetchOpportunities();const M=m.params.id;M&&K(M)}),be(()=>m.params.id,M=>{M&&K(M)}),be(F,M=>{M&&(M.type==="lead"?c.fetchLeadById(M.id):l.fetchOpportunityById(M.id))},{immediate:!0});const K=M=>{const _=parseInt(M),te=G.value.find(fe=>fe.id===_);te&&(te.type==="lead"?c.fetchLeadById(_):l.fetchOpportunityById(_))},ve=M=>{const[_,te]=M.split("-");x.value="card",s.push({path:`/tasks/${te}`,query:{type:_}})},he=()=>{s.push({path:"/tasks"})},Q=M=>{if(!F.value)return;const _=B.value.findIndex(te=>{const fe=F.value.compositeId||`${F.value.type}-${F.value.id}`;return(te.compositeId||`${te.type}-${te.id}`)===fe});if(_!==-1){if(M==="previous"&&_>0){const te=B.value[_-1];ve(te.compositeId)}else if(M==="next"&&_<B.value.length-1){const te=B.value[_+1];ve(te.compositeId)}}},me=M=>{w.value=w.value===M?null:M},ke=M=>{Y.value=M,L.value=!0,w.value=null},Z=M=>{k.value=M},z=async M=>{if(!Y.value)return;const _=Y.value,te=M.name;_.type==="lead"?await c.updateLead(_.id,{assignee:te,assigneeType:M.type,teamId:M.type==="team"?M.id:null}):_.type==="opportunity"&&await l.updateOpportunity(_.id,{assignee:te,assigneeType:M.type,teamId:M.type==="team"?M.id:null}),L.value=!1,Y.value=null},ie=async M=>{w.value=null,M.type==="lead"?await c.updateLead(M.id,{priority:"Hot"}):M.type==="opportunity"&&await l.updateOpportunity(M.id,{priority:"Hot"})},Fe=async M=>{w.value=null,M.type==="lead"?await c.updateLead(M.id,{priority:"Normal"}):M.type==="opportunity"&&await l.updateOpportunity(M.id,{priority:"Normal"})},Te=async M=>{if(w.value=null,M.type==="lead")try{const _=M.displayStage||M.stage||Ue.NEW,te=Ue.NEW,fe=rt(_,te);if(fe){const{updates:U,activities:X}=fe(M);await c.updateLead(M.id,U);for(const ue of X)await c.addActivity(M.id,ue)}else await c.updateLead(M.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await c.addActivity(M.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await c.fetchLeadById(M.id)}catch(_){console.error("Failed to reopen lead:",_)}},We=M=>{const _=[];return M.type==="lead"&&M.isDisqualified===!0&&_.push({key:"reopen",label:"Reopen Lead",onClick:()=>Te(M)}),_.push({key:"reassign",label:"Reassign",onClick:()=>ke(M)}),M.priority!=="Hot"?_.push({key:"mark-hot",label:"Mark as hot",onClick:()=>ie(M)}):_.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Fe(M)}),_};return(M,_)=>{var te,fe;return r(),y("div",Zd,[C(Aa,{show:!!F.value,"back-label":"Back to task list",onBack:he},null,8,["show"]),x.value==="card"?(r(),y("div",Xd,[e("div",{class:H(["flex flex-col overflow-hidden",F.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[C(bn,{title:"Tasks",items:B.value,"selected-id":(te=F.value)==null?void 0:te.compositeId,"type-filter":h.value,"view-mode":x.value,"initial-search-query":v.value,onViewChange:T,"selected-class":U=>U.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":n(N),"open-menu-id":w.value,getName:U=>{const X=U.customer;return X&&X.name?X.name:X&&!X.name&&X.email&&X.email.split("@")[0]||"Unknown"},getInitials:U=>{const X=U.customer;return X&&X.initials?X.initials:X&&X.name&&X.name.split(" ").map(re=>re[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:U=>{if(U.type==="lead"){if(!U.requestedCar)return"No vehicle specified";const re=U.requestedCar,je=[`${re.brand} ${re.model}`];return re.kilometers!==void 0&&re.kilometers!==null&&je.push(`${re.kilometers} km`),re.status&&je.push(re.status),je.join(" â€¢ ")}const X=U.vehicle||U.requestedCar;if(!X)return"No vehicle specified";const ue=[`${X.brand} ${X.model}`];return X.kilometers!==void 0&&X.kilometers!==null&&ue.push(`${X.kilometers} km`),X.status&&ue.push(X.status),ue.join(" â€¢ ")},avatarClass:U=>U.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":We,"show-mobile-close":!1,onSelect:ve,onMenuClick:me,onMenuClose:_[0]||(_[0]=U=>w.value=null),onClose:he,"show-type-filter":n(oe),onFilterChange:_[1]||(_[1]=U=>h.value=U),onSortChange:Z},{badges:O(({item:U})=>[U&&U.type?(r(),P(n(st),{key:0,text:U.type==="lead"?"Lead":"Opportunity",size:"small",theme:U.type==="lead"?"blue":"gray"},null,8,["text","theme"])):D("",!0),U&&U.type==="lead"&&n(i).getSetting("urgencyEnabled")!==!1&&U.urgencyLevel?(r(),P(n(st),{key:1,text:`${n(Nt)(U.urgencyLevel)} ${U.urgencyLevel}`,size:"small",class:H(n(Mt)(U.urgencyLevel))},null,8,["text","class"])):D("",!0),U&&U.priority==="Hot"&&(n(i).getSetting("urgencyEnabled")===!1||U.type!=="lead")?(r(),P(n(st),{key:2,text:"HOT",size:"small",theme:"red"})):D("",!0)]),location:O(({item:U})=>[R(S(n(u)(U)||"Unknown"),1)]),source:O(({item:U})=>{var X;return[R(S(U.source||((X=U.customer)==null?void 0:X.source)||"Unknown"),1)]}),owner:O(({item:U})=>[U.assignee?(r(),y("div",eu,[e("div",tu,S(n(f)(U.assignee)),1),e("span",su,S(U.assignee),1)])):(r(),y("span",nu,"Unassigned"))]),dates:O(({item:U})=>[U.type==="lead"&&U.nextActionDue?(r(),y("span",lu,"Due: "+S(n(o)(U.nextActionDue)),1)):U.type==="opportunity"&&U.nextActionDue?(r(),y("span",au,"Due: "+S(n(o)(U.nextActionDue)),1)):(r(),y("span",ou,"Due: No deadline"))]),_:1},8,["items","selected-id","type-filter","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),F.value?(r(),P(vt,{key:0,task:F.value,"management-widget":n(E),"store-adapter":n(V),"add-new-config":n(W),"filtered-tasks":B.value,onTaskNavigate:Q},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):D("",!0),F.value?D("",!0):(r(),y("div",iu,[..._[6]||(_[6]=[Ye('<div class="flex-1 flex items-center justify-center p-8" data-v-43a1ebfd><div class="text-center max-w-sm" data-v-43a1ebfd><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-surfaceSecondary flex items-center justify-center" data-v-43a1ebfd><i class="fa-solid fa-tasks text-2xl text-sub" data-v-43a1ebfd></i></div><h3 class="text-content-bold mb-2" data-v-43a1ebfd>No task selected</h3><p class="text-meta" data-v-43a1ebfd>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):D("",!0),x.value==="table"?(r(),y("div",ru,[C(Nn,{tasks:B.value,"current-task-id":(fe=F.value)==null?void 0:fe.compositeId,"highlight-id":I.value,"type-filter":h.value,"sort-option":k.value,"show-type-filter":n(oe),"show-closed":b.value,"show-mobile-close":!1,"open-menu-id":w.value,"get-vehicle-type":n(a),"get-vehicle-type-badge-class":n(p),"get-owner-info":n(d),"get-stage-badge-class":n(St),"view-mode":x.value,onSelect:ve,onMenuClick:me,onMenuClose:_[2]||(_[2]=U=>w.value=null),onFilterChange:_[3]||(_[3]=U=>h.value=U),onSortChange:Z,onToggleClosed:_[4]||(_[4]=U=>b.value=U),onReassign:ke,onClose:he,onViewChange:T,class:H(F.value?"hidden lg:flex shrink-0":"flex-1 w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode","class"]),F.value?(r(),P(vt,{key:0,task:F.value,"management-widget":n(E),"store-adapter":n(V),"add-new-config":n(W),"filtered-tasks":B.value,onTaskNavigate:Q},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):D("",!0)])):D("",!0),C(At,{show:L.value,onClose:_[5]||(_[5]=U=>L.value=!1),onConfirm:z},null,8,["show"])])}}},ku=we(du,[["__scopeId","data-v-43a1ebfd"]]);export{ku as default};
