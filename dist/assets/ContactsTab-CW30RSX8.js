import{y as A}from"./components-DM0tY7ch.js";import{u as k}from"./UnifiedAddForm-Dcy87xel.js";import{u as x}from"./opportunities-DEbYZ9Ha.js";import{u as D}from"./useCustomersTable-B1c5U_ml.js";import{r as n,c as N,m as S,d as T,o as U,s as h,D as B,e as r,y as i}from"./index-H5Cqf6fX.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-1_jAZFgo.js";import"./contacts-Dm10rkvw.js";const I={class:"table-wrapper w-full"},G={__name:"ContactsTab",emits:["row-click"],setup(L,{emit:y}){const a=k(),s=x(),c=n("all"),p=n({pageIndex:0,pageSize:10}),u=n(""),m=n([]),d=n([]),v=e=>{if(!e)return"N/A";const t=e.split(",");return t.length>1&&t[t.length-1].trim().replace(/^\d+\s*/,"").trim()||e},l=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",g=N(()=>{let e=a.customers;return c.value==="contacts"?e=a.contacts:c.value==="accounts"&&(e=a.accounts),e.map(t=>({id:`customer-${t.id}`,stageKey:"contacts",customer:t.name,accountType:t.company&&t.company!==""?"Account":"Contact",telephone:t.phone,location:v(t.address),createdAt:l(t.createdAt),name:t.name,accountOwner:t.source||"N/A",updatedAt:l(t.lastContact||t.createdAt),lastActivity:l(t.lastContact),openOpportunities:s.opportunities.filter(o=>o.customerId===t.id&&o.stage!=="Closed Won"&&o.stage!=="Closed Lost").length,wonOpportunities:s.opportunities.filter(o=>o.customerId===t.id&&o.stage==="Closed Won").length,initials:t.initials||t.name.slice(0,2).toUpperCase(),type:t.company&&t.company!==""?"account":"contact",customerId:t.id}))}),C=y,f=e=>{e.stageKey==="contacts"&&C("row-click",e)},w=n("contacts"),{columns:b,filterDefinitions:F,tableMeta:O}=D(w,f);return S(async()=>{await a.fetchCustomers(),await s.fetchOpportunities()}),(e,t)=>(U(),T("div",I,[h(i(A),{data:g.value,columns:i(b),meta:i(O),onRowClick:f,columnFiltersOptions:{filterDefs:i(F)},pagination:p.value,"onUpdate:pagination":t[0]||(t[0]=o=>p.value=o),globalFilter:u.value,"onUpdate:globalFilter":t[1]||(t[1]=o=>u.value=o),sorting:m.value,"onUpdate:sorting":t[2]||(t[2]=o=>m.value=o),columnFilters:d.value,"onUpdate:columnFilters":t[3]||(t[3]=o=>d.value=o),paginationOptions:{rowCount:g.value.length},globalFilterOptions:{debounce:300}},{"empty-state":B(()=>[...t[4]||(t[4]=[r("div",{class:"empty-state"},[r("i",{class:"fa-solid fa-inbox empty-state-icon"}),r("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{G as default};
