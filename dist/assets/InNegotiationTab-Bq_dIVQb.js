import{y as X}from"./components-D1kWShum.js";import{n as I}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-3RNqBGno.js";import{u as Y,U as Z}from"./useDataTableData-D7InczSP.js";import{u as ee}from"./opportunities-D_EVVSI9.js";import{g as te,c as se,f as ae}from"./OfferCarousel-YtLzEMp2.js";import{u as oe}from"./useCustomersTable-DJeOs6IQ.js";import{I as ne,r as l,c as d,W as ie,m as le,d as B,o as R,e as o,s as m,B as p,g as re,y as n,t as ue,k as $,G as ce}from"./index-D-GV69Dn.js";import{u as de}from"./useTableRowSelection-BPyRhPA4.js";import"./sparkles-DqOgHrLF.js";import"./vehicles-CLPlMvEC.js";const me={class:"mb-8"},pe={class:"bg-white"},ge={class:"mb-4"},fe={class:"data-table-inner table-search-wrapper"},ve={key:0,class:"flex items-center gap-2"},be={class:"flex items-center gap-2 mr-1"},ye={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},xe={__name:"InNegotiationTab",emits:["row-click"],setup(De,{emit:q}){const g=ee(),{rowSelection:f,selectedCount:G,hasSelection:V,getSelectedRows:_,clearSelection:b}=de(e=>e.id),z=q,i=l({pageIndex:0,pageSize:10}),r=l(""),u=l([]),v=l([]),y=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",x=d(()=>g.opportunities.filter(e=>e.stage==="In Negotiation").map(e=>{var s,a,S,k,C,h,F,O,N,U,T,A;const t=((s=e.scheduledAppointment)==null?void 0:s.start)||null;return{id:`opp-${e.id}`,stageKey:"in-negotiation",customer:((a=e.customer)==null?void 0:a.name)||"Unknown",email:((S=e.customer)==null?void 0:S.email)||"",initials:((k=e.customer)==null?void 0:k.initials)||((h=(C=e.customer)==null?void 0:C.name)==null?void 0:h.slice(0,2).toUpperCase())||"?",nextAction:ae(e.expectedCloseDate)||"No due date",nextActionFull:se(e.expectedCloseDate),deadlineStatus:te(e.expectedCloseDate),car:`${((F=e.vehicle)==null?void 0:F.brand)||""} ${((O=e.vehicle)==null?void 0:O.model)||""}`.trim()||"N/A",carStatus:((N=e.vehicle)==null?void 0:N.stockDays)!==void 0&&((U=e.vehicle)==null?void 0:U.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((T=e.vehicle)==null?void 0:T.stockDays)!==void 0&&((A=e.vehicle)==null?void 0:A.stockDays)!==null?"bg-green-100 text-green-700":"bg-muted text-muted-foreground",requestType:e.requestType||"Opportunity",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:y(e.createdAt),lastAppointment:t?y(t):"N/A",status:ie(e,"opportunity"),statusClass:"bg-yellow-100 text-yellow-700",priority:e.priority||"Normal"}})),D=e=>{e.id.startsWith("opp-")&&z("row-click",e)},M=l("in-negotiation"),{columns:w,filterDefinitions:c,tableMeta:E}=oe(M,D),{paginatedData:Q,sortedData:W,totalFilteredCount:j}=Y({rawData:x,columns:w,globalFilter:r,columnFilters:u,sorting:v,pagination:i,filterDefs:c,searchableFields:e=>[e.customer,e.email,e.status,e.car,e.source,e.assignee]}),K=d(()=>[...new Set(x.value.map(t=>t.assignee).filter(Boolean))].map(t=>({value:t,label:t}))),L=[{value:"Test Drive",label:"Test Drive"},{value:"Quotation",label:"Quotation"},{value:"Generic sales",label:"Generic sales"}],H=d(()=>{var t,s;const e=(t=c.value)==null?void 0:t.find(a=>a.key==="status");return((s=e==null?void 0:e.options)==null?void 0:s.map(a=>({value:a.value,label:a.label})))??[]}),J=d(()=>{var t,s;const e=(t=c.value)==null?void 0:t.find(a=>a.key==="source");return((s=e==null?void 0:e.options)==null?void 0:s.map(a=>({value:a.value,label:a.label})))??[]}),P=()=>{const e=_(W.value);e.length!==0&&confirm(`Are you sure you want to delete ${e.length} ${e.length===1?"opportunity":"opportunities"}?`)&&(e.forEach(t=>{const s=t.id.replace("opp-","");g.deleteOpportunity(s)}),b())};return le(async()=>{await g.fetchOpportunities()}),(e,t)=>(R(),B("div",me,[o("div",pe,[o("div",ge,[m(Z,{"active-tab":"opportunities",placeholder:"Search in negotiation...",pagination:i.value,"assignee-options":K.value,"request-type-options":L,"status-options":H.value,"source-options":J.value,"onUpdate:globalFilter":t[0]||(t[0]=s=>r.value=s),"onUpdate:columnFilters":t[1]||(t[1]=s=>u.value=s),"onUpdate:pagination":t[2]||(t[2]=s=>i.value=s)},null,8,["pagination","assignee-options","status-options","source-options"])]),o("div",fe,[m(n(X),{data:n(Q),columns:n(w),meta:n(E),onRowClick:D,columnFiltersOptions:{filterDefs:n(c)},pagination:i.value,"onUpdate:pagination":t[3]||(t[3]=s=>i.value=s),globalFilter:r.value,"onUpdate:globalFilter":t[4]||(t[4]=s=>r.value=s),sorting:v.value,"onUpdate:sorting":t[5]||(t[5]=s=>v.value=s),columnFilters:u.value,"onUpdate:columnFilters":t[6]||(t[6]=s=>u.value=s),rowSelection:n(f),"onUpdate:rowSelection":t[7]||(t[7]=s=>ce(f)?f.value=s:null),paginationOptions:{rowCount:n(j)},globalFilterOptions:{debounce:300,show:!0},class:"h-full"},{"empty-state":p(()=>[...t[8]||(t[8]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),"batch-action-bar":p(()=>[n(V)?(R(),B("div",ve,[o("div",be,[o("div",ye,ue(n(G)),1),t[9]||(t[9]=o("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),t[12]||(t[12]=o("div",{class:"h-4 w-px bg-greys-700"},null,-1)),m(n(I),{variant:"ghost",size:"sm",onClick:P},{default:p(()=>[...t[10]||(t[10]=[o("i",{class:"fa-solid fa-trash mr-2"},null,-1),$(" Delete ",-1)])]),_:1}),m(n(I),{variant:"ghost",size:"sm",onClick:n(b)},{default:p(()=>[...t[11]||(t[11]=[o("i",{class:"fa-solid fa-x mr-2"},null,-1),$(" Close ",-1)])]),_:1},8,["onClick"])])):re("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","rowSelection","paginationOptions"])])])]))}},Ae=ne(xe,[["__scopeId","data-v-ddb57d69"]]);export{Ae as default};
