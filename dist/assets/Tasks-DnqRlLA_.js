import{H as ve,I as he,c as L,r as O,J as qe,d as k,o as v,e as r,p as fe,g as F,n as Q,t as U,w as ge,F as X,i as Z,s as R,B as H,T as Te,l as ce,y as $,K as lt,x as ee,L as ae,M as be,C as Oe,N as A,S as Be,k as de,G as ot,u as Ue,O as rt,m as it,j as ut,h as ct,P as dt,Q as pt,R as Ae}from"./index-BrrG4Zms.js";import{u as Re}from"./opportunities-BPg57aoi.js";import{u as He}from"./users-OdWvBllN.js";import{n as le,z as De}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js";import{g as me,f as Me,a as ft,b as gt,C as Ve,c as ze,d as We,e as mt}from"./OfferCarousel-BgF_S9jC.js";import{g as yt,_ as vt,u as ht,a as Le,T as Ne,D as bt}from"./useTaskFilters-BowFMc_j.js";import{y as xt}from"./components-_fvbk5Dq.js";import{u as wt}from"./useTableRowSelection-Jz-9OHJe.js";import{_ as kt}from"./ReassignUserModal-DCLjOtM0.js";import"./sparkles-CqcWxD2C.js";import"./vehicles-CI37T_a6.js";import"./CreateEventModal-CoiF22IC.js";import"./EditEventModal-KIC--F4z.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ve("CircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ve("FlameIcon",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ve("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=ve("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),Ct={class:"absolute top-4 right-4 flex items-center gap-2 z-10"},$t=["onClick"],St={class:"flex flex-col min-w-0 flex-1 pr-4"},It={class:"flex items-center gap-1 mb-0.5"},Tt={key:0,class:"font-bold text-foreground text-base truncate"},At={class:"flex items-center gap-2 overflow-hidden"},Dt={class:"text-muted-foreground text-sm truncate"},Mt={class:"mt-2"},Lt={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:x}){const s=t,S=L(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),a=L(()=>s.selected),d=L(()=>a.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),y=L(()=>{var c;return a.value?((c=s.item)==null?void 0:c.type)==="opportunity"?"task-card-selected task-card-selected-opportunity":"task-card-selected":""}),p=L(()=>yt(s.item)),g=L(()=>{const c=s.item.nextActionDue||s.item.dueDate;if(!c)return null;const b=me(c);return{text:Me(c),status:b}}),m=L(()=>{if(s.item.type!=="opportunity"||!s.item.expectedCloseDate)return null;const c=s.item.expectedCloseDate,b=me(c);return{text:Me(c),status:b}}),i=L(()=>s.item.type==="opportunity"&&m.value?m.value:g.value);L(()=>g.value?g.value.status.textClass.replace("text-","bg-"):""),L(()=>i.value?i.value.status.textClass.replace("text-","bg-"):"");const l=O(null);return(c,b)=>{const C=qe("click-outside");return v(),k("div",{ref_key:"cardRef",ref:l,class:Q(["task-card bg-white rounded-xl p-4 flex items-center justify-between cursor-pointer relative transition-all border group",[d.value,y.value]]),onClick:b[2]||(b[2]=N=>c.$emit("select",S.value))},[r("div",Ct,[i.value?(v(),k("span",{key:0,class:Q(["text-xs font-bold uppercase leading-none shrink-0",i.value.status.textClass])},U(i.value.text),3)):F("",!0),t.showMenu?(v(),k("button",{key:1,onClick:b[0]||(b[0]=ge(N=>c.$emit("menu-click",t.item.id),["stop"])),class:"text-gray-300 hover:text-gray-600"},[...b[3]||(b[3]=[r("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):F("",!0)]),t.openMenuId===t.item.id&&t.showMenu?fe((v(),k("div",{key:0,class:"absolute right-4 top-10 z-50 w-40 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:b[1]||(b[1]=ge(()=>{},["stop"]))},[(v(!0),k(X,null,Z(t.menuItems,N=>(v(),k("button",{key:N.key,onClick:N.onClick,class:"w-full px-3 py-2 text-left text-xs text-foreground hover:bg-muted flex items-center gap-2"},U(N.label),9,$t))),128))])),[[C,()=>c.$emit("menu-close")]]):F("",!0),r("div",St,[r("div",It,[p.value?(v(),k("h3",Tt,U(p.value),1)):F("",!0)]),r("div",At,[r("span",Dt,U(t.getName(t.item)),1)]),r("div",Mt,[R(vt,{task:t.item},null,8,["task"])])])],2)}}},Nt=he(Lt,[["__scopeId","data-v-4c09f0c4"]]),Ft={key:0,class:"flex flex-col gap-2"},qt={class:"flex items-center gap-1.5 flex-wrap"},Ot={class:"relative",ref:"filterContainer"},Bt={key:0,class:"filter-indicator"},Ut=["onClick"],Rt=["onClick"],Ht={key:0,class:"flex items-center gap-1.5 flex-wrap"},Vt=["onClick"],zt={key:0,class:"task-filter-badge"},Wt={key:1,class:"relative",ref:"filterContainer"},jt={key:0,class:"filter-indicator"},Et=["onClick"],Pt=["onClick"],Qt={key:2,class:"flex items-center gap-1.5 flex-wrap"},Kt=["onClick"],Yt={key:0,class:"task-filter-badge"},Fe={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:""},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:x}){const s=t,S=x,a=O(!1),d=()=>{a.value=!a.value},y=()=>{a.value=!1},p=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],g=M=>{const w=p.find(z=>z.key===M);return w?w.label:M},m=M=>{a.value=!1;const w=[...s.activeFilters],z=w.indexOf(M);z>-1?w.splice(z,1):w.push(M),S("filter-change",w)},i=M=>{const w=[...s.activeFilters],z=w.indexOf(M);z>-1&&(w.splice(z,1),S("filter-change",w))},l=M=>{a.value=!1,S("sort-change",M)},c=()=>{S("sort-change","")},b=L(()=>{const M=s.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First"},...M?[{key:"urgent-first",label:"Urgent first"}]:[],{key:"assigned-to-me",label:"Assigned to me"},{key:"assigned-to-my-team",label:"Assigned to my team"}]}),C=L(()=>s.sortOption&&s.sortOption!==""&&s.sortOption!=="none"),N=L(()=>{const M=b.value.find(w=>w.key===s.sortOption);return M?M.label:s.sortOption});return(M,w)=>{const z=qe("click-outside");return!t.buttonOnly&&!t.chipsOnly?(v(),k("div",Ft,[r("div",qt,[fe((v(),k("div",Ot,[r("button",{onClick:d,class:"filter-dropdown-button"},[w[2]||(w[2]=r("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.activeFilters.length>0||t.sortOption?(v(),k("span",Bt)):F("",!0)]),R(Te,{name:"dropdown-fade"},{default:H(()=>[a.value?(v(),k("div",{key:0,class:"absolute left-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:w[0]||(w[0]=ge(()=>{},["stop"]))},[(v(),k(X,null,Z(p,I=>r("button",{key:I.key,onClick:Y=>m(I.key),class:Q(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted filter-item-selected":t.activeFilters.includes(I.key)}])},[r("span",null,U(I.label),1)],10,Ut)),64)),w[3]||(w[3]=r("div",{class:"border-t border-black/10 my-1"},null,-1)),(v(!0),k(X,null,Z(b.value,I=>(v(),k("button",{key:I.key,onClick:Y=>l(I.key),class:Q(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted sort-item-selected":I.key===t.sortOption}])},[r("span",null,U(I.label),1)],10,Rt))),128))])):F("",!0)]),_:1})])),[[z,y]]),t.activeFilters.length>0||C.value?(v(),k("div",Ht,[(v(!0),k(X,null,Z(t.activeFilters,I=>(v(),k("div",{key:I,class:"task-filter-badge"},[r("span",null,U(g(I)),1),r("button",{onClick:Y=>i(I),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...w[4]||(w[4]=[r("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Vt)]))),128)),C.value?(v(),k("div",zt,[r("span",null,U(N.value),1),r("button",{onClick:c,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...w[5]||(w[5]=[r("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)])])):t.buttonOnly?fe((v(),k("div",Wt,[r("button",{onClick:d,class:"filter-dropdown-button"},[w[6]||(w[6]=r("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.activeFilters.length>0||t.sortOption?(v(),k("span",jt)):F("",!0)]),R(Te,{name:"dropdown-fade"},{default:H(()=>[a.value?(v(),k("div",{key:0,class:"absolute right-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-nsc-card py-1",onClick:w[1]||(w[1]=ge(()=>{},["stop"]))},[(v(),k(X,null,Z(p,I=>r("button",{key:I.key,onClick:Y=>m(I.key),class:Q(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted filter-item-selected":t.activeFilters.includes(I.key)}])},[r("span",null,U(I.label),1)],10,Et)),64)),w[7]||(w[7]=r("div",{class:"border-t border-black/10 my-1"},null,-1)),(v(!0),k(X,null,Z(b.value,I=>(v(),k("button",{key:I.key,onClick:Y=>l(I.key),class:Q(["w-full px-4 py-2 text-left text-sm text-foreground hover:bg-muted flex items-center gap-2 relative",{"bg-muted sort-item-selected":I.key===t.sortOption}])},[r("span",null,U(I.label),1)],10,Pt))),128))])):F("",!0)]),_:1})])),[[z,y]]):t.chipsOnly&&(t.activeFilters.length>0||C.value)?(v(),k("div",Qt,[(v(!0),k(X,null,Z(t.activeFilters,I=>(v(),k("div",{key:I,class:"task-filter-badge"},[r("span",null,U(g(I)),1),r("button",{onClick:Y=>i(I),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...w[8]||(w[8]=[r("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Kt)]))),128)),C.value?(v(),k("div",Yt,[r("span",null,U(N.value),1),r("button",{onClick:c,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...w[9]||(w[9]=[r("i",{class:"fa-solid fa-xmark"},null,-1)])])])):F("",!0)])):F("",!0)}}},Gt={class:"tasks-list-container border-r border-border flex flex-col shrink-0 w-full lg:w-80 h-full"},Jt={class:"page-header shrink-0"},Xt={class:"page-header-main"},Zt={class:"page-header-content"},_t={class:"page-header-title-container"},es={class:"page-header-title"},ts={class:"page-header-actions"},ss={class:"bg-white border border-border p-0.5 rounded-btn inline-flex gap-0.5"},ns={class:"px-5 py-3"},as={class:"flex items-center gap-2"},ls={class:"relative flex-1"},os=["placeholder"],rs={key:0,class:"mt-2"},is={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:t=>t.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:x}){const s=t,S=x,a=O(s.initialSearchQuery),d=O(null),y=O(""),p=L(()=>typeof s.title=="string"?s.title:typeof s.title=="function"?(console.warn("TasksList: title prop received a function instead of a string. Using default title."),"Tasks"):s.title||"Tasks");ce(()=>s.initialSearchQuery,l=>{a.value=l});const g=L(()=>{let l=s.items;const c=s.activeFilters.filter(C=>C==="lead"||C==="opportunity");if(c.length>0&&(l=l.filter(C=>!!(C.type&&c.includes(C.type)))),!a.value.trim())return l;const b=a.value.toLowerCase().trim();return l.filter(C=>{const N=s.getName(C).toLowerCase(),M=s.getVehicleInfo(C).toLowerCase();return N.includes(b)||M.includes(b)})}),m=l=>{if(!s.selectedId)return!1;const c=l.compositeId||`${l.type||"task"}-${l.id}`;return String(c)===String(s.selectedId)},i=l=>{y.value=l,S("sort-change",l)};return(l,c)=>(v(),k("div",Gt,[r("header",Jt,[r("div",Xt,[r("div",Zt,[r("div",_t,[r("h1",es,U(p.value),1)]),r("div",ts,[r("div",ss,[R($(le),{variant:"secondary",size:"icon",onClick:c[0]||(c[0]=b=>l.$emit("view-change","card")),class:Q(["h-7 w-7",t.viewMode==="card"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Card View","aria-pressed":t.viewMode==="card"},{default:H(()=>[R($(Ee),{size:14})]),_:1},8,["class","aria-pressed"]),R($(le),{variant:"secondary",size:"icon",onClick:c[1]||(c[1]=b=>l.$emit("view-change","table")),class:Q(["h-7 w-7",t.viewMode==="table"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Table View","aria-pressed":t.viewMode==="table"},{default:H(()=>[R($(Pe),{size:14})]),_:1},8,["class","aria-pressed"])])])])])]),r("div",ns,[r("div",as,[r("div",ls,[c[8]||(c[8]=r("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-muted-foreground text-sm"},null,-1)),fe(r("input",{"onUpdate:modelValue":c[2]||(c[2]=b=>a.value=b),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-white border border-border rounded-btn pl-9 pr-3 py-2 text-sm"},null,8,os),[[lt,a.value]])]),R(Fe,{"active-filters":t.activeFilters,"sort-option":y.value,"button-only":!0,onFilterChange:c[3]||(c[3]=b=>l.$emit("filter-change",b)),onSortChange:i},null,8,["active-filters","sort-option"])]),t.activeFilters.length>0?(v(),k("div",rs,[R(Fe,{"active-filters":t.activeFilters,"sort-option":y.value,"chips-only":!0,onFilterChange:c[4]||(c[4]=b=>l.$emit("filter-change",b)),onSortChange:i},null,8,["active-filters","sort-option"])])):F("",!0)]),r("div",{ref_key:"scrollContainer",ref:d,class:"task-list-cards flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(v(!0),k(X,null,Z(g.value,b=>(v(),ee(Nt,{key:b.compositeId||`${b.type||"task"}-${b.id}`,item:b,selected:m(b),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(b):null,onSelect:c[5]||(c[5]=C=>l.$emit("select",C)),onMenuClick:c[6]||(c[6]=C=>l.$emit("menu-click",C)),onMenuClose:c[7]||(c[7]=C=>l.$emit("menu-close"))},{location:H(({item:C})=>[ae(l.$slots,"location",{item:C},void 0,!0)]),source:H(({item:C})=>[ae(l.$slots,"source",{item:C},void 0,!0)]),owner:H(({item:C})=>[ae(l.$slots,"owner",{item:C},void 0,!0)]),dates:H(({item:C})=>[ae(l.$slots,"dates",{item:C},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},us=he(is,[["__scopeId","data-v-d0497207"]]);function Qe(t,x=[],s,S){const a=be(),d=a.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},y=a.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},p=cs(t,x),g=ds(t,x),m=ps(t),i=fs(t),l=d.intent+d.behavioral+d.temporal,c={intent:d.intent/l*100,behavioral:d.behavioral/l*100,temporal:d.temporal/l*100},b=p/40*c.intent,C=g/35*c.behavioral,N=m/25*c.temporal,M=Math.min(100,Math.max(0,b+C+N+i));let w="COLD";return M>=y.hot?w="HOT":M>=y.warm?w="WARM":M>=y.standard&&(w="STANDARD"),{score:Math.round(M*10)/10,level:w,breakdown:{intent:Math.round(p*10)/10,behavioral:Math.round(g*10)/10,temporal:Math.round(m*10)/10,quality:Math.round(i*10)/10,total:Math.round(M*10)/10}}}function cs(t,x){var S;let s=0;return(t.requestType==="Test Drive"||((S=t.scheduledAppointment)==null?void 0:S.type)==="test-drive"||x.some(a=>a.type==="test-drive"||a.type==="appointment"))&&(s=Math.max(s,40)),x.some(a=>a.type==="financing")&&(s=Math.max(s,35)),x.some(a=>a.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||x.some(a=>{var d,y,p;return((d=a.content)==null?void 0:d.toLowerCase().includes("location"))||((y=a.content)==null?void 0:y.toLowerCase().includes("dealership"))||((p=a.content)==null?void 0:p.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||x.some(a=>{var d,y;return((d=a.content)==null?void 0:d.toLowerCase().includes("configur"))||a.type==="attachment"&&((y=a.fileName)==null?void 0:y.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),x.some(a=>{var y;const d=((y=a.content)==null?void 0:y.toLowerCase())||"";return d.includes("compare")||d.includes("versus")||d.includes("vs")||d.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function ds(t,x){let s=0;const S=new Set(x.map(p=>{if(!p.timestamp)return null;const g=new Date(p.timestamp);return`${g.getFullYear()}-${g.getMonth()}-${g.getDate()}`}).filter(Boolean)),a=Math.min(S.size*10,35);s+=a,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const d=x.reduce((p,g)=>{var m;return p+(((m=g.content)==null?void 0:m.length)||0)},0),y=Math.min(Math.floor(d/50),25);return s+=y,x.some(p=>{var g,m,i;return p.type==="attachment"&&(((g=p.fileName)==null?void 0:g.toLowerCase().includes("brochure"))||((m=p.fileName)==null?void 0:m.toLowerCase().includes("spec"))||((i=p.fileName)==null?void 0:i.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function ps(t){let x=0;if(!t.createdAt)return 0;const s=new Date,S=new Date(t.createdAt),a=(s.getTime()-S.getTime())/(1e3*60*60);a<2?x+=25:a<24?x+=15:a<48?x+=5:x-=10;const d=S.getDay(),y=S.getHours();if((d===0||d===6||y<9||y>17)&&(x+=10),t.contactAttempts&&t.contactAttempts.length===3&&(x+=50),t.lastActivity){const p=new Date(t.lastActivity);(s.getTime()-p.getTime())/(1e3*60*60*24)>3&&(x+=20)}return Math.min(Math.max(x,0),25)}function fs(t){var s,S,a,d,y,p,g;let x=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(x+=10),(S=t.customer)!=null&&S.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(x+=10),(a=t.customer)!=null&&a.name&&((d=t.customer)!=null&&d.email)&&((y=t.customer)!=null&&y.phone)&&((p=t.customer)!=null&&p.address)&&(x+=5),(t.isDuplicate||t.isDisqualified||!((g=t.customer)!=null&&g.name))&&(x-=20),x}const gs={HOT:"Flame",WARM:"Sun",STANDARD:"CheckCircle",COLD:"Circle"};function Ke(t){return gs[t]??"Circle"}function Ye(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function ms({typeFilter:t,showTypeFilter:x,tasks:s}){return{filterDefinitions:L(()=>{const a=[];x.value&&a.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),a.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"}],aiHint:"Lead status or opportunity stage",pinned:!0}),a.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&a.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),a.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const d=[...new Set(s.value.map(p=>p.assignee).filter(Boolean))];d.length>0&&a.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:d.map(p=>({value:p,label:p})),aiHint:"Person assigned to the task",pinned:!0});const y=[...new Set(s.value.map(p=>{const g=p.type==="lead"?p.requestedCar:p.vehicle;return g==null?void 0:g.brand}).filter(Boolean))];return y.length>0&&a.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:y.map(p=>({value:p,label:p})),aiHint:"Car brand requested by customer"}),a.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),a})}}const ys={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},vs={class:"page-header shrink-0"},hs={class:"page-header-main"},bs={class:"page-header-content"},xs={class:"page-header-actions"},ws={class:"bg-white border border-border p-0.5 rounded-btn inline-flex gap-0.5"},ks={class:"flex-1 overflow-y-auto p-4 md:p-8 bg-white"},Cs={key:0,class:"flex items-center gap-2"},$s={class:"flex items-center gap-2 mr-1"},Ss={class:"flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-blue-600 text-white text-xs font-medium"},Is={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","toggle-closed","reassign","close","view-change"],setup(t,{emit:x}){const s=t,S=x,a=be(),d=Oe(),y=Re();O("");const{rowSelection:p,selectedCount:g,hasSelection:m,getSelectedRows:i,clearSelection:l}=wt(o=>o.compositeId),c=O({pageIndex:0,pageSize:10}),b=O(""),C=O([]),N=O([]),M=O({}),{filterDefinitions:w}=ms({typeFilter:L(()=>"all"),showTypeFilter:L(()=>!0),tasks:L(()=>s.tasks)}),z=L(()=>s.tasks),I=o=>o.compositeId===s.currentTaskId||o.compositeId===s.highlightId,Y=o=>{if(o.type==="lead")return o.requestedCar?`${o.requestedCar.brand} ${o.requestedCar.model}`:"No vehicle specified";const e=o.vehicle||o.requestedCar;return e?`${e.brand} ${e.model}`:"No vehicle specified"},oe=o=>{if(!o)return"Not set";const e=new Date,u=new Date(o),V=new Date(e.getFullYear(),e.getMonth(),e.getDate()),E=new Date(u.getFullYear(),u.getMonth(),u.getDate())-V,W=Math.ceil(E/(1e3*60*60*24));return W===0?"Today":W===1?"Tomorrow":W===-1?"Yesterday":W>1&&W<=7?`In ${W} days`:W<-1&&W>=-7?`${Math.abs(W)} days ago`:ze(o)},P=o=>{const e=o.type==="lead"?o.requestedCar:o.vehicle;if(!e)return{status:"N/A",class:"bg-muted text-muted-foreground"};const u=e.stockDays!==void 0&&e.stockDays!==null;return{status:u?"In Stock":"Out of Stock",class:u?"bg-green-100 text-green-700":"bg-muted text-muted-foreground"}},te=o=>{var e;return o.type==="lead"?((e=o.requestedCar)==null?void 0:e.requestType)||o.requestType||"N/A":o.requestType||"Opportunity"},_=o=>{const e=o.type==="lead"?o.requestedCar:o.vehicle||o.requestedCar;return e==null?void 0:e.price},se=L(()=>[{id:"type",accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:o=>j(o.original)},cell:({row:o})=>{const e=o.original,u=e.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${u}`},e.type==="lead"?"Lead":"Opportunity")}},{id:"customer",accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:o})=>{const e=o.original;return A("div",{class:"flex items-center gap-2 md:gap-3"},[A("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${e.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},e.customer.initials),A("div",{class:"min-w-0"},[A("div",{class:"text-content font-semibold text-foreground truncate max-w-32 md:max-w-none"},e.customer.name),A("div",{class:"text-meta truncate hidden sm:block"},e.customer.phone||"N/A")])])}},{id:"carInfo",accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:o})=>{const e=o.original,u=Y(e),V=P(e),G=te(e),E=e.type==="lead"?e.requestedCar:e.vehicle||e.requestedCar;if(u==="No vehicle specified")return A("span",{class:"text-meta"},"N/A");const W=E!=null&&E.condition?E.condition.charAt(0).toUpperCase()+E.condition.slice(1).toLowerCase():null,re=E!=null&&E.kilometers?`${E.kilometers.toLocaleString()} km`:null,ie=e.quotationNumber||e.quotation||null,pe=G&&G!=="N/A"&&(G!=="Quotation"||ie);return A("div",{class:"flex flex-col gap-1"},[A("div",{class:"flex items-center gap-2"},[A("i",{class:"fa-brands fa-volkswagen text-muted-foreground text-sm"}),A("span",{class:"text-content font-medium text-foreground truncate max-w-32"},u)]),A("div",{class:"flex items-center gap-2 flex-wrap"},[A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${V.class}`},V.status),W&&A("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},W),re&&A("span",{class:"text-meta text-xs"},re),pe&&A("span",{class:"text-meta text-xs"},G)])])}},{id:"dueDate",accessorKey:"nextActionDue",header:"Due Date",meta:{title:"Due Date"},cell:({row:o})=>{const u=o.original.nextActionDue;if(!u)return A("span",{class:"text-meta"},"Not set");const V=me(u);return A("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${V.bgClass} ${V.textClass} ${V.borderClass}`},oe(u))}},{id:"price",accessorKey:"price",accessorFn:o=>_(o)??0,header:"Price",meta:{title:"Price"},cell:({row:o})=>{const e=o.original,u=_(e);return u==null||u===""?A("span",{class:"text-meta"},"â€”"):A("span",{class:"text-content font-medium text-foreground"},`â‚¬ ${ft(u)}`)}},{id:"source",accessorKey:"source",header:"Lead Source",meta:{title:"Lead Source"},cell:({row:o})=>{const e=o.original;return A("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-muted text-muted-foreground"},e.source||"N/A")}},{id:"contactAttempts",accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:o})=>{var V;const u=((V=o.original.contactAttempts)==null?void 0:V.length)||0;return A("span",{class:"text-content font-medium text-foreground"},u)}},{id:"assignee",accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:o})=>{const e=o.original,u=s.getOwnerInfo(e);return A("div",{class:"flex items-center gap-2"},[A("div",{class:"w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs font-bold text-muted-foreground shrink-0"},u.initials),A("span",{class:"text-meta truncate max-w-20"},u.name)])}},{id:"createdAt",accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:o})=>{const e=o.original;return e.createdAt?A("span",{class:"text-meta"},gt(e.createdAt)):A("span",{class:"text-meta"},"N/A")}},{id:"status",accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:o})=>{const e=o.original,u=e.type==="lead"?e.status:e.displayStage||e.stage,V=s.getStageBadgeClass(u);return A("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${V}`},u)}},...a.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:o})=>{const e=o.original;if(e.type!=="lead")return A("span",{class:"text-meta"},"â€”");let u=e.urgencyLevel;u||(u=Qe(e).level);const V=Ye(u),G=Ke(u),W={Flame:je,Sun:Be,CheckCircle:Ve,Circle:ye}[G]||ye;return A("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${V}`},[A(W,{class:"size-3 shrink-0"}),A("span",{},u)])}}]:[]]),j=o=>{b.value=String(o.id),S("select",o.compositeId)},K=()=>{const o=i(z.value);o.length!==0&&confirm(`Are you sure you want to delete ${o.length} ${o.length===1?"task":"tasks"}?`)&&(o.forEach(e=>{e.type==="lead"?d.deleteLead(e.id):y.deleteOpportunity(e.id)}),l())},xe=L(()=>({class:{tr:o=>{const e="cursor-pointer hover:bg-muted transition-colors",u=o.original;return I(u)?`${e} bg-blue-50 border-l-4 border-l-blue-500`:e}}}));return(o,e)=>(v(),k("div",ys,[r("header",vs,[r("div",hs,[r("div",bs,[e[10]||(e[10]=r("div",{class:"page-header-title-container"},[r("h1",{class:"page-header-title"},"Tasks")],-1)),r("div",xs,[r("div",ws,[R($(le),{variant:"secondary",size:"icon",onClick:e[0]||(e[0]=u=>o.$emit("view-change","card")),class:Q(["h-7 w-7",t.viewMode==="card"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Card View","aria-pressed":t.viewMode==="card"},{default:H(()=>[R($(Ee),{size:14})]),_:1},8,["class","aria-pressed"]),R($(le),{variant:"secondary",size:"icon",onClick:e[1]||(e[1]=u=>o.$emit("view-change","table")),class:Q(["h-7 w-7",t.viewMode==="table"?"bg-brand-gray text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),title:"Table View","aria-pressed":t.viewMode==="table"},{default:H(()=>[R($(Pe),{size:14})]),_:1},8,["class","aria-pressed"])]),r("button",{onClick:e[2]||(e[2]=u=>o.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-xl border border-border px-3 py-1.5 bg-surface text-sm font-medium text-muted-foreground hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...e[9]||(e[9]=[r("i",{class:"fa-solid fa-eye-slash text-muted-foreground group-hover:text-brand-red"},null,-1),r("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),r("div",ks,[R($(xt),{data:z.value,columns:se.value,meta:xe.value,onRowClick:j,columnFiltersOptions:{filterDefs:$(w)},pagination:c.value,"onUpdate:pagination":e[3]||(e[3]=u=>c.value=u),globalFilter:b.value,"onUpdate:globalFilter":e[4]||(e[4]=u=>b.value=u),sorting:C.value,"onUpdate:sorting":e[5]||(e[5]=u=>C.value=u),columnFilters:N.value,"onUpdate:columnFilters":e[6]||(e[6]=u=>N.value=u),columnVisibility:M.value,"onUpdate:columnVisibility":e[7]||(e[7]=u=>M.value=u),rowSelection:$(p),"onUpdate:rowSelection":e[8]||(e[8]=u=>ot(p)?p.value=u:null),paginationOptions:{rowCount:z.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!0},class:"h-full"},{"empty-state":H(()=>[...e[11]||(e[11]=[r("div",{class:"empty-state"},[r("i",{class:"fa-solid fa-tasks empty-state-icon"}),r("p",{class:"empty-state-text"},"No tasks found")],-1)])]),"batch-action-bar":H(()=>[$(m)?(v(),k("div",Cs,[r("div",$s,[r("div",Ss,U($(g)),1),e[12]||(e[12]=r("span",{class:"text-white text-fluid-sm font-medium whitespace-nowrap"},"Items selected",-1))]),e[15]||(e[15]=r("div",{class:"h-4 w-px bg-greys-700"},null,-1)),R($(le),{variant:"ghost",size:"sm",onClick:K},{default:H(()=>[...e[13]||(e[13]=[r("i",{class:"fa-solid fa-trash mr-2"},null,-1),de(" Delete ",-1)])]),_:1}),R($(le),{variant:"ghost",size:"sm",onClick:$(l)},{default:H(()=>[...e[14]||(e[14]=[r("i",{class:"fa-solid fa-x mr-2"},null,-1),de(" Close ",-1)])]),_:1},8,["onClick"])])):F("",!0)]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","columnVisibility","rowSelection","paginationOptions"])])]))}},Ts=he(Is,[["__scopeId","data-v-2203393a"]]),As={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},Ds={class:"px-4 py-3 flex items-center justify-between gap-3"},Ms=["aria-label"],Ls={key:0,class:"flex-1 flex items-center justify-center"},Ns={key:1,class:"flex items-center gap-2"},Fs={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:x}){const s=x,S=()=>{s("back")};return(a,d)=>t.show?(v(),k("div",As,[r("div",Ds,[r("button",{onClick:S,class:"w-11 h-11 flex items-center justify-center text-muted-foreground hover:text-foreground hover:bg-muted rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...d[0]||(d[0]=[r("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Ms),a.$slots.title?(v(),k("div",Ls,[ae(a.$slots,"title")])):F("",!0),a.$slots.actions?(v(),k("div",Ns,[ae(a.$slots,"actions")])):F("",!0)])])):F("",!0)}};function qs(){const t=i=>{if(!i)return"No deadline";const l=me(i);return l.type==="overdue"?"OVERDUE":l.type==="today"||l.type==="urgent"?l.relativeTime:ze(i)},x=i=>{const l=i.type==="lead"?i.requestedCar:i.vehicle;return!l||!l.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[l.type]||{type:l.type.toLowerCase(),label:l.type}},s=i=>i?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[i.type]||"bg-gray-50 text-gray-700":"",S=i=>{if(!i||!i.assignee)return{name:"Unassigned",initials:"?"};const l=i.assigneeInitials||i.assignee.split(" ").map(c=>c[0]).join("");return{name:i.assignee,initials:l}},a=i=>{if(!i||!i.customer||!i.customer.address)return null;const c=i.customer.address.split(",");return c.length>1&&c[c.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:x,getVehicleTypeBadgeClass:s,getOwnerInfo:S,getCustomerCity:a,getLocationDisplay:i=>{const l=a(i),c=i.source||"Unknown";return l?`${l} â€¢ ${c}`:c},getAssigneeInitials:i=>{if(!i)return"?";const l=i.split(" ");return l.length>=2?(l[0][0]+l[l.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()},getVehicleStatusDisplay:i=>{const l=i.type==="lead"?i.requestedCar:i.vehicle;if(!l)return"No vehicle";const c=x(i),b=c?c.label:l.type||"Unknown";let C="";return l.kilometers!==void 0&&l.kilometers!==null&&(l.kilometers>=1e3?C=`${(l.kilometers/1e3).toFixed(0)}k`:C=`${l.kilometers}`),C?`${b} / ${C}`:b},getTaskStatusDisplay:i=>i.type==="lead"?i.status||"Unknown":i.stage||"Unknown",getStageBadgeClass:We,getUnselectedClass:i=>i.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Os(){const t=Ue(),x=He(),s=be();return{sortTasks:(a,d)=>{if(!d||d===""||d==="none")return a;if(d==="recent-first")return[...a].sort((y,p)=>{const g=new Date(y.lastActivity||y.createdAt||0);return new Date(p.lastActivity||p.createdAt||0)-g});if(d==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...a.map(g=>{if(g.type==="lead"&&!g.urgencyScore){const m=Qe(g);return{...g,urgencyScore:m.score,urgencyLevel:m.level}}return g})].sort((g,m)=>{if(g.type==="lead"&&m.type==="lead"){const c=g.urgencyScore||0,b=m.urgencyScore||0;if(c!==b)return b-c;const C=new Date(g.createdAt||0);return new Date(m.createdAt||0)-C}if(g.type==="lead"&&m.type==="opportunity")return-1;if(g.type==="opportunity"&&m.type==="lead")return 1;if(g.priority==="Hot"&&m.priority!=="Hot")return-1;if(g.priority!=="Hot"&&m.priority==="Hot")return 1;const i=new Date(g.lastActivity||g.createdAt||0);return new Date(m.lastActivity||m.createdAt||0)-i}):[...a].sort((p,g)=>{if(p.priority==="Hot"&&g.priority!=="Hot")return-1;if(p.priority!=="Hot"&&g.priority==="Hot")return 1;const m=new Date(p.lastActivity||p.createdAt||0);return new Date(g.lastActivity||g.createdAt||0)-m});if(d==="assigned-to-me"){const y=t.currentUser.name;return[...a.filter(g=>g.assignee===y)].sort((g,m)=>{const i=new Date(g.lastActivity||g.createdAt||0);return new Date(m.lastActivity||m.createdAt||0)-i})}if(d==="assigned-to-my-team"){const y=t.currentUser;let p=[];return y.role==="manager"?p=x.users.map(m=>m.name):y.role==="salesman"?p=x.users.filter(m=>m.role==="salesman").map(m=>m.name):y.role==="operator"&&(p=x.users.filter(m=>m.role==="operator").map(m=>m.name)),[...a.filter(m=>p.includes(m.assignee))].sort((m,i)=>{const l=new Date(m.lastActivity||m.createdAt||0);return new Date(i.lastActivity||i.createdAt||0)-l})}return a}}}const Bs={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Us={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Rs={key:0,class:"flex items-center gap-2"},Hs={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Vs={class:"text-gray-600 font-medium"},zs={key:1},Ws={key:0},js={key:1},Es={key:2},Ps={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Qs={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Ks={__name:"Tasks",setup(t){const x={Flame:je,Sun:Be,CheckCircle:Ve,Circle:ye};function s(n){return x[Ke(n)]||ye}const S=rt(),a=ct(),d=Oe(),y=Re();Ue(),He();const p=be(),{getDateDisplay:g,getVehicleType:m,getVehicleTypeBadgeClass:i,getOwnerInfo:l,getCustomerCity:c,getAssigneeInitials:b,getUnselectedClass:C}=qs(),N=O(localStorage.getItem("tasksViewMode")||"table"),M=O(""),w=L(()=>S.query.highlight||null);ce(N,n=>{localStorage.setItem("tasksViewMode",n)});const z=(n,h="")=>{N.value;const T=u.value;if(N.value=n,n==="card"&&h&&(M.value=h),n==="table"&&T)M.value="",a.push({path:"/tasks",query:{highlight:T.compositeId}});else if(n==="card"&&w.value){const[B,f]=w.value.split("-");a.push({path:`/tasks/${f}`,query:{type:B}})}else n==="card"&&!w.value&&!u.value&&a.push({path:"/tasks"})},I=O([]),Y=O(""),oe=O(!1),P=O(null);O(!1);const te=O(!1),_=O(null),se=O(!1),j=O(null),{allTasks:K,applyFilters:xe}=ht(oe),{sortTasks:o}=Os(),e=L(()=>{let n=xe(K.value,I.value);return n=o(n,Y.value),n}),u=L(()=>{if(!S.params.id)return null;const n=parseInt(S.params.id);if(isNaN(n))return null;const h=S.query.type;if(h){const q=`${h}-${n}`;return K.value.find(ue=>ue.compositeId===q)||null}const T=I.value.filter(q=>q==="lead"||q==="opportunity"),B=T.length>0?K.value.filter(q=>T.includes(q.type)):K.value,f=`lead-${n}`,D=`opportunity-${n}`,J=B.find(q=>q.compositeId===f||q.compositeId===D);return J||K.value.find(q=>q.compositeId===f||q.compositeId===D)||null});L(()=>u.value?u.value.type==="lead"?d.currentLeadActivities:y.currentOpportunityActivities:[]);const V=Le(u),G=V.managementWidget,E=V.storeAdapter,W=V.addNewConfig,re=L(()=>j.value),ie=Le(re),pe=L(()=>ie.managementWidget.value),Ce=L(()=>ie.storeAdapter.value),$e=L(()=>ie.addNewConfig.value),Ge=C;it(()=>{d.fetchLeads(),y.fetchOpportunities();const n=S.params.id;n&&Se(n)}),ce(()=>S.params.id,n=>{n&&Se(n)}),ce(u,n=>{n&&(n.type==="lead"?d.fetchLeadById(n.id):y.fetchOpportunityById(n.id))},{immediate:!0}),ce(j,n=>{n&&(n.type==="lead"?d.fetchLeadById(n.id):y.fetchOpportunityById(n.id))},{immediate:!0});const Se=n=>{const h=parseInt(n),T=K.value.find(B=>B.id===h);T&&(T.type==="lead"?d.fetchLeadById(h):y.fetchOpportunityById(h))},ne=n=>{const[h,T]=n.split("-");if(N.value==="table"){const B=K.value.find(f=>f.compositeId===n);B&&(j.value=B,se.value=!0,B.type==="lead"?d.fetchLeadById(B.id):y.fetchOpportunityById(B.id));return}N.value="card",a.push({path:`/tasks/${T}`,query:{type:h}})},we=()=>{if(se.value){ke();return}a.push({path:"/tasks"})},ke=()=>{pt(()=>{se.value=!1,j.value=null})},Je=n=>{if(!u.value)return;const h=e.value.findIndex(T=>{const B=u.value.compositeId||`${u.value.type}-${u.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===B});if(h!==-1){if(n==="previous"&&h>0){const T=e.value[h-1];ne(T.compositeId)}else if(n==="next"&&h<e.value.length-1){const T=e.value[h+1];ne(T.compositeId)}}},Xe=n=>{if(!j.value)return;const h=e.value.findIndex(T=>{const B=j.value.compositeId||`${j.value.type}-${j.value.id}`;return(T.compositeId||`${T.type}-${T.id}`)===B});if(h!==-1){if(n==="previous"&&h>0){const T=e.value[h-1];ne(T.compositeId)}else if(n==="next"&&h<e.value.length-1){const T=e.value[h+1];ne(T.compositeId)}}},Ie=n=>{P.value=P.value===n?null:n},Ze=n=>{_.value=n,te.value=!0,P.value=null},_e=n=>{Y.value=n},et=async n=>{if(!_.value)return;const h=_.value,T=n.name;h.type==="lead"?await d.updateLead(h.id,{assignee:T,assigneeType:n.type,teamId:n.type==="team"?n.id:null}):h.type==="opportunity"&&await y.updateOpportunity(h.id,{assignee:T,assigneeType:n.type,teamId:n.type==="team"?n.id:null}),te.value=!1,_.value=null},tt=async n=>{P.value=null,n.type==="lead"?await d.updateLead(n.id,{priority:"Hot"}):n.type==="opportunity"&&await y.updateOpportunity(n.id,{priority:"Hot"})},st=async n=>{P.value=null,n.type==="lead"?await d.updateLead(n.id,{priority:"Normal"}):n.type==="opportunity"&&await y.updateOpportunity(n.id,{priority:"Normal"})},nt=async n=>{if(P.value=null,n.type==="lead")try{const h=n.displayStage||n.stage||Ae.NEW,T=Ae.NEW,B=mt(h,T);if(B){const{updates:f,activities:D}=B(n);await d.updateLead(n.id,f);for(const J of D)await d.addActivity(n.id,J)}else await d.updateLead(n.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open",status:"Open",nextActionDue:null,scheduledAppointment:null}),await d.addActivity(n.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await d.fetchLeadById(n.id)}catch(h){console.error("Failed to reopen lead:",h)}},at=n=>{const h=[];return n.type==="lead"&&n.isDisqualified===!0&&h.push({key:"reopen",label:"Reopen Lead",onClick:()=>nt(n)}),n.priority!=="Hot"?h.push({key:"mark-hot",label:"Mark as hot",onClick:()=>tt(n)}):h.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>st(n)}),h};return(n,h)=>{var T,B;return v(),k("div",Bs,[R(Fs,{show:!!u.value||N.value==="table"&&!!j.value,"back-label":"Back to task list",onBack:we},null,8,["show"]),N.value==="card"?(v(),k("div",Us,[r("div",{class:Q(["flex flex-col overflow-hidden",u.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[R(us,{title:"Tasks",items:e.value,"selected-id":u.value?String(u.value.compositeId):null,"view-mode":N.value,"initial-search-query":M.value,onViewChange:z,"selected-class":f=>f.type==="lead"?"bg-surface border-2 border-blue-500":"bg-surface border-2 border-purple-500","unselected-class":$(Ge),"open-menu-id":P.value,getName:f=>{const D=f.customer;return D&&D.name?D.name:D&&!D.name&&D.email&&D.email.split("@")[0]||"Unknown"},getInitials:f=>{const D=f.customer;return D&&D.initials?D.initials:D&&D.name&&D.name.split(" ").map(q=>q[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:f=>{if(f.type==="lead"){if(!f.requestedCar)return"No vehicle specified";const q=f.requestedCar,ue=[`${q.brand} ${q.model}`];return q.kilometers!==void 0&&q.kilometers!==null&&ue.push(`${q.kilometers} km`),q.status&&ue.push(q.status),ue.join(" â€¢ ")}const D=f.vehicle||f.requestedCar;if(!D)return"No vehicle specified";const J=[`${D.brand} ${D.model}`];return D.kilometers!==void 0&&D.kilometers!==null&&J.push(`${D.kilometers} km`),D.status&&J.push(D.status),J.join(" â€¢ ")},avatarClass:f=>f.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":at,"show-mobile-close":!1,onSelect:ne,onMenuClick:Ie,onMenuClose:h[0]||(h[0]=f=>P.value=null),onClose:we,"active-filters":I.value,onFilterChange:h[1]||(h[1]=f=>I.value=f),onSortChange:_e},{badges:H(({item:f})=>[f&&f.type?(v(),ee($(De),{key:0,text:f.type==="lead"?"Lead":"Opportunity",size:"small",theme:f.type==="lead"?"blue":"gray"},null,8,["text","theme"])):F("",!0),f&&f.type==="lead"&&$(p).getSetting("urgencyEnabled")!==!1&&f.urgencyLevel?(v(),k("span",{key:1,class:Q(["inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border",$(Ye)(f.urgencyLevel)])},[(v(),ee(dt(s(f.urgencyLevel)),{class:"size-3 shrink-0"})),de(" "+U(f.urgencyLevel),1)],2)):F("",!0),f&&f.priority==="Hot"&&($(p).getSetting("urgencyEnabled")===!1||f.type!=="lead")?(v(),ee($(De),{key:2,text:"HOT",size:"small",theme:"red"})):F("",!0)]),location:H(({item:f})=>[de(U($(c)(f)||"Unknown"),1)]),source:H(({item:f})=>{var D;return[de(U(f.source||((D=f.customer)==null?void 0:D.source)||"Unknown"),1)]}),owner:H(({item:f})=>[f.assignee?(v(),k("div",Rs,[r("div",Hs,U($(b)(f.assignee)),1),r("span",Vs,U(f.assignee),1)])):(v(),k("span",zs,"Unassigned"))]),dates:H(({item:f})=>[f.type==="lead"&&f.nextActionDue?(v(),k("span",Ws,"Due: "+U($(g)(f.nextActionDue)),1)):f.type==="opportunity"&&f.nextActionDue?(v(),k("span",js,"Due: "+U($(g)(f.nextActionDue)),1)):(v(),k("span",Es,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),u.value&&$(G)&&$(E)&&$(W)?(v(),ee(Ne,{key:((T=u.value)==null?void 0:T.compositeId)||"card-empty",task:u.value,"management-widget":$(G),"store-adapter":$(E),"add-new-config":$(W),"filtered-tasks":e.value,onTaskNavigate:Je},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0),u.value?F("",!0):(v(),k("div",Ps,[...h[5]||(h[5]=[ut('<div class="flex-1 flex items-center justify-center p-8" data-v-ef109631><div class="text-center max-w-sm" data-v-ef109631><div class="w-16 h-16 mx-auto mb-4 rounded-lg bg-muted flex items-center justify-center" data-v-ef109631><i class="fa-solid fa-tasks text-2xl text-muted-foreground" data-v-ef109631></i></div><h3 class="text-content-bold mb-2" data-v-ef109631>No task selected</h3><p class="text-meta" data-v-ef109631>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):F("",!0),N.value==="table"?(v(),k("div",Qs,[R(Ts,{tasks:$(K),"current-task-id":(B=j.value)==null?void 0:B.compositeId,"highlight-id":w.value,"show-closed":oe.value,"show-mobile-close":!1,"open-menu-id":P.value,"get-vehicle-type":$(m),"get-vehicle-type-badge-class":$(i),"get-owner-info":$(l),"get-stage-badge-class":$(We),"view-mode":N.value,onSelect:ne,onMenuClick:Ie,onMenuClose:h[2]||(h[2]=f=>P.value=null),onToggleClosed:h[3]||(h[3]=f=>oe.value=f),onReassign:Ze,onClose:we,onViewChange:z,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):F("",!0),N.value==="table"?(v(),ee(bt,{key:2,show:se.value,onClose:ke},{default:H(()=>{var f;return[j.value&&pe.value&&Ce.value&&$e.value?(v(),ee(Ne,{key:((f=j.value)==null?void 0:f.compositeId)||"drawer-empty",task:j.value,"management-widget":pe.value,"store-adapter":Ce.value,"add-new-config":$e.value,"filtered-tasks":$(K),"is-drawer-view":!0,onTaskNavigate:Xe,onClose:ke},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0)]}),_:1},8,["show"])):F("",!0),R(kt,{show:te.value,onClose:h[4]||(h[4]=f=>te.value=!1),onConfirm:et},null,8,["show"])])}}},rn=he(Ks,[["__scopeId","data-v-ef109631"]]);export{rn as default};
