import{d as h,o as c,F as ie,i as ue,n as U,e,_ as st,r as I,g as A,s as O,w as Se,D as T,p as z,T as pt,c as L,E as mt,G as X,t as $,k as R,l as ve,x as j,H as ae,I as _e,J as _,y as l,K as Lt,L as yt,j as Ge,M as se,N as $e,O as Ye,h as ot,C as He,u as Ee,m as Qe,v as we,P as qt,Q as Ue,R as Be,S as et,U as Nt,V as Mt,W as Rt}from"./index-CadXi4tZ.js";import{u as Je}from"./opportunities-wZyuO2as.js";import{u as Xe}from"./users-BFrVnYDO.js";import{Q as pe,i as Ke}from"./index-Dm9i4Ymj.js";import{y as Ft}from"./components-CmzOo1UI.js";import{u as Oe}from"./settings-BWd-PFvk.js";import{_ as Vt,a as Bt,g as Ut,b as Wt,c as Et,i as jt,d as Pt,e as Ht,f as Qt}from"./ComingSoonModal-ByrIkT4r.js";import{f as We,a as Pe,g as gt,b as ft,c as vt,d as bt}from"./formatters-DjeI4Z8-.js";import{z as Ie,F as Le,L as qe,H as Ne,j as Me,K as ze,C as Re,W as Fe}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DsnSKQBg.js";import{f as xt}from"./vehicles-axOG3UAX.js";import{_ as zt}from"./CreateEventModal-y9wAHxpI.js";import{_ as Yt,a as Kt}from"./EditEventModal-S7AJsZBc.js";import{_ as Gt}from"./ReassignUserModal-D1gdk1zU.js";import"./index-Ct-3v9pQ-BaCU_Qk3.js";const Jt={class:"flex items-center bg-gray-100 rounded-full p-1"},Xt=["onClick"],ht={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:t=>t.every(u=>u.value&&u.icon&&u.label)}},emits:["update:view"],setup(t){return(u,s)=>(c(),h("div",Jt,[(c(!0),h(ie,null,ue(t.options,n=>(c(),h("button",{key:n.value,onClick:a=>u.$emit("update:view",n.value),class:U(["w-8 h-8 flex items-center justify-center rounded-full transition-colors",t.view===n.value?"bg-white text-indigo-600 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-800"])},[e("i",{class:U([n.icon,"text-xs"])},null,2)],10,Xt))),128))]))}},Zt={class:"flex items-center gap-2"},_t={key:0,class:"flex gap-2"},es={class:"relative ml-auto",ref:"sortContainer"},ts={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},ss={key:0,class:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},os={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:u}){const s=u,n=I(!1),a=()=>{n.value=!n.value},o=d=>{n.value=!1,s("sort-change",d)},p={mounted(d,f){d.clickOutsideEvent=v=>{d===v.target||d.contains(v.target)||f.value(v)},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}};return(d,f)=>(c(),h("div",Zt,[t.showTypeFilter?(c(),h("div",_t,[e("button",{onClick:f[0]||(f[0]=v=>d.$emit("filter-change","all")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:f[1]||(f[1]=v=>d.$emit("filter-change","lead")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:f[2]||(f[2]=v=>d.$emit("filter-change","opportunity")),class:U(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):A("",!0),e("div",es,[e("button",{onClick:Se(a,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[f[7]||(f[7]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(c(),h("span",ts)):A("",!0)]),O(pt,{name:"dropdown"},{default:T(()=>[n.value?z((c(),h("div",ss,[e("button",{onClick:f[3]||(f[3]=v=>o("recent-first")),class:U(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":t.sortOption==="recent-first"}])},[e("i",{class:U(["fa-solid fa-check text-xs w-3",t.sortOption==="recent-first"?"opacity-100":"opacity-0"])},null,2),f[8]||(f[8]=e("span",null,"Most Recent First",-1))],2),t.typeFilter==="lead"?(c(),h("button",{key:0,onClick:f[4]||(f[4]=v=>o("urgent-first")),class:U(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":t.sortOption==="urgent-first"}])},[e("i",{class:U(["fa-solid fa-check text-xs w-3",t.sortOption==="urgent-first"?"opacity-100":"opacity-0"])},null,2),f[9]||(f[9]=e("span",null,"Urgent first",-1))],2)):A("",!0),e("button",{onClick:f[5]||(f[5]=v=>o("assigned-to-me")),class:U(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":t.sortOption==="assigned-to-me"}])},[e("i",{class:U(["fa-solid fa-check text-xs w-3",t.sortOption==="assigned-to-me"?"opacity-100":"opacity-0"])},null,2),f[10]||(f[10]=e("span",null,"Assigned to me",-1))],2),e("button",{onClick:f[6]||(f[6]=v=>o("assigned-to-my-team")),class:U(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":t.sortOption==="assigned-to-my-team"}])},[e("i",{class:U(["fa-solid fa-check text-xs w-3",t.sortOption==="assigned-to-my-team"?"opacity-100":"opacity-0"])},null,2),f[11]||(f[11]=e("span",null,"Assigned to my team",-1))],2)])),[[p,()=>n.value=!1]]):A("",!0)]),_:1})],512)]))}},ns=st(os,[["__scopeId","data-v-efc40990"]]),ls={key:1,class:"absolute right-3 top-8 w-40 bg-white border border-gray-200 rounded-sm shadow-xl z-50 overflow-hidden animate-fade-in"},as={class:"flex gap-2 mb-1"},is={key:1,class:"px-2 py-0.5 rounded text-xs font-medium bg-red-50 text-red-700 border border-red-200"},rs={class:"font-bold text-gray-900 text-base line-clamp-2 pt-1"},ds={class:"flex gap-3 text-xs text-gray-500 mt-1"},us={class:"flex items-center gap-1.5"},cs={class:"flex items-center gap-1.5"},ps={class:"pt-1 bg-gray-100 mt-2 mb-2"},ms={class:"flex justify-between text-xs px-3 py-1.5"},ys={class:"font-medium text-gray-900"},gs={class:"font-medium text-gray-900"},fs={key:2,class:"flex items-center justify-between pt-1 border-t border-gray-100"},vs={class:"text-xs text-gray-400 flex items-center gap-2"},bs={class:"w-5 h-5 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0"},xs={class:"text-gray-600 font-medium"},hs={key:1},ws={class:"text-xs text-gray-400 font-medium"},ks={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0}},emits:["select","menu-click","menu-close"],setup(t,{emit:u}){const s={mounted(r,i){r.clickOutsideEvent=m=>{r===m.target||r.contains(m.target)||i.value()},document.addEventListener("click",r.clickOutsideEvent)},unmounted(r){document.removeEventListener("click",r.clickOutsideEvent)}},n=t,a=L(()=>n.item.compositeId||`${n.item.type||"task"}-${n.item.id}`||n.item.id),o=L(()=>n.selected),p=L(()=>o.value?typeof n.selectedClass=="function"?n.selectedClass(n.item):n.selectedClass:typeof n.unselectedClass=="function"?n.unselectedClass(n.item):n.unselectedClass),d=L(()=>{const r=n.item.displayStage||n.item.stage;return r?mt(r,n.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),f=r=>{if(!r)return"?";const i=r.split(" ");return i.length>=2?(i[0][0]+i[i.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()},v=I(null);return(r,i)=>(c(),h("div",{ref_key:"cardRef",ref:v,onClick:i[1]||(i[1]=m=>r.$emit("select",a.value)),class:U(["bg-white rounded-lg p-3 h-44 flex flex-col justify-between hover:shadow-sm cursor-pointer relative",p.value])},[t.showMenu?(c(),h("button",{key:0,onClick:i[0]||(i[0]=Se(m=>r.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-3 right-3 text-gray-300 hover:text-gray-600"},[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):A("",!0),t.openMenuId===t.item.id&&t.showMenu?z((c(),h("div",ls,[X(r.$slots,"menu",{item:t.item})])),[[s,()=>r.$emit("menu-close")]]):A("",!0),e("div",null,[e("div",as,[e("span",{class:U(["px-2 py-0.5 rounded text-xs font-medium border",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},$(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(c(),h("span",{key:0,class:U(["px-2 py-0.5 rounded text-xs font-medium border",d.value])},$(t.item.displayStage||t.item.stage),3)):A("",!0),t.item.priority==="Hot"?(c(),h("span",is," Hot ")):A("",!0)]),e("h3",rs,$(t.getName(t.item)),1),e("div",ds,[e("span",us,[i[3]||(i[3]=e("i",{class:"fa-solid fa-location-dot"},null,-1)),X(r.$slots,"location",{item:t.item})]),e("span",cs,[i[4]||(i[4]=e("i",{class:"fa-solid fa-globe"},null,-1)),X(r.$slots,"source",{item:t.item},()=>{var m;return[R($(t.item.source||((m=t.item.customer)==null?void 0:m.source)||"Unknown"),1)]})])])]),e("div",ps,[e("div",ms,[e("span",ys,$(t.getVehicleInfo(t.item)),1),e("span",gs,[X(r.$slots,"vehicle-status",{item:t.item})])])]),r.$slots.owner||r.$slots.dates?(c(),h("div",fs,[e("div",vs,[X(r.$slots,"owner",{item:t.item},()=>[t.item.assignee?(c(),h(ie,{key:0},[e("div",bs,$(f(t.item.assignee)),1),e("span",xs,$(t.item.assignee),1)],64)):(c(),h("span",hs,"Unassigned"))])]),e("div",ws,[X(r.$slots,"dates",{item:t.item})])])):A("",!0)],2))}},Cs={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},$s={class:"page-header shrink-0"},Ss={class:"page-header-main"},As={class:"page-header-content"},Ds={class:"page-header-title"},Ts={class:"flex items-center gap-3"},Os={class:"px-5 py-3"},Is={class:"relative"},Ls=["placeholder"],qs={key:0,class:"px-5 pb-3"},Ns={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:u}){const s=t,n=u,a=I(""),o=I("none"),p=L(()=>{let i=s.items;if(s.typeFilter&&s.typeFilter!=="all"&&(i=i.filter(m=>m.type===s.typeFilter)),a.value){const m=a.value.toLowerCase();i=i.filter(w=>{const x=s.getName(w).toLowerCase(),N=s.getVehicleInfo(w).toLowerCase();return x.includes(m)||N.includes(m)})}return i}),d=i=>{const m=i.compositeId||`${i.type||"task"}-${i.id}`||i.id;return s.selectedId===m},f=i=>{o.value=i,n("sort-change",i)},v=I(null),r=I(null);return ve(()=>s.selectedId,async i=>{if(i&&r.value){await _e();try{const m=r.value.$el||r.value;m&&m.parentNode&&m.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}}},{immediate:!0}),ve(p,async()=>{s.selectedId&&r.value&&(await _e(),setTimeout(()=>{try{const i=r.value.$el||r.value;i&&i.parentNode&&i.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}},100))},{immediate:!0}),(i,m)=>(c(),h("div",Cs,[e("header",$s,[e("div",Ss,[e("div",As,[e("div",null,[e("h1",Ds,$(t.title),1)]),e("div",Ts,[t.viewMode?(c(),j(ht,{key:0,view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":m[0]||(m[0]=w=>i.$emit("view-change",w))},null,8,["view"])):A("",!0)])])])]),e("div",Os,[e("div",Is,[m[6]||(m[6]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),z(e("input",{"onUpdate:modelValue":m[1]||(m[1]=w=>a.value=w),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ls),[[ae,a.value]])])]),t.showTypeFilter?(c(),h("div",qs,[O(ns,{"type-filter":t.typeFilter,"sort-option":o.value,"show-type-filter":!0,onFilterChange:m[2]||(m[2]=w=>i.$emit("filter-change",w)),onSortChange:f},null,8,["type-filter","sort-option"])])):A("",!0),e("div",{ref_key:"scrollContainer",ref:v,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide bg-gray-50/50"},[(c(!0),h(ie,null,ue(p.value,w=>(c(),j(ks,{key:w.compositeId||`${w.type||"task"}-${w.id}`,ref_for:!0,ref:x=>{d(w)&&x&&(r.value=x.$el||x)},item:w,selected:d(w),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,onSelect:m[3]||(m[3]=x=>i.$emit("select",x)),onMenuClick:m[4]||(m[4]=x=>i.$emit("menu-click",x)),onMenuClose:m[5]||(m[5]=x=>i.$emit("menu-close"))},{location:T(({item:x})=>[X(i.$slots,"location",{item:x},void 0,!0)]),source:T(({item:x})=>[X(i.$slots,"source",{item:x},void 0,!0)]),"vehicle-status":T(({item:x})=>[X(i.$slots,"vehicle-status",{item:x},void 0,!0)]),owner:T(({item:x})=>[X(i.$slots,"owner",{item:x},void 0,!0)]),dates:T(({item:x})=>[X(i.$slots,"dates",{item:x},void 0,!0)]),menu:T(({item:x})=>[X(i.$slots,"menu",{item:x},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo"]))),128))],512)]))}},Ms=st(Ns,[["__scopeId","data-v-a1e436ae"]]);function wt(t,u=[],s,n){const a=Oe(),o=a.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},p=a.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},d=Rs(t,u),f=Fs(t,u),v=Vs(t),r=Bs(t),i=o.intent+o.behavioral+o.temporal,m={intent:o.intent/i*100,behavioral:o.behavioral/i*100,temporal:o.temporal/i*100},w=d/40*m.intent,x=f/35*m.behavioral,N=v/25*m.temporal,F=Math.min(100,Math.max(0,w+x+N+r));let C="COLD";return F>=p.hot?C="HOT":F>=p.warm?C="WARM":F>=p.standard&&(C="STANDARD"),{score:Math.round(F*10)/10,level:C,breakdown:{intent:Math.round(d*10)/10,behavioral:Math.round(f*10)/10,temporal:Math.round(v*10)/10,quality:Math.round(r*10)/10,total:Math.round(F*10)/10}}}function Rs(t,u){var n;let s=0;return(t.requestType==="Test Drive"||((n=t.scheduledAppointment)==null?void 0:n.type)==="test-drive"||u.some(a=>a.type==="test-drive"||a.type==="appointment"))&&(s=Math.max(s,40)),u.some(a=>a.type==="financing")&&(s=Math.max(s,35)),u.some(a=>a.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||u.some(a=>{var o,p,d;return((o=a.content)==null?void 0:o.toLowerCase().includes("location"))||((p=a.content)==null?void 0:p.toLowerCase().includes("dealership"))||((d=a.content)==null?void 0:d.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||u.some(a=>{var o,p;return((o=a.content)==null?void 0:o.toLowerCase().includes("configur"))||a.type==="attachment"&&((p=a.fileName)==null?void 0:p.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),u.some(a=>{var p;const o=((p=a.content)==null?void 0:p.toLowerCase())||"";return o.includes("compare")||o.includes("versus")||o.includes("vs")||o.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function Fs(t,u){let s=0;const n=new Set(u.map(d=>{if(!d.timestamp)return null;const f=new Date(d.timestamp);return`${f.getFullYear()}-${f.getMonth()}-${f.getDate()}`}).filter(Boolean)),a=Math.min(n.size*10,35);s+=a,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const o=u.reduce((d,f)=>{var v;return d+(((v=f.content)==null?void 0:v.length)||0)},0),p=Math.min(Math.floor(o/50),25);return s+=p,u.some(d=>{var f,v,r;return d.type==="attachment"&&(((f=d.fileName)==null?void 0:f.toLowerCase().includes("brochure"))||((v=d.fileName)==null?void 0:v.toLowerCase().includes("spec"))||((r=d.fileName)==null?void 0:r.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function Vs(t){let u=0;if(!t.createdAt)return 0;const s=new Date,n=new Date(t.createdAt),a=(s.getTime()-n.getTime())/(1e3*60*60);a<2?u+=25:a<24?u+=15:a<48?u+=5:u-=10;const o=n.getDay(),p=n.getHours();if((o===0||o===6||p<9||p>17)&&(u+=10),t.contactAttempts&&t.contactAttempts.length===3&&(u+=50),t.lastActivity){const d=new Date(t.lastActivity);(s.getTime()-d.getTime())/(1e3*60*60*24)>3&&(u+=20)}return Math.min(Math.max(u,0),25)}function Bs(t){var s,n,a,o,p,d,f;let u=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(u+=10),(n=t.customer)!=null&&n.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(u+=10),(a=t.customer)!=null&&a.name&&((o=t.customer)!=null&&o.email)&&((p=t.customer)!=null&&p.phone)&&((d=t.customer)!=null&&d.address)&&(u+=5),(t.isDuplicate||t.isDisqualified||!((f=t.customer)!=null&&f.name))&&(u-=20),u}function kt(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Ct(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Us({typeFilter:t,showTypeFilter:u,tasks:s}){return{filterDefinitions:L(()=>{const a=[];u.value&&a.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),a.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),a.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&a.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),a.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const o=[...new Set(s.value.map(d=>d.assignee).filter(Boolean))];o.length>0&&a.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:o.map(d=>({value:d,label:d})),aiHint:"Person assigned to the task",pinned:!0});const p=[...new Set(s.value.map(d=>{const f=d.type==="lead"?d.requestedCar:d.vehicle;return f==null?void 0:f.brand}).filter(Boolean))];return p.length>0&&a.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:p.map(d=>({value:d,label:d})),aiHint:"Car brand requested by customer"}),a.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),a})}}const Ws={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},Es={class:"page-header shrink-0"},js={class:"page-header-main"},Ps={class:"page-header-content"},Hs={class:"flex items-center gap-3"},Qs={class:"flex-1 overflow-y-auto p-4 md:p-8"},zs={class:"table-wrapper w-full"},Ys={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:u}){const s=t,n=u,a=Oe();I("");const o=I({pageIndex:0,pageSize:10}),p=I(""),d=I([]),f=I([{id:"status",value:["Valid","Qualified","Open Lead"],operator:"in"},{id:"type",value:"lead",operator:"eq"},{id:"source",value:["Marketing","Website"],operator:"in"},{id:"assignee",value:void 0},{id:"urgencyLevel",value:void 0}]);I({});const{filterDefinitions:v}=Us({typeFilter:L(()=>s.typeFilter),showTypeFilter:L(()=>s.showTypeFilter),tasks:L(()=>s.tasks)}),r=L(()=>s.tasks),i=k=>k.compositeId===s.currentTaskId||k.compositeId===s.highlightId,m=k=>{if(k.type==="lead")return k.requestedCar?`${k.requestedCar.brand} ${k.requestedCar.model}`:"No vehicle specified";const b=k.vehicle||k.requestedCar;return b?`${b.brand} ${b.model}`:"No vehicle specified"},w=k=>{const b=k.type==="lead"?k.requestedCar:k.vehicle;if(!b)return{status:"N/A",class:"bg-gray-100 text-gray-700"};const y=b.stockDays!==void 0&&b.stockDays!==null;return{status:y?"In Stock":"Out of Stock",class:y?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}},x=k=>{var b;return k.type==="lead"?((b=k.requestedCar)==null?void 0:b.requestType)||k.requestType||"N/A":k.requestType||"Opportunity"},N=L(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:k=>F(k.original)},cell:({row:k})=>{const b=k.original,y=b.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${y}`},b.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:k})=>{const b=k.original;return _("div",{class:"flex items-center gap-2 md:gap-3"},[_("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${b.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},b.customer.initials),_("div",{class:"min-w-0"},[_("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},b.customer.name),_("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},b.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:k})=>{const b=k.original,y=m(b);return y==="No vehicle specified"?_("span",{class:"text-sm text-gray-400"},"N/A"):_("div",{class:"flex items-center gap-2"},[_("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"}),_("span",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},y)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:k})=>{const b=k.original,y=w(b);return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${y.class}`},y.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:k})=>{const b=k.original,y=x(b);return _("span",{class:"text-sm text-gray-600"},y)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:k})=>{const b=k.original;return _("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},b.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:k})=>{const b=k.original,y=s.getOwnerInfo(b);return _("div",{class:"flex items-center gap-2"},[_("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-600 shrink-0"},y.initials),_("span",{class:"text-sm text-gray-600 truncate max-w-[80px]"},y.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:k})=>{const b=k.original,y=b.type==="lead"?b.status:b.displayStage||b.stage,D=s.getStageBadgeClass(y);return _("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${D}`},y)}},...s.typeFilter==="lead"&&a.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:k})=>{const b=k.original;if(b.type!=="lead")return _("span",{class:"text-sm text-gray-400"},"â€”");let y=b.urgencyLevel;y||(y=wt(b).level);const D=Ct(y),V=kt(y);return _("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${D}`},[_("span",{},V),_("span",{},y)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:k})=>{const b=k.original;return _("button",{class:"text-gray-400 hover:text-gray-600",onClick:y=>{y.stopPropagation(),n("menu-click",b.id)}},[_("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),F=k=>{n("select",k.compositeId)},C=L(()=>({class:{tr:k=>{const b="cursor-pointer hover:bg-gray-50 transition-colors",y=k.original;return i(y)?`${b} bg-blue-50 border-l-4 border-l-blue-500`:b}}}));return ve(()=>[s.highlightId,s.tasks],async([k])=>{k&&s.tasks.length>0&&(await _e(),setTimeout(()=>{var b,y;try{const D=document.querySelector(".table-wrapper");if(!D)return;const V=s.tasks.find(Y=>Y.compositeId===k);if(!V)return;const P=(b=V.customer)==null?void 0:b.name;if(P){const Y=D.querySelectorAll('tbody tr, [role="row"]');for(const Z of Y)if(Z&&Z.parentNode&&((y=Z.textContent)!=null&&y.includes(P))){Z.scrollIntoView({behavior:"smooth",block:"nearest"});break}}}catch{}},500))},{immediate:!0}),(k,b)=>(c(),h("div",Ws,[e("header",Es,[e("div",js,[e("div",Ps,[b[7]||(b[7]=e("div",null,[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Hs,[e("button",{onClick:b[0]||(b[0]=y=>k.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 hover:border-indigo-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all"},[...b[6]||(b[6]=[e("i",{class:"fa-solid fa-eye-slash text-gray-400 group-hover:text-indigo-500"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])]),O(ht,{view:t.viewMode,options:[{value:"card",icon:"fa-solid fa-table",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":b[1]||(b[1]=y=>k.$emit("view-change",y))},null,8,["view"])])])])]),e("div",Qs,[e("div",zs,[O(l(Ft),{data:r.value,columns:N.value,meta:C.value,onRowClick:F,columnFiltersOptions:{filterDefs:l(v)},pagination:o.value,"onUpdate:pagination":b[2]||(b[2]=y=>o.value=y),globalFilter:p.value,"onUpdate:globalFilter":b[3]||(b[3]=y=>p.value=y),sorting:d.value,"onUpdate:sorting":b[4]||(b[4]=y=>d.value=y),columnFilters:f.value,"onUpdate:columnFilters":b[5]||(b[5]=y=>f.value=y),paginationOptions:{rowCount:r.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{toolbar:T(()=>[...b[8]||(b[8]=[e("div",{class:"flex justify-end"},[e("button",{class:"group flex items-center gap-2 rounded-2xl border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 hover:border-purple-100 hover:bg-purple-50 hover:text-purple-600 transition-all"},[e("i",{class:"fa-solid fa-arrow-left text-gray-400 group-hover:text-purple-500"}),e("span",{class:"hidden sm:inline"},"Switch back to old design")])],-1)])]),"empty-state":T(()=>[...b[9]||(b[9]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Ks={key:0,class:"mb-8"},Gs={class:"flex items-center gap-2 mb-4"},Js={class:"font-bold text-gray-800 text-sm"},Xs={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},Zs={class:"p-4"},_s={class:"flex items-center justify-between"},eo={class:"flex items-center gap-4"},to={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},so=["src"],oo={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},no={class:"flex items-center gap-2"},lo={class:"font-bold text-gray-900 text-sm md:text-base"},ao={class:"mt-1.5 flex items-center gap-2"},io={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},ro={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},uo={key:2,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},co={class:"flex items-center gap-4"},po={key:0,class:"text-right"},mo={class:"font-bold text-gray-900"},yo={key:0,class:"mt-4 pt-4 border-t border-gray-200"},go={class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},fo={class:"text-sm text-gray-700 leading-relaxed"},vo={class:"border-t border-gray-200"},bo={class:"font-medium"},xo={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},ho={class:"mb-6"},wo={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ko={key:0},Co={class:"font-medium text-gray-700"},$o={key:1},So={class:"font-medium text-gray-700"},Ao={key:2},Do={class:"font-medium text-gray-700"},To={class:"font-medium text-gray-700"},Oo={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Io={key:0},Lo={class:"font-medium text-gray-700"},qo={key:1},No={class:"font-medium text-gray-700"},Mo={key:2},Ro={class:"font-medium text-gray-700"},Fo={key:3},Vo={class:"font-medium text-gray-700"},Bo={key:4},Uo={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Wo={key:5},Eo={class:"font-medium text-gray-700"},jo={key:0,class:"mt-6 flex justify-end"},Po={__name:"VehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const u=I(!1),s=a=>new Intl.NumberFormat("en-US").format(a),n=a=>new Intl.NumberFormat("en-US").format(a);return(a,o)=>t.show?(c(),h("div",Ks,[e("div",Gs,[o[1]||(o[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",Js,$(t.label),1)]),e("div",Xs,[e("div",Zs,[e("div",_s,[e("div",eo,[e("div",to,[t.image?(c(),h("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,so)):(c(),h("i",oo))]),e("div",null,[e("div",no,[e("div",lo,$(t.brand)+" "+$(t.model)+" ("+$(t.year)+")",1)]),e("div",ao,[t.stockDays!==void 0&&t.stockDays!==null?(c(),h("div",io,[o[2]||(o[2]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),R(" In stock ("+$(t.stockDays)+" days) ",1)])):(c(),h("div",ro,[...o[3]||(o[3]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),R(" Out of stock ",-1)])])),t.showOpenAd&&t.price?(c(),h("button",uo,[...o[4]||(o[4]=[R(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-xs text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):A("",!0)])])]),e("div",co,[t.price?(c(),h("div",po,[o[5]||(o[5]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",mo,"â‚¬ "+$(s(t.price)),1)])):A("",!0)])]),t.requestMessage?(c(),h("div",yo,[o[6]||(o[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-2"},"Request Message",-1)),e("div",go,[e("p",fo,$(t.requestMessage),1)])])):A("",!0)]),e("div",vo,[e("button",{onClick:o[0]||(o[0]=p=>u.value=!u.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",bo,$(u.value?"Hide":"View")+" Details",1),e("i",{class:U(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":u.value}])},null,2)])]),u.value?(c(),h("div",xo,[e("div",ho,[o[17]||(o[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",wo,[t.requestType?(c(),h("div",ko,[o[7]||(o[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Co,$(t.requestType),1)])):A("",!0),t.source?(c(),h("div",$o,[o[8]||(o[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",So,$(t.source),1)])):A("",!0),e("div",null,[o[9]||(o[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:U(["font-medium",t.sourceDetails?"text-gray-700":"text-gray-400"])},$(t.sourceDetails||"--"),3)]),t.dealership?(c(),h("div",Ao,[o[10]||(o[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Do,$(t.dealership),1)])):A("",!0),e("div",null,[o[11]||(o[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",To,$(t.channel||"Email"),1)]),e("div",null,[o[12]||(o[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:U(["font-medium",t.adCampaign?"text-gray-700":"text-gray-400"])},$(t.adCampaign||"--"),3)]),e("div",null,[o[13]||(o[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:U(["font-medium",t.adMedium?"text-gray-700":"text-gray-400"])},$(t.adMedium||"--"),3)]),e("div",null,[o[14]||(o[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:U(["font-medium",t.adSource?"text-gray-700":"text-gray-400"])},$(t.adSource||"--"),3)]),e("div",null,[o[15]||(o[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:U(["font-medium",t.expectedPurchaseDate?"text-gray-700":"text-gray-400"])},$(t.expectedPurchaseDate||"--"),3)]),e("div",null,[o[16]||(o[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:U(["font-medium",t.fiscalEntity?"text-gray-700":"text-gray-400"])},$(t.fiscalEntity||"--"),3)])])]),o[26]||(o[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[o[25]||(o[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Oo,[t.registration?(c(),h("div",Io,[o[18]||(o[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Lo,$(t.registration),1)])):A("",!0),t.kilometers!==void 0&&t.kilometers!==null?(c(),h("div",qo,[o[19]||(o[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",No,$(n(t.kilometers))+" Km",1)])):A("",!0),t.fuelType?(c(),h("div",Mo,[o[20]||(o[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Ro,$(t.fuelType),1)])):A("",!0),t.gearType?(c(),h("div",Fo,[o[21]||(o[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Vo,$(t.gearType),1)])):A("",!0),t.vin?(c(),h("div",Bo,[o[22]||(o[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Uo,$(t.vin),1)])):A("",!0),t.dealership?(c(),h("div",Wo,[o[23]||(o[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Eo,$(t.dealership),1)])):A("",!0)]),t.showTechnicalSpecs?(c(),h("div",jo,[...o[24]||(o[24]=[e("button",{class:"bg-white border border-gray-200 text-gray-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),R(" View technical specs ")],-1)])])):A("",!0)])])):A("",!0)])])):A("",!0)}},Ho={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border-gray-200"},Qo={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-gray-200"},dt={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},vehicleWidgetData:{type:Object,default:null}},setup(t){return(u,s)=>t.task?(c(),h("div",Ho,[O(Vt,{task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},{"pinned-extra":T(({task:n})=>[t.vehicleWidgetData?(c(),j(Po,Lt(yt({key:0},t.vehicleWidgetData)),null,16)):A("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):(c(),h("div",Qo,[...s[0]||(s[0]=[Ge('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gray-100 flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-gray-400"></i></div><h3 class="text-base font-semibold text-gray-900 mb-2">No task selected</h3><p class="text-sm text-gray-500">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},zo={key:0,class:"lg:hidden border-b border-gray-200 shrink-0",style:{"background-color":"#f5f5f5"}},Yo={class:"px-4 py-3 flex items-center justify-between gap-3"},Ko=["aria-label"],Go={key:0,class:"flex-1 flex items-center justify-center"},Jo={key:1,class:"flex items-center gap-2"},Xo={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:u}){const s=u,n=()=>{s("back")};return(a,o)=>t.show?(c(),h("div",zo,[e("div",Yo,[e("button",{onClick:n,class:"w-11 h-11 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...o[0]||(o[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,Ko),a.$slots.title?(c(),h("div",Go,[X(a.$slots,"title")])):A("",!0),a.$slots.actions?(c(),h("div",Jo,[X(a.$slots,"actions")])):A("",!0)])])):A("",!0)}},Ce={[se.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[se.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[se.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[se.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[se.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[se.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},ut={toClosed:(t,u,s)=>{const n={isDisqualified:!0,disqualifyReason:(s==null?void 0:s.reason)||null,disqualifyCategory:(s==null?void 0:s.category)||null,scheduledAppointment:null,nextActionDue:null};(s==null?void 0:s.reason)==="Duplicate"?(n.isDuplicate=!0,n.stage="Closed Failed"):(s==null?void 0:s.category)==="Not Interested"?n.stage="Not Interested":n.stage="Not Valid",n.status="Disqualified";const a=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(s==null?void 0:s.category)||"Unknown"}, Reason: ${(s==null?void 0:s.reason)||"Unknown"}`}];return t.scheduledAppointment&&a.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:n,activities:a}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function tt(t,u){return u.startsWith("Closed")?ut.toClosed:t.startsWith("Closed")&&!u.startsWith("Closed")?ut.reopen:null}function Zo(t){var o,p,d;const u=t.lead;if(!u)return null;const s=$e(u,"lead");if(!s)return((o=Ce[se.NEW])==null?void 0:o.primaryAction)||null;const n=Ce[s];if(!n)return((p=Ce[se.NEW])==null?void 0:p.primaryAction)||null;if(!n.primaryAction)return((d=Ce[se.NEW])==null?void 0:d.primaryAction)||null;const a=n.primaryAction;return typeof a=="function"?a({lead:u,displayStage:s}):a}function _o(t){const u=t.lead;if(!u)return[];const s=$e(u,"lead"),n=Ce[s];return n?n.secondaryActions||[]:[]}function nt(t){const u=t.lead;if(!u||!(u.isDisqualified===!0))return!1;const n=$e(u,"lead");return n===se.CLOSED_INVALID||n===se.CLOSED_NOT_INTERESTED||n===se.CLOSED_DUPLICATE}function en(t){const u=t.lead;if(!u||nt(t))return!1;const s=$e(u,"lead"),n=Ce[s];return n?typeof n.showLQWidget=="function"?n.showLQWidget(u):n.showLQWidget??!1:!1}function tn(t){const u=t.lead;if(!u||nt(t))return!1;const s=$e(u,"lead"),n=Ce[s];return n?n.showDeadlineBanner&&u.nextActionDue:!1}function sn(t){const u=t.lead;if(!u)return!1;const s=$e(u,"lead"),n=Ce[s];return n?n.canPostpone??!1:!1}function on(t){const u=t.lead;if(!u)return"qualification";const s=$e(u,"lead"),n=Ce[s];return n&&n.lqWidgetMode||"qualification"}function $t(t,u={}){const s=Oe(),n=L(()=>{const F=typeof t=="function"?t():Ye(t);return{lead:F,displayStage:F?$e(F,"lead"):null}}),a=L(()=>n.value.displayStage||"New"),o=L(()=>{const F=n.value;return nt(F)}),p=L(()=>{const F=n.value,C=Zo(F);if(!C)return null;const k=u[C.key];return{...C,handler:k||(()=>console.warn(`No handler for action: ${C.key}`))}}),d=L(()=>{const F=n.value;return _o(F).map(k=>{const b=u[k.key];return{...k,handler:b||(()=>console.warn(`No handler for action: ${k.key}`))}})}),f=L(()=>{const F=n.value;return en(F)}),v=L(()=>{const F=n.value;return tn(F)}),r=L(()=>{const F=n.value;return sn(F)}),i=L(()=>{const F=n.value;return on(F)}),m=L(()=>{const C=n.value.lead;return((C==null?void 0:C.contactAttempts)||[]).length||0}),w=L(()=>s.getSetting("maxContactAttempts")),x=L(()=>m.value+1>=w.value),N=L(()=>!0);return{displayStage:a,isClosed:o,primaryAction:p,secondaryActions:d,showLQWidget:f,showDeadlineBanner:v,canPostpone:r,canReassign:N,lqWidgetMode:i,contactAttempts:m,maxContactAttempts:w,shouldShowAutoDisqualifyWarning:x}}function nn({getLead:t,leadState:u,emit:s}){const n=ot(),a=He(),o=Ee();async function p(C){var b;const k=t();if(k){if(!u.canPostpone.value){console.warn("Cannot postpone in current state");return}try{const y=new Date(`${C.date}T${C.time}:00`),D=y.toISOString(),V={nextActionDue:D};if((C.assigneeId||C.teamId)&&(V.assignee=C.assignee||null,V.assigneeId=C.assigneeId||null,V.assigneeType=C.assigneeType||"user",V.teamId=C.teamId||null,V.team=C.team||null),await a.updateLead(k.id,V),C.createAppointment){const P=new Date(y);P.setHours(P.getHours()+1),await a.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${k.customer.name}`,start:D,end:P.toISOString(),type:"Call",assignee:C.assignee||k.assignee,assigneeId:C.assigneeId||k.assigneeId,assigneeType:C.assigneeType||k.assigneeType||"user",teamId:C.teamId||k.teamId,team:C.team||k.team,status:"scheduled"}}),await a.addActivity(k.id,{type:"appointment",user:((b=o.currentUser)==null?void 0:b.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${We(y)} at ${Pe(y)}`,data:{type:"Call",date:C.date,time:C.time,assignee:C.assignee||k.assignee}})}await a.addActivity(k.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${We(y)} at ${Pe(y)}${C.assignee?` and reassigned to ${C.assignee}`:""}`}),await a.fetchLeadById(k.id)}catch(y){console.error("Failed to postpone lead task:",y)}}}async function d(C){const k=t();if(k)try{if(await a.updateLead(k.id,{stage:"Validated"}),await a.addActivity(k.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),C.scheduleFollowUp&&C.appointmentData){const b=new Date(`${C.appointmentData.date}T${C.appointmentData.time}:00`);await a.scheduleFollowUp(k.id,{dateTime:b.toISOString(),assignee:C.appointmentData.assignee||k.assignee,assigneeId:C.appointmentData.assigneeId||null,assigneeType:C.appointmentData.assigneeType||"user",teamId:C.appointmentData.teamId||null,team:C.appointmentData.team||null}),await a.addActivity(k.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${We(b)} at ${Pe(b)}`})}await a.fetchLeadById(k.id)}catch(b){console.error("Failed to validate lead:",b)}}async function f(){const C=t();if(C)try{const k=await a.convertLeadToOpportunity(C.id);o.canAccessOpportunities()?n.push({path:`/tasks/${k}`,query:{type:"opportunity"}}):n.push("/tasks")}catch(k){console.error("Failed to qualify lead:",k)}}async function v(C){const k=t();if(k)try{const b=k.contactAttempts||[];await a.updateLead(k.id,{contactAttempts:[...b,C],lastContactAttempt:C.timestamp,totalContactAttempts:b.length+1}),await a.addActivity(k.id,{type:"call",user:"You",action:`logged call attempt - ${C.outcome}`,content:C.notes||`Call attempt via ${C.channel}`,data:{outcome:C.outcome,channel:C.channel,duration:C.duration}}),await a.fetchLeadById(k.id)}catch(b){console.error("Failed to log call attempt:",b)}}async function r(C){const k=t();if(k)try{await a.addActivity(k.id,{type:"note",user:"You",action:"added a note",content:C.content||C.text||"",data:C}),await a.fetchLeadById(k.id)}catch(b){console.error("Failed to save note:",b)}}function i(){s("open-purchase-method")}function m(){s("open-trade-in")}async function w(C){var b;const k=t();if(k)try{const y=`${C.date}T${C.time}:00`,D=new Date(y);D.setHours(D.getHours()+1),await a.updateLead(k.id,{scheduledAppointment:{id:Date.now(),title:`${C.type} - ${k.customer.name}`,start:y,end:D.toISOString(),type:C.type,assignee:C.assignee,assigneeId:C.assigneeId,status:"scheduled",location:C.location||"",notes:C.notes||""}}),await a.addActivity(k.id,{type:"appointment",user:((b=o.currentUser)==null?void 0:b.name)||"You",action:"scheduled an appointment",content:`${C.type} scheduled for ${C.date} at ${C.time}`,data:{type:C.type,date:C.date,time:C.time,assignee:C.assignee}}),await a.fetchLeadById(k.id)}catch(y){console.error("Failed to schedule appointment:",y)}}async function x(C){const k=t();if(k){if(u.isClosed.value&&!C.force){console.warn("Lead already closed");return}try{const b=u.displayStage.value,y=C.reason==="Duplicate"?se.CLOSED_DUPLICATE:C.category==="Not Interested"?se.CLOSED_NOT_INTERESTED:se.CLOSED_INVALID,D=tt(b,y);if(D){const{updates:V,activities:P}=D(k,y,C);await a.updateLead(k.id,V);for(const Y of P)await a.addActivity(k.id,Y)}else{const V=C.reason==="Duplicate";await a.updateLead(k.id,{isDisqualified:!0,disqualifyReason:C.reason,isDuplicate:V,stage:V?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await a.addActivity(k.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${C.category}, Reason: ${C.reason}`})}n.push("/tasks")}catch(b){console.error("Failed to disqualify lead:",b)}}}async function N(){const C=t();if(C)try{const k=u.displayStage.value,b=se.NEW,y=tt(k,b);if(y){const{updates:D,activities:V}=y(C);await a.updateLead(C.id,D);for(const P of V)await a.addActivity(C.id,P)}else await a.updateLead(C.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await a.addActivity(C.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await a.fetchLeadById(C.id)}catch(k){console.error("Failed to reopen lead:",k)}}function F(){const C=t();C&&C.opportunityId&&n.push({path:`/tasks/${C.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:p,handleValidated:d,handleQualified:f,handleCallAttemptLogged:v,handleNoteSaved:r,handleOpenPurchaseMethod:i,handleOpenTradeIn:m,handleAppointmentScheduled:w,handleDisqualified:x,handleReopen:N,viewOpportunity:F}}const ln={class:"p-5 space-y-6"},St={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""}},setup(t){return(u,s)=>t.task?(c(),h("div",{key:0,class:U(["bg-white border border-gray-200 rounded-xl shadow-sm",t.containerClass])},[s[0]||(s[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-gray-800 text-sm"},"Manage next steps")])],-1)),X(u.$slots,"deadline-banner"),e("div",ln,[X(u.$slots,"primary-action"),X(u.$slots,"task-widgets"),X(u.$slots,"closed-state"),X(u.$slots,"secondary-actions")])],2)):A("",!0)}},an={class:"flex justify-between items-start mb-3"},rn={class:"font-bold text-gray-900 text-sm"},dn={class:"text-xs text-gray-500 mt-0.5"},un={class:"flex gap-3 flex-wrap"},At={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(u,s)=>(c(),h("div",{class:U(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",an,[e("div",null,[e("h4",rn,$(t.action.title),1),e("p",dn,$(t.action.description),1)])]),e("div",un,[e("button",{onClick:s[0]||(s[0]=n=>u.$emit("action-clicked")),class:U([t.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:U(t.action.icon)},null,2),R(" "+$(t.action.label),1)],2)])],2))}},cn={class:"flex items-center gap-3"},pn={class:"flex-1"},mn={key:0,class:"text-xs font-normal opacity-75"},yn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:u}){const s=t,n=u,a=I(!1),o=L(()=>gt(s.nextActionDue)),p=L(()=>s.isClosed||!s.showDeadlineBanner||a.value?!1:o.value.type==="overdue"||o.value.type==="urgent"),d=()=>{a.value=!0,n("dismissed")};return(f,v)=>p.value?(c(),h("div",{key:0,class:U(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[o.value.bgClass,o.value.borderClass]])},[e("div",cn,[e("div",{class:U(["w-9 h-9 rounded-lg flex items-center justify-center",[o.value.bgClass,o.value.borderClass,"border"]])},[e("i",{class:U(["text-base",[`fa-solid ${o.value.icon}`,o.value.textClass]])},null,2)],2),e("div",pn,[v[0]||(v[0]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:U(["text-sm font-bold",o.value.textClass])},[R($(l(ft)(t.nextActionDue))+" ",1),o.value.type!=="overdue"?(c(),h("span",mn," ("+$(l(vt)(t.nextActionDue))+") ",1)):A("",!0)],2)]),o.value.type==="overdue"?(c(),h("div",{key:0,class:U(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...v[1]||(v[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),R(" Overdue ",-1)])],2)):o.value.type==="urgent"?(c(),h("div",{key:1,class:U(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...v[2]||(v[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),R(" Urgent ",-1)])],2)):A("",!0)]),e("button",{onClick:d,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):A("",!0)}},gn={class:"space-y-4"},fn={label:"Teams"},vn=["value"],bn={label:"Users"},xn=["value"],hn={key:0,class:"text-xs text-gray-500 mt-1"},wn={key:0,class:"animate-fade-in"},kn={class:"grid grid-cols-4 gap-2"},Cn=["onClick"],$n={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0}},emits:["close","confirm"],setup(t,{emit:u}){const s=t,n=u,a=Ee(),o=Xe(),p=I(""),d=I(null),f=I(""),v=I(!1),r=I(""),i=L(()=>o.assignableUsers),m=L(()=>o.assignableTeams),w=L(()=>d.value&&d.value.startsWith("team-")),x=L(()=>!!(p.value&&f.value&&r.value&&d.value));Qe(()=>{var b;d.value=`user-${((b=a.currentUser)==null?void 0:b.id)||1}`}),ve(()=>s.show,b=>{b||N()});const N=()=>{var b;p.value="",d.value=`user-${((b=a.currentUser)==null?void 0:b.id)||1}`,f.value="",v.value=!1,r.value=""},F=b=>{b||n("close")},C=()=>{if(!x.value)return;const b=d.value.startsWith("team-"),y=parseInt(d.value.split("-")[1]);let D={};if(b){const V=o.getTeamById(y);D={assigneeType:"team",teamId:y,team:(V==null?void 0:V.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const V=o.getUserById(y);D={assigneeType:"user",assigneeId:y,assignee:(V==null?void 0:V.name)||"Unknown",teamId:null,team:null}}n("confirm",{type:p.value,date:f.value,time:r.value,...D}),n("close")},k=()=>{n("close")};return(b,y)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":F},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...y[4]||(y[4]=[R("Schedule Appointment",-1)])]),_:1}),O(l(ze),null,{default:T(()=>[...y[5]||(y[5]=[R("Book an appointment with the customer",-1)])]),_:1})]),_:1}),e("div",gn,[e("div",null,[y[7]||(y[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),z(e("select",{"onUpdate:modelValue":y[0]||(y[0]=D=>p.value=D),class:"input"},[...y[6]||(y[6]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[we,p.value]])]),e("div",null,[y[9]||(y[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),z(e("select",{"onUpdate:modelValue":y[1]||(y[1]=D=>d.value=D),class:"input"},[e("optgroup",fn,[(c(!0),h(ie,null,ue(m.value,D=>(c(),h("option",{key:`team-${D.id}`,value:`team-${D.id}`},$(D.name)+" Team ",9,vn))),128))]),e("optgroup",bn,[(c(!0),h(ie,null,ue(i.value,D=>{var V;return c(),h("option",{key:`user-${D.id}`,value:`user-${D.id}`},$(D.name)+$(D.id===((V=l(a).currentUser)==null?void 0:V.id)?" (Me)":""),9,xn)}),128))])],512),[[we,d.value]]),w.value?(c(),h("p",hn,[...y[8]||(y[8]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),R(" Any available team member will be assigned ",-1)])])):A("",!0)]),e("div",null,[y[10]||(y[10]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":y[2]||(y[2]=D=>f.value=D),onChange:y[3]||(y[3]=D=>v.value=!0),class:"input"},null,544),[[ae,f.value]])]),v.value?(c(),h("div",wn,[y[11]||(y[11]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",kn,[(c(),h(ie,null,ue(["09:00","10:30","11:00","14:30","15:00","16:30"],D=>e("button",{key:D,onClick:V=>r.value=D,class:U(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",r.value===D?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},$(D),11,Cn)),64))])])):A("",!0)]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k}),O(l(pe),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!x.value,onClick:C},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Sn={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},An={key:0,class:"flex justify-between items-center mb-4"},Dn={class:"font-semibold text-gray-900 text-sm"},Tn={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(t){return(u,s)=>(c(),h("div",Sn,[t.title?(c(),h("div",An,[e("h5",Dn,$(t.title),1),t.showClose?(c(),h("button",{key:0,onClick:s[0]||(s[0]=n=>u.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...s[1]||(s[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):A("",!0)])):A("",!0),X(u.$slots,"default")]))}};function On(){const t=I(!1),u=I(!1),s=I(0),n=I(""),a=I(null),o=I({}),p=I(null),d={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},f=L(()=>{const x=Math.floor(s.value/60),N=s.value%60;return`${x.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`}),v=()=>{t.value=!0,s.value=0,u.value=!1,n.value="",a.value=setInterval(()=>{s.value++,s.value>=20&&r()},1e3)},r=()=>{a.value&&(clearInterval(a.value),a.value=null),t.value=!1,u.value=!0,o.value={duration:s.value,notes:n.value,transcription:d,channel:"phone"}},i=async x=>{try{await navigator.clipboard.writeText(x),alert("Phone number copied to clipboard!")}catch(N){console.error("Failed to copy:",N)}},m=x=>(p.value={tradeIn:d.leadLines.some(N=>N.toLowerCase().includes("trade")||N.toLowerCase().includes("exchange"))||!1,financing:d.leadLines.some(N=>N.toLowerCase().includes("financ")||N.toLowerCase().includes("payment")||N.toLowerCase().includes("loan"))||!1},p.value.tradeIn&&x&&(x.value.tradeIn=!0),p.value.financing&&x&&(x.value.financing=!0),p.value),w=()=>{t.value=!1,u.value=!1,s.value=0,n.value="",o.value={},a.value&&(clearInterval(a.value),a.value=null)};return qt(()=>{a.value&&clearInterval(a.value)}),{isCallActive:t,callEnded:u,callDuration:s,callNotes:n,callData:o,extractedData:p,mockTranscription:d,formattedCallDuration:f,startCall:v,endCall:r,copyNumber:i,extractInformation:m,resetCall:w}}function In(t,u,s,n,a,o){var ye,fe,xe;const p=I(!1),d=I(null),f=I(!1),v=I(null),r=I(!1),i=I(!1),m=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],w=I("whatsapp"),x=I("followup-1"),N=I("custom"),F=I(""),C=I("09:00"),k=I("Not Interested"),b=I(""),y=I({dealership:((fe=(ye=t.value)==null?void 0:ye.requestedCar)==null?void 0:fe.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((xe=o==null?void 0:o.value)==null?void 0:xe.id)||null}),D=I({tradeIn:!1,financing:!1,contactAvailability:!1}),V=L(()=>{var he,ce,te,ne,me,E,W;const K=((te=(ce=(he=t.value)==null?void 0:he.customer)==null?void 0:ce.name)==null?void 0:te.split(" ")[0])||"",G=((me=(ne=t.value)==null?void 0:ne.requestedCar)==null?void 0:me.brand)||"",ge=((W=(E=t.value)==null?void 0:E.requestedCar)==null?void 0:W.model)||"";return{"followup-1":`Hi ${K}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${G} ${ge}?`,"followup-2":`Hello ${K}, this is regarding your inquiry about the ${G} ${ge}. Please let me know when you're available for a call.`,custom:""}}),P=L(()=>x.value==="custom"?"Type your custom message...":V.value[x.value]||""),Y=L(()=>{var K;return!!((K=t.value)!=null&&K.scheduledAppointment)});return{showOutcomeSelection:p,selectedOutcome:d,appointmentScheduled:f,scheduledAppointmentData:v,showNoteModal:r,showScheduleAppointmentModal:i,followupChannels:m,followupChannel:w,selectedTemplate:x,rescheduleTime:N,customDate:F,customTime:C,disqualifyCategory:k,disqualifyReason:b,assignment:y,preferences:D,messageTemplates:V,messagePreview:P,hasExistingAppointment:Y,selectOutcome:K=>{d.value=K,K==="interested"&&(s!=null&&s.value)&&(D.value.tradeIn=s.value.tradeIn||!1,D.value.financing=s.value.financing||!1)},cancelOutcome:()=>{d.value=null,p.value=!1,f.value=!1,v.value=null},calculateNextCallDate:()=>{if(N.value==="tomorrow-9am"){const G=new Date;return G.setDate(G.getDate()+1),G.setHours(9,0,0,0),G.toISOString()}else if(N.value==="monday"){const G=new Date,ge=(8-G.getDay())%7||7;return G.setDate(G.getDate()+ge),G.setHours(9,0,0,0),G.toISOString()}else if(N.value==="custom"&&F.value&&C.value)return new Date(`${F.value}T${C.value}:00`).toISOString();const K=new Date;return K.setDate(K.getDate()+1),K.setHours(9,0,0,0),K.toISOString()},resetOutcomeState:()=>{d.value=null,p.value=!1,f.value=!1,v.value=null,w.value="whatsapp",x.value="followup-1",N.value="custom",F.value="",C.value="09:00",k.value="Not Interested",b.value=""}}}function Ln(t,u,s,n,a,o){const{callData:p}=u,{showOutcomeSelection:d,selectedOutcome:f,appointmentScheduled:v,scheduledAppointmentData:r,assignment:i,preferences:m,cancelOutcome:w,calculateNextCallDate:x,showScheduleAppointmentModal:N}=s;return{logManualCall:()=>{p.value={channel:"external",notes:"",transcription:null},d.value=!0},handleScheduleAppointmentConfirm:async P=>{r.value=P,v.value=!0,N.value=!1,t("appointment-scheduled",P)},handleQualify:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((Y=p.value)==null?void 0:Y.channel)||"phone",notes:((Z=p.value)==null?void 0:Z.notes)||"",transcription:((oe=p.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),t("validated",{scheduleFollowUp:!1}),t("qualified",{assignment:i.value,preferences:m.value,scheduleAppointment:v.value,appointmentData:r.value}),w()},handleDisqualifyFromInterested:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"interested",channel:((Y=p.value)==null?void 0:Y.channel)||"phone",notes:((Z=p.value)==null?void 0:Z.notes)||"",transcription:((oe=p.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),f.value="not-valid"},handleNoAnswerConfirm:async()=>{var be,H,ye;const P={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((be=p.value)==null?void 0:be.channel)||"phone",notes:((H=p.value)==null?void 0:H.notes)||"",transcription:((ye=p.value)==null?void 0:ye.transcription)||null};t("call-attempt-logged",P);const Y=x(),Z=Y.split("T")[0],oe=new Date(Y).toTimeString().slice(0,5);t("postponed",{date:Z,time:oe,createAppointment:!0}),(a==null?void 0:a.value)+1>=(o==null?void 0:o.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"}),w()},handleNotValidConfirm:()=>{var Y,Z,oe;const P={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((Y=p.value)==null?void 0:Y.channel)||"phone",notes:((Z=p.value)==null?void 0:Z.notes)||"",transcription:((oe=p.value)==null?void 0:oe.transcription)||null};t("call-attempt-logged",P),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),w()},handleNoteSave:P=>{s.showNoteModal.value=!1,t("note-saved",P)}}}const qn={key:0,class:"flex gap-2 items-center mb-4"},Nn=["disabled"],Mn={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Rn=["disabled"],Fn={key:1,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Vn={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Bn={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Un={class:"flex items-center gap-2 text-red-400"},Wn={class:"text-xs font-mono"},En={class:"space-y-3 text-sm font-mono"},jn={class:"ml-2"},Pn={class:"ml-2"},Hn={key:0},Qn={class:"ml-2"},zn={key:1},Yn={class:"ml-2"},Kn={key:2},Gn={class:"ml-2"},Jn={class:"mt-4 pt-4 border-t border-slate-700"},Xn=["model-value"],Zn={class:"mt-4 flex justify-end"},_n={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},el={class:"flex items-center justify-between"},tl={class:"flex gap-2"},sl={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes"],setup(t){return(u,s)=>(c(),h("div",null,[!t.showOutcomeSelection&&!t.isCallActive&&!t.callEnded?(c(),h("div",qn,[e("button",{onClick:s[0]||(s[0]=n=>u.$emit("start-call")),disabled:t.isCallActive,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone"},null,-1)),R(" "+$(t.contactAttempts>0?"Call Again":"Initiate Call")+" ",1),t.contactAttempts>0?(c(),h("span",Mn,$(t.contactAttempts+1)+"/"+$(t.maxContactAttempts),1)):A("",!0)],8,Nn),e("button",{onClick:s[1]||(s[1]=n=>u.$emit("log-manual-call")),disabled:t.isCallActive,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),R(" Log Call Outcome ",-1)])],8,Rn)])):A("",!0),t.isCallActive||t.callEnded?(c(),h("div",Fn,[t.isCallActive?(c(),h("div",Vn,[e("div",Bn,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Un,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Wn,"REC "+$(t.formattedCallDuration),1)])]),e("div",En,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",jn,$(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Pn,$(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(c(),h("div",Hn,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Qn,$(t.mockTranscription.leadLines[1]),1)])):A("",!0),t.callDuration>=8?(c(),h("div",zn,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Yn,$(t.mockTranscription.salesLines[1]),1)])):A("",!0),t.callDuration>=12?(c(),h("div",Kn,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Gn,$(t.mockTranscription.leadLines[2]),1)])):A("",!0)]),e("div",Jn,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=n=>u.$emit("update:call-notes",n)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Xn)]),e("div",Zn,[e("button",{onClick:s[3]||(s[3]=n=>u.$emit("end-call")),class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[15]||(s[15]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),R(" End Call ",-1)])])])])):A("",!0),t.callEnded&&!t.isCallActive?(c(),h("div",_n,[e("div",el,[s[18]||(s[18]=e("div",null,[e("h4",{class:"font-bold text-gray-900 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",tl,[e("button",{onClick:s[4]||(s[4]=n=>u.$emit("extract-information")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[16]||(s[16]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),R(" Extract information ",-1)])]),e("button",{onClick:s[5]||(s[5]=n=>u.$emit("log-manual-call")),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[17]||(s[17]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),R(" Log outcome ",-1)])])])])])):A("",!0)])):A("",!0)]))}},ol={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},nl={class:"flex justify-between items-start mb-3"},ll={class:"font-bold text-gray-900 text-sm"},al={class:"text-xs text-gray-500 mt-0.5"},il={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},rl={class:"text-xs text-blue-700"},dl={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},ul={class:"flex items-center justify-between"},cl={class:"flex items-center gap-2"},pl={class:"text-xs font-bold text-gray-900"},ml={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},yl={class:"flex items-center gap-2 mb-3"},gl={class:"text-sm text-gray-700 font-medium"},fl={key:2,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},vl={class:"grid grid-cols-3 gap-2"},bl={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},xl={class:"grid grid-cols-4 gap-2"},hl=["onClick"],wl={key:0},kl={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Cl={class:"text-xs text-gray-700"},$l={class:"grid grid-cols-3 gap-2"},Sl={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Al={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},Dl={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},Tl={class:"flex gap-4"},Ol={class:"flex items-center gap-2 cursor-pointer"},Il={class:"flex items-center gap-2 cursor-pointer"},Ll={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},ql=["disabled"],Nl={key:2,class:"space-y-4"},Ml={class:"bg-white border border-gray-200 rounded-lg p-4"},Rl={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Fl=["value"],Vl=["value"],Bl=["value"],Ul={class:"bg-white border border-gray-200 rounded-lg p-4"},Wl={class:"flex gap-2"},El={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},jl={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Pl={class:"ml-2 font-medium text-gray-900"},Hl={class:"ml-2 font-medium text-gray-900"},Ql={class:"ml-2 font-medium text-gray-900 capitalize"},zl={class:"ml-2 font-medium text-gray-900"},Yl={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},Kl={class:"space-y-2"},Gl=["checked"],Jl=["checked","disabled"],Xl={class:"flex-1"},Zl={class:"text-xs text-gray-500 mt-0.5"},_l={class:"space-y-3"},ea={class:"grid grid-cols-2 gap-3 text-sm"},ta={class:"ml-2 font-medium text-gray-900"},sa={class:"ml-2 font-medium text-gray-900"},oa={class:"ml-2 font-medium text-gray-900 capitalize"},na={class:"ml-2 font-medium text-gray-900"},la={key:0,class:"text-sm"},aa={class:"ml-2 font-medium text-gray-900"},ia={key:1,class:"text-sm"},ra={class:"mt-1 text-gray-700"},da={class:"flex justify-between items-center pt-3 border-t border-gray-200"},ua={class:"flex gap-2"},ca={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(t,{emit:u}){const s=t,n=re=>{re||(me.value=!1)},a=u,o=Xe(),p=Ee();Oe();const d=$t(()=>s.lead,{}),f=On(),{isCallActive:v,callEnded:r,callDuration:i,callNotes:m,callData:w,extractedData:x,mockTranscription:N,formattedCallDuration:F,startCall:C,endCall:k,extractInformation:b}=f,y=I(null),D=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],V=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],P=L(()=>o.assignableUsers),Y=L(()=>p.currentUser),Z=()=>{C()},oe=re=>{m.value=re},be=L(()=>{var re;return((re=d.primaryAction.value)==null?void 0:re.title)||"Call to Verify Contact Details"}),H=L(()=>{var re;return((re=d.primaryAction.value)==null?void 0:re.description)||"Begin lead qualification by verifying customer contact information."}),ye=L(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),fe=L(()=>!!s.lead.scheduledAppointment),xe=L(()=>fe.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:ye.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${vt(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),K=d.contactAttempts,G=d.maxContactAttempts,ge=In(Ue(s,"lead"),w,x,K,G,Y),{showOutcomeSelection:he,selectedOutcome:ce,appointmentScheduled:te,scheduledAppointmentData:ne,showNoteModal:me,showScheduleAppointmentModal:E,followupChannels:W,followupChannel:ee,selectedTemplate:je,rescheduleTime:ke,customDate:S,customTime:B,disqualifyCategory:J,disqualifyReason:le,assignment:q,messagePreview:Q,hasExistingAppointment:de,selectOutcome:Te,cancelOutcome:Ve}=ge;L(()=>s.activities.filter(re=>re.type==="note"));const Dt=Ln(a,f,ge,Ue(s,"lead"),K,G),{logManualCall:Tt,handleScheduleAppointmentConfirm:Ot,handleQualify:lt,handleDisqualifyFromInterested:at,handleNoAnswerConfirm:it,handleNotValidConfirm:rt,handleNoteSave:It}=Dt;return(re,g)=>(c(),h("div",ol,[e("div",nl,[e("div",null,[e("h4",ll,$(be.value),1),e("p",al,$(H.value),1)]),e("div",{class:U(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",xe.value.class])},$(xe.value.text),3)]),fe.value?(c(),h("div",il,[g[33]||(g[33]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",rl,$(l(We)(t.lead.scheduledAppointment.start))+" at "+$(l(Pe)(t.lead.scheduledAppointment.start)),1)])):A("",!0),l(K)>0?(c(),h("div",dl,[e("div",ul,[e("div",cl,[g[34]||(g[34]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),g[35]||(g[35]=e("span",{class:"text-xs font-semibold text-gray-700"},"Contact Attempts:",-1)),e("span",pl,$(l(K))+" / "+$(l(G)),1)]),l(K)>=l(G)-1?(c(),h("div",ml,[...g[36]||(g[36]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),R(" One more attempt before auto-disqualification ",-1)])])):A("",!0)])])):A("",!0),e("div",yl,[e("span",gl,$(t.lead.customer.phone),1),e("button",{onClick:g[0]||(g[0]=(...M)=>re.copyNumber&&re.copyNumber(...M)),class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...g[37]||(g[37]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),O(sl,{"is-call-active":l(v),"call-ended":l(r),"call-duration":l(i),"call-notes":l(m),"formatted-call-duration":l(F),"mock-transcription":l(N),"show-outcome-selection":l(he),"contact-attempts":l(K),"max-contact-attempts":l(G),onStartCall:Z,onEndCall:l(k),onLogManualCall:l(Tt),onExtractInformation:l(b),"onUpdate:callNotes":oe},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"]),l(he)?(c(),h("div",fl,[e("div",null,[g[41]||(g[41]=e("h4",{class:"font-semibold text-gray-900 mb-2 text-sm"},"What's the outcome?",-1)),e("div",vl,[e("button",{onClick:g[1]||(g[1]=M=>l(Te)("no-answer")),class:U(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l(ce)==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...g[38]||(g[38]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:g[2]||(g[2]=M=>l(Te)("not-valid")),class:U(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l(ce)==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...g[39]||(g[39]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:g[3]||(g[3]=M=>l(Te)("interested")),class:U(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",l(ce)==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...g[40]||(g[40]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),l(ce)==="no-answer"?(c(),h("div",bl,[g[49]||(g[49]=e("h5",{class:"font-semibold text-gray-900 text-sm"},"Send follow-up message",-1)),e("div",xl,[(c(!0),h(ie,null,ue(l(W),M=>(c(),h("button",{key:M.value,onClick:Ze=>ee.value=M.value,class:U(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",l(ee)===M.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},$(M.label),11,hl))),128))]),l(ee)&&l(ee)!=="dont-send"?(c(),h("div",wl,[g[44]||(g[44]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),z(e("select",{"onUpdate:modelValue":g[4]||(g[4]=M=>Be(je)?je.value=M:null),class:"input"},[...g[42]||(g[42]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[we,l(je)]]),e("div",kl,[g[43]||(g[43]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",Cl,$(l(Q)),1)])])):A("",!0),e("div",null,[g[47]||(g[47]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-2"},"Next call attempt",-1)),e("div",$l,[e("button",{onClick:g[5]||(g[5]=M=>ke.value="tomorrow-9am"),class:U(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",l(ke)==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:g[6]||(g[6]=M=>ke.value="monday"),class:U(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",l(ke)==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:g[7]||(g[7]=M=>ke.value="custom"),class:U(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",l(ke)==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),l(ke)==="custom"?(c(),h("div",Sl,[e("div",null,[g[45]||(g[45]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":g[8]||(g[8]=M=>Be(S)?S.value=M:null),class:"input"},null,512),[[ae,l(S)]])]),e("div",null,[g[46]||(g[46]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),z(e("input",{type:"time","onUpdate:modelValue":g[9]||(g[9]=M=>Be(B)?B.value=M:null),class:"input"},null,512),[[ae,l(B)]])])])):A("",!0)]),e("div",Al,[e("button",{onClick:g[10]||(g[10]=(...M)=>l(Ve)&&l(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:g[11]||(g[11]=(...M)=>l(it)&&l(it)(...M)),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...g[48]||(g[48]=[R(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):A("",!0),l(ce)==="not-valid"?(c(),h("div",Dl,[e("div",null,[g[52]||(g[52]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",Tl,[e("label",Ol,[z(e("input",{type:"radio","onUpdate:modelValue":g[12]||(g[12]=M=>Be(J)?J.value=M:null),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,l(J)]]),g[50]||(g[50]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",Il,[z(e("input",{type:"radio","onUpdate:modelValue":g[13]||(g[13]=M=>Be(J)?J.value=M:null),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[et,l(J)]]),g[51]||(g[51]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[g[54]||(g[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),z(e("select",{"onUpdate:modelValue":g[14]||(g[14]=M=>Be(le)?le.value=M:null),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...g[53]||(g[53]=[Ge('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[we,l(le)]])]),e("div",Ll,[e("button",{onClick:g[15]||(g[15]=(...M)=>l(Ve)&&l(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:g[16]||(g[16]=(...M)=>l(rt)&&l(rt)(...M)),disabled:!l(J)||!l(le),class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,ql)])])):A("",!0),l(ce)==="interested"?(c(),h("div",Nl,[e("div",Ml,[g[58]||(g[58]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-3"},"Assign to salesman",-1)),e("div",Rl,[e("div",null,[g[55]||(g[55]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),z(e("select",{"onUpdate:modelValue":g[17]||(g[17]=M=>l(q).dealership=M),class:"input"},[(c(),h(ie,null,ue(D,M=>e("option",{key:M,value:M},$(M),9,Fl)),64))],512),[[we,l(q).dealership]])]),e("div",null,[g[56]||(g[56]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),z(e("select",{"onUpdate:modelValue":g[18]||(g[18]=M=>l(q).team=M),class:"input"},[(c(),h(ie,null,ue(V,M=>e("option",{key:M,value:M},$(M),9,Vl)),64))],512),[[we,l(q).team]])]),e("div",null,[g[57]||(g[57]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),z(e("select",{"onUpdate:modelValue":g[19]||(g[19]=M=>l(q).assigneeId=M),class:"input"},[(c(!0),h(ie,null,ue(P.value,M=>(c(),h("option",{key:M.id,value:M.id},$(M.name)+$(M.id===Y.value.id?" (Me)":""),9,Bl))),128))],512),[[we,l(q).assigneeId]])])])]),e("div",Ul,[g[62]||(g[62]=e("h5",{class:"font-semibold text-gray-900 text-sm mb-3"},"Customer preferences",-1)),e("div",Wl,[e("button",{onClick:g[20]||(g[20]=M=>a("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...g[59]||(g[59]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),R(" Add purchase method ",-1)])]),e("button",{onClick:g[21]||(g[21]=M=>a("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...g[60]||(g[60]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),R(" Add trade-in ",-1)])]),e("button",{onClick:g[22]||(g[22]=M=>me.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...g[61]||(g[61]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),R(" Add note ",-1)])])])]),l(de)&&!l(te)?(c(),h("div",El,[g[68]||(g[68]=Ge('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-gray-900">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",jl,[e("div",null,[g[63]||(g[63]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Pl,$(l(We)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[g[64]||(g[64]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Hl,$(l(Pe)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[g[65]||(g[65]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Ql,$(t.lead.scheduledAppointment.type),1)]),e("div",null,[g[66]||(g[66]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",zl,$(t.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:g[23]||(g[23]=M=>E.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...g[67]||(g[67]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),R(" Reschedule Appointment ",-1)])])])):A("",!0),l(de)?A("",!0):(c(),h("div",Yl,[g[71]||(g[71]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",Kl,[e("label",{class:U(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!l(te)}])},[e("input",{type:"radio",checked:!l(te),onChange:g[24]||(g[24]=()=>{te.value=!1,ne.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Gl),g[69]||(g[69]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-gray-900"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:U(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":l(te)}]),onClick:g[26]||(g[26]=M=>!l(te)&&(E.value=!0))},[e("input",{type:"radio",checked:l(te),disabled:!l(te),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Jl),e("div",Xl,[g[70]||(g[70]=e("div",{class:"text-sm font-semibold text-gray-900"},"Schedule Appointment",-1)),e("div",Zl,$(l(te)?"Appointment scheduled":"Book a meeting or test drive"),1)]),l(te)?(c(),h("button",{key:0,onClick:g[25]||(g[25]=Se(M=>E.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):A("",!0)],2)])])),l(te)?(c(),j(Tn,{key:2,title:"Scheduled Appointment","show-close":!1},{default:T(()=>[e("div",_l,[e("div",ea,[e("div",null,[g[72]||(g[72]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",ta,$(l(We)(l(ne).datetime)),1)]),e("div",null,[g[73]||(g[73]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",sa,$(l(ne).time),1)]),e("div",null,[g[74]||(g[74]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",oa,$(l(ne).type),1)]),e("div",null,[g[75]||(g[75]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",na,$(l(ne).assignee),1)])]),l(ne).location?(c(),h("div",la,[g[76]||(g[76]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",aa,$(l(ne).location),1)])):A("",!0),l(ne).notes?(c(),h("div",ia,[g[77]||(g[77]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",ra,$(l(ne).notes),1)])):A("",!0)])]),_:1})):A("",!0),e("div",da,[e("button",{onClick:g[27]||(g[27]=(...M)=>l(Ve)&&l(Ve)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",ua,[e("button",{onClick:g[28]||(g[28]=(...M)=>l(at)&&l(at)(...M)),class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...g[78]||(g[78]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),R(" Disqualify ",-1)])]),e("button",{onClick:g[29]||(g[29]=(...M)=>l(lt)&&l(lt)(...M)),class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...g[79]||(g[79]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),R(" Qualify ",-1)])])])])])):A("",!0)])):A("",!0),O(l(Fe),{open:l(me),"onUpdate:open":n},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-2xl"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...g[80]||(g[80]=[R("Add Note",-1)])]),_:1})]),_:1}),O(Bt,{ref_key:"noteWidgetRef",ref:y,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:l(It),onCancel:g[30]||(g[30]=M=>me.value=!1)},null,8,["task-id","onSave"]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>{var M,Ze;return[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:g[31]||(g[31]=_i=>me.value=!1)}),O(l(pe),{label:"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!((M=y.value)!=null&&M.canSubmit()),onClick:(Ze=y.value)==null?void 0:Ze.submit},null,8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),O($n,{show:l(E),onConfirm:l(Ot),onClose:g[32]||(g[32]=M=>E.value=!1)},null,8,["show","onConfirm"])]))}},pa={key:0,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},ma={class:"flex justify-between items-start mb-3"},ya={class:"text-xs text-gray-500 mt-0.5"},ga={key:0},fa={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:u}){const s=t,n=u,a=He(),o=()=>{var b;const k=a.currentLead;return k&&k.id===((b=s.lead)==null?void 0:b.id)?k:s.lead},p={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},d=$t(Ue(s,"lead"),p),{handlePostponed:f,handleValidated:v,handleQualified:r,handleCallAttemptLogged:i,handleNoteSaved:m,handleOpenPurchaseMethod:w,handleOpenTradeIn:x,handleAppointmentScheduled:N,handleDisqualified:F,handleReopen:C}=nn({getLead:o,leadState:d,emit:n});return(k,b)=>(c(),j(St,{task:t.lead},{"deadline-banner":T(()=>[O(yn,{"next-action-due":t.lead.nextActionDue,"is-closed":l(d).isClosed.value,"show-deadline-banner":l(d).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":T(()=>[!l(d).isClosed.value&&l(d).showLQWidget.value?(c(),j(ca,{key:t.lead.id,lead:t.lead,onPostponed:l(f),onValidated:l(v),onQualified:l(r),onDisqualified:l(F),onCallAttemptLogged:l(i),onNoteSaved:l(m),onOpenPurchaseMethod:l(w),onOpenTradeIn:l(x),onAppointmentScheduled:l(N)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!l(d).isClosed.value&&l(d).primaryAction.value?(c(),j(At,{key:1,action:l(d).primaryAction.value,"color-scheme":l(d).primaryAction.value.colorScheme,onActionClicked:l(d).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):A("",!0)]),"task-widgets":T(()=>[...b[1]||(b[1]=[])]),"closed-state":T(()=>[l(d).isClosed.value?(c(),h("div",pa,[e("div",ma,[e("div",null,[b[2]||(b[2]=e("h4",{class:"font-bold text-gray-900 text-sm"},"Lead Closed",-1)),e("p",ya,[R(" Status: "+$(l(d).displayStage.value)+" ",1),t.lead.disqualifyReason?(c(),h("span",ga," - "+$(t.lead.disqualifyReason),1)):A("",!0)])])]),e("button",{onClick:b[0]||(b[0]=(...y)=>l(C)&&l(C)(...y)),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...b[3]||(b[3]=[R(" Reopen Lead ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):A("",!0)]),_:1},8,["task"]))}},va={class:"flex justify-between items-start mb-3"},ba={class:"font-bold text-gray-900 text-sm"},xa={class:"text-xs text-gray-500 mt-0.5"},ha={class:"flex gap-3 flex-wrap"},Ae={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(u,s)=>(c(),h("div",{class:U(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",va,[e("div",null,[e("h4",ba,$(t.title),1),e("p",xa,$(t.description),1)]),X(u.$slots,"badge")]),e("div",ha,[X(u.$slots,"actions")]),X(u.$slots,"survey"),X(u.$slots,"content")],2))}},wa={class:"mt-1.5 border-t border-gray-200 pt-1.5"},ka={key:1},Ca={class:"flex items-center justify-between mb-1.5"},$a={class:"space-y-1.5"},Sa={class:"block label-upper mb-1"},Aa=["onUpdate:modelValue","placeholder"],Da=["onUpdate:modelValue"],Ta=["value"],Oa={key:2,class:"space-y-0.5"},Ia=["onUpdate:modelValue","value"],De={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=I(!1),o=I({});ve(()=>s.questions,r=>{const i={};r.forEach(m=>{i[m.key]=""}),o.value=i},{immediate:!0});const p=()=>{n("survey-completed",{...o.value}),v()},d=()=>{n("survey-refused"),v()},f=()=>{n("not-responding"),v()},v=()=>{a.value=!1;const r={};s.questions.forEach(i=>{r[i.key]=""}),o.value=r};return(r,i)=>(c(),h("div",wa,[a.value?(c(),h("div",ka,[e("div",Ca,[i[4]||(i[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:i[1]||(i[1]=m=>a.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...i[3]||(i[3]=[e("i",{class:"fa-solid fa-chevron-up text-xs"},null,-1)])])]),e("div",$a,[(c(!0),h(ie,null,ue(t.questions,(m,w)=>(c(),h("div",{key:w,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Sa,$(m.label),1),m.type==="text"?z((c(),h("textarea",{key:0,"onUpdate:modelValue":x=>o.value[m.key]=x,placeholder:m.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Aa)),[[ae,o.value[m.key]]]):m.type==="select"?z((c(),h("select",{key:1,"onUpdate:modelValue":x=>o.value[m.key]=x,class:"input text-xs py-1 px-2"},[i[5]||(i[5]=e("option",{value:""},"Select an option...",-1)),(c(!0),h(ie,null,ue(m.options,x=>(c(),h("option",{key:x,value:x},$(x),9,Ta))),128))],8,Da)),[[we,o.value[m.key]]]):m.type==="radio"?(c(),h("div",Oa,[(c(!0),h(ie,null,ue(m.options,x=>(c(),h("label",{key:x,class:"flex items-center text-xs"},[z(e("input",{type:"radio","onUpdate:modelValue":N=>o.value[m.key]=N,value:x,class:"mr-1"},null,8,Ia),[[et,o.value[m.key]]]),R(" "+$(x),1)]))),128))])):A("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(c(),h("button",{key:0,onClick:i[0]||(i[0]=m=>a.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...i[2]||(i[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1)])]))]))}},La={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],o=L(()=>{if(!s.opportunity.createdAt)return 0;const i=new Date(s.opportunity.createdAt),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),p=()=>{n("create-offer",s.opportunity)},d=()=>{n("review",s.opportunity)},f=i=>{n("survey-completed",{opportunity:s.opportunity,responses:i})},v=()=>{n("survey-refused",{opportunity:s.opportunity})},r=()=>{n("not-responding",{opportunity:s.opportunity})};return(i,m)=>(c(),j(Ae,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${o.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:f,onSurveyRefused:v,onNotResponding:r})]),_:1},8,["description"]))}},qa={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],o=L(()=>{if(!s.opportunity.createdAt)return 0;const r=new Date(s.opportunity.createdAt),m=Math.abs(new Date-r);return Math.ceil(m/(1e3*60*60*24))}),p=()=>{n("create-offer",s.opportunity)},d=r=>{n("survey-completed",{opportunity:s.opportunity,responses:r})},f=()=>{n("survey-refused",{opportunity:s.opportunity})},v=()=>{n("not-responding",{opportunity:s.opportunity})};return(r,i)=>(c(),j(Ae,{title:"Unsold Feedback",description:`This opportunity has been open for ${o.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:d,onSurveyRefused:f,onNotResponding:v})]),_:1},8,["description"]))}},Na={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],o=()=>{n("schedule-closing",s.opportunity)},p=v=>{n("survey-completed",{opportunity:s.opportunity,responses:v})},d=()=>{n("survey-refused",{opportunity:s.opportunity})},f=()=>{n("not-responding",{opportunity:s.opportunity})};return(v,r)=>(c(),j(Ae,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:T(()=>[e("button",{onClick:o,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:p,onSurveyRefused:d,onNotResponding:f})]),_:1}))}},Ma={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],o=L(()=>{const r=s.opportunity.lastActivity||s.opportunity.createdAt;if(!r)return 0;const i=new Date(r),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),p=()=>{n("create-contract",s.opportunity)},d=r=>{n("survey-completed",{opportunity:s.opportunity,responses:r})},f=()=>{n("survey-refused",{opportunity:s.opportunity})},v=()=>{n("not-responding",{opportunity:s.opportunity})};return(r,i)=>(c(),j(Ae,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${o.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:d,onSurveyRefused:f,onNotResponding:v})]),_:1},8,["description"]))}},Ra={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],o=L(()=>{var x;if(!((x=s.opportunity)!=null&&x.contractDate))return 0;const i=new Date(s.opportunity.contractDate),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),p=()=>{n("prepare-delivery",s.opportunity)},d=()=>{n("pre-delivery-checklist",s.opportunity)},f=i=>{n("survey-completed",{opportunity:s.opportunity,responses:i})},v=()=>{n("survey-refused",{opportunity:s.opportunity})},r=()=>{n("not-responding",{opportunity:s.opportunity})};return(i,m)=>(c(),j(Ae,{title:"Contract Feedback",description:`Contract was signed ${o.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:f,onSurveyRefused:v,onNotResponding:r})]),_:1},8,["description"]))}},Fa={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u,a=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],o=L(()=>{const r=s.activities.find(x=>{var N;return x.type==="delivery"||((N=x.action)==null?void 0:N.toLowerCase().includes("delivered"))});if(!r||!r.timestamp)return 0;const i=new Date(r.timestamp),w=Math.abs(new Date-i);return Math.ceil(w/(1e3*60*60*24))}),p=()=>{n("delivery-feedback",s.opportunity)},d=r=>{n("survey-completed",{opportunity:s.opportunity,responses:r})},f=()=>{n("survey-refused",{opportunity:s.opportunity})},v=()=>{n("not-responding",{opportunity:s.opportunity})};return(r,i)=>(c(),j(Ae,{title:"Delivery Feedback",description:`Vehicle was delivered ${o.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:d,onSurveyRefused:f,onNotResponding:v})]),_:1},8,["description"]))}},Va={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:u}){const s=t,n=u,a=L(()=>{var x;return((x=s.scheduledAppointment)==null?void 0:x.noShowCount)||0}),o=L(()=>{const x=a.value;return x===0?"No-Show Follow-up":x>=3?`No-Show #${x} - Final Warning`:`No-Show #${x} Follow-up`}),p=L(()=>{const x=a.value;return x>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":x>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),d=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],f=L(()=>{var N;return(N=s.scheduledAppointment)!=null&&N.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),v=()=>{n("contact-customer",s.opportunity)},r=()=>{const x=a.value;if(x>=3)n("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${x} no-shows`});else if(x===1||x===2){const N=new Date;N.setDate(N.getDate()+2),n("set-callback",{opportunity:s.opportunity,callbackDate:N.toISOString()})}else n("reschedule",s.opportunity)},i=x=>{n("survey-completed",{opportunity:s.opportunity,responses:x})},m=()=>{n("survey-refused",{opportunity:s.opportunity})},w=()=>{n("not-responding",{opportunity:s.opportunity})};return(x,N)=>(c(),j(Ae,{title:o.value,description:`Appointment was scheduled for ${f.value} but customer did not show up. ${p.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:T(()=>[e("button",{onClick:r,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...N[0]||(N[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),R(" Book Another Appointment ",-1)])]),e("button",{onClick:v,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...N[1]||(N[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),R(" Contact Customer ",-1)])])]),survey:T(()=>[O(De,{questions:d,onSurveyCompleted:i,onSurveyRefused:m,onNotResponding:w})]),_:1},8,["title","description"]))}},Ba={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:u}){const s=t,n=u;Oe();const a=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],o=L(()=>{const m=s.opportunity.lastActivity||s.opportunity.createdAt;if(!m)return 0;const w=new Date(m),N=Math.abs(new Date-w);return Math.ceil(N/(1e3*60*60*24))}),p=()=>{n("reopen",s.opportunity)},d=()=>{n("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},f=()=>{n("requalify",s.opportunity)},v=m=>{n("survey-completed",{opportunity:s.opportunity,responses:m})},r=()=>{n("survey-refused",{opportunity:s.opportunity})},i=()=>{n("not-responding",{opportunity:s.opportunity})};return(m,w)=>(c(),j(Ae,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${o.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-gray-50/50",border:"border-gray-100"}},{actions:T(()=>[e("button",{onClick:p,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...w[0]||(w[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),R(" Reopen Opportunity ",-1)])]),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...w[1]||(w[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),R(" Close as Lost ",-1)])]),e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...w[2]||(w[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),R(" Requalify as Lead ",-1)])])]),survey:T(()=>[O(De,{questions:a,onSurveyCompleted:v,onSurveyRefused:r,onNotResponding:i})]),_:1},8,["description"]))}},Ua={OOFB:La,UFB:qa,NFU:Na,OFB:Ma,CFB:Ra,DFB:Fa,NS:Va,ABANDONED:Ba};function Wa(t,u,s,n,a){const o=L(()=>{const m=Ye(t),w=Ye(u),x=Ye(s);return{opportunity:m,scheduledAppointment:w,activities:x,hasOffers:(x==null?void 0:x.some(N=>N.type==="offer"))||!1,stage:m.displayStage||m.stage,deliverySubstatus:m.deliverySubstatus||null,formatDateTime:a,hasActiveTaskWidget:!1}}),p=L(()=>{const m=o.value,w=Ut(m.stage,m);if(!w)return null;const x=Ua[w];return x?{type:w,component:x,props:{opportunity:m.opportunity,appointment:m.scheduledAppointment,activities:m.activities}}:(console.warn(`No component found for widget type: ${w}`),null)}),d=L(()=>({...o.value,hasActiveTaskWidget:!!p.value})),f=L(()=>{const m=d.value,w=Wt(m.stage,m);if(!w)return null;const x=n[w.key];return{...w,handler:x||(()=>console.warn(`No handler for action: ${w.key}`))}}),v=L(()=>{const m=d.value;return Et(m.stage,m).map(x=>{const N=n[x.key];return{...x,handler:N||(()=>console.warn(`No handler for action: ${x.key}`))}})}),r=L(()=>{const m=o.value;return jt(m.stage)}),i=L(()=>!p.value||!p.value.type?"":Pt(p.value.type));return{primaryAction:f,secondaryActions:v,activeTaskWidget:p,taskWidgetTitle:i,isClosed:r}}const Ea=["disabled"],ja={key:0,class:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden max-h-96 overflow-y-auto min-w-full",style:{"z-index":"9999"}},Pa=["onClick","disabled"],Ha={class:"flex-1"},Qa={class:"font-medium text-slate-700"},za={key:0,class:"text-xs text-gray-500 mt-0.5"},Ya={key:0,class:"px-4 py-3 text-sm text-gray-500 text-center"},Ka={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:u}){const s=u,n=I(!1),a=I(null),o=()=>{n.value=!n.value},p=()=>{n.value=!1},d=v=>{v.disabled||(p(),s("action-selected",v),v.handler&&typeof v.handler=="function"&&v.handler())},f=v=>{a.value&&!a.value.contains(v.target)&&p()};return Qe(()=>{document.addEventListener("click",f)}),Nt(()=>{document.removeEventListener("click",f)}),(v,r)=>(c(),h("div",{class:"relative",ref_key:"dropdownRef",ref:a},[e("button",{onClick:o,class:"w-auto bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[r[0]||(r[0]=e("span",null,"More actions",-1)),e("i",{class:U(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":n.value}])},null,2)],8,Ea),O(pt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:T(()=>[n.value?(c(),h("div",ja,[(c(!0),h(ie,null,ue(t.actions,i=>(c(),h("button",{key:i.key,onClick:m=>d(i),class:U(["w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-start gap-3 border-b border-gray-100 last:border-b-0 transition-colors whitespace-nowrap",{"opacity-50 cursor-not-allowed":i.disabled}]),disabled:i.disabled},[e("i",{class:U([i.icon,"text-gray-400 mt-0.5 w-4 flex-shrink-0"])},null,2),e("div",Ha,[e("div",Qa,$(i.label),1),i.description?(c(),h("div",za,$(i.description),1)):A("",!0)])],10,Pa))),128)),!t.actions||t.actions.length===0?(c(),h("div",Ya," No actions available ")):A("",!0)])):A("",!0)]),_:1})],512))}},Ga={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},Ja=["src","alt"],Xa={key:1,class:"w-full h-full flex items-center justify-center"},Za={class:"flex items-center justify-between mb-1.5"},_a={class:"text-sm font-bold text-gray-900"},ei={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},ti={class:"text-xs text-gray-500 mb-1.5"},si={key:0,class:"text-xs text-green-600 font-medium mb-2"},oi={key:1,class:"text-xs text-orange-600 font-medium mb-2"},ct={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const u=t,s=L(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[u.badge]||"gray"),n=a=>a?a.toLocaleString("en-US"):"0";return(a,o)=>(c(),h("div",{onClick:o[1]||(o[1]=p=>a.$emit("select")),class:U(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":t.selected}])},[e("div",Ga,[t.vehicle.image?(c(),h("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,Ja)):(c(),h("div",Xa,[...o[2]||(o[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",Za,[O(l(Ke),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",_a,"â‚¬"+$(n(t.vehicle.price)),1)]),e("h4",ei,$(t.vehicle.brand)+" "+$(t.vehicle.model),1),e("p",ti,$(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(c(),h("div",si,[o[3]||(o[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),R(" In stock ("+$(t.stockDays)+" days) ",1)])):(c(),h("div",oi,[...o[4]||(o[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),R(" Out of stock ",-1)])])),e("button",{onClick:o[0]||(o[0]=Se(p=>a.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},ni={class:"space-y-6"},li={key:0},ai={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},ii={class:"mb-4"},ri={class:"relative"},di={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},ui={key:1,class:"text-center py-8 text-gray-500"},ci={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},pi={key:0,class:"mt-4 space-y-3"},mi={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},yi={class:"flex justify-end"},gi=["disabled"],fi={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:u}){const s=t,n=u,a=b=>{b||n("close")},o=I(""),p=I(!1),d=I(null),f=I(null),v=I(null),r=I([]),i=I({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});Qe(async()=>{try{const b=await xt({});r.value=b.data||[]}catch(b){console.error("Failed to load vehicles:",b),r.value=[]}});const m=L(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),w=L(()=>{const b=[];if(s.requestedVehicle&&m.value&&b.push({...s.requestedVehicle,isRequested:!0}),r.value&&r.value.length>0){const y=r.value.filter(V=>s.requestedVehicle?V.brand!==s.requestedVehicle.brand||V.model!==s.requestedVehicle.model:!0),D=s.requestedVehicle&&m.value?3:4;b.push(...y.slice(0,D))}return b}),x=L(()=>{if(!r.value||r.value.length===0)return[];let b=[...r.value];if(o.value){const y=o.value.toLowerCase();b=b.filter(D=>D.brand.toLowerCase().includes(y)||D.model.toLowerCase().includes(y)||D.year.toString().includes(y))}return b}),N=L(()=>i.value.brand&&i.value.model&&i.value.year&&i.value.price>0),F=(b,y)=>{d.value=b,f.value=b.id||`custom-${Date.now()}`,v.value=y},C=()=>{if(!N.value)return;const b={...i.value,id:`custom-${Date.now()}`,isCustom:!0};F(b,"custom")},k=()=>{d.value&&(n("vehicle-selected",{vehicle:d.value,type:v.value}),n("close"),d.value=null,f.value=null,v.value=null,o.value="",p.value=!1,i.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(b,y)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":a},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-6xl"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...y[7]||(y[7]=[R("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",ni,[w.value.length?(c(),h("div",li,[y[8]||(y[8]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),R(" Recommended Vehicles ")],-1)),e("div",ai,[(c(!0),h(ie,null,ue(w.value,D=>(c(),j(ct,{key:D.id,vehicle:D,badge:D.isRequested?"Requested":"Recommended","stock-days":D.stockDays,selected:f.value===D.id,onSelect:V=>F(D,D.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):A("",!0),e("div",null,[y[11]||(y[11]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),R(" Browse Stock ")],-1)),e("div",ii,[e("div",ri,[y[9]||(y[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),z(e("input",{"onUpdate:modelValue":y[0]||(y[0]=D=>o.value=D),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[ae,o.value]])])]),x.value.length?(c(),h("div",di,[(c(!0),h(ie,null,ue(x.value,D=>(c(),j(ct,{key:D.id,vehicle:D,badge:"In Stock","stock-days":D.stockDays,selected:f.value===D.id,onSelect:V=>F(D,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(c(),h("div",ui,[...y[10]||(y[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[y[19]||(y[19]=e("h3",{class:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),R(" Configure Custom Vehicle ")],-1)),e("div",ci,[y[18]||(y[18]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:y[1]||(y[1]=D=>p.value=!p.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[y[12]||(y[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),R(" "+$(p.value?"Hide Configuration":"Build Custom Configuration"),1)]),p.value?(c(),h("div",pi,[e("div",mi,[e("div",null,[y[13]||(y[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),z(e("input",{"onUpdate:modelValue":y[2]||(y[2]=D=>i.value.brand=D),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[ae,i.value.brand]])]),e("div",null,[y[14]||(y[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),z(e("input",{"onUpdate:modelValue":y[3]||(y[3]=D=>i.value.model=D),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[ae,i.value.model]])]),e("div",null,[y[15]||(y[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),z(e("input",{"onUpdate:modelValue":y[4]||(y[4]=D=>i.value.year=D),type:"number",class:"input",placeholder:"2024"},null,512),[[ae,i.value.year]])]),e("div",null,[y[16]||(y[16]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (â‚¬)",-1)),z(e("input",{"onUpdate:modelValue":y[5]||(y[5]=D=>i.value.price=D),type:"number",class:"input",placeholder:"98000"},null,512),[[ae,i.value.price]])])]),e("div",yi,[e("button",{onClick:C,disabled:!N.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...y[17]||(y[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),R(" Use Custom Configuration ",-1)])],8,gi)])])):A("",!0)])])]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[6]||(y[6]=D=>b.$emit("close"))}),d.value?(c(),j(l(pe),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:k})):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},vi={class:"space-y-4"},bi=["max"],xi={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:u}){const s=t,n=u,a=I(""),o=I(""),p=I(""),d=L(()=>new Date().toISOString().split("T")[0]);ve(()=>s.show,i=>{if(i){const m=new Date;a.value=m.toISOString().split("T")[0],o.value=m.toTimeString().slice(0,5),p.value=""}});const f=()=>{if(!a.value)return;const i=o.value?`${a.value}T${o.value}:00`:`${a.value}T12:00:00`;n("confirm",{contractDate:i,notes:p.value})},v=()=>{n("cancel")},r=i=>{i||v()};return(i,m)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":r},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...m[3]||(m[3]=[R("Set Contract Signing Date",-1)])]),_:1}),O(l(ze),null,{default:T(()=>[...m[4]||(m[4]=[R("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",vi,[e("div",null,[m[5]||(m[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=w=>a.value=w),max:d.value,class:"input"},null,8,bi),[[ae,a.value]])]),e("div",null,[m[6]||(m[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),z(e("input",{type:"time","onUpdate:modelValue":m[1]||(m[1]=w=>o.value=w),class:"input"},null,512),[[ae,o.value]])]),e("div",null,[m[7]||(m[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),z(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=w=>p.value=w),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[ae,p.value]])])]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:v}),O(l(pe),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value,onClick:f},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},hi={class:"space-y-4"},wi=["max"],ki={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:u}){const s=t,n=u,a=I(""),o=I(""),p=I(""),d=I(""),f=L(()=>new Date().toISOString().split("T")[0]);ve(()=>s.show,m=>{if(m){const w=new Date;a.value=w.toISOString().split("T")[0],o.value=w.toTimeString().slice(0,5),p.value="",d.value=""}});const v=()=>{if(!a.value||!p.value)return;const m=o.value?`${a.value}T${o.value}:00`:`${a.value}T12:00:00`;n("confirm",{deliveryDate:m,location:p.value,notes:d.value})},r=()=>{n("cancel")},i=m=>{m||r()};return(m,w)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":i},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...w[4]||(w[4]=[R("Mark as Delivered",-1)])]),_:1}),O(l(ze),null,{default:T(()=>[...w[5]||(w[5]=[R("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",hi,[e("div",null,[w[6]||(w[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),z(e("input",{type:"date","onUpdate:modelValue":w[0]||(w[0]=x=>a.value=x),max:f.value,class:"input"},null,8,wi),[[ae,a.value]])]),e("div",null,[w[7]||(w[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),z(e("input",{type:"time","onUpdate:modelValue":w[1]||(w[1]=x=>o.value=x),class:"input"},null,512),[[ae,o.value]])]),e("div",null,[w[9]||(w[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),z(e("select",{"onUpdate:modelValue":w[2]||(w[2]=x=>p.value=x),class:"input"},[...w[8]||(w[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[we,p.value]])]),e("div",null,[w[10]||(w[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),z(e("textarea",{"onUpdate:modelValue":w[3]||(w[3]=x=>d.value=x),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[ae,d.value]])])]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:r}),O(l(pe),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value||!p.value,onClick:v},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ci={class:"space-y-4"},$i={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:u}){const s=t,n=u,a=I(""),o=I("");ve(()=>s.show,v=>{v&&(a.value="",o.value="")});const p=()=>{a.value&&n("confirm",{reason:a.value,notes:o.value})},d=()=>{n("cancel")},f=v=>{v||d()};return(v,r)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":f},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...r[2]||(r[2]=[R("Close as Lost",-1)])]),_:1}),O(l(ze),null,{default:T(()=>[...r[3]||(r[3]=[R("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",Ci,[e("div",null,[r[5]||(r[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),z(e("select",{"onUpdate:modelValue":r[0]||(r[0]=i=>a.value=i),class:"input"},[...r[4]||(r[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[we,a.value]])]),e("div",null,[r[6]||(r[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),z(e("textarea",{"onUpdate:modelValue":r[1]||(r[1]=i=>o.value=i),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[ae,o.value]])])]),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),O(l(pe),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!a.value,onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Si={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:u}){const s=u,n=a=>{a||s("cancel")};return(a,o)=>(c(),j(l(Fe),{open:t.show,"onUpdate:open":n},{default:T(()=>[O(l(Ie),null,{default:T(()=>[O(l(Le),{class:"fixed inset-0 z-50 bg-black/50"}),O(l(qe),{class:"w-full sm:max-w-lg"},{default:T(()=>[O(l(Ne),null,{default:T(()=>[O(l(Me),null,{default:T(()=>[...o[2]||(o[2]=[R("Requalify as Lead",-1)])]),_:1}),O(l(ze),null,{default:T(()=>[...o[3]||(o[3]=[R("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),o[4]||(o[4]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-sm text-gray-600"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),R(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),R(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),R(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),O(l(Re),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:T(()=>[O(l(pe),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:o[0]||(o[0]=p=>a.$emit("cancel"))}),O(l(pe),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:o[1]||(o[1]=p=>a.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ai={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},Di={class:"flex gap-3"},Ti={key:0,class:"space-y-3"},Oi={class:"flex items-center gap-2 pb-2 border-b border-gray-200"},Ii={class:"font-semibold text-gray-900 text-sm"},Li={key:0,class:"flex justify-end"},qi={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:u}){const s=t,n=u,a=ot(),o=Je(),p=I(!1),d=I(!1),f=I(!1),v=I(!1),r=I(!1),i=I(!1),m=I(!1),w=I(!1),x=I(!1),N=I(!1),F=I([]),C=L(()=>{var E,W;return((E=s.opportunity)==null?void 0:E.displayStage)||((W=s.opportunity)==null?void 0:W.stage)||"Qualified"});L(()=>mt(C.value,"opportunity"));function k(E){return E?new Date(E).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const b={"schedule-appointment":()=>{p.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?x.value=!0:p.value=!0},"select-vehicle":()=>{m.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?m.value=!0:d.value=!0},"call-prospect":()=>{w.value=!0},"follow-up-offer":()=>{w.value=!0},"request-decision":()=>{w.value=!0},"finalize-contract":()=>{v.value=!0},"schedule-delivery":()=>{r.value=!0},"confirm-delivery":()=>{r.value=!0},"collect-feedback":()=>{w.value=!0},reschedule:()=>{N.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&fe()},"close-won":()=>{v.value=!0},"add-offer":()=>{d.value=!0},"add-contract":()=>{v.value=!0},"extend-deadline":()=>{w.value=!0},"close-lost":()=>{f.value=!0},reopen:()=>{ge()},requalify:()=>{i.value=!0}},{primaryAction:y,secondaryActions:D,activeTaskWidget:V,taskWidgetTitle:P,isClosed:Y}=Wa(Ue(s,"opportunity"),Ue(s,"scheduledAppointment"),Ue(s,"activities"),b,k);function Z(E){}function oe(){}function be(E){m.value=!1,n("vehicle-selected",E),setTimeout(()=>{d.value=!0},300)}function H(E){d.value=!1,n("offer-created",E)}function ye(E){p.value=!1,n("appointment-scheduled",{...E,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function fe(){s.scheduledAppointment&&n("appointment-cancelled",s.scheduledAppointment.id)}function xe(E){v.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:E.contractDate})}function K(E){r.value=!1,o.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:E})}function G(E){f.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:E})}function ge(){o.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function he(E){i.value=!1,a.push(`/customer/${E.id}?type=lead`)}function ce(E){x.value=!1}function te(E){N.value=!1}function ne(E){o.updateOpportunity(s.opportunity.id,{callbackDate:E.callbackDate})}function me(E){o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:E.reason||"Multiple no-shows (NS3)"})}return Qe(async()=>{try{const W=(await xt({})).data||[];F.value=W.filter(ee=>ee.stockDays!==null&&ee.stockDays!==void 0).slice(0,5)}catch(E){console.error("Failed to load recommended cars:",E),F.value=[]}}),(E,W)=>(c(),h(ie,null,[O(St,{task:t.opportunity,"container-class":"mb-8"},{"closed-state":T(()=>[l(Y)&&!l(V)?(c(),h("div",Ai,[W[15]||(W[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-gray-900 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Di,[e("button",{onClick:ge,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...W[13]||(W[13]=[R(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:W[0]||(W[0]=ee=>i.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...W[14]||(W[14]=[R(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):A("",!0)]),"primary-action":T(()=>[!l(Y)&&l(y)?(c(),j(At,{key:0,action:l(y),"color-scheme":l(y).colorScheme,onActionClicked:W[1]||(W[1]=ee=>l(y).handler())},null,8,["action","color-scheme"])):A("",!0)]),"task-widgets":T(()=>[l(V)&&l(V).component?(c(),h("div",Ti,[e("div",Oi,[W[16]||(W[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Ii,$(l(P)),1)]),(c(),j(Mt(l(V).component),yt(l(V).props,{onClose:oe,onSetCallback:ne,onAutoCloseLost:me}),null,16))])):A("",!0)]),"secondary-actions":T(()=>[l(D).length>0?(c(),h("div",Li,[O(Ka,{actions:l(D),onActionSelected:Z},null,8,["actions"])])):A("",!0)]),_:1},8,["task"]),p.value?(c(),j(zt,{key:0,show:p.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:ye,onCancel:W[2]||(W[2]=ee=>p.value=!1)},null,8,["show","customer","assignee"])):A("",!0),m.value?(c(),j(fi,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":F.value,onVehicleSelected:be,onClose:W[3]||(W[3]=ee=>m.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):A("",!0),d.value?(c(),j(Ht,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:H,onClose:W[4]||(W[4]=ee=>d.value=!1)},null,8,["opportunity","vehicle"])):A("",!0),v.value?(c(),j(xi,{key:3,opportunity:t.opportunity,onContractSet:xe,onClose:W[5]||(W[5]=ee=>v.value=!1)},null,8,["opportunity"])):A("",!0),r.value?(c(),j(ki,{key:4,opportunity:t.opportunity,onDelivered:K,onClose:W[6]||(W[6]=ee=>r.value=!1)},null,8,["opportunity"])):A("",!0),f.value?(c(),j($i,{key:5,opportunity:t.opportunity,onClosed:G,onClose:W[7]||(W[7]=ee=>f.value=!1)},null,8,["opportunity"])):A("",!0),i.value?(c(),j(Si,{key:6,opportunity:t.opportunity,onRequalified:he,onClose:W[8]||(W[8]=ee=>i.value=!1)},null,8,["opportunity"])):A("",!0),w.value?(c(),j(Qt,{key:7,onClose:W[9]||(W[9]=ee=>w.value=!1)})):A("",!0),x.value&&t.scheduledAppointment?(c(),j(Yt,{key:8,show:x.value,event:t.scheduledAppointment,onClose:W[10]||(W[10]=ee=>x.value=!1),onEdit:W[11]||(W[11]=ee=>{x.value=!1,N.value=!0}),onDelete:ce},null,8,["show","event"])):A("",!0),N.value&&t.scheduledAppointment?(c(),j(Kt,{key:9,show:N.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:te,onCancel:W[12]||(W[12]=ee=>N.value=!1)},null,8,["show","event","customer"])):A("",!0)],64))}};function Ni(t){const u=He(),s=Je(),n=L(()=>t.value?t.value.type==="lead"?fa:qi:null),a=L(()=>t.value?t.value.type==="lead"?{currentActivities:L(()=>u.currentLeadActivities),addActivity:(p,d)=>u.addActivity(p,d),updateActivity:(p,d,f)=>u.updateActivity(p,d,f),deleteActivity:(p,d)=>u.deleteActivity(p,d),updateLead:(p,d)=>u.updateLead(p,d),loadLeadById:p=>u.fetchLeadById(p)}:{currentActivities:L(()=>s.currentOpportunityActivities),addActivity:(p,d)=>s.addActivity(p,d),updateActivity:(p,d,f)=>s.updateActivity(p,d,f),deleteActivity:(p,d)=>s.deleteActivity(p,d),addVehicle:(p,d)=>s.addVehicle(p,d),createOffer:(p,d)=>s.createOffer(p,d),updateOpportunity:(p,d)=>s.updateOpportunity(p,d),loadOpportunityById:p=>s.fetchOpportunityById(p)}:null),o=L(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:n,storeAdapter:a,addNewConfig:o}}function Mi(){const t=r=>{if(!r)return"No deadline";const i=gt(r);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:ft(r)},u=r=>{const i=r.type==="lead"?r.requestedCar:r.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},s=r=>r?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[r.type]||"bg-gray-50 text-gray-700":"",n=r=>{if(!r||!r.assignee)return{name:"Unassigned",initials:"?"};const i=r.assigneeInitials||r.assignee.split(" ").map(m=>m[0]).join("");return{name:r.assignee,initials:i}},a=r=>{if(!r||!r.customer||!r.customer.address)return null;const m=r.customer.address.split(",");return m.length>1&&m[m.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:u,getVehicleTypeBadgeClass:s,getOwnerInfo:n,getCustomerCity:a,getLocationDisplay:r=>{const i=a(r),m=r.source||"Unknown";return i?`${i} â€¢ ${m}`:m},getAssigneeInitials:r=>{if(!r)return"?";const i=r.split(" ");return i.length>=2?(i[0][0]+i[i.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()},getVehicleStatusDisplay:r=>{const i=r.type==="lead"?r.requestedCar:r.vehicle;if(!i)return"No vehicle";const m=u(r),w=m?m.label:i.type||"Unknown";let x="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?x=`${(i.kilometers/1e3).toFixed(0)}k`:x=`${i.kilometers}`),x?`${w} / ${x}`:w},getTaskStatusDisplay:r=>r.type==="lead"?r.status||"Unknown":r.stage||"Unknown",getStageBadgeClass:bt,getUnselectedClass:r=>r.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Ri(t){const u=He(),s=Je(),n=Ee(),a=L(()=>{const f=(t.value?u.leads:u.leads.filter(i=>!i.isDisqualified)).map(i=>{const m=$e(i,"lead"),w={...i,type:"lead",compositeId:`lead-${i.id}`,displayStage:m};return!w.customer&&i.customer&&(w.customer=i.customer),w}),v=s.opportunities.map(i=>{const m={...i,type:"opportunity",compositeId:`opportunity-${i.id}`};return!m.customer&&i.customer&&(m.customer=i.customer),m});let r=[];return n.isOperator()?r=f:n.isSalesman()?r=v:r=[...f,...v],r}),o=(d,f)=>f==="all"?d:d.filter(v=>v.type===f),p=L(()=>{const d=a.value.some(v=>v.type==="lead"),f=a.value.some(v=>v.type==="opportunity");return d&&f});return{allTasks:a,filterByType:o,shouldShowTypeFilter:p}}function Fi(){const t=Ee(),u=Xe(),s=Oe();return{sortTasks:(a,o)=>{if(o==="none")return[...a].sort((p,d)=>{const f=new Date(p.lastActivity||p.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-f});if(o==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...a.map(f=>{if(f.type==="lead"&&!f.urgencyScore){const v=wt(f);return{...f,urgencyScore:v.score,urgencyLevel:v.level}}return f})].sort((f,v)=>{if(f.type==="lead"&&v.type==="lead"){const m=f.urgencyScore||0,w=v.urgencyScore||0;if(m!==w)return w-m;const x=new Date(f.createdAt||0);return new Date(v.createdAt||0)-x}if(f.type==="lead"&&v.type==="opportunity")return-1;if(f.type==="opportunity"&&v.type==="lead")return 1;if(f.priority==="Hot"&&v.priority!=="Hot")return-1;if(f.priority!=="Hot"&&v.priority==="Hot")return 1;const r=new Date(f.lastActivity||f.createdAt||0);return new Date(v.lastActivity||v.createdAt||0)-r}):[...a].sort((d,f)=>{if(d.priority==="Hot"&&f.priority!=="Hot")return-1;if(d.priority!=="Hot"&&f.priority==="Hot")return 1;const v=new Date(d.lastActivity||d.createdAt||0);return new Date(f.lastActivity||f.createdAt||0)-v});if(o==="assigned-to-me"){const p=t.currentUser.name;return[...a.filter(f=>f.assignee===p)].sort((f,v)=>{const r=new Date(f.lastActivity||f.createdAt||0);return new Date(v.lastActivity||v.createdAt||0)-r})}if(o==="assigned-to-my-team"){const p=t.currentUser;let d=[];return p.role==="manager"?d=u.users.map(v=>v.name):p.role==="salesman"?d=u.users.filter(v=>v.role==="salesman").map(v=>v.name):p.role==="operator"&&(d=u.users.filter(v=>v.role==="operator").map(v=>v.name)),[...a.filter(v=>d.includes(v.assignee))].sort((v,r)=>{const i=new Date(v.lastActivity||v.createdAt||0);return new Date(r.lastActivity||r.createdAt||0)-i})}return a}}}const Vi={class:"h-full flex flex-col lg:flex-row overflow-hidden",style:{"background-color":"#f5f5f5"}},Bi={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Ui={key:0,class:"flex items-center gap-2"},Wi={class:"w-5 h-5 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0"},Ei={class:"text-gray-600 font-medium"},ji={key:1},Pi={key:0},Hi={key:1},Qi={key:2},zi=["onClick"],Yi=["onClick"],Ki=["onClick"],Gi=["onClick"],Ji={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-gray-200"},Xi={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Zi={__name:"Tasks",setup(t){const u=Rt(),s=ot(),n=He(),a=Je();Ee(),Xe();const o=Oe(),{getDateDisplay:p,getVehicleType:d,getVehicleTypeBadgeClass:f,getOwnerInfo:v,getCustomerCity:r,getAssigneeInitials:i,getVehicleStatusDisplay:m,getUnselectedClass:w}=Mi(),x=I(localStorage.getItem("tasksViewMode")||"table"),N=L(()=>u.query.highlight||null);ve(x,S=>{localStorage.setItem("tasksViewMode",S)});const F=S=>{x.value;const B=H.value;if(x.value=S,S==="table"&&B)s.push({path:"/tasks",query:{highlight:B.compositeId}});else if(S==="card"&&N.value){const[J,le]=N.value.split("-");s.push({path:`/tasks/${le}`,query:{type:J}})}else S==="card"&&!N.value&&!H.value&&s.push({path:"/tasks"})},C=I("all"),k=I("none"),b=I(!1),y=I(null);I(!1);const D=I(!1),V=I(null),{allTasks:P,filterByType:Y,shouldShowTypeFilter:Z}=Ri(b),{sortTasks:oe}=Fi(),be=L(()=>{let S=Y(P.value,C.value);return S=oe(S,k.value),S}),H=L(()=>{if(!u.params.id)return null;const S=parseInt(u.params.id);if(isNaN(S))return null;const B=u.query.type;if(B){const de=`${B}-${S}`;return P.value.find(Te=>Te.compositeId===de)||null}const J=C.value!=="all"?P.value.filter(de=>de.type===C.value):P.value,le=`lead-${S}`,q=`opportunity-${S}`,Q=J.find(de=>de.compositeId===le||de.compositeId===q);return Q||P.value.find(de=>de.compositeId===le||de.compositeId===q)||null});L(()=>H.value?H.value.type==="lead"?n.currentLeadActivities:a.currentOpportunityActivities:[]);const ye=L(()=>{if(!H.value)return null;let S=null;if(H.value.type==="lead"){const B=H.value.requestedCar;B&&B.brand&&B.model&&(S=B)}else H.value.type==="opportunity"&&(S=H.value.vehicle||H.value.requestedCar);return!S||!S.brand||!S.model?null:{show:!0,label:"Requested Car",brand:S.brand,model:S.model,year:S.year,image:S.image||"",price:S.price||null,requestMessage:S.requestMessage||"",requestType:H.value.requestType||S.requestType||"",source:H.value.source||S.source||"",dealership:S.dealership||"",registration:S.registration||"",kilometers:S.kilometers!==void 0?S.kilometers:null,fuelType:S.fuelType||"",gearType:S.gearType||"",vin:S.vin||"",stockDays:S.stockDays!==void 0?S.stockDays:null,showOpenAd:!0,showTechnicalSpecs:!0,channel:"Email",adCampaign:H.value.sourceDetails||S.adCampaign||"",expectedPurchaseDate:S.expectedPurchaseDate||"",fiscalEntity:H.value.fiscalEntity||"",sourceDetails:H.value.sourceDetails||"",adMedium:S.adMedium||"",adSource:S.adSource||""}}),fe=Ni(H),xe=fe.managementWidget,K=fe.storeAdapter,G=fe.addNewConfig,ge=w;Qe(()=>{n.fetchLeads(),a.fetchOpportunities();const S=u.params.id;S&&he(S)}),ve(()=>u.params.id,S=>{S&&he(S)}),ve(H,S=>{S&&(S.type==="lead"?n.fetchLeadById(S.id):a.fetchOpportunityById(S.id))},{immediate:!0});const he=S=>{const B=parseInt(S),J=P.value.find(le=>le.id===B);J&&(J.type==="lead"?n.fetchLeadById(B):a.fetchOpportunityById(B))},ce=S=>{const[B,J]=S.split("-");s.push({path:`/tasks/${J}`,query:{type:B}})},te=()=>{s.push({path:"/tasks"})},ne=S=>{y.value=y.value===S?null:S},me=S=>{V.value=S,D.value=!0,y.value=null},E=S=>{k.value=S},W=async S=>{if(!V.value)return;const B=V.value,J=S.name;B.type==="lead"?await n.updateLead(B.id,{assignee:J,assigneeType:S.type,teamId:S.type==="team"?S.id:null}):B.type==="opportunity"&&await a.updateOpportunity(B.id,{assignee:J,assigneeType:S.type,teamId:S.type==="team"?S.id:null}),D.value=!1,V.value=null},ee=async S=>{y.value=null,S.type==="lead"?await n.updateLead(S.id,{priority:"Hot"}):S.type==="opportunity"&&await a.updateOpportunity(S.id,{priority:"Hot"})},je=async S=>{y.value=null,S.type==="lead"?await n.updateLead(S.id,{priority:"Normal"}):S.type==="opportunity"&&await a.updateOpportunity(S.id,{priority:"Normal"})},ke=async S=>{if(y.value=null,S.type==="lead")try{const B=S.displayStage||S.stage||se.NEW,J=se.NEW,le=tt(B,J);if(le){const{updates:q,activities:Q}=le(S);await n.updateLead(S.id,q);for(const de of Q)await n.addActivity(S.id,de)}else await n.updateLead(S.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await n.addActivity(S.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await n.fetchLeadById(S.id)}catch(B){console.error("Failed to reopen lead:",B)}};return(S,B)=>{var J,le;return c(),h("div",Vi,[O(Xo,{show:!!H.value,"back-label":"Back to task list",onBack:te},null,8,["show"]),x.value==="card"?(c(),h("div",Bi,[e("div",{class:U(["flex flex-col overflow-hidden",H.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[O(Ms,{title:"Tasks",items:be.value,"selected-id":(J=H.value)==null?void 0:J.compositeId,"type-filter":C.value,"view-mode":x.value,"selected-class":q=>q.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":l(ge),"open-menu-id":y.value,getName:q=>{const Q=q.customer;return Q&&Q.name?Q.name:Q&&!Q.name&&Q.email&&Q.email.split("@")[0]||"Unknown"},getInitials:q=>{const Q=q.customer;return Q&&Q.initials?Q.initials:Q&&Q.name&&Q.name.split(" ").map(Te=>Te[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:q=>{if(q.type==="lead")return q.requestedCar?`${q.requestedCar.brand} ${q.requestedCar.model}`:"No vehicle specified";const Q=q.vehicle||q.requestedCar;return Q?`${Q.brand} ${Q.model}`:"No vehicle specified"},avatarClass:q=>q.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!1,onSelect:ce,onMenuClick:ne,onMenuClose:B[0]||(B[0]=q=>y.value=null),onClose:te,"show-type-filter":l(Z),onFilterChange:B[1]||(B[1]=q=>C.value=q),onSortChange:E,onViewChange:F},{badges:T(({item:q})=>[q&&q.type?(c(),j(l(Ke),{key:0,text:q.type==="lead"?"Lead":"Opportunity",size:"small",theme:q.type==="lead"?"blue":"gray"},null,8,["text","theme"])):A("",!0),q&&q.type==="lead"&&l(o).getSetting("urgencyEnabled")!==!1&&q.urgencyLevel?(c(),j(l(Ke),{key:1,text:`${l(kt)(q.urgencyLevel)} ${q.urgencyLevel}`,size:"small",class:U(l(Ct)(q.urgencyLevel))},null,8,["text","class"])):A("",!0),q&&q.priority==="Hot"&&(l(o).getSetting("urgencyEnabled")===!1||q.type!=="lead")?(c(),j(l(Ke),{key:2,text:"HOT",size:"small",theme:"red"})):A("",!0)]),location:T(({item:q})=>[R($(l(r)(q)||"Unknown"),1)]),source:T(({item:q})=>{var Q;return[R($(q.source||((Q=q.customer)==null?void 0:Q.source)||"Unknown"),1)]}),"vehicle-status":T(({item:q})=>[R($(l(m)(q)),1)]),owner:T(({item:q})=>[q.assignee?(c(),h("div",Ui,[e("div",Wi,$(l(i)(q.assignee)),1),e("span",Ei,$(q.assignee),1)])):(c(),h("span",ji,"Unassigned"))]),dates:T(({item:q})=>[q.type==="lead"&&q.nextActionDue?(c(),h("span",Pi,"Due: "+$(l(p)(q.nextActionDue)),1)):q.type==="opportunity"&&q.nextActionDue?(c(),h("span",Hi,"Due: "+$(l(p)(q.nextActionDue)),1)):(c(),h("span",Qi,"Due: No deadline"))]),menu:T(({item:q})=>[q.type==="lead"&&q.isDisqualified===!0?(c(),h("button",{key:0,onClick:Se(Q=>ke(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[6]||(B[6]=[e("i",{class:"fa-solid fa-rotate-left text-blue-500"},null,-1),R(" Reopen Lead ",-1)])],8,zi)):A("",!0),e("button",{onClick:Se(Q=>me(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[7]||(B[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),R(" Reassign ",-1)])],8,Yi),q.priority!=="Hot"?(c(),h("button",{key:1,onClick:Se(Q=>ee(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[8]||(B[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),R(" Mark as hot ",-1)])],8,Ki)):(c(),h("button",{key:2,onClick:Se(Q=>je(q),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...B[9]||(B[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),R(" Unmark as hot ",-1)])],8,Gi))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),H.value?(c(),j(dt,{key:0,task:H.value,"management-widget":l(xe),"store-adapter":l(K),"add-new-config":l(G),"vehicle-widget-data":ye.value},null,8,["task","management-widget","store-adapter","add-new-config","vehicle-widget-data"])):A("",!0),H.value?A("",!0):(c(),h("div",Ji,[...B[10]||(B[10]=[Ge('<div class="flex-1 flex items-center justify-center p-8" data-v-65247a35><div class="text-center max-w-sm" data-v-65247a35><div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gray-100 flex items-center justify-center" data-v-65247a35><i class="fa-solid fa-tasks text-2xl text-gray-400" data-v-65247a35></i></div><h3 class="text-base font-semibold text-gray-900 mb-2" data-v-65247a35>No task selected</h3><p class="text-sm text-gray-500" data-v-65247a35>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):A("",!0),x.value==="table"?(c(),h("div",Xi,[O(Ys,{tasks:be.value,"current-task-id":(le=H.value)==null?void 0:le.compositeId,"highlight-id":N.value,"type-filter":C.value,"sort-option":k.value,"show-type-filter":l(Z),"show-closed":b.value,"show-mobile-close":!1,"open-menu-id":y.value,"get-vehicle-type":l(d),"get-vehicle-type-badge-class":l(f),"get-owner-info":l(v),"get-stage-badge-class":l(bt),"view-mode":x.value,onSelect:ce,onMenuClick:ne,onMenuClose:B[2]||(B[2]=q=>y.value=null),onFilterChange:B[3]||(B[3]=q=>C.value=q),onSortChange:E,onToggleClosed:B[4]||(B[4]=q=>b.value=q),onReassign:me,onClose:te,onViewChange:F,class:U(H.value?"hidden lg:flex shrink-0":"flex-1 w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode","class"]),H.value?(c(),j(dt,{key:0,task:H.value,"management-widget":l(xe),"store-adapter":l(K),"add-new-config":l(G),"vehicle-widget-data":ye.value},null,8,["task","management-widget","store-adapter","add-new-config","vehicle-widget-data"])):A("",!0)])):A("",!0),O(Gt,{show:D.value,onClose:B[5]||(B[5]=q=>D.value=!1),onConfirm:W},null,8,["show"])])}}},yr=st(Zi,[["__scopeId","data-v-65247a35"]]);export{yr as default};
