import{H as ee,S as B,a0 as Ce,h as Te,C as Ie,c as N,d as x,o as b,e,g as V,t as T,F as j,i as ae,n as q,M as we,r as F,L as Ae,s as y,B as w,w as ie,y as p,p as C,T as $e,k as L,a9 as Me,x as R,m as re,l as Q,N as M,v as z,j as fe,I as te,aa as De,D as Pe,u as Le,$ as Ve,a3 as ce,ab as Fe,ac as Oe,ad as Ee,ae as Ue,P as H}from"./index-Db_3peLd.js";import{u as Re}from"./opportunities-CySWWyzd.js";import{n as P,$ as Ne,f as Y,F as G,L as K,g as Z,h as J,K as le,C as de,d as X}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import{S as Be}from"./sparkles-CCfcFWX8.js";import{u as qe}from"./vehicles-ygxbygEI.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=ee("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=ee("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ee("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ee("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ee("PaperclipIcon",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ee("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=ee("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function $a(t){if(!t)return"";const s=new Date(t),a=new Date;if(s<a)return"OVERDUE";if(s.toDateString()===a.toDateString()){const r=s-a,o=Math.floor(r/(1e3*60*60)),c=Math.floor(r%(1e3*60*60)/(1e3*60));return o>0?`${o}h ${c}m`:`${c}m`}return s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Ma(t){return(typeof t=="string"?new Date(t):t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Da(t){return(typeof t=="string"?new Date(t):t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function he(t){return(t==null?void 0:t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function Pa(t){if(!t)return"No deadline";const s=new Date(t);if(s<new Date)return"OVERDUE";const l=s.toLocaleDateString("en-US",{month:"short",day:"numeric"}),r=s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${l}, ${r}`}function La(t){if(!t)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const s=new Date(t),a=new Date,l=(s-a)/(1e3*60*60);if(l<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(l<2){const r=Math.floor((s-a)/6e4),o=Math.floor(r/60),c=r%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:o>0?`${o}h ${c}m`:`${c}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(l<24){const r=Math.floor(l),o=Math.floor((l-r)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${r}h ${o}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const r=Math.ceil(l/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${r} day${r!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function Va(t){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[t]||"bg-gray-100 text-gray-700"}const W={[B.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[B.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:t=>!!(t.callbackDate||t.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[B.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[B.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[B.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[B.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},xe={toClosed:(t,s,a)=>{const l={isDisqualified:!0,disqualifyReason:(a==null?void 0:a.reason)||null,disqualifyCategory:(a==null?void 0:a.category)||null,scheduledAppointment:null,nextActionDue:null};(a==null?void 0:a.reason)==="Duplicate"?(l.isDuplicate=!0,l.stage="Closed Failed"):(a==null?void 0:a.category)==="Not Interested"?l.stage="Not Interested":l.stage="Not Valid",l.status="Disqualified";const r=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(a==null?void 0:a.category)||"Unknown"}, Reason: ${(a==null?void 0:a.reason)||"Unknown"}`}];return t.scheduledAppointment&&r.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:t.scheduledAppointment}}),{updates:l,activities:r}},reopen:t=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function Fa(t,s){return s.startsWith("Closed")?xe.toClosed:t.startsWith("Closed")&&!s.startsWith("Closed")?xe.reopen:null}const ye={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:t=>t.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:t=>t.scheduledAppointment?`Scheduled for ${t.formatDateTime(t.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:t=>t.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:t=>t.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:t=>t.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:t=>{const s=t.deliverySubstatus;return s==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:s==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},me={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},He={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},Qe={class:"flex flex-col"},Ye={class:"space-y-3"},Ge={class:"flex items-start justify-between gap-2"},Ke={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},Ze={class:"flex items-start justify-between gap-2"},Je={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},Xe={class:"flex items-start justify-between gap-2"},_e={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},et={key:0,class:"flex items-start justify-between gap-2"},tt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},lt={key:0,class:"mt-4 pt-4 border-t border-black/5"},at={class:"space-y-0.5"},nt=["onClick"],st={class:"text-sm font-medium text-heading truncate shrink-0 min-w-0"},ot={class:"text-sm text-body truncate flex-1 min-w-0"},it={key:0,class:"text-sm font-bold text-heading shrink-0"},rt={class:"text-sm text-sub shrink-0"},Oa={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(t){const s=t;Ce();const a=Te(),l=Ie(),r=Re();N(()=>s.task.negotiations||s.task.activeNegotiations||0);const o=N(()=>{if(!s.task.customer)return[];const m=s.task.customer.email,g=s.task.customer.phone,i=s.task.compositeId;return[...(l.leads||[]).map(D=>({...D,type:"lead",compositeId:`lead-${D.id}`})),...(r.opportunities||[]).map(D=>({...D,type:"opportunity",compositeId:`opportunity-${D.id}`}))].filter(D=>D.compositeId===i||!D.customer?!1:D.customer.email===m||D.customer.phone===g).sort((D,O)=>new Date(O.createdAt||0)-new Date(D.createdAt||0)).slice(0,3)}),c=m=>{const[g,i]=m.compositeId.split("-");a.push({path:`/tasks/${i}`,query:{type:g}})},f=m=>m.stage||m.currentStage||"Unknown",d=m=>{const g=m.createdAt||m.nextActionDue||m.updatedAt;if(!g)return"";try{return new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},S=m=>{const g=m.requestedCar||m.vehicle;if(!g)return"No vehicle";const i=g.brand||"",v=g.model||"",D=g.year?`(${g.year})`:"";return`${i} ${v} ${D}`.trim()||"Vehicle info N/A"},n=m=>m?m>=1e3?"€"+(m/1e3).toFixed(0)+"k":"€"+m:"€0";return(m,g)=>{var i,v,D,O;return b(),x("div",He,[g[5]||(g[5]=e("h3",{class:"text-base font-medium text-heading mb-4 leading-6"},"Customer information",-1)),e("div",Qe,[e("div",Ye,[e("div",Ge,[g[0]||(g[0]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Customer",-1)),e("p",Ke,T(((i=t.task.customer)==null?void 0:i.name)||"Unknown"),1)]),e("div",Ze,[g[1]||(g[1]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Email",-1)),e("p",Je,T(((v=t.task.customer)==null?void 0:v.email)||"N/A"),1)]),e("div",Xe,[g[2]||(g[2]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Phone",-1)),e("p",_e,T(((D=t.task.customer)==null?void 0:D.phone)||"N/A"),1)]),(O=t.task.customer)!=null&&O.address?(b(),x("div",et,[g[3]||(g[3]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Address",-1)),e("p",tt,T(t.task.customer.address),1)])):V("",!0)]),o.value.length>0?(b(),x("div",lt,[g[4]||(g[4]=e("h3",{class:"text-base font-medium text-heading mb-4 leading-6"},"Other customer requests",-1)),e("div",at,[(b(!0),x(j,null,ae(o.value,E=>(b(),x("div",{key:E.compositeId,onClick:A=>c(E),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:q(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",E.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},T(E.type==="lead"?"Lead":"Opp"),3),e("span",st,T(f(E)),1),e("span",ot,T(S(E)),1),E.type==="opportunity"&&E.estimatedValue?(b(),x("span",it,T(n(E.estimatedValue)),1)):V("",!0),e("span",rt,T(d(E)),1)],8,nt))),128))])])):V("",!0)])])}}},dt={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},ut={class:"mb-4"},ct={class:"flex items-center justify-between mb-2"},pt={class:"flex items-center gap-2 flex-wrap"},mt={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},ft={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},yt={key:0,class:"flex items-center gap-2 flex-wrap"},vt={class:"relative"},bt={key:0,class:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-black/10 py-1 z-10"},gt={class:"space-y-6 flex-1 flex flex-col min-h-0"},ht={key:0,class:"flex-1 overflow-y-auto min-h-0"},xt={class:"flex flex-col items-start gap-1 mb-4"},wt={class:"text-sm font-normal text-sub leading-normal"},kt={class:"space-y-4"},St=["onClick"],Ct={class:"flex-1 min-w-0"},Tt={class:"flex items-start justify-between gap-2"},It={class:"text-sm text-heading flex-1 wrap-break-word min-w-0 leading-normal"},At={key:0,class:"text-sub"},$t={key:1,class:"text-sub"},Mt={key:2,class:"text-sub"},Dt={key:3,class:"text-sub"},Pt={key:4,class:"text-sub"},Lt={key:5,class:"text-sub"},Vt={key:6,class:"text-sub"},Ft={class:"text-sm text-sub text-right shrink-0 w-14 leading-normal"},Ot={key:0,class:"mt-2 bg-[#fef7ee] rounded-lg p-4 backdrop-blur-sm"},Et={class:"text-sm text-heading wrap-break-word leading-normal"},Ut={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},Rt={class:"text-sm text-heading wrap-break-word leading-normal"},Nt={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},Bt={class:"text-sm text-heading wrap-break-word leading-normal"},qt={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},zt={class:"text-sm text-heading wrap-break-word leading-normal"},jt={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},Wt={class:"text-center"},Ht={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(t,{emit:s}){const a=t,l=s,r=F(!1),o=F(!1),c=F(null),f=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],d=F([]),S=()=>{o.value=!o.value},n=A=>{o.value=!1;const k=d.value.indexOf(A);k>-1?d.value.splice(k,1):d.value.push(A)},m=A=>{const k=d.value.indexOf(A);k>-1&&d.value.splice(k,1)},g=A=>{const k=f.find(U=>U.value===A);return k?k.label:A},i=N(()=>f.map(A=>({key:A.value,label:A.label,onClick:()=>n(A.value),className:d.value.includes(A.value)?"filter-item-selected":""}))),v=A=>A.important||A.isImportant?"important":["email","sms","whatsapp","call"].includes(A.type)?"communications":A.type==="note"?"notes":A.type==="transcription"||A.transcription?"transcriptions":A.type==="system"||A.type==="created"||A.type==="status"?"system-updates":null,D=N(()=>{let A=[...a.activities];return d.value.length>0&&(A=A.filter(k=>{const U=v(k);return U&&d.value.includes(U)})),A.sort((k,U)=>{const h=new Date(k.timestamp||k.createdAt||0).getTime();return new Date(U.timestamp||U.createdAt||0).getTime()-h})}),O=A=>{if(!A||A.length===0)return"";const k=A[0],U=k.timestamp||k.createdAt;if(!U)return"Recent Activity";const h=new Date(U),$=new Date,u=new Date($);return u.setDate(u.getDate()-1),h.toDateString()===$.toDateString()?"Today":h.toDateString()===u.toDateString()?"Yesterday":h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:h.getFullYear()!==$.getFullYear()?"numeric":void 0})},E=A=>{["note","email","whatsapp"].includes(A.type)&&l("activity-click",A)};return(A,k)=>{const U=Ae("click-outside");return b(),x("div",dt,[e("div",ut,[e("div",ct,[k[10]||(k[10]=e("h3",{class:"text-base font-medium text-heading leading-6"},"Activity",-1)),e("div",pt,[e("div",{class:"relative",ref_key:"filterContainer",ref:c},[y(p(P),{variant:"outline",size:"icon",onClick:ie(S,["stop"]),class:"relative w-8 h-8"},{default:w(()=>[k[8]||(k[8]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),d.value.length>0?(b(),x("span",mt)):V("",!0)]),_:1}),y($e,{name:"dropdown"},{default:w(()=>[o.value?C((b(),x("div",ft,[y(p(Ne),{items:i.value,className:"w-56"},null,8,["items"])])),[[U,()=>o.value=!1]]):V("",!0)]),_:1})],512),d.value.length>0?(b(),x("div",yt,[(b(!0),x(j,null,ae(d.value,h=>(b(),x("div",{key:h,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-sm font-medium text-heading border border-black/5"},[e("span",null,T(g(h)),1),y(p(P),{variant:"ghost",size:"icon",onClick:$=>m(h),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:w(()=>[...k[9]||(k[9]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):V("",!0)])]),e("div",vt,[y(p(P),{variant:"ghost",onClick:k[0]||(k[0]=h=>r.value=!r.value),class:"flex items-center gap-1.5 text-sm font-medium text-primary-600 hover:text-primary-700 underline decoration-primary-600 hover:decoration-primary-700 transition-colors h-auto p-0"},{default:w(()=>[y(p(Me),{size:14}),k[11]||(k[11]=L(" Add activity ",-1))]),_:1}),r.value?C((b(),x("div",bt,[y(p(P),{variant:"ghost",onClick:k[1]||(k[1]=h=>A.$emit("add-activity","note")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(ge),{size:16,class:"text-orange-600"}),k[12]||(k[12]=L(" Note ",-1))]),_:1}),y(p(P),{variant:"ghost",onClick:k[2]||(k[2]=h=>A.$emit("add-activity","sms")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(pe),{size:16,class:"text-purple-600"}),k[13]||(k[13]=L(" SMS ",-1))]),_:1}),y(p(P),{variant:"ghost",onClick:k[3]||(k[3]=h=>A.$emit("add-activity","whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(pe),{size:16,class:"text-green-600"}),k[14]||(k[14]=L(" WhatsApp ",-1))]),_:1}),y(p(P),{variant:"ghost",onClick:k[4]||(k[4]=h=>A.$emit("add-activity","email")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(be),{size:16,class:"text-blue-600"}),k[15]||(k[15]=L(" Email ",-1))]),_:1}),y(p(P),{variant:"ghost",onClick:k[5]||(k[5]=h=>A.$emit("add-activity","attachment")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(je),{size:16,class:"text-gray-600"}),k[16]||(k[16]=L(" Attachment ",-1))]),_:1}),y(p(P),{variant:"ghost",onClick:k[6]||(k[6]=h=>A.$emit("add-activity","tradein")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[...k[17]||(k[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"text-blue-600"},[e("path",{d:"M7 17L17 7M7 7h10v10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),L(" Trade-In ",-1)])]),_:1}),y(p(P),{variant:"ghost",onClick:k[7]||(k[7]=h=>A.$emit("add-activity","purchase-method")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 justify-start h-auto"},{default:w(()=>[y(p(ve),{size:16,class:"text-indigo-600"}),k[18]||(k[18]=L(" Purchase Method ",-1))]),_:1})])),[[U,()=>r.value=!1]]):V("",!0)])]),e("div",gt,[D.value.length>0?(b(),x("div",ht,[e("div",xt,[e("h3",wt,T(O(D.value)),1)]),e("div",kt,[(b(!0),x(j,null,ae(D.value,h=>(b(),x("div",{key:h.id,class:"space-y-2"},[e("div",{class:q(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":h.type==="note"||h.type==="email"||h.type==="whatsapp"}]),onClick:$=>E(h)},[e("div",{class:q(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",h.type==="note"?"bg-orange-100":h.type==="call"?"bg-green-100":h.type==="ai-summary"?"bg-purple-100":h.type==="email"?"bg-blue-100":h.type==="whatsapp"?"bg-green-100":"bg-surfaceSecondary"])},[h.type==="note"?(b(),R(p(ge),{key:0,size:16,class:"text-orange-600"})):h.type==="call"?(b(),R(p(We),{key:1,size:16,class:"text-green-600"})):h.type==="ai-summary"?(b(),R(p(Be),{key:2,size:16,class:"text-purple-600"})):h.type==="email"?(b(),R(p(be),{key:3,size:16,class:"text-blue-600"})):h.type==="whatsapp"?(b(),R(p(pe),{key:4,size:16,class:"text-green-600"})):(b(),R(p(ve),{key:5,size:16,class:"text-heading"}))],2),e("div",Ct,[e("div",Tt,[e("p",It,[e("span",{class:q(["font-normal",h.type==="ai-summary"?"font-medium":""])},T(h.type==="ai-summary"?"MotorKAI":h.user),3),h.type==="note"?(b(),x("span",At," added a note")):h.type==="created"?(b(),x("span",$t,T(h.message||h.action),1)):h.type==="call"?(b(),x("span",Mt,T(" "+(h.message||h.action)),1)):h.type==="ai-summary"?(b(),x("span",Dt," summary")):h.type==="email"?(b(),x("span",Pt,T(" sent an email"))):h.type==="whatsapp"?(b(),x("span",Lt,T(" sent a WhatsApp message"))):(b(),x("span",Vt,T(" "+(h.message||h.action)),1))]),e("p",Ft,T(h.time),1)]),h.type==="note"&&(h.message||h.content)?(b(),x("div",Ot,[e("p",Et,T(h.message||h.content),1)])):V("",!0),h.type==="email"&&h.content?(b(),x("div",Ut,[e("p",Rt,T(h.content),1)])):V("",!0),h.type==="whatsapp"&&h.content?(b(),x("div",Nt,[e("p",Bt,T(h.content),1)])):V("",!0),h.type==="ai-summary"&&(h.message||h.content)?(b(),x("div",qt,[e("p",zt,T(h.message||h.content),1)])):V("",!0)])],10,St)]))),128))])])):(b(),x("div",jt,[e("div",Wt,[y(p(ze),{size:32,class:"mx-auto text-sub mb-2"}),k[19]||(k[19]=e("p",{class:"text-sm text-sub"},"No activity yet",-1))])]))])])}}},Ea=we(Ht,[["__scopeId","data-v-603f8819"]]),Qt={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Yt={key:1,class:"flex justify-between items-center mb-4"},Gt={class:"text-fluid-sm font-semibold text-heading"},Kt={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Ua={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(t,{expose:s,emit:a}){const l=t,r=a,o=F(""),c=F(!1);re(()=>{l.item&&(o.value=l.item.content||l.item.message||"")}),Q(()=>l.item,n=>{n&&(o.value=n.content||n.message||"")},{deep:!0}),Q(()=>l.show,n=>{l.modal&&!n&&setTimeout(()=>{o.value=l.item&&(l.item.content||l.item.message)||"",c.value=!1},300)});const f=async()=>{var n,m;if(o.value.trim()){c.value=!0;try{const g={id:((n=l.item)==null?void 0:n.id)||Date.now(),type:"note",action:l.item?"updated a note":"added a note",content:o.value,message:o.value,timestamp:((m=l.item)==null?void 0:m.timestamp)||new Date().toISOString(),isEdit:!!l.item};r("save",g),l.modal&&r("close")}finally{c.value=!1}}},d=()=>{r("cancel"),l.modal&&r("close")},S=n=>{n||r("close")};return s({submit:f,canSubmit:()=>!!o.value.trim()}),(n,m)=>t.modal?(b(),R(p(X),{key:0,open:t.show,"onUpdate:open":S},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[L(T(t.item?"Edit Note":"Add Note"),1)]),_:1}),t.item?V("",!0):(b(),R(p(le),{key:0},{default:w(()=>[...m[2]||(m[2]=[L(" Add a note to document important information ",-1)])]),_:1}))]),_:1}),e("form",{onSubmit:ie(f,["prevent"]),class:"space-y-4"},[e("div",null,[m[3]||(m[3]=e("label",{class:"block label-upper mb-2"},[L(" Note "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("textarea",{"onUpdate:modelValue":m[0]||(m[0]=g=>o.value=g),class:"input",rows:"6",placeholder:"Type your note here...",required:""},null,512),[[M,o.value]])])],32),y(p(de),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:w(()=>[y(p(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d}),y(p(P),{label:c.value?"Saving...":t.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!o.value.trim()||c.value,onClick:f},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(b(),x("div",{key:1,class:q(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?V("",!0):(b(),x("div",Qt)),t.hideHeader?V("",!0):(b(),x("div",Yt,[e("h5",Gt,T(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:d,class:"text-sub hover:text-body"},[...m[4]||(m[4]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[m[5]||(m[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),C(e("textarea",{"onUpdate:modelValue":m[1]||(m[1]=g=>o.value=g),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[M,o.value]])]),t.hideActions?V("",!0):(b(),x("div",Kt,[y(p(P),{label:"Cancel",variant:"outline",size:"small",onClick:d}),y(p(P),{label:"Save",variant:"primary",size:"small",onClick:f})]))],2))}},Zt={class:"flex items-center gap-3"},Jt={key:0,class:"text-fluid-sm text-slate-600"},Xt={key:1,class:"text-fluid-sm text-sub"},_t={key:1,class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},el={class:"flex justify-between items-center mb-4"},tl={class:"text-fluid-sm font-semibold text-heading"},ll={class:"flex items-center gap-3"},al={key:0,class:"text-fluid-sm text-slate-600"},nl={key:1,class:"text-fluid-sm text-sub"},sl={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Ra={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(t,{expose:s,emit:a}){const l=t,r=a,o=F(null),c=F(""),f=F(!1),d=F(null);re(()=>{l.item&&(c.value=l.item.fileName||"")}),Q(()=>l.item,i=>{i&&(c.value=i.fileName||"")},{deep:!0}),Q(()=>l.show,i=>{l.modal&&!i&&setTimeout(()=>{o.value=null,c.value=l.item&&l.item.fileName||"",f.value=!1},300)});const S=i=>{const v=i.target.files[0];v&&(o.value=v,c.value=v.name)},n=async()=>{var i,v;if(!(!o.value&&!l.item)){f.value=!0;try{const D={id:((i=l.item)==null?void 0:i.id)||Date.now(),type:"attachment",action:l.item?"updated an attachment":"added an attachment",fileName:c.value,file:o.value,timestamp:((v=l.item)==null?void 0:v.timestamp)||new Date().toISOString(),isEdit:!!l.item};r("save",D),l.modal&&r("close")}finally{f.value=!1}}},m=()=>{r("cancel"),l.modal&&r("close")},g=i=>{i||r("close")};return s({submit:n,canSubmit:()=>!!o.value||!!l.item}),(i,v)=>t.modal?(b(),R(p(X),{key:0,open:t.show,"onUpdate:open":g},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[L(T(t.item?"Edit Attachment":"Add Attachment"),1)]),_:1}),t.item?V("",!0):(b(),R(p(le),{key:0},{default:w(()=>[...v[2]||(v[2]=[L(" Upload a file attachment ",-1)])]),_:1}))]),_:1}),e("form",{onSubmit:ie(n,["prevent"]),class:"space-y-4"},[e("div",null,[v[3]||(v[3]=e("label",{class:"block label-upper mb-2"},[L(" File "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Zt,[e("input",{type:"file",onChange:S,ref_key:"fileInput",ref:d,class:"hidden"},null,544),y(p(P),{label:"Choose File",variant:"outline",size:"small",onClick:v[0]||(v[0]=D=>{var O;return(O=d.value)==null?void 0:O.click()})}),c.value?(b(),x("span",Jt,T(c.value),1)):(b(),x("span",Xt,"No file selected"))])])],32),y(p(de),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:w(()=>[y(p(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:m}),y(p(P),{label:f.value?"Saving...":t.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!o.value||f.value,onClick:n},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(b(),x("div",_t,[v[6]||(v[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",el,[e("h5",tl,T(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:m,class:"text-sub hover:text-body"},[...v[4]||(v[4]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[v[5]||(v[5]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",ll,[e("input",{type:"file",onChange:S,ref_key:"fileInput",ref:d,class:"hidden"},null,544),y(p(P),{label:"Choose File",variant:"outline",size:"small",onClick:v[1]||(v[1]=D=>i.$refs.fileInput.click())}),c.value?(b(),x("span",al,T(c.value),1)):(b(),x("span",nl,"No file selected"))])]),e("div",sl,[y(p(P),{label:"Cancel",variant:"outline",size:"small",onClick:m}),y(p(P),{label:"Save",variant:"primary",size:"small",disabled:!o.value,onClick:n},null,8,["disabled"])])]))}},ol={class:"space-y-3"},il={class:"flex justify-end gap-2"},rl={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:s}){const a=t,l=s,r=F(a.initialTemplate),o=F(a.initialMessage),c={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},f=()=>{r.value&&c[r.value]&&(o.value=c[r.value])},d=()=>{o.value.trim()&&l("send",{type:"whatsapp",template:r.value,message:o.value})};return(S,n)=>(b(),x("div",ol,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":n[0]||(n[0]=m=>r.value=m),onChange:f,class:"input"},[...n[3]||(n[3]=[fe('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[z,r.value]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=m=>o.value=m),class:"input",rows:"4",placeholder:"Type your WhatsApp message here..."},null,512),[[M,o.value]])]),e("div",il,[y(p(P),{label:"Cancel",variant:"outline",size:"small",onClick:n[2]||(n[2]=m=>S.$emit("cancel"))}),y(p(P),{label:"Send WhatsApp",variant:"outline",size:"small",onClick:d})])]))}},Na={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(t,{emit:s}){const a=s,l=o=>{a("save",o),a("close")},r=o=>{o||a("close")};return(o,c)=>(b(),R(p(X),{open:t.show,"onUpdate:open":r},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[...c[1]||(c[1]=[L("Send WhatsApp Message",-1)])]),_:1}),y(p(le),null,{default:w(()=>[...c[2]||(c[2]=[L(" Send a WhatsApp message to the customer ",-1)])]),_:1})]),_:1}),y(rl,{onSend:l,onCancel:c[0]||(c[0]=f=>o.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},dl={class:"space-y-3"},ul={class:"text-fluid-xs text-sub mt-1"},cl={class:"flex justify-end gap-2"},pl={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:s}){const a=t,l=s,r=F(a.initialTemplate),o=F(a.initialMessage),c={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},f=()=>{r.value&&c[r.value]&&(o.value=c[r.value])},d=()=>{o.value.trim()&&l("send",{type:"sms",template:r.value,message:o.value})};return(S,n)=>(b(),x("div",dl,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":n[0]||(n[0]=m=>r.value=m),onChange:f,class:"input"},[...n[3]||(n[3]=[fe('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[z,r.value]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=m=>o.value=m),class:"input",rows:"4",placeholder:"Type your SMS message here...",maxlength:"160"},null,512),[[M,o.value]]),e("p",ul,T(o.value.length)+"/160 characters",1)]),e("div",cl,[y(p(P),{label:"Cancel",variant:"outline",size:"small",onClick:n[2]||(n[2]=m=>S.$emit("cancel"))}),y(p(P),{label:"Send SMS",variant:"primary",size:"small",onClick:d})])]))}},Ba={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(t,{emit:s}){const a=s,l=o=>{a("save",o),a("close")},r=o=>{o||a("close")};return(o,c)=>(b(),R(p(X),{open:t.show,"onUpdate:open":r},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[...c[1]||(c[1]=[L("Send SMS",-1)])]),_:1}),y(p(le),null,{default:w(()=>[...c[2]||(c[2]=[L(" Send an SMS message to the customer ",-1)])]),_:1})]),_:1}),y(pl,{onSend:l,onCancel:c[0]||(c[0]=f=>o.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},ml={class:"space-y-3"},fl={class:"flex justify-end gap-2"},yl={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(t,{emit:s}){const a=t,l=s,r=F(a.initialTemplate),o=F(""),c=F(a.initialMessage),f={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},d=()=>{r.value&&f[r.value]&&(o.value=f[r.value].subject,c.value=f[r.value].message)},S=()=>{c.value.trim()&&l("send",{type:"email",template:r.value,subject:o.value,message:c.value})};return(n,m)=>(b(),x("div",ml,[e("div",null,[m[5]||(m[5]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Template",-1)),C(e("select",{"onUpdate:modelValue":m[0]||(m[0]=g=>r.value=g),onChange:d,class:"input"},[...m[4]||(m[4]=[fe('<option value="">Select a template...</option><option value="Follow-up">Follow-up</option><option value="Meeting Confirmation">Meeting Confirmation</option><option value="Quote Proposal">Quote Proposal</option><option value="Unable to Reach">Unable to Reach</option>',5)])],544),[[z,r.value]])]),e("div",null,[m[6]||(m[6]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Subject",-1)),C(e("input",{"onUpdate:modelValue":m[1]||(m[1]=g=>o.value=g),type:"text",class:"input",placeholder:"Email subject..."},null,512),[[M,o.value]])]),e("div",null,[m[7]||(m[7]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Message",-1)),C(e("textarea",{"onUpdate:modelValue":m[2]||(m[2]=g=>c.value=g),class:"input",rows:"4",placeholder:"Type your message here..."},null,512),[[M,c.value]])]),e("div",fl,[y(p(P),{label:"Cancel",variant:"outline",size:"small",onClick:m[3]||(m[3]=g=>n.$emit("cancel"))}),y(p(P),{label:"Send Email",variant:"primary",size:"small",onClick:S})])]))}},qa={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(t,{emit:s}){const a=s,l=o=>{a("save",o),a("close")},r=o=>{o||a("close")};return(o,c)=>(b(),R(p(X),{open:t.show,"onUpdate:open":r},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[...c[1]||(c[1]=[L("Send Email",-1)])]),_:1}),y(p(le),null,{default:w(()=>[...c[2]||(c[2]=[L(" Send an email to the customer ",-1)])]),_:1})]),_:1}),y(yl,{onSend:l,onCancel:c[0]||(c[0]=f=>o.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}};function za(t){var o,c,f;const s=t.lead;if(!s)return null;const a=te(s,"lead");if(!a)return((o=W[B.NEW])==null?void 0:o.primaryAction)||null;const l=W[a];if(!l)return((c=W[B.NEW])==null?void 0:c.primaryAction)||null;if(!l.primaryAction)return((f=W[B.NEW])==null?void 0:f.primaryAction)||null;const r=l.primaryAction;return typeof r=="function"?r({lead:s,displayStage:a}):r}function ja(t){const s=t.lead;if(!s)return[];const a=te(s,"lead"),l=W[a];return l?l.secondaryActions||[]:[]}function ke(t){const s=t.lead;if(!s||!(s.isDisqualified===!0))return!1;const l=te(s,"lead");return l===B.CLOSED_INVALID||l===B.CLOSED_NOT_INTERESTED||l===B.CLOSED_DUPLICATE}function Wa(t){const s=t.lead;if(!s||ke(t))return!1;const a=te(s,"lead"),l=W[a];return l?typeof l.showLQWidget=="function"?l.showLQWidget(s):l.showLQWidget??!1:!1}function Ha(t){const s=t.lead;if(!s||ke(t))return!1;const a=te(s,"lead"),l=W[a];return l?l.showDeadlineBanner&&s.nextActionDue:!1}function Qa(t){const s=t.lead;if(!s)return!1;const a=te(s,"lead"),l=W[a];return l?l.canPostpone??!1:!1}function Ya(t){const s=t.lead;if(!s)return"qualification";const a=te(s,"lead"),l=W[a];return l&&l.lqWidgetMode||"qualification"}class vl extends De{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(s={}){await new Promise(l=>setTimeout(l,300));let a=[...this.dataSource];return s.leadId!==void 0&&(a=a.filter(l=>l.leadId===parseInt(s.leadId))),s.opportunityId!==void 0&&(a=a.filter(l=>l.opportunityId===parseInt(s.opportunityId))),s.type&&(a=a.filter(l=>l.type===s.type)),s.offerId!==void 0&&(a=a.filter(l=>l.offerId===parseInt(s.offerId))),s.vehicleId!==void 0&&(a=a.filter(l=>l.vehicleId===parseInt(s.vehicleId))),a}async findAllByLeadId(s){return this.findAll({leadId:s})}async findAllByOpportunityId(s){return this.findAll({opportunityId:s})}async findById(s){return await new Promise(l=>setTimeout(l,300)),this.dataSource.find(l=>l.id===parseInt(s))||null}async create(s){await new Promise(r=>setTimeout(r,300));const l={id:this.dataSource.length>0?Math.max(...this.dataSource.map(r=>r.id))+1:1,type:s.type,leadId:s.leadId!==void 0?parseInt(s.leadId):void 0,opportunityId:s.opportunityId!==void 0?parseInt(s.opportunityId):void 0,offerId:s.offerId!==void 0?parseInt(s.offerId):void 0,vehicleId:s.vehicleId!==void 0?parseInt(s.vehicleId):void 0,fields:s.fields||{},currency:s.currency||"EUR",offerValidFrom:s.offerValidFrom||null,offerValidTo:s.offerValidTo||null,status:s.status||"active",createdAt:s.createdAt||new Date().toISOString(),createdBy:s.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(l),l}async update(s,a){await new Promise(r=>setTimeout(r,300));const l=this.dataSource.find(r=>r.id===parseInt(s));if(!l)throw new Error("Purchase method not found");return Object.assign(l,a,{updatedAt:new Date().toISOString()}),l}async delete(s){await new Promise(l=>setTimeout(l,300));const a=this.dataSource.findIndex(l=>l.id===parseInt(s));if(a===-1)throw new Error("Purchase method not found");return this.dataSource.splice(a,1),{success:!0}}}class bl{constructor(){this.repository=new vl}calculateTotal(s){const{type:a,fields:l}=s;if(!l)return 0;const r=parseFloat(l.monthlyInstalment)||0,o=parseFloat(l.downPayment)||0,c=parseInt(l.duration)||0;switch(a){case"FIN":return r*c+o;case"LEA":const f=parseFloat(l.finalInstalment)||0;return r*c+o+f;case"LTR":return r*c+o;default:return 0}}validate(s){const a=[],{type:l,fields:r}=s;if((!l||!["FIN","LEA","LTR"].includes(l))&&a.push("Purchase method type is required and must be FIN, LEA, or LTR"),!r)return a.push("Purchase method fields are required"),{isValid:!1,errors:a};const o=parseFloat(r.monthlyInstalment);(!o||o<=0)&&a.push("Monthly Instalment must be greater than 0");const c=parseFloat(r.downPayment);(c==null||c<0)&&a.push("Down Payment must be greater than or equal to 0");const f=parseInt(r.duration);if((!f||f<12||f>60)&&a.push("Duration must be between 12 and 60 months"),l==="FIN"){const d=parseFloat(r.interestRate);d!=null&&(d<0||d>99.99)&&a.push("Interest Rate must be between 0 and 99.99%");const S=parseFloat(r.effectiveInterestRate);S!=null&&(S<0||S>99.99)&&a.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(l==="LEA"){const d=parseFloat(r.mileageLimit);d!=null&&d<=0&&a.push("Mileage Limit must be greater than 0 if provided");const S=parseFloat(r.finalInstalment);S!=null&&S<0&&a.push("Final Instalment must be greater than or equal to 0");const n=parseFloat(r.interestRate);n!=null&&(n<0||n>99.99)&&a.push("Interest Rate must be between 0 and 99.99%")}if(l==="LTR"){const d=parseFloat(r.mileageLimit);d!=null&&d<=0&&a.push("Mileage Limit must be greater than 0 if provided"),(!r.customerType||!["Private","Business","Fleet"].includes(r.customerType))&&a.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:a.length===0,errors:a}}async findAll(s={}){return await this.repository.findAll(s)}async findById(s){return await this.repository.findById(s)}async create(s){const a=this.validate(s);if(!a.isValid)throw new Error(`Validation failed: ${a.errors.join(", ")}`);const l=await this.repository.create(s),r=this.calculateTotal(l);return l.fields={...l.fields,totalAmount:r},await this.repository.update(l.id,{fields:l.fields})}async update(s,a){const l=await this.repository.findById(s);if(!l)throw new Error("Purchase method not found");const r={...l,...a,fields:{...l.fields,...a.fields}},o=this.validate(r);if(!o.isValid)throw new Error(`Validation failed: ${o.errors.join(", ")}`);const c=this.calculateTotal(r);return r.fields.totalAmount=c,await this.repository.update(s,{...a,fields:r.fields})}async delete(s){return await this.repository.delete(s)}}const se=new bl,ue=(t=300)=>new Promise(s=>setTimeout(s,t)),gl=async(t={})=>(await ue(),await se.findAll(t)),hl=async t=>(await ue(),await se.findById(t)),xl=async t=>(await ue(),await se.create(t)),wl=async(t,s)=>(await ue(),await se.update(t,s)),kl=async t=>(await ue(),await se.delete(t)),Sl=Pe("purchaseMethods",()=>{const t=F([]),s=F(null),a=F(!1),l=F(null),r=N(()=>g=>t.value.filter(i=>i.type===g)),o=N(()=>g=>t.value.filter(i=>i.leadId===parseInt(g))),c=N(()=>g=>t.value.filter(i=>i.opportunityId===parseInt(g)));return{purchaseMethods:t,currentPurchaseMethod:s,loading:a,error:l,purchaseMethodsByType:r,purchaseMethodsByLead:o,purchaseMethodsByOpportunity:c,fetchPurchaseMethods:async(g={})=>{a.value=!0,l.value=null;try{const i=await gl(g);return t.value=i,i}catch(i){throw l.value=i.message,i}finally{a.value=!1}},fetchPurchaseMethodById:async g=>{a.value=!0,l.value=null;try{return s.value=await hl(g),s.value}catch(i){throw l.value=i.message,i}finally{a.value=!1}},createPurchaseMethod:async g=>{a.value=!0,l.value=null;try{const i=await xl(g);return t.value.push(i),i}catch(i){throw l.value=i.message,i}finally{a.value=!1}},updatePurchaseMethod:async(g,i)=>{var v;a.value=!0,l.value=null;try{const D=await wl(g,i),O=t.value.findIndex(E=>E.id===g);return O!==-1&&(t.value[O]=D),((v=s.value)==null?void 0:v.id)===g&&(s.value=D),D}catch(D){throw l.value=D.message,D}finally{a.value=!1}},deletePurchaseMethod:async g=>{var i;a.value=!0,l.value=null;try{await kl(g),t.value=t.value.filter(v=>v.id!==g),((i=s.value)==null?void 0:i.id)===g&&(s.value=null)}catch(v){throw l.value=v.message,v}finally{a.value=!1}}}}),Cl={class:"flex gap-2"},Tl=["value"],Il={key:0,class:"space-y-4"},Al={class:"text-h3-card text-heading mb-4"},$l={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ml={class:"relative"},Dl={key:0,class:"text-xs text-red-600 mt-1"},Pl={class:"relative"},Ll={key:0,class:"text-xs text-red-600 mt-1"},Vl={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl=["value"],Ol={key:0,class:"text-xs text-red-600 mt-1"},El={key:0,class:"text-xs text-red-600 mt-1"},Ul={key:0,class:"text-xs text-red-600 mt-1"},Rl={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Nl={class:"flex justify-between items-center"},Bl={class:"text-lg font-bold text-heading"},ql={class:"flex flex-col gap-2"},zl={class:"flex items-center gap-2"},jl={class:"flex items-center gap-2"},Wl={class:"flex items-center gap-2"},Hl={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},Ql={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},Yl={class:"list-disc list-inside text-sm text-red-700 space-y-1"},Gl={key:0},Kl={key:1},Zl={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:t=>["lead","opportunity"].includes(t)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(t,{emit:s}){const a=t,l=s,r=Sl(),o=Le(),c=F(!1),f=F({}),d=F([]),S=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],n=F({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),m=N(()=>!!a.purchaseMethod);N(()=>{if(n.value.type!=="LEA")return 0;const $=parseFloat(n.value.fields.monthlyInstalment)||0,u=parseInt(n.value.fields.duration)||0,I=parseFloat(n.value.fields.downPayment)||0,oe=parseFloat(n.value.fields.finalInstalment)||0;return $*u+I+oe});const g=N(()=>{if(n.value.type!=="LTR")return 0;const $=parseFloat(n.value.fields.monthlyInstalment)||0,u=parseInt(n.value.fields.duration)||0,I=parseFloat(n.value.fields.downPayment)||0;return $*u+I}),i=$=>$==="FIN"?[12,24,36,48,60]:$==="LEA"?[24,36,48,60]:$==="LTR"?[12,24,36,48,60]:[],v=$=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[$]||$,D=$=>{const u=n.value.fields[$];switch($){case"monthlyInstalment":!u||u<=0?f.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete f.value.monthlyInstalment;break;case"downPayment":u==null||u<0?f.value.downPayment="Down Payment must be greater than or equal to 0":delete f.value.downPayment;break;case"duration":n.value.type==="LTR"&&(!u||u<12||u>60)?f.value.duration="Duration must be between 12 and 60 months":delete f.value.duration;break;case"customerType":n.value.type==="LTR"&&(!u||!["Private","Business","Fleet"].includes(u))?f.value.customerType="Customer Type is required":delete f.value.customerType;break}},O=$=>{delete f.value[$]},E=()=>{d.value=[],f.value={};const $=se.validate({type:n.value.type,fields:n.value.fields});return $.isValid||(d.value=$.errors,$.errors.forEach(u=>{u.includes("Monthly Instalment")?f.value.monthlyInstalment=u:u.includes("Down Payment")?f.value.downPayment=u:u.includes("Duration")?f.value.duration=u:u.includes("Customer Type")&&(f.value.customerType=u)})),$.isValid},A=N(()=>!n.value.type||!n.value.fields.monthlyInstalment||n.value.fields.monthlyInstalment<=0||n.value.fields.downPayment===null||n.value.fields.downPayment===void 0||n.value.fields.downPayment<0||n.value.type==="LTR"&&(!n.value.fields.duration||n.value.fields.duration<12||n.value.fields.duration>60)||n.value.type==="LTR"&&!n.value.fields.customerType?!1:Object.keys(f.value).length===0),k=()=>{n.value.type!=="FIN"&&(n.value.fields.effectiveInterestRate=null,n.value.fields.gfv=null),n.value.type!=="LEA"&&(n.value.fields.finalInstalment=null),n.value.type!=="LTR"&&(n.value.fields.customerType="",n.value.fields.registrationTaxesIncluded=!1),n.value.type!=="LEA"&&n.value.type!=="LTR"&&(n.value.fields.mileageLimit=null,n.value.fields.maintenanceIncluded=!1),f.value={},d.value=[]},U=async()=>{var $;if(E()){c.value=!0;try{const u={type:n.value.type,fields:{...n.value.fields},currency:n.value.currency,offerValidFrom:n.value.offerValidFrom||null,offerValidTo:n.value.offerValidTo||null,createdBy:(($=o.currentUser)==null?void 0:$.id)||null};a.taskType==="lead"?u.leadId=parseInt(a.taskId):a.taskType==="opportunity"&&(u.opportunityId=parseInt(a.taskId)),a.vehicleId&&(u.vehicleId=parseInt(a.vehicleId)),a.offerId&&(u.offerId=parseInt(a.offerId));let I;m.value?I=await r.updatePurchaseMethod(a.purchaseMethod.id,u):I=await r.createPurchaseMethod(u);const oe=v(I.type),Se=he(I.fields.monthlyInstalment||0);l("save",{...I,successMessage:`Purchase Method Added: ${oe} - €${Se}/month`}),l("close")}catch(u){d.value=[u.message||"Failed to save purchase method"]}finally{c.value=!1}}},h=$=>{$||l("close")};return re(()=>{a.purchaseMethod&&(n.value={type:a.purchaseMethod.type||"",fields:{...n.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null})}),Q(()=>a.show,$=>{$?a.purchaseMethod&&(n.value={type:a.purchaseMethod.type||"",fields:{...n.value.fields,...a.purchaseMethod.fields},currency:a.purchaseMethod.currency||"EUR",offerValidFrom:a.purchaseMethod.offerValidFrom||null,offerValidTo:a.purchaseMethod.offerValidTo||null}):setTimeout(()=>{n.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},f.value={},d.value=[],c.value=!1},300)}),($,u)=>(b(),R(p(X),{open:t.show,"onUpdate:open":h},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[L(T(m.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1}),y(p(le),null,{default:w(()=>[L(T(m.value?"Update purchase method details":"Select purchase method type and fill in the details"),1)]),_:1})]),_:1}),e("form",{onSubmit:ie(U,["prevent"]),class:"space-y-6"},[e("div",null,[u[19]||(u[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",Cl,[(b(),x(j,null,ae(S,I=>e("label",{key:I.value,class:"flex-1 cursor-pointer"},[C(e("input",{type:"radio",value:I.value,"onUpdate:modelValue":u[0]||(u[0]=oe=>n.value.type=oe),class:"sr-only",onChange:k},null,40,Tl),[[Ve,n.value.type]]),e("div",{class:q(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",n.value.type===I.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},T(I.label),3)])),64))])]),n.value.type?(b(),x("div",Il,[e("h3",Al,T(v(n.value.type))+" Details ",1),e("div",$l,[e("div",null,[u[21]||(u[21]=e("label",{class:"block label-upper mb-2"},[L(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Ml,[u[20]||(u[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":u[1]||(u[1]=I=>n.value.fields.monthlyInstalment=I),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":f.value.monthlyInstalment}]),onInput:u[2]||(u[2]=I=>O("monthlyInstalment")),onBlur:u[3]||(u[3]=I=>D("monthlyInstalment"))},null,34),[[M,n.value.fields.monthlyInstalment,void 0,{number:!0}]])]),f.value.monthlyInstalment?(b(),x("p",Dl,T(f.value.monthlyInstalment),1)):V("",!0),u[22]||(u[22]=e("p",{class:"text-xs text-sub mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[u[24]||(u[24]=e("label",{class:"block label-upper mb-2"},[L(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",Pl,[u[23]||(u[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),C(e("input",{"onUpdate:modelValue":u[4]||(u[4]=I=>n.value.fields.downPayment=I),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:q(["input pl-8",{"border-red-500":f.value.downPayment}]),onInput:u[5]||(u[5]=I=>O("downPayment")),onBlur:u[6]||(u[6]=I=>D("downPayment"))},null,34),[[M,n.value.fields.downPayment,void 0,{number:!0}]])]),f.value.downPayment?(b(),x("p",Ll,T(f.value.downPayment),1)):V("",!0),u[25]||(u[25]=e("p",{class:"text-xs text-sub mt-1"},"Amount at contract signing",-1))])]),n.value.type==="LTR"?(b(),x("div",Vl,[e("div",null,[u[27]||(u[27]=e("label",{class:"block label-upper mb-2"},[L(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":u[7]||(u[7]=I=>n.value.fields.duration=I),class:q(["input",{"border-red-500":f.value.duration}]),onChange:u[8]||(u[8]=I=>O("duration"))},[u[26]||(u[26]=e("option",{value:""},"Select duration...",-1)),(b(!0),x(j,null,ae(i(n.value.type),I=>(b(),x("option",{key:I,value:I},T(I)+" months ",9,Fl))),128))],34),[[z,n.value.fields.duration,void 0,{number:!0}]]),f.value.duration?(b(),x("p",Ol,T(f.value.duration),1)):V("",!0)]),e("div",null,[u[28]||(u[28]=e("label",{class:"block label-upper mb-2"},"Unlock Kilometers",-1)),C(e("input",{"onUpdate:modelValue":u[9]||(u[9]=I=>n.value.fields.mileageLimit=I),type:"number",min:"0",placeholder:"0",class:q(["input",{"border-red-500":f.value.mileageLimit}]),onInput:u[10]||(u[10]=I=>O("mileageLimit"))},null,34),[[M,n.value.fields.mileageLimit,void 0,{number:!0}]]),f.value.mileageLimit?(b(),x("p",El,T(f.value.mileageLimit),1)):V("",!0)])])):V("",!0),n.value.type==="LTR"?(b(),x(j,{key:1},[e("div",null,[u[30]||(u[30]=e("label",{class:"block label-upper mb-2"},[L(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),C(e("select",{"onUpdate:modelValue":u[11]||(u[11]=I=>n.value.fields.customerType=I),class:q(["input",{"border-red-500":f.value.customerType}]),onChange:u[12]||(u[12]=I=>O("customerType"))},[...u[29]||(u[29]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[z,n.value.fields.customerType]]),f.value.customerType?(b(),x("p",Ul,T(f.value.customerType),1)):V("",!0)]),e("div",Rl,[e("div",Nl,[u[31]||(u[31]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",Bl,"€ "+T(p(he)(g.value)),1)]),u[32]||(u[32]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",ql,[e("div",zl,[C(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":u[13]||(u[13]=I=>n.value.fields.insuranceIncluded=I),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ce,n.value.fields.insuranceIncluded]]),u[33]||(u[33]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",jl,[C(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":u[14]||(u[14]=I=>n.value.fields.maintenanceIncluded=I),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ce,n.value.fields.maintenanceIncluded]]),u[34]||(u[34]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Wl,[C(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":u[15]||(u[15]=I=>n.value.fields.registrationTaxesIncluded=I),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[ce,n.value.fields.registrationTaxesIncluded]]),u[35]||(u[35]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):V("",!0),e("div",Hl,[e("div",null,[u[36]||(u[36]=e("label",{class:"block label-upper mb-2"},"Offer Valid From",-1)),C(e("input",{"onUpdate:modelValue":u[16]||(u[16]=I=>n.value.offerValidFrom=I),type:"date",class:"input"},null,512),[[M,n.value.offerValidFrom]])]),e("div",null,[u[37]||(u[37]=e("label",{class:"block label-upper mb-2"},"Offer Valid To",-1)),C(e("input",{"onUpdate:modelValue":u[17]||(u[17]=I=>n.value.offerValidTo=I),type:"date",class:"input"},null,512),[[M,n.value.offerValidTo]])])])])):V("",!0),d.value.length>0?(b(),x("div",Ql,[u[38]||(u[38]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Yl,[(b(!0),x(j,null,ae(d.value,I=>(b(),x("li",{key:I},T(I),1))),128))])])):V("",!0)],32),y(p(de),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:w(()=>[y(p(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[18]||(u[18]=I=>$.$emit("close"))}),y(p(P),{label:m.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!A.value||c.value,onClick:U},{default:w(()=>[c.value?(b(),x("span",Gl,"Saving...")):(b(),x("span",Kl,T(m.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ga=we(Zl,[["__scopeId","data-v-6c00d475"]]),Jl={key:0,class:"space-y-4 py-4"},Xl={class:"grid grid-cols-1 gap-3"},_l={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ea={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ta=["max"],la={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},aa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},na=["max"],sa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ia={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ra={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ka={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:t=>["vehicle","tradein"].includes(t)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:s}){const a=t,l=s,r=F(a.mode==="tradein"?"tradein":null);Q(()=>a.mode,g=>{g==="tradein"?r.value="tradein":a.item||(r.value=null)});const o=N(()=>a.mode==="tradein"||r.value==="tradein"),c=()=>a.mode==="tradein"||r.value==="tradein"?"Add Trade-In Vehicle":r.value==="drove"?"Add Drove Vehicle":r.value==="requested"?"Add Requested Vehicle":"Add Vehicle",f=()=>a.mode==="tradein"||r.value==="tradein"?"Record details of the customer's trade-in vehicle":r.value==="drove"?"Record details of a vehicle the customer drove":r.value==="requested"?"Record details of a vehicle the customer requested":"Fill in the details for the new vehicle",d=F({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});re(()=>{a.item&&a.item.data&&(d.value={brand:a.item.data.brand||"",model:a.item.data.model||"",year:a.item.data.year||"",version:a.item.data.version||"",vin:a.item.data.vin||"",plates:a.item.data.plate||a.item.data.plates||"",fuelType:a.item.data.fuelType||"",gearType:a.item.data.gearType||"",kilometers:a.item.data.km||a.item.data.kilometers||"",registration:a.item.data.date||a.item.data.registration||"",owner:a.item.data.owner||"",ownershipType:a.item.data.ownershipType||"",ownedSince:a.item.data.ownedSince||"",warrantyInfo:a.item.data.warrantyInfo||"",note:a.item.data.note||"",stockDays:null})}),Q(()=>a.show,g=>{g||(r.value=null,d.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const S=N(()=>!!d.value.brand&&!!d.value.model&&!!d.value.year),n=g=>{g||l("close")},m=()=>{if(!S.value)return;const g={vehicle:{brand:d.value.brand,model:d.value.model,year:parseInt(d.value.year)||null,version:d.value.version||null,vin:d.value.vin||null,plates:d.value.plates||null,fuelType:d.value.fuelType||null,gearType:d.value.gearType||null,kilometers:parseInt(d.value.kilometers)||0,registration:d.value.registration||null,owner:d.value.owner||null,ownershipType:d.value.ownershipType||null,ownedSince:d.value.ownedSince||null,warrantyInfo:d.value.warrantyInfo||null,note:d.value.note||null,stockDays:null,status:"Available"}};r.value&&(g.vehicleType=r.value),a.item&&(g.id=a.item.id,g.isEdit=!0,g.timestamp=a.item.timestamp||new Date().toISOString()),l("save",g)};return(g,i)=>(b(),R(p(X),{open:t.show,"onUpdate:open":n},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-lg max-h-[90vh] overflow-y-auto"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[L(T(c()),1)]),_:1}),y(p(le),null,{default:w(()=>[L(T(f()),1)]),_:1})]),_:1}),t.mode==="vehicle"&&!t.item&&!r.value?(b(),x("div",Jl,[i[26]||(i[26]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Xl,[y(p(P),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:i[0]||(i[0]=v=>r.value="drove")}),y(p(P),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:i[1]||(i[1]=v=>r.value="requested")}),y(p(P),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:i[2]||(i[2]=v=>r.value="tradein")})])])):(b(),x("form",{key:1,onSubmit:ie(m,["prevent"]),class:"space-y-4"},[o.value?(b(),x(j,{key:0},[e("div",_l,[e("div",null,[i[27]||(i[27]=e("label",{class:"block label-upper mb-2"},"Brand *",-1)),C(e("input",{"onUpdate:modelValue":i[3]||(i[3]=v=>d.value.brand=v),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[M,d.value.brand]])]),e("div",null,[i[28]||(i[28]=e("label",{class:"block label-upper mb-2"},"Model *",-1)),C(e("input",{"onUpdate:modelValue":i[4]||(i[4]=v=>d.value.model=v),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[M,d.value.model]])])]),e("div",ea,[e("div",null,[i[29]||(i[29]=e("label",{class:"block label-upper mb-2"},"Year (or registration year) *",-1)),C(e("input",{"onUpdate:modelValue":i[5]||(i[5]=v=>d.value.year=v),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,ta),[[M,d.value.year]])]),e("div",null,[i[30]||(i[30]=e("label",{class:"block label-upper mb-2"},"Kilometers",-1)),C(e("input",{"onUpdate:modelValue":i[6]||(i[6]=v=>d.value.kilometers=v),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[M,d.value.kilometers,void 0,{number:!0}]])])]),e("div",la,[e("div",null,[i[32]||(i[32]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),C(e("select",{"onUpdate:modelValue":i[7]||(i[7]=v=>d.value.fuelType=v),class:"input"},[...i[31]||(i[31]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[z,d.value.fuelType]])]),e("div",null,[i[34]||(i[34]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),C(e("select",{"onUpdate:modelValue":i[8]||(i[8]=v=>d.value.gearType=v),class:"input"},[...i[33]||(i[33]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[z,d.value.gearType]])])]),e("div",null,[i[35]||(i[35]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),C(e("input",{"onUpdate:modelValue":i[9]||(i[9]=v=>d.value.plates=v),type:"text",placeholder:"License plate number",class:"input"},null,512),[[M,d.value.plates]]),i[36]||(i[36]=e("p",{class:"text-xs text-sub mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",null,[i[37]||(i[37]=e("label",{class:"block label-upper mb-2"},"Note",-1)),C(e("textarea",{"onUpdate:modelValue":i[10]||(i[10]=v=>d.value.note=v),rows:"4",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"input resize-none"},null,512),[[M,d.value.note]])])],64)):(b(),x(j,{key:1},[e("div",aa,[e("div",null,[i[38]||(i[38]=e("label",{class:"block label-upper mb-2"},"Brand",-1)),C(e("input",{"onUpdate:modelValue":i[11]||(i[11]=v=>d.value.brand=v),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[M,d.value.brand]])]),e("div",null,[i[39]||(i[39]=e("label",{class:"block label-upper mb-2"},"Model",-1)),C(e("input",{"onUpdate:modelValue":i[12]||(i[12]=v=>d.value.model=v),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[M,d.value.model]])]),e("div",null,[i[40]||(i[40]=e("label",{class:"block label-upper mb-2"},"Year",-1)),C(e("input",{"onUpdate:modelValue":i[13]||(i[13]=v=>d.value.year=v),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,na),[[M,d.value.year]])])]),e("div",null,[i[41]||(i[41]=e("label",{class:"block label-upper mb-2"},"Version/Trim",-1)),C(e("input",{"onUpdate:modelValue":i[14]||(i[14]=v=>d.value.version=v),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[M,d.value.version]])]),e("div",sa,[e("div",null,[i[42]||(i[42]=e("label",{class:"block label-upper mb-2"},"VIN",-1)),C(e("input",{"onUpdate:modelValue":i[15]||(i[15]=v=>d.value.vin=v),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[M,d.value.vin]])]),e("div",null,[i[43]||(i[43]=e("label",{class:"block label-upper mb-2"},"Plates",-1)),C(e("input",{"onUpdate:modelValue":i[16]||(i[16]=v=>d.value.plates=v),type:"text",placeholder:"License plate number",class:"input"},null,512),[[M,d.value.plates]])])]),e("div",oa,[e("div",null,[i[45]||(i[45]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),C(e("select",{"onUpdate:modelValue":i[17]||(i[17]=v=>d.value.fuelType=v),class:"input"},[...i[44]||(i[44]=[e("option",{value:""},"Select fuel type...",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1),e("option",{value:"Plug-in Hybrid"},"Plug-in Hybrid",-1)])],512),[[z,d.value.fuelType]])]),e("div",null,[i[47]||(i[47]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),C(e("select",{"onUpdate:modelValue":i[18]||(i[18]=v=>d.value.gearType=v),class:"input"},[...i[46]||(i[46]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[z,d.value.gearType]])]),e("div",null,[i[48]||(i[48]=e("label",{class:"block label-upper mb-2"},"Mileage (km)",-1)),C(e("input",{"onUpdate:modelValue":i[19]||(i[19]=v=>d.value.kilometers=v),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[M,d.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[i[49]||(i[49]=e("label",{class:"block label-upper mb-2"},"Registration Year/Month",-1)),C(e("input",{"onUpdate:modelValue":i[20]||(i[20]=v=>d.value.registration=v),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[M,d.value.registration]])]),e("div",ia,[e("div",null,[i[50]||(i[50]=e("label",{class:"block label-upper mb-2"},"Owned Since",-1)),C(e("input",{"onUpdate:modelValue":i[21]||(i[21]=v=>d.value.ownedSince=v),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[M,d.value.ownedSince]])]),e("div",null,[i[51]||(i[51]=e("label",{class:"block label-upper mb-2"},"Owner",-1)),C(e("input",{"onUpdate:modelValue":i[22]||(i[22]=v=>d.value.owner=v),type:"text",placeholder:"Owner name",class:"input"},null,512),[[M,d.value.owner]])])]),e("div",ra,[e("div",null,[i[53]||(i[53]=e("label",{class:"block label-upper mb-2"},"Ownership Type",-1)),C(e("select",{"onUpdate:modelValue":i[23]||(i[23]=v=>d.value.ownershipType=v),class:"input"},[...i[52]||(i[52]=[e("option",{value:""},"Select ownership type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Company"},"Company",-1),e("option",{value:"Lease"},"Lease",-1),e("option",{value:"Fleet"},"Fleet",-1)])],512),[[z,d.value.ownershipType]])])]),e("div",null,[i[54]||(i[54]=e("label",{class:"block label-upper mb-2"},"Warranty Info",-1)),C(e("textarea",{"onUpdate:modelValue":i[24]||(i[24]=v=>d.value.warrantyInfo=v),rows:"3",placeholder:"Warranty information...",class:"input"},null,512),[[M,d.value.warrantyInfo]])])],64))],32)),y(p(de),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:w(()=>[y(p(P),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i[25]||(i[25]=v=>g.$emit("close"))}),y(p(P),{label:o.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!S.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Za(){const t=qe();return{saveTradeInVehicle:async(l,r,o,c={})=>{try{const f=await t.addVehicle(o),d={type:"tradein",action:"added a trade-in",vehicleId:f.id,data:{brand:o.brand,model:o.model,version:o.version||null,year:o.year,kilometers:o.kilometers||0,plates:o.plates||null,registration:o.registration||null,vin:o.vin||null,fuelType:o.fuelType||null,gearType:o.gearType||null,tradeInPrice:c.tradeInPrice||null,evaluationRangeLow:c.evaluationRangeLow||null,evaluationRangeHigh:c.evaluationRangeHigh||null,provider:c.provider||null,evaluationDate:c.evaluationDate||null,priceToBuy:c.priceToBuy||null,priceToSell:c.priceToSell||null,priceOfVehicle:c.priceOfVehicle||null,priceOfOptionals:c.priceOfOptionals||null,listOfOptionals:c.listOfOptionals||null}};let S;if(l==="lead")S=await Ee(r,d);else if(l==="opportunity")S=await Ue(r,d);else throw new Error(`Invalid taskType: ${l}`);return{vehicle:f,activity:S}}catch(f){throw console.error("Error saving trade-in vehicle:",f),f}},updateTradeInVehicle:async(l,r,o,c,f,d={})=>{try{const S=await t.modifyVehicle(o,f),n={data:{brand:f.brand,model:f.model,version:f.version||null,year:f.year,kilometers:f.kilometers||0,plates:f.plates||null,registration:f.registration||null,vin:f.vin||null,fuelType:f.fuelType||null,gearType:f.gearType||null,tradeInPrice:d.tradeInPrice||null,evaluationRangeLow:d.evaluationRangeLow||null,evaluationRangeHigh:d.evaluationRangeHigh||null,provider:d.provider||null,evaluationDate:d.evaluationDate||null,priceToBuy:d.priceToBuy||null,priceToSell:d.priceToSell||null,priceOfVehicle:d.priceOfVehicle||null,priceOfOptionals:d.priceOfOptionals||null,listOfOptionals:d.listOfOptionals||null}};let m;if(l==="lead")m=await Fe(r,c,n);else if(l==="opportunity")m=await Oe(r,c,n);else throw new Error(`Invalid taskType: ${l}`);return{vehicle:S,activity:m}}catch(S){throw console.error("Error updating trade-in vehicle:",S),S}}}}function _(t){if(!t)return 0;const s=new Date(t),l=Math.abs(new Date-s);return Math.ceil(l/(1e3*60*60*24))}const ne={"no-appointment":t=>!t.scheduledAppointment,"has-appointment":t=>!!t.scheduledAppointment,"appointment-past-not-completed":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)<new Date&&t.scheduledAppointment.status!=="completed":!1,"has-future-appointment":t=>t.scheduledAppointment?new Date(t.scheduledAppointment.start)>new Date:!1,"no-offers":t=>!t.hasOffers,"has-offers":t=>t.hasOffers,"qualified-no-offers-7-13-days":t=>{const s=H(),a=s.getSetting("oofbMinDays"),l=s.getSetting("oofbMaxDays"),r=_(t.opportunity.createdAt);return r>=a&&r<l+1&&!t.hasOffers},"qualified-no-offers-14-plus-days":t=>{const a=H().getSetting("ufbDays");return _(t.opportunity.createdAt)>=a&&!t.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const a=H().getSetting("ofbDays");return _(t.opportunity.lastActivity||t.opportunity.createdAt)>=a&&!t.opportunity.contractDate&&t.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":t=>{if(t.stage==="In Negotiation"&&!t.hasOffers)return!1;const a=H().getSetting("nfuDays"),l=_(t.opportunity.lastActivity||t.opportunity.createdAt),r=t.scheduledAppointment&&new Date(t.scheduledAppointment.start)>new Date;return l>=a&&!t.opportunity.contractDate&&!r&&t.hasOffers},"contract-7-plus-days-no-delivery":t=>{var o;if(!t.opportunity.contractDate)return!1;const a=H().getSetting("cfbDays"),l=_(t.opportunity.contractDate),r=(o=t.activities)==null?void 0:o.some(c=>{var f;return c.type==="delivery"||((f=c.action)==null?void 0:f.toLowerCase().includes("delivered"))});return l>=a&&!r},"delivery-date-set":t=>!!t.opportunity.deliveryDate,"delivery-3-plus-days":t=>{var o;const s=(o=t.activities)==null?void 0:o.find(c=>{var f;return c.type==="delivery"||((f=c.action)==null?void 0:f.toLowerCase().includes("delivered"))});if(!s)return!1;const l=H().getSetting("dfbDays");return _(s.timestamp)>=l},"is-awaiting-delivery":t=>t.deliverySubstatus==="Awaiting Delivery","is-delivered":t=>t.deliverySubstatus==="Delivered","has-no-delivery":t=>!t.deliverySubstatus||t.deliverySubstatus===null,"is-closed":t=>{const s=t.stage;return s==="Closed Won"||s==="Closed Lost"},"is-closed-with-task-widget":t=>ne["is-closed"](t)&&t.hasActiveTaskWidget,"opportunity-abandoned":t=>{if(ne["is-closed"](t))return!1;const s=H(),a=s.getSetting("abandonedOpportunityDays");if(!s.getSetting("abandonedEligibleStages").includes(t.stage))return!1;const r=t.opportunity.lastActivity||t.opportunity.createdAt;return _(r)>=a}};function Ja(t,s){if(ne["is-closed-with-task-widget"](s))return[me.reopen,me.requalify,me.closeLost];const a=ye[t];return!a||!a.secondaryActions?[]:a.secondaryActions.filter(l=>{if(!l.conditional)return!0;const r=ne[l.conditional];return r?r(s):!0})}function Xa(t,s){const a=ye[t];if(!a||!a.taskWidgets)return null;const r=H().getSetting("autoCloseWidgetsOnClose"),o=ne["is-closed"]({stage:t});for(const c of a.taskWidgets){if(r&&o&&(c.type==="NFU"||c.type==="OFB"))continue;const f=ne[c.condition];if(f&&f(s))return c.type}return null}function _a(t,s){const a=ye[t];if(!a||!a.primaryAction)return null;let l=a.primaryAction;return typeof l=="function"&&(l=l(s),!l)?null:{...l,title:typeof l.title=="function"?l.title(s):l.title,description:typeof l.description=="function"?l.description(s):l.description,label:typeof l.label=="function"?l.label(s):l.label}}function en(t){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[t]||"Task"}function tn(t){return t==="Closed Won"||t==="Closed Lost"}const da={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},ua={key:0,class:"flex justify-between items-center mb-4"},ca={class:"text-sm font-bold text-heading"},pa={key:1,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-E5E7EB"},ma={class:"flex items-center gap-3"},fa={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},ya=["src"],va={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},ba={class:"font-bold text-sm text-heading"},ga={class:"text-xs text-sub"},ha={class:"space-y-4"},xa={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wa={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ka=["disabled"],ln={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:s,emit:a}){const l=t,r=a,o=F({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});re(()=>{if(l.selectedVehicle){o.value.price=l.selectedVehicle.price||0,o.value.brand=l.selectedVehicle.brand||"",o.value.model=l.selectedVehicle.model||"",o.value.year=l.selectedVehicle.year||"",o.value.image=l.selectedVehicle.image||"";const S=new Date;S.setDate(S.getDate()+30),o.value.validUntil=S.toISOString().split("T")[0]}l.item&&l.item.data&&(o.value={...o.value,...l.item.data,price:l.item.data.price||l.item.data.total||0,financingType:l.item.data.financingType||l.item.data.paymentMethod||"",notes:l.item.data.notes||l.item.data.description||""})}),Q(()=>l.selectedVehicle,S=>{S&&!l.item&&(o.value.price=S.price||0,o.value.brand=S.brand||"",o.value.model=S.model||"",o.value.year=S.year||"",o.value.image=S.image||"")});const c=N(()=>o.value.price>0&&o.value.financingType!==""),f=S=>S?S.toLocaleString("en-US"):"0",d=()=>{var n,m;if(!c.value)return;const S={id:((n=l.item)==null?void 0:n.id)||Date.now(),type:"offer",action:l.item?"updated an offer":"created an offer",data:{brand:o.value.brand,model:o.value.model,year:o.value.year,price:o.value.price,total:o.value.price,paymentMethod:o.value.financingType,financingType:o.value.financingType,downPayment:o.value.downPayment,monthlyPayment:o.value.monthlyPayment,term:o.value.term,interestRate:o.value.interestRate,deliveryDate:o.value.deliveryDate,validUntil:o.value.validUntil,notes:o.value.notes,description:o.value.notes,image:o.value.image},timestamp:((m=l.item)==null?void 0:m.timestamp)||new Date().toISOString(),isEdit:!!l.item};r("save",S)};return s({submit:d,isValid:c,offerData:o}),(S,n)=>(b(),x("div",da,[t.hideHeader?V("",!0):(b(),x("div",ua,[e("h5",ca,T(t.item?"Edit Offer":"Create Offer"),1),e("button",{onClick:n[0]||(n[0]=m=>S.$emit("cancel")),class:"text-sub hover:text-body"},[...n[11]||(n[11]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t.selectedVehicle?(b(),x("div",pa,[n[12]||(n[12]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",ma,[e("div",fa,[t.selectedVehicle.image?(b(),x("img",{key:0,src:t.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,ya)):(b(),x("i",va))]),e("div",null,[e("h4",ba,T(t.selectedVehicle.brand)+" "+T(t.selectedVehicle.model)+" ("+T(t.selectedVehicle.year)+") ",1),e("p",ga,"Base Price: € "+T(f(t.selectedVehicle.price)),1)])])])):V("",!0),e("div",ha,[e("div",null,[n[13]||(n[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},[L(" Offer Price (€) "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{type:"number","onUpdate:modelValue":n[1]||(n[1]=m=>o.value.price=m),class:"input",placeholder:"Enter offer price"},null,512),[[M,o.value.price]])]),e("div",null,[n[15]||(n[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},[L(" Payment Method "),e("span",{class:"text-red-500"},"*")],-1)),C(e("select",{"onUpdate:modelValue":n[2]||(n[2]=m=>o.value.financingType=m),class:"input"},[...n[14]||(n[14]=[e("option",{value:""},"Select payment method",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"finance"},"Finance",-1),e("option",{value:"lease"},"Lease",-1)])],512),[[z,o.value.financingType]])]),o.value.financingType==="finance"||o.value.financingType==="lease"?(b(),x("div",xa,[e("div",null,[n[16]||(n[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Down Payment (€)",-1)),C(e("input",{type:"number","onUpdate:modelValue":n[3]||(n[3]=m=>o.value.downPayment=m),class:"input",placeholder:"0"},null,512),[[M,o.value.downPayment]])]),e("div",null,[n[17]||(n[17]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Monthly Payment (€)",-1)),C(e("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=m=>o.value.monthlyPayment=m),class:"input",placeholder:"Calculated automatically"},null,512),[[M,o.value.monthlyPayment]])]),e("div",null,[n[18]||(n[18]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Term (months)",-1)),C(e("input",{type:"number","onUpdate:modelValue":n[5]||(n[5]=m=>o.value.term=m),class:"input",placeholder:"36"},null,512),[[M,o.value.term]])]),e("div",null,[n[19]||(n[19]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Interest Rate (%)",-1)),C(e("input",{type:"number",step:"0.1","onUpdate:modelValue":n[6]||(n[6]=m=>o.value.interestRate=m),class:"input",placeholder:"3.5"},null,512),[[M,o.value.interestRate]])])])):V("",!0),e("div",null,[n[20]||(n[20]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Expected Delivery Date",-1)),C(e("input",{type:"date","onUpdate:modelValue":n[7]||(n[7]=m=>o.value.deliveryDate=m),class:"input"},null,512),[[M,o.value.deliveryDate]])]),e("div",null,[n[21]||(n[21]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Offer Valid Until",-1)),C(e("input",{type:"date","onUpdate:modelValue":n[8]||(n[8]=m=>o.value.validUntil=m),class:"input"},null,512),[[M,o.value.validUntil]])]),e("div",null,[n[22]||(n[22]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Notes / Special Terms",-1)),C(e("textarea",{"onUpdate:modelValue":n[9]||(n[9]=m=>o.value.notes=m),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[M,o.value.notes]])])]),t.hideActions?V("",!0):(b(),x("div",wa,[e("button",{onClick:n[10]||(n[10]=m=>S.$emit("cancel")),class:"text-xs font-medium text-sub hover:text-body px-3 py-2 rounded-lg hover:bg-surfaceSecondary transition-colors"}," Cancel "),e("button",{onClick:d,disabled:!c.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},T(t.item?"Update Offer":"Create Offer"),9,ka)]))]))}},an={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:s}){const a=s,l=o=>{o||a("close")},r=()=>{a("close")};return(o,c)=>(b(),R(p(X),{open:t.show,"onUpdate:open":l},{default:w(()=>[y(p(Y),null,{default:w(()=>[y(p(G),{class:"fixed inset-0 z-50 bg-black/50"}),y(p(K),{class:"w-full sm:max-w-md"},{default:w(()=>[y(p(Z),null,{default:w(()=>[y(p(J),null,{default:w(()=>[L(T(t.title),1)]),_:1})]),_:1}),c[0]||(c[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),y(p(de),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:w(()=>[y(p(P),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:r})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{ln as A,an as B,yl as C,pl as D,rl as E,W as L,ye as O,Ga as P,Ea as T,Oa as _,Ma as a,Va as b,Pa as c,Fa as d,Ua as e,$a as f,La as g,Ra as h,Na as i,Ba as j,qa as k,ke as l,za as m,ja as n,Ha as o,Qa as p,Ya as q,Da as r,Wa as s,Ka as t,Za as u,Xa as v,_a as w,Ja as x,tn as y,en as z};
