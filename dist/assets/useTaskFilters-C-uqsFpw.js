const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contacts-BDIyKZyn.js","assets/index-Dj_RD8l0.js","assets/index-B2AXF7q7.css","assets/users-THux0QKI.js"])))=>i.map(i=>d[i]);
import{n as Y,z as sa,b as na,Z as Tn,X as On,a as aa,f as fs,F as ys,L as gs,g as bs,h as hs,Q as J,C as xs,d as ws,i as jt,W as Nt,U as Vt,H as Mt,j as be,G as qt,c as at,o as lt,$ as Ln}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-B5cRDmy2.js";import{H as St,M as Wt,c as S,d as C,o as v,e,g as L,t as I,n as Z,s,x as pe,B as r,y as t,X as _n,I as ps,L as la,Y as hn,V as xn,r as A,k as T,C as Pt,j as Fn,T as pt,O as xt,F as qe,P as wn,Z as Us,h as Un,u as Tt,S as _s,q as Qe,i as ze,$ as kn,l as De,p as Ke,a0 as vt,a1 as In,a2 as oa,a3 as ia,a4 as vs,G as At,a5 as bn,_ as Zt,N as ra,w as Sn,m as ks,K as En,a6 as Fs}from"./index-Dj_RD8l0.js";import{u as Lt}from"./opportunities-BC_ZMPUZ.js";import{E as ua,_ as da,T as ca,h as Rn,i as ma,j as pa,k as va,l as fa,m as Cn,P as jn,n as Bn,o as ya,p as ga,q as ba,r as ha,s as xa,t as wa,u as ka,v as Sa,e as Nn,b as Rt,w as ms,g as Ca,c as $a,f as Da,x as Aa,y as Ta,z as Oa,A as Ia,B as Na,C as Va,D as Es,F as Ma}from"./opportunityRules-vWdCqPB2.js";import{_ as Wn}from"./CreateEventModal-2ClmRhSs.js";import{_ as Pn}from"./ReassignUserModal-d8k4ux0v.js";import{u as _t,c as fn}from"./users-THux0QKI.js";import{S as Je}from"./components-D2RBuYr8.js";import{S as qa}from"./sparkles-hzGdDkcm.js";import{f as La}from"./vehicles-BgEBo0jD.js";import{_ as _a,a as Fa}from"./EditEventModal-DuOgUtB3.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=St("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=St("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=St("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=St("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=St("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=St("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=St("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=St("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=St("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=St("ZapIcon",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ya={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Ha={class:"flex items-center justify-between gap-4 w-full h-full"},Qa={class:"flex flex-col min-w-0"},Ja={class:"flex items-center gap-2 min-w-0"},Ga={key:0,class:"text-fluid-lg font-medium text-heading truncate"},Za={key:1,class:"text-fluid-lg font-medium text-heading"},Ka={key:2,class:"flex items-center gap-1.5 shrink-0"},Xa={key:0,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},el={key:0,class:"text-sm text-sub truncate leading-normal mt-0.5"},tl={key:1,class:"text-fluid-sm text-sub"},sl={class:"flex items-center gap-2 shrink-0"},nl={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["previous","next","close"],setup(l){const V=l,o=S(()=>!V.task||!V.filteredTasks.length?!1:V.filteredTasks.findIndex(h=>{const y=V.task.compositeId||V.task.id;return(h.compositeId||h.id)===y})>0),m=S(()=>{if(!V.task||!V.filteredTasks.length)return!1;const d=V.filteredTasks.findIndex(h=>{const y=V.task.compositeId||V.task.id;return(h.compositeId||h.id)===y});return d>=0&&d<V.filteredTasks.length-1}),p=d=>d?d.type==="lead"?"Lead Qualification Task":d.type==="opportunity"?"Opportunity Management Task":"Task Details":"No task selected",c=d=>{var y;if(!d)return"";const h=[];if(d.vehicle||d.requestedCar){const b=d.vehicle||d.requestedCar;b.brand&&b.model?h.push(`${b.brand} ${b.model} (${b.year||"N/A"})`):b.model&&h.push(`${b.model} (${b.year||"N/A"})`)}return d.source&&h.push(d.source),(y=d.customer)!=null&&y.name?h.push(d.customer.name):d.customerName&&h.push(d.customerName),h.join(" • ")},g=d=>{if(!d)return"";if(d.type==="opportunity"){const h=k(d)||d.stage||d.currentStage||"New";f(d);const y=u(d);return y&&y!==h?y:h}return d.stage||d.currentStage||d.displayStage||"New"},f=d=>d?d.stage||d.currentStage||"New":"",k=d=>{if(!d||d.type!=="opportunity")return null;try{return ps(d,"opportunity")}catch{return d.displayStage||d.stage||null}},u=d=>{if(!d||d.type!=="opportunity")return"";const h=f(d),y=k(d);if(!y||!h)return y||"";const b=h.toLowerCase().trim();if(y.toLowerCase().trim().startsWith(b+" - ")){const w=h+" - ";if(y.startsWith(w))return y.substring(w.length)}return y},x=d=>{if(!d)return"bg-gray-50 text-gray-700 border-gray-200";if(d.type==="opportunity"){const y=k(d)||f(d);return $(y,"opportunity")}const h=g(d).toLowerCase();return h.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":h.includes("qualif")?"bg-green-50 text-green-600 border-green-200":h.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":h.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"},$=(d,h="opportunity")=>{if(!d)return"bg-gray-50 text-gray-700 border-gray-200";try{const y=la(d,h);return y.includes("blue")?y+" border-blue-200":y.includes("purple")?y+" border-purple-200":y.includes("yellow")?y+" border-yellow-200":y.includes("pink")?y+" border-pink-200":y.includes("indigo")?y+" border-indigo-200":y.includes("emerald")?y+" border-emerald-200":y.includes("green")?y+" border-green-200":y.includes("red")?y+" border-red-200":(y.includes("gray"),y+" border-gray-200")}catch{const b=d.toLowerCase();return b.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":b.includes("qualif")?"bg-green-50 text-green-600 border-green-200":b.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":b.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}};return(d,h)=>(v(),C("div",Ya,[e("div",Ha,[e("div",Qa,[e("div",Ja,[l.task?(v(),C("h2",Ga,I(p(l.task)),1)):(v(),C("h2",Za," No task selected ")),l.task?(v(),C("div",Ka,[e("span",{class:Z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",l.task.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},I(l.task.type==="lead"?"Lead":"Opportunity"),3),e("span",{class:Z(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",x(l.task)])},I(g(l.task)),3),l.task.priority==="Hot"?(v(),C("span",Xa," Hot ")):L("",!0)])):L("",!0)]),l.task?(v(),C("p",el,I(c(l.task)),1)):(v(),C("p",tl," Select a task to view details "))]),e("div",sl,[s(t(Y),{variant:"secondary",size:"icon",onClick:h[0]||(h[0]=y=>d.$emit("previous")),disabled:!o.value},{default:r(()=>[s(t(Ea),{size:16,class:"text-body"})]),_:1},8,["disabled"]),s(t(Y),{variant:"secondary",size:"icon",onClick:h[1]||(h[1]=y=>d.$emit("next")),disabled:!m.value},{default:r(()=>[s(t(Ra),{size:16,class:"text-body"})]),_:1},8,["disabled"]),l.isDrawerView?(v(),pe(t(Y),{key:0,variant:"secondary",size:"icon",onClick:h[2]||(h[2]=y=>d.$emit("close")),class:"ml-1"},{default:r(()=>[s(t(_n),{size:16,class:"text-body"})]),_:1})):L("",!0)])])]))}},al=Wt(nl,[["__scopeId","data-v-a84389f7"]]),ll=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:l=>["lead","opportunity"].includes(l)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(l){return(V,o)=>(v(),C("div",null,[l.managementWidget?(v(),pe(xn(l.managementWidget),hn({key:0,lead:l.type==="lead"?l.task:void 0,opportunity:l.type==="opportunity"?l.task:void 0,activities:l.activities},V.$attrs),null,16,["lead","opportunity","activities"])):L("",!0)]))}}),ol=Wt(ll,[["__scopeId","data-v-f5db9491"]]),il={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},rl={key:0,class:"w-full h-20 rounded-btn overflow-hidden mb-4 bg-gray-100"},ul=["src","alt"],dl={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},cl={class:"space-y-2 mb-4"},ml={class:"flex justify-between items-start gap-2"},pl={class:"min-w-0 flex-1"},vl={class:"text-sm font-medium text-heading truncate"},fl={key:0,class:"text-sm text-sub"},yl={key:0,class:"text-sm font-semibold text-heading shrink-0"},gl={key:0,class:"flex gap-3 text-sm text-sub"},bl={key:0},hl={key:1},xl={key:2,class:"mb-4"},wl={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},kl={class:"text-sm text-heading"},Sl={class:"flex gap-2 pt-4 border-t border-black/5"},Cl={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(l){const V=l,o=A(!1),m=S(()=>{const f=[];return V.vehicle.brand&&f.push(V.vehicle.brand),V.vehicle.model&&f.push(V.vehicle.model),V.vehicle.variant&&f.push(V.vehicle.variant),f.join(" ")||"Vehicle Details"}),p=f=>{if(!f)return"0";const k=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(k)},c=f=>{if(!f)return"0";const k=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(k)},g=()=>{o.value=!0};return(f,k)=>(v(),C("div",il,[k[4]||(k[4]=e("h3",{class:"text-base font-medium mb-4 text-heading -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),l.imageUrl?(v(),C("div",rl,[e("img",{src:l.imageUrl,alt:`${l.vehicle.brand} ${l.vehicle.model}`,class:"w-full h-full object-cover",onError:g},null,40,ul)])):(v(),C("div",dl,[s(t(Ua),{size:48,class:"text-gray-400"})])),e("div",cl,[e("div",ml,[e("div",pl,[e("p",vl,I(m.value),1),l.vehicle.year?(v(),C("p",fl,I(l.vehicle.year),1)):L("",!0)]),l.vehicle.price?(v(),C("p",yl," €"+I(p(l.vehicle.price)),1)):L("",!0)]),l.vehicle.mileage||l.vehicle.fuelType?(v(),C("div",gl,[l.vehicle.mileage?(v(),C("span",bl,I(c(l.vehicle.mileage))+" km",1)):L("",!0),l.vehicle.fuelType?(v(),C("span",hl,I(l.vehicle.fuelType),1)):L("",!0)])):L("",!0)]),l.source?(v(),C("div",xl,[s(t(sa),{variant:"secondary",class:"text-sm"},{default:r(()=>[T(I(l.source),1)]),_:1})])):L("",!0),l.requestMessage?(v(),C("div",wl,[k[2]||(k[2]=e("p",{class:"text-sm text-sub mb-1"},"Request message",-1)),e("p",kl,I(l.requestMessage),1)])):L("",!0),e("div",Sl,[s(t(Y),{variant:"secondary",size:"sm",class:"flex-1",onClick:k[0]||(k[0]=u=>f.$emit("open-ad"))},{default:r(()=>[s(t(ua),{size:16}),k[3]||(k[3]=e("span",null,"Open Ad",-1))]),_:1}),s(t(Y),{variant:"secondary",size:"icon-sm",onClick:k[1]||(k[1]=u=>f.$emit("more-actions"))},{default:r(()=>[s(t(ja),{size:16})]),_:1})])]))}},$l={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},Dl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},Al={class:"flex flex-1 overflow-hidden"},Tl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},Ol={class:"flex-1 overflow-y-auto"},Il={class:"p-2"},Nl={class:"right-sidebar flex flex-col overflow-hidden shrink-0 border-l border-black/5 bg-surface"},Vl={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},Ml={key:1,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#0470e9] z-10"},ql={class:"flex-1 overflow-y-auto bg-[#F8F8F8]"},Ll={key:1,class:"flex-1 flex items-center justify-center bg-surface"},_l={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]},isDrawerView:{type:Boolean,default:!1}},emits:["task-navigate","close"],setup(l,{emit:V}){const o=l,m=V,p=Pt(),c=Lt(),g=A("request"),f=A({}),k=A(!1),u=A(!1),x=A(!1),$=A(!1),d=A(!1),h=A(!1),y=A(!1),b=A(!1),N=A(!1),w=A(!1),E=S(()=>{var P;return((P=o.storeAdapter.currentActivities)==null?void 0:P.value)||[]}),_=S(()=>E.value.length),F=S(()=>{var Ae;if(!((Ae=o.task)!=null&&Ae.customer))return 0;const P=o.task.customer.email,ee=o.task.customer.phone,Be=o.task.compositeId||`${o.task.type}-${o.task.id}`;return[...(p.leads||[]).map(Te=>({...Te,type:"lead",compositeId:`lead-${Te.id}`})),...(c.opportunities||[]).map(Te=>({...Te,type:"opportunity",compositeId:`opportunity-${Te.id}`}))].filter(Te=>Te.compositeId===Be||!Te.customer?!1:Te.customer.email===P||Te.customer.phone===ee).length}),ye=()=>{m("task-navigate","previous")},fe=()=>{m("task-navigate","next")},q=P=>{g.value!=="activity"&&(g.value="activity"),console.log("Activity clicked:",P)},D=P=>{f.value[P]=!f.value[P]},M=P=>P&&(P.image||P.imageUrl)||"",j=()=>{console.log("Open ad clicked")},H=()=>{console.log("More actions clicked")},ae=P=>{console.log("Contact action:",P)},Q=P=>{P==="note"?k.value=!0:P==="attachment"?u.value=!0:P==="whatsapp"?x.value=!0:P==="sms"?$.value=!0:P==="email"?d.value=!0:P==="call"?h.value=!0:P==="financing"?y.value=!0:P==="tradein"?b.value=!0:P==="purchase"?N.value=!0:P==="appointment"&&(w.value=!0)},we=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"note",content:P.content||P.message,message:P.content||P.message,timestamp:new Date().toISOString()}),k.value=!1}catch(ee){console.error("Error saving note:",ee)}},Ne=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"attachment",fileName:P.fileName,file:P.file,content:`Attachment: ${P.fileName}`,timestamp:new Date().toISOString()}),u.value=!1}catch(ee){console.error("Error saving attachment:",ee)}},ce=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"whatsapp",message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),x.value=!1}catch(ee){console.error("Error saving WhatsApp:",ee)}},te=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"sms",message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),$.value=!1}catch(ee){console.error("Error saving SMS:",ee)}},K=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"email",subject:P.subject,message:P.message,content:P.message,template:P.template,timestamp:new Date().toISOString()}),d.value=!1}catch(ee){console.error("Error saving email:",ee)}},re=async P=>{var ee;try{await o.storeAdapter.addActivity(o.task.id,{type:"financing",action:P.action||"added a financing proposal",content:P.content||`Financing: ${((ee=P.data)==null?void 0:ee.product)||"Unknown"}`,data:P.data,timestamp:new Date().toISOString()}),y.value=!1}catch(Be){console.error("Error saving financing:",Be)}},ke=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"tradein",action:"added a trade-in",content:P.content||"Trade-in vehicle added",data:P.data,timestamp:new Date().toISOString()}),b.value=!1}catch(ee){console.error("Error saving trade-in:",ee)}},Oe=async P=>{var ee;try{await o.storeAdapter.addActivity(o.task.id,{type:"offer",action:P.action||"created an offer",content:P.content||`Offer: €${((ee=P.data)==null?void 0:ee.price)||0}`,data:P.data,timestamp:new Date().toISOString()}),N.value=!1}catch(Be){console.error("Error saving offer:",Be)}},Xe=async P=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"appointment",action:"scheduled an appointment",content:`Appointment: ${P.type||"Meeting"} on ${P.date||""}`,data:P,timestamp:new Date().toISOString()}),w.value=!1}catch(ee){console.error("Error saving appointment:",ee)}};return(P,ee)=>{var Be,Ee,We,Ae,Te,R,B,oe,X,W,se,ie,Se;return v(),C("div",$l,[l.task?(v(),C("div",Dl,[s(al,{task:l.task,"filtered-tasks":l.filteredTasks,"is-drawer-view":l.isDrawerView,onPrevious:ye,onNext:fe,onClose:ee[0]||(ee[0]=ue=>P.$emit("close"))},null,8,["task","filtered-tasks","is-drawer-view"]),e("div",Al,[e("div",Tl,[e("div",Ol,[e("div",Il,[s(ol,hn({task:l.task,type:l.task.type,"management-widget":l.managementWidget,activities:E.value},P.$attrs),null,16,["task","type","management-widget","activities"])])])]),e("div",Nl,[s(t(aa),{modelValue:g.value,"onUpdate:modelValue":ee[1]||(ee[1]=ue=>g.value=ue),class:"flex flex-col flex-1 overflow-hidden"},{default:r(()=>[s(t(na),{class:"flex border-b border-black/5 bg-white rounded-none w-full relative h-full"},{default:r(()=>[s(t(Tn),{value:"request",class:Z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",g.value==="request"?"text-heading":"text-sub hover:text-body"])},{default:r(()=>[ee[12]||(ee[12]=e("span",null,"Request",-1)),F.value>0?(v(),C("span",{key:0,class:Z(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",g.value==="request"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},I(F.value),3)):L("",!0),g.value==="request"?(v(),C("span",Vl)):L("",!0)]),_:1},8,["class"]),s(t(Tn),{value:"activity",class:Z(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full",g.value==="activity"?"text-heading":"text-sub hover:text-body"])},{default:r(()=>[ee[13]||(ee[13]=e("span",null,"Activity",-1)),_.value>0?(v(),C("span",{key:0,class:Z(["flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold leading-none",g.value==="activity"?"bg-[#0470e9] text-white":"bg-gray-200 text-heading"])},I(_.value),3)):L("",!0),g.value==="activity"?(v(),C("span",Ml)):L("",!0)]),_:1},8,["class"])]),_:1}),e("div",ql,[s(t(On),{value:"request",class:"space-y-2 p-2 mt-0"},{default:r(()=>{var ue,Le;return[s(da,{task:l.task,"task-type":l.task.type,"customer-id":l.task.customerId||((ue=l.task.customer)==null?void 0:ue.id),onAction:ae},null,8,["task","task-type","customer-id"]),l.task.requestedCar||l.task.vehicle?(v(),pe(Cl,{key:0,vehicle:l.task.requestedCar||l.task.vehicle,"request-message":l.task.requestMessage||((Le=l.task.requestedCar)==null?void 0:Le.requestMessage),source:l.task.source,"image-url":M(l.task.requestedCar||l.task.vehicle),onOpenAd:j,onMoreActions:H},null,8,["vehicle","request-message","source","image-url"])):L("",!0)]}),_:1}),s(t(On),{value:"activity",class:"p-2 flex-1 overflow-hidden h-full flex flex-col mt-0"},{default:r(()=>[s(ca,{activities:E.value,"expanded-summaries":f.value,onActivityClick:q,onToggleSummaryExpanded:D,onAddActivity:Q},null,8,["activities","expanded-summaries"])]),_:1})])]),_:1},8,["modelValue"])])])])):(v(),C("div",Ll,[...ee[14]||(ee[14]=[Fn('<div class="text-center max-w-sm p-8" data-v-808d9e5c><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-808d9e5c><i class="fa-solid fa-tasks text-2xl text-sub" data-v-808d9e5c></i></div><h3 class="text-fluid-lg font-bold text-heading mb-2" data-v-808d9e5c>No task selected</h3><p class="text-fluid-sm text-sub" data-v-808d9e5c>Select a task from the list to view its details and manage activities</p></div>',1)])])),s(Rn,{modal:"",show:k.value,"task-type":((Be=l.task)==null?void 0:Be.type)||"lead","task-id":(Ee=l.task)==null?void 0:Ee.id,onSave:we,onClose:ee[2]||(ee[2]=ue=>k.value=!1)},null,8,["show","task-type","task-id"]),s(ma,{modal:"",show:u.value,"task-type":((We=l.task)==null?void 0:We.type)||"lead","task-id":(Ae=l.task)==null?void 0:Ae.id,onSave:Ne,onClose:ee[3]||(ee[3]=ue=>u.value=!1)},null,8,["show","task-type","task-id"]),s(pa,{show:x.value,onSave:ce,onClose:ee[4]||(ee[4]=ue=>x.value=!1)},null,8,["show"]),s(va,{show:$.value,onSave:te,onClose:ee[5]||(ee[5]=ue=>$.value=!1)},null,8,["show"]),s(fa,{show:d.value,onSave:K,onClose:ee[6]||(ee[6]=ue=>d.value=!1)},null,8,["show"]),s(Cn,{show:h.value,title:"Call Feature",onClose:ee[7]||(ee[7]=ue=>h.value=!1)},null,8,["show"]),s(jn,{show:y.value,"task-type":((Te=l.task)==null?void 0:Te.type)||"lead","task-id":(R=l.task)==null?void 0:R.id,onSave:re,onClose:ee[8]||(ee[8]=ue=>y.value=!1)},null,8,["show","task-type","task-id"]),s(Bn,{show:b.value,mode:"tradein","task-type":((B=l.task)==null?void 0:B.type)||"lead","task-id":(oe=l.task)==null?void 0:oe.id,onSave:ke,onClose:ee[9]||(ee[9]=ue=>b.value=!1)},null,8,["show","task-type","task-id"]),s(ya,{show:N.value,"task-type":((X=l.task)==null?void 0:X.type)||"lead","task-id":(W=l.task)==null?void 0:W.id,customer:(se=l.task)==null?void 0:se.customer,onSave:Oe,onClose:ee[10]||(ee[10]=ue=>N.value=!1)},null,8,["show","task-type","task-id","customer"]),s(Wn,{show:w.value,customer:(ie=l.task)==null?void 0:ie.customer,assignee:(Se=l.task)==null?void 0:Se.assignee,onCreate:Xe,onCancel:ee[11]||(ee[11]=ue=>w.value=!1)},null,8,["show","customer","assignee"])])}}},jp=Wt(_l,[["__scopeId","data-v-808d9e5c"]]),Fl={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},Ul={__name:"DrawerContainer",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(l,{emit:V}){const o=V,m=()=>{o("close")};return(p,c)=>(v(),C(qe,null,[s(pt,{name:"fade"},{default:r(()=>[l.show?(v(),C("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:m})):L("",!0)]),_:1}),s(pt,{name:"slide-right"},{default:r(()=>[l.show?(v(),C("div",Fl,[xt(p.$slots,"default",{},void 0,!0)])):L("",!0)]),_:3})],64))}},Bp=Wt(Ul,[["__scopeId","data-v-6c60a3d5"]]);function zn(l,V={}){const o=wn(),m=S(()=>{const N=typeof l=="function"?l():Us(l);return{lead:N,displayStage:N?ps(N,"lead"):null}}),p=S(()=>m.value.displayStage||"New"),c=S(()=>{const N=m.value;return ga(N)}),g=S(()=>{const N=m.value,w=ba(N);if(!w)return null;const E=V[w.key];return{...w,handler:E||(()=>{})}}),f=S(()=>{const N=m.value;return ha(N).map(E=>{const _=V[E.key];return{...E,handler:_||(()=>{})}})}),k=S(()=>{const N=m.value;return xa(N)}),u=S(()=>{const N=m.value;return wa(N)}),x=S(()=>{const N=m.value;return ka(N)}),$=S(()=>{const N=m.value;return Sa(N)}),d=S(()=>{const w=m.value.lead;return((w==null?void 0:w.contactAttempts)||[]).length||0}),h=S(()=>o.getSetting("maxContactAttempts")),y=S(()=>d.value+1>=h.value),b=S(()=>!0);return{displayStage:p,isClosed:c,primaryAction:g,secondaryActions:f,showLQWidget:k,showDeadlineBanner:u,canPostpone:x,canReassign:b,lqWidgetMode:$,contactAttempts:d,maxContactAttempts:h,shouldShowAutoDisqualifyWarning:y}}function El({getLead:l,leadState:V,emit:o}){const m=Un(),p=Pt(),c=Tt();async function g(w){var _;const E=l();if(E&&V.canPostpone.value)try{const F=new Date(`${w.date}T${w.time}:00`),ye=F.toISOString(),fe={nextActionDue:ye};if((w.assigneeId||w.teamId)&&(fe.assignee=w.assignee||null,fe.assigneeId=w.assigneeId||null,fe.assigneeType=w.assigneeType||"user",fe.teamId=w.teamId||null,fe.team=w.team||null),await p.updateLead(E.id,fe),w.createAppointment){const q=new Date(F);q.setHours(q.getHours()+1),await p.updateLead(E.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${E.customer.name}`,start:ye,end:q.toISOString(),type:"Call",assignee:w.assignee||E.assignee,assigneeId:w.assigneeId||E.assigneeId,assigneeType:w.assigneeType||E.assigneeType||"user",teamId:w.teamId||E.teamId,team:w.team||E.team,status:"scheduled"}}),await p.addActivity(E.id,{type:"appointment",user:((_=c.currentUser)==null?void 0:_.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Rt(F)} at ${ms(F)}`,data:{type:"Call",date:w.date,time:w.time,assignee:w.assignee||E.assignee}})}await p.addActivity(E.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Rt(F)} at ${ms(F)}${w.assignee?` and reassigned to ${w.assignee}`:""}`}),await p.fetchLeadById(E.id)}catch(F){console.error("Failed to postpone lead task:",F)}}async function f(w){const E=l();if(E)try{if(await p.updateLead(E.id,{stage:"Validated"}),await p.addActivity(E.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),w.scheduleFollowUp&&w.appointmentData){const _=new Date(`${w.appointmentData.date}T${w.appointmentData.time}:00`);await p.scheduleFollowUp(E.id,{dateTime:_.toISOString(),assignee:w.appointmentData.assignee||E.assignee,assigneeId:w.appointmentData.assigneeId||null,assigneeType:w.appointmentData.assigneeType||"user",teamId:w.appointmentData.teamId||null,team:w.appointmentData.team||null}),await p.addActivity(E.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Rt(_)} at ${ms(_)}`})}await p.fetchLeadById(E.id)}catch(_){console.error("Failed to validate lead:",_)}}async function k(w){var _,F,ye;const E=l();if(E)try{if((_=w==null?void 0:w.assignment)!=null&&_.assignee){const q=w.assignment.assignee,D={assignee:q.name||q.label||null,assigneeId:q.id||null,assigneeType:q.type||"user"};q.type==="team"&&(D.teamId=q.id||null,D.team=q.name||null),w.assignment.salesperson&&(D.assignee=w.assignment.salesperson.name||w.assignment.salesperson,D.assigneeId=w.assignment.salesperson.id||null,D.assigneeType="user",D.teamId=q.id||null,D.team=q.name||null),await p.updateLead(E.id,D);const M=((F=w.assignment.salesperson)==null?void 0:F.name)||q.name||"Unassigned";await p.addActivity(E.id,{type:"note",user:((ye=c.currentUser)==null?void 0:ye.name)||"You",action:"assigned lead",content:`Lead assigned to ${M}${w.assignment.salesperson&&q.name?` (${q.name} team)`:""}`,timestamp:new Date().toISOString()})}const fe=await p.convertLeadToOpportunity(E.id);c.canAccessOpportunities()?m.push({path:`/tasks/${fe}`,query:{type:"opportunity"}}):m.push("/tasks")}catch(fe){console.error("Failed to qualify lead:",fe)}}async function u(w){const E=l();if(E)try{const _=E.contactAttempts||[];await p.updateLead(E.id,{contactAttempts:[..._,w],lastContactAttempt:w.timestamp,totalContactAttempts:_.length+1}),await p.addActivity(E.id,{type:"call",user:"You",action:`logged call attempt - ${w.outcome}`,content:w.notes||`Call attempt via ${w.channel}`,data:{outcome:w.outcome,channel:w.channel,duration:w.duration}}),await p.fetchLeadById(E.id)}catch(_){console.error("Failed to log call attempt:",_)}}async function x(w){const E=l();if(E)try{await p.addActivity(E.id,{type:"note",user:"You",action:"added a note",content:w.content||w.text||"",data:w}),await p.fetchLeadById(E.id)}catch(_){console.error("Failed to save note:",_)}}function $(){o("open-purchase-method")}function d(){o("open-trade-in")}async function h(w){var _;const E=l();if(E)try{const F=w.datetime?new Date(w.datetime).toISOString().split("T")[0]+"T"+w.time+":00":`${w.date}T${w.time}:00`,ye=new Date(F),fe=w.duration||60;ye.setMinutes(ye.getMinutes()+fe);const q={scheduledAppointment:{id:Date.now(),title:`${w.type} - ${E.customer.name}`,start:F,end:ye.toISOString(),type:w.type,assignee:w.assignee,assigneeId:w.assigneeId||w.salespersonId||w.teamId,assigneeType:w.assigneeType||(w.salespersonId?"user":"team"),teamId:w.teamId||null,team:w.team||null,salesperson:w.salesperson||null,salespersonId:w.salespersonId||null,status:"scheduled",location:w.location||"",notes:w.notes||""}};(w.assigneeId||w.salespersonId||w.teamId)&&(q.assignee=w.assignee||w.salesperson||w.team,q.assigneeId=w.assigneeId||w.salespersonId||w.teamId,q.assigneeType=w.assigneeType||(w.salespersonId?"user":"team"),w.teamId&&(q.teamId=w.teamId,q.team=w.team)),await p.updateLead(E.id,q),await p.addActivity(E.id,{type:"appointment",user:((_=c.currentUser)==null?void 0:_.name)||"You",action:"scheduled an appointment",content:`${w.type} scheduled for ${Rt(new Date(F))} at ${w.time}`,data:{type:w.type,date:w.date||Rt(new Date(F)),time:w.time,assignee:w.assignee,assigneeId:w.assigneeId,team:w.team,salesperson:w.salesperson}}),await p.fetchLeadById(E.id)}catch(F){console.error("Failed to schedule appointment:",F)}}async function y(w){const E=l();if(E&&!(V.isClosed.value&&!w.force))try{const _=V.displayStage.value,F=w.reason==="Duplicate"?_s.CLOSED_DUPLICATE:w.category==="Not Interested"?_s.CLOSED_NOT_INTERESTED:_s.CLOSED_INVALID,ye=Nn(_,F);if(ye){const{updates:fe,activities:q}=ye(E,F,w);await p.updateLead(E.id,fe);for(const D of q)await p.addActivity(E.id,D)}else{const fe=w.reason==="Duplicate";await p.updateLead(E.id,{isDisqualified:!0,disqualifyReason:w.reason,isDuplicate:fe,stage:fe?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await p.addActivity(E.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${w.category}, Reason: ${w.reason}`})}m.push("/tasks")}catch(_){console.error("Failed to disqualify lead:",_)}}async function b(){const w=l();if(w)try{const E=V.displayStage.value,_=_s.NEW,F=Nn(E,_);if(F){const{updates:ye,activities:fe}=F(w);await p.updateLead(w.id,ye);for(const q of fe)await p.addActivity(w.id,q)}else await p.updateLead(w.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await p.addActivity(w.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await p.fetchLeadById(w.id)}catch(E){console.error("Failed to reopen lead:",E)}}function N(){const w=l();w&&w.opportunityId&&m.push({path:`/tasks/${w.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:g,handleValidated:f,handleQualified:k,handleCallAttemptLogged:u,handleNoteSaved:x,handleOpenPurchaseMethod:$,handleOpenTradeIn:d,handleAppointmentScheduled:h,handleDisqualified:y,handleReopen:b,viewOpportunity:N}}const Rl={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},jl={class:"space-y-6"},Yn={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(l){return(V,o)=>l.task?(v(),C("div",{key:0,class:Z(["rounded-lg flex flex-col",l.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[l.hideTitle?L("",!0):(v(),C("div",Rl,[...o[0]||(o[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:Z(["bg-white rounded-lg p-2 flex flex-col",l.hideBorder?"shadow-none":"shadow-sm"]),style:Qe(l.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[xt(V.$slots,"deadline-banner"),e("div",jl,[xt(V.$slots,"primary-action"),xt(V.$slots,"task-widgets"),xt(V.$slots,"closed-state"),xt(V.$slots,"secondary-actions")])],6)],2)):L("",!0)}},Bl={class:"flex justify-between items-start mb-3"},Wl={class:"font-bold text-gray-900 text-fluid-sm"},Pl={class:"text-fluid-xs text-gray-500 mt-0.5"},zl={class:"flex gap-3 flex-wrap"},Hn={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(l){return(V,o)=>(v(),C("div",{class:Z(["rounded-card p-4 relative transition-all duration-300 border",[l.colorScheme.background,l.colorScheme.border]])},[e("div",Bl,[e("div",null,[e("h4",Wl,I(l.action.title),1),e("p",Pl,I(l.action.description),1)])]),e("div",zl,[e("button",{onClick:o[0]||(o[0]=m=>V.$emit("action-clicked")),class:Z([l.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:Z(l.action.icon)},null,2),T(" "+I(l.action.label),1)],2)])],2))}},Yl={class:"rounded-lg",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Hl={class:"bg-white rounded-lg px-3 py-2 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ql={key:0,class:"flex items-center justify-between gap-2"},Jl={class:"flex items-center gap-2 min-w-0 flex-1"},Gl={class:"min-w-0 flex-1"},Zl={class:"text-sm font-semibold text-greys-900 truncate leading-tight"},Kl={class:"font-normal text-greys-500"},Xl={class:"text-xs text-greys-500 truncate leading-tight"},eo={key:1,class:"space-y-2"},to={class:"flex items-center justify-between gap-2 flex-wrap"},so={class:"flex items-center gap-1.5 shrink-0"},no={key:0,class:"flex gap-1.5 flex-wrap"},ao=["onClick"],lo={__name:"TaskAssignee",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"}},emits:["reassigned"],setup(l,{emit:V}){const o=l,m=V,p=_t(),c=Tt(),g=Pt(),f=Lt(),k=A(!1),u=A(null),x=S(()=>c.currentUser),$=S(()=>!!(o.task.assignee||o.task.owner||o.task.assignedTo)),d=S(()=>{var ye;const _=o.task.assignee||o.task.owner||o.task.assignedTo||"Unassigned",F=(ye=p.allUsers)==null?void 0:ye.find(fe=>fe.name===_);return{name:_,team:(F==null?void 0:F.team)||o.task.assigneeTeam||o.task.team||"No team",dealership:(F==null?void 0:F.dealership)||o.task.assigneeDealership||"MotorK Dealership",role:(F==null?void 0:F.role)||o.task.assigneeRole||"salesman"}});S(()=>!x.value||!$.value?!1:d.value.name===x.value.name);const h=S(()=>(p.assignableTeams||[]).slice(0,3)),y=_=>!_||_==="Unassigned"?"?":_.split(" ").map(F=>F[0]).join("").toUpperCase().substring(0,2),b=_=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[_]||"bg-surfaceSecondary text-body",N=async()=>{if(x.value)try{o.taskType==="lead"?await g.updateLead(o.task.id,{assignee:x.value.name,assigneeType:"user",assigneeTeam:x.value.team,assigneeDealership:x.value.dealership,assigneeRole:x.value.role}):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,{assignee:x.value.name,assigneeType:"user",assigneeTeam:x.value.team,assigneeDealership:x.value.dealership,assigneeRole:x.value.role}),m("reassigned",x.value)}catch(_){console.error("Error assigning to self:",_)}},w=async _=>{u.value=_;try{o.taskType==="lead"?await g.updateLead(o.task.id,{assignee:_.name,assigneeType:"team",teamId:_.id,assigneeTeam:_.name}):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,{assignee:_.name,assigneeType:"team",teamId:_.id,assigneeTeam:_.name}),m("reassigned",_)}catch(F){console.error("Error assigning to team:",F)}},E=async _=>{try{const F={assignee:_.name,assigneeType:_.type,assigneeTeam:_.team,assigneeDealership:_.dealership,assigneeRole:_.role};_.type==="team"&&(F.teamId=_.id),o.taskType==="lead"?await g.updateLead(o.task.id,F):o.taskType==="opportunity"&&await f.updateOpportunity(o.task.id,F),k.value=!1,m("reassigned",_)}catch(F){console.error("Error reassigning:",F)}};return(_,F)=>(v(),C(qe,null,[e("div",Yl,[e("div",Hl,[$.value?(v(),C("div",Ql,[e("div",Jl,[e("div",{class:Z(["w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shrink-0",b(d.value.role)])},I(y(d.value.name)),3),e("div",Gl,[e("p",Zl,[T(I(d.value.name)+" ",1),e("span",Kl,"• "+I(d.value.team),1)]),e("p",Xl,I(d.value.dealership),1)])]),s(t(Y),{variant:"ghost",size:"sm",onClick:F[0]||(F[0]=ye=>k.value=!0),class:"shrink-0 text-xs px-2 py-1"},{default:r(()=>[...F[3]||(F[3]=[T(" Change ",-1)])]),_:1})])):(v(),C("div",eo,[e("div",to,[F[6]||(F[6]=e("p",{class:"text-sm text-greys-500 font-medium"},"Unassigned",-1)),e("div",so,[s(t(Y),{variant:"primary",size:"sm",onClick:N,class:"!bg-brand-red text-sm px-3 py-1"},{default:r(()=>[...F[4]||(F[4]=[T(" Assign to me ",-1)])]),_:1}),s(t(Y),{variant:"outline",size:"sm",onClick:F[1]||(F[1]=ye=>k.value=!0),class:"text-sm px-3 py-1 border-D1D5DB"},{default:r(()=>[...F[5]||(F[5]=[T(" Assign to someone ",-1)])]),_:1})])]),h.value.length>0?(v(),C("div",no,[(v(!0),C(qe,null,ze(h.value,ye=>{var fe;return v(),C("button",{key:ye.id,class:Z(["inline-flex items-center gap-1 px-2 py-0.5 rounded-md border text-xs font-medium transition-all",((fe=u.value)==null?void 0:fe.id)===ye.id?"border-brand-blue bg-blue-50 text-brand-blue":"border-E5E7EB hover:border-brand-blue/30 text-greys-600"]),onClick:q=>w(ye)},[F[7]||(F[7]=e("i",{class:"fa-solid fa-users text-xs"},null,-1)),T(" "+I(ye.name),1)],10,ao)}),128))])):L("",!0)]))])]),s(Pn,{show:k.value,title:$.value?"Reassign task":"Assign task","confirm-label":$.value?"Reassign":"Assign",onClose:F[2]||(F[2]=ye=>k.value=!1),onConfirm:E},null,8,["show","title","confirm-label"])],64))}},Qn=Wt(lo,[["__scopeId","data-v-8fbba5aa"]]),Bt=(l,V)=>{if(!l||!V)return[];const o=new Date(V).getDay();if(o===0||o===6)return[];const[p,c]=l.split("-"),g=parseInt(c);return p==="team"?io(g,V):p==="user"?oo(g,V,o):[]},oo=(l,V,o)=>{const m={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(m[l]||m[1])[o]||[]},io=(l,V)=>{const o=new Date(V).getDay(),m=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return l===1?o===1||o===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:l===2?m.filter((p,c)=>c%2===0):m},ro={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},uo={class:"space-y-3"},co={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mo={class:"font-semibold text-heading text-sm mb-4"},po={class:"mb-4"},vo={class:"mb-4"},fo={class:"flex gap-2"},yo={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={class:"flex items-center justify-between mb-4"},ho={class:"text-sm font-semibold text-heading"},xo={class:"grid grid-cols-7 gap-1 mb-2"},wo={class:"grid grid-cols-7 gap-1"},ko=["onClick"],So={class:"text-sm font-semibold text-heading mb-4"},Co={key:0,class:"space-y-2"},$o=["onClick"],Do={key:1,class:"text-sm text-sub py-4 text-center"},Ao={key:2,class:"text-sm text-sub py-4 text-center"},To={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(l,{emit:V}){const{t:o}=kn(),m=l,p=V,c=Tt(),g=_t(),f=A("assign-and-schedule"),k=A(""),u=A(null),x=A(""),$=A(""),d=A("30min"),h=A(new Date().getMonth()),y=A(new Date().getFullYear()),b=A(null);S(()=>g.assignableUsers),S(()=>g.assignableTeams);const N=S(()=>new Date(y.value,h.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),w=S(()=>{const ce=new Date(y.value,h.value,1),K=new Date(y.value,h.value+1,0).getDate(),re=ce.getDay()===0?6:ce.getDay()-1,ke=[];for(let Oe=0;Oe<re;Oe++)ke.push(null);for(let Oe=1;Oe<=K;Oe++)ke.push(Oe);return ke}),E=S(()=>[{value:"Showroom Visit",label:o("forms.schedule.eventType.options.showroomVisit")},{value:"Test Drive",label:o("forms.schedule.eventType.options.testDrive")},{value:"Video Call",label:o("forms.schedule.eventType.options.videoCall")},{value:"Home Visit",label:o("forms.schedule.eventType.options.homeVisit")},{value:"Closing Meeting",label:o("forms.schedule.eventType.options.closingMeeting")}]),_=["MON","TUE","WED","THU","FRI","SAT","SUN"],F=S(()=>{if(!b.value||!x.value)return o("forms.schedule.timeSlots.selectDate");const ce=new Date(x.value),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${te[ce.getDay()]}, ${K[ce.getMonth()]} ${ce.getDate()}`}),ye=ce=>{if(!ce||!x.value)return!1;const te=new Date(x.value);return te.getDate()===ce&&te.getMonth()===h.value&&te.getFullYear()===y.value},fe=ce=>{if(!ce)return;const te=new Date(y.value,h.value,ce);x.value=te.toISOString().split("T")[0],b.value=ce,$.value=""},q=()=>{h.value===0?(h.value=11,y.value--):h.value--},D=()=>{h.value===11?(h.value=0,y.value++):h.value++},M=S(()=>!x.value||!u.value?[]:Bt(u.value,x.value)),j=()=>{var ce;if(m.preselectedAssignee){const{type:te,id:K}=m.preselectedAssignee;u.value=`${te}-${K}`}else u.value=`user-${((ce=c.currentUser)==null?void 0:ce.id)||1}`};j();const H=S(()=>f.value==="assign-only"?!0:!!(k.value&&x.value&&$.value&&u.value));De(()=>m.show,ce=>{ce?j():ae()}),De(x,()=>{$.value=""});const ae=()=>{f.value="assign-and-schedule",k.value="",x.value="",$.value="",d.value="30min",b.value=null;const ce=new Date;h.value=ce.getMonth(),y.value=ce.getFullYear()},Q=ce=>{ce||p("close")},we=()=>{if(!H.value)return;const ce=u.value.startsWith("team-"),te=parseInt(u.value.split("-")[1]);let K={};if(ce){const ke=g.getTeamById(te);K={assigneeType:"team",teamId:te,team:(ke==null?void 0:ke.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const ke=g.getUserById(te);K={assigneeType:"user",assigneeId:te,assignee:(ke==null?void 0:ke.name)||"Unknown",teamId:null,team:null}}const re={...K};f.value==="assign-and-schedule"&&(re.type=k.value,re.date=x.value,re.time=$.value,re.duration=d.value),p("confirm",re),p("close")},Ne=()=>{p("close")};return(ce,te)=>(v(),pe(t(ws),{open:l.show,"onUpdate:open":Q},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-4xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),{class:"text-fluid-lg"},{default:r(()=>[...te[6]||(te[6]=[T("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",ro,[e("div",uo,[e("label",{class:Z(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",f.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Ke(e("input",{type:"radio","onUpdate:modelValue":te[0]||(te[0]=K=>f.value=K),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[vt,f.value]]),te[7]||(te[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:Z(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",f.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[Ke(e("input",{type:"radio","onUpdate:modelValue":te[1]||(te[1]=K=>f.value=K),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[vt,f.value]]),te[8]||(te[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),f.value==="assign-and-schedule"?(v(),C("div",co,[e("h5",mo,I(t(o)("forms.schedule.title")),1),e("div",po,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[T(I(t(o)("forms.schedule.eventType.label")),1)]),_:1}),s(t(Je),{modelValue:k.value,"onUpdate:modelValue":te[2]||(te[2]=K=>k.value=K),items:E.value,placeholder:t(o)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:r(({item:K})=>[e("span",null,I(K.label),1)]),_:1},8,["modelValue","items","placeholder"])]),e("div",vo,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[T(I(t(o)("forms.schedule.duration.label")),1)]),_:1}),e("div",fo,[e("button",{onClick:te[3]||(te[3]=K=>d.value="30min"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",d.value==="30min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.30min")),3),e("button",{onClick:te[4]||(te[4]=K=>d.value="60min"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",d.value==="60min"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.60min")),3),e("button",{onClick:te[5]||(te[5]=K=>d.value="custom"),class:Z(["px-4 py-2 border-2 rounded-lg text-sm font-medium transition-all",d.value==="custom"?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(t(o)("forms.schedule.duration.custom")),3)])]),e("div",yo,[e("div",go,[e("div",null,[e("div",bo,[e("button",{onClick:q,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[9]||(te[9]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",ho,I(N.value),1),e("button",{onClick:D,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...te[10]||(te[10]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",xo,[(v(),C(qe,null,ze(_,K=>e("div",{key:K,class:"text-center text-xs font-medium text-sub py-2"},I(K),1)),64))]),e("div",wo,[(v(!0),C(qe,null,ze(w.value,(K,re)=>(v(),C("div",{key:re,onClick:ke=>fe(K),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg cursor-pointer transition-all",ye(K)?"bg-[#0470e9] text-white":K?"text-body hover:bg-surfaceSecondary":"text-transparent"])},I(K),11,ko))),128))])]),e("div",null,[e("h6",So,I(F.value),1),x.value&&M.value.length>0?(v(),C("div",Co,[(v(!0),C(qe,null,ze(M.value,K=>(v(),C("button",{key:K,onClick:re=>$.value=K,class:Z(["w-full py-2 px-4 bg-white border border-black/5 rounded-lg shadow-sm text-sm font-medium text-center transition-all",$.value===K?"border-[#0470e9] bg-surfaceSecondary text-heading":"text-body hover:border-[#0470e9]/30"])},I(K),11,$o))),128))])):x.value&&M.value.length===0?(v(),C("div",Do,I(t(o)("forms.schedule.timeSlots.noSlots")),1)):(v(),C("div",Ao,I(t(o)("forms.schedule.timeSlots.selectDate")),1))])])])])):L("",!0)]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:r(()=>[s(t(In),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:Ne}),s(t(In),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!H.value,onClick:we},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Jn(){const l=oa(),V=A(!1),o=A(!1),m=A(0),p=A(""),c=A(null),g=A({}),f=A(null),k={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},u=S(()=>{const b=Math.floor(m.value/60),N=m.value%60;return`${b.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`}),x=()=>{V.value=!0,m.value=0,o.value=!1,p.value="",c.value=setInterval(()=>{m.value++,m.value>=20&&$()},1e3)},$=()=>{c.value&&(clearInterval(c.value),c.value=null),V.value=!1,o.value=!0,g.value={duration:m.value,notes:p.value,transcription:k,channel:"phone"}},d=async b=>{try{await navigator.clipboard.writeText(b),l.pushToast("success","Phone number copied to clipboard!")}catch{l.pushToast("error","Failed to copy phone number")}},h=b=>(f.value={tradeIn:k.leadLines.some(N=>N.toLowerCase().includes("trade")||N.toLowerCase().includes("exchange"))||!1,financing:k.leadLines.some(N=>N.toLowerCase().includes("financ")||N.toLowerCase().includes("payment")||N.toLowerCase().includes("loan"))||!1},f.value.tradeIn&&b&&(b.value.tradeIn=!0),f.value.financing&&b&&(b.value.financing=!0),f.value),y=()=>{V.value=!1,o.value=!1,m.value=0,p.value="",g.value={},c.value&&(clearInterval(c.value),c.value=null)};return ia(()=>{c.value&&clearInterval(c.value)}),{isCallActive:V,callEnded:o,callDuration:m,callNotes:p,callData:g,extractedData:f,mockTranscription:k,formattedCallDuration:u,startCall:x,endCall:$,copyNumber:d,extractInformation:h,resetCall:y}}function Oo(l,V,o,m,p,c){var Re,et,tt;const g=A(!0),f=A(null),k=A(!1),u=A(!1),x=A(!1),$=A(""),d=A(null),h=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],y=A("whatsapp"),b=A("followup-1"),N=A(null),w=A(""),E=A("09:00"),_=A(null),F=A("Not Interested"),ye=A(""),fe=A({dealership:((et=(Re=l.value)==null?void 0:Re.requestedCar)==null?void 0:et.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((tt=c==null?void 0:c.value)==null?void 0:tt.id)||null}),q=A(null),D=A(null),M=A({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),j=S(()=>{var le,ge;if(!((le=l.value)!=null&&le.requestedCar))return null;const ne=(ge=l.value.requestedCar.condition)==null?void 0:ge.toLowerCase();return ne==="used"?{id:7,name:"Sales (Used)",dealershipId:2,dealership:"Firenze"}:ne==="new"?{id:5,name:"Sales (New)",dealershipId:3,dealership:"Milano"}:null}),H=A({tradeIn:!1,financing:!1,contactAvailability:!1}),ae=A(!1),Q=A(null),we=A(!0),Ne=A(null),ce=A(null),te=A("assign-and-schedule"),K=A(""),re=A(null),ke=A(""),Oe=A(null),Xe=A(""),P=A(""),ee=A(null),Be=A(""),Ee=S(()=>{const ne=[];for(let le=9*60;le<=18*60;le+=30){const ge=String(Math.floor(le/60)).padStart(2,"0"),Ce=String(le%60).padStart(2,"0");ne.push(`${ge}:${Ce}`)}return ne}),We=S(()=>{if(re.value!=null)return re.value;const ne=parseInt(ke.value,10);return Number.isFinite(ne)&&ne>0?ne:null}),Ae=S(()=>{if(!Oe.value)return[];const ne=[],le=new Date;if(le.setHours(0,0,0,0),Oe.value==="tomorrow"){const ge=new Date(le);ge.setDate(ge.getDate()+1),ge.getDay()!==0&&ge.getDay()!==6&&ne.push(ge)}else if(Oe.value==="this-week"){const ge=le.getDay(),Ce=new Date(le);Ce.setDate(le.getDate()-(ge===0?6:ge-1));for(let $e=0;$e<5;$e++){const Ie=new Date(Ce);Ie.setDate(Ce.getDate()+$e),Ie>=le&&ne.push(Ie)}}else if(Oe.value==="custom"&&Xe.value&&P.value){const ge=new Date(Xe.value),Ce=new Date(P.value),$e=new Date(ge);for(;$e<=Ce;)$e.getDay()!==0&&$e.getDay()!==6&&ne.push(new Date($e)),$e.setDate($e.getDate()+1)}return ne}),Te=S(()=>{var Ce,$e,Ie,Ye,ft,st,dt;const ne=((Ie=($e=(Ce=l.value)==null?void 0:Ce.customer)==null?void 0:$e.name)==null?void 0:Ie.split(" ")[0])||"",le=((ft=(Ye=l.value)==null?void 0:Ye.requestedCar)==null?void 0:ft.brand)||"",ge=((dt=(st=l.value)==null?void 0:st.requestedCar)==null?void 0:dt.model)||"";return{"followup-1":`Hi ${ne}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${le} ${ge}?`,"followup-2":`Hello ${ne}, this is regarding your inquiry about the ${le} ${ge}. Please let me know when you're available for a call.`,custom:""}}),R=S(()=>b.value==="custom"?"Type your custom message...":Te.value[b.value]||""),B=S(()=>{var ne;return!!((ne=l.value)!=null&&ne.scheduledAppointment)}),oe=()=>{const ne=new Date,le=ne.getHours(),ge=ne.getDay();let Ce=new Date,$e="10:00",Ie="";if(ge===5&&le>=15)Ce.setDate(ne.getDate()+3),$e="10:00",Ie="Optimal time after weekend, customer likely refreshed";else if(ge===6||ge===0)Ce.setDate(ne.getDate()+(ge===6?2:1)),$e="10:00",Ie="Weekend follow-up avoided, better response rate on weekdays";else if(le>=17)Ce.setDate(ne.getDate()+1),$e="10:00",Ie="Business hours preferred, higher engagement rate";else if(le<9)Ce=new Date(ne),Ce.setHours(10,0,0,0),$e="10:00",Ie="Peak response time, customers more available mid-morning";else if(le<14){Ce=new Date(ne);const st=le+2;Ce.setHours(st,0,0,0),$e=`${String(st).padStart(2,"0")}:00`,Ie="Follow-up within same day increases conversion likelihood"}else Ce.setDate(ne.getDate()+1),Ce.setHours(10,0,0,0),$e="10:00",Ie="Next morning follow-up maintains momentum";const Ye=Ce.toISOString().split("T")[0],ft=`${Ye}T${$e}:00`;return{date:Ye,time:$e,dateTime:ft,reason:Ie,formattedDate:Ce.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:g,selectedOutcome:f,showNoteModal:k,showScheduleAppointmentModal:u,followupChannels:h,followupChannel:y,selectedTemplate:b,rescheduleTime:N,customDate:w,customTime:E,disqualifyCategory:F,disqualifyReason:ye,assignment:fe,preferences:H,surveyCompleted:ae,surveyResponses:Q,showSurvey:we,aiSuggestionData:_,showCallLogForm:x,callLogDateTime:$,callLogAssignee:d,qualificationSelectedTeam:q,qualificationSelectedSalesman:D,suggestedTeam:j,communicationPreferences:M,messageTemplates:Te,messagePreview:R,hasExistingAppointment:B,selectOutcome:ne=>{if(f.value=ne,!$.value){const le=new Date,ge=le.getFullYear(),Ce=String(le.getMonth()+1).padStart(2,"0"),$e=String(le.getDate()).padStart(2,"0"),Ie=String(le.getHours()).padStart(2,"0"),Ye=String(le.getMinutes()).padStart(2,"0");$.value=`${ge}-${Ce}-${$e}T${Ie}:${Ye}`}!d.value&&(c!=null&&c.value)&&(d.value=c.value),ne==="interested"&&(ae.value=!1,Q.value=null,we.value=!0,o!=null&&o.value&&(H.value.tradeIn=o.value.tradeIn||!1,H.value.financing=o.value.financing||!1))},cancelOutcome:()=>{f.value=null,x.value=!1},calculateNextCallDate:()=>{if(N.value==="tomorrow-9am"){const le=new Date;return le.setDate(le.getDate()+1),le.setHours(9,0,0,0),le.toISOString()}else if(N.value==="monday"){if(_.value)return new Date(_.value.dateTime).toISOString();const le=new Date,ge=(8-le.getDay())%7||7;return le.setDate(le.getDate()+ge),le.setHours(9,0,0,0),le.toISOString()}else if(N.value==="custom"&&w.value&&E.value)return new Date(`${w.value}T${E.value}:00`).toISOString();const ne=new Date;return ne.setDate(ne.getDate()+1),ne.setHours(9,0,0,0),ne.toISOString()},calculateAISuggestion:oe,handleAISuggestionClick:()=>{N.value="monday",_.value=oe()},resetOutcomeState:()=>{f.value=null,g.value=!0,y.value="whatsapp",b.value="followup-1",N.value=null,w.value="",E.value="09:00",F.value="Not Interested",ye.value="",ae.value=!1,Q.value=null,we.value=!0,_.value=null,x.value=!1,$.value="",d.value=null,Ne.value=null,ce.value=null,te.value="assign-only",K.value="",Oe.value=null,Xe.value="",P.value="",ee.value=null,Be.value="",q.value=null,D.value=null,re.value=null,ke.value=""},initCallLogForm:(ne=!1)=>{if(Ne.value)return;const le=new Date,ge=le.getFullYear(),Ce=String(le.getMonth()+1).padStart(2,"0"),$e=String(le.getDate()).padStart(2,"0"),Ie=String(le.getHours()).padStart(2,"0"),Ye=String(le.getMinutes()).padStart(2,"0");$.value=`${ge}-${Ce}-${$e}T${Ie}:${Ye}`,c!=null&&c.value&&(d.value=c.value),x.value=!0},confirmCallLogForm:()=>{},cancelCallLogForm:()=>{x.value=!1,$.value="",d.value=null},clearSuccessState:()=>{Ne.value=null,ce.value=null},successState:Ne,successPerformedAt:ce,qualificationMethod:te,qualificationEventType:K,qualificationDurationMinutes:re,qualificationCustomDuration:ke,qualificationDateRange:Oe,qualificationCustomDateStart:Xe,qualificationCustomDateEnd:P,availableDatesForRange:Ae,qualificationSelectedDate:ee,qualificationSelectedSlot:Be,qualificationScheduleSlotOptions:Ee,qualificationDurationValue:We}}function Io(l,V,o,m,p,c,g,f,k=null){const{callData:u}=V,{showOutcomeSelection:x,selectedOutcome:$,assignment:d,preferences:h,cancelOutcome:y,calculateNextCallDate:b,showScheduleAppointmentModal:N,surveyCompleted:w,surveyResponses:E,showSurvey:_,initCallLogForm:F,callLogDateTime:ye,callLogAssignee:fe,successState:q,successPerformedAt:D,rescheduleTime:M,aiSuggestionData:j,customDate:H,customTime:ae,qualificationMethod:Q,qualificationEventType:we,qualificationDurationValue:Ne,qualificationSelectedDate:ce,qualificationSelectedSlot:te,qualificationSelectedTeam:K,qualificationSelectedSalesman:re,communicationPreferences:ke}=o,Oe=()=>{var W;return((W=f==null?void 0:f.value)==null?void 0:W.name)||"Unknown"},Xe=()=>M.value==="tomorrow-9am"?"Tomorrow 9:00 AM":M.value==="monday"&&j.value?`${j.value.formattedDate} at ${j.value.time}`:M.value==="monday"?"Monday":M.value==="custom"&&H.value&&ae.value?`${H.value} ${ae.value}`:"selected time";return{logManualCall:()=>{u.value={channel:"external",notes:"",transcription:null},F(!0)},handleScheduleAppointmentConfirm:async W=>{N.value=!1,l("appointment-scheduled",W)},handleQualify:async()=>{var Re,et,tt,ne,le,ge,Ce,$e,Ie,Ye,ft,st,dt,wt,ot,Ct,Ge,it,yt,gt,$t,Ze,Ot,He,Ue;const W={timestamp:new Date().toISOString(),outcome:"interested",channel:((Re=u.value)==null?void 0:Re.channel)||"phone",notes:((et=u.value)==null?void 0:et.notes)||"",transcription:((tt=u.value)==null?void 0:tt.transcription)||null};l("call-attempt-logged",W),l("validated",{scheduleFollowUp:!1});let se="Unassigned";Q.value==="assign-and-schedule"?re.value?se=re.value.name:K.value&&(se=K.value.name):se=((le=(ne=d.value)==null?void 0:ne.assignee)==null?void 0:le.name)||"Unassigned";let ie=null,Se=!1,ue=null;if(Q.value==="assign-and-schedule"&&ce.value&&te.value){const me=ce.value,It=me.toLocaleDateString(void 0,{month:"long",day:"numeric"}),zt={"test-drive":"Test Drive","in-store-visit":"In-Store Visit"}[we.value]||we.value;Se=!0;const Pe=me.getFullYear(),rt=String(me.getMonth()+1).padStart(2,"0"),Cs=String(me.getDate()).padStart(2,"0"),Xt=`${Pe}-${rt}-${Cs}`;if(ue={datetime:me,date:Xt,time:te.value,type:zt,assignee:se,assigneeId:((ge=re.value)==null?void 0:ge.id)||((Ce=K.value)==null?void 0:Ce.id)||null,assigneeType:re.value?"user":"team",duration:Ne.value,team:(($e=K.value)==null?void 0:$e.name)||null,teamId:((Ie=K.value)==null?void 0:Ie.id)||null,salesperson:((Ye=re.value)==null?void 0:Ye.name)||null,salespersonId:((ft=re.value)==null?void 0:ft.id)||null},ie={date:It,time:te.value,title:zt,name:((dt=(st=m.value)==null?void 0:st.customer)==null?void 0:dt.name)||"",location:se},l("appointment-scheduled",ue),ke.value){const bt=ke.value;if((wt=bt.immediateConfirmation)!=null&&wt.enabled&&((Ct=(ot=bt.immediateConfirmation)==null?void 0:ot.channels)==null?void 0:Ct.length)>0){for(const ct of bt.immediateConfirmation.channels)if(g&&((Ge=m.value)!=null&&Ge.id))try{await g.addActivity(m.value.id,{type:ct,user:Oe(),action:`sent ${ct} confirmation`,content:`Appointment confirmed: ${zt} on ${It} at ${te.value}`,timestamp:new Date().toISOString()})}catch(ut){console.error(`Failed to log ${ct} confirmation:`,ut)}}if((it=bt.reminder)!=null&&it.enabled&&((gt=(yt=bt.reminder)==null?void 0:yt.channels)==null?void 0:gt.length)>0){const ct=new Date(me);ct.setDate(ct.getDate()-1);const ut=ct.toISOString().split("T")[0];if(g&&(($t=m.value)!=null&&$t.id))try{await g.addActivity(m.value.id,{type:"reminder-scheduled",user:Oe(),action:"scheduled reminder",content:`Reminder scheduled for ${ut} via ${bt.reminder.channels.join(", ")}`,timestamp:new Date().toISOString(),data:{reminderDate:ut,channels:bt.reminder.channels}})}catch(Ft){console.error("Failed to schedule reminder:",Ft)}}if((Ze=bt.salespersonNotification)!=null&&Ze.enabled){const ct=((Ot=re.value)==null?void 0:Ot.name)||((He=K.value)==null?void 0:He.name)||"Team";if(g&&((Ue=m.value)!=null&&Ue.id))try{await g.addActivity(m.value.id,{type:"notification",user:Oe(),action:"sent notification",content:`Notification sent to ${ct} about appointment`,timestamp:new Date().toISOString()})}catch(ut){console.error("Failed to send notification:",ut)}}}}Q.value==="assign-and-schedule"&&(re.value?d.value={...d.value,assignee:{...re.value,type:"user"},assigneeId:re.value.id,salesperson:re.value}:K.value&&(d.value={...d.value,assignee:{...K.value,type:"team"},team:K.value}));const Le=Q.value==="assign-and-schedule"?{assignee:re.value||K.value,salesperson:re.value||null,team:K.value||null}:d.value;let xe=null;if(k!=null&&k.value){const me=k.value;xe={interestLevel:me.interestLevel,purchaseTimeline:me.purchaseTimeline,budgetRange:me.budgetRange,hasTradeIn:me.hasTradeIn,tradeInModel:me.tradeInModel,financingOption:me.financingOption,additionalNotes:me.additionalNotes}}else w.value&&E.value&&(xe=E.value);l("qualified",{assignment:Le,preferences:h.value,scheduleAppointment:Se,appointmentData:ue,surveyData:xe});let Ve=`Qualified - Assigned to ${se}`;ie&&(Ve=`Qualified - Assigned to ${se}, meeting on ${ie.date} ${ie.time}`),q.value={kind:"qualified",statusText:Ve,meeting:ie,actorName:Oe()},D.value=new Date,y()},handleDisqualifyFromInterested:()=>{var se,ie,Se;const W={timestamp:new Date().toISOString(),outcome:"interested",channel:((se=u.value)==null?void 0:se.channel)||"phone",notes:((ie=u.value)==null?void 0:ie.notes)||"",transcription:((Se=u.value)==null?void 0:Se.transcription)||null};l("call-attempt-logged",W),$.value="not-valid"},handleNoAnswerConfirm:async()=>{var Le,xe,Ve,Re;const W={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Le=u.value)==null?void 0:Le.channel)||"phone",notes:((xe=u.value)==null?void 0:xe.notes)||"",transcription:((Ve=u.value)==null?void 0:Ve.transcription)||null};l("call-attempt-logged",W);const se=b(),ie=se.split("T")[0],Se=new Date(se).toTimeString().slice(0,5);if(g&&((Re=m.value)!=null&&Re.id))try{await g.updateLead(m.value.id,{nextActionDue:se,status:"Pending"})}catch(et){console.error('Failed to update lead status to "to be called back":',et)}l("postponed",{date:ie,time:Se,createAppointment:!0}),(p==null?void 0:p.value)+1>=(c==null?void 0:c.value)&&l("disqualified",{category:"Not Interested",reason:"Unreachable"});const ue=Xe();q.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${ue}`,actorName:Oe()},D.value=new Date,y()},handleNotValidConfirm:()=>{var se,ie,Se;const W={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((se=u.value)==null?void 0:se.channel)||"phone",notes:((ie=u.value)==null?void 0:ie.notes)||"",transcription:((Se=u.value)==null?void 0:Se.transcription)||null};l("call-attempt-logged",W),l("disqualified",{category:o.disqualifyCategory.value,reason:o.disqualifyReason.value}),q.value={kind:"not-interested",statusText:"Closed - Not interested",actorName:Oe()},D.value=new Date,y()},handleNoteSave:W=>{o.showNoteModal.value=!1,l("note-saved",W)},handleSurveyCompleted:async W=>{var se;if(E.value=W,w.value=!0,_.value=!1,g&&((se=m.value)!=null&&se.id))try{await g.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(W),timestamp:new Date().toISOString()})}catch(ie){console.error("Failed to save survey activity:",ie)}l("survey-completed",{lead:m.value,responses:W})},handleSurveyRefused:async()=>{var W;if(_.value=!1,g&&((W=m.value)!=null&&W.id))try{await g.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey refusal activity:",se)}l("survey-refused",{lead:m.value})},handleNotResponding:async()=>{var W;if(_.value=!1,g&&((W=m.value)!=null&&W.id))try{await g.addActivity(m.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(se){console.error("Failed to save survey not responding activity:",se)}l("not-responding",{lead:m.value})},handleReopen:()=>{o.clearSuccessState(),o.resetOutcomeState()}}}const No=["disabled"],Vo={__name:"AIButton",props:{label:{type:String,required:!0},size:{type:String,default:"medium",validator:l=>["small","medium"].includes(l)},disabled:{type:Boolean,default:!1}},emits:["click"],setup(l){return(V,o)=>(v(),C("button",{class:Z(["flex items-center gap-2 rounded-lg text-white font-medium transition-all","hover:opacity-90 active:scale-95",l.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",l.size==="small"?"px-3 py-1.5 text-fluid-xs":"px-4 py-2 text-fluid-sm"]),disabled:l.disabled,style:{background:"linear-gradient(135deg, #6B21A8, #9333EA, #A855F7)"},onClick:o[0]||(o[0]=m=>V.$emit("click",m))},[s(t(qa),{size:l.size==="small"?14:16,class:"text-white shrink-0"},null,8,["size"]),e("span",null,I(l.label),1)],10,No))}},Mo={key:0,class:"flex gap-2 items-center mb-4"},qo=["disabled"],Lo={key:1,class:"mb-4 space-y-4 border-t border pt-4"},_o={key:0,class:"bg-slate-900 text-white rounded-card p-4"},Fo={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Uo={class:"flex items-center gap-3"},Eo={class:"flex items-center gap-2 text-red-400"},Ro={class:"text-xs font-mono"},jo={class:"space-y-3 text-sm font-mono"},Bo={class:"ml-2"},Wo={class:"ml-2"},Po={key:0},zo={class:"ml-2"},Yo={key:1},Ho={class:"ml-2"},Qo={key:2},Jo={class:"ml-2"},Go={class:"mt-4 pt-4 border-t border-slate-700"},Zo=["model-value"],Ko={key:1,class:"bg-blue-50 rounded-card p-4"},Xo={class:"flex items-center justify-between"},ei={class:"flex gap-2"},Gn={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0},hideButton:{type:Boolean,default:!1}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(l){return(V,o)=>(v(),C("div",null,[!l.hideButton&&!l.isCallActive?(v(),C("div",Mo,[e("button",{onClick:o[0]||(o[0]=m=>V.$emit("start-call")),disabled:l.isCallActive,class:Z(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",l.isCallActive?"bg-surface border-E5E7EB text-body opacity-60 cursor-not-allowed":"bg-primary hover:bg-primary/90 border-primary text-white"])},[o[4]||(o[4]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),T(" "+I(l.contactAttempts>0?"Call Again":"Initiate Call"),1)],10,qo)])):L("",!0),l.isCallActive||l.callEnded?(v(),C("div",Lo,[l.isCallActive?(v(),C("div",_o,[e("div",Fo,[o[7]||(o[7]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Uo,[e("div",Eo,[o[5]||(o[5]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ro,"REC "+I(l.formattedCallDuration),1)]),e("button",{onClick:o[1]||(o[1]=m=>V.$emit("end-call")),class:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg flex items-center gap-2 transition-colors"},[...o[6]||(o[6]=[e("i",{class:"fa-solid fa-stop"},null,-1),T(" Stop Call ",-1)])])])]),e("div",jo,[e("div",null,[o[8]||(o[8]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Bo,I(l.mockTranscription.leadLines[0]),1)]),e("div",null,[o[9]||(o[9]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Wo,I(l.mockTranscription.salesLines[0]),1)]),l.callDuration>=5?(v(),C("div",Po,[o[10]||(o[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",zo,I(l.mockTranscription.leadLines[1]),1)])):L("",!0),l.callDuration>=8?(v(),C("div",Yo,[o[11]||(o[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ho,I(l.mockTranscription.salesLines[1]),1)])):L("",!0),l.callDuration>=12?(v(),C("div",Qo,[o[12]||(o[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Jo,I(l.mockTranscription.leadLines[2]),1)])):L("",!0)]),e("div",Go,[e("textarea",{"model-value":l.callNotes,"onUpdate:modelValue":o[2]||(o[2]=m=>V.$emit("update:call-notes",m)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Zo)])])):L("",!0),l.callEnded&&!l.isCallActive?(v(),C("div",Ko,[e("div",Xo,[o[13]||(o[13]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("div",ei,[s(Vo,{label:"Extract information",size:"small",onClick:o[3]||(o[3]=m=>V.$emit("extract-information"))})])])])):L("",!0)])):L("",!0)]))}},ti={class:"flex items-center gap-2.5 min-w-0"},si={class:"flex items-center gap-2 min-w-0"},Zn={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(l,{emit:V}){const o=l,m=V,p=A(!1),c=S(()=>Ca(o.nextActionDue)),g=S(()=>c.value.type==="overdue"?Vn:c.value.type==="urgent"?za:Vn),f=S(()=>o.isClosed||!o.showDeadlineBanner||p.value?!1:c.value.type==="overdue"||c.value.type==="urgent"),k=()=>{p.value=!0,m("dismissed")};return(u,x)=>f.value?(v(),C("div",{key:0,class:Z(["flex items-center justify-between px-4 py-2 border-b transition-all duration-200",[c.value.bgClass,c.value.borderClass]])},[e("div",ti,[e("div",{class:Z(["flex items-center justify-center rounded-full w-5 h-5 shrink-0",c.value.type==="overdue"?"bg-red-100":"bg-orange-100"])},[(v(),pe(xn(g.value),{size:12,class:Z(c.value.textClass)},null,8,["class"]))],2),e("div",si,[e("span",{class:Z(["text-[10px] font-bold uppercase tracking-wider",c.value.textClass])},I(c.value.type==="overdue"?"Overdue":"Urgent"),3),x[0]||(x[0]=e("span",{class:"text-fluid-xs text-sub opacity-30"},"•",-1)),e("span",{class:Z(["text-fluid-xs font-medium truncate",c.value.textClass])}," Next Action: "+I(t($a)(l.nextActionDue)),3)])]),e("button",{onClick:k,class:Z(["p-1 rounded-md transition-colors shrink-0",[c.value.textClass,"hover:bg-black/5"]]),title:"Dismiss"},[s(t(_n),{size:14})],2)],2)):L("",!0)}},ni={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},ai={class:"space-y-4"},li={class:"flex items-center gap-3"},oi={class:"flex items-center gap-3"},ii={class:"text-fluid-sm font-medium text-heading"},Kn={__name:"AppointmentCommunications",props:{appointment:{type:Object,required:!0},customer:{type:Object,required:!0},salesperson:{type:Object,default:null},team:{type:Object,default:null},dealership:{type:Object,default:null}},emits:["update"],setup(l,{emit:V}){const o=V,m=[{value:"email",label:"via Email"},{value:"sms",label:"via SMS"},{value:"whatsapp",label:"via WhatsApp"}],p=A({immediateConfirmationEnabled:!0,immediateConfirmationChannels:["email"],reminderEnabled:!0,reminderChannels:["email"],salespersonNotification:!0});return De(p,c=>{var f,k;const g={immediateConfirmation:{enabled:c.immediateConfirmationEnabled,channels:c.immediateConfirmationEnabled&&((f=c.immediateConfirmationChannels)==null?void 0:f.length)>0?c.immediateConfirmationChannels:[]},reminder:{enabled:c.reminderEnabled,channels:c.reminderEnabled&&((k=c.reminderChannels)==null?void 0:k.length)>0?c.reminderChannels:[]},salespersonNotification:{enabled:c.salespersonNotification}};o("update",g)},{deep:!0}),(c,g)=>(v(),C("div",ni,[g[7]||(g[7]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Send confirmations and reminders",-1)),e("div",ai,[e("div",li,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"immediate-confirmation",modelValue:p.value.immediateConfirmationEnabled,"onUpdate:modelValue":g[0]||(g[0]=f=>p.value.immediateConfirmationEnabled=f)},null,8,["modelValue"]),g[5]||(g[5]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send immediate confirmation to customer",-1))]),_:1}),p.value.immediateConfirmationEnabled?(v(),pe(t(Je),{key:0,modelValue:p.value.immediateConfirmationChannels,"onUpdate:modelValue":g[1]||(g[1]=f=>p.value.immediateConfirmationChannels=f),items:m,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),e("div",oi,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"reminder",modelValue:p.value.reminderEnabled,"onUpdate:modelValue":g[2]||(g[2]=f=>p.value.reminderEnabled=f)},null,8,["modelValue"]),g[6]||(g[6]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Send reminder the day before appointment",-1))]),_:1}),p.value.reminderEnabled?(v(),pe(t(Je),{key:0,modelValue:p.value.reminderChannels,"onUpdate:modelValue":g[3]||(g[3]=f=>p.value.reminderChannels=f),items:m,multiple:!0,placeholder:"Select channels",class:"w-48"},null,8,["modelValue"])):L("",!0)]),s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},{default:r(()=>[s(t(jt),{id:"salesperson-notification",modelValue:p.value.salespersonNotification,"onUpdate:modelValue":g[4]||(g[4]=f=>p.value.salespersonNotification=f)},null,8,["modelValue"]),e("span",ii," Notify "+I(l.salesperson?l.salesperson.name:l.team?l.team.name:"salesperson")+" about appointment ",1)]),_:1})]),xt(c.$slots,"actions")]))}},ri={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},$n={__name:"CloseAsLostForm",props:{showMultipleNoShows:{type:Boolean,default:!1},preselectedReason:{type:String,default:""},closeButtonLabel:{type:String,default:"Close"}},emits:["close","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=A(m.preselectedReason||"");De(()=>m.preselectedReason,k=>{k&&(c.value=k)});const g=S(()=>!!c.value);function f(){g.value&&p("close",c.value)}return V({reason:c,canSubmit:g,submit:f}),(k,u)=>(v(),C("div",ri,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...u[1]||(u[1]=[T("Reason",-1)])]),_:1}),s(t(qt),{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=x=>c.value=x)},{default:r(()=>[s(t(Nt),{class:"w-full"},{default:r(()=>[s(t(Vt),{placeholder:"Select a reason..."})]),_:1}),s(t(Mt),null,{default:r(()=>[l.showMultipleNoShows?(v(),pe(t(be),{key:0,value:"Multiple no shows"},{default:r(()=>[...u[2]||(u[2]=[T("Multiple no shows",-1)])]),_:1})):L("",!0),s(t(be),{value:"Data cleanup"},{default:r(()=>[...u[3]||(u[3]=[T("Data cleanup",-1)])]),_:1}),s(t(be),{value:"Unreachable"},{default:r(()=>[...u[4]||(u[4]=[T("Unreachable",-1)])]),_:1}),s(t(be),{value:"Purchase postponed"},{default:r(()=>[...u[5]||(u[5]=[T("Purchase postponed",-1)])]),_:1}),s(t(be),{value:"Vehicle sold"},{default:r(()=>[...u[6]||(u[6]=[T("Vehicle sold",-1)])]),_:1}),s(t(be),{value:"Out of budget"},{default:r(()=>[...u[7]||(u[7]=[T("Out of budget",-1)])]),_:1}),s(t(be),{value:"Financing rejected"},{default:r(()=>[...u[8]||(u[8]=[T("Financing rejected",-1)])]),_:1}),s(t(be),{value:"Duplicate"},{default:r(()=>[...u[9]||(u[9]=[T("Duplicate",-1)])]),_:1}),s(t(be),{value:"Bought elsewhere"},{default:r(()=>[...u[10]||(u[10]=[T("Bought elsewhere",-1)])]),_:1}),s(t(be),{value:"Not interested"},{default:r(()=>[...u[11]||(u[11]=[T("Not interested",-1)])]),_:1}),s(t(be),{value:"Budget constraints"},{default:r(()=>[...u[12]||(u[12]=[T("Budget constraints",-1)])]),_:1}),s(t(be),{value:"Found better price"},{default:r(()=>[...u[13]||(u[13]=[T("Found better price at competitor",-1)])]),_:1}),s(t(be),{value:"No response"},{default:r(()=>[...u[14]||(u[14]=[T("Customer not responding",-1)])]),_:1}),s(t(be),{value:"Wrong timing"},{default:r(()=>[...u[15]||(u[15]=[T("Timing not right",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...u[16]||(u[16]=[T("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}},ui={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},di={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},ci={class:"flex items-center gap-3"},mi={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},pi={class:"text-sm font-medium text-heading flex-1 pr-10"},vi={key:0,class:"mt-4 bg-white rounded-lg border border-black/5 overflow-hidden shadow-sm"},fi={class:"grid grid-cols-2 gap-3 p-4 text-sm"},yi={class:"ml-2 font-medium text-heading"},gi={class:"ml-2 font-medium text-heading"},bi={class:"ml-2 font-medium text-heading capitalize"},hi={class:"ml-2 font-medium text-heading"},xi={class:"flex justify-end mt-4"},wi={class:"px-4 py-2 flex items-center justify-between text-sm text-sub"},ki={class:"tabular-nums"},Si={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ci={class:"p-4"},$i={class:"flex justify-between items-start mb-3"},Di={class:"font-bold text-heading text-sm"},Ai={class:"text-sm text-body mt-0.5"},Ti={key:0,class:"mb-3 bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Oi={class:"flex items-center justify-between gap-4 flex-wrap"},Ii={key:0,class:"flex items-center gap-2"},Ni={class:"flex items-center gap-2"},Vi={class:"text-sm text-body"},Mi={key:1,class:"flex items-center gap-2"},qi={class:"text-sm font-semibold text-heading"},Li={key:0,class:"text-sm text-orange-600 font-medium flex items-center gap-1 ml-2"},_i={class:"flex items-center gap-2 mb-3"},Fi={class:"text-sm text-body font-medium"},Ui={class:"px-4 py-4 space-y-3"},Ei={key:0,class:"space-y-4"},Ri={class:"flex flex-wrap gap-3"},ji={key:0,class:"space-y-4"},Bi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Wi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Pi={class:"grid grid-cols-4 gap-2 mb-4"},zi={key:0,class:"space-y-3"},Yi=["value"],Hi={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Qi={class:"grid grid-cols-3 gap-2"},Ji={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Gi={class:"flex items-start gap-2"},Zi={class:"flex-1"},Ki={class:"text-sm font-semibold text-heading mb-1"},Xi={class:"text-xs text-sub"},er={key:1,class:"mt-3 grid grid-cols-2 gap-3"},tr={key:1,class:"space-y-4"},sr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},nr={key:2,class:"space-y-4"},ar={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},lr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},or={class:"space-y-4"},ir={class:"flex gap-4"},rr={class:"space-y-2"},ur={class:"flex items-center gap-2 cursor-pointer"},dr={class:"flex justify-end gap-2 mt-4"},cr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},mr={class:"space-y-2"},pr={key:0,class:"space-y-4"},vr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},fr={class:"grid grid-cols-2 gap-4"},yr={class:"flex items-center gap-2"},gr={class:"text-sub"},br={class:"font-medium text-heading"},hr={class:"flex items-center gap-2"},xr={class:"font-medium text-heading"},wr={key:1,class:"space-y-4"},kr={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Sr={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cr={class:"grid grid-cols-2 gap-4"},$r={class:"flex items-center gap-2"},Dr={class:"text-sub"},Ar={class:"font-medium text-heading"},Tr={class:"flex items-center gap-2"},Or={class:"font-medium text-heading"},Ir={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Nr={class:"font-semibold text-heading text-sm mb-4"},Vr={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},Mr={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},qr={class:"p-6"},Lr={class:"flex items-center justify-between mb-4"},_r={class:"text-sm font-semibold text-heading"},Fr={class:"grid grid-cols-7 gap-1 mb-2"},Ur={class:"grid grid-cols-7 gap-1"},Er=["onClick"],Rr={class:"p-6"},jr={class:"text-sm font-semibold text-heading mb-4"},Br={key:0,class:"space-y-2"},Wr=["onClick"],Pr={key:1,class:"text-sm text-sub py-4 text-center"},zr={key:2,class:"text-sm text-sub py-4 text-center"},Yr={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Hr={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},Qr={class:"ml-2 font-medium text-heading"},Jr={class:"ml-2 font-medium text-heading"},Gr={class:"ml-2 font-medium text-heading capitalize"},Zr={class:"ml-2 font-medium text-heading"},Kr={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Xr={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]},showDeadlineBanner:{type:Boolean,default:!0}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const{t:o}=kn(),m=l,p=V,c=_t(),g=Tt();wn();const f=Pt(),k=zn(()=>m.lead,{}),u=Jn(),{isCallActive:x,callEnded:$,callDuration:d,callNotes:h,callData:y,extractedData:b,mockTranscription:N,formattedCallDuration:w,startCall:E,endCall:_,copyNumber:F}=u,ye=A(null),fe=A(!1),q=A(!1),D=A(!1),M=A(!1),j=S(()=>c.assignableUsers),H=S(()=>c.assignableTeams),ae=S(()=>g.currentUser),Q=A({interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}),we=A(""),Ne=A(""),ce=A(""),te=A("");S(()=>{var n;const O=new Set;return(n=H.value)==null||n.forEach(G=>{G.dealership&&O.add(G.dealership)}),Array.from(O).sort()}),S(()=>{var O;return we.value?((O=H.value)==null?void 0:O.filter(n=>n.dealership===we.value))||[]:H.value||[]}),S(()=>{var n,G;if(!Ne.value)return j.value||[];const O=(n=H.value)==null?void 0:n.find(a=>a.id===Ne.value);return O?((G=j.value)==null?void 0:G.filter(a=>a.team===O.name||a.teamId===O.id))||[]:j.value||[]});const K=O=>O?O.split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2):"?",re=O=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[O]||"bg-surfaceSecondary text-body",ke=O=>{ne.value.assignee=O,O.type==="team"&&(mt.value=null),fe.value=!1};S(()=>!!it.value),S(()=>{if(Ze.value)return Ze.value.statusText;const O=m.activities.filter(n=>n.type==="call"||n.type==="outcome").sort((n,G)=>new Date(G.timestamp)-new Date(n.timestamp))[0];return O?O.outcome||O.content||"Outcome logged":null});const Oe=async()=>{var O;try{const n=Q.value,G=[];if(n.interestLevel&&G.push(`Interest level: ${n.interestLevel}`),n.purchaseTimeline&&G.push(`Purchase timeline: ${n.purchaseTimeline}`),n.budgetRange&&G.push(`Budget range: ${n.budgetRange}`),n.hasTradeIn&&n.tradeInModel&&G.push(`Trade-in: ${n.tradeInModel}`),n.financingOption){const U={FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"};G.push(`Financing: ${U[n.financingOption]||n.financingOption}`)}n.additionalNotes&&G.push(n.additionalNotes);const a=G.join(`
`);if(a.trim()&&(await f.addActivity(m.lead.id,{type:"note",user:((O=ae.value)==null?void 0:O.name)||"You",action:"enriched lead information",content:a,timestamp:new Date().toISOString()}),p("note-saved",{type:"note",content:a,timestamp:new Date().toISOString(),enrichData:{...n}})),n.interestLevel||n.purchaseTimeline||n.budgetRange){const U={interestLevel:n.interestLevel,purchaseTimeline:n.purchaseTimeline,budgetRange:n.budgetRange};await f.addActivity(m.lead.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(U),timestamp:new Date().toISOString()}),p("survey-completed",{lead:m.lead,responses:U})}Q.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""}}catch(n){console.error("Error saving enriched lead data:",n)}},Xe=()=>{E(),$t(!1)},P=()=>{F(m.lead.customer.phone)},ee=O=>{h.value=O},Be=S(()=>{var O;return((O=k.primaryAction.value)==null?void 0:O.title)||"Call to Verify Contact Details"}),Ee=S(()=>{var O;return((O=k.primaryAction.value)==null?void 0:O.description)||"Begin lead qualification by verifying customer contact information."}),We=S(()=>m.lead.scheduledAppointment?new Date(m.lead.scheduledAppointment.start)<new Date:!1),Ae=S(()=>!!m.lead.scheduledAppointment),Te=S(()=>Ae.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:We.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:m.lead.nextActionDue?`Task Pending - Due ${Da(m.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),R=k.contactAttempts,B=k.maxContactAttempts,oe=Oo(vs(m,"lead"),y,b,R,B,ae),{showOutcomeSelection:X,selectedOutcome:W,showNoteModal:se,showScheduleAppointmentModal:ie,followupChannels:Se,followupChannel:ue,selectedTemplate:Le,rescheduleTime:xe,customDate:Ve,customTime:Re,disqualifyCategory:et,disqualifyReason:tt,assignment:ne,preferences:le,messageTemplates:ge,messagePreview:Ce,hasExistingAppointment:$e,selectOutcome:Ie,cancelOutcome:Ye,calculateNextCallDate:ft,surveyCompleted:st,surveyResponses:dt,showSurvey:wt,aiSuggestionData:ot,handleAISuggestionClick:Ct,callLogDateTime:Ge,callLogAssignee:it,confirmCallLogForm:yt,cancelCallLogForm:gt,initCallLogForm:$t,successState:Ze,successPerformedAt:Ot,qualificationMethod:He,qualificationEventType:Ue,qualificationDurationMinutes:me,qualificationCustomDuration:It,qualificationCalendarMonth:zt,qualificationSelectedDate:Pe,qualificationSelectedSlot:rt,qualificationDateRange:Cs,qualificationCustomDateStart:Xt,qualificationCustomDateEnd:bt,availableDatesForRange:ct,qualificationScheduleSlotOptions:ut,qualificationDurationValue:Ft,qualificationSelectedTeam:_e,qualificationSelectedSalesman:mt,suggestedTeam:Rs,communicationPreferences:js}=oe,$s=O=>{js.value=O},es=S(()=>{if(!Pe.value)return[];const O=Pe.value.toISOString().split("T")[0];if(mt.value){const n=Bt(`user-${mt.value.id}`,O);return ut.value.filter(G=>n.includes(G))}if(_e.value){const n=Bt(`team-${_e.value.id}`,O);return ut.value.filter(G=>n.includes(G))}return ut.value||[]});De(Pe,()=>{rt.value=""}),S(()=>m.activities.filter(O=>O.type==="note"));const Ut=S(()=>(H.value||[]).slice(0,3)),Bs=S(()=>{if(!H.value)return[];const O=[...H.value];if(_e.value){const n=O.findIndex(G=>G.id===_e.value.id);if(n>0){const G=O.splice(n,1)[0];O.unshift(G)}}return O}),Ds=S(()=>Bs.value.map(O=>({...O,label:`${O.dealership||"No location"} → ${O.name}`,value:O.id}))),Yt=S(()=>{var G;if(!_e.value)return[];const O=_e.value;return(((G=j.value)==null?void 0:G.filter(a=>a.team===O.name||a.teamId===O.id))||[]).map(a=>({...a,label:a.name,value:a.id}))}),Ht=S({get:()=>{var O;return((O=_e.value)==null?void 0:O.id)||null},set:O=>{var G;if(!O){_e.value=null;return}const n=(G=H.value)==null?void 0:G.find(a=>a.id===O);_e.value=n||null}}),Qt=S({get:()=>{var O;return((O=mt.value)==null?void 0:O.id)||null},set:O=>{if(!O){mt.value=null;return}const n=Yt.value.find(G=>G.id===O);mt.value=n||null}});De([Ue,Rs,H],([O,n,G])=>{if(O&&n&&G&&!_e.value){const a=G.find(i=>i.id===n.id);a&&(_e.value=a)}},{immediate:!0}),De(Ue,O=>{if(O&&!Pe.value){const n=new Date;n.setHours(0,0,0,0),Pe.value=n,nt.value=n.getMonth(),ht.value=n.getFullYear(),rt.value=""}},{immediate:!0}),De(W,O=>{var n,G,a;if(O==="interested"&&He.value==="assign-only"&&!((n=ne.value)!=null&&n.assignee))if(m.lead.assignee){const i=(G=j.value)==null?void 0:G.find(de=>de.name===m.lead.assignee),U=(a=H.value)==null?void 0:a.find(de=>de.name===m.lead.assignee);i?ne.value={...ne.value,assignee:{...i,type:"user"}}:U&&(ne.value={...ne.value,assignee:{...U,type:"team"}})}else Ut.value.length>0&&(ne.value={...ne.value,assignee:{...Ut.value[0],type:"team"}})}),De(()=>{var O;return(O=ne.value)==null?void 0:O.assignee},O=>{(O==null?void 0:O.type)!=="team"&&(mt.value=null)}),De(_e,O=>{mt.value=null,O&&Ue.value&&ts(`team-${O.id}`)}),De(mt,O=>{O?ts(`user-${O.id}`):_e.value&&ts(`team-${_e.value.id}`)}),De(Pe,()=>{rt.value=""});const ts=O=>{const n=new Date;n.setHours(0,0,0,0);for(let G=0;G<30;G++){const a=new Date(n);if(a.setDate(n.getDate()+G),a.getDay()===0||a.getDay()===6)continue;const i=a.toISOString().split("T")[0],U=Bt(O,i);if(U&&U.length>0){Pe.value=a,nt.value=a.getMonth(),ht.value=a.getFullYear(),setTimeout(()=>{const de=ut.value.filter(ve=>U.includes(ve));de.length>0&&(rt.value=de[0])},0);break}}},Ws=S(()=>!(W.value!=="no-answer"||!ue.value||ue.value!=="dont-send"&&!Le.value||!xe.value||xe.value==="custom"&&(!Ve.value||!Re.value)));De(W,O=>{O!=="interested"&&(Q.value={interestLevel:"",purchaseTimeline:"",budgetRange:"",hasTradeIn:!1,tradeInModel:"",financingOption:"",additionalNotes:""},we.value="",Ne.value="",ce.value="")}),De(ce,O=>{var n,G;if(O){const a=(n=j.value)==null?void 0:n.find(i=>i.id===O);if(a){const i=(G=H.value)==null?void 0:G.find(U=>U.name===a.team||U.id===a.teamId);i&&(Ne.value=i.id,i.dealership&&(we.value=i.dealership))}}}),De(Ne,O=>{var n,G;if(O&&ce.value){const a=(n=j.value)==null?void 0:n.find(U=>U.id===ce.value),i=(G=H.value)==null?void 0:G.find(U=>U.id===O);a&&i&&a.team!==i.name&&a.teamId!==i.id&&(ce.value="")}}),De(we,O=>{var n;if(O&&Ne.value){const G=(n=H.value)==null?void 0:n.find(a=>a.id===Ne.value);G&&G.dealership!==O&&(Ne.value="",ce.value="")}}),De($,O=>{O&&!Ze.value&&$t(!1)});const Ps=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],zs=S(()=>Ps.map(O=>({value:O.value,label:O.label}))),nt=A(new Date().getMonth()),ht=A(new Date().getFullYear()),As=["MON","TUE","WED","THU","FRI","SAT","SUN"],Ys=S(()=>new Date(ht.value,nt.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),Hs=S(()=>{const O=new Date(ht.value,nt.value,1),G=new Date(ht.value,nt.value+1,0).getDate(),a=O.getDay()===0?6:O.getDay()-1,i=[];for(let U=0;U<a;U++)i.push(null);for(let U=1;U<=G;U++)i.push(U);return i}),Qs=S(()=>{if(!Pe.value)return o("forms.schedule.timeSlots.selectDate");const O=Pe.value,n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${n[O.getDay()]}, ${G[O.getMonth()]} ${O.getDate()}`}),Js=O=>{if(!O||!Pe.value)return!1;const n=Pe.value;return n.getDate()===O&&n.getMonth()===nt.value&&n.getFullYear()===ht.value},Gs=O=>{if(!O)return;const n=new Date(ht.value,nt.value,O);Pe.value=n,rt.value=""},Zs=()=>{nt.value===0?(nt.value=11,ht.value--):nt.value--},Ts=()=>{nt.value===11?(nt.value=0,ht.value++):nt.value++},Os={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},ss=O=>{me.value=O,It.value=""};De(It,O=>{O&&(me.value=null)}),De(Ue,O=>{if(!O)return;const n=Os[O];n&&(n===15?ss(15):n===30?ss(30):n===60?ss(60):(me.value=null,It.value=n.toString()))});const Ks=S(()=>He.value==="assign-only"?!!(Ue.value&&_e.value):!!(Ue.value&&Ft.value&&Pe.value&&rt.value&&_e.value)),Is=S(()=>!!tt.value);function Xs(O){tt.value=O,et.value||(et.value="Not Valid"),ns()}const en=S(()=>W.value==="no-answer"?ue.value==="dont-send"?"Postpone":"Send and postpone":W.value==="not-valid"?et.value?`Close as ${et.value}`:"Close":W.value==="interested"?"Schedule and qualify":""),Ns=S(()=>W.value==="no-answer"?Ws.value:W.value==="not-valid"?Is.value:W.value==="interested"?Ks.value:!1),tn=()=>{W.value==="no-answer"?ln():W.value==="not-valid"?ns():W.value==="interested"&&an()},sn=Io(p,u,oe,vs(m,"lead"),R,B,f,ae,Q),{logManualCall:nn,handleScheduleAppointmentConfirm:Vs,handleQualify:an,handleNoAnswerConfirm:ln,handleNotValidConfirm:ns,handleNoteSave:on,handleReopen:rn}=sn,un=S(()=>{if(!Ot.value)return"";const O=Ot.value,n=String(O.getDate()).padStart(2,"0"),G=String(O.getMonth()+1).padStart(2,"0"),a=String(O.getFullYear()),i=String(O.getHours()).padStart(2,"0"),U=String(O.getMinutes()).padStart(2,"0");return`${n}/${G}/${a} ${i}:${U}`}),{saveTradeInVehicle:Ms}=Aa(),dn=async O=>{var n,G,a;try{q.value=!1,le.value.financing=!0;const i=O.type==="FIN"?"Captive Financing":O.type==="LEA"?"Leasing":"Long-Term Rental",U=((n=O.fields)==null?void 0:n.monthlyInstalment)||0;await f.addActivity(m.lead.id,{type:"purchase-method",user:((G=ae.value)==null?void 0:G.name)||"You",action:`added a ${i} purchase method`,content:`${i}: €${U.toLocaleString()}/month for ${((a=O.fields)==null?void 0:a.duration)||0} months`,data:{purchaseMethodId:O.id,type:O.type,...O.fields},timestamp:new Date().toISOString()}),p("note-saved",{type:"purchase-method",...O})}catch(i){console.error("Error saving purchase method:",i)}},cn=async O=>{try{if(D.value=!1,O.vehicleType==="tradein"||m.mode==="tradein"){const n=await Ms("lead",m.lead.id,O.vehicle,O.valuation||{});le.value.tradeIn=!0,p("note-saved",{type:"tradein",id:n.activity.id,action:"added a trade-in",vehicleId:n.vehicle.id,data:n.activity.data,timestamp:n.activity.timestamp})}else{const{addVehicleToCustomer:n}=await Zt(async()=>{const{addVehicleToCustomer:G}=await import("./contacts-BDIyKZyn.js");return{addVehicleToCustomer:G}},__vite__mapDeps([0,1,2]));await n(m.lead.customerId,O.vehicle),p("note-saved",{type:"vehicle",vehicleType:O.vehicleType,...O.vehicle})}}catch(n){console.error("Error saving vehicle:",n)}};return(O,n)=>{var G;return v(),C("div",ui,[t(Ze)?(v(),C(qe,{key:0},[e("div",di,[e("div",ci,[e("div",mi,[s(t(Mn),{size:16,class:"text-green-600"})]),e("p",pi,I(t(Ze).statusText),1)]),t(Ze).meeting?(v(),C("div",vi,[e("div",fi,[e("div",null,[n[41]||(n[41]=e("span",{class:"text-body"},"Date:",-1)),e("span",yi,I(t(Ze).meeting.date),1)]),e("div",null,[n[42]||(n[42]=e("span",{class:"text-body"},"Time:",-1)),e("span",gi,I(t(Ze).meeting.time),1)]),e("div",null,[n[43]||(n[43]=e("span",{class:"text-body"},"Type:",-1)),e("span",bi,I(t(Ze).meeting.title),1)]),e("div",null,[n[44]||(n[44]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",hi,I(t(Ze).meeting.location),1)])])])):L("",!0),e("div",xi,[s(t(Y),{variant:"outline",size:"small",class:"flex items-center gap-2",onClick:t(rn)},{default:r(()=>[s(t(Wa),{size:14}),n[45]||(n[45]=T(" Re-open ",-1))]),_:1},8,["onClick"])])]),e("div",wi,[e("span",null,"Updated by "+I(t(Ze).actorName||"Unknown"),1),e("span",ki,I(un.value),1)])],64)):(v(),C(qe,{key:1},[e("div",Si,[s(Zn,{"next-action-due":l.lead.nextActionDue,"show-deadline-banner":l.showDeadlineBanner,"task-id":l.lead.id},null,8,["next-action-due","show-deadline-banner","task-id"]),e("div",Ci,[e("div",$i,[e("div",null,[e("h4",Di,I(Be.value),1),e("p",Ai,I(Ee.value),1)]),e("div",{class:Z(["flex items-center gap-2 px-2 py-1 rounded-btn text-sm font-semibold",Te.value.class])},I(Te.value.text),3)]),Ae.value||t(R)>0?(v(),C("div",Ti,[e("div",Oi,[Ae.value?(v(),C("div",Ii,[n[47]||(n[47]=e("i",{class:"fa-solid fa-calendar-check text-blue-600 text-sm"},null,-1)),e("div",Ni,[n[46]||(n[46]=e("span",{class:"text-sm font-semibold text-heading"},"Scheduled Follow-up Call:",-1)),e("span",Vi,I(t(Rt)(l.lead.scheduledAppointment.start))+" at "+I(t(ms)(l.lead.scheduledAppointment.start)),1)])])):L("",!0),t(R)>0?(v(),C("div",Mi,[n[49]||(n[49]=e("i",{class:"fa-solid fa-phone text-body text-sm"},null,-1)),n[50]||(n[50]=e("span",{class:"text-sm font-semibold text-body"},"Contact Attempts:",-1)),e("span",qi,I(t(R))+" / "+I(t(B)),1),t(R)>=t(B)-1?(v(),C("div",Li,[...n[48]||(n[48]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("span",null,"One more attempt before auto-disqualification",-1)])])):L("",!0)])):L("",!0)])])):L("",!0),e("div",_i,[e("span",Fi,I(l.lead.customer.phone),1),e("button",{onClick:P,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...n[51]||(n[51]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])]),s(Gn,{"is-call-active":t(x),"call-ended":t($),"call-duration":t(d),"call-notes":t(h),"formatted-call-duration":t(w),"mock-transcription":t(N),"contact-attempts":t(R),"max-contact-attempts":t(B),onStartCall:Xe,onEndCall:t(_),onLogManualCall:t(nn),onExtractInformation:n[0]||(n[0]=a=>M.value=!0),"onUpdate:callNotes":ee,onCopyNumber:P},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall"])])]),e("div",Ui,[t(Ze)?L("",!0):(v(),C("div",Ei,[e("div",null,[n[55]||(n[55]=e("p",{class:"text-sm font-medium text-heading leading-normal mb-3"},"Log what is happening?",-1)),e("div",Ri,[s(t(Y),{variant:"outline",onClick:n[1]||(n[1]=a=>t(Ie)("no-answer")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Qe(t(W)==="no-answer"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Ba),{size:18,class:"shrink-0",style:Qe(t(W)==="no-answer"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[52]||(n[52]=e("span",null,"No answer",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[2]||(n[2]=a=>t(Ie)("not-valid")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Qe(t(W)==="not-valid"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Pa),{size:18,class:"shrink-0",style:Qe(t(W)==="not-valid"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[53]||(n[53]=e("span",null,"Not valid",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[3]||(n[3]=a=>t(Ie)("interested")),class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium",style:Qe(t(W)==="interested"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[s(t(Mn),{size:18,class:"shrink-0",style:Qe(t(W)==="interested"?{color:"var(--brand-blue)"}:{})},null,8,["style"]),n[54]||(n[54]=e("span",null,"Interested",-1))]),_:1},8,["style"])])]),t(W)==="no-answer"?(v(),C("div",ji,[e("div",Bi,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[56]||(n[56]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ge),"onUpdate:modelValue":n[4]||(n[4]=a=>At(Ge)?Ge.value=a:null),class:"w-full"},null,8,["modelValue"])]),e("div",Wi,[n[65]||(n[65]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Send follow-up message",-1)),e("div",Pi,[s(t(Y),{variant:"outline",onClick:n[5]||(n[5]=a=>ue.value="whatsapp"),class:"flex items-center justify-center gap-2",style:Qe(t(ue)==="whatsapp"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-brands fa-whatsapp text-xs",style:Qe(t(ue)==="whatsapp"?{color:"var(--brand-blue)"}:{})},null,4),n[57]||(n[57]=e("span",null,"WhatsApp",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[6]||(n[6]=a=>ue.value="sms"),class:"flex items-center justify-center gap-2",style:Qe(t(ue)==="sms"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-message text-xs",style:Qe(t(ue)==="sms"?{color:"var(--brand-blue)"}:{})},null,4),n[58]||(n[58]=e("span",null,"SMS",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[7]||(n[7]=a=>ue.value="email"),class:"flex items-center justify-center gap-2",style:Qe(t(ue)==="email"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-envelope text-xs",style:Qe(t(ue)==="email"?{color:"var(--brand-blue)"}:{})},null,4),n[59]||(n[59]=e("span",null,"Email",-1))]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:n[8]||(n[8]=a=>ue.value="dont-send"),class:"flex items-center justify-center gap-2",style:Qe(t(ue)==="dont-send"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-xmark text-xs",style:Qe(t(ue)==="dont-send"?{color:"var(--brand-blue)"}:{})},null,4),n[60]||(n[60]=e("span",null,"Don't send",-1))]),_:1},8,["style"])]),t(ue)&&t(ue)!=="dont-send"?(v(),C("div",zi,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[61]||(n[61]=[T("Template",-1)])]),_:1}),s(t(qt),{modelValue:t(Le),"onUpdate:modelValue":n[9]||(n[9]=a=>At(Le)?Le.value=a:null)},{default:r(()=>[s(t(Nt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select template"})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"followup-1"},{default:r(()=>[...n[62]||(n[62]=[T("Follow-up 1",-1)])]),_:1}),s(t(be),{value:"followup-2"},{default:r(()=>[...n[63]||(n[63]=[T("Follow-up 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[64]||(n[64]=[T("Message preview",-1)])]),_:1}),e("textarea",{value:t(Ce),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-body bg-white resize-none",readonly:""},null,8,Yi)])])):L("",!0)]),e("div",Hi,[n[72]||(n[72]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Next call attempt",-1)),e("div",Qi,[s(t(Y),{variant:"outline",onClick:n[10]||(n[10]=a=>xe.value="tomorrow-9am"),class:"px-4 py-2 text-sm font-medium",style:Qe(t(xe)==="tomorrow-9am"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[...n[66]||(n[66]=[T(" Tomorrow 9:00 AM ",-1)])]),_:1},8,["style"]),s(t(Y),{variant:"outline",onClick:t(Ct),class:"px-4 py-2 text-sm font-medium flex items-center gap-1.5",style:Qe(t(xe)==="monday"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[e("i",{class:"fa-solid fa-sparkles text-xs",style:Qe(t(xe)==="monday"?{color:"var(--brand-blue)"}:{})},null,4),n[67]||(n[67]=T(" AI suggestion ",-1))]),_:1},8,["onClick","style"]),s(t(Y),{variant:"outline",onClick:n[11]||(n[11]=a=>xe.value="custom"),class:"px-4 py-2 text-sm font-medium",style:Qe(t(xe)==="custom"?{borderColor:"var(--brand-blue)",color:"var(--brand-blue)"}:{})},{default:r(()=>[...n[68]||(n[68]=[T(" Select time ",-1)])]),_:1},8,["style"])]),t(xe)==="monday"&&t(ot)?(v(),C("div",Ji,[e("div",Gi,[n[69]||(n[69]=e("i",{class:"fa-solid fa-lightbulb text-blue-600 text-sm mt-0.5"},null,-1)),e("div",Zi,[e("p",Ki,I(t(ot).formattedDate)+" at "+I(t(ot).time),1),e("p",Xi,I(t(ot).reason),1)])])])):L("",!0),t(xe)==="custom"?(v(),C("div",er,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[70]||(n[70]=[T("Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:t(Ve),"onUpdate:modelValue":n[12]||(n[12]=a=>At(Ve)?Ve.value=a:null),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[71]||(n[71]=[T("Time",-1)])]),_:1}),s(t(at),{type:"time",modelValue:t(Re),"onUpdate:modelValue":n[13]||(n[13]=a=>At(Re)?Re.value=a:null),class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0),t(W)==="not-valid"?(v(),C("div",tr,[e("div",sr,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[73]||(n[73]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ge),"onUpdate:modelValue":n[14]||(n[14]=a=>At(Ge)?Ge.value=a:null),class:"w-full"},null,8,["modelValue"])]),s($n,{"preselected-reason":t(tt),"close-button-label":"Close",onClose:Xs,onCancel:t(Ye)},null,8,["preselected-reason","onCancel"])])):L("",!0),t(W)==="interested"?(v(),C("div",nr,[n[119]||(n[119]=e("div",{class:"text-xs text-sub px-2"},[e("span",{class:"text-red-600"},"*"),T(" Required fields ")],-1)),e("div",ar,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[74]||(n[74]=[T("When did you call?",-1)])]),_:1}),s(t(at),{type:"datetime-local",modelValue:t(Ge),"onUpdate:modelValue":n[15]||(n[15]=a=>At(Ge)?Ge.value=a:null),class:"w-full"},null,8,["modelValue"])]),e("div",lr,[n[97]||(n[97]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Enrich lead",-1)),e("div",or,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[75]||(n[75]=[T("Customer interest level?",-1)])]),_:1}),e("div",ir,[s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ke(e("input",{type:"radio","onUpdate:modelValue":n[16]||(n[16]=a=>Q.value.interestLevel=a),value:"High",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[76]||(n[76]=e("span",{class:"text-sm text-body"},"High",-1))]),_:1}),s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ke(e("input",{type:"radio","onUpdate:modelValue":n[17]||(n[17]=a=>Q.value.interestLevel=a),value:"Medium",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[77]||(n[77]=e("span",{class:"text-sm text-body"},"Medium",-1))]),_:1}),s(t(J),{class:"flex items-center gap-2 cursor-pointer"},{default:r(()=>[Ke(e("input",{type:"radio","onUpdate:modelValue":n[18]||(n[18]=a=>Q.value.interestLevel=a),value:"Low",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[vt,Q.value.interestLevel]]),n[78]||(n[78]=e("span",{class:"text-sm text-body"},"Low",-1))]),_:1})])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[79]||(n[79]=[T("Expected purchase timeline?",-1)])]),_:1}),s(t(qt),{modelValue:Q.value.purchaseTimeline,"onUpdate:modelValue":n[19]||(n[19]=a=>Q.value.purchaseTimeline=a)},{default:r(()=>[s(t(Nt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select timeline"})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"Immediate"},{default:r(()=>[...n[80]||(n[80]=[T("Immediate",-1)])]),_:1}),s(t(be),{value:"Within 1 month"},{default:r(()=>[...n[81]||(n[81]=[T("Within 1 month",-1)])]),_:1}),s(t(be),{value:"Within 3 months"},{default:r(()=>[...n[82]||(n[82]=[T("Within 3 months",-1)])]),_:1}),s(t(be),{value:"Within 6 months"},{default:r(()=>[...n[83]||(n[83]=[T("Within 6 months",-1)])]),_:1}),s(t(be),{value:"Just browsing"},{default:r(()=>[...n[84]||(n[84]=[T("Just browsing",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[85]||(n[85]=[T("Budget range (if discussed)?",-1)])]),_:1}),s(t(qt),{modelValue:Q.value.budgetRange,"onUpdate:modelValue":n[20]||(n[20]=a=>Q.value.budgetRange=a)},{default:r(()=>[s(t(Nt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select budget range"})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"Under €30k"},{default:r(()=>[...n[86]||(n[86]=[T("Under €30k",-1)])]),_:1}),s(t(be),{value:"€30k-€50k"},{default:r(()=>[...n[87]||(n[87]=[T("€30k-€50k",-1)])]),_:1}),s(t(be),{value:"€50k-€80k"},{default:r(()=>[...n[88]||(n[88]=[T("€50k-€80k",-1)])]),_:1}),s(t(be),{value:"€80k+"},{default:r(()=>[...n[89]||(n[89]=[T("€80k+",-1)])]),_:1}),s(t(be),{value:"Not discussed"},{default:r(()=>[...n[90]||(n[90]=[T("Not discussed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",rr,[e("label",ur,[Ke(e("input",{type:"checkbox","onUpdate:modelValue":n[21]||(n[21]=a=>Q.value.hasTradeIn=a),class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[bn,Q.value.hasTradeIn]]),n[91]||(n[91]=e("span",{class:"text-sm font-medium text-body"},"Trade in?",-1))]),s(t(at),{modelValue:Q.value.tradeInModel,"onUpdate:modelValue":n[22]||(n[22]=a=>Q.value.tradeInModel=a),disabled:!Q.value.hasTradeIn,placeholder:"Car brand and model",class:"w-full h-10 min-h-10"},null,8,["modelValue","disabled"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[92]||(n[92]=[T("Financing?",-1)])]),_:1}),s(t(qt),{modelValue:Q.value.financingOption,"onUpdate:modelValue":n[23]||(n[23]=a=>Q.value.financingOption=a)},{default:r(()=>[s(t(Nt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select financing option"})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"FIN"},{default:r(()=>[...n[93]||(n[93]=[T("Captive Financing",-1)])]),_:1}),s(t(be),{value:"LEA"},{default:r(()=>[...n[94]||(n[94]=[T("Leasing",-1)])]),_:1}),s(t(be),{value:"LTR"},{default:r(()=>[...n[95]||(n[95]=[T("Long-Term Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[96]||(n[96]=[T("Additional notes",-1)])]),_:1}),s(t(lt),{modelValue:Q.value.additionalNotes,"onUpdate:modelValue":n[24]||(n[24]=a=>Q.value.additionalNotes=a),rows:"4",class:"w-full",placeholder:"Any relevant information about customer interest or preferences..."},null,8,["modelValue"])])]),e("div",dr,[s(t(Y),{label:"Save",variant:"primary",size:"small",onClick:Oe})])]),e("div",cr,[n[100]||(n[100]=e("h5",{class:"font-semibold text-heading text-sm mb-3"},[T("Qualification method "),e("span",{class:"text-red-600"},"*")],-1)),e("div",mr,[e("label",{class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(He)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":n[25]||(n[25]=a=>At(He)?He.value=a:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[vt,t(He)]]),n[98]||(n[98]=e("span",{class:"text-sm text-heading"},"Assign only",-1))],2),e("label",{class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",t(He)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":n[26]||(n[26]=a=>At(He)?He.value=a:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[vt,t(He)]]),n[99]||(n[99]=e("span",{class:"text-sm text-heading"},"Assign and schedule",-1))],2)])]),t(He)==="assign-only"?(v(),C("div",pr,[e("div",vr,[n[105]||(n[105]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",fr,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[101]||(n[101]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:Ht.value,"onUpdate:modelValue":n[27]||(n[27]=a=>Ht.value=a),items:Ds.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:a})=>[e("div",yr,[e("span",gr,I(a.dealership||"No location"),1),n[102]||(n[102]=e("span",{class:"text-sub"},"→",-1)),e("span",br,I(a.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[103]||(n[103]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Je),{modelValue:Qt.value,"onUpdate:modelValue":n[28]||(n[28]=a=>Qt.value=a),items:Yt.value,disabled:!t(_e),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:a})=>[e("div",hr,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(a.role)])},I(K(a.name)),3),e("span",xr,I(a.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[104]||(n[104]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:te.value,"onUpdate:modelValue":n[29]||(n[29]=a=>te.value=a),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])])):L("",!0),t(He)==="assign-and-schedule"?(v(),C("div",wr,[e("div",kr,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...n[106]||(n[106]=[T("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:t(Ue),"onUpdate:modelValue":n[30]||(n[30]=a=>At(Ue)?Ue.value=a:null),items:zs.value,placeholder:t(o)("forms.schedule.eventType.placeholder"),"value-key":"value",class:"w-full"},{item:r(({item:a})=>[e("span",null,I(a.label),1)]),_:1},8,["modelValue","items","placeholder"])]),t(Ue)?(v(),C("div",Sr,[n[110]||(n[110]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Cr,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[107]||(n[107]=[T("Team",-1)])]),_:1}),s(t(Je),{modelValue:Ht.value,"onUpdate:modelValue":n[31]||(n[31]=a=>Ht.value=a),items:Ds.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:a})=>[e("div",$r,[e("span",Dr,I(a.dealership||"No location"),1),n[108]||(n[108]=e("span",{class:"text-sub"},"→",-1)),e("span",Ar,I(a.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...n[109]||(n[109]=[T("Salesperson (optional)",-1)])]),_:1}),s(t(Je),{modelValue:Qt.value,"onUpdate:modelValue":n[32]||(n[32]=a=>Qt.value=a),items:Yt.value,disabled:!t(_e),placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:a})=>[e("div",Tr,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(a.role)])},I(K(a.name)),3),e("span",Or,I(a.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):L("",!0),t(Ue)&&t(_e)?(v(),C("div",Ir,[e("h5",Nr,[T(I(t(o)("forms.schedule.title"))+" ",1),n[111]||(n[111]=e("span",{class:"text-red-600"},"*",-1))]),e("div",Vr,[e("div",Mr,[e("div",qr,[e("div",Lr,[e("button",{onClick:Zs,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...n[112]||(n[112]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",_r,I(Ys.value),1),e("button",{onClick:Ts,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...n[113]||(n[113]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",Fr,[(v(),C(qe,null,ze(As,a=>e("div",{key:a,class:"text-center text-xs font-medium text-sub py-2"},I(a),1)),64))]),e("div",Ur,[(v(!0),C(qe,null,ze(Hs.value,(a,i)=>(v(),C("div",{key:i,onClick:U=>Gs(a),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Js(a)?"bg-[#0470e9] text-white cursor-pointer":a?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},I(a),11,Er))),128))])]),e("div",Rr,[e("h6",jr,I(Qs.value),1),t(Pe)&&es.value.length>0?(v(),C("div",Br,[(v(!0),C(qe,null,ze(es.value,a=>(v(),C("button",{key:a,onClick:i=>rt.value=a,class:Z(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",t(rt)===a?"border-[#0470e9] bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-[#0470e9]/30"])},I(a),11,Wr))),128))])):t(Pe)&&es.value.length===0?(v(),C("div",Pr,I(t(o)("forms.schedule.timeSlots.noSlots")),1)):(v(),C("div",zr,I(t(o)("forms.schedule.timeSlots.selectDate")),1))])])])])):L("",!0),s(Kn,{appointment:{type:t(Ue),date:t(Pe),time:t(rt),duration:t(Ft)},customer:l.lead.customer,salesperson:t(mt),team:t(_e),dealership:(G=t(_e))!=null&&G.dealership?{name:t(_e).dealership}:null,onUpdate:$s},null,8,["appointment","customer","salesperson","team","dealership"])])):L("",!0),t($e)&&t(He)==="assign-only"?(v(),C("div",Yr,[n[118]||(n[118]=Fn('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-sm">Existing Appointment</h5></div><span class="text-sm font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Hr,[e("div",null,[n[114]||(n[114]=e("span",{class:"text-body"},"Date:",-1)),e("span",Qr,I(t(Rt)(l.lead.scheduledAppointment.start)),1)]),e("div",null,[n[115]||(n[115]=e("span",{class:"text-body"},"Time:",-1)),e("span",Jr,I(t(ms)(l.lead.scheduledAppointment.start)),1)]),e("div",null,[n[116]||(n[116]=e("span",{class:"text-body"},"Type:",-1)),e("span",Gr,I(l.lead.scheduledAppointment.type),1)]),e("div",null,[n[117]||(n[117]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Zr,I(l.lead.scheduledAppointment.assignee),1)])]),s(t(Y),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:n[33]||(n[33]=a=>ie.value=!0)})])):L("",!0)])):L("",!0)])),t(W)&&!t(Ze)&&t(W)!=="not-valid"?(v(),C("div",Kr,[s(t(Y),{variant:"secondary",onClick:t(Ye)},{default:r(()=>[...n[120]||(n[120]=[T(" Cancel ",-1)])]),_:1},8,["onClick"]),s(t(Y),{variant:"primary",disabled:!Ns.value,onClick:tn,class:"bg-primary"},{default:r(()=>[T(I(en.value),1)]),_:1},8,["disabled"])])):L("",!0)])],64)),s(Rn,{ref_key:"noteWidgetRef",ref:ye,modal:"",show:t(se),item:null,"task-type":"lead","task-id":l.lead.id,onSave:t(on),onClose:n[34]||(n[34]=a=>se.value=!1),onCancel:n[35]||(n[35]=a=>se.value=!1)},null,8,["show","task-id","onSave"]),s(To,{show:t(ie),"preselected-assignee":t(ne).assignee,onConfirm:t(Vs),onClose:n[36]||(n[36]=a=>ie.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),s(Pn,{show:fe.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:ke,onClose:n[37]||(n[37]=a=>fe.value=!1)},null,8,["show"]),s(jn,{show:q.value,"task-type":"lead","task-id":l.lead.id,onSave:dn,onClose:n[38]||(n[38]=a=>q.value=!1)},null,8,["show","task-id"]),s(Bn,{show:D.value,mode:"tradein","task-type":"lead","task-id":l.lead.id,"customer-id":l.lead.customerId,onClose:n[39]||(n[39]=a=>D.value=!1),onSave:cn},null,8,["show","task-id","customer-id"]),s(Cn,{show:M.value,title:"AI Information Extraction",onClose:n[40]||(n[40]=a=>M.value=!1)},null,8,["show"])])}}},eu={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},tu={class:"flex justify-between items-start mb-3"},su={class:"text-fluid-xs text-body mt-0.5"},nu={key:0},au={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(l,{emit:V}){const o=l,m=V,p=Pt(),c=()=>{var F;const _=p.currentLead;return _&&_.id===((F=o.lead)==null?void 0:F.id)?_:o.lead},g={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},f=zn(vs(o,"lead"),g),{handlePostponed:k,handleValidated:u,handleQualified:x,handleCallAttemptLogged:$,handleNoteSaved:d,handleOpenPurchaseMethod:h,handleOpenTradeIn:y,handleAppointmentScheduled:b,handleDisqualified:N,handleReopen:w}=El({getLead:c,leadState:f,emit:m}),E=async _=>{var F;(F=o.lead)!=null&&F.id&&await p.loadLeadById(o.lead.id)};return(_,F)=>(v(),pe(Yn,{task:l.lead,"hide-title":"","hide-border":""},{"primary-action":r(()=>[t(f).isClosed.value?L("",!0):(v(),pe(Qn,{key:0,task:l.lead,"task-type":"lead",onReassigned:E,class:"mb-3"},null,8,["task"])),!t(f).isClosed.value&&t(f).showLQWidget.value?(v(),pe(Xr,{key:l.lead.id,lead:l.lead,"show-deadline-banner":t(f).showDeadlineBanner.value,onPostponed:t(k),onValidated:t(u),onQualified:t(x),onDisqualified:t(N),onCallAttemptLogged:t($),onNoteSaved:t(d),onOpenPurchaseMethod:t(h),onOpenTradeIn:t(y),onAppointmentScheduled:t(b)},null,8,["lead","show-deadline-banner","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!t(f).isClosed.value&&t(f).primaryAction.value?(v(),pe(Hn,{key:2,action:t(f).primaryAction.value,"color-scheme":t(f).primaryAction.value.colorScheme,onActionClicked:t(f).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]),"task-widgets":r(()=>[...F[0]||(F[0]=[])]),"closed-state":r(()=>[t(f).isClosed.value?(v(),C("div",eu,[e("div",tu,[e("div",null,[F[1]||(F[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",su,[T(" Status: "+I(t(f).displayStage.value)+" ",1),l.lead.disqualifyReason?(v(),C("span",nu," - "+I(l.lead.disqualifyReason),1)):L("",!0)])])]),s(t(Y),{variant:"primary",size:"small",onClick:t(w),class:"flex items-center gap-2"},{default:r(()=>[...F[2]||(F[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):L("",!0)]),_:1},8,["task"]))}},lu={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},ou={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},iu={class:"p-4"},ru={class:"flex justify-between items-start mb-3"},uu={class:"font-bold text-heading text-fluid-sm"},du={class:"text-fluid-xs text-sub mt-0.5"},cu={class:"flex gap-3 flex-wrap"},Kt={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!1,default:()=>({background:"",border:""})}},setup(l){return(V,o)=>(v(),C("div",lu,[e("div",ou,[e("div",iu,[e("div",ru,[e("div",null,[e("h4",uu,I(l.title),1),e("p",du,I(l.description),1)]),xt(V.$slots,"badge")]),e("div",cu,[xt(V.$slots,"actions")]),xt(V.$slots,"survey"),xt(V.$slots,"content")])])]))}},mu={key:1,class:"space-y-4"},pu={class:"flex items-center justify-between"},vu={class:"space-y-4"},fu={class:"block text-fluid-sm font-medium text-body"},yu=["onUpdate:modelValue","placeholder"],gu={key:2,class:"space-y-2"},bu=["onUpdate:modelValue","value"],hu={class:"flex gap-2 flex-wrap justify-end pt-2"},Ss={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V,p=A(o.initialExpanded),c=A({});De(()=>o.questions,x=>{const $={};x.forEach(d=>{$[d.key]=""}),c.value=$},{immediate:!0});const g=()=>{m("survey-completed",{...c.value}),u()},f=()=>{m("survey-refused"),u()},k=()=>{m("not-responding"),u()},u=()=>{p.value=!1;const x={};o.questions.forEach($=>{x[$.key]=""}),c.value=x};return(x,$)=>(v(),C("div",null,[p.value?(v(),C("div",mu,[e("div",pu,[$[4]||($[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:$[1]||($[1]=d=>p.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...$[3]||($[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",vu,[(v(!0),C(qe,null,ze(l.questions,(d,h)=>(v(),C("div",{key:h,class:"space-y-2"},[e("label",fu,I(d.label),1),d.type==="text"?Ke((v(),C("textarea",{key:0,"onUpdate:modelValue":y=>c.value[d.key]=y,placeholder:d.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,yu)),[[ra,c.value[d.key]]]):d.type==="select"?(v(),pe(t(qt),{key:1,modelValue:c.value[d.key],"onUpdate:modelValue":y=>c.value[d.key]=y},{default:r(()=>[s(t(Nt),{class:"w-full h-10 min-h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select an option..."})]),_:1}),s(t(Mt),null,{default:r(()=>[(v(!0),C(qe,null,ze(d.options,y=>(v(),pe(t(be),{key:y,value:y},{default:r(()=>[T(I(y),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):d.type==="radio"?(v(),C("div",gu,[(v(!0),C(qe,null,ze(d.options,y=>(v(),C("label",{key:y,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[Ke(e("input",{type:"radio","onUpdate:modelValue":b=>c.value[d.key]=b,value:y,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,bu),[[vt,c.value[d.key]]]),T(" "+I(y),1)]))),128))])):L("",!0)]))),128)),e("div",hu,[s(t(Y),{label:"Complete Survey",variant:"primary",size:"small",onClick:g,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),s(t(Y),{label:"Customer Refused",variant:"outline",size:"small",onClick:f}),s(t(Y),{label:"Not Responding",variant:"outline",size:"small",onClick:k})])])])):(v(),C("button",{key:0,onClick:$[0]||($[0]=d=>p.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...$[2]||($[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},xu={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V,p=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],c=S(()=>{if(!o.opportunity.createdAt)return 0;const $=new Date(o.opportunity.createdAt),h=Math.abs(new Date-$);return Math.ceil(h/(1e3*60*60*24))}),g=()=>{m("create-offer",o.opportunity)},f=()=>{m("review",o.opportunity)},k=$=>{m("survey-completed",{opportunity:o.opportunity,responses:$})},u=()=>{m("survey-refused",{opportunity:o.opportunity})},x=()=>{m("not-responding",{opportunity:o.opportunity})};return($,d)=>(v(),pe(Kt,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${c.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:r(()=>[e("button",{onClick:g,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Review Opportunity ")]),survey:r(()=>[s(Ss,{questions:p,onSurveyCompleted:k,onSurveyRefused:u,onNotResponding:x})]),_:1},8,["description"]))}},wu={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V,p=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],c=S(()=>{if(!o.opportunity.createdAt)return 0;const x=new Date(o.opportunity.createdAt),d=Math.abs(new Date-x);return Math.ceil(d/(1e3*60*60*24))}),g=()=>{m("create-offer",o.opportunity)},f=x=>{m("survey-completed",{opportunity:o.opportunity,responses:x})},k=()=>{m("survey-refused",{opportunity:o.opportunity})},u=()=>{m("not-responding",{opportunity:o.opportunity})};return(x,$)=>(v(),pe(Kt,{title:"Unsold Feedback",description:`This opportunity has been open for ${c.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:r(()=>[e("button",{onClick:g,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Create Offer ")]),survey:r(()=>[s(Ss,{questions:p,onSurveyCompleted:f,onSurveyRefused:k,onNotResponding:u})]),_:1},8,["description"]))}},ku={class:"space-y-4"},Su={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cu={class:"flex flex-wrap gap-3"},$u={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Du={key:1},Au={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["appointment-scheduled","close-as-lost","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=A(null),g=A(null),f=S(()=>{var x;return c.value==="schedule"?!1:c.value==="close-lost"&&((x=g.value)==null?void 0:x.canSubmit)||!1});async function k(){var x;c.value==="schedule"?p("appointment-scheduled",{opportunity:m.opportunity}):c.value==="close-lost"&&((x=g.value)==null||x.submit())}function u(x){p("close-as-lost",{opportunity:m.opportunity,reason:x.reason})}return V({canSubmit:f,submit:k}),(x,$)=>(v(),C("div",ku,[$[6]||($[6]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"No Follow-Up Task"),e("p",{class:"text-sm text-body"}," 5+ days in negotiation with no future appointment scheduled. Schedule an appointment to move forward or close as lost. ")],-1)),e("div",Su,[$[4]||($[4]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Choose Action",-1)),e("div",Cu,[s(t(Y),{variant:"outline",onClick:$[0]||($[0]=d=>c.value="schedule"),class:Z(["flex-1",c.value==="schedule"?"border-purple-500 bg-purple-50 text-purple-700":""])},{default:r(()=>[...$[2]||($[2]=[e("i",{class:"fa-solid fa-calendar-plus mr-2"},null,-1),T(" Schedule Appointment ",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:$[1]||($[1]=d=>c.value="close-lost"),class:Z(["flex-1",c.value==="close-lost"?"border-red-500 bg-red-50 text-red-700":""])},{default:r(()=>[...$[3]||($[3]=[e("i",{class:"fa-solid fa-xmark mr-2"},null,-1),T(" Close as Lost ",-1)])]),_:1},8,["class"])])]),c.value==="schedule"?(v(),C("div",$u,[...$[5]||($[5]=[e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Schedule Appointment",-1),e("p",{class:"text-sm text-sub"}," This will reuse the full schedule appointment form from the Awaiting Appointment stage. ",-1)])])):L("",!0),c.value==="close-lost"?(v(),C("div",Du,[s($n,{ref_key:"closeFormRef",ref:g,item:l.opportunity,"item-type":"opportunity",onClose:u},null,8,["item"])])):L("",!0)]))}},Tu={key:0},Ou={class:"flex items-center justify-between mb-2"},Iu={class:"flex items-center gap-2"},Nu={class:"font-semibold text-heading text-sm"},Vu={class:"relative"},Mu={class:"flex overflow-x-auto space-x-2 pb-2 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},qu={class:"w-full h-16 bg-surfaceSecondary flex items-center justify-center overflow-hidden"},Lu=["src"],_u={key:1,class:"fa-solid fa-car text-base text-sub"},Fu={class:"p-2 space-y-1.5"},Uu={class:"font-bold text-heading text-xs leading-tight line-clamp-2 mb-0.5"},Eu={class:"text-sm font-bold text-heading"},Ru={class:"text-xs text-sub"},ju={key:0,class:"pt-1"},Bu={key:1,class:"text-center py-6 px-3 bg-surfaceSecondary border border-E5E7EB rounded-lg"},Wu={__name:"OfferCarousel",props:{offers:{type:Array,default:()=>[]},opportunityId:{type:[Number,String],required:!0}},emits:["offer-accepted"],setup(l,{emit:V}){const o=f=>f?new Intl.NumberFormat("en-US").format(f):"0",m=f=>{if(!f)return"";const k=new Date(f),x=Math.abs(new Date-k),$=Math.ceil(x/(1e3*60*60*24));return $===0?"today":$===1?"yesterday":$<7?`${$} days ago`:k.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=f=>({active:"Active",accepted:"Accepted",archived:"Archived"})[f]||"Active",c=f=>({active:"bg-blue-600",accepted:"bg-green-600",archived:"bg-gray-600"})[f]||"bg-gray-600",g=f=>f.status==="accepted"?"border-green-500 border-2":"border-E5E7EB";return(f,k)=>l.offers.length>0?(v(),C("div",Tu,[e("div",Ou,[e("div",Iu,[k[0]||(k[0]=e("i",{class:"fa-solid fa-file-invoice-dollar text-sub text-xs"},null,-1)),e("h3",Nu,"Offers ("+I(l.offers.length)+")",1)])]),e("div",Vu,[e("div",Mu,[(v(!0),C(qe,null,ze(l.offers,u=>{var x;return v(),C("div",{key:u.id,class:Z(["flex-none w-36 snap-start bg-white border rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow relative",g(u)])},[e("div",{class:Z(["absolute top-1 right-1 z-10 text-white text-xs font-bold px-1.5 py-0.5 rounded shadow-sm",c(u.status)])},I(p(u.status)),3),e("div",qu,[(x=u.data)!=null&&x.image?(v(),C("img",{key:0,src:u.data.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Lu)):(v(),C("i",_u))]),e("div",Fu,[e("div",null,[e("h4",Uu,I(u.vehicleBrand)+" "+I(u.vehicleModel)+" ("+I(u.vehicleYear)+") ",1),e("p",Eu,"€ "+I(o(u.price)),1),e("p",Ru,I(m(u.createdAt)),1)]),u.status==="active"?(v(),C("div",ju,[s(t(Y),{variant:"primary",size:"small",onClick:Sn($=>f.$emit("offer-accepted",u),["stop"]),class:"w-full text-xs h-7"},{default:r(()=>[...k[1]||(k[1]=[e("i",{class:"fa-solid fa-check text-xs mr-1"},null,-1),T(" Mark as accepted ",-1)])]),_:1},8,["onClick"])])):L("",!0)])],2)}),128))])])])):(v(),C("div",Bu,[...k[2]||(k[2]=[e("i",{class:"fa-solid fa-file-invoice text-2xl text-sub mb-2"},null,-1),e("p",{class:"text-xs font-medium text-body"},"No offers created yet",-1),e("p",{class:"text-xs text-sub mt-0.5"},"Create an offer to start negotiations",-1)])]))}},Xn=Wt(Wu,[["__scopeId","data-v-240d4fdb"]]),Pu={class:"space-y-4"},zu={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Yu={class:"text-sm text-body"},Hu={key:0,class:"mb-4"},Qu={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ju={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},Gu={key:0,class:"space-y-3"},Zu={key:0},Ku={class:"flex items-center justify-between gap-2"},Xu={class:"text-sub text-xs"},ed={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["offer-accepted","offer-deleted","view-offer","send-message"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=A(null),g=A(""),f=A(null),k=S(()=>{const y=m.opportunity.lastActivity||m.opportunity.createdAt;if(!y)return 0;const b=new Date(y),w=Math.abs(new Date-b);return Math.ceil(w/(1e3*60*60*24))}),u=S(()=>!m.opportunity.offers||m.opportunity.offers.length===0?[]:m.opportunity.offers.filter(y=>y.status==="active").map(y=>({id:y.id,label:`${y.vehicleBrand} ${y.vehicleModel} (${y.vehicleYear})`,price:y.price,value:y.id}))),x=S(()=>c.value&&g.value.trim().length>0);function $(y){return y?new Intl.NumberFormat("en-US").format(y):"0"}function d(y){p("offer-accepted",y)}async function h(){x.value&&(p("send-message",{channel:c.value,message:g.value,offerId:f.value}),c.value=null,g.value="",f.value=null)}return V({canSubmit:x,submit:h}),(y,b)=>(v(),C("div",Pu,[e("div",zu,[b[6]||(b[6]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"Offer Feedback Task",-1)),e("p",Yu," This opportunity has been in negotiation for "+I(k.value)+" days without a contract. Follow up with customer to get feedback and move forward. ",1)]),l.opportunity.offers&&l.opportunity.offers.length>0?(v(),C("div",Hu,[s(Xn,{offers:l.opportunity.offers,"opportunity-id":l.opportunity.id,onOfferAccepted:d},null,8,["offers","opportunity-id"])])):L("",!0),e("div",Qu,[b[13]||(b[13]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",Ju,[s(t(Y),{variant:"outline",onClick:b[0]||(b[0]=N=>c.value="call"),class:Z(["flex items-center justify-center gap-2",c.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[7]||(b[7]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[1]||(b[1]=N=>c.value="whatsapp"),class:Z(["flex items-center justify-center gap-2",c.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[8]||(b[8]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[2]||(b[2]=N=>c.value="sms"),class:Z(["flex items-center justify-center gap-2",c.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[9]||(b[9]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:b[3]||(b[3]=N=>c.value="email"),class:Z(["flex items-center justify-center gap-2",c.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...b[10]||(b[10]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),c.value?(v(),C("div",Gu,[u.value.length>0?(v(),C("div",Zu,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[11]||(b[11]=[T("Select offer to reference",-1)])]),_:1}),s(t(Je),{modelValue:f.value,"onUpdate:modelValue":b[4]||(b[4]=N=>f.value=N),items:u.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:r(({item:N})=>[e("div",Ku,[e("span",null,I(N.label),1),e("span",Xu,"€ "+I($(N.price)),1)])]),_:1},8,["modelValue","items"])])):L("",!0),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[12]||(b[12]=[T("Message",-1)])]),_:1}),s(t(lt),{modelValue:g.value,"onUpdate:modelValue":b[5]||(b[5]=N=>g.value=N),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):L("",!0)])]))}},td={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V,p=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],c=S(()=>{var y;if(!((y=o.opportunity)!=null&&y.contractDate))return 0;const $=new Date(o.opportunity.contractDate),h=Math.abs(new Date-$);return Math.ceil(h/(1e3*60*60*24))}),g=()=>{m("prepare-delivery",o.opportunity)},f=()=>{m("pre-delivery-checklist",o.opportunity)},k=$=>{m("survey-completed",{opportunity:o.opportunity,responses:$})},u=()=>{m("survey-refused",{opportunity:o.opportunity})},x=()=>{m("not-responding",{opportunity:o.opportunity})};return($,d)=>(v(),pe(Kt,{title:"Contract Feedback",description:`Contract was signed ${c.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:r(()=>[e("button",{onClick:g,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Prepare for Delivery "),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:r(()=>[s(Ss,{questions:p,onSurveyCompleted:k,onSurveyRefused:u,onNotResponding:x})]),_:1},8,["description"]))}},sd={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V,p=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],c=S(()=>{const x=o.activities.find(y=>{var b;return y.type==="delivery"||((b=y.action)==null?void 0:b.toLowerCase().includes("delivered"))});if(!x||!x.timestamp)return 0;const $=new Date(x.timestamp),h=Math.abs(new Date-$);return Math.ceil(h/(1e3*60*60*24))}),g=()=>{m("delivery-feedback",o.opportunity)},f=x=>{m("survey-completed",{opportunity:o.opportunity,responses:x})},k=()=>{m("survey-refused",{opportunity:o.opportunity})},u=()=>{m("not-responding",{opportunity:o.opportunity})};return(x,$)=>(v(),pe(Kt,{title:"Delivery Feedback",description:`Vehicle was delivered ${c.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:r(()=>[e("button",{onClick:g,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"}," Delivery Feedback ")]),survey:r(()=>[s(Ss,{questions:p,onSurveyCompleted:f,onSurveyRefused:k,onNotResponding:u})]),_:1},8,["description"]))}},nd={key:0,class:"mt-4 pt-4 border-t border-black/5"},ad={class:"grid grid-cols-2 gap-4"},ld={class:"flex items-center gap-2"},od={class:"text-sub"},id={class:"font-medium text-heading"},rd={class:"flex items-center gap-2"},ud={class:"font-medium text-heading"},dd={class:"mt-4"},cd={class:"mt-4 flex justify-end"},md={key:1,class:"mt-4 pt-4 border-t border-black/5"},pd={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},vd={class:"flex justify-end"},fd={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["not-responding","auto-close-lost","set-callback","assigned","close-as-lost"],setup(l,{emit:V}){const o=l,m=V,p=_t(),c=Tt(),g=Lt(),f=A(null),k=A(null),u=A(""),x=S(()=>p.assignableUsers),$=S(()=>p.assignableTeams),d=S(()=>$.value.map(D=>({...D,label:`${D.dealership||"No location"} → ${D.name}`,value:D.id}))),h=S(()=>{var j;if(!f.value)return[];const D=f.value;return(((j=x.value)==null?void 0:j.filter(H=>H.team===D.name||H.teamId===D.id))||[]).map(H=>({...H,label:H.name,value:H.id}))}),y=S({get:()=>{var D;return((D=f.value)==null?void 0:D.id)||null},set:D=>{var j;if(!D){f.value=null;return}const M=(j=$.value)==null?void 0:j.find(H=>H.id===D);f.value=M||null,M&&(k.value=null)}}),b=S({get:()=>{var D;return((D=k.value)==null?void 0:D.id)||null},set:D=>{if(!D){k.value=null;return}const M=h.value.find(j=>j.id===D);k.value=M||null}}),N=D=>D?D.split(" ").map(M=>M[0]).join("").toUpperCase().substring(0,2):"?",w=D=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[D]||"bg-surfaceSecondary text-body";async function E(){var j,H,ae;if(!f.value)return;const D=((j=k.value)==null?void 0:j.name)||((H=f.value)==null?void 0:H.name),M={assignee:D};u.value&&(M.assignmentNote=u.value),await g.updateOpportunity(o.opportunity.id,M),await g.addActivity(o.opportunity.id,{type:"assignment",user:((ae=c.currentUser)==null?void 0:ae.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${D}${u.value?` with note: ${u.value}`:""}`,timestamp:new Date().toISOString()}),m("assigned",{opportunity:o.opportunity,assignee:D,note:u.value}),f.value=null,k.value=null,u.value=""}function _(){m("close-as-lost",{opportunity:o.opportunity,reason:"Multiple no shows"})}ks(()=>{var D,M,j;if(o.opportunity.assignee&&!f.value&&!k.value){const H=(D=x.value)==null?void 0:D.find(Q=>Q.name===o.opportunity.assignee),ae=(M=$.value)==null?void 0:M.find(Q=>Q.name===o.opportunity.assignee);if(H){const Q=(j=$.value)==null?void 0:j.find(we=>we.name===H.team||we.id===H.teamId);Q&&(f.value=Q,k.value=H)}else ae&&(f.value=ae)}o.opportunity.assignmentNote&&(u.value=o.opportunity.assignmentNote)}),De(()=>o.opportunity.assignee,D=>{var M,j,H;if(D&&!f.value&&!k.value){const ae=(M=x.value)==null?void 0:M.find(we=>we.name===D),Q=(j=$.value)==null?void 0:j.find(we=>we.name===D);if(ae){const we=(H=$.value)==null?void 0:H.find(Ne=>Ne.name===ae.team||Ne.id===ae.teamId);we&&(f.value=we,k.value=ae)}else Q&&(f.value=Q)}});const F=S(()=>{var D;return((D=o.scheduledAppointment)==null?void 0:D.noShowCount)||0}),ye=S(()=>{const D=F.value;return D===0||D===1?"NS1":D===2?"NS2":D>=3?"NS3":`NS${D}`}),fe=S(()=>{const D=F.value;return D>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":D>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),q=S(()=>{var M;return(M=o.scheduledAppointment)!=null&&M.start?new Date(o.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return(D,M)=>(v(),pe(Kt,{title:ye.value,description:`Appointment was scheduled for ${q.value} but customer did not show up. ${fe.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{content:r(()=>[F.value<3?(v(),C("div",nd,[M[8]||(M[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",ad,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[3]||(M[3]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:y.value,"onUpdate:modelValue":M[0]||(M[0]=j=>y.value=j),items:d.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:j})=>[e("div",ld,[e("span",od,I(j.dealership||"No location"),1),M[4]||(M[4]=e("span",{class:"text-sub"},"→",-1)),e("span",id,I(j.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[5]||(M[5]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Je),{modelValue:b.value,"onUpdate:modelValue":M[1]||(M[1]=j=>b.value=j),items:h.value,disabled:!f.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:j})=>[e("div",rd,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",w(j.role)])},I(N(j.name)),3),e("span",ud,I(j.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",dd,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...M[6]||(M[6]=[T("Note for sellers",-1)])]),_:1}),s(t(lt),{modelValue:u.value,"onUpdate:modelValue":M[2]||(M[2]=j=>u.value=j),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the sellers..."},null,8,["modelValue"])]),e("div",cd,[s(t(Y),{variant:"primary",disabled:!f.value,onClick:E,class:"bg-primary"},{default:r(()=>[...M[7]||(M[7]=[T(" Assign ",-1)])]),_:1},8,["disabled"])])])):L("",!0),F.value>=3?(v(),C("div",md,[e("div",pd,[M[9]||(M[9]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),M[10]||(M[10]=e("p",{class:"text-sm text-body mb-4"}," This is the third no-show. The opportunity should be closed as lost. ",-1)),e("div",vd,[s(t(Y),{label:"Close Opportunity as Lost",variant:"primary",size:"small",onClick:_})])])])):L("",!0)]),_:1},8,["title","description"]))}},yd={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(l,{emit:V}){const o=l,m=V;wn();const p=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],c=S(()=>{const d=o.opportunity.lastActivity||o.opportunity.createdAt;if(!d)return 0;const h=new Date(d),b=Math.abs(new Date-h);return Math.ceil(b/(1e3*60*60*24))}),g=()=>{m("reopen",o.opportunity)},f=()=>{m("close-lost",{opportunity:o.opportunity,reason:"Abandoned - no activity for extended period"})},k=()=>{m("requalify",o.opportunity)},u=d=>{m("survey-completed",{opportunity:o.opportunity,responses:d})},x=()=>{m("survey-refused",{opportunity:o.opportunity})},$=()=>{m("not-responding",{opportunity:o.opportunity})};return(d,h)=>(v(),pe(Kt,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${c.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:r(()=>[e("button",{onClick:g,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors"},[...h[0]||(h[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),T(" Reopen Opportunity ",-1)])]),e("button",{onClick:f,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...h[1]||(h[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),T(" Close as Lost ",-1)])]),e("button",{onClick:k,class:"bg-white border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"},[...h[2]||(h[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),T(" Requalify as Lead ",-1)])])]),survey:r(()=>[s(Ss,{questions:p,onSurveyCompleted:u,onSurveyRefused:x,onNotResponding:$})]),_:1},8,["description"]))}},gd={OOFB:xu,UFB:wu,NFU:Au,OFB:ed,CFB:td,DFB:sd,NS:fd,ABANDONED:yd};function bd(l,V,o,m,p){const c=S(()=>{const d=Us(l),h=Us(V),y=Us(o);return{opportunity:d,scheduledAppointment:h,activities:y,hasOffers:d.offers&&d.offers.length>0||(y==null?void 0:y.some(b=>b.type==="offer"))||!1,stage:d.displayStage||d.stage,deliverySubstatus:d.deliverySubstatus||null,formatDateTime:p,hasActiveTaskWidget:!1}}),g=S(()=>{const d=c.value,h=Ta(d.stage,d);if(!h)return null;const y=gd[h];return y?{type:h,component:y,props:{opportunity:d.opportunity,appointment:d.scheduledAppointment,activities:d.activities}}:null}),f=S(()=>({...c.value,hasActiveTaskWidget:!!g.value})),k=S(()=>{const d=f.value,h=Oa(d.stage,d);if(!h)return null;const y=m[h.key];return{...h,handler:y||(()=>{})}}),u=S(()=>{const d=f.value;return Ia(d.stage,d).map(y=>{const b=m[y.key];return{...y,handler:b||(()=>{})}})}),x=S(()=>{const d=c.value;return Na(d.stage)}),$=S(()=>!g.value||!g.value.type?"":Va(g.value.type));return{primaryAction:k,secondaryActions:u,activeTaskWidget:g,taskWidgetTitle:$,isClosed:x}}const hd={class:"relative"},xd=["disabled"],wd={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},yn={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(l,{emit:V}){const o=l,m=V,p=A(!1),c=()=>{p.value=!p.value},g=()=>{p.value=!1},f=u=>{u.disabled||(g(),m("action-selected",u),u.handler&&typeof u.handler=="function"&&u.handler())},k=S(()=>(o.actions||[]).map(u=>({key:u.key,label:u.label,disabled:!!u.disabled,onClick:()=>f(u)})));return(u,x)=>{const $=En("click-outside");return v(),C("div",hd,[e("button",{onClick:Sn(c,["stop"]),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!l.actions||l.actions.length===0},[x[0]||(x[0]=e("span",null,"More actions",-1)),e("i",{class:Z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":p.value}])},null,2)],8,xd),p.value&&k.value.length>0?Ke((v(),C("div",wd,[s(t(Ln),{items:k.value,className:"w-56"},null,8,["items"])])),[[$,g]]):L("",!0)])}}},kd={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Sd={class:"space-y-2"},Cd={class:"space-y-2"},$d={class:"space-y-2"},Dd={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(l,{emit:V}){const o=l,m=V,p=A(""),c=A(""),g=A(""),f=S(()=>new Date().toISOString().split("T")[0]);De(()=>o.show,$=>{if($){const d=new Date;p.value=d.toISOString().split("T")[0],c.value=d.toTimeString().slice(0,5),g.value=""}});const k=()=>{if(!p.value)return;const $=c.value?`${p.value}T${c.value}:00`:`${p.value}T12:00:00`;m("confirm",{contractDate:$,notes:g.value})},u=()=>{m("cancel")},x=$=>{$||u()};return($,d)=>(v(),pe(t(ws),{open:l.show,"onUpdate:open":x},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...d[3]||(d[3]=[T("Set Contract Signing Date",-1)])]),_:1})]),_:1}),e("div",kd,[e("div",Sd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...d[4]||(d[4]=[T("Contract Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=h=>p.value=h),max:f.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Cd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...d[5]||(d[5]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:c.value,"onUpdate:modelValue":d[1]||(d[1]=h=>c.value=h),class:"w-full h-10"},null,8,["modelValue"])]),e("div",$d,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...d[6]||(d[6]=[T("Notes (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:g.value,"onUpdate:modelValue":d[2]||(d[2]=h=>g.value=h),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u}),s(t(Y),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!p.value,onClick:k},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ad={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Td={class:"space-y-2"},Od={class:"space-y-2"},Id={class:"space-y-2"},Nd={class:"space-y-2"},Vd={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(l,{emit:V}){const o=l,m=V,p=A(""),c=A(""),g=A(""),f=A(""),k=S(()=>new Date().toISOString().split("T")[0]);De(()=>o.show,d=>{if(d){const h=new Date;p.value=h.toISOString().split("T")[0],c.value=h.toTimeString().slice(0,5),g.value="",f.value=""}});const u=()=>{if(!p.value||!g.value)return;const d=c.value?`${p.value}T${c.value}:00`:`${p.value}T12:00:00`;m("confirm",{deliveryDate:d,location:g.value,notes:f.value})},x=()=>{m("cancel")},$=d=>{d||x()};return(d,h)=>(v(),pe(t(ws),{open:l.show,"onUpdate:open":$},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...h[4]||(h[4]=[T("Mark as Delivered",-1)])]),_:1})]),_:1}),e("div",Ad,[e("div",Td,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[5]||(h[5]=[T("Delivery Date",-1)])]),_:1}),s(t(at),{type:"date",modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=y=>p.value=y),max:k.value,class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Od,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[6]||(h[6]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:c.value,"onUpdate:modelValue":h[1]||(h[1]=y=>c.value=y),class:"w-full h-10"},null,8,["modelValue"])]),e("div",Id,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[7]||(h[7]=[T("Delivery Location",-1)])]),_:1}),s(t(qt),{modelValue:g.value,"onUpdate:modelValue":h[2]||(h[2]=y=>g.value=y)},{default:r(()=>[s(t(Nt),{class:"w-full h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select location..."})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"Dealership"},{default:r(()=>[...h[8]||(h[8]=[T("At Dealership",-1)])]),_:1}),s(t(be),{value:"Customer Address"},{default:r(()=>[...h[9]||(h[9]=[T("Customer Address",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...h[10]||(h[10]=[T("Other Location",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Nd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...h[11]||(h[11]=[T("Delivery Notes",-1)])]),_:1}),s(t(lt),{modelValue:f.value,"onUpdate:modelValue":h[3]||(h[3]=y=>f.value=y),rows:"4",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:x}),s(t(Y),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!p.value||!g.value,onClick:u},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Md={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},qd={class:"space-y-2"},Ld={class:"space-y-2"},qn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0},preselectedReason:{type:String,default:""}},emits:["confirm","cancel"],setup(l,{emit:V}){const o=l,m=V,p=A(""),c=A("");De(()=>o.show,u=>{u&&(o.preselectedReason?p.value=o.preselectedReason:p.value="",c.value="")}),De(()=>o.preselectedReason,u=>{u&&o.show&&(p.value=u)});const g=()=>{p.value&&m("confirm",{reason:p.value,notes:c.value})},f=()=>{m("cancel")},k=u=>{u||f()};return(u,x)=>(v(),pe(t(ws),{open:l.show,"onUpdate:open":k},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...x[2]||(x[2]=[T("Close as Lost",-1)])]),_:1})]),_:1}),e("div",Md,[e("div",qd,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[3]||(x[3]=[T("Reason",-1)])]),_:1}),s(t(qt),{modelValue:p.value,"onUpdate:modelValue":x[0]||(x[0]=$=>p.value=$)},{default:r(()=>[s(t(Nt),{class:"w-full h-10"},{default:r(()=>[s(t(Vt),{placeholder:"Select a reason..."})]),_:1}),s(t(Mt),null,{default:r(()=>[s(t(be),{value:"Multiple no shows"},{default:r(()=>[...x[4]||(x[4]=[T("Multiple no shows",-1)])]),_:1}),s(t(be),{value:"Not interested"},{default:r(()=>[...x[5]||(x[5]=[T("Not interested",-1)])]),_:1}),s(t(be),{value:"Budget constraints"},{default:r(()=>[...x[6]||(x[6]=[T("Budget constraints",-1)])]),_:1}),s(t(be),{value:"Found better price"},{default:r(()=>[...x[7]||(x[7]=[T("Found better price at competitor",-1)])]),_:1}),s(t(be),{value:"No response"},{default:r(()=>[...x[8]||(x[8]=[T("Customer not responding",-1)])]),_:1}),s(t(be),{value:"Wrong timing"},{default:r(()=>[...x[9]||(x[9]=[T("Timing not right",-1)])]),_:1}),s(t(be),{value:"Other"},{default:r(()=>[...x[10]||(x[10]=[T("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Ld,[s(t(J),{class:"block text-sm font-semibold text-heading"},{default:r(()=>[...x[11]||(x[11]=[T("Additional Notes",-1)])]),_:1}),s(t(lt),{modelValue:c.value,"onUpdate:modelValue":x[1]||(x[1]=$=>c.value=$),rows:"5",placeholder:"Add any relevant details about why this opportunity was lost...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])]),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f}),s(t(Y),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!p.value,onClick:g},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},_d={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(l,{emit:V}){const o=V,m=p=>{p||o("cancel")};return(p,c)=>(v(),pe(t(ws),{open:l.show,"onUpdate:open":m},{default:r(()=>[s(t(fs),null,{default:r(()=>[s(t(ys),{class:"fixed inset-0 z-50 bg-black/50"}),s(t(gs),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:r(()=>[s(t(bs),{class:"flex-shrink-0"},{default:r(()=>[s(t(hs),null,{default:r(()=>[...c[2]||(c[2]=[T("Requalify as Lead",-1)])]),_:1})]),_:1}),c[3]||(c[3]=e("div",{class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),T(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),T(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),T(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),s(t(xs),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:r(()=>[s(t(Y),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c[0]||(c[0]=g=>p.$emit("cancel"))}),s(t(Y),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:c[1]||(c[1]=g=>p.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Fd={class:"space-y-4"},Ud={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ed={key:0,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Rd={class:"grid grid-cols-2 gap-4"},jd={class:"flex items-center gap-2"},Bd={class:"text-sub"},Wd={class:"font-medium text-heading"},Pd={class:"flex items-center gap-2"},zd={class:"font-medium text-heading"},Yd={key:1,class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Hd={class:"bg-white border border-black/5 rounded-lg overflow-hidden"},Qd={class:"grid grid-cols-1 md:grid-cols-2 divide-x divide-black/5"},Jd={class:"p-6"},Gd={class:"flex items-center justify-between mb-4"},Zd={class:"text-sm font-semibold text-heading"},Kd={class:"grid grid-cols-7 gap-1 mb-2"},Xd={class:"grid grid-cols-7 gap-1"},ec=["onClick"],tc={class:"p-6"},sc={class:"text-sm font-semibold text-heading mb-4"},nc={key:0,class:"space-y-2"},ac=["onClick"],lc={key:1,class:"text-sm text-sub py-4 text-center"},oc={key:2,class:"text-sm text-sub py-4 text-center"},ic={class:"flex justify-end gap-2 px-4 pb-4 pt-3"},gn={__name:"OpportunityScheduleForm",props:{opportunity:{type:Object,required:!0},mode:{type:String,validator:l=>["schedule","reschedule"].includes(l),default:"schedule"},initialAppointment:{type:Object,default:null}},emits:["submit","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=_t(),g=A(""),f=A(null),k=A(""),u=A(null),x=A(null),$=A(null),d=A(""),h=A(new Date().getMonth()),y=A(new Date().getFullYear()),b=A({immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}),N=[{value:"appointment-on-phone",label:"Appointment on the phone (15m)"},{value:"appointment-at-dealership",label:"Appointment at the dealership (30m)"},{value:"recall-internal",label:"Recall - internal (15m)"},{value:"appointment-at-dealership-test-drive",label:"Appointment at the dealership + Test drive (1h)"},{value:"appointment-at-workshop",label:"Appointment at the workshop (15m)"},{value:"appointment-at-customer-site",label:"Appointment at customer's site (1h 40m)"},{value:"appointment-at-customer-site-test-drive",label:"Appointment at customer's site + Test drive (5h)"}],w={"appointment-on-phone":15,"appointment-at-dealership":30,"recall-internal":15,"appointment-at-dealership-test-drive":60,"appointment-at-workshop":15,"appointment-at-customer-site":100,"appointment-at-customer-site-test-drive":300},E=S(()=>N.map(R=>({value:R.value,label:R.label}))),_=S(()=>{const R=[];for(let B=9*60;B<=18*60;B+=30){const oe=String(Math.floor(B/60)).padStart(2,"0"),X=String(B%60).padStart(2,"0");R.push(`${oe}:${X}`)}return R}),F=S(()=>{if($.value!=null)return $.value;const R=parseInt(d.value,10);return Number.isFinite(R)&&R>0?R:null}),ye=S(()=>m.mode==="reschedule"?"Reschedule and Save":"Schedule and Save"),fe=S(()=>!!(g.value&&f.value&&k.value&&u.value)),q=["MON","TUE","WED","THU","FRI","SAT","SUN"],D=S(()=>new Date(y.value,h.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),M=S(()=>{const R=new Date(y.value,h.value,1),oe=new Date(y.value,h.value+1,0).getDate(),X=R.getDay()===0?6:R.getDay()-1,W=[];for(let se=0;se<X;se++)W.push(null);for(let se=1;se<=oe;se++)W.push(se);return W}),j=S(()=>{if(!f.value)return"Select a date";const R=f.value,B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${B[R.getDay()]}, ${oe[R.getMonth()]} ${R.getDate()}`}),H=S(()=>c.assignableUsers),ae=S(()=>c.assignableTeams),Q=S(()=>ae.value.map(R=>({...R,label:`${R.dealership||"No location"} → ${R.name}`,value:R.id}))),we=S(()=>{var oe;if(!u.value)return[];const R=u.value;return(((oe=H.value)==null?void 0:oe.filter(X=>X.team===R.name||X.teamId===R.id))||[]).map(X=>({...X,label:X.name,value:X.id}))}),Ne=S({get:()=>{var R;return((R=u.value)==null?void 0:R.id)||null},set:R=>{var oe;if(!R){u.value=null,x.value=null;return}const B=(oe=ae.value)==null?void 0:oe.find(X=>X.id===R);u.value=B||null,B&&ee(`team-${B.id}`)}}),ce=S({get:()=>{var R;return((R=x.value)==null?void 0:R.id)||null},set:R=>{if(!R){x.value=null;return}const B=we.value.find(oe=>oe.id===R);x.value=B||null,B&&ee(`user-${B.id}`)}}),te=S(()=>{if(!f.value)return[];const R=f.value.toISOString().split("T")[0];if(x.value){const B=Bt(`user-${x.value.id}`,R);return _.value.filter(oe=>B.includes(oe))}if(u.value){const B=Bt(`team-${u.value.id}`,R);return _.value.filter(oe=>B.includes(oe))}return _.value||[]});function K(R){return R?R.split(" ").map(B=>B[0]).join("").toUpperCase().substring(0,2):"?"}function re(R){return{manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"}[R]||"bg-surfaceSecondary text-body"}function ke(R){if(!R)return;const B=new Date(y.value,h.value,R);f.value=B,k.value=""}function Oe(R){if(!R||!f.value)return!1;const B=f.value;return B.getDate()===R&&B.getMonth()===h.value&&B.getFullYear()===y.value}function Xe(){h.value===0?(h.value=11,y.value--):h.value--}function P(){h.value===11?(h.value=0,y.value++):h.value++}function ee(R){const B=new Date;B.setHours(0,0,0,0);for(let oe=0;oe<30;oe++){const X=new Date(B);if(X.setDate(B.getDate()+oe),X.getDay()===0||X.getDay()===6)continue;const W=X.toISOString().split("T")[0],se=Bt(R,W);if(se!=null&&se.length){f.value=X,h.value=X.getMonth(),y.value=X.getFullYear();const ie=_.value.filter(Se=>se.includes(Se));ie.length&&(k.value=ie[0]);break}}}function Be(R){b.value=R}function Ee(){We(),p("cancel")}function We(){g.value="",f.value=null,k.value="",u.value=null,x.value=null,$.value=null,d.value="",b.value={immediateConfirmation:{enabled:!0,channels:["email"]},reminder:{enabled:!0,channels:["email"]},salespersonNotification:{enabled:!0}}}function Ae(R){var B,oe,X;if(R){if(g.value=R.type||"",R.assignee){const W=(B=H.value)==null?void 0:B.find(ie=>ie.name===R.assignee),se=(oe=ae.value)==null?void 0:oe.find(ie=>ie.name===R.assignee);if(W){const ie=(X=ae.value)==null?void 0:X.find(Se=>Se.name===W.team||Se.id===W.teamId);ie&&(u.value=ie,x.value=W)}else se&&(u.value=se)}if(R.start){const W=new Date(R.start),se=new Date(W.getFullYear(),W.getMonth(),W.getDate());f.value=se,h.value=W.getMonth(),y.value=W.getFullYear();const ie=W.getHours(),Se=W.getMinutes(),ue=Se<15?0:Se<45?30:60,Le=ue===60?ie+1:ie,xe=ue===60?0:ue,Ve=`${String(Le).padStart(2,"0")}:${String(xe).padStart(2,"0")}`;if(_.value.includes(Ve))k.value=Ve;else{const Re=Le*60+xe,et=_.value.reduce((tt,ne)=>{const[le,ge]=ne.split(":").map(Number),Ce=le*60+ge;if(!tt)return ne;const[$e,Ie]=tt.split(":").map(Number),Ye=$e*60+Ie;return Math.abs(Ce-Re)<Math.abs(Ye-Re)?ne:tt},null);k.value=et||_.value[0]||""}}if(R.duration){const W=R.duration;W===15?$.value=15:W===30?$.value=30:W===60?$.value=60:($.value=null,d.value=String(W))}}}De(g,R=>{if(!R)return;const B=w[R];if(B&&(B===15?$.value=15:B===30?$.value=30:B===60?$.value=60:($.value=null,d.value=String(B)),!f.value)){const oe=new Date;oe.setHours(0,0,0,0),f.value=oe,h.value=oe.getMonth(),y.value=oe.getFullYear()}}),De(f,()=>{k.value=""}),De(()=>m.opportunity.assignee,R=>{var X,W,se;if(!R||u.value||x.value)return;const B=(X=H.value)==null?void 0:X.find(ie=>ie.name===R),oe=(W=ae.value)==null?void 0:W.find(ie=>ie.name===R);if(B){const ie=(se=ae.value)==null?void 0:se.find(Se=>Se.name===B.team||Se.id===B.teamId);ie&&(u.value=ie,x.value=B)}else oe&&(u.value=oe)},{immediate:!0}),ks(()=>{m.mode==="reschedule"&&m.initialAppointment&&Ae(m.initialAppointment)});function Te(){fe.value&&p("submit",{eventType:g.value,selectedDate:f.value,selectedSlot:k.value,selectedTeam:u.value,selectedSalesman:x.value,durationValue:F.value,communicationPreferences:b.value})}return V({resetForm:We}),(R,B)=>{var oe;return v(),C("div",Fd,[e("div",Ud,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...B[3]||(B[3]=[T("Event type ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:g.value,"onUpdate:modelValue":B[0]||(B[0]=X=>g.value=X),items:E.value,placeholder:"Select event type...","value-key":"value",class:"w-full"},{item:r(({item:X})=>[e("span",null,I(X.label),1)]),_:1},8,["modelValue","items"])]),g.value?(v(),C("div",Ed,[B[7]||(B[7]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign appointment to",-1)),e("div",Rd,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...B[4]||(B[4]=[T("Team",-1)])]),_:1}),s(t(Je),{modelValue:Ne.value,"onUpdate:modelValue":B[1]||(B[1]=X=>Ne.value=X),items:Q.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:X})=>[e("div",jd,[e("span",Bd,I(X.dealership||"No location"),1),B[5]||(B[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Wd,I(X.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...B[6]||(B[6]=[T("Salesperson (optional)",-1)])]),_:1}),s(t(Je),{modelValue:ce.value,"onUpdate:modelValue":B[2]||(B[2]=X=>ce.value=X),items:we.value,disabled:!u.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:X})=>[e("div",Pd,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",re(X.role)])},I(K(X.name)),3),e("span",zd,I(X.name),1)])]),_:1},8,["modelValue","items","disabled"])])])])):L("",!0),g.value&&u.value?(v(),C("div",Yd,[B[10]||(B[10]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},[T("Schedule "),e("span",{class:"text-red-600"},"*")],-1)),e("div",Hd,[e("div",Qd,[e("div",Jd,[e("div",Gd,[e("button",{type:"button",onClick:Xe,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...B[8]||(B[8]=[e("i",{class:"fa-solid fa-chevron-left text-sm text-body"},null,-1)])]),e("h6",Zd,I(D.value),1),e("button",{type:"button",onClick:P,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors cursor-pointer"},[...B[9]||(B[9]=[e("i",{class:"fa-solid fa-chevron-right text-sm text-body"},null,-1)])])]),e("div",Kd,[(v(),C(qe,null,ze(q,X=>e("div",{key:X,class:"text-center text-xs font-semibold text-sub py-1"},I(X),1)),64))]),e("div",Xd,[(v(!0),C(qe,null,ze(M.value,(X,W)=>(v(),C("div",{key:W,onClick:se=>X&&ke(X),class:Z(["aspect-square flex items-center justify-center text-sm font-medium rounded-lg transition-all",Oe(X)?"bg-primary text-white cursor-pointer":X?"text-body hover:bg-surfaceSecondary cursor-pointer":"text-transparent"])},I(X),11,ec))),128))])]),e("div",tc,[e("h6",sc,I(j.value),1),f.value&&te.value.length>0?(v(),C("div",nc,[(v(!0),C(qe,null,ze(te.value,X=>(v(),C("button",{key:X,type:"button",onClick:W=>k.value=X,class:Z(["w-full py-2 px-4 border-2 rounded-lg text-sm font-medium transition-all cursor-pointer",k.value===X?"border-primary bg-surfaceSecondary text-heading":"border-black/5 text-body hover:border-primary/30"])},I(X),11,ac))),128))])):f.value&&te.value.length===0?(v(),C("div",lc," No available time slots for this date ")):(v(),C("div",oc," Select a date to see available time slots "))])])])])):L("",!0),g.value&&u.value?(v(),pe(Kn,{key:2,appointment:{type:g.value,date:f.value,time:k.value,duration:F.value},customer:l.opportunity.customer,salesperson:x.value,team:u.value,dealership:(oe=u.value)!=null&&oe.dealership?{name:u.value.dealership}:null,onUpdate:Be},null,8,["appointment","customer","salesperson","team","dealership"])):L("",!0),e("div",ic,[s(t(Y),{variant:"secondary",onClick:Ee},{default:r(()=>[...B[11]||(B[11]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!fe.value,onClick:Te,class:"bg-primary"},{default:r(()=>[T(I(ye.value),1)]),_:1},8,["disabled"])])])}}},rc={class:"space-y-4"},uc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},dc={class:"text-sm text-body"},cc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},mc={class:"grid grid-cols-2 gap-4"},pc={class:"flex items-center gap-2"},vc={class:"text-sub"},fc={class:"font-medium text-heading"},yc={class:"flex items-center gap-2"},gc={class:"font-medium text-heading"},bc={class:"mt-4"},hc={__name:"NS1Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=_t(),g=Tt(),f=Lt(),k=A(null),u=A(null),x=A(""),$=S(()=>c.assignableUsers),d=S(()=>c.assignableTeams),h=S(()=>d.value.map(q=>({...q,label:`${q.dealership||"No location"} → ${q.name}`,value:q.id}))),y=S(()=>{var M;if(!k.value)return[];const q=k.value;return(((M=$.value)==null?void 0:M.filter(j=>j.team===q.name||j.teamId===q.id))||[]).map(j=>({...j,label:j.name,value:j.id}))}),b=S({get:()=>{var q;return((q=k.value)==null?void 0:q.id)||null},set:q=>{var M;if(!q){k.value=null;return}const D=(M=d.value)==null?void 0:M.find(j=>j.id===q);k.value=D||null,D&&(u.value=null)}}),N=S({get:()=>{var q;return((q=u.value)==null?void 0:q.id)||null},set:q=>{if(!q){u.value=null;return}const D=y.value.find(M=>M.id===q);u.value=D||null}}),w=q=>q?q.split(" ").map(D=>D[0]).join("").toUpperCase().substring(0,2):"?",E=q=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[q]||"bg-surfaceSecondary text-body",_=S(()=>!!k.value);async function F(){var M,j,H;if(!_.value)return;const q=((M=u.value)==null?void 0:M.name)||((j=k.value)==null?void 0:j.name),D={assignee:q};x.value&&(D.assignmentNote=x.value),await f.updateOpportunity(m.opportunity.id,D),await f.addActivity(m.opportunity.id,{type:"assignment",user:((H=g.currentUser)==null?void 0:H.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${q}${x.value?` with note: ${x.value}`:""}`,timestamp:new Date().toISOString()}),p("assigned",{opportunity:m.opportunity,assignee:q,note:x.value})}V({canSubmit:_,submit:F});const ye=S(()=>"Follow up with customer to understand the situation and book another appointment."),fe=S(()=>{var D;return(D=m.scheduledAppointment)!=null&&D.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ks(()=>{var q,D,M;if(m.opportunity.assignee&&!k.value&&!u.value){const j=(q=$.value)==null?void 0:q.find(ae=>ae.name===m.opportunity.assignee),H=(D=d.value)==null?void 0:D.find(ae=>ae.name===m.opportunity.assignee);if(j){const ae=(M=d.value)==null?void 0:M.find(Q=>Q.name===j.team||Q.id===j.teamId);ae&&(k.value=ae,u.value=j)}else H&&(k.value=H)}m.opportunity.assignmentNote&&(x.value=m.opportunity.assignmentNote)}),De(()=>m.opportunity.assignee,q=>{var D,M,j;if(q&&!k.value&&!u.value){const H=(D=$.value)==null?void 0:D.find(Q=>Q.name===q),ae=(M=d.value)==null?void 0:M.find(Q=>Q.name===q);if(H){const Q=(j=d.value)==null?void 0:j.find(we=>we.name===H.team||we.id===H.teamId);Q&&(k.value=Q,u.value=H)}else ae&&(k.value=ae)}}),(q,D)=>(v(),C("div",rc,[e("div",uc,[D[3]||(D[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"1st No-Show Follow-up Task",-1)),e("p",dc," Appointment was scheduled for "+I(fe.value)+" but customer did not show up. "+I(ye.value),1)]),e("div",cc,[D[8]||(D[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",mc,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[4]||(D[4]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:b.value,"onUpdate:modelValue":D[0]||(D[0]=M=>b.value=M),items:h.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",pc,[e("span",vc,I(M.dealership||"No location"),1),D[5]||(D[5]=e("span",{class:"text-sub"},"→",-1)),e("span",fc,I(M.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[6]||(D[6]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Je),{modelValue:N.value,"onUpdate:modelValue":D[1]||(D[1]=M=>N.value=M),items:y.value,disabled:!k.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",yc,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",E(M.role)])},I(w(M.name)),3),e("span",gc,I(M.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",bc,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[7]||(D[7]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:x.value,"onUpdate:modelValue":D[2]||(D[2]=M=>x.value=M),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},xc={class:"space-y-4"},wc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},kc={class:"text-sm text-body"},Sc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Cc={class:"grid grid-cols-2 gap-4"},$c={class:"flex items-center gap-2"},Dc={class:"text-sub"},Ac={class:"font-medium text-heading"},Tc={class:"flex items-center gap-2"},Oc={class:"font-medium text-heading"},Ic={class:"mt-4"},Nc={__name:"NS2Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["assigned","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=_t(),g=Tt(),f=Lt(),k=A(null),u=A(null),x=A(""),$=S(()=>c.assignableUsers),d=S(()=>c.assignableTeams),h=S(()=>d.value.map(q=>({...q,label:`${q.dealership||"No location"} → ${q.name}`,value:q.id}))),y=S(()=>{var M;if(!k.value)return[];const q=k.value;return(((M=$.value)==null?void 0:M.filter(j=>j.team===q.name||j.teamId===q.id))||[]).map(j=>({...j,label:j.name,value:j.id}))}),b=S({get:()=>{var q;return((q=k.value)==null?void 0:q.id)||null},set:q=>{var M;if(!q){k.value=null;return}const D=(M=d.value)==null?void 0:M.find(j=>j.id===q);k.value=D||null,D&&(u.value=null)}}),N=S({get:()=>{var q;return((q=u.value)==null?void 0:q.id)||null},set:q=>{if(!q){u.value=null;return}const D=y.value.find(M=>M.id===q);u.value=D||null}}),w=q=>q?q.split(" ").map(D=>D[0]).join("").toUpperCase().substring(0,2):"?",E=q=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[q]||"bg-surfaceSecondary text-body",_=S(()=>!!k.value);async function F(){var M,j,H;if(!_.value)return;const q=((M=u.value)==null?void 0:M.name)||((j=k.value)==null?void 0:j.name),D={assignee:q};x.value&&(D.assignmentNote=x.value),await f.updateOpportunity(m.opportunity.id,D),await f.addActivity(m.opportunity.id,{type:"assignment",user:((H=g.currentUser)==null?void 0:H.name)||"You",action:"assigned opportunity",content:`Opportunity assigned to ${q}${x.value?` with note: ${x.value}`:""}`,timestamp:new Date().toISOString()}),p("assigned",{opportunity:m.opportunity,assignee:q,note:x.value})}V({canSubmit:_,submit:F});const ye=S(()=>"This is the second no-show. Please make every effort to reach the customer and reschedule."),fe=S(()=>{var D;return(D=m.scheduledAppointment)!=null&&D.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"});return ks(()=>{var q,D,M;if(m.opportunity.assignee&&!k.value&&!u.value){const j=(q=$.value)==null?void 0:q.find(ae=>ae.name===m.opportunity.assignee),H=(D=d.value)==null?void 0:D.find(ae=>ae.name===m.opportunity.assignee);if(j){const ae=(M=d.value)==null?void 0:M.find(Q=>Q.name===j.team||Q.id===j.teamId);ae&&(k.value=ae,u.value=j)}else H&&(k.value=H)}m.opportunity.assignmentNote&&(x.value=m.opportunity.assignmentNote)}),De(()=>m.opportunity.assignee,q=>{var D,M,j;if(q&&!k.value&&!u.value){const H=(D=$.value)==null?void 0:D.find(Q=>Q.name===q),ae=(M=d.value)==null?void 0:M.find(Q=>Q.name===q);if(H){const Q=(j=d.value)==null?void 0:j.find(we=>we.name===H.team||we.id===H.teamId);Q&&(k.value=Q,u.value=H)}else ae&&(k.value=ae)}}),(q,D)=>(v(),C("div",xc,[e("div",wc,[D[3]||(D[3]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"2nd No-Show Follow-up Task",-1)),e("p",kc," Appointment was scheduled for "+I(fe.value)+" but customer did not show up. "+I(ye.value),1)]),e("div",Sc,[D[8]||(D[8]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Assign to",-1)),e("div",Cc,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[4]||(D[4]=[T("Team ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(Je),{modelValue:b.value,"onUpdate:modelValue":D[0]||(D[0]=M=>b.value=M),items:h.value,placeholder:"Search and select team...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",$c,[e("span",Dc,I(M.dealership||"No location"),1),D[5]||(D[5]=e("span",{class:"text-sub"},"→",-1)),e("span",Ac,I(M.name),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[6]||(D[6]=[T("Salesperson ",-1),e("span",{class:"text-sub text-xs"},"(optional)",-1)])]),_:1}),s(t(Je),{modelValue:N.value,"onUpdate:modelValue":D[1]||(D[1]=M=>N.value=M),items:y.value,disabled:!k.value,placeholder:"Search and select salesperson...","value-key":"id",class:"w-full"},{item:r(({item:M})=>[e("div",Tc,[e("div",{class:Z(["w-6 h-6 rounded-full flex items-center justify-center font-semibold text-sm shrink-0",E(M.role)])},I(w(M.name)),3),e("span",Oc,I(M.name),1)])]),_:1},8,["modelValue","items","disabled"])])]),e("div",Ic,[s(t(J),{class:"block text-sm font-medium text-body mb-1.5"},{default:r(()=>[...D[7]||(D[7]=[T("Notes for assignee",-1)])]),_:1}),s(t(lt),{modelValue:x.value,"onUpdate:modelValue":D[2]||(D[2]=M=>x.value=M),rows:"4",class:"w-full",placeholder:"Add any notes or instructions for the assignee..."},null,8,["modelValue"])])])]))}},Vc={class:"space-y-4"},Mc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},qc={class:"text-sm text-body"},Lc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},_c={__name:"NS3Task",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["close-as-lost","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=A(null),g=S(()=>"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed."),f=S(()=>{var d;return(d=m.scheduledAppointment)!=null&&d.start?new Date(m.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),k=S(()=>{var $;return(($=c.value)==null?void 0:$.canSubmit)||!1});function u(){var $;($=c.value)==null||$.submit()}function x($){p("close-as-lost",{opportunity:m.opportunity,reason:$})}return V({canSubmit:k,submit:u}),($,d)=>(v(),C("div",Vc,[e("div",Mc,[d[0]||(d[0]=e("h4",{class:"font-bold text-heading text-sm mb-1"},"3rd No-Show Follow-up Task",-1)),e("p",qc," Appointment was scheduled for "+I(f.value)+" but customer did not show up. "+I(g.value),1)]),e("div",Lc,[d[1]||(d[1]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Close Opportunity as Lost",-1)),s($n,{ref_key:"closeFormRef",ref:c,"show-multiple-no-shows":!0,"preselected-reason":"Multiple no shows","close-button-label":"Close as Lost",onClose:x},null,512)])]))}},Fc={class:"space-y-4"},Uc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ec={__name:"OfferAssignmentTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["offer-created","cancel"],setup(l,{expose:V,emit:o}){const m=l,p=o,c=A(null),g=S(()=>m.opportunity.requestedCar||m.opportunity.vehicle||null),f=S(()=>{var x;return((x=c.value)==null?void 0:x.isValid)||!1});function k(){var x;(x=c.value)==null||x.submit()}function u(x){p("offer-created",{opportunity:m.opportunity,offerData:x})}return V({canSubmit:f,submit:k}),(x,$)=>(v(),C("div",Fc,[$[0]||($[0]=e("div",{class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},[e("h4",{class:"font-bold text-heading text-sm mb-1"},"Create Offer"),e("p",{class:"text-sm text-body"}," Customer showed up for the appointment. Create an offer to proceed with the opportunity. ")],-1)),e("div",Uc,[s(Es,{item:null,"task-type":"opportunity","task-id":l.opportunity.id,"selected-vehicle":g.value,customer:l.opportunity.customer,"hide-header":!0,"hide-actions":!0,ref_key:"offerWidgetRef",ref:c,onSave:u},null,8,["task-id","selected-vehicle","customer"])])]))}},Rc={class:"space-y-6"},jc={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Bc={class:"space-y-6"},Wc={class:"space-y-2"},Pc=["value"],zc={class:"text-sm text-heading"},Yc={class:"space-y-2"},Hc=["value"],Qc={class:"text-sm text-heading"},Jc={key:0},Gc={class:"space-y-2"},Zc=["value"],Kc={class:"text-sm text-heading"},Xc={class:"flex items-center gap-2"},em=["onClick"],tm={key:0,class:"text-sm text-body ml-2"},sm={class:"space-y-2"},nm=["value"],am={class:"text-sm text-heading"},lm={class:"flex items-center gap-2 mt-2"},om={class:"space-y-2"},im=["value"],rm={class:"text-sm text-heading"},um={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},dm={class:"space-y-4"},cm={class:"flex items-center gap-3"},mm={class:"flex items-center gap-3"},pm={class:"flex items-center gap-3"},vm={class:"flex items-center gap-3"},fm={__name:"PostDeliverySurvey",props:{opportunity:{type:Object,required:!0}},emits:["submit","cancel"],setup(l,{expose:V,emit:o}){const m=o,p=A({q1:"",q2:"",q3:"",q4:"",q5:null,q6:[],q6Other:!1,q6OtherText:"",q7:"",q8:""}),c=A({negativeSatisfaction:!1,issuesReported:!1,deliveryDelay:!1,highNPS:!1}),g=[{value:"very-satisfied",label:"Very Satisfied"},{value:"satisfied",label:"Satisfied"},{value:"neutral",label:"Neutral"},{value:"unsatisfied",label:"Unsatisfied"},{value:"very-unsatisfied",label:"Very Unsatisfied"}],f=[{value:"perfect",label:"Yes, perfect condition"},{value:"acceptable",label:"Yes, acceptable"},{value:"minor-issues",label:"There are minor issues"},{value:"major-issues",label:"There are major issues"}],k=[{value:"on-time",label:"Yes, on time"},{value:"early",label:"Yes, early"},{value:"delayed-minor",label:"No, delayed (minor - 1-3 days)"},{value:"delayed-major",label:"No, delayed (major - more than 3 days)"}],u=[{value:"keys",label:"Vehicle keys"},{value:"manual",label:"Owner's manual"},{value:"registration",label:"Registration documents"},{value:"warranty",label:"Service warranty information"},{value:"insurance",label:"Insurance documents"}],x=[{value:"definitely-yes",label:"Definitely Yes"},{value:"probably-yes",label:"Probably Yes"},{value:"not-sure",label:"Not Sure"},{value:"probably-not",label:"Probably Not"},{value:"definitely-not",label:"Definitely Not"}],$=S(()=>p.value.q2==="minor-issues"||p.value.q2==="major-issues");De(()=>p.value.q1,y=>{y==="very-unsatisfied"||y==="unsatisfied"?c.value.negativeSatisfaction=!0:c.value.negativeSatisfaction=!1}),De(()=>p.value.q3,y=>{y&&y.trim().length>0?c.value.issuesReported=!0:c.value.issuesReported=!1}),De(()=>p.value.q4,y=>{y==="delayed-major"?c.value.deliveryDelay=!0:c.value.deliveryDelay=!1}),De(()=>p.value.q7,y=>{y==="definitely-yes"?c.value.highNPS=!0:c.value.highNPS=!1});const d=S(()=>{var N,w;if(!p.value.q1||!p.value.q2||$.value&&!((N=p.value.q3)!=null&&N.trim()))return!1;const y=p.value.q6&&p.value.q6.length>0,b=p.value.q6Other&&((w=p.value.q6OtherText)==null?void 0:w.trim());return!(!y&&!b)});return V({submit:()=>{if(!d.value)return;const y={responses:{...p.value},triggerActions:{...c.value},timestamp:new Date().toISOString()};m("submit",y)},isValid:d}),(y,b)=>(v(),C("div",Rc,[e("div",jc,[b[22]||(b[22]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Post-Delivery Customer Satisfaction Survey",-1)),e("div",Bc,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[13]||(b[13]=[T(" How satisfied are you with your new vehicle delivery experience? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Wc,[(v(),C(qe,null,ze(g,N=>e("label",{key:N.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",p.value.q1===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":b[0]||(b[0]=w=>p.value.q1=w),type:"radio",value:N.value,class:"shrink-0"},null,8,Pc),[[vt,p.value.q1]]),e("span",zc,I(N.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[14]||(b[14]=[T(" Is the vehicle in the condition you expected? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",Yc,[(v(),C(qe,null,ze(f,N=>e("label",{key:N.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",p.value.q2===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":b[1]||(b[1]=w=>p.value.q2=w),type:"radio",value:N.value,class:"shrink-0"},null,8,Hc),[[vt,p.value.q2]]),e("span",Qc,I(N.label),1)],2)),64))])]),$.value?(v(),C("div",Jc,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[15]||(b[15]=[T(" Please describe the issues you found: ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(lt),{modelValue:p.value.q3,"onUpdate:modelValue":b[2]||(b[2]=N=>p.value.q3=N),rows:"4",placeholder:"Describe the issues...",class:"w-full"},null,8,["modelValue"])])):L("",!0),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[16]||(b[16]=[T(" Was the vehicle delivered on the scheduled date? ",-1)])]),_:1}),e("div",Gc,[(v(),C(qe,null,ze(k,N=>e("label",{key:N.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",p.value.q4===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":b[3]||(b[3]=w=>p.value.q4=w),type:"radio",value:N.value,class:"shrink-0"},null,8,Zc),[[vt,p.value.q4]]),e("span",Kc,I(N.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[17]||(b[17]=[T(" How would you rate the professionalism of our sales team during delivery? ",-1)])]),_:1}),e("div",Xc,[(v(),C(qe,null,ze(5,N=>e("button",{key:N,onClick:w=>p.value.q5=N,class:Z(["text-2xl transition-colors",p.value.q5>=N?"text-yellow-500":"text-gray-300"])}," ⭐ ",10,em)),64)),p.value.q5?(v(),C("span",tm,I(p.value.q5)+" "+I(p.value.q5===1?"star":"stars"),1)):L("",!0)])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[18]||(b[18]=[T(" Did you receive all the required items? ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),e("div",sm,[(v(),C(qe,null,ze(u,N=>e("label",{key:N.value,class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors"},[Ke(e("input",{"onUpdate:modelValue":b[4]||(b[4]=w=>p.value.q6=w),type:"checkbox",value:N.value,class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,8,nm),[[bn,p.value.q6]]),e("span",am,I(N.label),1)])),64)),e("div",lm,[Ke(e("input",{"onUpdate:modelValue":b[5]||(b[5]=N=>p.value.q6Other=N),type:"checkbox",class:"w-4 h-4 focus:ring-brand-blue border-gray-300 rounded",style:{"accent-color":"var(--brand-blue)"}},null,512),[[bn,p.value.q6Other]]),b[19]||(b[19]=e("span",{class:"text-sm text-heading"},"Other:",-1)),p.value.q6Other?(v(),pe(t(at),{key:0,modelValue:p.value.q6OtherText,"onUpdate:modelValue":b[6]||(b[6]=N=>p.value.q6OtherText=N),placeholder:"Specify other item",class:"flex-1"},null,8,["modelValue"])):L("",!0)])])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[20]||(b[20]=[T(" Would you recommend our dealership to friends and family? ",-1)])]),_:1}),e("div",om,[(v(),C(qe,null,ze(x,N=>e("label",{key:N.value,class:Z(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",p.value.q7===N.value?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-black/5 hover:bg-surfaceSecondary/50"])},[Ke(e("input",{"onUpdate:modelValue":b[7]||(b[7]=w=>p.value.q7=w),type:"radio",value:N.value,class:"shrink-0"},null,8,im),[[vt,p.value.q7]]),e("span",rm,I(N.label),1)],2)),64))])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...b[21]||(b[21]=[T(" Internal notes for follow-up actions: ",-1),e("span",{class:"text-xs text-sub ml-1"},"(Private - only for internal staff)",-1)])]),_:1}),s(t(lt),{modelValue:p.value.q8,"onUpdate:modelValue":b[8]||(b[8]=N=>p.value.q8=N),rows:"4",placeholder:"Add internal notes...",class:"w-full"},null,8,["modelValue"])])])]),e("div",um,[b[31]||(b[31]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Trigger Actions (Email Notifications)",-1)),e("div",dm,[e("div",cm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-negative-satisfaction",modelValue:c.value.negativeSatisfaction,"onUpdate:modelValue":b[9]||(b[9]=N=>c.value.negativeSatisfaction=N)},null,8,["modelValue"]),b[23]||(b[23]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Sales Manager + Branch Manager ",-1))]),_:1}),b[24]||(b[24]=e("span",{class:"text-xs text-sub"},"(Q1 = Very Unsatisfied/Unsatisfied)",-1))]),e("div",mm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-issues",modelValue:c.value.issuesReported,"onUpdate:modelValue":b[10]||(b[10]=N=>c.value.issuesReported=N)},null,8,["modelValue"]),b[25]||(b[25]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Service Department ",-1))]),_:1}),b[26]||(b[26]=e("span",{class:"text-xs text-sub"},"(Q3 = Issues reported)",-1))]),e("div",pm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-delay",modelValue:c.value.deliveryDelay,"onUpdate:modelValue":b[11]||(b[11]=N=>c.value.deliveryDelay=N)},null,8,["modelValue"]),b[27]||(b[27]=e("span",{class:"text-sm font-medium text-heading"}," ⚠️ Email to Delivery Coordinator ",-1))]),_:1}),b[28]||(b[28]=e("span",{class:"text-xs text-sub"},"(Q4 = Delayed major)",-1))]),e("div",vm,[s(t(J),{class:"flex items-center gap-2 cursor-pointer py-1 px-2 rounded-lg hover:bg-surfaceSecondary/50 transition-colors flex-1"},{default:r(()=>[s(t(jt),{id:"trigger-nps",modelValue:c.value.highNPS,"onUpdate:modelValue":b[12]||(b[12]=N=>c.value.highNPS=N)},null,8,["modelValue"]),b[29]||(b[29]=e("span",{class:"text-sm font-medium text-heading"}," ✅ Email to Marketing ",-1))]),_:1}),b[30]||(b[30]=e("span",{class:"text-xs text-sub"},"(Q7 = Definitely Yes)",-1))])])])]))}},ym={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},gm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},bm={class:"p-4"},hm={class:"mb-3"},xm={class:"text-sm text-body mt-0.5"},wm={class:"flex flex-wrap gap-3 items-center"},km={key:0,class:"mt-4"},Sm={key:0,class:"mt-4"},Cm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},$m={key:0,class:"mt-4"},Dm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Am={key:2,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Tm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Om={class:"p-4"},Im={class:"mb-3"},Nm={class:"text-sm text-body mt-0.5"},Vm={class:"mb-4"},Mm={class:"flex flex-wrap gap-3 items-center"},qm={key:0,class:"mt-4 space-y-4"},Lm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},_m={class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},Fm={key:0,class:"space-y-3"},Um={class:"flex items-center justify-between gap-2"},Em={class:"text-sub text-xs"},Rm={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},jm={key:0,class:"mt-4"},Bm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Wm={key:1,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},Pm={key:3,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},zm={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ym={class:"p-4"},Hm={class:"flex flex-wrap gap-3 items-center"},Qm={key:0,class:"mt-4 px-4 pb-4"},Jm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Gm={class:"space-y-4"},Zm={class:"flex justify-end gap-2 mt-4"},Km={key:0,class:"mt-4"},Xm={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},ep={key:0,class:"flex justify-end gap-2 px-4 pb-4 pt-3"},tp={key:0,class:"mt-4 px-4 pb-4"},sp={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},np={class:"space-y-4"},ap={class:"flex justify-end gap-2 mt-4"},lp={key:0,class:"mt-4 px-4 pb-4"},op={key:0,class:"space-y-4"},ip={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},rp={class:"flex items-start gap-3"},up={class:"flex-1"},dp={class:"text-sm text-body whitespace-pre-wrap"},cp={class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},mp={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},pp={class:"p-4"},vp={class:"flex items-center gap-2 mb-3"},fp={class:"text-sm text-body font-medium"},yp={class:"px-4 py-4"},gp={key:1,class:"rounded-lg flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},bp={class:"bg-white rounded-lg shadow-nsc-card overflow-hidden",style:{"box-shadow":"var(--nsc-card-shadow)"}},hp={class:"p-4"},xp={class:"flex flex-wrap gap-3 items-center"},wp={class:"relative"},kp={key:0,class:"absolute top-full right-0 mt-2 z-50 dropdown-menu-small"},Sp={key:0,class:"mt-4 px-4 pb-4"},Cp={class:"flex justify-end gap-2 mt-4"},$p={key:2,class:"space-y-3"},Dp={class:"flex items-center gap-2 pb-2 border-b border"},Ap={class:"font-semibold text-heading text-fluid-sm"},Tp={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled","appointment-cancelled","appointment-no-show"],setup(l,{emit:V}){const o=l,m=V,p=Un(),c=Lt();_t();const g=Tt(),{t:f}=kn(),k=()=>{var i;const a=c.currentOpportunity;return a&&a.id===((i=o.opportunity)==null?void 0:i.id)?a:o.opportunity},u=S(()=>{var a;return o.scheduledAppointment||((a=o.opportunity)==null?void 0:a.scheduledAppointment)||null}),x=S(()=>{if(u.value&&u.value.start)return!1;const a=me.displayStage.value,i=a===Fs.QUALIFIED,U=a===Fs.AWAITING_APPOINTMENT;return(i||U)&&!me.isClosed.value});S(()=>!u.value||!u.value.start?!1:new Date(u.value.start)<new Date&&u.value.status!=="completed");const $=S(()=>{const a=o.opportunity,i=me.displayStage.value;return a.stage==="Closed Won"||i==="Closed Won"}),d=S(()=>{const a=o.opportunity,i=me.displayStage.value;return a.stage==="Closed Lost"||i==="Closed Lost"?!1:$.value}),h=Jn(),{isCallActive:y,callEnded:b,callDuration:N,callNotes:w,mockTranscription:E,formattedCallDuration:_,startCall:F,endCall:ye,copyNumber:fe}=h,q=()=>{F()},D=()=>{ye()},M=()=>{var a;fe(((a=o.opportunity.customer)==null?void 0:a.phone)||"")},j=a=>{w.value=a},H=()=>{h.callData.value={channel:"external",notes:"",transcription:null}},ae=A(null),Q=()=>{K.value=!1},we=()=>{var a;(a=ae.value)==null||a.resetForm()};async function Ne(a,i){var rs,us,Gt,ds,cs;const{eventType:U,selectedDate:de,selectedSlot:ve,selectedTeam:z,selectedSalesman:he,durationValue:je,communicationPreferences:Fe}=a,Me=o.opportunity,kt=de,[mn,Jt]=ve.split(":").map(Number),Dt=new Date(kt);Dt.setHours(mn,Jt,0,0);const Et=je||30,as=new Date(Dt.getTime()+Et*6e4),ls=(he==null?void 0:he.name)||(z==null?void 0:z.name)||Me.assignee||"Unassigned",os=(he==null?void 0:he.id)||(z==null?void 0:z.id)||null,is=he?"user":"team";try{if(i==="reschedule"){const qs={title:`Appointment - ${((rs=Me.customer)==null?void 0:rs.name)||"Customer"}`,start:Dt.toISOString(),end:as.toISOString(),type:U,assignee:ls,customerId:Me.customerId,opportunityId:Me.id,duration:Et,status:"pending_confirmation"};let Ls={...qs};if((us=u.value)!=null&&us.id){const{updateCalendarEvent:vn}=await Zt(async()=>{const{updateCalendarEvent:ea}=await import("./users-THux0QKI.js").then(ta=>ta.i);return{updateCalendarEvent:ea}},__vite__mapDeps([3,1,2]));await vn(u.value.id,{...qs,status:"pending_confirmation"}),Ls.id=u.value.id}else{const vn=await fn({...qs,status:"pending_confirmation"});Ls={...qs,id:vn.id,status:"pending_confirmation"}}await c.updateOpportunity(Me.id,{scheduledAppointment:Ls}),m("appointment-scheduled",Ls),K.value=!1;return}const pn={customerId:Me.customerId||((Gt=Me.customer)==null?void 0:Gt.id),customer:((ds=Me.customer)==null?void 0:ds.name)||"Unknown",start:Dt.toISOString(),end:as.toISOString(),type:U,title:`${U} - ${((cs=Me.customer)==null?void 0:cs.name)||"Customer"}`,assigneeId:os,assigneeType:is,teamId:(z==null?void 0:z.id)||null,team:(z==null?void 0:z.name)||null,salesperson:(he==null?void 0:he.name)||null,salespersonId:(he==null?void 0:he.id)||null,duration:Et,opportunityId:Me.id},Dn=await fn(pn),An={id:Dn.id,start:Dt.toISOString(),end:as.toISOString(),type:U,assignee:ls,assigneeId:os,assigneeType:is,duration:Et,team:(z==null?void 0:z.name)||null,teamId:(z==null?void 0:z.id)||null,salesperson:(he==null?void 0:he.name)||null,salespersonId:(he==null?void 0:he.id)||null,communications:Fe,status:"confirmed"};await c.updateOpportunity(Me.id,{scheduledAppointment:An}),m("appointment-scheduled",{...An,calendarEventId:Dn.id}),we()}catch(pn){console.error("Failed to schedule/reschedule appointment:",pn)}}async function ce(){if(u.value)try{const a={...u.value,status:"confirmed"};if(u.value.id){const{updateCalendarEvent:i}=await Zt(async()=>{const{updateCalendarEvent:U}=await import("./users-THux0QKI.js").then(de=>de.i);return{updateCalendarEvent:U}},__vite__mapDeps([3,1,2]));await i(u.value.id,{status:"confirmed"})}await c.updateOpportunity(o.opportunity.id,{scheduledAppointment:a}),m("appointment-scheduled",a)}catch(a){console.error("Failed to confirm appointment:",a)}}const te=A(!1),K=A(!1),re=A(!1),ke=A(!1),Oe=A(""),Xe=A(null),P=A(null),ee=A(null),Be=A(null),Ee=A(!1),We=A(!1),Ae=A(null),Te=A(""),R=A(null),B=A(null),oe=A(!1),X=A(null),W=A(!1),se=A(!1),ie=A(!1),Se=A(!1),ue=A(!1),Le=A(!1),xe=A({contractDate:"",contractTime:"",notes:""}),Ve=A({newDeadline:"",reason:""}),Re=A(null),et=A(null),tt=S(()=>[{key:"schedule-appointment",label:"Schedule Appointment",onClick:()=>{W.value=!1,te.value=!0}}]),ne=S(()=>[{key:"add-offer",label:"Add offer",handler:()=>en()},{key:"extend-deadline",label:"Extend deadline",handler:()=>nn()},{key:"close-as-lost",label:"Close as Lost",handler:()=>{ue.value=!0}},{key:"schedule-appointment",label:"Schedule appointment",handler:()=>ln()}]);function le(a){}const ge=S(()=>{var i;const a=((i=u.value)==null?void 0:i.noShowCount)||0;return a===0&&re.value?(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning 1 (first no-show)"),1):(console.log("[OpportunityManagementWidget] nsTaskCount computed: returning",a),a)});De([K,re,ke],([a,i,U])=>{console.log("[OpportunityManagementWidget] Section visibility changed:",{showRescheduleSection:a,showNsTaskSection:i,showOfferAssignmentSection:U,nsTaskCount:ge.value})});const Ce=S(()=>{var U;return((U={1:Xe,2:P,3:ee}[ge.value].value)==null?void 0:U.canSubmit)||!1}),$e=S(()=>ge.value===3?"Close as Lost":"Assign and Save"),Ie=S(()=>{var a;return((a=Be.value)==null?void 0:a.canSubmit)||!1}),Ye=S(()=>!opportunity.offers||opportunity.offers.length===0?[]:opportunity.offers.filter(a=>a.status==="active").map(a=>({id:a.id,label:`${a.vehicleBrand} ${a.vehicleModel} (${a.vehicleYear})`,price:a.price,value:a.id}))),ft=S(()=>Ae.value&&Te.value.trim().length>0),st=A(!1),dt=A(!1),wt=A(!1),ot=A(!1),Ct=A(!1),Ge=A(!1),it=A(!1),yt=A(!1),gt=A(!1),$t=A([]);function Ze(a){return a?new Intl.NumberFormat("en-US").format(a):"0"}function Ot(a){return a?new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const He={"schedule-appointment":()=>{te.value=!0},"manage-appointment":()=>{u.value&&(yt.value=!0)},"view-or-schedule-appointment":()=>{u.value?yt.value=!0:te.value=!0},reschedule:()=>{u.value&&(gt.value=!0)},"cancel-appointment":()=>{Xt()},"mark-no-show":()=>{Ms()},"select-vehicle":()=>{Ge.value=!0},"create-offer":()=>{!o.opportunity.selectedVehicle&&!o.opportunity.vehicle?Ge.value=!0:st.value=!0},"call-prospect":()=>{it.value=!0},"follow-up-offer":()=>{it.value=!0},"request-decision":()=>{it.value=!0},"finalize-contract":()=>{wt.value=!0},"schedule-delivery":()=>{ot.value=!0},"confirm-delivery":()=>{ot.value=!0},"collect-feedback":()=>{it.value=!0},reschedule:()=>{gt.value=!0},"cancel-appointment":()=>{Xt()},"close-won":()=>{wt.value=!0},"add-offer":()=>{st.value=!0},"add-contract":()=>{wt.value=!0},"extend-deadline":()=>{it.value=!0},"close-lost":()=>{dt.value=!0},reopen:()=>{Ft()},requalify:()=>{Ct.value=!0}},Ue=bd(vs(o,"opportunity"),u,vs(o,"activities"),He,Ot),me={isClosed:Ue.isClosed,primaryAction:S(()=>x.value||u.value&&u.value.start&&(me.displayStage.value===Fs.APPOINTMENT_SCHEDULED||me.displayStage.value===Fs.AWAITING_APPOINTMENT)?null:Ue.primaryAction.value),secondaryActions:Ue.secondaryActions,activeTaskWidget:S(()=>{if(x.value)return null;const a=Ue.activeTaskWidget.value;return a&&a.type==="NS"?null:a}),taskWidgetTitle:Ue.taskWidgetTitle,displayStage:S(()=>{var i;const a=ps(o.opportunity,"opportunity");return a||console.warn("No display stage calculated for opportunity:",(i=o.opportunity)==null?void 0:i.id),a}),showDeadlineBanner:S(()=>{var a;return!Ue.isClosed.value&&!!((a=o.opportunity)!=null&&a.nextActionDue)})},It=async a=>{var i;(i=o.opportunity)!=null&&i.id&&await c.fetchOpportunityById(o.opportunity.id)};function zt(){}function Pe(a){Ge.value=!1,m("vehicle-selected",a),setTimeout(()=>{st.value=!0},300)}function rt(a){st.value=!1,m("offer-created",a)}function Cs(a){te.value=!1,m("appointment-scheduled",{...a,opportunityId:o.opportunity.id,customer:o.opportunity.customer.name})}async function Xt(){if(u.value&&confirm("Are you sure you want to cancel this appointment?"))try{if(u.value.id){const{deleteCalendarEvent:a}=await Zt(async()=>{const{deleteCalendarEvent:i}=await import("./users-THux0QKI.js").then(U=>U.i);return{deleteCalendarEvent:i}},__vite__mapDeps([3,1,2]));await a(u.value.id)}await c.updateOpportunity(o.opportunity.id,{scheduledAppointment:null}),m("appointment-cancelled",u.value.id)}catch(a){console.error("Failed to cancel appointment:",a)}}function bt(a){wt.value=!1,c.updateOpportunity(o.opportunity.id,{stage:"Closed Won",contractDate:a.contractDate})}function ct(a){ot.value=!1,c.addActivity(o.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:a})}function ut(a){const i=typeof a=="string"?a:a.reason||a,U=typeof a=="object"?a.notes:"";dt.value=!1,Oe.value="",c.updateOpportunity(o.opportunity.id,{stage:"Closed Lost",lossReason:i,lossNotes:U})}function Ft(){c.updateOpportunity(o.opportunity.id,{stage:"Qualified"})}function _e(a){Ct.value=!1,p.push(`/customer/${a.id}?type=lead`)}function mt(a){yt.value=!1}function Rs(a){gt.value=!1}function js({opportunity:a,callbackDate:i}){c.updateOpportunity(a.id,{callbackDate:i})}function $s({opportunity:a,assignee:i,note:U}){console.log("Opportunity assigned:",{opportunity:a,assignee:i,note:U})}function es(){var U;(U={1:Xe,2:P,3:ee}[ge.value].value)==null||U.submit()}function Ut(){re.value=!1}async function Bs({opportunity:a,offerData:i}){var U,de,ve,z,he;try{if((U=u.value)!=null&&U.id){const{updateCalendarEvent:je}=await Zt(async()=>{const{updateCalendarEvent:Fe}=await import("./users-THux0QKI.js").then(Me=>Me.i);return{updateCalendarEvent:Fe}},__vite__mapDeps([3,1,2]));await je(u.value.id,{status:"completed"})}await c.addOffer(a.id,{vehicleBrand:((de=i.data)==null?void 0:de.brand)||"",vehicleModel:((ve=i.data)==null?void 0:ve.model)||"",vehicleYear:((z=i.data)==null?void 0:z.year)||"",price:((he=i.data)==null?void 0:he.price)||0,data:i.data}),ke.value=!1}catch(je){console.error("Failed to create offer:",je)}}function Ds(){var a;(a=Be.value)==null||a.submit()}function Yt(){ke.value=!1}function Ht(){console.log("[OpportunityManagementWidget] handleFollowUpOffer called"),K.value=!1,re.value=!1,ke.value=!1,We.value=!1,Ee.value=!Ee.value,Ee.value||(Ae.value=null,Te.value="",R.value=null)}function Qt(){console.log("[OpportunityManagementWidget] handleAddAnotherOffer called"),K.value=!1,re.value=!1,ke.value=!1,Ee.value=!1,We.value=!We.value}async function ts(a){var i;console.log("[OpportunityManagementWidget] handleOfferAccepted called",a);try{await c.markOfferAccepted(opportunity.id,a.id),await c.addActivity(opportunity.id,{type:"offer-acceptance",user:((i=g.currentUser)==null?void 0:i.name)||"You",action:"accepted offer",content:`Offer accepted: ${a.vehicleBrand} ${a.vehicleModel} (${a.vehicleYear}) - € ${a.price.toLocaleString()}`,data:{offerId:a.id},timestamp:new Date().toISOString()}),Ee.value=!1}catch(U){console.error("Failed to mark offer as accepted:",U)}}async function Ws(){var a,i;if(ft.value){console.log("[OpportunityManagementWidget] handleSendNegotiationMessage called",{channel:Ae.value,message:Te.value,offerId:R.value});try{const U=(a=opportunity.offers)==null?void 0:a.find(ve=>ve.id===R.value),de=U?`${U.vehicleBrand} ${U.vehicleModel} (€${U.price.toLocaleString()})`:"offer";await c.addActivity(opportunity.id,{type:Ae.value,user:((i=g.currentUser)==null?void 0:i.name)||"You",action:`sent ${Ae.value}`,content:Te.value,data:{channel:Ae.value,offerId:R.value,offerReference:de},timestamp:new Date().toISOString()}),Ee.value=!1,Ae.value=null,Te.value="",R.value=null}catch(U){console.error("Failed to send negotiation message:",U)}}}function Ps(){Ee.value=!1,Ae.value=null,Te.value="",R.value=null}const zs=S(()=>{var a;return((a=B.value)==null?void 0:a.isValid)||!1});async function nt(a){var i,U,de,ve,z,he,je,Fe,Me;console.log("[OpportunityManagementWidget] handleInlineOfferCreated called",a);try{await c.addOffer(opportunity.id,{vehicleBrand:((i=a.data)==null?void 0:i.brand)||"",vehicleModel:((U=a.data)==null?void 0:U.model)||"",vehicleYear:((de=a.data)==null?void 0:de.year)||"",price:((ve=a.data)==null?void 0:ve.price)||0,data:a.data}),await c.addActivity(opportunity.id,{type:"offer",user:((z=g.currentUser)==null?void 0:z.name)||"You",action:"created an offer",content:`Offer created: ${(he=a.data)==null?void 0:he.brand} ${(je=a.data)==null?void 0:je.model} (${(Fe=a.data)==null?void 0:Fe.year}) - € ${(((Me=a.data)==null?void 0:Me.price)||0).toLocaleString()}`,data:a.data,timestamp:new Date().toISOString()}),We.value=!1}catch(kt){console.error("Failed to create offer:",kt)}}function ht(){B.value&&B.value.submit()}function As(){We.value=!1,B.value}const Ys=S(()=>{var a;return((a=X.value)==null?void 0:a.isValid)||!1});async function Hs(a){var i,U,de,ve,z;console.log("[OpportunityManagementWidget] handleSurveySubmit called",a);try{const he=k(),{responses:je,triggerActions:Fe}=a;await c.addActivity(he.id,{type:"post-delivery-survey",user:((i=g.currentUser)==null?void 0:i.name)||"You",action:"completed post-delivery customer satisfaction survey",content:"Post-Delivery Customer Satisfaction Survey completed",data:{responses:je,triggerActions:Fe,timestamp:a.timestamp},timestamp:a.timestamp});const Me=[];Fe.negativeSatisfaction&&Me.push(c.addActivity(he.id,{type:"survey-trigger",user:((U=g.currentUser)==null?void 0:U.name)||"You",action:"triggered email notification",content:"Email sent to Sales Manager + Branch Manager (Negative satisfaction)",data:{trigger:"negative-satisfaction",recipients:["Sales Manager","Branch Manager"],surveyResponse:je.q1},timestamp:new Date().toISOString()})),Fe.issuesReported&&Me.push(c.addActivity(he.id,{type:"survey-trigger",user:((de=g.currentUser)==null?void 0:de.name)||"You",action:"triggered email notification",content:"Email sent to Service Department (Issues reported)",data:{trigger:"issues-reported",recipients:["Service Department"],issueDescription:je.q3},timestamp:new Date().toISOString()})),Fe.deliveryDelay&&Me.push(c.addActivity(he.id,{type:"survey-trigger",user:((ve=g.currentUser)==null?void 0:ve.name)||"You",action:"triggered email notification",content:"Email sent to Delivery Coordinator (Major delivery delay)",data:{trigger:"delivery-delay",recipients:["Delivery Coordinator"],surveyResponse:je.q4},timestamp:new Date().toISOString()})),Fe.highNPS&&Me.push(c.addActivity(he.id,{type:"survey-trigger",user:((z=g.currentUser)==null?void 0:z.name)||"You",action:"triggered email notification",content:"Email sent to Marketing (High NPS - Definitely Yes)",data:{trigger:"high-nps",recipients:["Marketing"],surveyResponse:je.q7},timestamp:new Date().toISOString()})),await Promise.all(Me),oe.value=!1}catch(he){console.error("Failed to submit survey:",he)}}function Qs(){X.value&&X.value.submit()}function Js(){oe.value=!1}const Gs=S(()=>new Date().toISOString().split("T")[0]),Zs=S(()=>{const a=new Date;return a.setDate(a.getDate()+1),a.toISOString().split("T")[0]}),Ts=S(()=>!!xe.value.contractDate),Os=S(()=>!!Ve.value.newDeadline),ss=S(()=>{var a;return((a=Re.value)==null?void 0:a.isValid)||!1});function Ks(){if(ie.value=!1,Se.value=!1,Le.value=!1,se.value=!se.value,se.value&&!xe.value.contractDate){const a=new Date;xe.value.contractDate=a.toISOString().split("T")[0],xe.value.contractTime=a.toTimeString().slice(0,5)}}function Is(){se.value=!1,xe.value={contractDate:"",contractTime:"",notes:""}}async function Xs(){var a;if(Ts.value)try{const i=k(),U=xe.value.contractTime?`${xe.value.contractDate}T${xe.value.contractTime}:00`:`${xe.value.contractDate}T12:00:00`;await c.updateOpportunity(i.id,{contractDate:U,contractNotes:xe.value.notes}),await c.addActivity(i.id,{type:"contract",user:((a=g.currentUser)==null?void 0:a.name)||"You",action:"set contract signing date",content:`Contract date set: ${new Date(U).toLocaleString()}`,data:{contractDate:U,notes:xe.value.notes},timestamp:new Date().toISOString()}),Is()}catch(i){console.error("Failed to set contract date:",i)}}function en(){se.value=!1,Se.value=!1,Le.value=!1,ie.value=!ie.value}function Ns(){ie.value=!1}function tn(){Re.value&&Re.value.submit()}async function sn(a){var i,U,de,ve,z,he,je,Fe,Me;try{const kt=k();await c.addOffer(kt.id,{vehicleBrand:((i=a.data)==null?void 0:i.brand)||"",vehicleModel:((U=a.data)==null?void 0:U.model)||"",vehicleYear:((de=a.data)==null?void 0:de.year)||"",price:((ve=a.data)==null?void 0:ve.price)||0,data:a.data}),await c.addActivity(kt.id,{type:"offer",user:((z=g.currentUser)==null?void 0:z.name)||"You",action:"created an offer",content:`Offer created: ${(he=a.data)==null?void 0:he.brand} ${(je=a.data)==null?void 0:je.model} (${(Fe=a.data)==null?void 0:Fe.year}) - € ${(((Me=a.data)==null?void 0:Me.price)||0).toLocaleString()}`,data:a.data,timestamp:new Date().toISOString()}),ie.value=!1}catch(kt){console.error("Failed to create offer:",kt)}}function nn(){if(se.value=!1,ie.value=!1,Le.value=!1,Se.value=!Se.value,Se.value&&!Ve.value.newDeadline){const a=new Date;a.setDate(a.getDate()+1),Ve.value.newDeadline=a.toISOString().split("T")[0]}}function Vs(){Se.value=!1,Ve.value={newDeadline:"",reason:""}}async function an(){var a;if(Os.value)try{const i=k();await c.updateOpportunity(i.id,{deadline:Ve.value.newDeadline,deadlineExtensionReason:Ve.value.reason}),await c.addActivity(i.id,{type:"deadline-extension",user:((a=g.currentUser)==null?void 0:a.name)||"You",action:"extended deadline",content:`Deadline extended to ${new Date(Ve.value.newDeadline).toLocaleDateString()}`,data:{newDeadline:Ve.value.newDeadline,reason:Ve.value.reason},timestamp:new Date().toISOString()}),Vs()}catch(i){console.error("Failed to extend deadline:",i)}}function ln(){se.value=!1,ie.value=!1,Se.value=!1,Le.value=!Le.value}function ns(){Le.value=!1}async function on(a){var is,rs,us;const{eventType:i,selectedDate:U,selectedSlot:de,selectedTeam:ve,selectedSalesman:z,durationValue:he,communicationPreferences:je}=a,Fe=k(),Me=U,[kt,mn]=de.split(":").map(Number),Jt=new Date(Me);Jt.setHours(kt,mn,0,0);const Dt=he||30,Et=new Date(Jt.getTime()+Dt*6e4),as=(z==null?void 0:z.name)||(ve==null?void 0:ve.name)||Fe.assignee||"Unassigned",ls=(z==null?void 0:z.id)||(ve==null?void 0:ve.id)||null,os=z?"user":"team";try{const Gt={customerId:Fe.customerId||((is=Fe.customer)==null?void 0:is.id),customer:((rs=Fe.customer)==null?void 0:rs.name)||"Unknown",start:Jt.toISOString(),end:Et.toISOString(),type:i,title:`${i} - ${((us=Fe.customer)==null?void 0:us.name)||"Customer"}`,assigneeId:ls,assigneeType:os,teamId:(ve==null?void 0:ve.id)||null,team:(ve==null?void 0:ve.name)||null,salesperson:(z==null?void 0:z.name)||null,salespersonId:(z==null?void 0:z.id)||null,duration:Dt,opportunityId:Fe.id},ds=await fn(Gt),cs={id:ds.id,start:Jt.toISOString(),end:Et.toISOString(),type:i,assignee:as,assigneeId:ls,assigneeType:os,duration:Dt,team:(ve==null?void 0:ve.name)||null,teamId:(ve==null?void 0:ve.id)||null,salesperson:(z==null?void 0:z.name)||null,salespersonId:(z==null?void 0:z.id)||null,communications:je,status:"confirmed"};await c.updateOpportunity(Fe.id,{scheduledAppointment:cs}),m("appointment-scheduled",{...cs,calendarEventId:ds.id}),ns()}catch(Gt){console.error("Failed to schedule appointment:",Gt)}}function rn(a){const i=typeof a=="string"?a:a.reason||a,U=typeof a=="object"?a.notes:"";ue.value=!1,c.updateOpportunity(o.opportunity.id,{stage:"Closed Lost",lossReason:i,lossNotes:U})}function un(){!u.value||!u.value.start||(K.value=!0,re.value=!1,ke.value=!1)}function Ms(){var a,i;if(console.log("[OpportunityManagementWidget] handleMarkNoShow called",{hasAppointment:!!u.value,appointmentStatus:(a=u.value)==null?void 0:a.status,noShowCount:(i=u.value)==null?void 0:i.noShowCount}),!u.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,ke.value=!1,re.value=!0,console.log("[OpportunityManagementWidget] Set showNsTaskSection to true"),u.value.status!=="no-show"&&(console.log("[OpportunityManagementWidget] Calling updateAppointmentToNoShow"),cn())}function dn(){var a;if(console.log("[OpportunityManagementWidget] handleMarkShowedUp called",{hasAppointment:!!u.value,appointmentStatus:(a=u.value)==null?void 0:a.status}),!u.value){console.log("[OpportunityManagementWidget] No scheduled appointment, returning");return}K.value=!1,re.value=!1,ke.value=!0,console.log("[OpportunityManagementWidget] Set showOfferAssignmentSection to true")}async function cn(){var a;if(u.value)try{const U=(u.value.noShowCount||0)+1,de=U===1?"NS1":U===2?"NS2":"NS3";if(u.value.id){const{updateCalendarEvent:z}=await Zt(async()=>{const{updateCalendarEvent:he}=await import("./users-THux0QKI.js").then(je=>je.i);return{updateCalendarEvent:he}},__vite__mapDeps([3,1,2]));await z(u.value.id,{status:"no-show"})}const ve={...u.value,status:"no-show",noShowCount:U};await c.updateOpportunity(o.opportunity.id,{scheduledAppointment:ve}),await c.addActivity(o.opportunity.id,{type:"ns-task",user:((a=g.currentUser)==null?void 0:a.name)||"You",action:`${de} - marked appointment as no-show`,content:`${de}: Appointment on ${new Date(u.value.start).toLocaleString()} marked as no-show. This is the ${U===1?"first":U===2?"second":"third"} no-show.`,data:{appointmentId:u.value.id,noShowCount:U,nsLabel:de},timestamp:new Date().toISOString()}),m("appointment-no-show",{appointmentId:u.value.id,noShowCount:U,nsLabel:de})}catch(i){console.error("Failed to mark appointment as no-show:",i)}}function O({opportunity:a,reason:i}){dt.value=!0}async function n({opportunity:a,reason:i}){var U;re.value=!1,await c.updateOpportunity(a.id,{stage:"Closed Lost",lossReason:i}),await c.addActivity(a.id,{type:"close-lost",user:((U=g.currentUser)==null?void 0:U.name)||"You",action:"closed opportunity as lost",content:`Opportunity closed as lost. Reason: ${i||"N/A"}`,data:{reason:i},timestamp:new Date().toISOString()})}function G(a){if(a&&a.handler)a.handler();else if(a&&a.key){const i=He[a.key];i&&i()}}return ks(async()=>{try{const i=(await La({})).data||[];$t.value=i.filter(U=>U.stockDays!==null&&U.stockDays!==void 0).slice(0,5)}catch(a){console.error("Failed to load recommended cars:",a),$t.value=[]}u.value&&u.value.status==="no-show"&&(re.value=!0)}),(a,i)=>{const U=En("click-outside");return v(),C(qe,null,[s(Yn,{task:l.opportunity,"hide-title":"","hide-border":""},{"deadline-banner":r(()=>[me.isClosed.value?L("",!0):(v(),pe(Zn,{key:0,"next-action-due":l.opportunity.nextActionDue,"show-deadline-banner":me.showDeadlineBanner.value,"task-id":l.opportunity.id},null,8,["next-action-due","show-deadline-banner","task-id"]))]),"primary-action":r(()=>{var de,ve;return[me.isClosed.value?L("",!0):(v(),pe(Qn,{key:0,task:l.opportunity,"task-type":"opportunity",onReassigned:It,class:"mb-3"},null,8,["task"])),!me.isClosed.value&&u.value&&u.value.start?(v(),C("div",ym,[e("div",gm,[e("div",bm,[e("div",hm,[i[30]||(i[30]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Appointment",-1)),e("p",xm," Appointment scheduled for "+I((de=u.value)!=null&&de.start?Ot(u.value.start):"TBD"),1)]),e("div",wm,[((ve=u.value)==null?void 0:ve.status)==="pending_confirmation"?(v(),pe(t(Y),{key:0,variant:"outline",onClick:ce,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700"},{default:r(()=>[...i[31]||(i[31]=[e("i",{class:"fa-solid fa-calendar-check"},null,-1),e("span",null,"Confirm appointment",-1)])]),_:1})):L("",!0),s(t(Y),{variant:"outline",onClick:un,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",K.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[32]||(i[32]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),e("span",null,"Reschedule",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:Ms,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",re.value?"border-orange-500 bg-orange-50 text-orange-700":""])},{default:r(()=>[...i[33]||(i[33]=[e("i",{class:"fa-solid fa-user-slash"},null,-1),e("span",null,"Mark as No-Show",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:dn,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",ke.value?"border-green-500 bg-green-50 text-green-700":""])},{default:r(()=>[...i[34]||(i[34]=[e("i",{class:"fa-solid fa-user-check"},null,-1),e("span",null,"Mark as Showed Up",-1)])]),_:1},8,["class"]),me.secondaryActions.value&&me.secondaryActions.value.length>0?(v(),pe(yn,{key:1,actions:me.secondaryActions.value,onActionSelected:G},null,8,["actions"])):L("",!0)])])]),s(pt,{name:"expand"},{default:r(()=>[K.value?(v(),C("div",km,[s(gn,{ref_key:"scheduleFormRef",ref:ae,opportunity:l.opportunity,mode:"reschedule","initial-appointment":u.value,onSubmit:i[0]||(i[0]=z=>Ne(z,"reschedule")),onCancel:Q},null,8,["opportunity","initial-appointment"])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[re.value?(v(),C("div",Sm,[ge.value===1?(v(),pe(hc,{key:0,ref_key:"ns1TaskRef",ref:Xe,opportunity:l.opportunity,"scheduled-appointment":u.value,onAssigned:$s,onCancel:Ut},null,8,["opportunity","scheduled-appointment"])):ge.value===2?(v(),pe(Nc,{key:1,ref_key:"ns2TaskRef",ref:P,opportunity:l.opportunity,"scheduled-appointment":u.value,onAssigned:$s,onCancel:Ut},null,8,["opportunity","scheduled-appointment"])):ge.value>=3?(v(),pe(_c,{key:2,ref_key:"ns3TaskRef",ref:ee,opportunity:l.opportunity,"scheduled-appointment":u.value,onCloseAsLost:n,onCancel:Ut},null,8,["opportunity","scheduled-appointment"])):L("",!0)])):L("",!0)]),_:1}),re.value?(v(),C("div",Cm,[s(t(Y),{variant:"secondary",onClick:Ut},{default:r(()=>[...i[35]||(i[35]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ce.value,onClick:es,class:"bg-primary"},{default:r(()=>[T(I($e.value),1)]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[ke.value?(v(),C("div",$m,[s(Ec,{ref_key:"offerAssignmentTaskRef",ref:Be,opportunity:l.opportunity,"scheduled-appointment":u.value,onOfferCreated:Bs,onCancel:Yt},null,8,["opportunity","scheduled-appointment"])])):L("",!0)]),_:1}),ke.value?(v(),C("div",Dm,[s(t(Y),{variant:"secondary",onClick:Yt},{default:r(()=>[...i[36]||(i[36]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ie.value,onClick:Ds,class:"bg-primary"},{default:r(()=>[...i[37]||(i[37]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0)])):L("",!0),!me.isClosed.value&&l.opportunity.stage==="In Negotiation"&&l.opportunity.negotiationSubstatus!=="Offer Accepted"&&l.opportunity.offers&&l.opportunity.offers.length>0?(v(),C("div",Am,[e("div",Tm,[e("div",Om,[e("div",Im,[i[38]||(i[38]=e("h4",{class:"font-bold text-heading text-sm"},"Manage Offers & Follow Up",-1)),e("p",Nm,I(l.opportunity.negotiationSubstatus==="Offer Feedback"?"Request feedback on pending offers":"Follow up with customer about offers"),1)]),e("div",Vm,[s(Xn,{offers:l.opportunity.offers,"opportunity-id":l.opportunity.id,onOfferAccepted:ts},null,8,["offers","opportunity-id"])]),e("div",Mm,[s(t(Y),{variant:"outline",onClick:Ht,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",Ee.value?"border-yellow-500 bg-yellow-50 text-yellow-700":""])},{default:r(()=>[i[39]||(i[39]=e("i",{class:"fa-solid fa-phone-volume"},null,-1)),e("span",null,I(l.opportunity.negotiationSubstatus==="Offer Feedback"?"Request Feedback":"Follow Up"),1)]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:Qt,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",We.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[40]||(i[40]=[e("i",{class:"fa-solid fa-plus"},null,-1),e("span",null,"Add Offer",-1)])]),_:1},8,["class"]),me.secondaryActions.value&&me.secondaryActions.value.length>0?(v(),pe(yn,{key:0,actions:me.secondaryActions.value,onActionSelected:G},null,8,["actions"])):L("",!0)])])]),s(pt,{name:"expand"},{default:r(()=>[Ee.value?(v(),C("div",qm,[e("div",Lm,[i[47]||(i[47]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Contact Customer",-1)),e("div",_m,[s(t(Y),{variant:"outline",onClick:i[1]||(i[1]=z=>Ae.value="call"),class:Z(["flex items-center justify-center gap-2",Ae.value==="call"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[41]||(i[41]=[e("i",{class:"fa-solid fa-phone text-xs"},null,-1),e("span",null,"Call",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[2]||(i[2]=z=>Ae.value="whatsapp"),class:Z(["flex items-center justify-center gap-2",Ae.value==="whatsapp"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[42]||(i[42]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[3]||(i[3]=z=>Ae.value="sms"),class:Z(["flex items-center justify-center gap-2",Ae.value==="sms"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[43]||(i[43]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])]),_:1},8,["class"]),s(t(Y),{variant:"outline",onClick:i[4]||(i[4]=z=>Ae.value="email"),class:Z(["flex items-center justify-center gap-2",Ae.value==="email"?"border-brand-blue bg-blue-50 text-brand-blue":""])},{default:r(()=>[...i[44]||(i[44]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])]),_:1},8,["class"])]),Ae.value?(v(),C("div",Fm,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[45]||(i[45]=[T("Select offer to reference",-1)])]),_:1}),s(t(Je),{modelValue:R.value,"onUpdate:modelValue":i[5]||(i[5]=z=>R.value=z),items:Ye.value,placeholder:"Select an offer...","value-key":"id",class:"w-full"},{item:r(({item:z})=>[e("div",Um,[e("span",null,I(z.label),1),e("span",Em,"€ "+I(Ze(z.price)),1)])]),_:1},8,["modelValue","items"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[46]||(i[46]=[T("Message",-1)])]),_:1}),s(t(lt),{modelValue:Te.value,"onUpdate:modelValue":i[6]||(i[6]=z=>Te.value=z),rows:"4",placeholder:"Type your message here...",class:"w-full"},null,8,["modelValue"])])])):L("",!0)])])):L("",!0)]),_:1}),Ee.value?(v(),C("div",Rm,[s(t(Y),{variant:"secondary",onClick:Ps},{default:r(()=>[...i[48]||(i[48]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!ft.value,onClick:Ws,class:"bg-primary"},{default:r(()=>[...i[49]||(i[49]=[T(" Send Message ",-1)])]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[We.value?(v(),C("div",jm,[e("div",Bm,[s(Es,{ref_key:"addOfferWidgetRef",ref:B,"task-id":l.opportunity.id,"task-type":"opportunity",customer:l.opportunity.customer,"selected-vehicle":l.opportunity.selectedVehicle||l.opportunity.vehicle||l.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:nt,onCancel:As},null,8,["task-id","customer","selected-vehicle"])])])):L("",!0)]),_:1}),We.value?(v(),C("div",Wm,[s(t(Y),{variant:"secondary",onClick:As},{default:r(()=>[...i[50]||(i[50]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!zs.value,onClick:ht,class:"bg-primary"},{default:r(()=>[...i[51]||(i[51]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0)])):L("",!0),!me.isClosed.value&&l.opportunity.stage==="In Negotiation"&&(l.opportunity.negotiationSubstatus==="Offer Accepted"||me.displayStage.value==="In Negotiation - Contract Pending")?(v(),C("div",Pm,[e("div",zm,[e("div",Ym,[i[53]||(i[53]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Collect e-signatures, finalize contract"),e("p",{class:"text-sm text-body mt-0.5"}," Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs. ")],-1)),e("div",Hm,[s(t(Y),{variant:"outline",onClick:Ks,class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",se.value?"border-emerald-500 bg-emerald-50 text-emerald-700":""])},{default:r(()=>[...i[52]||(i[52]=[e("i",{class:"fa-solid fa-file-signature"},null,-1),e("span",null,"Collect Signatures",-1)])]),_:1},8,["class"]),s(yn,{actions:ne.value,onActionSelected:le},null,8,["actions"])])])]),s(pt,{name:"expand"},{default:r(()=>[se.value?(v(),C("div",Qm,[e("div",Jm,[i[57]||(i[57]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Set Contract Signing Date",-1)),e("div",Gm,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[54]||(i[54]=[T("Contract Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(at),{type:"date",modelValue:xe.value.contractDate,"onUpdate:modelValue":i[7]||(i[7]=z=>xe.value.contractDate=z),max:Gs.value,class:"w-full"},null,8,["modelValue","max"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[55]||(i[55]=[T("Time (Optional)",-1)])]),_:1}),s(t(at),{type:"time",modelValue:xe.value.contractTime,"onUpdate:modelValue":i[8]||(i[8]=z=>xe.value.contractTime=z),class:"w-full"},null,8,["modelValue"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[56]||(i[56]=[T("Notes (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:xe.value.notes,"onUpdate:modelValue":i[9]||(i[9]=z=>xe.value.notes=z),rows:"4",placeholder:"Add any relevant notes about the contract signing...",class:"w-full"},null,8,["modelValue"])])])]),e("div",Zm,[s(t(Y),{variant:"secondary",onClick:Is},{default:r(()=>[...i[58]||(i[58]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ts.value,onClick:Xs,class:"bg-primary"},{default:r(()=>[...i[59]||(i[59]=[T(" Set Contract Date ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[ie.value?(v(),C("div",Km,[e("div",Xm,[s(Es,{ref_key:"addOfferContractPendingRef",ref:Re,"task-id":l.opportunity.id,"task-type":"opportunity",customer:l.opportunity.customer,"selected-vehicle":l.opportunity.selectedVehicle||l.opportunity.vehicle||l.opportunity.requestedCar,"hide-header":"","hide-actions":"",onSave:sn,onCancel:Ns},null,8,["task-id","customer","selected-vehicle"])])])):L("",!0)]),_:1}),ie.value?(v(),C("div",ep,[s(t(Y),{variant:"secondary",onClick:Ns},{default:r(()=>[...i[60]||(i[60]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!ss.value,onClick:tn,class:"bg-primary"},{default:r(()=>[...i[61]||(i[61]=[T(" Create Offer ",-1)])]),_:1},8,["disabled"])])):L("",!0),s(pt,{name:"expand"},{default:r(()=>[Se.value?(v(),C("div",tp,[e("div",sp,[i[64]||(i[64]=e("h5",{class:"font-semibold text-heading text-sm mb-4"},"Extend Deadline",-1)),e("div",np,[e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[62]||(i[62]=[T("New Deadline Date ",-1),e("span",{class:"text-red-600"},"*",-1)])]),_:1}),s(t(at),{type:"date",modelValue:Ve.value.newDeadline,"onUpdate:modelValue":i[10]||(i[10]=z=>Ve.value.newDeadline=z),min:Zs.value,class:"w-full"},null,8,["modelValue","min"])]),e("div",null,[s(t(J),{class:"block text-sm font-medium text-body mb-2"},{default:r(()=>[...i[63]||(i[63]=[T("Reason (Optional)",-1)])]),_:1}),s(t(lt),{modelValue:Ve.value.reason,"onUpdate:modelValue":i[11]||(i[11]=z=>Ve.value.reason=z),rows:"3",placeholder:"Reason for extending the deadline...",class:"w-full"},null,8,["modelValue"])])])]),e("div",ap,[s(t(Y),{variant:"secondary",onClick:Vs},{default:r(()=>[...i[65]||(i[65]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Os.value,onClick:an,class:"bg-primary"},{default:r(()=>[...i[66]||(i[66]=[T(" Extend Deadline ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1}),s(pt,{name:"expand"},{default:r(()=>[Le.value?(v(),C("div",lp,[s(gn,{ref_key:"scheduleAppointmentContractPendingFormRef",ref:et,opportunity:l.opportunity,mode:"schedule",onSubmit:i[12]||(i[12]=z=>on(z)),onCancel:ns},null,8,["opportunity"])])):L("",!0)]),_:1})])):!me.isClosed.value&&me.primaryAction.value?(v(),pe(Hn,{key:4,action:me.primaryAction.value,"color-scheme":me.primaryAction.value.colorScheme,onActionClicked:me.primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):L("",!0)]}),"task-widgets":r(()=>{var de;return[x.value?(v(),C("div",op,[l.opportunity.assignmentNote?(v(),C("div",ip,[e("div",rp,[i[68]||(i[68]=e("i",{class:"fa-solid fa-sticky-note text-blue-600 text-sm mt-0.5"},null,-1)),e("div",up,[i[67]||(i[67]=e("h5",{class:"font-semibold text-heading text-sm mb-1"},"Note from Assigner",-1)),e("p",dp,I(l.opportunity.assignmentNote),1)])])])):L("",!0),e("div",cp,[e("div",mp,[e("div",pp,[i[70]||(i[70]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Call to Schedule Appointment"),e("p",{class:"text-sm text-body mt-0.5"}," Contact the customer to schedule an appointment ")],-1)),e("div",vp,[e("span",fp,I(((de=l.opportunity.customer)==null?void 0:de.phone)||"N/A"),1),e("button",{onClick:M,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...i[69]||(i[69]=[e("i",{class:"fa-regular fa-copy text-sm"},null,-1)])])]),s(Gn,{"is-call-active":t(y),"call-ended":t(b),"call-duration":t(N),"call-notes":t(w),"formatted-call-duration":t(_),"mock-transcription":t(E),"contact-attempts":0,"max-contact-attempts":3,onStartCall:q,onEndCall:D,onLogManualCall:H,onExtractInformation:i[13]||(i[13]=ve=>it.value=!0),"onUpdate:callNotes":j,onCopyNumber:M},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription"])])]),e("div",yp,[s(gn,{ref_key:"scheduleFormRef",ref:ae,opportunity:l.opportunity,mode:"schedule",onSubmit:i[14]||(i[14]=ve=>Ne(ve,"schedule")),onCancel:we},null,8,["opportunity"])])])])):L("",!0),d.value?(v(),C("div",gp,[e("div",bp,[e("div",hp,[i[74]||(i[74]=e("div",{class:"mb-3"},[e("h4",{class:"font-bold text-heading text-sm"},"Post-Delivery Customer Satisfaction Survey"),e("p",{class:"text-sm text-body mt-0.5"}," Collect feedback from the customer about their delivery experience ")],-1)),e("div",xp,[s(t(Y),{variant:"outline",onClick:i[15]||(i[15]=ve=>oe.value=!oe.value),class:Z(["inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors",oe.value?"border-blue-500 bg-blue-50 text-blue-700":""])},{default:r(()=>[...i[71]||(i[71]=[e("i",{class:"fa-solid fa-clipboard-list"},null,-1),e("span",null,"Complete Survey",-1)])]),_:1},8,["class"]),$.value?(v(),pe(t(Y),{key:0,variant:"outline",onClick:Ft,class:"inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors border-green-500 bg-green-50 text-green-700 hover:bg-green-100"},{default:r(()=>[...i[72]||(i[72]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),e("span",null,"Reopen Opportunity",-1)])]),_:1})):L("",!0),e("div",wp,[e("button",{onClick:i[16]||(i[16]=Sn(ve=>W.value=!W.value,["stop"])),class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap"},[i[73]||(i[73]=e("span",null,"More actions",-1)),e("i",{class:Z(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":W.value}])},null,2)]),W.value&&tt.value.length>0?Ke((v(),C("div",kp,[s(t(Ln),{items:tt.value,className:"w-56"},null,8,["items"])])),[[U,()=>W.value=!1]]):L("",!0)])])])]),s(pt,{name:"expand"},{default:r(()=>[oe.value?(v(),C("div",Sp,[s(fm,{ref_key:"postDeliverySurveyRef",ref:X,opportunity:l.opportunity,onSubmit:Hs,onCancel:i[17]||(i[17]=ve=>oe.value=!1)},null,8,["opportunity"]),e("div",Cp,[s(t(Y),{variant:"secondary",onClick:Js},{default:r(()=>[...i[75]||(i[75]=[T(" Cancel ",-1)])]),_:1}),s(t(Y),{variant:"primary",disabled:!Ys.value,onClick:Qs,class:"bg-primary"},{default:r(()=>[...i[76]||(i[76]=[T(" Submit Survey ",-1)])]),_:1},8,["disabled"])])])):L("",!0)]),_:1})])):me.activeTaskWidget.value&&me.activeTaskWidget.value.component?(v(),C("div",$p,[e("div",Dp,[i[77]||(i[77]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Ap,I(me.taskWidgetTitle.value),1)]),(v(),pe(xn(me.activeTaskWidget.value.component),hn(me.activeTaskWidget.value.props,{onClose:zt,onSetCallback:js,onAutoCloseLost:O}),null,16))])):L("",!0)]}),"secondary-actions":r(()=>[...i[78]||(i[78]=[])]),_:1},8,["task"]),te.value?(v(),pe(Wn,{key:0,show:te.value,customer:l.opportunity.customer,assignee:l.opportunity.assignee,"disabled-fields":["customer"],onCreate:Cs,onCancel:i[18]||(i[18]=de=>te.value=!1)},null,8,["show","customer","assignee"])):L("",!0),Ge.value?(v(),pe(Ma,{key:1,opportunity:l.opportunity,"requested-car":l.opportunity.requestedCar,"recommended-cars":$t.value,onVehicleSelected:Pe,onClose:i[19]||(i[19]=de=>Ge.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):L("",!0),st.value?(v(),pe(Es,{key:2,opportunity:l.opportunity,vehicle:l.opportunity.selectedVehicle||l.opportunity.vehicle||l.opportunity.requestedCar,onOfferCreated:rt,onClose:i[20]||(i[20]=de=>st.value=!1)},null,8,["opportunity","vehicle"])):L("",!0),wt.value?(v(),pe(Dd,{key:3,opportunity:l.opportunity,onContractSet:bt,onClose:i[21]||(i[21]=de=>wt.value=!1)},null,8,["opportunity"])):L("",!0),ot.value?(v(),pe(Vd,{key:4,opportunity:l.opportunity,onDelivered:ct,onClose:i[22]||(i[22]=de=>ot.value=!1)},null,8,["opportunity"])):L("",!0),dt.value?(v(),pe(qn,{key:5,opportunity:l.opportunity,"preselected-reason":Oe.value,onConfirm:ut,onCancel:i[23]||(i[23]=de=>{dt.value=!1,Oe.value=""})},null,8,["opportunity","preselected-reason"])):L("",!0),ue.value?(v(),pe(qn,{key:6,opportunity:l.opportunity,onConfirm:rn,onCancel:i[24]||(i[24]=de=>ue.value=!1)},null,8,["opportunity"])):L("",!0),Ct.value?(v(),pe(_d,{key:7,opportunity:l.opportunity,onRequalified:_e,onClose:i[25]||(i[25]=de=>Ct.value=!1)},null,8,["opportunity"])):L("",!0),it.value?(v(),pe(Cn,{key:8,onClose:i[26]||(i[26]=de=>it.value=!1)})):L("",!0),yt.value&&u.value?(v(),pe(_a,{key:9,show:yt.value,event:u.value,onClose:i[27]||(i[27]=de=>yt.value=!1),onEdit:i[28]||(i[28]=de=>{yt.value=!1,gt.value=!0}),onDelete:mt},null,8,["show","event"])):L("",!0),gt.value&&u.value?(v(),pe(Fa,{key:10,show:gt.value,event:u.value,customer:l.opportunity.customer,"disabled-fields":["customer"],onSave:Rs,onCancel:i[29]||(i[29]=de=>gt.value=!1)},null,8,["show","event","customer"])):L("",!0)],64)}}},Op=Wt(Tp,[["__scopeId","data-v-e2e67882"]]);function Wp(l){const V=Pt(),o=Lt(),m=S(()=>l.value?l.value.type==="lead"?au:Op:null),p=S(()=>l.value?l.value.type==="lead"?{currentActivities:S(()=>V.currentLeadActivities),addActivity:(g,f)=>V.addActivity(g,f),updateActivity:(g,f,k)=>V.updateActivity(g,f,k),deleteActivity:(g,f)=>V.deleteActivity(g,f),updateLead:(g,f)=>V.updateLead(g,f),loadLeadById:g=>V.fetchLeadById(g)}:{currentActivities:S(()=>o.currentOpportunityActivities),addActivity:(g,f)=>o.addActivity(g,f),updateActivity:(g,f,k)=>o.updateActivity(g,f,k),deleteActivity:(g,f)=>o.deleteActivity(g,f),addVehicle:(g,f)=>o.addVehicle(g,f),createOffer:(g,f)=>o.createOffer(g,f),updateOpportunity:(g,f)=>o.updateOpportunity(g,f),loadOpportunityById:g=>o.fetchOpportunityById(g)}:null),c=S(()=>l.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:m,storeAdapter:p,addNewConfig:c}}function Pp(l){const V=Pt(),o=Lt(),m=Tt(),p=S(()=>{const h=(l.value?V.leads:V.leads.filter(N=>!N.isDisqualified)).map(N=>{const w=ps(N,"lead"),E={...N,type:"lead",compositeId:`lead-${N.id}`,displayStage:w};return!E.customer&&N.customer&&(E.customer=N.customer),E}),y=o.opportunities.map(N=>{const w=ps(N,"opportunity"),E={...N,type:"opportunity",compositeId:`opportunity-${N.id}`,displayStage:w};return!E.customer&&N.customer&&(E.customer=N.customer),E});let b=[];return m.isOperator()?b=h:m.isSalesman()?b=y:b=[...h,...y],b}),c=(d,h)=>!h||h.length===0?d:Array.isArray(h)?d.filter(y=>h.includes(y.type)):h==="all"?d:d.filter(y=>y.type===h),g=d=>{const h=new Date,y=new Date(h.getTime()+24*60*60*1e3);return d.filter(b=>{if(!b.nextActionDue)return!1;const N=new Date(b.nextActionDue);return N>=h&&N<=y})},f=d=>d.filter(h=>h.nextActionDue!=null),k=d=>{const h=new Date(Date.now()-36e5);return d.filter(y=>y.type!=="lead"||!y.createdAt?!1:new Date(y.createdAt)>=h)},u=d=>{var y;const h=(y=m.currentUser)==null?void 0:y.name;return h?d.filter(b=>b.assignee===h):[]},x=(d,h)=>{if(!h||h.length===0)return d;let y=[...d];const b=h.filter(N=>N==="lead"||N==="opportunity");return b.length>0&&(y=c(y,b)),h.forEach(N=>{switch(N){case"due-in-24h":y=g(y);break;case"to-be-called":y=f(y);break;case"leads-1h":y=k(y);break;case"assigned-to-me":y=u(y);break}}),y},$=S(()=>{const d=p.value.some(y=>y.type==="lead"),h=p.value.some(y=>y.type==="opportunity");return d&&h});return{allTasks:p,filterByType:c,filterByDueIn24Hours:g,filterByToBeCalled:f,filterByLeadsCreated1Hour:k,filterByAssignedToMe:u,applyFilters:x,shouldShowTypeFilter:$}}export{Bp as D,jp as T,Wp as a,Pp as u};
