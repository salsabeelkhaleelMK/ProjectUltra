import{r as V,d as r,o as i,e as t,g as y,n as j,t as v,G as fe,w as K,p as I,k as N,F as W,i as H,c as T,a0 as Ne,E as Fe,x as q,y as g,s as h,v as ye,H as U,m as G,D as S,l as Q,a1 as Ee,W as Ue,h as je,R as qe,V as Be}from"./index-CadXi4tZ.js";import{i as ke,Q as L}from"./index-Dm9i4Ymj.js";import{_ as Me}from"./ReassignUserModal-D1gdk1zU.js";import{_ as We}from"./CreateEventModal-y9wAHxpI.js";import{z as J,F as X,L as Z,H as _,j as ee,K as pe,C as te,W as ae}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DsnSKQBg.js";import{u as z}from"./settings-BWd-PFvk.js";const Le={class:"w-full bg-white"},ze={class:"flex items-center justify-between gap-3 md:gap-4"},Re={class:"flex items-center gap-3 md:gap-4 flex-1"},Pe={class:"min-w-0 flex-1"},He={class:"flex items-center gap-2"},Ke={class:"heading-main truncate"},Ye={class:"flex flex-wrap items-center gap-2 mt-1"},Qe={class:"flex items-center gap-1 ml-2"},Ge={class:"relative"},Je={key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-50 overflow-hidden flex flex-col p-1"},Xe={key:0,class:"border-t border-gray-100 my-1"},Ze={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},_e={class:"flex items-center gap-4"},et={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},tt={class:"flex items-center gap-2"},at={class:"text-xs text-gray-900 font-medium"},nt={class:"flex items-center gap-2"},st={class:"text-xs text-gray-900 font-medium"},lt={class:"flex items-center gap-2"},it={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},ot={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-xs"},rt={key:1,class:"fa-regular fa-calendar text-gray-500 text-xs"},dt={class:"text-xs text-gray-900 font-medium"},ut={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg whitespace-nowrap"},ct={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"}},emits:["action","add-tag"],setup(e,{emit:m}){const o={mounted(d,c){d.clickOutsideEvent=O=>{d===O.target||d.contains(O.target)||c.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},l=m,f=V(!1),n=V(!1),p=V(null),u=d=>{n.value=!1,l("action",d)},a=async(d,c)=>{try{await navigator.clipboard.writeText(d),p.value=c,setTimeout(()=>{p.value=null},1500)}catch(O){console.error("Failed to copy:",O)}},s=()=>{l("add-tag")};return(d,c)=>(i(),r("div",Le,[t("div",ze,[t("div",Re,[t("div",{class:j(["w-14 h-14 rounded flex items-center justify-center text-lg font-bold shadow-sm shrink-0",e.avatarColorClass])},v(e.initials),3),t("div",Pe,[t("div",He,[t("h1",Ke,v(e.name),1),fe(d.$slots,"name-action")]),t("div",Ye,[fe(d.$slots,"tags"),t("button",{onClick:K(s,["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 font-medium hover:underline flex items-center gap-1"},[...c[14]||(c[14]=[t("i",{class:"fa-solid fa-plus text-xs"},null,-1),t("span",null,"add tag",-1)])])])])]),t("div",Qe,[t("div",Ge,[t("button",{onClick:c[0]||(c[0]=K(O=>n.value=!n.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white rounded-lg shrink-0 transition-colors","aria-label":"Quick actions"},[...c[15]||(c[15]=[t("i",{class:"fa-solid fa-plus text-base"},null,-1)])]),n.value?I((i(),r("div",Je,[t("button",{onClick:c[1]||(c[1]=O=>u("note")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note "),t("button",{onClick:c[2]||(c[2]=O=>u("financing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing "),t("button",{onClick:c[3]||(c[3]=O=>u("tradein")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in "),t("button",{onClick:c[4]||(c[4]=O=>u("purchase")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase "),t("button",{onClick:c[5]||(c[5]=O=>u("attachment")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment "),c[20]||(c[20]=t("div",{class:"border-t border-gray-100 my-1"},null,-1)),t("button",{onClick:c[6]||(c[6]=O=>u("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[16]||(c[16]=[t("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),N(" WhatsApp msg ",-1)])]),t("button",{onClick:c[7]||(c[7]=O=>u("email")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[17]||(c[17]=[t("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),N(" Email ",-1)])]),t("button",{onClick:c[8]||(c[8]=O=>u("sms")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[18]||(c[18]=[t("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),N(" SMS ",-1)])]),t("button",{onClick:c[9]||(c[9]=O=>u("call")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[19]||(c[19]=[t("i",{class:"fa-solid fa-phone text-xs text-gray-400"},null,-1),N(" Call ",-1)])]),e.taskType==="opportunity"?(i(),r("div",Xe)):y("",!0),e.taskType==="opportunity"?(i(),r("button",{key:1,onClick:c[10]||(c[10]=O=>u("appointment")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Appointment ")):y("",!0)])),[[o,()=>n.value=!1]]):y("",!0)]),t("button",{onClick:c[11]||(c[11]=O=>f.value=!f.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[t("i",{class:j(["fa-solid fa-chevron-up text-sm transition-transform duration-200",{"rotate-180":f.value}])},null,2)])])]),f.value?(i(),r("div",Ze,[t("div",_e,[t("div",et,[t("div",tt,[c[22]||(c[22]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-regular fa-envelope text-gray-500 text-xs"})],-1)),t("span",at,v(e.email),1),t("button",{onClick:c[12]||(c[12]=K(O=>a(e.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...c[21]||(c[21]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",nt,[c[24]||(c[24]=t("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-phone text-gray-500 text-xs"})],-1)),t("span",st,v(e.phone),1),t("button",{onClick:c[13]||(c[13]=K(O=>a(e.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...c[23]||(c[23]=[t("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),t("div",lt,[t("div",it,[e.thirdFieldLabel.toLowerCase().includes("address")?(i(),r("i",ot)):(i(),r("i",rt))]),t("span",dt,v(e.thirdFieldValue),1)])])]),p.value?(i(),r("div",ut,v(p.value==="email"?"Email":"Phone")+" copied! ",1)):y("",!0)])):y("",!0)]))}},mt={class:"flex gap-0 md:gap-8 text-base font-medium text-gray-500 py-1"},ft=["onClick"],yt={class:"hidden md:inline whitespace-nowrap"},pt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(e){const m={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip"},o=l=>m[l]||"fa-solid fa-circle";return(l,f)=>(i(),r("div",mt,[(i(!0),r(W,null,H(e.tabs,n=>(i(),r("div",{key:n.key,onClick:p=>l.$emit("update:modelValue",n.key),class:j(["flex-1 md:flex-none pb-2 border-b-2 cursor-pointer transition-colors flex items-center justify-center gap-1.5",e.modelValue===n.key?"border-blue-600 text-blue-600":"border-transparent hover:text-gray-700 hover:border-slate-200"])},[t("i",{class:j([o(n.key),"text-base md:text-base"])},null,2),t("span",yt,v(n.label),1),n.count!==void 0?(i(),r("span",{key:0,class:j(["inline-flex items-center justify-center px-1.5 md:px-2 py-0.5 rounded-full text-xs font-semibold",e.modelValue===n.key?"bg-blue-50 text-blue-700":"bg-gray-100 text-gray-500"])},v(n.count),3)):y("",!0)],10,ft))),128))]))}},gt={class:"metadata-bar w-full"},vt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},bt={class:"flex items-center gap-1.5"},xt={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},ht={class:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5"},kt={class:"text-xs font-bold text-gray-900"},wt={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"}},emits:["reassign"],setup(e){const m=e;T(()=>m.deliverySubstatus?Ne(m.deliverySubstatus):"");const o=T(()=>m.deliverySubstatus?m.deliverySubstatus==="Delivered"?"green":m.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),l=T(()=>Fe(m.stage,m.entityType));function f(u){return!u||u.length===0?null:u.filter(s=>s.type==="offer").sort((s,d)=>new Date(d.timestamp)-new Date(s.timestamp))[0]||null}function n(u){if(!u)return 0;const a=new Date(u),d=Math.abs(new Date-a);return Math.ceil(d/(1e3*60*60*24))}const p=T(()=>{if(m.stage!=="In Negotiation")return null;const u=f(m.activities);if(!u)return null;const a=n(u.timestamp);return a<1?{label:"New Offer",theme:"orange"}:a<3?{label:"Active",theme:"yellow"}:null});return(u,a)=>(i(),r("div",gt,[t("div",vt,[a[1]||(a[1]=t("span",{class:"label-upper"},"Stage",-1)),t("div",bt,[t("span",{class:j(["text-xs px-1.5 py-0.5 rounded font-semibold border",l.value])},v(e.stage),3),e.deliverySubstatus?(i(),q(g(ke),{key:0,text:e.deliverySubstatus,size:"small",theme:o.value},null,8,["text","theme"])):y("",!0),p.value?(i(),q(g(ke),{key:1,text:p.value.label,size:"small",theme:p.value.theme},null,8,["text","theme"])):y("",!0)])]),a[5]||(a[5]=t("div",{class:"metadata-divider"},null,-1)),t("div",xt,[a[2]||(a[2]=t("span",{class:"label-upper"},"Owner",-1)),t("button",{onClick:a[0]||(a[0]=s=>u.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors cursor-pointer"},v(e.owner),1)]),e.source?(i(),r(W,{key:0},[a[4]||(a[4]=t("div",{class:"metadata-divider"},null,-1)),t("div",ht,[a[3]||(a[3]=t("span",{class:"label-upper"},"Source",-1)),t("span",kt,v(e.source),1)])],64)):y("",!0)]))}},Ct={key:0,class:"flex-grow border-t border-gray-200"},$t={key:0,class:"ml-1.5"},St={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},At={key:0,class:"border-t border-gray-100 my-1"},Dt={key:0,class:"border-t border-gray-100 my-1"},Tt={key:1,class:"flex-grow border-t border-gray-200"},Ot={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(e,{emit:m}){const o={mounted(w,b){w.clickOutsideEvent=E=>{w===E.target||w.contains(E.target)||b.value()},document.addEventListener("click",w.clickOutsideEvent)},unmounted(w){document.removeEventListener("click",w.clickOutsideEvent)}},l=e,f=m,n=V(!1),p={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},u=T(()=>{if(!l.activeTab||l.activeTab==="overview")return l.actions.filter(b=>!p[b]);const w=Object.entries(p).filter(([,b])=>b===l.activeTab).map(([b])=>b);return l.actions.filter(b=>w.includes(b))}),a=T(()=>l.activeTab==="communication"?!1:u.value.length===1),s=T(()=>{if(!a.value||u.value.length!==1)return"";const w=u.value[0];return{note:"add note",attachment:"add attachment"}[w]||""}),d=T(()=>l.activeTab==="communication"?!0:u.value.length>1),c=T(()=>{if(l.inline)return"bg-blue-600 hover:bg-blue-700 text-white font-medium w-9 h-9 rounded-lg shadow-sm transition-all flex items-center justify-center z-20 relative";const w="bg-gray-50 hover:bg-white border border-gray-200 text-gray-700 font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative";return a.value?`${w} px-4 h-9`:`${w} w-9 h-9`}),O=T(()=>u.value.some(w=>["email","whatsapp","sms"].includes(w))),A=T(()=>u.value.some(w=>["addVehicle","configureVehicle"].includes(w))),k=T(()=>u.value.some(w=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(w))),x=w=>{n.value=!1,f("action",w)},F=()=>{a.value&&u.value.length===1?x(u.value[0]):n.value=!n.value};return(w,b)=>e.show?(i(),r("div",{key:0,class:j(["relative flex items-center",e.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[e.inline?y("",!0):(i(),r("div",Ct)),t("div",{class:j(["relative",e.inline?"mx-0":"mx-4"])},[t("button",{onClick:K(F,["stop"]),class:j(c.value)},[b[11]||(b[11]=t("i",{class:"fa-solid fa-plus text-xs"},null,-1)),a.value?(i(),r("span",$t,v(s.value),1)):y("",!0)],2),n.value&&d.value?I((i(),r("div",St,[A.value?(i(),r(W,{key:0},[u.value.includes("addVehicle")?(i(),r("button",{key:0,onClick:b[0]||(b[0]=E=>x("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):y("",!0),u.value.includes("configureVehicle")?(i(),r("button",{key:1,onClick:b[1]||(b[1]=E=>x("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):y("",!0)],64)):y("",!0),k.value?(i(),r(W,{key:1},[A.value?(i(),r("div",At)):y("",!0),u.value.includes("note")?(i(),r("button",{key:1,onClick:b[2]||(b[2]=E=>x("note")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):y("",!0),u.value.includes("financing")?(i(),r("button",{key:2,onClick:b[3]||(b[3]=E=>x("financing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):y("",!0),u.value.includes("tradein")?(i(),r("button",{key:3,onClick:b[4]||(b[4]=E=>x("tradein")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):y("",!0),u.value.includes("requestedCar")?(i(),r("button",{key:4,onClick:b[5]||(b[5]=E=>x("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):y("",!0),u.value.includes("purchase")?(i(),r("button",{key:5,onClick:b[6]||(b[6]=E=>x("purchase")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):y("",!0),u.value.includes("attachment")?(i(),r("button",{key:6,onClick:b[7]||(b[7]=E=>x("attachment")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):y("",!0)],64)):y("",!0),O.value?(i(),r(W,{key:2},[A.value||k.value?(i(),r("div",Dt)):y("",!0),u.value.includes("email")?(i(),r("button",{key:1,onClick:b[8]||(b[8]=E=>x("email")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...b[12]||(b[12]=[t("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),N(" Send Email ",-1)])])):y("",!0),u.value.includes("whatsapp")?(i(),r("button",{key:2,onClick:b[9]||(b[9]=E=>x("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...b[13]||(b[13]=[t("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),N(" Send WhatsApp ",-1)])])):y("",!0),u.value.includes("sms")?(i(),r("button",{key:3,onClick:b[10]||(b[10]=E=>x("sms")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...b[14]||(b[14]=[t("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),N(" Send SMS ",-1)])])):y("",!0)],64)):y("",!0)])),[[o,()=>n.value=!1]]):y("",!0)],2),e.inline?y("",!0):(i(),r("div",Tt))],2)):y("",!0)}},It={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Vt={class:"flex items-start gap-3"},Nt={class:"flex-1 min-w-0"},Ft={class:"font-bold text-sm text-gray-900 mb-2"},Et={class:"space-y-1.5 text-xs text-gray-600"},Ut={class:"flex items-center gap-2"},jt={class:"flex items-center gap-2"},qt={class:"flex items-center gap-2"},Bt={key:0,class:"mt-2"},Mt={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(e){const m=e,o=T(()=>m.appointmentData.date?new Date(m.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),l=T(()=>m.appointmentData.time?m.appointmentData.time:""),f=n=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[n==null?void 0:n.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(n,p)=>(i(),r("div",It,[t("div",Vt,[p[3]||(p[3]=t("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[t("i",{class:"fa-solid fa-calendar text-sm"})],-1)),t("div",Nt,[t("h4",Ft,v(e.appointmentData.type),1),t("div",Et,[t("div",Ut,[p[0]||(p[0]=t("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),t("span",null,v(o.value),1)]),t("div",jt,[p[1]||(p[1]=t("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),t("span",null,v(l.value),1)]),t("div",qt,[p[2]||(p[2]=t("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),t("span",null,v(e.appointmentData.assignee),1)])]),e.appointmentData.status?(i(),r("div",Bt,[t("span",{class:j(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",f(e.appointmentData.status)])},v(e.appointmentData.status),3)])):y("",!0)])])]))}},Wt={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},Lt={class:"flex-1"},zt={class:"flex items-center gap-2 mb-1"},Rt={class:"text-xs font-bold text-gray-900"},Pt={class:"text-xs text-gray-400"},Ht={class:"text-xs text-gray-400"},Kt={key:0,class:"bg-blue-50 text-blue-600 text-xs px-1 py-0.5 rounded border border-blue-100"},Yt={class:"ml-auto relative"},Qt={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},Gt={key:0,class:"text-sm text-gray-700"},Jt={key:1,class:"text-sm text-gray-700 flex items-center gap-2"},Xt={key:2,class:"mt-2"},Zt={key:0},_t={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},ea={key:0},ta={class:"text-sm font-bold text-gray-900"},aa={key:0,class:"text-xs text-gray-600 mt-0.5"},na={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},sa={key:0},la={key:1},ia={key:2},oa={key:3},ra={key:4},da={key:1},ua={class:"text-sm font-bold text-gray-900 mb-2"},ca={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},ma={key:0},fa={class:"text-gray-700 font-medium ml-1"},ya={key:1},pa={class:"text-gray-700 font-medium ml-1"},ga={key:2},va={class:"text-gray-700 font-medium ml-1"},ba={key:3},xa={class:"text-gray-700 font-medium ml-1"},ha={key:4},ka={class:"text-gray-700 font-medium ml-1"},wa={key:5},Ca={class:"text-gray-700 font-medium ml-1"},$a={key:2,class:"flex items-center gap-3"},Sa={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Aa=["src"],Da={class:"flex-1"},Ta={class:"text-sm font-bold text-gray-900"},Oa={class:"text-xs text-gray-500"},Ia={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Va={key:3,class:"flex items-center gap-3"},Na={class:"flex-1"},Fa={class:"text-sm font-bold text-gray-900"},Ea={class:"text-xs text-gray-500"},Ua={key:0,class:"text-xs text-gray-400 mt-1"},ja={key:1,class:"text-xs text-gray-600 mt-1"},we={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(e,{emit:m}){const o=e,l=m,f=V(!1),n={mounted(A,k){A.clickOutsideEvent=x=>{A===x.target||A.contains(x.target)||k.value()},setTimeout(()=>{document.addEventListener("click",A.clickOutsideEvent)},0)},unmounted(A){document.removeEventListener("click",A.clickOutsideEvent)}},p=A=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[A]||"fa-solid fa-circle",u=A=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[A]||"bg-gray-100 text-gray-600 border-gray-200",a=A=>{if(!A)return"Just now";const k=new Date(A),F=new Date-k,w=Math.floor(F/6e4),b=Math.floor(w/60),E=Math.floor(b/24);return w<1?"Just now":w<60?`${w} minutes ago`:b<24?`${b} hours ago`:E===1?"Yesterday":E<7?`${E} days ago`:k.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},s=A=>A?new Intl.NumberFormat("en-US").format(A):"0",d=A=>A?new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",c=()=>{f.value=!1,l("edit",o.item)},O=()=>{f.value=!1,confirm("Are you sure you want to delete this item?")&&l("delete",o.item)};return(A,k)=>(i(),r("div",Wt,[t("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",u(e.item.type)])},[t("i",{class:j([p(e.item.type),"text-sm"])},null,2)],2),t("div",Lt,[t("div",zt,[t("span",Rt,v(e.customerInitials),1),t("span",Pt,v(e.item.action||"added"),1),t("span",Ht,"• "+v(a(e.item.timestamp)),1),e.item.autoDetected?(i(),r("span",Kt,"Auto-detected")):y("",!0),t("div",Yt,[t("button",{onClick:k[0]||(k[0]=K(x=>f.value=!f.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...k[1]||(k[1]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),f.value?I((i(),r("div",Qt,[t("button",{onClick:c,class:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...k[2]||(k[2]=[t("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),N(" Edit ",-1)])]),t("button",{onClick:O,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...k[3]||(k[3]=[t("i",{class:"fa-solid fa-trash text-red-400"},null,-1),N(" Delete ",-1)])])])),[[n,()=>f.value=!1]]):y("",!0)])]),e.item.content?(i(),r("div",Gt,v(e.item.content),1)):y("",!0),e.item.fileName?(i(),r("div",Jt,[k[4]||(k[4]=t("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),t("span",null,v(e.item.fileName),1)])):y("",!0),e.item.data?(i(),r("div",Xt,[e.item.type==="appointment"?(i(),r("div",Zt,[h(Mt,{"appointment-data":e.item.data},null,8,["appointment-data"])])):(i(),r("div",_t,[e.item.type==="tradein"?(i(),r("div",ea,[t("h4",ta,v(e.item.data.brand)+" "+v(e.item.data.model),1),e.item.data.version?(i(),r("p",aa,v(e.item.data.version),1)):y("",!0),t("div",na,[e.item.data.year?(i(),r("div",sa,[k[5]||(k[5]=t("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(v(e.item.data.year),1)])):y("",!0),e.item.data.km?(i(),r("div",la,[k[6]||(k[6]=t("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(v(e.item.data.km)+" km ",1)])):y("",!0),e.item.data.plate?(i(),r("div",ia,[k[7]||(k[7]=t("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(v(e.item.data.plate),1)])):y("",!0),e.item.data.date?(i(),r("div",oa,[k[8]||(k[8]=t("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(v(d(e.item.data.date)),1)])):y("",!0),e.item.data.class?(i(),r("div",ra,[k[9]||(k[9]=t("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(v(e.item.data.class),1)])):y("",!0)])])):e.item.type==="financing"?(i(),r("div",da,[t("h4",ua,v(e.item.data.product),1),t("div",ca,[e.item.data.provider?(i(),r("div",ma,[k[10]||(k[10]=t("span",{class:"text-gray-500"},"Provider:",-1)),t("span",fa,v(e.item.data.provider),1)])):y("",!0),e.item.data.total?(i(),r("div",ya,[k[11]||(k[11]=t("span",{class:"text-gray-500"},"Total:",-1)),t("span",pa,"€"+v(s(e.item.data.total)),1)])):y("",!0),e.item.data.monthly?(i(),r("div",ga,[k[12]||(k[12]=t("span",{class:"text-gray-500"},"Monthly:",-1)),t("span",va,"€"+v(s(e.item.data.monthly)),1)])):y("",!0),e.item.data.deposit?(i(),r("div",ba,[k[13]||(k[13]=t("span",{class:"text-gray-500"},"Deposit:",-1)),t("span",xa,"€"+v(s(e.item.data.deposit)),1)])):y("",!0),e.item.data.startDate?(i(),r("div",ha,[k[14]||(k[14]=t("span",{class:"text-gray-500"},"Start:",-1)),t("span",ka,v(d(e.item.data.startDate)),1)])):y("",!0),e.item.data.expDate?(i(),r("div",wa,[k[15]||(k[15]=t("span",{class:"text-gray-500"},"Expires:",-1)),t("span",Ca,v(d(e.item.data.expDate)),1)])):y("",!0)])])):e.item.type==="offer"?(i(),r("div",$a,[e.item.data.image?(i(),r("div",Sa,[t("img",{src:e.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Aa)])):y("",!0),t("div",Da,[t("h4",Ta,v(e.item.data.brand)+" "+v(e.item.data.model)+" ("+v(e.item.data.year)+")",1),t("p",Oa,"€ "+v(s(e.item.data.price)),1)]),e.item.data.isMainOffer?(i(),r("span",Ia,"Main Offer")):y("",!0)])):e.item.type==="purchase"?(i(),r("div",Va,[t("div",Na,[t("h4",Fa,v(e.item.data.brand)+" "+v(e.item.data.model)+" ("+v(e.item.data.year)+")",1),t("p",Ea,"€ "+v(s(e.item.data.price)),1),e.item.data.purchaseDate?(i(),r("p",Ua,"Purchased: "+v(d(e.item.data.purchaseDate)),1)):y("",!0),e.item.data.notes?(i(),r("p",ja,v(e.item.data.notes),1)):y("",!0)])])):y("",!0)]))])):y("",!0)])]))}},qa={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Ba={class:"flex items-center gap-3"},Ma=["title"],Wa={key:0,class:"fa-solid fa-arrow-left text-sm"},La={key:1,class:"fa-solid fa-arrow-right text-sm"},za={key:2,class:"font-bold text-lg text-gray-800"},Ra={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},Pa={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Ha={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Ka={class:"text-sm"},Ya={key:2,class:"space-y-6 relative z-10"},Qa={key:0,class:"mb-4 pl-12"},Ga={class:"text-sm font-semibold text-gray-800"},Ja={class:"flex gap-4 relative mb-6"},Xa={class:"flex-1 min-w-0"},Za={class:"text-sm text-slate-700 leading-snug"},_a={class:"font-bold"},en={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},tn={class:"text-xs text-gray-400 mt-1"},an={key:1,class:"flex-1 overflow-y-auto py-6 scrollbar-hide relative flex flex-col items-center"},nn={key:0,class:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-200 -translate-x-1/2 z-0"},sn={key:1,class:"space-y-4 relative z-10"},ln=["title"],on={key:2,class:"text-center py-8 text-gray-400 relative z-10"},rn={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!0},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(e,{emit:m}){const o=e,l=a=>{const s={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return s[a]||s.default},f=a=>{const s={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return s[a]||s.default},n=a=>{if(!a)return"";const s=new Date(a),d=new Date,c=new Date(d);return c.setDate(c.getDate()-1),s.toDateString()===d.toDateString()?"Today":s.toDateString()===c.toDateString()?"Yesterday":s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},p=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",u=(a,s)=>{if(a===0)return!0;const d=o.activities[a-1];if(!d)return!0;const c=new Date(s.timestamp).toDateString(),O=new Date(d.timestamp).toDateString();return c!==O};return(a,s)=>e.show?(i(),r("div",{key:0,class:j(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[e.collapsed?"w-16":"w-80",e.mobileFullscreen?"xl:relative xl:border-l":""]])},[t("div",qa,[t("div",Ba,[e.mobileFullscreen?(i(),r("button",{key:0,onClick:s[0]||(s[0]=d=>a.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...s[2]||(s[2]=[t("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):e.showCollapse?(i(),r("button",{key:1,onClick:s[1]||(s[1]=d=>a.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:e.collapsed?"Expand sidebar":"Collapse sidebar"},[e.collapsed?(i(),r("i",Wa)):(i(),r("i",La))],8,Ma)):y("",!0),e.collapsed?y("",!0):(i(),r("h2",za,v(e.title),1))])]),e.collapsed?(i(),r("div",an,[e.activities.length>0?(i(),r("div",nn)):y("",!0),e.activities.length>0?(i(),r("div",sn,[(i(!0),r(W,null,H(e.activities,d=>(i(),r("div",{key:d.id,class:"relative"},[t("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white border-2 border-gray-200",f(d.type)]),title:`${d.user} ${d.action}`},[t("i",{class:j([l(d.type),"text-xs"])},null,2)],10,ln)]))),128))])):(i(),r("div",on,[...s[4]||(s[4]=[t("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1)])]))])):(i(),r("div",Ra,[e.activities.length>0?(i(),r("div",Pa)):y("",!0),e.activities.length===0?(i(),r("div",Ha,[s[3]||(s[3]=t("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),t("p",Ka,v(e.emptyMessage),1)])):(i(),r("div",Ya,[(i(!0),r(W,null,H(e.activities,(d,c)=>(i(),r(W,{key:d.id},[u(c,d)?(i(),r("div",Qa,[t("h3",Ga,v(n(d.timestamp)),1)])):y("",!0),t("div",Ja,[t("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",f(d.type)])},[t("i",{class:j([l(d.type),"text-sm"])},null,2)],2),t("div",Xa,[t("div",Za,[t("span",_a,v(d.user),1),N(" "+v(d.action),1)]),d.content?(i(),r("div",en,v(d.content),1)):y("",!0),t("div",tn,v(p(d.timestamp)),1)])])],64))),128))]))]))],2)):y("",!0)}},dn={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},un={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},cn={class:"mb-3"},mn={class:"flex justify-end gap-2"},fn={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const o=e,l=m,f=V(""),n=V(""),p=()=>{!f.value.trim()&&!n.value||l("save",{type:"communication",action:`sent via ${o.type}`,content:f.value||`Sent template: ${n.value}`,communicationType:o.type})};return(u,a)=>(i(),r("div",dn,[a[5]||(a[5]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("h5",un,v(e.type==="email"?"Send Email":e.type==="whatsapp"?"Send WhatsApp":e.type==="sms"?"Send SMS":"Send Message"),1),t("div",cn,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Template",-1)),I(t("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>n.value=s),class:"input"},[...a[3]||(a[3]=[t("option",{value:""},"Select a template...",-1),t("option",null,"Follow-up",-1),t("option",null,"Meeting Confirmation",-1),t("option",null,"Quote Proposal",-1),t("option",null,"Unable to Reach",-1)])],512),[[ye,n.value]])]),I(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=s=>f.value=s),class:"input mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[U,f.value]]),t("div",mn,[t("button",{onClick:a[2]||(a[2]=s=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},yn={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},pn={key:1,class:"flex justify-between items-center mb-4"},gn={class:"text-sm font-bold text-gray-900"},vn={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},bn={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:o}){const l=e,f=o,n=V("");G(()=>{l.item&&(n.value=l.item.content||"")});const p=()=>{var u,a;n.value.trim()&&f("save",{id:((u=l.item)==null?void 0:u.id)||Date.now(),type:"note",action:l.item?"updated a note":"added a note",content:n.value,timestamp:((a=l.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return m({submit:p,canSubmit:()=>!!n.value.trim()}),(u,a)=>(i(),r("div",{class:j(["animate-fade-in relative",{"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6":!e.hideHeader}])},[e.hideHeader?y("",!0):(i(),r("div",yn)),e.hideHeader?y("",!0):(i(),r("div",pn,[t("h5",gn,v(e.item?"Edit Note":"Add Note"),1),t("button",{onClick:a[0]||(a[0]=s=>u.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...a[3]||(a[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),t("div",null,[a[4]||(a[4]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Note",-1)),I(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=s=>n.value=s),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[U,n.value]])]),e.hideActions?y("",!0):(i(),r("div",vn,[t("button",{onClick:a[2]||(a[2]=s=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")]))],2))}},xn={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},hn={class:"flex justify-between items-center mb-4"},kn={class:"text-sm font-bold text-gray-900"},wn={class:"flex items-center gap-3"},Cn={key:0,class:"text-sm text-slate-600"},$n={key:1,class:"text-sm text-gray-400"},Sn={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},An=["disabled"],Dn={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(e,{emit:m}){const o=e,l=m,f=V(null),n=V("");G(()=>{o.item&&(n.value=o.item.fileName||"")});const p=a=>{const s=a.target.files[0];s&&(f.value=s,n.value=s.name)},u=()=>{var a,s;!f.value&&!o.item||l("save",{id:((a=o.item)==null?void 0:a.id)||Date.now(),type:"attachment",action:o.item?"updated an attachment":"added an attachment",fileName:n.value,timestamp:((s=o.item)==null?void 0:s.timestamp)||new Date().toISOString(),isEdit:!!o.item})};return(a,s)=>(i(),r("div",xn,[s[6]||(s[6]=t("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),t("div",hn,[t("h5",kn,v(e.item?"Edit Attachment":"Add Attachment"),1),t("button",{onClick:s[0]||(s[0]=d=>a.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...s[3]||(s[3]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t("div",null,[s[5]||(s[5]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),t("div",wn,[t("input",{type:"file",onChange:p,ref:"fileInput",class:"hidden"},null,544),t("button",{onClick:s[1]||(s[1]=d=>a.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...s[4]||(s[4]=[t("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),N("Choose File ",-1)])]),n.value?(i(),r("span",Cn,v(n.value),1)):(i(),r("span",$n,"No file selected"))])]),t("div",Sn,[t("button",{onClick:s[2]||(s[2]=d=>a.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:u,disabled:!f.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,An)])]))}},Tn={class:"animate-fade-in"},On={class:"space-y-4"},In={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Nn={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Fn=["disabled"],En={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:o}){const l=e,f=o,n=V({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});G(()=>{l.item&&l.item.data&&(n.value={startDate:l.item.data.startDate||"",expDate:l.item.data.expDate||"",productName:l.item.data.product||l.item.data.productName||"",deposit:l.item.data.deposit||"",loanAmount:l.item.data.total||l.item.data.loanAmount||""})});const p=()=>{var u,a;n.value.productName&&f("save",{id:((u=l.item)==null?void 0:u.id)||Date.now(),type:"financing",action:l.item?"updated a financing proposal":"added a financing proposal",data:{product:n.value.productName,provider:"Audi Financial",total:n.value.loanAmount||"0",monthly:Math.round(parseFloat(n.value.loanAmount||0)/36).toString(),startDate:n.value.startDate,expDate:n.value.expDate,deposit:n.value.deposit},timestamp:((a=l.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return m({submit:p,isValid:T(()=>!!n.value.productName)}),(u,a)=>(i(),r("div",Tn,[t("div",On,[t("div",In,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Start date",-1)),I(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=s=>n.value.startDate=s),class:"input"},null,512),[[U,n.value.startDate]])]),t("div",null,[a[7]||(a[7]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Expiration date",-1)),I(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=s=>n.value.expDate=s),class:"input"},null,512),[[U,n.value.expDate]])])]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Financial product name",-1)),I(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>n.value.productName=s),class:"input"},null,512),[[U,n.value.productName]])]),t("div",Vn,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Deposit",-1)),I(t("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=s=>n.value.deposit=s),class:"input"},null,512),[[U,n.value.deposit]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Total loan amount",-1)),I(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=s=>n.value.loanAmount=s),class:"input"},null,512),[[U,n.value.loanAmount]])])])]),e.hideActions?y("",!0):(i(),r("div",Nn,[t("button",{onClick:a[5]||(a[5]=s=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,disabled:!n.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Fn)]))]))}},Un={__name:"FinancingModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const o=m,l=V(null),f=T(()=>{var a;return((a=l.value)==null?void 0:a.isValid)||!1}),n=()=>{var a;(a=l.value)==null||a.submit()},p=a=>{a||o("close")},u=a=>{o("save",a),o("close")};return(a,s)=>(i(),q(g(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[h(g(J),null,{default:S(()=>[h(g(X),{class:"fixed inset-0 z-50 bg-black/50"}),h(g(Z),{class:"w-full sm:max-w-lg"},{default:S(()=>[h(g(_),null,{default:S(()=>[h(g(ee),null,{default:S(()=>[...s[2]||(s[2]=[N("Add Financing",-1)])]),_:1}),h(g(pe),null,{default:S(()=>[...s[3]||(s[3]=[N("Record financing details for this customer",-1)])]),_:1})]),_:1}),h(En,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:l,onSave:u,onCancel:s[0]||(s[0]=d=>a.$emit("close"))},null,8,["item","task-type","task-id"]),h(g(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[h(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=d=>a.$emit("close"))}),h(g(L),{label:"Save Financing",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!f.value,onClick:n},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},jn={class:"animate-fade-in"},qn={class:"space-y-4"},Bn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Wn={key:0,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ln=["disabled"],zn={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:o}){const l=e,f=o,n=V({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});G(()=>{l.item&&l.item.data&&(n.value={class:l.item.data.class||"Car",brand:l.item.data.brand||"",model:l.item.data.model||"",version:l.item.data.version||"",km:l.item.data.km||"",plate:l.item.data.plate||"",date:l.item.data.date||""})});const p=()=>{var u,a;n.value.brand&&f("save",{id:((u=l.item)==null?void 0:u.id)||Date.now(),type:"tradein",action:l.item?"updated a trade-in":"added a trade-in",data:{class:n.value.class,brand:n.value.brand,model:n.value.model||"Unknown Model",year:n.value.date?new Date(n.value.date).getFullYear():"Unknown Year",km:n.value.km||"0",plate:n.value.plate||"",date:n.value.date||""},timestamp:((a=l.item)==null?void 0:a.timestamp)||new Date().toISOString(),isEdit:!!l.item})};return m({submit:p,isValid:T(()=>!!n.value.brand)}),(u,a)=>(i(),r("div",jn,[t("div",qn,[t("div",null,[a[9]||(a[9]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),I(t("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.class=s),class:"input"},[...a[8]||(a[8]=[t("option",{value:"Car"},"Car",-1),t("option",{value:"Motorcycle"},"Motorcycle",-1),t("option",{value:"Truck"},"Truck",-1)])],512),[[ye,n.value.class]])]),t("div",Bn,[t("div",null,[a[10]||(a[10]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),I(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>n.value.brand=s),class:"input"},null,512),[[U,n.value.brand]])]),t("div",null,[a[11]||(a[11]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),I(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>n.value.model=s),class:"input"},null,512),[[U,n.value.model]])])]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),I(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=s=>n.value.version=s),class:"input"},null,512),[[U,n.value.version]])]),t("div",Mn,[t("div",null,[a[13]||(a[13]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),I(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=s=>n.value.km=s),class:"input"},null,512),[[U,n.value.km]])]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),I(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=s=>n.value.plate=s),class:"input"},null,512),[[U,n.value.plate]])])]),t("div",null,[a[15]||(a[15]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),I(t("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=s=>n.value.date=s),class:"input"},null,512),[[U,n.value.date]])])]),e.hideActions?y("",!0):(i(),r("div",Wn,[t("button",{onClick:a[7]||(a[7]=s=>u.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),t("button",{onClick:p,disabled:!n.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Ln)]))]))}},Rn={__name:"TradeInModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],required:!0}},emits:["close","save"],setup(e,{emit:m}){const o=m,l=V(null),f=T(()=>{var a;return((a=l.value)==null?void 0:a.isValid)||!1}),n=()=>{var a;(a=l.value)==null||a.submit()},p=a=>{a||o("close")},u=a=>{o("save",a),o("close")};return(a,s)=>(i(),q(g(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[h(g(J),null,{default:S(()=>[h(g(X),{class:"fixed inset-0 z-50 bg-black/50"}),h(g(Z),{class:"w-full sm:max-w-lg"},{default:S(()=>[h(g(_),null,{default:S(()=>[h(g(ee),null,{default:S(()=>[...s[2]||(s[2]=[N("Add Trade-In Vehicle",-1)])]),_:1}),h(g(pe),null,{default:S(()=>[...s[3]||(s[3]=[N("Record details of the customer's trade-in vehicle",-1)])]),_:1})]),_:1}),h(zn,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"hide-actions":!0,ref_key:"widgetRef",ref:l,onSave:u,onCancel:s[0]||(s[0]=d=>a.$emit("close"))},null,8,["item","task-type","task-id"]),h(g(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[h(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=d=>a.$emit("close"))}),h(g(L),{label:"Save Trade-In",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!f.value,onClick:n},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Pn={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Hn={key:0,class:"flex justify-between items-center mb-4"},Kn={class:"text-sm font-bold text-gray-900"},Yn={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Qn={class:"flex items-center gap-3"},Gn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Jn=["src"],Xn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Zn={class:"font-bold text-sm text-gray-900"},_n={class:"text-xs text-gray-500"},es={class:"space-y-4"},ts={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},as={key:2,class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ns=["disabled"],ss={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(e,{expose:m,emit:o}){const l=e,f=o,n=V({price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,deliveryDate:"",validUntil:"",notes:"",brand:"",model:"",year:"",image:""});G(()=>{if(l.selectedVehicle){n.value.price=l.selectedVehicle.price||0,n.value.brand=l.selectedVehicle.brand||"",n.value.model=l.selectedVehicle.model||"",n.value.year=l.selectedVehicle.year||"",n.value.image=l.selectedVehicle.image||"";const s=new Date;s.setDate(s.getDate()+30),n.value.validUntil=s.toISOString().split("T")[0]}l.item&&l.item.data&&(n.value={...n.value,...l.item.data,price:l.item.data.price||l.item.data.total||0,financingType:l.item.data.financingType||l.item.data.paymentMethod||"",notes:l.item.data.notes||l.item.data.description||""})}),Q(()=>l.selectedVehicle,s=>{s&&!l.item&&(n.value.price=s.price||0,n.value.brand=s.brand||"",n.value.model=s.model||"",n.value.year=s.year||"",n.value.image=s.image||"")});const p=T(()=>n.value.price>0&&n.value.financingType!==""),u=s=>s?s.toLocaleString("en-US"):"0",a=()=>{var d,c;if(!p.value)return;const s={id:((d=l.item)==null?void 0:d.id)||Date.now(),type:"offer",action:l.item?"updated an offer":"created an offer",data:{brand:n.value.brand,model:n.value.model,year:n.value.year,price:n.value.price,total:n.value.price,paymentMethod:n.value.financingType,financingType:n.value.financingType,downPayment:n.value.downPayment,monthlyPayment:n.value.monthlyPayment,term:n.value.term,interestRate:n.value.interestRate,deliveryDate:n.value.deliveryDate,validUntil:n.value.validUntil,notes:n.value.notes,description:n.value.notes,image:n.value.image},timestamp:((c=l.item)==null?void 0:c.timestamp)||new Date().toISOString(),isEdit:!!l.item};f("save",s)};return m({submit:a,isValid:p,offerData:n}),(s,d)=>(i(),r("div",Pn,[e.hideHeader?y("",!0):(i(),r("div",Hn,[t("h5",Kn,v(e.item?"Edit Offer":"Create Offer"),1),t("button",{onClick:d[0]||(d[0]=c=>s.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[11]||(d[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e.selectedVehicle?(i(),r("div",Yn,[d[12]||(d[12]=t("p",{class:"text-xs text-gray-500 mb-2"},"Creating offer for:",-1)),t("div",Qn,[t("div",Gn,[e.selectedVehicle.image?(i(),r("img",{key:0,src:e.selectedVehicle.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Jn)):(i(),r("i",Xn))]),t("div",null,[t("h4",Zn,v(e.selectedVehicle.brand)+" "+v(e.selectedVehicle.model)+" ("+v(e.selectedVehicle.year)+") ",1),t("p",_n,"Base Price: € "+v(u(e.selectedVehicle.price)),1)])])])):y("",!0),t("div",es,[t("div",null,[d[13]||(d[13]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[N(" Offer Price (€) "),t("span",{class:"text-red-500"},"*")],-1)),I(t("input",{type:"number","onUpdate:modelValue":d[1]||(d[1]=c=>n.value.price=c),class:"input",placeholder:"Enter offer price"},null,512),[[U,n.value.price]])]),t("div",null,[d[15]||(d[15]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[N(" Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),I(t("select",{"onUpdate:modelValue":d[2]||(d[2]=c=>n.value.financingType=c),class:"input"},[...d[14]||(d[14]=[t("option",{value:""},"Select payment method",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"finance"},"Finance",-1),t("option",{value:"lease"},"Lease",-1)])],512),[[ye,n.value.financingType]])]),n.value.financingType==="finance"||n.value.financingType==="lease"?(i(),r("div",ts,[t("div",null,[d[16]||(d[16]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Down Payment (€)",-1)),I(t("input",{type:"number","onUpdate:modelValue":d[3]||(d[3]=c=>n.value.downPayment=c),class:"input",placeholder:"0"},null,512),[[U,n.value.downPayment]])]),t("div",null,[d[17]||(d[17]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Monthly Payment (€)",-1)),I(t("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=c=>n.value.monthlyPayment=c),class:"input",placeholder:"Calculated automatically"},null,512),[[U,n.value.monthlyPayment]])]),t("div",null,[d[18]||(d[18]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Term (months)",-1)),I(t("input",{type:"number","onUpdate:modelValue":d[5]||(d[5]=c=>n.value.term=c),class:"input",placeholder:"36"},null,512),[[U,n.value.term]])]),t("div",null,[d[19]||(d[19]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Interest Rate (%)",-1)),I(t("input",{type:"number",step:"0.1","onUpdate:modelValue":d[6]||(d[6]=c=>n.value.interestRate=c),class:"input",placeholder:"3.5"},null,512),[[U,n.value.interestRate]])])])):y("",!0),t("div",null,[d[20]||(d[20]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Expected Delivery Date",-1)),I(t("input",{type:"date","onUpdate:modelValue":d[7]||(d[7]=c=>n.value.deliveryDate=c),class:"input"},null,512),[[U,n.value.deliveryDate]])]),t("div",null,[d[21]||(d[21]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Offer Valid Until",-1)),I(t("input",{type:"date","onUpdate:modelValue":d[8]||(d[8]=c=>n.value.validUntil=c),class:"input"},null,512),[[U,n.value.validUntil]])]),t("div",null,[d[22]||(d[22]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Notes / Special Terms",-1)),I(t("textarea",{"onUpdate:modelValue":d[9]||(d[9]=c=>n.value.notes=c),rows:"3",class:"input",placeholder:"Any special terms, conditions, or notes about this offer..."},null,512),[[U,n.value.notes]])])]),e.hideActions?y("",!0):(i(),r("div",as,[t("button",{onClick:d[10]||(d[10]=c=>s.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),t("button",{onClick:a,disabled:!p.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},v(e.item?"Update Offer":"Create Offer"),9,ns)]))]))}},ls={class:"p-6"},is={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(e,{emit:m}){const o=m,l=V(null),f=T(()=>{var a;return((a=l.value)==null?void 0:a.isValid)||!1}),n=()=>{var a;(a=l.value)==null||a.submit()},p=a=>{a||o("close")},u=a=>{o("save",a),o("close")};return(a,s)=>(i(),q(g(ae),{open:e.show,"onUpdate:open":p},{default:S(()=>[h(g(J),null,{default:S(()=>[h(g(X),{class:"fixed inset-0 z-50 bg-black/50"}),h(g(Z),{class:"w-full sm:max-w-2xl p-0"},{default:S(()=>[h(g(_),{class:"p-6 pb-4 border-b border-gray-100"},{default:S(()=>[h(g(ee),null,{default:S(()=>[...s[2]||(s[2]=[N("Create Offer",-1)])]),_:1}),h(g(pe),null,{default:S(()=>[...s[3]||(s[3]=[N("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),t("div",ls,[h(ss,{item:e.item,"task-type":e.taskType,"task-id":e.taskId,"requested-car":e.requestedCar,"recommended-cars":e.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:l,onSave:u,onCancel:s[0]||(s[0]=d=>a.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),h(g(te),{class:"p-6 pt-4 bg-gray-50 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border-gray-100"},{default:S(()=>[h(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:s[1]||(s[1]=d=>a.$emit("close"))}),h(g(L),{label:e.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!f.value,onClick:n},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},os={class:"space-y-4"},rs={key:0},ds={class:"flex flex-wrap gap-2"},us=["onClick"],cs={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(e,{emit:m}){const o=e,l=m,f=V(""),n=u=>{u||l("close")};Q(()=>o.show,u=>{u&&(f.value="")});const p=()=>{const u=f.value.trim();u&&(o.existingTags.includes(u)||(l("add",u),f.value=""))};return(u,a)=>(i(),q(g(ae),{open:e.show,"onUpdate:open":n},{default:S(()=>[h(g(J),null,{default:S(()=>[h(g(X),{class:"fixed inset-0 z-50 bg-black/50"}),h(g(Z),{class:"w-full sm:max-w-md"},{default:S(()=>[h(g(_),null,{default:S(()=>[h(g(ee),null,{default:S(()=>[...a[2]||(a[2]=[N("Add Tag",-1)])]),_:1})]),_:1}),t("div",os,[t("div",null,[a[3]||(a[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Tag Name ",-1)),I(t("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),onKeyup:Ee(p,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[U,f.value]])]),e.existingTags.length>0?(i(),r("div",rs,[a[4]||(a[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Existing Tags ",-1)),t("div",ds,[(i(!0),r(W,null,H(e.existingTags,s=>(i(),r("button",{key:s,onClick:d=>f.value=s,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},v(s),9,us))),128))])])):y("",!0)]),h(g(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[h(g(L),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[1]||(a[1]=s=>u.$emit("close"))}),h(g(L),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto",disabled:!f.value.trim(),onClick:p},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ce={note:"note",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Ce(e){if(!e)return ce.default;const m=e.toLowerCase().trim();return ce[m]||ce.default}function ms({store:e,taskId:m,getTabForItemType:o,isOverviewModalAction:l}){const f=V(null),n=V(null),p=V("overview"),u=V("email"),a=V([]);Q(p,()=>{f.value=null,n.value=null});const s=T(()=>[...e.currentActivities.value,...a.value.filter(F=>!F.activityId)].filter(F=>{const w=o(F.type);return p.value==="overview"?w==="overview":w===p.value}).sort((F,w)=>{const b=new Date(F.timestamp||0);return new Date(w.timestamp||0)-b})),d=x=>(n.value=null,p.value==="overview"&&l&&l(x)?{type:"overview-modal",action:x}:(["email","sms","whatsapp","call"].includes(x)?(u.value=x,f.value="communication"):f.value=x,null)),c=async x=>{var F;if(x.isEdit){const w=a.value.findIndex(b=>b.id===x.id);w>-1&&(a.value[w]={...a.value[w],...x}),(F=n.value)!=null&&F.activityId&&await e.updateActivity(m.value,n.value.activityId,{type:x.communicationType||x.type,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data})}else{const w=x.communicationType||x.type,b=await e.addActivity(m.value,{type:w,user:"You",action:x.action,content:x.content,fileName:x.fileName,data:x.data});a.value.push({id:b.id,type:w==="email"||w==="whatsapp"||w==="sms"?"communication":w,action:x.action,content:x.content,fileName:x.fileName,data:x.data,timestamp:b.timestamp,activityId:b.id})}f.value=null,n.value=null},O=()=>{f.value=null,n.value=null},A=x=>{o(x.type)&&(f.value=x.type==="email"||x.type==="whatsapp"||x.type==="sms"||x.type==="communication"?"communication":x.type,n.value=x)},k=async x=>{try{await e.deleteActivity(m.value,x)}catch(F){throw console.error("Error deleting item:",F),F}};return{activeTab:p,showInlineWidget:f,inlineWidgetType:T(()=>f.value),editingItem:n,isEditing:T(()=>n.value!==null),communicationType:u,inlineContent:a,filteredInlineContent:s,handleAddNewAction:d,handleWidgetSave:c,handleWidgetCancel:O,handleEditItem:A,handleDeleteItem:k}}const fs={class:"flex-1 flex flex-col overflow-hidden h-full"},ys={class:"bg-white border-b border-gray-200 shrink-0"},ps={class:"px-4 md:px-8 py-3 md:py-4"},gs={class:"flex-1 flex flex-row overflow-hidden"},vs={class:"flex-1 flex flex-col overflow-hidden min-w-0"},bs={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},xs={class:"mb-4"},hs={key:0},ks={key:0,class:"mb-6"},ws={class:"space-y-6 mb-6"},Cs={key:1,class:"mb-6"},$s={key:2,class:"space-y-4 mb-6 px-1"},Ss={key:1},As={key:0,class:"space-y-4 mb-6 px-1"},Fs={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},emits:["car-added","convert-to-lead","convert-to-opportunity"],setup(e,{emit:m}){const o=e,l=Ue(),f=je(),n=T(()=>o.task.id),p=T(()=>o.type==="contact"?"bg-blue-100 text-blue-600":o.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),u=T(()=>l.path.startsWith("/tasks")&&!l.path.startsWith("/customer")),a=V(l.path.startsWith("/tasks")&&!l.path.startsWith("/customer"));Q(()=>l.path,C=>{a.value=C.startsWith("/tasks")&&!C.startsWith("/customer")});const s=()=>{f.push({path:`/customer/${o.task.id}`,query:{type:o.type}})};function d(C){x.value=!1}const c=()=>{F.value=!0},O=async C=>{var D,M,R,B;const $=C.name;o.type==="lead"?await((M=(D=o.storeAdapter).updateLead)==null?void 0:M.call(D,o.task.id,{assignee:$,assigneeType:C.type,teamId:C.type==="team"?C.id:null})):o.type==="opportunity"&&await((B=(R=o.storeAdapter).updateOpportunity)==null?void 0:B.call(R,o.task.id,{assignee:$,assigneeType:C.type,teamId:C.type==="team"?C.id:null})),F.value=!1},A=V(!1),k=V(null),x=V(!1),F=V(!1),w=V(!1),{activeTab:b,showInlineWidget:E,editingItem:ie,communicationType:$e,inlineContent:ve,filteredInlineContent:ne,handleAddNewAction:Se,handleWidgetSave:se,handleWidgetCancel:oe,handleEditItem:be,handleDeleteItem:xe}=ms({store:o.storeAdapter,taskId:n,getTabForItemType:Ce,isOverviewModalAction:C=>b.value==="overview"&&o.addNewConfig.overviewActions.includes(C)});Q(()=>o.task.id,()=>{b.value="overview"});const re=C=>{const $=Se(C);$&&$.modalAction&&(k.value=$.modalAction,A.value=!0)},Ae=C=>{if(C==="appointment"){x.value=!0;return}const $={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication",call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(C))k.value=C,A.value=!0;else{const D=$[C];D?(b.value=D,setTimeout(()=>{re(C),setTimeout(()=>{try{const M=document.querySelector(".animate-fade-in");M&&M.parentNode&&M.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):re(C)}},le=()=>{A.value=!1,k.value=null},de=async C=>{await se(C),le()},De=T(()=>{const C=[...o.storeAdapter.currentActivities.value,...ve.value],$=C.filter(B=>Ce(B.type)==="overview").length,D=C.filter(B=>["call","email","sms","whatsapp","communication"].includes(B.type)).length,M=C.filter(B=>B.type==="note").length,R=C.filter(B=>B.type==="attachment").length;return[{key:"overview",label:"Overview",count:$},{key:"note",label:"Notes",count:M},{key:"communication",label:"Communication",count:D},{key:"attachment",label:"Attachments",count:R}]}),he=T(()=>[...o.storeAdapter.currentActivities.value,...ve.value]);T(()=>k.value==="financing"?"Add Financing":k.value==="tradein"?"Add Trade-in":k.value==="purchase"?"Create Purchase Offer":"");const Te=async C=>{if(o.type==="opportunity")try{await o.storeAdapter.addVehicle(o.task.id,C.vehicleData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch($){console.error("Error selecting vehicle:",$)}},Oe=async C=>{if(o.type==="opportunity")try{await o.storeAdapter.createOffer(o.task.id,C.offerData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch($){console.error("Error creating offer:",$)}},Ie=async C=>{var M,R,B,ue;const $=o.task.tags||[];if($.includes(C)){w.value=!1;return}const D=[...$,C];try{o.type==="lead"?await((R=(M=o.storeAdapter).updateLead)==null?void 0:R.call(M,o.task.id,{tags:D})):o.type==="opportunity"&&await((ue=(B=o.storeAdapter).updateOpportunity)==null?void 0:ue.call(B,o.task.id,{tags:D})),o.type==="lead"&&o.storeAdapter.loadLeadById?await o.storeAdapter.loadLeadById(o.task.id):o.type==="opportunity"&&o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id),w.value=!1}catch(Ve){console.error("Error adding tag:",Ve)}};return(C,$)=>(i(),r("div",fs,[t("header",ys,[t("div",ps,[h(ct,{initials:e.task.customer.initials,name:e.task.customer.name,email:e.task.customer.email,phone:e.task.customer.phone,"third-field-value":e.task.customer.address,"avatar-color-class":p.value,"task-type":e.type,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:Ae,onAddTag:$[0]||($[0]=D=>w.value=!0)},{tags:S(()=>[(i(!0),r(W,null,H(e.task.tags,D=>(i(),r("span",{key:D,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},v(D),1))),128))]),"name-action":S(()=>[u.value?(i(),r("button",{key:0,onClick:s,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...$[9]||($[9]=[t("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type"])])]),t("div",gs,[t("div",vs,[t("main",bs,[t("div",xs,[h(pt,{modelValue:g(b),"onUpdate:modelValue":$[1]||($[1]=D=>qe(b)?b.value=D:null),tabs:De.value,class:"mb-0"},null,8,["modelValue","tabs"])]),g(b)==="overview"?(i(),r("div",hs,[e.type!=="contact"?(i(),r("div",ks,[h(wt,{stage:e.task.displayStage||e.task.stage,owner:e.task.assignee,source:e.task.source||"","delivery-substatus":e.task.deliverySubstatus,activities:e.task.activities||[],"entity-type":e.type,onReassign:c},null,8,["stage","owner","source","delivery-substatus","activities","entity-type"])])):y("",!0),t("div",ws,[fe(C.$slots,"pinned-extra",{task:e.task})]),e.managementWidget?(i(),r("div",Cs,[(i(),q(Be(e.managementWidget),{lead:e.type==="lead"?e.task:void 0,opportunity:e.type==="opportunity"?e.task:void 0,contact:e.type==="contact"?e.task:void 0,activities:he.value,onCarAdded:$[2]||($[2]=D=>C.$emit("car-added",D)),onConvertToLead:$[3]||($[3]=D=>C.$emit("convert-to-lead")),onConvertToOpportunity:$[4]||($[4]=D=>C.$emit("convert-to-opportunity")),onVehicleSelected:Te,onCreateOffer:Oe},null,40,["lead","opportunity","contact","activities"]))])):y("",!0),g(ne).length>0?(i(),r("div",$s,[(i(!0),r(W,null,H(g(ne),D=>(i(),q(we,{key:D.id,item:D,"task-type":e.type,"customer-initials":"SK",onEdit:g(be),onDelete:g(xe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)])):(i(),r("div",Ss,[h(Ot,{actions:e.addNewConfig.tabActions,"active-tab":g(b),onAction:re},null,8,["actions","active-tab"]),t("div",null,[g(E)==="communication"?(i(),q(fn,{key:0,type:g($e),"task-type":e.type,"task-id":e.task.id,item:g(ie),onSave:g(se),onCancel:g(oe)},null,8,["type","task-type","task-id","item","onSave","onCancel"])):y("",!0),g(E)==="note"?(i(),q(bn,{key:1,item:g(ie),"task-type":e.type,"task-id":e.task.id,onSave:g(se),onCancel:g(oe)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0),g(E)==="attachment"?(i(),q(Dn,{key:2,item:g(ie),"task-type":e.type,"task-id":e.task.id,onSave:g(se),onCancel:g(oe)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0)]),g(ne).length>0?(i(),r("div",As,[(i(!0),r(W,null,H(g(ne),D=>(i(),q(we,{key:D.id,item:D,"task-type":e.type,"customer-initials":"SK",onEdit:g(be),onDelete:g(xe)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)]))])]),h(rn,{title:"Activity summary",activities:he.value,collapsed:a.value,"show-collapse":!0,show:!0,class:"hidden lg:flex",onToggleCollapse:$[5]||($[5]=D=>a.value=!a.value)},null,8,["activities","collapsed"])]),h(Un,{show:k.value==="financing"&&A.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:de,onClose:le},null,8,["show","task-type","task-id"]),h(Rn,{show:k.value==="tradein"&&A.value,item:null,"task-type":e.type,"task-id":e.task.id,onSave:de,onClose:le},null,8,["show","task-type","task-id"]),h(is,{show:k.value==="purchase"&&A.value,item:null,"task-type":e.type,"task-id":e.task.id,"requested-car":e.type==="lead"?e.task.requestedCar:null,"recommended-cars":[],onSave:de,onClose:le},null,8,["show","task-type","task-id","requested-car"]),h(Me,{show:F.value,onClose:$[6]||($[6]=D=>F.value=!1),onConfirm:O},null,8,["show"]),x.value?(i(),q(We,{key:0,show:x.value,customer:e.task.customer,assignee:e.task.assignee,"disabled-fields":["customer"],onCreate:d,onCancel:$[7]||($[7]=D=>x.value=!1)},null,8,["show","customer","assignee"])):y("",!0),h(cs,{show:w.value,"existing-tags":e.task.tags||[],onClose:$[8]||($[8]=D=>w.value=!1),onAdd:Ie},null,8,["show","existing-tags"])]))}},ge={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:{key:"view-or-schedule-appointment",title:e=>e.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:e=>e.scheduledAppointment?`Scheduled for ${e.formatDateTime(e.scheduledAppointment.start)}`:"Schedule an appointment to move forward",label:e=>e.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:{key:"follow-up-offer",title:"Follow Up on Offer",description:e=>e.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:e=>e.hasOffers?"Follow Up on Offer":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}},secondaryActions:[{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"Contract Pending":{primaryAction:{key:"finalize-contract",title:"Finalize Contract",description:"Collect e-signatures and finalize contract documentation",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"close-won",label:"Close as Won",icon:"fa-solid fa-check-circle",description:"Mark deal as won and finalize"},{key:"extend-deadline",label:"Extend Deadline",icon:"fa-solid fa-clock"},{key:"add-offer",label:"Revise Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"Closed Won":{primaryAction:e=>{const m=e.deliverySubstatus;return m==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:m==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},me={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}};function P(e){if(!e)return 0;const m=new Date(e),l=Math.abs(new Date-m);return Math.ceil(l/(1e3*60*60*24))}const Y={"no-appointment":e=>!e.scheduledAppointment,"has-appointment":e=>!!e.scheduledAppointment,"appointment-past-not-completed":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)<new Date&&e.scheduledAppointment.status!=="completed":!1,"has-future-appointment":e=>e.scheduledAppointment?new Date(e.scheduledAppointment.start)>new Date:!1,"no-offers":e=>!e.hasOffers,"has-offers":e=>e.hasOffers,"qualified-no-offers-7-13-days":e=>{const m=z(),o=m.getSetting("oofbMinDays"),l=m.getSetting("oofbMaxDays"),f=P(e.opportunity.createdAt);return f>=o&&f<l+1&&!e.hasOffers},"qualified-no-offers-14-plus-days":e=>{const o=z().getSetting("ufbDays");return P(e.opportunity.createdAt)>=o&&!e.hasOffers},"negotiation-5-plus-days-no-contract-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const o=z().getSetting("ofbDays");return P(e.opportunity.lastActivity||e.opportunity.createdAt)>=o&&!e.opportunity.contractDate&&e.hasOffers},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":e=>{if(e.stage==="In Negotiation"&&!e.hasOffers)return!1;const o=z().getSetting("nfuDays"),l=P(e.opportunity.lastActivity||e.opportunity.createdAt),f=e.scheduledAppointment&&new Date(e.scheduledAppointment.start)>new Date;return l>=o&&!e.opportunity.contractDate&&!f&&e.hasOffers},"contract-7-plus-days-no-delivery":e=>{var n;if(!e.opportunity.contractDate)return!1;const o=z().getSetting("cfbDays"),l=P(e.opportunity.contractDate),f=(n=e.activities)==null?void 0:n.some(p=>{var u;return p.type==="delivery"||((u=p.action)==null?void 0:u.toLowerCase().includes("delivered"))});return l>=o&&!f},"delivery-date-set":e=>!!e.opportunity.deliveryDate,"delivery-3-plus-days":e=>{var n;const m=(n=e.activities)==null?void 0:n.find(p=>{var u;return p.type==="delivery"||((u=p.action)==null?void 0:u.toLowerCase().includes("delivered"))});if(!m)return!1;const l=z().getSetting("dfbDays");return P(m.timestamp)>=l},"is-awaiting-delivery":e=>e.deliverySubstatus==="Awaiting Delivery","is-delivered":e=>e.deliverySubstatus==="Delivered","has-no-delivery":e=>!e.deliverySubstatus||e.deliverySubstatus===null,"is-closed":e=>{const m=e.stage;return m==="Closed Won"||m==="Closed Lost"},"is-closed-with-task-widget":e=>Y["is-closed"](e)&&e.hasActiveTaskWidget,"opportunity-abandoned":e=>{if(Y["is-closed"](e))return!1;const m=z(),o=m.getSetting("abandonedOpportunityDays");if(!m.getSetting("abandonedEligibleStages").includes(e.stage))return!1;const f=e.opportunity.lastActivity||e.opportunity.createdAt;return P(f)>=o}};function Es(e,m){if(Y["is-closed-with-task-widget"](m))return[me.reopen,me.requalify,me.closeLost];const o=ge[e];return!o||!o.secondaryActions?[]:o.secondaryActions.filter(l=>{if(!l.conditional)return!0;const f=Y[l.conditional];return f?f(m):!0})}function Us(e,m){const o=ge[e];if(!o||!o.taskWidgets)return null;const f=z().getSetting("autoCloseWidgetsOnClose"),n=Y["is-closed"]({stage:e});for(const p of o.taskWidgets){if(f&&n&&(p.type==="NFU"||p.type==="OFB"))continue;const u=Y[p.condition];if(u&&u(m))return p.type}return null}function js(e,m){const o=ge[e];if(!o||!o.primaryAction)return null;const l=o.primaryAction;return{...l,title:typeof l.title=="function"?l.title(m):l.title,description:typeof l.description=="function"?l.description(m):l.description,label:typeof l.label=="function"?l.label(m):l.label}}function qs(e){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"No-Show Follow-up Task",ABANDONED:"Abandoned Opportunity Task"}[e]||"Task"}function Bs(e){return e==="Closed Won"||e==="Closed Lost"}const Ms={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(e,{emit:m}){const o=m,l=n=>{n||o("close")},f=()=>{o("close")};return(n,p)=>(i(),q(g(ae),{open:e.show,"onUpdate:open":l},{default:S(()=>[h(g(J),null,{default:S(()=>[h(g(X),{class:"fixed inset-0 z-50 bg-black/50"}),h(g(Z),{class:"w-full sm:max-w-md"},{default:S(()=>[h(g(_),null,{default:S(()=>[h(g(ee),null,{default:S(()=>[N(v(e.title),1)]),_:1})]),_:1}),p[0]||(p[0]=t("div",{class:"py-8 flex items-center justify-center"},[t("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1)),h(g(te),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:S(()=>[h(g(L),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};export{Fs as _,bn as a,js as b,Es as c,qs as d,ss as e,Ms as f,Us as g,Bs as i};
