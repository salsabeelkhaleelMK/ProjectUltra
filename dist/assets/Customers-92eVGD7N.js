import{r as c,A as re,c as b,p as ue,o as v,y as j,e as o,d as f,z as p,B as m,t as W,u as ce,x as de,k as pe,E as r,l as E,F as me,i as ge,g as be,j as ve,m as ye,h as fe,U as xe,n as Y}from"./index-C9aAcNW4.js";import{_ as Ce}from"./PageHeader-DfWVNIq4.js";import{_ as ke}from"./ModalShell-DIYenJ39.js";import{y as he}from"./components-DijixhIv.js";import{u as we}from"./opportunities-D7dSSblW.js";import{u as Ne}from"./contacts-BhMVt6bQ.js";import{g as De,f as Se,d as Z}from"./formatters-hBiVcbat.js";import{a as Ae}from"./customers-Du5jai_J.js";const $e={class:"space-y-4"},Oe={key:0},Ue={key:1},Ve={key:2},qe={key:3},Te=["placeholder"],Ie={class:"p-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100"},Ke={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(y,{emit:h}){const u=y,x=h,i=c({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});re(()=>u.show,d=>{d&&(i.value={customerName:u.initialData.customerName||"",email:u.initialData.email||"",phone:u.initialData.phone||"",company:u.initialData.company||"",vehicle:u.initialData.vehicle||"",value:u.initialData.value||"",reason:u.initialData.reason||""})});const R=b(()=>({contacts:"Add New Contact","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[u.activeTab]||"Add New Item"),C=b(()=>({contacts:"Contact","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[u.activeTab]||"Item"),F=()=>{x("save",{...i.value}),i.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(d,s)=>(v(),ue(ke,{show:y.show,title:R.value,subtitle:"Fill in the details below",size:"md",onClose:s[14]||(s[14]=l=>d.$emit("close")),onCancel:s[15]||(s[15]=l=>d.$emit("close"))},{footer:j(()=>[o("div",Ie,[o("button",{onClick:s[13]||(s[13]=l=>d.$emit("close")),class:"btn-secondary text-sm"}," Cancel "),o("button",{onClick:F,class:"btn-primary"}," Create "+W(C.value),1)])]),default:j(()=>[o("div",$e,[y.activeTab==="contacts"?(v(),f("div",Oe,[s[16]||(s[16]=o("label",{class:"block label-upper mb-2"},"Contact Name",-1)),p(o("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>i.value.customerName=l),type:"text",placeholder:"Enter contact name...",class:"input"},null,512),[[m,i.value.customerName]]),s[17]||(s[17]=o("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),p(o("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>i.value.email=l),type:"email",placeholder:"contact@example.com",class:"input"},null,512),[[m,i.value.email]]),s[18]||(s[18]=o("label",{class:"block label-upper mb-2 mt-4"},"Phone",-1)),p(o("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>i.value.phone=l),type:"tel",placeholder:"+49...",class:"input"},null,512),[[m,i.value.phone]]),s[19]||(s[19]=o("label",{class:"block label-upper mb-2 mt-4"},"Company (optional)",-1)),p(o("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>i.value.company=l),type:"text",placeholder:"Company name...",class:"input"},null,512),[[m,i.value.company]])])):y.activeTab==="open-leads"?(v(),f("div",Ue,[s[20]||(s[20]=o("label",{class:"block label-upper mb-2"},"Customer Name",-1)),p(o("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>i.value.customerName=l),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[m,i.value.customerName]]),s[21]||(s[21]=o("label",{class:"block label-upper mb-2 mt-4"},"Email",-1)),p(o("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>i.value.email=l),type:"email",placeholder:"customer@example.com",class:"input"},null,512),[[m,i.value.email]]),s[22]||(s[22]=o("label",{class:"block label-upper mb-2 mt-4"},"Requested Vehicle",-1)),p(o("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>i.value.vehicle=l),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"input"},null,512),[[m,i.value.vehicle]])])):y.activeTab==="open-opportunities"||y.activeTab==="in-negotiation"?(v(),f("div",Ve,[s[23]||(s[23]=o("label",{class:"block label-upper mb-2"},"Customer Name",-1)),p(o("input",{"onUpdate:modelValue":s[7]||(s[7]=l=>i.value.customerName=l),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[m,i.value.customerName]]),s[24]||(s[24]=o("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),p(o("input",{"onUpdate:modelValue":s[8]||(s[8]=l=>i.value.vehicle=l),type:"text",placeholder:"e.g., Porsche Taycan",class:"input"},null,512),[[m,i.value.vehicle]]),s[25]||(s[25]=o("label",{class:"block label-upper mb-2 mt-4"},"Opportunity Value",-1)),p(o("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>i.value.value=l),type:"number",placeholder:"0",class:"input"},null,512),[[m,i.value.value]])])):(v(),f("div",qe,[s[26]||(s[26]=o("label",{class:"block label-upper mb-2"},"Customer Name",-1)),p(o("input",{"onUpdate:modelValue":s[10]||(s[10]=l=>i.value.customerName=l),type:"text",placeholder:"Enter customer name...",class:"input"},null,512),[[m,i.value.customerName]]),s[27]||(s[27]=o("label",{class:"block label-upper mb-2 mt-4"},"Vehicle",-1)),p(o("input",{"onUpdate:modelValue":s[11]||(s[11]=l=>i.value.vehicle=l),type:"text",placeholder:"Vehicle model",class:"input"},null,512),[[m,i.value.vehicle]]),s[28]||(s[28]=o("label",{class:"block label-upper mb-2 mt-4"},"Reason",-1)),p(o("textarea",{"onUpdate:modelValue":s[12]||(s[12]=l=>i.value.reason=l),rows:"3",placeholder:`Reason for ${y.activeTab==="won"?"win":"loss"}...`,class:"input resize-none"},null,8,Te),[[m,i.value.reason]])]))])]),_:1},8,["show","title"]))}},Fe={class:"page-container"},Le={class:"p-4 md:p-8"},Me={class:"flex items-center gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide"},Re=["onClick"],Ee={class:"text-sm font-medium text-foreground whitespace-nowrap"},je={class:"mb-6 flex justify-end"},We={class:"table-wrapper w-full"},Ye={__name:"Customers",setup(y){const h=fe();xe();const u=ce(),x=de(),i=we(),R=Ne(),C=c([]),F=c(!1),d=b(()=>{const t=x.leads.filter(e=>!e.isDisqualified),a=i.opportunities.filter(e=>e.stage!=="Closed Won"&&e.stage!=="Closed Lost"),n=i.opportunities.filter(e=>e.stage==="In Negotiation"||e.stage==="In negotiation"),k=i.opportunities.filter(e=>e.stage==="Closed Won"),N=i.opportunities.filter(e=>e.stage==="Closed Lost");return{contacts:C.value.length,openLeads:t.length,openOpportunities:a.length-n.length,inNegotiation:n.length,won:k.length,lost:N.length}}),l=c(u.isOperator()?"open-leads":u.isManager()||u.isSalesman()?"in-negotiation":"contacts");c("");const L=c(!1),_=c(!1),B=c("all"),w=c({status:"",priority:"",source:""}),z=c({pageIndex:0,pageSize:10}),P=c(""),Q=c([]),H=c([]);c({});const ee=b(()=>l.value==="contacts"?[{key:"source",label:"Source",type:"select",operators:[{value:"eq",label:"is"},{value:"ne",label:"is not"}],options:[{value:"Marketing",label:"Marketing"},{value:"Referral",label:"Referral"},{value:"Direct",label:"Direct"}]},{key:"company",label:"Has Company",type:"boolean",operators:[{value:"exists",label:"exists"},{value:"notExists",label:"does not exist"}]}]:[{key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"Not interested",label:"Not interested"}]},{key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"},{value:"ne",label:"is not"}],options:[{value:"Hot",label:"Hot"},{value:"Normal",label:"Normal"}]},{key:"source",label:"Source",type:"select",operators:[{value:"eq",label:"is"},{value:"ne",label:"is not"}],options:[{value:"Marketing",label:"Marketing"},{value:"Referral",label:"Referral"},{value:"Direct",label:"Direct"}]}]),G=c({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),te=b(()=>{const t=[{key:"contacts",label:"Contacts & Accounts",count:d.value.contacts,borderColor:"border-t-purple-600",badgeColor:"bg-purple-600 text-white"},{key:"open-leads",label:"Open Leads",count:d.value.openLeads,borderColor:"border-t-blue-600",badgeColor:"bg-blue-600 text-white"},{key:"open-opportunities",label:"Open opportunities",count:d.value.openOpportunities,borderColor:"border-t-orange-500",badgeColor:"bg-orange-500 text-white"},{key:"in-negotiation",label:"In negotiation",count:d.value.inNegotiation,borderColor:"border-t-blue-500",badgeColor:"bg-blue-500 text-white"},{key:"won",label:"Won",count:d.value.won,borderColor:"border-t-green-500",badgeColor:"bg-green-500 text-white"},{key:"lost",label:"Lost",count:d.value.lost,borderColor:"border-t-red-500",badgeColor:"bg-red-500 text-white"}];return u.isOperator()?t.filter(a=>a.key==="contacts"||a.key==="open-leads"):u.isSalesman()?t.filter(a=>a.key!=="open-leads"):t}),ae=()=>{G.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},L.value=!1},se=b(()=>{let t=C.value;B.value==="contacts"?t=C.value.filter(e=>!e.company||e.company===""):B.value==="accounts"&&(t=C.value.filter(e=>e.company&&e.company!==""));const a=t.map(e=>({id:`customer-${e.id}`,stageKey:"contacts",customer:e.name,email:e.email,phone:e.phone,company:e.company||"-",initials:e.initials||e.name.slice(0,2).toUpperCase(),source:e.source||"Marketing",tags:e.tags||[],type:e.company&&e.company!==""?"account":"contact",customerId:e.id}));let n=x.leads;_.value?n=x.leads.filter(e=>e.isDisqualified===!0):n=x.leads.filter(e=>!e.isDisqualified);const k=n.map(e=>{var g,D,S,A,$,O,U,V,q,T,I,K;return{id:`lead-${e.id}`,stageKey:"open-leads",customer:((g=e.customer)==null?void 0:g.name)||"Unknown",email:((D=e.customer)==null?void 0:D.email)||"",initials:((S=e.customer)==null?void 0:S.initials)||(($=(A=e.customer)==null?void 0:A.name)==null?void 0:$.slice(0,2).toUpperCase())||"?",nextAction:Z(e.nextActionDue)||"No due date",nextActionFull:Se(e.nextActionDue),deadlineStatus:De(e.nextActionDue),car:`${((O=e.requestedCar)==null?void 0:O.brand)||""} ${((U=e.requestedCar)==null?void 0:U.model)||""}`.trim()||"N/A",carStatus:((V=e.requestedCar)==null?void 0:V.stockDays)!==void 0&&((q=e.requestedCar)==null?void 0:q.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((T=e.requestedCar)==null?void 0:T.stockDays)!==void 0&&((I=e.requestedCar)==null?void 0:I.stockDays)!==null?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",requestType:((K=e.requestedCar)==null?void 0:K.requestType)||"Quotation",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:M(e.createdAt),lastActivity:M(e.lastActivity),status:e.status,statusClass:oe(e.status),priority:e.priority||"Normal"}}),N=i.opportunities.map(e=>{var D,S,A,$,O,U,V,q,T,I,K;let g="open-opportunities";return e.stage==="In Negotiation"||e.stage==="In negotiation"?g="in-negotiation":e.stage==="Closed Won"?g="won":e.stage==="Closed Lost"&&(g="lost"),{id:`opp-${e.id}`,stageKey:g,customer:((D=e.customer)==null?void 0:D.name)||"Unknown",email:((S=e.customer)==null?void 0:S.email)||"",initials:((A=e.customer)==null?void 0:A.initials)||((O=($=e.customer)==null?void 0:$.name)==null?void 0:O.slice(0,2).toUpperCase())||"?",nextAction:Z(e.expectedCloseDate)||"No due date",car:`${((U=e.vehicle)==null?void 0:U.brand)||""} ${((V=e.vehicle)==null?void 0:V.model)||""}`.trim()||"N/A",carStatus:((q=e.vehicle)==null?void 0:q.stockDays)!==void 0&&((T=e.vehicle)==null?void 0:T.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((I=e.vehicle)==null?void 0:I.stockDays)!==void 0&&((K=e.vehicle)==null?void 0:K.stockDays)!==null?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",requestType:"Opportunity",source:e.source||"Marketing",assignee:e.assignee,assigneeInitials:e.assignee?e.assignee.slice(0,2).toUpperCase():"NA",createdAt:M(e.createdAt),lastActivity:M(e.lastActivity),status:e.stage,statusClass:g==="in-negotiation"?"bg-orange-100 text-orange-700":g==="won"?"bg-green-100 text-green-700":g==="lost"?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700",priority:e.priority||"Normal"}});return[...a,...k,...N]}),J=b(()=>{let t=se.value.filter(a=>a.stageKey===l.value);return w.value.status&&(t=t.filter(a=>a.status===w.value.status)),w.value.priority&&(t=t.filter(a=>a.priority===w.value.priority)),w.value.source&&(t=t.filter(a=>a.source===w.value.source)),t}),le=t=>{l.value=t},oe=t=>({Valid:"bg-green-100 text-green-700","Not valid":"bg-red-100 text-red-700",Qualified:"bg-gray-100 text-gray-700","Not interested":"bg-red-100 text-red-700",Open:"bg-blue-100 text-blue-700"})[t]||"bg-gray-100 text-gray-700",M=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-";pe(async()=>{F.value=!0;try{const t=await Ae();C.value=t.data||[]}catch(t){console.error("Error loading customers:",t)}finally{F.value=!1}await R.loadContacts(),await x.loadLeads(),await i.loadOpportunities()});const X=t=>{if(t.stageKey==="contacts"){const n=t.customerId||t.id.split("-")[1];h.push({path:`/customer/${n}`,query:{type:"contact"}});return}const a=t.id.match(/-(\d+)$/);if(l.value==="open-leads"&&t.id.startsWith("lead-")){const n=a?a[1]:t.id.replace("lead-","");h.push({path:`/customer/${n}`,query:{stage:"lead"}})}else if(t.id.startsWith("opp-")){const n=a?a[1]:t.id.replace("opp-","");h.push({path:`/customer/${n}`,query:{stage:"opportunity"}})}else if(t.stageKey==="won"||t.stageKey==="lost"){const n=a?a[1]:t.id.replace("opp-","");h.push({path:`/customer/${n}`,query:{stage:"opportunity"}})}},ne=b(()=>({class:{tr:"cursor-pointer hover:bg-gray-50 transition-colors"}})),ie=b(()=>l.value==="contacts"?[{accessorKey:"customer",header:"Contact",meta:{title:"Contact",onOpen:t=>X(t.original)},cell:({row:t})=>{const a=t.original;return r("div",{class:"flex items-center gap-2 md:gap-3"},[r("div",{class:"w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 bg-blue-100 text-blue-600"},a.initials),r("div",{class:"min-w-0"},[r("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},a.customer)])])}},{accessorKey:"company",header:"Company",meta:{title:"Company"},cell:({row:t})=>r("span",{class:"text-sm text-gray-600 truncate block max-w-[100px]"},t.original.company||"-")},{accessorKey:"email",header:"Email",meta:{title:"Email"},cell:({row:t})=>r("div",{class:"text-sm text-gray-600 truncate max-w-[150px]"},t.original.email)},{accessorKey:"phone",header:"Phone",meta:{title:"Phone"},cell:({row:t})=>r("span",{class:"text-sm text-gray-600"},t.original.phone)},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:t})=>r("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},t.original.source)},{accessorKey:"tags",header:"Tags",meta:{title:"Tags"},cell:({row:t})=>{const a=t.original.tags;return a&&a.length>0?r("div",{class:"flex flex-wrap gap-1"},a.map(n=>r("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},n))):r("span",{class:"text-xs text-gray-400"},"-")}},{id:"actions",header:"",meta:{title:"Actions"},cell:()=>r("button",{class:"text-gray-400 hover:text-gray-600"},[r("i",{class:"fa-solid fa-ellipsis-vertical"})])}]:[{accessorKey:"customer",header:"Customer",meta:{title:"Customer",onOpen:t=>X(t.original)},cell:({row:t})=>{const a=t.original;return r("div",{class:"flex items-center gap-2 md:gap-3"},[r("div",{class:"w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 bg-orange-100 text-orange-600"},a.initials),r("div",{class:"min-w-0"},[r("div",{class:"text-sm font-semibold text-gray-900 truncate"},a.customer),r("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},a.email)])])}},{accessorKey:"nextAction",header:"Next action due",meta:{title:"Next action due"},cell:({row:t})=>{var n,k,N;const a=t.original;return a.nextActionFull?r("div",{class:"text-sm"},[r("div",{class:`font-medium mb-0.5 ${((n=a.deadlineStatus)==null?void 0:n.textClass)||"text-gray-600"}`},a.nextActionFull),r("div",{class:`text-xs flex items-center gap-1 ${((k=a.deadlineStatus)==null?void 0:k.textClass)||"text-gray-500"}`},[(N=a.deadlineStatus)!=null&&N.icon?r("i",{class:`fa-solid ${a.deadlineStatus.icon} text-[10px]`}):null,r("span",a.nextAction)])]):"-"}},{accessorKey:"car",header:"Requested car",meta:{title:"Requested car"},cell:({row:t})=>r("div",{class:"flex items-center gap-2"},[r("i",{class:"fa-brands fa-volkswagen text-gray-400 text-sm"}),r("span",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},t.original.car)])},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:t})=>r("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${t.original.carStatusClass}`},t.original.carStatus)},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:t})=>r("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700"},t.original.source)},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:t})=>r("div",{class:"flex items-center gap-2"},[r("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},t.original.assigneeInitials),r("span",{class:"text-sm text-gray-600 truncate max-w-[80px] hidden md:inline"},t.original.assignee)])},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:t})=>r("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${t.original.statusClass}`},t.original.status)},{id:"actions",header:"",meta:{title:"Actions"},cell:()=>r("button",{class:"text-gray-400 hover:text-gray-600"},[r("i",{class:"fa-solid fa-ellipsis-vertical"})])}]);return(t,a)=>(v(),f("div",Fe,[E(Ce,{title:"Customers",subtitle:"Manage contacts, accounts, leads and opportunities"}),o("div",Le,[o("div",Me,[(v(!0),f(me,null,ge(te.value,n=>(v(),f("button",{key:n.key,onClick:k=>le(n.key),class:Y(["flex items-center justify-between gap-3 px-4 py-3 bg-white border border-border rounded-lg cursor-pointer hover:shadow-sm transition-all shrink-0 min-w-[160px] border-t-4",l.value===n.key?n.borderColor:"border-t-border"])},[o("span",Ee,W(n.label),1),o("span",{class:Y(["px-2.5 py-1 text-sm font-semibold rounded-full min-w-[32px] text-center",l.value===n.key?n.badgeColor:"bg-muted text-muted-foreground"])},W(n.count),3)],10,Re))),128))]),o("div",je,[l.value==="contacts"||l.value==="open-leads"||l.value==="open-opportunities"?(v(),f("button",{key:0,onClick:a[0]||(a[0]=n=>L.value=!0),class:"btn-primary-lg"},[...a[6]||(a[6]=[o("i",{class:"fa-solid fa-plus"},null,-1),ve(" Add new ",-1)])])):be("",!0)]),o("div",We,[E(ye(he),{data:J.value,columns:ie.value,meta:ne.value,columnFiltersOptions:{filterDefs:ee.value},pagination:z.value,"onUpdate:pagination":a[1]||(a[1]=n=>z.value=n),globalFilter:P.value,"onUpdate:globalFilter":a[2]||(a[2]=n=>P.value=n),sorting:Q.value,"onUpdate:sorting":a[3]||(a[3]=n=>Q.value=n),columnFilters:H.value,"onUpdate:columnFilters":a[4]||(a[4]=n=>H.value=n),paginationOptions:{rowCount:J.value.length},globalFilterOptions:{debounce:300}},{"empty-state":j(()=>[...a[7]||(a[7]=[o("div",{class:"empty-state"},[o("i",{class:"fa-solid fa-inbox empty-state-icon"}),o("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])]),E(Ke,{show:L.value,"active-tab":l.value,"initial-data":G.value,onClose:a[5]||(a[5]=n=>L.value=!1),onSave:ae},null,8,["show","active-tab","initial-data"])]))}};export{Ye as default};
