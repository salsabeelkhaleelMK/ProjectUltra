import{h as I,r as s,c as U,m as T,d as $,o as B,s as M,D as q,e as i,y as n}from"./index-B6fu4vW4.js";import{y as R}from"./components-BOXotWV0.js";import{a as V}from"./opportunities-Cpo2JN0p.js";import{g as z,b as E,c as G}from"./formatters-DjeI4Z8-.js";import{u as K}from"./useCustomersTable-Driou-yp.js";import"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-K7ki7z-B.js";const L={class:"table-wrapper w-full"},X={__name:"InNegotiationTab",setup(W){const A=I(),o=V(),r=s({pageIndex:0,pageSize:10}),l=s(""),u=s([]),c=s([]),d=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",m=U(()=>o.opportunities.filter(t=>t.stage==="In Negotiation"||t.stage==="In negotiation").map(t=>{var a,p,f,y,v,b,D,x,k,F,C,h;const e=((a=t.scheduledAppointment)==null?void 0:a.start)||null;return{id:`opp-${t.id}`,stageKey:"in-negotiation",customer:((p=t.customer)==null?void 0:p.name)||"Unknown",email:((f=t.customer)==null?void 0:f.email)||"",initials:((y=t.customer)==null?void 0:y.initials)||((b=(v=t.customer)==null?void 0:v.name)==null?void 0:b.slice(0,2).toUpperCase())||"?",nextAction:G(t.expectedCloseDate)||"No due date",nextActionFull:E(t.expectedCloseDate),deadlineStatus:z(t.expectedCloseDate),car:`${((D=t.vehicle)==null?void 0:D.brand)||""} ${((x=t.vehicle)==null?void 0:x.model)||""}`.trim()||"N/A",carStatus:((k=t.vehicle)==null?void 0:k.stockDays)!==void 0&&((F=t.vehicle)==null?void 0:F.stockDays)!==null?"In Stock":"Out of Stock",carStatusClass:((C=t.vehicle)==null?void 0:C.stockDays)!==void 0&&((h=t.vehicle)==null?void 0:h.stockDays)!==null?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body",requestType:t.requestType||"Opportunity",source:t.source||"Marketing",assignee:t.assignee,assigneeInitials:t.assignee?t.assignee.slice(0,2).toUpperCase():"NA",createdAt:d(t.createdAt),lastAppointment:e?d(e):"N/A",status:t.stage,statusClass:"bg-orange-100 text-orange-700",priority:t.priority||"Normal"}})),g=t=>{if(t.id.startsWith("opp-")){const e=t.id.match(/-(\d+)$/),a=e?e[1]:t.id.replace("opp-","");A.push({path:`/tasks/${a}`,query:{type:"opportunity"}})}},N=s("in-negotiation"),{columns:S,filterDefinitions:O,tableMeta:w}=K(N,g);return T(async()=>{await o.fetchOpportunities()}),(t,e)=>(B(),$("div",L,[M(n(R),{data:m.value,columns:n(S),meta:n(w),onRowClick:g,columnFiltersOptions:{filterDefs:n(O)},pagination:r.value,"onUpdate:pagination":e[0]||(e[0]=a=>r.value=a),globalFilter:l.value,"onUpdate:globalFilter":e[1]||(e[1]=a=>l.value=a),sorting:u.value,"onUpdate:sorting":e[2]||(e[2]=a=>u.value=a),columnFilters:c.value,"onUpdate:columnFilters":e[3]||(e[3]=a=>c.value=a),paginationOptions:{rowCount:m.value.length},globalFilterOptions:{debounce:300}},{"empty-state":q(()=>[...e[4]||(e[4]=[i("div",{class:"empty-state"},[i("i",{class:"fa-solid fa-inbox empty-state-icon"}),i("p",{class:"empty-state-text"},"No records found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])]))}};export{X as default};
