import{r as S,c as D,a as r,o as a,b as e,e as v,t as f,s as N,n as O,q as T,v as R,F as J,h as _,y as ee,z as ce,A as Re,j as U,B as ae,i as se,w as te,f as F,g as Q,k as V,C as gt,D as ft,T as he,E as we,G as je,u as Ce,l as Se,_ as vt,H as Ve,I as bt}from"./index-aIgEv3db.js";import{useOpportunitiesStore as Fe}from"./opportunities-DYkJa5UQ.js";import{_ as me}from"./ModalShell-DJ-4EQvF.js";import{f as ke,a as $e,b as ge,c as xt}from"./formatters-CNf1MjAs.js";import"./opportunities-P1PvtTvZ.js";const ht={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},wt={class:"h-16 px-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"},kt={class:"flex items-center gap-3"},$t={class:"font-bold text-lg text-gray-800"},Ct={key:0,class:"px-5 py-2 border-b border-gray-100 bg-gray-50/50"},St={class:"flex gap-2"},Dt={class:"px-5 py-3"},At={class:"relative"},Tt=["placeholder"],qt={class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},Ot=["onClick"],Nt=["onClick"],It={key:1,class:"absolute right-2 top-8 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Mt={class:"flex items-start gap-3.5 pr-6"},Rt={class:"flex-1 min-w-0"},jt={class:"font-bold text-gray-800 text-sm leading-snug truncate"},Vt={class:"text-gray-600 text-xs mt-1 truncate"},Ft={class:"text-right shrink-0"},Lt={class:"flex items-center gap-2 flex-wrap mt-3"},Ut={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:String,default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1}},emits:["select","menu-click","menu-close","filter-change","close"],setup(t,{emit:x}){const s={mounted(d,i){d.clickOutsideEvent=n=>{d===n.target||d.contains(n.target)||i.value()},document.addEventListener("click",d.clickOutsideEvent)},unmounted(d){document.removeEventListener("click",d.clickOutsideEvent)}},u=t,l=S(""),o=D(()=>{let d=u.items;if(u.typeFilter&&u.typeFilter!=="all"&&(d=d.filter(i=>i.type===u.typeFilter)),l.value){const i=l.value.toLowerCase();d=d.filter(n=>{const p=u.getName(n).toLowerCase(),y=u.getVehicleInfo(n).toLowerCase();return p.includes(i)||y.includes(i)})}return d}),m=d=>{const i=d.compositeId||`${d.type||"task"}-${d.id}`||d.id;return u.selectedId===i};return(d,i)=>(a(),r("div",ht,[e("div",wt,[e("div",kt,[t.showMobileClose?(a(),r("button",{key:0,onClick:i[0]||(i[0]=n=>d.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...i[5]||(i[5]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):v("",!0),e("h2",$t,f(t.title),1)]),i[6]||(i[6]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"text-xs font-medium bg-white hover:bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200"},[N(" Urgent first "),e("i",{class:"fa-solid fa-chevron-down text-[10px] ml-1"})])],-1))]),t.showTypeFilter?(a(),r("div",Ct,[e("div",St,[e("button",{onClick:i[1]||(i[1]=n=>d.$emit("filter-change","all")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:i[2]||(i[2]=n=>d.$emit("filter-change","lead")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:i[3]||(i[3]=n=>d.$emit("filter-change","opportunity")),class:O(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])])):v("",!0),e("div",Dt,[e("div",At,[i[7]||(i[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),T(e("input",{"onUpdate:modelValue":i[4]||(i[4]=n=>l.value=n),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Tt),[[R,l.value]])])]),e("div",qt,[(a(!0),r(J,null,_(o.value,n=>(a(),r("div",{key:n.id,onClick:p=>d.$emit("select",n.compositeId||`${n.type||"task"}-${n.id}`||n.id),class:O(["rounded-xl px-4 py-3.5 cursor-pointer transition-all relative group",m(n)?typeof t.selectedClass=="function"?t.selectedClass(n):t.selectedClass:typeof t.unselectedClass=="function"?t.unselectedClass(n):t.unselectedClass])},[t.showMenu?(a(),r("button",{key:0,onClick:ee(p=>d.$emit("menu-click",n.id),["stop"]),class:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors z-10"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)])],8,Nt)):v("",!0),t.openMenuId===n.id&&t.showMenu?T((a(),r("div",It,[ce(d.$slots,"menu",{item:n})])),[[s,()=>d.$emit("menu-close")]]):v("",!0),e("div",Mt,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold shrink-0",t.avatarClass(n)])},f(t.getInitials(n)),3),e("div",Rt,[e("div",jt,f(t.getName(n)),1),e("div",Vt,f(t.getVehicleInfo(n)),1)]),e("div",Ft,[ce(d.$slots,"meta",{item:n}),ce(d.$slots,"footer",{item:n})])]),e("div",Lt,[ce(d.$slots,"badges",{item:n})])],10,Ot))),128))])]))}},Et={class:"h-16 px-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3"},Bt={class:"flex items-center gap-3"},Wt={key:2,class:"font-bold text-lg text-gray-800"},Pt={key:0,class:"flex-1 overflow-y-auto px-5 py-6 scrollbar-hide relative"},zt={key:0,class:"absolute left-[39px] top-0 bottom-0 w-0.5 bg-gray-200 z-0"},Qt={key:1,class:"text-center py-8 text-gray-400 relative z-10"},Yt={class:"text-sm"},Ht={key:2,class:"space-y-6 relative z-10"},Jt={key:0,class:"mb-4 pl-12"},Kt={class:"text-sm font-semibold text-gray-800"},Gt={class:"flex gap-4 relative mb-6"},Xt={class:"flex-1 min-w-0"},Zt={class:"text-sm text-slate-700 leading-snug"},_t={class:"font-bold"},es={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-gray-700"},ts={class:"text-xs text-gray-400 mt-1"},Ie={__name:"ActivitySummarySidebar",props:{title:{type:String,default:"Activity summary"},activities:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No activities yet"},collapsed:{type:Boolean,default:!1},showCollapse:{type:Boolean,default:!0},show:{type:Boolean,default:!0},mobileFullscreen:{type:Boolean,default:!1}},emits:["toggle-collapse","close"],setup(t,{emit:x}){const s=t,u=i=>{const n={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-gray-600",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-gray-400"};return n[i]||n.default},l=i=>{const n={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-gray-100 text-gray-600",status:"bg-orange-100 text-orange-600",default:"bg-gray-100 text-gray-400"};return n[i]||n.default},o=i=>{if(!i)return"";const n=new Date(i),p=new Date,y=new Date(p);return y.setDate(y.getDate()-1),n.toDateString()===p.toDateString()?"Today":n.toDateString()===y.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},m=i=>i?new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",d=(i,n)=>{if(i===0)return!0;const p=s.activities[i-1];if(!p)return!0;const y=new Date(n.timestamp).toDateString(),g=new Date(p.timestamp).toDateString();return y!==g};return(i,n)=>t.show?(a(),r("div",{key:0,class:O(["bg-white border-l border-gray-200 shrink-0 flex flex-col transition-all duration-300",[t.collapsed?"w-16":"w-80",t.mobileFullscreen?"xl:relative xl:border-l":""]])},[e("div",Et,[e("div",Bt,[t.mobileFullscreen?(a(),r("button",{key:0,onClick:n[0]||(n[0]=p=>i.$emit("close")),class:"xl:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...n[2]||(n[2]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):t.showCollapse?(a(),r("button",{key:1,onClick:n[1]||(n[1]=p=>i.$emit("toggle-collapse")),class:"w-8 h-8 flex items-center justify-center rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors shrink-0",title:"Toggle Sidebar"},[e("i",{class:O(["fa-solid fa-arrow-right-from-bracket transition-transform duration-300",t.collapsed?"rotate-180":""])},null,2)])):v("",!0),t.collapsed?v("",!0):(a(),r("h2",Wt,f(t.title),1))])]),t.collapsed?v("",!0):(a(),r("div",Pt,[t.activities.length>0?(a(),r("div",zt)):v("",!0),t.activities.length===0?(a(),r("div",Qt,[n[3]||(n[3]=e("i",{class:"fa-solid fa-clock text-4xl mb-2"},null,-1)),e("p",Yt,f(t.emptyMessage),1)])):(a(),r("div",Ht,[(a(!0),r(J,null,_(t.activities,(p,y)=>(a(),r(J,{key:p.id},[d(y,p)?(a(),r("div",Jt,[e("h3",Kt,f(o(p.timestamp)),1)])):v("",!0),e("div",Gt,[e("div",{class:O(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-white",l(p.type)])},[e("i",{class:O([u(p.type),"text-sm"])},null,2)],2),e("div",Xt,[e("div",Zt,[e("span",_t,f(p.user),1),N(" "+f(p.action),1)]),p.content?(a(),r("div",es,f(p.content),1)):v("",!0),e("div",ts,f(m(p.timestamp)),1)])])],64))),128))]))]))],2)):v("",!0)}},ss={class:"w-full"},os={class:"flex items-center justify-between gap-3 md:gap-4"},ls={class:"flex items-center gap-3 md:gap-4 flex-1"},as={class:"min-w-0 flex-1"},ns={class:"heading-main truncate"},is={class:"flex flex-wrap items-center gap-2 mt-1"},rs={class:"flex items-center gap-1 ml-2"},ds={key:0,class:"mt-4 pt-4 border-t-2 border-dashed border-gray-300 animate-fade-in relative"},us={class:"flex items-center gap-4"},cs={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},ms={class:"flex items-center gap-2"},ps={class:"text-xs text-gray-900 font-medium"},ys={class:"flex items-center gap-2"},gs={class:"text-xs text-gray-900 font-medium"},fs={class:"flex items-center gap-2"},vs={class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},bs={key:0,class:"fa-solid fa-map-marker-alt text-gray-500 text-[10px]"},xs={key:1,class:"fa-regular fa-calendar text-gray-500 text-[10px]"},hs={class:"text-xs text-gray-900 font-medium"},ws={key:0,class:"absolute -bottom-6 left-0 px-2 py-1 bg-gray-900 text-white text-[10px] rounded shadow-lg whitespace-nowrap"},ks={__name:"ContactInfo",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"}},setup(t){const x=S(!1),s=S(null),u=async(l,o)=>{try{await navigator.clipboard.writeText(l),s.value=o,setTimeout(()=>{s.value=null},1500)}catch(m){console.error("Failed to copy:",m)}};return(l,o)=>(a(),r("div",ss,[e("div",os,[e("div",ls,[e("div",{class:O(["w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold border-2 border-white shadow-sm shrink-0",t.avatarColorClass])},f(t.initials),3),e("div",as,[e("h1",ns,f(t.name),1),e("div",is,[ce(l.$slots,"tags")])])]),e("div",rs,[e("button",{onClick:o[0]||(o[0]=m=>x.value=!x.value),class:"w-9 h-9 flex items-center justify-center bg-white border border-gray-200 rounded-lg hover:bg-gray-50 shrink-0"},[e("i",{class:O(["fa-solid fa-chevron-down text-sm transition-transform duration-200",{"rotate-180":x.value}])},null,2)])])]),x.value?(a(),r("div",ds,[e("div",us,[e("div",cs,[e("div",ms,[o[4]||(o[4]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-regular fa-envelope text-gray-500 text-[10px]"})],-1)),e("span",ps,f(t.email),1),e("button",{onClick:o[1]||(o[1]=ee(m=>u(t.email,"email"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy email"},[...o[3]||(o[3]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",ys,[o[6]||(o[6]=e("div",{class:"w-6 h-6 rounded bg-gray-100 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-phone text-gray-500 text-[10px]"})],-1)),e("span",gs,f(t.phone),1),e("button",{onClick:o[2]||(o[2]=ee(m=>u(t.phone,"phone"),["stop"])),class:"w-5 h-5 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0",title:"Copy phone"},[...o[5]||(o[5]=[e("i",{class:"fa-regular fa-copy text-[10px]"},null,-1)])])]),e("div",fs,[e("div",vs,[t.thirdFieldLabel.toLowerCase().includes("address")?(a(),r("i",bs)):(a(),r("i",xs))]),e("span",hs,f(t.thirdFieldValue),1)])])]),s.value?(a(),r("div",ws,f(s.value==="email"?"Email":"Phone")+" copied! ",1)):v("",!0)])):v("",!0)]))}},$s={class:"flex gap-8 text-base font-medium text-slate-500 py-1 overflow-x-auto scrollbar-hide"},Cs=["onClick"],Ss={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){return(x,s)=>(a(),r("div",$s,[(a(!0),r(J,null,_(t.tabs,u=>(a(),r("div",{key:u.key,onClick:l=>x.$emit("update:modelValue",u.key),class:O(["pb-2 border-b-2 cursor-pointer whitespace-nowrap transition-colors",t.modelValue===u.key?"border-slate-900 text-slate-900":"border-transparent hover:text-slate-700 hover:border-slate-200"])},[N(f(u.label)+" ",1),u.count!==void 0?(a(),r("span",{key:0,class:O(["ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold",t.modelValue===u.key?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500"])},f(u.count),3)):v("",!0)],10,Cs))),128))]))}},Ds={class:"metadata-bar w-full"},As={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Ts={class:"text-xs sm:text-sm font-bold text-gray-800"},qs={key:0,class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Os={class:"flex items-center gap-1 sm:gap-2"},Ns={class:"w-10 sm:w-16 bg-gray-200 rounded-full h-1.5 sm:h-2"},Is={class:"text-xs sm:text-sm font-bold text-gray-800"},Ms={key:1,class:"metadata-divider"},Rs={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},js={class:"text-xs sm:text-sm font-bold text-gray-800"},Vs={class:"flex items-center gap-1 sm:gap-2 px-1.5 py-1 sm:px-3 sm:py-1.5"},Fs={class:"text-xs sm:text-sm font-bold text-gray-800"},Ls={__name:"StageOwnerBar",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},probability:{type:Number,default:null}},setup(t){const x=t,s=D(()=>x.probability!==null&&x.probability!==void 0),u=D(()=>x.probability>=70?"bg-green-500":x.probability>=40?"bg-orange-500":"bg-red-500");return(l,o)=>(a(),r("div",Ds,[e("div",As,[o[0]||(o[0]=e("span",{class:"label-upper text-xs"},"Stage",-1)),e("span",Ts,f(t.stage),1)]),o[5]||(o[5]=e("div",{class:"metadata-divider"},null,-1)),s.value?(a(),r("div",qs,[o[1]||(o[1]=e("span",{class:"label-upper text-xs"},"Probability",-1)),e("div",Os,[e("div",Ns,[e("div",{class:O(["h-1.5 sm:h-2 rounded-full transition-all",u.value]),style:Re({width:t.probability+"%"})},null,6)]),e("span",Is,f(t.probability)+"%",1)])])):v("",!0),s.value?(a(),r("div",Ms)):v("",!0),e("div",Rs,[o[2]||(o[2]=e("span",{class:"label-upper text-xs"},"Owner",-1)),e("span",js,f(t.owner),1)]),t.source?(a(),r(J,{key:2},[o[4]||(o[4]=e("div",{class:"metadata-divider"},null,-1)),e("div",Vs,[o[3]||(o[3]=e("span",{class:"label-upper text-xs"},"Source",-1)),e("span",Fs,f(t.source),1)])],64)):v("",!0)]))}},Us={key:0,class:"flex-grow border-t border-gray-200"},Es={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-lg shadow-gray-100/50 z-10 overflow-hidden flex flex-col p-1"},Bs={key:0,class:"border-t border-gray-100 my-1"},Ws={key:1,class:"flex-grow border-t border-gray-200"},xe={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:x}){const s={mounted(b,c){b.clickOutsideEvent=$=>{b===$.target||b.contains($.target)||c.value()},document.addEventListener("click",b.clickOutsideEvent)},unmounted(b){document.removeEventListener("click",b.clickOutsideEvent)}},u=t,l=x,o=S(!1),m=D(()=>u.inline?"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 md:px-4 py-2 md:py-2 text-xs md:text-sm rounded-lg shadow-sm transition-all flex items-center justify-center gap-1.5 md:gap-2 z-20 relative whitespace-nowrap":"bg-gray-50 hover:bg-white border border-gray-200 text-slate-700 font-medium px-4 py-1.5 rounded-full text-sm shadow-sm transition-all flex items-center gap-2 z-20 relative"),d={note:"note",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},i=D(()=>{if(!u.activeTab||u.activeTab==="overview")return u.actions.filter(c=>!d[c]);const b=Object.entries(d).filter(([,c])=>c===u.activeTab).map(([c])=>c);return u.actions.filter(c=>b.includes(c))}),n=D(()=>i.value.some(b=>["email","whatsapp","sms"].includes(b))),p=D(()=>i.value.some(b=>["addVehicle","configureVehicle"].includes(b))),y=D(()=>i.value.some(b=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(b))),g=b=>{o.value=!1,l("action",b)};return(b,c)=>t.show?(a(),r("div",{key:0,class:O(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?v("",!0):(a(),r("div",Us)),e("div",{class:O(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:c[0]||(c[0]=ee($=>o.value=!o.value,["stop"])),class:O(m.value)},[...c[12]||(c[12]=[e("i",{class:"fa-solid fa-plus text-[10px] md:text-xs"},null,-1),e("span",{class:"text-xs md:text-sm"},"Add new",-1)])],2),o.value?T((a(),r("div",Es,[p.value?(a(),r(J,{key:0},[i.value.includes("addVehicle")?(a(),r("button",{key:0,onClick:c[1]||(c[1]=$=>g("addVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Add Vehicle ")):v("",!0),i.value.includes("configureVehicle")?(a(),r("button",{key:1,onClick:c[2]||(c[2]=$=>g("configureVehicle")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Configure Vehicle ")):v("",!0)],64)):v("",!0),y.value?(a(),r(J,{key:1},[p.value?(a(),r("div",Bs)):v("",!0),i.value.includes("note")?(a(),r("button",{key:1,onClick:c[3]||(c[3]=$=>g("note")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Note ")):v("",!0),i.value.includes("financing")?(a(),r("button",{key:2,onClick:c[4]||(c[4]=$=>g("financing")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Financing ")):v("",!0),i.value.includes("tradein")?(a(),r("button",{key:3,onClick:c[5]||(c[5]=$=>g("tradein")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Trade-in ")):v("",!0),i.value.includes("requestedCar")?(a(),r("button",{key:4,onClick:c[6]||(c[6]=$=>g("requestedCar")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Requested car ")):v("",!0),i.value.includes("purchase")?(a(),r("button",{key:5,onClick:c[7]||(c[7]=$=>g("purchase")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Purchase ")):v("",!0),i.value.includes("attachment")?(a(),r("button",{key:6,onClick:c[8]||(c[8]=$=>g("attachment")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium"}," Attachment ")):v("",!0)],64)):v("",!0),n.value?(a(),r(J,{key:2},[c[16]||(c[16]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),i.value.includes("email")?(a(),r("button",{key:0,onClick:c[9]||(c[9]=$=>g("email")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[13]||(c[13]=[e("i",{class:"fa-regular fa-envelope text-xs text-gray-400"},null,-1),N(" Send Email ",-1)])])):v("",!0),i.value.includes("whatsapp")?(a(),r("button",{key:1,onClick:c[10]||(c[10]=$=>g("whatsapp")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[14]||(c[14]=[e("i",{class:"fa-brands fa-whatsapp text-xs text-gray-400"},null,-1),N(" Send WhatsApp ",-1)])])):v("",!0),i.value.includes("sms")?(a(),r("button",{key:2,onClick:c[11]||(c[11]=$=>g("sms")),class:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors font-medium flex items-center gap-2"},[...c[15]||(c[15]=[e("i",{class:"fa-solid fa-comment-dots text-xs text-gray-400"},null,-1),N(" Send SMS ",-1)])])):v("",!0)],64)):v("",!0)])),[[s,()=>o.value=!1]]):v("",!0)],2),t.inline?v("",!0):(a(),r("div",Ws))],2)):v("",!0)}},Ps={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},zs={class:"flex items-start gap-3"},Qs={class:"flex-1 min-w-0"},Ys={class:"font-bold text-sm text-slate-800 mb-2"},Hs={class:"space-y-1.5 text-xs text-gray-600"},Js={class:"flex items-center gap-2"},Ks={class:"flex items-center gap-2"},Gs={class:"flex items-center gap-2"},Xs={key:0,class:"mt-2"},Zs={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const x=t,s=D(()=>x.appointmentData.date?new Date(x.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),u=D(()=>x.appointmentData.time?x.appointmentData.time:""),l=o=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[o==null?void 0:o.toLowerCase()]||"bg-gray-100 text-gray-700 border border-gray-200";return(o,m)=>(a(),r("div",Ps,[e("div",zs,[m[3]||(m[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Qs,[e("h4",Ys,f(t.appointmentData.type),1),e("div",Hs,[e("div",Js,[m[0]||(m[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,f(s.value),1)]),e("div",Ks,[m[1]||(m[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,f(u.value),1)]),e("div",Gs,[m[2]||(m[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,f(t.appointmentData.assignee),1)])]),t.appointmentData.status?(a(),r("div",Xs,[e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold",l(t.appointmentData.status)])},f(t.appointmentData.status),3)])):v("",!0)])])]))}},_s={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},eo={class:"flex-1"},to={class:"flex items-center gap-2 mb-1"},so={class:"text-xs font-bold text-slate-800"},oo={class:"text-[10px] text-gray-400"},lo={class:"text-[10px] text-gray-400"},ao={key:0,class:"bg-blue-50 text-blue-600 text-[9px] px-1.5 py-0.5 rounded border border-blue-100"},no={class:"ml-auto relative"},io={key:0,class:"absolute right-0 top-full mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"},ro={key:0,class:"text-sm text-slate-700"},uo={key:1,class:"text-sm text-slate-700 flex items-center gap-2"},co={key:2,class:"mt-2"},mo={key:0},po={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},yo={key:0},go={class:"text-sm font-bold text-slate-800"},fo={key:0,class:"text-xs text-gray-600 mt-0.5"},vo={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-gray-500 mt-2"},bo={key:0},xo={key:1},ho={key:2},wo={key:3},ko={key:4},$o={key:1},Co={class:"text-sm font-bold text-slate-800 mb-2"},So={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs"},Do={key:0},Ao={class:"text-slate-700 font-medium ml-1"},To={key:1},qo={class:"text-slate-700 font-medium ml-1"},Oo={key:2},No={class:"text-slate-700 font-medium ml-1"},Io={key:3},Mo={class:"text-slate-700 font-medium ml-1"},Ro={key:4},jo={class:"text-slate-700 font-medium ml-1"},Vo={key:5},Fo={class:"text-slate-700 font-medium ml-1"},Lo={key:2,class:"flex items-center gap-3"},Uo={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Eo=["src"],Bo={class:"flex-1"},Wo={class:"text-sm font-bold text-slate-800"},Po={class:"text-xs text-gray-500"},zo={key:1,class:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded"},Qo={key:3,class:"flex items-center gap-3"},Yo={class:"flex-1"},Ho={class:"text-sm font-bold text-slate-800"},Jo={class:"text-xs text-gray-500"},Ko={key:0,class:"text-xs text-gray-400 mt-1"},Go={key:1,class:"text-xs text-gray-600 mt-1"},Xo={__name:"TaskCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:x}){const s=t,u=x,l=S(!1),o={mounted(b,c){b.clickOutsideEvent=$=>{b===$.target||b.contains($.target)||c.value()},setTimeout(()=>{document.addEventListener("click",b.clickOutsideEvent)},0)},unmounted(b){document.removeEventListener("click",b.clickOutsideEvent)}},m=b=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart",appointment:"fa-solid fa-calendar"})[b]||"fa-solid fa-circle",d=b=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-gray-100 text-gray-600 border-gray-200",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-gray-100 text-gray-600 border-gray-200",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[b]||"bg-gray-100 text-gray-600 border-gray-200",i=b=>{if(!b)return"Just now";const c=new Date(b),q=new Date-c,M=Math.floor(q/6e4),L=Math.floor(M/60),B=Math.floor(L/24);return M<1?"Just now":M<60?`${M} minutes ago`:L<24?`${L} hours ago`:B===1?"Yesterday":B<7?`${B} days ago`:c.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},n=b=>b?new Intl.NumberFormat("en-US").format(b):"0",p=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",y=()=>{l.value=!1,u("edit",s.item)},g=()=>{l.value=!1,confirm("Are you sure you want to delete this item?")&&u("delete",s.item)};return(b,c)=>(a(),r("div",_s,[e("div",{class:O(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",d(t.item.type)])},[e("i",{class:O([m(t.item.type),"text-sm"])},null,2)],2),e("div",eo,[e("div",to,[e("span",so,f(t.customerInitials),1),e("span",oo,f(t.item.action||"added"),1),e("span",lo,"• "+f(i(t.item.timestamp)),1),t.item.autoDetected?(a(),r("span",ao,"Auto-detected")):v("",!0),e("div",no,[e("button",{onClick:c[0]||(c[0]=ee($=>l.value=!l.value,["stop"])),class:"text-gray-400 hover:text-gray-600 transition-colors p-1",title:"More actions"},[...c[1]||(c[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),l.value?T((a(),r("div",io,[e("button",{onClick:y,class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-pencil text-gray-400"},null,-1),N(" Edit ",-1)])]),e("button",{onClick:g,class:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2"},[...c[3]||(c[3]=[e("i",{class:"fa-solid fa-trash text-red-400"},null,-1),N(" Delete ",-1)])])])),[[o,()=>l.value=!1]]):v("",!0)])]),t.item.content?(a(),r("div",ro,f(t.item.content),1)):v("",!0),t.item.fileName?(a(),r("div",uo,[c[4]||(c[4]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,f(t.item.fileName),1)])):v("",!0),t.item.data?(a(),r("div",co,[t.item.type==="appointment"?(a(),r("div",mo,[U(Zs,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(a(),r("div",po,[t.item.type==="tradein"?(a(),r("div",yo,[e("h4",go,f(t.item.data.brand)+" "+f(t.item.data.model),1),t.item.data.version?(a(),r("p",fo,f(t.item.data.version),1)):v("",!0),e("div",vo,[t.item.data.year?(a(),r("div",bo,[c[5]||(c[5]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(f(t.item.data.year),1)])):v("",!0),t.item.data.km?(a(),r("div",xo,[c[6]||(c[6]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(f(t.item.data.km)+" km ",1)])):v("",!0),t.item.data.plate?(a(),r("div",ho,[c[7]||(c[7]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(f(t.item.data.plate),1)])):v("",!0),t.item.data.date?(a(),r("div",wo,[c[8]||(c[8]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(f(p(t.item.data.date)),1)])):v("",!0),t.item.data.class?(a(),r("div",ko,[c[9]||(c[9]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(f(t.item.data.class),1)])):v("",!0)])])):t.item.type==="financing"?(a(),r("div",$o,[e("h4",Co,f(t.item.data.product),1),e("div",So,[t.item.data.provider?(a(),r("div",Do,[c[10]||(c[10]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Ao,f(t.item.data.provider),1)])):v("",!0),t.item.data.total?(a(),r("div",To,[c[11]||(c[11]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",qo,"€"+f(n(t.item.data.total)),1)])):v("",!0),t.item.data.monthly?(a(),r("div",Oo,[c[12]||(c[12]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",No,"€"+f(n(t.item.data.monthly)),1)])):v("",!0),t.item.data.deposit?(a(),r("div",Io,[c[13]||(c[13]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Mo,"€"+f(n(t.item.data.deposit)),1)])):v("",!0),t.item.data.startDate?(a(),r("div",Ro,[c[14]||(c[14]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",jo,f(p(t.item.data.startDate)),1)])):v("",!0),t.item.data.expDate?(a(),r("div",Vo,[c[15]||(c[15]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",Fo,f(p(t.item.data.expDate)),1)])):v("",!0)])])):t.item.type==="offer"?(a(),r("div",Lo,[t.item.data.image?(a(),r("div",Uo,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Eo)])):v("",!0),e("div",Bo,[e("h4",Wo,f(t.item.data.brand)+" "+f(t.item.data.model)+" ("+f(t.item.data.year)+")",1),e("p",Po,"€ "+f(n(t.item.data.price)),1)]),t.item.data.isMainOffer?(a(),r("span",zo,"Main Offer")):v("",!0)])):t.item.type==="purchase"?(a(),r("div",Qo,[e("div",Yo,[e("h4",Ho,f(t.item.data.brand)+" "+f(t.item.data.model)+" ("+f(t.item.data.year)+")",1),e("p",Jo,"€ "+f(n(t.item.data.price)),1),t.item.data.purchaseDate?(a(),r("p",Ko,"Purchased: "+f(p(t.item.data.purchaseDate)),1)):v("",!0),t.item.data.notes?(a(),r("p",Go,f(t.item.data.notes),1)):v("",!0)])])):v("",!0)]))])):v("",!0)])]))}},Zo={class:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-6 animate-fade-in relative"},_o={class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},el={class:"mb-3"},tl={class:"flex justify-end gap-2"},sl={__name:"CommunicationWidget",props:{type:{type:String,required:!0},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(""),o=S(""),m=()=>{!l.value.trim()&&!o.value||u("save",{type:"communication",action:`sent via ${s.type}`,content:l.value||`Sent template: ${o.value}`,communicationType:s.type})};return(d,i)=>(a(),r("div",Zo,[i[5]||(i[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("h5",_o,f(t.type==="email"?"Send Email":t.type==="whatsapp"?"Send WhatsApp":t.type==="sms"?"Send SMS":"Send Message"),1),e("div",el,[i[4]||(i[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Template",-1)),T(e("select",{"onUpdate:modelValue":i[0]||(i[0]=n=>o.value=n),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 cursor-pointer"},[...i[3]||(i[3]=[e("option",{value:""},"Select a template...",-1),e("option",null,"Follow-up",-1),e("option",null,"Meeting Confirmation",-1),e("option",null,"Quote Proposal",-1),e("option",null,"Unable to Reach",-1)])],512),[[ae,o.value]])]),T(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=n=>l.value=n),class:"w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 resize-none mb-3",rows:"4",placeholder:"Type your message here..."},null,512),[[R,l.value]]),e("div",tl,[e("button",{onClick:i[2]||(i[2]=n=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:m,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Send")])]))}},ol={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},ll={class:"flex justify-between items-center mb-4"},al={class:"text-sm font-bold text-slate-800"},nl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},il={__name:"NoteWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S("");se(()=>{s.item&&(l.value=s.item.content||"")});const o=()=>{var m,d;l.value.trim()&&u("save",{id:((m=s.item)==null?void 0:m.id)||Date.now(),type:"note",action:s.item?"updated a note":"added a note",content:l.value,timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(m,d)=>(a(),r("div",ol,[d[5]||(d[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",ll,[e("h5",al,f(t.item?"Edit Note":"Add Note"),1),e("button",{onClick:d[0]||(d[0]=i=>m.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...d[3]||(d[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[d[4]||(d[4]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Note",-1)),T(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=i=>l.value=i),rows:"4",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Enter your note..."},null,512),[[R,l.value]])]),e("div",nl,[e("button",{onClick:d[2]||(d[2]=i=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:o,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save")])]))}},rl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},dl={class:"flex justify-between items-center mb-4"},ul={class:"text-sm font-bold text-slate-800"},cl={class:"flex items-center gap-3"},ml={key:0,class:"text-sm text-slate-600"},pl={key:1,class:"text-sm text-gray-400"},yl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},gl=["disabled"],fl={__name:"AttachmentWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(null),o=S("");se(()=>{s.item&&(o.value=s.item.fileName||"")});const m=i=>{const n=i.target.files[0];n&&(l.value=n,o.value=n.name)},d=()=>{var i,n;!l.value&&!s.item||u("save",{id:((i=s.item)==null?void 0:i.id)||Date.now(),type:"attachment",action:s.item?"updated an attachment":"added an attachment",fileName:o.value,timestamp:((n=s.item)==null?void 0:n.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(i,n)=>(a(),r("div",rl,[n[6]||(n[6]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",dl,[e("h5",ul,f(t.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:n[0]||(n[0]=p=>i.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",cl,[e("input",{type:"file",onChange:m,ref:"fileInput",class:"hidden"},null,544),e("button",{onClick:n[1]||(n[1]=p=>i.$refs.fileInput.click()),class:"bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm text-slate-700 transition-colors"},[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),N("Choose File ",-1)])]),o.value?(a(),r("span",ml,f(o.value),1)):(a(),r("span",pl,"No file selected"))])]),e("div",yl,[e("button",{onClick:n[2]||(n[2]=p=>i.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:d,disabled:!l.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,gl)])]))}},vl={class:"animate-fade-in"},bl={class:"space-y-4"},xl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},hl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},kl=["disabled"],$l={__name:"FinancingWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S({startDate:"",expDate:"",productName:"",deposit:"",loanAmount:""});se(()=>{s.item&&s.item.data&&(l.value={startDate:s.item.data.startDate||"",expDate:s.item.data.expDate||"",productName:s.item.data.product||s.item.data.productName||"",deposit:s.item.data.deposit||"",loanAmount:s.item.data.total||s.item.data.loanAmount||""})});const o=()=>{var m,d;l.value.productName&&u("save",{id:((m=s.item)==null?void 0:m.id)||Date.now(),type:"financing",action:s.item?"updated a financing proposal":"added a financing proposal",data:{product:l.value.productName,provider:"Audi Financial",total:l.value.loanAmount||"0",monthly:Math.round(parseFloat(l.value.loanAmount||0)/36).toString(),startDate:l.value.startDate,expDate:l.value.expDate,deposit:l.value.deposit},timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(m,d)=>(a(),r("div",vl,[e("div",bl,[e("div",xl,[e("div",null,[d[6]||(d[6]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Start date",-1)),T(e("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=i=>l.value.startDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.startDate]])]),e("div",null,[d[7]||(d[7]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Expiration date",-1)),T(e("input",{type:"date","onUpdate:modelValue":d[1]||(d[1]=i=>l.value.expDate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.expDate]])])]),e("div",null,[d[8]||(d[8]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Financial product name",-1)),T(e("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>l.value.productName=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.productName]])]),e("div",hl,[e("div",null,[d[9]||(d[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Deposit",-1)),T(e("input",{type:"number","onUpdate:modelValue":d[3]||(d[3]=i=>l.value.deposit=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.deposit]])]),e("div",null,[d[10]||(d[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Total loan amount",-1)),T(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=i=>l.value.loanAmount=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.loanAmount]])])])]),e("div",wl,[e("button",{onClick:d[5]||(d[5]=i=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:o,disabled:!l.value.productName,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,kl)])]))}},Cl={class:"animate-fade-in"},Sl={class:"space-y-4"},Dl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Al={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},ql=["disabled"],Ol={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S({class:"Car",brand:"",model:"",version:"",km:"",plate:"",date:""});se(()=>{s.item&&s.item.data&&(l.value={class:s.item.data.class||"Car",brand:s.item.data.brand||"",model:s.item.data.model||"",version:s.item.data.version||"",km:s.item.data.km||"",plate:s.item.data.plate||"",date:s.item.data.date||""})});const o=()=>{var m,d;l.value.brand&&u("save",{id:((m=s.item)==null?void 0:m.id)||Date.now(),type:"tradein",action:s.item?"updated a trade-in":"added a trade-in",data:{class:l.value.class,brand:l.value.brand,model:l.value.model||"Unknown Model",year:l.value.date?new Date(l.value.date).getFullYear():"Unknown Year",km:l.value.km||"0",plate:l.value.plate||"",date:l.value.date||""},timestamp:((d=s.item)==null?void 0:d.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(m,d)=>(a(),r("div",Cl,[e("div",Sl,[e("div",null,[d[9]||(d[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Class",-1)),T(e("select",{"onUpdate:modelValue":d[0]||(d[0]=i=>l.value.class=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},[...d[8]||(d[8]=[e("option",{value:"Car"},"Car",-1),e("option",{value:"Motorcycle"},"Motorcycle",-1),e("option",{value:"Truck"},"Truck",-1)])],512),[[ae,l.value.class]])]),e("div",Dl,[e("div",null,[d[10]||(d[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=i=>l.value.brand=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.brand]])]),e("div",null,[d[11]||(d[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>l.value.model=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.model]])])]),e("div",null,[d[12]||(d[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Version",-1)),T(e("input",{type:"text","onUpdate:modelValue":d[3]||(d[3]=i=>l.value.version=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.version]])]),e("div",Al,[e("div",null,[d[13]||(d[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Km",-1)),T(e("input",{type:"number","onUpdate:modelValue":d[4]||(d[4]=i=>l.value.km=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.km]])]),e("div",null,[d[14]||(d[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Plate",-1)),T(e("input",{type:"text","onUpdate:modelValue":d[5]||(d[5]=i=>l.value.plate=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.plate]])])]),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Registration date",-1)),T(e("input",{type:"date","onUpdate:modelValue":d[6]||(d[6]=i=>l.value.date=i),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.date]])])]),e("div",Tl,[e("button",{onClick:d[7]||(d[7]=i=>m.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:o,disabled:!l.value.brand,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,ql)])]))}},Nl={class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Il={class:"flex justify-between items-center mb-4"},Ml={class:"text-sm font-bold text-slate-800"},Rl={class:"space-y-4"},jl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},Ll=["disabled"],Ul={__name:"PurchaseWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S({brand:"",model:"",year:"",price:"",purchaseDate:"",notes:""});se(()=>{s.item&&s.item.data&&(l.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",purchaseDate:s.item.data.purchaseDate||"",notes:s.item.data.notes||""})});const o=D(()=>l.value.brand&&l.value.model&&l.value.price),m=()=>{var d,i;o.value&&u("save",{id:((d=s.item)==null?void 0:d.id)||Date.now(),type:"purchase",action:s.item?"updated a purchase":"added a purchase",data:{brand:l.value.brand,model:l.value.model,year:l.value.year||new Date().getFullYear(),price:l.value.price,purchaseDate:l.value.purchaseDate||new Date().toISOString().split("T")[0],notes:l.value.notes||""},timestamp:((i=s.item)==null?void 0:i.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(d,i)=>(a(),r("div",Nl,[i[15]||(i[15]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-gray-200 rotate-45"},null,-1)),e("div",Il,[e("h5",Ml,f(t.item?"Edit Purchase":"Add Purchase"),1),e("button",{onClick:i[0]||(i[0]=n=>d.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...i[8]||(i[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",Rl,[e("div",jl,[e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=n=>l.value.brand=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.brand]])]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=n=>l.value.model=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.model]])])]),e("div",Vl,[e("div",null,[i[11]||(i[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":i[3]||(i[3]=n=>l.value.year=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.year]])]),e("div",null,[i[12]||(i[12]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Price (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":i[4]||(i[4]=n=>l.value.price=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.price]])])]),e("div",null,[i[13]||(i[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Purchase Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":i[5]||(i[5]=n=>l.value.purchaseDate=n),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,l.value.purchaseDate]])]),e("div",null,[i[14]||(i[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Notes",-1)),T(e("textarea",{"onUpdate:modelValue":i[6]||(i[6]=n=>l.value.notes=n),rows:"3",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500 placeholder-gray-400 transition-colors shadow-sm resize-none",placeholder:"Additional purchase details..."},null,512),[[R,l.value.notes]])])]),e("div",Fl,[e("button",{onClick:i[7]||(i[7]=n=>d.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:m,disabled:!o.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,Ll)])]))}},El=t=>t==="note"?"note":["call","email","sms","whatsapp","communication"].includes(t)?"communication":t==="attachment"?"attachment":"overview";function Bl(t){const{store:x,taskId:s,getTabForItemType:u,isOverviewModalAction:l}=t,o=S("overview"),m=S(null),d=S(null),i=S("email"),n=S([]),p=D(()=>[...x.currentActivities.value,...n.value.filter(M=>!M.activityId)].filter(M=>{const L=u(M.type);return o.value==="overview"?L==="overview":L===o.value})),y=q=>(d.value=null,o.value==="overview"&&l(q)?{modalAction:q}:(["email","whatsapp","sms"].includes(q)?(i.value=q,m.value="communication"):m.value=q,null)),g=async q=>{var M;if(q.isEdit){const L=n.value.findIndex(B=>B.id===q.id);L>-1&&(n.value[L]={...n.value[L],...q}),(M=d.value)!=null&&M.activityId&&await x.updateActivity(s.value,d.value.activityId,{type:q.communicationType||q.type,user:"You",action:q.action,content:q.content,fileName:q.fileName,data:q.data})}else{const L=q.communicationType||q.type,B=await x.addActivity(s.value,{type:L,user:"You",action:q.action,content:q.content,fileName:q.fileName,data:q.data});n.value.push({id:B.id,type:L==="email"||L==="whatsapp"||L==="sms"?"communication":L,action:q.action,content:q.content,fileName:q.fileName,data:q.data,timestamp:B.timestamp,activityId:B.id})}m.value=null,d.value=null},b=()=>{m.value=null,d.value=null},c=q=>{d.value=q,m.value=q.type},$=async q=>{const M=n.value.findIndex(L=>L.id===q.id);M>-1&&n.value.splice(M,1),q.activityId&&await x.deleteActivity(s.value,q.activityId)};return te(o,()=>{m.value=null,d.value=null}),{activeTab:o,showInlineWidget:m,editingItem:d,communicationType:i,inlineContent:n,filteredInlineContent:p,handleAddNewAction:y,handleWidgetSave:g,handleWidgetCancel:b,handleEditItem:c,handleDeleteItem:$}}const Wl={class:"flex-1 flex flex-col overflow-hidden"},Pl={class:"bg-white border-b border-gray-200 shrink-0 shadow-sm"},zl={class:"px-4 md:px-8 py-4 md:py-6"},Ql={class:"flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full scrollbar-hide"},Yl={class:"mb-4"},Hl={class:"flex items-center justify-between gap-2 mb-3 md:mb-0"},Jl={key:0,class:"mb-6"},Kl={key:1,class:"space-y-6 mb-6"},Gl={key:3},Xl={key:4,class:"space-y-4 mb-6 px-1"},Zl={key:0,class:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},_l={class:"p-6"},ea={class:"flex justify-between items-center mb-4"},ta={class:"text-sm font-bold text-slate-800"},sa={key:1,class:"max-w-2xl w-full max-h-[90vh] overflow-y-auto"},oa={__name:"TaskShell",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0}},setup(t){const x=t,s=D(()=>x.task.id),u=S(!1),l=S(null),{activeTab:o,showInlineWidget:m,editingItem:d,communicationType:i,inlineContent:n,filteredInlineContent:p,handleAddNewAction:y,handleWidgetSave:g,handleWidgetCancel:b,handleEditItem:c,handleDeleteItem:$}=Bl({store:x.storeAdapter,taskId:s,getTabForItemType:El,isOverviewModalAction:z=>o.value==="overview"&&x.addNewConfig.overviewActions.includes(z)}),q=z=>{const W=y(z);W&&W.modalAction&&(l.value=W.modalAction,u.value=!0)},M=()=>{u.value=!1,l.value=null},L=async z=>{await g(z),M()},B=D(()=>{const z=[...x.storeAdapter.currentActivities.value,...n.value],W=z.length,I=z.filter(C=>["call","email","sms","whatsapp","communication"].includes(C.type)).length,X=z.filter(C=>C.type==="note").length,ne=z.filter(C=>C.type==="attachment").length;return[{key:"overview",label:"Overview",count:W},{key:"note",label:"Notes",count:X},{key:"communication",label:"Communication",count:I},{key:"attachment",label:"Attachments",count:ne}]}),oe=D(()=>[...x.storeAdapter.currentActivities.value,...n.value]);return(z,W)=>(a(),r("div",Wl,[e("header",Pl,[e("div",zl,[U(ks,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":t.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","email-label":"Email","phone-label":"Phone","third-field-label":"Address"},{tags:Q(()=>[(a(!0),r(J,null,_(t.task.tags,I=>(a(),r("span",{key:I,class:"badge-ui bg-blue-50 border-blue-100 text-blue-700 font-semibold"},f(I),1))),128))]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class"])])]),e("main",Ql,[e("div",Yl,[e("div",Hl,[U(Ss,{modelValue:V(o),"onUpdate:modelValue":W[0]||(W[0]=I=>gt(o)?o.value=I:null),tabs:B.value,class:"mb-0 flex-1 min-w-0"},null,8,["modelValue","tabs"]),V(o)==="overview"&&t.addNewConfig.overviewActions.length?(a(),F(xe,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":V(o),inline:!0,class:"hidden md:flex",onAction:q},null,8,["actions","active-tab"])):v("",!0)]),V(o)==="overview"&&t.addNewConfig.overviewActions.length?(a(),F(xe,{key:0,actions:t.addNewConfig.overviewActions,"active-tab":V(o),inline:!0,class:"flex md:hidden w-full",onAction:q},null,8,["actions","active-tab"])):v("",!0)]),V(o)==="overview"?(a(),r("div",Jl,[U(Ls,{stage:t.task.stage,owner:t.task.assignee,source:t.task.source||"",probability:t.task.probability},null,8,["stage","owner","source","probability"])])):v("",!0),V(o)==="overview"?(a(),r("div",Kl,[(a(),F(ft(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:oe.value},null,8,["lead","opportunity","activities"])),ce(z.$slots,"pinned-extra",{task:t.task})])):v("",!0),V(o)!=="overview"?(a(),F(xe,{key:2,actions:t.addNewConfig.tabActions,"active-tab":V(o),onAction:q},null,8,["actions","active-tab"])):v("",!0),V(o)!=="overview"?(a(),r("div",Gl,[V(m)==="communication"?(a(),F(sl,{key:0,type:V(i),"task-type":t.type,"task-id":t.task.id,onSave:V(g),onCancel:V(b)},null,8,["type","task-type","task-id","onSave","onCancel"])):v("",!0),V(m)==="note"?(a(),F(il,{key:1,item:V(d),"task-type":t.type,"task-id":t.task.id,onSave:V(g),onCancel:V(b)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0),V(m)==="attachment"?(a(),F(fl,{key:2,item:V(d),"task-type":t.type,"task-id":t.task.id,onSave:V(g),onCancel:V(b)},null,8,["item","task-type","task-id","onSave","onCancel"])):v("",!0)])):v("",!0),V(p).length>0?(a(),r("div",Xl,[(a(!0),r(J,null,_(V(p),I=>(a(),F(Xo,{key:I.id,item:I,"task-type":t.type,"customer-initials":"SK",onEdit:V(c),onDelete:V($)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):v("",!0)]),(a(),F(he,{to:"body"},[u.value?(a(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:ee(M,["self"])},[l.value==="financing"||l.value==="tradein"?(a(),r("div",Zl,[e("div",_l,[e("div",ea,[e("h5",ta,f(l.value==="financing"?"Add Financing":"Add Trade-in"),1),e("button",{onClick:M,class:"text-gray-400 hover:text-gray-600"},[...W[1]||(W[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),l.value==="financing"?(a(),F($l,{key:0,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])):v("",!0),l.value==="tradein"?(a(),F(Ol,{key:1,item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])):v("",!0)])])):v("",!0),l.value==="purchase"?(a(),r("div",sa,[U(Ul,{item:null,"task-type":t.type,"task-id":t.task.id,onSave:L,onCancel:M},null,8,["task-type","task-id"])])):v("",!0)])):v("",!0)]))]))}},la={key:0,class:"mb-8"},aa={class:"flex items-center gap-2 mb-4"},na={class:"font-bold text-gray-800 text-sm"},ia={class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden"},ra={class:"p-4"},da={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"},ua={class:"text-sm text-slate-700 leading-snug"},ca={class:"flex items-center justify-between"},ma={class:"flex items-center gap-4"},pa={class:"w-16 h-12 bg-gray-200 rounded-md overflow-hidden shrink-0 border border-gray-100"},ya=["src"],ga={key:1,class:"fa-solid fa-car text-3xl text-gray-400 w-full h-full flex items-center justify-center"},fa={class:"flex items-center gap-2"},va={class:"font-bold text-slate-800 text-sm md:text-base"},ba={class:"mt-1.5"},xa={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md"},ha={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-orange-50 border border-orange-100 text-orange-700 text-[10px] font-semibold rounded-md"},wa={class:"flex items-center gap-4"},ka={key:0,class:"hidden sm:flex items-center gap-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-200 text-slate-700 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors group/btn"},$a={key:1,class:"text-right"},Ca={class:"font-bold text-slate-800"},Sa={class:"border-t border-gray-200"},Da={class:"font-medium"},Aa={key:0,class:"border-t border-gray-100 p-6 bg-gray-50/30 text-sm animate-fade-in"},Ta={class:"mb-6"},qa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Oa={key:0},Na={class:"font-medium text-slate-700"},Ia={key:1},Ma={class:"font-medium text-slate-700"},Ra={key:2},ja={class:"font-medium text-slate-700"},Va={class:"font-medium text-slate-700"},Fa={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},La={key:0},Ua={class:"font-medium text-slate-700"},Ea={key:1},Ba={class:"font-medium text-slate-700"},Wa={key:2},Pa={class:"font-medium text-slate-700"},za={key:3},Qa={class:"font-medium text-slate-700"},Ya={key:4},Ha={class:"font-mono text-xs bg-white border border-gray-200 px-2 py-1 rounded inline-block text-gray-600"},Ja={key:5},Ka={class:"font-medium text-slate-700"},Ga={key:0,class:"mt-6 flex justify-end"},Me={__name:"RequestedVehicleWidget",props:{show:{type:Boolean,default:!0},label:{type:String,default:"Requested Car"},brand:{type:String,required:!0},model:{type:String,required:!0},year:{type:[Number,String],required:!0},image:{type:String,default:""},price:{type:Number,default:null},requestMessage:{type:String,default:""},requestType:{type:String,default:""},source:{type:String,default:""},dealership:{type:String,default:""},registration:{type:String,default:""},kilometers:{type:Number,default:null},fuelType:{type:String,default:""},gearType:{type:String,default:""},vin:{type:String,default:""},stockDays:{type:Number,default:null},showOpenAd:{type:Boolean,default:!0},showTechnicalSpecs:{type:Boolean,default:!0},channel:{type:String,default:"Email"},adCampaign:{type:String,default:""},expectedPurchaseDate:{type:String,default:""},fiscalEntity:{type:String,default:""},sourceDetails:{type:String,default:""},adMedium:{type:String,default:""},adSource:{type:String,default:""}},setup(t){const x=S(!1),s=l=>new Intl.NumberFormat("en-US").format(l),u=l=>new Intl.NumberFormat("en-US").format(l);return(l,o)=>t.show?(a(),r("div",la,[e("div",aa,[o[1]||(o[1]=e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"},null,-1)),e("h3",na,f(t.label),1)]),e("div",ia,[e("div",ra,[t.requestMessage?(a(),r("div",da,[o[2]||(o[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"},"Request message",-1)),e("p",ua,f(t.requestMessage),1)])):v("",!0),e("div",ca,[e("div",ma,[e("div",pa,[t.image?(a(),r("img",{key:0,src:t.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ya)):(a(),r("i",ga))]),e("div",null,[e("div",fa,[e("div",va,f(t.brand)+" "+f(t.model)+" ("+f(t.year)+")",1)]),e("div",ba,[t.stockDays!==void 0&&t.stockDays!==null?(a(),r("div",xa,[o[3]||(o[3]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+f(t.stockDays)+" days) ",1)])):(a(),r("div",ha,[...o[4]||(o[4]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])]))])])]),e("div",wa,[t.showOpenAd&&t.price?(a(),r("button",ka,[...o[5]||(o[5]=[N(" Open Ad ",-1),e("i",{class:"fa-solid fa-arrow-up-right-from-square text-[10px] text-gray-400 group-hover/btn:text-gray-800"},null,-1)])])):v("",!0),t.price?(a(),r("div",$a,[o[6]||(o[6]=e("div",{class:"text-xs text-gray-500 font-medium mb-0.5"},"Price",-1)),e("div",Ca,"€ "+f(s(t.price)),1)])):v("",!0)])])]),e("div",Sa,[e("button",{onClick:o[0]||(o[0]=m=>x.value=!x.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"},[e("span",Da,f(x.value?"Hide":"View")+" Details",1),e("i",{class:O(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":x.value}])},null,2)])]),x.value?(a(),r("div",Aa,[e("div",Ta,[o[17]||(o[17]=e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",qa,[t.requestType?(a(),r("div",Oa,[o[7]||(o[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Request type",-1)),e("div",Na,f(t.requestType),1)])):v("",!0),t.source?(a(),r("div",Ia,[o[8]||(o[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source",-1)),e("div",Ma,f(t.source),1)])):v("",!0),e("div",null,[o[9]||(o[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Source details",-1)),e("div",{class:O(["font-medium",t.sourceDetails?"text-slate-700":"text-gray-400"])},f(t.sourceDetails||"--"),3)]),t.dealership?(a(),r("div",Ra,[o[10]||(o[10]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",ja,f(t.dealership),1)])):v("",!0),e("div",null,[o[11]||(o[11]=e("div",{class:"text-xs text-gray-500 mb-1"},"Channel",-1)),e("div",Va,f(t.channel||"Email"),1)]),e("div",null,[o[12]||(o[12]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdCampaign",-1)),e("div",{class:O(["font-medium",t.adCampaign?"text-slate-700":"text-gray-400"])},f(t.adCampaign||"--"),3)]),e("div",null,[o[13]||(o[13]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdMedium",-1)),e("div",{class:O(["font-medium",t.adMedium?"text-slate-700":"text-gray-400"])},f(t.adMedium||"--"),3)]),e("div",null,[o[14]||(o[14]=e("div",{class:"text-xs text-gray-500 mb-1"},"AdSource",-1)),e("div",{class:O(["font-medium",t.adSource?"text-slate-700":"text-gray-400"])},f(t.adSource||"--"),3)]),e("div",null,[o[15]||(o[15]=e("div",{class:"text-xs text-gray-500 mb-1"},"Expected purchase date",-1)),e("div",{class:O(["font-medium",t.expectedPurchaseDate?"text-slate-700":"text-gray-400"])},f(t.expectedPurchaseDate||"--"),3)]),e("div",null,[o[16]||(o[16]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fiscal entity",-1)),e("div",{class:O(["font-medium",t.fiscalEntity?"text-slate-700":"text-gray-400"])},f(t.fiscalEntity||"--"),3)])])]),o[26]||(o[26]=e("div",{class:"border-t border-gray-200 my-4"},null,-1)),e("div",null,[o[25]||(o[25]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-gray-500 tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Fa,[t.registration?(a(),r("div",La,[o[18]||(o[18]=e("div",{class:"text-xs text-gray-500 mb-1"},"Registration",-1)),e("div",Ua,f(t.registration),1)])):v("",!0),t.kilometers!==void 0&&t.kilometers!==null?(a(),r("div",Ea,[o[19]||(o[19]=e("div",{class:"text-xs text-gray-500 mb-1"},"Kilometers",-1)),e("div",Ba,f(u(t.kilometers))+" Km",1)])):v("",!0),t.fuelType?(a(),r("div",Wa,[o[20]||(o[20]=e("div",{class:"text-xs text-gray-500 mb-1"},"Fuel type",-1)),e("div",Pa,f(t.fuelType),1)])):v("",!0),t.gearType?(a(),r("div",za,[o[21]||(o[21]=e("div",{class:"text-xs text-gray-500 mb-1"},"Gear type",-1)),e("div",Qa,f(t.gearType),1)])):v("",!0),t.vin?(a(),r("div",Ya,[o[22]||(o[22]=e("div",{class:"text-xs text-gray-500 mb-1"},"VIN Number",-1)),e("div",Ha,f(t.vin),1)])):v("",!0),t.dealership?(a(),r("div",Ja,[o[23]||(o[23]=e("div",{class:"text-xs text-gray-500 mb-1"},"Dealership",-1)),e("div",Ka,f(t.dealership),1)])):v("",!0)]),t.showTechnicalSpecs?(a(),r("div",Ga,[...o[24]||(o[24]=[e("button",{class:"bg-white border border-gray-200 text-slate-700 hover:text-blue-600 hover:border-blue-200 font-medium px-4 py-2 rounded-lg text-xs transition-colors flex items-center gap-2 group"},[e("i",{class:"fa-solid fa-list-check text-gray-400 group-hover:text-blue-500"}),N(" View technical specs ")],-1)])])):v("",!0)])])):v("",!0)])])):v("",!0)}},Xa={key:0,class:"border-t border-gray-200 p-5 bg-white transition-all"},Za={class:"grid grid-cols-3 gap-3 mb-4"},_a={class:"flex gap-3 mb-4"},Le={__name:"RescheduleWidget",props:{show:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:x}){const s=x,u=S(null),l=S(""),o=S(""),m=n=>{u.value=n;const p=new Date;if(n==="later-today"){const y=new Date(p.getTime()+72e5);l.value=y.toISOString().split("T")[0],o.value=y.toTimeString().slice(0,5)}else if(n==="tomorrow"){const y=new Date(p);y.setDate(y.getDate()+1),l.value=y.toISOString().split("T")[0],o.value="09:00"}else if(n==="next-week"){const y=new Date(p);y.setDate(y.getDate()+(7-y.getDay()+1)),l.value=y.toISOString().split("T")[0],o.value="09:00"}},d=()=>{s("confirm",{date:l.value,time:o.value,option:u.value}),s("close"),u.value=null,l.value="",o.value=""},i=()=>{s("close"),u.value=null,l.value="",o.value=""};return(n,p)=>t.show?(a(),r("div",Xa,[e("div",Za,[e("button",{onClick:p[0]||(p[0]=y=>m("later-today")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="later-today"}])},[...p[5]||(p[5]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Later Today",-1),e("span",{class:"text-[10px] text-gray-400"},"+2 Hours",-1)])],2),e("button",{onClick:p[1]||(p[1]=y=>m("tomorrow")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="tomorrow"}])},[...p[6]||(p[6]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Tomorrow",-1),e("span",{class:"text-[10px] text-gray-400"},"09:00 AM",-1)])],2),e("button",{onClick:p[2]||(p[2]=y=>m("next-week")),class:O(["flex flex-col items-center justify-center p-2 border border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group",{"border-blue-400 bg-blue-50":u.value==="next-week"}])},[...p[7]||(p[7]=[e("span",{class:"text-xs font-semibold text-slate-700 group-hover:text-blue-700"},"Next Week",-1),e("span",{class:"text-[10px] text-gray-400"},"Mon, 9 AM",-1)])],2)]),e("div",_a,[T(e("input",{"onUpdate:modelValue":p[3]||(p[3]=y=>l.value=y),type:"date",class:"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[R,l.value]]),T(e("input",{"onUpdate:modelValue":p[4]||(p[4]=y=>o.value=y),type:"time",class:"w-1/3 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"},null,512),[[R,o.value]])]),e("div",{class:"flex gap-3"},[e("button",{onClick:i,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:d,class:"flex-1 bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 rounded-lg text-sm transition-colors"}," Confirm New Time ")])])):v("",!0)}},en={key:0,class:"space-y-4 animate-fade-in"},tn={key:0,class:"animate-fade-in"},sn={class:"grid grid-cols-4 gap-2"},on=["onClick"],Ue={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(""),o=S("Michael Thomas (Me)"),m=S(""),d=S(!1),i=S("");te(()=>s.show,g=>{g||n()});const n=()=>{l.value="",o.value="Michael Thomas (Me)",m.value="",d.value=!1,i.value=""},p=()=>{!l.value||!m.value||!i.value||(u("confirm",{type:l.value,assignee:o.value,date:m.value,time:i.value}),n())},y=()=>{n(),u("cancel")};return(g,b)=>t.show?(a(),r("div",en,[e("div",null,[b[5]||(b[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),T(e("select",{"onUpdate:modelValue":b[0]||(b[0]=c=>l.value=c),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...b[4]||(b[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ae,l.value]])]),e("div",null,[b[7]||(b[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to Salesman",-1)),T(e("select",{"onUpdate:modelValue":b[1]||(b[1]=c=>o.value=c),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...b[6]||(b[6]=[e("option",null,"Michael Thomas (Me)",-1),e("option",null,"Sarah Jenkins",-1),e("option",null,"David Miller",-1),e("option",null,"Jessica Lee",-1)])],512),[[ae,o.value]])]),e("div",null,[b[8]||(b[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":b[2]||(b[2]=c=>m.value=c),onChange:b[3]||(b[3]=c=>d.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[R,m.value]])]),d.value?(a(),r("div",tn,[b[9]||(b[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",sn,[(a(),r(J,null,_(["09:00","10:30","11:00","14:30","15:00","16:30"],c=>e("button",{key:c,onClick:$=>i.value=c,class:O(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",i.value===c?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},f(c),11,on)),64))])])):v("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:y,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:p,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...b[10]||(b[10]=[N(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):v("",!0)}},ln={class:"space-y-6"},an={class:"flex gap-6"},nn={class:"flex items-center gap-2 cursor-pointer"},rn={class:"flex items-center gap-2 cursor-pointer"},dn=["disabled"],un={__name:"DisqualifyModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S("Not Interested"),o=S("");te(()=>s.show,i=>{i&&(l.value="Not Interested",o.value="")});const m=()=>{u("confirm",{category:l.value,reason:o.value})},d=()=>{u("cancel")};return(i,n)=>(a(),F(me,{show:t.show,title:"Disqualify Lead",subtitle:"Please select a reason for disqualification.",onCancel:d},{actions:Q(()=>[e("button",{onClick:m,disabled:!l.value||!o.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-6 py-3 rounded-lg text-base transition-colors"}," Confirm Disqualification ",8,dn)]),default:Q(()=>[e("div",ln,[e("div",null,[n[5]||(n[5]=e("label",{class:"block label-upper mb-3"},"Category",-1)),e("div",an,[e("label",nn,[T(e("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=p=>l.value=p),value:"Not Valid",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,l.value]]),n[3]||(n[3]=e("span",{class:"text-base text-gray-700"},"Not Valid",-1))]),e("label",rn,[T(e("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=p=>l.value=p),value:"Not Interested",class:"w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[we,l.value]]),n[4]||(n[4]=e("span",{class:"text-base text-gray-700"},"Not Interested",-1))])])]),e("div",null,[n[7]||(n[7]=e("label",{class:"block label-upper mb-3"},"Failure Reason",-1)),T(e("select",{"onUpdate:modelValue":n[2]||(n[2]=p=>o.value=p),class:"w-full bg-white border-2 border-red-500 rounded-lg px-4 py-3 text-base text-gray-700 focus:outline-none focus:border-red-600 transition-colors"},[...n[6]||(n[6]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Data cleanup"},"Data cleanup",-1),e("option",{value:"Unreachable"},"Unreachable",-1),e("option",{value:"Purchase postponed"},"Purchase postponed",-1),e("option",{value:"Vehicle sold"},"Vehicle sold",-1),e("option",{value:"Out of budget"},"Out of budget",-1),e("option",{value:"Financing rejected"},"Financing rejected",-1),e("option",{value:"Duplicate"},"Duplicate",-1),e("option",{value:"Bought elsewhere"},"Bought elsewhere",-1)])],512),[[ae,o.value]])])])]),_:1},8,["show"]))}},cn={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},mn={class:"flex justify-between items-start mb-3"},pn={class:"text-xs text-gray-500 mt-0.5"},yn={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},gn={class:"text-xs text-blue-700"},fn={class:"flex gap-3 flex-wrap"},vn={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},bn={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},xn={class:"flex items-center justify-between mb-4"},hn={__name:"LQWidget",props:{lead:{type:Object,required:!0}},emits:["postponed","validated","qualified","disqualified"],setup(t,{emit:x}){const s=t,u=x,l=S(!1),o=S(!1),m=S(!1),d=S(!1),i=D(()=>s.lead.stage==="Open Lead"?"Contact and qualify this lead":s.lead.stage==="Validated"?"Follow up with validated lead":"Complete lead qualification"),n=D(()=>s.lead.nextActionDue?new Date(s.lead.nextActionDue)<new Date:!1),p=D(()=>!!s.lead.scheduledAppointment),y=D(()=>p.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:n.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),g=()=>{l.value=!0},b=W=>{u("postponed",W),l.value=!1},c=()=>{o.value=!0},$=()=>{u("validated",{scheduleFollowUp:!1}),o.value=!1},q=()=>{o.value=!1,m.value=!0},M=W=>{u("validated",{scheduleFollowUp:!0,appointmentData:W}),m.value=!1},L=()=>{m.value=!1,u("validated",{scheduleFollowUp:!1})},B=()=>{u("qualified")},oe=()=>{d.value=!0},z=W=>{u("disqualified",W),d.value=!1};return(W,I)=>(a(),r("div",cn,[e("div",mn,[e("div",null,[I[3]||(I[3]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Qualification Task",-1)),e("p",pn,f(i.value),1)]),e("div",{class:O(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",y.value.class])},f(y.value.text),3)]),p.value?(a(),r("div",yn,[I[4]||(I[4]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",gn,f(V(ke)(t.lead.scheduledAppointment.start))+" at "+f(V($e)(t.lead.scheduledAppointment.start)),1)])):v("",!0),e("div",fn,[e("button",{onClick:g,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...I[5]||(I[5]=[N(" Postpone ",-1),e("i",{class:"fa-regular fa-clock text-xs"},null,-1)])]),e("button",{onClick:oe,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...I[6]||(I[6]=[N(" Disqualify ",-1),e("i",{class:"fa-solid fa-ban text-xs"},null,-1)])]),t.lead.stage==="Open Lead"?(a(),r("button",{key:0,onClick:c,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[...I[7]||(I[7]=[N(" Validate ",-1),e("i",{class:"fa-solid fa-check text-xs"},null,-1)])])):v("",!0),e("button",{onClick:B,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-green-200"},[...I[8]||(I[8]=[N(" Qualify ",-1),e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])]),U(Le,{show:l.value,onClose:I[0]||(I[0]=X=>l.value=!1),onConfirm:b},null,8,["show"]),o.value?(a(),r("div",vn,[e("div",bn,[e("div",xn,[I[10]||(I[10]=e("h3",{class:"text-lg font-bold text-gray-900"},"Validate Lead",-1)),e("button",{onClick:I[1]||(I[1]=X=>o.value=!1),class:"text-gray-400 hover:text-gray-600"},[...I[9]||(I[9]=[e("i",{class:"fa-solid fa-times"},null,-1)])])]),I[11]||(I[11]=e("p",{class:"text-sm text-gray-600 mb-4"},' Lead will be marked as "Validated". Would you like to schedule a follow-up call? ',-1)),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:$,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Just Validate "),e("button",{onClick:q,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2.5 rounded-lg text-sm transition-colors"}," Schedule Follow-up ")])])])):v("",!0),m.value?(a(),F(Ue,{key:2,show:m.value,onConfirm:M,onCancel:L},null,8,["show"])):v("",!0),U(un,{show:d.value,onConfirm:z,onCancel:I[2]||(I[2]=X=>d.value=!1)},null,8,["show"])]))}},wn={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"},kn={class:"p-5 space-y-6"},$n={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},setup(t){const x=t,s=Se(),u=je(),l=Ce(),o=async n=>{try{const p=new Date(`${n.date}T${n.time}:00`),y=p.toISOString();await u.modifyLead(x.lead.id,{nextActionDue:y}),await u.addActivity(x.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${ke(p)} at ${$e(p)}`}),await u.loadLeadById(x.lead.id)}catch(p){console.error("Failed to postpone lead task:",p)}},m=async n=>{try{if(await u.modifyLead(x.lead.id,{stage:"Validated"}),await u.addActivity(x.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),n.scheduleFollowUp&&n.appointmentData){const p=new Date(`${n.appointmentData.date}T${n.appointmentData.time}:00`);await u.scheduleFollowUp(x.lead.id,{dateTime:p.toISOString(),assignee:n.appointmentData.assignee||x.lead.assignee,assigneeId:n.appointmentData.assigneeId||1}),await u.addActivity(x.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${ke(p)} at ${$e(p)}`})}await u.loadLeadById(x.lead.id)}catch(p){console.error("Failed to validate lead:",p)}},d=async()=>{try{const n=await u.convertLeadToOpportunity(x.lead.id);l.canAccessOpportunities()?s.push({path:`/tasks/${n}`,query:{type:"opportunity"}}):s.push("/tasks/1")}catch(n){console.error("Failed to qualify lead:",n)}},i=async n=>{try{await u.modifyLead(x.lead.id,{isDisqualified:!0,disqualifyReason:n.reason,status:"Disqualified"}),await u.addActivity(x.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${n.category}, Reason: ${n.reason}`}),s.push("/tasks")}catch(p){console.error("Failed to disqualify lead:",p)}};return(n,p)=>t.lead?(a(),r("div",wn,[p[0]||(p[0]=e("div",{class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Lead Management")])],-1)),e("div",kn,[U(hn,{lead:t.lead,onPostponed:o,onValidated:m,onQualified:d,onDisqualified:i},null,8,["lead"])])])):v("",!0)}},Cn={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(t,{emit:x}){const s=x,u=()=>{s("close")};return(l,o)=>(a(),F(me,{show:t.show,title:t.title,onCancel:u},{footer:Q(()=>[e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:u,class:"bg-gray-800 hover:bg-gray-900 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Close ")])]),default:Q(()=>[o[0]||(o[0]=e("div",{class:"py-8 flex items-center justify-center"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")],-1))]),_:1},8,["show","title"]))}},Sn={class:"space-y-4"},Dn=["disabled"],An={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(""),o=S("");te(()=>s.show,i=>{i&&(l.value="",o.value="")});const m=()=>{l.value&&u("confirm",{reason:l.value,notes:o.value})},d=()=>{u("cancel")};return(i,n)=>(a(),F(me,{show:t.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:d},{actions:Q(()=>[e("button",{onClick:m,disabled:!l.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Dn)]),default:Q(()=>[e("div",Sn,[e("div",null,[n[3]||(n[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),T(e("select",{"onUpdate:modelValue":n[0]||(n[0]=p=>l.value=p),class:"input"},[...n[2]||(n[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ae,l.value]])]),e("div",null,[n[4]||(n[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),T(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=p=>o.value=p),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[R,o.value]])])])]),_:1},8,["show"]))}},Tn={class:"space-y-4"},qn=["max"],On=["disabled"],Nn={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(""),o=S(""),m=S(""),d=D(()=>new Date().toISOString().split("T")[0]);te(()=>s.show,p=>{if(p){const y=new Date;l.value=y.toISOString().split("T")[0],o.value=y.toTimeString().slice(0,5),m.value=""}});const i=()=>{if(!l.value)return;const p=o.value?`${l.value}T${o.value}:00`:`${l.value}T12:00:00`;u("confirm",{contractDate:p,notes:m.value})},n=()=>{u("cancel")};return(p,y)=>(a(),F(me,{show:t.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:n},{actions:Q(()=>[e("button",{onClick:i,disabled:!l.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,On)]),default:Q(()=>[e("div",Tn,[e("div",null,[y[3]||(y[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=g=>l.value=g),max:d.value,class:"input"},null,8,qn),[[R,l.value]])]),e("div",null,[y[4]||(y[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=g=>o.value=g),class:"input"},null,512),[[R,o.value]])]),e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),T(e("textarea",{"onUpdate:modelValue":y[2]||(y[2]=g=>m.value=g),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[R,m.value]])])])]),_:1},8,["show"]))}},In={class:"space-y-4"},Mn=["max"],Rn=["disabled"],jn={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(""),o=S(""),m=S(""),d=S(""),i=D(()=>new Date().toISOString().split("T")[0]);te(()=>s.show,y=>{if(y){const g=new Date;l.value=g.toISOString().split("T")[0],o.value=g.toTimeString().slice(0,5),m.value="",d.value=""}});const n=()=>{if(!l.value||!m.value)return;const y=o.value?`${l.value}T${o.value}:00`:`${l.value}T12:00:00`;u("confirm",{deliveryDate:y,location:m.value,notes:d.value})},p=()=>{u("cancel")};return(y,g)=>(a(),F(me,{show:t.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:p},{actions:Q(()=>[e("button",{onClick:n,disabled:!l.value||!m.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,Rn)]),default:Q(()=>[e("div",In,[e("div",null,[g[4]||(g[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":g[0]||(g[0]=b=>l.value=b),max:i.value,class:"input"},null,8,Mn),[[R,l.value]])]),e("div",null,[g[5]||(g[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),T(e("input",{type:"time","onUpdate:modelValue":g[1]||(g[1]=b=>o.value=b),class:"input"},null,512),[[R,o.value]])]),e("div",null,[g[7]||(g[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),T(e("select",{"onUpdate:modelValue":g[2]||(g[2]=b=>m.value=b),class:"input"},[...g[6]||(g[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ae,m.value]])]),e("div",null,[g[8]||(g[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),T(e("textarea",{"onUpdate:modelValue":g[3]||(g[3]=b=>d.value=b),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[R,d.value]])])])]),_:1},8,["show"]))}},Vn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t){return(x,s)=>(a(),F(me,{show:t.show,title:"Requalify as Lead",size:"lg",onCancel:s[1]||(s[1]=u=>x.$emit("cancel"))},{header:Q(()=>[...s[2]||(s[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:Q(()=>[e("button",{onClick:s[0]||(s[0]=u=>x.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:Q(()=>[s[3]||(s[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),N(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage, probability, and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),N(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),N(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},Fn={class:"bg-white rounded-xl p-5 mb-6 animate-fade-in relative"},Ln={class:"flex justify-between items-center mb-4"},Un={class:"text-sm font-bold text-slate-800"},En={key:0,class:"mb-4"},Bn={class:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2"},Wn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Pn=["src"],zn={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},Qn={class:"flex-1 min-w-0"},Yn={class:"flex items-center gap-2 flex-wrap"},Hn={class:"font-bold text-sm text-gray-800 truncate"},Jn={class:"text-xs text-gray-500"},Kn={key:0,class:"text-[10px] text-green-600 mt-0.5"},Gn={key:1,class:"text-[10px] text-orange-600 mt-0.5"},Xn=["onClick"],Zn={class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},_n=["src"],ei={key:1,class:"fa-solid fa-car text-gray-400 w-full h-full flex items-center justify-center"},ti={class:"flex-1 min-w-0"},si={class:"flex items-center gap-2 flex-wrap"},oi={class:"font-bold text-sm text-gray-800 truncate"},li={class:"text-xs text-gray-500"},ai={key:0,class:"text-[10px] text-green-600 mt-0.5"},ni={key:1,class:"text-center py-4 text-gray-400 text-sm"},ii={class:"mb-4"},ri={key:0,class:"flex items-center gap-2 mb-2"},di={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ui={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},ci={class:"mt-4"},mi={class:"flex justify-end gap-2 mt-6 border-t border-gray-100 pt-4"},pi=["disabled"],yi={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(t,{emit:x}){const s=t,u=x,l=S(null),o=S(null),m=S({brand:"",model:"",year:"",price:"",image:""});se(()=>{s.item&&s.item.data&&(m.value={brand:s.item.data.brand||"",model:s.item.data.model||"",year:s.item.data.year||"",price:s.item.data.price||"",image:s.item.data.image||""})});const d=y=>{if(l.value=y,s.requestedCar){const g=y.id&&s.requestedCar.id&&y.id===s.requestedCar.id||y.brand===s.requestedCar.brand&&y.model===s.requestedCar.model&&y.year===s.requestedCar.year;o.value=g?"requested":"recommended"}else o.value="recommended";m.value={brand:y.brand||"",model:y.model||"",year:y.year||new Date().getFullYear(),price:y.price||"",image:y.image||""}},i=D(()=>l.value||m.value.brand&&m.value.model&&m.value.price),n=y=>new Intl.NumberFormat("en-US").format(y),p=()=>{var g,b;const y=l.value||m.value;u("save",{id:((g=s.item)==null?void 0:g.id)||Date.now(),type:"offer",action:s.item?"updated an offer":"added an offer",data:{brand:y.brand,model:y.model,year:y.year||new Date().getFullYear(),price:y.price,image:y.image||"",isMainOffer:!1},timestamp:((b=s.item)==null?void 0:b.timestamp)||new Date().toISOString(),isEdit:!!s.item})};return(y,g)=>{var b,c;return a(),r("div",Fn,[e("div",Ln,[e("h5",Un,f(t.item?"Edit Offer":"Add Offer"),1),e("button",{onClick:g[0]||(g[0]=$=>y.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[...g[8]||(g[8]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),t.item?v("",!0):(a(),r("div",En,[g[11]||(g[11]=e("label",{class:"block text-xs font-medium text-slate-700 mb-2"},"Select a vehicle",-1)),e("div",Bn,[t.requestedCar?(a(),r("div",{key:0,onClick:g[1]||(g[1]=$=>d(t.requestedCar)),class:O(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((b=l.value)==null?void 0:b.id)===t.requestedCar.id}])},[e("div",Wn,[t.requestedCar.image?(a(),r("img",{key:0,src:t.requestedCar.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Pn)):(a(),r("i",zn))]),e("div",Qn,[e("div",Yn,[e("h4",Hn,f(t.requestedCar.brand)+" "+f(t.requestedCar.model)+" ("+f(t.requestedCar.year)+")",1),e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((c=l.value)==null?void 0:c.id)===t.requestedCar.id&&o.value==="requested","bg-blue-100 text-blue-700 border border-blue-200")])}," Requested ",2)]),e("p",Jn,"€ "+f(n(t.requestedCar.price)),1),t.requestedCar.stockDays!==null&&t.requestedCar.stockDays!==void 0?(a(),r("div",Kn," In stock ("+f(t.requestedCar.stockDays)+" days) ",1)):(a(),r("div",Gn," Out of stock "))]),g[9]||(g[9]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],2)):v("",!0),(a(!0),r(J,null,_(t.recommendedCars,$=>{var q,M;return a(),r("div",{key:$.id,onClick:L=>d($),class:O(["flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-colors",{"border-blue-400 bg-blue-50":((q=l.value)==null?void 0:q.id)===$.id}])},[e("div",Zn,[$.image?(a(),r("img",{key:0,src:$.image,alt:"Car",class:"w-full h-full object-cover"},null,8,_n)):(a(),r("i",ei))]),e("div",ti,[e("div",si,[e("h4",oi,f($.brand)+" "+f($.model)+" ("+f($.year)+")",1),e("span",{class:O(["inline-flex px-2 py-0.5 rounded text-[10px] font-semibold shrink-0",(((M=l.value)==null?void 0:M.id)===$.id&&o.value==="recommended","bg-purple-100 text-purple-700 border border-purple-200")])}," Recommended ",2)]),e("p",li,"€ "+f(n($.price)),1),$.stockDays!==null&&$.stockDays!==void 0?(a(),r("div",ai," In stock ("+f($.stockDays)+" days) ",1)):v("",!0)]),g[10]||(g[10]=e("i",{class:"fa-solid fa-chevron-right text-gray-400"},null,-1))],10,Xn)}),128)),!t.requestedCar&&t.recommendedCars.length===0?(a(),r("div",ni," No vehicles available ")):v("",!0)])])),e("div",ii,[t.requestedCar||t.recommendedCars.length>0?(a(),r("div",ri,[...g[12]||(g[12]=[e("div",{class:"flex-grow border-t border-gray-200"},null,-1),e("span",{class:"text-xs text-gray-400 uppercase font-semibold"},"Or create manually",-1),e("div",{class:"flex-grow border-t border-gray-200"},null,-1)])])):v("",!0),e("div",di,[e("div",null,[g[13]||(g[13]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Brand",-1)),T(e("input",{type:"text","onUpdate:modelValue":g[2]||(g[2]=$=>m.value.brand=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,m.value.brand]])]),e("div",null,[g[14]||(g[14]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Model",-1)),T(e("input",{type:"text","onUpdate:modelValue":g[3]||(g[3]=$=>m.value.model=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,m.value.model]])])]),e("div",ui,[e("div",null,[g[15]||(g[15]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Year",-1)),T(e("input",{type:"number","onUpdate:modelValue":g[4]||(g[4]=$=>m.value.year=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,m.value.year]])]),e("div",null,[g[16]||(g[16]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Price (€)",-1)),T(e("input",{type:"number","onUpdate:modelValue":g[5]||(g[5]=$=>m.value.price=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700"},null,512),[[R,m.value.price]])])]),e("div",ci,[g[17]||(g[17]=e("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Image URL (optional)",-1)),T(e("input",{type:"text","onUpdate:modelValue":g[6]||(g[6]=$=>m.value.image=$),class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-slate-700",placeholder:"https://..."},null,512),[[R,m.value.image]])])]),e("div",mi,[e("button",{onClick:g[7]||(g[7]=$=>y.$emit("cancel")),class:"text-xs font-medium text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e("button",{onClick:p,disabled:!i.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-blue-200"},"Save",8,pi)])])}}},gi={key:0,class:"mb-8"},fi={class:"relative"},vi={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth",style:{"scroll-behavior":"smooth"}},bi={class:"w-full h-36 bg-gray-200 flex items-center justify-center overflow-hidden"},xi=["src"],hi={key:1,class:"fa-solid fa-car text-4xl text-gray-400"},wi={class:"p-4"},ki={class:"font-bold text-gray-800 text-sm mb-1"},$i={class:"text-xs text-gray-500 mb-2"},Ci={key:0,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-[10px] font-semibold rounded-md mb-2"},Si=["onClick"],Di={__name:"RecommendedCarsSlider",emits:["add-to-opportunity"],setup(t,{emit:x}){const s=S([]);se(()=>{s.value=Ve.filter(l=>l.stockDays!==null&&l.stockDays!==void 0).slice(0,5)});const u=l=>new Intl.NumberFormat("en-US").format(l);return(l,o)=>s.value.length>0?(a(),r("div",gi,[o[1]||(o[1]=e("h3",{class:"font-bold text-gray-800 text-sm mb-4"},"Recommended Cars",-1)),e("div",fi,[e("div",vi,[(a(!0),r(J,null,_(s.value,m=>(a(),r("div",{key:m.id,class:"flex-none w-64 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow"},[e("div",bi,[m.image?(a(),r("img",{key:0,src:m.image,alt:"Car",class:"w-full h-full object-cover"},null,8,xi)):(a(),r("i",hi))]),e("div",wi,[e("h4",ki,f(m.brand)+" "+f(m.model)+" ("+f(m.year)+")",1),e("p",$i,"€ "+f(u(m.price)),1),m.stockDays!==null&&m.stockDays!==void 0?(a(),r("div",Ci,[o[0]||(o[0]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+f(m.stockDays)+" days) ",1)])):v("",!0),e("button",{onClick:d=>l.$emit("add-to-opportunity",m),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm shadow-sm transition-colors mt-2"}," Add to opportunity ",8,Si)])]))),128))])])])):v("",!0)}},Ai=vt(Di,[["__scopeId","data-v-894833e6"]]),Ti={class:"mt-1.5 border-t border-gray-200 pt-1.5"},qi={key:1},Oi={class:"flex items-center justify-between mb-1.5"},Ni={class:"space-y-1.5"},Ii={class:"block label-upper mb-1"},Mi=["onUpdate:modelValue","placeholder"],Ri=["onUpdate:modelValue"],ji=["value"],Vi={key:2,class:"space-y-0.5"},Fi=["onUpdate:modelValue","value"],ue={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=S(!1),o=S({});te(()=>s.questions,p=>{const y={};p.forEach(g=>{y[g.key]=""}),o.value=y},{immediate:!0});const m=()=>{u("survey-completed",{...o.value}),n()},d=()=>{u("survey-refused"),n()},i=()=>{u("not-responding"),n()},n=()=>{l.value=!1;const p={};s.questions.forEach(y=>{p[y.key]=""}),o.value=p};return(p,y)=>(a(),r("div",Ti,[l.value?(a(),r("div",qi,[e("div",Oi,[y[4]||(y[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:y[1]||(y[1]=g=>l.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...y[3]||(y[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",Ni,[(a(!0),r(J,null,_(t.questions,(g,b)=>(a(),r("div",{key:b,class:"bg-gray-50 rounded-md p-1.5"},[e("label",Ii,f(g.label),1),g.type==="text"?T((a(),r("textarea",{key:0,"onUpdate:modelValue":c=>o.value[g.key]=c,placeholder:g.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Mi)),[[R,o.value[g.key]]]):g.type==="select"?T((a(),r("select",{key:1,"onUpdate:modelValue":c=>o.value[g.key]=c,class:"input text-xs py-1 px-2"},[y[5]||(y[5]=e("option",{value:""},"Select an option...",-1)),(a(!0),r(J,null,_(g.options,c=>(a(),r("option",{key:c,value:c},f(c),9,ji))),128))],8,Ri)),[[ae,o.value[g.key]]]):g.type==="radio"?(a(),r("div",Vi,[(a(!0),r(J,null,_(g.options,c=>(a(),r("label",{key:c,class:"flex items-center text-xs"},[T(e("input",{type:"radio","onUpdate:modelValue":$=>o.value[g.key]=$,value:c,class:"mr-1"},null,8,Fi),[[we,o.value[g.key]]]),N(" "+f(c),1)]))),128))])):v("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:m,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:i,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(a(),r("button",{key:0,onClick:y[0]||(y[0]=g=>l.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...y[2]||(y[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Li={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Ui={class:"flex justify-between items-start mb-3"},Ei={class:"text-xs text-gray-500 mt-0.5"},Bi={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],o=D(()=>{if(!s.opportunity.createdAt)return 0;const y=new Date(s.opportunity.createdAt),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),m=()=>{u("create-offer",s.opportunity)},d=()=>{u("review",s.opportunity)},i=y=>{u("survey-completed",{opportunity:s.opportunity,responses:y})},n=()=>{u("survey-refused",{opportunity:s.opportunity})},p=()=>{u("not-responding",{opportunity:s.opportunity})};return(y,g)=>(a(),r("div",Li,[e("div",Ui,[e("div",null,[g[0]||(g[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Ei,"This opportunity has been open for "+f(o.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:m,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),U(ue,{questions:l,onSurveyCompleted:i,onSurveyRefused:n,onNotResponding:p})]))}},Wi={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Pi={class:"flex justify-between items-start mb-3"},zi={class:"text-xs text-gray-500 mt-0.5"},Qi={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],o=D(()=>{if(!s.opportunity.createdAt)return 0;const p=new Date(s.opportunity.createdAt),g=Math.abs(new Date-p);return Math.ceil(g/(1e3*60*60*24))}),m=()=>{u("create-offer",s.opportunity)},d=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),r("div",Wi,[e("div",Pi,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",zi,"This opportunity has been open for "+f(o.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:m,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),U(ue,{questions:l,onSurveyCompleted:d,onSurveyRefused:i,onNotResponding:n})]))}},Yi={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Hi={class:"flex justify-between items-start mb-3"},Ji={class:"text-xs text-gray-500 mt-0.5"},Ki={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],o=D(()=>{const p=s.opportunity.lastActivity||s.opportunity.createdAt;if(!p)return 0;const y=new Date(p),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),m=()=>{u("create-contract",s.opportunity)},d=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),r("div",Yi,[e("div",Hi,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Ji,"This opportunity has been in negotiation for "+f(o.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:m,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),U(ue,{questions:l,onSurveyCompleted:d,onSurveyRefused:i,onNotResponding:n})]))}},Gi={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Xi={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],o=()=>{u("schedule-closing",s.opportunity)},m=n=>{u("survey-completed",{opportunity:s.opportunity,responses:n})},d=()=>{u("survey-refused",{opportunity:s.opportunity})},i=()=>{u("not-responding",{opportunity:s.opportunity})};return(n,p)=>(a(),r("div",Gi,[p[0]||(p[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:o,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),U(ue,{questions:l,onSurveyCompleted:m,onSurveyRefused:d,onNotResponding:i})]))}},Zi={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},_i={class:"flex justify-between items-start mb-3"},er={class:"font-bold text-slate-800 text-sm"},tr={class:"text-xs text-gray-500 mt-0.5"},sr={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost"],setup(t,{emit:x}){const s=t,u=x,l=D(()=>{var c;return((c=s.scheduledAppointment)==null?void 0:c.noShowCount)||0}),o=D(()=>{const c=l.value;return c===0?"No-Show Follow-up":c>=3?`No-Show #${c} - Final Warning`:`No-Show #${c} Follow-up`}),m=D(()=>{const c=l.value;return c>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":c>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),d=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],i=D(()=>{var $;return($=s.scheduledAppointment)!=null&&$.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),n=()=>{u("contact-customer",s.opportunity)},p=()=>{l.value>=3?u("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${l.value} no-shows`}):u("reschedule",s.opportunity)},y=c=>{u("survey-completed",{opportunity:s.opportunity,responses:c})},g=()=>{u("survey-refused",{opportunity:s.opportunity})},b=()=>{u("not-responding",{opportunity:s.opportunity})};return(c,$)=>(a(),r("div",Zi,[e("div",_i,[e("div",null,[e("h4",er,f(o.value),1),e("p",tr,"Appointment was scheduled for "+f(i.value)+" but customer did not show up. "+f(m.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:p,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...$[0]||($[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),N(" Book Another Appointment ",-1)])]),e("button",{onClick:n,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...$[1]||($[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),N(" Contact Customer ",-1)])])]),U(ue,{questions:d,onSurveyCompleted:y,onSurveyRefused:g,onNotResponding:b})]))}},or={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},lr={class:"flex justify-between items-start mb-3"},ar={class:"text-xs text-gray-500 mt-0.5"},nr={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],o=D(()=>{var c;if(!((c=s.opportunity)!=null&&c.contractDate))return 0;const y=new Date(s.opportunity.contractDate),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),m=()=>{u("prepare-delivery",s.opportunity)},d=()=>{u("pre-delivery-checklist",s.opportunity)},i=y=>{u("survey-completed",{opportunity:s.opportunity,responses:y})},n=()=>{u("survey-refused",{opportunity:s.opportunity})},p=()=>{u("not-responding",{opportunity:s.opportunity})};return(y,g)=>(a(),r("div",or,[e("div",lr,[e("div",null,[g[0]||(g[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",ar,"Contract was signed "+f(o.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:m,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:d,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),U(ue,{questions:l,onSurveyCompleted:i,onSurveyRefused:n,onNotResponding:p})]))}},ir={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},rr={class:"flex justify-between items-start mb-3"},dr={class:"text-xs text-gray-500 mt-0.5"},ur={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:x}){const s=t,u=x,l=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],o=D(()=>{const p=s.activities.find(c=>{var $;return c.type==="delivery"||(($=c.action)==null?void 0:$.toLowerCase().includes("delivered"))});if(!p||!p.timestamp)return 0;const y=new Date(p.timestamp),b=Math.abs(new Date-y);return Math.ceil(b/(1e3*60*60*24))}),m=()=>{u("delivery-feedback",s.opportunity)},d=p=>{u("survey-completed",{opportunity:s.opportunity,responses:p})},i=()=>{u("survey-refused",{opportunity:s.opportunity})},n=()=>{u("not-responding",{opportunity:s.opportunity})};return(p,y)=>(a(),r("div",ir,[e("div",rr,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",dr,"Vehicle was delivered "+f(o.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:m,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),U(ue,{questions:l,onSurveyCompleted:d,onSurveyRefused:i,onNotResponding:n})]))}},cr={class:"bg-gray-50/50 border border-gray-200 rounded-lg p-4 relative transition-all duration-300"},mr={__name:"CloseOpportunityWidget",props:{opportunity:{type:Object,required:!0}},emits:["close-won","close-lost"],setup(t,{emit:x}){const s=t,u=x,l=()=>{u("close-won",s.opportunity)},o=()=>{u("close-lost",s.opportunity)};return(m,d)=>(a(),r("div",cr,[d[2]||(d[2]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Close Opportunity"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Mark this opportunity as won or lost to close the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:l,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...d[0]||(d[0]=[N(" Close as Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])]),e("button",{onClick:o,class:"bg-white hover:bg-red-50 border border-gray-200 text-slate-700 hover:text-red-600 hover:border-red-200 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...d[1]||(d[1]=[N(" Close as Lost ",-1),e("i",{class:"fa-solid fa-times-circle"},null,-1)])])])]))}},pr={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8"},yr={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},gr={class:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-medium"},fr={class:"p-5 space-y-6"},vr={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},br={class:"flex gap-3"},xr={key:1,class:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-4 relative transition-all duration-300"},hr={class:"flex items-start gap-3"},wr={class:"flex-1"},kr={class:"font-bold text-slate-800 text-sm mb-1"},$r={key:0},Cr={key:1},Sr={class:"text-xs text-gray-600"},Dr={key:0},Ar={key:1},Tr={key:2},qr={class:"flex justify-between items-start mb-3"},Or={class:"font-bold text-slate-800 text-sm"},Nr={key:0},Ir={key:1},Mr={class:"text-xs text-gray-500 mt-0.5"},Rr={key:0},jr={key:1},Vr={class:"flex gap-3 flex-wrap"},Fr={key:0,class:"mt-4"},Lr={class:"[&>div]:mb-0"},Ur={key:3,class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},Er={class:"flex justify-between items-start mb-3"},Br={class:"text-xs text-gray-500 mt-0.5"},Wr={key:0,class:"pt-4"},Pr={key:4,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},zr={key:5,class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Qr={class:"flex justify-between items-start mb-3"},Yr={class:"text-xs text-gray-500 mt-0.5"},Hr={key:12,class:"bg-indigo-50/50 border border-indigo-100 rounded-lg p-4 relative transition-all duration-300"},Jr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Kr={class:"p-6"},Gr={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Xr={class:"p-6"},Zr={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["add-vehicle","add-vehicle-from-stock","configure-vehicle","create-offer","add-to-opportunity"],setup(t,{emit:x}){const s=t,u=x,l=D(()=>{var w,k,j;return((w=s.opportunity)==null?void 0:w.stage)==="Closed"||((k=s.opportunity)==null?void 0:k.stage)==="Closed Lost"||((j=s.opportunity)==null?void 0:j.stage)==="Registration"}),o=S(!1),m=S(!1),d=S(null),i=S(!1),n=S(""),p=S(!1),y=S(!1),g=S(!1),b=S(!1),c=S(!1),$=S([]),q=Se(),M=Fe(),L=Ce();se(()=>{$.value=Ve.filter(w=>w.stockDays!==null&&w.stockDays!==void 0).slice(0,5).map(w=>({id:w.id,brand:w.brand,model:w.model,year:w.year,price:w.price,image:w.image||"",stockDays:w.stockDays}))});const B=w=>{n.value=w,i.value=!0},oe=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",z=w=>w?new Date(w).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",W=()=>{o.value=!o.value},I=w=>{o.value=!1},X=D(()=>{var Y;if(!((Y=s.opportunity)!=null&&Y.createdAt))return 0;const w=new Date(s.opportunity.createdAt),j=Math.abs(new Date-w);return Math.ceil(j/(1e3*60*60*24))}),ne=D(()=>{var k,j;return s.activities.some(Y=>Y.type==="offer")||((k=s.opportunity)==null?void 0:k.stage)==="In Negotiation"||((j=s.opportunity)==null?void 0:j.stage)==="Closed"}),C=D(()=>s.activities.some(w=>w.type==="appointment")),A=D(()=>{var j,Y,H,Z;const w=((j=s.opportunity)==null?void 0:j.contractDate)!==null&&((Y=s.opportunity)==null?void 0:Y.contractDate)!==void 0,k=s.activities.some(K=>{var G,le;return((G=K.action)==null?void 0:G.toLowerCase().includes("won"))||((le=K.action)==null?void 0:le.toLowerCase().includes("contract"))});return w||k||((H=s.opportunity)==null?void 0:H.stage)==="Closed"&&((Z=s.opportunity)==null?void 0:Z.probability)===100}),P=D(()=>s.activities.some(w=>{var k,j;return w.type==="delivery"||((k=w.action)==null?void 0:k.toLowerCase().includes("delivered"))||((j=w.action)==null?void 0:j.toLowerCase().includes("delivery"))})),h=D(()=>{var k;if(((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ne.value||s.scheduledAppointment||C.value)return!1;const w=X.value;return w>=7&&w<14}),E=D(()=>{var k;return((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ne.value||s.scheduledAppointment||C.value?!1:X.value>=14}),pe=D(()=>{var k;return((k=s.opportunity)==null?void 0:k.stage)!=="Qualified"||ne.value||!s.scheduledAppointment?!1:X.value>=7}),ye=D(()=>{const w=X.value;return w>=14?"high":w>=7?"medium":null}),De=D(()=>{var H;if(((H=s.opportunity)==null?void 0:H.stage)!=="In Negotiation")return!1;const w=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),j=Math.abs(new Date-w),Y=Math.ceil(j/(1e3*60*60*24));return!A.value&&Y>=5}),Ee=D(()=>{var G,le,Oe;if(((G=s.opportunity)==null?void 0:G.stage)!=="In Negotiation")return!1;const w=((le=s.opportunity)==null?void 0:le.contractDate)!==null&&((Oe=s.opportunity)==null?void 0:Oe.contractDate)!==void 0,k=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date||C.value&&s.activities.some(be=>{var Ne;return be.type==="appointment"&&((Ne=be.data)!=null&&Ne.datetime)?new Date(be.data.datetime)>new Date:!1}),j=s.opportunity.lastActivity?new Date(s.opportunity.lastActivity):new Date(s.opportunity.createdAt),H=Math.abs(new Date-j);return Math.ceil(H/(1e3*60*60*24))>=5&&!w&&!k}),Be=D(()=>{var K,G,le;if(((K=s.opportunity)==null?void 0:K.stage)!=="Closed"&&((G=s.opportunity)==null?void 0:G.stage)!=="Registration")return!1;const w=(le=s.opportunity)==null?void 0:le.contractDate;if(!w||P.value)return!1;const k=new Date(w),Y=Math.abs(new Date-k);return Math.ceil(Y/(1e3*60*60*24))>=7}),We=D(()=>{const w=s.activities.find(K=>{var G;return K.type==="delivery"||((G=K.action)==null?void 0:G.toLowerCase().includes("delivered"))});if(!w)return!1;const k=new Date(w.timestamp),Y=Math.abs(new Date-k);return Math.ceil(Y/(1e3*60*60*24))>=3}),Pe=D(()=>{if(!s.scheduledAppointment||new Date(s.scheduledAppointment.start)>=new Date)return!1;const j=s.activities.some(H=>{var Z,K,G;return H.type==="appointment"&&(((Z=H.data)==null?void 0:Z.status)==="completed"||((K=H.action)==null?void 0:K.toLowerCase().includes("completed")))&&((G=H.data)==null?void 0:G.appointmentId)===s.scheduledAppointment.id}),Y=s.scheduledAppointment.status==="no-show";return!j&&!Y}),ze=D(()=>!l.value),Qe=D(()=>{var w,k,j;return!(((w=s.opportunity)==null?void 0:w.stage)!=="In Negotiation"||!((k=s.opportunity)!=null&&k.contractDate)||((j=s.opportunity)==null?void 0:j.stage)==="Closed")}),Ye=D(()=>{var H,Z,K;if(((H=s.opportunity)==null?void 0:H.stage)!=="Closed"||!((Z=s.opportunity)!=null&&Z.contractDate)||P.value||((K=s.opportunity)==null?void 0:K.stage)==="Registration")return!1;const w=new Date(s.opportunity.contractDate),j=Math.abs(new Date-w);return Math.ceil(j/(1e3*60*60*24))>=7}),He=()=>{u("add-vehicle",s.opportunity)},Je=()=>{B("Add Vehicle from Stock")},Ke=()=>{B("Configure Vehicle")},fe=()=>{p.value=!0},Ae=()=>{p.value=!1},Ge=w=>{p.value=!1,u("create-offer",{opportunity:s.opportunity,offerData:w})},Xe=w=>{u("add-to-opportunity",w)},Ze=w=>{B("Review Opportunity")},_e=w=>{g.value=!0},et=w=>{g.value=!1},Te=w=>{m.value=!0,d.value=w},ve=()=>{m.value=!1,d.value=null},tt=w=>{Te("nfu")},st=w=>{ve();const k={type:"appointment",user:"You",action:"scheduled an appointment",content:`Appointment scheduled: ${w.type} on ${w.date} at ${w.time}`,data:{type:w.type,assignee:w.assignee,date:w.date,time:w.time,datetime:`${w.date}T${w.time}:00`,status:"scheduled"},timestamp:new Date().toISOString()};u("appointment-created",k)},ot=w=>{b.value=!0},lt=w=>{B("Pre-Delivery Checklist")},at=w=>{b.value=!1},nt=w=>{B("Delivery Feedback")},it=()=>{qe()},rt=()=>{y.value=!0},dt=w=>{},ut=w=>{y.value=!1},ct=()=>{B("Contact Customer")},ie=w=>{},re=w=>{},de=w=>{},mt=async()=>{try{await M.reopenOpportunity(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to reopen opportunity:",w)}},pt=async()=>{try{c.value=!1;const w=await M.convertOpportunityToLead(s.opportunity.id);L.canAccessLeads()?q.push({path:`/tasks/${w}`,query:{type:"lead"}}):q.push("/tasks/1")}catch(w){console.error("Failed to convert opportunity to lead:",w),c.value=!1}},yt=async()=>{try{await M.markAsRegistration(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as registration:",w)}},qe=async()=>{try{await M.markAsClosedWon(s.opportunity.id),await M.loadOpportunityById(s.opportunity.id)}catch(w){console.error("Failed to mark as closed won:",w)}};return(w,k)=>t.opportunity?(a(),r("div",pr,[e("div",yr,[k[8]||(k[8]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage Next steps")],-1)),e("span",gr,f(l.value?"Closed":"Active"),1)]),e("div",fr,[l.value?(a(),r("div",vr,[k[11]||(k[11]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead.")])],-1)),e("div",br,[e("button",{onClick:mt,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[9]||(k[9]=[N(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:k[0]||(k[0]=j=>c.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...k[10]||(k[10]=[N(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):v("",!0),pe.value?(a(),r("div",xr,[e("div",hr,[k[12]||(k[12]=e("div",{class:"flex-shrink-0 mt-0.5"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-sm"})],-1)),e("div",wr,[e("h4",kr,[ye.value==="high"?(a(),r("span",$r,"High Risk")):(a(),r("span",Cr,"At Risk"))]),e("p",Sr,[ye.value==="high"?(a(),r("span",Dr," This opportunity has been open for "+f(X.value)+" days. Even with a scheduled appointment, consider following up to ensure engagement. ",1)):(a(),r("span",Ar," This opportunity has been open for "+f(X.value)+" days. Monitor closely to ensure the scheduled appointment proceeds as planned. ",1))])])])])):v("",!0),t.opportunity.stage==="Qualified"&&t.opportunity.vehicle?(a(),r("div",Tr,[e("div",{class:O([t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?"bg-green-50/50 border border-green-100":"bg-orange-50/50 border border-orange-100","rounded-lg p-4 relative transition-all duration-300"])},[e("div",qr,[e("div",null,[e("h4",Or,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),r("span",Nr," Add Vehicle ")):(a(),r("span",Ir," Find Alternative "))]),e("p",Mr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),r("span",Rr," The requested vehicle is available. Add it to the opportunity to proceed. ")):(a(),r("span",jr," The requested vehicle is currently out of stock. Explore other options. "))])])]),e("div",Vr,[t.opportunity.vehicle.stockDays!==null&&t.opportunity.vehicle.stockDays!==void 0?(a(),r("button",{key:0,onClick:He,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add requested vehicle to opportunity ")):v("",!0),e("button",{onClick:Je,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Add vehicle from stock "),e("button",{onClick:Ke,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Configure vehicle "),e("button",{onClick:fe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Create offer ")]),t.opportunity.vehicle.stockDays===null||t.opportunity.vehicle.stockDays===void 0?(a(),r("div",Fr,[e("div",Lr,[U(Ai,{onAddToOpportunity:Xe})])])):v("",!0)],2)])):v("",!0),t.opportunity.stage==="Qualified"&&t.scheduledAppointment?(a(),r("div",Ur,[e("div",Er,[e("div",null,[k[13]||(k[13]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Next Appointment",-1)),e("p",Br,f(t.scheduledAppointment.title)+" on "+f(oe(t.scheduledAppointment.start))+" at "+f(z(t.scheduledAppointment.start)),1)])]),e("button",{onClick:W,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Postpone "),o.value?(a(),r("div",Wr,[U(Le,{show:o.value,onClose:k[1]||(k[1]=j=>o.value=!1),onConfirm:I},null,8,["show"])])):v("",!0)])):t.opportunity.stage==="Qualified"&&!C.value?(a(),r("div",Pr,[k[14]||(k[14]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"No Appointment Scheduled"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Schedule a new appointment to move the opportunity forward.")])],-1)),e("button",{onClick:k[2]||(k[2]=j=>Te("no-appointment")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule appointment ")])):v("",!0),Qe.value?(a(),r("div",zr,[e("div",Qr,[e("div",null,[k[15]||(k[15]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Signed",-1)),e("p",Yr," Contract was signed on "+f(oe(t.opportunity.contractDate))+". Mark this opportunity as Closed Won to complete the deal. ",1)])]),e("button",{onClick:qe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[16]||(k[16]=[N(" Mark as Closed Won ",-1),e("i",{class:"fa-solid fa-check-circle"},null,-1)])])])):v("",!0),Pe.value?(a(),F(sr,{key:6,opportunity:t.opportunity,"scheduled-appointment":t.scheduledAppointment,onContactCustomer:ct,onReschedule:w.openRescheduleModal,onAutoCloseLost:dt,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity","scheduled-appointment","onReschedule"])):v("",!0),E.value?(a(),F(Qi,{key:7,opportunity:t.opportunity,onCreateOffer:fe,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity"])):v("",!0),h.value?(a(),F(Bi,{key:8,opportunity:t.opportunity,onCreateOffer:fe,onReview:Ze,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity"])):v("",!0),Ee.value?(a(),F(Xi,{key:9,opportunity:t.opportunity,onScheduleClosing:tt,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity"])):v("",!0),De.value?(a(),F(Ki,{key:10,opportunity:t.opportunity,onCreateContract:_e,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity"])):v("",!0),Be.value?(a(),F(nr,{key:11,opportunity:t.opportunity,onPrepareDelivery:ot,onPreDeliveryChecklist:lt,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity"])):v("",!0),Ye.value?(a(),r("div",Hr,[k[18]||(k[18]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Administrative Phase"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Contract has been signed. Move to Registration stage to complete administrative processes before delivery.")])],-1)),e("button",{onClick:yt,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[17]||(k[17]=[N(" Mark as Registration ",-1),e("i",{class:"fa-solid fa-file-contract"},null,-1)])])])):v("",!0),We.value?(a(),F(ur,{key:13,opportunity:t.opportunity,activities:t.activities,onDeliveryFeedback:nt,onSurveyCompleted:ie,onSurveyRefused:re,onNotResponding:de},null,8,["opportunity","activities"])):v("",!0),ze.value?(a(),F(mr,{key:14,opportunity:t.opportunity,onCloseWon:it,onCloseLost:rt},null,8,["opportunity"])):v("",!0)]),U(Cn,{show:i.value,title:n.value,onClose:k[3]||(k[3]=j=>i.value=!1)},null,8,["show","title"]),U(An,{show:y.value,onConfirm:ut,onCancel:k[4]||(k[4]=j=>y.value=!1)},null,8,["show"]),U(Vn,{show:c.value,onConfirm:pt,onCancel:k[5]||(k[5]=j=>c.value=!1)},null,8,["show"]),U(Nn,{show:g.value,onConfirm:et,onCancel:k[6]||(k[6]=j=>g.value=!1)},null,8,["show"]),U(jn,{show:b.value,onConfirm:at,onCancel:k[7]||(k[7]=j=>b.value=!1)},null,8,["show"]),(a(),F(he,{to:"body"},[p.value?(a(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ee(Ae,["self"])},[e("div",Jr,[e("div",Kr,[U(yi,{item:null,"task-type":"opportunity","task-id":t.opportunity.id,"requested-car":t.opportunity.vehicle||null,"recommended-cars":$.value,onSave:Ge,onCancel:Ae},null,8,["task-id","requested-car","recommended-cars"])])])])):v("",!0)])),(a(),F(he,{to:"body"},[m.value?(a(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:ee(ve,["self"])},[e("div",Gr,[e("div",Xr,[U(Ue,{show:m.value,onConfirm:st,onCancel:ve},null,8,["show"])])])])):v("",!0)]))])):v("",!0)}},_r={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},ed={class:"bg-gray-100 text-gray-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-gray-200"},td={key:0,class:"bg-red-50 text-red-600 text-[10px] font-bold uppercase px-2 py-0.5 rounded border border-red-100 flex items-center gap-1"},sd={class:"text-[10px] font-bold uppercase tracking-wide"},od={key:1,class:"text-right"},ld={class:"text-sm font-bold text-gray-900"},ad={class:"mt-1.5"},nd={class:"w-20 h-1.5 bg-gray-200 rounded-full overflow-hidden"},id={class:"text-[10px] text-gray-500 mt-0.5"},rd=["onClick"],dd=["onClick"],ud=["onClick"],cd={class:"flex-1 flex flex-col overflow-hidden"},md={key:0,class:"lg:hidden xl:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},pd={key:1,class:"flex-1 flex items-center justify-center"},yd={key:0,class:"xl:hidden fixed inset-0 z-[60] bg-white"},hd={__name:"Tasks",setup(t){const x=bt(),s=Se(),u=je(),l=Fe(),o=Ce(),m=S("all"),d=S(null),i=S(!1),n=S(!1),p=D(()=>{const A=u.leads.filter(E=>!E.isDisqualified).map(E=>({...E,type:"lead",compositeId:`lead-${E.id}`})),P=l.opportunities.map(E=>({...E,type:"opportunity",compositeId:`opportunity-${E.id}`}));let h=[];return o.isOperator()?h=A:o.isSalesman()?h=P:h=[...A,...P],h.sort((E,pe)=>{const ye=new Date(E.lastActivity||E.createdAt||0);return new Date(pe.lastActivity||pe.createdAt||0)-ye})}),y=D(()=>m.value==="all"?p.value:p.value.filter(C=>C.type===m.value)),g=D(()=>{const C=p.value.some(P=>P.type==="lead"),A=p.value.some(P=>P.type==="opportunity");return C&&A}),b=D(()=>{const C=parseInt(x.params.id),A=x.query.type;if(A)return p.value.find(E=>E.id===C&&E.type===A)||null;const h=(m.value!=="all"?p.value.filter(E=>E.type===m.value):p.value).find(E=>E.id===C);return h||p.value.find(E=>E.id===C)||null}),c=D(()=>b.value?b.value.type==="lead"?u.currentLeadActivities:l.currentOpportunityActivities:[]),$=D(()=>b.value?b.value.type==="lead"?$n:Zr:null),q=D(()=>b.value?b.value.type==="lead"?{currentActivities:D(()=>u.currentLeadActivities),addActivity:(C,A)=>u.addActivity(C,A),updateActivity:(C,A,P)=>u.updateActivity(C,A,P),deleteActivity:(C,A)=>u.deleteActivity(C,A)}:{currentActivities:D(()=>l.currentOpportunityActivities),addActivity:(C,A)=>l.addActivity(C,A),updateActivity:(C,A,P)=>l.updateActivity(C,A,P),deleteActivity:(C,A)=>l.deleteActivity(C,A)}:null),M=D(()=>b.value?b.value.type==="lead"?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]}),L=D(()=>C=>C.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");se(()=>{u.loadLeads(),l.loadOpportunities();const C=x.params.id;C&&B(C)}),te(()=>x.params.id,C=>{C&&B(C)}),te(b,C=>{C&&(C.type==="lead"?u.loadLeadById(C.id):l.loadOpportunityById(C.id))},{immediate:!0});const B=C=>{const A=parseInt(C),P=p.value.find(h=>h.id===A);P&&(P.type==="lead"?u.loadLeadById(A):l.loadOpportunityById(A))},oe=C=>{const[A,P]=C.split("-");s.push({path:`/tasks/${P}`,query:{type:A}}),i.value=!1},z=C=>{d.value=d.value===C?null:C},W=C=>{d.value=null},I=async C=>{d.value=null,C.type==="lead"?await u.modifyLead(C.id,{priority:"Hot"}):C.type==="opportunity"&&await l.modifyOpportunity(C.id,{priority:"Hot"})},X=async C=>{d.value=null,C.type==="lead"?await u.modifyLead(C.id,{priority:"Normal"}):C.type==="opportunity"&&await l.modifyOpportunity(C.id,{priority:"Normal"})},ne=C=>({Open:"bg-blue-100 text-blue-700 border-blue-200","Open Opportunities":"bg-blue-100 text-blue-700 border-blue-200","Open opportunity":"bg-blue-100 text-blue-700 border-blue-200",Qualified:"bg-purple-100 text-purple-700 border-purple-200","In Negotiation":"bg-orange-100 text-orange-700 border-orange-200","Opportunity in negotiation":"bg-orange-100 text-orange-700 border-orange-200",Registration:"bg-indigo-100 text-indigo-700 border-indigo-200",Closed:"bg-gray-100 text-gray-700 border-gray-200","Closed opportunity":"bg-gray-100 text-gray-700 border-gray-200","Closed Lost":"bg-red-100 text-red-700 border-red-200",Won:"bg-green-100 text-green-700 border-green-200",Lost:"bg-red-100 text-red-700 border-red-200"})[C]||"bg-gray-100 text-gray-700 border-gray-200";return(C,A)=>{var P;return a(),r("div",_r,[e("div",{class:O(["lg:relative lg:block",i.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[U(Ut,{title:"My Tasks",items:y.value,"selected-id":(P=b.value)==null?void 0:P.compositeId,"type-filter":m.value,"selected-class":h=>h.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":L.value,"open-menu-id":d.value,getName:h=>h.customer.name,getInitials:h=>h.customer.initials,getVehicleInfo:h=>h.type==="lead"?`${h.requestedCar.brand} ${h.requestedCar.model}`:`${h.vehicle.brand} ${h.vehicle.model}`,avatarClass:h=>h.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:oe,onMenuClick:z,onMenuClose:A[0]||(A[0]=h=>d.value=null),onClose:A[1]||(A[1]=h=>i.value=!1),"show-type-filter":g.value,onFilterChange:A[2]||(A[2]=h=>m.value=h)},{badges:Q(({item:h})=>[e("span",{class:O(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",h.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},f(h.type==="lead"?"Lead":"Opportunity"),3),h.type==="lead"?(a(),r(J,{key:0},[e("span",ed,f(h.status),1),h.priority==="Hot"?(a(),r("span",td,[...A[6]||(A[6]=[e("i",{class:"fa-solid fa-fire text-[9px]"},null,-1),N(" Hot ",-1)])])):v("",!0)],64)):(a(),r("span",{key:1,class:O(["text-[10px] font-bold uppercase px-2 py-0.5 rounded border",ne(h.stage)])},f(h.stage),3))]),meta:Q(({item:h})=>[h.type==="lead"?(a(),r("div",{key:0,class:O(["flex items-center gap-1.5",V(ge)(h.nextActionDue)==="OVERDUE"?"text-red-500":h.priority==="Hot"?"text-orange-500":"text-gray-400"])},[e("i",{class:O(["text-[10px]",V(ge)(h.nextActionDue)==="OVERDUE"?"fa-solid fa-exclamation-triangle":"fa-solid fa-clock"])},null,2),e("span",sd,f(V(ge)(h.nextActionDue)==="OVERDUE"?"OVERDUE":`Due in ${V(ge)(h.nextActionDue)}`),1)],2)):(a(),r("div",od,[e("div",ld,"€"+f(V(xt)(h.value)),1),e("div",ad,[e("div",nd,[e("div",{class:O(["h-full rounded-full",h.probability>=70?"bg-green-500":h.probability>=40?"bg-blue-500":"bg-orange-500"]),style:Re({width:`${h.probability}%`})},null,6)]),e("div",id,f(h.probability)+"% PROB",1)])]))]),menu:Q(({item:h})=>[e("button",{onClick:ee(E=>W(h),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[7]||(A[7]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),N(" Reassign ",-1)])],8,rd),h.priority!=="Hot"?(a(),r("button",{key:0,onClick:ee(E=>I(h),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[8]||(A[8]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),N(" Mark as hot ",-1)])],8,dd)):(a(),r("button",{key:1,onClick:ee(E=>X(h),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...A[9]||(A[9]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),N(" Unmark as hot ",-1)])],8,ud))]),_:1},8,["items","selected-id","type-filter","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),e("div",cd,[b.value?(a(),r("div",md,[e("button",{onClick:A[3]||(A[3]=h=>n.value=!n.value),class:"w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-all hover:scale-110",title:"Activity"},[...A[10]||(A[10]=[e("i",{class:"fa-solid fa-clock-rotate-left text-lg"},null,-1)])]),e("button",{onClick:A[4]||(A[4]=h=>i.value=!i.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...A[11]||(A[11]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])])):v("",!0),b.value?(a(),F(oa,{key:2,task:b.value,type:b.value.type,"management-widget":$.value,"store-adapter":q.value,"add-new-config":M.value},{"pinned-extra":Q(({task:h})=>[h.type==="lead"&&h.requestedCar?(a(),F(Me,{key:0,brand:h.requestedCar.brand,model:h.requestedCar.model,year:h.requestedCar.year,image:h.requestedCar.image||"",price:h.requestedCar.price||null,"request-message":h.requestedCar.requestMessage||"","request-type":h.requestedCar.requestType||"",source:h.source||"",dealership:h.requestedCar.dealership||"",registration:h.requestedCar.registration||"",kilometers:h.requestedCar.kilometers||null,"fuel-type":h.requestedCar.fuelType||"","gear-type":h.requestedCar.gearType||"",vin:h.requestedCar.vin||"","stock-days":h.requestedCar.stockDays!==void 0?h.requestedCar.stockDays:null,channel:h.requestedCar.channel||"Email","ad-campaign":h.requestedCar.adCampaign||"","expected-purchase-date":h.requestedCar.expectedPurchaseDate||"","fiscal-entity":h.requestedCar.fiscalEntity||"","source-details":h.requestedCar.sourceDetails||"","ad-medium":h.requestedCar.adMedium||"","ad-source":h.requestedCar.adSource||"",label:"Requested Car"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0),h.type==="opportunity"&&h.vehicle?(a(),F(Me,{key:1,brand:h.vehicle.brand,model:h.vehicle.model,year:h.vehicle.year,image:h.vehicle.image||"",price:h.vehicle.price||null,"request-message":h.vehicle.requestMessage||"","request-type":h.vehicle.requestType||"",source:h.source||"",dealership:h.vehicle.dealership||"",registration:h.vehicle.registration||"",kilometers:h.vehicle.kilometers||null,"fuel-type":h.vehicle.fuelType||"","gear-type":h.vehicle.gearType||"",vin:h.vehicle.vin||"","stock-days":h.vehicle.stockDays!==void 0?h.vehicle.stockDays:null,channel:h.vehicle.channel||"Email","ad-campaign":h.vehicle.adCampaign||"","expected-purchase-date":h.vehicle.expectedPurchaseDate||"","fiscal-entity":h.vehicle.fiscalEntity||"","source-details":h.vehicle.sourceDetails||"","ad-medium":h.vehicle.adMedium||"","ad-source":h.vehicle.adSource||"",label:"Vehicle"},null,8,["brand","model","year","image","price","request-message","request-type","source","dealership","registration","kilometers","fuel-type","gear-type","vin","stock-days","channel","ad-campaign","expected-purchase-date","fiscal-entity","source-details","ad-medium","ad-source"])):v("",!0)]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):(a(),r("div",pd,[...A[12]||(A[12]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])]))]),n.value&&b.value?(a(),r("div",yd,[U(Ie,{title:"Activity summary",activities:c.value,collapsed:!1,"show-collapse":!1,show:!0,"mobile-fullscreen":!0,onClose:A[5]||(A[5]=h=>n.value=!1),class:"flex w-full h-full"},null,8,["activities"])])):v("",!0),U(Ie,{title:"Activity summary",activities:c.value,collapsed:!1,"show-collapse":!1,show:!!b.value,class:"hidden xl:flex"},null,8,["activities","show"])])}}};export{hd as default};
