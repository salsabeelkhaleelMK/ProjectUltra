import{H as ve,S as ae,a2 as ze,h as _e,C as We,c as N,d as k,o as h,e,x as z,g as L,B as i,s as l,y as t,n as j,t as T,F as H,i as Z,M as Be,r as O,K as He,w as Ce,p as fe,T as Qe,k as v,m as ge,l as ne,N as Ve,ac as Ye,D as Ge,u as Ke,a0 as Ze,I as ye,ad as Je,ae as Xe,af as et,ag as tt,P as re}from"./index-D8nDSNmq.js";import{u as lt}from"./opportunities-D1cnNxBd.js";import{n as U,$ as st,f as J,F as X,L as ee,g as te,h as le,Q as I,o as ue,C as be,d as se,W as Q,U as Y,H as G,j as B,G as K,c as P,i as oe,z as at}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-DVyH4GI_.js";import{S as ot}from"./sparkles-BOzuQ2gU.js";import{f as nt,u as it}from"./vehicles-CxdEy1So.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=ve("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=ve("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ve("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ve("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ve("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=ve("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=ve("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);function fn(s){if(!s)return"";const r=new Date(s),o=new Date;if(r<o)return"OVERDUE";if(r.toDateString()===o.toDateString()){const f=r-o,p=Math.floor(f/(1e3*60*60)),x=Math.floor(f%(1e3*60*60)/(1e3*60));return p>0?`${p}h ${x}m`:`${x}m`}return r.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function pn(s){return(typeof s=="string"?new Date(s):s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function vn(s){return(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Ue(s){return(s==null?void 0:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0"}function yn(s){if(!s)return"No deadline";const r=new Date(s);if(r<new Date)return"OVERDUE";const a=r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${a}, ${f}`}function bn(s){if(!s)return{type:"none",color:"gray",icon:"fa-clock",relativeTime:"No deadline",statusText:"No deadline",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-clock"};const r=new Date(s),o=new Date,a=(r-o)/(1e3*60*60);if(a<0)return{type:"overdue",color:"red",icon:"fa-exclamation-triangle",relativeTime:"OVERDUE",statusText:"OVERDUE",bgClass:"bg-red-50",textClass:"text-red-700",borderClass:"border-red-200",iconClass:"fa-solid fa-exclamation-triangle"};if(a<2){const f=Math.floor((r-o)/6e4),p=Math.floor(f/60),x=f%60;return{type:"urgent",color:"orange",icon:"fa-clock",relativeTime:p>0?`${p}h ${x}m`:`${x}m`,statusText:"URGENT",bgClass:"bg-orange-50",textClass:"text-orange-700",borderClass:"border-orange-200",iconClass:"fa-solid fa-clock"}}else if(a<24){const f=Math.floor(a),p=Math.floor((a-f)*60);return{type:"today",color:"blue",icon:"fa-clock",relativeTime:`${f}h ${p}m`,statusText:"TODAY",bgClass:"bg-blue-50",textClass:"text-blue-700",borderClass:"border-blue-200",iconClass:"fa-solid fa-clock"}}else{const f=Math.ceil(a/24);return{type:"normal",color:"gray",icon:"fa-calendar",relativeTime:`${f} day${f!==1?"s":""}`,statusText:"UPCOMING",bgClass:"bg-gray-50",textClass:"text-gray-700",borderClass:"border-gray-200",iconClass:"fa-solid fa-calendar"}}}function gn(s){return{Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700","Closed Won":"bg-green-50 text-green-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700"}const he={[ae.NEW]:{primaryAction:{key:"call-to-verify",title:"Call to Verify Contact Details",description:"Begin lead qualification by verifying customer contact information",label:"Call to Verify",icon:"fa-solid fa-phone",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark",description:"Mark lead as invalid or not interested"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.TO_BE_CALLED_BACK]:{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Make the call at scheduled time",label:"Call Prospect",icon:"fa-solid fa-phone",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"postpone",label:"Postpone Task",icon:"fa-solid fa-clock",description:"Reschedule the callback"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"has-callback-date"}],showLQWidget:s=>!!(s.callbackDate||s.callbackScheduled),showDeadlineBanner:!0,canPostpone:!0,canReassign:!0},[ae.VALID]:{primaryAction:{key:"complete-conversion",title:"Lead Validated",description:"Lead is validated. Complete conversion details to create opportunity",label:"Complete Conversion",icon:"fa-solid fa-check-circle",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"schedule-follow-up",label:"Schedule Follow-up",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"disqualify",label:"Disqualify Lead",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"LQ",condition:"always"}],showLQWidget:!0,showDeadlineBanner:!0,canPostpone:!1,canReassign:!0,lqWidgetMode:"conversion"},[ae.CLOSED_INVALID]:{primaryAction:{key:"reopen",title:"Lead Closed - Invalid",description:"This lead has been marked as invalid. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_NOT_INTERESTED]:{primaryAction:{key:"reopen",title:"Lead Closed - Not Interested",description:"This lead has been marked as not interested. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1},[ae.CLOSED_DUPLICATE]:{primaryAction:{key:"reopen",title:"Lead Closed - Duplicate",description:"This lead has been marked as duplicate. Reopen it to continue qualification",label:"Reopen Lead",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[],taskWidgets:[],showLQWidget:!1,showDeadlineBanner:!1,canPostpone:!1,canReassign:!1}},Fe={toClosed:(s,r,o)=>{const a={isDisqualified:!0,disqualifyReason:(o==null?void 0:o.reason)||null,disqualifyCategory:(o==null?void 0:o.category)||null,scheduledAppointment:null,nextActionDue:null};(o==null?void 0:o.reason)==="Duplicate"?(a.isDuplicate=!0,a.stage="Closed Failed"):(o==null?void 0:o.category)==="Not Interested"?a.stage="Not Interested":a.stage="Not Valid",a.status="Disqualified";const f=[{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${(o==null?void 0:o.category)||"Unknown"}, Reason: ${(o==null?void 0:o.reason)||"Unknown"}`}];return s.scheduledAppointment&&f.push({type:"appointment",user:"You",action:"cancelled appointment",content:"Appointment cancelled due to lead disqualification",data:{cancelledReason:"Lead disqualified",originalAppointment:s.scheduledAppointment}}),{updates:a,activities:f}},reopen:s=>({updates:{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null},activities:[{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}]})};function hn(s,r){return r.startsWith("Closed")?Fe.toClosed:s.startsWith("Closed")&&!r.startsWith("Closed")?Fe.reopen:null}const Te={Qualified:{primaryAction:{key:"schedule-appointment",title:"Schedule First Appointment",description:"Begin the sales process by scheduling an appointment with the customer",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Awaiting Appointment":{primaryAction:s=>s.scheduledAppointment&&s.scheduledAppointment.start?{key:"manage-appointment",title:"Manage Appointment",description:r=>{const o=new Date(r.scheduledAppointment.start);return`Appointment scheduled for ${r.formatDateTime?r.formatDateTime(r.scheduledAppointment.start):o.toLocaleString()}`},label:"Manage Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}}:{key:"schedule-appointment",title:"Schedule Appointment",description:"An appointment needs to be scheduled to move forward with this opportunity",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",buttonClass:"bg-blue-600 hover:bg-blue-700 text-white",colorScheme:{background:"bg-blue-50/50",border:"border-blue-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time",conditional:"has-appointment"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark",description:"Cancel the scheduled appointment",conditional:"has-appointment"},{key:"mark-no-show",label:"Mark as No-Show",icon:"fa-solid fa-user-slash",description:"Mark appointment as no-show and create NS task",conditional:"appointment-past-not-completed"},{key:"select-vehicle",label:"Select Vehicle",icon:"fa-solid fa-car",description:"Choose a vehicle for this opportunity"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OOFB",condition:"qualified-no-offers-7-13-days"},{type:"UFB",condition:"qualified-no-offers-14-plus-days"}]},"Appointment Scheduled":{primaryAction:{key:"view-or-schedule-appointment",title:s=>s.scheduledAppointment?"Next Appointment":"Schedule Appointment",description:s=>s.scheduledAppointment&&s.scheduledAppointment.start?`Scheduled for ${s.formatDateTime?s.formatDateTime(s.scheduledAppointment.start):new Date(s.scheduledAppointment.start).toLocaleString()}`:"Schedule an appointment to move forward",label:s=>s.scheduledAppointment?"View Appointment":"Schedule Appointment",icon:"fa-solid fa-calendar-check",buttonClass:"bg-purple-600 hover:bg-purple-700 text-white",colorScheme:{background:"bg-purple-50/50",border:"border-purple-100"}},secondaryActions:[{key:"reschedule",label:"Reschedule",icon:"fa-solid fa-calendar-days",description:"Change appointment date/time"},{key:"cancel-appointment",label:"Cancel Appointment",icon:"fa-solid fa-calendar-xmark"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"NS",condition:"appointment-past-not-completed"}]},"To be Called Back":{primaryAction:{key:"call-prospect",title:"Call Prospect",description:"Customer requested a callback. Follow up to maintain engagement",label:"Initiate Call",icon:"fa-solid fa-phone",buttonClass:"bg-indigo-600 hover:bg-indigo-700 text-white",colorScheme:{background:"bg-indigo-50/50",border:"border-indigo-100"}},secondaryActions:[{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[]},"In Negotiation":{primaryAction:s=>{var o;return((o=s.opportunity)==null?void 0:o.negotiationSubstatus)==="Offer Feedback"?{key:"request-feedback",title:"Request Offer Feedback",description:"Get customer response on pending offer(s) and push forward",label:"Request Feedback",icon:"fa-solid fa-comments",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}:{key:"follow-up-offer",title:"Follow Up on Offer",description:s.hasOffers?"Follow up to gauge customer interest and move forward":"Create initial offer to begin negotiation",label:s.hasOffers?"Follow Up":"Create Offer",icon:"fa-solid fa-phone-volume",buttonClass:"bg-yellow-600 hover:bg-yellow-700 text-white",colorScheme:{background:"bg-yellow-50/50",border:"border-yellow-100"}}},secondaryActions:[{key:"mark-offer-accepted",label:"Mark Offer Accepted",icon:"fa-solid fa-check-circle",description:"Mark an offer as accepted and move to In Negotiation - Contract Pending",conditional:"has-offers"},{key:"add-offer",label:"Add Another Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Appointment",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-offer-feedback-5-plus-days-no-appointment"}]},"Needs Follow-up":{primaryAction:{key:"request-decision",title:"Request Customer Decision",description:"Offer has been pending. Time to request a decision",label:"Request Decision",icon:"fa-solid fa-circle-question",buttonClass:"bg-pink-600 hover:bg-pink-700 text-white",colorScheme:{background:"bg-pink-50/50",border:"border-pink-100"}},secondaryActions:[{key:"add-contract",label:"Add Contract",icon:"fa-solid fa-file-contract",description:"Customer accepted - add contract to proceed"},{key:"add-offer",label:"Send New Offer",icon:"fa-solid fa-file-invoice-dollar"},{key:"schedule-appointment",label:"Schedule Meeting",icon:"fa-solid fa-calendar-plus",conditional:"no-appointment"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"OFB",condition:"negotiation-5-plus-days-no-contract-has-offers"},{type:"NFU",condition:"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers"}]},"In Negotiation - Contract Pending":{primaryAction:{key:"finalize-contract",title:"Collect e-signatures, finalize contract",description:"Get the formal contract signed electronically by the customer. Finalize all contractual terms and conditions. Ensure all required signatures are collected. Set the official Contract Date when customer signs.",label:"Collect Signatures",icon:"fa-solid fa-file-signature",buttonClass:"bg-emerald-600 hover:bg-emerald-700 text-white",colorScheme:{background:"bg-emerald-50/50",border:"border-emerald-100"}},secondaryActions:[{key:"add-offer",label:"Add offer",icon:"fa-solid fa-file-invoice-dollar",description:"Create additional offers if terms need adjustment"},{key:"extend-deadline",label:"Extend deadline",icon:"fa-solid fa-clock",description:"Give customer more time to review/sign"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"End negotiation if customer changes mind"},{key:"reassign",label:"Reassign",icon:"fa-solid fa-user-group",description:"Assign to another team member"},{key:"schedule-appointment",label:"Schedule appointment",icon:"fa-solid fa-calendar-plus",description:"Book delivery or signing meeting"}],taskWidgets:[]},"Closed Won":{primaryAction:s=>{const r=s.deliverySubstatus;return r==="Delivered"?{key:"collect-feedback",title:"Post-Delivery Follow-up",description:"Vehicle delivered. Collect customer feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}:r==="Awaiting Delivery"?{key:"confirm-delivery",title:"Confirm Delivery Details",description:"Delivery scheduled. Confirm date/time with customer",label:"Confirm Delivery",icon:"fa-solid fa-calendar-check",buttonClass:"bg-teal-600 hover:bg-teal-700 text-white",colorScheme:{background:"bg-teal-50/50",border:"border-teal-100"}}:{key:"schedule-delivery",title:"Set Delivery Date",description:"Contract signed! Schedule vehicle delivery with the customer",label:"Schedule Delivery",icon:"fa-solid fa-truck",buttonClass:"bg-green-600 hover:bg-green-700 text-white",colorScheme:{background:"bg-green-50/50",border:"border-green-100"}}},secondaryActions:[{key:"collect-feedback",label:"Collect Feedback",icon:"fa-solid fa-comment",conditional:"is-delivered"},{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}],taskWidgets:[{type:"CFB",condition:"contract-7-plus-days-no-delivery"},{type:"DFB",condition:"delivery-date-set"},{type:"DFB",condition:"delivery-3-plus-days"}]},"Closed Lost":{primaryAction:{key:"reopen",title:"Reopen Opportunity",description:"This opportunity was closed as lost. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[]},Abandoned:{primaryAction:{key:"reopen",title:"Opportunity Abandoned",description:"This opportunity has been inactive for an extended period. Reopen it to continue the sales process.",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",buttonClass:"bg-gray-600 hover:bg-gray-700 text-white",colorScheme:{background:"bg-gray-50/50",border:"border-gray-100"}},secondaryActions:[{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark",description:"Mark this opportunity as lost"},{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"}],taskWidgets:[{type:"ABANDONED",condition:"opportunity-abandoned"}]}},Ie={reopen:{key:"reopen",label:"Reopen Opportunity",icon:"fa-solid fa-rotate-left",description:"Restart the management process"},requalify:{key:"requalify",label:"Requalify as Lead",icon:"fa-solid fa-arrow-left",description:"Convert back to a lead"},closeLost:{key:"close-lost",label:"Close as Lost",icon:"fa-solid fa-xmark"}},vt={class:"overflow-hidden p-4",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)"}},yt={class:"flex items-center justify-between gap-2 mb-4"},bt={class:"flex flex-col"},gt={class:"space-y-3"},ht={class:"flex items-start justify-between gap-2"},xt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},wt={class:"flex items-start justify-between gap-2"},kt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},Ct={class:"flex items-start justify-between gap-2"},Vt={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},St={key:0,class:"flex items-start justify-between gap-2"},$t={class:"text-sm font-medium text-heading leading-5 text-right wrap-break-word min-w-0 flex-1"},It={key:0,class:"mt-4 pt-4 border-t border-black/5"},Tt={class:"space-y-0.5"},At=["onClick"],Et={class:"text-sm font-medium text-heading truncate shrink-0 min-w-0"},Mt={class:"text-sm text-body truncate flex-1 min-w-0"},Dt={key:0,class:"text-sm font-bold text-heading shrink-0"},Pt={class:"text-sm text-sub shrink-0"},xn={__name:"TaskContactCard",props:{task:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null}},setup(s){const r=s;ze();const o=_e(),a=We(),f=lt();N(()=>r.task.negotiations||r.task.activeNegotiations||0);const p=N(()=>{if(!r.task.customer)return[];const d=r.task.customer.email,b=r.task.customer.phone,M=r.task.compositeId;return[...(a.leads||[]).map(F=>({...F,type:"lead",compositeId:`lead-${F.id}`})),...(f.opportunities||[]).map(F=>({...F,type:"opportunity",compositeId:`opportunity-${F.id}`}))].filter(F=>F.compositeId===M||!F.customer?!1:F.customer.email===d||F.customer.phone===b).sort((F,W)=>new Date(W.createdAt||0)-new Date(F.createdAt||0)).slice(0,3)}),x=()=>{var b;const d=((b=r.task.customer)==null?void 0:b.id)||r.customerId;if(d){const M=o.resolve(`/customer/${d}`).href;window.open(M,"_blank")}},c=d=>{const[b,M]=d.compositeId.split("-");o.push({path:`/tasks/${M}`,query:{type:b}})},V=d=>d.stage||d.currentStage||"Unknown",E=d=>{const b=d.createdAt||d.nextActionDue||d.updatedAt;if(!b)return"";try{return new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}catch{return""}},m=d=>{const b=d.requestedCar||d.vehicle;if(!b)return"No vehicle";const M=b.brand||"",u=b.model||"",F=b.year?`(${b.year})`:"";return`${M} ${u} ${F}`.trim()||"Vehicle info N/A"},C=d=>d?d>=1e3?"€"+(d/1e3).toFixed(0)+"k":"€"+d:"€0";return(d,b)=>{var M,u,F,W,q;return h(),k("div",vt,[e("div",yt,[b[0]||(b[0]=e("h3",{class:"text-base font-medium text-heading leading-6"},"Customer information",-1)),(M=s.task.customer)!=null&&M.id?(h(),z(t(U),{key:0,variant:"ghost",size:"icon",onClick:x,class:j("h-7 w-7"),title:"Open customer profile in new tab"},{default:i(()=>[l(t(rt),{size:14,class:"text-sub"})]),_:1})):L("",!0)]),e("div",bt,[e("div",gt,[e("div",ht,[b[1]||(b[1]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Customer",-1)),e("p",xt,T(((u=s.task.customer)==null?void 0:u.name)||"Unknown"),1)]),e("div",wt,[b[2]||(b[2]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Email",-1)),e("p",kt,T(((F=s.task.customer)==null?void 0:F.email)||"N/A"),1)]),e("div",Ct,[b[3]||(b[3]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Phone",-1)),e("p",Vt,T(((W=s.task.customer)==null?void 0:W.phone)||"N/A"),1)]),(q=s.task.customer)!=null&&q.address?(h(),k("div",St,[b[4]||(b[4]=e("p",{class:"text-sm text-sub leading-5 shrink-0"},"Address",-1)),e("p",$t,T(s.task.customer.address),1)])):L("",!0)]),p.value.length>0?(h(),k("div",It,[b[5]||(b[5]=e("h3",{class:"text-base font-medium text-heading mb-4 leading-6"},"Other customer requests",-1)),e("div",Tt,[(h(!0),k(H,null,Z(p.value,$=>(h(),k("div",{key:$.compositeId,onClick:y=>c($),class:"group px-2 py-1 rounded-lg border border-transparent hover:border-brand-blue/30 hover:bg-blue-50/20 transition-all cursor-pointer flex items-center gap-2"},[e("span",{class:j(["text-sm font-bold uppercase px-1 py-0.5 rounded leading-normal shrink-0",$.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},T($.type==="lead"?"Lead":"Opp"),3),e("span",Et,T(V($)),1),e("span",Mt,T(m($)),1),$.type==="opportunity"&&$.estimatedValue?(h(),k("span",Dt,T(C($.estimatedValue)),1)):L("",!0),e("span",Pt,T(E($)),1)],8,At))),128))])])):L("",!0)])])}}},Lt={class:"overflow-hidden p-4 flex flex-col flex-1",style:{"border-radius":"var(--border-radius-rounded-lg, 10px)",background:"var(--base-card, #FFF)","box-shadow":"var(--nsc-card-shadow)","min-height":"100vh"}},Ot={class:"mb-4"},Ut={class:"flex items-center justify-between mb-2"},Ft={class:"flex items-center gap-2 flex-wrap"},Rt={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-black"},Bt={key:0,class:"absolute right-0 mt-2 z-50 filter-dropdown-wrapper"},Nt={class:"relative"},qt={class:"space-y-6 flex-1 flex flex-col min-h-0"},jt={key:0,class:"flex-1 overflow-y-auto min-h-0"},zt={class:"flex flex-col items-start gap-1 mb-4"},_t={class:"text-sm font-normal text-sub leading-normal"},Wt={class:"space-y-4"},Ht=["onClick"],Qt={class:"flex-1 min-w-0"},Yt={class:"flex items-start justify-between gap-2"},Gt={class:"text-sm text-heading flex-1 wrap-break-word min-w-0 leading-normal"},Kt={key:0,class:"text-sub"},Zt={key:1,class:"text-sub"},Jt={key:2,class:"text-sub"},Xt={key:3,class:"text-sub"},el={key:4,class:"text-sub"},tl={key:5,class:"text-sub"},ll={key:6,class:"text-sub"},sl={class:"text-sm text-sub text-right shrink-0 w-14 leading-normal"},al={key:0,class:"mt-2 bg-[#fef7ee] rounded-lg p-4 backdrop-blur-sm"},ol={class:"text-sm text-heading wrap-break-word leading-normal"},nl={key:1,class:"mt-2 bg-blue-50 rounded-lg p-4"},il={class:"text-sm text-heading wrap-break-word leading-normal"},dl={key:2,class:"mt-2 bg-green-50 rounded-lg p-4"},rl={class:"text-sm text-heading wrap-break-word leading-normal"},ul={key:3,class:"mt-2 bg-purple-50 rounded-lg p-4"},cl={class:"text-sm text-heading wrap-break-word leading-normal"},ml={key:0,class:"flex items-center gap-2 flex-wrap"},fl={key:1,class:"py-8 flex-1 flex flex-col justify-center min-h-full"},pl={class:"text-center"},vl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded","add-activity"],setup(s,{emit:r}){const o=s,a=r,f=O(!1),p=O(!1),x=O(null),c=[{label:"Important",value:"important"},{label:"Communications",value:"communications"},{label:"Notes",value:"notes"},{label:"Transcriptions",value:"transcriptions"},{label:"System Updates",value:"system-updates"}],V=O([]),E=()=>{p.value=!p.value},m=$=>{p.value=!1;const y=V.value.indexOf($);y>-1?V.value.splice(y,1):V.value.push($)},C=$=>{const y=V.value.indexOf($);y>-1&&V.value.splice(y,1)},d=$=>{const y=c.find(D=>D.value===$);return y?y.label:$},b=N(()=>c.map($=>({key:$.value,label:$.label,onClick:()=>m($.value),className:V.value.includes($.value)?"filter-item-selected":""}))),M=$=>$.important||$.isImportant?"important":["email","sms","whatsapp","call"].includes($.type)?"communications":$.type==="note"?"notes":$.type==="transcription"||$.transcription?"transcriptions":$.type==="system"||$.type==="created"||$.type==="status"?"system-updates":null,u=N(()=>{let $=[...o.activities];return V.value.length>0&&($=$.filter(y=>{const D=M(y);return D&&V.value.includes(D)})),$.sort((y,D)=>{const w=new Date(y.timestamp||y.createdAt||0).getTime();return new Date(D.timestamp||D.createdAt||0).getTime()-w})}),F=$=>{if(!$||$.length===0)return"";const y=$[0],D=y.timestamp||y.createdAt;if(!D)return"Recent Activity";const w=new Date(D),g=new Date,A=new Date(g);return A.setDate(A.getDate()-1),w.toDateString()===g.toDateString()?"Today":w.toDateString()===A.toDateString()?"Yesterday":w.toLocaleDateString("en-US",{month:"long",day:"numeric",year:w.getFullYear()!==g.getFullYear()?"numeric":void 0})},W=$=>{["note","email","whatsapp"].includes($.type)&&a("activity-click",$)},q=$=>{f.value=!1,a("add-activity",$)};return($,y)=>{const D=He("click-outside");return h(),k("div",Lt,[e("div",Ot,[e("div",Ut,[y[27]||(y[27]=e("h3",{class:"text-base font-medium text-heading leading-6"},"Activity",-1)),e("div",Ft,[e("div",{class:"relative",ref_key:"filterContainer",ref:x},[l(t(U),{variant:"outline",size:"icon",onClick:Ce(E,["stop"]),class:"relative w-8 h-8"},{default:i(()=>[y[12]||(y[12]=e("i",{class:"fa-solid fa-filter text-sm"},null,-1)),V.value.length>0?(h(),k("span",Rt)):L("",!0)]),_:1}),l(Qe,{name:"dropdown"},{default:i(()=>[p.value?fe((h(),k("div",Bt,[l(t(st),{items:b.value,className:"w-56"},null,8,["items"])])),[[D,()=>p.value=!1]]):L("",!0)]),_:1})],512),e("div",Nt,[l(t(U),{variant:"default",size:"icon",onClick:y[0]||(y[0]=Ce(w=>f.value=!f.value,["stop"])),class:"relative w-8 h-8 bg-primary text-white border border-primary hover:bg-primary/90","aria-label":"Add activity"},{default:i(()=>[...y[13]||(y[13]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),_:1}),f.value?fe((h(),k("div",{key:0,class:"absolute right-0 top-full mt-2 w-48 bg-white border border-black/10 rounded-lg shadow-lg py-1 z-50",onClick:y[11]||(y[11]=Ce(()=>{},["stop"]))},[e("button",{onClick:y[1]||(y[1]=w=>q("email")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[14]||(y[14]=[e("i",{class:"fa-solid fa-envelope text-sm text-primary"},null,-1),v(" Email ",-1)])]),e("button",{onClick:y[2]||(y[2]=w=>q("sms")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[15]||(y[15]=[e("i",{class:"fa-solid fa-comment text-sm text-purple-600"},null,-1),v(" SMS ",-1)])]),e("button",{onClick:y[3]||(y[3]=w=>q("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[16]||(y[16]=[e("i",{class:"fa-brands fa-whatsapp text-sm text-green-600"},null,-1),v(" WhatsApp ",-1)])]),e("button",{onClick:y[4]||(y[4]=w=>q("call")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[17]||(y[17]=[e("i",{class:"fa-solid fa-phone text-sm text-green-600"},null,-1),v(" Call ",-1)])]),y[24]||(y[24]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[5]||(y[5]=w=>q("note")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[18]||(y[18]=[e("i",{class:"fa-solid fa-sticky-note text-sm text-orange-600"},null,-1),v(" Note ",-1)])]),e("button",{onClick:y[6]||(y[6]=w=>q("attachment")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[19]||(y[19]=[e("i",{class:"fa-solid fa-paperclip text-sm text-sub"},null,-1),v(" Attachment ",-1)])]),y[25]||(y[25]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[7]||(y[7]=w=>q("financing")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[20]||(y[20]=[e("i",{class:"fa-solid fa-file-invoice-dollar text-sm text-primary"},null,-1),v(" Financing ",-1)])]),e("button",{onClick:y[8]||(y[8]=w=>q("tradein")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[21]||(y[21]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sm text-primary"},null,-1),v(" Trade-in ",-1)])]),e("button",{onClick:y[9]||(y[9]=w=>q("purchase")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[22]||(y[22]=[e("i",{class:"fa-solid fa-handshake text-sm text-primary"},null,-1),v(" Offer ",-1)])]),y[26]||(y[26]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:y[10]||(y[10]=w=>q("appointment")),class:"w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2"},[...y[23]||(y[23]=[e("i",{class:"fa-regular fa-calendar text-sm text-purple-600"},null,-1),v(" Appointment ",-1)])])])),[[D,()=>f.value=!1]]):L("",!0)])])])]),e("div",qt,[u.value.length>0?(h(),k("div",jt,[e("div",zt,[e("h3",_t,T(F(u.value)),1)]),e("div",Wt,[(h(!0),k(H,null,Z(u.value,w=>(h(),k("div",{key:w.id,class:"space-y-2"},[e("div",{class:j(["flex items-start gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":w.type==="note"||w.type==="email"||w.type==="whatsapp"}]),onClick:g=>W(w)},[e("div",{class:j(["size-8 rounded-md flex items-center justify-center shrink-0 p-2",w.type==="note"?"bg-orange-100":w.type==="call"?"bg-green-100":w.type==="ai-summary"?"bg-purple-100":w.type==="email"?"bg-blue-100":w.type==="whatsapp"?"bg-green-100":"bg-surfaceSecondary"])},[w.type==="note"?(h(),z(t(pt),{key:0,size:16,class:"text-orange-600"})):w.type==="call"?(h(),z(t(ft),{key:1,size:16,class:"text-green-600"})):w.type==="ai-summary"?(h(),z(t(ot),{key:2,size:16,class:"text-purple-600"})):w.type==="email"?(h(),z(t(ct),{key:3,size:16,class:"text-blue-600"})):w.type==="whatsapp"?(h(),z(t(mt),{key:4,size:16,class:"text-green-600"})):(h(),z(t(ut),{key:5,size:16,class:"text-heading"}))],2),e("div",Qt,[e("div",Yt,[e("p",Gt,[e("span",{class:j(["font-normal",w.type==="ai-summary"?"font-medium":""])},T(w.type==="ai-summary"?"MotorKAI":w.user),3),w.type==="note"?(h(),k("span",Kt," added a note")):w.type==="created"?(h(),k("span",Zt,T(w.message||w.action),1)):w.type==="call"?(h(),k("span",Jt,T(" "+(w.message||w.action)),1)):w.type==="ai-summary"?(h(),k("span",Xt," summary")):w.type==="email"?(h(),k("span",el,T(" sent an email"))):w.type==="whatsapp"?(h(),k("span",tl,T(" sent a WhatsApp message"))):(h(),k("span",ll,T(" "+(w.message||w.action)),1))]),e("p",sl,T(w.time),1)]),w.type==="note"&&(w.message||w.content)?(h(),k("div",al,[e("p",ol,T(w.message||w.content),1)])):L("",!0),w.type==="email"&&w.content?(h(),k("div",nl,[e("p",il,T(w.content),1)])):L("",!0),w.type==="whatsapp"&&w.content?(h(),k("div",dl,[e("p",rl,T(w.content),1)])):L("",!0),w.type==="ai-summary"&&(w.message||w.content)?(h(),k("div",ul,[e("p",cl,T(w.message||w.content),1)])):L("",!0)])],10,Ht)]))),128)),V.value.length>0?(h(),k("div",ml,[(h(!0),k(H,null,Z(V.value,w=>(h(),k("div",{key:w,class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-surfaceSecondary text-sm font-medium text-heading border border-black/5"},[e("span",null,T(d(w)),1),l(t(U),{variant:"ghost",size:"icon",onClick:g=>C(w),class:"w-4 h-4 rounded-full","aria-label":"Remove filter"},{default:i(()=>[...y[28]||(y[28]=[e("i",{class:"fa-solid fa-xmark text-sm"},null,-1)])]),_:1},8,["onClick"])]))),128))])):L("",!0)])])):(h(),k("div",fl,[e("div",pl,[l(t(dt),{size:32,class:"mx-auto text-sub mb-2"}),y[29]||(y[29]=e("p",{class:"text-sm text-sub"},"No activity yet",-1))])]))])])}}},wn=Be(vl,[["__scopeId","data-v-d6092c27"]]),yl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},bl={class:"space-y-2"},gl={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},hl={key:1,class:"flex justify-between items-center mb-4"},xl={class:"text-fluid-sm font-semibold text-heading"},wl={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},kn={__name:"NoteWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O(""),x=O(!1);ge(()=>{a.item&&(p.value=a.item.content||a.item.message||"")}),ne(()=>a.item,m=>{m&&(p.value=m.content||m.message||"")},{deep:!0}),ne(()=>a.show,m=>{a.modal&&!m&&setTimeout(()=>{p.value=a.item&&(a.item.content||a.item.message)||"",x.value=!1},300)});const c=async()=>{var m,C;if(p.value.trim()){x.value=!0;try{const d={id:((m=a.item)==null?void 0:m.id)||Date.now(),type:"note",action:a.item?"updated a note":"added a note",content:p.value,message:p.value,timestamp:((C=a.item)==null?void 0:C.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",d),a.modal&&f("close")}finally{x.value=!1}}},V=()=>{f("cancel"),a.modal&&f("close")},E=m=>{m||f("close")};return r({submit:c,canSubmit:()=>!!p.value.trim()}),(m,C)=>s.modal?(h(),z(t(se),{key:0,open:s.show,"onUpdate:open":E},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(T(s.item?"Edit Note":"Add Note"),1)]),_:1})]),_:1}),e("div",yl,[e("div",bl,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[2]||(C[2]=[v(" Note ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":C[0]||(C[0]=d=>p.value=d),rows:"8",placeholder:"Type your note here...",required:"",class:"w-full min-h-[200px] resize-none"},null,8,["modelValue"])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:V}),l(t(U),{label:x.value?"Saving...":s.item?"Update Note":"Save Note",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value.trim()||x.value,onClick:c},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(h(),k("div",{key:1,class:j(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!s.hideHeader}])},[s.hideHeader?L("",!0):(h(),k("div",gl)),s.hideHeader?L("",!0):(h(),k("div",hl,[e("h5",xl,T(s.item?"Edit Note":"Add Note"),1),e("button",{onClick:V,class:"text-sub hover:text-body"},[...C[3]||(C[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",null,[C[4]||(C[4]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Note",-1)),fe(e("textarea",{"onUpdate:modelValue":C[1]||(C[1]=d=>p.value=d),rows:"4",class:"input",placeholder:"Enter your note..."},null,512),[[Ve,p.value]])]),s.hideActions?L("",!0):(h(),k("div",wl,[l(t(U),{label:"Cancel",variant:"outline",size:"small",onClick:V}),l(t(U),{label:"Save",variant:"primary",size:"small",onClick:c})]))],2))}},kl={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Cl={class:"space-y-2"},Vl={class:"flex items-center gap-3"},Sl={key:0,class:"text-sm text-body truncate"},$l={key:1,class:"text-sm text-sub"},Il={key:1,class:"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6 animate-fade-in relative"},Tl={class:"flex justify-between items-center mb-4"},Al={class:"text-fluid-sm font-semibold text-heading"},El={class:"flex items-center gap-3"},Ml={key:0,class:"text-fluid-sm text-slate-600"},Dl={key:1,class:"text-fluid-sm text-sub"},Pl={class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Cn={__name:"AttachmentWidget",props:{modal:{type:Boolean,default:!1},show:{type:Boolean,default:!1},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,default:null}},emits:["save","cancel","close"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O(null),x=O(""),c=O(!1),V=O(null);ge(()=>{a.item&&(x.value=a.item.fileName||"")}),ne(()=>a.item,b=>{b&&(x.value=b.fileName||"")},{deep:!0}),ne(()=>a.show,b=>{a.modal&&!b&&setTimeout(()=>{p.value=null,x.value=a.item&&a.item.fileName||"",c.value=!1},300)});const E=b=>{const M=b.target.files[0];M&&(p.value=M,x.value=M.name)},m=async()=>{var b,M;if(!(!p.value&&!a.item)){c.value=!0;try{const u={id:((b=a.item)==null?void 0:b.id)||Date.now(),type:"attachment",action:a.item?"updated an attachment":"added an attachment",fileName:x.value,file:p.value,timestamp:((M=a.item)==null?void 0:M.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",u),a.modal&&f("close")}finally{c.value=!1}}},C=()=>{f("cancel"),a.modal&&f("close")},d=b=>{b||f("close")};return r({submit:m,canSubmit:()=>!!p.value||!!a.item}),(b,M)=>s.modal?(h(),z(t(se),{key:0,open:s.show,"onUpdate:open":d},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(T(s.item?"Edit Attachment":"Add Attachment"),1)]),_:1})]),_:1}),e("div",kl,[e("div",Cl,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...M[2]||(M[2]=[v(" File ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),e("div",Vl,[e("input",{type:"file",onChange:E,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(U),{label:"Choose File",variant:"outline",size:"small",class:"rounded-sm",onClick:M[0]||(M[0]=u=>{var F;return(F=V.value)==null?void 0:F.click()})}),x.value?(h(),k("span",Sl,T(x.value),1)):(h(),k("span",$l,"No file selected"))])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:C}),l(t(U),{label:c.value?"Saving...":s.item?"Update Attachment":"Save Attachment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!p.value||c.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])):(h(),k("div",Il,[M[5]||(M[5]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",Tl,[e("h5",Al,T(s.item?"Edit Attachment":"Add Attachment"),1),e("button",{onClick:C,class:"text-sub hover:text-body"},[...M[3]||(M[3]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",null,[M[4]||(M[4]=e("label",{class:"block text-fluid-xs font-medium text-slate-700 mb-1"},"File",-1)),e("div",El,[e("input",{type:"file",onChange:E,ref_key:"fileInput",ref:V,class:"hidden"},null,544),l(t(U),{label:"Choose File",variant:"outline",size:"small",onClick:M[1]||(M[1]=u=>b.$refs.fileInput.click())}),x.value?(h(),k("span",Ml,T(x.value),1)):(h(),k("span",Dl,"No file selected"))])]),e("div",Pl,[l(t(U),{label:"Cancel",variant:"outline",size:"small",onClick:C}),l(t(U),{label:"Save",variant:"primary",size:"small",disabled:!p.value,onClick:m},null,8,["disabled"])])]))}},Ll={class:"space-y-6"},Ol={class:"space-y-2"},Ul={class:"space-y-2"},Fl={class:"flex justify-end gap-3"},Rl={__name:"WhatsAppForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(o.initialMessage),x={"Follow-up":"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions.","Meeting Confirmation":"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!","Quote Proposal":"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions.","Unable to Reach":"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."},c=()=>{f.value&&x[f.value]&&(p.value=x[f.value])},V=()=>{p.value.trim()&&a("send",{type:"whatsapp",template:f.value,message:p.value})};return(E,m)=>(h(),k("div",Ll,[e("div",Ol,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),l(t(B),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(B),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),l(t(B),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Ul,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=C=>p.value=C),rows:"6",placeholder:"Type your WhatsApp message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Fl,[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>E.$emit("cancel"))}),l(t(U),{label:"Send WhatsApp",variant:"primary",size:"small",class:"rounded-sm !bg-green-600 !hover:bg-green-700 !text-white !border-green-600",onClick:V})])]))}},Vn={__name:"AddWhatsAppModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,x)=>(h(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...x[1]||(x[1]=[v("Send WhatsApp Message",-1)])]),_:1})]),_:1}),l(Rl,{onSend:a,onCancel:x[0]||(x[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Bl={class:"space-y-6"},Nl={class:"space-y-2"},ql={class:"space-y-2"},jl={class:"text-xs text-sub mt-1"},zl={class:"flex justify-end gap-3"},_l={__name:"SMSForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(o.initialMessage),x={"Follow-up":"Hi! Following up on our conversation. Still interested? Let me know if you have questions.","Meeting Confirmation":"Confirming our meeting on [DATE] at [TIME]. Looking forward to it!","Quote Proposal":"Your quote is ready! I'll send you the details. Questions? Just ask.","Unable to Reach":"Tried to reach you. When's a good time to call back?"},c=()=>{f.value&&x[f.value]&&(p.value=x[f.value])},V=()=>{p.value.trim()&&a("send",{type:"sms",template:f.value,message:p.value})};return(E,m)=>(h(),k("div",Bl,[e("div",Nl,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[3]||(m[3]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[m[0]||(m[0]=C=>f.value=C),c]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Follow-up"},{default:i(()=>[...m[4]||(m[4]=[v("Follow-up",-1)])]),_:1}),l(t(B),{value:"Meeting Confirmation"},{default:i(()=>[...m[5]||(m[5]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(B),{value:"Quote Proposal"},{default:i(()=>[...m[6]||(m[6]=[v("Quote Proposal",-1)])]),_:1}),l(t(B),{value:"Unable to Reach"},{default:i(()=>[...m[7]||(m[7]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ql,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...m[8]||(m[8]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=C=>p.value=C),rows:"5",placeholder:"Type your SMS message here...",maxlength:"160",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"]),e("p",jl,T(p.value.length)+"/160 characters",1)]),e("div",zl,[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:m[2]||(m[2]=C=>E.$emit("cancel"))}),l(t(U),{label:"Send SMS",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:V})])]))}},Sn={__name:"AddSMSModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,x)=>(h(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...x[1]||(x[1]=[v("Send SMS",-1)])]),_:1})]),_:1}),l(_l,{onSend:a,onCancel:x[0]||(x[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},Wl={class:"space-y-6"},Hl={class:"space-y-2"},Ql={class:"space-y-2"},Yl={class:"space-y-2"},Gl={class:"flex justify-end gap-3"},Kl={__name:"EmailForm",props:{initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel"],setup(s,{emit:r}){const o=s,a=r,f=O(o.initialTemplate),p=O(""),x=O(o.initialMessage),c={"Follow-up":{subject:"Following up on your inquiry",message:"Hi! I wanted to follow up on our previous conversation. Are you still interested in moving forward? Let me know if you have any questions."},"Meeting Confirmation":{subject:"Meeting Confirmation",message:"This is a confirmation for our meeting scheduled on [DATE] at [TIME]. Looking forward to speaking with you!"},"Quote Proposal":{subject:"Your Quote Proposal",message:"Thank you for your interest! I've prepared a quote based on your requirements. Please find the details attached. Let me know if you have any questions."},"Unable to Reach":{subject:"Tried to reach you",message:"I tried reaching you but wasn't able to connect. Please let me know a good time to call you back, or feel free to reach out at your convenience."}},V=()=>{f.value&&c[f.value]&&(p.value=c[f.value].subject,x.value=c[f.value].message)},E=()=>{x.value.trim()&&a("send",{type:"email",template:f.value,subject:p.value,message:x.value})};return(m,C)=>(h(),k("div",Wl,[e("div",Hl,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[4]||(C[4]=[v("Template",-1)])]),_:1}),l(t(K),{modelValue:f.value,"onUpdate:modelValue":[C[0]||(C[0]=d=>f.value=d),V]},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select a template..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Follow-up"},{default:i(()=>[...C[5]||(C[5]=[v("Follow-up",-1)])]),_:1}),l(t(B),{value:"Meeting Confirmation"},{default:i(()=>[...C[6]||(C[6]=[v("Meeting Confirmation",-1)])]),_:1}),l(t(B),{value:"Quote Proposal"},{default:i(()=>[...C[7]||(C[7]=[v("Quote Proposal",-1)])]),_:1}),l(t(B),{value:"Unable to Reach"},{default:i(()=>[...C[8]||(C[8]=[v("Unable to Reach",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Ql,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[9]||(C[9]=[v("Subject",-1)])]),_:1}),l(t(P),{modelValue:p.value,"onUpdate:modelValue":C[1]||(C[1]=d=>p.value=d),type:"text",placeholder:"Email subject...",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Yl,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...C[10]||(C[10]=[v("Message",-1)])]),_:1}),l(t(ue),{modelValue:x.value,"onUpdate:modelValue":C[2]||(C[2]=d=>x.value=d),rows:"6",placeholder:"Type your message here...",class:"w-full min-h-[150px] resize-none"},null,8,["modelValue"])]),e("div",Gl,[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:C[3]||(C[3]=d=>m.$emit("cancel"))}),l(t(U),{label:"Send Email",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:E})])]))}},$n={__name:"AddEmailModal",props:{show:{type:Boolean,required:!0}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=p=>{o("save",p),o("close")},f=p=>{p||o("close")};return(p,x)=>(h(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] overflow-y-auto"},{default:i(()=>[l(t(te),null,{default:i(()=>[l(t(le),null,{default:i(()=>[...x[1]||(x[1]=[v("Send Email",-1)])]),_:1})]),_:1}),l(Kl,{onSend:a,onCancel:x[0]||(x[0]=c=>p.$emit("close"))})]),_:1})]),_:1})]),_:1},8,["open"]))}},In={__name:"ComingSoonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Coming Soon"}},emits:["close"],setup(s,{emit:r}){const o=r,a=p=>{p||o("close")},f=()=>{o("close")};return(p,x)=>(h(),z(t(se),{open:s.show,"onUpdate:open":a},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(T(s.title),1)]),_:1})]),_:1}),x[0]||(x[0]=e("div",{class:"flex-1 overflow-y-auto px-6 py-8 w-full"},[e("div",{class:"flex items-center justify-center w-full"},[e("p",{class:"text-gray-600 text-lg font-medium"},"Coming soon")])],-1)),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Close",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};class Zl extends Ye{constructor(){super([])}get dataSource(){return this._dataSource||(this._dataSource=[]),this._dataSource}async findAll(r={}){await new Promise(a=>setTimeout(a,300));let o=[...this.dataSource];return r.leadId!==void 0&&(o=o.filter(a=>a.leadId===parseInt(r.leadId))),r.opportunityId!==void 0&&(o=o.filter(a=>a.opportunityId===parseInt(r.opportunityId))),r.type&&(o=o.filter(a=>a.type===r.type)),r.offerId!==void 0&&(o=o.filter(a=>a.offerId===parseInt(r.offerId))),r.vehicleId!==void 0&&(o=o.filter(a=>a.vehicleId===parseInt(r.vehicleId))),o}async findAllByLeadId(r){return this.findAll({leadId:r})}async findAllByOpportunityId(r){return this.findAll({opportunityId:r})}async findById(r){return await new Promise(a=>setTimeout(a,300)),this.dataSource.find(a=>a.id===parseInt(r))||null}async create(r){await new Promise(f=>setTimeout(f,300));const a={id:this.dataSource.length>0?Math.max(...this.dataSource.map(f=>f.id))+1:1,type:r.type,leadId:r.leadId!==void 0?parseInt(r.leadId):void 0,opportunityId:r.opportunityId!==void 0?parseInt(r.opportunityId):void 0,offerId:r.offerId!==void 0?parseInt(r.offerId):void 0,vehicleId:r.vehicleId!==void 0?parseInt(r.vehicleId):void 0,fields:r.fields||{},currency:r.currency||"EUR",offerValidFrom:r.offerValidFrom||null,offerValidTo:r.offerValidTo||null,status:r.status||"active",createdAt:r.createdAt||new Date().toISOString(),createdBy:r.createdBy||null,updatedAt:new Date().toISOString()};return this.dataSource.push(a),a}async update(r,o){await new Promise(f=>setTimeout(f,300));const a=this.dataSource.find(f=>f.id===parseInt(r));if(!a)throw new Error("Purchase method not found");return Object.assign(a,o,{updatedAt:new Date().toISOString()}),a}async delete(r){await new Promise(a=>setTimeout(a,300));const o=this.dataSource.findIndex(a=>a.id===parseInt(r));if(o===-1)throw new Error("Purchase method not found");return this.dataSource.splice(o,1),{success:!0}}}class Jl{constructor(){this.repository=new Zl}calculateTotal(r){const{type:o,fields:a}=r;if(!a)return 0;const f=parseFloat(a.monthlyInstalment)||0,p=parseFloat(a.downPayment)||0,x=parseInt(a.duration)||0;switch(o){case"FIN":return f*x+p;case"LEA":const c=parseFloat(a.finalInstalment)||0;return f*x+p+c;case"LTR":return f*x+p;default:return 0}}validate(r){const o=[],{type:a,fields:f}=r;if((!a||!["FIN","LEA","LTR"].includes(a))&&o.push("Purchase method type is required and must be FIN, LEA, or LTR"),!f)return o.push("Purchase method fields are required"),{isValid:!1,errors:o};const p=parseFloat(f.monthlyInstalment);(!p||p<=0)&&o.push("Monthly Instalment must be greater than 0");const x=parseFloat(f.downPayment);(x==null||x<0)&&o.push("Down Payment must be greater than or equal to 0");const c=parseInt(f.duration);if((!c||c<12||c>60)&&o.push("Duration must be between 12 and 60 months"),a==="FIN"){const V=parseFloat(f.interestRate);V!=null&&(V<0||V>99.99)&&o.push("Interest Rate must be between 0 and 99.99%");const E=parseFloat(f.effectiveInterestRate);E!=null&&(E<0||E>99.99)&&o.push("Effective Interest Rate (TAEG) must be between 0 and 99.99%")}if(a==="LEA"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&o.push("Mileage Limit must be greater than 0 if provided");const E=parseFloat(f.finalInstalment);E!=null&&E<0&&o.push("Final Instalment must be greater than or equal to 0");const m=parseFloat(f.interestRate);m!=null&&(m<0||m>99.99)&&o.push("Interest Rate must be between 0 and 99.99%")}if(a==="LTR"){const V=parseFloat(f.mileageLimit);V!=null&&V<=0&&o.push("Mileage Limit must be greater than 0 if provided"),(!f.customerType||!["Private","Business","Fleet"].includes(f.customerType))&&o.push("Customer Type is required and must be Private, Business, or Fleet")}return{isValid:o.length===0,errors:o}}async findAll(r={}){return await this.repository.findAll(r)}async findById(r){return await this.repository.findById(r)}async create(r){const o=this.validate(r);if(!o.isValid)throw new Error(`Validation failed: ${o.errors.join(", ")}`);const a=await this.repository.create(r),f=this.calculateTotal(a);return a.fields={...a.fields,totalAmount:f},await this.repository.update(a.id,{fields:a.fields})}async update(r,o){const a=await this.repository.findById(r);if(!a)throw new Error("Purchase method not found");const f={...a,...o,fields:{...a.fields,...o.fields}},p=this.validate(f);if(!p.isValid)throw new Error(`Validation failed: ${p.errors.join(", ")}`);const x=this.calculateTotal(f);return f.fields.totalAmount=x,await this.repository.update(r,{...o,fields:f.fields})}async delete(r){return await this.repository.delete(r)}}const xe=new Jl,we=(s=300)=>new Promise(r=>setTimeout(r,s)),Xl=async(s={})=>(await we(),await xe.findAll(s)),es=async s=>(await we(),await xe.findById(s)),ts=async s=>(await we(),await xe.create(s)),ls=async(s,r)=>(await we(),await xe.update(s,r)),ss=async s=>(await we(),await xe.delete(s)),as=Ge("purchaseMethods",()=>{const s=O([]),r=O(null),o=O(!1),a=O(null),f=N(()=>d=>s.value.filter(b=>b.type===d)),p=N(()=>d=>s.value.filter(b=>b.leadId===parseInt(d))),x=N(()=>d=>s.value.filter(b=>b.opportunityId===parseInt(d)));return{purchaseMethods:s,currentPurchaseMethod:r,loading:o,error:a,purchaseMethodsByType:f,purchaseMethodsByLead:p,purchaseMethodsByOpportunity:x,fetchPurchaseMethods:async(d={})=>{o.value=!0,a.value=null;try{const b=await Xl(d);return s.value=b,b}catch(b){throw a.value=b.message,b}finally{o.value=!1}},fetchPurchaseMethodById:async d=>{o.value=!0,a.value=null;try{return r.value=await es(d),r.value}catch(b){throw a.value=b.message,b}finally{o.value=!1}},createPurchaseMethod:async d=>{o.value=!0,a.value=null;try{const b=await ts(d);return s.value.push(b),b}catch(b){throw a.value=b.message,b}finally{o.value=!1}},updatePurchaseMethod:async(d,b)=>{var M;o.value=!0,a.value=null;try{const u=await ls(d,b),F=s.value.findIndex(W=>W.id===d);return F!==-1&&(s.value[F]=u),((M=r.value)==null?void 0:M.id)===d&&(r.value=u),u}catch(u){throw a.value=u.message,u}finally{o.value=!1}},deletePurchaseMethod:async d=>{var b;o.value=!0,a.value=null;try{await ss(d),s.value=s.value.filter(M=>M.id!==d),((b=r.value)==null?void 0:b.id)===d&&(r.value=null)}catch(M){throw a.value=M.message,M}finally{o.value=!1}}}}),os={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ns={class:"flex gap-2"},is=["value"],ds={key:0,class:"space-y-4"},rs={class:"text-h3-card text-heading mb-4"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},cs={class:"relative"},ms={key:0,class:"text-xs text-red-600 mt-1"},fs={class:"relative"},ps={key:0,class:"text-xs text-red-600 mt-1"},vs={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ys={key:0,class:"text-xs text-red-600 mt-1"},bs={class:"space-y-2"},gs={key:0,class:"text-xs text-red-600 mt-1"},hs={key:0,class:"text-xs text-red-600 mt-1"},xs={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},ws={class:"flex justify-between items-center"},ks={class:"text-lg font-bold text-heading"},Cs={class:"flex flex-col gap-3"},Vs={class:"flex items-center gap-2"},Ss={class:"flex items-center gap-2"},$s={class:"flex items-center gap-2"},Is={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-E5E7EB"},Ts={class:"space-y-2"},As={class:"space-y-2"},Es={key:1,class:"bg-red-50 border border-red-200 rounded-card p-4"},Ms={class:"list-disc list-inside text-sm text-red-700 space-y-1"},Ds={key:0},Ps={key:1},Ls={__name:"PurchaseMethodModal",props:{show:{type:Boolean,required:!0},taskType:{type:String,default:"lead",validator:s=>["lead","opportunity"].includes(s)},taskId:{type:[String,Number],required:!0},purchaseMethod:{type:Object,default:null},vehicleId:{type:[String,Number],default:null},offerId:{type:[String,Number],default:null},vehiclePrice:{type:Number,default:null}},emits:["close","save"],setup(s,{emit:r}){const o=s,a=r,f=as(),p=Ke(),x=O(!1),c=O({}),V=O([]),E=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],m=O({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null}),C=N(()=>!!o.purchaseMethod);N(()=>{if(m.value.type!=="LEA")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,A=parseFloat(m.value.fields.downPayment)||0,ce=parseFloat(m.value.fields.finalInstalment)||0;return w*g+A+ce});const d=N(()=>{if(m.value.type!=="LTR")return 0;const w=parseFloat(m.value.fields.monthlyInstalment)||0,g=parseInt(m.value.fields.duration)||0,A=parseFloat(m.value.fields.downPayment)||0;return w*g+A}),b=w=>w==="FIN"?[12,24,36,48,60]:w==="LEA"?[24,36,48,60]:w==="LTR"?[12,24,36,48,60]:[],M=w=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[w]||w,u=w=>{const g=m.value.fields[w];switch(w){case"monthlyInstalment":!g||g<=0?c.value.monthlyInstalment="Monthly Instalment must be greater than 0":delete c.value.monthlyInstalment;break;case"downPayment":g==null||g<0?c.value.downPayment="Down Payment must be greater than or equal to 0":delete c.value.downPayment;break;case"duration":m.value.type==="LTR"&&(!g||g<12||g>60)?c.value.duration="Duration must be between 12 and 60 months":delete c.value.duration;break;case"customerType":m.value.type==="LTR"&&(!g||!["Private","Business","Fleet"].includes(g))?c.value.customerType="Customer Type is required":delete c.value.customerType;break}},F=w=>{delete c.value[w]},W=()=>{V.value=[],c.value={};const w=xe.validate({type:m.value.type,fields:m.value.fields});return w.isValid||(V.value=w.errors,w.errors.forEach(g=>{g.includes("Monthly Instalment")?c.value.monthlyInstalment=g:g.includes("Down Payment")?c.value.downPayment=g:g.includes("Duration")?c.value.duration=g:g.includes("Customer Type")&&(c.value.customerType=g)})),w.isValid},q=N(()=>!m.value.type||!m.value.fields.monthlyInstalment||m.value.fields.monthlyInstalment<=0||m.value.fields.downPayment===null||m.value.fields.downPayment===void 0||m.value.fields.downPayment<0||m.value.type==="LTR"&&(!m.value.fields.duration||m.value.fields.duration<12||m.value.fields.duration>60)||m.value.type==="LTR"&&!m.value.fields.customerType?!1:Object.keys(c.value).length===0),$=()=>{m.value.type!=="FIN"&&(m.value.fields.effectiveInterestRate=null,m.value.fields.gfv=null),m.value.type!=="LEA"&&(m.value.fields.finalInstalment=null),m.value.type!=="LTR"&&(m.value.fields.customerType="",m.value.fields.registrationTaxesIncluded=!1),m.value.type!=="LEA"&&m.value.type!=="LTR"&&(m.value.fields.mileageLimit=null,m.value.fields.maintenanceIncluded=!1),c.value={},V.value=[]},y=async()=>{var w;if(W()){x.value=!0;try{const g={type:m.value.type,fields:{...m.value.fields},currency:m.value.currency,offerValidFrom:m.value.offerValidFrom||null,offerValidTo:m.value.offerValidTo||null,createdBy:((w=p.currentUser)==null?void 0:w.id)||null};o.taskType==="lead"?g.leadId=parseInt(o.taskId):o.taskType==="opportunity"&&(g.opportunityId=parseInt(o.taskId)),o.vehicleId&&(g.vehicleId=parseInt(o.vehicleId)),o.offerId&&(g.offerId=parseInt(o.offerId));let A;C.value?A=await f.updatePurchaseMethod(o.purchaseMethod.id,g):A=await f.createPurchaseMethod(g);const ce=M(A.type),Se=Ue(A.fields.monthlyInstalment||0);a("save",{...A,successMessage:`Purchase Method Added: ${ce} - €${Se}/month`}),a("close")}catch(g){V.value=[g.message||"Failed to save purchase method"]}finally{x.value=!1}}},D=w=>{w||a("close")};return ge(()=>{o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null})}),ne(()=>o.show,w=>{w?o.purchaseMethod&&(m.value={type:o.purchaseMethod.type||"",fields:{...m.value.fields,...o.purchaseMethod.fields},currency:o.purchaseMethod.currency||"EUR",offerValidFrom:o.purchaseMethod.offerValidFrom||null,offerValidTo:o.purchaseMethod.offerValidTo||null}):setTimeout(()=>{m.value={type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1},currency:"EUR",offerValidFrom:null,offerValidTo:null},c.value={},V.value=[],x.value=!1},300)}),(w,g)=>(h(),z(t(se),{open:s.show,"onUpdate:open":D},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(T(C.value?"Edit Purchase Method":"Add Purchase Method"),1)]),_:1})]),_:1}),e("div",os,[e("div",null,[g[19]||(g[19]=e("label",{class:"block label-upper mb-3"},"Purchase Method Type",-1)),e("div",ns,[(h(),k(H,null,Z(E,A=>e("label",{key:A.value,class:"flex-1 cursor-pointer"},[fe(e("input",{type:"radio",value:A.value,"onUpdate:modelValue":g[0]||(g[0]=ce=>m.value.type=ce),class:"sr-only",onChange:$},null,40,is),[[Ze,m.value.type]]),e("div",{class:j(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",m.value.type===A.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},T(A.label),3)])),64))])]),m.value.type?(h(),k("div",ds,[e("h3",rs,T(M(m.value.type))+" Details ",1),e("div",us,[e("div",null,[g[21]||(g[21]=e("label",{class:"block label-upper mb-2"},[v(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",cs,[g[20]||(g[20]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),fe(e("input",{"onUpdate:modelValue":g[1]||(g[1]=A=>m.value.fields.monthlyInstalment=A),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.monthlyInstalment}]),onInput:g[2]||(g[2]=A=>F("monthlyInstalment")),onBlur:g[3]||(g[3]=A=>u("monthlyInstalment"))},null,34),[[Ve,m.value.fields.monthlyInstalment,void 0,{number:!0}]])]),c.value.monthlyInstalment?(h(),k("p",ms,T(c.value.monthlyInstalment),1)):L("",!0),g[22]||(g[22]=e("p",{class:"text-xs text-sub mt-1"},"Customer's desired monthly payment amount",-1))]),e("div",null,[g[24]||(g[24]=e("label",{class:"block label-upper mb-2"},[v(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",fs,[g[23]||(g[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),fe(e("input",{"onUpdate:modelValue":g[4]||(g[4]=A=>m.value.fields.downPayment=A),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:j(["input pl-8",{"border-red-500":c.value.downPayment}]),onInput:g[5]||(g[5]=A=>F("downPayment")),onBlur:g[6]||(g[6]=A=>u("downPayment"))},null,34),[[Ve,m.value.fields.downPayment,void 0,{number:!0}]])]),c.value.downPayment?(h(),k("p",ps,T(c.value.downPayment),1)):L("",!0),g[25]||(g[25]=e("p",{class:"text-xs text-sub mt-1"},"Amount at contract signing",-1))])]),m.value.type==="LTR"?(h(),k("div",vs,[e("div",null,[g[26]||(g[26]=e("label",{class:"block label-upper mb-2"},[v(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.duration,"onUpdate:modelValue":[g[7]||(g[7]=A=>m.value.fields.duration=A),g[8]||(g[8]=A=>F("duration"))]},{default:i(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.duration}])},{default:i(()=>[l(t(Y),{placeholder:"Select duration..."})]),_:1},8,["class"]),l(t(G),null,{default:i(()=>[(h(!0),k(H,null,Z(b(m.value.type),A=>(h(),z(t(B),{key:A,value:A},{default:i(()=>[v(T(A)+" months ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c.value.duration?(h(),k("p",ys,T(c.value.duration),1)):L("",!0)]),e("div",bs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...g[27]||(g[27]=[v("Unlock Kilometers",-1)])]),_:1}),l(t(P),{modelValue:m.value.fields.mileageLimit,"onUpdate:modelValue":g[9]||(g[9]=A=>m.value.fields.mileageLimit=A),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"0",class:j(["w-full h-10",{"border-red-500":c.value.mileageLimit}]),onInput:g[10]||(g[10]=A=>F("mileageLimit"))},null,8,["modelValue","class"]),c.value.mileageLimit?(h(),k("p",gs,T(c.value.mileageLimit),1)):L("",!0)])])):L("",!0),m.value.type==="LTR"?(h(),k(H,{key:1},[e("div",null,[g[31]||(g[31]=e("label",{class:"block label-upper mb-2"},[v(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),l(t(K),{modelValue:m.value.fields.customerType,"onUpdate:modelValue":[g[11]||(g[11]=A=>m.value.fields.customerType=A),g[12]||(g[12]=A=>F("customerType"))]},{default:i(()=>[l(t(Q),{class:j(["w-full h-10 min-h-10",{"border-red-500":c.value.customerType}])},{default:i(()=>[l(t(Y),{placeholder:"Select customer type..."})]),_:1},8,["class"]),l(t(G),null,{default:i(()=>[l(t(B),{value:"Private"},{default:i(()=>[...g[28]||(g[28]=[v("Private",-1)])]),_:1}),l(t(B),{value:"Business"},{default:i(()=>[...g[29]||(g[29]=[v("Business",-1)])]),_:1}),l(t(B),{value:"Fleet"},{default:i(()=>[...g[30]||(g[30]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value.customerType?(h(),k("p",hs,T(c.value.customerType),1)):L("",!0)]),e("div",xs,[e("div",ws,[g[32]||(g[32]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",ks,"€ "+T(t(Ue)(d.value)),1)]),g[33]||(g[33]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Cs,[e("div",Vs,[l(t(oe),{id:"ltr-insurance",checked:m.value.fields.insuranceIncluded,"onUpdate:checked":g[13]||(g[13]=A=>m.value.fields.insuranceIncluded=A)},null,8,["checked"]),l(t(I),{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...g[34]||(g[34]=[v(" Insurance Included ",-1)])]),_:1})]),e("div",Ss,[l(t(oe),{id:"ltr-maintenance",checked:m.value.fields.maintenanceIncluded,"onUpdate:checked":g[14]||(g[14]=A=>m.value.fields.maintenanceIncluded=A)},null,8,["checked"]),l(t(I),{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...g[35]||(g[35]=[v(" Maintenance Included ",-1)])]),_:1})]),e("div",$s,[l(t(oe),{id:"ltr-registration",checked:m.value.fields.registrationTaxesIncluded,"onUpdate:checked":g[15]||(g[15]=A=>m.value.fields.registrationTaxesIncluded=A)},null,8,["checked"]),l(t(I),{for:"ltr-registration",class:"text-sm text-body cursor-pointer"},{default:i(()=>[...g[36]||(g[36]=[v(" Registration/Taxes Included ",-1)])]),_:1})])])],64)):L("",!0),e("div",Is,[e("div",Ts,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...g[37]||(g[37]=[v("Offer Valid From",-1)])]),_:1}),l(t(P),{modelValue:m.value.offerValidFrom,"onUpdate:modelValue":g[16]||(g[16]=A=>m.value.offerValidFrom=A),type:"date",class:"w-full h-10"},null,8,["modelValue"])]),e("div",As,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...g[38]||(g[38]=[v("Offer Valid To",-1)])]),_:1}),l(t(P),{modelValue:m.value.offerValidTo,"onUpdate:modelValue":g[17]||(g[17]=A=>m.value.offerValidTo=A),type:"date",class:"w-full h-10"},null,8,["modelValue"])])])])):L("",!0),V.value.length>0?(h(),k("div",Es,[g[39]||(g[39]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Please fix the following errors:",-1)),e("ul",Ms,[(h(!0),k(H,null,Z(V.value,A=>(h(),k("li",{key:A},T(A),1))),128))])])):L("",!0)]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:g[18]||(g[18]=A=>w.$emit("close"))}),l(t(U),{label:C.value?"Update Purchase Method":"Save Purchase Method",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!q.value||x.value,onClick:y},{default:i(()=>[x.value?(h(),k("span",Ds,"Saving...")):(h(),k("span",Ps,T(C.value?"Update":"Save"),1))]),_:1},8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Tn=Be(Ls,[["__scopeId","data-v-c85eec7d"]]),Os={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},Us={key:0,class:"space-y-4 py-4 w-full"},Fs={class:"grid grid-cols-1 gap-3"},Rs={key:1,class:"space-y-6 w-full"},Bs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ns={class:"space-y-2"},qs={class:"space-y-2"},js={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zs={class:"space-y-2"},_s={class:"space-y-2"},Ws={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Hs={class:"space-y-2"},Qs={class:"space-y-2"},Ys={class:"space-y-2"},Gs={class:"space-y-2"},Ks={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Zs={class:"space-y-2"},Js={class:"space-y-2"},Xs={class:"space-y-2"},ea={class:"space-y-2"},ta={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},la={class:"space-y-2"},sa={class:"space-y-2"},aa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},oa={class:"space-y-2"},na={class:"space-y-2"},ia={class:"space-y-2"},da={class:"space-y-2"},ra={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ua={class:"space-y-2"},ca={class:"space-y-2"},ma={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fa={class:"space-y-2"},pa={class:"space-y-2"},An={__name:"AddVehicleModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"vehicle",validator:s=>["vehicle","tradein"].includes(s)},item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(s,{emit:r}){const o=s,a=r,f=O(o.mode==="tradein"?"tradein":null);ne(()=>o.mode,C=>{C==="tradein"?f.value="tradein":o.item||(f.value=null)});const p=N(()=>o.mode==="tradein"||f.value==="tradein"),x=()=>o.mode==="tradein"||f.value==="tradein"?"Add Trade-In Vehicle":f.value==="drove"?"Add Drove Vehicle":f.value==="requested"?"Add Requested Vehicle":"Add Vehicle",c=O({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null});ge(()=>{o.item&&o.item.data&&(c.value={brand:o.item.data.brand||"",model:o.item.data.model||"",year:o.item.data.year||"",version:o.item.data.version||"",vin:o.item.data.vin||"",plates:o.item.data.plate||o.item.data.plates||"",fuelType:o.item.data.fuelType||"",gearType:o.item.data.gearType||"",kilometers:o.item.data.km||o.item.data.kilometers||"",registration:o.item.data.date||o.item.data.registration||"",owner:o.item.data.owner||"",ownershipType:o.item.data.ownershipType||"",ownedSince:o.item.data.ownedSince||"",warrantyInfo:o.item.data.warrantyInfo||"",note:o.item.data.note||"",stockDays:null})}),ne(()=>o.show,C=>{C||(f.value=null,c.value={brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:"",owner:"",ownershipType:"",ownedSince:"",warrantyInfo:"",note:"",stockDays:null})});const V=N(()=>!!c.value.brand&&!!c.value.model&&!!c.value.year),E=C=>{C||a("close")},m=()=>{if(!V.value)return;const C={vehicle:{brand:c.value.brand,model:c.value.model,year:parseInt(c.value.year)||null,version:c.value.version||null,vin:c.value.vin||null,plates:c.value.plates||null,fuelType:c.value.fuelType||null,gearType:c.value.gearType||null,kilometers:parseInt(c.value.kilometers)||0,registration:c.value.registration||null,owner:c.value.owner||null,ownershipType:c.value.ownershipType||null,ownedSince:c.value.ownedSince||null,warrantyInfo:c.value.warrantyInfo||null,note:c.value.note||null,stockDays:null,status:"Available"}};f.value&&(C.vehicleType=f.value),o.item&&(C.id=o.item.id,C.isEdit=!0,C.timestamp=o.item.timestamp||new Date().toISOString()),a("save",C)};return(C,d)=>(h(),z(t(se),{open:s.show,"onUpdate:open":E},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[v(T(x()),1)]),_:1})]),_:1}),e("div",Os,[s.mode==="vehicle"&&!s.item&&!f.value?(h(),k("div",Us,[d[26]||(d[26]=e("p",{class:"text-body text-sm mb-4"},"Select the type of vehicle you want to add:",-1)),e("div",Fs,[l(t(U),{label:"Drove",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[0]||(d[0]=b=>f.value="drove")}),l(t(U),{label:"Requested",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[1]||(d[1]=b=>f.value="requested")}),l(t(U),{label:"Trade-In",variant:"outline",size:"small",class:"w-full justify-start !border-D1D5DB !text-heading hover:!bg-surfaceSecondary",onClick:d[2]||(d[2]=b=>f.value="tradein")})])])):(h(),k("div",Rs,[p.value?(h(),k(H,{key:0},[e("div",Bs,[e("div",Ns,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[27]||(d[27]=[v("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(P),{modelValue:c.value.brand,"onUpdate:modelValue":d[3]||(d[3]=b=>c.value.brand=b),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",qs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[28]||(d[28]=[v("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(P),{modelValue:c.value.model,"onUpdate:modelValue":d[4]||(d[4]=b=>c.value.model=b),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])])]),e("div",js,[e("div",zs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[29]||(d[29]=[v("Year (or registration year) ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),l(t(P),{modelValue:c.value.year,"onUpdate:modelValue":d[5]||(d[5]=b=>c.value.year=b),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])]),e("div",_s,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[30]||(d[30]=[v("Kilometers",-1)])]),_:1}),l(t(P),{modelValue:c.value.kilometers,"onUpdate:modelValue":d[6]||(d[6]=b=>c.value.kilometers=b),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",Ws,[e("div",Hs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[31]||(d[31]=[v("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":d[7]||(d[7]=b=>c.value.fuelType=b)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Petrol"},{default:i(()=>[...d[32]||(d[32]=[v("Petrol",-1)])]),_:1}),l(t(B),{value:"Diesel"},{default:i(()=>[...d[33]||(d[33]=[v("Diesel",-1)])]),_:1}),l(t(B),{value:"Electric"},{default:i(()=>[...d[34]||(d[34]=[v("Electric",-1)])]),_:1}),l(t(B),{value:"Hybrid"},{default:i(()=>[...d[35]||(d[35]=[v("Hybrid",-1)])]),_:1}),l(t(B),{value:"Plug-in Hybrid"},{default:i(()=>[...d[36]||(d[36]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Qs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[37]||(d[37]=[v("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":d[8]||(d[8]=b=>c.value.gearType=b)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Manual"},{default:i(()=>[...d[38]||(d[38]=[v("Manual",-1)])]),_:1}),l(t(B),{value:"Automatic"},{default:i(()=>[...d[39]||(d[39]=[v("Automatic",-1)])]),_:1}),l(t(B),{value:"CVT"},{default:i(()=>[...d[40]||(d[40]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",Ys,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[41]||(d[41]=[v("Plates",-1)])]),_:1}),l(t(P),{modelValue:c.value.plates,"onUpdate:modelValue":d[9]||(d[9]=b=>c.value.plates=b),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"]),d[42]||(d[42]=e("p",{class:"text-xs text-sub mt-1"},"These can be relevant for automatically retrieving other information.",-1))]),e("div",Gs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[43]||(d[43]=[v("Note",-1)])]),_:1}),l(t(ue),{modelValue:c.value.note,"onUpdate:modelValue":d[10]||(d[10]=b=>c.value.note=b),rows:"5",placeholder:"Add unquantifiable requests, such as the customer's desired value for the car...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])])],64)):(h(),k(H,{key:1},[e("div",Ks,[e("div",Zs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[44]||(d[44]=[v("Brand",-1)])]),_:1}),l(t(P),{modelValue:c.value.brand,"onUpdate:modelValue":d[11]||(d[11]=b=>c.value.brand=b),type:"text",placeholder:"e.g., Volkswagen",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",Js,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[45]||(d[45]=[v("Model",-1)])]),_:1}),l(t(P),{modelValue:c.value.model,"onUpdate:modelValue":d[12]||(d[12]=b=>c.value.model=b),type:"text",placeholder:"e.g., ID.4",class:"w-full h-10",required:""},null,8,["modelValue"])]),e("div",Xs,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[46]||(d[46]=[v("Year",-1)])]),_:1}),l(t(P),{modelValue:c.value.year,"onUpdate:modelValue":d[13]||(d[13]=b=>c.value.year=b),type:"number",placeholder:"e.g., 2024",class:"w-full h-10",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",ea,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[47]||(d[47]=[v("Version/Trim",-1)])]),_:1}),l(t(P),{modelValue:c.value.version,"onUpdate:modelValue":d[14]||(d[14]=b=>c.value.version=b),type:"text",placeholder:"e.g., Premium Plus",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ta,[e("div",la,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[48]||(d[48]=[v("VIN",-1)])]),_:1}),l(t(P),{modelValue:c.value.vin,"onUpdate:modelValue":d[15]||(d[15]=b=>c.value.vin=b),type:"text",placeholder:"Vehicle Identification Number",class:"w-full h-10"},null,8,["modelValue"])]),e("div",sa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[49]||(d[49]=[v("Plates",-1)])]),_:1}),l(t(P),{modelValue:c.value.plates,"onUpdate:modelValue":d[16]||(d[16]=b=>c.value.plates=b),type:"text",placeholder:"License plate number",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",aa,[e("div",oa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[50]||(d[50]=[v("Fuel Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.fuelType,"onUpdate:modelValue":d[17]||(d[17]=b=>c.value.fuelType=b)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select fuel type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Petrol"},{default:i(()=>[...d[51]||(d[51]=[v("Petrol",-1)])]),_:1}),l(t(B),{value:"Diesel"},{default:i(()=>[...d[52]||(d[52]=[v("Diesel",-1)])]),_:1}),l(t(B),{value:"Electric"},{default:i(()=>[...d[53]||(d[53]=[v("Electric",-1)])]),_:1}),l(t(B),{value:"Hybrid"},{default:i(()=>[...d[54]||(d[54]=[v("Hybrid",-1)])]),_:1}),l(t(B),{value:"Plug-in Hybrid"},{default:i(()=>[...d[55]||(d[55]=[v("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",na,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[56]||(d[56]=[v("Gear Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.gearType,"onUpdate:modelValue":d[18]||(d[18]=b=>c.value.gearType=b)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select gear type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Manual"},{default:i(()=>[...d[57]||(d[57]=[v("Manual",-1)])]),_:1}),l(t(B),{value:"Automatic"},{default:i(()=>[...d[58]||(d[58]=[v("Automatic",-1)])]),_:1}),l(t(B),{value:"CVT"},{default:i(()=>[...d[59]||(d[59]=[v("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ia,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[60]||(d[60]=[v("Mileage (km)",-1)])]),_:1}),l(t(P),{modelValue:c.value.kilometers,"onUpdate:modelValue":d[19]||(d[19]=b=>c.value.kilometers=b),modelModifiers:{number:!0},type:"number",placeholder:"0",class:"w-full h-10",min:"0"},null,8,["modelValue"])])]),e("div",da,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[61]||(d[61]=[v("Registration Year/Month",-1)])]),_:1}),l(t(P),{modelValue:c.value.registration,"onUpdate:modelValue":d[20]||(d[20]=b=>c.value.registration=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ra,[e("div",ua,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[62]||(d[62]=[v("Owned Since",-1)])]),_:1}),l(t(P),{modelValue:c.value.ownedSince,"onUpdate:modelValue":d[21]||(d[21]=b=>c.value.ownedSince=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"w-full h-10"},null,8,["modelValue"])]),e("div",ca,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[63]||(d[63]=[v("Owner",-1)])]),_:1}),l(t(P),{modelValue:c.value.owner,"onUpdate:modelValue":d[22]||(d[22]=b=>c.value.owner=b),type:"text",placeholder:"Owner name",class:"w-full h-10"},null,8,["modelValue"])])]),e("div",ma,[e("div",fa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[64]||(d[64]=[v("Ownership Type",-1)])]),_:1}),l(t(K),{modelValue:c.value.ownershipType,"onUpdate:modelValue":d[23]||(d[23]=b=>c.value.ownershipType=b)},{default:i(()=>[l(t(Q),{class:"w-full h-10"},{default:i(()=>[l(t(Y),{placeholder:"Select ownership type..."})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Private"},{default:i(()=>[...d[65]||(d[65]=[v("Private",-1)])]),_:1}),l(t(B),{value:"Company"},{default:i(()=>[...d[66]||(d[66]=[v("Company",-1)])]),_:1}),l(t(B),{value:"Lease"},{default:i(()=>[...d[67]||(d[67]=[v("Lease",-1)])]),_:1}),l(t(B),{value:"Fleet"},{default:i(()=>[...d[68]||(d[68]=[v("Fleet",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",pa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...d[69]||(d[69]=[v("Warranty Info",-1)])]),_:1}),l(t(ue),{modelValue:c.value.warrantyInfo,"onUpdate:modelValue":d[24]||(d[24]=b=>c.value.warrantyInfo=b),rows:"4",placeholder:"Warranty information...",class:"w-full min-h-[100px] resize-none"},null,8,["modelValue"])])],64))]))]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:d[25]||(d[25]=b=>C.$emit("close"))}),l(t(U),{label:p.value?"Save Trade-In":"Add Vehicle",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!V.value,onClick:m},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},va={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},ya=["src","alt"],ba={key:1,class:"w-full h-full flex items-center justify-center"},ga={class:"flex items-center justify-between mb-1.5"},ha={class:"text-sm font-bold text-heading"},xa={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},wa={class:"text-xs text-sub mb-1.5"},ka={key:0,class:"text-xs text-green-600 font-medium mb-2"},Ca={key:1,class:"text-xs text-orange-600 font-medium mb-2"},Re={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(s){const r=s,o=N(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[r.badge]||"gray"),a=f=>f?f.toLocaleString("en-US"):"0";return(f,p)=>(h(),k("div",{onClick:p[1]||(p[1]=x=>f.$emit("select")),class:j(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":s.selected}])},[e("div",va,[s.vehicle.image?(h(),k("img",{key:0,src:s.vehicle.image,alt:`${s.vehicle.brand} ${s.vehicle.model}`,class:"w-full h-full object-cover"},null,8,ya)):(h(),k("div",ba,[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",ga,[l(t(at),{text:s.badge,size:"small",theme:o.value},null,8,["text","theme"]),e("span",ha,"€"+T(a(s.vehicle.price)),1)]),e("h4",xa,T(s.vehicle.brand)+" "+T(s.vehicle.model),1),e("p",wa,T(s.vehicle.year),1),s.stockDays!==null&&s.stockDays!==void 0?(h(),k("div",ka,[p[3]||(p[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),v(" In stock ("+T(s.stockDays)+" days) ",1)])):(h(),k("div",Ca,[...p[4]||(p[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),v(" Out of stock ",-1)])])),e("button",{onClick:p[0]||(p[0]=Ce(x=>f.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},Va={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Sa={key:0},$a={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Ia={class:"mb-4"},Ta={class:"relative"},Aa={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Ea={key:1,class:"text-center py-8 text-sub"},Ma={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},Da={key:0,class:"mt-4 space-y-4"},Pa={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},La={class:"space-y-2"},Oa={class:"space-y-2"},Ua={class:"space-y-2"},Fa={class:"space-y-2"},Ra={class:"flex justify-end"},Ba=["disabled"],Na={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(s,{emit:r}){const o=s,a=r,f=$=>{$||a("close")},p=O(""),x=O(!1),c=O(null),V=O(null),E=O(null),m=O([]),C=O({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});ge(async()=>{try{const $=await nt({});m.value=$.data||[]}catch($){console.error("Failed to load vehicles:",$),m.value=[]}});const d=N(()=>o.requestedVehicle&&o.requestedVehicle.stockDays!==null&&o.requestedVehicle.stockDays!==void 0),b=N(()=>{const $=[];if(o.requestedVehicle&&d.value&&$.push({...o.requestedVehicle,isRequested:!0}),m.value&&m.value.length>0){const y=m.value.filter(w=>o.requestedVehicle?w.brand!==o.requestedVehicle.brand||w.model!==o.requestedVehicle.model:!0),D=o.requestedVehicle&&d.value?3:4;$.push(...y.slice(0,D))}return $}),M=N(()=>{if(!m.value||m.value.length===0)return[];let $=[...m.value];if(p.value){const y=p.value.toLowerCase();$=$.filter(D=>D.brand.toLowerCase().includes(y)||D.model.toLowerCase().includes(y)||D.year.toString().includes(y))}return $}),u=N(()=>C.value.brand&&C.value.model&&C.value.year&&C.value.price>0),F=($,y)=>{c.value=$,V.value=$.id||`custom-${Date.now()}`,E.value=y},W=()=>{if(!u.value)return;const $={...C.value,id:`custom-${Date.now()}`,isCustom:!0};F($,"custom")},q=()=>{c.value&&(a("vehicle-selected",{vehicle:c.value,type:E.value}),a("close"),c.value=null,V.value=null,E.value=null,p.value="",x.value=!1,C.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return($,y)=>(h(),z(t(se),{open:s.show,"onUpdate:open":f},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-6xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(te),{class:"flex-shrink-0"},{default:i(()=>[l(t(le),null,{default:i(()=>[...y[7]||(y[7]=[v("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",Va,[b.value.length?(h(),k("div",Sa,[y[8]||(y[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),v(" Recommended Vehicles ")],-1)),e("div",$a,[(h(!0),k(H,null,Z(b.value,D=>(h(),z(Re,{key:D.id,vehicle:D,badge:D.isRequested?"Requested":"Recommended","stock-days":D.stockDays,selected:V.value===D.id,onSelect:w=>F(D,D.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):L("",!0),e("div",null,[y[11]||(y[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),v(" Browse Stock ")],-1)),e("div",Ia,[e("div",Ta,[y[9]||(y[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),fe(e("input",{"onUpdate:modelValue":y[0]||(y[0]=D=>p.value=D),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Ve,p.value]])])]),M.value.length?(h(),k("div",Aa,[(h(!0),k(H,null,Z(M.value,D=>(h(),z(Re,{key:D.id,vehicle:D,badge:"In Stock","stock-days":D.stockDays,selected:V.value===D.id,onSelect:w=>F(D,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(h(),k("div",Ea,[...y[10]||(y[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[y[19]||(y[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),v(" Configure Custom Vehicle ")],-1)),e("div",Ma,[y[18]||(y[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:y[1]||(y[1]=D=>x.value=!x.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[y[12]||(y[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),v(" "+T(x.value?"Hide Configuration":"Build Custom Configuration"),1)]),x.value?(h(),k("div",Da,[e("div",Pa,[e("div",La,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[13]||(y[13]=[v("Brand",-1)])]),_:1}),l(t(P),{modelValue:C.value.brand,"onUpdate:modelValue":y[2]||(y[2]=D=>C.value.brand=D),type:"text",class:"w-full h-10",placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",Oa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[14]||(y[14]=[v("Model",-1)])]),_:1}),l(t(P),{modelValue:C.value.model,"onUpdate:modelValue":y[3]||(y[3]=D=>C.value.model=D),type:"text",class:"w-full h-10",placeholder:"e.g., e-tron GT"},null,8,["modelValue"])]),e("div",Ua,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[15]||(y[15]=[v("Year",-1)])]),_:1}),l(t(P),{modelValue:C.value.year,"onUpdate:modelValue":y[4]||(y[4]=D=>C.value.year=D),type:"number",class:"w-full h-10",placeholder:"2024"},null,8,["modelValue"])]),e("div",Fa,[l(t(I),{class:"block text-sm font-semibold text-heading"},{default:i(()=>[...y[16]||(y[16]=[v("Price (€)",-1)])]),_:1}),l(t(P),{modelValue:C.value.price,"onUpdate:modelValue":y[5]||(y[5]=D=>C.value.price=D),type:"number",class:"w-full h-10",placeholder:"98000"},null,8,["modelValue"])])]),e("div",Ra,[e("button",{onClick:W,disabled:!u.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...y[17]||(y[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),v(" Use Custom Configuration ",-1)])],8,Ba)])])):L("",!0)])])]),l(t(be),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[6]||(y[6]=D=>$.$emit("close"))}),c.value?(h(),z(t(U),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:q})):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},qa={class:"bg-surface rounded-xl p-5 mb-6 animate-fade-in relative"},ja={key:0,class:"flex justify-between items-center mb-4"},za={class:"text-sm font-bold text-heading"},_a={key:1,class:"mb-6"},Wa={class:"bg-white border border-black/5 rounded-lg shadow-sm overflow-hidden p-6"},Ha={class:"space-y-3"},Qa={key:2,class:"mb-6 p-4 bg-surfaceSecondary rounded-lg border border-border"},Ya={class:"flex items-center gap-3"},Ga={class:"w-16 h-16 bg-surfaceTertiary rounded overflow-hidden flex-shrink-0"},Ka=["src"],Za={key:1,class:"fa-solid fa-car text-sub w-full h-full flex items-center justify-center"},Ja={class:"font-bold text-sm text-heading"},Xa={class:"text-xs text-sub"},eo={key:3,class:"space-y-3"},to={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},lo={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},so={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ao={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},no={key:0,class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},io={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},ro={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},co={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},mo={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},fo={class:"space-y-3"},po={class:"flex items-center gap-2"},vo={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-surfaceSecondary rounded-lg"},yo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},bo={class:"flex items-center gap-2"},go={class:"text-xs text-sub"},ho={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},xo={class:"flex justify-end"},wo={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ko={class:"md:col-span-2"},Co={class:"flex justify-between items-end gap-2"},Vo={class:"grid grid-cols-2 gap-3"},So={class:"flex justify-end"},$o={class:"text-sm font-semibold text-heading"},Io={key:0,class:"text-center py-6 text-sub text-xs"},To={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},Ao={class:"flex items-center gap-2"},Eo={class:"text-xs text-sub"},Mo={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},Do={class:"flex justify-end"},Po={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Lo={class:"flex justify-between items-center"},Oo={key:0,class:"text-center py-6 text-sub text-xs"},Uo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},Fo={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},Ro={class:"flex items-center gap-2"},Bo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},No={class:"flex items-center gap-2"},qo={class:"text-xs text-sub"},jo={key:0,class:"px-4 pb-4 space-y-3 border-t border-E5E7EB pt-4"},zo={class:"flex justify-end"},_o={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wo={class:"flex justify-between items-center"},Ho={key:0,class:"text-center py-6 text-sub text-xs"},Qo={key:1,class:"bg-surfaceSecondary rounded-lg p-4 mt-4 space-y-2"},Yo={class:"flex justify-between items-center"},Go={class:"text-sm font-bold text-heading"},Ko={class:"flex justify-between items-center"},Zo={class:"text-sm font-bold text-heading"},Jo={key:0,class:"text-xs text-red-600"},Xo={class:"border border-E5E7EB rounded-lg bg-white shadow-sm"},en={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},tn={class:"space-y-3 pt-3 border-t border-E5E7EB"},ln={class:"flex items-start gap-2"},sn={class:"flex items-start gap-2"},an={key:4,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},on={__name:"OfferWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:Number,required:!0},selectedVehicle:{type:Object,default:null},customer:{type:Object,default:null},hideHeader:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["save","cancel"],setup(s,{expose:r,emit:o}){const a=s,f=o,p=O("select"),x=O(!1),c=O(!1),V=O(!1),E=O(!1),m=O(!1),C=O(!1),d=O(!1),b=O(!1),M=O(!1),u=O({salutation:"",firstName:"",lastName:"",email:"",phone:"",zipCode:"",address:"",city:"",price:0,financingType:"",downPayment:0,monthlyPayment:0,term:36,interestRate:3.5,notes:"",privacyConsent:!1,marketingConsent:!1,brand:"",model:"",year:"",image:"",showVat:!1,vatRate:21,quotationItems:[],discounts:[],tradeIn:{showOnPdf:!0,valuation:0,notes:""},paymentMethods:[],expirationDate:null}),F=N(()=>!!a.customer),W=N(()=>{let R=u.value.price||0;return u.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),u.value.showVat?R-q.value:R}),q=N(()=>{if(!u.value.showVat||!u.value.vatRate)return 0;let R=u.value.price||0;return u.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),R*u.value.vatRate/(100+u.value.vatRate)}),$=N(()=>{let R=u.value.price||0;return u.value.quotationItems.forEach(n=>{R+=(n.price||0)*(n.quantity||1)}),u.value.discounts.forEach(n=>{R-=n.price||0}),u.value.tradeIn.valuation&&(R-=u.value.tradeIn.valuation),R}),y=N(()=>u.value.paymentMethods.reduce((R,n)=>R+(n.amount||0),0)),D=N(()=>u.value.paymentMethods.length===0?!0:Math.abs(y.value-$.value)<.01),w=()=>{u.value.quotationItems.push({type:"custom",name:"",price:0,quantity:1,vat:0})},g=R=>{u.value.quotationItems.splice(R,1)},A=()=>{u.value.discounts.push({title:"",price:0,vatInclusive:!0})},ce=R=>{u.value.discounts.splice(R,1)},Se=()=>{u.value.paymentMethods.push({description:"",amount:0,paid:!1})},qe=R=>{u.value.paymentMethods.splice(R,1)},Ae=()=>{if(a.customer){const R=(a.customer.name||"").split(" ");u.value.firstName=R[0]||"",u.value.lastName=R.slice(1).join(" ")||"",u.value.email=a.customer.email||"",u.value.phone=a.customer.phone||"",u.value.address=a.customer.address||"",u.value.city=a.customer.city||"",u.value.zipCode=a.customer.zipCode||a.customer.postalCode||""}};ge(()=>{Ae(),a.item&&(p.value="manual"),a.selectedVehicle&&(p.value="manual"),a.selectedVehicle&&(u.value.price=a.selectedVehicle.price||0,u.value.brand=a.selectedVehicle.brand||"",u.value.model=a.selectedVehicle.model||"",u.value.year=a.selectedVehicle.year||"",u.value.image=a.selectedVehicle.image||""),a.item&&a.item.data&&(u.value={...u.value,...a.item.data,price:a.item.data.price||a.item.data.total||0,financingType:a.item.data.financingType||a.item.data.paymentMethod||"",notes:a.item.data.notes||a.item.data.description||"",showVat:a.item.data.showVat||!1,vatRate:a.item.data.vatRate||21,quotationItems:a.item.data.quotationItems||[],discounts:a.item.data.discounts||[],tradeIn:a.item.data.tradeIn||{showOnPdf:!0,valuation:0,notes:""},paymentMethods:a.item.data.paymentMethods||[],expirationDate:a.item.data.expirationDate||null})}),ne(()=>a.selectedVehicle,R=>{R&&!a.item&&(p.value="manual",u.value.price=R.price||0,u.value.brand=R.brand||"",u.value.model=R.model||"",u.value.year=R.year||"",u.value.image=R.image||"")}),ne(()=>a.customer,()=>{Ae()});const $e=N(()=>{const R=u.value.salutation!==""&&u.value.firstName!==""&&u.value.lastName!==""&&u.value.email!==""&&u.value.zipCode!==""&&u.value.price>0&&u.value.financingType!==""&&u.value.privacyConsent===!0,n=a.selectedVehicle||p.value==="manual",me=D.value;return R&&n&&me}),ke=R=>R?(typeof R=="string"?parseFloat(R):R).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",je=R=>{const n=R.vehicle;u.value.brand=n.brand||"",u.value.model=n.model||"",u.value.year=n.year||"",u.value.price=n.price||0,u.value.image=n.image||"",p.value="manual",x.value=!1},Ee=()=>{var n,me;if(!$e.value)return;const R={id:((n=a.item)==null?void 0:n.id)||Date.now(),type:"offer",action:a.item?"updated an offer":"created an offer",data:{salutation:u.value.salutation,firstName:u.value.firstName,lastName:u.value.lastName,email:u.value.email,phone:u.value.phone,zipCode:u.value.zipCode,address:u.value.address,city:u.value.city,brand:u.value.brand,model:u.value.model,year:u.value.year,image:u.value.image,price:u.value.price,total:$.value,paymentMethod:u.value.financingType,financingType:u.value.financingType,downPayment:u.value.downPayment,monthlyPayment:u.value.monthlyPayment,term:u.value.term,interestRate:u.value.interestRate,notes:u.value.notes,description:u.value.notes,privacyConsent:u.value.privacyConsent,marketingConsent:u.value.marketingConsent,showVat:u.value.showVat,vatRate:u.value.vatRate,vatAmount:q.value,subtotal:W.value,quotationItems:u.value.quotationItems,discounts:u.value.discounts,tradeIn:u.value.tradeIn,paymentMethods:u.value.paymentMethods,expirationDate:u.value.expirationDate,grandTotal:$.value},timestamp:((me=a.item)==null?void 0:me.timestamp)||new Date().toISOString(),isEdit:!!a.item};f("save",R)};return r({submit:Ee,isValid:$e,offerData:u}),(R,n)=>{var me,Me,De,Pe,Le,Oe;return h(),k("div",qa,[s.hideHeader?L("",!0):(h(),k("div",ja,[e("h5",za,T(s.item?"Edit Offer":"Create Offer"),1),l(t(U),{variant:"ghost",size:"icon",onClick:n[0]||(n[0]=S=>R.$emit("cancel")),class:"text-sub hover:text-body"},{default:i(()=>[...n[37]||(n[37]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])]),_:1})])),!s.selectedVehicle&&!s.item&&p.value==="select"?(h(),k("div",_a,[e("div",Wa,[n[41]||(n[41]=e("h6",{class:"text-sm font-semibold text-heading mb-4"},"Select Vehicle",-1)),n[42]||(n[42]=e("p",{class:"text-xs text-body mb-4"},"Choose how you want to add a vehicle to this offer:",-1)),e("div",Ha,[l(t(U),{variant:"outline",class:"w-full justify-start",onClick:n[1]||(n[1]=S=>x.value=!0)},{default:i(()=>[...n[38]||(n[38]=[e("i",{class:"fa-solid fa-warehouse mr-2"},null,-1),v(" Add from Stock — Search and select an existing vehicle from inventory ",-1)])]),_:1}),l(t(U),{variant:"outline",class:"w-full justify-start",onClick:n[2]||(n[2]=S=>x.value=!0)},{default:i(()=>[...n[39]||(n[39]=[e("i",{class:"fa-solid fa-cog mr-2"},null,-1),v(" Configure Vehicle — Build/customize a new vehicle ",-1)])]),_:1}),l(t(U),{variant:"outline",class:"w-full justify-start",onClick:n[3]||(n[3]=S=>p.value="manual")},{default:i(()=>[...n[40]||(n[40]=[e("i",{class:"fa-solid fa-pen-to-square mr-2"},null,-1),v(" Skip & Enter Manually — Create vehicle data from scratch ",-1)])]),_:1})])])])):L("",!0),s.selectedVehicle||p.value==="manual"&&u.value.brand?(h(),k("div",Qa,[n[43]||(n[43]=e("p",{class:"text-xs text-sub mb-2"},"Creating offer for:",-1)),e("div",Ya,[e("div",Ga,[(me=s.selectedVehicle)!=null&&me.image||u.value.image?(h(),k("img",{key:0,src:((Me=s.selectedVehicle)==null?void 0:Me.image)||u.value.image,alt:"Vehicle",class:"w-full h-full object-cover"},null,8,Ka)):(h(),k("i",Za))]),e("div",null,[e("h4",Ja,T(((De=s.selectedVehicle)==null?void 0:De.brand)||u.value.brand)+" "+T(((Pe=s.selectedVehicle)==null?void 0:Pe.model)||u.value.model)+" ("+T(((Le=s.selectedVehicle)==null?void 0:Le.year)||u.value.year)+") ",1),e("p",Xa,"Base Price: € "+T(ke(((Oe=s.selectedVehicle)==null?void 0:Oe.price)||u.value.price)),1)])])])):L("",!0),s.selectedVehicle||p.value==="manual"||s.item?(h(),k("div",eo,[e("div",to,[e("button",{type:"button",onClick:n[4]||(n[4]=S=>c.value=!c.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors rounded-t-lg"},[n[44]||(n[44]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Personal Information"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",c.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),c.value?(h(),k("div",lo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[45]||(n[45]=[v("Salutation ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:u.value.salutation,"onUpdate:modelValue":n[5]||(n[5]=S=>u.value.salutation=S)},{default:i(()=>[l(t(Q),{class:"w-full"},{default:i(()=>[l(t(Y),{placeholder:"Select salutation"})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"Mr."},{default:i(()=>[...n[46]||(n[46]=[v("Mr.",-1)])]),_:1}),l(t(B),{value:"Mrs."},{default:i(()=>[...n[47]||(n[47]=[v("Mrs.",-1)])]),_:1}),l(t(B),{value:"Ms."},{default:i(()=>[...n[48]||(n[48]=[v("Ms.",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",so,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[49]||(n[49]=[v("First Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(P),{modelValue:u.value.firstName,"onUpdate:modelValue":n[6]||(n[6]=S=>u.value.firstName=S),placeholder:"Enter first name",disabled:F.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[50]||(n[50]=[v("Last Name ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(P),{modelValue:u.value.lastName,"onUpdate:modelValue":n[7]||(n[7]=S=>u.value.lastName=S),placeholder:"Enter last name",disabled:F.value},null,8,["modelValue","disabled"])])]),e("div",ao,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[51]||(n[51]=[v("Email ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(P),{type:"email",modelValue:u.value.email,"onUpdate:modelValue":n[8]||(n[8]=S=>u.value.email=S),placeholder:"email@example.com",disabled:F.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[52]||(n[52]=[v("Phone Number",-1)])]),_:1}),l(t(P),{type:"tel",modelValue:u.value.phone,"onUpdate:modelValue":n[9]||(n[9]=S=>u.value.phone=S),placeholder:"+1 (555) 000-0000",disabled:F.value},null,8,["modelValue","disabled"])])]),e("div",oo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[53]||(n[53]=[v("ZIP / Postal Code ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(P),{modelValue:u.value.zipCode,"onUpdate:modelValue":n[10]||(n[10]=S=>u.value.zipCode=S),placeholder:"Enter ZIP code",disabled:F.value},null,8,["modelValue","disabled"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[54]||(n[54]=[v("City",-1)])]),_:1}),l(t(P),{modelValue:u.value.city,"onUpdate:modelValue":n[11]||(n[11]=S=>u.value.city=S),placeholder:"Enter city",disabled:F.value},null,8,["modelValue","disabled"])])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[55]||(n[55]=[v("Address / Street",-1)])]),_:1}),l(t(P),{modelValue:u.value.address,"onUpdate:modelValue":n[12]||(n[12]=S=>u.value.address=S),placeholder:"Enter street address",disabled:F.value},null,8,["modelValue","disabled"])])])):L("",!0)]),p.value==="manual"&&!s.selectedVehicle?(h(),k("div",no,[e("button",{type:"button",onClick:n[13]||(n[13]=S=>V.value=!V.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[56]||(n[56]=e("h6",{class:"text-sm font-semibold text-heading"},"Vehicle Details",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",V.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),V.value?(h(),k("div",io,[e("div",ro,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[57]||(n[57]=[v("Brand",-1)])]),_:1}),l(t(P),{modelValue:u.value.brand,"onUpdate:modelValue":n[14]||(n[14]=S=>u.value.brand=S),placeholder:"e.g., Audi"},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[58]||(n[58]=[v("Model",-1)])]),_:1}),l(t(P),{modelValue:u.value.model,"onUpdate:modelValue":n[15]||(n[15]=S=>u.value.model=S),placeholder:"e.g., e-tron GT"},null,8,["modelValue"])])]),e("div",uo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[59]||(n[59]=[v("Year",-1)])]),_:1}),l(t(P),{type:"number",modelValue:u.value.year,"onUpdate:modelValue":n[16]||(n[16]=S=>u.value.year=S),placeholder:"2024"},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[60]||(n[60]=[v("Image URL",-1)])]),_:1}),l(t(P),{modelValue:u.value.image,"onUpdate:modelValue":n[17]||(n[17]=S=>u.value.image=S),placeholder:"https://..."},null,8,["modelValue"])])])])):L("",!0)])):L("",!0),e("div",co,[e("button",{type:"button",onClick:n[18]||(n[18]=S=>E.value=!E.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[61]||(n[61]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Pricing & Financing"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",E.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),E.value?(h(),k("div",mo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[62]||(n[62]=[v("Base Price (€) ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(P),{type:"number",modelValue:u.value.price,"onUpdate:modelValue":n[19]||(n[19]=S=>u.value.price=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[63]||(n[63]=[v("Financing Type ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(t(K),{modelValue:u.value.financingType,"onUpdate:modelValue":n[20]||(n[20]=S=>u.value.financingType=S)},{default:i(()=>[l(t(Q),{class:"w-full"},{default:i(()=>[l(t(Y),{placeholder:"Select financing type"})]),_:1}),l(t(G),null,{default:i(()=>[l(t(B),{value:"cash"},{default:i(()=>[...n[64]||(n[64]=[v("Cash",-1)])]),_:1}),l(t(B),{value:"financing"},{default:i(()=>[...n[65]||(n[65]=[v("Financing",-1)])]),_:1}),l(t(B),{value:"leasing"},{default:i(()=>[...n[66]||(n[66]=[v("Leasing",-1)])]),_:1}),l(t(B),{value:"rental"},{default:i(()=>[...n[67]||(n[67]=[v("Rental",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",fo,[e("div",po,[l(t(oe),{checked:u.value.showVat,"onUpdate:checked":n[21]||(n[21]=S=>u.value.showVat=S),id:"show-vat"},null,8,["checked"]),l(t(I),{for:"show-vat",class:"text-xs font-medium text-body cursor-pointer"},{default:i(()=>[...n[68]||(n[68]=[v("Show VAT breakdown",-1)])]),_:1})]),u.value.showVat?(h(),k("div",vo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[69]||(n[69]=[v("VAT %",-1)])]),_:1}),l(t(P),{type:"number",step:"0.1",modelValue:u.value.vatRate,"onUpdate:modelValue":n[22]||(n[22]=S=>u.value.vatRate=S),placeholder:"21"},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[70]||(n[70]=[v("VAT €",-1)])]),_:1}),l(t(P),{type:"number",value:q.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[71]||(n[71]=[v("Subtotal €",-1)])]),_:1}),l(t(P),{type:"number",value:W.value,readonly:"",class:"bg-surfaceTertiary"},null,8,["value"])])])):L("",!0)])])):L("",!0)]),e("div",yo,[e("button",{type:"button",onClick:n[23]||(n[23]=S=>m.value=!m.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",bo,[n[72]||(n[72]=e("h6",{class:"text-sm font-semibold text-heading"},"Quotation Items",-1)),e("span",go,"("+T(u.value.quotationItems.length)+" items)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",m.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),m.value?(h(),k("div",ho,[e("div",xo,[l(t(U),{variant:"outline",size:"small",onClick:w},{default:i(()=>[...n[73]||(n[73]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Item ",-1)])]),_:1})]),(h(!0),k(H,null,Z(u.value.quotationItems,(S,ie)=>(h(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",wo,[e("div",ko,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[74]||(n[74]=[v("Item Name",-1)])]),_:1}),l(t(P),{modelValue:S.name,"onUpdate:modelValue":_=>S.name=_,placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Co,[l(t(U),{variant:"ghost",size:"icon",onClick:_=>g(ie),class:"text-red-600 hover:text-red-700 h-10 w-10"},{default:i(()=>[...n[75]||(n[75]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]),e("div",Vo,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[76]||(n[76]=[v("Price (€)",-1)])]),_:1}),l(t(P),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[77]||(n[77]=[v("Quantity",-1)])]),_:1}),l(t(P),{type:"number",modelValue:S.quantity,"onUpdate:modelValue":_=>S.quantity=_,placeholder:"1",value:S.quantity||1},null,8,["modelValue","onUpdate:modelValue","value"])])]),e("div",So,[e("span",$o,"Total: € "+T(ke((S.price||0)*(S.quantity||1))),1)])]))),128)),u.value.quotationItems.length===0?(h(),k("div",Io," No quotation items added yet ")):L("",!0)])):L("",!0)]),e("div",To,[e("button",{type:"button",onClick:n[24]||(n[24]=S=>C.value=!C.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",Ao,[n[78]||(n[78]=e("h6",{class:"text-sm font-semibold text-heading"},"Discounts",-1)),e("span",Eo,"("+T(u.value.discounts.length)+" discounts)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",C.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),C.value?(h(),k("div",Mo,[e("div",Do,[l(t(U),{variant:"outline",size:"small",onClick:A},{default:i(()=>[...n[79]||(n[79]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Discount ",-1)])]),_:1})]),(h(!0),k(H,null,Z(u.value.discounts,(S,ie)=>(h(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",Po,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[80]||(n[80]=[v("Discount Title",-1)])]),_:1}),l(t(P),{modelValue:S.title,"onUpdate:modelValue":_=>S.title=_,placeholder:"Discount title"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[81]||(n[81]=[v("Amount (€)",-1)])]),_:1}),l(t(P),{type:"number",modelValue:S.price,"onUpdate:modelValue":_=>S.price=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Lo,[l(t(I),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[l(t(oe),{checked:S.vatInclusive,"onUpdate:checked":_=>S.vatInclusive=_},null,8,["checked","onUpdate:checked"]),n[82]||(n[82]=e("span",{class:"text-xs text-body"},"VAT inclusive",-1))]),_:2},1024),l(t(U),{variant:"ghost",size:"icon",onClick:_=>ce(ie),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...n[83]||(n[83]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),u.value.discounts.length===0?(h(),k("div",Oo," No discounts added yet ")):L("",!0)])):L("",!0)]),e("div",Uo,[e("button",{type:"button",onClick:n[25]||(n[25]=S=>d.value=!d.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[84]||(n[84]=e("h6",{class:"text-sm font-semibold text-heading"},"Trade-In",-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",d.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),d.value?(h(),k("div",Fo,[e("div",Ro,[l(t(oe),{checked:u.value.tradeIn.showOnPdf,"onUpdate:checked":n[26]||(n[26]=S=>u.value.tradeIn.showOnPdf=S),id:"show-tradein-pdf"},null,8,["checked"]),l(t(I),{for:"show-tradein-pdf",class:"text-xs font-medium text-body cursor-pointer"},{default:i(()=>[...n[85]||(n[85]=[v("Show on PDF",-1)])]),_:1})]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[86]||(n[86]=[v("Trade-in Valuation (€)",-1)])]),_:1}),l(t(P),{type:"number",modelValue:u.value.tradeIn.valuation,"onUpdate:modelValue":n[27]||(n[27]=S=>u.value.tradeIn.valuation=S),placeholder:"0"},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[87]||(n[87]=[v("Trade-in Notes",-1)])]),_:1}),l(t(ue),{modelValue:u.value.tradeIn.notes,"onUpdate:modelValue":n[28]||(n[28]=S=>u.value.tradeIn.notes=S),rows:"3",placeholder:"Add notes about the trade-in vehicle..."},null,8,["modelValue"])])])):L("",!0)]),e("div",Bo,[e("button",{type:"button",onClick:n[29]||(n[29]=S=>b.value=!b.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[e("div",No,[n[88]||(n[88]=e("h6",{class:"text-sm font-semibold text-heading"},"Payment Methods",-1)),e("span",qo,"("+T(u.value.paymentMethods.length)+" methods)",1)]),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",b.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),b.value?(h(),k("div",jo,[e("div",zo,[l(t(U),{variant:"outline",size:"small",onClick:Se},{default:i(()=>[...n[89]||(n[89]=[e("i",{class:"fa-solid fa-plus mr-1 text-xs"},null,-1),v(" Add Payment Method ",-1)])]),_:1})]),(h(!0),k(H,null,Z(u.value.paymentMethods,(S,ie)=>(h(),k("div",{key:ie,class:"border border-E5E7EB rounded-lg p-3 space-y-3"},[e("div",_o,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[90]||(n[90]=[v("Description",-1)])]),_:1}),l(t(P),{modelValue:S.description,"onUpdate:modelValue":_=>S.description=_,placeholder:"Description (max 80 chars)",maxlength:80},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[91]||(n[91]=[v("Amount (€)",-1)])]),_:1}),l(t(P),{type:"number",modelValue:S.amount,"onUpdate:modelValue":_=>S.amount=_,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Wo,[l(t(I),{class:"flex items-center gap-2 cursor-pointer"},{default:i(()=>[l(t(oe),{checked:S.paid,"onUpdate:checked":_=>S.paid=_},null,8,["checked","onUpdate:checked"]),n[92]||(n[92]=e("span",{class:"text-xs text-body"},"PAID",-1))]),_:2},1024),l(t(U),{variant:"ghost",size:"icon",onClick:_=>qe(ie),class:"text-red-600 hover:text-red-700"},{default:i(()=>[...n[93]||(n[93]=[e("i",{class:"fa-solid fa-trash text-xs"},null,-1)])]),_:1},8,["onClick"])])]))),128)),u.value.paymentMethods.length===0?(h(),k("div",Ho," No payment methods added yet ")):L("",!0),u.value.paymentMethods.length>0?(h(),k("div",Qo,[e("div",Yo,[n[94]||(n[94]=e("span",{class:"text-xs font-medium text-body"},"Payment Methods Total:",-1)),e("span",Go,"€ "+T(ke(y.value)),1)]),e("div",Ko,[n[95]||(n[95]=e("span",{class:"text-xs font-medium text-body"},"Grand Total:",-1)),e("span",Zo,"€ "+T(ke($.value)),1)]),D.value?L("",!0):(h(),k("div",Jo," ⚠️ Payment methods must equal Grand Total "))])):L("",!0)])):L("",!0)]),e("div",Xo,[e("button",{type:"button",onClick:n[30]||(n[30]=S=>M.value=!M.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surfaceSecondary transition-colors"},[n[96]||(n[96]=e("div",{class:"flex items-center gap-2"},[e("h6",{class:"text-sm font-semibold text-heading"},"Terms & Conditions"),e("span",{class:"text-xs text-red-600"},"*Required")],-1)),e("i",{class:j(["fa-solid transition-transform duration-200 text-sub text-xs",M.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),M.value?(h(),k("div",en,[e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[97]||(n[97]=[v("Notes / Comments",-1)])]),_:1}),l(t(ue),{modelValue:u.value.notes,"onUpdate:modelValue":n[31]||(n[31]=S=>u.value.notes=S),rows:"3",placeholder:"Any special terms, conditions, or notes about this offer..."},null,8,["modelValue"])]),e("div",null,[l(t(I),{class:"text-xs font-medium text-body mb-1"},{default:i(()=>[...n[98]||(n[98]=[v("Offer Expiration Date",-1)])]),_:1}),l(t(P),{type:"date",modelValue:u.value.expirationDate,"onUpdate:modelValue":n[32]||(n[32]=S=>u.value.expirationDate=S)},null,8,["modelValue"])]),e("div",tn,[n[101]||(n[101]=e("h6",{class:"text-xs font-semibold text-heading"},"Privacy & Consent",-1)),e("div",ln,[l(t(oe),{checked:u.value.privacyConsent,"onUpdate:checked":n[33]||(n[33]=S=>u.value.privacyConsent=S),id:"privacy-consent"},null,8,["checked"]),l(t(I),{for:"privacy-consent",class:"text-xs text-body cursor-pointer"},{default:i(()=>[...n[99]||(n[99]=[v(" I agree to the privacy policy ",-1),e("span",{class:"text-red-500"},"*",-1)])]),_:1})]),e("div",sn,[l(t(oe),{checked:u.value.marketingConsent,"onUpdate:checked":n[34]||(n[34]=S=>u.value.marketingConsent=S),id:"marketing-consent"},null,8,["checked"]),l(t(I),{for:"marketing-consent",class:"text-xs text-body cursor-pointer"},{default:i(()=>[...n[100]||(n[100]=[v(" I want to receive marketing communications ",-1)])]),_:1})])])])):L("",!0)])])):L("",!0),s.hideActions?L("",!0):(h(),k("div",an,[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:n[35]||(n[35]=S=>R.$emit("cancel"))}),l(t(U),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!$e.value,onClick:Ee},null,8,["label","disabled"])])),l(Na,{show:x.value,"requested-vehicle":s.selectedVehicle,"opportunity-id":s.taskId,onClose:n[36]||(n[36]=S=>x.value=!1),onVehicleSelected:je},null,8,["show","requested-vehicle","opportunity-id"])])}}},nn={class:"flex-1 overflow-y-auto p-6 w-full"},En={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]},customer:{type:Object,default:null}},emits:["close","save"],setup(s,{emit:r}){const o=r,a=O(null),f=N(()=>{var V;return((V=a.value)==null?void 0:V.isValid)||!1}),p=()=>{var V;(V=a.value)==null||V.submit()},x=V=>{V||o("close")},c=V=>{o("save",V),o("close")};return(V,E)=>(h(),z(t(se),{open:s.show,"onUpdate:open":x},{default:i(()=>[l(t(J),null,{default:i(()=>[l(t(X),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(ee),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col p-0"},{default:i(()=>[l(t(te),{class:"flex-shrink-0 p-6 pb-4 border-b border"},{default:i(()=>[l(t(le),null,{default:i(()=>[...E[2]||(E[2]=[v("Create Offer",-1)])]),_:1})]),_:1}),e("div",nn,[l(on,{item:s.item,"task-type":s.taskType,"task-id":s.taskId,"selected-vehicle":s.requestedCar,customer:s.customer,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:a,onSave:c,onCancel:E[0]||(E[0]=m=>V.$emit("close"))},null,8,["item","task-type","task-id","selected-vehicle","customer"])]),l(t(be),{class:"flex-shrink-0 p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:i(()=>[l(t(U),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:E[1]||(E[1]=m=>V.$emit("close"))}),l(t(U),{label:s.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!f.value,onClick:p},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}};function Mn(s){const r=s.lead;if(!r)return null;const o=ye(r,"lead");if(!o)return console.warn("No display stage calculated for lead"),null;const a=he[o];if(!a)return console.warn(`No state config found for lead stage: ${o}`),null;if(!a.primaryAction)return console.warn(`No primary action found for lead stage: ${o}`),null;const f=a.primaryAction;if(typeof f=="function"){const p=f({lead:r,displayStage:o});return p||console.warn(`Primary action function returned null for lead stage: ${o}`),p}return f}function Dn(s){const r=s.lead;if(!r)return[];const o=ye(r,"lead"),a=he[o];return a?a.secondaryActions||[]:[]}function Ne(s){const r=s.lead;if(!r||!(r.isDisqualified===!0))return!1;const a=ye(r,"lead");return a===ae.CLOSED_INVALID||a===ae.CLOSED_NOT_INTERESTED||a===ae.CLOSED_DUPLICATE}function Pn(s){const r=s.lead;if(!r||Ne(s))return!1;const o=ye(r,"lead"),a=he[o];return a?typeof a.showLQWidget=="function"?a.showLQWidget(r):a.showLQWidget??!1:!1}function Ln(s){const r=s.lead;if(!r||Ne(s))return!1;const o=ye(r,"lead"),a=he[o];return a?a.showDeadlineBanner&&r.nextActionDue:!1}function On(s){const r=s.lead;if(!r)return!1;const o=ye(r,"lead"),a=he[o];return a?a.canPostpone??!1:!1}function Un(s){const r=s.lead;if(!r)return"qualification";const o=ye(r,"lead"),a=he[o];return a&&a.lqWidgetMode||"qualification"}function Fn(){const s=it();return{saveTradeInVehicle:async(a,f,p,x={})=>{try{const c=await s.addVehicle(p),V={type:"tradein",action:"added a trade-in",vehicleId:c.id,data:{brand:p.brand,model:p.model,version:p.version||null,year:p.year,kilometers:p.kilometers||0,plates:p.plates||null,registration:p.registration||null,vin:p.vin||null,fuelType:p.fuelType||null,gearType:p.gearType||null,tradeInPrice:x.tradeInPrice||null,evaluationRangeLow:x.evaluationRangeLow||null,evaluationRangeHigh:x.evaluationRangeHigh||null,provider:x.provider||null,evaluationDate:x.evaluationDate||null,priceToBuy:x.priceToBuy||null,priceToSell:x.priceToSell||null,priceOfVehicle:x.priceOfVehicle||null,priceOfOptionals:x.priceOfOptionals||null,listOfOptionals:x.listOfOptionals||null}};let E;if(a==="lead")E=await et(f,V);else if(a==="opportunity")E=await tt(f,V);else throw new Error(`Invalid taskType: ${a}`);return{vehicle:c,activity:E}}catch(c){throw console.error("Error saving trade-in vehicle:",c),c}},updateTradeInVehicle:async(a,f,p,x,c,V={})=>{try{const E=await s.modifyVehicle(p,c),m={data:{brand:c.brand,model:c.model,version:c.version||null,year:c.year,kilometers:c.kilometers||0,plates:c.plates||null,registration:c.registration||null,vin:c.vin||null,fuelType:c.fuelType||null,gearType:c.gearType||null,tradeInPrice:V.tradeInPrice||null,evaluationRangeLow:V.evaluationRangeLow||null,evaluationRangeHigh:V.evaluationRangeHigh||null,provider:V.provider||null,evaluationDate:V.evaluationDate||null,priceToBuy:V.priceToBuy||null,priceToSell:V.priceToSell||null,priceOfVehicle:V.priceOfVehicle||null,priceOfOptionals:V.priceOfOptionals||null,listOfOptionals:V.listOfOptionals||null}};let C;if(a==="lead")C=await Je(f,x,m);else if(a==="opportunity")C=await Xe(f,x,m);else throw new Error(`Invalid taskType: ${a}`);return{vehicle:E,activity:C}}catch(E){throw console.error("Error updating trade-in vehicle:",E),E}}}}function de(s){if(!s)return 0;const r=new Date(s),a=Math.abs(new Date-r);return Math.ceil(a/(1e3*60*60*24))}const pe={"no-appointment":s=>!s.scheduledAppointment,"has-appointment":s=>!!s.scheduledAppointment,"appointment-past-not-completed":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)<new Date&&s.scheduledAppointment.status!=="completed":!1,"has-future-appointment":s=>s.scheduledAppointment?new Date(s.scheduledAppointment.start)>new Date:!1,"no-offers":s=>!s.hasOffers,"has-offers":s=>s.hasOffers,"qualified-no-offers-7-13-days":s=>{const r=re(),o=r.getSetting("oofbMinDays"),a=r.getSetting("oofbMaxDays"),f=de(s.opportunity.createdAt);return f>=o&&f<a+1&&!s.hasOffers},"qualified-no-offers-14-plus-days":s=>{const o=re().getSetting("ufbDays");return de(s.opportunity.createdAt)>=o&&!s.hasOffers},"negotiation-offer-sent-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Sent"},"negotiation-offer-feedback-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Feedback"},"negotiation-offer-accepted-substatus":s=>{var r;return((r=s.opportunity)==null?void 0:r.negotiationSubstatus)==="Offer Accepted"},"negotiation-offer-sent-3-days":s=>{var a,f;if(((a=s.opportunity)==null?void 0:a.negotiationSubstatus)!=="Offer Sent"||!((f=s.opportunity)!=null&&f.offers)||s.opportunity.offers.length===0)return!1;const r=s.opportunity.offers.filter(p=>p.status==="active").sort((p,x)=>new Date(x.createdAt)-new Date(p.createdAt))[0];return r?de(r.createdAt)>=3:!1},"negotiation-5-plus-days-no-contract-has-offers":s=>{if(s.stage==="In Negotiation"&&!s.hasOffers)return!1;const o=re().getSetting("ofbDays");return de(s.opportunity.lastActivity||s.opportunity.createdAt)>=o&&!s.opportunity.contractDate&&s.hasOffers},"negotiation-offer-feedback-5-plus-days-no-appointment":s=>{var p;if(((p=s.opportunity)==null?void 0:p.negotiationSubstatus)!=="Offer Feedback"||!s.hasOffers)return!1;const o=re().getSetting("nfuDays"),a=de(s.opportunity.lastActivity||s.opportunity.createdAt),f=s.scheduledAppointment&&new Date(s.scheduledAppointment.start)>new Date;return a>=o&&!s.opportunity.contractDate&&!f},"negotiation-5-plus-days-no-contract-no-future-appointment-has-offers":s=>pe["negotiation-offer-feedback-5-plus-days-no-appointment"](s),"contract-7-plus-days-no-delivery":s=>{var p;if(!s.opportunity.contractDate)return!1;const o=re().getSetting("cfbDays"),a=de(s.opportunity.contractDate),f=(p=s.activities)==null?void 0:p.some(x=>{var c;return x.type==="delivery"||((c=x.action)==null?void 0:c.toLowerCase().includes("delivered"))});return a>=o&&!f},"delivery-date-set":s=>!!s.opportunity.deliveryDate,"delivery-3-plus-days":s=>{var p;const r=(p=s.activities)==null?void 0:p.find(x=>{var c;return x.type==="delivery"||((c=x.action)==null?void 0:c.toLowerCase().includes("delivered"))});if(!r)return!1;const a=re().getSetting("dfbDays");return de(r.timestamp)>=a},"is-awaiting-delivery":s=>s.deliverySubstatus==="Awaiting Delivery","is-delivered":s=>s.deliverySubstatus==="Delivered","has-no-delivery":s=>!s.deliverySubstatus||s.deliverySubstatus===null,"is-closed":s=>{const r=s.stage;return r==="Closed Won"||r==="Closed Lost"},"is-closed-with-task-widget":s=>pe["is-closed"](s)&&s.hasActiveTaskWidget,"opportunity-abandoned":s=>{if(pe["is-closed"](s))return!1;const r=re(),o=r.getSetting("abandonedOpportunityDays");if(!r.getSetting("abandonedEligibleStages").includes(s.stage))return!1;const f=s.opportunity.lastActivity||s.opportunity.createdAt;return de(f)>=o}};function Rn(s,r){if(pe["is-closed-with-task-widget"](r))return[Ie.reopen,Ie.requalify,Ie.closeLost];const o=Te[s];return!o||!o.secondaryActions?[]:o.secondaryActions.filter(a=>{if(!a.conditional)return!0;const f=pe[a.conditional];return f?f(r):!0})}function Bn(s,r){const o=Te[s];if(!o||!o.taskWidgets)return null;const f=re().getSetting("autoCloseWidgetsOnClose"),p=pe["is-closed"]({stage:s});for(const x of o.taskWidgets){if(f&&p&&(x.type==="NFU"||x.type==="OFB"))continue;const c=pe[x.condition];if(c&&c(r))return x.type}return null}function Nn(s,r){const o=Te[s];if(!o||!o.primaryAction)return null;let a=o.primaryAction;return typeof a=="function"&&(a=a(r),!a)?null:{...a,title:typeof a.title=="function"?a.title(r):a.title,description:typeof a.description=="function"?a.description(r):a.description,label:typeof a.label=="function"?a.label(r):a.label}}function qn(s){return{OOFB:"Overdue Offer Follow-up Task",UFB:"Urgent Follow-up Task",NFU:"No Future Updates Task",OFB:"Offer Follow-up Task",CFB:"Contract Follow-up Task",DFB:"Delivery Follow-up Task",NS:"NS",ABANDONED:"Abandoned Opportunity Task"}[s]||"Task"}function jn(s){return s==="Closed Won"||s==="Closed Lost"}export{Rn as A,jn as B,qn as C,on as D,rt as E,Na as F,Kl as G,_l as H,Rl as I,he as L,Te as O,Tn as P,wn as T,xn as _,Ue as a,pn as b,yn as c,gn as d,hn as e,fn as f,bn as g,kn as h,Cn as i,Vn as j,Sn as k,$n as l,In as m,An as n,En as o,Ne as p,Mn as q,Dn as r,Pn as s,Ln as t,On as u,Un as v,vn as w,Fn as x,Bn as y,Nn as z};
