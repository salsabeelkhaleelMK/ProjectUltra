const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DOihZbFy.js","assets/index-qEzl5vL1.css"])))=>i.map(i=>d[i]);
import{v as T,r as v,d as w,a4 as V,a5 as O,a6 as m,a7 as W,a8 as $,a9 as f,aa as D,ab as Q,ac as j,ad as q,ae as z,af as G}from"./index-DOihZbFy.js";const J=T("opportunities",()=>{const i=v([]),s=v(null),o=v([]),u=v(!1),n=v(null),y=v({stage:null,assignee:null,search:""}),A=w(()=>i.value.length),x=w(()=>{const t={};return i.value.forEach(a=>{t[a.stage]||(t[a.stage]=[]),t[a.stage].push(a)}),t}),b=w(()=>i.value.reduce((t,a)=>t+a.value,0));async function h(){u.value=!0,n.value=null;try{const t=await V(y.value);i.value=t.data}catch(t){n.value=t.message}finally{u.value=!1}}async function L(t){u.value=!0,n.value=null;try{s.value=await O(t);const a=await m(t);o.value=W(a);const e=i.value.findIndex(r=>r.id===parseInt(t));e!==-1&&(i.value[e]=s.value)}catch(a){n.value=a.message}finally{u.value=!1}}async function I(t){u.value=!0,n.value=null;try{const a=await $(t);return i.value.unshift(a),a}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function S(t,a){u.value=!0,n.value=null;try{const e=await f(t,a),r=i.value.findIndex(l=>l.id===t);return r!==-1&&(i.value[r]=e),e}catch(e){throw n.value=e.message,e}finally{u.value=!1}}async function g(t){u.value=!0,n.value=null;try{await D(t),i.value=i.value.filter(a=>a.id!==t)}catch(a){throw n.value=a.message,a}finally{u.value=!1}}async function d(t,a){try{const e=await Q(t,a);return o.value.unshift(e),e}catch(e){throw n.value=e.message,e}}async function _(t,a,e){try{const r=await j(t,a,e),l=o.value.findIndex(c=>c.id===parseInt(a));return l!==-1&&(o.value[l]=r),r}catch(r){throw n.value=r.message,r}}async function k(t,a){try{return await q(t,a),o.value=o.value.filter(e=>e.id!==parseInt(a)),{success:!0}}catch(e){throw n.value=e.message,e}}function F(t){y.value={...y.value,...t},h()}async function R(t){var a;u.value=!0,n.value=null;try{const e=i.value.find(p=>p.id===t)||s.value,r={stage:"Qualified"};((e==null?void 0:e.probability)===0||(e==null?void 0:e.probability)===100)&&(r.probability=50);const l=await f(t,r),c=i.value.findIndex(p=>p.id===t);return c!==-1&&(i.value[c]=l),((a=s.value)==null?void 0:a.id)===t&&(s.value=l),await d(t,{type:"note",user:"You",action:"reopened opportunity",content:`Opportunity has been reopened and moved back to ${l.stage} stage`}),l}catch(e){throw n.value=e.message,e}finally{u.value=!1}}async function B(t){var a;u.value=!0,n.value=null;try{const e=await f(t,{stage:"Registration"}),r=i.value.findIndex(l=>l.id===t);return r!==-1&&(i.value[r]=e),((a=s.value)==null?void 0:a.id)===t&&(s.value=e),await d(t,{type:"note",user:"You",action:"marked as registration",content:"Opportunity moved to Registration stage - administrative phase before delivery"}),e}catch(e){throw n.value=e.message,e}finally{u.value=!1}}async function C(t){var a;u.value=!0,n.value=null;try{const e=await f(t,{stage:"Closed",probability:100}),r=i.value.findIndex(l=>l.id===t);return r!==-1&&(i.value[r]=e),((a=s.value)==null?void 0:a.id)===t&&(s.value=e),await d(t,{type:"note",user:"You",action:"marked as closed won",content:"Opportunity marked as Closed Won - contract signed and deal completed"}),e}catch(e){throw n.value=e.message,e}finally{u.value=!1}}async function E(t,a){u.value=!0,n.value=null;try{const e=await z(t,a);return i.value.unshift(e),e}catch(e){throw n.value=e.message,e}finally{u.value=!1}}async function Y(t){u.value=!0,n.value=null;try{const a=await O(t),e=await m(t),{useLeadsStore:r}=await G(async()=>{const{useLeadsStore:p}=await import("./index-DOihZbFy.js").then(P=>P.ag);return{useLeadsStore:p}},__vite__mapDeps([0,1])),c=await r().createLeadFromOpportunity(a,e);return await g(t),c.id}catch(a){throw n.value=a.message,a}finally{u.value=!1}}return{opportunities:i,currentOpportunity:s,currentOpportunityActivities:o,loading:u,error:n,filters:y,totalOpportunities:A,opportunitiesByStage:x,totalValue:b,loadOpportunities:h,loadOpportunityById:L,addOpportunity:I,modifyOpportunity:S,removeOpportunity:g,addActivity:d,updateActivity:_,deleteActivity:k,setFilters:F,reopenOpportunity:R,markAsRegistration:B,markAsClosedWon:C,createOpportunityFromLead:E,convertOpportunityToLead:Y}});export{J as useOpportunitiesStore};
