const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CustomersTab-Ce4ZOsgJ.js","assets/components-WJKgpbNX.js","assets/index-BSxt259F.js","assets/index-jg_8NBCO.css","assets/toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js","assets/UnifiedAddForm-fTV8M0qH.js","assets/contacts-CvrS-If3.js","assets/opportunities-C7VMVq_4.js","assets/useCustomersTable-CT-fT-ee.js","assets/useTableRowSelection-Bs49OKi4.js","assets/CustomersTab-f48GFISN.css","assets/OpenLeadsTab-Cl80wsQc.js","assets/opportunityRules-DVPgyxsv.js","assets/sparkles-ByigpcXa.js","assets/vehicles-sZbJG44U.js","assets/opportunityRules-CNarBnEk.css","assets/OpenLeadsTab-lMr7tiBw.css","assets/OpenOpportunitiesTab-BG6hCQpo.js","assets/OpenOpportunitiesTab-HF23GNLZ.css","assets/InNegotiationTab-DOyIOuFt.js","assets/InNegotiationTab-C9jp4TWA.css","assets/WonTab-DTN1kvdw.js","assets/WonTab-CamrNFGu.css","assets/LostTab-6UfjegwQ.js","assets/LostTab-BwFLuzYs.css"])))=>i.map(i=>d[i]);
import{r as C,l as X,c as k,x as I,o as d,B as i,s as l,y as t,e as r,k as m,t as Q,d as T,u as ee,C as te,m as le,h as ae,F as M,i as j,n as oe,g as F,W as se,U as ne,X as D,_ as O}from"./index-BSxt259F.js";import{_ as ue}from"./PageHeader-D-QUKZVE.js";import{f as ie,F as re,L as de,g as me,h as pe,Q as c,c as y,o as ce,C as ve,n as q,d as fe,a as ye,b as ge,Z as xe,z as he,X as be}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{u as ke,a as we,D as Ve,T as _e}from"./useTaskFilters-_o99iYhw.js";import{_ as Ce}from"./CustomerProfile-CmTMNlYN.js";import{u as Te}from"./opportunities-C7VMVq_4.js";import{u as Ne}from"./UnifiedAddForm-fTV8M0qH.js";import"./opportunityRules-DVPgyxsv.js";import"./sparkles-ByigpcXa.js";import"./vehicles-sZbJG44U.js";import"./CreateEventModal-DQDakbY_.js";import"./users-i2L6lO-2.js";import"./ReassignUserModal-8Wfd_b4T.js";import"./components-WJKgpbNX.js";import"./EditEventModal-_ABol0cZ.js";import"./contacts-CvrS-If3.js";const Ie={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},De={key:0,class:"space-y-6"},Oe={class:"space-y-2"},Le={class:"space-y-2"},$e={class:"space-y-2"},Ae={class:"space-y-2"},Ee={key:1,class:"space-y-6"},Se={class:"space-y-2"},Ue={class:"space-y-2"},Re={class:"space-y-2"},We={key:2,class:"space-y-6"},Be={class:"space-y-2"},ze={class:"space-y-2"},Pe={class:"space-y-2"},Me={key:3,class:"space-y-6"},je={class:"space-y-2"},Fe={class:"space-y-2"},qe={class:"space-y-2"},Xe={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(w,{emit:$}){const p=w,N=$,o=C({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});X(()=>p.show,g=>{g&&(o.value={customerName:p.initialData.customerName||"",email:p.initialData.email||"",phone:p.initialData.phone||"",company:p.initialData.company||"",vehicle:p.initialData.vehicle||"",value:p.initialData.value||"",reason:p.initialData.reason||""})});const A=g=>{g||N("close")},V=k(()=>({customers:"Add New Customer","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[p.activeTab]||"Add New Item"),W=k(()=>({customers:"Customer","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[p.activeTab]||"Item"),_=()=>{N("save",{...o.value}),o.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(g,e)=>(d(),I(t(fe),{open:w.show,"onUpdate:open":A},{default:i(()=>[l(t(ie),null,{default:i(()=>[l(t(re),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(de),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(me),{class:"flex-shrink-0"},{default:i(()=>[l(t(pe),null,{default:i(()=>[m(Q(V.value),1)]),_:1})]),_:1}),r("div",Ie,[w.activeTab==="customers"?(d(),T("div",De,[r("div",Oe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[14]||(e[14]=[m("Contact Name",-1)])]),_:1}),l(t(y),{modelValue:o.value.customerName,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.customerName=n),type:"text",placeholder:"Enter contact name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Le,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[15]||(e[15]=[m("Email",-1)])]),_:1}),l(t(y),{modelValue:o.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.email=n),type:"email",placeholder:"contact@example.com",class:"w-full h-10"},null,8,["modelValue"])]),r("div",$e,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[16]||(e[16]=[m("Phone",-1)])]),_:1}),l(t(y),{modelValue:o.value.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.phone=n),type:"tel",placeholder:"+49...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Ae,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[17]||(e[17]=[m("Company (optional)",-1)])]),_:1}),l(t(y),{modelValue:o.value.company,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.company=n),type:"text",placeholder:"Company name...",class:"w-full h-10"},null,8,["modelValue"])])])):w.activeTab==="open-leads"?(d(),T("div",Ee,[r("div",Se,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[18]||(e[18]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:o.value.customerName,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Ue,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[19]||(e[19]=[m("Email",-1)])]),_:1}),l(t(y),{modelValue:o.value.email,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.email=n),type:"email",placeholder:"customer@example.com",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Re,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[20]||(e[20]=[m("Requested Vehicle",-1)])]),_:1}),l(t(y),{modelValue:o.value.vehicle,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.vehicle=n),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"w-full h-10"},null,8,["modelValue"])])])):w.activeTab==="open-opportunities"||w.activeTab==="in-negotiation"?(d(),T("div",We,[r("div",Be,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[21]||(e[21]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:o.value.customerName,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",ze,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[22]||(e[22]=[m("Vehicle",-1)])]),_:1}),l(t(y),{modelValue:o.value.vehicle,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.vehicle=n),type:"text",placeholder:"e.g., Porsche Taycan",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Pe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[23]||(e[23]=[m("Opportunity Value",-1)])]),_:1}),l(t(y),{modelValue:o.value.value,"onUpdate:modelValue":e[9]||(e[9]=n=>o.value.value=n),type:"number",placeholder:"0",class:"w-full h-10"},null,8,["modelValue"])])])):(d(),T("div",Me,[r("div",je,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[24]||(e[24]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:o.value.customerName,"onUpdate:modelValue":e[10]||(e[10]=n=>o.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Fe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[25]||(e[25]=[m("Vehicle",-1)])]),_:1}),l(t(y),{modelValue:o.value.vehicle,"onUpdate:modelValue":e[11]||(e[11]=n=>o.value.vehicle=n),type:"text",placeholder:"Vehicle model",class:"w-full h-10"},null,8,["modelValue"])]),r("div",qe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[26]||(e[26]=[m("Reason",-1)])]),_:1}),l(t(ce),{modelValue:o.value.reason,"onUpdate:modelValue":e[12]||(e[12]=n=>o.value.reason=n),rows:"4",placeholder:`Reason for ${w.activeTab==="won"?"win":"loss"}...`,class:"w-full min-h-[100px] resize-none"},null,8,["modelValue","placeholder"])])]))]),l(t(ve),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(q),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:e[13]||(e[13]=n=>g.$emit("close"))}),l(t(q),{label:`Create ${W.value}`,variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:_},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Qe={class:"page-container relative"},Ze={class:"p-4 md:p-8"},He={class:"whitespace-nowrap"},Je={key:0,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},ct={__name:"Customers",setup(w){const $=ae(),p=ee(),N=te(),o=Te(),A=Ne(),V=k(()=>{const u=N.leads.filter(x=>!x.isDisqualified),s=o.opportunities.filter(x=>x.stage!=="Closed Won"&&x.stage!=="Closed Lost"),a=o.opportunities.filter(x=>x.stage==="In Negotiation"||x.stage==="In negotiation"),f=o.opportunities.filter(x=>x.stage==="Closed Won"),b=o.opportunities.filter(x=>x.stage==="Closed Lost");return{contacts:A.totalCustomers,openLeads:u.length,openOpportunities:s.length-a.length,inNegotiation:a.length,won:f.length,lost:b.length}}),_=C("customers"),g=C(!1),e=C({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),n=C(!1),h=C(null),v=C(null),{allTasks:E}=ke(C(!1)),L=k(()=>E.value),Z=k(()=>v.value),S=we(Z),B=k(()=>S.managementWidget.value),z=k(()=>S.storeAdapter.value),H=k(()=>S.addNewConfig.value);X(v,u=>{u&&(u.type==="lead"?N.fetchLeadById(u.id):o.fetchOpportunityById(u.id))},{immediate:!0});const J={customers:D(()=>O(()=>import("./CustomersTab-Ce4ZOsgJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),"open-leads":D(()=>O(()=>import("./OpenLeadsTab-Cl80wsQc.js"),__vite__mapDeps([11,1,2,3,4,12,7,13,14,15,8,9,16]))),"open-opportunities":D(()=>O(()=>import("./OpenOpportunitiesTab-BG6hCQpo.js"),__vite__mapDeps([17,1,2,3,4,7,12,13,14,15,8,9,18]))),"in-negotiation":D(()=>O(()=>import("./InNegotiationTab-DOyIOuFt.js"),__vite__mapDeps([19,1,2,3,4,7,12,13,14,15,8,9,20]))),won:D(()=>O(()=>import("./WonTab-DTN1kvdw.js"),__vite__mapDeps([21,1,2,3,4,7,12,13,14,15,8,9,22]))),lost:D(()=>O(()=>import("./LostTab-6UfjegwQ.js"),__vite__mapDeps([23,1,2,3,4,7,12,13,14,15,8,9,24])))},P=k(()=>{const u=[{key:"customers",label:"Customers",count:V.value.contacts},{key:"open-leads",label:"Open leads",count:V.value.openLeads},{key:"open-opportunities",label:"Open opportunities",count:V.value.openOpportunities},{key:"in-negotiation",label:"In negotiation",count:V.value.inNegotiation},{key:"won",label:"Won",count:V.value.won},{key:"lost",label:"Lost",count:V.value.lost}];return p.isOperator()?u.filter(s=>s.key==="customers"||s.key==="open-leads"):p.isSalesman()?u.filter(s=>s.key!=="open-leads"):u}),Y=()=>{e.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},g.value=!1},G=(u,s)=>{if(!s||!u)return"gray";const f={customers:"gray","open-leads":"blue","open-opportunities":"blue","in-negotiation":"blue",won:"green",lost:"red"}[u]||"gray";return["blue","green","red","gray"].includes(f)?f:"gray"},U=u=>{if(u.id.startsWith("customer-")){const s=u.customerId||parseInt(u.id.replace("customer-",""));h.value={type:"customer",id:s},v.value=null,n.value=!0}else if(u.id.startsWith("lead-")){const s=u.id.match(/-(\d+)$/),a=parseInt(s?s[1]:u.id.replace("lead-","")),f=E.value.find(b=>b.type==="lead"&&b.id===a);f&&(v.value=f,h.value={type:"task",id:a},n.value=!0,N.fetchLeadById(a))}else if(u.id.startsWith("opp-")){const s=u.id.match(/-(\d+)$/),a=parseInt(s?s[1]:u.id.replace("opp-","")),f=E.value.find(b=>b.type==="opportunity"&&b.id===a);f&&(v.value=f,h.value={type:"task",id:a},n.value=!0,o.fetchOpportunityById(a))}},R=()=>{n.value=!1,h.value=null,v.value=null},K=u=>{if(!v.value)return;const s=L.value.findIndex(a=>{const f=v.value.compositeId||`${v.value.type}-${v.value.id}`;return(a.compositeId||`${a.type}-${a.id}`)===f});if(s!==-1){if(u==="previous"&&s>0){const a=L.value[s-1];U({id:`${a.type}-${a.id}`})}else if(u==="next"&&s<L.value.length-1){const a=L.value[s+1];U({id:`${a.type}-${a.id}`})}}};return le(async()=>{await N.fetchLeads(),await o.fetchOpportunities()}),(u,s)=>(d(),T("div",Qe,[l(ue,{title:"Customers"},{actions:i(()=>[r("button",{onClick:s[0]||(s[0]=a=>t($).push("/add-new")),class:"group flex items-center gap-2 rounded-xl border border-border px-3 py-1.5 bg-surface text-sm font-medium text-muted-foreground hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...s[3]||(s[3]=[r("i",{class:"fa-solid fa-plus text-muted-foreground group-hover:text-brand-red"},null,-1),r("span",{class:"hidden sm:inline"},"Add new",-1)])])]),_:1}),r("div",Ze,[l(t(ye),{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=a=>_.value=a)},{default:i(()=>[l(t(ge),{class:"w-full justify-start border-b border-border bg-transparent mb-0 overflow-x-auto"},{default:i(()=>[(d(!0),T(M,null,j(P.value,a=>(d(),I(t(xe),{key:a.key,value:a.key,class:oe(["flex items-center gap-2 text-sm font-medium transition-all relative bg-transparent outline-none shrink-0",_.value===a.key?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:i(()=>[r("span",He,Q(a.label),1),l(t(he),{text:String(a.count),size:"small",theme:G(a.key,_.value===a.key)},null,8,["text","theme"]),_.value===a.key?(d(),T("span",Je)):F("",!0)]),_:2},1032,["value","class"]))),128))]),_:1}),(d(!0),T(M,null,j(P.value,a=>(d(),I(t(be),{key:`content-${a.key}`,value:a.key},{default:i(()=>[(d(),I(se,null,{fallback:i(()=>[...s[4]||(s[4]=[r("div",{class:"flex items-center justify-center py-12"},[r("div",{class:"text-center"},[r("i",{class:"fa-solid fa-spinner fa-spin text-gray-400 text-2xl mb-2"}),r("p",{class:"text-meta"},"Loading...")])],-1)])]),default:i(()=>[(d(),I(ne(J[a.key]),{onRowClick:U},null,32))]),_:2},1024))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),l(Ve,{show:n.value,onClose:R},{default:i(()=>[h.value&&h.value.type==="customer"?(d(),I(Ce,{key:0,"customer-id":h.value.id,"customer-type":"contact","show-close-button":!0,"close-on-convert":!0,onClose:R},null,8,["customer-id"])):h.value&&h.value.type==="task"&&v.value&&B.value&&z.value?(d(),I(_e,{key:1,task:v.value,"management-widget":B.value,"store-adapter":z.value,"add-new-config":H.value,"filtered-tasks":L.value,"is-drawer-view":!0,onTaskNavigate:K,onClose:R},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0)]),_:1},8,["show"]),l(Xe,{show:g.value,"active-tab":_.value,"initial-data":e.value,onClose:s[2]||(s[2]=a=>g.value=!1),onSave:Y},null,8,["show","active-tab","initial-data"])]))}};export{ct as default};
