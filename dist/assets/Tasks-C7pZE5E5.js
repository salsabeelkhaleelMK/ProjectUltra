import{d as c,o as a,F as _,i as ee,n as R,e,_ as Le,r as A,g as D,l as J,w as de,y as G,z as W,T as Ke,c as q,A as ae,t as C,B as Z,C as me,D as Ne,E as Q,m as E,u as Te,k as $e,G as ie,j as M,H as Ge,I as at,p as K,J as Ve,K as He,L as ze,h as Fe,x as Re,M as Je,N as Ie,O as it,P as ye,Q as rt,R as qe,S as dt,U as ut,V as ct}from"./index-DhXdPUMX.js";import{u as Me}from"./opportunities-vWziAi5K.js";import{u as Ue}from"./users-CzjLCIoh.js";import{_ as pt}from"./PageHeader-DgVtM0CV.js";import{y as mt}from"./components-BWnj0vXB.js";import{g as je,f as Ae,a as yt,b as Ce,c as De,d as gt}from"./formatters-hBiVcbat.js";import{_ as ft,g as vt,a as bt,b as xt,i as ht,c as wt,d as kt,e as Ct,f as Qe}from"./ComingSoonModal-BN4uxLRO.js";import{_ as $t}from"./CreateEventModal-BDHz8pKw.js";import{_ as Se}from"./ModalShell-CHgAd1m8.js";import{_ as St,a as At}from"./EditEventModal-BB-hb4zM.js";import{_ as Dt}from"./ReassignUserModal-D0SwpBMR.js";const Tt={class:"flex bg-gray-100 p-1 rounded-lg w-fit"},Ot=["onClick"],Xe={__name:"ViewToggle",props:{view:{type:String,required:!0},options:{type:Array,required:!0,validator:o=>o.every(T=>T.value&&T.icon&&T.label)}},emits:["update:view"],setup(o){return(T,t)=>(a(),c("div",Tt,[(a(!0),c(_,null,ee(o.options,r=>(a(),c("button",{key:r.value,onClick:w=>T.$emit("update:view",r.value),class:R(["p-1.5 rounded-md transition-all duration-200",o.view===r.value?"bg-white shadow-sm text-gray-900":"text-gray-400 hover:text-gray-600"])},[e("i",{class:R([r.icon,"text-base"])},null,2)],10,Ot))),128))]))}},It={class:"flex items-center gap-2"},qt={key:0,class:"flex gap-2"},Nt={key:0,class:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"},Vt={key:0,class:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Lt={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0}},emits:["filter-change","sort-change"],setup(o,{emit:T}){const t=T,r=A(!1),w=()=>{r.value=!r.value},u=m=>{r.value=!1,t("sort-change",m)},b={mounted(m,k){m.clickOutsideEvent=f=>{m===f.target||m.contains(f.target)||k.value(f)},document.addEventListener("click",m.clickOutsideEvent)},unmounted(m){document.removeEventListener("click",m.clickOutsideEvent)}};return(m,k)=>(a(),c("div",It,[o.showTypeFilter?(a(),c("div",qt,[e("button",{onClick:k[0]||(k[0]=f=>m.$emit("filter-change","all")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="all"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:k[1]||(k[1]=f=>m.$emit("filter-change","lead")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="lead"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:k[2]||(k[2]=f=>m.$emit("filter-change","opportunity")),class:R(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",o.typeFilter==="opportunity"?"bg-blue-600 text-white border-blue-600":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):D("",!0),e("div",{class:R(["relative",o.showTypeFilter?"ml-auto":""]),ref:"sortContainer"},[e("button",{onClick:de(w,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[k[7]||(k[7]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),o.sortOption&&o.sortOption!=="recent-first"?(a(),c("span",Nt)):D("",!0)]),J(Ke,{name:"dropdown"},{default:G(()=>[r.value?W((a(),c("div",Vt,[e("button",{onClick:k[3]||(k[3]=f=>u("recent-first")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="recent-first"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="recent-first"?"opacity-100":"opacity-0"])},null,2),k[8]||(k[8]=e("span",null,"Most Recent First",-1))],2),e("button",{onClick:k[4]||(k[4]=f=>u("urgent-first")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="urgent-first"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="urgent-first"?"opacity-100":"opacity-0"])},null,2),k[9]||(k[9]=e("span",null,"Urgent first",-1))],2),e("button",{onClick:k[5]||(k[5]=f=>u("assigned-to-me")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-me"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-me"?"opacity-100":"opacity-0"])},null,2),k[10]||(k[10]=e("span",null,"Assigned to me",-1))],2),e("button",{onClick:k[6]||(k[6]=f=>u("assigned-to-my-team")),class:R(["w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",{"bg-blue-50 text-blue-700":o.sortOption==="assigned-to-my-team"}])},[e("i",{class:R(["fa-solid fa-check text-[10px] w-3",o.sortOption==="assigned-to-my-team"?"opacity-100":"opacity-0"])},null,2),k[11]||(k[11]=e("span",null,"Assigned to my team",-1))],2)])),[[b,()=>r.value=!1]]):D("",!0)]),_:1})],2)]))}},Ft=Le(Lt,[["__scopeId","data-v-59aa697a"]]),Rt={class:"bg-white border-r border-gray-200 flex flex-col shrink-0 w-full lg:w-80 h-full"},Mt={class:"px-4 md:px-8 py-4 md:py-6 border-b border-gray-100 bg-gray-50/50 shrink-0"},Ut={class:"flex items-center justify-between gap-3"},jt={class:"flex items-center gap-3"},Bt={class:"page-header-title"},Wt={key:0,class:"hidden lg:flex"},Et={class:"px-5 py-3"},Pt={class:"relative"},Ht=["placeholder"],zt={key:0,class:"px-5 pb-3"},Qt=["onClick"],Yt={key:0,class:"absolute right-2 top-10 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-50 overflow-hidden"},Kt={class:"flex items-center justify-between border-b border-gray-100 p-2 bg-gray-50"},Gt={class:"flex gap-2"},Jt=["onClick"],Xt={class:"p-3 flex-1 flex flex-col justify-between"},Zt={class:"flex items-start gap-3 mb-3"},_t={class:"flex-1 min-w-0"},es={class:"text-sm font-bold text-gray-900 truncate"},ts={class:"text-[10px] text-gray-500"},ss={class:"space-y-1 mb-3"},os={class:"flex justify-between text-[10px]"},ls={class:"font-medium text-gray-700 truncate ml-2"},ns={class:"flex justify-between text-[10px]"},as={class:"font-medium text-gray-700"},is={class:"border-t border-gray-100 pt-2 flex justify-between text-[9px] text-gray-400"},rs={__name:"TasksList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},selectedId:{type:[Number,String],default:null},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-blue-300"},searchPlaceholder:{type:String,default:"Search..."},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getInitials:{type:Function,required:!0},getVehicleInfo:{type:Function,required:!0},avatarClass:{type:Function,default:()=>"bg-orange-100 text-orange-600"},typeFilter:{type:String,default:"all"},showTypeFilter:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(o,{emit:T}){const t={mounted(l,v){l.clickOutsideEvent=p=>{l===p.target||l.contains(p.target)||v.value()},document.addEventListener("click",l.clickOutsideEvent)},unmounted(l){document.removeEventListener("click",l.clickOutsideEvent)}},r=o,w=T,u=A(""),b=A("none"),m=q(()=>{let l=r.items;if(r.typeFilter&&r.typeFilter!=="all"&&(l=l.filter(v=>v.type===r.typeFilter)),u.value){const v=u.value.toLowerCase();l=l.filter(p=>{const L=r.getName(p).toLowerCase(),S=r.getVehicleInfo(p).toLowerCase();return L.includes(v)||S.includes(v)})}return l}),k=l=>{const v=l.compositeId||`${l.type||"task"}-${l.id}`||l.id;return r.selectedId===v},f=l=>{b.value=l,w("sort-change",l)},x=A(null),y=A(null);return ae(()=>r.selectedId,async l=>{l&&y.value&&(await Ne(),y.value.scrollIntoView({behavior:"smooth",block:"nearest"}))},{immediate:!0}),ae(m,async()=>{r.selectedId&&y.value&&(await Ne(),setTimeout(()=>{y.value&&y.value.scrollIntoView({behavior:"smooth",block:"nearest"})},100))},{immediate:!0}),(l,v)=>(a(),c("div",Rt,[e("div",Mt,[e("div",Ut,[e("div",jt,[o.showMobileClose?(a(),c("button",{key:0,onClick:v[0]||(v[0]=p=>l.$emit("close")),class:"lg:hidden w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[...v[4]||(v[4]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])):D("",!0),e("h2",Bt,C(o.title),1)]),o.viewMode?(a(),c("div",Wt,[J(Xe,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-grip",label:"Cards"},{value:"table",icon:"fa-solid fa-list",label:"Table"}],"onUpdate:view":v[1]||(v[1]=p=>l.$emit("view-change",p))},null,8,["view"])])):D("",!0)])]),e("div",Et,[e("div",Pt,[v[5]||(v[5]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),W(e("input",{"onUpdate:modelValue":v[2]||(v[2]=p=>u.value=p),type:"text",placeholder:o.searchPlaceholder,class:"w-full bg-gray-50 border border-gray-200 rounded-lg pl-9 pr-3 py-2 text-sm"},null,8,Ht),[[Z,u.value]])])]),o.showTypeFilter?(a(),c("div",zt,[J(Ft,{"type-filter":o.typeFilter,"sort-option":b.value,"show-type-filter":!0,onFilterChange:v[3]||(v[3]=p=>l.$emit("filter-change",p)),onSortChange:f},null,8,["type-filter","sort-option"])])):D("",!0),e("div",{ref_key:"scrollContainer",ref:x,class:"flex-1 overflow-y-auto px-4 space-y-4 pb-4 scrollbar-hide"},[(a(!0),c(_,null,ee(m.value,p=>(a(),c("div",{key:p.compositeId||`${p.type||"task"}-${p.id}`,ref_for:!0,ref:L=>{k(p)&&(y.value=L)},onClick:L=>l.$emit("select",p.compositeId||`${p.type||"task"}-${p.id}`||p.id),class:R(["card card-hover min-h-[11rem] flex flex-col overflow-hidden cursor-pointer relative",k(p)?typeof o.selectedClass=="function"?o.selectedClass(p):o.selectedClass:typeof o.unselectedClass=="function"?o.unselectedClass(p):o.unselectedClass])},[o.openMenuId===p.id&&o.showMenu?W((a(),c("div",Yt,[me(l.$slots,"menu",{item:p},void 0,!0)])),[[t,()=>l.$emit("menu-close")]]):D("",!0),e("div",Kt,[e("div",Gt,[me(l.$slots,"badges",{item:p},void 0,!0)]),o.showMenu?(a(),c("button",{key:0,onClick:de(L=>l.$emit("menu-click",p.id),["stop"]),class:"text-gray-400 hover:text-gray-600 transition-colors pr-2"},[...v[6]||(v[6]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Jt)):D("",!0)]),e("div",Xt,[e("div",Zt,[e("div",{class:R(["w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-bold shrink-0",o.avatarClass(p)])},C(o.getInitials(p)),3),e("div",_t,[e("h3",es,C(o.getName(p)),1),e("p",ts,[me(l.$slots,"location",{item:p},void 0,!0)])])]),e("div",ss,[e("div",os,[v[7]||(v[7]=e("span",{class:"text-gray-400"},"Car",-1)),e("span",ls,C(o.getVehicleInfo(p)),1)]),e("div",ns,[v[8]||(v[8]=e("span",{class:"text-gray-400"},"Status",-1)),e("span",as,[me(l.$slots,"vehicle-status",{item:p},void 0,!0)])])]),e("div",is,[me(l.$slots,"owner",{item:p},void 0,!0),me(l.$slots,"dates",{item:p},void 0,!0)])])],10,Qt))),128))],512)]))}},ds=Le(rs,[["__scopeId","data-v-9815ca27"]]),us={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},cs={class:"flex-1 overflow-y-auto p-4 md:p-8"},ps={class:"table-wrapper w-full"},ms={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0},viewMode:{type:String,default:"table"}},emits:["select","menu-click","menu-close","filter-change","sort-change","reassign","close","view-change"],setup(o,{emit:T}){const t=o,r=T;A("");const w=A({pageIndex:0,pageSize:10}),u=A(""),b=A([]),m=A([]);A({});const k=q(()=>{const S=[];t.showTypeFilter&&S.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type"}),S.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage"}),S.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),S.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source"});const g=[...new Set(t.tasks.map(h=>h.assignee).filter(Boolean))];g.length>0&&S.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:g.map(h=>({value:h,label:h})),aiHint:"Person assigned to the task"});const d=[...new Set(t.tasks.map(h=>{const j=h.type==="lead"?h.requestedCar:h.vehicle;return j==null?void 0:j.brand}).filter(Boolean))];return d.length>0&&S.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:d.map(h=>({value:h,label:h})),aiHint:"Car brand requested by customer"}),S.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),S}),f=q(()=>t.tasks),x=S=>S.compositeId===t.currentTaskId||S.compositeId===t.highlightId,y=S=>S.type==="lead"?S.requestedCar?`${S.requestedCar.brand} ${S.requestedCar.model}`:"No vehicle specified":S.vehicle?`${S.vehicle.brand} ${S.vehicle.model}`:"No vehicle specified",l=S=>{if(!S)return"Not set";const g=new Date,d=new Date(S),h=new Date(g.getFullYear(),g.getMonth(),g.getDate()),z=new Date(d.getFullYear(),d.getMonth(),d.getDate())-h,P=Math.ceil(z/(1e3*60*60*24));return P===0?"Today":P===1?"Tomorrow":P===-1?"Yesterday":P>1&&P<=7?`In ${P} days`:P<-1&&P>=-7?`${Math.abs(P)} days ago`:Ae(S)},v=q(()=>[{accessorKey:"customer",header:"Customer",meta:{title:"Customer",onOpen:S=>p(S.original)},cell:({row:S})=>{const g=S.original;return Q("div",{class:"flex items-center gap-2 md:gap-3"},[Q("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${g.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},g.customer.initials),Q("div",{class:"min-w-0"},[Q("div",{class:"text-sm font-semibold text-gray-900 truncate max-w-[120px] md:max-w-none"},g.customer.name),Q("div",{class:"text-xs text-gray-500 truncate hidden sm:block"},g.customer.email)])])}},{accessorKey:"vehicle",header:"Vehicle",meta:{title:"Vehicle"},cell:({row:S})=>{const g=S.original,d=t.getVehicleType(g);return Q("div",{class:"flex items-center gap-2"},[Q("div",{class:"min-w-0"},[Q("div",{class:"text-sm font-medium text-gray-900 truncate max-w-[120px]"},y(g)),d?Q("div",{class:"flex items-center gap-1 mt-0.5"},[Q("span",{class:`text-[10px] font-medium px-1.5 py-0.5 rounded-md ${t.getVehicleTypeBadgeClass(d)}`},d.label)]):null])])}},{accessorKey:"type",header:"Type",meta:{title:"Type"},cell:({row:S})=>{const g=S.original,d=g.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return Q("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${d}`},g.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"stage",header:"Stage/Status",meta:{title:"Stage/Status"},cell:({row:S})=>{const g=S.original,d=g.type==="lead"?g.status:g.displayStage||g.stage,h=t.getStageBadgeClass(d);return Q("div",{class:"flex flex-col gap-1"},[Q("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${h}`},d),g.type==="lead"&&g.priority==="Hot"?Q("span",{class:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold bg-red-50 text-red-700 w-fit"},[Q("i",{class:"fa-solid fa-fire text-[9px]"}),"Hot"]):null])}},{accessorKey:"nextActionDue",header:"Next Action",meta:{title:"Next Action"},cell:({row:S})=>{const g=S.original;if(!g.nextActionDue)return"-";const d=je(g.nextActionDue);return Q("div",{class:"text-sm"},[Q("div",{class:`font-medium mb-0.5 ${d.textClass}`},Ae(g.nextActionDue)),Q("div",{class:`text-xs flex items-center gap-1 ${d.textClass}`},[d.icon?Q("i",{class:`fa-solid ${d.icon} text-[10px]`}):null,Q("span",l(g.nextActionDue))])])}},{accessorKey:"owner",header:"Owner",meta:{title:"Owner"},cell:({row:S})=>{const g=S.original,d=t.getOwnerInfo(g);return Q("div",{class:"flex items-center gap-2"},[Q("div",{class:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-600 shrink-0"},d.initials),Q("span",{class:"text-sm text-gray-600 truncate max-w-[80px]"},d.name)])}},{accessorKey:"value",header:"Value",meta:{title:"Value"},cell:({row:S})=>{const g=S.original;return g.type==="opportunity"?Q("div",{class:"text-sm font-semibold text-gray-900"},`â‚¬${yt(g.value)}`):Q("div",{class:"text-gray-400"},"-")}},{id:"actions",header:"",meta:{title:"Actions"},cell:({row:S})=>{const g=S.original;return Q("button",{class:"text-gray-400 hover:text-gray-600",onClick:d=>{d.stopPropagation(),r("menu-click",g.id)}},[Q("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),p=S=>{r("select",S.compositeId)},L=q(()=>({class:{tr:S=>{const g="cursor-pointer hover:bg-gray-50 transition-colors",d=S.original;return x(d)?`${g} bg-blue-50 border-l-4 border-l-blue-500`:g}}}));return ae(()=>[t.highlightId,t.tasks],async([S])=>{S&&t.tasks.length>0&&(await Ne(),setTimeout(()=>{var j,z;const g=document.querySelector(".table-wrapper");if(!g)return;const d=t.tasks.find(P=>P.compositeId===S);if(!d)return;const h=(j=d.customer)==null?void 0:j.name;if(h){const P=g.querySelectorAll('tbody tr, [role="row"]');for(const Y of P)if((z=Y.textContent)!=null&&z.includes(h)){Y.scrollIntoView({behavior:"smooth",block:"nearest"});break}}},500))},{immediate:!0}),(S,g)=>(a(),c("div",us,[J(pt,{title:"Tasks",subtitle:"Manage your leads and opportunities"},{actions:G(()=>[J(Xe,{view:o.viewMode,options:[{value:"card",icon:"fa-solid fa-list",label:"Cards"},{value:"table",icon:"fa-solid fa-table",label:"Table"}],"onUpdate:view":g[0]||(g[0]=d=>S.$emit("view-change",d))},null,8,["view"])]),_:1}),e("div",cs,[e("div",ps,[J(E(mt),{data:f.value,columns:v.value,meta:L.value,onRowClick:p,columnFiltersOptions:{filterDefs:k.value},pagination:w.value,"onUpdate:pagination":g[1]||(g[1]=d=>w.value=d),globalFilter:u.value,"onUpdate:globalFilter":g[2]||(g[2]=d=>u.value=d),sorting:b.value,"onUpdate:sorting":g[3]||(g[3]=d=>b.value=d),columnFilters:m.value,"onUpdate:columnFilters":g[4]||(g[4]=d=>m.value=d),paginationOptions:{rowCount:f.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{"empty-state":G(()=>[...g[5]||(g[5]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},ys={key:0,class:"space-y-4 animate-fade-in"},gs={label:"Teams"},fs=["value"],vs={label:"Users"},bs=["value"],xs={key:0,class:"text-xs text-gray-500 mt-1"},hs={key:0,class:"animate-fade-in"},ws={class:"grid grid-cols-4 gap-2"},ks=["onClick"],Cs={__name:"ScheduleAppointmentWidget",props:{show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,r=T,w=Te(),u=Ue(),b=A(""),m=A(null),k=A(""),f=A(!1),x=A(""),y=q(()=>u.assignableUsers),l=q(()=>u.assignableTeams),v=q(()=>m.value&&m.value.startsWith("team-"));$e(()=>{var g;m.value=`user-${((g=w.currentUser)==null?void 0:g.id)||1}`}),ae(()=>t.show,g=>{g||p()});const p=()=>{var g;b.value="",m.value=`user-${((g=w.currentUser)==null?void 0:g.id)||1}`,k.value="",f.value=!1,x.value=""},L=()=>{if(!b.value||!k.value||!x.value||!m.value)return;const g=m.value.startsWith("team-"),d=parseInt(m.value.split("-")[1]);let h={};if(g){const j=u.getTeamById(d);h={assigneeType:"team",teamId:d,team:(j==null?void 0:j.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const j=u.getUserById(d);h={assigneeType:"user",assigneeId:d,assignee:(j==null?void 0:j.name)||"Unknown",teamId:null,team:null}}r("confirm",{type:b.value,date:k.value,time:x.value,...h}),p()},S=()=>{p(),r("cancel")};return(g,d)=>o.show?(a(),c("div",ys,[e("div",null,[d[5]||(d[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Appointment Type",-1)),W(e("select",{"onUpdate:modelValue":d[0]||(d[0]=h=>b.value=h),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[...d[4]||(d[4]=[e("option",{value:"",disabled:""},"Select type...",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ie,b.value]])]),e("div",null,[d[7]||(d[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Assign to",-1)),W(e("select",{"onUpdate:modelValue":d[1]||(d[1]=h=>m.value=h),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none appearance-none cursor-pointer transition-colors shadow-sm"},[e("optgroup",gs,[(a(!0),c(_,null,ee(l.value,h=>(a(),c("option",{key:`team-${h.id}`,value:`team-${h.id}`},C(h.name)+" Team ",9,fs))),128))]),e("optgroup",vs,[(a(!0),c(_,null,ee(y.value,h=>{var j;return a(),c("option",{key:`user-${h.id}`,value:`user-${h.id}`},C(h.name)+C(h.id===((j=E(w).currentUser)==null?void 0:j.id)?" (Me)":""),9,bs)}),128))])],512),[[ie,m.value]]),v.value?(a(),c("p",xs,[...d[6]||(d[6]=[e("i",{class:"fa-solid fa-users text-gray-400"},null,-1),M(" Any available team member will be assigned ",-1)])])):D("",!0)]),e("div",null,[d[8]||(d[8]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1.5"},"Select Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":d[2]||(d[2]=h=>k.value=h),onChange:d[3]||(d[3]=h=>f.value=!0),class:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 text-sm text-slate-700 focus:border-blue-500 focus:bg-white focus:outline-none shadow-sm transition-colors cursor-pointer"},null,544),[[Z,k.value]])]),f.value?(a(),c("div",hs,[d[9]||(d[9]=e("label",{class:"block text-xs font-medium text-gray-500 mb-2"},"Available Slots",-1)),e("div",ws,[(a(),c(_,null,ee(["09:00","10:30","11:00","14:30","15:00","16:30"],h=>e("button",{key:h,onClick:j=>x.value=h,class:R(["py-2 border border-gray-200 rounded-lg text-xs font-medium transition-all",x.value===h?"border-blue-500 bg-blue-50 text-blue-600":"text-slate-600 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600"])},C(h),11,ks)),64))])])):D("",!0),e("div",{class:"flex gap-3 pt-2"},[e("button",{onClick:S,class:"flex-1 bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium py-2.5 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:L,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg text-sm transition-colors shadow-sm shadow-green-100 flex items-center justify-center gap-2"},[...d[10]||(d[10]=[M(" Confirm Appointment ",-1),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])])])])):D("",!0)}},$s={class:"bg-white border border-gray-200 rounded-lg p-4 animate-fade-in"},Ss={key:0,class:"flex justify-between items-center mb-4"},As={class:"font-semibold text-slate-800 text-sm"},Ds={__name:"InlineFormContainer",props:{title:{type:String,default:""},showClose:{type:Boolean,default:!0}},emits:["close"],setup(o){return(T,t)=>(a(),c("div",$s,[o.title?(a(),c("div",Ss,[e("h5",As,C(o.title),1),o.showClose?(a(),c("button",{key:0,onClick:t[0]||(t[0]=r=>T.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[1]||(t[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):D("",!0)])):D("",!0),me(T.$slots,"default")]))}},Ts={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},Os={class:"flex justify-between items-start mb-3"},Is={class:"font-bold text-slate-800 text-sm"},qs={class:"text-xs text-gray-500 mt-0.5"},Ns={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},Vs={class:"text-xs text-blue-700"},Ls={key:1,class:"mb-3 bg-gray-100 border border-gray-200 rounded-lg p-3"},Fs={class:"flex items-center justify-between"},Rs={class:"flex items-center gap-2"},Ms={class:"text-xs font-bold text-slate-800"},Us={key:0,class:"text-xs text-orange-600 font-medium flex items-center gap-1"},js={class:"flex items-center gap-2 mb-3"},Bs={class:"text-sm text-slate-700 font-medium"},Ws={key:2,class:"flex gap-2 items-center mb-4"},Es=["disabled"],Ps={key:0,class:"bg-blue-500 px-2 py-0.5 rounded text-xs font-bold"},Hs=["disabled"],zs={key:3,class:"mb-4 space-y-4 border-t border-gray-200 pt-4"},Qs={key:0,class:"bg-slate-900 text-white rounded-lg p-4"},Ys={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Ks={class:"flex items-center gap-2 text-red-400"},Gs={class:"text-xs font-mono"},Js={class:"space-y-3 text-sm font-mono"},Xs={class:"ml-2"},Zs={class:"ml-2"},_s={key:0},eo={class:"ml-2"},to={key:1},so={class:"ml-2"},oo={key:2},lo={class:"ml-2"},no={class:"mt-4 pt-4 border-t border-slate-700"},ao={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},io={key:4,class:"mt-4 space-y-4 border-t border-gray-200 pt-4"},ro={class:"grid grid-cols-3 gap-2"},uo={key:0,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},co={class:"grid grid-cols-4 gap-2"},po=["onClick"],mo={key:0},yo={class:"mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},go={class:"text-xs text-slate-700"},fo={class:"grid grid-cols-3 gap-2"},vo={key:0,class:"mt-3 grid grid-cols-2 gap-3"},bo={key:1,class:"space-y-4 bg-white border border-gray-200 rounded-lg p-4"},xo={class:"flex gap-4"},ho={class:"flex items-center gap-2 cursor-pointer"},wo={class:"flex items-center gap-2 cursor-pointer"},ko={class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},Co=["disabled"],$o={key:2,class:"space-y-4"},So={class:"bg-white border border-gray-200 rounded-lg p-4"},Ao={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Do=["value"],To=["value"],Oo=["value"],Io={class:"bg-white border border-gray-200 rounded-lg p-4"},qo={class:"flex gap-2"},No={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Vo={class:"grid grid-cols-2 gap-3 text-sm mb-3"},Lo={class:"ml-2 font-medium text-slate-800"},Fo={class:"ml-2 font-medium text-slate-800"},Ro={class:"ml-2 font-medium text-slate-800 capitalize"},Mo={class:"ml-2 font-medium text-slate-800"},Uo={key:1,class:"bg-white border border-gray-200 rounded-lg p-4"},jo={class:"space-y-2"},Bo=["checked"],Wo=["checked","disabled"],Eo={class:"flex-1"},Po={class:"text-xs text-gray-500 mt-0.5"},Ho={class:"space-y-3"},zo={class:"grid grid-cols-2 gap-3 text-sm"},Qo={class:"ml-2 font-medium text-slate-800"},Yo={class:"ml-2 font-medium text-slate-800"},Ko={class:"ml-2 font-medium text-slate-800 capitalize"},Go={class:"ml-2 font-medium text-slate-800"},Jo={key:0,class:"text-sm"},Xo={class:"ml-2 font-medium text-slate-800"},Zo={key:1,class:"text-sm"},_o={class:"mt-1 text-slate-700"},el={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},tl={class:"p-6"},sl={class:"flex justify-between items-center mb-4"},ol={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ll={class:"p-6"},nl={class:"flex justify-between items-center mb-4"},al={__name:"LQWidget",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","open-trade-in","appointment-scheduled"],setup(o,{emit:T}){var Be,We,Ee;const t=o,r=T,w=Ue(),u=Te(),b=Ge(),m=A(!1),k=A(!1),f=A(0),x=A(""),y=A(null),l=A(!1),v=A(null),p=A(!1),L=A(!1),S=A(!1),g=A(null),d=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],h=A("whatsapp"),j=A("followup-1"),z=A("custom"),P=A(""),Y=A("09:00"),O=A("Not Interested"),V=A(""),H=["Barcelona","Madrid","Valencia","Firenze","Milano","Roma"],le=["Audi Sales (New)","Audi Sales (Used)","Sales (New)","Sales (Used)"],ge=q(()=>w.assignableUsers),ce=q(()=>u.currentUser),oe=A({dealership:((We=(Be=t.lead)==null?void 0:Be.requestedCar)==null?void 0:We.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((Ee=ce.value)==null?void 0:Ee.id)||1}),re=A({tradeIn:!1,financing:!1,contactAvailability:!1}),X=A({}),ne=A(null);$e(()=>{const F=t.lead.displayStage||t.lead.stage;(F==="Valid"||F==="Validated")&&(v.value="interested",l.value=!0)});const te={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},pe=q(()=>{const F=Math.floor(f.value/60),s=f.value%60;return`${F.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}),fe=q(()=>{const F=t.lead.displayStage||t.lead.stage;return F==="Valid"||F==="Validated"?"Lead Validated":t.lead.callbackDate||t.lead.callbackScheduled?"Call Prospect":"Call to Verify Contact Details"}),he=q(()=>{const F=t.lead.displayStage||t.lead.stage;return F==="Valid"||F==="Validated"?"Lead is validated. Complete conversion details to create opportunity.":t.lead.callbackDate||t.lead.callbackScheduled?"Customer requested a callback. Make the call at scheduled time.":"Begin lead qualification by verifying customer contact information."}),we=q(()=>t.lead.scheduledAppointment?new Date(t.lead.scheduledAppointment.start)<new Date:!1),ve=q(()=>!!t.lead.scheduledAppointment),be=q(()=>ve.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:we.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:"Pending",class:"bg-orange-100 text-orange-700"}),n=q(()=>{var F;return((F=t.lead.contactAttempts)==null?void 0:F.length)||0}),i=q(()=>b.getSetting("maxContactAttempts"));q(()=>t.activities.filter(F=>F.type==="note"));const I={"followup-1":`Hi ${t.lead.customer.name.split(" ")[0]}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}?`,"followup-2":`Hello ${t.lead.customer.name.split(" ")[0]}, this is regarding your inquiry about the ${t.lead.requestedCar.brand} ${t.lead.requestedCar.model}. Please let me know when you're available for a call.`,custom:""},U=q(()=>j.value==="custom"?"Type your custom message...":I[j.value]),$=()=>{m.value=!0,f.value=0,k.value=!1,x.value="",y.value=setInterval(()=>{f.value++,f.value>=20&&B()},1e3)},B=()=>{y.value&&(clearInterval(y.value),y.value=null),m.value=!1,k.value=!0,X.value={duration:f.value,notes:x.value,transcription:te,channel:"phone"},l.value=!0},se=async()=>{try{await navigator.clipboard.writeText(t.lead.customer.phone),alert("Phone number copied to clipboard!")}catch(F){console.error("Failed to copy:",F)}},ke=()=>{ne.value={tradeIn:te.leadLines.some(F=>F.toLowerCase().includes("trade")||F.toLowerCase().includes("exchange"))||!1,financing:te.leadLines.some(F=>F.toLowerCase().includes("financ")||F.toLowerCase().includes("payment")||F.toLowerCase().includes("loan"))||!1},ne.value.tradeIn&&(re.value.tradeIn=!0),ne.value.financing&&(re.value.financing=!0),l.value=!0,k.value=!1},Ze=async F=>{g.value=F,S.value=!0,L.value=!1,r("appointment-scheduled",F)},_e=()=>{const F={timestamp:new Date().toISOString(),outcome:"interested",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};r("call-attempt-logged",F),r("validated",{scheduleFollowUp:!1}),r("qualified",{assignment:oe.value,preferences:re.value,scheduleAppointment:S.value,appointmentData:g.value}),xe()},et=()=>{const F={timestamp:new Date().toISOString(),outcome:"interested",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};r("call-attempt-logged",F),v.value="not-valid"},tt=()=>{X.value={channel:"external",notes:"",transcription:null},l.value=!0},Oe=F=>{v.value=F,F==="interested"&&ne.value&&(re.value.tradeIn=ne.value.tradeIn||!1,re.value.financing=ne.value.financing||!1)},xe=()=>{v.value=null,l.value=!1,S.value=!1,g.value=null},st=()=>{if(z.value==="tomorrow-9am"){const s=new Date;return s.setDate(s.getDate()+1),s.setHours(9,0,0,0),s.toISOString()}else if(z.value==="monday"){const s=new Date,N=(8-s.getDay())%7||7;return s.setDate(s.getDate()+N),s.setHours(9,0,0,0),s.toISOString()}else if(z.value==="custom"&&P.value&&Y.value)return new Date(`${P.value}T${Y.value}:00`).toISOString();const F=new Date;return F.setDate(F.getDate()+1),F.setHours(9,0,0,0),F.toISOString()},ot=async()=>{const F={timestamp:new Date().toISOString(),outcome:"no-answer",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};r("call-attempt-logged",F),h.value&&h.value;const s=st(),N=s.split("T")[0],Pe=new Date(s).toTimeString().slice(0,5);r("postponed",{date:N,time:Pe,createAppointment:!0}),n.value+1>=i.value&&r("disqualified",{category:"Not Interested",reason:"Unreachable"}),xe()},lt=()=>{const F={timestamp:new Date().toISOString(),outcome:"not-valid",channel:X.value.channel||"phone",notes:X.value.notes||"",transcription:X.value.transcription||null};r("call-attempt-logged",F),r("disqualified",{category:O.value,reason:V.value}),xe()},nt=F=>{p.value=!1,r("note-saved",F)};return at(()=>{y.value&&clearInterval(y.value)}),(F,s)=>(a(),c("div",Ts,[e("div",Os,[e("div",null,[e("h4",Is,C(fe.value),1),e("p",qs,C(he.value),1)]),e("div",{class:R(["flex items-center gap-2 px-2 py-1 rounded text-xs font-semibold",be.value.class])},C(be.value.text),3)]),ve.value?(a(),c("div",Ns,[s[29]||(s[29]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-xs"}),e("span",{class:"text-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",Vs,C(E(Ce)(o.lead.scheduledAppointment.start))+" at "+C(E(De)(o.lead.scheduledAppointment.start)),1)])):D("",!0),n.value>0?(a(),c("div",Ls,[e("div",Fs,[e("div",Rs,[s[30]||(s[30]=e("i",{class:"fa-solid fa-phone text-gray-600 text-xs"},null,-1)),s[31]||(s[31]=e("span",{class:"text-xs font-semibold text-slate-700"},"Contact Attempts:",-1)),e("span",Ms,C(n.value)+" / "+C(i.value),1)]),n.value>=i.value-1?(a(),c("div",Us,[...s[32]||(s[32]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),M(" One more attempt before auto-disqualification ",-1)])])):D("",!0)])])):D("",!0),e("div",js,[e("span",Bs,C(o.lead.customer.phone),1),e("button",{onClick:se,class:"w-6 h-6 flex items-center justify-center rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy phone number"},[...s[33]||(s[33]=[e("i",{class:"fa-regular fa-copy text-xs"},null,-1)])])]),!l.value&&!m.value&&!k.value?(a(),c("div",Ws,[e("button",{onClick:$,disabled:m.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-blue-200"},[s[34]||(s[34]=e("i",{class:"fa-solid fa-phone"},null,-1)),M(" "+C(n.value>0?"Call Again":"Initiate Call")+" ",1),n.value>0?(a(),c("span",Ps,C(n.value+1)+"/"+C(i.value),1)):D("",!0)],8,Es),e("button",{onClick:tt,disabled:m.value,class:"bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[35]||(s[35]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),M(" Log Call Outcome ",-1)])],8,Hs)])):D("",!0),m.value||k.value?(a(),c("div",zs,[m.value?(a(),c("div",Qs,[e("div",Ys,[s[37]||(s[37]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Ks,[s[36]||(s[36]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Gs,"REC "+C(pe.value),1)])]),e("div",Js,[e("div",null,[s[38]||(s[38]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Xs,C(te.leadLines[0]),1)]),e("div",null,[s[39]||(s[39]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Zs,C(te.salesLines[0]),1)]),f.value>=5?(a(),c("div",_s,[s[40]||(s[40]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",eo,C(te.leadLines[1]),1)])):D("",!0),f.value>=8?(a(),c("div",to,[s[41]||(s[41]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",so,C(te.salesLines[1]),1)])):D("",!0),f.value>=12?(a(),c("div",oo,[s[42]||(s[42]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",lo,C(te.leadLines[2]),1)])):D("",!0)]),e("div",no,[W(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=N=>x.value=N),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,512),[[Z,x.value]])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:B,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...s[43]||(s[43]=[e("i",{class:"fa-solid fa-phone-slash"},null,-1),M(" End Call ",-1)])])])])):D("",!0),k.value&&!m.value?(a(),c("div",ao,[e("div",{class:"flex items-center justify-between"},[s[45]||(s[45]=e("div",null,[e("h4",{class:"font-bold text-slate-800 mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription")],-1)),e("button",{onClick:ke,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[44]||(s[44]=[e("i",{class:"fa-solid fa-wand-magic-sparkles"},null,-1),M(" Extract information ",-1)])])])])):D("",!0)])):D("",!0),l.value?(a(),c("div",io,[e("div",null,[s[49]||(s[49]=e("h4",{class:"font-semibold text-slate-800 mb-2 text-sm"},"What's the outcome?",-1)),e("div",ro,[e("button",{onClick:s[1]||(s[1]=N=>Oe("no-answer")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="no-answer"?"bg-blue-50 border-blue-500 text-blue-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[46]||(s[46]=[e("i",{class:"fa-solid fa-phone-slash text-base"},null,-1),e("span",{class:"font-medium text-xs"},"No answer",-1)])],2),e("button",{onClick:s[2]||(s[2]=N=>Oe("not-valid")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="not-valid"?"bg-red-50 border-red-500 text-red-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[47]||(s[47]=[e("i",{class:"fa-solid fa-thumbs-down text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Not valid",-1)])],2),e("button",{onClick:s[3]||(s[3]=N=>Oe("interested")),class:R(["flex flex-col items-center justify-center gap-1.5 p-2 rounded-lg border transition-all",v.value==="interested"?"bg-green-50 border-green-500 text-green-700 shadow-sm":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"])},[...s[48]||(s[48]=[e("i",{class:"fa-solid fa-check text-base"},null,-1),e("span",{class:"font-medium text-xs"},"Interested",-1)])],2)])]),v.value==="no-answer"?(a(),c("div",uo,[s[57]||(s[57]=e("h5",{class:"font-semibold text-slate-800 text-sm"},"Send follow-up message",-1)),e("div",co,[(a(),c(_,null,ee(d,N=>e("button",{key:N.value,onClick:Pe=>h.value=N.value,class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",h.value===N.value?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])},C(N.label),11,po)),64))]),h.value&&h.value!=="dont-send"?(a(),c("div",mo,[s[52]||(s[52]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Template",-1)),W(e("select",{"onUpdate:modelValue":s[4]||(s[4]=N=>j.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[...s[50]||(s[50]=[e("option",{value:"followup-1"},"Follow-up 1",-1),e("option",{value:"followup-2"},"Follow-up 2",-1),e("option",{value:"custom"},"Custom message",-1)])],512),[[ie,j.value]]),e("div",yo,[s[51]||(s[51]=e("p",{class:"text-xs font-semibold text-gray-600 mb-1 uppercase"},"Message preview",-1)),e("p",go,C(U.value),1)])])):D("",!0),e("div",null,[s[55]||(s[55]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-2"},"Next call attempt",-1)),e("div",fo,[e("button",{onClick:s[5]||(s[5]=N=>z.value="tomorrow-9am"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",z.value==="tomorrow-9am"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:s[6]||(s[6]=N=>z.value="monday"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",z.value==="monday"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Monday ",2),e("button",{onClick:s[7]||(s[7]=N=>z.value="custom"),class:R(["px-3 py-2 rounded-lg text-xs font-medium transition-all border-2",z.value==="custom"?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:border-gray-300"])}," Select time ",2)]),z.value==="custom"?(a(),c("div",vo,[e("div",null,[s[53]||(s[53]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":s[8]||(s[8]=N=>P.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[Z,P.value]])]),e("div",null,[s[54]||(s[54]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Time",-1)),W(e("input",{type:"time","onUpdate:modelValue":s[9]||(s[9]=N=>Y.value=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},null,512),[[Z,Y.value]])])])):D("",!0)]),e("div",{class:"flex justify-end gap-2 pt-3 border-t border-gray-200"},[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:ot,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[56]||(s[56]=[M(" Send and reschedule ",-1),e("i",{class:"fa-solid fa-check"},null,-1)])])])])):D("",!0),v.value==="not-valid"?(a(),c("div",bo,[e("div",null,[s[60]||(s[60]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Category",-1)),e("div",xo,[e("label",ho,[W(e("input",{type:"radio","onUpdate:modelValue":s[10]||(s[10]=N=>O.value=N),value:"Not Valid",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Ve,O.value]]),s[58]||(s[58]=e("span",{class:"text-sm text-gray-700"},"Not Valid",-1))]),e("label",wo,[W(e("input",{type:"radio","onUpdate:modelValue":s[11]||(s[11]=N=>O.value=N),value:"Not Interested",class:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Ve,O.value]]),s[59]||(s[59]=e("span",{class:"text-sm text-gray-700"},"Not Interested",-1))])])]),e("div",null,[s[62]||(s[62]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"Failure Reason",-1)),W(e("select",{"onUpdate:modelValue":s[12]||(s[12]=N=>V.value=N),class:"w-full bg-white border-2 border-red-500 rounded-lg px-3 py-2 text-sm text-gray-700 focus:outline-none focus:border-red-600"},[...s[61]||(s[61]=[He('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[ie,V.value]])]),e("div",ko,[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("button",{onClick:lt,disabled:!O.value||!V.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Confirm Disqualification ",8,Co)])])):D("",!0),v.value==="interested"?(a(),c("div",$o,[e("div",So,[s[66]||(s[66]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Assign to salesman",-1)),e("div",Ao,[e("div",null,[s[63]||(s[63]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Dealership",-1)),W(e("select",{"onUpdate:modelValue":s[13]||(s[13]=N=>oe.value.dealership=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(a(),c(_,null,ee(H,N=>e("option",{key:N,value:N},C(N),9,Do)),64))],512),[[ie,oe.value.dealership]])]),e("div",null,[s[64]||(s[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Team",-1)),W(e("select",{"onUpdate:modelValue":s[14]||(s[14]=N=>oe.value.team=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(a(),c(_,null,ee(le,N=>e("option",{key:N,value:N},C(N),9,To)),64))],512),[[ie,oe.value.team]])]),e("div",null,[s[65]||(s[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1.5"},"Assignee",-1)),W(e("select",{"onUpdate:modelValue":s[15]||(s[15]=N=>oe.value.assigneeId=N),class:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-500"},[(a(!0),c(_,null,ee(ge.value,N=>(a(),c("option",{key:N.id,value:N.id},C(N.name)+C(N.id===ce.value.id?" (Me)":""),9,Oo))),128))],512),[[ie,oe.value.assigneeId]])])])]),e("div",Io,[s[70]||(s[70]=e("h5",{class:"font-semibold text-slate-800 text-sm mb-3"},"Customer preferences",-1)),e("div",qo,[e("button",{onClick:s[16]||(s[16]=N=>r("open-purchase-method")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[67]||(s[67]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),M(" Add purchase method ",-1)])]),e("button",{onClick:s[17]||(s[17]=N=>r("open-trade-in")),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[68]||(s[68]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),M(" Add trade-in ",-1)])]),e("button",{onClick:s[18]||(s[18]=N=>p.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...s[69]||(s[69]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),M(" Add note ",-1)])])])]),F.hasExistingAppointment&&!S.value?(a(),c("div",No,[s[76]||(s[76]=He('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="text-sm font-semibold text-slate-800">Existing Appointment</h5></div><span class="text-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Vo,[e("div",null,[s[71]||(s[71]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Lo,C(E(Ce)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[72]||(s[72]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Fo,C(E(De)(o.lead.scheduledAppointment.start)),1)]),e("div",null,[s[73]||(s[73]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Ro,C(o.lead.scheduledAppointment.type),1)]),e("div",null,[s[74]||(s[74]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Mo,C(o.lead.scheduledAppointment.assignee),1)])]),e("button",{onClick:s[19]||(s[19]=N=>L.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[75]||(s[75]=[e("i",{class:"fa-solid fa-calendar-days text-xs"},null,-1),M(" Reschedule Appointment ",-1)])])])):D("",!0),F.hasExistingAppointment?D("",!0):(a(),c("div",Uo,[s[79]||(s[79]=e("h5",{class:"text-xs font-semibold text-gray-600 mb-3"},"Choose Next Step",-1)),e("div",jo,[e("label",{class:R(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":!S.value}])},[e("input",{type:"radio",checked:!S.value,onChange:s[20]||(s[20]=()=>{S.value=!1,g.value=null}),class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,40,Bo),s[77]||(s[77]=e("div",{class:"flex-1"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Qualify without appointment"),e("div",{class:"text-xs text-gray-500 mt-0.5"},"Proceed directly to opportunity stage")],-1))],2),e("label",{class:R(["flex items-start gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50/50 transition-all",{"border-blue-500 bg-blue-50":S.value}]),onClick:s[22]||(s[22]=N=>!S.value&&(L.value=!0))},[e("input",{type:"radio",checked:S.value,disabled:!S.value,class:"mt-0.5 w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,8,Wo),e("div",Eo,[s[78]||(s[78]=e("div",{class:"text-sm font-semibold text-slate-800"},"Schedule Appointment",-1)),e("div",Po,C(S.value?"Appointment scheduled":"Book a meeting or test drive"),1)]),S.value?(a(),c("button",{key:0,onClick:s[21]||(s[21]=de(N=>L.value=!0,["stop","prevent"])),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded-lg text-xs transition-colors shadow-sm"}," Reschedule ")):D("",!0)],2)])])),S.value?(a(),K(Ds,{key:2,title:"Scheduled Appointment","show-close":!1},{default:G(()=>[e("div",Ho,[e("div",zo,[e("div",null,[s[80]||(s[80]=e("span",{class:"text-gray-600"},"Date:",-1)),e("span",Qo,C(E(Ce)(g.value.datetime)),1)]),e("div",null,[s[81]||(s[81]=e("span",{class:"text-gray-600"},"Time:",-1)),e("span",Yo,C(g.value.time),1)]),e("div",null,[s[82]||(s[82]=e("span",{class:"text-gray-600"},"Type:",-1)),e("span",Ko,C(g.value.type),1)]),e("div",null,[s[83]||(s[83]=e("span",{class:"text-gray-600"},"Assigned to:",-1)),e("span",Go,C(g.value.assignee),1)])]),g.value.location?(a(),c("div",Jo,[s[84]||(s[84]=e("span",{class:"text-gray-600"},"Location:",-1)),e("span",Xo,C(g.value.location),1)])):D("",!0),g.value.notes?(a(),c("div",Zo,[s[85]||(s[85]=e("span",{class:"text-gray-600"},"Notes:",-1)),e("p",_o,C(g.value.notes),1)])):D("",!0)])]),_:1})):D("",!0),e("div",{class:"flex justify-between items-center pt-3 border-t border-gray-200"},[e("button",{onClick:xe,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Cancel "),e("div",{class:"flex gap-2"},[e("button",{onClick:et,class:"bg-white hover:bg-gray-50 border border-gray-200 text-gray-700 font-medium px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2"},[...s[86]||(s[86]=[e("i",{class:"fa-solid fa-ban text-xs"},null,-1),M(" Disqualify ",-1)])]),e("button",{onClick:_e,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors shadow-sm flex items-center gap-2"},[...s[87]||(s[87]=[e("i",{class:"fa-solid fa-check text-xs"},null,-1),M(" Qualify ",-1)])])])])])):D("",!0)])):D("",!0),(a(),K(ze,{to:"body"},[p.value?(a(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[25]||(s[25]=de(N=>p.value=!1,["self"]))},[e("div",el,[e("div",tl,[e("div",sl,[s[89]||(s[89]=e("h5",{class:"text-sm font-bold text-slate-800"},"Add Note",-1)),e("button",{onClick:s[23]||(s[23]=N=>p.value=!1),class:"text-gray-400 hover:text-gray-600"},[...s[88]||(s[88]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),J(ft,{item:null,"task-type":"lead","task-id":o.lead.id,borderless:!1,onSave:nt,onCancel:s[24]||(s[24]=N=>p.value=!1)},null,8,["task-id"])])])])):D("",!0)])),(a(),K(ze,{to:"body"},[L.value?(a(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[28]||(s[28]=de(N=>L.value=!1,["self"]))},[e("div",ol,[e("div",ll,[e("div",nl,[s[91]||(s[91]=e("h5",{class:"text-sm font-bold text-slate-800"},"Schedule Appointment",-1)),e("button",{onClick:s[26]||(s[26]=N=>L.value=!1),class:"text-gray-400 hover:text-gray-600"},[...s[90]||(s[90]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),J(Cs,{show:!0,onConfirm:Ze,onCancel:s[27]||(s[27]=N=>L.value=!1)})])])])):D("",!0)]))]))}},il={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm"},rl={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},dl={class:"flex items-center gap-3"},ul={class:"flex-1"},cl={key:0,class:"text-xs font-normal opacity-75"},pl={class:"p-5 space-y-6"},ml={key:1,class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4"},yl={class:"flex justify-between items-start mb-3"},gl={class:"text-xs text-gray-500 mt-0.5"},fl={key:0},vl={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(o,{emit:T}){const t=o,r=T,w=Fe(),u=Re(),b=Te(),m=A(new Set),k=q(()=>m.value.has(t.lead.id)),f=()=>{m.value.add(t.lead.id)},x=q(()=>je(t.lead.nextActionDue)),y=q(()=>{var O,V;return((O=t.lead)==null?void 0:O.displayStage)||((V=t.lead)==null?void 0:V.stage)||"New Lead"}),l=q(()=>Je(y.value,"lead"));q(()=>(t.lead.contactAttempts||[]).length||0),q(()=>t.lead.isDisqualified||y.value.startsWith("Closed"));const v=q(()=>y.value.startsWith("Closed"));async function p(O){try{const V=new Date(`${O.date}T${O.time}:00`),H=V.toISOString();await u.modifyLead(t.lead.id,{nextActionDue:H}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${Ce(V)} at ${De(V)}`}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to postpone lead task:",V)}}async function L(O){try{if(await u.modifyLead(t.lead.id,{stage:"Validated"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),O.scheduleFollowUp&&O.appointmentData){const V=new Date(`${O.appointmentData.date}T${O.appointmentData.time}:00`);await u.scheduleFollowUp(t.lead.id,{dateTime:V.toISOString(),assignee:O.appointmentData.assignee||t.lead.assignee,assigneeId:O.appointmentData.assigneeId||null,assigneeType:O.appointmentData.assigneeType||"user",teamId:O.appointmentData.teamId||null,team:O.appointmentData.team||null}),await u.addActivity(t.lead.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${Ce(V)} at ${De(V)}`})}await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to validate lead:",V)}}async function S(){try{const O=await u.convertLeadToOpportunity(t.lead.id);b.canAccessOpportunities()?w.push({path:`/tasks/${O}`,query:{type:"opportunity"}}):w.push("/tasks/1")}catch(O){console.error("Failed to qualify lead:",O)}}async function g(O){try{const V=t.lead.contactAttempts||[];await u.modifyLead(t.lead.id,{contactAttempts:[...V,O],lastContactAttempt:O.timestamp,totalContactAttempts:V.length+1}),await u.addActivity(t.lead.id,{type:"call",user:"You",action:`logged call attempt - ${O.outcome}`,content:O.notes||`Call attempt via ${O.channel}`,data:{outcome:O.outcome,channel:O.channel,duration:O.duration}}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to log call attempt:",V)}}async function d(O){try{await u.addActivity(t.lead.id,{type:"note",user:"You",action:"added a note",content:O.content||O.text||"",data:O}),await u.loadLeadById(t.lead.id)}catch(V){console.error("Failed to save note:",V)}}function h(){r("open-purchase-method")}function j(){r("open-trade-in")}async function z(O){var V;try{const H=`${O.date}T${O.time}:00`,le=new Date(H);le.setHours(le.getHours()+1),await u.modifyLead(t.lead.id,{scheduledAppointment:{id:Date.now(),title:`${O.type} - ${t.lead.customer.name}`,start:H,end:le.toISOString(),type:O.type,assignee:O.assignee,assigneeId:O.assigneeId,status:"scheduled",location:O.location||"",notes:O.notes||""}}),await u.addActivity(t.lead.id,{type:"appointment",user:((V=b.currentUser)==null?void 0:V.name)||"You",action:"scheduled an appointment",content:`${O.type} scheduled for ${O.date} at ${O.time}`,data:{type:O.type,date:O.date,time:O.time,assignee:O.assignee}}),await u.loadLeadById(t.lead.id)}catch(H){console.error("Failed to schedule appointment:",H)}}async function P(O){try{const V=O.reason==="Duplicate";await u.modifyLead(t.lead.id,{isDisqualified:!0,disqualifyReason:O.reason,isDuplicate:V,stage:V?"Closed Failed":"Not Valid",status:"Disqualified"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${O.category}, Reason: ${O.reason}`}),w.push("/tasks")}catch(V){console.error("Failed to disqualify lead:",V)}}async function Y(){try{await u.modifyLead(t.lead.id,{isDisqualified:!1,disqualifyReason:null,stage:"Open Lead",status:"Open"}),await u.addActivity(t.lead.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"}),await u.loadLeadById(t.lead.id)}catch(O){console.error("Failed to reopen lead:",O)}}return(O,V)=>o.lead?(a(),c("div",il,[e("div",rl,[V[0]||(V[0]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:R(["text-xs px-3 py-1 rounded-full font-medium border",l.value])},C(y.value),3)]),o.lead.nextActionDue&&!k.value&&(x.value.type==="overdue"||x.value.type==="urgent")?(a(),c("div",{key:0,class:R(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[x.value.bgClass,x.value.borderClass]])},[e("div",dl,[e("div",{class:R(["w-9 h-9 rounded-lg flex items-center justify-center",[x.value.bgClass,x.value.borderClass,"border"]])},[e("i",{class:R(["text-base",[`fa-solid ${x.value.icon}`,x.value.textClass]])},null,2)],2),e("div",ul,[V[1]||(V[1]=e("div",{class:"text-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:R(["text-sm font-bold",x.value.textClass])},[M(C(E(Ae)(o.lead.nextActionDue))+" ",1),x.value.type!=="overdue"?(a(),c("span",cl," ("+C(E(gt)(o.lead.nextActionDue))+") ",1)):D("",!0)],2)]),x.value.type==="overdue"?(a(),c("div",{key:0,class:R(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[x.value.bgClass,x.value.textClass,x.value.borderClass,"border"]])},[...V[2]||(V[2]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),M(" Overdue ",-1)])],2)):x.value.type==="urgent"?(a(),c("div",{key:1,class:R(["text-xs font-bold uppercase px-2.5 py-1 rounded-md",[x.value.bgClass,x.value.textClass,x.value.borderClass,"border"]])},[...V[3]||(V[3]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),M(" Urgent ",-1)])],2)):D("",!0)]),e("button",{onClick:f,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...V[4]||(V[4]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):D("",!0),e("div",pl,[v.value?(a(),c("div",ml,[e("div",yl,[e("div",null,[V[5]||(V[5]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Lead Closed",-1)),e("p",gl,[M(" Status: "+C(y.value)+" ",1),o.lead.disqualifyReason?(a(),c("span",fl," - "+C(o.lead.disqualifyReason),1)):D("",!0)])])]),e("button",{onClick:Y,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...V[6]||(V[6]=[M(" Reopen Lead ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])])])):(a(),c(_,{key:0},[y.value==="New"||!v.value?(a(),K(al,{key:0,lead:o.lead,onPostponed:p,onValidated:L,onQualified:S,onDisqualified:P,onCallAttemptLogged:g,onNoteSaved:d,onOpenPurchaseMethod:h,onOpenTradeIn:j,onAppointmentScheduled:z},null,8,["lead"])):D("",!0)],64))])])):D("",!0)}},bl={class:"mt-1.5 border-t border-gray-200 pt-1.5"},xl={key:1},hl={class:"flex items-center justify-between mb-1.5"},wl={class:"space-y-1.5"},kl={class:"block label-upper mb-1"},Cl=["onUpdate:modelValue","placeholder"],$l=["onUpdate:modelValue"],Sl=["value"],Al={key:2,class:"space-y-0.5"},Dl=["onUpdate:modelValue","value"],ue={__name:"SurveyWidget",props:{questions:{type:Array,required:!0}},emits:["survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=A(!1),u=A({});ae(()=>t.questions,x=>{const y={};x.forEach(l=>{y[l.key]=""}),u.value=y},{immediate:!0});const b=()=>{r("survey-completed",{...u.value}),f()},m=()=>{r("survey-refused"),f()},k=()=>{r("not-responding"),f()},f=()=>{w.value=!1;const x={};t.questions.forEach(y=>{x[y.key]=""}),u.value=x};return(x,y)=>(a(),c("div",bl,[w.value?(a(),c("div",xl,[e("div",hl,[y[4]||(y[4]=e("h5",{class:"text-xs font-semibold text-gray-700"},"Survey / Feedback",-1)),e("button",{onClick:y[1]||(y[1]=l=>w.value=!1),class:"text-xs text-gray-400 hover:text-gray-600 font-medium py-0.5"},[...y[3]||(y[3]=[e("i",{class:"fa-solid fa-chevron-up text-[10px]"},null,-1)])])]),e("div",wl,[(a(!0),c(_,null,ee(o.questions,(l,v)=>(a(),c("div",{key:v,class:"bg-gray-50 rounded-md p-1.5"},[e("label",kl,C(l.label),1),l.type==="text"?W((a(),c("textarea",{key:0,"onUpdate:modelValue":p=>u.value[l.key]=p,placeholder:l.placeholder,rows:"2",class:"input resize-none text-xs py-1 px-2"},null,8,Cl)),[[Z,u.value[l.key]]]):l.type==="select"?W((a(),c("select",{key:1,"onUpdate:modelValue":p=>u.value[l.key]=p,class:"input text-xs py-1 px-2"},[y[5]||(y[5]=e("option",{value:""},"Select an option...",-1)),(a(!0),c(_,null,ee(l.options,p=>(a(),c("option",{key:p,value:p},C(p),9,Sl))),128))],8,$l)),[[ie,u.value[l.key]]]):l.type==="radio"?(a(),c("div",Al,[(a(!0),c(_,null,ee(l.options,p=>(a(),c("label",{key:p,class:"flex items-center text-xs"},[W(e("input",{type:"radio","onUpdate:modelValue":L=>u.value[l.key]=L,value:p,class:"mr-1"},null,8,Dl),[[Ve,u.value[l.key]]]),M(" "+C(p),1)]))),128))])):D("",!0)]))),128)),e("div",{class:"flex gap-1.5 flex-wrap pt-0.5"},[e("button",{onClick:b,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Complete Survey "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Customer Refused "),e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-2.5 py-1 rounded-md text-xs transition-colors"}," Not Responding ")])])])):(a(),c("button",{key:0,onClick:y[0]||(y[0]=l=>w.value=!0),class:"w-full flex items-center justify-between text-xs text-gray-500 hover:text-gray-700 py-0.5 transition-colors"},[...y[2]||(y[2]=[e("span",{class:"font-medium"},"Survey / Feedback",-1),e("i",{class:"fa-solid fa-chevron-down text-[10px]"},null,-1)])]))]))}},Tl={class:"bg-orange-50/50 border border-orange-100 rounded-lg p-4 relative transition-all duration-300"},Ol={class:"flex justify-between items-start mb-3"},Il={class:"text-xs text-gray-500 mt-0.5"},ql={__name:"OOFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],u=q(()=>{if(!t.opportunity.createdAt)return 0;const y=new Date(t.opportunity.createdAt),v=Math.abs(new Date-y);return Math.ceil(v/(1e3*60*60*24))}),b=()=>{r("create-offer",t.opportunity)},m=()=>{r("review",t.opportunity)},k=y=>{r("survey-completed",{opportunity:t.opportunity,responses:y})},f=()=>{r("survey-refused",{opportunity:t.opportunity})},x=()=>{r("not-responding",{opportunity:t.opportunity})};return(y,l)=>(a(),c("div",Tl,[e("div",Ol,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Open Opportunity Feedback",-1)),e("p",Il,"This opportunity has been open for "+C(u.value)+" days without any offer. Consider creating an offer to move forward.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:b,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Review Opportunity ")]),J(ue,{questions:w,onSurveyCompleted:k,onSurveyRefused:f,onNotResponding:x})]))}},Nl={class:"bg-red-50/50 border border-red-100 rounded-lg p-4 relative transition-all duration-300"},Vl={class:"flex justify-between items-start mb-3"},Ll={class:"text-xs text-gray-500 mt-0.5"},Fl={__name:"UFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],u=q(()=>{if(!t.opportunity.createdAt)return 0;const x=new Date(t.opportunity.createdAt),l=Math.abs(new Date-x);return Math.ceil(l/(1e3*60*60*24))}),b=()=>{r("create-offer",t.opportunity)},m=x=>{r("survey-completed",{opportunity:t.opportunity,responses:x})},k=()=>{r("survey-refused",{opportunity:t.opportunity})},f=()=>{r("not-responding",{opportunity:t.opportunity})};return(x,y)=>(a(),c("div",Nl,[e("div",Vl,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Unsold Feedback",-1)),e("p",Ll,"This opportunity has been open for "+C(u.value)+" days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:b,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),J(ue,{questions:w,onSurveyCompleted:m,onSurveyRefused:k,onNotResponding:f})]))}},Rl={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4 relative transition-all duration-300"},Ml={__name:"NFUWidget",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],u=()=>{r("schedule-closing",t.opportunity)},b=f=>{r("survey-completed",{opportunity:t.opportunity,responses:f})},m=()=>{r("survey-refused",{opportunity:t.opportunity})},k=()=>{r("not-responding",{opportunity:t.opportunity})};return(f,x)=>(a(),c("div",Rl,[x[0]||(x[0]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Follow-up"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.")])],-1)),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:u,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),J(ue,{questions:w,onSurveyCompleted:b,onSurveyRefused:m,onNotResponding:k})]))}},Ul={class:"bg-blue-50/50 border border-blue-100 rounded-lg p-4 relative transition-all duration-300"},jl={class:"flex justify-between items-start mb-3"},Bl={class:"text-xs text-gray-500 mt-0.5"},Wl={__name:"OFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],u=q(()=>{const x=t.opportunity.lastActivity||t.opportunity.createdAt;if(!x)return 0;const y=new Date(x),v=Math.abs(new Date-y);return Math.ceil(v/(1e3*60*60*24))}),b=()=>{r("create-contract",t.opportunity)},m=x=>{r("survey-completed",{opportunity:t.opportunity,responses:x})},k=()=>{r("survey-refused",{opportunity:t.opportunity})},f=()=>{r("not-responding",{opportunity:t.opportunity})};return(x,y)=>(a(),c("div",Ul,[e("div",jl,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Offer Feedback",-1)),e("p",Bl,"This opportunity has been in negotiation for "+C(u.value)+" days without a contract. Consider creating a contract to finalize the deal.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:b,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),J(ue,{questions:w,onSurveyCompleted:m,onSurveyRefused:k,onNotResponding:f})]))}},El={class:"bg-green-50/50 border border-green-100 rounded-lg p-4 relative transition-all duration-300"},Pl={class:"flex justify-between items-start mb-3"},Hl={class:"text-xs text-gray-500 mt-0.5"},zl={__name:"CFBWidget",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],u=q(()=>{var p;if(!((p=t.opportunity)!=null&&p.contractDate))return 0;const y=new Date(t.opportunity.contractDate),v=Math.abs(new Date-y);return Math.ceil(v/(1e3*60*60*24))}),b=()=>{r("prepare-delivery",t.opportunity)},m=()=>{r("pre-delivery-checklist",t.opportunity)},k=y=>{r("survey-completed",{opportunity:t.opportunity,responses:y})},f=()=>{r("survey-refused",{opportunity:t.opportunity})},x=()=>{r("not-responding",{opportunity:t.opportunity})};return(y,l)=>(a(),c("div",El,[e("div",Pl,[e("div",null,[l[0]||(l[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Contract Feedback",-1)),e("p",Hl,"Contract was signed "+C(u.value)+" days ago. Follow up on delivery status and collect customer feedback.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:b,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"}," Pre-Delivery Checklist ")]),J(ue,{questions:w,onSurveyCompleted:k,onSurveyRefused:f,onNotResponding:x})]))}},Ql={class:"bg-teal-50/50 border border-teal-100 rounded-lg p-4 relative transition-all duration-300"},Yl={class:"flex justify-between items-start mb-3"},Kl={class:"text-xs text-gray-500 mt-0.5"},Gl={__name:"DFBWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T,w=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],u=q(()=>{const x=t.activities.find(p=>{var L;return p.type==="delivery"||((L=p.action)==null?void 0:L.toLowerCase().includes("delivered"))});if(!x||!x.timestamp)return 0;const y=new Date(x.timestamp),v=Math.abs(new Date-y);return Math.ceil(v/(1e3*60*60*24))}),b=()=>{r("delivery-feedback",t.opportunity)},m=x=>{r("survey-completed",{opportunity:t.opportunity,responses:x})},k=()=>{r("survey-refused",{opportunity:t.opportunity})},f=()=>{r("not-responding",{opportunity:t.opportunity})};return(x,y)=>(a(),c("div",Ql,[e("div",Yl,[e("div",null,[y[0]||(y[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Delivery Feedback",-1)),e("p",Kl,"Vehicle was delivered "+C(u.value)+" days ago. Ask the customer if they're satisfied with the vehicle.",1)])]),e("button",{onClick:b,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback "),J(ue,{questions:w,onSurveyCompleted:m,onSurveyRefused:k,onNotResponding:f})]))}},Jl={class:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 relative transition-all duration-300"},Xl={class:"flex justify-between items-start mb-3"},Zl={class:"font-bold text-slate-800 text-sm"},_l={class:"text-xs text-gray-500 mt-0.5"},en={__name:"NSWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(o,{emit:T}){const t=o,r=T,w=q(()=>{var p;return((p=t.scheduledAppointment)==null?void 0:p.noShowCount)||0}),u=q(()=>{const p=w.value;return p===0?"No-Show Follow-up":p>=3?`No-Show #${p} - Final Warning`:`No-Show #${p} Follow-up`}),b=q(()=>{const p=w.value;return p>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":p>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),m=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],k=q(()=>{var L;return(L=t.scheduledAppointment)!=null&&L.start?new Date(t.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),f=()=>{r("contact-customer",t.opportunity)},x=()=>{const p=w.value;if(p>=3)r("auto-close-lost",{opportunity:t.opportunity,reason:`Automatically closed after ${p} no-shows`});else if(p===1||p===2){const L=new Date;L.setDate(L.getDate()+2),r("set-callback",{opportunity:t.opportunity,callbackDate:L.toISOString()})}else r("reschedule",t.opportunity)},y=p=>{r("survey-completed",{opportunity:t.opportunity,responses:p})},l=()=>{r("survey-refused",{opportunity:t.opportunity})},v=()=>{r("not-responding",{opportunity:t.opportunity})};return(p,L)=>(a(),c("div",Jl,[e("div",Xl,[e("div",null,[e("h4",Zl,C(u.value),1),e("p",_l,"Appointment was scheduled for "+C(k.value)+" but customer did not show up. "+C(b.value),1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:x,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...L[0]||(L[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),M(" Book Another Appointment ",-1)])]),e("button",{onClick:f,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...L[1]||(L[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),M(" Contact Customer ",-1)])])]),J(ue,{questions:m,onSurveyCompleted:y,onSurveyRefused:l,onNotResponding:v})]))}},tn={class:"bg-gray-50/50 border border-gray-100 rounded-lg p-4 relative transition-all duration-300"},sn={class:"flex justify-between items-start mb-3"},on={class:"text-xs text-gray-500 mt-0.5"},ln={__name:"AbandonedWidget",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(o,{emit:T}){const t=o,r=T;Ge();const w=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],u=q(()=>{const l=t.opportunity.lastActivity||t.opportunity.createdAt;if(!l)return 0;const v=new Date(l),L=Math.abs(new Date-v);return Math.ceil(L/(1e3*60*60*24))}),b=()=>{r("reopen",t.opportunity)},m=()=>{r("close-lost",{opportunity:t.opportunity,reason:"Abandoned - no activity for extended period"})},k=()=>{r("requalify",t.opportunity)},f=l=>{r("survey-completed",{opportunity:t.opportunity,responses:l})},x=()=>{r("survey-refused",{opportunity:t.opportunity})},y=()=>{r("not-responding",{opportunity:t.opportunity})};return(l,v)=>(a(),c("div",tn,[e("div",sn,[e("div",null,[v[0]||(v[0]=e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Abandoned",-1)),e("p",on,"This opportunity has been inactive for "+C(u.value)+" days. Consider reopening it or closing as lost.",1)])]),e("div",{class:"flex gap-3 flex-wrap"},[e("button",{onClick:b,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...v[1]||(v[1]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),M(" Reopen Opportunity ",-1)])]),e("button",{onClick:m,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...v[2]||(v[2]=[e("i",{class:"fa-solid fa-xmark"},null,-1),M(" Close as Lost ",-1)])]),e("button",{onClick:k,class:"bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...v[3]||(v[3]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),M(" Requalify as Lead ",-1)])])]),J(ue,{questions:w,onSurveyCompleted:f,onSurveyRefused:x,onNotResponding:y})]))}},nn={OOFB:ql,UFB:Fl,NFU:Ml,OFB:Wl,CFB:zl,DFB:Gl,NS:en,ABANDONED:ln};function an(o,T,t,r,w){const u=q(()=>{const l=Ie(o),v=Ie(T),p=Ie(t);return{opportunity:l,scheduledAppointment:v,activities:p,hasOffers:(p==null?void 0:p.some(L=>L.type==="offer"))||!1,stage:l.displayStage||l.stage,deliverySubstatus:l.deliverySubstatus||null,formatDateTime:w,hasActiveTaskWidget:!1}}),b=q(()=>{const l=u.value,v=vt(l.stage,l);if(!v)return null;const p=nn[v];return p?{type:v,component:p,props:{opportunity:l.opportunity,appointment:l.scheduledAppointment,activities:l.activities}}:(console.warn(`No component found for widget type: ${v}`),null)}),m=q(()=>({...u.value,hasActiveTaskWidget:!!b.value})),k=q(()=>{const l=m.value,v=bt(l.stage,l);if(!v)return null;const p=r[v.key];return{...v,handler:p||(()=>console.warn(`No handler for action: ${v.key}`))}}),f=q(()=>{const l=m.value;return xt(l.stage,l).map(p=>{const L=r[p.key];return{...p,handler:L||(()=>console.warn(`No handler for action: ${p.key}`))}})}),x=q(()=>{const l=u.value;return ht(l.stage)}),y=q(()=>!b.value||!b.value.type?"":wt(b.value.type));return{primaryAction:k,secondaryActions:f,activeTaskWidget:b,taskWidgetTitle:y,isClosed:x}}const rn=["disabled"],dn={key:0,class:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden max-h-96 overflow-y-auto min-w-full",style:{"z-index":"9999"}},un=["onClick","disabled"],cn={class:"flex-1"},pn={class:"font-medium text-slate-700"},mn={key:0,class:"text-xs text-gray-500 mt-0.5"},yn={key:0,class:"px-4 py-3 text-sm text-gray-500 text-center"},gn={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(o,{emit:T}){const t=T,r=A(!1),w=A(null),u=()=>{r.value=!r.value},b=()=>{r.value=!1},m=f=>{f.disabled||(b(),t("action-selected",f),f.handler&&typeof f.handler=="function"&&f.handler())},k=f=>{w.value&&!w.value.contains(f.target)&&b()};return $e(()=>{document.addEventListener("click",k)}),it(()=>{document.removeEventListener("click",k)}),(f,x)=>(a(),c("div",{class:"relative",ref_key:"dropdownRef",ref:w},[e("button",{onClick:u,class:"w-auto bg-white hover:bg-gray-50 border border-gray-200 text-slate-700 font-medium px-4 py-2 rounded-lg text-sm flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!o.actions||o.actions.length===0},[x[0]||(x[0]=e("span",null,"More actions",-1)),e("i",{class:R(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":r.value}])},null,2)],8,rn),J(Ke,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:G(()=>[r.value?(a(),c("div",dn,[(a(!0),c(_,null,ee(o.actions,y=>(a(),c("button",{key:y.key,onClick:l=>m(y),class:R(["w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-start gap-3 border-b border-gray-100 last:border-b-0 transition-colors whitespace-nowrap",{"opacity-50 cursor-not-allowed":y.disabled}]),disabled:y.disabled},[e("i",{class:R([y.icon,"text-gray-400 mt-0.5 w-4 flex-shrink-0"])},null,2),e("div",cn,[e("div",pn,C(y.label),1),y.description?(a(),c("div",mn,C(y.description),1)):D("",!0)])],10,un))),128)),!o.actions||o.actions.length===0?(a(),c("div",yn," No actions available ")):D("",!0)])):D("",!0)]),_:1})],512))}},fn={class:"w-full h-28 bg-gray-100 rounded overflow-hidden mb-2"},vn=["src","alt"],bn={key:1,class:"w-full h-full flex items-center justify-center"},xn={class:"flex items-center justify-between mb-1.5"},hn={class:"text-sm font-bold text-gray-900"},wn={class:"font-bold text-xs text-gray-800 mb-0.5 line-clamp-1"},kn={class:"text-[10px] text-gray-500 mb-1.5"},Cn={key:0,class:"text-[10px] text-green-600 font-medium mb-2"},$n={key:1,class:"text-[10px] text-orange-600 font-medium mb-2"},Ye={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(o){const T=o,t=q(()=>({Requested:"bg-blue-100 text-blue-700 border border-blue-200",Recommended:"bg-purple-100 text-purple-700 border border-purple-200","In Stock":"bg-green-100 text-green-700 border border-green-200",Custom:"bg-orange-100 text-orange-700 border border-orange-200"})[T.badge]||"bg-gray-100 text-gray-700 border border-gray-200"),r=w=>w?w.toLocaleString("en-US"):"0";return(w,u)=>(a(),c("div",{onClick:u[1]||(u[1]=b=>w.$emit("select")),class:R(["border border-gray-200 rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-white",{"border-blue-500 shadow":o.selected}])},[e("div",fn,[o.vehicle.image?(a(),c("img",{key:0,src:o.vehicle.image,alt:`${o.vehicle.brand} ${o.vehicle.model}`,class:"w-full h-full object-cover"},null,8,vn)):(a(),c("div",bn,[...u[2]||(u[2]=[e("i",{class:"fa-solid fa-car text-gray-300 text-2xl"},null,-1)])]))]),e("div",null,[e("div",xn,[e("span",{class:R(["text-[10px] font-bold uppercase px-1.5 py-0.5 rounded",t.value])},C(o.badge),3),e("span",hn,"â‚¬"+C(r(o.vehicle.price)),1)]),e("h4",wn,C(o.vehicle.brand)+" "+C(o.vehicle.model),1),e("p",kn,C(o.vehicle.year),1),o.stockDays!==null&&o.stockDays!==void 0?(a(),c("div",Cn,[u[3]||(u[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),M(" In stock ("+C(o.stockDays)+" days) ",1)])):(a(),c("div",$n,[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),M(" Out of stock ",-1)])])),e("button",{onClick:u[0]||(u[0]=de(b=>w.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},Sn={class:"space-y-6 max-h-[75vh] overflow-y-auto px-2"},An={key:0},Dn={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},Tn={class:"mb-4"},On={class:"relative"},In={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},qn={key:1,class:"text-center py-8 text-gray-500"},Nn={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Vn={key:0,class:"mt-4 space-y-3"},Ln={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},Fn={class:"flex justify-end"},Rn=["disabled"],Mn={class:"p-4 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Un={class:"flex items-center gap-3"},jn={class:"font-bold text-sm text-gray-800"},Bn={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(o,{emit:T}){const t=o,r=T,w=A(""),u=A(!1),b=A(null),m=A(null),k=A(null),f=A({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""}),x=q(()=>t.requestedVehicle&&t.requestedVehicle.stockDays!==null&&t.requestedVehicle.stockDays!==void 0),y=q(()=>{const g=[];if(t.requestedVehicle&&x.value&&g.push({...t.requestedVehicle,isRequested:!0}),ye&&ye.length>0){const d=ye.filter(j=>t.requestedVehicle?j.brand!==t.requestedVehicle.brand||j.model!==t.requestedVehicle.model:!0),h=t.requestedVehicle&&x.value?3:4;g.push(...d.slice(0,h))}return g}),l=q(()=>{if(!ye||ye.length===0)return[];let g=[...ye];if(w.value){const d=w.value.toLowerCase();g=g.filter(h=>h.brand.toLowerCase().includes(d)||h.model.toLowerCase().includes(d)||h.year.toString().includes(d))}return g}),v=q(()=>f.value.brand&&f.value.model&&f.value.year&&f.value.price>0),p=(g,d)=>{b.value=g,m.value=g.id||`custom-${Date.now()}`,k.value=d},L=()=>{if(!v.value)return;const g={...f.value,id:`custom-${Date.now()}`,isCustom:!0};p(g,"custom")},S=()=>{b.value&&(r("vehicle-selected",{vehicle:b.value,type:k.value}),r("close"),b.value=null,m.value=null,k.value=null,w.value="",u.value=!1,f.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(g,d)=>(a(),K(Se,{show:o.show,onClose:d[6]||(d[6]=h=>g.$emit("close")),title:"Select Vehicle",size:"6xl"},rt({default:G(()=>[e("div",Sn,[y.value.length?(a(),c("div",An,[d[7]||(d[7]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),M(" Recommended Vehicles ")],-1)),e("div",Dn,[(a(!0),c(_,null,ee(y.value,h=>(a(),K(Ye,{key:h.id,vehicle:h,badge:h.isRequested?"Requested":"Recommended","stock-days":h.stockDays,selected:m.value===h.id,onSelect:j=>p(h,h.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):D("",!0),e("div",null,[d[10]||(d[10]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),M(" Browse Stock ")],-1)),e("div",Tn,[e("div",On,[d[8]||(d[8]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"},null,-1)),W(e("input",{"onUpdate:modelValue":d[0]||(d[0]=h=>w.value=h),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-white border border-gray-200 rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[Z,w.value]])])]),l.value.length?(a(),c("div",In,[(a(!0),c(_,null,ee(l.value,h=>(a(),K(Ye,{key:h.id,vehicle:h,badge:"In Stock","stock-days":h.stockDays,selected:m.value===h.id,onSelect:j=>p(h,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(a(),c("div",qn,[...d[9]||(d[9]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-gray-400"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[d[18]||(d[18]=e("h3",{class:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),M(" Configure Custom Vehicle ")],-1)),e("div",Nn,[d[17]||(d[17]=e("p",{class:"text-xs text-gray-600 mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:d[1]||(d[1]=h=>u.value=!u.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[d[11]||(d[11]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),M(" "+C(u.value?"Hide Configuration":"Build Custom Configuration"),1)]),u.value?(a(),c("div",Vn,[e("div",Ln,[e("div",null,[d[12]||(d[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Brand",-1)),W(e("input",{"onUpdate:modelValue":d[2]||(d[2]=h=>f.value.brand=h),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., Audi"},null,512),[[Z,f.value.brand]])]),e("div",null,[d[13]||(d[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Model",-1)),W(e("input",{"onUpdate:modelValue":d[3]||(d[3]=h=>f.value.model=h),type:"text",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., e-tron GT"},null,512),[[Z,f.value.model]])]),e("div",null,[d[14]||(d[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Year",-1)),W(e("input",{"onUpdate:modelValue":d[4]||(d[4]=h=>f.value.year=h),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"2024"},null,512),[[Z,f.value.year]])]),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Price (â‚¬)",-1)),W(e("input",{"onUpdate:modelValue":d[5]||(d[5]=h=>f.value.price=h),type:"number",class:"w-full bg-white border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"98000"},null,512),[[Z,f.value.price]])])]),e("div",Fn,[e("button",{onClick:L,disabled:!v.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...d[16]||(d[16]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),M(" Use Custom Configuration ",-1)])],8,Rn)])])):D("",!0)])])])]),_:2},[b.value?{name:"footer",fn:G(()=>[e("div",Mn,[e("div",Un,[d[20]||(d[20]=e("i",{class:"fa-solid fa-check-circle text-green-600 text-lg"},null,-1)),e("div",null,[d[19]||(d[19]=e("p",{class:"text-xs text-gray-500"},"Selected Vehicle",-1)),e("p",jn,C(b.value.brand)+" "+C(b.value.model)+" ("+C(b.value.year)+") ",1)])]),e("button",{onClick:S,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors shadow-sm"}," Confirm Selection ")])]),key:"0"}:void 0]),1032,["show"]))}},Wn={class:"space-y-4"},En=["max"],Pn=["disabled"],Hn={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,r=T,w=A(""),u=A(""),b=A(""),m=q(()=>new Date().toISOString().split("T")[0]);ae(()=>t.show,x=>{if(x){const y=new Date;w.value=y.toISOString().split("T")[0],u.value=y.toTimeString().slice(0,5),b.value=""}});const k=()=>{if(!w.value)return;const x=u.value?`${w.value}T${u.value}:00`:`${w.value}T12:00:00`;r("confirm",{contractDate:x,notes:b.value})},f=()=>{r("cancel")};return(x,y)=>(a(),K(Se,{show:o.show,title:"Set Contract Signing Date",subtitle:"Record when the contract was signed to track delivery timeline",onCancel:f},{actions:G(()=>[e("button",{onClick:k,disabled:!w.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Set Contract Date ",8,Pn)]),default:G(()=>[e("div",Wn,[e("div",null,[y[3]||(y[3]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":y[0]||(y[0]=l=>w.value=l),max:m.value,class:"input"},null,8,En),[[Z,w.value]])]),e("div",null,[y[4]||(y[4]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),W(e("input",{type:"time","onUpdate:modelValue":y[1]||(y[1]=l=>u.value=l),class:"input"},null,512),[[Z,u.value]])]),e("div",null,[y[5]||(y[5]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),W(e("textarea",{"onUpdate:modelValue":y[2]||(y[2]=l=>b.value=l),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[Z,b.value]])])])]),_:1},8,["show"]))}},zn={class:"space-y-4"},Qn=["max"],Yn=["disabled"],Kn={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,r=T,w=A(""),u=A(""),b=A(""),m=A(""),k=q(()=>new Date().toISOString().split("T")[0]);ae(()=>t.show,y=>{if(y){const l=new Date;w.value=l.toISOString().split("T")[0],u.value=l.toTimeString().slice(0,5),b.value="",m.value=""}});const f=()=>{if(!w.value||!b.value)return;const y=u.value?`${w.value}T${u.value}:00`:`${w.value}T12:00:00`;r("confirm",{deliveryDate:y,location:b.value,notes:m.value})},x=()=>{r("cancel")};return(y,l)=>(a(),K(Se,{show:o.show,title:"Mark as Delivered",subtitle:"Record the vehicle delivery date and details",onCancel:x},{actions:G(()=>[e("button",{onClick:f,disabled:!w.value||!b.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Mark as Delivered ",8,Yn)]),default:G(()=>[e("div",zn,[e("div",null,[l[4]||(l[4]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),W(e("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=v=>w.value=v),max:k.value,class:"input"},null,8,Qn),[[Z,w.value]])]),e("div",null,[l[5]||(l[5]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),W(e("input",{type:"time","onUpdate:modelValue":l[1]||(l[1]=v=>u.value=v),class:"input"},null,512),[[Z,u.value]])]),e("div",null,[l[7]||(l[7]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),W(e("select",{"onUpdate:modelValue":l[2]||(l[2]=v=>b.value=v),class:"input"},[...l[6]||(l[6]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ie,b.value]])]),e("div",null,[l[8]||(l[8]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),W(e("textarea",{"onUpdate:modelValue":l[3]||(l[3]=v=>m.value=v),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[Z,m.value]])])])]),_:1},8,["show"]))}},Gn={class:"space-y-4"},Jn=["disabled"],Xn={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o,{emit:T}){const t=o,r=T,w=A(""),u=A("");ae(()=>t.show,k=>{k&&(w.value="",u.value="")});const b=()=>{w.value&&r("confirm",{reason:w.value,notes:u.value})},m=()=>{r("cancel")};return(k,f)=>(a(),K(Se,{show:o.show,title:"Close as Lost",subtitle:"Document why this opportunity didn't close",onCancel:m},{actions:G(()=>[e("button",{onClick:b,disabled:!w.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"}," Close as Lost ",8,Jn)]),default:G(()=>[e("div",Gn,[e("div",null,[f[3]||(f[3]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),W(e("select",{"onUpdate:modelValue":f[0]||(f[0]=x=>w.value=x),class:"input"},[...f[2]||(f[2]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ie,w.value]])]),e("div",null,[f[4]||(f[4]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),W(e("textarea",{"onUpdate:modelValue":f[1]||(f[1]=x=>u.value=x),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[Z,u.value]])])])]),_:1},8,["show"]))}},Zn={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(o){return(T,t)=>(a(),K(Se,{show:o.show,title:"Requalify as Lead",size:"lg",onCancel:t[1]||(t[1]=r=>T.$emit("cancel"))},{header:G(()=>[...t[2]||(t[2]=[e("div",{class:"p-6 border-b border-gray-200"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Requalify as Lead"),e("p",{class:"text-sm text-gray-600"}," This will convert the opportunity back to a lead. Some data will be lost. ")])])],-1)])]),actions:G(()=>[e("button",{onClick:t[0]||(t[0]=r=>T.$emit("confirm")),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-6 py-2 rounded-lg text-sm transition-colors"}," Confirm Requalification ")]),default:G(()=>[t[3]||(t[3]=e("div",{class:"space-y-6 max-h-[60vh] overflow-y-auto"},[e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),M(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),M(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-gray-700"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),M(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1))]),_:1},8,["show"]))}},_n={class:"flex justify-between items-start mb-3"},ea={class:"font-bold text-slate-800 text-sm"},ta={class:"text-xs text-gray-500 mt-0.5"},sa={class:"flex gap-3 flex-wrap"},oa={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(o){return(T,t)=>(a(),c("div",{class:R(["rounded-lg p-4 relative transition-all duration-300 border",[o.colorScheme.background,o.colorScheme.border]])},[e("div",_n,[e("div",null,[e("h4",ea,C(o.action.title),1),e("p",ta,C(o.action.description),1)])]),e("div",sa,[e("button",{onClick:t[0]||(t[0]=r=>T.$emit("action-clicked")),class:R([o.action.buttonClass,"font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:R(o.action.icon)},null,2),M(" "+C(o.action.label),1)],2)])],2))}},la={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-sm mb-8"},na={class:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center"},aa={class:"p-5 space-y-6"},ia={key:0,class:"bg-green-50/50 border border-green-100 rounded-lg p-4"},ra={class:"flex gap-3"},da={key:2,class:"space-y-3"},ua={class:"flex items-center gap-2 pb-2 border-b border-gray-200"},ca={class:"font-semibold text-gray-900 text-sm"},pa={key:3,class:"flex justify-end"},ma={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(o,{emit:T}){const t=o,r=T,w=Fe(),u=Me(),b=A(!1),m=A(!1),k=A(!1),f=A(!1),x=A(!1),y=A(!1),l=A(!1),v=A(!1),p=A(!1),L=A(!1),S=A([]),g=q(()=>{var n,i;return((n=t.opportunity)==null?void 0:n.displayStage)||((i=t.opportunity)==null?void 0:i.stage)||"Qualified"}),d=q(()=>Je(g.value,"opportunity"));function h(n){return n?new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const j={"schedule-appointment":()=>{b.value=!0},"view-or-schedule-appointment":()=>{t.scheduledAppointment?p.value=!0:b.value=!0},"select-vehicle":()=>{l.value=!0},"create-offer":()=>{!t.opportunity.selectedVehicle&&!t.opportunity.vehicle?l.value=!0:m.value=!0},"call-prospect":()=>{v.value=!0},"follow-up-offer":()=>{v.value=!0},"request-decision":()=>{v.value=!0},"finalize-contract":()=>{f.value=!0},"schedule-delivery":()=>{x.value=!0},"confirm-delivery":()=>{x.value=!0},"collect-feedback":()=>{v.value=!0},reschedule:()=>{L.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&re()},"close-won":()=>{f.value=!0},"add-offer":()=>{m.value=!0},"add-contract":()=>{f.value=!0},"extend-deadline":()=>{v.value=!0},"close-lost":()=>{k.value=!0},reopen:()=>{pe()},requalify:()=>{y.value=!0}},{primaryAction:z,secondaryActions:P,activeTaskWidget:Y,taskWidgetTitle:O,isClosed:V}=an(qe(t,"opportunity"),qe(t,"scheduledAppointment"),qe(t,"activities"),j,h);function H(n){console.log("Secondary action selected:",n.key)}function le(){}function ge(n){l.value=!1,r("vehicle-selected",n),setTimeout(()=>{m.value=!0},300)}function ce(n){m.value=!1,r("offer-created",n)}function oe(n){b.value=!1,r("appointment-scheduled",{...n,opportunityId:t.opportunity.id,customer:t.opportunity.customer.name})}function re(){t.scheduledAppointment&&r("appointment-cancelled",t.scheduledAppointment.id)}function X(n){f.value=!1,u.modifyOpportunity(t.opportunity.id,{stage:"Closed Won",contractDate:n.contractDate})}function ne(n){x.value=!1,u.addActivity(t.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:n})}function te(n){k.value=!1,u.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:n})}function pe(){u.modifyOpportunity(t.opportunity.id,{stage:"Qualified"})}function fe(n){y.value=!1,w.push(`/customer/${n.id}?type=lead`)}function he(n){p.value=!1,console.log("Delete appointment:",n)}function we(n){L.value=!1,console.log("Save appointment:",n)}function ve(n){u.modifyOpportunity(t.opportunity.id,{callbackDate:n.callbackDate})}function be(n){u.modifyOpportunity(t.opportunity.id,{stage:"Closed Lost",lossReason:n.reason||"Multiple no-shows (NS3)"})}return $e(()=>{S.value=ye.filter(n=>n.stockDays!==null&&n.stockDays!==void 0).slice(0,5)}),(n,i)=>o.opportunity?(a(),c("div",la,[e("div",na,[i[13]||(i[13]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-gray-400 text-xs"}),e("h3",{class:"font-bold text-slate-800 text-sm"},"Manage next steps")],-1)),e("span",{class:R(["text-xs px-3 py-1 rounded-full font-medium border",d.value])},C(o.opportunity.displayStage||o.opportunity.stage),3)]),e("div",aa,[E(V)&&!E(Y)?(a(),c("div",ia,[i[16]||(i[16]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-slate-800 text-sm"},"Opportunity Closed"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",ra,[e("button",{onClick:pe,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors shadow-sm"},[...i[14]||(i[14]=[M(" Reopen ",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),e("button",{onClick:i[0]||(i[0]=I=>y.value=!0),class:"bg-white hover:bg-yellow-50 text-yellow-700 border border-yellow-300 font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors"},[...i[15]||(i[15]=[M(" Requalify as Lead ",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])])])])):D("",!0),!E(V)&&E(z)?(a(),K(oa,{key:1,action:E(z),"color-scheme":E(z).colorScheme,onActionClicked:i[1]||(i[1]=I=>E(z).handler())},null,8,["action","color-scheme"])):D("",!0),E(Y)&&E(Y).component?(a(),c("div",da,[e("div",ua,[i[17]||(i[17]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",ca,C(E(O)),1)]),(a(),K(ut(E(Y).component),dt(E(Y).props,{onClose:le,onSetCallback:ve,onAutoCloseLost:be}),null,16))])):D("",!0),E(P).length>0?(a(),c("div",pa,[J(gn,{actions:E(P),onActionSelected:H},null,8,["actions"])])):D("",!0),b.value?(a(),K($t,{key:4,show:b.value,customer:o.opportunity.customer,assignee:o.opportunity.assignee,"disabled-fields":["customer"],onCreate:oe,onCancel:i[2]||(i[2]=I=>b.value=!1)},null,8,["show","customer","assignee"])):D("",!0)]),l.value?(a(),K(Bn,{key:0,opportunity:o.opportunity,"requested-car":o.opportunity.requestedCar,"recommended-cars":S.value,onVehicleSelected:ge,onClose:i[3]||(i[3]=I=>l.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):D("",!0),m.value?(a(),K(kt,{key:1,opportunity:o.opportunity,vehicle:o.opportunity.selectedVehicle||o.opportunity.vehicle||o.opportunity.requestedCar,onOfferCreated:ce,onClose:i[4]||(i[4]=I=>m.value=!1)},null,8,["opportunity","vehicle"])):D("",!0),f.value?(a(),K(Hn,{key:2,opportunity:o.opportunity,onContractSet:X,onClose:i[5]||(i[5]=I=>f.value=!1)},null,8,["opportunity"])):D("",!0),x.value?(a(),K(Kn,{key:3,opportunity:o.opportunity,onDelivered:ne,onClose:i[6]||(i[6]=I=>x.value=!1)},null,8,["opportunity"])):D("",!0),k.value?(a(),K(Xn,{key:4,opportunity:o.opportunity,onClosed:te,onClose:i[7]||(i[7]=I=>k.value=!1)},null,8,["opportunity"])):D("",!0),y.value?(a(),K(Zn,{key:5,opportunity:o.opportunity,onRequalified:fe,onClose:i[8]||(i[8]=I=>y.value=!1)},null,8,["opportunity"])):D("",!0),v.value?(a(),K(Ct,{key:6,onClose:i[9]||(i[9]=I=>v.value=!1)})):D("",!0),p.value&&o.scheduledAppointment?(a(),K(St,{key:7,show:p.value,event:o.scheduledAppointment,onClose:i[10]||(i[10]=I=>p.value=!1),onEdit:i[11]||(i[11]=I=>{p.value=!1,L.value=!0}),onDelete:he},null,8,["show","event"])):D("",!0),L.value&&o.scheduledAppointment?(a(),K(At,{key:8,show:L.value,event:o.scheduledAppointment,customer:o.opportunity.customer,"disabled-fields":["customer"],onSave:we,onCancel:i[12]||(i[12]=I=>L.value=!1)},null,8,["show","event","customer"])):D("",!0)])):D("",!0)}};function ya(o){const T=Re(),t=Me(),r=q(()=>o.value?o.value.type==="lead"?vl:ma:null),w=q(()=>o.value?o.value.type==="lead"?{currentActivities:q(()=>T.currentLeadActivities),addActivity:(b,m)=>T.addActivity(b,m),updateActivity:(b,m,k)=>T.updateActivity(b,m,k),deleteActivity:(b,m)=>T.deleteActivity(b,m)}:{currentActivities:q(()=>t.currentOpportunityActivities),addActivity:(b,m)=>t.addActivity(b,m),updateActivity:(b,m,k)=>t.updateActivity(b,m,k),deleteActivity:(b,m)=>t.deleteActivity(b,m),addVehicle:(b,m)=>t.addVehicle(b,m),createOffer:(b,m)=>t.createOffer(b,m),loadOpportunityById:b=>t.loadOpportunityById(b)}:null),u=q(()=>o.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:r,storeAdapter:w,addNewConfig:u}}const ga={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-gray-50"},fa={key:0,class:"px-1.5 py-0.5 bg-red-50 text-red-600 rounded text-[9px] font-bold uppercase"},va={key:0},ba={key:1},xa={key:0},ha={key:1},wa={key:2},ka=["onClick"],Ca=["onClick"],$a=["onClick"],Sa={key:1,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Aa={key:0,class:"flex-1 flex flex-col overflow-hidden border-l border-gray-200 lg:w-1/2"},Da={key:2,class:"flex-1 flex flex-col overflow-hidden"},Ta={class:"lg:hidden fixed bottom-6 right-4 flex flex-col gap-3 z-30"},Oa=["title"],Ia={key:0,class:"flex-1 flex items-center justify-center"},qa={__name:"Tasks",setup(o){const T=ct(),t=Fe(),r=Re(),w=Me(),u=Te(),b=Ue(),m=A(localStorage.getItem("tasksViewMode")||"table"),k=q(()=>T.query.highlight||null);ae(m,n=>{localStorage.setItem("tasksViewMode",n)});const f=n=>{m.value;const i=H.value;if(m.value=n,n==="table"&&i)t.push({path:"/tasks",query:{highlight:i.compositeId}});else if(n==="card"&&k.value){const[I,U]=k.value.split("-");t.push({path:`/tasks/${U}`,query:{type:I}})}else n==="card"&&!k.value&&!H.value&&t.push({path:"/tasks"})},x=n=>{if(!n)return"No deadline";const i=je(n);return i.type==="overdue"?"OVERDUE":i.type==="today"||i.type==="urgent"?i.relativeTime:Ae(n)},y=n=>{const i=n.type==="lead"?n.requestedCar:n.vehicle;return!i||!i.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[i.type]||{type:i.type.toLowerCase(),label:i.type}},l=n=>n?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[n.type]||"bg-gray-50 text-gray-700":"",v=n=>{if(!n||!n.assignee)return{name:"Unassigned",initials:"?"};const i=n.assigneeInitials||n.assignee.split(" ").map(I=>I[0]).join("");return{name:n.assignee,initials:i}},p=n=>{if(!n||!n.customer||!n.customer.address)return null;const I=n.customer.address.split(",");return I.length>1&&I[I.length-1].trim().replace(/^\d+\s*/,"").trim()||null},L=n=>{const i=p(n),I=n.source||"Unknown";return i?`${i} â€¢ ${I}`:I},S=n=>{const i=n.type==="lead"?n.requestedCar:n.vehicle;if(!i)return"No vehicle";const I=y(n),U=I?I.label:i.type||"Unknown";let $="";return i.kilometers!==void 0&&i.kilometers!==null&&(i.kilometers>=1e3?$=`${(i.kilometers/1e3).toFixed(0)}k`:$=`${i.kilometers}`),$?`${U} / ${$}`:U},g=A("all"),d=A("none"),h=A(null),j=A(!1),z=A(!1),P=A(null),Y=q(()=>{const i=r.leads.filter($=>!$.isDisqualified).map($=>{const B={...$,type:"lead",compositeId:`lead-${$.id}`};return!B.customer&&$.customer&&(B.customer=$.customer),B}),I=w.opportunities.map($=>{const B={...$,type:"opportunity",compositeId:`opportunity-${$.id}`};return!B.customer&&$.customer&&(B.customer=$.customer),B});let U=[];return u.isOperator()?U=i:u.isSalesman()?U=I:U=[...i,...I],U}),O=q(()=>{let n=Y.value;if(g.value!=="all"&&(n=n.filter(i=>i.type===g.value)),d.value==="urgent-first")n=[...n].sort((i,I)=>{if(i.priority==="Hot"&&I.priority!=="Hot")return-1;if(i.priority!=="Hot"&&I.priority==="Hot")return 1;const U=new Date(i.lastActivity||i.createdAt||0);return new Date(I.lastActivity||I.createdAt||0)-U});else if(d.value==="assigned-to-me"){const i=u.currentUser.name;n=n.filter(I=>I.assignee===i),n=[...n].sort((I,U)=>{const $=new Date(I.lastActivity||I.createdAt||0);return new Date(U.lastActivity||U.createdAt||0)-$})}else if(d.value==="assigned-to-my-team"){const i=u.currentUser;let I=[];i.role==="manager"?I=b.users.map(U=>U.name):i.role==="salesman"?I=b.users.filter(U=>U.role==="salesman").map(U=>U.name):i.role==="operator"&&(I=b.users.filter(U=>U.role==="operator").map(U=>U.name)),n=n.filter(U=>I.includes(U.assignee)),n=[...n].sort((U,$)=>{const B=new Date(U.lastActivity||U.createdAt||0);return new Date($.lastActivity||$.createdAt||0)-B})}else n=[...n].sort((i,I)=>{const U=new Date(i.lastActivity||i.createdAt||0);return new Date(I.lastActivity||I.createdAt||0)-U});return n}),V=q(()=>{const n=Y.value.some(I=>I.type==="lead"),i=Y.value.some(I=>I.type==="opportunity");return n&&i}),H=q(()=>{const n=parseInt(T.params.id),i=T.query.type;if(i){const se=`${i}-${n}`;return Y.value.find(ke=>ke.compositeId===se)||null}const I=g.value!=="all"?Y.value.filter(se=>se.type===g.value):Y.value,U=`lead-${n}`,$=`opportunity-${n}`,B=I.find(se=>se.compositeId===U||se.compositeId===$);return B||Y.value.find(se=>se.compositeId===U||se.compositeId===$)||null});q(()=>H.value?H.value.type==="lead"?r.currentLeadActivities:w.currentOpportunityActivities:[]);const le=ya(H),ge=le.managementWidget,ce=le.storeAdapter,oe=le.addNewConfig,re=q(()=>n=>n.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300");$e(()=>{r.loadLeads(),w.loadOpportunities();const n=T.params.id;n&&X(n)}),ae(()=>T.params.id,n=>{n&&X(n)}),ae(H,n=>{n&&(n.type==="lead"?r.loadLeadById(n.id):w.loadOpportunityById(n.id))},{immediate:!0});const X=n=>{const i=parseInt(n),I=Y.value.find(U=>U.id===i);I&&(I.type==="lead"?r.loadLeadById(i):w.loadOpportunityById(i))},ne=n=>{const[i,I]=n.split("-");m.value==="table"&&(m.value="card"),t.push({path:`/tasks/${I}`,query:{type:i}}),j.value=!1},te=n=>{h.value=h.value===n?null:n},pe=n=>{P.value=n,z.value=!0,h.value=null},fe=n=>{d.value=n},he=async n=>{if(!P.value)return;const i=P.value,I=n.name;i.type==="lead"?await r.modifyLead(i.id,{assignee:I,assigneeType:n.type,teamId:n.type==="team"?n.id:null}):i.type==="opportunity"&&await w.updateOpportunity(i.id,{assignee:I,assigneeType:n.type,teamId:n.type==="team"?n.id:null}),z.value=!1,P.value=null},we=async n=>{h.value=null,n.type==="lead"?await r.modifyLead(n.id,{priority:"Hot"}):n.type==="opportunity"&&await w.modifyOpportunity(n.id,{priority:"Hot"})},ve=async n=>{h.value=null,n.type==="lead"?await r.modifyLead(n.id,{priority:"Normal"}):n.type==="opportunity"&&await w.modifyOpportunity(n.id,{priority:"Normal"})},be=n=>({Open:"bg-blue-50 text-blue-700","Open Opportunities":"bg-blue-50 text-blue-700","Open opportunity":"bg-blue-50 text-blue-700",Qualified:"bg-purple-50 text-purple-700","In Negotiation":"bg-orange-50 text-orange-700","Opportunity in negotiation":"bg-orange-50 text-orange-700",Registration:"bg-indigo-50 text-indigo-700",Closed:"bg-gray-100 text-gray-700","Closed opportunity":"bg-gray-100 text-gray-700","Closed Lost":"bg-red-50 text-red-700",Won:"bg-green-50 text-green-700",Lost:"bg-red-50 text-red-700",Valid:"bg-green-50 text-green-700","Not valid":"bg-red-50 text-red-700","To be validated":"bg-yellow-50 text-yellow-700","Not interested":"bg-gray-100 text-gray-700"})[n]||"bg-gray-100 text-gray-700";return(n,i)=>{var I,U;return a(),c("div",ga,[m.value==="card"?(a(),c("div",{key:0,class:R(["lg:relative lg:block",j.value?"fixed inset-0 z-[60] md:relative md:z-auto":"hidden lg:block"])},[J(ds,{title:"Tasks",items:O.value,"selected-id":(I=H.value)==null?void 0:I.compositeId,"type-filter":g.value,"view-mode":m.value,"selected-class":$=>$.type==="lead"?"bg-white border-2 border-blue-500 shadow-md":"bg-white border-2 border-purple-500 shadow-md","unselected-class":re.value,"open-menu-id":h.value,getName:$=>{const B=$.customer;return B&&B.name?B.name:B&&!B.name&&B.email&&B.email.split("@")[0]||"Unknown"},getInitials:$=>{const B=$.customer;return B&&B.initials?B.initials:B&&B.name&&B.name.split(" ").map(ke=>ke[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:$=>$.type==="lead"?$.requestedCar?`${$.requestedCar.brand} ${$.requestedCar.model}`:"No vehicle specified":$.vehicle?`${$.vehicle.brand} ${$.vehicle.model}`:"No vehicle specified",avatarClass:$=>$.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","show-mobile-close":!0,onSelect:ne,onMenuClick:te,onMenuClose:i[0]||(i[0]=$=>h.value=null),onClose:i[1]||(i[1]=$=>j.value=!1),"show-type-filter":V.value,onFilterChange:i[2]||(i[2]=$=>g.value=$),onSortChange:fe,onViewChange:f},{badges:G(({item:$})=>[e("span",{class:R(["px-1.5 py-0.5 rounded text-[9px] font-bold uppercase",$.type==="lead"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"])},C($.type==="lead"?"Lead":"Opportunity"),3),$.priority==="Hot"?(a(),c("span",fa," HOT ")):D("",!0)]),location:G(({item:$})=>[M(C(L($)),1)]),"vehicle-status":G(({item:$})=>[M(C(S($)),1)]),owner:G(({item:$})=>[$.assignee?(a(),c("span",va,"Assignee: "+C($.assignee),1)):(a(),c("span",ba,"Assignee: Unassigned"))]),dates:G(({item:$})=>[$.type==="lead"&&$.nextActionDue?(a(),c("span",xa,"Due: "+C(x($.nextActionDue)),1)):$.type==="opportunity"&&$.nextActionDue?(a(),c("span",ha,"Due: "+C(x($.nextActionDue)),1)):(a(),c("span",wa,"Due: No deadline"))]),menu:G(({item:$})=>[e("button",{onClick:de(B=>pe($),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[9]||(i[9]=[e("i",{class:"fa-solid fa-share text-gray-400"},null,-1),M(" Reassign ",-1)])],8,ka),$.priority!=="Hot"?(a(),c("button",{key:0,onClick:de(B=>we($),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[10]||(i[10]=[e("i",{class:"fa-solid fa-fire text-orange-500"},null,-1),M(" Mark as hot ",-1)])],8,Ca)):(a(),c("button",{key:1,onClick:de(B=>ve($),["stop"]),class:"w-full text-left px-3 py-2 text-xs text-slate-700 hover:bg-gray-50 flex items-center gap-2"},[...i[11]||(i[11]=[e("i",{class:"fa-regular fa-snowflake text-gray-400"},null,-1),M(" Unmark as hot ",-1)])],8,$a))]),_:1},8,["items","selected-id","type-filter","view-mode","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2)):D("",!0),m.value==="table"?(a(),c("div",Sa,[J(ms,{tasks:O.value,"current-task-id":(U=H.value)==null?void 0:U.compositeId,"highlight-id":k.value,"type-filter":g.value,"sort-option":d.value,"show-type-filter":V.value,"show-mobile-close":!0,"open-menu-id":h.value,"get-vehicle-type":y,"get-vehicle-type-badge-class":l,"get-owner-info":v,"get-stage-badge-class":be,"view-mode":m.value,onSelect:ne,onMenuClick:te,onMenuClose:i[3]||(i[3]=$=>h.value=null),onFilterChange:i[4]||(i[4]=$=>g.value=$),onSortChange:fe,onReassign:pe,onClose:i[5]||(i[5]=$=>j.value=!1),onViewChange:f,class:R(H.value?"lg:w-1/2":"w-full")},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","open-menu-id","view-mode","class"]),H.value?(a(),c("div",Aa,[J(Qe,{task:H.value,type:H.value.type,"management-widget":E(ge),"store-adapter":E(ce),"add-new-config":E(oe)},{"pinned-extra":G(({task:$})=>[...i[12]||(i[12]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])])):D("",!0)])):D("",!0),m.value==="card"&&H.value?(a(),c("div",Da,[e("div",Ta,[e("button",{onClick:i[6]||(i[6]=$=>f(m.value==="card"?"table":"card")),class:"w-14 h-14 bg-gray-700 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all hover:scale-110",title:m.value==="card"?"Switch to Table":"Switch to Cards"},[e("i",{class:R(m.value==="card"?"fa-solid fa-table text-lg":"fa-solid fa-list text-lg")},null,2)],8,Oa),e("button",{onClick:i[7]||(i[7]=$=>j.value=!j.value),class:"w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-110",title:"Tasks"},[...i[13]||(i[13]=[e("i",{class:"fa-solid fa-list text-lg"},null,-1)])])]),!H.value&&m.value==="card"?(a(),c("div",Ia,[...i[14]||(i[14]=[e("div",{class:"text-center"},[e("i",{class:"fa-solid fa-tasks text-6xl text-gray-300 mb-4"}),e("p",{class:"text-gray-500"},"Select a task to view details")],-1)])])):H.value&&m.value==="card"?(a(),K(Qe,{key:1,task:H.value,type:H.value.type,"management-widget":E(ge),"store-adapter":E(ce),"add-new-config":E(oe)},{"pinned-extra":G(({task:$})=>[...i[15]||(i[15]=[])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config"])):D("",!0)])):D("",!0),J(Dt,{show:z.value,onClose:i[8]||(i[8]=$=>z.value=!1),onConfirm:he},null,8,["show"])])}}},Pa=Le(qa,[["__scopeId","data-v-cac4c1a0"]]);export{Pa as default};
