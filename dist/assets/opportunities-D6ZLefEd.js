import{D as s,l as S,j as l,p}from"./index-BD7Ni8RS.js";const i=(e=300)=>new Promise(n=>setTimeout(n,e)),C=async(e={})=>{await i();let n=[...s];if(e.stage&&(n=n.filter(t=>t.stage===e.stage)),e.assignee&&(n=n.filter(t=>t.assignee===e.assignee)),e.search){const t=e.search.toLowerCase();n=n.filter(u=>u.customer.name.toLowerCase().includes(t)||u.vehicle.brand.toLowerCase().includes(t)||u.vehicle.model.toLowerCase().includes(t))}return{data:n,total:n.length}},E=async e=>{await i();const n=s.find(t=>t.id===parseInt(e));if(!n)throw new Error("Opportunity not found");return n},L=async e=>{await i();const n={id:s.length+1,...e,createdAt:new Date().toISOString()};return s.push(n),n},B=async(e,n)=>{await i();const t=s.findIndex(u=>u.id===parseInt(e));if(t===-1)throw new Error("Opportunity not found");return s[t]={...s[t],...n},s[t]},D=async e=>{await i();const n=s.findIndex(t=>t.id===parseInt(e));if(n===-1)throw new Error("Opportunity not found");return s.splice(n,1),{success:!0}},j=S("opportunities",()=>{const e=l([]),n=l(null),t=l(!1),u=l(null),c=l({stage:null,assignee:null,search:""}),f=p(()=>e.value.length),v=p(()=>{const a={};return e.value.forEach(r=>{a[r.stage]||(a[r.stage]=[]),a[r.stage].push(r)}),a}),w=p(()=>e.value.reduce((a,r)=>a+r.value,0));async function d(){t.value=!0,u.value=null;try{const a=await C(c.value);e.value=a.data}catch(a){u.value=a.message}finally{t.value=!1}}async function h(a){t.value=!0,u.value=null;try{n.value=await E(a)}catch(r){u.value=r.message}finally{t.value=!1}}async function g(a){t.value=!0,u.value=null;try{const r=await L(a);return e.value.unshift(r),r}catch(r){throw u.value=r.message,r}finally{t.value=!1}}async function O(a,r){t.value=!0,u.value=null;try{const o=await B(a,r),y=e.value.findIndex(x=>x.id===a);return y!==-1&&(e.value[y]=o),o}catch(o){throw u.value=o.message,o}finally{t.value=!1}}async function m(a){t.value=!0,u.value=null;try{await D(a),e.value=e.value.filter(r=>r.id!==a)}catch(r){throw u.value=r.message,r}finally{t.value=!1}}function I(a){c.value={...c.value,...a},d()}return{opportunities:e,currentOpportunity:n,loading:t,error:u,filters:c,totalOpportunities:f,opportunitiesByStage:v,totalValue:w,loadOpportunities:d,loadOpportunityById:h,addOpportunity:g,modifyOpportunity:O,removeOpportunity:m,setFilters:I}});export{j as u};
