import{D as _,r as y,d as w,s as u,e as b,E as O,h as S,o as k}from"./index-DqXOZZRa.js";import{u as C}from"./customers-C0SUz608.js";import{u as q}from"./opportunities-kOQOLZpi.js";import{_ as A}from"./PageHeader-DlkrTgfs.js";import{_ as N}from"./UnifiedAddForm-ckY42O0p.js";import"./settings-B0uvb4uj.js";const D={class:"page-container"},L={class:"p-4 md:p-8"},I={__name:"AddNew",setup(R){const o=S(),c=C(),p=_(),d=q(),i=y(null),m=async l=>{try{const{contactMode:a,selectedContact:f,contactData:r,vehicleData:e,markAsLead:h,markAsOpportunity:g}=l;let t=f;if(a==="new"&&(t=await c.addCustomer({...r,initials:r.name.split(" ").map(s=>s[0]).join("").toUpperCase(),source:"Direct",tags:[],company:r.company||null})),h){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},status:"Open",stage:"Open Lead",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:"",isDisqualified:!1,disqualifyReason:null,scheduledAppointment:null,contactAttempts:[]};e&&Object.keys(e).length>0&&(s.requestedCar=e);const n=await p.createLead(s);o.push({path:"/customers",query:{tab:"open-leads",highlight:`lead-${n.id}`}})}else if(g){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},stage:"Qualified",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:""};e&&Object.keys(e).length>0&&(s.vehicle=e);const n=await d.createOpportunity(s);o.push({path:"/customers",query:{tab:"open-opportunities",highlight:`opp-${n.id}`}})}else e&&Object.keys(e).length>0&&await c.addRequestedCar(t.id,e),o.push({path:"/customers",query:{tab:"contacts",highlight:`contact-${t.id}`}})}catch(a){console.error("Error saving data:",a),alert("Failed to save. Please try again."),i.value&&i.value.resetSubmitting()}};return(l,a)=>(k(),w("div",D,[u(A,{title:"Add New Customer"},{actions:O(()=>[...a[0]||(a[0]=[])]),_:1}),b("div",L,[u(N,{ref_key:"formRef",ref:i,onSubmit:m},null,512)])]))}};export{I as default};
