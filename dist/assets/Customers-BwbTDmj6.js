const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CustomersTab-D3Uxcudc.js","assets/components-_fvbk5Dq.js","assets/index-BrrG4Zms.js","assets/index-SJE1bRqx.css","assets/toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js","assets/UnifiedAddForm-BFt8oQo9.js","assets/contacts-UHPRiXzI.js","assets/opportunities-BPg57aoi.js","assets/useCustomersTable-DAaOrG-p.js","assets/useTableRowSelection-Jz-9OHJe.js","assets/CustomersTab-f48GFISN.css","assets/OpenLeadsTab-CjCkEXSG.js","assets/OfferCarousel-BgF_S9jC.js","assets/sparkles-CqcWxD2C.js","assets/vehicles-CI37T_a6.js","assets/OfferCarousel-CGKIAHJr.css","assets/OpenLeadsTab-lMr7tiBw.css","assets/OpenOpportunitiesTab-CARp9bxz.js","assets/OpenOpportunitiesTab-HF23GNLZ.css","assets/InNegotiationTab-shrdX9E4.js","assets/InNegotiationTab-C9jp4TWA.css","assets/WonTab-C1Qy0BM6.js","assets/WonTab-CamrNFGu.css","assets/LostTab-BvFK3xGQ.js","assets/LostTab-BwFLuzYs.css"])))=>i.map(i=>d[i]);
import{r as C,l as Q,c as w,x as I,o as d,B as i,s as l,y as t,e as r,k as m,t as X,d as T,I as ee,u as te,C as le,m as oe,h as ae,F as M,i as j,n as se,g as F,U as ne,P as ue,V as D,_ as O}from"./index-BrrG4Zms.js";import{_ as ie}from"./PageHeader-umrjmP0o.js";import{f as re,F as de,L as me,g as pe,h as ce,Q as c,c as y,o as ve,C as fe,n as q,d as ye,a as ge,b as he,Z as xe,z as be,X as we}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D7OsJ7VX.js";import{u as ke,a as _e,D as Ve,T as Ce}from"./useTaskFilters-BowFMc_j.js";import{_ as Te}from"./CustomerProfile-BtQiG3iE.js";import{u as Ne}from"./opportunities-BPg57aoi.js";import{u as Ie}from"./UnifiedAddForm-BFt8oQo9.js";import"./OfferCarousel-BgF_S9jC.js";import"./sparkles-CqcWxD2C.js";import"./vehicles-CI37T_a6.js";import"./CreateEventModal-CoiF22IC.js";import"./users-OdWvBllN.js";import"./components-_fvbk5Dq.js";import"./ReassignUserModal-DCLjOtM0.js";import"./EditEventModal-KIC--F4z.js";import"./contacts-UHPRiXzI.js";const De={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Oe={key:0,class:"space-y-6"},$e={class:"space-y-2"},Le={class:"space-y-2"},Ae={class:"space-y-2"},Ee={class:"space-y-2"},Se={key:1,class:"space-y-6"},Ue={class:"space-y-2"},Re={class:"space-y-2"},Be={class:"space-y-2"},Pe={key:2,class:"space-y-6"},We={class:"space-y-2"},ze={class:"space-y-2"},Me={class:"space-y-2"},je={key:3,class:"space-y-6"},Fe={class:"space-y-2"},qe={class:"space-y-2"},Qe={class:"space-y-2"},Xe={__name:"AddCustomerModal",props:{show:{type:Boolean,default:!1},activeTab:{type:String,required:!0},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(k,{emit:L}){const p=k,N=L,a=C({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""});Q(()=>p.show,g=>{g&&(a.value={customerName:p.initialData.customerName||"",email:p.initialData.email||"",phone:p.initialData.phone||"",company:p.initialData.company||"",vehicle:p.initialData.vehicle||"",value:p.initialData.value||"",reason:p.initialData.reason||""})});const A=g=>{g||N("close")},_=w(()=>({customers:"Add New Customer","open-leads":"Add New Lead","open-opportunities":"Add New Opportunity","in-negotiation":"Add Opportunity in Negotiation",won:"Add Won Opportunity",lost:"Add Lost Opportunity"})[p.activeTab]||"Add New Item"),B=w(()=>({customers:"Customer","open-leads":"Lead","open-opportunities":"Opportunity","in-negotiation":"Opportunity",won:"Won Opportunity",lost:"Lost Opportunity"})[p.activeTab]||"Item"),V=()=>{N("save",{...a.value}),a.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}};return(g,e)=>(d(),I(t(ye),{open:k.show,"onUpdate:open":A},{default:i(()=>[l(t(re),null,{default:i(()=>[l(t(de),{class:"fixed inset-0 z-50 bg-black/50"}),l(t(me),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:i(()=>[l(t(pe),{class:"flex-shrink-0"},{default:i(()=>[l(t(ce),null,{default:i(()=>[m(X(_.value),1)]),_:1})]),_:1}),r("div",De,[k.activeTab==="customers"?(d(),T("div",Oe,[r("div",$e,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[14]||(e[14]=[m("Contact Name",-1)])]),_:1}),l(t(y),{modelValue:a.value.customerName,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.customerName=n),type:"text",placeholder:"Enter contact name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Le,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[15]||(e[15]=[m("Email",-1)])]),_:1}),l(t(y),{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.email=n),type:"email",placeholder:"contact@example.com",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Ae,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[16]||(e[16]=[m("Phone",-1)])]),_:1}),l(t(y),{modelValue:a.value.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.phone=n),type:"tel",placeholder:"+49...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Ee,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[17]||(e[17]=[m("Company (optional)",-1)])]),_:1}),l(t(y),{modelValue:a.value.company,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.company=n),type:"text",placeholder:"Company name...",class:"w-full h-10"},null,8,["modelValue"])])])):k.activeTab==="open-leads"?(d(),T("div",Se,[r("div",Ue,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[18]||(e[18]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:a.value.customerName,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Re,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[19]||(e[19]=[m("Email",-1)])]),_:1}),l(t(y),{modelValue:a.value.email,"onUpdate:modelValue":e[5]||(e[5]=n=>a.value.email=n),type:"email",placeholder:"customer@example.com",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Be,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[20]||(e[20]=[m("Requested Vehicle",-1)])]),_:1}),l(t(y),{modelValue:a.value.vehicle,"onUpdate:modelValue":e[6]||(e[6]=n=>a.value.vehicle=n),type:"text",placeholder:"e.g., Volkswagen ID.4",class:"w-full h-10"},null,8,["modelValue"])])])):k.activeTab==="open-opportunities"||k.activeTab==="in-negotiation"?(d(),T("div",Pe,[r("div",We,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[21]||(e[21]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:a.value.customerName,"onUpdate:modelValue":e[7]||(e[7]=n=>a.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",ze,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[22]||(e[22]=[m("Vehicle",-1)])]),_:1}),l(t(y),{modelValue:a.value.vehicle,"onUpdate:modelValue":e[8]||(e[8]=n=>a.value.vehicle=n),type:"text",placeholder:"e.g., Porsche Taycan",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Me,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[23]||(e[23]=[m("Opportunity Value",-1)])]),_:1}),l(t(y),{modelValue:a.value.value,"onUpdate:modelValue":e[9]||(e[9]=n=>a.value.value=n),type:"number",placeholder:"0",class:"w-full h-10"},null,8,["modelValue"])])])):(d(),T("div",je,[r("div",Fe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[24]||(e[24]=[m("Customer Name",-1)])]),_:1}),l(t(y),{modelValue:a.value.customerName,"onUpdate:modelValue":e[10]||(e[10]=n=>a.value.customerName=n),type:"text",placeholder:"Enter customer name...",class:"w-full h-10"},null,8,["modelValue"])]),r("div",qe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[25]||(e[25]=[m("Vehicle",-1)])]),_:1}),l(t(y),{modelValue:a.value.vehicle,"onUpdate:modelValue":e[11]||(e[11]=n=>a.value.vehicle=n),type:"text",placeholder:"Vehicle model",class:"w-full h-10"},null,8,["modelValue"])]),r("div",Qe,[l(t(c),{class:"block text-sm font-semibold text-foreground"},{default:i(()=>[...e[26]||(e[26]=[m("Reason",-1)])]),_:1}),l(t(ve),{modelValue:a.value.reason,"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.reason=n),rows:"4",placeholder:`Reason for ${k.activeTab==="won"?"win":"loss"}...`,class:"w-full min-h-[100px] resize-none"},null,8,["modelValue","placeholder"])])]))]),l(t(fe),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:i(()=>[l(t(q),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:e[13]||(e[13]=n=>g.$emit("close"))}),l(t(q),{label:`Create ${B.value}`,variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:V},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ze={class:"page-container relative flex flex-col overflow-hidden h-full"},He={class:"flex-1 flex flex-col overflow-hidden"},Je={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Ye={class:"mb-2 -mt-2"},Ge={class:"whitespace-nowrap"},Ke={key:0,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},et={__name:"Customers",setup(k){const L=ae(),p=te(),N=le(),a=Ne(),A=Ie(),_=w(()=>{const u=N.leads.filter(h=>!h.isDisqualified),s=a.opportunities.filter(h=>h.stage!=="Closed Won"&&h.stage!=="Closed Lost"),o=a.opportunities.filter(h=>h.stage==="In Negotiation"||h.stage==="In negotiation"),f=a.opportunities.filter(h=>h.stage==="Closed Won"),b=a.opportunities.filter(h=>h.stage==="Closed Lost");return{contacts:A.totalCustomers,openLeads:u.length,openOpportunities:s.length-o.length,inNegotiation:o.length,won:f.length,lost:b.length}}),V=C("customers"),g=C(!1),e=C({customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""}),n=C(!1),x=C(null),v=C(null),{allTasks:E}=ke(C(!1)),$=w(()=>E.value),Z=w(()=>v.value),S=_e(Z),P=w(()=>S.managementWidget.value),W=w(()=>S.storeAdapter.value),H=w(()=>S.addNewConfig.value);Q(v,u=>{u&&(u.type==="lead"?N.fetchLeadById(u.id):a.fetchOpportunityById(u.id))},{immediate:!0});const J={customers:D(()=>O(()=>import("./CustomersTab-D3Uxcudc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),"open-leads":D(()=>O(()=>import("./OpenLeadsTab-CjCkEXSG.js"),__vite__mapDeps([11,1,2,3,4,12,7,13,14,15,8,9,16]))),"open-opportunities":D(()=>O(()=>import("./OpenOpportunitiesTab-CARp9bxz.js"),__vite__mapDeps([17,1,2,3,4,7,12,13,14,15,8,9,18]))),"in-negotiation":D(()=>O(()=>import("./InNegotiationTab-shrdX9E4.js"),__vite__mapDeps([19,1,2,3,4,7,12,13,14,15,8,9,20]))),won:D(()=>O(()=>import("./WonTab-C1Qy0BM6.js"),__vite__mapDeps([21,1,2,3,4,7,12,13,14,15,8,9,22]))),lost:D(()=>O(()=>import("./LostTab-BvFK3xGQ.js"),__vite__mapDeps([23,1,2,3,4,7,12,13,14,15,8,9,24])))},z=w(()=>{const u=[{key:"customers",label:"Customers",count:_.value.contacts},{key:"open-leads",label:"Open leads",count:_.value.openLeads},{key:"open-opportunities",label:"Open opportunities",count:_.value.openOpportunities},{key:"in-negotiation",label:"In negotiation",count:_.value.inNegotiation},{key:"won",label:"Won",count:_.value.won},{key:"lost",label:"Lost",count:_.value.lost}];return p.isOperator()?u.filter(s=>s.key==="customers"||s.key==="open-leads"):p.isSalesman()?u.filter(s=>s.key!=="open-leads"):u}),Y=()=>{e.value={customerName:"",email:"",phone:"",company:"",vehicle:"",value:"",reason:""},g.value=!1},G=(u,s)=>{if(!s||!u)return"gray";const f={customers:"gray","open-leads":"blue","open-opportunities":"blue","in-negotiation":"blue",won:"green",lost:"red"}[u]||"gray";return["blue","green","red","gray"].includes(f)?f:"gray"},U=u=>{if(u.id.startsWith("customer-")){const s=u.customerId||parseInt(u.id.replace("customer-",""));x.value={type:"customer",id:s},v.value=null,n.value=!0}else if(u.id.startsWith("lead-")){const s=u.id.match(/-(\d+)$/),o=parseInt(s?s[1]:u.id.replace("lead-","")),f=E.value.find(b=>b.type==="lead"&&b.id===o);f&&(v.value=f,x.value={type:"task",id:o},n.value=!0,N.fetchLeadById(o))}else if(u.id.startsWith("opp-")){const s=u.id.match(/-(\d+)$/),o=parseInt(s?s[1]:u.id.replace("opp-","")),f=E.value.find(b=>b.type==="opportunity"&&b.id===o);f&&(v.value=f,x.value={type:"task",id:o},n.value=!0,a.fetchOpportunityById(o))}},R=()=>{n.value=!1,x.value=null,v.value=null},K=u=>{if(!v.value)return;const s=$.value.findIndex(o=>{const f=v.value.compositeId||`${v.value.type}-${v.value.id}`;return(o.compositeId||`${o.type}-${o.id}`)===f});if(s!==-1){if(u==="previous"&&s>0){const o=$.value[s-1];U({id:`${o.type}-${o.id}`})}else if(u==="next"&&s<$.value.length-1){const o=$.value[s+1];U({id:`${o.type}-${o.id}`})}}};return oe(async()=>{await N.fetchLeads(),await a.fetchOpportunities()}),(u,s)=>(d(),T("div",Ze,[l(ie,{title:"Customers",class:"shrink-0"},{actions:i(()=>[r("button",{onClick:s[0]||(s[0]=o=>t(L).push("/add-new")),class:"group flex items-center gap-2 rounded-xl border border-border px-3 py-1.5 bg-surface text-sm font-medium text-muted-foreground hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...s[3]||(s[3]=[r("i",{class:"fa-solid fa-plus text-muted-foreground group-hover:text-brand-red"},null,-1),r("span",{class:"hidden sm:inline"},"Add new",-1)])])]),_:1}),r("div",He,[r("div",Je,[r("div",Ye,[l(t(ge),{modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=o=>V.value=o)},{default:i(()=>[l(t(he),{class:"flex shrink-0 border-b border-border bg-white rounded-none w-full relative h-full"},{default:i(()=>[(d(!0),T(M,null,j(z.value,o=>(d(),I(t(xe),{key:o.key,value:o.key,class:se(["flex items-center gap-2 text-sm font-medium transition-all relative flex-1 justify-center bg-transparent outline-none h-full shrink-0",V.value===o.key?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:i(()=>[r("span",Ge,X(o.label),1),l(t(be),{text:String(o.count),size:"small",theme:G(o.key,V.value===o.key)},null,8,["text","theme"]),V.value===o.key?(d(),T("span",Ke)):F("",!0)]),_:2},1032,["value","class"]))),128))]),_:1}),(d(!0),T(M,null,j(z.value,o=>(d(),I(t(we),{key:`content-${o.key}`,value:o.key},{default:i(()=>[(d(),I(ne,null,{fallback:i(()=>[...s[4]||(s[4]=[r("div",{class:"flex items-center justify-center py-12"},[r("div",{class:"text-center"},[r("i",{class:"fa-solid fa-spinner fa-spin text-gray-400 text-2xl mb-2"}),r("p",{class:"text-meta"},"Loading...")])],-1)])]),default:i(()=>[(d(),I(ue(J[o.key]),{onRowClick:U},null,32))]),_:2},1024))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])])]),l(Ve,{show:n.value,onClose:R},{default:i(()=>[x.value&&x.value.type==="customer"?(d(),I(Te,{key:0,"customer-id":x.value.id,"customer-type":"contact","show-close-button":!0,"close-on-convert":!0,onClose:R},null,8,["customer-id"])):x.value&&x.value.type==="task"&&v.value&&P.value&&W.value?(d(),I(Ce,{key:1,task:v.value,"management-widget":P.value,"store-adapter":W.value,"add-new-config":H.value,"filtered-tasks":$.value,"is-drawer-view":!0,onTaskNavigate:K,onClose:R},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):F("",!0)]),_:1},8,["show"]),l(Xe,{show:g.value,"active-tab":V.value,"initial-data":e.value,onClose:s[2]||(s[2]=o=>g.value=!1),onSave:Y},null,8,["show","active-tab","initial-data"])]))}},gt=ee(et,[["__scopeId","data-v-9c7b5442"]]);export{gt as default};
