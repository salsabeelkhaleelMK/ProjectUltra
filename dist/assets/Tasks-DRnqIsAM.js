import{H as Ae,I as Te,J as _e,c as F,r as B,K as De,d as A,o as C,g as N,p as ae,e as p,w as le,F as J,i as X,t as R,n as P,k as fe,L as et,s as z,B as E,T as we,M as ge,l as se,y as M,N as tt,x as Z,O as ee,P as oe,Q as I,u as Ie,C as st,R as nt,m as at,j as lt,h as rt,S as ke}from"./index-Dj_RD8l0.js";import{u as ot}from"./opportunities-BC_ZMPUZ.js";import{u as Le}from"./users-THux0QKI.js";import{n as re,z as pe}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-B5cRDmy2.js";import{L as it,O as ut,g as ye,f as ct,a as dt,b as pt,c as Me,d as Ne,e as ft}from"./opportunityRules-vWdCqPB2.js";import{y as gt}from"./components-D2RBuYr8.js";import{u as yt,a as Ce,T as Se,D as mt}from"./useTaskFilters-C-uqsFpw.js";import{_ as vt}from"./ReassignUserModal-d8k4ux0v.js";import"./sparkles-hzGdDkcm.js";import"./vehicles-BgEBo0jD.js";import"./CreateEventModal-2ClmRhSs.js";import"./EditEventModal-DuOgUtB3.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=Ae("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Ae("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function ht(e){if(!e)return null;if(e.title)return e.title;const v=e.type||(e.customer?"opportunity":"lead"),s=Te(e,v);if(v==="lead"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const b=it[s];if(!b||!b.primaryAction)return null;const n=b.primaryAction,g={lead:e,displayStage:s},u=typeof n=="function"?n(g):n;if(!u)return null;const c=typeof u.label=="function"?u.label(g):u.label,d=typeof u.title=="function"?u.title(g):u.title;return c||d||null}if(v==="opportunity"){if(e.scheduledAppointment&&e.scheduledAppointment.title)return e.scheduledAppointment.title;const b=ut[s];if(!b||!b.primaryAction)return null;const n=b.primaryAction,g={deliverySubstatus:e.deliverySubstatus||_e(e,e.activities||[]),hasOffers:!!(e.offers&&e.offers.length>0)||!!(e.activities&&e.activities.some(y=>y.type==="offer")),scheduledAppointment:e.scheduledAppointment,opportunity:e,formatDateTime:y=>new Date(y).toLocaleDateString()},u=typeof n=="function"?n(g):n;if(!u)return null;const c=typeof u.label=="function"?u.label(g):u.label,d=typeof u.title=="function"?u.title(g):u.title;return c||d||null}return null}const bt=["onClick"],xt={class:"flex flex-col min-w-0 flex-1 pr-4"},wt={class:"flex items-center gap-1 mb-0.5"},kt={key:0,class:"font-bold text-heading text-fluid-base truncate"},Ct={class:"flex items-center gap-2 overflow-hidden"},St={class:"text-sub text-fluid-sm truncate"},$t={class:"flex flex-wrap items-center gap-2 mt-2"},At={key:1,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},Tt={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(e,{emit:v}){const s=e,b=F(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),n=F(()=>s.selected),g=F(()=>n.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),u=r=>r?r.stage||r.currentStage||"New":"",c=r=>{if(!r||r.type!=="opportunity")return null;try{return Te(r,"opportunity")}catch{return r.displayStage||r.stage||null}},d=r=>{if(!r)return"";if(r.type==="opportunity"){const i=c(r)||r.stage||r.currentStage||"New";u(r);const w=y(r);return w&&w!==i?w:i}return r.stage||r.currentStage||r.displayStage||"New"},y=r=>{if(!r||r.type!=="opportunity")return"";const i=u(r),w=c(r);if(!w||!i)return w||"";const $=i.toLowerCase().trim();if(w.toLowerCase().trim().startsWith($+" - ")){const l=i+" - ";if(w.startsWith(l))return w.substring(l.length)}return w},f=(r,i="opportunity")=>{if(!r)return"bg-gray-50 text-gray-700 border-gray-200";try{const w=et(r,i);return w.includes("blue")?w+" border-blue-200":w.includes("purple")?w+" border-purple-200":w.includes("yellow")?w+" border-yellow-200":w.includes("pink")?w+" border-pink-200":w.includes("indigo")?w+" border-indigo-200":w.includes("emerald")?w+" border-emerald-200":w.includes("green")?w+" border-green-200":w.includes("red")?w+" border-red-200":(w.includes("gray"),w+" border-gray-200")}catch{const $=r.toLowerCase();return $.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":$.includes("qualif")?"bg-green-50 text-green-600 border-green-200":$.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":$.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-gray-50 text-gray-700 border-gray-200"}},o=F(()=>{const r=s.item;if(!r)return"bg-gray-50 text-gray-700 border-gray-200";if(r.type==="opportunity"){const w=c(r)||u(r);return f(w,"opportunity")}const i=d(r).toLowerCase();return i.includes("new")?"bg-blue-50 text-blue-600 border-blue-200":i.includes("qualif")?"bg-green-50 text-green-600 border-green-200":i.includes("negotiat")?"bg-purple-50 text-purple-600 border-purple-200":i.includes("close")?"bg-surfaceSecondary text-body border-black/5":"bg-blue-50 text-blue-600 border-blue-200"}),x=F(()=>ht(s.item)),T=F(()=>{const r=s.item.nextActionDue||s.item.dueDate;if(!r)return null;const i=ye(r);return{text:ct(r),status:i}}),S=F(()=>T.value?T.value.status.textClass.replace("text-","bg-"):""),j=B(null);return(r,i)=>{const w=De("click-outside");return C(),A("div",{ref_key:"cardRef",ref:j,onClick:i[2]||(i[2]=$=>r.$emit("select",b.value)),class:P(["bg-white rounded-xl p-4 flex items-center justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-all border group",g.value])},[e.showMenu?(C(),A("button",{key:0,onClick:i[0]||(i[0]=le($=>r.$emit("menu-click",e.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 z-10"},[...i[3]||(i[3]=[p("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):N("",!0),e.openMenuId===e.item.id&&e.showMenu?ae((C(),A("div",{key:1,class:"absolute right-2 top-7 z-50 w-40 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:i[1]||(i[1]=le(()=>{},["stop"]))},[(C(!0),A(J,null,X(e.menuItems,$=>(C(),A("button",{key:$.key,onClick:$.onClick,class:"w-full px-3 py-2 text-left text-xs text-heading hover:bg-surfaceSecondary flex items-center gap-2"},R($.label),9,bt))),128))])),[[w,()=>r.$emit("menu-close")]]):N("",!0),p("div",xt,[p("div",wt,[x.value?(C(),A("h3",kt,R(x.value),1)):N("",!0),T.value?(C(),A("span",{key:1,class:P(["flex items-center gap-1 text-[10px] font-bold uppercase leading-none shrink-0",T.value.status.textClass])},[p("span",{class:P(["w-1.5 h-1.5 rounded-full",S.value])},null,2),fe(" "+R(T.value.text),1)],2)):N("",!0)]),p("div",Ct,[p("span",St,R(e.getName(e.item)),1)]),p("div",$t,[p("span",{class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",e.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},R(e.item.type==="lead"?"Lead":"Opportunity"),3),d(e.item)?(C(),A("span",{key:0,class:P(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",o.value])},R(d(e.item)),3)):N("",!0),e.item.priority==="Hot"?(C(),A("span",At," Hot ")):N("",!0)])])],2)}}},Dt={key:0,class:"flex flex-col gap-2"},It={class:"flex items-center gap-1.5 flex-wrap"},Lt={class:"relative",ref:"filterContainer"},Mt={key:0,class:"filter-indicator"},Nt=["onClick"],Ft=["onClick"],Ot={key:0,class:"flex items-center gap-1.5 flex-wrap"},qt=["onClick"],Bt={key:0,class:"task-filter-badge"},Ut={key:1,class:"relative",ref:"filterContainer"},Rt={key:0,class:"filter-indicator"},Ht=["onClick"],Vt=["onClick"],Wt={key:2,class:"flex items-center gap-1.5 flex-wrap"},zt=["onClick"],Et={key:0,class:"task-filter-badge"},$e={__name:"TaskFilters",props:{activeFilters:{type:Array,default:()=>[]},sortOption:{type:String,default:""},showClosed:{type:Boolean,default:!1},buttonOnly:{type:Boolean,default:!1},chipsOnly:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(e,{emit:v}){const s=e,b=v,n=B(!1),g=()=>{n.value=!n.value},u=()=>{n.value=!1},c=[{key:"lead",label:"Leads",type:"type"},{key:"opportunity",label:"Opportunities",type:"type"},{key:"due-in-24h",label:"Due in 24 hours",type:"date"},{key:"to-be-called",label:"To be called again",type:"status"},{key:"leads-1h",label:"Leads created 1 hour ago",type:"date"},{key:"assigned-to-me",label:"Assigned to me",type:"assignee"}],d=r=>{const i=c.find(w=>w.key===r);return i?i.label:r},y=r=>{n.value=!1;const i=[...s.activeFilters],w=i.indexOf(r);w>-1?i.splice(w,1):i.push(r),b("filter-change",i)},f=r=>{const i=[...s.activeFilters],w=i.indexOf(r);w>-1&&(i.splice(w,1),b("filter-change",i))},o=r=>{n.value=!1,b("sort-change",r)},x=()=>{b("sort-change","")},T=F(()=>{const r=s.activeFilters.includes("lead");return[{key:"recent-first",label:"Most Recent First"},...r?[{key:"urgent-first",label:"Urgent first"}]:[],{key:"assigned-to-me",label:"Assigned to me"},{key:"assigned-to-my-team",label:"Assigned to my team"}]}),S=F(()=>s.sortOption&&s.sortOption!==""&&s.sortOption!=="none"),j=F(()=>{const r=T.value.find(i=>i.key===s.sortOption);return r?r.label:s.sortOption});return(r,i)=>{const w=De("click-outside");return!e.buttonOnly&&!e.chipsOnly?(C(),A("div",Dt,[p("div",It,[ae((C(),A("div",Lt,[p("button",{onClick:g,class:"filter-dropdown-button"},[i[2]||(i[2]=p("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(C(),A("span",Mt)):N("",!0)]),z(we,{name:"dropdown-fade"},{default:E(()=>[n.value?(C(),A("div",{key:0,class:"absolute left-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:i[0]||(i[0]=le(()=>{},["stop"]))},[(C(),A(J,null,X(c,$=>p("button",{key:$.key,onClick:K=>y($.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes($.key)}])},[p("span",null,R($.label),1)],10,Nt)),64)),i[3]||(i[3]=p("div",{class:"border-t border-black/10 my-1"},null,-1)),(C(!0),A(J,null,X(T.value,$=>(C(),A("button",{key:$.key,onClick:K=>o($.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":$.key===e.sortOption}])},[p("span",null,R($.label),1)],10,Ft))),128))])):N("",!0)]),_:1})])),[[w,u]]),e.activeFilters.length>0||S.value?(C(),A("div",Ot,[(C(!0),A(J,null,X(e.activeFilters,$=>(C(),A("div",{key:$,class:"task-filter-badge"},[p("span",null,R(d($)),1),p("button",{onClick:K=>f($),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...i[4]||(i[4]=[p("i",{class:"fa-solid fa-xmark"},null,-1)])],8,qt)]))),128)),S.value?(C(),A("div",Bt,[p("span",null,R(j.value),1),p("button",{onClick:x,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...i[5]||(i[5]=[p("i",{class:"fa-solid fa-xmark"},null,-1)])])])):N("",!0)])):N("",!0)])])):e.buttonOnly?ae((C(),A("div",Ut,[p("button",{onClick:g,class:"filter-dropdown-button"},[i[6]||(i[6]=p("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),e.activeFilters.length>0||e.sortOption?(C(),A("span",Rt)):N("",!0)]),z(we,{name:"dropdown-fade"},{default:E(()=>[n.value?(C(),A("div",{key:0,class:"absolute right-0 mt-2 z-50 w-56 bg-white border border-black/10 rounded-lg shadow-lg py-1",onClick:i[1]||(i[1]=le(()=>{},["stop"]))},[(C(),A(J,null,X(c,$=>p("button",{key:$.key,onClick:K=>y($.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary filter-item-selected":e.activeFilters.includes($.key)}])},[p("span",null,R($.label),1)],10,Ht)),64)),i[7]||(i[7]=p("div",{class:"border-t border-black/10 my-1"},null,-1)),(C(!0),A(J,null,X(T.value,$=>(C(),A("button",{key:$.key,onClick:K=>o($.key),class:P(["w-full px-4 py-2 text-left text-sm text-heading hover:bg-surfaceSecondary flex items-center gap-2 relative",{"bg-surfaceSecondary sort-item-selected":$.key===e.sortOption}])},[p("span",null,R($.label),1)],10,Vt))),128))])):N("",!0)]),_:1})])),[[w,u]]):e.chipsOnly&&(e.activeFilters.length>0||S.value)?(C(),A("div",Wt,[(C(!0),A(J,null,X(e.activeFilters,$=>(C(),A("div",{key:$,class:"task-filter-badge"},[p("span",null,R(d($)),1),p("button",{onClick:K=>f($),class:"task-filter-badge-remove","aria-label":"Remove filter"},[...i[8]||(i[8]=[p("i",{class:"fa-solid fa-xmark"},null,-1)])],8,zt)]))),128)),S.value?(C(),A("div",Et,[p("span",null,R(j.value),1),p("button",{onClick:x,class:"task-filter-badge-remove","aria-label":"Remove sort"},[...i[9]||(i[9]=[p("i",{class:"fa-solid fa-xmark"},null,-1)])])])):N("",!0)])):N("",!0)}}},jt={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},Pt={class:"page-header shrink-0"},Qt={class:"page-header-main"},Kt={class:"page-header-content"},Yt={class:"page-header-title-container"},Gt={class:"page-header-title"},Jt={class:"page-header-actions"},Xt={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},Zt={class:"px-5 py-3"},_t={class:"flex items-center gap-2"},es={class:"relative flex-1"},ts=["placeholder"],ss={key:0,class:"mt-2"},ns={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},activeFilters:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:e=>e.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(e,{emit:v}){const s=e,b=v,n=B(s.initialSearchQuery),g=B(null),u=B(""),c=F(()=>typeof s.title=="string"?s.title:typeof s.title=="function"?(console.warn("TasksList: title prop received a function instead of a string. Using default title."),"Tasks"):s.title||"Tasks");se(()=>s.initialSearchQuery,o=>{n.value=o});const d=F(()=>{let o=s.items;const x=s.activeFilters.filter(S=>S==="lead"||S==="opportunity");if(x.length>0&&(o=o.filter(S=>!!(S.type&&x.includes(S.type)))),!n.value.trim())return o;const T=n.value.toLowerCase().trim();return o.filter(S=>{const j=s.getName(S).toLowerCase(),r=s.getVehicleInfo(S).toLowerCase();return j.includes(T)||r.includes(T)})}),y=o=>s.selectedId?(o.compositeId||`${o.type||"task"}-${o.id}`)===s.selectedId:!1,f=o=>{u.value=o,b("sort-change",o)};return(o,x)=>(C(),A("div",jt,[p("header",Pt,[p("div",Qt,[p("div",Kt,[p("div",Yt,[p("h1",Gt,R(c.value),1)]),p("div",Jt,[p("div",Xt,[z(M(re),{variant:"secondary",size:"icon",onClick:x[0]||(x[0]=T=>o.$emit("view-change","card")),class:P(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:E(()=>[z(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"]),z(M(re),{variant:"secondary",size:"icon",onClick:x[1]||(x[1]=T=>o.$emit("view-change","table")),class:P(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:E(()=>[z(M(Oe),{size:14})]),_:1},8,["class","aria-pressed"])])])])])]),p("div",Zt,[p("div",_t,[p("div",es,[x[8]||(x[8]=p("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),ae(p("input",{"onUpdate:modelValue":x[2]||(x[2]=T=>n.value=T),type:"text",placeholder:e.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,ts),[[tt,n.value]])]),z($e,{"active-filters":e.activeFilters,"sort-option":u.value,"button-only":!0,onFilterChange:x[3]||(x[3]=T=>o.$emit("filter-change",T)),onSortChange:f},null,8,["active-filters","sort-option"])]),e.activeFilters.length>0?(C(),A("div",ss,[z($e,{"active-filters":e.activeFilters,"sort-option":u.value,"chips-only":!0,onFilterChange:x[4]||(x[4]=T=>o.$emit("filter-change",T)),onSortChange:f},null,8,["active-filters","sort-option"])])):N("",!0)]),p("div",{ref_key:"scrollContainer",ref:g,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(C(!0),A(J,null,X(d.value,T=>(C(),Z(Tt,{key:T.compositeId||`${T.type||"task"}-${T.id}`,item:T,selected:y(T),"selected-class":e.selectedClass,"unselected-class":e.unselectedClass,"show-menu":e.showMenu,"open-menu-id":e.openMenuId,getName:e.getName,getVehicleInfo:e.getVehicleInfo,"menu-items":e.getMenuItems?e.getMenuItems(T):null,onSelect:x[5]||(x[5]=S=>o.$emit("select",S)),onMenuClick:x[6]||(x[6]=S=>o.$emit("menu-click",S)),onMenuClose:x[7]||(x[7]=S=>o.$emit("menu-close"))},{location:E(({item:S})=>[ee(o.$slots,"location",{item:S},void 0,!0)]),source:E(({item:S})=>[ee(o.$slots,"source",{item:S},void 0,!0)]),owner:E(({item:S})=>[ee(o.$slots,"owner",{item:S},void 0,!0)]),dates:E(({item:S})=>[ee(o.$slots,"dates",{item:S},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},as=ge(ns,[["__scopeId","data-v-8979b846"]]);function qe(e,v=[],s,b){const n=oe(),g=n.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},u=n.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},c=ls(e,v),d=rs(e,v),y=os(e),f=is(e),o=g.intent+g.behavioral+g.temporal,x={intent:g.intent/o*100,behavioral:g.behavioral/o*100,temporal:g.temporal/o*100},T=c/40*x.intent,S=d/35*x.behavioral,j=y/25*x.temporal,r=Math.min(100,Math.max(0,T+S+j+f));let i="COLD";return r>=u.hot?i="HOT":r>=u.warm?i="WARM":r>=u.standard&&(i="STANDARD"),{score:Math.round(r*10)/10,level:i,breakdown:{intent:Math.round(c*10)/10,behavioral:Math.round(d*10)/10,temporal:Math.round(y*10)/10,quality:Math.round(f*10)/10,total:Math.round(r*10)/10}}}function ls(e,v){var b;let s=0;return(e.requestType==="Test Drive"||((b=e.scheduledAppointment)==null?void 0:b.type)==="test-drive"||v.some(n=>n.type==="test-drive"||n.type==="appointment"))&&(s=Math.max(s,40)),v.some(n=>n.type==="financing")&&(s=Math.max(s,35)),v.some(n=>n.type==="tradein")&&(s=Math.max(s,30)),(e.source==="Walk-in"||v.some(n=>{var g,u,c;return((g=n.content)==null?void 0:g.toLowerCase().includes("location"))||((u=n.content)==null?void 0:u.toLowerCase().includes("dealership"))||((c=n.content)==null?void 0:c.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),e.requestedCar&&(e.requestedCar.requestMessage||v.some(n=>{var g,u;return((g=n.content)==null?void 0:g.toLowerCase().includes("configur"))||n.type==="attachment"&&((u=n.fileName)==null?void 0:u.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),v.some(n=>{var u;const g=((u=n.content)==null?void 0:u.toLowerCase())||"";return g.includes("compare")||g.includes("versus")||g.includes("vs")||g.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function rs(e,v){let s=0;const b=new Set(v.map(c=>{if(!c.timestamp)return null;const d=new Date(c.timestamp);return`${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`}).filter(Boolean)),n=Math.min(b.size*10,35);s+=n,e.contactAttempts&&e.contactAttempts.length>1&&(s+=20);const g=v.reduce((c,d)=>{var y;return c+(((y=d.content)==null?void 0:y.length)||0)},0),u=Math.min(Math.floor(g/50),25);return s+=u,v.some(c=>{var d,y,f;return c.type==="attachment"&&(((d=c.fileName)==null?void 0:d.toLowerCase().includes("brochure"))||((y=c.fileName)==null?void 0:y.toLowerCase().includes("spec"))||((f=c.fileName)==null?void 0:f.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function os(e){let v=0;if(!e.createdAt)return 0;const s=new Date,b=new Date(e.createdAt),n=(s.getTime()-b.getTime())/(1e3*60*60);n<2?v+=25:n<24?v+=15:n<48?v+=5:v-=10;const g=b.getDay(),u=b.getHours();if((g===0||g===6||u<9||u>17)&&(v+=10),e.contactAttempts&&e.contactAttempts.length===3&&(v+=50),e.lastActivity){const c=new Date(e.lastActivity);(s.getTime()-c.getTime())/(1e3*60*60*24)>3&&(v+=20)}return Math.min(Math.max(v,0),25)}function is(e){var s,b,n,g,u,c,d;let v=0;return(s=e.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer.email)&&(v+=10),(b=e.customer)!=null&&b.phone&&/^\+?[\d\s\-()]+$/.test(e.customer.phone)&&e.customer.phone.length>=10&&(v+=10),(n=e.customer)!=null&&n.name&&((g=e.customer)!=null&&g.email)&&((u=e.customer)!=null&&u.phone)&&((c=e.customer)!=null&&c.address)&&(v+=5),(e.isDuplicate||e.isDisqualified||!((d=e.customer)!=null&&d.name))&&(v-=20),v}function Be(e){switch(e){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function Ue(e){switch(e){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function us({typeFilter:e,showTypeFilter:v,tasks:s}){return{filterDefinitions:F(()=>{const n=[];v.value&&n.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),n.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),n.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),e.value==="lead"&&n.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),n.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const g=[...new Set(s.value.map(c=>c.assignee).filter(Boolean))];g.length>0&&n.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:g.map(c=>({value:c,label:c})),aiHint:"Person assigned to the task",pinned:!0});const u=[...new Set(s.value.map(c=>{const d=c.type==="lead"?c.requestedCar:c.vehicle;return d==null?void 0:d.brand}).filter(Boolean))];return u.length>0&&n.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:u.map(c=>({value:c,label:c})),aiHint:"Car brand requested by customer"}),n.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),n})}}const cs={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},ds={class:"page-header shrink-0"},ps={class:"page-header-main"},fs={class:"page-header-content"},gs={class:"page-header-actions"},ys={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},ms={class:"flex-1 overflow-y-auto p-4 md:p-8"},vs={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","toggle-closed","reassign","close","view-change"],setup(e,{emit:v}){const s=e,b=v,n=oe();B("");const g=B({pageIndex:0,pageSize:10}),u=B(""),c=B([]),d=B([]),y=B({}),{filterDefinitions:f}=us({typeFilter:F(()=>"all"),showTypeFilter:F(()=>!0),tasks:F(()=>s.tasks)}),o=F(()=>s.tasks),x=l=>l.compositeId===s.currentTaskId||l.compositeId===s.highlightId,T=l=>{if(l.type==="lead")return l.requestedCar?`${l.requestedCar.brand} ${l.requestedCar.model}`:"No vehicle specified";const a=l.vehicle||l.requestedCar;return a?`${a.brand} ${a.model}`:"No vehicle specified"},S=l=>{if(!l)return"Not set";const a=new Date,k=new Date(l),H=new Date(a.getFullYear(),a.getMonth(),a.getDate()),O=new Date(k.getFullYear(),k.getMonth(),k.getDate())-H,Q=Math.ceil(O/(1e3*60*60*24));return Q===0?"Today":Q===1?"Tomorrow":Q===-1?"Yesterday":Q>1&&Q<=7?`In ${Q} days`:Q<-1&&Q>=-7?`${Math.abs(Q)} days ago`:Me(l)},j=l=>{const a=l.type==="lead"?l.requestedCar:l.vehicle;if(!a)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const k=a.stockDays!==void 0&&a.stockDays!==null;return{status:k?"In Stock":"Out of Stock",class:k?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},r=l=>{var a;return l.type==="lead"?((a=l.requestedCar)==null?void 0:a.requestType)||l.requestType||"N/A":l.requestType||"Opportunity"},i=l=>{const a=l.type==="lead"?l.requestedCar:l.vehicle||l.requestedCar;return a==null?void 0:a.price},w=F(()=>[{id:"type",accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:l=>$(l.original)},cell:({row:l})=>{const a=l.original,k=a.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${k}`},a.type==="lead"?"Lead":"Opportunity")}},{id:"customer",accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:l})=>{const a=l.original;return I("div",{class:"flex items-center gap-2 md:gap-3"},[I("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${a.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},a.customer.initials),I("div",{class:"min-w-0"},[I("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},a.customer.name),I("div",{class:"text-meta truncate hidden sm:block"},a.customer.phone||"N/A")])])}},{id:"carInfo",accessorKey:"carInfo",header:"Car Info",meta:{title:"Car Info"},cell:({row:l})=>{const a=l.original,k=T(a),H=j(a),V=r(a),O=a.type==="lead"?a.requestedCar:a.vehicle||a.requestedCar;if(k==="No vehicle specified")return I("span",{class:"text-meta"},"N/A");const Q=O!=null&&O.condition?O.condition.charAt(0).toUpperCase()+O.condition.slice(1).toLowerCase():null,ne=O!=null&&O.kilometers?`${O.kilometers.toLocaleString()} km`:null,Y=a.quotationNumber||a.quotation||null,W=V&&V!=="N/A"&&(V!=="Quotation"||Y);return I("div",{class:"flex flex-col gap-1"},[I("div",{class:"flex items-center gap-2"},[I("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),I("span",{class:"text-content font-medium text-heading truncate max-w-32"},k)]),I("div",{class:"flex items-center gap-2 flex-wrap"},[I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${H.class}`},H.status),Q&&I("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-blue-50 text-blue-700"},Q),ne&&I("span",{class:"text-meta text-xs"},ne),W&&I("span",{class:"text-meta text-xs"},V)])])}},{id:"dueDate",accessorKey:"nextActionDue",header:"Due Date",meta:{title:"Due Date"},cell:({row:l})=>{const k=l.original.nextActionDue;if(!k)return I("span",{class:"text-meta"},"Not set");const H=ye(k);return I("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${H.bgClass} ${H.textClass} ${H.borderClass}`},S(k))}},{id:"price",accessorKey:"price",accessorFn:l=>i(l)??0,header:"Price",meta:{title:"Price"},cell:({row:l})=>{const a=l.original,k=i(a);return k==null||k===""?I("span",{class:"text-meta"},"â€”"):I("span",{class:"text-content font-medium text-heading"},`â‚¬ ${dt(k)}`)}},{id:"source",accessorKey:"source",header:"Lead Source",meta:{title:"Lead Source"},cell:({row:l})=>{const a=l.original;return I("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},a.source||"N/A")}},{id:"contactAttempts",accessorKey:"contactAttempts",header:"Contact Attempts",meta:{title:"Contact Attempts"},cell:({row:l})=>{var H;const k=((H=l.original.contactAttempts)==null?void 0:H.length)||0;return I("span",{class:"text-content font-medium text-heading"},k)}},{id:"assignee",accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:l})=>{const a=l.original,k=s.getOwnerInfo(a);return I("div",{class:"flex items-center gap-2"},[I("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},k.initials),I("span",{class:"text-meta truncate max-w-20"},k.name)])}},{id:"createdAt",accessorKey:"createdAt",header:"Creation Date",meta:{title:"Creation Date"},cell:({row:l})=>{const a=l.original;return a.createdAt?I("span",{class:"text-meta"},pt(a.createdAt)):I("span",{class:"text-meta"},"N/A")}},{id:"status",accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:l})=>{const a=l.original,k=a.type==="lead"?a.status:a.displayStage||a.stage,H=s.getStageBadgeClass(k);return I("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${H}`},k)}},...n.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:l})=>{const a=l.original;if(a.type!=="lead")return I("span",{class:"text-meta"},"â€”");let k=a.urgencyLevel;k||(k=qe(a).level);const H=Ue(k),V=Be(k);return I("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${H}`},[I("span",{},V),I("span",{},k)])}}]:[]]),$=l=>{u.value=String(l.id),b("select",l.compositeId)},K=F(()=>({class:{tr:l=>{const a="cursor-pointer hover:bg-surfaceSecondary transition-colors",k=l.original;return x(k)?`${a} bg-blue-50 border-l-4 border-l-blue-500`:a}}}));return(l,a)=>(C(),A("div",cs,[p("header",ds,[p("div",ps,[p("div",fs,[a[9]||(a[9]=p("div",{class:"page-header-title-container"},[p("h1",{class:"page-header-title"},"Tasks")],-1)),p("div",gs,[p("div",ys,[z(M(re),{variant:"secondary",size:"icon",onClick:a[0]||(a[0]=k=>l.$emit("view-change","card")),class:P(["h-7 w-7",e.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View","aria-pressed":e.viewMode==="card"},{default:E(()=>[z(M(Fe),{size:14})]),_:1},8,["class","aria-pressed"]),z(M(re),{variant:"secondary",size:"icon",onClick:a[1]||(a[1]=k=>l.$emit("view-change","table")),class:P(["h-7 w-7",e.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View","aria-pressed":e.viewMode==="table"},{default:E(()=>[z(M(Oe),{size:14})]),_:1},8,["class","aria-pressed"])]),p("button",{onClick:a[2]||(a[2]=k=>l.$emit("toggle-closed",!e.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...a[8]||(a[8]=[p("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),p("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),p("div",ms,[z(M(gt),{data:o.value,columns:w.value,meta:K.value,onRowClick:$,columnFiltersOptions:{filterDefs:M(f)},pagination:g.value,"onUpdate:pagination":a[3]||(a[3]=k=>g.value=k),globalFilter:u.value,"onUpdate:globalFilter":a[4]||(a[4]=k=>u.value=k),sorting:c.value,"onUpdate:sorting":a[5]||(a[5]=k=>c.value=k),columnFilters:d.value,"onUpdate:columnFilters":a[6]||(a[6]=k=>d.value=k),columnVisibility:y.value,"onUpdate:columnVisibility":a[7]||(a[7]=k=>y.value=k),paginationOptions:{rowCount:o.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question",show:!1},class:"h-full"},{"empty-state":E(()=>[...a[10]||(a[10]=[p("div",{class:"empty-state"},[p("i",{class:"fa-solid fa-tasks empty-state-icon"}),p("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","columnVisibility","paginationOptions"])])]))}},hs=ge(vs,[["__scopeId","data-v-29cab866"]]),bs={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},xs={class:"px-4 py-3 flex items-center justify-between gap-3"},ws=["aria-label"],ks={key:0,class:"flex-1 flex items-center justify-center"},Cs={key:1,class:"flex items-center gap-2"},Ss={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(e,{emit:v}){const s=v,b=()=>{s("back")};return(n,g)=>e.show?(C(),A("div",bs,[p("div",xs,[p("button",{onClick:b,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":e.backLabel},[...g[0]||(g[0]=[p("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,ws),n.$slots.title?(C(),A("div",ks,[ee(n.$slots,"title")])):N("",!0),n.$slots.actions?(C(),A("div",Cs,[ee(n.$slots,"actions")])):N("",!0)])])):N("",!0)}};function $s(){const e=f=>{if(!f)return"No deadline";const o=ye(f);return o.type==="overdue"?"OVERDUE":o.type==="today"||o.type==="urgent"?o.relativeTime:Me(f)},v=f=>{const o=f.type==="lead"?f.requestedCar:f.vehicle;return!o||!o.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[o.type]||{type:o.type.toLowerCase(),label:o.type}},s=f=>f?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[f.type]||"bg-gray-50 text-gray-700":"",b=f=>{if(!f||!f.assignee)return{name:"Unassigned",initials:"?"};const o=f.assigneeInitials||f.assignee.split(" ").map(x=>x[0]).join("");return{name:f.assignee,initials:o}},n=f=>{if(!f||!f.customer||!f.customer.address)return null;const x=f.customer.address.split(",");return x.length>1&&x[x.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:e,getVehicleType:v,getVehicleTypeBadgeClass:s,getOwnerInfo:b,getCustomerCity:n,getLocationDisplay:f=>{const o=n(f),x=f.source||"Unknown";return o?`${o} â€¢ ${x}`:x},getAssigneeInitials:f=>{if(!f)return"?";const o=f.split(" ");return o.length>=2?(o[0][0]+o[o.length-1][0]).toUpperCase():f.substring(0,2).toUpperCase()},getVehicleStatusDisplay:f=>{const o=f.type==="lead"?f.requestedCar:f.vehicle;if(!o)return"No vehicle";const x=v(f),T=x?x.label:o.type||"Unknown";let S="";return o.kilometers!==void 0&&o.kilometers!==null&&(o.kilometers>=1e3?S=`${(o.kilometers/1e3).toFixed(0)}k`:S=`${o.kilometers}`),S?`${T} / ${S}`:T},getTaskStatusDisplay:f=>f.type==="lead"?f.status||"Unknown":f.stage||"Unknown",getStageBadgeClass:Ne,getUnselectedClass:f=>f.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function As(){const e=Ie(),v=Le(),s=oe();return{sortTasks:(n,g)=>{if(!g||g===""||g==="none")return n;if(g==="recent-first")return[...n].sort((u,c)=>{const d=new Date(u.lastActivity||u.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-d});if(g==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...n.map(d=>{if(d.type==="lead"&&!d.urgencyScore){const y=qe(d);return{...d,urgencyScore:y.score,urgencyLevel:y.level}}return d})].sort((d,y)=>{if(d.type==="lead"&&y.type==="lead"){const x=d.urgencyScore||0,T=y.urgencyScore||0;if(x!==T)return T-x;const S=new Date(d.createdAt||0);return new Date(y.createdAt||0)-S}if(d.type==="lead"&&y.type==="opportunity")return-1;if(d.type==="opportunity"&&y.type==="lead")return 1;if(d.priority==="Hot"&&y.priority!=="Hot")return-1;if(d.priority!=="Hot"&&y.priority==="Hot")return 1;const f=new Date(d.lastActivity||d.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-f}):[...n].sort((c,d)=>{if(c.priority==="Hot"&&d.priority!=="Hot")return-1;if(c.priority!=="Hot"&&d.priority==="Hot")return 1;const y=new Date(c.lastActivity||c.createdAt||0);return new Date(d.lastActivity||d.createdAt||0)-y});if(g==="assigned-to-me"){const u=e.currentUser.name;return[...n.filter(d=>d.assignee===u)].sort((d,y)=>{const f=new Date(d.lastActivity||d.createdAt||0);return new Date(y.lastActivity||y.createdAt||0)-f})}if(g==="assigned-to-my-team"){const u=e.currentUser;let c=[];return u.role==="manager"?c=v.users.map(y=>y.name):u.role==="salesman"?c=v.users.filter(y=>y.role==="salesman").map(y=>y.name):u.role==="operator"&&(c=v.users.filter(y=>y.role==="operator").map(y=>y.name)),[...n.filter(y=>c.includes(y.assignee))].sort((y,f)=>{const o=new Date(y.lastActivity||y.createdAt||0);return new Date(f.lastActivity||f.createdAt||0)-o})}return n}}}const Ts={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},Ds={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Is={key:0,class:"flex items-center gap-2"},Ls={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Ms={class:"text-gray-600 font-medium"},Ns={key:1},Fs={key:0},Os={key:1},qs={key:2},Bs={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Us={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Rs={__name:"Tasks",setup(e){const v=nt(),s=rt(),b=st(),n=ot(),g=Ie();Le();const u=oe(),{getDateDisplay:c,getVehicleType:d,getVehicleTypeBadgeClass:y,getOwnerInfo:f,getCustomerCity:o,getAssigneeInitials:x,getUnselectedClass:T}=$s(),S=B(localStorage.getItem("tasksViewMode")||"table"),j=B(""),r=F(()=>v.query.highlight||null);se(S,t=>{localStorage.setItem("tasksViewMode",t)});const i=(t,h="")=>{S.value;const D=W.value;if(S.value=t,t==="card"&&h&&(j.value=h),t==="table"&&D)j.value="",s.push({path:"/tasks",query:{highlight:D.compositeId}});else if(t==="card"&&r.value){const[U,m]=r.value.split("-");s.push({path:`/tasks/${m}`,query:{type:U}})}else t==="card"&&!r.value&&!W.value&&s.push({path:"/tasks"})},w=B([]),$=B(""),K=B(!1),l=B(null);B(!1);const a=B(!1),k=B(null),H=B(!1),V=B(null),{allTasks:O,applyFilters:Q}=yt(K),{sortTasks:ne}=As(),Y=F(()=>{let t=Q(O.value,w.value);return t=ne(t,$.value),t}),W=F(()=>{if(!v.params.id)return null;const t=parseInt(v.params.id);if(isNaN(t))return null;const h=v.query.type;if(h){const q=`${h}-${t}`;return O.value.find(te=>te.compositeId===q)||null}const D=w.value.filter(q=>q==="lead"||q==="opportunity"),U=D.length>0?O.value.filter(q=>D.includes(q.type)):O.value,m=`lead-${t}`,L=`opportunity-${t}`,G=U.find(q=>q.compositeId===m||q.compositeId===L);return G||O.value.find(q=>q.compositeId===m||q.compositeId===L)||null});F(()=>W.value?W.value.type==="lead"?b.currentLeadActivities:n.currentOpportunityActivities:[]);const ie=Ce(W),Re=ie.managementWidget,He=ie.storeAdapter,Ve=ie.addNewConfig,We=F(()=>V.value),ue=Ce(We),me=F(()=>ue.managementWidget.value),ve=F(()=>ue.storeAdapter.value),ze=F(()=>ue.addNewConfig.value),Ee=T;at(()=>{b.fetchLeads(),n.fetchOpportunities();const t=v.params.id;t&&he(t)}),se(()=>v.params.id,t=>{t&&he(t)}),se(W,t=>{t&&(t.type==="lead"?b.fetchLeadById(t.id):n.fetchOpportunityById(t.id))},{immediate:!0}),se(V,t=>{t&&(t.type==="lead"?b.fetchLeadById(t.id):n.fetchOpportunityById(t.id))},{immediate:!0});const he=t=>{const h=parseInt(t),D=O.value.find(U=>U.id===h);D&&(D.type==="lead"?b.fetchLeadById(h):n.fetchOpportunityById(h))},_=t=>{const[h,D]=t.split("-");if(S.value==="table"){const U=O.value.find(m=>m.compositeId===t);U&&(V.value=U,H.value=!0,U.type==="lead"?b.fetchLeadById(U.id):n.fetchOpportunityById(U.id));return}S.value="card",s.push({path:`/tasks/${D}`,query:{type:h}})},ce=()=>{if(H.value){de();return}s.push({path:"/tasks"})},de=()=>{H.value=!1,V.value=null},je=t=>{if(!W.value)return;const h=Y.value.findIndex(D=>{const U=W.value.compositeId||`${W.value.type}-${W.value.id}`;return(D.compositeId||`${D.type}-${D.id}`)===U});if(h!==-1){if(t==="previous"&&h>0){const D=Y.value[h-1];_(D.compositeId)}else if(t==="next"&&h<Y.value.length-1){const D=Y.value[h+1];_(D.compositeId)}}},Pe=t=>{if(!V.value)return;const h=Y.value.findIndex(D=>{const U=V.value.compositeId||`${V.value.type}-${V.value.id}`;return(D.compositeId||`${D.type}-${D.id}`)===U});if(h!==-1){if(t==="previous"&&h>0){const D=Y.value[h-1];_(D.compositeId)}else if(t==="next"&&h<Y.value.length-1){const D=Y.value[h+1];_(D.compositeId)}}},be=t=>{l.value=l.value===t?null:t},xe=t=>{k.value=t,a.value=!0,l.value=null},Qe=t=>{$.value=t},Ke=async t=>{if(!k.value)return;const h=k.value,D=t.name;h.type==="lead"?await b.updateLead(h.id,{assignee:D,assigneeType:t.type,teamId:t.type==="team"?t.id:null}):h.type==="opportunity"&&await n.updateOpportunity(h.id,{assignee:D,assigneeType:t.type,teamId:t.type==="team"?t.id:null}),a.value=!1,k.value=null},Ye=async t=>{l.value=null,t.type==="lead"?await b.updateLead(t.id,{priority:"Hot"}):t.type==="opportunity"&&await n.updateOpportunity(t.id,{priority:"Hot"})},Ge=async t=>{l.value=null,t.type==="lead"?await b.updateLead(t.id,{priority:"Normal"}):t.type==="opportunity"&&await n.updateOpportunity(t.id,{priority:"Normal"})},Je=async t=>{l.value=null;const h=g.user;h&&(t.type==="lead"?await b.updateLead(t.id,{assignee:h.name,assigneeType:"user"}):t.type==="opportunity"&&await n.updateOpportunity(t.id,{assignee:h.name,assigneeType:"user"}))},Xe=async t=>{if(l.value=null,t.type==="lead")try{const h=t.displayStage||t.stage||ke.NEW,D=ke.NEW,U=ft(h,D);if(U){const{updates:m,activities:L}=U(t);await b.updateLead(t.id,m);for(const G of L)await b.addActivity(t.id,G)}else await b.updateLead(t.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await b.addActivity(t.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await b.fetchLeadById(t.id)}catch(h){console.error("Failed to reopen lead:",h)}},Ze=t=>{var D;const h=[];return t.type==="lead"&&t.isDisqualified===!0&&h.push({key:"reopen",label:"Reopen Lead",onClick:()=>Xe(t)}),h.push({key:"reassign",label:"Reassign",onClick:()=>xe(t)}),t.assignee!==((D=g.user)==null?void 0:D.name)&&h.push({key:"assign-me",label:"Assign to me",onClick:()=>Je(t)}),t.priority!=="Hot"?h.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Ye(t)}):h.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Ge(t)}),h};return(t,h)=>{var D,U;return C(),A("div",Ts,[z(Ss,{show:!!W.value||S.value==="table"&&!!V.value,"back-label":"Back to task list",onBack:ce},null,8,["show"]),S.value==="card"?(C(),A("div",Ds,[p("div",{class:P(["flex flex-col overflow-hidden",W.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[z(as,{title:"Tasks",items:Y.value,"selected-id":(D=W.value)==null?void 0:D.compositeId,"view-mode":S.value,"initial-search-query":j.value,onViewChange:i,"selected-class":m=>m.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":M(Ee),"open-menu-id":l.value,getName:m=>{const L=m.customer;return L&&L.name?L.name:L&&!L.name&&L.email&&L.email.split("@")[0]||"Unknown"},getInitials:m=>{const L=m.customer;return L&&L.initials?L.initials:L&&L.name&&L.name.split(" ").map(q=>q[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:m=>{if(m.type==="lead"){if(!m.requestedCar)return"No vehicle specified";const q=m.requestedCar,te=[`${q.brand} ${q.model}`];return q.kilometers!==void 0&&q.kilometers!==null&&te.push(`${q.kilometers} km`),q.status&&te.push(q.status),te.join(" â€¢ ")}const L=m.vehicle||m.requestedCar;if(!L)return"No vehicle specified";const G=[`${L.brand} ${L.model}`];return L.kilometers!==void 0&&L.kilometers!==null&&G.push(`${L.kilometers} km`),L.status&&G.push(L.status),G.join(" â€¢ ")},avatarClass:m=>m.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":Ze,"show-mobile-close":!1,onSelect:_,onMenuClick:be,onMenuClose:h[0]||(h[0]=m=>l.value=null),onClose:ce,"active-filters":w.value,onFilterChange:h[1]||(h[1]=m=>w.value=m),onSortChange:Qe},{badges:E(({item:m})=>[m&&m.type?(C(),Z(M(pe),{key:0,text:m.type==="lead"?"Lead":"Opportunity",size:"small",theme:m.type==="lead"?"blue":"gray"},null,8,["text","theme"])):N("",!0),m&&m.type==="lead"&&M(u).getSetting("urgencyEnabled")!==!1&&m.urgencyLevel?(C(),Z(M(pe),{key:1,text:`${M(Be)(m.urgencyLevel)} ${m.urgencyLevel}`,size:"small",class:P(M(Ue)(m.urgencyLevel))},null,8,["text","class"])):N("",!0),m&&m.priority==="Hot"&&(M(u).getSetting("urgencyEnabled")===!1||m.type!=="lead")?(C(),Z(M(pe),{key:2,text:"HOT",size:"small",theme:"red"})):N("",!0)]),location:E(({item:m})=>[fe(R(M(o)(m)||"Unknown"),1)]),source:E(({item:m})=>{var L;return[fe(R(m.source||((L=m.customer)==null?void 0:L.source)||"Unknown"),1)]}),owner:E(({item:m})=>[m.assignee?(C(),A("div",Is,[p("div",Ls,R(M(x)(m.assignee)),1),p("span",Ms,R(m.assignee),1)])):(C(),A("span",Ns,"Unassigned"))]),dates:E(({item:m})=>[m.type==="lead"&&m.nextActionDue?(C(),A("span",Fs,"Due: "+R(M(c)(m.nextActionDue)),1)):m.type==="opportunity"&&m.nextActionDue?(C(),A("span",Os,"Due: "+R(M(c)(m.nextActionDue)),1)):(C(),A("span",qs,"Due: No deadline"))]),_:1},8,["items","selected-id","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","active-filters"])],2),W.value?(C(),Z(Se,{key:0,task:W.value,"management-widget":M(Re),"store-adapter":M(He),"add-new-config":M(Ve),"filtered-tasks":Y.value,onTaskNavigate:je},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0),W.value?N("",!0):(C(),A("div",Bs,[...h[5]||(h[5]=[lt('<div class="flex-1 flex items-center justify-center p-8" data-v-a38c0ec8><div class="text-center max-w-sm" data-v-a38c0ec8><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-a38c0ec8><i class="fa-solid fa-tasks text-2xl text-sub" data-v-a38c0ec8></i></div><h3 class="text-content-bold mb-2" data-v-a38c0ec8>No task selected</h3><p class="text-meta" data-v-a38c0ec8>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):N("",!0),S.value==="table"?(C(),A("div",Us,[z(hs,{tasks:M(O),"current-task-id":(U=V.value)==null?void 0:U.compositeId,"highlight-id":r.value,"show-closed":K.value,"show-mobile-close":!1,"open-menu-id":l.value,"get-vehicle-type":M(d),"get-vehicle-type-badge-class":M(y),"get-owner-info":M(f),"get-stage-badge-class":M(Ne),"view-mode":S.value,onSelect:_,onMenuClick:be,onMenuClose:h[2]||(h[2]=m=>l.value=null),onToggleClosed:h[3]||(h[3]=m=>K.value=m),onReassign:xe,onClose:ce,onViewChange:i,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):N("",!0),S.value==="table"?(C(),Z(mt,{key:2,show:H.value,onClose:de},{default:E(()=>[V.value&&me.value&&ve.value?(C(),Z(Se,{key:0,task:V.value,"management-widget":me.value,"store-adapter":ve.value,"add-new-config":ze.value,"filtered-tasks":M(O),"is-drawer-view":!0,onTaskNavigate:Pe,onClose:de},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):N("",!0)]),_:1},8,["show"])):N("",!0),z(vt,{show:a.value,onClose:h[4]||(h[4]=m=>a.value=!1),onConfirm:Ke},null,8,["show"])])}}},Xs=ge(Rs,[["__scopeId","data-v-a38c0ec8"]]);export{Xs as default};
