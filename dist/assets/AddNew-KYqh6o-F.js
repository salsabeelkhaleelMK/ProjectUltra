import{x as _,r as y,d as b,l as d,e as w,h as C,o as O}from"./index-CNXtwH7T.js";import{u as S}from"./contacts-D-QIkj5Z.js";import{u as k}from"./opportunities-BLSgwgft.js";import{P as q}from"./PageHeader-8J4ZZyG7.js";import{_ as A}from"./UnifiedAddForm-CsrmPm1J.js";import"./index-X4R71uMA.js";const N={class:"page-container"},L={class:"p-4 md:p-8"},P={__name:"AddNew",setup(R){const o=C(),n=S(),p=_(),u=k(),i=y(null),m=async c=>{try{const{contactMode:a,selectedContact:h,contactData:l,vehicleData:e,markAsLead:f,markAsOpportunity:g}=c;let t=h;if(a==="new"&&(t=await n.addContact({...l,initials:l.name.split(" ").map(s=>s[0]).join("").toUpperCase(),source:"Direct",tags:[]})),f){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},status:"Open",stage:"Open Lead",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:"",isDisqualified:!1,disqualifyReason:null,scheduledAppointment:null,contactAttempts:[]};e&&Object.keys(e).length>0&&(s.requestedCar=e);const r=await p.createLead(s);o.push({path:"/customers",query:{tab:"open-leads",highlight:`lead-${r.id}`}})}else if(g){const s={customer:{id:t.id,name:t.name,initials:t.initials,email:t.email,phone:t.phone,address:t.address||""},stage:"Qualified",priority:"Normal",source:(e==null?void 0:e.source)||"Direct",assignee:null,assigneeInitials:""};e&&Object.keys(e).length>0&&(s.vehicle=e);const r=await u.createOpportunity(s);o.push({path:"/customers",query:{tab:"open-opportunities",highlight:`opp-${r.id}`}})}else e&&Object.keys(e).length>0&&await n.addRequestedCarToContact(t.id,e),o.push({path:"/customers",query:{tab:"contacts",highlight:`contact-${t.id}`}})}catch(a){console.error("Error saving data:",a),alert("Failed to save. Please try again."),i.value&&i.value.resetSubmitting()}};return(c,a)=>(O(),b("div",N,[d(q,{title:"Add New Customer",subtitle:"Create contacts, leads, or opportunities"}),w("div",L,[d(A,{ref_key:"formRef",ref:i,onSubmit:m},null,512)])]))}};export{P as default};
