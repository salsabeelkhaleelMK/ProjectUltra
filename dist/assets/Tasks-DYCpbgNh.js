const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/opportunities-D5y9S6Q1.js","assets/index-BZwEnuDT.js","assets/index-NhVoF2vJ.css"])))=>i.map(i=>d[i]);
import{E as ve,G as Ft,H as Ps,c as D,I as ts,r as T,J as Bt,d as b,o as d,g as q,p as te,e,w as gt,x as Q,y as n,P as Vt,t as I,n as j,_ as ze,s as w,D as O,T as Dt,l as Ee,K as xe,F as ye,i as we,L as De,M as Ge,N as pe,O as bt,j as vt,k as P,R as ht,q as Nt,U as _s,S as Qs,V as Ys,W as Gs,X as $t,h as Rt,C as ct,u as pt,Y as rt,Z as Ke,v as ut,Q as Z,$ as Js,a0 as Ks,a1 as dt,a2 as Pe,a3 as Zs,z as At,m as jt,a4 as Xs}from"./index-BZwEnuDT.js";import{a as Tt}from"./opportunities-D5y9S6Q1.js";import{u as It}from"./users-Bg_sNy2B.js";import{g as Ut,f as zt,a as mt,b as ft,c as ss,d as ns}from"./formatters-B1RFjlNy.js";import{L as Yt,O as Gt,_ as en,E as tn,T as sn,i as nn,g as an,a as ln,s as on,b as rn,c as dn,d as un,e as Lt,f as cn,h as pn,j as mn,u as fn,k as yn,P as gn,l as vn,m as bn,n as hn,o as xn,p as wn,q as kn,r as Cn,t as Sn}from"./ComingSoonModal-CNc1QEAZ.js";import{y as $n}from"./components-BBuk30SU.js";import{n as Ye,V as An,R as Dn,z as Tn,a as Ze,F as Xe,L as et,H as tt,j as st,C as nt,W as at,K as qt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-D2e1bD8Q.js";import{_ as as}from"./ReassignUserModal-X-LKnpVU.js";import{f as ls}from"./vehicles-RXA5rnNk.js";import{_ as In}from"./CreateEventModal-Bcr752dX.js";import{_ as qn,a as On}from"./EditEventModal-C_kx5dW6.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=ve("CarIcon",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=ve("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=ve("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=ve("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=ve("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=ve("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=ve("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=ve("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=ve("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ve("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=ve("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=ve("PaperclipIcon",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=ve("PhoneOffIcon",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=ve("PhoneIcon",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=ve("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=ve("StickyNoteIcon",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=ve("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=ve("TagIcon",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=ve("ThumbsDownIcon",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);function zn(t){if(!t)return"Action Required";if(t.title)return t.title;const m=t.type||(t.customer?"opportunity":"lead"),s=Ft(t,m);if(m==="lead"){const a=(Yt[s]||Yt.New).primaryAction;if(a){const o=typeof a=="function"?a({lead:t,displayStage:s}):a;return o.label||o.title||"Follow up"}}if(m==="opportunity"){const a=(Gt[s]||Gt.Qualified).primaryAction;if(a){const o=typeof a=="function"?a({deliverySubstatus:t.deliverySubstatus||Ps(t,t.activities||[]),hasOffers:!!(t.offers&&t.offers.length>0)||!!(t.activities&&t.activities.some(l=>l.type==="offer")),scheduledAppointment:t.scheduledAppointment,formatDateTime:l=>new Date(l).toLocaleDateString()}):a;return o.label||o.title||"Update Opportunity"}}return"Action Required"}const Wn={key:1,class:"absolute right-2 top-7 z-50"},Hn={class:"flex flex-col min-w-0 pr-4"},Pn={class:"font-bold text-heading text-fluid-base truncate mb-0.5"},_n={class:"flex items-center gap-2 overflow-hidden"},Qn={class:"text-sub text-fluid-sm truncate"},Yn={class:"flex flex-wrap gap-2 mt-2"},Gn={key:1,class:"px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-50 text-red-700 border border-red-200 leading-none"},Jn={key:2,class:"shrink-0 ml-auto self-start mt-1"},Kn={__name:"TaskCard",props:{item:{type:Object,required:!0},selected:{type:Boolean,default:!1},selectedClass:{type:[String,Function],default:"bg-white border-2 border-blue-500 shadow-md"},unselectedClass:{type:[String,Function],default:"bg-white border border-gray-200 hover:border-gray-300"},showMenu:{type:Boolean,default:!0},openMenuId:{type:[Number,String],default:null},getName:{type:Function,required:!0},getVehicleInfo:{type:Function,default:null},menuItems:{type:Array,default:null}},emits:["select","menu-click","menu-close"],setup(t,{emit:m}){const s=t,r=D(()=>s.item.compositeId||`${s.item.type||"task"}-${s.item.id}`||s.item.id),a=D(()=>s.selected),o=D(()=>a.value?typeof s.selectedClass=="function"?s.selectedClass(s.item):s.selectedClass:typeof s.unselectedClass=="function"?s.unselectedClass(s.item):s.unselectedClass),l=D(()=>{const c=s.item.displayStage||s.item.stage;return c?ts(c,s.item.type||"opportunity"):"bg-gray-100 text-gray-700"}),i=D(()=>zn(s.item)),u=D(()=>{const c=s.item.nextActionDue||s.item.dueDate;if(!c)return null;const p=Ut(c);return{text:zt(c),status:p}}),f=T(null);return(c,p)=>{const g=Bt("click-outside");return d(),b("div",{ref_key:"cardRef",ref:f,onClick:p[1]||(p[1]=k=>c.$emit("select",r.value)),class:j(["bg-white rounded-xl p-4 flex items-center justify-between hover:shadow-mk-dashboard-card cursor-pointer relative transition-all border group",o.value])},[t.showMenu?(d(),b("button",{key:0,onClick:p[0]||(p[0]=gt(k=>c.$emit("menu-click",t.item.id),["stop"])),class:"absolute top-2 right-2 pr-1 text-gray-300 hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity z-10"},[...p[2]||(p[2]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)])])):q("",!0),t.openMenuId===t.item.id&&t.showMenu?te((d(),b("div",Wn,[t.menuItems&&t.menuItems.length>0?(d(),Q(n(Vt),{key:0,items:t.menuItems,className:"w-40 text-xs"},null,8,["items"])):q("",!0)])),[[g,()=>c.$emit("menu-close")]]):q("",!0),e("div",Hn,[e("h3",Pn,I(i.value),1),e("div",_n,[e("span",Qn,I(t.getName(t.item)),1)]),e("div",Yn,[e("span",{class:j(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",t.item.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},I(t.item.type==="lead"?"Lead":"Opportunity"),3),t.item.displayStage||t.item.stage?(d(),b("span",{key:0,class:j(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase border leading-none",l.value])},I(t.item.displayStage||t.item.stage),3)):q("",!0),t.item.priority==="Hot"?(d(),b("span",Gn," Hot ")):q("",!0)])]),u.value?(d(),b("div",Jn,[e("span",{class:j(["px-3 py-1 rounded-lg text-[11px] font-bold border whitespace-nowrap",[u.value.status.bgClass,u.value.status.textClass,u.value.status.borderClass]])},I(u.value.text),3)])):q("",!0)],2)}}},Zn={class:"flex items-center gap-2"},Xn={key:0,class:"flex gap-2"},ea={class:"relative ml-auto",ref:"sortContainer"},ta={key:0,class:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white bg-brand-dark"},sa={key:0,class:"absolute right-0 mt-2 z-50 sort-dropdown-wrapper"},na={__name:"TaskFilters",props:{typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1}},emits:["filter-change","sort-change","toggle-closed"],setup(t,{emit:m}){const s=t,r=m,a=T(!1),o=()=>{a.value=!a.value},l=u=>{a.value=!1,r("sort-change",u)},i=D(()=>[{key:"recent-first",label:"Most Recent First",onClick:()=>l("recent-first")},...s.typeFilter==="lead"?[{key:"urgent-first",label:"Urgent first",onClick:()=>l("urgent-first")}]:[],{key:"assigned-to-me",label:"Assigned to me",onClick:()=>l("assigned-to-me")},{key:"assigned-to-my-team",label:"Assigned to my team",onClick:()=>l("assigned-to-my-team")}].map(f=>({...f,className:f.key===s.sortOption?"sort-item-selected":""})));return(u,f)=>{const c=Bt("click-outside");return d(),b("div",Zn,[t.showTypeFilter?(d(),b("div",Xn,[e("button",{onClick:f[0]||(f[0]=p=>u.$emit("filter-change","all")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="all"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," All ",2),e("button",{onClick:f[1]||(f[1]=p=>u.$emit("filter-change","lead")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="lead"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Leads ",2),e("button",{onClick:f[2]||(f[2]=p=>u.$emit("filter-change","opportunity")),class:j(["text-xs font-medium px-3 py-1.5 rounded-md border transition-colors",t.typeFilter==="opportunity"?"bg-surfaceSecondary text-brand-dark border-brand-dark":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700"])}," Opportunities ",2)])):q("",!0),e("div",ea,[e("button",{onClick:gt(o,["stop"]),class:"relative w-8 h-8 flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50 transition-colors text-gray-600 hover:text-gray-900"},[f[3]||(f[3]=e("i",{class:"fa-solid fa-arrow-down-wide-short text-sm"},null,-1)),t.sortOption&&t.sortOption!=="recent-first"?(d(),b("span",ta)):q("",!0)]),w(Dt,{name:"dropdown"},{default:O(()=>[a.value?te((d(),b("div",sa,[w(n(Vt),{items:i.value,className:"w-56"},null,8,["items"])])),[[c,()=>a.value=!1]]):q("",!0)]),_:1})],512)])}}},aa=ze(na,[["__scopeId","data-v-dba5cff9"]]),la={class:"tasks-list-container border-r border-black/5 flex flex-col shrink-0 w-full lg:w-80 h-full"},oa={class:"page-header shrink-0"},ia={class:"page-header-main"},ra={class:"page-header-content"},da={class:"page-header-title-container"},ua={class:"page-header-title"},ca={class:"page-header-actions"},pa={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},ma={class:"px-5 py-3"},fa={class:"relative"},ya=["placeholder"],ga={key:0,class:"px-5 pb-3"},va={__name:"TasksList",props:{title:{type:String,default:"Tasks"},items:{type:Array,default:()=>[]},selectedId:{type:[String,Number],default:null},typeFilter:{type:String,default:"all"},initialSearchQuery:{type:String,default:""},selectedClass:{type:[String,Function],default:""},unselectedClass:{type:[String,Function],default:""},openMenuId:{type:[String,Number],default:null},getName:{type:Function,default:t=>t.name||"Unknown"},getVehicleInfo:{type:Function,default:()=>"No vehicle specified"},getMenuItems:{type:Function,default:null},showMenu:{type:Boolean,default:!0},showTypeFilter:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"card"}},emits:["select","menu-click","menu-close","filter-change","sort-change","close","view-change"],setup(t,{emit:m}){const s=t,r=m,a=T(s.initialSearchQuery),o=T(null),l=T("recent-first");Ee(()=>s.initialSearchQuery,c=>{a.value=c});const i=D(()=>{if(!a.value.trim())return s.items;const c=a.value.toLowerCase().trim();return s.items.filter(p=>{const g=s.getName(p).toLowerCase(),k=s.getVehicleInfo(p).toLowerCase();return g.includes(c)||k.includes(c)})}),u=c=>s.selectedId?(c.compositeId||`${c.type||"task"}-${c.id}`)===s.selectedId:!1,f=c=>{l.value=c,r("sort-change",c)};return(c,p)=>(d(),b("div",la,[e("header",oa,[e("div",ia,[e("div",ra,[e("div",da,[e("h1",ua,I(t.title),1)]),e("div",ca,[e("div",pa,[e("button",{onClick:p[0]||(p[0]=g=>c.$emit("view-change","table")),class:j(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[w(n(us),{size:14})],2),e("button",{onClick:p[1]||(p[1]=g=>c.$emit("view-change","card")),class:j(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[w(n(rs),{size:14})],2)])])])])]),e("div",ma,[e("div",fa,[p[7]||(p[7]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-fluid-sm"},null,-1)),te(e("input",{"onUpdate:modelValue":p[2]||(p[2]=g=>a.value=g),type:"text",placeholder:t.searchPlaceholder,class:"w-full bg-white border border-black/5 rounded-btn pl-9 pr-3 py-2 text-fluid-sm"},null,8,ya),[[xe,a.value]])])]),t.showTypeFilter?(d(),b("div",ga,[w(aa,{"type-filter":t.typeFilter,"sort-option":l.value,"show-type-filter":!0,onFilterChange:p[3]||(p[3]=g=>c.$emit("filter-change",g)),onSortChange:f},null,8,["type-filter","sort-option"])])):q("",!0),e("div",{ref_key:"scrollContainer",ref:o,class:"flex-1 overflow-y-auto px-5 space-y-3 pt-4 pb-6 scrollbar-hide"},[(d(!0),b(ye,null,we(i.value,g=>(d(),Q(Kn,{key:g.compositeId||`${g.type||"task"}-${g.id}`,item:g,selected:u(g),"selected-class":t.selectedClass,"unselected-class":t.unselectedClass,"show-menu":t.showMenu,"open-menu-id":t.openMenuId,getName:t.getName,getVehicleInfo:t.getVehicleInfo,"menu-items":t.getMenuItems?t.getMenuItems(g):null,onSelect:p[4]||(p[4]=k=>c.$emit("select",k)),onMenuClick:p[5]||(p[5]=k=>c.$emit("menu-click",k)),onMenuClose:p[6]||(p[6]=k=>c.$emit("menu-close"))},{location:O(({item:k})=>[De(c.$slots,"location",{item:k},void 0,!0)]),source:O(({item:k})=>[De(c.$slots,"source",{item:k},void 0,!0)]),owner:O(({item:k})=>[De(c.$slots,"owner",{item:k},void 0,!0)]),dates:O(({item:k})=>[De(c.$slots,"dates",{item:k},void 0,!0)]),_:2},1032,["item","selected","selected-class","unselected-class","show-menu","open-menu-id","getName","getVehicleInfo","menu-items"]))),128))],512)]))}},ba=ze(va,[["__scopeId","data-v-659cd328"]]);function cs(t,m=[],s,r){const a=Ge(),o=a.getSetting("urgencyWeights")||{intent:40,behavioral:35,temporal:25},l=a.getSetting("urgencyThresholds")||{hot:80,warm:50,standard:20},i=ha(t,m),u=xa(t,m),f=wa(t),c=ka(t),p=o.intent+o.behavioral+o.temporal,g={intent:o.intent/p*100,behavioral:o.behavioral/p*100,temporal:o.temporal/p*100},k=i/40*g.intent,S=u/35*g.behavioral,A=f/25*g.temporal,L=Math.min(100,Math.max(0,k+S+A+c));let v="COLD";return L>=l.hot?v="HOT":L>=l.warm?v="WARM":L>=l.standard&&(v="STANDARD"),{score:Math.round(L*10)/10,level:v,breakdown:{intent:Math.round(i*10)/10,behavioral:Math.round(u*10)/10,temporal:Math.round(f*10)/10,quality:Math.round(c*10)/10,total:Math.round(L*10)/10}}}function ha(t,m){var r;let s=0;return(t.requestType==="Test Drive"||((r=t.scheduledAppointment)==null?void 0:r.type)==="test-drive"||m.some(a=>a.type==="test-drive"||a.type==="appointment"))&&(s=Math.max(s,40)),m.some(a=>a.type==="financing")&&(s=Math.max(s,35)),m.some(a=>a.type==="tradein")&&(s=Math.max(s,30)),(t.source==="Walk-in"||m.some(a=>{var o,l,i;return((o=a.content)==null?void 0:o.toLowerCase().includes("location"))||((l=a.content)==null?void 0:l.toLowerCase().includes("dealership"))||((i=a.content)==null?void 0:i.toLowerCase().includes("visit"))}))&&(s=Math.max(s,25)),t.requestedCar&&(t.requestedCar.requestMessage||m.some(a=>{var o,l;return((o=a.content)==null?void 0:o.toLowerCase().includes("configur"))||a.type==="attachment"&&((l=a.fileName)==null?void 0:l.toLowerCase().includes("config"))}))&&(s=Math.max(s,20)),m.some(a=>{var l;const o=((l=a.content)==null?void 0:l.toLowerCase())||"";return o.includes("compare")||o.includes("versus")||o.includes("vs")||o.includes("alternative")})&&(s=Math.max(s,15)),Math.min(s,40)}function xa(t,m){let s=0;const r=new Set(m.map(i=>{if(!i.timestamp)return null;const u=new Date(i.timestamp);return`${u.getFullYear()}-${u.getMonth()}-${u.getDate()}`}).filter(Boolean)),a=Math.min(r.size*10,35);s+=a,t.contactAttempts&&t.contactAttempts.length>1&&(s+=20);const o=m.reduce((i,u)=>{var f;return i+(((f=u.content)==null?void 0:f.length)||0)},0),l=Math.min(Math.floor(o/50),25);return s+=l,m.some(i=>{var u,f,c;return i.type==="attachment"&&(((u=i.fileName)==null?void 0:u.toLowerCase().includes("brochure"))||((f=i.fileName)==null?void 0:f.toLowerCase().includes("spec"))||((c=i.fileName)==null?void 0:c.toLowerCase().includes("pdf")))})&&(s+=15),Math.min(s,35)}function wa(t){let m=0;if(!t.createdAt)return 0;const s=new Date,r=new Date(t.createdAt),a=(s.getTime()-r.getTime())/(1e3*60*60);a<2?m+=25:a<24?m+=15:a<48?m+=5:m-=10;const o=r.getDay(),l=r.getHours();if((o===0||o===6||l<9||l>17)&&(m+=10),t.contactAttempts&&t.contactAttempts.length===3&&(m+=50),t.lastActivity){const i=new Date(t.lastActivity);(s.getTime()-i.getTime())/(1e3*60*60*24)>3&&(m+=20)}return Math.min(Math.max(m,0),25)}function ka(t){var s,r,a,o,l,i,u;let m=0;return(s=t.customer)!=null&&s.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.customer.email)&&(m+=10),(r=t.customer)!=null&&r.phone&&/^\+?[\d\s\-()]+$/.test(t.customer.phone)&&t.customer.phone.length>=10&&(m+=10),(a=t.customer)!=null&&a.name&&((o=t.customer)!=null&&o.email)&&((l=t.customer)!=null&&l.phone)&&((i=t.customer)!=null&&i.address)&&(m+=5),(t.isDuplicate||t.isDisqualified||!((u=t.customer)!=null&&u.name))&&(m-=20),m}function ps(t){switch(t){case"HOT":return"ðŸ”¥";case"WARM":return"ðŸŸ¡";case"STANDARD":return"ðŸŸ¢";case"COLD":return"âšª";default:return"âšª"}}function ms(t){switch(t){case"HOT":return"bg-red-50 text-red-700 border-red-200";case"WARM":return"bg-orange-50 text-orange-700 border-orange-200";case"STANDARD":return"bg-green-50 text-green-700 border-green-200";case"COLD":return"bg-gray-50 text-gray-700 border-gray-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}}function Ca({typeFilter:t,showTypeFilter:m,tasks:s}){return{filterDefinitions:D(()=>{const a=[];m.value&&a.push({key:"type",label:"Type",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"lead",label:"Lead"},{value:"opportunity",label:"Opportunity"}],aiHint:"Lead or Opportunity type",pinned:!0}),a.push({key:"status",label:"Status",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Valid",label:"Valid"},{value:"Not valid",label:"Not valid"},{value:"Qualified",label:"Qualified"},{value:"In Negotiation",label:"In Negotiation"},{value:"Won",label:"Won"},{value:"Lost",label:"Lost"},{value:"Not interested",label:"Not interested"},{value:"Open",label:"Open"},{value:"Open Lead",label:"Open Lead"}],aiHint:"Lead status or opportunity stage",pinned:!0}),a.push({key:"priority",label:"Priority",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"Hot",label:"High"},{value:"Normal",label:"Normal"}],aiHint:"Task priority level"}),t.value==="lead"&&a.push({key:"urgencyLevel",label:"Urgency",type:"select",operators:[{value:"eq",label:"is"}],options:[{value:"HOT",label:"ðŸ”¥ Hot"},{value:"WARM",label:"ðŸŸ¡ Warm"},{value:"STANDARD",label:"ðŸŸ¢ Standard"},{value:"COLD",label:"âšª Cold"}],aiHint:"Lead urgency level based on scoring",pinned:!0}),a.push({key:"source",label:"Source",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:[{value:"Marketing",label:"Marketing"},{value:"Website",label:"Website"},{value:"Referral",label:"Referral"},{value:"Walk-in",label:"Walk-in"}],aiHint:"Lead or opportunity source",pinned:!0});const o=[...new Set(s.value.map(i=>i.assignee).filter(Boolean))];o.length>0&&a.push({key:"assignee",label:"Assignee",type:"select",operators:[{value:"eq",label:"is"}],options:o.map(i=>({value:i,label:i})),aiHint:"Person assigned to the task",pinned:!0});const l=[...new Set(s.value.map(i=>{const u=i.type==="lead"?i.requestedCar:i.vehicle;return u==null?void 0:u.brand}).filter(Boolean))];return l.length>0&&a.push({key:"requestedCarBrand",label:"Requested car",type:"multiselect",operators:[{value:"in",label:"is any of"},{value:"notIn",label:"is none of"}],options:l.map(i=>({value:i,label:i})),aiHint:"Car brand requested by customer"}),a.push({key:"createdAt",label:"Creation date",type:"daterange",operators:[{value:"between",label:"is between"},{value:"gte",label:"is after"},{value:"lte",label:"is before"}],aiHint:"Date when the task was created"}),a})}}const Sa={class:"page-container flex-1 flex flex-col overflow-hidden min-w-0"},$a={class:"page-header shrink-0"},Aa={class:"page-header-main"},Da={class:"page-header-content"},Ta={class:"page-header-actions"},Ia={class:"bg-white border border-black/5 p-0.5 rounded-btn inline-flex gap-0.5"},qa={class:"flex-1 overflow-y-auto p-4 md:p-8"},Oa={class:"table-wrapper w-full"},Ma={__name:"TasksTableView",props:{tasks:{type:Array,required:!0},currentTaskId:{type:String,default:null},highlightId:{type:String,default:null},typeFilter:{type:String,default:"all"},sortOption:{type:String,default:"recent-first"},showTypeFilter:{type:Boolean,default:!0},showClosed:{type:Boolean,default:!1},showMobileClose:{type:Boolean,default:!1},openMenuId:{type:[Number,String],default:null},searchPlaceholder:{type:String,default:"Search tasks..."},viewMode:{type:String,default:"table"},getVehicleType:{type:Function,required:!0},getVehicleTypeBadgeClass:{type:Function,required:!0},getOwnerInfo:{type:Function,required:!0},getStageBadgeClass:{type:Function,required:!0}},emits:["select","menu-click","menu-close","filter-change","sort-change","toggle-closed","reassign","close","view-change"],setup(t,{emit:m}){const s=t,r=m,a=Ge();T("");const o=T({pageIndex:0,pageSize:10}),l=T(""),i=T([]),u=T([]);T({});const{filterDefinitions:f}=Ca({typeFilter:D(()=>s.typeFilter),showTypeFilter:D(()=>s.showTypeFilter),tasks:D(()=>s.tasks)}),c=D(()=>s.tasks),p=h=>h.compositeId===s.currentTaskId||h.compositeId===s.highlightId,g=h=>{if(h.type==="lead")return h.requestedCar?`${h.requestedCar.brand} ${h.requestedCar.model}`:"No vehicle specified";const x=h.vehicle||h.requestedCar;return x?`${x.brand} ${x.model}`:"No vehicle specified"},k=h=>{const x=h.type==="lead"?h.requestedCar:h.vehicle;if(!x)return{status:"N/A",class:"bg-surfaceSecondary text-body"};const $=x.stockDays!==void 0&&x.stockDays!==null;return{status:$?"In Stock":"Out of Stock",class:$?"bg-green-100 text-green-700":"bg-surfaceSecondary text-body"}},S=h=>{var x;return h.type==="lead"?((x=h.requestedCar)==null?void 0:x.requestType)||h.requestType||"N/A":h.requestType||"Opportunity"},A=D(()=>[{accessorKey:"type",header:"Task type",meta:{title:"Task type",onOpen:h=>L(h.original)},cell:({row:h})=>{const x=h.original,$=x.type==="lead"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700";return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${$}`},x.type==="lead"?"Lead":"Opportunity")}},{accessorKey:"customer",header:"Customer",meta:{title:"Customer"},cell:({row:h})=>{const x=h.original;return pe("div",{class:"flex items-center gap-2 md:gap-3"},[pe("div",{class:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${x.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`},x.customer.initials),pe("div",{class:"min-w-0"},[pe("div",{class:"text-content font-semibold text-heading truncate max-w-32 md:max-w-none"},x.customer.name),pe("div",{class:"text-meta truncate hidden sm:block"},x.customer.email)])])}},{accessorKey:"car",header:"Car",meta:{title:"Car"},cell:({row:h})=>{const x=h.original,$=g(x);return $==="No vehicle specified"?pe("span",{class:"text-meta"},"N/A"):pe("div",{class:"flex items-center gap-2"},[pe("i",{class:"fa-brands fa-volkswagen text-sub text-sm"}),pe("span",{class:"text-content font-medium text-heading truncate max-w-32"},$)])}},{accessorKey:"carStatus",header:"Car status",meta:{title:"Car status"},cell:({row:h})=>{const x=h.original,$=k(x);return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${$.class}`},$.status)}},{accessorKey:"requestType",header:"Request type",meta:{title:"Request type"},cell:({row:h})=>{const x=h.original,$=S(x);return pe("span",{class:"text-meta"},$)}},{accessorKey:"source",header:"Source",meta:{title:"Source"},cell:({row:h})=>{const x=h.original;return pe("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-surfaceSecondary text-body"},x.source||"N/A")}},{accessorKey:"assignee",header:"Assignee",meta:{title:"Assignee"},cell:({row:h})=>{const x=h.original,$=s.getOwnerInfo(x);return pe("div",{class:"flex items-center gap-2"},[pe("div",{class:"w-6 h-6 rounded-full bg-surfaceSecondary flex items-center justify-center text-xs font-bold text-body shrink-0"},$.initials),pe("span",{class:"text-meta truncate max-w-20"},$.name)])}},{accessorKey:"status",header:"Status",meta:{title:"Status"},cell:({row:h})=>{const x=h.original,$=x.type==="lead"?x.status:x.displayStage||x.stage,F=s.getStageBadgeClass($);return pe("span",{class:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${F}`},$)}},...s.typeFilter==="lead"&&a.getSetting("urgencyEnabled")!==!1?[{id:"urgencyLevel",accessorKey:"urgencyLevel",header:"Urgency",meta:{title:"Urgency"},cell:({row:h})=>{const x=h.original;if(x.type!=="lead")return pe("span",{class:"text-meta"},"â€”");let $=x.urgencyLevel;$||($=cs(x).level);const F=ms($),H=ps($);return pe("span",{class:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold border ${F}`},[pe("span",{},H),pe("span",{},$)])}}]:[],{id:"actions",header:"",meta:{title:"Actions"},cell:({row:h})=>{const x=h.original;return pe("button",{class:"text-sub hover:text-body",onClick:$=>{$.stopPropagation(),r("menu-click",x.id)}},[pe("i",{class:"fa-solid fa-ellipsis-vertical"})])}}]),L=h=>{l.value=String(h.id),r("select",h.compositeId)},v=D(()=>({class:{tr:h=>{const x="cursor-pointer hover:bg-surfaceSecondary transition-colors",$=h.original;return p($)?`${x} bg-blue-50 border-l-4 border-l-blue-500`:x}}}));return(h,x)=>(d(),b("div",Sa,[e("header",$a,[e("div",Aa,[e("div",Da,[x[8]||(x[8]=e("div",{class:"page-header-title-container"},[e("h1",{class:"page-header-title"},"Tasks")],-1)),e("div",Ta,[e("div",Ia,[e("button",{onClick:x[0]||(x[0]=$=>h.$emit("view-change","table")),class:j(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="table"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Table View"},[w(n(us),{size:14})],2),e("button",{onClick:x[1]||(x[1]=$=>h.$emit("view-change","card")),class:j(["h-7 px-2.5 rounded-md transition-all flex items-center justify-center",t.viewMode==="card"?"bg-brand-gray text-heading shadow-sm":"text-sub hover:text-heading"]),title:"Card View"},[w(n(rs),{size:14})],2)]),e("button",{onClick:x[2]||(x[2]=$=>h.$emit("toggle-closed",!t.showClosed)),class:"group flex items-center gap-2 rounded-2xl border border-E5E7EB px-3 py-1.5 bg-surface text-fluid-sm font-medium text-body hover:border-red-100 hover:bg-red-50 hover:text-brand-red transition-all"},[...x[7]||(x[7]=[e("i",{class:"fa-solid fa-eye-slash text-sub group-hover:text-brand-red"},null,-1),e("span",{class:"hidden sm:inline"},"Show Closed",-1)])])])])])]),e("div",qa,[e("div",Oa,[w(n($n),{data:c.value,columns:A.value,meta:v.value,onRowClick:L,columnFiltersOptions:{filterDefs:n(f)},pagination:o.value,"onUpdate:pagination":x[3]||(x[3]=$=>o.value=$),globalFilter:l.value,"onUpdate:globalFilter":x[4]||(x[4]=$=>l.value=$),sorting:i.value,"onUpdate:sorting":x[5]||(x[5]=$=>i.value=$),columnFilters:u.value,"onUpdate:columnFilters":x[6]||(x[6]=$=>u.value=$),paginationOptions:{rowCount:c.value.length},globalFilterOptions:{debounce:300,placeholder:"Q Search or ask a question"}},{"empty-state":O(()=>[...x[9]||(x[9]=[e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-tasks empty-state-icon"}),e("p",{class:"empty-state-text"},"No tasks found")],-1)])]),_:1},8,["data","columns","meta","columnFiltersOptions","pagination","globalFilter","sorting","columnFilters","paginationOptions"])])])]))}},Na=ze(Ma,[["__scopeId","data-v-20f2a5ef"]]),La={key:0,class:"flex-1 flex flex-col overflow-hidden lg:border-l border bg-surface"},Ea={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border-black/5 bg-surface"},Fa={__name:"TaskDetailViewCompact",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},setup(t){return(m,s)=>t.task?(d(),b("div",La,[w(en,bt({task:t.task,type:t.task.type,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig},m.$attrs),null,16,["task","type","management-widget","store-adapter","add-new-config"])])):(d(),b("div",Ea,[...s[0]||(s[0]=[vt('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-sm"><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center"><i class="fa-solid fa-tasks text-2xl text-sub"></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2">No task selected</h3><p class="text-fluid-sm text-sub">Select a task from the list to view its details and manage activities</p></div></div>',1)])]))}},Ba={class:"border-b border-black/5 bg-white px-6 h-16 min-h-16 shrink-0"},Va={class:"flex items-center justify-between gap-4 w-full h-full"},Ra={class:"flex flex-col gap-0.5 min-w-0"},ja={class:"text-fluid-lg font-medium text-greys-900"},Ua={key:0,class:"text-fluid-sm text-greys-500 truncate"},za={key:1,class:"text-fluid-sm text-greys-500"},Wa={class:"flex items-center gap-2 shrink-0"},Ha={__name:"TaskDetailHeader",props:{task:{type:Object,default:null},filteredTasks:{type:Array,default:()=>[]}},emits:["previous","next"],setup(t){const m=t,s=D(()=>!m.task||!m.filteredTasks.length?!1:m.filteredTasks.findIndex(i=>{const u=m.task.compositeId||m.task.id;return(i.compositeId||i.id)===u})>0),r=D(()=>{if(!m.task||!m.filteredTasks.length)return!1;const l=m.filteredTasks.findIndex(i=>{const u=m.task.compositeId||m.task.id;return(i.compositeId||i.id)===u});return l>=0&&l<m.filteredTasks.length-1}),a=l=>l?l.type==="lead"?"Lead Qualification Task":l.type==="opportunity"?"Opportunity Management Task":"Task Details":"",o=l=>{var u;if(!l)return"";const i=[];if(l.vehicle||l.requestedCar){const f=l.vehicle||l.requestedCar;f.brand&&f.model?i.push(`${f.brand} ${f.model} (${f.year||"N/A"})`):f.model&&i.push(`${f.model} (${f.year||"N/A"})`)}return l.source&&i.push(l.source),(u=l.customer)!=null&&u.name?i.push(l.customer.name):l.customerName&&i.push(l.customerName),i.join(" â€¢ ")};return(l,i)=>(d(),b("div",Ba,[e("div",Va,[e("div",Ra,[e("h2",ja,I(a(t.task)),1),t.task?(d(),b("p",Ua,I(o(t.task)),1)):(d(),b("p",za," Select a task to view details "))]),e("div",Wa,[w(n(Ye),{variant:"secondary",size:"icon",onClick:i[0]||(i[0]=u=>l.$emit("previous")),disabled:!s.value},{default:O(()=>[w(n(os),{size:16})]),_:1},8,["disabled"]),w(n(Ye),{variant:"secondary",size:"icon",onClick:i[1]||(i[1]=u=>l.$emit("next")),disabled:!r.value},{default:O(()=>[w(n(is),{size:16})]),_:1},8,["disabled"])])])]))}},Pa=ze(Ha,[["__scopeId","data-v-8eea4260"]]),_a={class:"grid grid-cols-3 gap-4"},Qa={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},Ya={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},Ga={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},Ja={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0 text-right flex-1"},Ka={class:"px-3 py-2 overflow-hidden flex items-center justify-between gap-2 rounded-card bg-white shadow-nsc-card"},Za={class:"flex items-center gap-2 min-w-0 flex-1 justify-end"},Xa={class:"text-xs xl:text-sm font-medium text-greys-900 leading-5 truncate min-w-0"},el={__name:"TaskInfoCards",props:{task:{type:Object,required:!0},type:{type:String,required:!0}},setup(t){const m=t,s=D(()=>m.task.displayStage?m.task.displayStage:m.task.stage?m.task.stage.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "):"N/A"),r=D(()=>m.task.assignee||m.task.owner||m.task.assignedTo||""),a=o=>{if(!o)return"U";const l=o.trim().split(" ");return l.length>=2?`${l[0][0]}${l[1][0]}`.toUpperCase():o.substring(0,2).toUpperCase()};return(o,l)=>(d(),b("div",_a,[e("div",Qa,[l[0]||(l[0]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Stage",-1)),e("p",Ya,I(s.value),1)]),e("div",Ga,[l[1]||(l[1]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Source",-1)),e("p",Ja,I(t.task.source||"N/A"),1)]),e("div",Ka,[l[2]||(l[2]=e("p",{class:"text-xs text-greys-500 leading-4 shrink-0"},"Owner",-1)),e("div",Za,[r.value?(d(),Q(n(Dn),{key:0,class:"h-5 w-5 shrink-0"},{default:O(()=>[w(n(An),{class:"bg-orange-500 text-white text-xs"},{default:O(()=>[P(I(a(r.value)),1)]),_:1})]),_:1})):q("",!0),e("p",Xa,I(r.value||"Unassigned"),1)])])]))}},tl=ze(el,[["__scopeId","data-v-abff1c03"]]),sl=Object.assign({inheritAttrs:!1},{__name:"TaskManagementCard",props:{task:{type:Object,required:!0},type:{type:String,required:!0,validator:t=>["lead","opportunity"].includes(t)},managementWidget:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},setup(t){return(m,s)=>(d(),b("div",null,[t.managementWidget?(d(),Q(ht(t.managementWidget),bt({key:0,lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,activities:t.activities},m.$attrs),null,16,["lead","opportunity","activities"])):q("",!0)]))}}),nl=ze(sl,[["__scopeId","data-v-f5db9491"]]),al={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},ll={key:0,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100"},ol=["src","alt"],il={key:1,class:"w-full h-40 rounded-btn overflow-hidden mb-4 bg-gray-100 flex items-center justify-center"},rl={class:"space-y-2 mb-4"},dl={class:"flex justify-between items-start gap-2"},ul={class:"min-w-0 flex-1"},cl={class:"text-sm font-medium text-greys-900 truncate"},pl={key:0,class:"text-xs text-greys-500"},ml={key:0,class:"text-sm font-semibold text-greys-900 shrink-0"},fl={key:0,class:"flex gap-3 text-xs text-greys-500"},yl={key:0},gl={key:1},vl={key:2,class:"mb-4"},bl={key:3,class:"rounded-btn p-3 mb-4",style:{"background-color":"var(--base-muted, #f5f5f5)"}},hl={class:"text-sm text-greys-900"},xl={class:"flex gap-2 pt-4 border-t border-black/5"},wl={__name:"VehicleRequestCard",props:{vehicle:{type:Object,required:!0},requestMessage:{type:String,default:""},source:{type:String,default:""},imageUrl:{type:String,default:""}},emits:["open-ad","more-actions"],setup(t){const m=t,s=T(!1),r=D(()=>{const i=[];return m.vehicle.brand&&i.push(m.vehicle.brand),m.vehicle.model&&i.push(m.vehicle.model),m.vehicle.variant&&i.push(m.vehicle.variant),i.join(" ")||"Vehicle Details"}),a=i=>{if(!i)return"0";const u=typeof i=="string"?parseFloat(i):i;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u)},o=i=>{if(!i)return"0";const u=typeof i=="string"?parseFloat(i):i;return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u)},l=()=>{s.value=!0};return(i,u)=>(d(),b("div",al,[u[4]||(u[4]=e("h3",{class:"text-base font-medium mb-4 text-greys-900 -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Requested Car",-1)),t.imageUrl?(d(),b("div",ll,[e("img",{src:t.imageUrl,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover",onError:l},null,40,ol)])):(d(),b("div",il,[w(n(Mn),{size:48,class:"text-gray-400"})])),e("div",rl,[e("div",dl,[e("div",ul,[e("p",cl,I(r.value),1),t.vehicle.year?(d(),b("p",pl,I(t.vehicle.year),1)):q("",!0)]),t.vehicle.price?(d(),b("p",ml," â‚¬"+I(a(t.vehicle.price)),1)):q("",!0)]),t.vehicle.mileage||t.vehicle.fuelType?(d(),b("div",fl,[t.vehicle.mileage?(d(),b("span",yl,I(o(t.vehicle.mileage))+" km",1)):q("",!0),t.vehicle.fuelType?(d(),b("span",gl,I(t.vehicle.fuelType),1)):q("",!0)])):q("",!0)]),t.source?(d(),b("div",vl,[w(n(Tn),{variant:"secondary",class:"text-xs"},{default:O(()=>[P(I(t.source),1)]),_:1})])):q("",!0),t.requestMessage?(d(),b("div",bl,[u[2]||(u[2]=e("p",{class:"text-xs text-greys-500 mb-1"},"Request message",-1)),e("p",hl,I(t.requestMessage),1)])):q("",!0),e("div",xl,[w(n(Ye),{variant:"secondary",size:"sm",class:"flex-1",onClick:u[0]||(u[0]=f=>i.$emit("open-ad"))},{default:O(()=>[w(n(tn),{size:16}),u[3]||(u[3]=e("span",null,"Open Ad",-1))]),_:1}),w(n(Ye),{variant:"secondary",size:"icon-sm",onClick:u[1]||(u[1]=f=>i.$emit("more-actions"))},{default:O(()=>[w(n(En),{size:16})]),_:1})])]))}},kl=ze(wl,[["__scopeId","data-v-86c6d8c5"]]),Cl={class:"overflow-hidden p-4 rounded-card bg-white shadow-nsc-card"},Sl={key:0,class:"space-y-6"},$l={class:"text-sm text-greys-500 font-medium"},Al={class:"space-y-4"},Dl=["onClick"],Tl={class:"flex-1 min-w-0"},Il={class:"text-sm leading-5"},ql={class:"font-normal text-greys-900"},Ol={class:"text-greys-500"},Ml=["onClick"],Nl=["onClick"],Ll={class:"text-xs text-greys-500 mt-1"},El={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Fl={__name:"TaskActivityCard",props:{activities:{type:Array,default:()=>[]},expandedSummaries:{type:Object,default:()=>({})}},emits:["activity-click","toggle-summary-expanded"],setup(t,{emit:m}){const s=t,r=m,a=D(()=>[...s.activities].sort((A,L)=>{const v=new Date(A.timestamp||A.createdAt||0).getTime();return new Date(L.timestamp||L.createdAt||0).getTime()-v})),o=A=>({note:Et,email:ds,whatsapp:yt,sms:yt,call:Vn,meeting:Qs,task:Kt,status_change:jn,assignment:_s,survey:Nn})[A]||Kt,l=A=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;",sms:"background-color: #f3e8ff;",call:"background-color: #dbeafe;",meeting:"background-color: #e0e7ff;",task:"background-color: #f5f5f5;",status_change:"background-color: #fef3c7;",assignment:"background-color: #e5e7eb;",survey:"background-color: #f0f9ff;"})[A]||"background-color: #f5f5f5;",i=A=>({note:"text-orange-600",email:"text-blue-600",whatsapp:"text-green-600",sms:"text-purple-600",call:"text-blue-500",meeting:"text-indigo-600",task:"text-gray-600",status_change:"text-yellow-600",assignment:"text-gray-500",survey:"text-blue-600"})[A]||"text-gray-600",u=A=>({note:"background-color: #fef7ee;",email:"background-color: #eff6ff;",whatsapp:"background-color: #dcfce7;",survey:"background-color: #f0f9ff;"})[A]||"background-color: #f5f5f5;",f=A=>["note","email","whatsapp","survey"].includes(A.type)&&A.content,c=A=>{if(!A.content)return"";if(A.type==="survey")try{const L=typeof A.content=="string"?JSON.parse(A.content):A.content,h=Object.entries(L).filter(([x,$])=>$&&$!=="").map(([x,$])=>`${x.replace(/([A-Z])/g," $1").replace(/^./,H=>H.toUpperCase()).trim()}: ${$}`).join(`
`)||A.content;return s.expandedSummaries[A.id]?h:h.length>100?h.substring(0,100)+"...":h}catch{const v=A.content;return s.expandedSummaries[A.id]?v:v.length>100?v.substring(0,100)+"...":v}return s.expandedSummaries[A.id]?A.content:A.content.length>100?A.content.substring(0,100)+"...":A.content},p=A=>{if(!A||A.length===0)return"";const L=A[0],v=L.timestamp||L.createdAt;if(!v)return"Recent Activity";const h=new Date(v),x=new Date,$=new Date(x);return $.setDate($.getDate()-1),h.toDateString()===x.toDateString()?"Today":h.toDateString()===$.toDateString()?"Yesterday":h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:h.getFullYear()!==x.getFullYear()?"numeric":void 0})},g=A=>{["note","email","whatsapp","survey"].includes(A.type)&&r("activity-click",A)},k=A=>{r("toggle-summary-expanded",A)},S=A=>{if(!A.content)return 0;if(A.type==="survey")try{const L=typeof A.content=="string"?JSON.parse(A.content):A.content;return Object.entries(L).filter(([h,x])=>x&&x!=="").map(([h,x])=>`${h.replace(/([A-Z])/g," $1").replace(/^./,F=>F.toUpperCase()).trim()}: ${x}`).join(`
`).length||A.content.length}catch{return A.content.length}return A.content.length};return(A,L)=>(d(),b("div",Cl,[L[1]||(L[1]=e("h3",{class:"text-base font-medium mb-4 text-greys-900 -mx-4 -mt-4 px-4 pt-4 rounded-t-card"},"Activity",-1)),a.value.length>0?(d(),b("div",Sl,[e("h3",$l,I(p(a.value)),1),e("div",Al,[(d(!0),b(ye,null,we(a.value,v=>(d(),b("div",{key:v.id,class:j(["flex gap-2",{"cursor-pointer hover:opacity-80 transition-opacity":v.type==="note"||v.type==="email"||v.type==="whatsapp"||v.type==="survey"}]),onClick:h=>g(v)},[e("div",{class:"size-8 rounded-btn flex items-center justify-center shrink-0",style:Nt(l(v.type))},[(d(),Q(ht(o(v.type)),{size:16,class:j(i(v.type))},null,8,["class"]))],4),e("div",Tl,[e("p",Il,[e("span",ql,I(v.user),1),e("span",Ol,I(v.action),1)]),v.content&&f(v)?(d(),b("div",{key:0,class:"mt-2 rounded-card p-4",style:Nt(u(v.type))},[e("p",{class:j(["text-sm text-greys-900",{"whitespace-pre-line":v.type==="survey"}])},I(c(v)),3),S(v)>100&&!t.expandedSummaries[v.id]?(d(),b("button",{key:0,onClick:gt(h=>k(v.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show more ",8,Ml)):S(v)>100&&t.expandedSummaries[v.id]?(d(),b("button",{key:1,onClick:gt(h=>k(v.id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-700 mt-1"}," Show less ",8,Nl)):q("",!0)],4)):q("",!0),e("p",Ll,I(v.time),1)])],10,Dl))),128))])])):(d(),b("div",El,[w(n(Ln),{size:32,class:"text-greys-400 mb-2"}),L[0]||(L[0]=e("p",{class:"text-sm text-greys-500"},"No activity yet",-1))]))]))}},Bl=ze(Fl,[["__scopeId","data-v-aba69c31"]]),Vl={key:0,class:"flex flex-col flex-1 min-w-0 overflow-hidden"},Rl={class:"flex flex-1 overflow-hidden"},jl={class:"flex-1 flex flex-col overflow-hidden bg-white min-w-0"},Ul={class:"px-6 py-0 shrink-0"},zl={class:"flex items-stretch h-12 gap-4 border-b border-black/5"},Wl=["onClick"],Hl={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"},Pl={class:"flex-1 overflow-y-auto"},_l={key:0,class:"p-6 space-y-4"},Ql={key:1,class:"p-6 space-y-4"},Yl={class:"px-4 py-2 flex items-center justify-between rounded-t-card -mx-1 -mt-1"},Gl={class:"flex items-center gap-2"},Jl={class:"text-base font-medium text-greys-500"},Kl={class:"text-sm text-greys-500"},Zl={class:"p-4 overflow-hidden rounded-card bg-white shadow-nsc-card"},Xl={class:"text-sm font-medium text-greys-900"},eo={class:"text-sm mt-1 text-greys-700"},to={key:0,class:"flex justify-end mt-4"},so={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},no={key:2,class:"p-6 space-y-4"},ao={class:"px-4 py-2 flex items-center justify-between rounded-t-card -mx-1 -mt-1"},lo={class:"flex items-center gap-2"},oo={class:"text-base font-medium text-greys-500"},io={class:"text-sm text-greys-500"},ro={class:"p-4 overflow-hidden rounded-card bg-white shadow-nsc-card"},uo={class:"text-sm text-greys-900"},co={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},po={key:3,class:"p-6"},mo={key:0,class:"empty-state flex flex-col items-center justify-center py-12"},fo={class:"right-sidebar flex flex-col overflow-y-auto shrink-0 border-l border-black/5",style:{"background-color":"#F8F8F8"}},yo={class:"space-y-2 p-2"},go={key:1,class:"flex-1 flex items-center justify-center bg-surface"},vo={__name:"TaskDetailViewTabbed",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t,{emit:m}){const s=t,r=m,a=T("overview"),o=T({}),l=[{key:"overview",label:"Overview"},{key:"communication",label:"Communication"},{key:"notes",label:"Notes"},{key:"attachments",label:"Attachments"}],i=D(()=>{var N;return((N=s.storeAdapter.currentActivities)==null?void 0:N.value)||[]}),u=D(()=>i.value.filter(N=>["email","whatsapp","sms","call"].includes(N.type))),f=D(()=>i.value.filter(N=>N.type==="note")),c=D(()=>i.value.filter(N=>N.type==="attachment")),p=N=>N==="overview"?1:N==="communication"?u.value.length:N==="notes"?f.value.length:N==="attachments"?c.value.length:0,g=()=>{r("task-navigate","previous")},k=()=>{r("task-navigate","next")},S=T(null),A=T({}),L=T({});let v=null;const h=N=>{v!==null&&(window.clearTimeout(v),v=null),S.value=N,N&&(v=window.setTimeout(()=>{S.value=null,v=null},900))},x=async()=>{if(S.value){if(await Gs(),S.value.tab==="notes"&&a.value==="notes"){const N=A.value[S.value.id];N&&typeof N.scrollIntoView=="function"&&N.scrollIntoView({behavior:"smooth",block:"center"})}if(S.value.tab==="communication"&&a.value==="communication"){const N=L.value[S.value.id];N&&typeof N.scrollIntoView=="function"&&N.scrollIntoView({behavior:"smooth",block:"center"})}}},$=(N,W)=>{W?A.value[N]=W:delete A.value[N]},F=(N,W)=>{W?L.value[N]=W:delete L.value[N]},H=N=>S.value?S.value.tab==="notes"&&S.value.type==="note"&&S.value.id===N.id:!1,ee=N=>S.value?S.value.tab==="communication"&&(S.value.type==="email"||S.value.type==="whatsapp")&&S.value.id===N.id:!1;Ee(()=>[S.value,a.value],()=>{S.value&&x()}),Ys(()=>{v!==null&&(window.clearTimeout(v),v=null)});const le=N=>{N.type==="note"?(a.value="notes",h({tab:"notes",type:"note",id:N.id})):["email","whatsapp","sms","call"].includes(N.type)?(a.value="communication",h({tab:"communication",type:N.type,id:N.id})):N.type==="attachment"&&(a.value="attachments",h(null))},ne=N=>{o.value[N]=!o.value[N]},me=N=>N==="email"?ds:yt,ge=N=>N==="email"?"text-blue-600":N==="whatsapp"?"text-green-600":N==="sms"?"text-purple-600":"text-gray-600",ke=N=>{const W=N.from==="lead"||N.direction==="incoming";return N.type==="whatsapp"?W?"Received WhatsApp message":"Sent WhatsApp message":N.type==="email"?W?"Received Email":"Sent Email":N.type==="sms"?W?"Received SMS":"Sent SMS":"Message"},J=N=>N&&(N.image||N.imageUrl)||"",V=()=>{console.log("Open ad clicked")},U=()=>{console.log("More actions clicked")},oe=N=>{console.log("Contact action:",N)};return(N,W)=>{var qe,Ve;return t.task?(d(),b("div",Vl,[w(Pa,{task:t.task,"filtered-tasks":t.filteredTasks,onPrevious:g,onNext:k},null,8,["task","filtered-tasks"]),e("div",Rl,[e("div",jl,[e("div",Ul,[e("div",zl,[(d(),b(ye,null,we(l,G=>e("button",{key:G.key,onClick:$e=>a.value=G.key,class:"relative flex items-center gap-1.5 px-0 h-full"},[e("span",{class:j(["text-sm font-medium",a.value===G.key?"text-greys-900":"text-greys-500"])},I(G.label),3),e("span",{class:j(["px-2 py-0.5 rounded-btn text-sm",a.value===G.key?"bg-blue-50 text-blue-600 font-bold":"bg-surfaceSecondary text-greys-600 font-medium"])},I(p(G.key)),3),a.value===G.key?(d(),b("span",Hl)):q("",!0)],8,Wl)),64))])]),e("div",Pl,[a.value==="overview"?(d(),b("div",_l,[w(tl,{task:t.task,type:t.task.type},null,8,["task","type"]),w(nl,bt({task:t.task,type:t.task.type,"management-widget":t.managementWidget,activities:i.value},N.$attrs),null,16,["task","type","management-widget","activities"])])):q("",!0),a.value==="communication"?(d(),b("div",Ql,[(d(!0),b(ye,null,we(u.value,G=>(d(),b("div",{key:G.id,ref_for:!0,ref:$e=>F(G.id,$e),class:j(["bg-greys-100 rounded-card p-1",ee(G)&&G.type==="whatsapp"?"highlight-whatsapp":"",ee(G)&&G.type==="email"?"highlight-email":""]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[e("div",Yl,[e("div",Gl,[(d(),Q(ht(me(G.type)),{size:18,class:j(ge(G.type))},null,8,["class"])),e("h3",Jl,I(ke(G)),1)]),e("span",Kl,I(G.timestamp||G.time),1)]),e("div",Zl,[e("p",Xl,I(G.senderName||G.user),1),e("p",eo,I(G.content),1),G.from==="lead"||G.direction==="incoming"?(d(),b("div",to,[w(n(Ye),{size:"sm"},{default:O(()=>[...W[0]||(W[0]=[P("Reply",-1)])]),_:1})])):q("",!0)])],2))),128)),u.value.length===0?(d(),b("div",so,[w(n(yt),{size:48,class:"text-greys-400 mb-4"}),W[2]||(W[2]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No communication yet",-1)),W[3]||(W[3]=e("p",{class:"text-sm text-greys-500 mb-4"},"Start a conversation with the customer",-1)),w(n(Ye),null,{default:O(()=>[...W[1]||(W[1]=[P("Send message",-1)])]),_:1})])):q("",!0)])):q("",!0),a.value==="notes"?(d(),b("div",no,[(d(!0),b(ye,null,we(f.value,G=>(d(),b("div",{key:G.id,ref_for:!0,ref:$e=>$(G.id,$e),class:j(["bg-[#fef7ee] rounded-card p-1",H(G)?"highlight-note":""])},[e("div",ao,[e("div",lo,[w(n(Et),{size:18,class:"text-orange-600"}),e("h3",oo,"Note by "+I(G.user),1)]),e("span",io,I(G.timestamp||G.time),1)]),e("div",ro,[e("p",uo,I(G.content),1)])],2))),128)),f.value.length===0?(d(),b("div",co,[w(n(Et),{size:48,class:"text-greys-400 mb-4"}),W[5]||(W[5]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No notes yet",-1)),W[6]||(W[6]=e("p",{class:"text-sm text-greys-500 mb-4"},"Add a note to keep track of important information",-1)),w(n(Ye),null,{default:O(()=>[...W[4]||(W[4]=[P("Add note",-1)])]),_:1})])):q("",!0)])):q("",!0),a.value==="attachments"?(d(),b("div",po,[c.value.length===0?(d(),b("div",mo,[w(n(Fn),{size:48,class:"text-greys-400 mb-4"}),W[8]||(W[8]=e("h3",{class:"text-base font-medium text-greys-900 mb-2"},"No attachments yet",-1)),W[9]||(W[9]=e("p",{class:"text-sm text-greys-500 mb-4"},"Upload files related to this task",-1)),w(n(Ye),null,{default:O(()=>[...W[7]||(W[7]=[P("Add attachment",-1)])]),_:1})])):q("",!0)])):q("",!0)])]),e("div",fo,[e("div",yo,[w(sn,{task:t.task,"task-type":t.task.type,"customer-id":t.task.customerId||((qe=t.task.customer)==null?void 0:qe.id),onAction:oe},null,8,["task","task-type","customer-id"]),t.task.requestedCar||t.task.vehicle?(d(),Q(kl,{key:0,vehicle:t.task.requestedCar||t.task.vehicle,"request-message":t.task.requestMessage||((Ve=t.task.requestedCar)==null?void 0:Ve.requestMessage),source:t.task.source,"image-url":J(t.task.requestedCar||t.task.vehicle),onOpenAd:V,onMoreActions:U},null,8,["vehicle","request-message","source","image-url"])):q("",!0),w(Bl,{activities:i.value,"expanded-summaries":o.value,onActivityClick:le,onToggleSummaryExpanded:ne},null,8,["activities","expanded-summaries"])])])])])):(d(),b("div",go,[...W[10]||(W[10]=[vt('<div class="text-center max-w-sm p-8" data-v-d5316e4e><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-d5316e4e><i class="fa-solid fa-tasks text-2xl text-sub" data-v-d5316e4e></i></div><h3 class="text-fluid-lg font-semibold text-heading mb-2" data-v-d5316e4e>No task selected</h3><p class="text-fluid-sm text-sub" data-v-d5316e4e>Select a task from the list to view its details and manage activities</p></div>',1)])]))}}},bo=ze(vo,[["__scopeId","data-v-d5316e4e"]]),ho={class:"relative flex-1 flex flex-col min-w-0 overflow-hidden"},xo={key:0,class:"absolute top-3 right-[18px] z-50 flex items-center gap-1 bg-white border border-E5E7EB rounded-btn shadow-sm p-0.5"},wo={__name:"TaskDetailView",props:{task:{type:Object,default:null},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},filteredTasks:{type:Array,default:()=>[]}},emits:["task-navigate"],setup(t){const m=Ge(),s=D(()=>m.getSetting("taskDetailsViewMode")||"compact"),r=D(()=>s.value==="tabbed"?bo:Fa),a=o=>{m.setSetting("taskDetailsViewMode",o)};return(o,l)=>(d(),b("div",ho,[t.task?(d(),b("div",xo,[e("button",{onClick:l[0]||(l[0]=i=>a("compact")),class:j(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="compact"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Compact View"},[...l[3]||(l[3]=[e("i",{class:"fa-solid fa-list text-[10px] mr-1"},null,-1),P(" Compact ",-1)])],2),e("button",{onClick:l[1]||(l[1]=i=>a("tabbed")),class:j(["px-2 py-1 text-[10px] font-medium rounded transition-colors",s.value==="tabbed"?"bg-brand-dark text-white hover:bg-brand-darkDarker":"text-sub hover:text-body hover:bg-surfaceSecondary"]),title:"Tabbed View"},[...l[4]||(l[4]=[e("i",{class:"fa-solid fa-table-columns text-[10px] mr-1"},null,-1),P(" Tabbed ",-1)])],2)])):q("",!0),(d(),Q(ht(r.value),bt({task:t.task,"management-widget":t.managementWidget,"store-adapter":t.storeAdapter,"add-new-config":t.addNewConfig,"filtered-tasks":t.filteredTasks},o.$attrs,{onTaskNavigate:l[2]||(l[2]=i=>o.$emit("task-navigate",i))}),null,16,["task","management-widget","store-adapter","add-new-config","filtered-tasks"]))]))}},Zt=ze(wo,[["__scopeId","data-v-86b0efed"]]),ko={key:0,class:"lg:hidden border-b border shrink-0 bg-brand-gray"},Co={class:"px-4 py-3 flex items-center justify-between gap-3"},So=["aria-label"],$o={key:0,class:"flex-1 flex items-center justify-center"},Ao={key:1,class:"flex items-center gap-2"},Do={__name:"MobileDetailHeader",props:{show:{type:Boolean,required:!0},backLabel:{type:String,default:"Back"}},emits:["back"],setup(t,{emit:m}){const s=m,r=()=>{s("back")};return(a,o)=>t.show?(d(),b("div",ko,[e("div",Co,[e("button",{onClick:r,class:"w-11 h-11 flex items-center justify-center text-body hover:text-heading hover:bg-surfaceSecondary rounded-lg transition-colors shrink-0","aria-label":t.backLabel},[...o[0]||(o[0]=[e("i",{class:"fa-solid fa-arrow-left text-lg"},null,-1)])],8,So),a.$slots.title?(d(),b("div",$o,[De(a.$slots,"title")])):q("",!0),a.$slots.actions?(d(),b("div",Ao,[De(a.$slots,"actions")])):q("",!0)])])):q("",!0)}};function fs(t,m={}){const s=Ge(),r=D(()=>{const L=typeof t=="function"?t():$t(t);return{lead:L,displayStage:L?Ft(L,"lead"):null}}),a=D(()=>r.value.displayStage||"New"),o=D(()=>{const L=r.value;return nn(L)}),l=D(()=>{const L=r.value,v=an(L);if(!v)return null;const h=m[v.key];return{...v,handler:h||(()=>{})}}),i=D(()=>{const L=r.value;return ln(L).map(h=>{const x=m[h.key];return{...h,handler:x||(()=>{})}})}),u=D(()=>{const L=r.value;return on(L)}),f=D(()=>{const L=r.value;return rn(L)}),c=D(()=>{const L=r.value;return dn(L)}),p=D(()=>{const L=r.value;return un(L)}),g=D(()=>{const v=r.value.lead;return((v==null?void 0:v.contactAttempts)||[]).length||0}),k=D(()=>s.getSetting("maxContactAttempts")),S=D(()=>g.value+1>=k.value),A=D(()=>!0);return{displayStage:a,isClosed:o,primaryAction:l,secondaryActions:i,showLQWidget:u,showDeadlineBanner:f,canPostpone:c,canReassign:A,lqWidgetMode:p,contactAttempts:g,maxContactAttempts:k,shouldShowAutoDisqualifyWarning:S}}function To({getLead:t,leadState:m,emit:s}){const r=Rt(),a=ct(),o=pt();async function l(v){var x;const h=t();if(h&&m.canPostpone.value)try{const $=new Date(`${v.date}T${v.time}:00`),F=$.toISOString(),H={nextActionDue:F};if((v.assigneeId||v.teamId)&&(H.assignee=v.assignee||null,H.assigneeId=v.assigneeId||null,H.assigneeType=v.assigneeType||"user",H.teamId=v.teamId||null,H.team=v.team||null),await a.updateLead(h.id,H),v.createAppointment){const ee=new Date($);ee.setHours(ee.getHours()+1),await a.updateLead(h.id,{scheduledAppointment:{id:Date.now(),title:`Follow-up Call - ${h.customer.name}`,start:F,end:ee.toISOString(),type:"Call",assignee:v.assignee||h.assignee,assigneeId:v.assigneeId||h.assigneeId,assigneeType:v.assigneeType||h.assigneeType||"user",teamId:v.teamId||h.teamId,team:v.team||h.team,status:"scheduled"}}),await a.addActivity(h.id,{type:"appointment",user:((x=o.currentUser)==null?void 0:x.name)||"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${mt($)} at ${ft($)}`,data:{type:"Call",date:v.date,time:v.time,assignee:v.assignee||h.assignee}})}await a.addActivity(h.id,{type:"note",user:"You",action:"postponed lead qualification task",content:`Task postponed to ${mt($)} at ${ft($)}${v.assignee?` and reassigned to ${v.assignee}`:""}`}),await a.fetchLeadById(h.id)}catch($){console.error("Failed to postpone lead task:",$)}}async function i(v){const h=t();if(h)try{if(await a.updateLead(h.id,{stage:"Validated"}),await a.addActivity(h.id,{type:"note",user:"You",action:"validated lead",content:"Lead has been validated and is ready for follow-up"}),v.scheduleFollowUp&&v.appointmentData){const x=new Date(`${v.appointmentData.date}T${v.appointmentData.time}:00`);await a.scheduleFollowUp(h.id,{dateTime:x.toISOString(),assignee:v.appointmentData.assignee||h.assignee,assigneeId:v.appointmentData.assigneeId||null,assigneeType:v.appointmentData.assigneeType||"user",teamId:v.appointmentData.teamId||null,team:v.appointmentData.team||null}),await a.addActivity(h.id,{type:"appointment",user:"You",action:"scheduled follow-up call",content:`Follow-up call scheduled for ${mt(x)} at ${ft(x)}`})}await a.fetchLeadById(h.id)}catch(x){console.error("Failed to validate lead:",x)}}async function u(){const v=t();if(v)try{const h=await a.convertLeadToOpportunity(v.id);o.canAccessOpportunities()?r.push({path:`/tasks/${h}`,query:{type:"opportunity"}}):r.push("/tasks")}catch(h){console.error("Failed to qualify lead:",h)}}async function f(v){const h=t();if(h)try{const x=h.contactAttempts||[];await a.updateLead(h.id,{contactAttempts:[...x,v],lastContactAttempt:v.timestamp,totalContactAttempts:x.length+1}),await a.addActivity(h.id,{type:"call",user:"You",action:`logged call attempt - ${v.outcome}`,content:v.notes||`Call attempt via ${v.channel}`,data:{outcome:v.outcome,channel:v.channel,duration:v.duration}}),await a.fetchLeadById(h.id)}catch(x){console.error("Failed to log call attempt:",x)}}async function c(v){const h=t();if(h)try{await a.addActivity(h.id,{type:"note",user:"You",action:"added a note",content:v.content||v.text||"",data:v}),await a.fetchLeadById(h.id)}catch(x){console.error("Failed to save note:",x)}}function p(){s("open-purchase-method")}function g(){s("open-trade-in")}async function k(v){var x;const h=t();if(h)try{const $=`${v.date}T${v.time}:00`,F=new Date($);F.setHours(F.getHours()+1),await a.updateLead(h.id,{scheduledAppointment:{id:Date.now(),title:`${v.type} - ${h.customer.name}`,start:$,end:F.toISOString(),type:v.type,assignee:v.assignee,assigneeId:v.assigneeId,status:"scheduled",location:v.location||"",notes:v.notes||""}}),await a.addActivity(h.id,{type:"appointment",user:((x=o.currentUser)==null?void 0:x.name)||"You",action:"scheduled an appointment",content:`${v.type} scheduled for ${v.date} at ${v.time}`,data:{type:v.type,date:v.date,time:v.time,assignee:v.assignee}}),await a.fetchLeadById(h.id)}catch($){console.error("Failed to schedule appointment:",$)}}async function S(v){const h=t();if(h&&!(m.isClosed.value&&!v.force))try{const x=m.displayStage.value,$=v.reason==="Duplicate"?rt.CLOSED_DUPLICATE:v.category==="Not Interested"?rt.CLOSED_NOT_INTERESTED:rt.CLOSED_INVALID,F=Lt(x,$);if(F){const{updates:H,activities:ee}=F(h,$,v);await a.updateLead(h.id,H);for(const le of ee)await a.addActivity(h.id,le)}else{const H=v.reason==="Duplicate";await a.updateLead(h.id,{isDisqualified:!0,disqualifyReason:v.reason,isDuplicate:H,stage:H?"Closed Failed":"Not Valid",status:"Disqualified",scheduledAppointment:null,nextActionDue:null}),await a.addActivity(h.id,{type:"note",user:"You",action:"disqualified lead",content:`Lead disqualified - Category: ${v.category}, Reason: ${v.reason}`})}r.push("/tasks")}catch(x){console.error("Failed to disqualify lead:",x)}}async function A(){const v=t();if(v)try{const h=m.displayStage.value,x=rt.NEW,$=Lt(h,x);if($){const{updates:F,activities:H}=$(v);await a.updateLead(v.id,F);for(const ee of H)await a.addActivity(v.id,ee)}else await a.updateLead(v.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await a.addActivity(v.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await a.fetchLeadById(v.id)}catch(h){console.error("Failed to reopen lead:",h)}}function L(){const v=t();v&&v.opportunityId&&r.push({path:`/tasks/${v.opportunityId}`,query:{type:"opportunity"}})}return{handlePostponed:l,handleValidated:i,handleQualified:u,handleCallAttemptLogged:f,handleNoteSaved:c,handleOpenPurchaseMethod:p,handleOpenTradeIn:g,handleAppointmentScheduled:k,handleDisqualified:S,handleReopen:A,viewOpportunity:L}}const Io={key:0,class:"px-4 py-4 flex items-center justify-between shrink-0"},qo={class:"space-y-6"},ys={__name:"TaskManagementWidget",props:{task:{type:Object,required:!0},containerClass:{type:String,default:""},hideTitle:{type:Boolean,default:!1},hideBorder:{type:Boolean,default:!1}},setup(t){return(m,s)=>t.task?(d(),b("div",{key:0,class:j(["rounded-lg flex flex-col",t.containerClass]),style:{"background-color":"var(--base-muted, #f5f5f5)"}},[t.hideTitle?q("",!0):(d(),b("div",Io,[...s[0]||(s[0]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clipboard-check text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Manage next steps")],-1)])])),e("div",{class:j(["bg-white rounded-lg p-4 flex flex-col",t.hideBorder?"shadow-none":"shadow-sm"]),style:Nt(t.hideBorder?void 0:{boxShadow:"var(--nsc-card-shadow)"})},[De(m.$slots,"deadline-banner"),e("div",qo,[De(m.$slots,"primary-action"),De(m.$slots,"task-widgets"),De(m.$slots,"closed-state"),De(m.$slots,"secondary-actions")])],6)],2)):q("",!0)}},Oo={class:"flex justify-between items-start mb-3"},Mo={class:"font-bold text-gray-900 text-fluid-sm"},No={class:"text-fluid-xs text-gray-500 mt-0.5"},Lo={class:"flex gap-3 flex-wrap"},gs={__name:"PrimaryActionWidget",props:{action:{type:Object,required:!0},colorScheme:{type:Object,required:!0}},emits:["action-clicked"],setup(t){return(m,s)=>(d(),b("div",{class:j(["rounded-card p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Oo,[e("div",null,[e("h4",Mo,I(t.action.title),1),e("p",No,I(t.action.description),1)])]),e("div",Lo,[e("button",{onClick:s[0]||(s[0]=r=>m.$emit("action-clicked")),class:j([t.action.buttonClass,"font-medium px-4 py-2 rounded-btn text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"])},[e("i",{class:j(t.action.icon)},null,2),P(" "+I(t.action.label),1)],2)])],2))}},Eo={class:"flex items-center gap-3"},Fo={class:"flex-1"},Bo={key:0,class:"text-fluid-xs font-normal opacity-75"},Vo={__name:"DeadlineBanner",props:{nextActionDue:{type:String,default:null},isClosed:{type:Boolean,default:!1},showDeadlineBanner:{type:Boolean,default:!0},taskId:{type:[String,Number],required:!0}},emits:["dismissed"],setup(t,{emit:m}){const s=t,r=m,a=T(!1),o=D(()=>Ut(s.nextActionDue)),l=D(()=>s.isClosed||!s.showDeadlineBanner||a.value?!1:o.value.type==="overdue"||o.value.type==="urgent"),i=()=>{a.value=!0,r("dismissed")};return(u,f)=>l.value?(d(),b("div",{key:0,class:j(["mx-4 mt-4 px-4 py-3 rounded-lg border flex items-center justify-between",[o.value.bgClass,o.value.borderClass]])},[e("div",Eo,[e("div",{class:j(["w-9 h-9 rounded-lg flex items-center justify-center",[o.value.bgClass,o.value.borderClass,"border"]])},[e("i",{class:j(["text-sm",[`fa-solid ${o.value.icon}`,o.value.textClass]])},null,2)],2),e("div",Fo,[f[0]||(f[0]=e("div",{class:"text-fluid-xs font-medium text-gray-600 mb-0.5"},"Next Action Due",-1)),e("div",{class:j(["text-fluid-sm font-bold",o.value.textClass])},[P(I(n(ss)(t.nextActionDue))+" ",1),o.value.type!=="overdue"?(d(),b("span",Bo," ("+I(n(zt)(t.nextActionDue))+") ",1)):q("",!0)],2)]),o.value.type==="overdue"?(d(),b("div",{key:0,class:j(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...f[1]||(f[1]=[e("i",{class:"fa-solid fa-exclamation-circle mr-1"},null,-1),P(" Overdue ",-1)])],2)):o.value.type==="urgent"?(d(),b("div",{key:1,class:j(["text-fluid-xs font-bold uppercase px-2.5 py-1 rounded-md",[o.value.bgClass,o.value.textClass,o.value.borderClass,"border"]])},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-bolt mr-1"},null,-1),P(" Urgent ",-1)])],2)):q("",!0)]),e("button",{onClick:i,class:"w-6 h-6 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors ml-2 shrink-0",title:"Dismiss"},[...f[3]||(f[3]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1)])])],2)):q("",!0)}},Ro=(t,m)=>{if(!t||!m)return[];const s=new Date(m).getDay();if(s===0||s===6)return[];const[a,o]=t.split("-"),l=parseInt(o);return a==="team"?Uo(l,m):a==="user"?jo(l,m,s):[]},jo=(t,m,s)=>{const r={1:{1:["09:00","09:30","10:00","10:30","11:00"],2:["09:00","10:00","11:00","14:00","15:00"],3:["09:00","09:30","10:30","11:00"],4:["09:00","10:00","11:00","14:00","16:00"],5:["09:00","10:00","11:00"]},2:{1:["14:00","14:30","15:00","15:30","16:00"],2:["13:00","14:00","15:00","16:00","17:00"],3:["14:00","15:00","16:00","17:00"],4:["13:00","14:30","15:00","16:00"],5:["14:00","15:00","16:00"]},3:{1:["09:00","10:30","14:00","15:30"],2:["09:30","11:00","14:00","16:00"],3:["10:00","11:30","14:30","16:00"],4:["09:00","11:00","14:00","15:00"],5:["10:00","11:00","14:00","15:00"]},4:{1:["09:00","10:00","11:00","13:00","14:00","15:00","16:00"],2:["09:00","10:30","11:30","14:00","15:00","16:30"],3:["09:30","10:00","11:00","14:00","15:30","16:00"],4:["09:00","10:00","11:30","13:30","15:00","16:00"],5:["09:00","10:00","11:00","14:00","15:00"]}};return(r[t]||r[1])[s]||[]},Uo=(t,m)=>{const s=new Date(m).getDay(),r=["09:00","09:30","10:00","10:30","11:00","11:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return t===1?s===1||s===4?["09:00","11:00","14:00","16:00"]:["10:00","14:00","15:00"]:t===2?r.filter((a,o)=>o%2===0):r},zo={class:"space-y-6"},Wo={class:"space-y-3"},Ho={key:0,class:"space-y-4"},Po={class:"flex gap-2"},_o={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Qo={class:"flex items-center justify-between mb-4"},Yo={class:"text-fluid-sm font-semibold text-heading"},Go={class:"grid grid-cols-7 gap-1 mb-2"},Jo={class:"grid grid-cols-7 gap-1"},Ko=["onClick"],Zo={class:"text-fluid-sm font-semibold text-heading mb-4"},Xo={key:0,class:"space-y-2"},ei=["onClick"],ti={key:1,class:"text-fluid-sm text-sub py-4 text-center"},si={key:2,class:"text-fluid-sm text-sub py-4 text-center"},ni={__name:"ScheduleAppointmentModal",props:{show:{type:Boolean,required:!0},preselectedAssignee:{type:Object,default:null}},emits:["close","confirm"],setup(t,{emit:m}){const s=t,r=m,a=pt(),o=It(),l=T("assign-and-schedule"),i=T(""),u=T(null),f=T(""),c=T(""),p=T("30min"),g=T(new Date().getMonth()),k=T(new Date().getFullYear()),S=T(null);D(()=>o.assignableUsers),D(()=>o.assignableTeams);const A=D(()=>new Date(k.value,g.value).toLocaleDateString("en-US",{month:"long",year:"numeric"})),L=D(()=>{const J=new Date(k.value,g.value,1),U=new Date(k.value,g.value+1,0).getDate(),oe=J.getDay(),N=[];for(let W=0;W<oe;W++)N.push(null);for(let W=1;W<=U;W++)N.push(W);return N}),v=D(()=>{if(!S.value||!f.value)return"Select a date";const J=new Date(f.value),V=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${V[J.getDay()]}, ${U[J.getMonth()]} ${J.getDate()}`}),h=J=>{if(!J||!f.value)return!1;const V=new Date(f.value);return V.getDate()===J&&V.getMonth()===g.value&&V.getFullYear()===k.value},x=J=>{if(!J)return;const V=new Date(k.value,g.value,J);f.value=V.toISOString().split("T")[0],S.value=J,c.value=""},$=()=>{g.value===0?(g.value=11,k.value--):g.value--},F=()=>{g.value===11?(g.value=0,k.value++):g.value++},H=D(()=>!f.value||!u.value?[]:Ro(u.value,f.value)),ee=()=>{var J;if(s.preselectedAssignee){const{type:V,id:U}=s.preselectedAssignee;u.value=`${V}-${U}`}else u.value=`user-${((J=a.currentUser)==null?void 0:J.id)||1}`};ee();const le=D(()=>l.value==="assign-only"?!0:!!(i.value&&f.value&&c.value&&u.value));Ee(()=>s.show,J=>{J?ee():ne()}),Ee(f,()=>{c.value=""});const ne=()=>{l.value="assign-and-schedule",i.value="",f.value="",c.value="",p.value="30min",S.value=null;const J=new Date;g.value=J.getMonth(),k.value=J.getFullYear()},me=J=>{J||r("close")},ge=()=>{if(!le.value)return;const J=u.value.startsWith("team-"),V=parseInt(u.value.split("-")[1]);let U={};if(J){const N=o.getTeamById(V);U={assigneeType:"team",teamId:V,team:(N==null?void 0:N.name)||"Unknown Team",assignee:null,assigneeId:null}}else{const N=o.getUserById(V);U={assigneeType:"user",assigneeId:V,assignee:(N==null?void 0:N.name)||"Unknown",teamId:null,team:null}}const oe={...U};l.value==="assign-and-schedule"&&(oe.type=i.value,oe.date=f.value,oe.time=c.value,oe.duration=p.value),r("confirm",oe),r("close")},ke=()=>{r("close")};return(J,V)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":me},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-4xl"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),{class:"text-fluid-lg"},{default:O(()=>[...V[6]||(V[6]=[P("Schedule Appointment",-1)])]),_:1})]),_:1}),e("div",zo,[e("div",Wo,[e("label",{class:j(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",l.value==="assign-only"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[te(e("input",{type:"radio","onUpdate:modelValue":V[0]||(V[0]=U=>l.value=U),value:"assign-only",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[Ke,l.value]]),V[7]||(V[7]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign only",-1))],2),e("label",{class:j(["flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all",l.value==="assign-and-schedule"?"border-green-600 bg-green-50":"border-E5E7EB hover:border-green-600/30"])},[te(e("input",{type:"radio","onUpdate:modelValue":V[1]||(V[1]=U=>l.value=U),value:"assign-and-schedule",class:"w-4 h-4 text-green-600 focus:ring-green-600 border-gray-300"},null,512),[[Ke,l.value]]),V[8]||(V[8]=e("span",{class:"text-fluid-sm font-medium text-heading"},"Assign and schedule",-1))],2)]),l.value==="assign-and-schedule"?(d(),b("div",Ho,[V[14]||(V[14]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Schedule",-1)),e("div",null,[V[10]||(V[10]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Event type",-1)),te(e("select",{"onUpdate:modelValue":V[2]||(V[2]=U=>i.value=U),class:"input text-fluid-sm w-full"},[...V[9]||(V[9]=[e("option",{value:"",disabled:""},"Select event type",-1),e("option",null,"Showroom Visit",-1),e("option",null,"Test Drive",-1),e("option",null,"Video Call",-1),e("option",null,"Home Visit",-1),e("option",null,"Closing Meeting",-1)])],512),[[ut,i.value]])]),e("div",null,[V[11]||(V[11]=e("label",{class:"block text-fluid-xs font-medium text-sub mb-1.5"},"Duration",-1)),e("div",Po,[e("button",{onClick:V[3]||(V[3]=U=>p.value="30min"),class:j(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",p.value==="30min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 30min ",2),e("button",{onClick:V[4]||(V[4]=U=>p.value="60min"),class:j(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",p.value==="60min"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," 60min ",2),e("button",{onClick:V[5]||(V[5]=U=>p.value="custom"),class:j(["px-4 py-2 border-2 rounded-lg text-fluid-sm font-medium transition-all",p.value==="custom"?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30"])}," Custom ",2)])]),e("div",_o,[e("div",null,[e("div",Qo,[e("button",{onClick:$,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...V[12]||(V[12]=[e("i",{class:"fa-solid fa-chevron-left text-fluid-sm text-body"},null,-1)])]),e("h6",Yo,I(A.value),1),e("button",{onClick:F,class:"p-1 hover:bg-surfaceSecondary rounded transition-colors"},[...V[13]||(V[13]=[e("i",{class:"fa-solid fa-chevron-right text-fluid-sm text-body"},null,-1)])])]),e("div",Go,[(d(),b(ye,null,we(["SUN","MON","TUE","WED","THU","FRI","SAT"],U=>e("div",{key:U,class:"text-center text-fluid-xs font-medium text-sub py-2"},I(U),1)),64))]),e("div",Jo,[(d(!0),b(ye,null,we(L.value,(U,oe)=>(d(),b("div",{key:oe,onClick:N=>x(U),class:j(["aspect-square flex items-center justify-center text-fluid-sm font-medium rounded-lg cursor-pointer transition-all",h(U)?"bg-green-600 text-white":U?"text-body hover:bg-surfaceSecondary":"text-transparent"])},I(U),11,Ko))),128))])]),e("div",null,[e("h6",Zo,I(v.value),1),f.value&&H.value.length>0?(d(),b("div",Xo,[(d(!0),b(ye,null,we(H.value,U=>(d(),b("button",{key:U,onClick:oe=>c.value=U,class:j(["w-full py-2 px-4 border-2 rounded-lg text-fluid-sm font-medium text-left transition-all",c.value===U?"border-green-600 bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-green-600/30 hover:bg-surfaceSecondary/50"])},I(U),11,ei))),128))])):f.value&&H.value.length===0?(d(),b("div",ti," No available time slots for this date ")):(d(),b("div",si," Select a date to see available time slots "))])])])):q("",!0)]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 mt-6"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm",onClick:ke}),w(n(Z),{label:"Confirm Appointment",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto text-fluid-sm !bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black",disabled:!le.value,onClick:ge},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ai={key:1,class:"space-y-4"},li={class:"flex items-center justify-between"},oi={class:"space-y-4"},ii={class:"block text-fluid-sm font-medium text-body"},ri=["onUpdate:modelValue","placeholder"],di=["onUpdate:modelValue"],ui=["value"],ci={key:2,class:"space-y-2"},pi=["onUpdate:modelValue","value"],mi={class:"flex gap-2 flex-wrap justify-end pt-2"},_e={__name:"SurveyWidget",props:{questions:{type:Array,required:!0},initialExpanded:{type:Boolean,default:!1}},emits:["survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=T(s.initialExpanded),o=T({});Ee(()=>s.questions,c=>{const p={};c.forEach(g=>{p[g.key]=""}),o.value=p},{immediate:!0});const l=()=>{r("survey-completed",{...o.value}),f()},i=()=>{r("survey-refused"),f()},u=()=>{r("not-responding"),f()},f=()=>{a.value=!1;const c={};s.questions.forEach(p=>{c[p.key]=""}),o.value=c};return(c,p)=>(d(),b("div",null,[a.value?(d(),b("div",ai,[e("div",li,[p[4]||(p[4]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Lead Qualification Survey",-1)),e("button",{onClick:p[1]||(p[1]=g=>a.value=!1),class:"text-fluid-xs text-sub hover:text-body transition-colors"},[...p[3]||(p[3]=[e("i",{class:"fa-solid fa-chevron-up"},null,-1)])])]),e("div",oi,[(d(!0),b(ye,null,we(t.questions,(g,k)=>(d(),b("div",{key:k,class:"space-y-2"},[e("label",ii,I(g.label),1),g.type==="text"?te((d(),b("textarea",{key:0,"onUpdate:modelValue":S=>o.value[g.key]=S,placeholder:g.placeholder,rows:"3",class:"input resize-none text-fluid-sm py-2 px-3 w-full"},null,8,ri)),[[xe,o.value[g.key]]]):g.type==="select"?te((d(),b("select",{key:1,"onUpdate:modelValue":S=>o.value[g.key]=S,class:"input text-fluid-sm py-2 px-3 w-full"},[p[5]||(p[5]=e("option",{value:""},"Select an option...",-1)),(d(!0),b(ye,null,we(g.options,S=>(d(),b("option",{key:S,value:S},I(S),9,ui))),128))],8,di)),[[ut,o.value[g.key]]]):g.type==="radio"?(d(),b("div",ci,[(d(!0),b(ye,null,we(g.options,S=>(d(),b("label",{key:S,class:"flex items-center text-fluid-sm text-body cursor-pointer"},[te(e("input",{type:"radio","onUpdate:modelValue":A=>o.value[g.key]=A,value:S,class:"mr-2 w-4 h-4 text-brand-red focus:ring-brand-red border-gray-300"},null,8,pi),[[Ke,o.value[g.key]]]),P(" "+I(S),1)]))),128))])):q("",!0)]))),128)),e("div",mi,[w(n(Z),{label:"Complete Survey",variant:"primary",size:"small",onClick:l,class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600"}),w(n(Z),{label:"Customer Refused",variant:"outline",size:"small",onClick:i}),w(n(Z),{label:"Not Responding",variant:"outline",size:"small",onClick:u})])])])):(d(),b("button",{key:0,onClick:p[0]||(p[0]=g=>a.value=!0),class:"w-full flex items-center justify-between text-fluid-sm text-body hover:text-heading py-2 transition-colors"},[...p[2]||(p[2]=[e("span",{class:"font-medium"},"Lead Qualification Survey",-1),e("i",{class:"fa-solid fa-chevron-down text-fluid-xs text-sub"},null,-1)])]))]))}},fi={class:"space-y-3"},yi={class:"space-y-2"},gi={key:0,class:"font-semibold text-heading text-fluid-sm mb-2"},vi={class:"grid grid-cols-4 gap-2"},bi={key:0},hi={__name:"CommunicationSelector",props:{title:{type:String,default:"Send follow-up message"},showEmail:{type:Boolean,default:!0},showSMS:{type:Boolean,default:!0},showWhatsApp:{type:Boolean,default:!0},showDontSend:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["send","cancel","dont-send"],setup(t,{emit:m}){const s=m,r=T(null),a=i=>{i==="dont-send"?(r.value="dont-send",s("dont-send")):r.value=i},o=i=>{s("send",i),r.value=null},l=()=>{r.value=null,s("cancel")};return(i,u)=>(d(),b("div",fi,[e("div",yi,[t.title?(d(),b("h5",gi,I(t.title),1)):q("",!0),e("div",vi,[t.showEmail?(d(),b("button",{key:0,onClick:u[0]||(u[0]=f=>a("email")),class:j(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="email"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-envelope text-xs"},null,-1),e("span",null,"Email",-1)])],2)):q("",!0),t.showSMS?(d(),b("button",{key:1,onClick:u[1]||(u[1]=f=>a("sms")),class:j(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="sms"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[5]||(u[5]=[e("i",{class:"fa-solid fa-message text-xs"},null,-1),e("span",null,"SMS",-1)])],2)):q("",!0),t.showWhatsApp?(d(),b("button",{key:2,onClick:u[2]||(u[2]=f=>a("whatsapp")),class:j(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="whatsapp"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[6]||(u[6]=[e("i",{class:"fa-brands fa-whatsapp text-xs"},null,-1),e("span",null,"WhatsApp",-1)])],2)):q("",!0),t.showDontSend?(d(),b("button",{key:3,onClick:u[3]||(u[3]=f=>a("dont-send")),class:j(["flex items-center justify-center gap-2 px-3 py-1.5 text-fluid-xs font-medium rounded-lg border transition-all",r.value==="dont-send"?"border-green-600 bg-surfaceSecondary text-heading":"border-D1D5DB bg-white text-body hover:border-brand-dark/30"])},[...u[7]||(u[7]=[e("i",{class:"fa-solid fa-xmark text-xs"},null,-1),e("span",null,"Don't send",-1)])],2)):q("",!0)])]),r.value&&r.value!=="dont-send"?(d(),b("div",bi,[r.value==="email"?(d(),Q(cn,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:l},null,8,["initial-template","initial-message"])):r.value==="sms"?(d(),Q(pn,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:l},null,8,["initial-template","initial-message"])):r.value==="whatsapp"?(d(),Q(mn,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:l},null,8,["initial-template","initial-message"])):q("",!0)])):q("",!0)]))}};function xi(){const t=Js(),m=T(!1),s=T(!1),r=T(0),a=T(""),o=T(null),l=T({}),i=T(null),u={leadLines:["Yes, this is Josh Adams speaking.","Oh, hi Michael! Yes, I was waiting for your call.","That sounds great. I'm definitely interested in seeing it."],salesLines:["Hi Josh, Michael here regarding your Audi A6 inquiry.","Great. I see you're interested in the Allroad. Do you have a vehicle you'd like to trade in?"]},f=D(()=>{const A=Math.floor(r.value/60),L=r.value%60;return`${A.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`}),c=()=>{m.value=!0,r.value=0,s.value=!1,a.value="",o.value=setInterval(()=>{r.value++,r.value>=20&&p()},1e3)},p=()=>{o.value&&(clearInterval(o.value),o.value=null),m.value=!1,s.value=!0,l.value={duration:r.value,notes:a.value,transcription:u,channel:"phone"}},g=async A=>{try{await navigator.clipboard.writeText(A),t.pushToast("success","Phone number copied to clipboard!")}catch{t.pushToast("error","Failed to copy phone number")}},k=A=>(i.value={tradeIn:u.leadLines.some(L=>L.toLowerCase().includes("trade")||L.toLowerCase().includes("exchange"))||!1,financing:u.leadLines.some(L=>L.toLowerCase().includes("financ")||L.toLowerCase().includes("payment")||L.toLowerCase().includes("loan"))||!1},i.value.tradeIn&&A&&(A.value.tradeIn=!0),i.value.financing&&A&&(A.value.financing=!0),i.value),S=()=>{m.value=!1,s.value=!1,r.value=0,a.value="",l.value={},o.value&&(clearInterval(o.value),o.value=null)};return Ks(()=>{o.value&&clearInterval(o.value)}),{isCallActive:m,callEnded:s,callDuration:r,callNotes:a,callData:l,extractedData:i,mockTranscription:u,formattedCallDuration:f,startCall:c,endCall:p,copyNumber:g,extractInformation:k,resetCall:S}}function wi(t,m,s,r,a,o){var R,Y,ae;const l=T(!1),i=T(null),u=T(!1),f=T(!1),c=T(!1),p=T(""),g=T(null),k=[{value:"whatsapp",label:"WhatsApp"},{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"dont-send",label:"Don't send"}],S=T("whatsapp"),A=T("followup-1"),L=T(null),v=T(""),h=T("09:00"),x=T(null),$=T("Not Interested"),F=T(""),H=T({dealership:((Y=(R=t.value)==null?void 0:R.requestedCar)==null?void 0:Y.dealership)||"Barcelona",team:"Audi Sales (New)",assigneeId:((ae=o==null?void 0:o.value)==null?void 0:ae.id)||null}),ee=T({tradeIn:!1,financing:!1,contactAvailability:!1}),le=T(!1),ne=T(null),me=T(!0),ge=T(null),ke=T(null),J=T("assign-only"),V=T(""),U=T(null),oe=T(""),N=T(new Date(new Date().getFullYear(),new Date().getMonth(),1)),W=T(new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate())),qe=T(""),Ve=D(()=>{const C=N.value;return!C||!(C instanceof Date)?"":C.toLocaleString(void 0,{month:"long",year:"numeric"})}),G=D(()=>{const C=N.value;if(!C||!(C instanceof Date))return[];const B=C.getFullYear(),X=C.getMonth(),ue=new Date(B,X,1).getDay(),Ce=new Date(B,X+1,0).getDate(),Ie=[];for(let Ae=0;Ae<ue;Ae++)Ie.push(null);for(let Ae=1;Ae<=Ce;Ae++)Ie.push(new Date(B,X,Ae));for(;Ie.length<42;)Ie.push(null);return Ie}),$e=D(()=>{const C=W.value;return!C||!(C instanceof Date)?"Select a date":C.toLocaleDateString(void 0,{weekday:"short",day:"2-digit",month:"short"})}),Te=D(()=>{const C=[];for(let B=9*60;B<=18*60;B+=30){const X=String(Math.floor(B/60)).padStart(2,"0"),se=String(B%60).padStart(2,"0");C.push(`${X}:${se}`)}return C}),K=()=>{const C=N.value;C&&(N.value=new Date(C.getFullYear(),C.getMonth()-1,1))},_=()=>{const C=N.value;C&&(N.value=new Date(C.getFullYear(),C.getMonth()+1,1))},de=(C,B)=>!C||!B?!1:C.getFullYear()===B.getFullYear()&&C.getMonth()===B.getMonth()&&C.getDate()===B.getDate(),be=C=>{C&&(W.value=C,qe.value="")},Fe=D(()=>{if(U.value!=null)return U.value;const C=parseInt(oe.value,10);return Number.isFinite(C)&&C>0?C:null}),Re=D(()=>{var se,ue,Ce,Ie,Ae,He,xt;const C=((Ce=(ue=(se=t.value)==null?void 0:se.customer)==null?void 0:ue.name)==null?void 0:Ce.split(" ")[0])||"",B=((Ae=(Ie=t.value)==null?void 0:Ie.requestedCar)==null?void 0:Ae.brand)||"",X=((xt=(He=t.value)==null?void 0:He.requestedCar)==null?void 0:xt.model)||"";return{"followup-1":`Hi ${C}! I tried calling you earlier but couldn't reach you. When would be a good time to discuss the ${B} ${X}?`,"followup-2":`Hello ${C}, this is regarding your inquiry about the ${B} ${X}. Please let me know when you're available for a call.`,custom:""}}),ie=D(()=>A.value==="custom"?"Type your custom message...":Re.value[A.value]||""),re=D(()=>{var C;return!!((C=t.value)!=null&&C.scheduledAppointment)}),ce=()=>{const C=new Date,B=C.getHours(),X=C.getDay();let se=new Date,ue="10:00",Ce="";if(X===5&&B>=15)se.setDate(C.getDate()+3),ue="10:00",Ce="Optimal time after weekend, customer likely refreshed";else if(X===6||X===0)se.setDate(C.getDate()+(X===6?2:1)),ue="10:00",Ce="Weekend follow-up avoided, better response rate on weekdays";else if(B>=17)se.setDate(C.getDate()+1),ue="10:00",Ce="Business hours preferred, higher engagement rate";else if(B<9)se=new Date(C),se.setHours(10,0,0,0),ue="10:00",Ce="Peak response time, customers more available mid-morning";else if(B<14){se=new Date(C);const He=B+2;se.setHours(He,0,0,0),ue=`${String(He).padStart(2,"0")}:00`,Ce="Follow-up within same day increases conversion likelihood"}else se.setDate(C.getDate()+1),se.setHours(10,0,0,0),ue="10:00",Ce="Next morning follow-up maintains momentum";const Ie=se.toISOString().split("T")[0],Ae=`${Ie}T${ue}:00`;return{date:Ie,time:ue,dateTime:Ae,reason:Ce,formattedDate:se.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}};return{showOutcomeSelection:l,selectedOutcome:i,showNoteModal:u,showScheduleAppointmentModal:f,followupChannels:k,followupChannel:S,selectedTemplate:A,rescheduleTime:L,customDate:v,customTime:h,disqualifyCategory:$,disqualifyReason:F,assignment:H,preferences:ee,surveyCompleted:le,surveyResponses:ne,showSurvey:me,aiSuggestionData:x,showCallLogForm:c,callLogDateTime:p,callLogAssignee:g,messageTemplates:Re,messagePreview:ie,hasExistingAppointment:re,selectOutcome:C=>{i.value=C,C==="interested"&&(le.value=!1,ne.value=null,me.value=!0,s!=null&&s.value&&(ee.value.tradeIn=s.value.tradeIn||!1,ee.value.financing=s.value.financing||!1))},cancelOutcome:()=>{i.value=null,l.value=!1,c.value=!1},calculateNextCallDate:()=>{if(L.value==="tomorrow-9am"){const B=new Date;return B.setDate(B.getDate()+1),B.setHours(9,0,0,0),B.toISOString()}else if(L.value==="monday"){if(x.value)return new Date(x.value.dateTime).toISOString();const B=new Date,X=(8-B.getDay())%7||7;return B.setDate(B.getDate()+X),B.setHours(9,0,0,0),B.toISOString()}else if(L.value==="custom"&&v.value&&h.value)return new Date(`${v.value}T${h.value}:00`).toISOString();const C=new Date;return C.setDate(C.getDate()+1),C.setHours(9,0,0,0),C.toISOString()},calculateAISuggestion:ce,handleAISuggestionClick:()=>{L.value="monday",x.value=ce()},resetOutcomeState:()=>{i.value=null,l.value=!1,S.value="whatsapp",A.value="followup-1",L.value=null,v.value="",h.value="09:00",$.value="Not Interested",F.value="",le.value=!1,ne.value=null,me.value=!0,x.value=null,c.value=!1,p.value="",g.value=null,ge.value=null,ke.value=null,J.value="assign-only",V.value="",U.value=null,oe.value="",qe.value="";const C=new Date;N.value=new Date(C.getFullYear(),C.getMonth(),1),W.value=new Date(C.getFullYear(),C.getMonth(),C.getDate())},initCallLogForm:()=>{const C=new Date,B=C.getFullYear(),X=String(C.getMonth()+1).padStart(2,"0"),se=String(C.getDate()).padStart(2,"0"),ue=String(C.getHours()).padStart(2,"0"),Ce=String(C.getMinutes()).padStart(2,"0");p.value=`${B}-${X}-${se}T${ue}:${Ce}`,o!=null&&o.value&&(g.value=o.value),c.value=!0},confirmCallLogForm:()=>{l.value=!0},cancelCallLogForm:()=>{c.value=!1,p.value="",g.value=null},clearSuccessState:()=>{ge.value=null,ke.value=null},successState:ge,successPerformedAt:ke,qualificationMethod:J,qualificationEventType:V,qualificationDurationMinutes:U,qualificationCustomDuration:oe,qualificationCalendarMonth:N,qualificationSelectedDate:W,qualificationSelectedSlot:qe,qualificationCalendarMonthLabel:Ve,qualificationCalendarDayCells:G,qualificationSelectedDayLabel:$e,qualificationScheduleSlotOptions:Te,qualificationDurationValue:Fe,qualificationGoPrevMonth:K,qualificationGoNextMonth:_,qualificationIsSameDay:de,qualificationSelectDate:be}}function ki(t,m,s,r,a,o,l,i){const{callData:u}=m,{showOutcomeSelection:f,selectedOutcome:c,assignment:p,preferences:g,cancelOutcome:k,calculateNextCallDate:S,showScheduleAppointmentModal:A,surveyCompleted:L,surveyResponses:v,showSurvey:h,initCallLogForm:x,callLogDateTime:$,callLogAssignee:F,successState:H,successPerformedAt:ee,rescheduleTime:le,aiSuggestionData:ne,customDate:me,customTime:ge,qualificationMethod:ke,qualificationEventType:J,qualificationDurationValue:V,qualificationSelectedDate:U,qualificationSelectedSlot:oe}=s,N=()=>{var ie;return((ie=i==null?void 0:i.value)==null?void 0:ie.name)||"Unknown"},W=()=>le.value==="tomorrow-9am"?"Tomorrow 9:00 AM":le.value==="monday"&&ne.value?`${ne.value.formattedDate} at ${ne.value.time}`:le.value==="monday"?"Monday":le.value==="custom"&&me.value&&ge.value?`${me.value} ${ge.value}`:"selected time";return{logManualCall:()=>{u.value={channel:"external",notes:"",transcription:null},x()},handleScheduleAppointmentConfirm:async ie=>{A.value=!1,t("appointment-scheduled",ie)},handleQualify:()=>{var Se,Me,he,We,lt,M,R;const ie={timestamp:new Date().toISOString(),outcome:"interested",channel:((Se=u.value)==null?void 0:Se.channel)||"phone",notes:((Me=u.value)==null?void 0:Me.notes)||"",transcription:((he=u.value)==null?void 0:he.transcription)||null};t("call-attempt-logged",ie),t("validated",{scheduleFollowUp:!1});const re=((lt=(We=p.value)==null?void 0:We.assignee)==null?void 0:lt.name)||"Unassigned";let ce=null,fe=!1,Oe=null;if(ke.value==="assign-and-schedule"&&U.value&&oe.value){const Y=U.value,ae=Y.toLocaleDateString(void 0,{month:"long",day:"numeric"}),C={"test-drive":"Test drive","video-call":"Video call","phone-call":"Phone call","in-store-visit":"In-store visit"}[J.value]||J.value;fe=!0,Oe={datetime:Y,time:oe.value,type:C,assignee:re,duration:V.value},ce={date:ae,time:oe.value,title:C,name:((R=(M=r.value)==null?void 0:M.customer)==null?void 0:R.name)||"",location:re},t("appointment-scheduled",Oe)}t("qualified",{assignment:p.value,preferences:g.value,scheduleAppointment:fe,appointmentData:Oe,surveyData:L.value?v.value:null});let Be=`Qualified - Assigned to ${re}`;ce&&(Be=`Qualified - Assigned to ${re}, meeting on ${ce.date} ${ce.time}`),H.value={kind:"qualified",statusText:Be,meeting:ce,actorName:N()},ee.value=new Date,k()},handleDisqualifyFromInterested:()=>{var re,ce,fe;const ie={timestamp:new Date().toISOString(),outcome:"interested",channel:((re=u.value)==null?void 0:re.channel)||"phone",notes:((ce=u.value)==null?void 0:ce.notes)||"",transcription:((fe=u.value)==null?void 0:fe.transcription)||null};t("call-attempt-logged",ie),c.value="not-valid"},handleNoAnswerConfirm:async()=>{var Be,Se,Me,he;const ie={timestamp:new Date().toISOString(),outcome:"no-answer",channel:((Be=u.value)==null?void 0:Be.channel)||"phone",notes:((Se=u.value)==null?void 0:Se.notes)||"",transcription:((Me=u.value)==null?void 0:Me.transcription)||null};t("call-attempt-logged",ie);const re=S(),ce=re.split("T")[0],fe=new Date(re).toTimeString().slice(0,5);if(l&&((he=r.value)!=null&&he.id))try{await l.updateLead(r.value.id,{nextActionDue:re,status:"Pending"})}catch(We){console.error('Failed to update lead status to "to be called back":',We)}t("postponed",{date:ce,time:fe,createAppointment:!0}),(a==null?void 0:a.value)+1>=(o==null?void 0:o.value)&&t("disqualified",{category:"Not Interested",reason:"Unreachable"});const Oe=W();H.value={kind:"no-answer",statusText:`Message sent - Rescheduled to ${Oe}`,actorName:N()},ee.value=new Date,k()},handleNotValidConfirm:()=>{var re,ce,fe;const ie={timestamp:new Date().toISOString(),outcome:"not-valid",channel:((re=u.value)==null?void 0:re.channel)||"phone",notes:((ce=u.value)==null?void 0:ce.notes)||"",transcription:((fe=u.value)==null?void 0:fe.transcription)||null};t("call-attempt-logged",ie),t("disqualified",{category:s.disqualifyCategory.value,reason:s.disqualifyReason.value}),H.value={kind:"not-interested",statusText:"Closed - Not interested",actorName:N()},ee.value=new Date,k()},handleNoteSave:ie=>{s.showNoteModal.value=!1,t("note-saved",ie)},handleSurveyCompleted:async ie=>{var re;if(v.value=ie,L.value=!0,h.value=!1,l&&((re=r.value)!=null&&re.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:JSON.stringify(ie),timestamp:new Date().toISOString()})}catch(ce){console.error("Failed to save survey activity:",ce)}t("survey-completed",{lead:r.value,responses:ie})},handleSurveyRefused:async()=>{var ie;if(h.value=!1,l&&((ie=r.value)!=null&&ie.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer refused to complete survey",timestamp:new Date().toISOString()})}catch(re){console.error("Failed to save survey refusal activity:",re)}t("survey-refused",{lead:r.value})},handleNotResponding:async()=>{var ie;if(h.value=!1,l&&((ie=r.value)!=null&&ie.id))try{await l.addActivity(r.value.id,{type:"survey",action:"Lead Qualification Survey",content:"Customer not responding to survey",timestamp:new Date().toISOString()})}catch(re){console.error("Failed to save survey not responding activity:",re)}t("not-responding",{lead:r.value})},handleReopen:()=>{s.clearSuccessState(),s.resetOutcomeState()}}}const Ci={class:"flex gap-2 items-center mb-4"},Si={key:0,class:"mb-4 space-y-4 border-t border pt-4"},$i={key:0,class:"bg-slate-900 text-white rounded-card p-4"},Ai={class:"flex items-center justify-between mb-4 pb-3 border-b border-slate-700"},Di={class:"flex items-center gap-2 text-red-400"},Ti={class:"text-xs font-mono"},Ii={class:"space-y-3 text-sm font-mono"},qi={class:"ml-2"},Oi={class:"ml-2"},Mi={key:0},Ni={class:"ml-2"},Li={key:1},Ei={class:"ml-2"},Fi={key:2},Bi={class:"ml-2"},Vi={class:"mt-4 pt-4 border-t border-slate-700"},Ri=["model-value"],ji={class:"mt-4 flex justify-end"},Ui={key:1,class:"bg-blue-50 border border-blue-200 rounded-card p-4"},zi={class:"flex items-center justify-between"},Wi={class:"flex gap-2"},Hi={__name:"CallInterface",props:{isCallActive:{type:Boolean,required:!0},callEnded:{type:Boolean,required:!0},callDuration:{type:Number,required:!0},callNotes:{type:String,required:!0},formattedCallDuration:{type:String,required:!0},mockTranscription:{type:Object,required:!0},showOutcomeSelection:{type:Boolean,required:!0},showCallLogForm:{type:Boolean,default:!1},contactAttempts:{type:Number,required:!0},maxContactAttempts:{type:Number,required:!0}},emits:["start-call","end-call","log-manual-call","extract-information","update:call-notes","copy-number"],setup(t){return(m,s)=>(d(),b("div",null,[e("div",Ci,[e("button",{onClick:s[0]||(s[0]=r=>m.$emit("start-call")),class:j(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",t.isCallActive?"bg-brand-red text-white border-brand-red":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[s[6]||(s[6]=e("i",{class:"fa-solid fa-phone text-xs"},null,-1)),P(" "+I(t.contactAttempts>0?"Call Again":"Initiate Call"),1)],2),e("button",{onClick:s[1]||(s[1]=r=>m.$emit("log-manual-call")),class:j(["border font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors",t.callEnded&&!t.isCallActive?"bg-blue-50 border-blue-200 text-blue-700":"bg-surface hover:bg-surfaceSecondary border-E5E7EB text-body"])},[...s[7]||(s[7]=[e("i",{class:"fa-solid fa-clipboard-check text-xs"},null,-1),P(" Log Call Outcome ",-1)])],2)]),t.isCallActive||t.callEnded?(d(),b("div",Si,[t.isCallActive?(d(),b("div",$i,[e("div",Ai,[s[9]||(s[9]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-waveform-lines text-blue-400 animate-pulse"}),e("span",{class:"text-xs font-bold uppercase tracking-wider"},"TRANSCRIBING")],-1)),e("div",Di,[s[8]||(s[8]=e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),e("span",Ti,"REC "+I(t.formattedCallDuration),1)])]),e("div",Ii,[e("div",null,[s[10]||(s[10]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",qi,I(t.mockTranscription.leadLines[0]),1)]),e("div",null,[s[11]||(s[11]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Oi,I(t.mockTranscription.salesLines[0]),1)]),t.callDuration>=5?(d(),b("div",Mi,[s[12]||(s[12]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Ni,I(t.mockTranscription.leadLines[1]),1)])):q("",!0),t.callDuration>=8?(d(),b("div",Li,[s[13]||(s[13]=e("span",{class:"text-green-400 font-semibold"},"Sales:",-1)),e("span",Ei,I(t.mockTranscription.salesLines[1]),1)])):q("",!0),t.callDuration>=12?(d(),b("div",Fi,[s[14]||(s[14]=e("span",{class:"text-blue-400 font-semibold"},"Lead:",-1)),e("span",Bi,I(t.mockTranscription.leadLines[2]),1)])):q("",!0)]),e("div",Vi,[e("textarea",{"model-value":t.callNotes,"onUpdate:modelValue":s[2]||(s[2]=r=>m.$emit("update:call-notes",r)),placeholder:"Add a quick note about this call...",class:"w-full p-3 bg-slate-800 border border-slate-700 rounded-btn text-white text-sm placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none",rows:"3"},null,8,Ri)]),e("div",ji,[w(n(Z),{label:"End Call",variant:"primary",size:"small",onClick:s[3]||(s[3]=r=>m.$emit("end-call")),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"})])])):q("",!0),t.callEnded&&!t.isCallActive?(d(),b("div",Ui,[e("div",zi,[s[15]||(s[15]=e("div",null,[e("h4",{class:"font-bold text-heading mb-1 text-sm"},"Call Ended"),e("p",{class:"text-xs text-gray-600"},"Extract information from the transcription or log the outcome")],-1)),e("div",Wi,[w(n(Z),{label:"Extract information",variant:"primary",size:"small",onClick:s[4]||(s[4]=r=>m.$emit("extract-information")),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"}),w(n(Z),{label:"Log outcome",variant:"outline",size:"small",onClick:s[5]||(s[5]=r=>m.$emit("log-manual-call"))})])])])):q("",!0)])):q("",!0)]))}},Pi={class:"bg-greys-100 rounded-xl p-1 flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},_i={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col relative",style:{"box-shadow":"var(--nsc-card-shadow)"}},Qi={class:"flex items-center gap-3"},Yi={class:"size-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0"},Gi={class:"text-fluid-sm font-medium text-heading flex-1 pr-10"},Ji={key:0,class:"mt-4 bg-white rounded-lg border border-E5E7EB overflow-hidden shadow-sm"},Ki={class:"grid grid-cols-2 gap-3 p-4 text-fluid-sm"},Zi={class:"ml-2 font-medium text-heading"},Xi={class:"ml-2 font-medium text-heading"},er={class:"ml-2 font-medium text-heading capitalize"},tr={class:"ml-2 font-medium text-heading"},sr={class:"flex justify-end mt-4"},nr={class:"px-4 py-2 flex items-center justify-between text-fluid-sm text-sub"},ar={class:"tabular-nums"},lr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},or={class:"flex justify-between items-start mb-3"},ir={class:"font-bold text-heading text-fluid-sm"},rr={class:"text-fluid-xs text-body mt-0.5"},dr={key:0,class:"mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3"},ur={class:"text-fluid-xs text-blue-700"},cr={key:1,class:"mb-3 bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},pr={class:"flex items-center justify-between"},mr={class:"flex items-center gap-2"},fr={class:"text-fluid-xs font-semibold text-heading"},yr={key:0,class:"text-fluid-xs text-orange-600 font-medium flex items-center gap-1"},gr={class:"flex items-center gap-2 mb-3"},vr={class:"text-fluid-sm text-body font-medium"},br={class:"px-4 py-4 space-y-3"},hr={key:0,class:"space-y-4"},xr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},wr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kr={class:"flex items-center gap-3 p-3 bg-surfaceSecondary rounded-lg border border-E5E7EB"},Cr={class:"flex-1"},Sr={class:"font-medium text-fluid-sm text-heading"},$r={class:"text-fluid-xs text-sub capitalize"},Ar={class:"flex justify-end gap-2 mt-4 pt-4 border-t border-E5E7EB"},Dr={key:1,class:"space-y-4"},Tr={class:"flex flex-wrap gap-3"},Ir={key:0,class:"space-y-4"},qr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Or={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Mr={class:"grid grid-cols-3 gap-2"},Nr={key:0,class:"mt-3 grid grid-cols-2 gap-3"},Lr={key:1,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Er={class:"text-fluid-xs text-body"},Fr={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Br={key:1,class:"space-y-4"},Vr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Rr={class:"flex gap-4"},jr={class:"flex items-center gap-2 cursor-pointer"},Ur={class:"flex items-center gap-2 cursor-pointer"},zr={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},Wr={key:2,class:"space-y-4"},Hr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Pr={class:"flex gap-2 flex-wrap"},_r={key:0,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Qr={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-3"},Yr={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},Gr={class:"flex items-center justify-between mb-4"},Jr={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Kr=["onClick"],Zr={class:"flex items-center gap-3 w-full"},Xr={class:"min-w-0 flex-1"},ed={class:"font-medium text-fluid-sm text-heading truncate"},td={class:"text-fluid-xs text-sub capitalize truncate"},sd={key:0,class:"text-fluid-xs text-sub"},nd={class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},ad={class:"space-y-2"},ld={key:2,class:"bg-white rounded-lg p-4 shadow-nsc-card",style:{"box-shadow":"var(--nsc-card-shadow)"}},od={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},id=["value"],rd={class:"flex gap-2 items-center flex-wrap"},dd={class:"border border-E5E7EB rounded-lg overflow-hidden"},ud={class:"grid grid-cols-1 lg:grid-cols-2"},cd={class:"p-3"},pd={class:"flex items-center justify-between mb-3"},md={class:"text-fluid-sm font-medium text-heading"},fd={class:"flex items-center gap-1"},yd={class:"grid grid-cols-7 gap-1 mb-1"},gd={class:"grid grid-cols-7 gap-1"},vd=["onClick"],bd={class:"p-3 border-t border-E5E7EB lg:border-t-0 lg:border-l lg:border-E5E7EB"},hd={class:"text-fluid-sm font-medium text-heading mb-3"},xd={class:"space-y-2 max-h-64 overflow-auto pr-1"},wd=["onClick"],kd={key:3,class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},Cd={class:"grid grid-cols-2 gap-3 text-fluid-sm mb-3"},Sd={class:"ml-2 font-medium text-heading"},$d={class:"ml-2 font-medium text-heading"},Ad={class:"ml-2 font-medium text-heading capitalize"},Dd={class:"ml-2 font-medium text-heading"},Td={class:"flex justify-between items-center pt-3 border-t border-E5E7EB"},Id={class:"flex gap-2"},qd={__name:"LQTask",props:{lead:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["postponed","validated","qualified","disqualified","call-attempt-logged","note-saved","open-purchase-method","appointment-scheduled","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=z=>{z||(Fe.value=!1)},a=m,o=It(),l=pt();Ge();const i=ct(),u=fs(()=>s.lead,{}),f=xi(),{isCallActive:c,callEnded:p,callDuration:g,callNotes:k,callData:S,extractedData:A,mockTranscription:L,formattedCallDuration:v,startCall:h,endCall:x,copyNumber:$,extractInformation:F}=f,H=T(null),ee=T(!1),le=T(!1),ne=T(!1),me=D(()=>o.assignableUsers),ge=D(()=>l.currentUser),ke=z=>z?z.split(" ").map(y=>y[0]).join("").toUpperCase().substring(0,2):"?",J=z=>({manager:"bg-blue-100 text-blue-700",salesman:"bg-purple-100 text-purple-700",operator:"bg-orange-100 text-orange-700"})[z]||"bg-surfaceSecondary text-body",V=z=>{he.value.assignee=z,ee.value=!1},U=()=>{h()},oe=()=>{$(s.lead.customer.phone)},N=z=>{k.value=z},W=D(()=>{var z;return((z=u.primaryAction.value)==null?void 0:z.title)||"Call to Verify Contact Details"}),qe=D(()=>{var z;return((z=u.primaryAction.value)==null?void 0:z.description)||"Begin lead qualification by verifying customer contact information."}),Ve=D(()=>s.lead.scheduledAppointment?new Date(s.lead.scheduledAppointment.start)<new Date:!1),G=D(()=>!!s.lead.scheduledAppointment),$e=D(()=>G.value?{text:"Follow-up Scheduled",class:"bg-blue-100 text-blue-700"}:Ve.value?{text:"Overdue",class:"bg-red-100 text-red-700"}:{text:s.lead.nextActionDue?`Task Pending - Due ${zt(s.lead.nextActionDue)}`:"Task Pending",class:"bg-orange-100 text-orange-700"}),Te=u.contactAttempts,K=u.maxContactAttempts,_=wi(dt(s,"lead"),S,A,Te,K,ge),{showOutcomeSelection:de,selectedOutcome:be,showNoteModal:Fe,showScheduleAppointmentModal:Re,followupChannels:ie,followupChannel:re,selectedTemplate:ce,rescheduleTime:fe,customDate:Oe,customTime:Be,disqualifyCategory:Se,disqualifyReason:Me,assignment:he,preferences:We,messageTemplates:lt,messagePreview:M,hasExistingAppointment:R,selectOutcome:Y,cancelOutcome:ae,calculateNextCallDate:C,surveyCompleted:B,surveyResponses:X,showSurvey:se,aiSuggestionData:ue,handleAISuggestionClick:Ce,showCallLogForm:Ie,callLogDateTime:Ae,callLogAssignee:He,confirmCallLogForm:xt,cancelCallLogForm:vs,successState:Qe,successPerformedAt:Wt,qualificationMethod:je,qualificationEventType:wt,qualificationDurationMinutes:kt,qualificationCustomDuration:Ct,qualificationCalendarMonth:ec,qualificationSelectedDate:Ht,qualificationSelectedSlot:Ot,qualificationCalendarMonthLabel:bs,qualificationCalendarDayCells:hs,qualificationSelectedDayLabel:xs,qualificationScheduleSlotOptions:ws,qualificationDurationValue:ks,qualificationGoPrevMonth:Pt,qualificationGoNextMonth:_t,qualificationIsSameDay:Cs,qualificationSelectDate:Ss}=_;D(()=>s.activities.filter(z=>z.type==="note"));const St=D(()=>(me.value||[]).slice(0,3).map(y=>({...y,type:"user",initials:ke(y.name)})));Ee(be,z=>{var y;z==="interested"&&!((y=he.value)!=null&&y.assignee)&&St.value.length>0&&(he.value={...he.value,assignee:St.value[0]})});const $s=[{value:"test-drive",label:"Test drive"},{value:"video-call",label:"Video call"},{value:"phone-call",label:"Phone call"},{value:"in-store-visit",label:"In-store visit"}],Qt=z=>{kt.value=z,Ct.value=""},As=D(()=>{var z;return(z=he.value)!=null&&z.assignee?je.value!=="assign-and-schedule"?!0:!!(wt.value&&ks.value&&Ht.value&&Ot.value):!1}),Ds=ki(a,f,_,dt(s,"lead"),Te,K,i,ge),{logManualCall:Ts,handleScheduleAppointmentConfirm:Is,handleQualify:qs,handleDisqualifyFromInterested:Os,handleNoAnswerConfirm:Ms,handleNotValidConfirm:Ns,handleNoteSave:Ls,handleSurveyCompleted:Es,handleSurveyRefused:Fs,handleNotResponding:Bs,handleReopen:Vs}=Ds,Rs=D(()=>{if(!Wt.value)return"";const z=Wt.value,y=String(z.getDate()).padStart(2,"0"),Ne=String(z.getMonth()+1).padStart(2,"0"),Ue=String(z.getFullYear()),Le=String(z.getHours()).padStart(2,"0"),ot=String(z.getMinutes()).padStart(2,"0");return`${y}/${Ne}/${Ue} ${Le}:${ot}`}),js=[{key:"interestLevel",label:"Customer interest level?",type:"radio",options:["High","Medium","Low"]},{key:"purchaseTimeline",label:"Expected purchase timeline?",type:"select",options:["Immediate","Within 1 month","Within 3 months","Within 6 months","Just browsing"]},{key:"budgetRange",label:"Budget range (if discussed)?",type:"select",options:["Under â‚¬30k","â‚¬30k-â‚¬50k","â‚¬50k-â‚¬80k","â‚¬80k+","Not discussed"]},{key:"preferredContact",label:"Preferred contact method?",type:"radio",options:["Phone","Email","WhatsApp","SMS"]},{key:"additionalNotes",label:"Additional notes",type:"text",placeholder:"Any relevant information about customer interest or preferences..."}],{saveTradeInVehicle:Us}=fn(),zs=async z=>{var y,Ne,Ue;try{le.value=!1,We.value.financing=!0;const Le=z.type==="FIN"?"Captive Financing":z.type==="LEA"?"Leasing":"Long-Term Rental",ot=((y=z.fields)==null?void 0:y.monthlyInstalment)||0;await i.addActivity(s.lead.id,{type:"purchase-method",user:((Ne=ge.value)==null?void 0:Ne.name)||"You",action:`added a ${Le} purchase method`,content:`${Le}: â‚¬${ot.toLocaleString()}/month for ${((Ue=z.fields)==null?void 0:Ue.duration)||0} months`,data:{purchaseMethodId:z.id,type:z.type,...z.fields},timestamp:new Date().toISOString()}),a("note-saved",{type:"purchase-method",...z})}catch(Le){console.error("Error saving purchase method:",Le)}},Ws=async z=>{try{if(ne.value=!1,z.vehicleType==="tradein"||s.mode==="tradein"){const y=await Us("lead",s.lead.id,z.vehicle,z.valuation||{});We.value.tradeIn=!0,a("note-saved",{type:"tradein",id:y.activity.id,action:"added a trade-in",vehicleId:y.vehicle.id,data:y.activity.data,timestamp:y.activity.timestamp})}else{const{addVehicleToCustomer:y}=await Zs(async()=>{const{addVehicleToCustomer:Ne}=await import("./opportunities-D5y9S6Q1.js").then(Ue=>Ue.e);return{addVehicleToCustomer:Ne}},__vite__mapDeps([0,1,2]));await y(s.lead.customerId,z.vehicle),a("note-saved",{type:"vehicle",vehicleType:z.vehicleType,...z.vehicle})}}catch(y){console.error("Error saving vehicle:",y)}},Hs=async z=>{var y;try{re.value=z.type,ce.value=z.template||"";const Ne={email:"sent an email",sms:"sent an SMS",whatsapp:"sent a WhatsApp message"},Ue=((y=ge.value)==null?void 0:y.name)||"You";let Le=z.message||"";z.type==="email"&&z.subject&&(Le=`${z.subject}: ${Le}`),await i.addActivity(s.lead.id,{type:z.type,user:Ue,action:Ne[z.type]||"sent a message",content:Le,timestamp:new Date().toISOString()})}catch(Ne){console.error("Failed to save follow-up communication:",Ne)}};return(z,y)=>{var Ne,Ue,Le,ot;return d(),b("div",Pi,[n(Qe)?(d(),b(ye,{key:0},[e("div",_i,[e("div",Qi,[e("div",Yi,[w(n(Jt),{size:16,class:"text-green-600"})]),e("p",Gi,I(n(Qe).statusText),1)]),n(Qe).meeting?(d(),b("div",Ji,[e("div",Ki,[e("div",null,[y[34]||(y[34]=e("span",{class:"text-body"},"Date:",-1)),e("span",Zi,I(n(Qe).meeting.date),1)]),e("div",null,[y[35]||(y[35]=e("span",{class:"text-body"},"Time:",-1)),e("span",Xi,I(n(Qe).meeting.time),1)]),e("div",null,[y[36]||(y[36]=e("span",{class:"text-body"},"Type:",-1)),e("span",er,I(n(Qe).meeting.title),1)]),e("div",null,[y[37]||(y[37]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",tr,I(n(Qe).meeting.location),1)])])])):q("",!0),e("div",sr,[w(n(Z),{variant:"outline",size:"small",class:"flex items-center gap-2",onClick:n(Vs)},{default:O(()=>[w(n(Rn),{size:14}),y[38]||(y[38]=P(" Re-open ",-1))]),_:1},8,["onClick"])])]),e("div",nr,[e("span",null,"Updated by "+I(n(Qe).actorName||"Unknown"),1),e("span",ar,I(Rs.value),1)])],64)):(d(),b(ye,{key:1},[e("div",lr,[e("div",or,[e("div",null,[e("h4",ir,I(W.value),1),e("p",rr,I(qe.value),1)]),e("div",{class:j(["flex items-center gap-2 px-2 py-1 rounded-btn text-fluid-xs font-semibold",$e.value.class])},I($e.value.text),3)]),G.value?(d(),b("div",dr,[y[39]||(y[39]=e("div",{class:"flex items-center gap-2 mb-1"},[e("i",{class:"fa-solid fa-phone text-blue-600 text-fluid-xs"}),e("span",{class:"text-fluid-xs font-semibold text-blue-900"},"Scheduled Follow-up Call")],-1)),e("p",ur,I(n(mt)(t.lead.scheduledAppointment.start))+" at "+I(n(ft)(t.lead.scheduledAppointment.start)),1)])):q("",!0),n(Te)>0?(d(),b("div",cr,[e("div",pr,[e("div",mr,[y[40]||(y[40]=e("i",{class:"fa-solid fa-phone text-body text-fluid-xs"},null,-1)),y[41]||(y[41]=e("span",{class:"text-fluid-xs font-semibold text-body"},"Contact Attempts:",-1)),e("span",fr,I(n(Te))+" / "+I(n(K)),1)]),n(Te)>=n(K)-1?(d(),b("div",yr,[...y[42]||(y[42]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),P(" One more attempt before auto-disqualification ",-1)])])):q("",!0)])])):q("",!0),e("div",gr,[e("span",vr,I(t.lead.customer.phone),1),e("button",{onClick:oe,class:"flex items-center justify-center rounded hover:bg-surfaceSecondary text-sub hover:text-body transition-colors w-6 h-6",title:"Copy phone number"},[...y[43]||(y[43]=[e("i",{class:"fa-regular fa-copy text-fluid-xs"},null,-1)])])]),w(Hi,{"is-call-active":n(c),"call-ended":n(p),"call-duration":n(g),"call-notes":n(k),"formatted-call-duration":n(v),"mock-transcription":n(L),"show-outcome-selection":n(de),"show-call-log-form":n(Ie),"contact-attempts":n(Te),"max-contact-attempts":n(K),onStartCall:U,onEndCall:n(x),onLogManualCall:n(Ts),onExtractInformation:n(F),"onUpdate:callNotes":N,onCopyNumber:oe},null,8,["is-call-active","call-ended","call-duration","call-notes","formatted-call-duration","mock-transcription","show-outcome-selection","show-call-log-form","contact-attempts","max-contact-attempts","onEndCall","onLogManualCall","onExtractInformation"])]),e("div",br,[n(Ie)?(d(),b("div",hr,[e("div",xr,[y[47]||(y[47]=e("h4",{class:"font-semibold text-heading mb-4 text-fluid-sm"},"Log Call Details",-1)),e("div",wr,[e("div",null,[y[44]||(y[44]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Call Date & Time",-1)),te(e("input",{type:"datetime-local","onUpdate:modelValue":y[0]||(y[0]=E=>Pe(Ae)?Ae.value=E:null),class:"input w-full"},null,512),[[xe,n(Ae)]])]),e("div",null,[y[46]||(y[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Assigned To",-1)),e("div",kr,[e("div",{class:j(["w-8 h-8 rounded-full flex items-center justify-center font-semibold text-fluid-xs",J((Ne=n(He))==null?void 0:Ne.role)])},I(ke((Ue=n(He))==null?void 0:Ue.name)),3),e("div",Cr,[e("p",Sr,I(((Le=n(He))==null?void 0:Le.name)||"Unknown"),1),e("p",$r,I(((ot=n(He))==null?void 0:ot.role)||"User"),1)]),y[45]||(y[45]=e("span",{class:"text-fluid-xs text-green-600 font-medium"},"Auto-assigned",-1))])])]),e("div",Ar,[w(n(Z),{label:"Cancel",variant:"outline",size:"small",onClick:n(vs)},null,8,["onClick"]),w(n(Z),{label:"Continue",variant:"primary",size:"small",onClick:n(xt),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])])):q("",!0),n(de)?(d(),b("div",Dr,[e("div",null,[y[51]||(y[51]=e("p",{class:"text-fluid-sm font-medium text-heading leading-6 mb-3"},"What's the outcome?",-1)),e("div",Tr,[e("button",{type:"button",class:j(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",n(be)==="no-answer"?"border-brand-blue text-heading":"border-E5E7EB text-body hover:border-brand-blue/30 hover:bg-surfaceSecondary/50"]),onClick:y[1]||(y[1]=E=>n(Y)("no-answer"))},[w(n(Bn),{size:18,class:"shrink-0"}),y[48]||(y[48]=e("span",null,"No answer",-1))],2),e("button",{type:"button",class:j(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",n(be)==="not-valid"?"border-brand-blue text-heading":"border-E5E7EB text-body hover:border-brand-blue/30 hover:bg-surfaceSecondary/50"]),onClick:y[2]||(y[2]=E=>n(Y)("not-valid"))},[w(n(Un),{size:18,class:"shrink-0"}),y[49]||(y[49]=e("span",null,"Not valid",-1))],2),e("button",{type:"button",class:j(["inline-flex items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-fluid-sm font-medium transition-all bg-white",n(be)==="interested"?"border-brand-blue text-heading":"border-E5E7EB text-body hover:border-brand-blue/30 hover:bg-surfaceSecondary/50"]),onClick:y[3]||(y[3]=E=>n(Y)("interested"))},[w(n(Jt),{size:18,class:"shrink-0"}),y[50]||(y[50]=e("span",null,"Interested",-1))],2)])]),n(be)==="no-answer"?(d(),b("div",Ir,[e("div",qr,[w(hi,{title:"Send follow-up message","show-email":!0,"show-sms":!0,"show-whatsapp":!0,"show-dont-send":!0,onSend:Hs,onDontSend:y[4]||(y[4]=()=>{n(re).value="dont-send"}),onCancel:y[5]||(y[5]=()=>{n(be).value=null})})]),e("div",Or,[y[55]||(y[55]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-2"},"Next call attempt",-1)),e("div",Mr,[e("button",{onClick:y[6]||(y[6]=E=>fe.value="tomorrow-9am"),class:j(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(fe)==="tomorrow-9am"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," Tomorrow 9:00 AM ",2),e("button",{onClick:y[7]||(y[7]=(...E)=>n(Ce)&&n(Ce)(...E)),class:j(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(fe)==="monday"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," AI suggestion ",2),e("button",{onClick:y[8]||(y[8]=E=>fe.value="custom"),class:j(["bg-surfaceSecondary border-2 rounded-lg px-4 py-2 text-fluid-xs font-medium text-heading transition-all",n(fe)==="custom"?"border-primary-700 bg-primary-700 text-white":"border-E5E7EB hover:border-primary-300 hover:bg-brand-gray"])}," Select time ",2)]),n(fe)==="custom"?(d(),b("div",Nr,[e("div",null,[y[52]||(y[52]=e("label",{class:"block text-fluid-xs font-semibold mb-1.5"},"Date",-1)),te(e("input",{type:"date","onUpdate:modelValue":y[9]||(y[9]=E=>Pe(Oe)?Oe.value=E:null),class:"input"},null,512),[[xe,n(Oe)]])]),e("div",null,[y[53]||(y[53]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Time",-1)),te(e("input",{type:"time","onUpdate:modelValue":y[10]||(y[10]=E=>Pe(Be)?Be.value=E:null),class:"input"},null,512),[[xe,n(Be)]])])])):q("",!0),n(fe)==="monday"&&n(ue)?(d(),b("div",Lr,[e("p",Er,[y[54]||(y[54]=e("span",{class:"font-semibold text-heading"},"AI Suggestion:",-1)),P(" "+I(n(ue).formattedDate)+" at "+I(n(ue).time)+". "+I(n(ue).reason),1)])])):q("",!0)]),e("div",Fr,[w(n(Z),{label:"Cancel",variant:"outline",size:"small",onClick:n(ae)},null,8,["onClick"]),w(n(Z),{label:"Send and reschedule",variant:"primary",size:"small",onClick:n(Ms),class:"!bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red"},null,8,["onClick"])])])):q("",!0),n(be)==="not-valid"?(d(),b("div",Br,[e("div",Vr,[e("div",null,[y[58]||(y[58]=e("label",{class:"block text-fluid-xs font-semibold mb-2"},"Category",-1)),e("div",Rr,[e("label",jr,[te(e("input",{type:"radio","onUpdate:modelValue":y[11]||(y[11]=E=>Pe(Se)?Se.value=E:null),value:"Not Valid",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Ke,n(Se)]]),y[56]||(y[56]=e("span",{class:"text-fluid-sm text-body"},"Not Valid",-1))]),e("label",Ur,[te(e("input",{type:"radio","onUpdate:modelValue":y[12]||(y[12]=E=>Pe(Se)?Se.value=E:null),value:"Not Interested",class:"w-4 h-4 text-brand-blue focus:ring-brand-blue border-gray-300"},null,512),[[Ke,n(Se)]]),y[57]||(y[57]=e("span",{class:"text-fluid-sm text-body"},"Not Interested",-1))])])]),e("div",null,[y[60]||(y[60]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},"Failure Reason",-1)),te(e("select",{"onUpdate:modelValue":y[13]||(y[13]=E=>Pe(Me)?Me.value=E:null),class:"input"},[...y[59]||(y[59]=[vt('<option value="">Select a reason...</option><option value="Data cleanup">Data cleanup</option><option value="Unreachable">Unreachable</option><option value="Purchase postponed">Purchase postponed</option><option value="Vehicle sold">Vehicle sold</option><option value="Out of budget">Out of budget</option><option value="Financing rejected">Financing rejected</option><option value="Duplicate">Duplicate</option><option value="Bought elsewhere">Bought elsewhere</option>',9)])],512),[[ut,n(Me)]])]),e("div",zr,[w(n(Z),{label:"Cancel",variant:"outline",size:"small",onClick:n(ae)},null,8,["onClick"]),w(n(Z),{label:"Confirm Disqualification",variant:"primary",size:"small",disabled:!n(Se)||!n(Me),onClick:n(Ns),class:"!bg-red-600 !hover:bg-red-700 !text-white !border-red-600"},null,8,["disabled","onClick"])])])])):q("",!0),n(be)==="interested"?(d(),b("div",Wr,[e("div",Hr,[y[61]||(y[61]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Customer data",-1)),e("div",Pr,[w(n(Z),{label:"+ Add vehicle",variant:"primary",size:"small",onClick:y[14]||(y[14]=E=>ne.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),w(n(Z),{label:"+ Add financing",variant:"primary",size:"small",onClick:y[15]||(y[15]=E=>le.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"}),w(n(Z),{label:"+ Add note",variant:"primary",size:"small",onClick:y[16]||(y[16]=E=>Fe.value=!0),class:"!bg-brand-black !hover:bg-brand-darkDarker !text-white !border-brand-black"})])]),n(se)&&!n(B)?(d(),b("div",_r,[w(_e,{questions:js,"initial-expanded":!1,onSurveyCompleted:n(Es),onSurveyRefused:n(Fs),onNotResponding:n(Bs)},null,8,["onSurveyCompleted","onSurveyRefused","onNotResponding"])])):q("",!0),n(B)?(d(),b("div",Qr,[...y[62]||(y[62]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle text-green-600 text-fluid-sm"}),e("span",{class:"text-fluid-xs font-semibold text-green-900"},"Survey completed")],-1)])])):q("",!0),e("div",Yr,[e("div",Gr,[y[63]||(y[63]=e("h5",{class:"font-semibold text-heading text-fluid-sm"},"Assign to salesman",-1)),w(n(Z),{label:"Change",variant:"outline",size:"small",class:"text-fluid-xs",onClick:y[17]||(y[17]=E=>ee.value=!0)})]),e("div",Jr,[(d(!0),b(ye,null,we(St.value,E=>(d(),b("button",{key:E.id,type:"button",class:j(["flex flex-col items-start gap-2 p-3 rounded-lg border-2 transition-all text-left",n(he).assignee&&n(he).assignee.id===E.id?"border-brand-blue bg-surfaceSecondary":"border-E5E7EB hover:border-brand-blue/30 hover:bg-surfaceSecondary/50"]),onClick:it=>n(he).assignee=E},[e("div",Zr,[e("div",{class:j(["w-10 h-10 rounded-full flex items-center justify-center font-semibold text-fluid-sm shrink-0",J(E.role)])},I(E.initials),3),e("div",Xr,[e("p",ed,I(E.name),1),e("p",td,I(E.role),1)])]),y[64]||(y[64]=e("p",{class:"text-fluid-xs text-sub"},"Monâ€“Fri 9:00â€“17:00",-1))],10,Kr))),128))]),St.value.length===0?(d(),b("p",sd,"No assignable users. Use Change to assign.")):q("",!0)]),e("div",nd,[y[67]||(y[67]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-3"},"Qualification method",-1)),e("div",ad,[e("label",{class:j(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",n(je)==="assign-only"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-E5E7EB hover:bg-surfaceSecondary/50"])},[te(e("input",{"onUpdate:modelValue":y[18]||(y[18]=E=>Pe(je)?je.value=E:null),type:"radio",value:"assign-only",class:"shrink-0"},null,512),[[Ke,n(je)]]),y[65]||(y[65]=e("span",{class:"text-fluid-sm text-heading"},"Assign only",-1))],2),e("label",{class:j(["flex items-center gap-3 border rounded-lg px-3 py-2 cursor-pointer transition-colors",n(je)==="assign-and-schedule"?"border-2 border-brand-blue bg-surfaceSecondary/50":"border border-E5E7EB hover:bg-surfaceSecondary/50"])},[te(e("input",{"onUpdate:modelValue":y[19]||(y[19]=E=>Pe(je)?je.value=E:null),type:"radio",value:"assign-and-schedule",class:"shrink-0"},null,512),[[Ke,n(je)]]),y[66]||(y[66]=e("span",{class:"text-fluid-sm text-heading"},"Assign and schedule",-1))],2)])]),n(je)==="assign-and-schedule"?(d(),b("div",ld,[y[71]||(y[71]=e("h5",{class:"font-semibold text-heading text-fluid-sm mb-4"},"Schedule",-1)),e("div",od,[e("div",null,[y[69]||(y[69]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Event type",-1)),te(e("select",{"onUpdate:modelValue":y[20]||(y[20]=E=>Pe(wt)?wt.value=E:null),class:"input w-full"},[y[68]||(y[68]=e("option",{value:"",disabled:""},"Select event type",-1)),(d(),b(ye,null,we($s,E=>e("option",{key:E.value,value:E.value},I(E.label),9,id)),64))],512),[[ut,n(wt)]])]),e("div",null,[y[70]||(y[70]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1.5"},"Duration",-1)),e("div",rd,[e("button",{type:"button",class:j(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",n(kt)===30?"border-brand-blue bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-brand-blue/30"]),onClick:y[21]||(y[21]=E=>Qt(30))}," 30min ",2),e("button",{type:"button",class:j(["px-3 py-2 rounded-lg border-2 text-fluid-sm font-medium transition-all",n(kt)===60?"border-brand-blue bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-brand-blue/30"]),onClick:y[22]||(y[22]=E=>Qt(60))}," 60min ",2),te(e("input",{"onUpdate:modelValue":y[23]||(y[23]=E=>Pe(Ct)?Ct.value=E:null),type:"number",min:"1",placeholder:"Custom",class:"input w-24",onInput:y[24]||(y[24]=E=>kt.value=null)},null,544),[[xe,n(Ct)]])])])]),e("div",dd,[e("div",ud,[e("div",cd,[e("div",pd,[e("p",md,I(n(bs)),1),e("div",fd,[e("button",{type:"button",class:"p-1.5 rounded-lg hover:bg-surfaceSecondary transition-colors","aria-label":"Previous month",onClick:y[25]||(y[25]=(...E)=>n(Pt)&&n(Pt)(...E))},[w(n(os),{size:16,class:"text-body"})]),e("button",{type:"button",class:"p-1.5 rounded-lg hover:bg-surfaceSecondary transition-colors","aria-label":"Next month",onClick:y[26]||(y[26]=(...E)=>n(_t)&&n(_t)(...E))},[w(n(is),{size:16,class:"text-body"})])])]),e("div",yd,[(d(),b(ye,null,we(["SUN","MON","TUE","WED","THU","FRI","SAT"],E=>e("div",{key:E,class:"text-center text-fluid-xs font-medium text-sub py-1"},I(E),1)),64))]),e("div",gd,[(d(!0),b(ye,null,we(n(hs),(E,it)=>{var Mt;return d(),b("button",{key:`${it}-${((Mt=E==null?void 0:E.getTime)==null?void 0:Mt.call(E))??"e"}`,type:"button",class:j(["h-10 w-full rounded-lg text-fluid-sm flex items-center justify-center transition-colors",E?n(Cs)(E,n(Ht))?"bg-brand-blue text-white":"hover:bg-surfaceSecondary text-heading":"pointer-events-none invisible"]),onClick:tc=>n(Ss)(E)},I(E?E.getDate():""),11,vd)}),128))])]),e("div",bd,[e("p",hd,I(n(xs)),1),e("div",xd,[(d(!0),b(ye,null,we(n(ws),E=>(d(),b("button",{key:E,type:"button",class:j(["w-full py-2.5 px-4 rounded-lg border-2 text-fluid-sm font-medium text-center transition-all",n(Ot)===E?"border-brand-blue bg-surfaceSecondary text-heading":"border-E5E7EB text-body hover:border-brand-blue/30"]),onClick:it=>Ot.value=E},I(E),11,wd))),128))])])])])])):q("",!0),n(R)&&n(je)==="assign-only"?(d(),b("div",kd,[y[76]||(y[76]=vt('<div class="flex items-start justify-between mb-3"><div class="flex items-center gap-2"><i class="fa-solid fa-calendar-check text-blue-600"></i><h5 class="font-semibold text-heading text-fluid-sm">Existing Appointment</h5></div><span class="text-fluid-xs font-semibold text-blue-600 uppercase">Scheduled</span></div>',1)),e("div",Cd,[e("div",null,[y[72]||(y[72]=e("span",{class:"text-body"},"Date:",-1)),e("span",Sd,I(n(mt)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[y[73]||(y[73]=e("span",{class:"text-body"},"Time:",-1)),e("span",$d,I(n(ft)(t.lead.scheduledAppointment.start)),1)]),e("div",null,[y[74]||(y[74]=e("span",{class:"text-body"},"Type:",-1)),e("span",Ad,I(t.lead.scheduledAppointment.type),1)]),e("div",null,[y[75]||(y[75]=e("span",{class:"text-body"},"Assigned to:",-1)),e("span",Dd,I(t.lead.scheduledAppointment.assignee),1)])]),w(n(Z),{label:"Reschedule Appointment",variant:"outline",size:"small",onClick:y[27]||(y[27]=E=>Re.value=!0)})])):q("",!0),e("div",Td,[w(n(Z),{label:"Cancel",variant:"outline",size:"small",onClick:n(ae)},null,8,["onClick"]),e("div",Id,[w(n(Z),{label:"Disqualify",variant:"outline",size:"small",onClick:n(Os)},null,8,["onClick"]),w(n(Z),{label:"Qualify",variant:"primary",size:"small",disabled:!As.value,onClick:n(qs),class:"!bg-green-600 !hover:bg-green-700 !text-white !border-green-600 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,["disabled","onClick"])])])])):q("",!0)])):q("",!0)])],64)),w(n(at),{open:n(Fe),"onUpdate:open":r},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-2xl"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...y[77]||(y[77]=[P("Add Note",-1)])]),_:1})]),_:1}),w(yn,{ref_key:"noteWidgetRef",ref:H,item:null,"task-type":"lead","task-id":t.lead.id,borderless:!1,"hide-actions":!0,"hide-header":!0,onSave:n(Ls),onCancel:y[28]||(y[28]=E=>Fe.value=!1)},null,8,["task-id","onSave"]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>{var E,it;return[w(n(Z),{variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:y[29]||(y[29]=Mt=>Fe.value=!1)},{default:O(()=>[...y[78]||(y[78]=[P(" Cancel ",-1)])]),_:1}),w(n(Z),{variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!((E=H.value)!=null&&E.canSubmit()),onClick:(it=H.value)==null?void 0:it.submit},{default:O(()=>[...y[79]||(y[79]=[P(" Save Note ",-1)])]),_:1},8,["disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),w(ni,{show:n(Re),"preselected-assignee":n(he).assignee,onConfirm:n(Is),onClose:y[30]||(y[30]=E=>Re.value=!1)},null,8,["show","preselected-assignee","onConfirm"]),w(as,{show:ee.value,title:"Assign to salesman","confirm-label":"Assign",onConfirm:V,onClose:y[31]||(y[31]=E=>ee.value=!1)},null,8,["show"]),w(gn,{show:le.value,"task-type":"lead","task-id":t.lead.id,onSave:zs,onClose:y[32]||(y[32]=E=>le.value=!1)},null,8,["show","task-id"]),w(vn,{show:ne.value,mode:"vehicle","task-type":"lead","task-id":t.lead.id,"customer-id":t.lead.customerId,onClose:y[33]||(y[33]=E=>ne.value=!1),onSave:Ws},null,8,["show","task-id","customer-id"])])}}},Od={key:0,class:"bg-surfaceSecondary/50 border border-E5E7EB rounded-card p-4"},Md={class:"flex justify-between items-start mb-3"},Nd={class:"text-fluid-xs text-body mt-0.5"},Ld={key:0},Ed={__name:"LeadManagementWidget",props:{lead:{type:Object,required:!0}},emits:["open-purchase-method","open-trade-in"],setup(t,{emit:m}){const s=t,r=m,a=ct(),o=()=>{var x;const h=a.currentLead;return h&&h.id===((x=s.lead)==null?void 0:x.id)?h:s.lead},l={"call-to-verify":()=>{},"call-prospect":()=>{},"complete-conversion":()=>{},reopen:()=>{}},i=fs(dt(s,"lead"),l),{handlePostponed:u,handleValidated:f,handleQualified:c,handleCallAttemptLogged:p,handleNoteSaved:g,handleOpenPurchaseMethod:k,handleOpenTradeIn:S,handleAppointmentScheduled:A,handleDisqualified:L,handleReopen:v}=To({getLead:o,leadState:i,emit:r});return(h,x)=>(d(),Q(ys,{task:t.lead,"hide-title":"","hide-border":""},{"deadline-banner":O(()=>[w(Vo,{"next-action-due":t.lead.nextActionDue,"is-closed":n(i).isClosed.value,"show-deadline-banner":n(i).showDeadlineBanner.value,"task-id":t.lead.id},null,8,["next-action-due","is-closed","show-deadline-banner","task-id"])]),"primary-action":O(()=>[!n(i).isClosed.value&&n(i).showLQWidget.value?(d(),Q(qd,{key:t.lead.id,lead:t.lead,onPostponed:n(u),onValidated:n(f),onQualified:n(c),onDisqualified:n(L),onCallAttemptLogged:n(p),onNoteSaved:n(g),onOpenPurchaseMethod:n(k),onOpenTradeIn:n(S),onAppointmentScheduled:n(A)},null,8,["lead","onPostponed","onValidated","onQualified","onDisqualified","onCallAttemptLogged","onNoteSaved","onOpenPurchaseMethod","onOpenTradeIn","onAppointmentScheduled"])):!n(i).isClosed.value&&n(i).primaryAction.value?(d(),Q(gs,{key:1,action:n(i).primaryAction.value,"color-scheme":n(i).primaryAction.value.colorScheme,onActionClicked:n(i).primaryAction.value.handler},null,8,["action","color-scheme","onActionClicked"])):q("",!0)]),"task-widgets":O(()=>[...x[0]||(x[0]=[])]),"closed-state":O(()=>[n(i).isClosed.value?(d(),b("div",Od,[e("div",Md,[e("div",null,[x[1]||(x[1]=e("h4",{class:"font-bold text-heading text-fluid-sm"},"Lead Closed",-1)),e("p",Nd,[P(" Status: "+I(n(i).displayStage.value)+" ",1),t.lead.disqualifyReason?(d(),b("span",Ld," - "+I(t.lead.disqualifyReason),1)):q("",!0)])])]),w(n(Z),{variant:"primary",size:"small",onClick:n(v),class:"flex items-center gap-2"},{default:O(()=>[...x[2]||(x[2]=[e("span",null,"Reopen Lead",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1},8,["onClick"])])):q("",!0)]),_:1},8,["task"]))}},Fd={class:"flex justify-between items-start mb-3"},Bd={class:"font-bold text-heading text-fluid-sm"},Vd={class:"text-fluid-xs text-sub mt-0.5"},Rd={class:"flex gap-3 flex-wrap"},Je={__name:"BaseTaskWidget",props:{title:{type:String,required:!0},description:{type:String,required:!0},colorScheme:{type:Object,required:!0,validator:t=>t.background&&t.border}},setup(t){return(m,s)=>(d(),b("div",{class:j(["rounded-lg p-4 relative transition-all duration-300 border",[t.colorScheme.background,t.colorScheme.border]])},[e("div",Fd,[e("div",null,[e("h4",Bd,I(t.title),1),e("p",Vd,I(t.description),1)]),De(m.$slots,"badge")]),e("div",Rd,[De(m.$slots,"actions")]),De(m.$slots,"survey"),De(m.$slots,"content")],2))}},jd={__name:"OOFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","review","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"offerStatus",label:"Why hasn't an offer been created?",type:"select",options:["Still gathering information","Awaiting customer response","Vehicle unavailable","Pricing concerns","Other"]},{key:"customerInterest",label:"Is customer still interested?",type:"radio",options:["Yes","Maybe","No"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Any relevant feedback or next steps..."}],o=D(()=>{if(!s.opportunity.createdAt)return 0;const p=new Date(s.opportunity.createdAt),k=Math.abs(new Date-p);return Math.ceil(k/(1e3*60*60*24))}),l=()=>{r("create-offer",s.opportunity)},i=()=>{r("review",s.opportunity)},u=p=>{r("survey-completed",{opportunity:s.opportunity,responses:p})},f=()=>{r("survey-refused",{opportunity:s.opportunity})},c=()=>{r("not-responding",{opportunity:s.opportunity})};return(p,g)=>(d(),Q(Je,{title:"Open Opportunity Feedback",description:`This opportunity has been open for ${o.value} days without any offer. Consider creating an offer to move forward.`,"color-scheme":{background:"bg-orange-50/50",border:"border-orange-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer "),e("button",{onClick:i,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"}," Review Opportunity ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:u,onSurveyRefused:f,onNotResponding:c})]),_:1},8,["description"]))}},Ud={__name:"UFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-offer","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"lostInterest",label:"Has customer lost interest?",type:"radio",options:["Yes","Maybe","No","Unknown"]},{key:"blockers",label:"What are the blockers?",type:"select",options:["Pricing","Availability","Financing","No response","Changed mind","Found competitor","Other"]},{key:"notes",label:"Additional feedback",type:"text",placeholder:"Describe the situation and any relevant details..."}],o=D(()=>{if(!s.opportunity.createdAt)return 0;const c=new Date(s.opportunity.createdAt),g=Math.abs(new Date-c);return Math.ceil(g/(1e3*60*60*24))}),l=()=>{r("create-offer",s.opportunity)},i=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},u=()=>{r("survey-refused",{opportunity:s.opportunity})},f=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,p)=>(d(),Q(Je,{title:"Unsold Feedback",description:`This opportunity has been open for ${o.value} days without any offer. This is a follow-up to ensure progress. Consider creating an offer or closing the opportunity.`,"color-scheme":{background:"bg-red-50/50",border:"border-red-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Offer ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:i,onSurveyRefused:u,onNotResponding:f})]),_:1},8,["description"]))}},zd={__name:"NFUTask",props:{opportunity:{type:Object,required:!0}},emits:["schedule-closing","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"appointmentStatus",label:"Why no appointment scheduled?",type:"select",options:["Customer delaying","Awaiting vehicle availability","Logistics issues","Customer not responding","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Considering","Lost interest","Unknown"]},{key:"notes",label:"Additional information",type:"text",placeholder:"Any relevant details about the follow-up..."}],o=()=>{r("schedule-closing",s.opportunity)},l=f=>{r("survey-completed",{opportunity:s.opportunity,responses:f})},i=()=>{r("survey-refused",{opportunity:s.opportunity})},u=()=>{r("not-responding",{opportunity:s.opportunity})};return(f,c)=>(d(),Q(Je,{title:"Opportunity Follow-up",description:"No contract date exists. Push to close or schedule a closing meeting to finalize the deal.","color-scheme":{background:"bg-purple-50/50",border:"border-purple-100"}},{actions:O(()=>[e("button",{onClick:o,class:"bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Schedule Closing Meeting ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:l,onSurveyRefused:i,onNotResponding:u})]),_:1}))}},Wd={__name:"OFBTask",props:{opportunity:{type:Object,required:!0}},emits:["create-contract","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"customerFeedback",label:"Customer feedback on offer?",type:"select",options:["Positive","Neutral","Negative","No feedback yet"]},{key:"objections",label:"Any objections?",type:"text",placeholder:"Describe any concerns or objections raised by customer..."},{key:"nextSteps",label:"What are the next steps?",type:"select",options:["Waiting for customer decision","Revising offer","Scheduling closing meeting","Addressing objections","Other"]}],o=D(()=>{const c=s.opportunity.lastActivity||s.opportunity.createdAt;if(!c)return 0;const p=new Date(c),k=Math.abs(new Date-p);return Math.ceil(k/(1e3*60*60*24))}),l=()=>{r("create-contract",s.opportunity)},i=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},u=()=>{r("survey-refused",{opportunity:s.opportunity})},f=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,p)=>(d(),Q(Je,{title:"Offer Feedback",description:`This opportunity has been in negotiation for ${o.value} days without a contract. Consider creating a contract to finalize the deal.`,"color-scheme":{background:"bg-blue-50/50",border:"border-blue-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Create Contract ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:i,onSurveyRefused:u,onNotResponding:f})]),_:1},8,["description"]))}},Hd={__name:"CFBTask",props:{opportunity:{type:Object,required:!0}},emits:["prepare-delivery","pre-delivery-checklist","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"deliveryTimeline",label:"Delivery timeline confirmation?",type:"select",options:["On schedule","Delayed","Ahead of schedule","To be determined"]},{key:"concerns",label:"Any concerns?",type:"text",placeholder:"Document any concerns or special requests from customer..."},{key:"readiness",label:"Vehicle readiness status?",type:"select",options:["Ready","In preparation","Waiting for parts","Other"]}],o=D(()=>{var S;if(!((S=s.opportunity)!=null&&S.contractDate))return 0;const p=new Date(s.opportunity.contractDate),k=Math.abs(new Date-p);return Math.ceil(k/(1e3*60*60*24))}),l=()=>{r("prepare-delivery",s.opportunity)},i=()=>{r("pre-delivery-checklist",s.opportunity)},u=p=>{r("survey-completed",{opportunity:s.opportunity,responses:p})},f=()=>{r("survey-refused",{opportunity:s.opportunity})},c=()=>{r("not-responding",{opportunity:s.opportunity})};return(p,g)=>(d(),Q(Je,{title:"Contract Feedback",description:`Contract was signed ${o.value} days ago. Follow up on delivery status and collect customer feedback.`,"color-scheme":{background:"bg-green-50/50",border:"border-green-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Prepare for Delivery "),e("button",{onClick:i,class:"bg-surface border border-D1D5DB text-brand-dark font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors hover:bg-surfaceSecondary"}," Pre-Delivery Checklist ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:u,onSurveyRefused:f,onNotResponding:c})]),_:1},8,["description"]))}},Pd={__name:"DFBTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["delivery-feedback","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m,a=[{key:"satisfaction",label:"Satisfaction with vehicle?",type:"radio",options:["Very satisfied","Satisfied","Neutral","Dissatisfied","Very dissatisfied"]},{key:"deliveryExperience",label:"Delivery experience rating",type:"select",options:["Excellent","Good","Average","Poor","Very poor"]},{key:"issues",label:"Any issues or concerns?",type:"text",placeholder:"Document any issues or positive feedback from customer..."}],o=D(()=>{const c=s.activities.find(S=>{var A;return S.type==="delivery"||((A=S.action)==null?void 0:A.toLowerCase().includes("delivered"))});if(!c||!c.timestamp)return 0;const p=new Date(c.timestamp),k=Math.abs(new Date-p);return Math.ceil(k/(1e3*60*60*24))}),l=()=>{r("delivery-feedback",s.opportunity)},i=c=>{r("survey-completed",{opportunity:s.opportunity,responses:c})},u=()=>{r("survey-refused",{opportunity:s.opportunity})},f=()=>{r("not-responding",{opportunity:s.opportunity})};return(c,p)=>(d(),Q(Je,{title:"Delivery Feedback",description:`Vehicle was delivered ${o.value} days ago. Ask the customer if they're satisfied with the vehicle.`,"color-scheme":{background:"bg-teal-50/50",border:"border-teal-100"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-teal-600 hover:bg-teal-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"}," Delivery Feedback ")]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:i,onSurveyRefused:u,onNotResponding:f})]),_:1},8,["description"]))}},_d={__name:"NSTask",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,required:!0}},emits:["contact-customer","reschedule","survey-completed","survey-refused","not-responding","auto-close-lost","set-callback"],setup(t,{emit:m}){const s=t,r=m,a=D(()=>{var S;return((S=s.scheduledAppointment)==null?void 0:S.noShowCount)||0}),o=D(()=>{const S=a.value;return S===0?"No-Show Follow-up":S>=3?`No-Show #${S} - Final Warning`:`No-Show #${S} Follow-up`}),l=D(()=>{const S=a.value;return S>=3?"This is the third no-show. The opportunity will be automatically closed as lost if another appointment is not successfully completed.":S>=2?"This is the second no-show. Please make every effort to reach the customer and reschedule.":"Follow up with customer to understand the situation and book another appointment."}),i=[{key:"contactStatus",label:"Were you able to reach the customer?",type:"radio",options:["Yes","No","Left message"]},{key:"noShowReason",label:"Reason for no-show?",type:"select",options:["Emergency","Forgot","Changed mind","No response","Schedule conflict","Other"]},{key:"nextAction",label:"Next action?",type:"select",options:["Reschedule appointment","Customer will call back","Continue follow-up","Other"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document the conversation and any relevant details..."}],u=D(()=>{var A;return(A=s.scheduledAppointment)!=null&&A.start?new Date(s.scheduledAppointment.start).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"unknown date"}),f=()=>{r("contact-customer",s.opportunity)},c=()=>{const S=a.value;if(S>=3)r("auto-close-lost",{opportunity:s.opportunity,reason:`Automatically closed after ${S} no-shows`});else if(S===1||S===2){const A=new Date;A.setDate(A.getDate()+2),r("set-callback",{opportunity:s.opportunity,callbackDate:A.toISOString()})}else r("reschedule",s.opportunity)},p=S=>{r("survey-completed",{opportunity:s.opportunity,responses:S})},g=()=>{r("survey-refused",{opportunity:s.opportunity})},k=()=>{r("not-responding",{opportunity:s.opportunity})};return(S,A)=>(d(),Q(Je,{title:o.value,description:`Appointment was scheduled for ${u.value} but customer did not show up. ${l.value}`,"color-scheme":{background:"bg-yellow-50/50",border:"border-yellow-100"}},{actions:O(()=>[e("button",{onClick:c,class:"bg-yellow-600 hover:bg-yellow-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...A[0]||(A[0]=[e("i",{class:"fa-solid fa-calendar-plus"},null,-1),P(" Book Another Appointment ",-1)])]),e("button",{onClick:f,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...A[1]||(A[1]=[e("i",{class:"fa-solid fa-phone"},null,-1),P(" Contact Customer ",-1)])])]),survey:O(()=>[w(_e,{questions:i,onSurveyCompleted:p,onSurveyRefused:g,onNotResponding:k})]),_:1},8,["title","description"]))}},Qd={__name:"AbandonedTask",props:{opportunity:{type:Object,required:!0},activities:{type:Array,default:()=>[]}},emits:["reopen","close-lost","requalify","survey-completed","survey-refused","not-responding"],setup(t,{emit:m}){const s=t,r=m;Ge();const a=[{key:"abandonmentReason",label:"Why was this opportunity abandoned?",type:"select",options:["No response from customer","Customer lost interest","Competitor won","Budget constraints","Timing issues","Other"]},{key:"customerStatus",label:"Customer status?",type:"radio",options:["Still interested","Lost interest","Bought elsewhere","Unknown"]},{key:"notes",label:"Additional notes",type:"text",placeholder:"Document any relevant information about why this opportunity was abandoned..."}],o=D(()=>{const g=s.opportunity.lastActivity||s.opportunity.createdAt;if(!g)return 0;const k=new Date(g),A=Math.abs(new Date-k);return Math.ceil(A/(1e3*60*60*24))}),l=()=>{r("reopen",s.opportunity)},i=()=>{r("close-lost",{opportunity:s.opportunity,reason:"Abandoned - no activity for extended period"})},u=()=>{r("requalify",s.opportunity)},f=g=>{r("survey-completed",{opportunity:s.opportunity,responses:g})},c=()=>{r("survey-refused",{opportunity:s.opportunity})},p=()=>{r("not-responding",{opportunity:s.opportunity})};return(g,k)=>(d(),Q(Je,{title:"Opportunity Abandoned",description:`This opportunity has been inactive for ${o.value} days. Consider reopening it or closing as lost.`,"color-scheme":{background:"bg-surfaceSecondary/50",border:"border"}},{actions:O(()=>[e("button",{onClick:l,class:"bg-gray-600 hover:bg-gray-700 text-white font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors shadow-sm shadow-gray-200"},[...k[0]||(k[0]=[e("i",{class:"fa-solid fa-rotate-left"},null,-1),P(" Reopen Opportunity ",-1)])]),e("button",{onClick:i,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...k[1]||(k[1]=[e("i",{class:"fa-solid fa-xmark"},null,-1),P(" Close as Lost ",-1)])]),e("button",{onClick:u,class:"bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-slate-700 font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center gap-2 transition-colors"},[...k[2]||(k[2]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),P(" Requalify as Lead ",-1)])])]),survey:O(()=>[w(_e,{questions:a,onSurveyCompleted:f,onSurveyRefused:c,onNotResponding:p})]),_:1},8,["description"]))}},Yd={OOFB:jd,UFB:Ud,NFU:zd,OFB:Wd,CFB:Hd,DFB:Pd,NS:_d,ABANDONED:Qd};function Gd(t,m,s,r,a){const o=D(()=>{const g=$t(t),k=$t(m),S=$t(s);return{opportunity:g,scheduledAppointment:k,activities:S,hasOffers:(S==null?void 0:S.some(A=>A.type==="offer"))||!1,stage:g.displayStage||g.stage,deliverySubstatus:g.deliverySubstatus||null,formatDateTime:a,hasActiveTaskWidget:!1}}),l=D(()=>{const g=o.value,k=bn(g.stage,g);if(!k)return null;const S=Yd[k];return S?{type:k,component:S,props:{opportunity:g.opportunity,appointment:g.scheduledAppointment,activities:g.activities}}:null}),i=D(()=>({...o.value,hasActiveTaskWidget:!!l.value})),u=D(()=>{const g=i.value,k=hn(g.stage,g);if(!k)return null;const S=r[k.key];return{...k,handler:S||(()=>{})}}),f=D(()=>{const g=i.value;return xn(g.stage,g).map(S=>{const A=r[S.key];return{...S,handler:A||(()=>{})}})}),c=D(()=>{const g=o.value;return wn(g.stage)}),p=D(()=>!l.value||!l.value.type?"":kn(l.value.type));return{primaryAction:u,secondaryActions:f,activeTaskWidget:l,taskWidgetTitle:p,isClosed:c}}const Jd={class:"relative"},Kd=["disabled"],Zd={key:0,class:"absolute top-full right-0 mt-2 min-w-full z-50 dropdown-menu-small"},Xd={__name:"SecondaryActionsDropdown",props:{actions:{type:Array,default:()=>[]}},emits:["action-selected"],setup(t,{emit:m}){const s=t,r=m,a=T(!1),o=()=>{a.value=!a.value},l=()=>{a.value=!1},i=f=>{f.disabled||(l(),r("action-selected",f),f.handler&&typeof f.handler=="function"&&f.handler())},u=D(()=>(s.actions||[]).map(f=>({key:f.key,label:f.label,disabled:!!f.disabled,onClick:()=>i(f)})));return(f,c)=>{const p=Bt("click-outside");return te((d(),b("div",Jd,[e("button",{onClick:o,class:"w-auto bg-surface hover:bg-surfaceSecondary border border-E5E7EB text-body font-medium px-4 py-2 rounded-lg text-fluid-xs flex items-center justify-between gap-2 transition-colors whitespace-nowrap",disabled:!t.actions||t.actions.length===0},[c[0]||(c[0]=e("span",null,"More actions",-1)),e("i",{class:j(["fa-solid fa-chevron-down text-xs transition-transform duration-200 flex-shrink-0",{"rotate-180":a.value}])},null,2)],8,Kd),w(Dt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:O(()=>[a.value?(d(),b("div",Zd,[w(n(Vt),{items:u.value,className:"min-w-full"},null,8,["items"])])):q("",!0)]),_:1})])),[[p,l]])}}},eu={class:"w-full h-28 bg-surfaceSecondary rounded overflow-hidden mb-2"},tu=["src","alt"],su={key:1,class:"w-full h-full flex items-center justify-center"},nu={class:"flex items-center justify-between mb-1.5"},au={class:"text-sm font-bold text-heading"},lu={class:"font-bold text-xs text-heading mb-0.5 line-clamp-1"},ou={class:"text-xs text-sub mb-1.5"},iu={key:0,class:"text-xs text-green-600 font-medium mb-2"},ru={key:1,class:"text-xs text-orange-600 font-medium mb-2"},Xt={__name:"VehicleCard",props:{vehicle:{type:Object,required:!0},badge:{type:String,required:!0},stockDays:{type:Number,default:null},selected:{type:Boolean,default:!1}},emits:["select"],setup(t){const m=t,s=D(()=>({Requested:"blue",Recommended:"gray","In Stock":"green",Custom:"yellow"})[m.badge]||"gray"),r=a=>a?a.toLocaleString("en-US"):"0";return(a,o)=>(d(),b("div",{onClick:o[1]||(o[1]=l=>a.$emit("select")),class:j(["border border-E5E7EB rounded-lg p-3 hover:border-blue-500 hover:shadow cursor-pointer transition-all bg-surface",{"border-blue-500 shadow":t.selected}])},[e("div",eu,[t.vehicle.image?(d(),b("img",{key:0,src:t.vehicle.image,alt:`${t.vehicle.brand} ${t.vehicle.model}`,class:"w-full h-full object-cover"},null,8,tu)):(d(),b("div",su,[...o[2]||(o[2]=[e("i",{class:"fa-solid fa-car text-sub opacity-50 text-2xl"},null,-1)])]))]),e("div",null,[e("div",nu,[w(n(At),{text:t.badge,size:"small",theme:s.value},null,8,["text","theme"]),e("span",au,"â‚¬"+I(r(t.vehicle.price)),1)]),e("h4",lu,I(t.vehicle.brand)+" "+I(t.vehicle.model),1),e("p",ou,I(t.vehicle.year),1),t.stockDays!==null&&t.stockDays!==void 0?(d(),b("div",iu,[o[3]||(o[3]=e("i",{class:"fa-solid fa-check-circle mr-0.5"},null,-1)),P(" In stock ("+I(t.stockDays)+" days) ",1)])):(d(),b("div",ru,[...o[4]||(o[4]=[e("i",{class:"fa-solid fa-clock mr-0.5"},null,-1),P(" Out of stock ",-1)])])),e("button",{onClick:o[0]||(o[0]=gt(l=>a.$emit("select"),["stop"])),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-3 py-1.5 rounded text-xs transition-colors"}," Select ")])],2))}},du={class:"space-y-6"},uu={key:0},cu={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},pu={class:"mb-4"},mu={class:"relative"},fu={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3"},yu={key:1,class:"text-center py-8 text-sub"},gu={class:"border border-E5E7EB rounded-lg p-4 bg-surfaceSecondary"},vu={key:0,class:"mt-4 space-y-3"},bu={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},hu={class:"flex justify-end"},xu=["disabled"],wu={__name:"VehicleSelectionModal",props:{show:{type:Boolean,required:!0},requestedVehicle:{type:Object,default:null},opportunityId:{type:Number,required:!0}},emits:["close","vehicle-selected"],setup(t,{emit:m}){const s=t,r=m,a=x=>{x||r("close")},o=T(""),l=T(!1),i=T(null),u=T(null),f=T(null),c=T([]),p=T({brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""});jt(async()=>{try{const x=await ls({});c.value=x.data||[]}catch(x){console.error("Failed to load vehicles:",x),c.value=[]}});const g=D(()=>s.requestedVehicle&&s.requestedVehicle.stockDays!==null&&s.requestedVehicle.stockDays!==void 0),k=D(()=>{const x=[];if(s.requestedVehicle&&g.value&&x.push({...s.requestedVehicle,isRequested:!0}),c.value&&c.value.length>0){const $=c.value.filter(H=>s.requestedVehicle?H.brand!==s.requestedVehicle.brand||H.model!==s.requestedVehicle.model:!0),F=s.requestedVehicle&&g.value?3:4;x.push(...$.slice(0,F))}return x}),S=D(()=>{if(!c.value||c.value.length===0)return[];let x=[...c.value];if(o.value){const $=o.value.toLowerCase();x=x.filter(F=>F.brand.toLowerCase().includes($)||F.model.toLowerCase().includes($)||F.year.toString().includes($))}return x}),A=D(()=>p.value.brand&&p.value.model&&p.value.year&&p.value.price>0),L=(x,$)=>{i.value=x,u.value=x.id||`custom-${Date.now()}`,f.value=$},v=()=>{if(!A.value)return;const x={...p.value,id:`custom-${Date.now()}`,isCustom:!0};L(x,"custom")},h=()=>{i.value&&(r("vehicle-selected",{vehicle:i.value,type:f.value}),r("close"),i.value=null,u.value=null,f.value=null,o.value="",l.value=!1,p.value={brand:"",model:"",year:new Date().getFullYear(),price:0,stockDays:null,image:""})};return(x,$)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":a},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-6xl"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...$[7]||($[7]=[P("Select Vehicle",-1)])]),_:1})]),_:1}),e("div",du,[k.value.length?(d(),b("div",uu,[$[8]||($[8]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-sparkles text-purple-600"}),P(" Recommended Vehicles ")],-1)),e("div",cu,[(d(!0),b(ye,null,we(k.value,F=>(d(),Q(Xt,{key:F.id,vehicle:F,badge:F.isRequested?"Requested":"Recommended","stock-days":F.stockDays,selected:u.value===F.id,onSelect:H=>L(F,F.isRequested?"requested":"recommended")},null,8,["vehicle","badge","stock-days","selected","onSelect"]))),128))])])):q("",!0),e("div",null,[$[11]||($[11]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-warehouse text-green-600"}),P(" Browse Stock ")],-1)),e("div",pu,[e("div",mu,[$[9]||($[9]=e("i",{class:"fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-sub text-sm"},null,-1)),te(e("input",{"onUpdate:modelValue":$[0]||($[0]=F=>o.value=F),type:"text",placeholder:"Search by brand, model, year...",class:"w-full bg-surface border border-E5E7EB rounded-lg pl-10 pr-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[xe,o.value]])])]),S.value.length?(d(),b("div",fu,[(d(!0),b(ye,null,we(S.value,F=>(d(),Q(Xt,{key:F.id,vehicle:F,badge:"In Stock","stock-days":F.stockDays,selected:u.value===F.id,onSelect:H=>L(F,"stock")},null,8,["vehicle","stock-days","selected","onSelect"]))),128))])):(d(),b("div",yu,[...$[10]||($[10]=[e("i",{class:"fa-solid fa-search text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm font-medium"},"No vehicles found matching your search",-1),e("p",{class:"text-xs mt-1 text-sub"},"Try different keywords or clear the search",-1)])]))]),e("div",null,[$[19]||($[19]=e("h3",{class:"text-sm font-bold text-heading mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-wrench text-orange-600"}),P(" Configure Custom Vehicle ")],-1)),e("div",gu,[$[18]||($[18]=e("p",{class:"text-xs text-body mb-3"}," Build a custom configuration with specific options and features ",-1)),e("button",{onClick:$[1]||($[1]=F=>l.value=!l.value),class:"bg-orange-600 hover:bg-orange-700 text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[$[12]||($[12]=e("i",{class:"fa-solid fa-cog mr-2"},null,-1)),P(" "+I(l.value?"Hide Configuration":"Build Custom Configuration"),1)]),l.value?(d(),b("div",vu,[e("div",bu,[e("div",null,[$[13]||($[13]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Brand",-1)),te(e("input",{"onUpdate:modelValue":$[2]||($[2]=F=>p.value.brand=F),type:"text",class:"input",placeholder:"e.g., Audi"},null,512),[[xe,p.value.brand]])]),e("div",null,[$[14]||($[14]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Model",-1)),te(e("input",{"onUpdate:modelValue":$[3]||($[3]=F=>p.value.model=F),type:"text",class:"input",placeholder:"e.g., e-tron GT"},null,512),[[xe,p.value.model]])]),e("div",null,[$[15]||($[15]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Year",-1)),te(e("input",{"onUpdate:modelValue":$[4]||($[4]=F=>p.value.year=F),type:"number",class:"input",placeholder:"2024"},null,512),[[xe,p.value.year]])]),e("div",null,[$[16]||($[16]=e("label",{class:"block text-xs font-medium text-body mb-1"},"Price (â‚¬)",-1)),te(e("input",{"onUpdate:modelValue":$[5]||($[5]=F=>p.value.price=F),type:"number",class:"input",placeholder:"98000"},null,512),[[xe,p.value.price]])])]),e("div",hu,[e("button",{onClick:v,disabled:!A.value,class:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-4 py-2 rounded-lg text-sm transition-colors"},[...$[17]||($[17]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),P(" Use Custom Configuration ",-1)])],8,xu)])])):q("",!0)])])]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:$[6]||($[6]=F=>x.$emit("close"))}),i.value?(d(),Q(n(Z),{key:0,label:"Confirm Selection",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",onClick:h})):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},ku={class:"space-y-4"},Cu=["max"],Su={__name:"ContractDateModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=T(""),o=T(""),l=T(""),i=D(()=>new Date().toISOString().split("T")[0]);Ee(()=>s.show,p=>{if(p){const g=new Date;a.value=g.toISOString().split("T")[0],o.value=g.toTimeString().slice(0,5),l.value=""}});const u=()=>{if(!a.value)return;const p=o.value?`${a.value}T${o.value}:00`:`${a.value}T12:00:00`;r("confirm",{contractDate:p,notes:l.value})},f=()=>{r("cancel")},c=p=>{p||f()};return(p,g)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":c},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-lg"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...g[3]||(g[3]=[P("Set Contract Signing Date",-1)])]),_:1}),w(n(qt),null,{default:O(()=>[...g[4]||(g[4]=[P("Record when the contract was signed to track delivery timeline",-1)])]),_:1})]),_:1}),e("div",ku,[e("div",null,[g[5]||(g[5]=e("label",{class:"block label-upper mb-2"},"Contract Date",-1)),te(e("input",{type:"date","onUpdate:modelValue":g[0]||(g[0]=k=>a.value=k),max:i.value,class:"input"},null,8,Cu),[[xe,a.value]])]),e("div",null,[g[6]||(g[6]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),te(e("input",{type:"time","onUpdate:modelValue":g[1]||(g[1]=k=>o.value=k),class:"input"},null,512),[[xe,o.value]])]),e("div",null,[g[7]||(g[7]=e("label",{class:"block label-upper mb-2"},"Notes (Optional)",-1)),te(e("textarea",{"onUpdate:modelValue":g[2]||(g[2]=k=>l.value=k),rows:"3",placeholder:"Add any relevant notes about the contract signing...",class:"input resize-none"},null,512),[[xe,l.value]])])]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:f}),w(n(Z),{label:"Set Contract Date",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value,onClick:u},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},$u={class:"space-y-4"},Au=["max"],Du={__name:"DeliveryModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=T(""),o=T(""),l=T(""),i=T(""),u=D(()=>new Date().toISOString().split("T")[0]);Ee(()=>s.show,g=>{if(g){const k=new Date;a.value=k.toISOString().split("T")[0],o.value=k.toTimeString().slice(0,5),l.value="",i.value=""}});const f=()=>{if(!a.value||!l.value)return;const g=o.value?`${a.value}T${o.value}:00`:`${a.value}T12:00:00`;r("confirm",{deliveryDate:g,location:l.value,notes:i.value})},c=()=>{r("cancel")},p=g=>{g||c()};return(g,k)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":p},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-lg"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...k[4]||(k[4]=[P("Mark as Delivered",-1)])]),_:1}),w(n(qt),null,{default:O(()=>[...k[5]||(k[5]=[P("Record the vehicle delivery date and details",-1)])]),_:1})]),_:1}),e("div",$u,[e("div",null,[k[6]||(k[6]=e("label",{class:"block label-upper mb-2"},"Delivery Date",-1)),te(e("input",{type:"date","onUpdate:modelValue":k[0]||(k[0]=S=>a.value=S),max:u.value,class:"input"},null,8,Au),[[xe,a.value]])]),e("div",null,[k[7]||(k[7]=e("label",{class:"block label-upper mb-2"},"Time (Optional)",-1)),te(e("input",{type:"time","onUpdate:modelValue":k[1]||(k[1]=S=>o.value=S),class:"input"},null,512),[[xe,o.value]])]),e("div",null,[k[9]||(k[9]=e("label",{class:"block label-upper mb-2"},"Delivery Location",-1)),te(e("select",{"onUpdate:modelValue":k[2]||(k[2]=S=>l.value=S),class:"input"},[...k[8]||(k[8]=[e("option",{value:""},"Select location...",-1),e("option",{value:"Dealership"},"At Dealership",-1),e("option",{value:"Customer Address"},"Customer Address",-1),e("option",{value:"Other"},"Other Location",-1)])],512),[[ut,l.value]])]),e("div",null,[k[10]||(k[10]=e("label",{class:"block label-upper mb-2"},"Delivery Notes",-1)),te(e("textarea",{"onUpdate:modelValue":k[3]||(k[3]=S=>i.value=S),rows:"3",placeholder:"Add any relevant delivery details, customer feedback, etc...",class:"input resize-none"},null,512),[[xe,i.value]])])]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:c}),w(n(Z),{label:"Mark as Delivered",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-green-600 !hover:bg-green-700 !border-green-600",disabled:!a.value||!l.value,onClick:f},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Tu={class:"space-y-4"},Iu={__name:"CloseAsLostModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=t,r=m,a=T(""),o=T("");Ee(()=>s.show,f=>{f&&(a.value="",o.value="")});const l=()=>{a.value&&r("confirm",{reason:a.value,notes:o.value})},i=()=>{r("cancel")},u=f=>{f||i()};return(f,c)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":u},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-lg"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...c[2]||(c[2]=[P("Close as Lost",-1)])]),_:1}),w(n(qt),null,{default:O(()=>[...c[3]||(c[3]=[P("Document why this opportunity didn't close",-1)])]),_:1})]),_:1}),e("div",Tu,[e("div",null,[c[5]||(c[5]=e("label",{class:"block label-upper mb-2"},"Reason",-1)),te(e("select",{"onUpdate:modelValue":c[0]||(c[0]=p=>a.value=p),class:"input"},[...c[4]||(c[4]=[e("option",{value:""},"Select a reason...",-1),e("option",{value:"Not interested"},"Not interested",-1),e("option",{value:"Budget constraints"},"Budget constraints",-1),e("option",{value:"Found better price"},"Found better price at competitor",-1),e("option",{value:"No response"},"Customer not responding",-1),e("option",{value:"Wrong timing"},"Timing not right",-1),e("option",{value:"Other"},"Other",-1)])],512),[[ut,a.value]])]),e("div",null,[c[6]||(c[6]=e("label",{class:"block label-upper mb-2"},"Additional Notes",-1)),te(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=p=>o.value=p),rows:"4",placeholder:"Add any relevant details about why this opportunity was lost...",class:"input resize-none"},null,512),[[xe,o.value]])])]),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:i}),w(n(Z),{label:"Close as Lost",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-red-600 !hover:bg-red-700 !border-red-600",disabled:!a.value,onClick:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},qu={__name:"RequalifyAsLeadModal",props:{show:{type:Boolean,required:!0}},emits:["confirm","cancel"],setup(t,{emit:m}){const s=m,r=a=>{a||s("cancel")};return(a,o)=>(d(),Q(n(at),{open:t.show,"onUpdate:open":r},{default:O(()=>[w(n(Ze),null,{default:O(()=>[w(n(Xe),{class:"fixed inset-0 z-50 bg-black/50"}),w(n(et),{class:"w-full sm:max-w-lg"},{default:O(()=>[w(n(tt),null,{default:O(()=>[w(n(st),null,{default:O(()=>[...o[2]||(o[2]=[P("Requalify as Lead",-1)])]),_:1}),w(n(qt),null,{default:O(()=>[...o[3]||(o[3]=[P("This will convert the opportunity back to a lead. Some data will be lost.",-1)])]),_:1})]),_:1}),o[4]||(o[4]=e("div",{class:"space-y-6 max-h-screen-60 overflow-y-auto"},[e("div",{class:"flex items-start gap-4 mb-6"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 rounded-sm bg-yellow-100 flex items-center justify-center border border-yellow-200"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-600 text-xl"})])]),e("div",{class:"flex-1"},[e("p",{class:"text-meta"}," Requalifying this opportunity will reset its stage and remove negotiation history. ")])]),e("div",null,[e("h4",{class:"text-sm font-bold text-red-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-times-circle"}),P(" What will be lost ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity stage and expected close date")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Opportunity value and negotiation history")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Stock or configured vehicles added to the opportunity")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-minus text-red-500 text-xs mt-1"}),e("span",null,"Offer history and negotiation data")])])]),e("div",null,[e("h4",{class:"text-sm font-bold text-green-700 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-check-circle"}),P(" What will be kept ")]),e("ul",{class:"space-y-2 text-sm text-body"},[e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Customer information and contact details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"Original requested car details")]),e("li",{class:"flex items-start gap-2"},[e("i",{class:"fa-solid fa-check text-green-500 text-xs mt-1"}),e("span",null,"All activities (notes, calls, emails, etc.)")])])]),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("p",{class:"text-sm text-yellow-800"},[e("i",{class:"fa-solid fa-info-circle mr-2"}),P(" This action cannot be undone. The opportunity will be permanently removed and replaced with a new lead. ")])])],-1)),w(n(nt),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:O(()=>[w(n(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:o[0]||(o[0]=l=>a.$emit("cancel"))}),w(n(Z),{label:"Confirm Requalification",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-yellow-600 !hover:bg-yellow-700 !border-yellow-600",onClick:o[1]||(o[1]=l=>a.$emit("confirm"))})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ou={key:0,class:"bg-green-50/50 border border-green-100 rounded-card p-4"},Mu={class:"flex gap-3"},Nu={key:0,class:"space-y-3"},Lu={class:"flex items-center gap-2 pb-2 border-b border"},Eu={class:"font-semibold text-heading text-fluid-sm"},Fu={key:0,class:"flex justify-end"},Bu={__name:"OpportunityManagementWidget",props:{opportunity:{type:Object,required:!0},scheduledAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]}},emits:["vehicle-selected","offer-created","appointment-scheduled"],setup(t,{emit:m}){const s=t,r=m,a=Rt(),o=Tt(),l=T(!1),i=T(!1),u=T(!1),f=T(!1),c=T(!1),p=T(!1),g=T(!1),k=T(!1),S=T(!1),A=T(!1),L=T([]),v=D(()=>{var K,_;return((K=s.opportunity)==null?void 0:K.displayStage)||((_=s.opportunity)==null?void 0:_.stage)||"Qualified"});D(()=>ts(v.value,"opportunity"));function h(K){return K?new Date(K).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):""}const x={"schedule-appointment":()=>{l.value=!0},"view-or-schedule-appointment":()=>{s.scheduledAppointment?S.value=!0:l.value=!0},"select-vehicle":()=>{g.value=!0},"create-offer":()=>{!s.opportunity.selectedVehicle&&!s.opportunity.vehicle?g.value=!0:i.value=!0},"call-prospect":()=>{k.value=!0},"follow-up-offer":()=>{k.value=!0},"request-decision":()=>{k.value=!0},"finalize-contract":()=>{f.value=!0},"schedule-delivery":()=>{c.value=!0},"confirm-delivery":()=>{c.value=!0},"collect-feedback":()=>{k.value=!0},reschedule:()=>{A.value=!0},"cancel-appointment":()=>{confirm("Are you sure you want to cancel this appointment?")&&V()},"close-won":()=>{f.value=!0},"add-offer":()=>{i.value=!0},"add-contract":()=>{f.value=!0},"extend-deadline":()=>{k.value=!0},"close-lost":()=>{u.value=!0},reopen:()=>{W()},requalify:()=>{p.value=!0}},{primaryAction:$,secondaryActions:F,activeTaskWidget:H,taskWidgetTitle:ee,isClosed:le}=Gd(dt(s,"opportunity"),dt(s,"scheduledAppointment"),dt(s,"activities"),x,h);function ne(K){}function me(){}function ge(K){g.value=!1,r("vehicle-selected",K),setTimeout(()=>{i.value=!0},300)}function ke(K){i.value=!1,r("offer-created",K)}function J(K){l.value=!1,r("appointment-scheduled",{...K,opportunityId:s.opportunity.id,customer:s.opportunity.customer.name})}function V(){s.scheduledAppointment&&r("appointment-cancelled",s.scheduledAppointment.id)}function U(K){f.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Won",contractDate:K.contractDate})}function oe(K){c.value=!1,o.addActivity(s.opportunity.id,{type:"delivery",user:"You",action:"marked as delivered",data:K})}function N(K){u.value=!1,o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:K})}function W(){o.updateOpportunity(s.opportunity.id,{stage:"Qualified"})}function qe(K){p.value=!1,a.push(`/customer/${K.id}?type=lead`)}function Ve(K){S.value=!1}function G(K){A.value=!1}function $e(K){o.updateOpportunity(s.opportunity.id,{callbackDate:K.callbackDate})}function Te(K){o.updateOpportunity(s.opportunity.id,{stage:"Closed Lost",lossReason:K.reason||"Multiple no-shows (NS3)"})}return jt(async()=>{try{const _=(await ls({})).data||[];L.value=_.filter(de=>de.stockDays!==null&&de.stockDays!==void 0).slice(0,5)}catch(K){console.error("Failed to load recommended cars:",K),L.value=[]}}),(K,_)=>(d(),b(ye,null,[w(ys,{task:t.opportunity,"container-class":"mb-8","hide-title":"","hide-border":""},{"closed-state":O(()=>[n(le)&&!n(H)?(d(),b("div",Ou,[_[15]||(_[15]=e("div",{class:"flex justify-between items-start mb-3"},[e("div",null,[e("h4",{class:"font-bold text-heading text-fluid-sm"},"Opportunity Closed"),e("p",{class:"text-fluid-xs text-gray-500 mt-0.5"}," This opportunity has been closed. Reopen it to restart the management process, or requalify as a lead. ")])],-1)),e("div",Mu,[w(n(Z),{variant:"primary",size:"small",onClick:W,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700"},{default:O(()=>[..._[13]||(_[13]=[e("span",null,"Reopen",-1),e("i",{class:"fa-solid fa-rotate-left"},null,-1)])]),_:1}),w(n(Z),{variant:"outline",size:"small",onClick:_[0]||(_[0]=de=>p.value=!0),class:"flex items-center gap-2 bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300"},{default:O(()=>[..._[14]||(_[14]=[e("span",null,"Requalify as Lead",-1),e("i",{class:"fa-solid fa-arrow-left"},null,-1)])]),_:1})])])):q("",!0)]),"primary-action":O(()=>[!n(le)&&n($)?(d(),Q(gs,{key:0,action:n($),"color-scheme":n($).colorScheme,onActionClicked:_[1]||(_[1]=de=>n($).handler())},null,8,["action","color-scheme"])):q("",!0)]),"task-widgets":O(()=>[n(H)&&n(H).component?(d(),b("div",Nu,[e("div",Lu,[_[16]||(_[16]=e("i",{class:"fa-solid fa-clipboard-check text-blue-600 text-sm"},null,-1)),e("h5",Eu,I(n(ee)),1)]),(d(),Q(ht(n(H).component),bt(n(H).props,{onClose:me,onSetCallback:$e,onAutoCloseLost:Te}),null,16))])):q("",!0)]),"secondary-actions":O(()=>[n(F).length>0?(d(),b("div",Fu,[w(Xd,{actions:n(F),onActionSelected:ne},null,8,["actions"])])):q("",!0)]),_:1},8,["task"]),l.value?(d(),Q(In,{key:0,show:l.value,customer:t.opportunity.customer,assignee:t.opportunity.assignee,"disabled-fields":["customer"],onCreate:J,onCancel:_[2]||(_[2]=de=>l.value=!1)},null,8,["show","customer","assignee"])):q("",!0),g.value?(d(),Q(wu,{key:1,opportunity:t.opportunity,"requested-car":t.opportunity.requestedCar,"recommended-cars":L.value,onVehicleSelected:ge,onClose:_[3]||(_[3]=de=>g.value=!1)},null,8,["opportunity","requested-car","recommended-cars"])):q("",!0),i.value?(d(),Q(Cn,{key:2,opportunity:t.opportunity,vehicle:t.opportunity.selectedVehicle||t.opportunity.vehicle||t.opportunity.requestedCar,onOfferCreated:ke,onClose:_[4]||(_[4]=de=>i.value=!1)},null,8,["opportunity","vehicle"])):q("",!0),f.value?(d(),Q(Su,{key:3,opportunity:t.opportunity,onContractSet:U,onClose:_[5]||(_[5]=de=>f.value=!1)},null,8,["opportunity"])):q("",!0),c.value?(d(),Q(Du,{key:4,opportunity:t.opportunity,onDelivered:oe,onClose:_[6]||(_[6]=de=>c.value=!1)},null,8,["opportunity"])):q("",!0),u.value?(d(),Q(Iu,{key:5,opportunity:t.opportunity,onClosed:N,onClose:_[7]||(_[7]=de=>u.value=!1)},null,8,["opportunity"])):q("",!0),p.value?(d(),Q(qu,{key:6,opportunity:t.opportunity,onRequalified:qe,onClose:_[8]||(_[8]=de=>p.value=!1)},null,8,["opportunity"])):q("",!0),k.value?(d(),Q(Sn,{key:7,onClose:_[9]||(_[9]=de=>k.value=!1)})):q("",!0),S.value&&t.scheduledAppointment?(d(),Q(qn,{key:8,show:S.value,event:t.scheduledAppointment,onClose:_[10]||(_[10]=de=>S.value=!1),onEdit:_[11]||(_[11]=de=>{S.value=!1,A.value=!0}),onDelete:Ve},null,8,["show","event"])):q("",!0),A.value&&t.scheduledAppointment?(d(),Q(On,{key:9,show:A.value,event:t.scheduledAppointment,customer:t.opportunity.customer,"disabled-fields":["customer"],onSave:G,onCancel:_[12]||(_[12]=de=>A.value=!1)},null,8,["show","event","customer"])):q("",!0)],64))}};function es(t){const m=ct(),s=Tt(),r=D(()=>t.value?t.value.type==="lead"?Ed:Bu:null),a=D(()=>t.value?t.value.type==="lead"?{currentActivities:D(()=>m.currentLeadActivities),addActivity:(l,i)=>m.addActivity(l,i),updateActivity:(l,i,u)=>m.updateActivity(l,i,u),deleteActivity:(l,i)=>m.deleteActivity(l,i),updateLead:(l,i)=>m.updateLead(l,i),loadLeadById:l=>m.fetchLeadById(l)}:{currentActivities:D(()=>s.currentOpportunityActivities),addActivity:(l,i)=>s.addActivity(l,i),updateActivity:(l,i,u)=>s.updateActivity(l,i,u),deleteActivity:(l,i)=>s.deleteActivity(l,i),addVehicle:(l,i)=>s.addVehicle(l,i),createOffer:(l,i)=>s.createOffer(l,i),updateOpportunity:(l,i)=>s.updateOpportunity(l,i),loadOpportunityById:l=>s.fetchOpportunityById(l)}:null),o=D(()=>t.value?{overviewActions:["financing","tradein","purchase"],tabActions:["note","call","email","sms","whatsapp","attachment"]}:{overviewActions:[],tabActions:[]});return{managementWidget:r,storeAdapter:a,addNewConfig:o}}function Vu(){const t=c=>{if(!c)return"No deadline";const p=Ut(c);return p.type==="overdue"?"OVERDUE":p.type==="today"||p.type==="urgent"?p.relativeTime:ss(c)},m=c=>{const p=c.type==="lead"?c.requestedCar:c.vehicle;return!p||!p.type?null:{New:{type:"new",label:"New"},"New 0km":{type:"0km",label:"New 0km"},Used:{type:"used",label:"Used"},Demo:{type:"demo",label:"Demo"}}[p.type]||{type:p.type.toLowerCase(),label:p.type}},s=c=>c?{new:"bg-green-50 text-green-700","0km":"bg-blue-50 text-blue-700",used:"bg-orange-50 text-orange-700",demo:"bg-purple-50 text-purple-700"}[c.type]||"bg-gray-50 text-gray-700":"",r=c=>{if(!c||!c.assignee)return{name:"Unassigned",initials:"?"};const p=c.assigneeInitials||c.assignee.split(" ").map(g=>g[0]).join("");return{name:c.assignee,initials:p}},a=c=>{if(!c||!c.customer||!c.customer.address)return null;const g=c.customer.address.split(",");return g.length>1&&g[g.length-1].trim().replace(/^\d+\s*/,"").trim()||null};return{getDateDisplay:t,getVehicleType:m,getVehicleTypeBadgeClass:s,getOwnerInfo:r,getCustomerCity:a,getLocationDisplay:c=>{const p=a(c),g=c.source||"Unknown";return p?`${p} â€¢ ${g}`:g},getAssigneeInitials:c=>{if(!c)return"?";const p=c.split(" ");return p.length>=2?(p[0][0]+p[p.length-1][0]).toUpperCase():c.substring(0,2).toUpperCase()},getVehicleStatusDisplay:c=>{const p=c.type==="lead"?c.requestedCar:c.vehicle;if(!p)return"No vehicle";const g=m(c),k=g?g.label:p.type||"Unknown";let S="";return p.kilometers!==void 0&&p.kilometers!==null&&(p.kilometers>=1e3?S=`${(p.kilometers/1e3).toFixed(0)}k`:S=`${p.kilometers}`),S?`${k} / ${S}`:k},getTaskStatusDisplay:c=>c.type==="lead"?c.status||"Unknown":c.stage||"Unknown",getStageBadgeClass:ns,getUnselectedClass:c=>c.type==="lead"?"bg-white border border-gray-200 hover:border-blue-300":"bg-white border border-gray-200 hover:border-purple-300"}}function Ru(t){const m=ct(),s=Tt(),r=pt(),a=D(()=>{const u=(t.value?m.leads:m.leads.filter(p=>!p.isDisqualified)).map(p=>{const g=Ft(p,"lead"),k={...p,type:"lead",compositeId:`lead-${p.id}`,displayStage:g};return!k.customer&&p.customer&&(k.customer=p.customer),k}),f=s.opportunities.map(p=>{const g={...p,type:"opportunity",compositeId:`opportunity-${p.id}`};return!g.customer&&p.customer&&(g.customer=p.customer),g});let c=[];return r.isOperator()?c=u:r.isSalesman()?c=f:c=[...u,...f],c}),o=(i,u)=>u==="all"?i:i.filter(f=>f.type===u),l=D(()=>{const i=a.value.some(f=>f.type==="lead"),u=a.value.some(f=>f.type==="opportunity");return i&&u});return{allTasks:a,filterByType:o,shouldShowTypeFilter:l}}function ju(){const t=pt(),m=It(),s=Ge();return{sortTasks:(a,o)=>{if(o==="none")return[...a].sort((l,i)=>{const u=new Date(l.lastActivity||l.createdAt||0);return new Date(i.lastActivity||i.createdAt||0)-u});if(o==="urgent-first")return s.getSetting("urgencyEnabled")!==!1?[...a.map(u=>{if(u.type==="lead"&&!u.urgencyScore){const f=cs(u);return{...u,urgencyScore:f.score,urgencyLevel:f.level}}return u})].sort((u,f)=>{if(u.type==="lead"&&f.type==="lead"){const g=u.urgencyScore||0,k=f.urgencyScore||0;if(g!==k)return k-g;const S=new Date(u.createdAt||0);return new Date(f.createdAt||0)-S}if(u.type==="lead"&&f.type==="opportunity")return-1;if(u.type==="opportunity"&&f.type==="lead")return 1;if(u.priority==="Hot"&&f.priority!=="Hot")return-1;if(u.priority!=="Hot"&&f.priority==="Hot")return 1;const c=new Date(u.lastActivity||u.createdAt||0);return new Date(f.lastActivity||f.createdAt||0)-c}):[...a].sort((i,u)=>{if(i.priority==="Hot"&&u.priority!=="Hot")return-1;if(i.priority!=="Hot"&&u.priority==="Hot")return 1;const f=new Date(i.lastActivity||i.createdAt||0);return new Date(u.lastActivity||u.createdAt||0)-f});if(o==="assigned-to-me"){const l=t.currentUser.name;return[...a.filter(u=>u.assignee===l)].sort((u,f)=>{const c=new Date(u.lastActivity||u.createdAt||0);return new Date(f.lastActivity||f.createdAt||0)-c})}if(o==="assigned-to-my-team"){const l=t.currentUser;let i=[];return l.role==="manager"?i=m.users.map(f=>f.name):l.role==="salesman"?i=m.users.filter(f=>f.role==="salesman").map(f=>f.name):l.role==="operator"&&(i=m.users.filter(f=>f.role==="operator").map(f=>f.name)),[...a.filter(f=>i.includes(f.assignee))].sort((f,c)=>{const p=new Date(f.lastActivity||f.createdAt||0);return new Date(c.lastActivity||c.createdAt||0)-p})}return a}}}const Uu={class:"h-full flex flex-col lg:flex-row overflow-hidden bg-surface"},zu={key:0,class:"flex-1 flex flex-col lg:flex-row overflow-hidden min-w-0"},Wu={key:0,class:"flex items-center gap-2"},Hu={class:"w-3 h-3 rounded-full bg-black text-white font-medium flex items-center justify-center text-xs shrink-0",style:{"font-size":"0.5rem"}},Pu={class:"text-gray-600 font-medium"},_u={key:1},Qu={key:0},Yu={key:1},Gu={key:2},Ju={key:1,class:"hidden lg:flex flex-1 flex-col overflow-hidden lg:border-l border"},Ku={key:1,class:"flex-1 flex flex-col overflow-hidden min-w-0 relative"},Zu={key:0,class:"fixed top-0 right-0 bottom-0 w-full lg:w-4/5 xl:w-3/4 bg-white z-50 overflow-y-auto shadow-xl"},Xu={__name:"Tasks",setup(t){const m=Xs(),s=Rt(),r=ct(),a=Tt(),o=pt();It();const l=Ge(),{getDateDisplay:i,getVehicleType:u,getVehicleTypeBadgeClass:f,getOwnerInfo:c,getCustomerCity:p,getAssigneeInitials:g,getUnselectedClass:k}=Vu(),S=T(localStorage.getItem("tasksViewMode")||"table"),A=T(""),L=D(()=>m.query.highlight||null);Ee(S,M=>{localStorage.setItem("tasksViewMode",M)});const v=(M,R="")=>{S.value;const Y=U.value;if(S.value=M,M==="card"&&R&&(A.value=R),M==="table"&&Y)A.value="",s.push({path:"/tasks",query:{highlight:Y.compositeId}});else if(M==="card"&&L.value){const[ae,C]=L.value.split("-");s.push({path:`/tasks/${C}`,query:{type:ae}})}else M==="card"&&!L.value&&!U.value&&s.push({path:"/tasks"})},h=T("all"),x=T("none"),$=T(!1),F=T(null);T(!1);const H=T(!1),ee=T(null),le=T(!1),ne=T(null),{allTasks:me,filterByType:ge,shouldShowTypeFilter:ke}=Ru($),{sortTasks:J}=ju(),V=D(()=>{let M=ge(me.value,h.value);return M=J(M,x.value),M}),U=D(()=>{if(!m.params.id)return null;const M=parseInt(m.params.id);if(isNaN(M))return null;const R=m.query.type;if(R){const X=`${R}-${M}`;return me.value.find(se=>se.compositeId===X)||null}const Y=h.value!=="all"?me.value.filter(X=>X.type===h.value):me.value,ae=`lead-${M}`,C=`opportunity-${M}`,B=Y.find(X=>X.compositeId===ae||X.compositeId===C);return B||me.value.find(X=>X.compositeId===ae||X.compositeId===C)||null});D(()=>U.value?U.value.type==="lead"?r.currentLeadActivities:a.currentOpportunityActivities:[]);const oe=es(U),N=oe.managementWidget,W=oe.storeAdapter,qe=oe.addNewConfig,Ve=D(()=>ne.value),G=es(Ve),$e=D(()=>G.managementWidget.value),Te=D(()=>G.storeAdapter.value),K=D(()=>G.addNewConfig.value),_=k;jt(()=>{r.fetchLeads(),a.fetchOpportunities();const M=m.params.id;M&&de(M)}),Ee(()=>m.params.id,M=>{M&&de(M)}),Ee(U,M=>{M&&(M.type==="lead"?r.fetchLeadById(M.id):a.fetchOpportunityById(M.id))},{immediate:!0}),Ee(ne,M=>{M&&(M.type==="lead"?r.fetchLeadById(M.id):a.fetchOpportunityById(M.id))},{immediate:!0});const de=M=>{const R=parseInt(M),Y=me.value.find(ae=>ae.id===R);Y&&(Y.type==="lead"?r.fetchLeadById(R):a.fetchOpportunityById(R))},be=M=>{const[R,Y]=M.split("-");if(S.value==="table"){const ae=me.value.find(C=>C.compositeId===M);ae&&(ne.value=ae,le.value=!0,ae.type==="lead"?r.fetchLeadById(ae.id):a.fetchOpportunityById(ae.id));return}S.value="card",s.push({path:`/tasks/${Y}`,query:{type:R}})},Fe=()=>{if(le.value){Re();return}s.push({path:"/tasks"})},Re=()=>{le.value=!1,ne.value=null},ie=M=>{if(!U.value)return;const R=V.value.findIndex(Y=>{const ae=U.value.compositeId||`${U.value.type}-${U.value.id}`;return(Y.compositeId||`${Y.type}-${Y.id}`)===ae});if(R!==-1){if(M==="previous"&&R>0){const Y=V.value[R-1];be(Y.compositeId)}else if(M==="next"&&R<V.value.length-1){const Y=V.value[R+1];be(Y.compositeId)}}},re=M=>{if(!ne.value)return;const R=V.value.findIndex(Y=>{const ae=ne.value.compositeId||`${ne.value.type}-${ne.value.id}`;return(Y.compositeId||`${Y.type}-${Y.id}`)===ae});if(R!==-1){if(M==="previous"&&R>0){const Y=V.value[R-1];be(Y.compositeId)}else if(M==="next"&&R<V.value.length-1){const Y=V.value[R+1];be(Y.compositeId)}}},ce=M=>{F.value=F.value===M?null:M},fe=M=>{ee.value=M,H.value=!0,F.value=null},Oe=M=>{x.value=M},Be=async M=>{if(!ee.value)return;const R=ee.value,Y=M.name;R.type==="lead"?await r.updateLead(R.id,{assignee:Y,assigneeType:M.type,teamId:M.type==="team"?M.id:null}):R.type==="opportunity"&&await a.updateOpportunity(R.id,{assignee:Y,assigneeType:M.type,teamId:M.type==="team"?M.id:null}),H.value=!1,ee.value=null},Se=async M=>{F.value=null,M.type==="lead"?await r.updateLead(M.id,{priority:"Hot"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{priority:"Hot"})},Me=async M=>{F.value=null,M.type==="lead"?await r.updateLead(M.id,{priority:"Normal"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{priority:"Normal"})},he=async M=>{F.value=null;const R=o.user;R&&(M.type==="lead"?await r.updateLead(M.id,{assignee:R.name,assigneeType:"user"}):M.type==="opportunity"&&await a.updateOpportunity(M.id,{assignee:R.name,assigneeType:"user"}))},We=async M=>{if(F.value=null,M.type==="lead")try{const R=M.displayStage||M.stage||rt.NEW,Y=rt.NEW,ae=Lt(R,Y);if(ae){const{updates:C,activities:B}=ae(M);await r.updateLead(M.id,C);for(const X of B)await r.addActivity(M.id,X)}else await r.updateLead(M.id,{isDisqualified:!1,disqualifyReason:null,disqualifyCategory:null,isDuplicate:!1,stage:"Open Lead",status:"Open",nextActionDue:null,scheduledAppointment:null}),await r.addActivity(M.id,{type:"note",user:"You",action:"reopened lead",content:"Lead has been reopened for qualification"});await r.fetchLeadById(M.id)}catch(R){console.error("Failed to reopen lead:",R)}},lt=M=>{var Y;const R=[];return M.type==="lead"&&M.isDisqualified===!0&&R.push({key:"reopen",label:"Reopen Lead",onClick:()=>We(M)}),R.push({key:"reassign",label:"Reassign",onClick:()=>fe(M)}),M.assignee!==((Y=o.user)==null?void 0:Y.name)&&R.push({key:"assign-me",label:"Assign to me",onClick:()=>he(M)}),M.priority!=="Hot"?R.push({key:"mark-hot",label:"Mark as hot",onClick:()=>Se(M)}):R.push({key:"unmark-hot",label:"Unmark as hot",onClick:()=>Me(M)}),R};return(M,R)=>{var Y,ae;return d(),b("div",Uu,[w(Do,{show:!!U.value||S.value==="table"&&!!ne.value,"back-label":"Back to task list",onBack:Fe},null,8,["show"]),S.value==="card"?(d(),b("div",zu,[e("div",{class:j(["flex flex-col overflow-hidden",U.value?"hidden lg:flex shrink-0":"w-full lg:w-auto lg:shrink-0"])},[w(ba,{title:"Tasks",items:V.value,"selected-id":(Y=U.value)==null?void 0:Y.compositeId,"type-filter":h.value,"view-mode":S.value,"initial-search-query":A.value,onViewChange:v,"selected-class":C=>C.type==="lead"?"bg-surface border-2 border-blue-500 shadow-md":"bg-surface border-2 border-purple-500 shadow-md","unselected-class":n(_),"open-menu-id":F.value,getName:C=>{const B=C.customer;return B&&B.name?B.name:B&&!B.name&&B.email&&B.email.split("@")[0]||"Unknown"},getInitials:C=>{const B=C.customer;return B&&B.initials?B.initials:B&&B.name&&B.name.split(" ").map(se=>se[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"?"},getVehicleInfo:C=>{if(C.type==="lead"){if(!C.requestedCar)return"No vehicle specified";const se=C.requestedCar,ue=[`${se.brand} ${se.model}`];return se.kilometers!==void 0&&se.kilometers!==null&&ue.push(`${se.kilometers} km`),se.status&&ue.push(se.status),ue.join(" â€¢ ")}const B=C.vehicle||C.requestedCar;if(!B)return"No vehicle specified";const X=[`${B.brand} ${B.model}`];return B.kilometers!==void 0&&B.kilometers!==null&&X.push(`${B.kilometers} km`),B.status&&X.push(B.status),X.join(" â€¢ ")},avatarClass:C=>C.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600","get-menu-items":lt,"show-mobile-close":!1,onSelect:be,onMenuClick:ce,onMenuClose:R[0]||(R[0]=C=>F.value=null),onClose:Fe,"show-type-filter":n(ke),onFilterChange:R[1]||(R[1]=C=>h.value=C),onSortChange:Oe},{badges:O(({item:C})=>[C&&C.type?(d(),Q(n(At),{key:0,text:C.type==="lead"?"Lead":"Opportunity",size:"small",theme:C.type==="lead"?"blue":"gray"},null,8,["text","theme"])):q("",!0),C&&C.type==="lead"&&n(l).getSetting("urgencyEnabled")!==!1&&C.urgencyLevel?(d(),Q(n(At),{key:1,text:`${n(ps)(C.urgencyLevel)} ${C.urgencyLevel}`,size:"small",class:j(n(ms)(C.urgencyLevel))},null,8,["text","class"])):q("",!0),C&&C.priority==="Hot"&&(n(l).getSetting("urgencyEnabled")===!1||C.type!=="lead")?(d(),Q(n(At),{key:2,text:"HOT",size:"small",theme:"red"})):q("",!0)]),location:O(({item:C})=>[P(I(n(p)(C)||"Unknown"),1)]),source:O(({item:C})=>{var B;return[P(I(C.source||((B=C.customer)==null?void 0:B.source)||"Unknown"),1)]}),owner:O(({item:C})=>[C.assignee?(d(),b("div",Wu,[e("div",Hu,I(n(g)(C.assignee)),1),e("span",Pu,I(C.assignee),1)])):(d(),b("span",_u,"Unassigned"))]),dates:O(({item:C})=>[C.type==="lead"&&C.nextActionDue?(d(),b("span",Qu,"Due: "+I(n(i)(C.nextActionDue)),1)):C.type==="opportunity"&&C.nextActionDue?(d(),b("span",Yu,"Due: "+I(n(i)(C.nextActionDue)),1)):(d(),b("span",Gu,"Due: No deadline"))]),_:1},8,["items","selected-id","type-filter","view-mode","initial-search-query","selected-class","unselected-class","open-menu-id","getName","getInitials","getVehicleInfo","avatarClass","show-type-filter"])],2),U.value?(d(),Q(Zt,{key:0,task:U.value,"management-widget":n(N),"store-adapter":n(W),"add-new-config":n(qe),"filtered-tasks":V.value,onTaskNavigate:ie},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):q("",!0),U.value?q("",!0):(d(),b("div",Ju,[...R[6]||(R[6]=[vt('<div class="flex-1 flex items-center justify-center p-8" data-v-f89586dd><div class="text-center max-w-sm" data-v-f89586dd><div class="w-16 h-16 mx-auto mb-4 rounded-card bg-surfaceSecondary flex items-center justify-center" data-v-f89586dd><i class="fa-solid fa-tasks text-2xl text-sub" data-v-f89586dd></i></div><h3 class="text-content-bold mb-2" data-v-f89586dd>No task selected</h3><p class="text-meta" data-v-f89586dd>Select a task from the list to view its details and manage activities</p></div></div>',1)])]))])):q("",!0),S.value==="table"?(d(),b("div",Ku,[w(Na,{tasks:V.value,"current-task-id":(ae=ne.value)==null?void 0:ae.compositeId,"highlight-id":L.value,"type-filter":h.value,"sort-option":x.value,"show-type-filter":n(ke),"show-closed":$.value,"show-mobile-close":!1,"open-menu-id":F.value,"get-vehicle-type":n(u),"get-vehicle-type-badge-class":n(f),"get-owner-info":n(c),"get-stage-badge-class":n(ns),"view-mode":S.value,onSelect:be,onMenuClick:ce,onMenuClose:R[2]||(R[2]=C=>F.value=null),onFilterChange:R[3]||(R[3]=C=>h.value=C),onSortChange:Oe,onToggleClosed:R[4]||(R[4]=C=>$.value=C),onReassign:fe,onClose:Fe,onViewChange:v,class:"flex-1 w-full"},null,8,["tasks","current-task-id","highlight-id","type-filter","sort-option","show-type-filter","show-closed","open-menu-id","get-vehicle-type","get-vehicle-type-badge-class","get-owner-info","get-stage-badge-class","view-mode"])])):q("",!0),w(Dt,{name:"fade"},{default:O(()=>[le.value&&S.value==="table"?(d(),b("div",{key:0,class:"fixed inset-0 bg-black/50 z-40",onClick:Re})):q("",!0)]),_:1}),w(Dt,{name:"slide-right"},{default:O(()=>[le.value&&S.value==="table"?(d(),b("div",Zu,[e("div",{class:"sticky top-0 bg-white border-b border-E5E7EB p-4 flex items-center justify-between z-10"},[R[8]||(R[8]=e("h3",{class:"text-h3-card text-heading font-semibold"},"Task Details",-1)),e("button",{onClick:Re,class:"w-8 h-8 flex items-center justify-center text-sub hover:text-body hover:bg-surfaceSecondary rounded transition-colors","aria-label":"Close task details"},[...R[7]||(R[7]=[e("i",{class:"fa-solid fa-xmark text-lg"},null,-1)])])]),ne.value&&$e.value&&Te.value?(d(),Q(Zt,{key:0,task:ne.value,"management-widget":$e.value,"store-adapter":Te.value,"add-new-config":K.value,"filtered-tasks":V.value,onTaskNavigate:re},null,8,["task","management-widget","store-adapter","add-new-config","filtered-tasks"])):q("",!0)])):q("",!0)]),_:1}),w(as,{show:H.value,onClose:R[5]||(R[5]=C=>H.value=!1),onConfirm:Be},null,8,["show"])])}}},mc=ze(Xu,[["__scopeId","data-v-f89586dd"]]);export{mc as default};
