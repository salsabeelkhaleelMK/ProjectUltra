import{r as L,a0 as Ht,h as fe,L as _e,d as l,o as s,e,n as B,w as _,g as y,t as c,F as W,i as H,x as j,p as M,k as N,B as V,s as E,y as D,X as Yt,c as I,a4 as Kt,K as et,C as ht,l as de,m as Se,j as De,N as F,v as ye,$ as Qt,a3 as Ce,E as Gt,R as Jt,G as Xt,O as Qe,V as ut,M as Zt,I as ct,a5 as _t,a6 as es}from"./index-Db_3peLd.js";import{u as kt}from"./opportunities-CySWWyzd.js";import{u as wt,_ as ts}from"./UnifiedAddForm-wanemrH9.js";import{n as K,b as ss,Z as as,a as ls,e as ns,z as qe,J as is,Y as os,$ as $t,f as Ee,F as Oe,L as Le,g as Me,h as Ne,C as Be,d as je,K as Ct}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-BDHqZScF.js";import{C as mt,D as ft,E as pt,A as rs,e as Ge,h as Je,T as ds,_ as us,P as cs,t as ms,i as fs,j as ps,k as vs,u as ys,v as bs,B as xs,m as Tt,w as St}from"./ComingSoonModal-ClD5EuQ6.js";import{_ as gs}from"./ReassignUserModal-Jtm4D-75.js";import{a as hs,_ as ks}from"./CreateEventModal-Y_RNkacC.js";import{u as ws}from"./users-Dyw3oNPt.js";import{b as $s,c as Cs,d as Ts}from"./calendar-DrsClk7B.js";import{fetchLeadsByCustomerId as Ss,fetchOpportunitiesByCustomerId as As,fetchTasksByCustomerId as Is,fetchCustomerCars as Ds}from"./contacts-BPIU2ljN.js";const qs={class:"w-full card-container p-3 md:px-8 md:py-3.5"},Es={class:"flex items-center justify-between gap-4"},Os={class:"flex flex-col gap-2 flex-1 min-w-0"},Ls={class:"flex items-start gap-3 min-w-0 flex-1"},Ms={class:"min-w-0 flex-1"},Ns={class:"flex items-center gap-2"},Bs={class:"text-fluid-base font-bold uppercase text-brand-dark truncate leading-tight"},js={class:"flex flex-col gap-1.5 mt-1"},Vs={class:"flex flex-wrap items-center gap-x-4 gap-y-0.5"},Rs={class:"flex items-center gap-1.5 group"},Fs={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},Us={class:"flex items-center gap-1.5 group"},Ps={class:"text-xs text-heading font-medium whitespace-nowrap"},Ws={class:"flex items-center gap-1.5"},zs={key:0,class:"fa-solid fa-map-marker-alt text-sm text-brand-dark font-bold"},Hs={key:1,class:"fa-regular fa-calendar text-sm text-brand-dark font-bold"},Ys={class:"text-xs text-heading font-medium truncate max-w-36 lg:max-w-none"},Ks={class:"flex flex-wrap items-center gap-1.5 ml-16"},Qs={class:"shrink-0 flex items-center gap-2"},Gs={class:"relative"},Js={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]},showCloseButton:{type:Boolean,default:!1}},emits:["action","add-tag","close"],setup(t,{emit:x}){const o=t,g=x,C=L(!1),w=Ht(),d=fe(),i=b=>{C.value=!1,g("action",b)},T=async(b,v)=>{try{await navigator.clipboard.writeText(b),w.pushToast("success",`${v==="email"?"Email":"Phone"} copied!`)}catch{w.pushToast("error","Failed to copy")}},r=()=>g("add-tag"),a=()=>{o.customerId&&d.push(`/customer/${o.customerId}`)},n=()=>{if(o.customerId){const b=d.resolve(`/customer/${o.customerId}`).href;window.open(b,"_blank")}};return(b,v)=>{const S=_e("click-outside");return s(),l("div",qs,[e("div",Es,[e("div",Os,[e("div",Ls,[e("button",{onClick:_(a,["stop"]),class:B(["w-12 h-12 rounded-lg bg-black text-white flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...v[15]||(v[15]=[e("i",{class:"fa-solid fa-user text-xl text-white"},null,-1)])],2),e("div",Ms,[e("div",Ns,[e("h1",Bs,c(t.name),1),t.customerId?(s(),l("button",{key:0,onClick:_(n,["stop"]),class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...v[16]||(v[16]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),e("div",js,[e("div",Vs,[e("div",Rs,[v[18]||(v[18]=e("i",{class:"fa-regular fa-envelope text-sm text-brand-dark font-bold"},null,-1)),e("span",Fs,c(t.email),1),e("button",{onClick:v[0]||(v[0]=_(h=>T(t.email,"email"),["stop"])),class:"transition-all"},[...v[17]||(v[17]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",Us,[v[20]||(v[20]=e("i",{class:"fa-solid fa-phone text-sm text-brand-dark font-bold"},null,-1)),e("span",Ps,c(t.phone),1),e("button",{onClick:v[1]||(v[1]=_(h=>T(t.phone,"phone"),["stop"])),class:"transition-all"},[...v[19]||(v[19]=[e("i",{class:"fa-regular fa-copy text-xs text-sub hover:text-brand-dark"},null,-1)])])]),e("div",Ws,[t.thirdFieldLabel.toLowerCase().includes("address")?(s(),l("i",zs)):(s(),l("i",Hs)),e("span",Ys,c(t.thirdFieldValue),1)])])])])]),e("div",Ks,[(s(!0),l(W,null,H(t.tags,h=>(s(),l("span",{key:h,class:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 font-semibold rounded"},c(h),1))),128)),e("button",{onClick:_(r,["stop"]),class:"text-xs text-sub hover:text-brand-dark font-medium hover:underline flex items-center gap-1 transition-colors"},[...v[21]||(v[21]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"add tag",-1)])])])]),e("div",Qs,[e("div",Gs,[e("button",{onClick:v[2]||(v[2]=_(h=>C.value=!C.value,["stop"])),class:"w-9 h-9 flex items-center justify-center bg-white border border-black/5 rounded-lg hover:bg-surfaceSecondary text-brand-dark shadow-sm transition-all","aria-label":"Quick actions"},[...v[22]||(v[22]=[e("i",{class:"fa-solid fa-plus text-sm"},null,-1)])]),C.value?M((s(),l("div",{key:0,class:"absolute top-full right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-black/10 py-1 z-50",onClick:v[13]||(v[13]=_(()=>{},["stop"]))},[e("button",{onClick:v[3]||(v[3]=h=>i("email")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[23]||(v[23]=[e("i",{class:"fa-solid fa-envelope text-sm",style:{color:"#2563eb"}},null,-1),N(" Email ",-1)])]),e("button",{onClick:v[4]||(v[4]=h=>i("sms")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[24]||(v[24]=[e("i",{class:"fa-solid fa-comment text-sm",style:{color:"#9333ea"}},null,-1),N(" SMS ",-1)])]),e("button",{onClick:v[5]||(v[5]=h=>i("whatsapp")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[25]||(v[25]=[e("i",{class:"fa-brands fa-whatsapp text-sm",style:{color:"#16a34a"}},null,-1),N(" WhatsApp ",-1)])]),e("button",{onClick:v[6]||(v[6]=h=>i("call")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[26]||(v[26]=[e("i",{class:"fa-solid fa-phone text-sm",style:{color:"#16a34a"}},null,-1),N(" Call ",-1)])]),v[34]||(v[34]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:v[7]||(v[7]=h=>i("note")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[27]||(v[27]=[e("i",{class:"fa-solid fa-sticky-note text-sm",style:{color:"#ea580c"}},null,-1),N(" Note ",-1)])]),e("button",{onClick:v[8]||(v[8]=h=>i("attachment")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[28]||(v[28]=[e("i",{class:"fa-solid fa-paperclip text-sm",style:{color:"#6b7280"}},null,-1),N(" Attachment ",-1)])]),v[35]||(v[35]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:v[9]||(v[9]=h=>i("financing")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[29]||(v[29]=[e("i",{class:"fa-solid fa-file-invoice-dollar text-sm",style:{color:"#4f46e5"}},null,-1),N(" Financing ",-1)])]),e("button",{onClick:v[10]||(v[10]=h=>i("tradein")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[30]||(v[30]=[e("i",{class:"fa-solid fa-arrow-right-arrow-left text-sm",style:{color:"#2563eb"}},null,-1),N(" Trade-in ",-1)])]),e("button",{onClick:v[11]||(v[11]=h=>i("purchase")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[31]||(v[31]=[e("i",{class:"fa-solid fa-handshake text-sm",style:{color:"#4f46e5"}},null,-1),N(" Offer ",-1)])]),o.taskType==="opportunity"||o.taskType==="contact"?(s(),l(W,{key:0},[v[33]||(v[33]=e("div",{class:"border-t border-black/10 my-1"},null,-1)),e("button",{onClick:v[12]||(v[12]=h=>i("appointment")),class:"w-full px-4 py-2 text-left text-sm text-greys-900 hover:bg-greys-50 flex items-center gap-2"},[...v[32]||(v[32]=[e("i",{class:"fa-regular fa-calendar text-sm",style:{color:"#9333ea"}},null,-1),N(" Appointment ",-1)])])],64)):y("",!0)])),[[S,()=>C.value=!1]]):y("",!0)]),t.showCloseButton?(s(),j(D(K),{key:0,variant:"secondary",size:"icon",onClick:v[14]||(v[14]=_(h=>b.$emit("close"),["stop"]))},{default:V(()=>[E(D(Yt),{size:16,class:"text-greys-700"})]),_:1})):y("",!0)])])])}}},Xs={class:"hidden md:inline whitespace-nowrap"},vt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const x={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},o=g=>x[g]||"fa-solid fa-circle";return(g,C)=>(s(),j(D(ls),{"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=w=>g.$emit("update:modelValue",w))},{default:V(()=>[E(D(ss),{class:"w-full justify-start border-b border-border bg-transparent"},{default:V(()=>[(s(!0),l(W,null,H(t.tabs,w=>(s(),j(D(as),{key:w.key,value:w.key,class:"flex items-center gap-1.5 data-[state=active]:border-b-2 data-[state=active]:border-brand-dark data-[state=active]:text-brand-darkDarker rounded-none pb-2"},{default:V(()=>[e("i",{class:B([o(w.key),"text-sm"])},null,2),e("span",Xs,c(w.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]))}},Zs={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},_s={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},ea={class:"flex items-center gap-1.5"},ta={key:1},sa={class:"flex items-center gap-2"},aa={key:0,class:"space-y-4"},la={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},na={class:"flex items-center gap-4"},ia={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-black/5"},oa=["src"],ra={key:1,class:"fa-solid fa-car text-3xl text-sub w-full h-full flex items-center justify-center"},da={class:"font-bold text-heading text-fluid-base md:text-fluid-lg mb-2"},ua={class:"flex items-center gap-2 flex-wrap"},ca={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-fluid-xs font-semibold rounded-md"},ma={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-fluid-xs font-semibold rounded-md"},fa={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-surfaceSecondary border border-black/5 text-body text-fluid-xs font-semibold rounded-md"},pa={class:"text-fluid-xs font-bold text-heading"},va={key:0,class:"text-right"},ya={class:"font-bold text-heading text-fluid-lg"},ba={key:0,class:"pt-2"},xa={class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},ga={class:"text-fluid-sm text-body leading-relaxed"},ha={key:1,class:"space-y-3"},ka={key:0,class:"flex items-center gap-2"},wa={class:"text-fluid-sm font-semibold text-heading"},$a={key:1,class:"bg-surfaceSecondary border border-black/5 rounded-lg p-3"},Ca={class:"text-fluid-sm text-body leading-relaxed"},Ta={key:2,class:"border-t border-black/5"},Sa={class:"font-medium"},Aa={key:3,class:"border-t border-black/5 p-6 bg-surfaceSecondary/30 text-fluid-sm animate-fade-in"},Ia={class:"mb-6"},Da={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},qa={key:0},Ea={class:"font-medium text-body"},Oa={key:1},La={class:"font-medium text-body"},Ma={key:2},Na={class:"font-medium text-body"},Ba={class:"font-medium text-body"},ja={key:0},Va={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ra={key:0},Fa={class:"font-medium text-body"},Ua={key:1},Pa={class:"font-medium text-body"},Wa={key:2},za={class:"font-medium text-body"},Ha={key:3},Ya={class:"font-medium text-body"},Ka={key:4},Qa={class:"font-mono text-xs bg-surface border border-E5E7EB px-2 py-1 rounded inline-block text-body"},Ga={key:5},Ja={class:"font-medium text-body"},Xa={key:0,class:"mt-6 flex justify-end"},Za={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const x=t,o=L(!1);I(()=>x.deliverySubstatus?Kt(x.deliverySubstatus):"");const g=I(()=>x.deliverySubstatus?x.deliverySubstatus==="Delivered"?"green":x.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),C=I(()=>et(x.stage,x.entityType));function w($){return!$||$.length===0?null:$.filter(P=>P.type==="offer").sort((P,Z)=>new Date(Z.timestamp)-new Date(P.timestamp))[0]||null}function d($){if(!$)return 0;const A=new Date($),Z=Math.abs(new Date-A);return Math.ceil(Z/(1e3*60*60*24))}const i=I(()=>{if(x.stage!=="In Negotiation")return null;const $=w(x.activities);if(!$)return null;const A=d($.timestamp);return A<1?{label:"New Offer",theme:"orange"}:A<3?{label:"Active",theme:"yellow"}:null}),T=I(()=>x.requestedCar&&x.requestedCar.brand&&x.requestedCar.model),r=I(()=>x.requestType||x.requestMessage||T.value),a=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.brand)||""}),n=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.model)||""}),b=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.year)||""}),v=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.image)||""}),S=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.price)||null}),h=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.stockDays)!==void 0?x.requestedCar.stockDays:null}),m=I(()=>{var $,A;return(($=x.requestedCar)==null?void 0:$.dealership)||((A=x.task)==null?void 0:A.dealership)||""}),f=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.registration)||""}),u=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.kilometers)!==void 0?x.requestedCar.kilometers:null}),q=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.fuelType)||""}),U=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.gearType)||""}),ee=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.vin)||""}),G=I(()=>"Email"),oe=I(()=>{var $,A;return(($=x.task)==null?void 0:$.sourceDetails)||((A=x.requestedCar)==null?void 0:A.adCampaign)||""}),pe=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.expectedPurchaseDate)||""}),ue=I(()=>{var $;return(($=x.task)==null?void 0:$.fiscalEntity)||""}),re=I(()=>{var $;return(($=x.task)==null?void 0:$.sourceDetails)||""}),se=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.adMedium)||""}),be=I(()=>{var $;return(($=x.requestedCar)==null?void 0:$.adSource)||""});I(()=>!0);const ie=I(()=>!0),J=I(()=>T.value||x.requestType||x.source||re.value||oe.value||pe.value||ue.value||se.value||be.value),ce=$=>new Intl.NumberFormat("en-US").format($),ae=$=>new Intl.NumberFormat("en-US").format($);return($,A)=>(s(),j(D(os),{class:"w-full mb-6 shadow-mk-dashboard-card"},{default:V(()=>[E(D(ns),{class:"px-4 md:px-6 py-3 border-b border-black/5"},{default:V(()=>[e("div",Zs,[r.value?(s(),l("div",_s,[A[2]||(A[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-fluid-xs"}),e("h3",{class:"font-bold text-heading text-fluid-sm"},"Request")],-1)),e("div",ea,[e("span",{class:B(["px-2 py-0.5 rounded text-fluid-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:B(["px-2 py-0.5 rounded text-fluid-xs font-medium border",C.value])},c(t.stage),3),t.deliverySubstatus?(s(),j(D(qe),{key:0,text:t.deliverySubstatus,size:"small",theme:g.value},null,8,["text","theme"])):y("",!0),i.value?(s(),j(D(qe),{key:1,text:i.value.label,size:"small",theme:i.value.theme},null,8,["text","theme"])):y("",!0)])])):(s(),l("div",ta)),e("div",sa,[A[3]||(A[3]=e("span",{class:"hidden md:inline text-fluid-xs text-sub font-medium"},"Owner",-1)),E(D(K),{onClick:A[0]||(A[0]=P=>$.$emit("reassign")),variant:"link",size:"small",class:"text-fluid-xs font-bold"},{default:V(()=>[N(c(t.owner),1)]),_:1})])])]),_:1}),r.value?(s(),j(D(is),{key:0,class:"p-4 md:p-6"},{default:V(()=>[T.value?(s(),l("div",aa,[e("div",la,[e("div",na,[e("div",ia,[v.value?(s(),l("img",{key:0,src:v.value,alt:"Car",class:"w-full h-full object-cover"},null,8,oa)):(s(),l("i",ra))]),e("div",null,[e("div",da,c(a.value)+" "+c(n.value)+" ("+c(b.value)+")",1),e("div",ua,[h.value!==void 0&&h.value!==null?(s(),l("div",ca,[A[4]||(A[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(h.value)+" days) ",1)])):T.value?(s(),l("div",ma,[...A[5]||(A[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])])):y("",!0),t.source?(s(),l("div",fa,[A[6]||(A[6]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Source:",-1)),e("span",pa,c(t.source),1)])):y("",!0)])])]),S.value?(s(),l("div",va,[A[7]||(A[7]=e("div",{class:"text-fluid-xs text-sub font-medium mb-1"},"Price",-1)),e("div",ya,"€ "+c(ce(S.value)),1)])):y("",!0)]),t.requestMessage?(s(),l("div",ba,[A[8]||(A[8]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("div",xa,[e("p",ga,c(t.requestMessage),1)])])):y("",!0)])):(s(),l("div",ha,[t.requestType?(s(),l("div",ka,[A[9]||(A[9]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Request Type:",-1)),e("span",wa,c(t.requestType),1)])):y("",!0),t.requestMessage?(s(),l("div",$a,[A[10]||(A[10]=e("div",{class:"text-fluid-xs text-sub font-medium mb-2"},"Request Message",-1)),e("p",Ca,c(t.requestMessage),1)])):y("",!0)])),J.value?(s(),l("div",Ta,[e("button",{onClick:A[1]||(A[1]=P=>o.value=!o.value),class:"w-full p-3 flex items-center justify-center gap-2 text-fluid-sm text-body hover:text-heading hover:bg-surfaceSecondary transition-colors"},[e("span",Sa,c(o.value?"Hide":"View")+" Details",1),e("i",{class:B(["fa-solid fa-chevron-down text-fluid-xs transition-transform duration-200",{"rotate-180":o.value}])},null,2)])])):y("",!0),o.value&&J.value?(s(),l("div",Aa,[e("div",Ia,[A[21]||(A[21]=e("h4",{class:"text-fluid-xs font-bold uppercase text-sub tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Da,[t.requestType?(s(),l("div",qa,[A[11]||(A[11]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Request type",-1)),e("div",Ea,c(t.requestType),1)])):y("",!0),t.source?(s(),l("div",Oa,[A[12]||(A[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source",-1)),e("div",La,c(t.source),1)])):y("",!0),e("div",null,[A[13]||(A[13]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Source details",-1)),e("div",{class:B(["font-medium",re.value?"text-body":"text-sub"])},c(re.value||"--"),3)]),m.value?(s(),l("div",Ma,[A[14]||(A[14]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Na,c(m.value),1)])):y("",!0),e("div",null,[A[15]||(A[15]=e("div",{class:"text-xs text-sub mb-1"},"Channel",-1)),e("div",Ba,c(G.value||"Email"),1)]),e("div",null,[A[16]||(A[16]=e("div",{class:"text-xs text-sub mb-1"},"AdCampaign",-1)),e("div",{class:B(["font-medium",oe.value?"text-body":"text-sub"])},c(oe.value||"--"),3)]),e("div",null,[A[17]||(A[17]=e("div",{class:"text-xs text-sub mb-1"},"AdMedium",-1)),e("div",{class:B(["font-medium",se.value?"text-body":"text-sub"])},c(se.value||"--"),3)]),e("div",null,[A[18]||(A[18]=e("div",{class:"text-xs text-sub mb-1"},"AdSource",-1)),e("div",{class:B(["font-medium",be.value?"text-body":"text-sub"])},c(be.value||"--"),3)]),e("div",null,[A[19]||(A[19]=e("div",{class:"text-xs text-sub mb-1"},"Expected purchase date",-1)),e("div",{class:B(["font-medium",pe.value?"text-body":"text-sub"])},c(pe.value||"--"),3)]),e("div",null,[A[20]||(A[20]=e("div",{class:"text-xs text-sub mb-1"},"Fiscal entity",-1)),e("div",{class:B(["font-medium",ue.value?"text-body":"text-sub"])},c(ue.value||"--"),3)])])]),T.value?(s(),l("div",ja,[A[30]||(A[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[A[29]||(A[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-sub tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Va,[f.value?(s(),l("div",Ra,[A[22]||(A[22]=e("div",{class:"text-xs text-sub mb-1"},"Registration",-1)),e("div",Fa,c(f.value),1)])):y("",!0),u.value!==void 0&&u.value!==null?(s(),l("div",Ua,[A[23]||(A[23]=e("div",{class:"text-xs text-sub mb-1"},"Kilometers",-1)),e("div",Pa,c(ae(u.value))+" Km",1)])):y("",!0),q.value?(s(),l("div",Wa,[A[24]||(A[24]=e("div",{class:"text-xs text-sub mb-1"},"Fuel type",-1)),e("div",za,c(q.value),1)])):y("",!0),U.value?(s(),l("div",Ha,[A[25]||(A[25]=e("div",{class:"text-xs text-sub mb-1"},"Gear type",-1)),e("div",Ya,c(U.value),1)])):y("",!0),ee.value?(s(),l("div",Ka,[A[26]||(A[26]=e("div",{class:"text-xs text-sub mb-1"},"VIN Number",-1)),e("div",Qa,c(ee.value),1)])):y("",!0),m.value?(s(),l("div",Ga,[A[27]||(A[27]=e("div",{class:"text-xs text-sub mb-1"},"Dealership",-1)),e("div",Ja,c(m.value),1)])):y("",!0)]),ie.value?(s(),l("div",Xa,[E(D(K),{variant:"outline",size:"small",class:"flex items-center gap-2"},{default:V(()=>[...A[28]||(A[28]=[e("i",{class:"fa-solid fa-list-check text-xs"},null,-1),N(" View technical specs ",-1)])]),_:1})])):y("",!0)])])):y("",!0)])):y("",!0)]),_:1})):y("",!0)]),_:1}))}},_a={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},el={class:"px-4 py-4 flex items-center justify-between shrink-0"},tl={class:"flex items-center gap-2"},sl={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1",style:{"box-shadow":"var(--nsc-card-shadow)"}},al={class:"flex items-center gap-2 flex-wrap mb-3"},ll={key:0,class:"space-y-3"},nl={class:"flex items-center gap-3"},il={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},ol=["src"],rl={key:1,class:"fa-solid fa-car text-2xl text-sub w-full h-full flex items-center justify-center"},dl={class:"flex-1 min-w-0"},ul={class:"font-bold text-heading text-fluid-sm mb-1"},cl={class:"flex items-center gap-2 flex-wrap"},ml={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},fl={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},pl={key:0,class:"text-right"},vl={class:"font-bold text-heading text-fluid-sm"},yl={class:"flex justify-end pt-2"},bl={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},xl={class:"mt-3 pt-3 space-y-2"},gl={key:0,class:"flex items-center justify-between text-fluid-xs"},hl={class:"text-heading font-medium"},kl={key:1,class:"flex items-center justify-between text-fluid-xs"},wl={class:"text-heading font-medium"},$l={key:2,class:"pt-2"},Cl={class:"bg-surfaceSecondary rounded-lg p-2"},Tl={class:"text-fluid-xs text-body leading-relaxed line-clamp-3"},yt={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const x=t,o=I(()=>x.task.requestedCar&&x.task.requestedCar.brand&&x.task.requestedCar.model),g=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.brand)||""}),C=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.model)||""}),w=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.year)||""}),d=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.image)||""}),i=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.price)||null}),T=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.stockDays)!==void 0?x.task.requestedCar.stockDays:null}),r=I(()=>{var m;return((m=x.task.requestedCar)==null?void 0:m.requestMessage)||""}),a=I(()=>et(x.task.displayStage||x.task.stage,x.entityType)),n=I(()=>x.task.deliverySubstatus?x.task.deliverySubstatus==="Delivered"?"green":x.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function b(m){return!m||m.length===0?null:m.filter(u=>u.type==="offer").sort((u,q)=>new Date(q.timestamp)-new Date(u.timestamp))[0]||null}function v(m){if(!m)return 0;const f=new Date(m),q=Math.abs(new Date-f);return Math.ceil(q/(1e3*60*60*24))}const S=I(()=>{if((x.task.displayStage||x.task.stage)!=="In Negotiation")return null;const m=b(x.activities);if(!m)return null;const f=v(m.timestamp);return f<1?{label:"New Offer",theme:"orange"}:f<3?{label:"Active",theme:"yellow"}:null}),h=m=>new Intl.NumberFormat("en-US").format(m);return(m,f)=>{var u,q;return s(),l("div",_a,[e("div",el,[f[4]||(f[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Requested Car")],-1)),e("div",tl,[f[3]||(f[3]=e("span",{class:"text-fluid-xs text-sub font-medium"},"Owner:",-1)),e("button",{onClick:f[0]||(f[0]=U=>m.$emit("reassign")),class:"text-fluid-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},c(t.task.assignee),1)])]),e("div",sl,[e("div",al,[e("span",{class:B(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:B(["px-2 py-1 rounded text-xs font-medium border",a.value])},c(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(s(),j(D(qe),{key:0,text:t.task.deliverySubstatus,size:"small",theme:n.value},null,8,["text","theme"])):y("",!0),S.value?(s(),j(D(qe),{key:1,text:S.value.label,size:"small",theme:S.value.theme},null,8,["text","theme"])):y("",!0)]),o.value?(s(),l("div",ll,[e("div",nl,[e("div",il,[d.value?(s(),l("img",{key:0,src:d.value,alt:"Car",class:"w-full h-full object-cover"},null,8,ol)):(s(),l("i",rl))]),e("div",dl,[e("div",ul,c(g.value)+" "+c(C.value)+" ("+c(w.value)+")",1),e("div",cl,[T.value!==void 0&&T.value!==null?(s(),l("div",ml,[f[5]||(f[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(T.value)+" days) ",1)])):(s(),l("div",fl,[...f[6]||(f[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),N(" Out of stock ",-1)])]))])]),i.value?(s(),l("div",pl,[f[7]||(f[7]=e("div",{class:"text-fluid-xs text-sub font-medium"},"Price",-1)),e("div",vl,"€ "+c(h(i.value)),1)])):y("",!0)]),e("div",yl,[E(D(K),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:f[1]||(f[1]=U=>m.$emit("add-requested-car")),class:"text-fluid-xs"},null,8,["label"])])])):(s(),l("div",bl,[f[8]||(f[8]=e("i",{class:"fa-solid fa-car text-4xl text-sub mb-3"},null,-1)),f[9]||(f[9]=e("p",{class:"text-fluid-sm text-body mb-4"},"No requested car added yet",-1)),E(D(K),{label:"+ Add or update",variant:"outline",size:"small",onClick:f[2]||(f[2]=U=>m.$emit("add-requested-car"))})])),e("div",xl,[t.task.source?(s(),l("div",gl,[f[10]||(f[10]=e("span",{class:"text-sub"},"Source",-1)),e("span",hl,c(t.task.source),1)])):y("",!0),t.task.requestType||(u=t.task.requestedCar)!=null&&u.requestType?(s(),l("div",kl,[f[11]||(f[11]=e("span",{class:"text-sub"},"Request Type",-1)),e("span",wl,c(t.task.requestType||((q=t.task.requestedCar)==null?void 0:q.requestType)),1)])):y("",!0),r.value?(s(),l("div",$l,[f[12]||(f[12]=e("div",{class:"text-fluid-xs text-sub mb-1"},"Message",-1)),e("div",Cl,[e("p",Tl,c(r.value),1)])])):y("",!0)])])])}}},Sl={class:"rounded-card flex flex-col h-full",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Al={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},Il={class:"flex items-center gap-2"},Dl={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},ql={class:"bg-white rounded-lg p-3 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},El={key:0,class:"text-center py-6 text-sub"},Ol={key:1,class:"space-y-2 overflow-y-auto flex-1"},Ll=["onClick"],Ml={class:"flex items-start justify-between gap-2"},Nl={class:"flex-1 min-w-0"},Bl={class:"flex items-center gap-2 mb-1 flex-wrap"},jl={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-sub"},Vl={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},Rl={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-sub"},Fl={key:1,class:"flex items-center gap-1 text-xs text-sub"},Ul={key:2,class:"flex items-center gap-1 text-xs text-sub"},Pl={class:"truncate max-w-[150px]"},Wl={key:3,class:"flex items-center gap-1 text-xs"},zl={class:"font-bold text-heading"},Hl={key:2,class:"text-center py-8 text-sub"},bt={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const x=t,o=fe(),g=ht(),C=kt(),w=L(!1),d=L([]),i=L([]),T=I(()=>{var h;return x.task.customerId||((h=x.task.customer)==null?void 0:h.id)||null}),r=async()=>{if(T.value){w.value=!0;try{await Promise.all([g.fetchLeads(),C.fetchOpportunities()]),d.value=g.leads||[],i.value=C.opportunities||[]}catch(h){console.error("Error fetching related tasks:",h)}finally{w.value=!1}}},a=I(()=>{if(!T.value)return[];const h=[];return d.value.forEach(m=>{m.customerId===T.value&&!(m.id===x.task.id&&x.entityType==="lead")&&h.push({...m,type:"lead"})}),i.value.forEach(m=>{m.customerId===T.value&&!(m.id===x.task.id&&x.entityType==="opportunity")&&h.push({...m,type:"opportunity"})}),h.sort((m,f)=>{const u=new Date(m.createdAt||0);return new Date(f.createdAt||0)-u})}),n=h=>{const m=h.requestedCar||h.vehicle;return m&&m.brand&&m.model?`${m.brand} ${m.model}`:null},b=h=>h?new Intl.NumberFormat("en-US").format(h):"0",v=h=>{if(!h)return"";const m=new Date(h),u=new Date-m,q=Math.floor(u/(1e3*60*60*24));return q===0?"Today":q===1?"Yesterday":q<7?`${q} days ago`:q<30?`${Math.floor(q/7)} weeks ago`:m.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},S=h=>{o.push({path:`/tasks/${h.id}`,query:{type:h.type}})};return de(()=>x.task.id,()=>{r()},{immediate:!0}),Se(()=>{r()}),(h,m)=>(s(),l("div",Sl,[e("div",Al,[e("div",Il,[m[0]||(m[0]=e("i",{class:"fa-solid fa-list text-heading text-xs"},null,-1)),m[1]||(m[1]=e("h2",{class:"text-fluid-xs font-medium text-heading"},"Other Tasks for This Customer",-1)),a.value.length>0?(s(),l("span",Dl,c(a.value.length),1)):y("",!0)])]),e("div",ql,[w.value?(s(),l("div",El,[...m[2]||(m[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):a.value.length>0?(s(),l("div",Ol,[(s(!0),l(W,null,H(a.value,f=>(s(),l("div",{key:`${f.type}-${f.id}`,class:"flex flex-col p-2 border border-E5E7EB rounded-lg hover:bg-surfaceSecondary transition-colors cursor-pointer group",onClick:u=>S(f)},[e("div",Ml,[e("div",Nl,[e("div",Bl,[e("span",{class:B(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",f.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},c(f.type==="lead"?"Lead":"Opp"),3),e("span",{class:B(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",D(et)(f.displayStage||f.stage,f.type)])},c(f.displayStage||f.stage),3),f.createdAt?(s(),l("div",jl,[e("span",null,c(v(f.createdAt)),1)])):y("",!0)]),e("div",Vl,[f.createdAt?(s(),l("div",Rl,[m[3]||(m[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,c(v(f.createdAt)),1)])):y("",!0),f.assignee?(s(),l("div",Fl,[m[4]||(m[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,c(f.assignee),1)])):y("",!0),n(f)?(s(),l("div",Ul,[m[5]||(m[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",Pl,c(n(f)),1)])):y("",!0),f.type==="opportunity"&&f.value?(s(),l("div",Wl,[m[6]||(m[6]=e("i",{class:"fa-solid fa-tag text-sub opacity-70"},null,-1)),e("span",zl,"€ "+c(b(f.value)),1)])):y("",!0)])]),m[7]||(m[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,Ll))),128))])):(s(),l("div",Hl,[...m[8]||(m[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},Yl={key:0,class:"flex-grow border-t border"},Kl={key:0,class:"ml-1.5 text-body"},Ql={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},Gl={key:1,class:"flex-grow border-t border"},xt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:x}){const o=t,g=x,C=L(!1),w={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},d=I(()=>{if(!o.activeTab||o.activeTab==="overview")return o.actions.filter(h=>!w[h]);const S=Object.entries(w).filter(([,h])=>h===o.activeTab).map(([h])=>h);return o.actions.filter(h=>S.includes(h))}),i=I(()=>o.activeTab==="communication"?!0:d.value.length===1),T=I(()=>{if(o.activeTab==="communication")return"add communication";if(!i.value||d.value.length!==1)return"";const S=d.value[0];return{note:"add note",attachment:"add attachment"}[S]||""}),r=I(()=>o.activeTab==="communication"?!1:d.value.length>1),a=I(()=>{const S={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return d.value.map(h=>({key:h,label:S[h]||h,onClick:()=>b(h)}))}),n=I(()=>{if(o.inline)return"bg-surface hover:bg-surfaceSecondary text-body font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";const S="bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-E5E7EB";return i.value?`${S} px-4 py-2 h-9`:`${S} w-9 h-9`});I(()=>d.value.some(S=>["email","whatsapp","sms"].includes(S))),I(()=>d.value.some(S=>["addVehicle","configureVehicle"].includes(S))),I(()=>d.value.some(S=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(S)));const b=S=>{C.value=!1,g("action",S)},v=()=>{if(o.activeTab==="communication"){b("call");return}i.value&&d.value.length===1?b(d.value[0]):C.value=!C.value};return(S,h)=>{const m=_e("click-outside");return t.show?(s(),l("div",{key:0,class:B(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?y("",!0):(s(),l("div",Yl)),e("div",{class:B(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:_(v,["stop"]),class:B(n.value)},[h[0]||(h[0]=e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1)),i.value?(s(),l("span",Kl,c(T.value),1)):y("",!0)],2),C.value&&r.value?M((s(),l("div",Ql,[E(D($t),{items:a.value,className:"w-48"},null,8,["items"])])),[[m,()=>C.value=!1]]):y("",!0)],2),t.inline?y("",!0):(s(),l("div",Gl))],2)):y("",!0)}}},Jl={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},Xl={class:"flex items-start gap-3"},Zl={class:"flex-1 min-w-0"},_l={class:"font-bold text-sm text-heading mb-2"},en={class:"space-y-1.5 text-xs text-gray-600"},tn={class:"flex items-center gap-2"},sn={class:"flex items-center gap-2"},an={class:"flex items-center gap-2"},ln={key:0,class:"mt-2"},nn={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const x=t,o=I(()=>x.appointmentData.date?new Date(x.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),g=I(()=>x.appointmentData.time?x.appointmentData.time:""),C=w=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[w==null?void 0:w.toLowerCase()]||"bg-surfaceSecondary text-body border border-E5E7EB";return(w,d)=>(s(),l("div",Jl,[e("div",Xl,[d[3]||(d[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Zl,[e("h4",_l,c(t.appointmentData.type),1),e("div",en,[e("div",tn,[d[0]||(d[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,c(o.value),1)]),e("div",sn,[d[1]||(d[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,c(g.value),1)]),e("div",an,[d[2]||(d[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,c(t.appointmentData.assignee),1)])]),t.appointmentData.status?(s(),l("div",ln,[e("span",{class:B(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",C(t.appointmentData.status)])},c(t.appointmentData.status),3)])):y("",!0)])])]))}},on={class:"bg-surface border border-E5E7EB rounded-xl p-4 shadow-sm flex gap-4 animate-fade-in mb-4 feed-item"},rn={class:"flex-1"},dn={class:"flex items-center gap-2 mb-1"},un={class:"text-meta-bold text-heading"},cn={class:"text-meta"},mn={class:"text-meta"},fn={key:0,class:"bg-blue-50 text-blue-600 text-meta px-1 py-0.5 rounded border border-blue-100"},pn={class:"ml-auto relative"},vn={key:0,class:"absolute right-0 top-full mt-1 z-10"},yn={key:0,class:"text-content text-body"},bn={key:1,class:"text-content text-body flex items-center gap-2"},xn={key:2,class:"mt-2"},gn={key:0},hn={key:1,class:"bg-surfaceSecondary border border-E5E7EB rounded-lg p-3"},kn={key:0},wn={class:"text-content font-bold text-heading"},$n={key:0,class:"text-meta mt-0.5"},Cn={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-meta mt-2"},Tn={key:0},Sn={key:1},An={key:2},In={key:3},Dn={key:4},qn={key:1},En={class:"text-content font-bold text-heading mb-2"},On={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},Ln={key:0},Mn={class:"text-body font-medium ml-1"},Nn={key:1},Bn={class:"text-body font-medium ml-1"},jn={key:2},Vn={class:"text-body font-medium ml-1"},Rn={key:3},Fn={class:"text-body font-medium ml-1"},Un={key:4},Pn={class:"text-body font-medium ml-1"},Wn={key:5},zn={class:"text-body font-medium ml-1"},Hn={key:2,class:"flex items-center gap-3"},Yn={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},Kn=["src"],Qn={class:"flex-1"},Gn={class:"text-content font-bold text-heading"},Jn={class:"text-meta"},Xn={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},Zn={key:3,class:"flex items-center gap-3"},_n={class:"flex-1"},ei={class:"text-content font-bold text-heading"},ti={class:"text-meta"},si={key:0,class:"text-meta mt-1"},ai={key:1,class:"text-meta mt-1"},li={key:4},ni={class:"text-content font-bold text-heading mb-2"},ii={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-meta"},oi={key:0},ri={class:"text-body font-medium ml-1"},di={key:1},ui={class:"text-body font-medium ml-1"},ci={key:2},mi={class:"text-body font-medium ml-1"},fi={key:3},pi={class:"text-body font-medium ml-1"},vi={key:4},yi={class:"text-body font-medium ml-1"},bi={key:5},xi={class:"text-body font-medium ml-1"},gi={key:0,class:"flex flex-wrap gap-2 mt-2"},hi={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},ki={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},wi={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},Xe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:x}){const o=t,g=x,C=L(!1),w=I(()=>[{key:"edit",label:"Edit",onClick:n},{key:"delete",label:"Delete",onClick:b}]),d=v=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[v]||"fa-solid fa-circle",i=v=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-surfaceSecondary text-body border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-surfaceSecondary text-body border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[v]||"bg-surfaceSecondary text-body border",T=v=>{if(!v)return"Just now";const S=new Date(v),m=new Date-S,f=Math.floor(m/6e4),u=Math.floor(f/60),q=Math.floor(u/24);return f<1?"Just now":f<60?`${f} minutes ago`:u<24?`${u} hours ago`:q===1?"Yesterday":q<7?`${q} days ago`:S.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},r=v=>v?new Intl.NumberFormat("en-US").format(v):"0",a=v=>v?new Date(v).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",n=()=>{C.value=!1,g("edit",o.item)},b=()=>{C.value=!1,confirm("Are you sure you want to delete this item?")&&g("delete",o.item)};return(v,S)=>{const h=_e("click-outside");return s(),l("div",on,[e("div",{class:B(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",i(t.item.type)])},[e("i",{class:B([d(t.item.type),"text-sm"])},null,2)],2),e("div",rn,[e("div",dn,[e("span",un,c(t.customerInitials),1),e("span",cn,c(t.item.action||"added"),1),e("span",mn,"• "+c(T(t.item.timestamp)),1),t.item.autoDetected?(s(),l("span",fn,"Auto-detected")):y("",!0),e("div",pn,[e("button",{onClick:S[0]||(S[0]=_(m=>C.value=!C.value,["stop"])),class:"text-gray-400 hover:text-body transition-colors p-1",title:"More actions"},[...S[1]||(S[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),C.value?M((s(),l("div",vn,[E(D($t),{items:w.value,className:"w-32"},null,8,["items"])])),[[h,()=>C.value=!1]]):y("",!0)])]),t.item.content?(s(),l("div",yn,c(t.item.content),1)):y("",!0),t.item.fileName?(s(),l("div",bn,[S[2]||(S[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,c(t.item.fileName),1)])):y("",!0),t.item.data?(s(),l("div",xn,[t.item.type==="appointment"?(s(),l("div",gn,[E(nn,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(s(),l("div",hn,[t.item.type==="tradein"?(s(),l("div",kn,[e("h4",wn,c(t.item.data.brand)+" "+c(t.item.data.model),1),t.item.data.version?(s(),l("p",$n,c(t.item.data.version),1)):y("",!0),e("div",Cn,[t.item.data.year?(s(),l("div",Tn,[S[3]||(S[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),N(c(t.item.data.year),1)])):y("",!0),t.item.data.km?(s(),l("div",Sn,[S[4]||(S[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),N(c(t.item.data.km)+" km ",1)])):y("",!0),t.item.data.plate?(s(),l("div",An,[S[5]||(S[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),N(c(t.item.data.plate),1)])):y("",!0),t.item.data.date?(s(),l("div",In,[S[6]||(S[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),N(c(a(t.item.data.date)),1)])):y("",!0),t.item.data.class?(s(),l("div",Dn,[S[7]||(S[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),N(c(t.item.data.class),1)])):y("",!0)])])):t.item.type==="financing"?(s(),l("div",qn,[e("h4",En,c(t.item.data.product),1),e("div",On,[t.item.data.provider?(s(),l("div",Ln,[S[8]||(S[8]=e("span",{class:"text-gray-500"},"Provider:",-1)),e("span",Mn,c(t.item.data.provider),1)])):y("",!0),t.item.data.total?(s(),l("div",Nn,[S[9]||(S[9]=e("span",{class:"text-gray-500"},"Total:",-1)),e("span",Bn,"€"+c(r(t.item.data.total)),1)])):y("",!0),t.item.data.monthly?(s(),l("div",jn,[S[10]||(S[10]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",Vn,"€"+c(r(t.item.data.monthly)),1)])):y("",!0),t.item.data.deposit?(s(),l("div",Rn,[S[11]||(S[11]=e("span",{class:"text-gray-500"},"Deposit:",-1)),e("span",Fn,"€"+c(r(t.item.data.deposit)),1)])):y("",!0),t.item.data.startDate?(s(),l("div",Un,[S[12]||(S[12]=e("span",{class:"text-gray-500"},"Start:",-1)),e("span",Pn,c(a(t.item.data.startDate)),1)])):y("",!0),t.item.data.expDate?(s(),l("div",Wn,[S[13]||(S[13]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",zn,c(a(t.item.data.expDate)),1)])):y("",!0)])])):t.item.type==="offer"?(s(),l("div",Hn,[t.item.data.image?(s(),l("div",Yn,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Kn)])):y("",!0),e("div",Qn,[e("h4",Gn,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",Jn,"€ "+c(r(t.item.data.price)),1)]),t.item.data.isMainOffer?(s(),l("span",Xn,"Main Offer")):y("",!0)])):t.item.type==="purchase"?(s(),l("div",Zn,[e("div",_n,[e("h4",ei,c(t.item.data.brand)+" "+c(t.item.data.model)+" ("+c(t.item.data.year)+")",1),e("p",ti,"€ "+c(r(t.item.data.price)),1),t.item.data.purchaseDate?(s(),l("p",si,"Purchased: "+c(a(t.item.data.purchaseDate)),1)):y("",!0),t.item.data.notes?(s(),l("p",ai,c(t.item.data.notes),1)):y("",!0)])])):t.item.type==="purchase-method"?(s(),l("div",li,[e("h4",ni,c(t.item.data.typeLabel||t.item.data.type),1),e("div",ii,[t.item.data.monthlyInstalment?(s(),l("div",oi,[S[14]||(S[14]=e("span",{class:"text-gray-500"},"Monthly:",-1)),e("span",ri,"€"+c(r(t.item.data.monthlyInstalment)),1)])):y("",!0),t.item.data.duration?(s(),l("div",di,[S[15]||(S[15]=e("span",{class:"text-gray-500"},"Duration:",-1)),e("span",ui,c(t.item.data.duration)+" months",1)])):y("",!0),t.item.data.downPayment?(s(),l("div",ci,[S[16]||(S[16]=e("span",{class:"text-gray-500"},"Down Payment:",-1)),e("span",mi,"€"+c(r(t.item.data.downPayment)),1)])):y("",!0),t.item.data.interestRate?(s(),l("div",fi,[S[17]||(S[17]=e("span",{class:"text-gray-500"},"Interest Rate:",-1)),e("span",pi,c(t.item.data.interestRate)+"%",1)])):y("",!0),t.item.data.mileageLimit?(s(),l("div",vi,[S[18]||(S[18]=e("span",{class:"text-gray-500"},"Mileage Limit:",-1)),e("span",yi,c(r(t.item.data.mileageLimit))+" km/year",1)])):y("",!0),t.item.data.customerType?(s(),l("div",bi,[S[19]||(S[19]=e("span",{class:"text-gray-500"},"Customer Type:",-1)),e("span",xi,c(t.item.data.customerType),1)])):y("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(s(),l("div",gi,[t.item.data.insuranceIncluded?(s(),l("span",hi,"Insurance")):y("",!0),t.item.data.maintenanceIncluded?(s(),l("span",ki,"Maintenance")):y("",!0),t.item.data.registrationTaxesIncluded?(s(),l("span",wi,"Registration/Taxes")):y("",!0)])):y("",!0)])):y("",!0)]))])):y("",!0)])])}}},$i={class:"space-y-3"},Ci={class:"space-y-2"},Ti={class:"flex-1"},Si={class:"text-xs text-sub uppercase"},Ai={class:"flex justify-end gap-2 pt-3 border-t border-E5E7EB"},gt={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:x}){const o=t,g=x,C=L(""),w=d=>{d==="copy"&&navigator.clipboard.writeText(o.phoneNumber),g("call",{type:"call",option:d,phoneNumber:o.phoneNumber,notes:C.value})};return(d,i)=>(s(),l("div",$i,[e("div",Ci,[i[10]||(i[10]=e("label",{class:"block text-fluid-xs font-medium text-body uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:i[0]||(i[0]=T=>w("outbound")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[5]||(i[5]=[De('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-sub uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[1]||(i[1]=T=>w("pbx")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[...i[6]||(i[6]=[De('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-fluid-sm text-heading uppercase tracking-tight">Call with PBX</p><p class="text-xs text-sub uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:i[2]||(i[2]=T=>w("copy")),class:"w-full px-4 py-3 text-left border border-black/5 rounded-lg hover:bg-surfaceSecondary transition-all flex items-center gap-3 group"},[i[8]||(i[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Ti,[i[7]||(i[7]=e("p",{class:"font-bold text-fluid-sm text-heading uppercase tracking-tight"},"Copy Number",-1)),e("p",Si,c(t.phoneNumber),1)]),i[9]||(i[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[i[11]||(i[11]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Call Notes",-1)),M(e("textarea",{"onUpdate:modelValue":i[3]||(i[3]=T=>C.value=T),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[F,C.value]])]),e("div",Ai,[E(D(K),{label:"Cancel",variant:"outline",size:"small",onClick:i[4]||(i[4]=T=>d.$emit("cancel"))})])]))}},Ii={key:0,class:"space-y-4"},Di={class:"grid grid-cols-4 gap-2"},qi=["onClick"],Ei={class:"text-xs font-bold uppercase tracking-wider"},Oi={key:1,class:"space-y-4"},Li={class:"grid grid-cols-4 gap-2"},Mi=["onClick"],Ni={class:"text-xs font-bold uppercase tracking-wider"},Bi={key:0},ji={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:x}){const o=t,g=x,C=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],w=L(o.type);de(()=>o.type,a=>{a?w.value=a:w.value=null}),de(()=>o.taskId,()=>{w.value=null});const d=I(()=>a=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${w.value===a?"border-brand-dark bg-surfaceSecondary text-brand-dark shadow-sm":"border-black/5 text-sub hover:border-brand-dark/30 hover:bg-surfaceSecondary/30 hover:text-body"}`),i=a=>{g("save",{type:"communication",action:`sent via ${a.type}`,content:a.message,communicationType:a.type,template:a.template,subject:a.subject}),g("send",a)},T=a=>{g("save",{type:"communication",action:`called via ${a.option}`,content:a.notes||"Call attempt logged",communicationType:"call",callOption:a.option}),g("send",{type:"call",option:a.option,phoneNumber:a.phoneNumber,notes:a.notes})},r=()=>{w.value=null,g("cancel")};return(a,n)=>t.inline?(s(),l("div",Oi,[e("div",Li,[(s(),l(W,null,H(C,b=>e("button",{key:b.id,onClick:v=>w.value=b.id,class:B(d.value(b.id))},[e("i",{class:B([b.icon,"text-sm"])},null,2),e("span",Ni,c(b.label),1)],10,Mi)),64))]),w.value?(s(),l("div",Bi,[w.value==="email"?(s(),j(mt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="sms"?(s(),j(ft,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(s(),j(pt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="call"?(s(),j(gt,{key:3,"phone-number":t.phoneNumber,onCall:T,onCancel:r},null,8,["phone-number"])):y("",!0)])):y("",!0)])):(s(),l("div",Ii,[e("div",Di,[(s(),l(W,null,H(C,b=>e("button",{key:b.id,onClick:v=>w.value=b.id,class:B(d.value(b.id))},[e("i",{class:B([b.icon,"text-sm"])},null,2),e("span",Ei,c(b.label),1)],10,qi)),64))]),e("div",null,[w.value==="email"?(s(),j(mt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="sms"?(s(),j(ft,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(s(),j(pt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:i,onCancel:r},null,8,["initial-template","initial-message"])):w.value==="call"?(s(),j(gt,{key:3,"phone-number":t.phoneNumber,onCall:T,onCancel:r},null,8,["phone-number"])):y("",!0)])]))}},Vi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Ri={key:1,class:"flex justify-between items-center mb-4"},Fi={class:"text-fluid-sm font-semibold text-heading"},Ui={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Pi=["max"],Wi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zi={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Hi={class:"border border-E5E7EB rounded-card bg-surfaceSecondary"},Yi={key:0,class:"px-4 pb-4 space-y-4 border-t border-E5E7EB pt-4"},Ki={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qi={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Gi={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Ji={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:x,emit:o}){const g=t,C=o,w=L(!1),d=L({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),i=L({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),T=I(()=>!!d.value.brand&&!!d.value.model&&!!d.value.year);Se(()=>{g.item&&g.item.data&&(d.value={brand:g.item.data.brand||"",model:g.item.data.model||"",year:g.item.data.year||"",version:g.item.data.version||"",vin:g.item.data.vin||"",plates:g.item.data.plate||g.item.data.plates||"",fuelType:g.item.data.fuelType||"",gearType:g.item.data.gearType||"",kilometers:g.item.data.km||g.item.data.kilometers||"",registration:g.item.data.date||g.item.data.registration||""},g.item.data.tradeInPrice!==void 0&&(i.value={tradeInPrice:g.item.data.tradeInPrice||null,evaluationRangeLow:g.item.data.evaluationRangeLow||null,evaluationRangeHigh:g.item.data.evaluationRangeHigh||null,provider:g.item.data.provider||"",evaluationDate:g.item.data.evaluationDate||""},w.value=!0))});const r=()=>{var n,b;if(!T.value)return;const a={id:((n=g.item)==null?void 0:n.id)||Date.now(),type:"tradein",action:g.item?"updated a trade-in":"added a trade-in",timestamp:((b=g.item)==null?void 0:b.timestamp)||new Date().toISOString(),isEdit:!!g.item,data:{brand:d.value.brand,model:d.value.model,year:parseInt(d.value.year)||null,version:d.value.version||null,vin:d.value.vin||null,plate:d.value.plates||null,plates:d.value.plates||null,fuelType:d.value.fuelType||null,gearType:d.value.gearType||null,km:parseInt(d.value.kilometers)||0,kilometers:parseInt(d.value.kilometers)||0,date:d.value.registration||null,registration:d.value.registration||null,tradeInPrice:i.value.tradeInPrice,evaluationRangeLow:i.value.evaluationRangeLow,evaluationRangeHigh:i.value.evaluationRangeHigh,provider:i.value.provider||null,evaluationDate:i.value.evaluationDate||null}};C("save",a)};return x({submit:r,canSubmit:()=>T.value}),(a,n)=>(s(),l("div",{class:B(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?y("",!0):(s(),l("div",Vi)),t.hideHeader?y("",!0):(s(),l("div",Ri,[e("h5",Fi,c(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:n[0]||(n[0]=b=>a.$emit("cancel")),class:"text-sub hover:text-body"},[...n[18]||(n[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:_(r,["prevent"]),class:"space-y-4"},[e("div",Ui,[e("div",null,[n[19]||(n[19]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Brand "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":n[1]||(n[1]=b=>d.value.brand=b),type:"text",placeholder:"e.g., Volkswagen",class:"input",required:""},null,512),[[F,d.value.brand]])]),e("div",null,[n[20]||(n[20]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Model "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":n[2]||(n[2]=b=>d.value.model=b),type:"text",placeholder:"e.g., ID.4",class:"input",required:""},null,512),[[F,d.value.model]])]),e("div",null,[n[21]||(n[21]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N("Year "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("input",{"onUpdate:modelValue":n[3]||(n[3]=b=>d.value.year=b),type:"number",placeholder:"e.g., 2024",class:"input",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,Pi),[[F,d.value.year]])])]),e("div",null,[n[22]||(n[22]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Version/Trim",-1)),M(e("input",{"onUpdate:modelValue":n[4]||(n[4]=b=>d.value.version=b),type:"text",placeholder:"e.g., Premium Plus",class:"input"},null,512),[[F,d.value.version]])]),e("div",Wi,[e("div",null,[n[23]||(n[23]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"VIN",-1)),M(e("input",{"onUpdate:modelValue":n[5]||(n[5]=b=>d.value.vin=b),type:"text",placeholder:"Vehicle Identification Number",class:"input"},null,512),[[F,d.value.vin]])]),e("div",null,[n[24]||(n[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Plates",-1)),M(e("input",{"onUpdate:modelValue":n[6]||(n[6]=b=>d.value.plates=b),type:"text",placeholder:"License plate number",class:"input"},null,512),[[F,d.value.plates]])])]),e("div",zi,[e("div",null,[n[26]||(n[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Fuel Type",-1)),M(e("select",{"onUpdate:modelValue":n[7]||(n[7]=b=>d.value.fuelType=b),class:"input"},[...n[25]||(n[25]=[De('<option value="">Select fuel type...</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="Plug-in Hybrid">Plug-in Hybrid</option>',6)])],512),[[ye,d.value.fuelType]])]),e("div",null,[n[28]||(n[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Gear Type",-1)),M(e("select",{"onUpdate:modelValue":n[8]||(n[8]=b=>d.value.gearType=b),class:"input"},[...n[27]||(n[27]=[e("option",{value:""},"Select gear type...",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1),e("option",{value:"CVT"},"CVT",-1)])],512),[[ye,d.value.gearType]])]),e("div",null,[n[29]||(n[29]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage (km)",-1)),M(e("input",{"onUpdate:modelValue":n[9]||(n[9]=b=>d.value.kilometers=b),type:"number",placeholder:"0",class:"input",min:"0"},null,512),[[F,d.value.kilometers,void 0,{number:!0}]])])]),e("div",null,[n[30]||(n[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Registration Year/Month",-1)),M(e("input",{"onUpdate:modelValue":n[10]||(n[10]=b=>d.value.registration=b),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)",class:"input"},null,512),[[F,d.value.registration]])]),e("div",Hi,[e("button",{type:"button",onClick:n[11]||(n[11]=b=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-card"},[n[31]||(n[31]=e("h3",{class:"text-fluid-sm font-medium text-heading"},"Valuation Information",-1)),e("i",{class:B(["fa-solid transition-transform duration-200 text-sub",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(s(),l("div",Yi,[e("div",null,[n[32]||(n[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Trade-In Price (€)",-1)),M(e("input",{"onUpdate:modelValue":n[12]||(n[12]=b=>i.value.tradeInPrice=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[F,i.value.tradeInPrice,void 0,{number:!0}]])]),e("div",Ki,[e("div",null,[n[33]||(n[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - Low (€)",-1)),M(e("input",{"onUpdate:modelValue":n[13]||(n[13]=b=>i.value.evaluationRangeLow=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[F,i.value.evaluationRangeLow,void 0,{number:!0}]])]),e("div",null,[n[34]||(n[34]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Range - High (€)",-1)),M(e("input",{"onUpdate:modelValue":n[14]||(n[14]=b=>i.value.evaluationRangeHigh=b),type:"number",placeholder:"0.00",class:"input",min:"0",step:"0.01"},null,512),[[F,i.value.evaluationRangeHigh,void 0,{number:!0}]])])]),e("div",Qi,[e("div",null,[n[36]||(n[36]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Provider",-1)),M(e("select",{"onUpdate:modelValue":n[15]||(n[15]=b=>i.value.provider=b),class:"input"},[...n[35]||(n[35]=[De('<option value="">Select provider...</option><option value="Eurotax">Eurotax</option><option value="Infocar">Infocar</option><option value="Manual">Manual</option><option value="Other">Other</option>',5)])],512),[[ye,i.value.provider]])]),e("div",null,[n[37]||(n[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Evaluation Date",-1)),M(e("input",{"onUpdate:modelValue":n[16]||(n[16]=b=>i.value.evaluationDate=b),type:"date",class:"input"},null,512),[[F,i.value.evaluationDate]])])])])):y("",!0)])],32),t.hideActions?y("",!0):(s(),l("div",Gi,[E(D(K),{label:"Cancel",variant:"outline",size:"small",onClick:n[17]||(n[17]=b=>a.$emit("cancel"))}),E(D(K),{label:"Save",variant:"primary",size:"small",disabled:!T.value,onClick:r},null,8,["disabled"])]))],2))}},Xi={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},Zi={key:1,class:"flex justify-between items-center mb-4"},_i={class:"text-fluid-sm font-semibold text-heading"},eo={class:"flex gap-2"},to=["value"],so={key:0,class:"space-y-4"},ao={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lo={class:"relative"},no={key:0,class:"text-xs text-red-600 mt-1"},io={class:"relative"},oo={key:0,class:"text-xs text-red-600 mt-1"},ro={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},uo=["value"],co={key:0,class:"text-xs text-red-600 mt-1"},mo={key:0},fo={class:"relative"},po={key:1},vo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yo={class:"relative"},bo={class:"relative"},xo={class:"flex items-center gap-2"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ho={class:"relative"},ko={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},wo={class:"flex justify-between items-center"},$o={class:"text-lg font-bold text-heading"},Co={class:"flex flex-col gap-2"},To={class:"flex items-center gap-2"},So={class:"flex items-center gap-2"},Ao={key:0,class:"text-xs text-red-600 mt-1"},Io={class:"bg-surfaceSecondary p-4 rounded-card border border-E5E7EB"},Do={class:"flex justify-between items-center"},qo={class:"text-lg font-bold text-heading"},Eo={class:"flex flex-col gap-2"},Oo={class:"flex items-center gap-2"},Lo={class:"flex items-center gap-2"},Mo={class:"flex items-center gap-2"},No={key:2,class:"flex justify-end gap-2 mt-6 border-t border-E5E7EB pt-4"},Bo={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:x,emit:o}){const g=t,C=o,w=L({}),d=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],i=L({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),T=I(()=>{if(i.value.type!=="LEA")return 0;const f=parseFloat(i.value.fields.monthlyInstalment)||0,u=parseInt(i.value.fields.duration)||0,q=parseFloat(i.value.fields.downPayment)||0,U=parseFloat(i.value.fields.finalInstalment)||0;return f*u+q+U}),r=I(()=>{if(i.value.type!=="LTR")return 0;const f=parseFloat(i.value.fields.monthlyInstalment)||0,u=parseInt(i.value.fields.duration)||0,q=parseFloat(i.value.fields.downPayment)||0;return f*u+q}),a=f=>f==="FIN"?[12,24,36,48,60]:f==="LEA"?[24,36,48,60]:f==="LTR"?[12,24,36,48,60]:[],n=f=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[f]||f,b=f=>f?new Intl.NumberFormat("en-US").format(f):"0",v=f=>{delete w.value[f]},S=I(()=>!i.value.type||!i.value.fields.monthlyInstalment||i.value.fields.monthlyInstalment<=0||i.value.fields.downPayment===null||i.value.fields.downPayment===void 0||i.value.fields.downPayment<0||!i.value.fields.duration||i.value.fields.duration<12||i.value.fields.duration>60||i.value.type==="LTR"&&!i.value.fields.customerType?!1:Object.keys(w.value).length===0),h=()=>{i.value.type!=="FIN"&&(i.value.fields.effectiveInterestRate=null,i.value.fields.gfv=null),i.value.type!=="LEA"&&(i.value.fields.finalInstalment=null),i.value.type!=="LTR"&&(i.value.fields.customerType="",i.value.fields.registrationTaxesIncluded=!1),i.value.type!=="LEA"&&i.value.type!=="LTR"&&(i.value.fields.mileageLimit=null,i.value.fields.maintenanceIncluded=!1),w.value={}};Se(()=>{g.item&&g.item.data&&(i.value={type:g.item.data.type||"",fields:{monthlyInstalment:g.item.data.monthlyInstalment||null,downPayment:g.item.data.downPayment||null,duration:g.item.data.duration||null,interestRate:g.item.data.interestRate||null,effectiveInterestRate:g.item.data.effectiveInterestRate||null,gfv:g.item.data.gfv||null,mileageLimit:g.item.data.mileageLimit||null,finalInstalment:g.item.data.finalInstalment||null,customerType:g.item.data.customerType||"",insuranceIncluded:g.item.data.insuranceIncluded||!1,maintenanceIncluded:g.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:g.item.data.registrationTaxesIncluded||!1}})});const m=()=>{var ee,G;if(!S.value)return;const f=n(i.value.type),u=i.value.fields.monthlyInstalment||0,q=i.value.fields.duration||0,U={id:((ee=g.item)==null?void 0:ee.id)||Date.now(),type:"purchase-method",action:g.item?"updated a purchase method":"added a purchase method",content:`${f}: €${b(u)}/month for ${q} months`,timestamp:((G=g.item)==null?void 0:G.timestamp)||new Date().toISOString(),isEdit:!!g.item,data:{type:i.value.type,typeLabel:f,monthlyInstalment:i.value.fields.monthlyInstalment,downPayment:i.value.fields.downPayment,duration:i.value.fields.duration,interestRate:i.value.fields.interestRate,effectiveInterestRate:i.value.fields.effectiveInterestRate,gfv:i.value.fields.gfv,mileageLimit:i.value.fields.mileageLimit,finalInstalment:i.value.fields.finalInstalment,customerType:i.value.fields.customerType,insuranceIncluded:i.value.fields.insuranceIncluded,maintenanceIncluded:i.value.fields.maintenanceIncluded,registrationTaxesIncluded:i.value.fields.registrationTaxesIncluded,totalLeasingAmount:T.value,totalRentalAmount:r.value}};C("save",U)};return x({submit:m,canSubmit:()=>S.value}),(f,u)=>(s(),l("div",{class:B(["animate-fade-in relative",{"bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6":!t.hideHeader}])},[t.hideHeader?y("",!0):(s(),l("div",Xi)),t.hideHeader?y("",!0):(s(),l("div",Zi,[e("h5",_i,c(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:u[0]||(u[0]=q=>f.$emit("cancel")),class:"text-sub hover:text-body"},[...u[23]||(u[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:_(m,["prevent"]),class:"space-y-4"},[e("div",null,[u[24]||(u[24]=e("label",{class:"block text-fluid-xs font-medium text-body mb-2"},[N("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",eo,[(s(),l(W,null,H(d,q=>e("label",{key:q.value,class:"flex-1 cursor-pointer"},[M(e("input",{type:"radio",value:q.value,"onUpdate:modelValue":u[1]||(u[1]=U=>i.value.type=U),class:"sr-only",onChange:h},null,40,to),[[Qt,i.value.type]]),e("div",{class:B(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",i.value.type===q.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-body hover:border-brand-slate"])},c(q.label),3)])),64))])]),i.value.type?(s(),l("div",so,[e("div",ao,[e("div",null,[u[26]||(u[26]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",lo,[u[25]||(u[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":u[2]||(u[2]=q=>i.value.fields.monthlyInstalment=q),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:B(["input pl-8",{"border-red-500":w.value.monthlyInstalment}]),onInput:u[3]||(u[3]=q=>v("monthlyInstalment"))},null,34),[[F,i.value.fields.monthlyInstalment,void 0,{number:!0}]])]),w.value.monthlyInstalment?(s(),l("p",no,c(w.value.monthlyInstalment),1)):y("",!0)]),e("div",null,[u[28]||(u[28]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",io,[u[27]||(u[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":u[4]||(u[4]=q=>i.value.fields.downPayment=q),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:B(["input pl-8",{"border-red-500":w.value.downPayment}]),onInput:u[5]||(u[5]=q=>v("downPayment"))},null,34),[[F,i.value.fields.downPayment,void 0,{number:!0}]])]),w.value.downPayment?(s(),l("p",oo,c(w.value.downPayment),1)):y("",!0)])]),e("div",ro,[e("div",null,[u[30]||(u[30]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("select",{"onUpdate:modelValue":u[6]||(u[6]=q=>i.value.fields.duration=q),class:B(["input",{"border-red-500":w.value.duration}]),onChange:u[7]||(u[7]=q=>v("duration"))},[u[29]||(u[29]=e("option",{value:""},"Select duration...",-1)),(s(!0),l(W,null,H(a(i.value.type),q=>(s(),l("option",{key:q,value:q},c(q)+" months ",9,uo))),128))],34),[[ye,i.value.fields.duration,void 0,{number:!0}]]),w.value.duration?(s(),l("p",co,c(w.value.duration),1)):y("",!0)]),i.value.type==="FIN"||i.value.type==="LEA"?(s(),l("div",mo,[u[32]||(u[32]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Interest Rate / APR (%)",-1)),e("div",fo,[M(e("input",{"onUpdate:modelValue":u[8]||(u[8]=q=>i.value.fields.interestRate=q),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:u[9]||(u[9]=q=>v("interestRate"))},null,544),[[F,i.value.fields.interestRate,void 0,{number:!0}]]),u[31]||(u[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])])):y("",!0),i.value.type==="LEA"||i.value.type==="LTR"?(s(),l("div",po,[u[33]||(u[33]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Mileage Limit (annual km)",-1)),M(e("input",{"onUpdate:modelValue":u[10]||(u[10]=q=>i.value.fields.mileageLimit=q),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[F,i.value.fields.mileageLimit,void 0,{number:!0}]])])):y("",!0)]),i.value.type==="FIN"?(s(),l(W,{key:0},[e("div",vo,[e("div",null,[u[35]||(u[35]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",yo,[M(e("input",{"onUpdate:modelValue":u[11]||(u[11]=q=>i.value.fields.effectiveInterestRate=q),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[F,i.value.fields.effectiveInterestRate,void 0,{number:!0}]]),u[34]||(u[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-body"},"%",-1))])]),e("div",null,[u[37]||(u[37]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",bo,[u[36]||(u[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":u[12]||(u[12]=q=>i.value.fields.gfv=q),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[F,i.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",xo,[M(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":u[13]||(u[13]=q=>i.value.fields.insuranceIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.insuranceIncluded]]),u[38]||(u[38]=e("label",{for:"fin-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))])],64)):y("",!0),i.value.type==="LEA"?(s(),l(W,{key:1},[e("div",go,[e("div",null,[u[40]||(u[40]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},"Final Instalment (€)",-1)),e("div",ho,[u[39]||(u[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-body"},"€",-1)),M(e("input",{"onUpdate:modelValue":u[14]||(u[14]=q=>i.value.fields.finalInstalment=q),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[F,i.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",ko,[e("div",wo,[u[41]||(u[41]=e("span",{class:"text-sm font-medium text-body"},"Total Leasing Amount:",-1)),e("span",$o,"€ "+c(b(T.value)),1)]),u[42]||(u[42]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Co,[e("div",To,[M(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":u[15]||(u[15]=q=>i.value.fields.insuranceIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.insuranceIncluded]]),u[43]||(u[43]=e("label",{for:"lea-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",So,[M(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":u[16]||(u[16]=q=>i.value.fields.maintenanceIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.maintenanceIncluded]]),u[44]||(u[44]=e("label",{for:"lea-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))])])],64)):y("",!0),i.value.type==="LTR"?(s(),l(W,{key:2},[e("div",null,[u[46]||(u[46]=e("label",{class:"block text-fluid-xs font-medium text-body mb-1"},[N(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),M(e("select",{"onUpdate:modelValue":u[17]||(u[17]=q=>i.value.fields.customerType=q),class:B(["input",{"border-red-500":w.value.customerType}]),onChange:u[18]||(u[18]=q=>v("customerType"))},[...u[45]||(u[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[ye,i.value.fields.customerType]]),w.value.customerType?(s(),l("p",Ao,c(w.value.customerType),1)):y("",!0)]),e("div",Io,[e("div",Do,[u[47]||(u[47]=e("span",{class:"text-sm font-medium text-body"},"Total Rental Amount:",-1)),e("span",qo,"€ "+c(b(r.value)),1)]),u[48]||(u[48]=e("p",{class:"text-xs text-sub mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Eo,[e("div",Oo,[M(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":u[19]||(u[19]=q=>i.value.fields.insuranceIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.insuranceIncluded]]),u[49]||(u[49]=e("label",{for:"ltr-insurance",class:"text-sm text-body cursor-pointer"}," Insurance Included ",-1))]),e("div",Lo,[M(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":u[20]||(u[20]=q=>i.value.fields.maintenanceIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.maintenanceIncluded]]),u[50]||(u[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-body cursor-pointer"}," Maintenance Included ",-1))]),e("div",Mo,[M(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":u[21]||(u[21]=q=>i.value.fields.registrationTaxesIncluded=q),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ce,i.value.fields.registrationTaxesIncluded]]),u[51]||(u[51]=e("label",{for:"ltr-registration",class:"text-sm text-body cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):y("",!0)])):y("",!0)],32),t.hideActions?y("",!0):(s(),l("div",No,[E(D(K),{label:"Cancel",variant:"outline",size:"small",onClick:u[22]||(u[22]=q=>f.$emit("cancel"))}),E(D(K),{label:"Save",variant:"primary",size:"small",disabled:!S.value,onClick:m},null,8,["disabled"])]))],2))}},jo=["max"],Vo={class:"relative"},Ro={class:"border-t border pt-4"},Fo={key:0,class:"mt-4 space-y-4"},Uo={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:x}){const o=t,g=x,C=r=>{r||g("close")},w=L(!1),d=L({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});de(()=>o.show,r=>{var a;if(r&&((a=o.task)!=null&&a.requestedCar)){const n=o.task.requestedCar;d.value={brand:n.brand||"",model:n.model||"",year:n.year||new Date().getFullYear(),price:n.price||null,requestType:n.requestType||"Quotation",requestMessage:n.requestMessage||"",image:n.image||"",dealership:n.dealership||"",fuelType:n.fuelType||"",gearType:n.gearType||"",kilometers:n.kilometers||null}}else r&&(d.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const i=I(()=>d.value.brand.trim()&&d.value.model.trim()&&d.value.year>1900),T=()=>{if(!i.value)return;const r={brand:d.value.brand.trim(),model:d.value.model.trim(),year:d.value.year,requestType:d.value.requestType};d.value.price&&(r.price=d.value.price),d.value.requestMessage&&(r.requestMessage=d.value.requestMessage.trim()),d.value.image&&(r.image=d.value.image.trim()),d.value.dealership&&(r.dealership=d.value.dealership.trim()),d.value.fuelType&&(r.fuelType=d.value.fuelType),d.value.gearType&&(r.gearType=d.value.gearType),d.value.kilometers!==null&&(r.kilometers=d.value.kilometers),g("save",r)};return(r,a)=>(s(),j(D(je),{open:t.show,"onUpdate:open":C},{default:V(()=>[E(D(Ee),null,{default:V(()=>[E(D(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),E(D(Le),{class:"w-full sm:max-w-2xl"},{default:V(()=>[E(D(Me),null,{default:V(()=>[E(D(Ne),null,{default:V(()=>{var n;return[N(c((n=t.task)!=null&&n.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("form",{onSubmit:_(T,["prevent"]),class:"space-y-4"},[e("div",null,[a[13]||(a[13]=e("label",{class:"block label-upper mb-2"},"Brand *",-1)),M(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>d.value.brand=n),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"input"},null,512),[[F,d.value.brand]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block label-upper mb-2"},"Model *",-1)),M(e("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>d.value.model=n),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"input"},null,512),[[F,d.value.model]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block label-upper mb-2"},"Year *",-1)),M(e("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>d.value.year=n),type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"input"},null,8,jo),[[F,d.value.year,void 0,{number:!0}]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block label-upper mb-2"},"Price (Optional)",-1)),e("div",Vo,[a[16]||(a[16]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-sub"},"€",-1)),M(e("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>d.value.price=n),type:"number",min:"0",step:"1000",placeholder:"45000",class:"input pl-8"},null,512),[[F,d.value.price,void 0,{number:!0}]])])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block label-upper mb-2"},"Request Type",-1)),M(e("select",{"onUpdate:modelValue":a[4]||(a[4]=n=>d.value.requestType=n),class:"input"},[...a[18]||(a[18]=[e("option",{value:"Quotation"},"Quotation",-1),e("option",{value:"Test Drive"},"Test Drive",-1),e("option",{value:"Generic Sales"},"Generic Sales",-1)])],512),[[ye,d.value.requestType]])]),e("div",null,[a[20]||(a[20]=e("label",{class:"block label-upper mb-2"},"Request Message (Optional)",-1)),M(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=n=>d.value.requestMessage=n),rows:"4",placeholder:"Customer's message or notes about the vehicle request...",class:"input resize-none"},null,512),[[F,d.value.requestMessage]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block label-upper mb-2"},"Image URL (Optional)",-1)),M(e("input",{"onUpdate:modelValue":a[6]||(a[6]=n=>d.value.image=n),type:"url",placeholder:"https://example.com/car-image.jpg",class:"input"},null,512),[[F,d.value.image]]),a[22]||(a[22]=e("p",{class:"text-xs text-sub mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",Ro,[e("button",{type:"button",onClick:a[7]||(a[7]=n=>w.value=!w.value),class:"flex items-center gap-2 text-sm font-medium text-body hover:text-heading transition-colors"},[e("i",{class:B(["fa-solid",w.value?"fa-chevron-down":"fa-chevron-right"])},null,2),a[23]||(a[23]=N(" Advanced Details (Optional) ",-1))]),w.value?(s(),l("div",Fo,[e("div",null,[a[24]||(a[24]=e("label",{class:"block label-upper mb-2"},"Dealership",-1)),M(e("input",{"onUpdate:modelValue":a[8]||(a[8]=n=>d.value.dealership=n),type:"text",placeholder:"e.g., Milano, Berlin",class:"input"},null,512),[[F,d.value.dealership]])]),e("div",null,[a[26]||(a[26]=e("label",{class:"block label-upper mb-2"},"Fuel Type",-1)),M(e("select",{"onUpdate:modelValue":a[9]||(a[9]=n=>d.value.fuelType=n),class:"input"},[...a[25]||(a[25]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"Petrol"},"Petrol",-1),e("option",{value:"Diesel"},"Diesel",-1),e("option",{value:"Electric"},"Electric",-1),e("option",{value:"Hybrid"},"Hybrid",-1)])],512),[[ye,d.value.fuelType]])]),e("div",null,[a[28]||(a[28]=e("label",{class:"block label-upper mb-2"},"Gear Type",-1)),M(e("select",{"onUpdate:modelValue":a[10]||(a[10]=n=>d.value.gearType=n),class:"input"},[...a[27]||(a[27]=[e("option",{value:""},"Select gear type",-1),e("option",{value:"Manual"},"Manual",-1),e("option",{value:"Automatic"},"Automatic",-1)])],512),[[ye,d.value.gearType]])]),e("div",null,[a[29]||(a[29]=e("label",{class:"block label-upper mb-2"},"Kilometers",-1)),M(e("input",{"onUpdate:modelValue":a[11]||(a[11]=n=>d.value.kilometers=n),type:"number",min:"0",placeholder:"e.g., 50000",class:"input"},null,512),[[F,d.value.kilometers,void 0,{number:!0}]])])])):y("",!0)])],32),E(D(Be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:V(()=>{var n;return[E(D(K),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[12]||(a[12]=b=>r.$emit("close"))}),E(D(K),{label:(n=t.task)!=null&&n.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!i.value,onClick:T},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Po={class:"p-6"},Wo={__name:"OfferModal",props:{show:{type:Boolean,required:!0},item:{type:Object,default:null},taskType:{type:String,default:"opportunity"},taskId:{type:[String,Number],required:!0},requestedCar:{type:Object,default:null},recommendedCars:{type:Array,default:()=>[]}},emits:["close","save"],setup(t,{emit:x}){const o=x,g=L(null),C=I(()=>{var T;return((T=g.value)==null?void 0:T.isValid)||!1}),w=()=>{var T;(T=g.value)==null||T.submit()},d=T=>{T||o("close")},i=T=>{o("save",T),o("close")};return(T,r)=>(s(),j(D(je),{open:t.show,"onUpdate:open":d},{default:V(()=>[E(D(Ee),null,{default:V(()=>[E(D(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),E(D(Le),{class:"w-full sm:max-w-2xl p-0"},{default:V(()=>[E(D(Me),{class:"p-6 pb-4 border-b border"},{default:V(()=>[E(D(Ne),null,{default:V(()=>[...r[2]||(r[2]=[N("Create Offer",-1)])]),_:1}),E(D(Ct),null,{default:V(()=>[...r[3]||(r[3]=[N("Create a purchase offer for the customer",-1)])]),_:1})]),_:1}),e("div",Po,[E(rs,{item:t.item,"task-type":t.taskType,"task-id":t.taskId,"requested-car":t.requestedCar,"recommended-cars":t.recommendedCars,"hide-header":!0,"hide-actions":!0,ref_key:"widgetRef",ref:g,onSave:i,onCancel:r[0]||(r[0]=a=>T.$emit("close"))},null,8,["item","task-type","task-id","requested-car","recommended-cars"])]),E(D(Be),{class:"p-6 pt-4 bg-surfaceSecondary flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 border-t border"},{default:V(()=>[E(D(K),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:r[1]||(r[1]=a=>T.$emit("close"))}),E(D(K),{label:t.item?"Update Offer":"Create Offer",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!C.value,onClick:w},null,8,["label","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},zo={class:"space-y-4"},Ho={key:0},Yo={class:"flex flex-wrap gap-2"},Ko=["onClick"],Qo={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:x}){const o=t,g=x,C=L(""),w=i=>{i||g("close")};de(()=>o.show,i=>{i&&(C.value="")});const d=()=>{const i=C.value.trim();i&&(o.existingTags.includes(i)||(g("add",i),C.value=""))};return(i,T)=>(s(),j(D(je),{open:t.show,"onUpdate:open":w},{default:V(()=>[E(D(Ee),null,{default:V(()=>[E(D(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),E(D(Le),{class:"w-full sm:max-w-md"},{default:V(()=>[E(D(Me),null,{default:V(()=>[E(D(Ne),null,{default:V(()=>[...T[2]||(T[2]=[N("Add Tag",-1)])]),_:1})]),_:1}),e("div",zo,[e("div",null,[T[3]||(T[3]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Tag Name ",-1)),M(e("input",{"onUpdate:modelValue":T[0]||(T[0]=r=>C.value=r),onKeyup:Gt(d,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,544),[[F,C.value]])]),t.existingTags.length>0?(s(),l("div",Ho,[T[4]||(T[4]=e("label",{class:"block text-sm font-medium text-body mb-2"}," Existing Tags ",-1)),e("div",Yo,[(s(!0),l(W,null,H(t.existingTags,r=>(s(),l("button",{key:r,onClick:a=>C.value=r,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},c(r),9,Ko))),128))])])):y("",!0)]),E(D(Be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:V(()=>[E(D(K),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:T[1]||(T[1]=r=>i.$emit("close"))}),E(D(K),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!C.value.trim(),onClick:d},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Ze={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function Go(t){if(!t)return Ze.default;const x=t.toLowerCase().trim();return Ze[x]||Ze.default}function Jo({store:t,taskId:x,getTabForItemType:o,isOverviewModalAction:g}){const C=L(null),w=L(null),d=L("overview"),i=L(null),T=L([]);de(d,()=>{C.value=null,w.value=null});const r=I(()=>[...t.currentActivities.value,...T.value.filter(m=>!m.activityId)].filter(m=>{const f=o(m.type);return d.value==="overview"?f==="overview":f===d.value}).sort((m,f)=>{const u=new Date(m.timestamp||0);return new Date(f.timestamp||0)-u})),a=h=>(w.value=null,d.value==="overview"&&g&&g(h)?{type:"overview-modal",action:h}:(["email","sms","whatsapp","call"].includes(h)?(i.value=h,C.value="communication"):C.value=h,null)),n=async h=>{var m;if(h.isEdit){const f=T.value.findIndex(u=>u.id===h.id);f>-1&&(T.value[f]={...T.value[f],...h}),(m=w.value)!=null&&m.activityId&&await t.updateActivity(x.value,w.value.activityId,{type:h.communicationType||h.type,user:"You",action:h.action,content:h.content,fileName:h.fileName,data:h.data})}else{const f=h.communicationType||h.type,u=await t.addActivity(x.value,{type:f,user:"You",action:h.action,content:h.content,fileName:h.fileName,data:h.data});T.value.push({id:u.id,type:f==="email"||f==="whatsapp"||f==="sms"?"communication":f,action:h.action,content:h.content,fileName:h.fileName,data:h.data,timestamp:u.timestamp,activityId:u.id})}C.value=null,w.value=null},b=()=>{C.value=null,w.value=null},v=h=>{o(h.type)&&(C.value=h.type==="email"||h.type==="whatsapp"||h.type==="sms"||h.type==="communication"?"communication":h.type,w.value=h)},S=async h=>{try{await t.deleteActivity(x.value,h)}catch(m){throw console.error("Error deleting item:",m),m}};return{activeTab:d,showInlineWidget:C,inlineWidgetType:I(()=>C.value),editingItem:w,isEditing:I(()=>w.value!==null),communicationType:i,inlineContent:T,filteredInlineContent:r,handleAddNewAction:a,handleWidgetSave:n,handleWidgetCancel:b,handleEditItem:v,handleDeleteItem:S}}const Xo={class:"flex-1 flex flex-col overflow-hidden h-full"},Zo={class:"bg-surface border-b border-black/5 shrink-0"},_o={key:0},er={key:0,class:"flex-1 flex flex-row overflow-hidden"},tr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},sr={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},ar={class:"mb-4"},lr={key:0},nr={key:0},ir={key:1,class:"mb-6"},or={key:2,class:"space-y-4 mb-6 px-1"},rr={key:1},dr={key:0},ur={key:1},cr={class:"relative flex items-center py-1 mb-4"},mr={class:"relative mx-4"},fr={key:0,class:"animate-fade-in relative bg-surface border border-E5E7EB rounded-xl p-5 shadow-sm mb-6"},pr={class:"flex justify-between items-center mb-4"},vr={key:0,class:"space-y-4 mb-6 px-1"},yr={class:"hidden lg:flex flex-col overflow-hidden border-l border-black/5 shrink-0 w-80 h-full"},br={key:1,class:"flex-1 flex flex-row overflow-hidden"},xr={class:"flex-1 flex flex-col overflow-hidden min-w-0"},gr={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},hr={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},kr={class:"space-y-6"},wr={key:0},$r={key:0,class:"lg:col-span-1 space-y-6"},Cr={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Tr={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Sr={class:"rounded-card flex flex-col",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ar={class:"bg-white rounded-lg p-4 shadow-sm flex flex-col flex-1 min-h-0",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ir={class:"relative flex-1 min-h-0"},Dr={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},qr={key:1,class:"text-center py-6 text-sub"},Er={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},Or={class:"flex-1 min-w-0"},Lr={class:"text-fluid-sm text-slate-700 leading-snug"},Mr={class:"font-bold"},Nr={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-fluid-sm text-body"},Br={class:"text-fluid-xs text-sub mt-1"},jr={key:2},Vr={key:0,class:"space-y-4 mt-4"},Rr={key:1,class:"text-center py-12 text-sub"},Fr={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},showCloseButton:{type:Boolean,default:!1}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created","close"],setup(t,{emit:x}){const o=t,g=x,C=Jt(),w=fe(),d=wt(),i=ws(),T=I(()=>o.task.id),r=I(()=>C.path.startsWith("/tasks")&&!C.path.startsWith("/customer")),a=L("manage"),n=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];L(!1);const b=L(null),v=L(null),S=["note","attachment","tradein","purchase"],h=I(()=>{var Y,X;const p=[],k=new Set,R=["note","attachment","tradein","purchase","purchase-method","financing"];return(X=(Y=o.storeAdapter)==null?void 0:Y.currentActivities)!=null&&X.value&&o.storeAdapter.currentActivities.value.filter(O=>R.includes(O.type)).forEach(O=>{k.has(O.id)||(k.add(O.id),p.push(O))}),o.task.activities&&o.task.activities.filter(O=>R.includes(O.type)).forEach(O=>{k.has(O.id)||(k.add(O.id),p.push(O))}),he.value.filter(Q=>R.includes(Q.type)).forEach(Q=>{k.has(Q.id)||(k.add(Q.id),p.push(Q))}),p.sort((Q,O)=>{const $e=new Date(Q.timestamp||0);return new Date(O.timestamp||0)-$e})}),m=p=>{v.value=null,b.value=p},f=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:p.type,action:p.action,content:p.content,data:p.data,fileName:p.fileName,timestamp:p.timestamp||new Date().toISOString()}),he.value.push({id:p.id||Date.now(),type:p.type,action:p.action,content:p.content,data:p.data,fileName:p.fileName,timestamp:p.timestamp||new Date().toISOString()}),b.value=null,v.value=null}catch(k){console.error("Error saving enrich data:",k)}},u=()=>{b.value=null,v.value=null},q=p=>{v.value=p,b.value=p.type==="purchase-method"?"purchase":p.type},U=async p=>{try{await o.storeAdapter.deleteActivity(o.task.id,p.id);const k=he.value.findIndex(R=>R.id===p.id);k!==-1&&he.value.splice(k,1)}catch(k){console.error("Error deleting enrich item:",k)}};I(()=>o.task.activities?o.task.activities.filter(p=>p.type==="note"):[]),I(()=>o.task.activities?o.task.activities.filter(p=>["email","call","sms","whatsapp"].includes(p.type)):[]),I(()=>o.task.activities?o.task.activities.filter(p=>p.type==="attachment"):[]),I(()=>o.task.activities?o.task.activities.filter(p=>p.type==="purchase"):[]),I(()=>o.task.activities?o.task.activities.filter(p=>p.type==="tradein"):[]);const ee=I(()=>o.type==="contact"?"bg-blue-100 text-blue-600":o.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),G=L(C.path.startsWith("/tasks")&&!C.path.startsWith("/customer"));de(()=>C.path,p=>{G.value=p.startsWith("/tasks")&&!p.startsWith("/customer")});const oe=()=>{w.push({path:`/customer/${o.task.id}`,query:{type:o.type}})};async function pe(p){var rt,dt;const k=((rt=o.task.customer)==null?void 0:rt.id)??o.task.id,R=p.time||"10:00",z=R.length===5?`${R}:00`:R,Y=`${p.date}T${z}`,[X,Q]=R.split(":").map(Number),O=X+1,$e=`${p.date}T${String(O).padStart(2,"0")}:${String(Q||0).padStart(2,"0")}:00`;let ze=null,He="user",ot=null,Ye="",Ke=null;if(p.assignee){if(p.assignee.startsWith("user-")){const xe=parseInt(p.assignee.replace("user-",""),10),ge=i.getUserById(xe);ze=xe,He="user",Ye=(ge==null?void 0:ge.name)||""}else if(p.assignee.startsWith("team-")){const xe=parseInt(p.assignee.replace("team-",""),10),ge=i.getTeamById(xe);ot=xe,He="team",Ke=(ge==null?void 0:ge.name)||"",Ye=Ke}}const zt={type:p.type,title:p.title||`${p.type} - ${p.customer||"Customer"}`,customer:p.customer||((dt=o.task.customer)==null?void 0:dt.name)||"",customerId:k,start:Y,end:$e,assignee:Ye,assigneeId:ze,assigneeType:He,teamId:ot,team:Ke,dealership:p.dealership||"",status:"confirmed"};try{await Cs(zt)}catch(xe){console.error("Failed to create appointment:",xe);return}ce.value=!1,ae.value=!1,g("appointment-created")}const ue=()=>{$.value=!0},re=async p=>{var R,z,Y,X;const k=p.name;o.type==="lead"?await((z=(R=o.storeAdapter).updateLead)==null?void 0:z.call(R,o.task.id,{assignee:k,assigneeType:p.type,teamId:p.type==="team"?p.id:null})):o.type==="opportunity"&&await((X=(Y=o.storeAdapter).updateOpportunity)==null?void 0:X.call(Y,o.task.id,{assignee:k,assigneeType:p.type,teamId:p.type==="team"?p.id:null})),$.value=!1},se=()=>{P.value=!0},be=async p=>{var k,R,z,Y;try{o.type==="lead"?await((R=(k=o.storeAdapter).updateLead)==null?void 0:R.call(k,o.task.id,{requestedCar:p})):o.type==="opportunity"&&await((Y=(z=o.storeAdapter).updateOpportunity)==null?void 0:Y.call(z,o.task.id,{requestedCar:p})),P.value=!1}catch(X){console.error("Error saving requested car:",X)}},ie=L(!1),J=L(null),ce=L(!1),ae=L(!1),$=L(!1),A=L(!1),P=L(!1),Z=L([]),me=L(!1),ve=L(!1),le=L(!1),ne=L(!1),Ae=L(!1),Ve=L({}),{activeTab:te,showInlineWidget:Re,editingItem:Fe,communicationType:At,inlineContent:he,filteredInlineContent:Ie,handleAddNewAction:It,handleWidgetSave:Te,handleWidgetCancel:Ue,handleEditItem:tt,handleDeleteItem:st}=Jo({store:o.storeAdapter,taskId:T,getTabForItemType:Go,isOverviewModalAction:p=>te.value==="overview"&&o.addNewConfig.overviewActions.includes(p)});de(()=>o.task.id,()=>{te.value="overview"}),de(te,p=>{p!=="appointments"&&(ae.value=!1)});const Dt=I(()=>new Date().toISOString().slice(0,10));Se(async()=>{if(!r.value)try{const p=await $s();Z.value=p.dealerships||[]}catch(p){console.error("Failed to fetch calendar filter options:",p)}});const at=()=>{r.value?a.value="request":te.value="overview"},Pe=p=>{const k=It(p);k&&k.modalAction&&(J.value=k.modalAction,ie.value=!0)},We=p=>{if(p==="appointment"){ce.value=!0;return}if(p==="note"){me.value=!0;return}if(p==="attachment"){ve.value=!0;return}if(p==="whatsapp"){le.value=!0;return}if(p==="sms"){ne.value=!0;return}if(p==="email"){Ae.value=!0;return}const k={call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(p))J.value=p,ie.value=!0;else{const R=k[p];R?(te.value=R,setTimeout(()=>{Pe(p),setTimeout(()=>{try{const z=document.querySelector(".animate-fade-in");z&&z.parentNode&&z.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Pe(p)}},ke=()=>{ie.value=!1,J.value=null},qt=async p=>{var k,R;try{const z=p.type==="FIN"?"Captive Financing":p.type==="LEA"?"Leasing":"Long-Term Rental",Y=((k=p.fields)==null?void 0:k.monthlyInstalment)||0;await Te({type:"purchase-method",action:`added a ${z} purchase method`,content:`${z}: €${Y.toLocaleString()}/month for ${((R=p.fields)==null?void 0:R.duration)||0} months`,data:{purchaseMethodId:p.id,type:p.type,...p.fields}}),ke()}catch(z){console.error("Error saving purchase method:",z)}},lt=async p=>{if(J.value==="tradein")try{const{saveTradeInVehicle:k}=ys(),R=await k(o.type,o.task.id,p.vehicle,p.valuation||{});he.value.push({id:R.activity.id,type:"tradein",action:"added a trade-in",vehicleId:R.vehicle.id,data:R.activity.data,timestamp:R.activity.timestamp,activityId:R.activity.id}),ke()}catch(k){console.error("Error saving trade-in:",k)}else J.value==="purchase"&&(await Te(p),ke())},Et=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"note",content:p.content||p.message,message:p.content||p.message,timestamp:new Date().toISOString()}),me.value=!1}catch(k){console.error("Error saving note:",k)}},Ot=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"attachment",fileName:p.fileName,file:p.file,content:`Attachment: ${p.fileName}`,timestamp:new Date().toISOString()}),ve.value=!1}catch(k){console.error("Error saving attachment:",k)}},Lt=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"whatsapp",message:p.message,content:p.message,template:p.template,timestamp:new Date().toISOString()}),le.value=!1}catch(k){console.error("Error saving WhatsApp:",k)}},Mt=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"sms",message:p.message,content:p.message,template:p.template,timestamp:new Date().toISOString()}),ne.value=!1}catch(k){console.error("Error saving SMS:",k)}},Nt=async p=>{try{await o.storeAdapter.addActivity(o.task.id,{type:"email",subject:p.subject,message:p.message,content:p.message,template:p.template,timestamp:new Date().toISOString()}),Ae.value=!1}catch(k){console.error("Error saving email:",k)}},Bt=p=>{console.log("Activity clicked:",p)},jt=p=>{Ve.value[p]=!Ve.value[p]},Vt=p=>{We(p)},Rt=I(()=>{const p=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return o.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...p.slice(1),{key:"appointments",label:"Appointments"}]:p}),we=I(()=>[...o.storeAdapter.currentActivities.value,...he.value]);I(()=>J.value==="financing"?"Add Financing":J.value==="tradein"?"Add Trade-in":J.value==="purchase"?"Create Purchase Offer":"");const nt=async p=>{if(o.type==="opportunity")try{await o.storeAdapter.addVehicle(o.task.id,p.vehicleData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch(k){console.error("Error selecting vehicle:",k)}},it=async p=>{if(o.type==="opportunity")try{await o.storeAdapter.createOffer(o.task.id,p.offerData),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id)}catch(k){console.error("Error creating offer:",k)}},Ft=async p=>{var z,Y,X,Q;const k=o.task.tags||[];if(k.includes(p)){A.value=!1;return}const R=[...k,p];try{if(o.type==="lead")await((Y=(z=o.storeAdapter).updateLead)==null?void 0:Y.call(z,o.task.id,{tags:R})),o.storeAdapter.loadLeadById&&await o.storeAdapter.loadLeadById(o.task.id);else if(o.type==="opportunity")await((Q=(X=o.storeAdapter).updateOpportunity)==null?void 0:Q.call(X,o.task.id,{tags:R})),o.storeAdapter.loadOpportunityById&&await o.storeAdapter.loadOpportunityById(o.task.id);else if(o.type==="contact"){const O=C.query.type==="account"?"account":"contact";await d.updateCustomer(o.task.id,{tags:R},O),await d.fetchCustomerById(o.task.id,O),g("tag-updated")}A.value=!1}catch(O){console.error("Error adding tag:",O)}},Ut=p=>{const k={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-body",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-sub"};return k[p]||k.default},Pt=p=>{const k={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-surfaceSecondary text-body",status:"bg-orange-100 text-orange-600",default:"bg-surfaceSecondary text-sub"};return k[p]||k.default},Wt=p=>p?new Date(p).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(p,k)=>{var R,z,Y,X,Q;return s(),l("div",Xo,[e("header",Zo,[r.value?y("",!0):(s(),l("div",_o,[E(Js,{initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":ee.value,"task-type":t.type,"customer-id":((R=t.task.customer)==null?void 0:R.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"show-close-button":t.showCloseButton,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAction:We,onAddTag:k[0]||(k[0]=O=>A.value=!0),onClose:k[1]||(k[1]=O=>p.$emit("close"))},{"name-action":V(()=>[r.value?(s(),l("button",{key:0,onClick:oe,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...k[23]||(k[23]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):y("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags","show-close-button"])]))]),r.value?r.value?(s(),l("div",br,[e("div",xr,[e("div",gr,[E(vt,{modelValue:a.value,"onUpdate:modelValue":k[9]||(k[9]=O=>a.value=O),tabs:n,class:"mb-6"},null,8,["modelValue"]),a.value==="manage"?(s(),l("div",hr,[e("div",kr,[t.managementWidget?(s(),l("div",wr,[(s(),j(ut(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:k[10]||(k[10]=O=>p.$emit("car-added",O)),onConvertToLead:k[11]||(k[11]=O=>p.$emit("convert-to-lead")),onConvertToOpportunity:k[12]||(k[12]=O=>p.$emit("convert-to-opportunity")),onVehicleSelected:nt,onCreateOffer:it,onViewHistory:at},null,40,["lead","opportunity","contact","activities"]))])):y("",!0)]),t.type!=="contact"?(s(),l("div",$r,[E(yt,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:ue,onAddRequestedCar:se},null,8,["task","entity-type","activities"]),E(bt,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):y("",!0)])):y("",!0),a.value==="request"?(s(),l("div",Cr,[e("div",Tr,[t.type!=="contact"?(s(),j(yt,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:ue,onAddRequestedCar:se},null,8,["task","entity-type","activities"])):y("",!0),E(us,{task:t.task,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,onAction:We,onAddTag:k[13]||(k[13]=O=>A.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(s(),j(bt,{key:0,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):y("",!0),e("div",Sr,[k[31]||(k[31]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Activity Summary")])],-1)),e("div",Ar,[e("div",Ir,[we.value.length>0?(s(),l("div",Dr)):y("",!0),we.value.length===0?(s(),l("div",qr,[...k[30]||(k[30]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-fluid-sm"},"No activities yet",-1)])])):(s(),l("div",Er,[(s(!0),l(W,null,H(we.value,O=>(s(),l("div",{key:O.id,class:"flex gap-4 relative"},[e("div",{class:B(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",Pt(O.type)])},[e("i",{class:B([Ut(O.type),"text-fluid-sm"])},null,2)],2),e("div",Or,[e("div",Lr,[e("span",Mr,c(O.user),1),N(" "+c(O.action),1)]),O.content?(s(),l("div",Nr,c(O.content),1)):y("",!0),e("div",Br,c(Wt(O.timestamp)),1)])]))),128))]))])])])])):y("",!0),a.value==="data"?(s(),l("div",jr,[E(xt,{actions:S,"active-tab":"data",onAction:m}),e("div",null,[b.value==="note"?(s(),j(Ge,{key:0,item:v.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:u},null,8,["item","task-type","task-id"])):y("",!0),b.value==="attachment"?(s(),j(Je,{key:1,item:v.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:u},null,8,["item","task-type","task-id"])):y("",!0),b.value==="tradein"?(s(),j(Ji,{key:2,item:v.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:u},null,8,["item","task-type","task-id"])):y("",!0),b.value==="purchase"?(s(),j(Bo,{key:3,item:v.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:u},null,8,["item","task-type","task-id"])):y("",!0)]),h.value.length>0?(s(),l("div",Vr,[(s(!0),l(W,null,H(h.value,O=>{var $e;return s(),j(Xe,{key:O.id,item:O,"task-type":t.type,"customer-initials":(($e=t.task.customer)==null?void 0:$e.initials)||"SK",onEdit:q,onDelete:U},null,8,["item","task-type","customer-initials"])}),128))])):b.value?y("",!0):(s(),l("div",Rr,[...k[32]||(k[32]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-fluid-sm"},"No enrichment data yet",-1),e("p",{class:"text-fluid-xs mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):y("",!0)])])])):y("",!0):(s(),l("div",er,[e("div",tr,[e("main",sr,[e("div",ar,[E(vt,{modelValue:D(te),"onUpdate:modelValue":k[2]||(k[2]=O=>Xt(te)?te.value=O:null),tabs:Rt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),D(te)==="overview"?(s(),l("div",lr,[t.type!=="contact"?(s(),l("div",nr,[E(Za,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((z=t.task.requestedCar)==null?void 0:z.requestType)||"","request-message":((Y=t.task.requestedCar)==null?void 0:Y.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:ue},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):y("",!0),Qe(p.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(s(),l("div",ir,[(s(),j(ut(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:we.value,onCarAdded:k[3]||(k[3]=O=>p.$emit("car-added",O)),onConvertToLead:k[4]||(k[4]=O=>p.$emit("convert-to-lead")),onConvertToOpportunity:k[5]||(k[5]=O=>p.$emit("convert-to-opportunity")),onViewHistory:at,onVehicleSelected:nt,onCreateOffer:it},null,40,["lead","opportunity","contact","activities"]))])):y("",!0),D(Ie).length>0?(s(),l("div",or,[(s(!0),l(W,null,H(D(Ie),O=>(s(),j(Xe,{key:O.id,item:O,"task-type":t.type,"customer-initials":"SK",onEdit:D(tt),onDelete:D(st)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)])):(s(),l("div",rr,[t.type==="contact"&&D(te)==="negotiations"?(s(),l("div",dr,[Qe(p.$slots,"tab-negotiations")])):t.type==="contact"&&D(te)==="appointments"?(s(),l("div",ur,[e("div",cr,[k[25]||(k[25]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",mr,[ae.value?y("",!0):(s(),l("button",{key:0,onClick:k[6]||(k[6]=_(O=>ae.value=!0,["stop"])),class:"bg-surface hover:bg-surfaceSecondary text-body font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-E5E7EB"},[...k[24]||(k[24]=[e("i",{class:"fa-solid fa-plus text-xs text-body"},null,-1),e("span",{class:"ml-1.5 text-body"},"add appointment",-1)])]))]),k[26]||(k[26]=e("div",{class:"flex-grow border-t border"},null,-1))]),ae.value?(s(),l("div",fr,[k[29]||(k[29]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-E5E7EB rotate-45"},null,-1)),e("div",pr,[k[28]||(k[28]=e("h5",{class:"text-fluid-sm font-semibold text-heading"},"Add Appointment",-1)),e("button",{type:"button",onClick:k[7]||(k[7]=O=>ae.value=!1),class:"text-sub hover:text-body"},[...k[27]||(k[27]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(s(),j(hs,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":Dt.value,dealerships:Z.value,"show-actions":!0,"reset-trigger":ae.value,onCreate:pe,onCancel:k[8]||(k[8]=O=>ae.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):y("",!0),Qe(p.$slots,"tab-appointments")])):(s(),l(W,{key:2},[E(xt,{actions:t.addNewConfig.tabActions,"active-tab":D(te),onAction:Pe},null,8,["actions","active-tab"]),e("div",null,[D(Re)==="communication"?(s(),j(ji,{key:0,type:D(At),"task-type":t.type,"task-id":t.task.id,"phone-number":((X=t.task.customer)==null?void 0:X.phone)||"",item:D(Fe),onSave:D(Te),onCancel:D(Ue)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):y("",!0),D(te)==="data"&&D(Re)==="note"?(s(),j(Ge,{key:1,item:D(Fe),"task-type":t.type,"task-id":t.task.id,onSave:D(Te),onCancel:D(Ue)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0),D(Re)==="attachment"?(s(),j(Je,{key:2,item:D(Fe),"task-type":t.type,"task-id":t.task.id,onSave:D(Te),onCancel:D(Ue)},null,8,["item","task-type","task-id","onSave","onCancel"])):y("",!0)]),D(Ie).length>0?(s(),l("div",vr,[(s(!0),l(W,null,H(D(Ie),O=>(s(),j(Xe,{key:O.id,item:O,"task-type":t.type,"customer-initials":"SK",onEdit:D(tt),onDelete:D(st)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):y("",!0)],64))]))])]),e("div",yr,[E(ds,{activities:we.value,"expanded-summaries":Ve.value,onActivityClick:Bt,onToggleSummaryExpanded:jt,onAddActivity:Vt},null,8,["activities","expanded-summaries"])])])),E(cs,{show:J.value==="financing"&&ie.value,"task-type":t.type,"task-id":t.task.id,onSave:qt,onClose:ke},null,8,["show","task-type","task-id"]),E(ms,{show:J.value==="tradein"&&ie.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:lt,onClose:ke},null,8,["show","task-type","task-id"]),E(Wo,{show:J.value==="purchase"&&ie.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,"recommended-cars":[],onSave:lt,onClose:ke},null,8,["show","task-type","task-id","requested-car"]),E(gs,{show:$.value,onClose:k[14]||(k[14]=O=>$.value=!1),onConfirm:re},null,8,["show"]),E(Uo,{show:P.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:k[15]||(k[15]=O=>P.value=!1),onSave:be},null,8,["show","task","task-type","task-id"]),E(Ge,{modal:"",show:me.value,"task-type":t.type,"task-id":t.task.id,onSave:Et,onClose:k[16]||(k[16]=O=>me.value=!1)},null,8,["show","task-type","task-id"]),E(Je,{modal:"",show:ve.value,"task-type":t.type,"task-id":t.task.id,onSave:Ot,onClose:k[17]||(k[17]=O=>ve.value=!1)},null,8,["show","task-type","task-id"]),E(fs,{show:le.value,onSave:Lt,onClose:k[18]||(k[18]=O=>le.value=!1)},null,8,["show"]),E(ps,{show:ne.value,onSave:Mt,onClose:k[19]||(k[19]=O=>ne.value=!1)},null,8,["show"]),E(vs,{show:Ae.value,onSave:Nt,onClose:k[20]||(k[20]=O=>Ae.value=!1)},null,8,["show"]),ce.value?(s(),j(ks,{key:2,show:ce.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:Z.value,onCreate:pe,onCancel:k[21]||(k[21]=O=>ce.value=!1)},null,8,["show","customer","assignee","dealerships"])):y("",!0),E(Qo,{show:A.value,"existing-tags":t.task.tags||[],onClose:k[22]||(k[22]=O=>A.value=!1),onAdd:Ft},null,8,["show","existing-tags"])])}}},Ur={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Pr={class:"px-4 py-4 flex items-center justify-between shrink-0"},Wr={class:"flex items-center gap-2"},zr={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Hr={class:"bg-white rounded-card p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Yr={key:0,class:"divide-y divide-gray-100"},Kr=["onClick"],Qr={class:"flex items-start justify-between gap-3"},Gr={class:"flex-1 min-w-0"},Jr={class:"flex items-center gap-2 mb-1"},Xr={class:"text-xs font-semibold text-heading uppercase tracking-wider"},Zr={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},_r={key:0,class:"flex items-center gap-1"},ed={key:1,class:"flex items-center gap-1"},td={key:0,class:"mt-2 space-y-1.5 border-t border-gray-50 pt-2"},sd={class:"flex items-center gap-2 min-w-0"},ad={class:"text-xs text-body font-medium truncate"},ld={key:1,class:"text-center py-8 text-sub"},nd={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:x}){const o=t,g=fe(),C=r=>{if(!r)return 0;const a=new Date(r),b=Math.abs(new Date-a);return Math.ceil(b/(1e3*60*60*24))},w=r=>{const a=[];return o.allTasks&&o.allTasks.length>0&&o.allTasks.filter(b=>b.leadId===r.id).forEach(b=>{a.push({id:b.id,type:b.title||"Task",description:b.description||b.title})}),r.stage==="Open Lead"&&C(r.createdAt)>=0&&a.push({id:`lead-${r.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),a},d=r=>({LQ:"bg-orange-50 text-orange-600 border-orange-100"})[r]||"bg-surface text-body border-gray-100",i=r=>({"Open Lead":"bg-orange-50 text-orange-600 border-orange-100",Validated:"bg-blue-50 text-blue-600 border-blue-100",Contacted:"bg-blue-50 text-blue-600 border-blue-100"})[r]||"bg-surfaceSecondary text-body border-gray-100",T=r=>{const a=g.resolve({path:`/tasks/${r.id}`,query:{type:"lead"}});window.open(a.href,"_blank")};return(r,a)=>(s(),l("div",Ur,[e("div",Pr,[e("div",Wr,[a[1]||(a[1]=e("i",{class:"fa-solid fa-user-circle text-heading"},null,-1)),a[2]||(a[2]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Leads",-1)),e("span",zr,c(t.leads.length),1)]),e("button",{onClick:a[0]||(a[0]=n=>r.$emit("add-lead")),class:"text-fluid-xs text-brand-blue hover:text-brand-blue/80 font-medium flex items-center gap-1 transition-colors"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),e("div",Hr,[t.leads.length>0?(s(),l("div",Yr,[(s(!0),l(W,null,H(t.leads,n=>(s(),l("div",{key:n.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:b=>T(n)},[e("div",Qr,[e("div",Gr,[e("div",Jr,[e("span",Xr,"Lead #"+c(n.id),1),e("span",{class:B(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",i(n.stage)])},c(n.stage),3)]),e("div",Zr,[n.assignee?(s(),l("span",_r,[a[4]||(a[4]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+c(n.assignee),1)])):y("",!0),n.requestedCar?(s(),l("span",ed,[a[5]||(a[5]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+c(n.requestedCar.brand)+" "+c(n.requestedCar.model),1)])):y("",!0)])]),a[6]||(a[6]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))]),w(n).length>0?(s(),l("div",td,[(s(!0),l(W,null,H(w(n),b=>(s(),l("div",{key:b.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",sd,[e("span",{class:B(["text-xs px-1.5 py-0.5 rounded font-black uppercase tracking-widest border",d(b.type)])},c(b.type),3),e("span",ad,c(b.description),1)]),a[7]||(a[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):y("",!0)],8,Kr))),128))])):(s(),l("div",ld,[...a[8]||(a[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))])]))}},id={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},od={class:"px-4 py-4 flex items-center justify-between shrink-0"},rd={class:"flex items-center gap-2"},dd={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},ud={class:"bg-white rounded-card p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},cd={key:0,class:"divide-y divide-gray-100"},md=["onClick"],fd={class:"flex items-start justify-between gap-3"},pd={class:"flex-1 min-w-0"},vd={class:"flex items-center gap-2 mb-1"},yd={class:"text-xs font-semibold text-heading uppercase tracking-wider"},bd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},xd={key:0,class:"flex items-center gap-1"},gd={key:1,class:"flex items-center gap-1"},hd={key:2,class:"flex items-center gap-1"},kd={key:0,class:"mt-2 space-y-1.5 border-t border-gray-50 pt-2"},wd={class:"flex items-center gap-2 min-w-0"},$d={class:"text-xs text-body font-medium truncate"},Cd={key:1,class:"text-center py-8 text-sub"},Td={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:x}){const o=t,g=fe(),C=r=>{const a=[];o.allTasks&&o.allTasks.length>0&&o.allTasks.filter(h=>h.opportunityId===r.id).forEach(h=>{a.push({id:h.id,type:h.title||"Task",description:h.description||h.title})});const n=o.activities.filter(S=>S.opportunityId===r.id),b={opportunity:r,scheduledAppointment:r.scheduledAppointment||null,activities:n,hasOffers:n.some(S=>S.type==="offer")||!1,stage:r.displayStage||r.stage,deliverySubstatus:r.deliverySubstatus||null},v=bs(b.stage,b);if(v){const S={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};a.push({id:`opp-${r.id}-${v}`,type:v,description:S[v]||v})}return a},w=r=>({OOFB:"bg-blue-50 text-blue-600 border-blue-100",UFB:"bg-purple-50 text-purple-600 border-purple-100",NFU:"bg-red-50 text-red-600 border-red-100",OFB:"bg-yellow-50 text-yellow-600 border-yellow-100",CFB:"bg-green-50 text-green-600 border-green-100",DFB:"bg-teal-50 text-teal-600 border-teal-100",NS:"bg-pink-50 text-pink-600 border-pink-100"})[r]||"bg-surface text-body border-gray-100",d=r=>new Intl.NumberFormat("en-US").format(r),i=r=>({Qualified:"bg-purple-50 text-purple-600 border-purple-100","In Negotiation":"bg-blue-50 text-blue-600 border-blue-100","Closed Won":"bg-green-50 text-green-600 border-green-100","Closed Lost":"bg-red-50 text-red-600 border-red-100"})[r]||"bg-surfaceSecondary text-body border-gray-100",T=r=>{const a=g.resolve({path:`/tasks/${r.id}`,query:{type:"opportunity"}});window.open(a.href,"_blank")};return(r,a)=>(s(),l("div",id,[e("div",od,[e("div",rd,[a[1]||(a[1]=e("i",{class:"fa-solid fa-briefcase text-heading"},null,-1)),a[2]||(a[2]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Opportunities",-1)),e("span",dd,c(t.opportunities.length),1)]),e("button",{onClick:a[0]||(a[0]=n=>r.$emit("add-opportunity")),class:"text-fluid-xs text-brand-blue hover:text-brand-blue/80 font-medium flex items-center gap-1 transition-colors"},[...a[3]||(a[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),e("div",ud,[t.opportunities.length>0?(s(),l("div",cd,[(s(!0),l(W,null,H(t.opportunities,n=>(s(),l("div",{key:n.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:b=>T(n)},[e("div",fd,[e("div",pd,[e("div",vd,[e("span",yd,"Opp #"+c(n.id),1),e("span",{class:B(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",i(n.stage)])},c(n.displayStage||n.stage),3)]),e("div",bd,[n.assignee?(s(),l("span",xd,[a[4]||(a[4]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+c(n.assignee),1)])):y("",!0),n.value?(s(),l("span",gd,[a[5]||(a[5]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),N(" € "+c(d(n.value)),1)])):y("",!0),n.vehicle?(s(),l("span",hd,[a[6]||(a[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+c(n.vehicle.brand)+" "+c(n.vehicle.model),1)])):y("",!0)])]),a[7]||(a[7]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))]),C(n).length>0?(s(),l("div",kd,[(s(!0),l(W,null,H(C(n),b=>(s(),l("div",{key:b.id,class:"flex items-center justify-between p-2 bg-surfaceSecondary/50 border border-black/5 rounded-md"},[e("div",wd,[e("span",{class:B(["text-xs px-1.5 py-0.5 rounded font-black uppercase tracking-widest border",w(b.type)])},c(b.type),3),e("span",$d,c(b.description),1)]),a[8]||(a[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-sub opacity-50"},null,-1))]))),128))])):y("",!0)],8,md))),128))])):(s(),l("div",Cd,[...a[9]||(a[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))])]))}},Sd={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},Ad={class:"px-4 py-4 flex items-center justify-between shrink-0"},Id={class:"flex items-center gap-2"},Dd={class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},qd={class:"bg-white rounded-card p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Ed={key:0,class:"divide-y divide-gray-100"},Od=["onClick"],Ld={class:"flex items-start justify-between gap-3"},Md={class:"flex-1 min-w-0"},Nd={class:"flex items-center gap-2 mb-1 flex-wrap"},Bd={class:"text-fluid-sm font-medium text-heading truncate mb-0.5"},jd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-sub"},Vd={class:"flex items-center gap-1"},Rd={key:0,class:"flex items-center gap-1"},Fd={key:1,class:"flex items-center gap-1"},Ud={key:1,class:"text-center py-8 text-sub"},Pd={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const x=fe(),o={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},g=T=>o[T]||T||"Appointment",C=T=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[T]||"bg-surfaceSecondary text-body border-gray-100",w=T=>{const r=(T||"").toLowerCase();return r==="confirmed"?"bg-green-50 text-green-600":r==="cancelled"?"bg-red-50 text-red-600":r==="no-show"?"bg-amber-50 text-amber-600":"bg-surfaceSecondary text-body"},d=T=>{if(!T)return"";const r=new Date(T);return r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:r.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},i=T=>{T.opportunityId?x.push({path:`/tasks/${T.opportunityId}`,query:{type:"opportunity"}}):T.leadId?x.push({path:`/tasks/${T.leadId}`,query:{type:"lead"}}):x.push({path:"/calendar"})};return(T,r)=>(s(),l("div",Sd,[e("div",Ad,[e("div",Id,[r[0]||(r[0]=e("i",{class:"fa-solid fa-calendar-days text-heading"},null,-1)),r[1]||(r[1]=e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Appointments",-1)),e("span",Dd,c(t.appointments.length),1)])]),e("div",qd,[t.appointments.length>0?(s(),l("div",Ed,[(s(!0),l(W,null,H(t.appointments,a=>(s(),l("div",{key:a.id,class:"flex flex-col p-3 hover:bg-surfaceSecondary transition-colors rounded-md group cursor-pointer",onClick:n=>i(a)},[e("div",Ld,[e("div",Md,[e("div",Nd,[e("span",{class:B(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",C(a.type)])},c(g(a.type)),3),a.status?(s(),l("span",{key:0,class:B(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",w(a.status)])},c(a.status),3)):y("",!0)]),e("div",Bd,c(a.title||"Appointment"),1),e("div",jd,[e("span",Vd,[r[2]||(r[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),N(" "+c(d(a.start)),1)]),a.assignee?(s(),l("span",Rd,[r[3]||(r[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),N(" "+c(a.assignee),1)])):y("",!0),a.vehicle?(s(),l("span",Fd,[r[4]||(r[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),N(" "+c(a.vehicle),1)])):y("",!0)])]),r[5]||(r[5]=e("div",{class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0"},[e("i",{class:"fa-solid fa-chevron-right text-xs"})],-1))])],8,Od))),128))])):(s(),l("div",Ud,[...r[6]||(r[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))])]))}},Wd={key:0,class:"mb-8"},zd={class:"relative"},Hd={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},Yd=["onClick"],Kd={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},Qd=["src"],Gd={key:1,class:"fa-solid fa-car text-4xl text-sub"},Jd={class:"p-6"},Xd={class:"font-bold text-heading text-sm mb-1"},Zd={key:0,class:"text-xs text-sub mb-2"},_d={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},eu={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:x}){const o=x,g=L(!1),C=T=>new Intl.NumberFormat("en-US").format(T),w=T=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[T]||"Car",d=T=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[T]||"bg-gray-600",i=T=>{o("car-click",T),g.value=!0};return(T,r)=>t.cars.length>0?(s(),l("div",Wd,[r[2]||(r[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-sub text-xs"}),e("h3",{class:"font-bold text-heading text-sm"},"Cars")],-1)),e("div",zd,[e("div",Hd,[(s(!0),l(W,null,H(t.cars,(a,n)=>(s(),l("div",{key:a.id,class:"flex-none w-64 snap-start bg-surface border border-E5E7EB rounded-card shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative",onClick:b=>i(a)},[e("div",{class:B(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",d(a.type)])},c(w(a.type)),3),e("div",Kd,[a.image?(s(),l("img",{key:0,src:a.image,alt:"Car",class:"w-full h-full object-cover"},null,8,Qd)):(s(),l("i",Gd))]),e("div",Jd,[e("h4",Xd,c(a.brand)+" "+c(a.model)+" ("+c(a.year)+")",1),a.price?(s(),l("p",Zd,"€ "+c(C(a.price)),1)):y("",!0),a.stockDays!==null&&a.stockDays!==void 0?(s(),l("div",_d,[r[1]||(r[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),N(" In stock ("+c(a.stockDays)+" days) ",1)])):y("",!0)])],8,Yd))),128))])]),E(xs,{show:g.value,title:"Car Details",onClose:r[0]||(r[0]=a=>g.value=!1)},null,8,["show"])])):y("",!0)}},tu=Zt(eu,[["__scopeId","data-v-94fa8916"]]),su={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:x}){const o=t,g=x,C=L(null),w=I(()=>o.type==="lead"?"Add New Lead":"Add New Opportunity"),d=I(()=>`Create a ${o.type} for ${o.contact.name}`),i=r=>{r||g("close")},T=r=>{g("save",r)};return(r,a)=>(s(),j(D(je),{open:t.show,"onUpdate:open":i},{default:V(()=>[E(D(Ee),null,{default:V(()=>[E(D(Oe),{class:"fixed inset-0 z-50 bg-black/50"}),E(D(Le),{class:"w-full sm:max-w-lg"},{default:V(()=>[E(D(Me),null,{default:V(()=>[E(D(Ne),null,{default:V(()=>[N(c(w.value),1)]),_:1}),E(D(Ct),null,{default:V(()=>[N(c(d.value),1)]),_:1})]),_:1}),E(ts,{ref_key:"formRef",ref:C,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:T},null,8,["initial-contact","force-type"]),E(D(Be),{class:"flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:V(()=>{var n,b,v,S;return[E(D(K),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:a[0]||(a[0]=h=>r.$emit("close"))}),E(D(K),{label:(n=C.value)!=null&&n.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((b=C.value)==null?void 0:b.isSubmitting)||!((v=C.value)!=null&&v.canSubmit),onClick:(S=C.value)==null?void 0:S.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},au={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},lu={class:"bg-white rounded-card p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},nu={class:"divide-y divide-gray-100"},iu={class:"p-3"},ou={key:0,class:"text-sm text-body leading-relaxed whitespace-pre-line"},ru={key:1,class:"flex items-center gap-3 py-1 text-sub"},du={key:0,class:"p-3"},uu={class:"flex flex-wrap gap-2"},cu={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null}},setup(t){const x=t,o=I(()=>{if(x.preferences&&x.preferences.length>0)return x.preferences;const g=[],C=x.customerData;if(!C)return g;if(C.preferredVehicleType&&g.push({icon:"fa-solid fa-car",label:`Prefers ${C.preferredVehicleType}s`}),C.preferredChannel){const w={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};g.push({icon:w[C.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${C.preferredChannel}`})}return C.preferredContactTime&&g.push({icon:"fa-solid fa-clock",label:C.preferredContactTime}),C.budgetRange&&g.push({icon:"fa-solid fa-dollar-sign",label:C.budgetRange}),g});return(g,C)=>(s(),l("div",au,[C[1]||(C[1]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Customer Insights")])],-1)),e("div",lu,[e("div",nu,[e("div",iu,[t.summary?(s(),l("p",ou,c(t.summary),1)):(s(),l("div",ru,[...C[0]||(C[0]=[e("i",{class:"fa-solid fa-circle-info text-sm opacity-20"},null,-1),e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1)])]))]),o.value&&o.value.length>0?(s(),l("div",du,[e("div",uu,[(s(!0),l(W,null,H(o.value,(w,d)=>(s(),l("span",{key:d,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-surfaceSecondary text-heading text-xs font-semibold uppercase tracking-wider rounded border border-black/5"},[e("i",{class:B([w.icon,"text-xs text-brand-blue"])},null,2),N(" "+c(w.label),1)]))),128))])])):y("",!0)])])]))}},mu={key:0,class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},fu={class:"bg-white rounded-card p-3 md:p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},pu={class:"space-y-4"},vu={class:"w-full"},yu={class:"text-sm text-body leading-relaxed break-words"},bu={key:0,class:"text-sub"},xu={class:"font-medium text-heading"},gu={class:"text-xs text-sub ml-1"},hu={class:"flex flex-col xl:flex-row items-stretch xl:items-center gap-2 w-full"},ku={__name:"SuggestedNextAction",props:{leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},setup(t){const x=t,o=fe(),g=I(()=>{if(!x.leads||x.leads.length===0)return null;const r=x.leads.filter(n=>{if(n.isDisqualified)return!1;const b=ct(n,"lead");return b!=="Closed - Invalid"&&b!=="Closed - Not Interested"&&b!=="Closed - Duplicate"});if(r.length===0)return null;const a={Hot:3,Medium:2,Low:1};return r.sort((n,b)=>{const v=a[n.priority]||0,S=a[b.priority]||0;if(v!==S)return S-v;const h=new Date(n.updatedAt||n.createdAt||0);return new Date(b.updatedAt||b.createdAt||0)-h}),r[0]}),C=I(()=>{if(!x.opportunities||x.opportunities.length===0)return null;const r=x.opportunities.filter(n=>{const b=n.displayStage||n.stage;return b!=="Closed Won"&&b!=="Closed Lost"&&b!=="Abandoned"});if(r.length===0)return null;const a={Hot:3,Medium:2,Low:1};return r.sort((n,b)=>{const v=a[n.priority]||0,S=a[b.priority]||0;if(v!==S)return S-v;const h=new Date(n.updatedAt||n.createdAt||0);return new Date(b.updatedAt||b.createdAt||0)-h}),r[0]}),w=I(()=>{if(!g.value)return null;const r=g.value,a={lead:r,displayStage:ct(r,"lead")},n=Tt(a);return n?{...n,type:"lead",entityId:r.id,entity:r}:null}),d=I(()=>{if(!C.value)return null;const r=C.value,a=x.activities.filter(v=>v.opportunityId===r.id),n={opportunity:r,scheduledAppointment:r.scheduledAppointment||null,activities:a,hasOffers:a.some(v=>v.type==="offer")||!1,stage:r.displayStage||r.stage,deliverySubstatus:r.deliverySubstatus||null,formatDateTime:v=>{if(!v)return"";const S=new Date(v);return S.toLocaleDateString()+" "+S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},b=St(n.stage,n);return b?{...b,type:"opportunity",entityId:r.id,entity:r}:null}),i=I(()=>{const r=[];w.value&&r.push({...w.value,id:`lead-${w.value.entityId}`}),d.value&&r.push({...d.value,id:`opp-${d.value.entityId}`});const a={Hot:3,Medium:2,Low:1};return r.sort((n,b)=>{const v=n.entity,S=b.entity,h=a[v==null?void 0:v.priority]||0,m=a[S==null?void 0:S.priority]||0;return h!==m?m-h:n.type==="lead"&&b.type==="opportunity"?-1:n.type==="opportunity"&&b.type==="lead"?1:0}),r}),T=r=>{r.type==="lead"?o.push({path:`/tasks/${r.entityId}`,query:{type:"lead"}}):r.type==="opportunity"&&o.push({path:`/tasks/${r.entityId}`,query:{type:"opportunity"}})};return(r,a)=>i.value.length>0?(s(),l("div",mu,[a[2]||(a[2]=e("div",{class:"px-3 py-3 md:px-4 md:py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Suggested Next Action")])],-1)),e("div",fu,[e("div",pu,[e("div",vu,[e("p",yu,[(s(!0),l(W,null,H(i.value,(n,b)=>(s(),l(W,{key:n.id},[b>0?(s(),l("span",bu," or ")):y("",!0),e("span",xu,c(n.title),1),e("span",gu," ("+c(n.type==="lead"?"Lead":"Opp")+" #"+c(n.entityId)+") ",1)],64))),128))])]),e("div",hu,[i.value.length>0?(s(),l("button",{key:0,onClick:a[0]||(a[0]=n=>T(i.value[0])),class:"flex items-center justify-center gap-2 px-4 py-2 bg-brand-red hover:brightness-90 hover:-translate-y-px text-white rounded-btn font-medium text-sm transition-all w-full xl:w-auto xl:shrink-0"},[e("i",{class:B([i.value[0].icon,"text-sm"])},null,2),e("span",null,c(i.value[0].label),1)])):y("",!0),i.value.length>1?(s(),l("button",{key:1,onClick:a[1]||(a[1]=n=>T(i.value[1])),class:"flex items-center justify-center gap-2 px-3 py-2 bg-white border border-D1D5DB hover:bg-surfaceSecondary text-heading rounded-btn font-medium text-sm transition-colors w-full xl:w-auto xl:shrink-0"},[e("i",{class:B([i.value[1].icon,"text-sm"])},null,2),e("span",null,c(i.value[1].label),1)])):y("",!0)])])])])):y("",!0)}},wu={class:"rounded-card flex flex-col mb-6",style:{"background-color":"var(--base-muted, #f5f5f5)"}},$u={class:"bg-white rounded-card p-2 shadow-sm flex flex-col",style:{"box-shadow":"var(--nsc-card-shadow)"}},Cu={class:"divide-y divide-gray-100"},Tu={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Su={class:"flex items-center gap-3 min-w-0"},Au={class:"min-w-0"},Iu={class:"text-sm text-body truncate"},Du={class:"text-xs text-sub truncate"},qu={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Eu={class:"flex items-center gap-3 min-w-0"},Ou={class:"w-8 h-8 rounded bg-brand-slate/10 flex items-center justify-center shrink-0"},Lu={class:"min-w-0"},Mu={class:"text-sm text-body truncate"},Nu={class:"text-xs text-sub truncate"},Bu={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},ju={class:"flex items-center gap-3 min-w-0"},Vu={class:"min-w-0"},Ru={class:"text-sm text-body truncate"},Fu={class:"text-xs text-sub truncate"},Uu={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-surfaceSecondary transition-colors rounded-md group"},Pu={class:"flex items-center gap-3 min-w-0"},Wu={class:"min-w-0"},zu={class:"text-sm text-body truncate"},Hu={class:"text-xs text-sub truncate"},Yu={key:0,class:"text-center py-6 text-sub"},Ku={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null}},setup(t){const x=t,o=fe(),g=I(()=>{const m=["email","sms","whatsapp","call"],f=x.activities.filter(u=>m.includes(u.type)).sort((u,q)=>new Date(q.timestamp)-new Date(u.timestamp));return f.length>0?f[0]:null}),C=I(()=>{const m=x.leads.filter(f=>{var u;return!f.isDisqualified&&f.status!=="Disqualified"&&!((u=f.stage)!=null&&u.includes("Closed"))});return m.length>0?m[0]:null}),w=I(()=>{if(!C.value)return null;try{return Tt({lead:C.value,displayStage:C.value.stage})}catch(m){return console.error("Error getting lead next action:",m),null}}),d=I(()=>{const m=x.opportunities.filter(f=>f.stage!=="Closed Won"&&f.stage!=="Closed Lost");return m.length>0?m[0]:null}),i=I(()=>{if(!d.value)return null;try{const m=x.activities.filter(u=>u.opportunityId===d.value.id)||[];return St(d.value.stage,{opportunity:d.value,scheduledAppointment:d.value.scheduledAppointment||null,activities:m,hasOffers:m.some(u=>u.type==="offer")||!1,stage:d.value.stage,deliverySubstatus:d.value.deliverySubstatus||null,formatDateTime:u=>u?new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(m){return console.error("Error getting opportunity next action:",m),null}}),T=m=>({email:"fa-solid fa-envelope",sms:"fa-solid fa-message",whatsapp:"fa-brands fa-whatsapp",call:"fa-solid fa-phone"})[m]||"fa-solid fa-comment",r=m=>m.type==="call"?m.content||`Call with ${m.user||"customer"}`:m.type==="email"?m.subject||m.content||"Email communication":m.type==="sms"||m.type==="whatsapp"?m.content||`${m.type.toUpperCase()} message`:m.content||"Communication",a=m=>{if(!m)return"";const f=new Date(m),u=new Date,q=Math.abs(u-f),U=Math.ceil(q/(1e3*60*60*24));return U===1?"Today":U===2?"Yesterday":U<=7?`${U-1} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:f.getFullYear()!==u.getFullYear()?"numeric":void 0})},n=m=>{if(!m)return"";const f=new Date(m),u=new Date;if(f.toDateString()===u.toDateString())return`Today at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const U=new Date(u);return U.setDate(U.getDate()+1),f.toDateString()===U.toDateString()?`Tomorrow at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:f.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=()=>{var m,f;(m=x.nextAppointment)!=null&&m.opportunityId?o.push({path:`/tasks/${x.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(f=x.nextAppointment)!=null&&f.leadId?o.push({path:`/tasks/${x.nextAppointment.leadId}`,query:{type:"lead"}}):o.push({path:"/calendar"})},v=()=>{var m,f;(m=g.value)!=null&&m.opportunityId?o.push({path:`/tasks/${g.value.opportunityId}`,query:{type:"opportunity"}}):(f=g.value)!=null&&f.leadId&&o.push({path:`/tasks/${g.value.leadId}`,query:{type:"lead"}})},S=()=>{var m;(m=C.value)!=null&&m.id&&o.push({path:`/tasks/${C.value.id}`,query:{type:"lead"}})},h=()=>{var m;(m=d.value)!=null&&m.id&&o.push({path:`/tasks/${d.value.id}`,query:{type:"opportunity"}})};return(m,f)=>{var u,q,U,ee,G,oe;return s(),l("div",wu,[f[12]||(f[12]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock-rotate-left text-heading"}),e("h2",{class:"text-fluid-sm font-medium text-heading leading-5"},"Recent Activities")])],-1)),e("div",$u,[e("div",Cu,[t.nextAppointment?(s(),l("div",Tu,[e("div",Su,[f[1]||(f[1]=e("div",{class:"w-8 h-8 rounded bg-brand-blue/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar-check text-brand-blue text-sm"})],-1)),e("div",Au,[f[0]||(f[0]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",Iu,c(n(t.nextAppointment.start)),1),e("div",Du,c(t.nextAppointment.title||"Appointment"),1)])]),e("button",{onClick:b,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0",title:"View Details"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):y("",!0),g.value?(s(),l("div",qu,[e("div",Eu,[e("div",Ou,[e("i",{class:B([T(g.value.type),"text-brand-slate text-sm"])},null,2)]),e("div",Lu,[f[3]||(f[3]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",Mu,c(r(g.value)),1),e("div",Nu,c(a(g.value.timestamp)),1)])]),e("button",{onClick:v,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-slate/30 text-sub hover:text-brand-slate transition-all shrink-0",title:"View Details"},[...f[4]||(f[4]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):y("",!0),C.value?(s(),l("div",Bu,[e("div",ju,[f[6]||(f[6]=e("div",{class:"w-8 h-8 rounded bg-brand-dark/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-user-clock text-brand-dark text-sm"})],-1)),e("div",Vu,[f[5]||(f[5]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",Ru,c(((u=w.value)==null?void 0:u.label)||"No action defined"),1),e("div",Fu,c((q=C.value.requestedCar)==null?void 0:q.brand)+" "+c((U=C.value.requestedCar)==null?void 0:U.model),1)])]),e("button",{onClick:S,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-dark/30 text-sub hover:text-brand-dark transition-all shrink-0",title:"View Details"},[...f[7]||(f[7]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):y("",!0),d.value?(s(),l("div",Uu,[e("div",Pu,[f[9]||(f[9]=e("div",{class:"w-8 h-8 rounded bg-brand-blue/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-handshake text-brand-blue text-sm"})],-1)),e("div",Wu,[f[8]||(f[8]=e("div",{class:"text-xs font-semibold text-heading uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",zu,c(((ee=i.value)==null?void 0:ee.label)||"No action defined"),1),e("div",Hu,c((G=d.value.vehicle)==null?void 0:G.brand)+" "+c((oe=d.value.vehicle)==null?void 0:oe.model)+" - "+c(d.value.stage),1)])]),e("button",{onClick:h,class:"w-8 h-8 flex items-center justify-center bg-surface border border-black/5 rounded hover:bg-white hover:border-brand-blue/30 text-sub hover:text-brand-blue transition-all shrink-0",title:"View Details"},[...f[10]||(f[10]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):y("",!0)]),!t.nextAppointment&&!g.value&&!C.value&&!d.value?(s(),l("div",Yu,[...f[11]||(f[11]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No recent activities available",-1)])])):y("",!0)])])}}},Qu={class:"h-full flex flex-col overflow-hidden bg-surface"},Gu={key:0,class:"flex-1 flex items-center justify-center"},Ju={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Xu={class:"flex flex-col gap-6"},Zu={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},dc={__name:"CustomerProfile",props:{customerId:{type:Number,required:!0},customerType:{type:String,default:"contact",validator:t=>["contact","account"].includes(t)},showCloseButton:{type:Boolean,default:!1},closeOnConvert:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:x}){const o=t,g=x,C=fe();ht(),kt();const w=wt(),d=L(!1),i=L(null),T=L(null),r=L([]),a=L([]),n=L([]),b=L([]),v=L([]),S=L([]),h=I(()=>"contact"),m=I(()=>T.value||w.currentCustomer),f=I(()=>{const $=m.value;return $?{...$,id:$.id,type:"contact",customer:{id:$.id,name:$.name,email:$.email,phone:$.phone,address:$.address||"",initials:$.initials},source:$.source||"Direct",tags:$.tags||[],stage:"Contact",assignee:null,assigneeId:null}:null}),u=I(()=>{const $=new Date,A=(S.value||[]).filter(P=>(P==null?void 0:P.start)&&new Date(P.start)>=$);return A.sort((P,Z)=>new Date(P.start)-new Date(Z.start)),A.length>0?A[0]:null}),q=I(()=>null),U=I(()=>({currentActivities:I(()=>v.value),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),ee=I(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),G=async()=>{if(o.customerId)try{d.value=!0;const[$,A,P,Z,me]=await Promise.all([w.fetchCustomerById(o.customerId,o.customerType),Ss(o.customerId),As(o.customerId),Is(o.customerId),Ds(o.customerId)]);T.value=$||w.currentCustomer,r.value=A.data||[],a.value=P.data||[],n.value=Z.data||[],b.value=me.data||[];const ve=[];for(const le of r.value)try{const ne=await _t(le.id);ve.push(...ne)}catch(ne){console.error(`Failed to load activities for lead ${le.id}:`,ne)}for(const le of a.value)try{const ne=await es(le.id);ve.push(...ne)}catch(ne){console.error(`Failed to load activities for opportunity ${le.id}:`,ne)}v.value=ve;try{S.value=await Ts(o.customerId)}catch(le){console.error("Failed to load appointments:",le),S.value=[]}}catch($){console.error("Error loading customer data:",$),i.value=$.message||"Failed to load customer"}finally{d.value=!1}},oe=async $=>{try{await w.addRequestedCar(o.customerId,$),await G()}catch(A){console.error("Error adding car to customer:",A),i.value=A.message||"Failed to add car"}},pe=async()=>{try{d.value=!0;const $=await w.convertToLead(o.customerId);o.closeOnConvert&&g("close"),C.push({path:`/tasks/${$.id}`,query:{type:"lead"}})}catch($){console.error("Error converting to lead:",$),i.value=$.message||"Failed to convert to lead",d.value=!1}},ue=async()=>{try{d.value=!0;const $=await w.convertToOpportunity(o.customerId);o.closeOnConvert&&g("close"),C.push({path:`/tasks/${$.id}`,query:{type:"opportunity"}})}catch($){console.error("Error converting to opportunity:",$),i.value=$.message||"Failed to convert to opportunity",d.value=!1}},re=L(!1),se=L("lead"),be=I(()=>{if(!m.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const $=m.value;return{id:$.id,name:$.name||"Unknown",email:$.email||"",phone:$.phone||"",initials:$.initials||"?"}}),ie=$=>{se.value=$,re.value=!0},J=async $=>{try{if(d.value=!0,re.value=!1,!o.customerId)throw new Error("Customer ID not found");se.value==="lead"?await w.convertToLead(o.customerId):await w.convertToOpportunity(o.customerId),await G(),d.value=!1}catch(A){console.error(`Error adding ${se.value}:`,A),i.value=A.message||`Failed to add ${se.value}`,d.value=!1}},ce=async()=>{await G()},ae=async()=>{await G()};return Se(async()=>{await G()}),de(()=>o.customerId,$=>{$&&G()}),($,A)=>(s(),l("div",Qu,[d.value||!m.value?(s(),l("div",Gu,[...A[4]||(A[4]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):(s(),j(Fr,{key:1,task:f.value,type:h.value,"management-widget":q.value,"store-adapter":U.value,"add-new-config":ee.value,"show-close-button":t.showCloseButton,onClose:A[2]||(A[2]=P=>$.$emit("close")),onCarAdded:oe,onConvertToLead:pe,onConvertToOpportunity:ue,onTagUpdated:ce,onAppointmentCreated:ae},{"pinned-extra":V(({task:P})=>{var Z,me;return[e("div",Ju,[E(cu,{summary:P.summary||((Z=T.value)==null?void 0:Z.summary),preferences:P.preferences||((me=T.value)==null?void 0:me.preferences),"customer-data":T.value},null,8,["summary","preferences","customer-data"]),e("div",Xu,[E(ku,{leads:r.value,opportunities:a.value,activities:v.value},null,8,["leads","opportunities","activities"]),E(Ku,{"next-appointment":u.value,activities:v.value,leads:r.value,opportunities:a.value,"customer-id":t.customerId},null,8,["next-appointment","activities","leads","opportunities","customer-id"])])]),b.value.length>0?(s(),j(tu,{key:0,cars:b.value},null,8,["cars"])):y("",!0)]}),"tab-negotiations":V(()=>[e("div",Zu,[E(nd,{leads:r.value,"all-tasks":n.value,onAddLead:A[0]||(A[0]=P=>ie("lead"))},null,8,["leads","all-tasks"]),E(Td,{opportunities:a.value,"all-tasks":n.value,activities:v.value,onAddOpportunity:A[1]||(A[1]=P=>ie("opportunity"))},null,8,["opportunities","all-tasks","activities"])])]),"tab-appointments":V(()=>[E(Pd,{appointments:S.value},null,8,["appointments"])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config","show-close-button"])),m.value?(s(),j(su,{key:2,show:re.value,type:se.value,contact:be.value,onClose:A[3]||(A[3]=P=>re.value=!1),onSave:J},null,8,["show","type","contact"])):y("",!0)]))}};export{dc as _};
