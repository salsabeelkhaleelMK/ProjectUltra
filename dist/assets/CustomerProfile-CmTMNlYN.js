import{a3 as _t,h as ge,d as l,o as a,e,n as E,w as ae,t as g,F as P,i as H,x as j,y as d,g as x,B as D,s as p,Y as es,r as N,c as q,a9 as ts,M as Xe,k as M,C as It,l as ce,m as Me,L as St,p as G,j as vt,N as be,a2 as ss,v as gt,a6 as Ie,E as as,R as ns,G as ls,O as Ye,U as yt,K as os,I as xt,aa as rs,ab as is}from"./index-BSxt259F.js";import{u as Dt}from"./opportunities-C7VMVq_4.js";import{u as qt,_ as ds}from"./UnifiedAddForm-fTV8M0qH.js";import{z as ie,n as Z,b as us,Z as ms,a as cs,e as fs,J as ps,Y as vs,$ as Vt,Q as F,c as Y,W as Se,U as De,H as qe,j as z,G as Ve,f as Ze,F as _e,L as et,g as tt,h as st,o as gs,C as at,d as nt}from"./toggle-group-item.vue_vue_type_script_setup_true_lang-Csij51_o-CK4ymTFf.js";import{H as bt,I as ht,J as kt,h as Ge,i as Ke,T as ys,_ as xs,P as bs,n as hs,o as ks,j as ws,k as $s,l as Cs,m as Lt,y as Ts,z as As,q as Mt,A as Ot}from"./opportunityRules-DVPgyxsv.js";import{_ as Is}from"./ReassignUserModal-8Wfd_b4T.js";import{a as Ss,_ as Ds}from"./CreateEventModal-DQDakbY_.js";import{u as qs,b as Vs,c as Ls,d as Ms}from"./users-i2L6lO-2.js";import{fetchLeadsByCustomerId as Os,fetchOpportunitiesByCustomerId as Ns,fetchTasksByCustomerId as Es,fetchCustomerCars as js}from"./contacts-CvrS-If3.js";const Rs={class:"page-header-main"},Fs={class:"page-header-content"},Us={class:"flex items-center gap-3 min-w-0 flex-1"},Bs={class:"min-w-0 flex-1 flex flex-col justify-center"},Ps={class:"flex items-center gap-2 -mb-2"},Ws={class:"text-lg font-semibold text-foreground truncate leading-tight mb-0"},zs={class:"hidden lg:flex items-center gap-1.5 ml-2"},Hs={class:"flex items-center gap-4 flex-wrap -mt-2"},Ys={class:"flex items-center gap-1.5 group"},Gs={class:"text-xs text-muted-foreground truncate max-w-40 sm:max-w-52"},Ks={class:"flex items-center gap-1.5 group"},Qs={class:"text-xs text-muted-foreground whitespace-nowrap"},Js={class:"flex items-center gap-1.5"},Xs={key:0,class:"fa-solid fa-map-marker-alt text-xs text-muted-foreground"},Zs={key:1,class:"fa-regular fa-calendar text-xs text-muted-foreground"},_s={class:"text-xs text-muted-foreground truncate max-w-40 sm:max-w-52"},ea={class:"lg:hidden flex items-center gap-1.5 ml-auto"},ta={class:"page-header-actions"},sa={__name:"CustomerContactHeader",props:{initials:{type:String,required:!0},name:{type:String,required:!0},avatarColorClass:{type:String,default:"bg-orange-100 text-orange-600"},email:{type:String,required:!0},phone:{type:String,required:!0},thirdFieldValue:{type:String,required:!0},emailLabel:{type:String,default:"Email"},phoneLabel:{type:String,default:"Phone"},thirdFieldLabel:{type:String,default:"Expected Close"},taskType:{type:String,default:"lead"},customerId:{type:[Number,String],default:null},tags:{type:Array,default:()=>[]},showCloseButton:{type:Boolean,default:!1}},emits:["add-tag","close"],setup(t,{emit:b}){const r=t,k=b,A=_t(),w=ge(),i=async(u,n)=>{try{await navigator.clipboard.writeText(u),A.pushToast("success",`${n==="email"?"Email":"Phone"} copied!`)}catch{A.pushToast("error","Failed to copy")}},o=()=>k("add-tag"),I=()=>{r.customerId&&w.push(`/customer/${r.customerId}`)};return(u,n)=>(a(),l("div",Rs,[e("div",Fs,[e("div",Us,[e("button",{onClick:ae(I,["stop"]),class:E(["w-10 h-10 rounded-lg bg-primary text-white flex items-center justify-center cursor-pointer hover:opacity-90 transition-opacity shrink-0 shadow-sm",{"cursor-pointer":t.customerId}])},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-user text-base"},null,-1)])],2),e("div",Bs,[e("div",Ps,[e("h1",Ws,g(t.name),1),e("div",zs,[(a(!0),l(P,null,H(t.tags,s=>(a(),j(d(ie),{key:s,text:s,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:ae(o,["stop"]),class:"text-xs text-muted-foreground hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors whitespace-nowrap"},[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"tag",-1)])])])]),e("div",Hs,[e("div",Ys,[n[6]||(n[6]=e("i",{class:"fa-regular fa-envelope text-xs text-muted-foreground"},null,-1)),e("span",Gs,g(t.email),1),e("button",{onClick:n[0]||(n[0]=ae(s=>i(t.email,"email"),["stop"])),class:"opacity-0 group-hover:opacity-100 transition-opacity ml-0.5"},[...n[5]||(n[5]=[e("i",{class:"fa-regular fa-copy text-xs text-muted-foreground hover:text-primary"},null,-1)])])]),e("div",Ks,[n[8]||(n[8]=e("i",{class:"fa-solid fa-phone text-xs text-muted-foreground"},null,-1)),e("span",Qs,g(t.phone),1),e("button",{onClick:n[1]||(n[1]=ae(s=>i(t.phone,"phone"),["stop"])),class:"opacity-0 group-hover:opacity-100 transition-opacity ml-0.5"},[...n[7]||(n[7]=[e("i",{class:"fa-regular fa-copy text-xs text-muted-foreground hover:text-primary"},null,-1)])])]),e("div",Js,[t.thirdFieldLabel.toLowerCase().includes("address")?(a(),l("i",Xs)):(a(),l("i",Zs)),e("span",_s,g(t.thirdFieldValue),1)]),e("div",ea,[(a(!0),l(P,null,H(t.tags,s=>(a(),j(d(ie),{key:s,text:s,size:"small",theme:"blue"},null,8,["text"]))),128)),e("button",{onClick:ae(o,["stop"]),class:"text-xs text-muted-foreground hover:text-primary font-medium hover:underline flex items-center gap-1 transition-colors"},[...n[9]||(n[9]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"tag",-1)])])])])])]),e("div",ta,[t.showCloseButton?(a(),j(d(Z),{key:0,variant:"secondary",size:"icon",onClick:n[2]||(n[2]=ae(s=>u.$emit("close"),["stop"]))},{default:D(()=>[p(d(es),{size:16,class:"text-muted-foreground"})]),_:1})):x("",!0)])])]))}},aa={class:"hidden md:inline whitespace-nowrap"},na={key:0,class:"absolute bottom-0 left-0 right-0 h-[2px] bg-primary z-10"},wt={__name:"Tabs",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(t){const b={overview:"fa-solid fa-house",note:"fa-solid fa-note-sticky",communication:"fa-solid fa-comments",attachment:"fa-solid fa-paperclip",request:"fa-solid fa-globe",manage:"fa-solid fa-gear",data:"fa-solid fa-pen",notes:"fa-solid fa-note-sticky",enrich:"fa-solid fa-pen"},r=k=>b[k]||"fa-solid fa-circle";return(k,A)=>(a(),j(d(cs),{"model-value":t.modelValue,"onUpdate:modelValue":A[0]||(A[0]=w=>k.$emit("update:modelValue",w))},{default:D(()=>[p(d(us),{class:"w-full justify-start border-b border-border bg-transparent"},{default:D(()=>[(a(!0),l(P,null,H(t.tabs,w=>(a(),j(d(ms),{key:w.key,value:w.key,class:E(["flex items-center gap-1.5 text-sm font-medium transition-all relative bg-transparent outline-none",t.modelValue===w.key?"text-foreground":"text-muted-foreground hover:text-muted-foreground"])},{default:D(()=>[e("i",{class:E([r(w.key),"text-sm"])},null,2),e("span",aa,g(w.label),1),t.modelValue===w.key?(a(),l("span",na)):x("",!0)]),_:2},1032,["value","class"]))),128))]),_:1})]),_:1},8,["model-value"]))}},la={class:"flex flex-row items-center justify-between gap-2 md:gap-4"},oa={key:0,class:"flex items-center gap-2 shrink-0 flex-wrap"},ra={class:"flex items-center gap-1.5"},ia={key:1},da={class:"flex items-center gap-2"},ua={key:0,class:"space-y-4"},ma={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ca={class:"flex items-center gap-4"},fa={class:"w-20 h-14 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0 border border-border"},pa=["src"],va={key:1,class:"fa-solid fa-car text-3xl text-muted-foreground w-full h-full flex items-center justify-center"},ga={class:"font-bold text-foreground text-base md:text-lg mb-2"},ya={class:"flex items-center gap-2 flex-wrap"},xa={key:0,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md"},ba={key:1,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-orange-50 border border-orange-100 text-orange-700 text-xs font-semibold rounded-md"},ha={key:2,class:"inline-flex items-center gap-1.5 px-2 py-1 bg-muted border border-border text-muted-foreground text-xs font-semibold rounded-md"},ka={class:"text-xs font-bold text-foreground"},wa={key:0,class:"text-right"},$a={class:"font-bold text-foreground text-lg"},Ca={key:0,class:"pt-2"},Ta={class:"bg-muted border border-border rounded-lg p-3"},Aa={class:"text-sm text-muted-foreground leading-relaxed"},Ia={key:1,class:"space-y-3"},Sa={key:0,class:"flex items-center gap-2"},Da={class:"text-sm font-semibold text-foreground"},qa={key:1,class:"bg-muted border border-border rounded-lg p-3"},Va={class:"text-sm text-muted-foreground leading-relaxed"},La={key:2,class:"border-t border-border"},Ma={class:"font-medium"},Oa={key:3,class:"border-t border-border p-6 bg-muted/30 text-sm animate-fade-in"},Na={class:"mb-6"},Ea={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},ja={key:0},Ra={class:"font-medium text-muted-foreground"},Fa={key:1},Ua={class:"font-medium text-muted-foreground"},Ba={key:2},Pa={class:"font-medium text-muted-foreground"},Wa={class:"font-medium text-muted-foreground"},za={key:0},Ha={class:"grid grid-cols-2 md:grid-cols-4 gap-y-4 gap-x-6"},Ya={key:0},Ga={class:"font-medium text-muted-foreground"},Ka={key:1},Qa={class:"font-medium text-muted-foreground"},Ja={key:2},Xa={class:"font-medium text-muted-foreground"},Za={key:3},_a={class:"font-medium text-muted-foreground"},en={key:4},tn={class:"font-mono text-xs bg-surface border border-border px-2 py-1 rounded inline-block text-muted-foreground"},sn={key:5},an={class:"font-medium text-muted-foreground"},nn={key:0,class:"mt-6 flex justify-end"},ln={__name:"Request",props:{stage:{type:String,required:!0},owner:{type:String,required:!0},source:{type:String,default:""},deliverySubstatus:{type:String,default:null},activities:{type:Array,default:()=>[]},entityType:{type:String,default:"opportunity"},requestType:{type:String,default:""},requestMessage:{type:String,default:""},requestedCar:{type:Object,default:null},task:{type:Object,default:null}},emits:["reassign"],setup(t){const b=t,r=N(!1);q(()=>b.deliverySubstatus?ts(b.deliverySubstatus):"");const k=q(()=>b.deliverySubstatus?b.deliverySubstatus==="Delivered"?"green":b.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray"),A=q(()=>Xe(b.stage,b.entityType));function w($){return!$||$.length===0?null:$.filter(B=>B.type==="offer").sort((B,ee)=>new Date(ee.timestamp)-new Date(B.timestamp))[0]||null}function i($){if(!$)return 0;const S=new Date($),ee=Math.abs(new Date-S);return Math.ceil(ee/(1e3*60*60*24))}const o=q(()=>{if(b.stage!=="In Negotiation")return null;const $=w(b.activities);if(!$)return null;const S=i($.timestamp);return S<1?{label:"New Offer",theme:"orange"}:S<3?{label:"Active",theme:"yellow"}:null}),I=q(()=>b.requestedCar&&b.requestedCar.brand&&b.requestedCar.model),u=q(()=>b.requestType||b.requestMessage||I.value),n=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.brand)||""}),s=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.model)||""}),y=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.year)||""}),V=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.image)||""}),C=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.price)||null}),T=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.stockDays)!==void 0?b.requestedCar.stockDays:null}),c=q(()=>{var $,S;return(($=b.requestedCar)==null?void 0:$.dealership)||((S=b.task)==null?void 0:S.dealership)||""}),f=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.registration)||""}),m=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.kilometers)!==void 0?b.requestedCar.kilometers:null}),L=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.fuelType)||""}),U=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.gearType)||""}),te=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.vin)||""}),J=q(()=>"Email"),ue=q(()=>{var $,S;return(($=b.task)==null?void 0:$.sourceDetails)||((S=b.requestedCar)==null?void 0:S.adCampaign)||""}),ye=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.expectedPurchaseDate)||""}),fe=q(()=>{var $;return(($=b.task)==null?void 0:$.fiscalEntity)||""}),me=q(()=>{var $;return(($=b.task)==null?void 0:$.sourceDetails)||""}),ne=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.adMedium)||""}),he=q(()=>{var $;return(($=b.requestedCar)==null?void 0:$.adSource)||""});q(()=>!0);const de=q(()=>!0),X=q(()=>I.value||b.requestType||b.source||me.value||ue.value||ye.value||fe.value||ne.value||he.value),pe=$=>new Intl.NumberFormat("en-US").format($),le=$=>new Intl.NumberFormat("en-US").format($);return($,S)=>(a(),j(d(vs),{class:"w-full mb-6 shadow-mk-dashboard-card"},{default:D(()=>[p(d(fs),{class:"px-4 md:px-6 py-3 border-b border-border"},{default:D(()=>[e("div",la,[u.value?(a(),l("div",oa,[S[2]||(S[2]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Request")],-1)),e("div",ra,[e("span",{class:E(["px-2 py-0.5 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:E(["px-2 py-0.5 rounded text-xs font-medium border",A.value])},g(t.stage),3),t.deliverySubstatus?(a(),j(d(ie),{key:0,text:t.deliverySubstatus,size:"small",theme:k.value},null,8,["text","theme"])):x("",!0),o.value?(a(),j(d(ie),{key:1,text:o.value.label,size:"small",theme:o.value.theme},null,8,["text","theme"])):x("",!0)])])):(a(),l("div",ia)),e("div",da,[S[3]||(S[3]=e("span",{class:"hidden md:inline text-xs text-muted-foreground font-medium"},"Owner",-1)),p(d(Z),{onClick:S[0]||(S[0]=B=>$.$emit("reassign")),variant:"link",size:"small",class:"text-xs font-bold"},{default:D(()=>[M(g(t.owner),1)]),_:1})])])]),_:1}),u.value?(a(),j(d(ps),{key:0,class:"p-4 md:p-6"},{default:D(()=>[I.value?(a(),l("div",ua,[e("div",ma,[e("div",ca,[e("div",fa,[V.value?(a(),l("img",{key:0,src:V.value,alt:"Car",class:"w-full h-full object-cover"},null,8,pa)):(a(),l("i",va))]),e("div",null,[e("div",ga,g(n.value)+" "+g(s.value)+" ("+g(y.value)+")",1),e("div",ya,[T.value!==void 0&&T.value!==null?(a(),l("div",xa,[S[4]||(S[4]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+g(T.value)+" days) ",1)])):I.value?(a(),l("div",ba,[...S[5]||(S[5]=[e("div",{class:"w-1.5 h-1.5 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])])):x("",!0),t.source?(a(),l("div",ha,[S[6]||(S[6]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Source:",-1)),e("span",ka,g(t.source),1)])):x("",!0)])])]),C.value?(a(),l("div",wa,[S[7]||(S[7]=e("div",{class:"text-xs text-muted-foreground font-medium mb-1"},"Price",-1)),e("div",$a,"€ "+g(pe(C.value)),1)])):x("",!0)]),t.requestMessage?(a(),l("div",Ca,[S[8]||(S[8]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("div",Ta,[e("p",Aa,g(t.requestMessage),1)])])):x("",!0)])):(a(),l("div",Ia,[t.requestType?(a(),l("div",Sa,[S[9]||(S[9]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Request Type:",-1)),e("span",Da,g(t.requestType),1)])):x("",!0),t.requestMessage?(a(),l("div",qa,[S[10]||(S[10]=e("div",{class:"text-xs text-muted-foreground font-medium mb-2"},"Request Message",-1)),e("p",Va,g(t.requestMessage),1)])):x("",!0)])),X.value?(a(),l("div",La,[e("button",{onClick:S[1]||(S[1]=B=>r.value=!r.value),class:"w-full p-3 flex items-center justify-center gap-2 text-sm text-muted-foreground hover:text-foreground hover:bg-muted transition-colors"},[e("span",Ma,g(r.value?"Hide":"View")+" Details",1),e("i",{class:E(["fa-solid fa-chevron-down text-xs transition-transform duration-200",{"rotate-180":r.value}])},null,2)])])):x("",!0),r.value&&X.value?(a(),l("div",Oa,[e("div",Na,[S[21]||(S[21]=e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider mb-4"},"REQUEST DETAILS",-1)),e("div",Ea,[t.requestType?(a(),l("div",ja,[S[11]||(S[11]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Request type",-1)),e("div",Ra,g(t.requestType),1)])):x("",!0),t.source?(a(),l("div",Fa,[S[12]||(S[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source",-1)),e("div",Ua,g(t.source),1)])):x("",!0),e("div",null,[S[13]||(S[13]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Source details",-1)),e("div",{class:E(["font-medium",(me.value,"text-muted-foreground")])},g(me.value||"--"),3)]),c.value?(a(),l("div",Ba,[S[14]||(S[14]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",Pa,g(c.value),1)])):x("",!0),e("div",null,[S[15]||(S[15]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Channel",-1)),e("div",Wa,g(J.value||"Email"),1)]),e("div",null,[S[16]||(S[16]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdCampaign",-1)),e("div",{class:E(["font-medium",(ue.value,"text-muted-foreground")])},g(ue.value||"--"),3)]),e("div",null,[S[17]||(S[17]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdMedium",-1)),e("div",{class:E(["font-medium",(ne.value,"text-muted-foreground")])},g(ne.value||"--"),3)]),e("div",null,[S[18]||(S[18]=e("div",{class:"text-xs text-muted-foreground mb-1"},"AdSource",-1)),e("div",{class:E(["font-medium",(he.value,"text-muted-foreground")])},g(he.value||"--"),3)]),e("div",null,[S[19]||(S[19]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Expected purchase date",-1)),e("div",{class:E(["font-medium",(ye.value,"text-muted-foreground")])},g(ye.value||"--"),3)]),e("div",null,[S[20]||(S[20]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fiscal entity",-1)),e("div",{class:E(["font-medium",(fe.value,"text-muted-foreground")])},g(fe.value||"--"),3)])])]),I.value?(a(),l("div",za,[S[30]||(S[30]=e("div",{class:"border-t border my-4"},null,-1)),e("div",null,[S[29]||(S[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h4",{class:"text-xs font-bold uppercase text-muted-foreground tracking-wider"},"VEHICLE DETAILS")],-1)),e("div",Ha,[f.value?(a(),l("div",Ya,[S[22]||(S[22]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Registration",-1)),e("div",Ga,g(f.value),1)])):x("",!0),m.value!==void 0&&m.value!==null?(a(),l("div",Ka,[S[23]||(S[23]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Kilometers",-1)),e("div",Qa,g(le(m.value))+" Km",1)])):x("",!0),L.value?(a(),l("div",Ja,[S[24]||(S[24]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Fuel type",-1)),e("div",Xa,g(L.value),1)])):x("",!0),U.value?(a(),l("div",Za,[S[25]||(S[25]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Gear type",-1)),e("div",_a,g(U.value),1)])):x("",!0),te.value?(a(),l("div",en,[S[26]||(S[26]=e("div",{class:"text-xs text-muted-foreground mb-1"},"VIN Number",-1)),e("div",tn,g(te.value),1)])):x("",!0),c.value?(a(),l("div",sn,[S[27]||(S[27]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Dealership",-1)),e("div",an,g(c.value),1)])):x("",!0)]),de.value?(a(),l("div",nn,[p(d(Z),{variant:"outline",size:"small",class:"flex items-center gap-2"},{default:D(()=>[...S[28]||(S[28]=[e("i",{class:"fa-solid fa-list-check text-xs"},null,-1),M(" View technical specs ",-1)])]),_:1})])):x("",!0)])])):x("",!0)])):x("",!0)]),_:1})):x("",!0)]),_:1}))}},on={class:"rounded-lg flex flex-col h-full bg-muted"},rn={class:"px-4 py-4 flex items-center justify-between shrink-0"},dn={class:"flex items-center gap-2"},un={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1"},mn={class:"flex items-center gap-2 flex-wrap mb-3"},cn={key:0,class:"space-y-3"},fn={class:"flex items-center gap-3"},pn={class:"w-16 h-12 bg-surfaceTertiary rounded-lg overflow-hidden shrink-0"},vn=["src"],gn={key:1,class:"fa-solid fa-car text-2xl text-muted-foreground w-full h-full flex items-center justify-center"},yn={class:"flex-1 min-w-0"},xn={class:"font-bold text-foreground text-sm mb-1"},bn={class:"flex items-center gap-2 flex-wrap"},hn={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 text-xs font-semibold rounded"},kn={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-50 text-orange-700 text-xs font-semibold rounded"},wn={key:0,class:"text-right"},$n={class:"font-bold text-foreground text-sm"},Cn={class:"flex justify-end pt-2"},Tn={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},An={class:"mt-3 pt-3 space-y-2"},In={key:0,class:"flex items-center justify-between text-xs"},Sn={class:"text-foreground font-medium"},Dn={key:1,class:"flex items-center justify-between text-xs"},qn={class:"text-foreground font-medium"},Vn={key:2,class:"pt-2"},Ln={class:"bg-muted rounded-lg p-2"},Mn={class:"text-xs text-muted-foreground leading-relaxed line-clamp-3"},$t={__name:"TaskRequestOverviewTab",props:{task:{type:Object,required:!0},entityType:{type:String,default:"opportunity"},activities:{type:Array,default:()=>[]}},emits:["reassign","add-requested-car"],setup(t){const b=t,r=q(()=>b.task.requestedCar&&b.task.requestedCar.brand&&b.task.requestedCar.model),k=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.brand)||""}),A=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.model)||""}),w=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.year)||""}),i=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.image)||""}),o=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.price)||null}),I=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.stockDays)!==void 0?b.task.requestedCar.stockDays:null}),u=q(()=>{var c;return((c=b.task.requestedCar)==null?void 0:c.requestMessage)||""}),n=q(()=>Xe(b.task.displayStage||b.task.stage,b.entityType)),s=q(()=>b.task.deliverySubstatus?b.task.deliverySubstatus==="Delivered"?"green":b.task.deliverySubstatus==="Awaiting Delivery"?"blue":"gray":"gray");function y(c){return!c||c.length===0?null:c.filter(m=>m.type==="offer").sort((m,L)=>new Date(L.timestamp)-new Date(m.timestamp))[0]||null}function V(c){if(!c)return 0;const f=new Date(c),L=Math.abs(new Date-f);return Math.ceil(L/(1e3*60*60*24))}const C=q(()=>{if((b.task.displayStage||b.task.stage)!=="In Negotiation")return null;const c=y(b.activities);if(!c)return null;const f=V(c.timestamp);return f<1?{label:"New Offer",theme:"orange"}:f<3?{label:"Active",theme:"yellow"}:null}),T=c=>new Intl.NumberFormat("en-US").format(c);return(c,f)=>{var m,L;return a(),l("div",on,[e("div",rn,[f[4]||(f[4]=e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-car text-foreground"}),e("h2",{class:"text-base font-medium text-foreground leading-6"},"Requested Car")],-1)),e("div",dn,[f[3]||(f[3]=e("span",{class:"text-xs text-muted-foreground font-medium"},"Owner:",-1)),e("button",{onClick:f[0]||(f[0]=U=>c.$emit("reassign")),class:"text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline transition-colors"},g(t.task.assignee),1)])]),e("div",un,[e("div",mn,[e("span",{class:E(["px-2 py-1 rounded text-xs font-medium border",t.entityType==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(t.entityType==="lead"?"Lead":"Opportunity"),3),e("span",{class:E(["px-2 py-1 rounded text-xs font-medium border",n.value])},g(t.task.displayStage||t.task.stage),3),t.task.deliverySubstatus?(a(),j(d(ie),{key:0,text:t.task.deliverySubstatus,size:"small",theme:s.value},null,8,["text","theme"])):x("",!0),C.value?(a(),j(d(ie),{key:1,text:C.value.label,size:"small",theme:C.value.theme},null,8,["text","theme"])):x("",!0)]),r.value?(a(),l("div",cn,[e("div",fn,[e("div",pn,[i.value?(a(),l("img",{key:0,src:i.value,alt:"Car",class:"w-full h-full object-cover"},null,8,vn)):(a(),l("i",gn))]),e("div",yn,[e("div",xn,g(k.value)+" "+g(A.value)+" ("+g(w.value)+")",1),e("div",bn,[I.value!==void 0&&I.value!==null?(a(),l("div",hn,[f[5]||(f[5]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+g(I.value)+" days) ",1)])):(a(),l("div",kn,[...f[6]||(f[6]=[e("div",{class:"w-1 h-1 bg-orange-500 rounded-full"},null,-1),M(" Out of stock ",-1)])]))])]),o.value?(a(),l("div",wn,[f[7]||(f[7]=e("div",{class:"text-xs text-muted-foreground font-medium"},"Price",-1)),e("div",$n,"€ "+g(T(o.value)),1)])):x("",!0)]),e("div",Cn,[p(d(Z),{label:(t.task.requestedCar,"+ Add or update"),variant:"outline",size:"small",onClick:f[1]||(f[1]=U=>c.$emit("add-requested-car")),class:"text-xs"},null,8,["label"])])])):(a(),l("div",Tn,[f[8]||(f[8]=e("i",{class:"fa-solid fa-car text-4xl text-muted-foreground mb-3"},null,-1)),f[9]||(f[9]=e("p",{class:"text-sm text-muted-foreground mb-4"},"No requested car added yet",-1)),p(d(Z),{label:"+ Add or update",variant:"outline",size:"small",onClick:f[2]||(f[2]=U=>c.$emit("add-requested-car"))})])),e("div",An,[t.task.source?(a(),l("div",In,[f[10]||(f[10]=e("span",{class:"text-muted-foreground"},"Source",-1)),e("span",Sn,g(t.task.source),1)])):x("",!0),t.task.requestType||(m=t.task.requestedCar)!=null&&m.requestType?(a(),l("div",Dn,[f[11]||(f[11]=e("span",{class:"text-muted-foreground"},"Request Type",-1)),e("span",qn,g(t.task.requestType||((L=t.task.requestedCar)==null?void 0:L.requestType)),1)])):x("",!0),u.value?(a(),l("div",Vn,[f[12]||(f[12]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Message",-1)),e("div",Ln,[e("p",Mn,g(u.value),1)])])):x("",!0)])])])}}},On={class:"rounded-lg flex flex-col h-full bg-muted"},Nn={class:"px-4 py-2.5 flex items-center justify-between shrink-0"},En={class:"flex items-center gap-2"},jn={key:0,class:"ml-1 px-2 py-0.5 bg-brand-blue/10 text-brand-blue text-xs font-bold rounded-full"},Rn={class:"bg-white rounded-lg p-3 shadow-nsc-card flex flex-col flex-1 min-h-0"},Fn={key:0,class:"text-center py-6 text-muted-foreground"},Un={key:1,class:"space-y-2 overflow-y-auto flex-1"},Bn=["onClick"],Pn={class:"flex items-start justify-between gap-2"},Wn={class:"flex-1 min-w-0"},zn={class:"flex items-center gap-2 mb-1 flex-wrap"},Hn={key:0,class:"hidden sm:flex items-center gap-1 text-xs text-muted-foreground"},Yn={class:"flex flex-wrap items-center gap-x-3 gap-y-0.5"},Gn={key:0,class:"flex sm:hidden items-center gap-1 text-xs text-muted-foreground"},Kn={key:1,class:"flex items-center gap-1 text-xs text-muted-foreground"},Qn={key:2,class:"flex items-center gap-1 text-xs text-muted-foreground"},Jn={class:"truncate max-w-[150px]"},Xn={key:3,class:"flex items-center gap-1 text-xs"},Zn={class:"font-bold text-foreground"},_n={key:2,class:"text-center py-8 text-muted-foreground"},Ct={__name:"CustomerRelatedTasksWidget",props:{task:{type:Object,required:!0},entityType:{type:String,required:!0}},setup(t){const b=t,r=ge(),k=It(),A=Dt(),w=N(!1),i=N([]),o=N([]),I=q(()=>{var T;return b.task.customerId||((T=b.task.customer)==null?void 0:T.id)||null}),u=async()=>{if(I.value){w.value=!0;try{await Promise.all([k.fetchLeads(),A.fetchOpportunities()]),i.value=k.leads||[],o.value=A.opportunities||[]}catch(T){console.error("Error fetching related tasks:",T)}finally{w.value=!1}}},n=q(()=>{if(!I.value)return[];const T=[];return i.value.forEach(c=>{c.customerId===I.value&&!(c.id===b.task.id&&b.entityType==="lead")&&T.push({...c,type:"lead"})}),o.value.forEach(c=>{c.customerId===I.value&&!(c.id===b.task.id&&b.entityType==="opportunity")&&T.push({...c,type:"opportunity"})}),T.sort((c,f)=>{const m=new Date(c.createdAt||0);return new Date(f.createdAt||0)-m})}),s=T=>{const c=T.requestedCar||T.vehicle;return c&&c.brand&&c.model?`${c.brand} ${c.model}`:null},y=T=>T?new Intl.NumberFormat("en-US").format(T):"0",V=T=>{if(!T)return"";const c=new Date(T),m=new Date-c,L=Math.floor(m/(1e3*60*60*24));return L===0?"Today":L===1?"Yesterday":L<7?`${L} days ago`:L<30?`${Math.floor(L/7)} weeks ago`:c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},C=T=>{r.push({path:`/tasks/${T.id}`,query:{type:T.type}})};return ce(()=>b.task.id,()=>{u()},{immediate:!0}),Me(()=>{u()}),(T,c)=>(a(),l("div",On,[e("div",Nn,[e("div",En,[c[0]||(c[0]=e("i",{class:"fa-solid fa-list text-foreground text-xs"},null,-1)),c[1]||(c[1]=e("h2",{class:"text-xs font-medium text-foreground"},"Other Tasks for This Customer",-1)),n.value.length>0?(a(),l("span",jn,g(n.value.length),1)):x("",!0)])]),e("div",Rn,[w.value?(a(),l("div",Fn,[...c[2]||(c[2]=[e("i",{class:"fa-solid fa-spinner fa-spin text-xl mb-2"},null,-1),e("p",{class:"text-xs"},"Loading related tasks...",-1)])])):n.value.length>0?(a(),l("div",Un,[(a(!0),l(P,null,H(n.value,f=>(a(),l("div",{key:`${f.type}-${f.id}`,class:"flex flex-col p-2 border border-border rounded-lg hover:bg-muted transition-colors cursor-pointer group",onClick:m=>C(f)},[e("div",Pn,[e("div",Wn,[e("div",zn,[e("span",{class:E(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",f.type==="lead"?"bg-blue-50 text-blue-700 border-blue-200":"bg-purple-50 text-purple-700 border-purple-200"])},g(f.type==="lead"?"Lead":"Opp"),3),e("span",{class:E(["px-1 py-0.5 rounded text-xs font-bold border leading-none uppercase",d(Xe)(f.displayStage||f.stage,f.type)])},g(f.displayStage||f.stage),3),f.createdAt?(a(),l("div",Hn,[e("span",null,g(V(f.createdAt)),1)])):x("",!0)]),e("div",Yn,[f.createdAt?(a(),l("div",Gn,[c[3]||(c[3]=e("i",{class:"fa-solid fa-calendar opacity-70"},null,-1)),e("span",null,g(V(f.createdAt)),1)])):x("",!0),f.assignee?(a(),l("div",Kn,[c[4]||(c[4]=e("i",{class:"fa-solid fa-user opacity-70"},null,-1)),e("span",null,g(f.assignee),1)])):x("",!0),s(f)?(a(),l("div",Qn,[c[5]||(c[5]=e("i",{class:"fa-solid fa-car opacity-70"},null,-1)),e("span",Jn,g(s(f)),1)])):x("",!0),f.type==="opportunity"&&f.value?(a(),l("div",Xn,[c[6]||(c[6]=e("i",{class:"fa-solid fa-tag text-muted-foreground opacity-70"},null,-1)),e("span",Zn,"€ "+g(y(f.value)),1)])):x("",!0)])]),c[7]||(c[7]=e("div",{class:"w-6 h-6 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-brand-blue/30 text-muted-foreground hover:text-brand-blue transition-all shrink-0 self-center"},[e("i",{class:"fa-solid fa-external-link text-xs"})],-1))])],8,Bn))),128))])):(a(),l("div",_n,[...c[8]||(c[8]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No other tasks for this customer",-1)])]))])]))}},el={key:0,class:"flex-grow border-t border"},tl={key:0,class:"ml-1.5 text-muted-foreground"},sl={key:0,class:"absolute top-full right-0 md:left-1/2 md:-translate-x-1/2 mt-2 z-50"},al={key:1,class:"flex-grow border-t border"},Tt={__name:"AddNewButton",props:{show:{type:Boolean,default:!0},actions:{type:Array,default:()=>["note","financing","tradein","attachment","email","whatsapp","sms"]},activeTab:{type:String,default:"overview"},inline:{type:Boolean,default:!1}},emits:["action"],setup(t,{emit:b}){const r=t,k=b,A=N(!1),w={note:"data",tradein:"data",purchase:"data",attachment:"attachment",email:"communication",whatsapp:"communication",sms:"communication"},i=q(()=>{if(!r.activeTab||r.activeTab==="overview")return r.actions.filter(T=>!w[T]);const C=Object.entries(w).filter(([,T])=>T===r.activeTab).map(([T])=>T);return r.actions.filter(T=>C.includes(T))}),o=q(()=>r.activeTab==="communication"?!0:i.value.length===1),I=q(()=>{if(r.activeTab==="communication")return"add communication";if(!o.value||i.value.length!==1)return"";const C=i.value[0];return{note:"add note",attachment:"add attachment"}[C]||""}),u=q(()=>r.activeTab==="communication"?!1:i.value.length>1),n=q(()=>{const C={addVehicle:"Add Vehicle",configureVehicle:"Configure Vehicle",note:"Note",financing:"Financing",tradein:"Trade-in",requestedCar:"Requested car",purchase:"Purchase Method",attachment:"Attachment",email:"Send Email",whatsapp:"Send WhatsApp",sms:"Send SMS"};return i.value.map(T=>({key:T,label:C[T]||T,onClick:()=>y(T)}))}),s=q(()=>{if(r.inline)return"bg-surface hover:bg-muted text-muted-foreground font-medium w-9 h-9 rounded-full shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";const C="bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center z-20 relative border border-border";return o.value?`${C} px-4 py-2 h-9`:`${C} w-9 h-9`});q(()=>i.value.some(C=>["email","whatsapp","sms"].includes(C))),q(()=>i.value.some(C=>["addVehicle","configureVehicle"].includes(C))),q(()=>i.value.some(C=>["note","financing","tradein","attachment","requestedCar","purchase"].includes(C)));const y=C=>{A.value=!1,k("action",C)},V=()=>{if(r.activeTab==="communication"){y("call");return}o.value&&i.value.length===1?y(i.value[0]):A.value=!A.value};return(C,T)=>{const c=St("click-outside");return t.show?(a(),l("div",{key:0,class:E(["relative flex items-center",t.inline?"justify-end mb-0 py-0":"py-1 mb-4"])},[t.inline?x("",!0):(a(),l("div",el)),e("div",{class:E(["relative",t.inline?"mx-0":"mx-4"])},[e("button",{onClick:ae(V,["stop"]),class:E(s.value)},[T[0]||(T[0]=e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1)),o.value?(a(),l("span",tl,g(I.value),1)):x("",!0)],2),A.value&&u.value?G((a(),l("div",sl,[p(d(Vt),{items:n.value,className:"w-48"},null,8,["items"])])),[[c,()=>A.value=!1]]):x("",!0)],2),t.inline?x("",!0):(a(),l("div",al))],2)):x("",!0)}}},nl={class:"bg-purple-50/50 border border-purple-100 rounded-lg p-4"},ll={class:"flex items-start gap-3"},ol={class:"flex-1 min-w-0"},rl={class:"font-bold text-sm text-foreground mb-2"},il={class:"space-y-1.5 text-xs text-gray-600"},dl={class:"flex items-center gap-2"},ul={class:"flex items-center gap-2"},ml={class:"flex items-center gap-2"},cl={key:0,class:"mt-2"},fl={__name:"AppointmentWidget",props:{appointmentData:{type:Object,required:!0}},setup(t){const b=t,r=q(()=>b.appointmentData.date?new Date(b.appointmentData.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),k=q(()=>b.appointmentData.time?b.appointmentData.time:""),A=w=>({scheduled:"bg-blue-100 text-blue-700 border border-blue-200",confirmed:"bg-green-100 text-green-700 border border-green-200",pending:"bg-yellow-100 text-yellow-700 border border-yellow-200",cancelled:"bg-red-100 text-red-700 border border-red-200"})[w==null?void 0:w.toLowerCase()]||"bg-muted text-muted-foreground border border-border";return(w,i)=>(a(),l("div",nl,[e("div",ll,[i[3]||(i[3]=e("div",{class:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",ol,[e("h4",rl,g(t.appointmentData.type),1),e("div",il,[e("div",dl,[i[0]||(i[0]=e("i",{class:"fa-regular fa-calendar text-gray-400"},null,-1)),e("span",null,g(r.value),1)]),e("div",ul,[i[1]||(i[1]=e("i",{class:"fa-regular fa-clock text-gray-400"},null,-1)),e("span",null,g(k.value),1)]),e("div",ml,[i[2]||(i[2]=e("i",{class:"fa-solid fa-user text-gray-400"},null,-1)),e("span",null,g(t.appointmentData.assignee),1)])]),t.appointmentData.status?(a(),l("div",cl,[e("span",{class:E(["inline-flex px-2 py-0.5 rounded text-xs font-semibold",A(t.appointmentData.status)])},g(t.appointmentData.status),3)])):x("",!0)])])]))}},pl={class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in mb-4 feed-item"},vl={class:"flex-1"},gl={class:"flex items-center gap-2 mb-1"},yl={class:"text-sm font-bold text-foreground"},xl={class:"text-sm text-muted-foreground"},bl={class:"text-sm text-muted-foreground"},hl={key:0,class:"bg-blue-50 text-blue-600 text-sm px-1 py-0.5 rounded border border-blue-100"},kl={class:"ml-auto relative"},wl={key:0,class:"absolute right-0 top-full mt-1 z-10"},$l={key:0,class:"text-sm text-muted-foreground"},Cl={key:1,class:"text-sm text-muted-foreground flex items-center gap-2"},Tl={key:2,class:"mt-2"},Al={key:0},Il={key:1,class:"bg-white border border-border rounded-lg p-3"},Sl={key:0},Dl={class:"text-sm font-bold text-foreground"},ql={key:0,class:"text-sm text-muted-foreground mt-0.5"},Vl={class:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-muted-foreground mt-2"},Ll={key:0},Ml={key:1},Ol={key:2},Nl={key:3},El={key:4},jl={key:1},Rl={class:"text-sm font-bold text-foreground mb-2"},Fl={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},Ul={key:0},Bl={class:"text-muted-foreground font-medium ml-1"},Pl={key:1},Wl={class:"text-muted-foreground font-medium ml-1"},zl={key:2},Hl={class:"text-muted-foreground font-medium ml-1"},Yl={key:3},Gl={class:"text-muted-foreground font-medium ml-1"},Kl={key:4},Ql={class:"text-muted-foreground font-medium ml-1"},Jl={key:5},Xl={class:"text-muted-foreground font-medium ml-1"},Zl={key:2,class:"flex items-center gap-3"},_l={key:0,class:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0"},eo=["src"],to={class:"flex-1"},so={class:"text-sm font-bold text-foreground"},ao={class:"text-sm text-muted-foreground"},no={key:1,class:"bg-purple-600 text-white text-xs font-bold px-1 py-0.5 rounded"},lo={key:3,class:"flex items-center gap-3"},oo={class:"flex-1"},ro={class:"text-sm font-bold text-foreground"},io={class:"text-sm text-muted-foreground"},uo={key:0,class:"text-sm text-muted-foreground mt-1"},mo={key:1,class:"text-sm text-muted-foreground mt-1"},co={key:4},fo={class:"text-sm font-bold text-foreground mb-2"},po={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-muted-foreground"},vo={key:0},go={class:"text-muted-foreground font-medium ml-1"},yo={key:1},xo={class:"text-muted-foreground font-medium ml-1"},bo={key:2},ho={class:"text-muted-foreground font-medium ml-1"},ko={key:3},wo={class:"text-muted-foreground font-medium ml-1"},$o={key:4},Co={class:"text-muted-foreground font-medium ml-1"},To={key:5},Ao={class:"text-muted-foreground font-medium ml-1"},Io={key:0,class:"flex flex-wrap gap-2 mt-2"},So={key:0,class:"bg-green-50 text-green-700 text-xs px-2 py-0.5 rounded border border-green-100"},Do={key:1,class:"bg-blue-50 text-blue-700 text-xs px-2 py-0.5 rounded border border-blue-100"},qo={key:2,class:"bg-purple-50 text-purple-700 text-xs px-2 py-0.5 rounded border border-purple-100"},Qe={__name:"FeedItemCard",props:{item:{type:Object,required:!0},taskType:{type:String,default:"lead"},customerInitials:{type:String,required:!0}},emits:["edit","delete"],setup(t,{emit:b}){const r=t,k=b,A=N(!1),w=q(()=>[{key:"edit",label:"Edit",onClick:s},{key:"delete",label:"Delete",onClick:y}]),i=V=>({note:"fa-regular fa-note-sticky",communication:"fa-solid fa-comment-dots",email:"fa-regular fa-envelope",whatsapp:"fa-brands fa-whatsapp",sms:"fa-solid fa-comment-dots",attachment:"fa-solid fa-paperclip",tradein:"fa-solid fa-car-side",financing:"fa-solid fa-file-invoice-dollar",offer:"fa-solid fa-handshake",purchase:"fa-solid fa-shopping-cart","purchase-method":"fa-solid fa-credit-card",appointment:"fa-solid fa-calendar"})[V]||"fa-solid fa-circle",o=V=>({note:"bg-orange-100 text-orange-600 border-orange-200",communication:"bg-muted text-muted-foreground border",email:"bg-blue-100 text-blue-600 border-blue-200",whatsapp:"bg-green-100 text-green-600 border-green-200",sms:"bg-muted text-muted-foreground border",attachment:"bg-blue-50 text-blue-600 border-blue-100",tradein:"bg-green-50 text-green-600 border-green-100",financing:"bg-purple-50 text-purple-600 border-purple-100",offer:"bg-indigo-50 text-indigo-600 border-indigo-100",purchase:"bg-teal-50 text-teal-600 border-teal-100","purchase-method":"bg-amber-50 text-amber-600 border-amber-100",appointment:"bg-purple-100 text-purple-600 border-purple-200"})[V]||"bg-muted text-muted-foreground border",I=V=>{if(!V)return"Just now";const C=new Date(V),c=new Date-C,f=Math.floor(c/6e4),m=Math.floor(f/60),L=Math.floor(m/24);return f<1?"Just now":f<60?`${f} minutes ago`:m<24?`${m} hours ago`:L===1?"Yesterday":L<7?`${L} days ago`:C.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},u=V=>V?new Intl.NumberFormat("en-US").format(V):"0",n=V=>V?new Date(V).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",s=()=>{A.value=!1,k("edit",r.item)},y=()=>{A.value=!1,confirm("Are you sure you want to delete this item?")&&k("delete",r.item)};return(V,C)=>{const T=St("click-outside");return a(),l("div",pl,[e("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border",o(t.item.type)])},[e("i",{class:E([i(t.item.type),"text-sm"])},null,2)],2),e("div",vl,[e("div",gl,[e("span",yl,g(t.customerInitials),1),e("span",xl,g(t.item.action||"added"),1),e("span",bl,"• "+g(I(t.item.timestamp)),1),t.item.autoDetected?(a(),l("span",hl,"Auto-detected")):x("",!0),e("div",kl,[e("button",{onClick:C[0]||(C[0]=ae(c=>A.value=!A.value,["stop"])),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...C[1]||(C[1]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])]),A.value?G((a(),l("div",wl,[p(d(Vt),{items:w.value,className:"w-32"},null,8,["items"])])),[[T,()=>A.value=!1]]):x("",!0)])]),t.item.content?(a(),l("div",$l,g(t.item.content),1)):x("",!0),t.item.fileName?(a(),l("div",Cl,[C[2]||(C[2]=e("i",{class:"fa-solid fa-paperclip text-gray-400"},null,-1)),e("span",null,g(t.item.fileName),1)])):x("",!0),t.item.data?(a(),l("div",Tl,[t.item.type==="appointment"?(a(),l("div",Al,[p(fl,{"appointment-data":t.item.data},null,8,["appointment-data"])])):(a(),l("div",Il,[t.item.type==="tradein"?(a(),l("div",Sl,[e("h4",Dl,g(t.item.data.brand)+" "+g(t.item.data.model),1),t.item.data.version?(a(),l("p",ql,g(t.item.data.version),1)):x("",!0),e("div",Vl,[t.item.data.year?(a(),l("div",Ll,[C[3]||(C[3]=e("i",{class:"fa-regular fa-calendar mr-1"},null,-1)),M(g(t.item.data.year),1)])):x("",!0),t.item.data.km?(a(),l("div",Ml,[C[4]||(C[4]=e("i",{class:"fa-solid fa-road mr-1"},null,-1)),M(g(t.item.data.km)+" km ",1)])):x("",!0),t.item.data.plate?(a(),l("div",Ol,[C[5]||(C[5]=e("i",{class:"fa-solid fa-id-card mr-1"},null,-1)),M(g(t.item.data.plate),1)])):x("",!0),t.item.data.date?(a(),l("div",Nl,[C[6]||(C[6]=e("i",{class:"fa-regular fa-calendar-check mr-1"},null,-1)),M(g(n(t.item.data.date)),1)])):x("",!0),t.item.data.class?(a(),l("div",El,[C[7]||(C[7]=e("i",{class:"fa-solid fa-car mr-1"},null,-1)),M(g(t.item.data.class),1)])):x("",!0)])])):t.item.type==="financing"?(a(),l("div",jl,[e("h4",Rl,g(t.item.data.product),1),e("div",Fl,[t.item.data.provider?(a(),l("div",Ul,[C[8]||(C[8]=e("span",{class:"text-muted-foreground"},"Provider:",-1)),e("span",Bl,g(t.item.data.provider),1)])):x("",!0),t.item.data.total?(a(),l("div",Pl,[C[9]||(C[9]=e("span",{class:"text-muted-foreground"},"Total:",-1)),e("span",Wl,"€"+g(u(t.item.data.total)),1)])):x("",!0),t.item.data.monthly?(a(),l("div",zl,[C[10]||(C[10]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",Hl,"€"+g(u(t.item.data.monthly)),1)])):x("",!0),t.item.data.deposit?(a(),l("div",Yl,[C[11]||(C[11]=e("span",{class:"text-muted-foreground"},"Deposit:",-1)),e("span",Gl,"€"+g(u(t.item.data.deposit)),1)])):x("",!0),t.item.data.startDate?(a(),l("div",Kl,[C[12]||(C[12]=e("span",{class:"text-muted-foreground"},"Start:",-1)),e("span",Ql,g(n(t.item.data.startDate)),1)])):x("",!0),t.item.data.expDate?(a(),l("div",Jl,[C[13]||(C[13]=e("span",{class:"text-muted-foreground"},"Expires:",-1)),e("span",Xl,g(n(t.item.data.expDate)),1)])):x("",!0)])])):t.item.type==="offer"?(a(),l("div",Zl,[t.item.data.image?(a(),l("div",_l,[e("img",{src:t.item.data.image,alt:"Car",class:"w-full h-full object-cover"},null,8,eo)])):x("",!0),e("div",to,[e("h4",so,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",ao,"€ "+g(u(t.item.data.price)),1)]),t.item.data.isMainOffer?(a(),l("span",no,"Main Offer")):x("",!0)])):t.item.type==="purchase"?(a(),l("div",lo,[e("div",oo,[e("h4",ro,g(t.item.data.brand)+" "+g(t.item.data.model)+" ("+g(t.item.data.year)+")",1),e("p",io,"€ "+g(u(t.item.data.price)),1),t.item.data.purchaseDate?(a(),l("p",uo,"Purchased: "+g(n(t.item.data.purchaseDate)),1)):x("",!0),t.item.data.notes?(a(),l("p",mo,g(t.item.data.notes),1)):x("",!0)])])):t.item.type==="purchase-method"?(a(),l("div",co,[e("h4",fo,g(t.item.data.typeLabel||t.item.data.type),1),e("div",po,[t.item.data.monthlyInstalment?(a(),l("div",vo,[C[14]||(C[14]=e("span",{class:"text-muted-foreground"},"Monthly:",-1)),e("span",go,"€"+g(u(t.item.data.monthlyInstalment)),1)])):x("",!0),t.item.data.duration?(a(),l("div",yo,[C[15]||(C[15]=e("span",{class:"text-muted-foreground"},"Duration:",-1)),e("span",xo,g(t.item.data.duration)+" months",1)])):x("",!0),t.item.data.downPayment?(a(),l("div",bo,[C[16]||(C[16]=e("span",{class:"text-muted-foreground"},"Down Payment:",-1)),e("span",ho,"€"+g(u(t.item.data.downPayment)),1)])):x("",!0),t.item.data.interestRate?(a(),l("div",ko,[C[17]||(C[17]=e("span",{class:"text-muted-foreground"},"Interest Rate:",-1)),e("span",wo,g(t.item.data.interestRate)+"%",1)])):x("",!0),t.item.data.mileageLimit?(a(),l("div",$o,[C[18]||(C[18]=e("span",{class:"text-muted-foreground"},"Mileage Limit:",-1)),e("span",Co,g(u(t.item.data.mileageLimit))+" km/year",1)])):x("",!0),t.item.data.customerType?(a(),l("div",To,[C[19]||(C[19]=e("span",{class:"text-muted-foreground"},"Customer Type:",-1)),e("span",Ao,g(t.item.data.customerType),1)])):x("",!0)]),t.item.data.insuranceIncluded||t.item.data.maintenanceIncluded||t.item.data.registrationTaxesIncluded?(a(),l("div",Io,[t.item.data.insuranceIncluded?(a(),l("span",So,"Insurance")):x("",!0),t.item.data.maintenanceIncluded?(a(),l("span",Do,"Maintenance")):x("",!0),t.item.data.registrationTaxesIncluded?(a(),l("span",qo,"Registration/Taxes")):x("",!0)])):x("",!0)])):x("",!0)]))])):x("",!0)])])}}},Vo={class:"space-y-3"},Lo={class:"space-y-2"},Mo={class:"flex-1"},Oo={class:"text-xs text-muted-foreground uppercase"},No={class:"flex justify-end gap-2 pt-3 border-t border-border"},At={__name:"CallForm",props:{phoneNumber:{type:String,required:!0}},emits:["call","cancel"],setup(t,{emit:b}){const r=t,k=b,A=N(""),w=i=>{i==="copy"&&navigator.clipboard.writeText(r.phoneNumber),k("call",{type:"call",option:i,phoneNumber:r.phoneNumber,notes:A.value})};return(i,o)=>(a(),l("div",Vo,[e("div",Lo,[o[10]||(o[10]=e("label",{class:"block text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Choose Call Method",-1)),e("button",{onClick:o[0]||(o[0]=I=>w("outbound")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...o[5]||(o[5]=[vt('<div class="w-10 h-10 rounded-lg bg-brand-blue/10 flex items-center justify-center group-hover:bg-brand-blue/20 transition-colors"><i class="fa-solid fa-phone text-brand-blue"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with Outbound</p><p class="text-xs text-muted-foreground uppercase">Use external calling system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:o[1]||(o[1]=I=>w("pbx")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[...o[6]||(o[6]=[vt('<div class="w-10 h-10 rounded-lg bg-brand-slate/10 flex items-center justify-center group-hover:bg-brand-slate/20 transition-colors"><i class="fa-solid fa-phone-volume text-brand-slate"></i></div><div class="flex-1"><p class="font-bold text-sm text-foreground uppercase tracking-tight">Call with PBX</p><p class="text-xs text-muted-foreground uppercase">Use internal phone system</p></div><i class="fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"></i>',3)])]),e("button",{onClick:o[2]||(o[2]=I=>w("copy")),class:"w-full px-4 py-3 text-left border border-border rounded-lg hover:bg-muted transition-all flex items-center gap-3 group"},[o[8]||(o[8]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors"},[e("i",{class:"fa-solid fa-copy text-gray-600"})],-1)),e("div",Mo,[o[7]||(o[7]=e("p",{class:"font-bold text-sm text-foreground uppercase tracking-tight"},"Copy Number",-1)),e("p",Oo,g(t.phoneNumber),1)]),o[9]||(o[9]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Call Notes",-1)),G(e("textarea",{"onUpdate:modelValue":o[3]||(o[3]=I=>A.value=I),class:"input",rows:"4",placeholder:"Add notes about the call..."},null,512),[[be,A.value]])]),e("div",No,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",onClick:o[4]||(o[4]=I=>i.$emit("cancel"))})])]))}},Eo={key:0,class:"space-y-4"},jo={class:"grid grid-cols-4 gap-2"},Ro=["onClick"],Fo={class:"text-xs font-bold uppercase tracking-wider"},Uo={key:1,class:"space-y-4"},Bo={class:"grid grid-cols-4 gap-2"},Po=["onClick"],Wo={class:"text-xs font-bold uppercase tracking-wider"},zo={key:0},Ho={__name:"CommunicationWidget",props:{type:{type:String,default:null},taskType:{type:String,default:"lead"},taskId:{type:[Number,String],default:null},phoneNumber:{type:String,default:""},showArrow:{type:Boolean,default:!0},inline:{type:Boolean,default:!1},initialTemplate:{type:String,default:""},initialMessage:{type:String,default:""}},emits:["save","cancel","send"],setup(t,{emit:b}){const r=t,k=b,A=[{id:"call",label:"Call",icon:"fa-solid fa-phone"},{id:"whatsapp",label:"WhatsApp",icon:"fa-brands fa-whatsapp"},{id:"email",label:"Email",icon:"fa-solid fa-envelope"},{id:"sms",label:"SMS",icon:"fa-solid fa-message"}],w=N(r.type);ce(()=>r.type,n=>{n?w.value=n:w.value=null}),ce(()=>r.taskId,()=>{w.value=null});const i=q(()=>n=>`bg-surface border-2 rounded-lg h-12 flex flex-col items-center justify-center gap-1 transition-all ${w.value===n?"border-brand-dark bg-muted text-brand-dark shadow-nsc-card":"border-border text-muted-foreground hover:border-brand-dark/30 hover:bg-muted/30 hover:text-muted-foreground"}`),o=n=>{k("save",{type:"communication",action:`sent via ${n.type}`,content:n.message,communicationType:n.type,template:n.template,subject:n.subject}),k("send",n)},I=n=>{k("save",{type:"communication",action:`called via ${n.option}`,content:n.notes||"Call attempt logged",communicationType:"call",callOption:n.option}),k("send",{type:"call",option:n.option,phoneNumber:n.phoneNumber,notes:n.notes})},u=()=>{w.value=null,k("cancel")};return(n,s)=>t.inline?(a(),l("div",Uo,[e("div",Bo,[(a(),l(P,null,H(A,y=>e("button",{key:y.id,onClick:V=>w.value=y.id,class:E(i.value(y.id))},[e("i",{class:E([y.icon,"text-sm"])},null,2),e("span",Wo,g(y.label),1)],10,Po)),64))]),w.value?(a(),l("div",zo,[w.value==="email"?(a(),j(bt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="sms"?(a(),j(ht,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(a(),j(kt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="call"?(a(),j(At,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:u},null,8,["phone-number"])):x("",!0)])):x("",!0)])):(a(),l("div",Eo,[e("div",jo,[(a(),l(P,null,H(A,y=>e("button",{key:y.id,onClick:V=>w.value=y.id,class:E(i.value(y.id))},[e("i",{class:E([y.icon,"text-sm"])},null,2),e("span",Fo,g(y.label),1)],10,Ro)),64))]),e("div",null,[w.value==="email"?(a(),j(bt,{key:0,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="sms"?(a(),j(ht,{key:1,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="whatsapp"?(a(),j(kt,{key:2,"initial-template":t.initialTemplate,"initial-message":t.initialMessage,onSend:o,onCancel:u},null,8,["initial-template","initial-message"])):w.value==="call"?(a(),j(At,{key:3,"phone-number":t.phoneNumber,onCall:I,onCancel:u},null,8,["phone-number"])):x("",!0)])]))}},Yo={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},Go={key:1,class:"flex justify-between items-center mb-4"},Ko={class:"text-sm font-semibold text-foreground"},Qo={class:"space-y-4"},Jo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Zo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},_o={class:"border border-border rounded-lg bg-muted"},er={key:0,class:"px-4 pb-4 space-y-4 border-t border-border pt-4"},tr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},sr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ar={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},nr={__name:"TradeInWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:b,emit:r}){const k=t,A=r,w=N(!1),i=N({brand:"",model:"",year:"",version:"",vin:"",plates:"",fuelType:"",gearType:"",kilometers:"",registration:""}),o=N({tradeInPrice:null,evaluationRangeLow:null,evaluationRangeHigh:null,provider:"",evaluationDate:""}),I=q(()=>!!i.value.brand&&!!i.value.model&&!!i.value.year);Me(()=>{k.item&&k.item.data&&(i.value={brand:k.item.data.brand||"",model:k.item.data.model||"",year:k.item.data.year||"",version:k.item.data.version||"",vin:k.item.data.vin||"",plates:k.item.data.plate||k.item.data.plates||"",fuelType:k.item.data.fuelType||"",gearType:k.item.data.gearType||"",kilometers:k.item.data.km||k.item.data.kilometers||"",registration:k.item.data.date||k.item.data.registration||""},k.item.data.tradeInPrice!==void 0&&(o.value={tradeInPrice:k.item.data.tradeInPrice||null,evaluationRangeLow:k.item.data.evaluationRangeLow||null,evaluationRangeHigh:k.item.data.evaluationRangeHigh||null,provider:k.item.data.provider||"",evaluationDate:k.item.data.evaluationDate||""},w.value=!0))});const u=()=>{var s,y;if(!I.value)return;const n={id:((s=k.item)==null?void 0:s.id)||Date.now(),type:"tradein",action:k.item?"updated a trade-in":"added a trade-in",timestamp:((y=k.item)==null?void 0:y.timestamp)||new Date().toISOString(),isEdit:!!k.item,data:{brand:i.value.brand,model:i.value.model,year:parseInt(i.value.year)||null,version:i.value.version||null,vin:i.value.vin||null,plate:i.value.plates||null,plates:i.value.plates||null,fuelType:i.value.fuelType||null,gearType:i.value.gearType||null,km:parseInt(i.value.kilometers)||0,kilometers:parseInt(i.value.kilometers)||0,date:i.value.registration||null,registration:i.value.registration||null,tradeInPrice:o.value.tradeInPrice,evaluationRangeLow:o.value.evaluationRangeLow,evaluationRangeHigh:o.value.evaluationRangeHigh,provider:o.value.provider||null,evaluationDate:o.value.evaluationDate||null}};A("save",n)};return b({submit:u,canSubmit:()=>I.value}),(n,s)=>(a(),l("div",{class:E(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(a(),l("div",Yo)),t.hideHeader?x("",!0):(a(),l("div",Go,[e("h5",Ko,g(t.item?"Edit Trade-In":"Add Trade-In"),1),e("button",{onClick:s[0]||(s[0]=y=>n.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...s[18]||(s[18]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("div",Qo,[e("div",Jo,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[19]||(s[19]=[M("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.brand,"onUpdate:modelValue":s[1]||(s[1]=y=>i.value.brand=y),type:"text",placeholder:"e.g., Volkswagen",required:""},null,8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[20]||(s[20]=[M("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.model,"onUpdate:modelValue":s[2]||(s[2]=y=>i.value.model=y),type:"text",placeholder:"e.g., ID.4",required:""},null,8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[21]||(s[21]=[M("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.year,"onUpdate:modelValue":s[3]||(s[3]=y=>i.value.year=y),type:"number",placeholder:"e.g., 2024",min:"1900",max:new Date().getFullYear()+1,required:""},null,8,["modelValue","max"])])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[22]||(s[22]=[M("Version/Trim",-1)])]),_:1}),p(d(Y),{modelValue:i.value.version,"onUpdate:modelValue":s[4]||(s[4]=y=>i.value.version=y),type:"text",placeholder:"e.g., Premium Plus"},null,8,["modelValue"])]),e("div",Xo,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[23]||(s[23]=[M("VIN",-1)])]),_:1}),p(d(Y),{modelValue:i.value.vin,"onUpdate:modelValue":s[5]||(s[5]=y=>i.value.vin=y),type:"text",placeholder:"Vehicle Identification Number"},null,8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[24]||(s[24]=[M("Plates",-1)])]),_:1}),p(d(Y),{modelValue:i.value.plates,"onUpdate:modelValue":s[6]||(s[6]=y=>i.value.plates=y),type:"text",placeholder:"License plate number"},null,8,["modelValue"])])]),e("div",Zo,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[25]||(s[25]=[M("Fuel Type",-1)])]),_:1}),p(d(Ve),{modelValue:i.value.fuelType,"onUpdate:modelValue":s[7]||(s[7]=y=>i.value.fuelType=y)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select fuel type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Petrol"},{default:D(()=>[...s[26]||(s[26]=[M("Petrol",-1)])]),_:1}),p(d(z),{value:"Diesel"},{default:D(()=>[...s[27]||(s[27]=[M("Diesel",-1)])]),_:1}),p(d(z),{value:"Electric"},{default:D(()=>[...s[28]||(s[28]=[M("Electric",-1)])]),_:1}),p(d(z),{value:"Hybrid"},{default:D(()=>[...s[29]||(s[29]=[M("Hybrid",-1)])]),_:1}),p(d(z),{value:"Plug-in Hybrid"},{default:D(()=>[...s[30]||(s[30]=[M("Plug-in Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[31]||(s[31]=[M("Gear Type",-1)])]),_:1}),p(d(Ve),{modelValue:i.value.gearType,"onUpdate:modelValue":s[8]||(s[8]=y=>i.value.gearType=y)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select gear type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Manual"},{default:D(()=>[...s[32]||(s[32]=[M("Manual",-1)])]),_:1}),p(d(z),{value:"Automatic"},{default:D(()=>[...s[33]||(s[33]=[M("Automatic",-1)])]),_:1}),p(d(z),{value:"CVT"},{default:D(()=>[...s[34]||(s[34]=[M("CVT",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[35]||(s[35]=[M("Mileage (km)",-1)])]),_:1}),p(d(Y),{modelValue:i.value.kilometers,"onUpdate:modelValue":s[9]||(s[9]=y=>i.value.kilometers=y),modelModifiers:{number:!0},type:"number",placeholder:"0",min:"0"},null,8,["modelValue"])])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[36]||(s[36]=[M("Registration Year/Month",-1)])]),_:1}),p(d(Y),{modelValue:i.value.registration,"onUpdate:modelValue":s[10]||(s[10]=y=>i.value.registration=y),type:"text",placeholder:"MM/YYYY (e.g., 01/2024)"},null,8,["modelValue"])]),e("div",_o,[e("button",{type:"button",onClick:s[11]||(s[11]=y=>w.value=!w.value),class:"w-full flex items-center justify-between p-4 text-left hover:bg-surface transition-colors rounded-lg"},[s[37]||(s[37]=e("h3",{class:"text-sm font-medium text-foreground"},"Valuation Information",-1)),e("i",{class:E(["fa-solid transition-transform duration-200 text-muted-foreground",w.value?"fa-chevron-up":"fa-chevron-down"])},null,2)]),w.value?(a(),l("div",er,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[38]||(s[38]=[M("Trade-In Price (€)",-1)])]),_:1}),p(d(Y),{modelValue:o.value.tradeInPrice,"onUpdate:modelValue":s[12]||(s[12]=y=>o.value.tradeInPrice=y),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",tr,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[39]||(s[39]=[M("Evaluation Range - Low (€)",-1)])]),_:1}),p(d(Y),{modelValue:o.value.evaluationRangeLow,"onUpdate:modelValue":s[13]||(s[13]=y=>o.value.evaluationRangeLow=y),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[40]||(s[40]=[M("Evaluation Range - High (€)",-1)])]),_:1}),p(d(Y),{modelValue:o.value.evaluationRangeHigh,"onUpdate:modelValue":s[14]||(s[14]=y=>o.value.evaluationRangeHigh=y),modelModifiers:{number:!0},type:"number",placeholder:"0.00",min:"0",step:"0.01"},null,8,["modelValue"])])]),e("div",sr,[e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[41]||(s[41]=[M("Provider",-1)])]),_:1}),p(d(Ve),{modelValue:o.value.provider,"onUpdate:modelValue":s[15]||(s[15]=y=>o.value.provider=y)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select provider..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Eurotax"},{default:D(()=>[...s[42]||(s[42]=[M("Eurotax",-1)])]),_:1}),p(d(z),{value:"Infocar"},{default:D(()=>[...s[43]||(s[43]=[M("Infocar",-1)])]),_:1}),p(d(z),{value:"Manual"},{default:D(()=>[...s[44]||(s[44]=[M("Manual",-1)])]),_:1}),p(d(z),{value:"Other"},{default:D(()=>[...s[45]||(s[45]=[M("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",null,[p(d(F),{class:"text-xs font-medium text-muted-foreground mb-1"},{default:D(()=>[...s[46]||(s[46]=[M("Evaluation Date",-1)])]),_:1}),p(d(Y),{modelValue:o.value.evaluationDate,"onUpdate:modelValue":s[16]||(s[16]=y=>o.value.evaluationDate=y),type:"date"},null,8,["modelValue"])])])])):x("",!0)])]),t.hideActions?x("",!0):(a(),l("div",ar,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm",onClick:s[17]||(s[17]=y=>n.$emit("cancel"))}),p(d(Z),{label:"Save",variant:"primary",size:"small",class:"rounded-sm !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!I.value,onClick:u},null,8,["disabled"])]))],2))}},lr={key:0,class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},or={key:1,class:"flex justify-between items-center mb-4"},rr={class:"text-sm font-semibold text-foreground"},ir={class:"flex gap-2"},dr=["value"],ur={key:0,class:"space-y-4"},mr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},cr={class:"relative"},fr={key:0,class:"text-xs text-red-600 mt-1"},pr={class:"relative"},vr={key:0,class:"text-xs text-red-600 mt-1"},gr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yr=["value"],xr={key:0,class:"text-xs text-red-600 mt-1"},br={key:0},hr={class:"relative"},kr={key:1},wr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$r={class:"relative"},Cr={class:"relative"},Tr={class:"flex items-center gap-2"},Ar={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ir={class:"relative"},Sr={class:"bg-muted p-4 rounded-lg border border-border"},Dr={class:"flex justify-between items-center"},qr={class:"text-lg font-bold text-foreground"},Vr={class:"flex flex-col gap-2"},Lr={class:"flex items-center gap-2"},Mr={class:"flex items-center gap-2"},Or={key:0,class:"text-xs text-red-600 mt-1"},Nr={class:"bg-muted p-4 rounded-lg border border-border"},Er={class:"flex justify-between items-center"},jr={class:"text-lg font-bold text-foreground"},Rr={class:"flex flex-col gap-2"},Fr={class:"flex items-center gap-2"},Ur={class:"flex items-center gap-2"},Br={class:"flex items-center gap-2"},Pr={key:2,class:"flex justify-end gap-2 mt-6 border-t border-border pt-4"},Wr={__name:"PurchaseMethodWidget",props:{item:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:Number,required:!0},hideActions:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}},emits:["save","cancel"],setup(t,{expose:b,emit:r}){const k=t,A=r,w=N({}),i=[{value:"FIN",label:"FIN"},{value:"LEA",label:"LEA"},{value:"LTR",label:"LTR"}],o=N({type:"",fields:{monthlyInstalment:null,downPayment:null,duration:null,interestRate:null,effectiveInterestRate:null,gfv:null,mileageLimit:null,finalInstalment:null,customerType:"",insuranceIncluded:!1,maintenanceIncluded:!1,registrationTaxesIncluded:!1}}),I=q(()=>{if(o.value.type!=="LEA")return 0;const f=parseFloat(o.value.fields.monthlyInstalment)||0,m=parseInt(o.value.fields.duration)||0,L=parseFloat(o.value.fields.downPayment)||0,U=parseFloat(o.value.fields.finalInstalment)||0;return f*m+L+U}),u=q(()=>{if(o.value.type!=="LTR")return 0;const f=parseFloat(o.value.fields.monthlyInstalment)||0,m=parseInt(o.value.fields.duration)||0,L=parseFloat(o.value.fields.downPayment)||0;return f*m+L}),n=f=>f==="FIN"?[12,24,36,48,60]:f==="LEA"?[24,36,48,60]:f==="LTR"?[12,24,36,48,60]:[],s=f=>({FIN:"Captive Financing",LEA:"Leasing",LTR:"Long-Term Rental"})[f]||f,y=f=>f?new Intl.NumberFormat("en-US").format(f):"0",V=f=>{delete w.value[f]},C=q(()=>!o.value.type||!o.value.fields.monthlyInstalment||o.value.fields.monthlyInstalment<=0||o.value.fields.downPayment===null||o.value.fields.downPayment===void 0||o.value.fields.downPayment<0||!o.value.fields.duration||o.value.fields.duration<12||o.value.fields.duration>60||o.value.type==="LTR"&&!o.value.fields.customerType?!1:Object.keys(w.value).length===0),T=()=>{o.value.type!=="FIN"&&(o.value.fields.effectiveInterestRate=null,o.value.fields.gfv=null),o.value.type!=="LEA"&&(o.value.fields.finalInstalment=null),o.value.type!=="LTR"&&(o.value.fields.customerType="",o.value.fields.registrationTaxesIncluded=!1),o.value.type!=="LEA"&&o.value.type!=="LTR"&&(o.value.fields.mileageLimit=null,o.value.fields.maintenanceIncluded=!1),w.value={}};Me(()=>{k.item&&k.item.data&&(o.value={type:k.item.data.type||"",fields:{monthlyInstalment:k.item.data.monthlyInstalment||null,downPayment:k.item.data.downPayment||null,duration:k.item.data.duration||null,interestRate:k.item.data.interestRate||null,effectiveInterestRate:k.item.data.effectiveInterestRate||null,gfv:k.item.data.gfv||null,mileageLimit:k.item.data.mileageLimit||null,finalInstalment:k.item.data.finalInstalment||null,customerType:k.item.data.customerType||"",insuranceIncluded:k.item.data.insuranceIncluded||!1,maintenanceIncluded:k.item.data.maintenanceIncluded||!1,registrationTaxesIncluded:k.item.data.registrationTaxesIncluded||!1}})});const c=()=>{var te,J;if(!C.value)return;const f=s(o.value.type),m=o.value.fields.monthlyInstalment||0,L=o.value.fields.duration||0,U={id:((te=k.item)==null?void 0:te.id)||Date.now(),type:"purchase-method",action:k.item?"updated a purchase method":"added a purchase method",content:`${f}: €${y(m)}/month for ${L} months`,timestamp:((J=k.item)==null?void 0:J.timestamp)||new Date().toISOString(),isEdit:!!k.item,data:{type:o.value.type,typeLabel:f,monthlyInstalment:o.value.fields.monthlyInstalment,downPayment:o.value.fields.downPayment,duration:o.value.fields.duration,interestRate:o.value.fields.interestRate,effectiveInterestRate:o.value.fields.effectiveInterestRate,gfv:o.value.fields.gfv,mileageLimit:o.value.fields.mileageLimit,finalInstalment:o.value.fields.finalInstalment,customerType:o.value.fields.customerType,insuranceIncluded:o.value.fields.insuranceIncluded,maintenanceIncluded:o.value.fields.maintenanceIncluded,registrationTaxesIncluded:o.value.fields.registrationTaxesIncluded,totalLeasingAmount:I.value,totalRentalAmount:u.value}};A("save",U)};return b({submit:c,canSubmit:()=>C.value}),(f,m)=>(a(),l("div",{class:E(["animate-fade-in relative",{"bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6":!t.hideHeader}])},[t.hideHeader?x("",!0):(a(),l("div",lr)),t.hideHeader?x("",!0):(a(),l("div",or,[e("h5",rr,g(t.item?"Edit Purchase Method":"Add Purchase Method"),1),e("button",{onClick:m[0]||(m[0]=L=>f.$emit("cancel")),class:"text-muted-foreground hover:text-muted-foreground"},[...m[23]||(m[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])])),e("form",{onSubmit:ae(c,["prevent"]),class:"space-y-4"},[e("div",null,[m[24]||(m[24]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-2"},[M("Purchase Method Type "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",ir,[(a(),l(P,null,H(i,L=>e("label",{key:L.value,class:"flex-1 cursor-pointer"},[G(e("input",{type:"radio",value:L.value,"onUpdate:modelValue":m[1]||(m[1]=U=>o.value.type=U),class:"sr-only",onChange:T},null,40,dr),[[ss,o.value.type]]),e("div",{class:E(["px-4 py-3 rounded-btn border-2 text-center text-sm font-medium transition-colors",o.value.type===L.value?"border-brand-red bg-brand-red/5 text-brand-red":"border-D1D5DB bg-white text-muted-foreground hover:border-brand-slate"])},g(L.label),3)])),64))])]),o.value.type?(a(),l("div",ur,[e("div",mr,[e("div",null,[m[26]||(m[26]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Monthly Instalment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",cr,[m[25]||(m[25]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),G(e("input",{"onUpdate:modelValue":m[2]||(m[2]=L=>o.value.fields.monthlyInstalment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:E(["input pl-8",{"border-red-500":w.value.monthlyInstalment}]),onInput:m[3]||(m[3]=L=>V("monthlyInstalment"))},null,34),[[be,o.value.fields.monthlyInstalment,void 0,{number:!0}]])]),w.value.monthlyInstalment?(a(),l("p",fr,g(w.value.monthlyInstalment),1)):x("",!0)]),e("div",null,[m[28]||(m[28]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Down Payment "),e("span",{class:"text-brand-red"},"*")],-1)),e("div",pr,[m[27]||(m[27]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),G(e("input",{"onUpdate:modelValue":m[4]||(m[4]=L=>o.value.fields.downPayment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:E(["input pl-8",{"border-red-500":w.value.downPayment}]),onInput:m[5]||(m[5]=L=>V("downPayment"))},null,34),[[be,o.value.fields.downPayment,void 0,{number:!0}]])]),w.value.downPayment?(a(),l("p",vr,g(w.value.downPayment),1)):x("",!0)])]),e("div",gr,[e("div",null,[m[30]||(m[30]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Duration (months) "),e("span",{class:"text-brand-red"},"*")],-1)),G(e("select",{"onUpdate:modelValue":m[6]||(m[6]=L=>o.value.fields.duration=L),class:E(["input",{"border-red-500":w.value.duration}]),onChange:m[7]||(m[7]=L=>V("duration"))},[m[29]||(m[29]=e("option",{value:""},"Select duration...",-1)),(a(!0),l(P,null,H(n(o.value.type),L=>(a(),l("option",{key:L,value:L},g(L)+" months ",9,yr))),128))],34),[[gt,o.value.fields.duration,void 0,{number:!0}]]),w.value.duration?(a(),l("p",xr,g(w.value.duration),1)):x("",!0)]),o.value.type==="FIN"||o.value.type==="LEA"?(a(),l("div",br,[m[32]||(m[32]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Interest Rate / APR (%)",-1)),e("div",hr,[G(e("input",{"onUpdate:modelValue":m[8]||(m[8]=L=>o.value.fields.interestRate=L),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8",onInput:m[9]||(m[9]=L=>V("interestRate"))},null,544),[[be,o.value.fields.interestRate,void 0,{number:!0}]]),m[31]||(m[31]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])])):x("",!0),o.value.type==="LEA"||o.value.type==="LTR"?(a(),l("div",kr,[m[33]||(m[33]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Mileage Limit (annual km)",-1)),G(e("input",{"onUpdate:modelValue":m[10]||(m[10]=L=>o.value.fields.mileageLimit=L),type:"number",min:"0",placeholder:"0",class:"input"},null,512),[[be,o.value.fields.mileageLimit,void 0,{number:!0}]])])):x("",!0)]),o.value.type==="FIN"?(a(),l(P,{key:0},[e("div",wr,[e("div",null,[m[35]||(m[35]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Effective Interest Rate / TAEG (%)",-1)),e("div",$r,[G(e("input",{"onUpdate:modelValue":m[11]||(m[11]=L=>o.value.fields.effectiveInterestRate=L),type:"number",step:"0.01",min:"0",max:"99.99",placeholder:"0.00",class:"input pr-8"},null,512),[[be,o.value.fields.effectiveInterestRate,void 0,{number:!0}]]),m[34]||(m[34]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"%",-1))])]),e("div",null,[m[37]||(m[37]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Guaranteed Future Value / GFV (€)",-1)),e("div",Cr,[m[36]||(m[36]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),G(e("input",{"onUpdate:modelValue":m[12]||(m[12]=L=>o.value.fields.gfv=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[be,o.value.fields.gfv,void 0,{number:!0}]])])])]),e("div",Tr,[G(e("input",{type:"checkbox",id:"fin-insurance","onUpdate:modelValue":m[13]||(m[13]=L=>o.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.insuranceIncluded]]),m[38]||(m[38]=e("label",{for:"fin-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))])],64)):x("",!0),o.value.type==="LEA"?(a(),l(P,{key:1},[e("div",Ar,[e("div",null,[m[40]||(m[40]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},"Final Instalment (€)",-1)),e("div",Ir,[m[39]||(m[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),G(e("input",{"onUpdate:modelValue":m[14]||(m[14]=L=>o.value.fields.finalInstalment=L),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"input pl-8"},null,512),[[be,o.value.fields.finalInstalment,void 0,{number:!0}]])])])]),e("div",Sr,[e("div",Dr,[m[41]||(m[41]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Leasing Amount:",-1)),e("span",qr,"€ "+g(y(I.value)),1)]),m[42]||(m[42]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment + Final Instalment) ",-1))]),e("div",Vr,[e("div",Lr,[G(e("input",{type:"checkbox",id:"lea-insurance","onUpdate:modelValue":m[15]||(m[15]=L=>o.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.insuranceIncluded]]),m[43]||(m[43]=e("label",{for:"lea-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Mr,[G(e("input",{type:"checkbox",id:"lea-maintenance","onUpdate:modelValue":m[16]||(m[16]=L=>o.value.fields.maintenanceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.maintenanceIncluded]]),m[44]||(m[44]=e("label",{for:"lea-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))])])],64)):x("",!0),o.value.type==="LTR"?(a(),l(P,{key:2},[e("div",null,[m[46]||(m[46]=e("label",{class:"block text-xs font-medium text-muted-foreground mb-1"},[M(" Customer Type "),e("span",{class:"text-brand-red"},"*")],-1)),G(e("select",{"onUpdate:modelValue":m[17]||(m[17]=L=>o.value.fields.customerType=L),class:E(["input",{"border-red-500":w.value.customerType}]),onChange:m[18]||(m[18]=L=>V("customerType"))},[...m[45]||(m[45]=[e("option",{value:""},"Select customer type...",-1),e("option",{value:"Private"},"Private",-1),e("option",{value:"Business"},"Business",-1),e("option",{value:"Fleet"},"Fleet",-1)])],34),[[gt,o.value.fields.customerType]]),w.value.customerType?(a(),l("p",Or,g(w.value.customerType),1)):x("",!0)]),e("div",Nr,[e("div",Er,[m[47]||(m[47]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Total Rental Amount:",-1)),e("span",jr,"€ "+g(y(u.value)),1)]),m[48]||(m[48]=e("p",{class:"text-xs text-muted-foreground mt-1"}," (Monthly × Duration + Down Payment) ",-1))]),e("div",Rr,[e("div",Fr,[G(e("input",{type:"checkbox",id:"ltr-insurance","onUpdate:modelValue":m[19]||(m[19]=L=>o.value.fields.insuranceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.insuranceIncluded]]),m[49]||(m[49]=e("label",{for:"ltr-insurance",class:"text-sm text-muted-foreground cursor-pointer"}," Insurance Included ",-1))]),e("div",Ur,[G(e("input",{type:"checkbox",id:"ltr-maintenance","onUpdate:modelValue":m[20]||(m[20]=L=>o.value.fields.maintenanceIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.maintenanceIncluded]]),m[50]||(m[50]=e("label",{for:"ltr-maintenance",class:"text-sm text-muted-foreground cursor-pointer"}," Maintenance Included ",-1))]),e("div",Br,[G(e("input",{type:"checkbox",id:"ltr-registration","onUpdate:modelValue":m[21]||(m[21]=L=>o.value.fields.registrationTaxesIncluded=L),class:"w-4 h-4 rounded border-D1D5DB"},null,512),[[Ie,o.value.fields.registrationTaxesIncluded]]),m[51]||(m[51]=e("label",{for:"ltr-registration",class:"text-sm text-muted-foreground cursor-pointer"}," Registration/Taxes Included ",-1))])])],64)):x("",!0)])):x("",!0)],32),t.hideActions?x("",!0):(a(),l("div",Pr,[p(d(Z),{label:"Cancel",variant:"outline",size:"small",onClick:m[22]||(m[22]=L=>f.$emit("cancel"))}),p(d(Z),{label:"Save",variant:"primary",size:"small",disabled:!C.value,onClick:c},null,8,["disabled"])]))],2))}},zr={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},Hr={class:"space-y-2"},Yr={class:"space-y-2"},Gr={class:"space-y-2"},Kr={class:"space-y-2"},Qr={class:"relative"},Jr={class:"space-y-2"},Xr={class:"space-y-2"},Zr={class:"space-y-2"},_r={class:"border-t border pt-4"},ei={key:0,class:"mt-4 space-y-6"},ti={class:"space-y-2"},si={class:"space-y-2"},ai={class:"space-y-2"},ni={class:"space-y-2"},li={__name:"AddRequestedCarModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},taskType:{type:String,default:"lead"},taskId:{type:[String,Number],default:null}},emits:["close","save"],setup(t,{emit:b}){const r=t,k=b,A=u=>{u||k("close")},w=N(!1),i=N({brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null});ce(()=>r.show,u=>{var n;if(u&&((n=r.task)!=null&&n.requestedCar)){const s=r.task.requestedCar;i.value={brand:s.brand||"",model:s.model||"",year:s.year||new Date().getFullYear(),price:s.price||null,requestType:s.requestType||"Quotation",requestMessage:s.requestMessage||"",image:s.image||"",dealership:s.dealership||"",fuelType:s.fuelType||"",gearType:s.gearType||"",kilometers:s.kilometers||null}}else u&&(i.value={brand:"",model:"",year:new Date().getFullYear(),price:null,requestType:"Quotation",requestMessage:"",image:"",dealership:"",fuelType:"",gearType:"",kilometers:null})});const o=q(()=>i.value.brand.trim()&&i.value.model.trim()&&i.value.year>1900),I=()=>{if(!o.value)return;const u={brand:i.value.brand.trim(),model:i.value.model.trim(),year:i.value.year,requestType:i.value.requestType};i.value.price&&(u.price=i.value.price),i.value.requestMessage&&(u.requestMessage=i.value.requestMessage.trim()),i.value.image&&(u.image=i.value.image.trim()),i.value.dealership&&(u.dealership=i.value.dealership.trim()),i.value.fuelType&&(u.fuelType=i.value.fuelType),i.value.gearType&&(u.gearType=i.value.gearType),i.value.kilometers!==null&&(u.kilometers=i.value.kilometers),k("save",u)};return(u,n)=>(a(),j(d(nt),{open:t.show,"onUpdate:open":A},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-2xl max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>{var s;return[M(g((s=t.task)!=null&&s.requestedCar?"Edit Requested Car":"Add Requested Car"),1)]}),_:1})]),_:1}),e("div",zr,[e("div",Hr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[13]||(n[13]=[M("Brand ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.brand,"onUpdate:modelValue":n[0]||(n[0]=s=>i.value.brand=s),type:"text",required:"",placeholder:"e.g., BMW, Mercedes-Benz, Audi",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Yr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[14]||(n[14]=[M("Model ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.model,"onUpdate:modelValue":n[1]||(n[1]=s=>i.value.model=s),type:"text",required:"",placeholder:"e.g., 3 Series, C-Class, A4",class:"w-full h-10"},null,8,["modelValue"])]),e("div",Gr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[15]||(n[15]=[M("Year ",-1),e("span",{class:"text-brand-red"},"*",-1)])]),_:1}),p(d(Y),{modelValue:i.value.year,"onUpdate:modelValue":n[2]||(n[2]=s=>i.value.year=s),modelModifiers:{number:!0},type:"number",required:"",min:"1900",max:new Date().getFullYear()+1,placeholder:"e.g., 2024",class:"w-full h-10"},null,8,["modelValue","max"])]),e("div",Kr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[16]||(n[16]=[M("Price (Optional)",-1)])]),_:1}),e("div",Qr,[n[17]||(n[17]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"€",-1)),p(d(Y),{modelValue:i.value.price,"onUpdate:modelValue":n[3]||(n[3]=s=>i.value.price=s),modelModifiers:{number:!0},type:"number",min:"0",step:"1000",placeholder:"45000",class:"w-full h-10 pl-8"},null,8,["modelValue"])])]),e("div",Jr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[18]||(n[18]=[M("Request Type",-1)])]),_:1}),p(d(Ve),{modelValue:i.value.requestType,"onUpdate:modelValue":n[4]||(n[4]=s=>i.value.requestType=s)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select request type..."})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Quotation"},{default:D(()=>[...n[19]||(n[19]=[M("Quotation",-1)])]),_:1}),p(d(z),{value:"Test Drive"},{default:D(()=>[...n[20]||(n[20]=[M("Test Drive",-1)])]),_:1}),p(d(z),{value:"Generic Sales"},{default:D(()=>[...n[21]||(n[21]=[M("Generic Sales",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",Xr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[22]||(n[22]=[M("Request Message (Optional)",-1)])]),_:1}),p(d(gs),{modelValue:i.value.requestMessage,"onUpdate:modelValue":n[5]||(n[5]=s=>i.value.requestMessage=s),rows:"5",placeholder:"Customer's message or notes about the vehicle request...",class:"w-full min-h-[120px] resize-none"},null,8,["modelValue"])]),e("div",Zr,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[23]||(n[23]=[M("Image URL (Optional)",-1)])]),_:1}),p(d(Y),{modelValue:i.value.image,"onUpdate:modelValue":n[6]||(n[6]=s=>i.value.image=s),type:"url",placeholder:"https://example.com/car-image.jpg",class:"w-full h-10"},null,8,["modelValue"]),n[24]||(n[24]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Enter a URL to an image of the vehicle",-1))]),e("div",_r,[e("button",{type:"button",onClick:n[7]||(n[7]=s=>w.value=!w.value),class:"flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"},[e("i",{class:E(["fa-solid",w.value?"fa-chevron-down":"fa-chevron-right"])},null,2),n[25]||(n[25]=M(" Advanced Details (Optional) ",-1))]),w.value?(a(),l("div",ei,[e("div",ti,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[26]||(n[26]=[M("Dealership",-1)])]),_:1}),p(d(Y),{modelValue:i.value.dealership,"onUpdate:modelValue":n[8]||(n[8]=s=>i.value.dealership=s),type:"text",placeholder:"e.g., Milano, Berlin",class:"w-full h-10"},null,8,["modelValue"])]),e("div",si,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[27]||(n[27]=[M("Fuel Type",-1)])]),_:1}),p(d(Ve),{modelValue:i.value.fuelType,"onUpdate:modelValue":n[9]||(n[9]=s=>i.value.fuelType=s)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select fuel type"})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Petrol"},{default:D(()=>[...n[28]||(n[28]=[M("Petrol",-1)])]),_:1}),p(d(z),{value:"Diesel"},{default:D(()=>[...n[29]||(n[29]=[M("Diesel",-1)])]),_:1}),p(d(z),{value:"Electric"},{default:D(()=>[...n[30]||(n[30]=[M("Electric",-1)])]),_:1}),p(d(z),{value:"Hybrid"},{default:D(()=>[...n[31]||(n[31]=[M("Hybrid",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ai,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[32]||(n[32]=[M("Gear Type",-1)])]),_:1}),p(d(Ve),{modelValue:i.value.gearType,"onUpdate:modelValue":n[10]||(n[10]=s=>i.value.gearType=s)},{default:D(()=>[p(d(Se),{class:"w-full h-10"},{default:D(()=>[p(d(De),{placeholder:"Select gear type"})]),_:1}),p(d(qe),null,{default:D(()=>[p(d(z),{value:"Manual"},{default:D(()=>[...n[33]||(n[33]=[M("Manual",-1)])]),_:1}),p(d(z),{value:"Automatic"},{default:D(()=>[...n[34]||(n[34]=[M("Automatic",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ni,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...n[35]||(n[35]=[M("Kilometers",-1)])]),_:1}),p(d(Y),{modelValue:i.value.kilometers,"onUpdate:modelValue":n[11]||(n[11]=s=>i.value.kilometers=s),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"e.g., 50000",class:"w-full h-10"},null,8,["modelValue"])])])):x("",!0)])]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>{var s;return[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:n[12]||(n[12]=y=>u.$emit("close"))}),p(d(Z),{label:(s=t.task)!=null&&s.requestedCar?"Update Car":"Add Car",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!o.value,onClick:I},null,8,["label","disabled"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},oi={class:"flex-1 overflow-y-auto px-6 py-4 w-full space-y-6"},ri={class:"space-y-2"},ii={key:0,class:"space-y-2"},di={class:"flex flex-wrap gap-2"},ui=["onClick"],mi={__name:"AddTagModal",props:{show:{type:Boolean,required:!0},existingTags:{type:Array,default:()=>[]}},emits:["close","add"],setup(t,{emit:b}){const r=t,k=b,A=N(""),w=o=>{o||k("close")};ce(()=>r.show,o=>{o&&(A.value="")});const i=()=>{const o=A.value.trim();o&&(r.existingTags.includes(o)||(k("add",o),A.value=""))};return(o,I)=>(a(),j(d(nt),{open:t.show,"onUpdate:open":w},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-md max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>[...I[2]||(I[2]=[M("Add Tag",-1)])]),_:1})]),_:1}),e("div",oi,[e("div",ri,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...I[3]||(I[3]=[M("Tag Name",-1)])]),_:1}),p(d(Y),{modelValue:A.value,"onUpdate:modelValue":I[0]||(I[0]=u=>A.value=u),onKeyup:as(i,["enter"]),type:"text",placeholder:"Enter tag name",class:"w-full h-10",autofocus:""},null,8,["modelValue"])]),t.existingTags.length>0?(a(),l("div",ii,[p(d(F),{class:"block text-sm font-semibold text-foreground"},{default:D(()=>[...I[4]||(I[4]=[M("Existing Tags",-1)])]),_:1}),e("div",di,[(a(!0),l(P,null,H(t.existingTags,u=>(a(),l("button",{key:u,onClick:n=>A.value=u,class:"px-3 py-1 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors"},g(u),9,ui))),128))])])):x("",!0)]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:I[1]||(I[1]=u=>o.$emit("close"))}),p(d(Z),{label:"Add Tag",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:!A.value.trim(),onClick:i},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},Je={note:"data",communication:"communication",email:"communication",call:"communication",sms:"communication",whatsapp:"communication",attachment:"attachment",document:"attachment",file:"attachment",tradein:"tradein","trade-in":"tradein",financing:"financing",offer:"offers",purchase:"offers",appointment:"appointments",survey:"surveys",default:"overview"};function ci(t){if(!t)return Je.default;const b=t.toLowerCase().trim();return Je[b]||Je.default}function fi({store:t,taskId:b,getTabForItemType:r,isOverviewModalAction:k}){const A=N(null),w=N(null),i=N("overview"),o=N(null),I=N([]);ce(i,()=>{A.value=null,w.value=null});const u=q(()=>[...t.currentActivities.value,...I.value.filter(c=>!c.activityId)].filter(c=>{const f=r(c.type);return i.value==="overview"?f==="overview":f===i.value}).sort((c,f)=>{const m=new Date(c.timestamp||0);return new Date(f.timestamp||0)-m})),n=T=>(w.value=null,i.value==="overview"&&k&&k(T)?{type:"overview-modal",action:T}:(["email","sms","whatsapp","call"].includes(T)?(o.value=T,A.value="communication"):A.value=T,null)),s=async T=>{var c;if(T.isEdit){const f=I.value.findIndex(m=>m.id===T.id);f>-1&&(I.value[f]={...I.value[f],...T}),(c=w.value)!=null&&c.activityId&&await t.updateActivity(b.value,w.value.activityId,{type:T.communicationType||T.type,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data})}else{const f=T.communicationType||T.type,m=await t.addActivity(b.value,{type:f,user:"You",action:T.action,content:T.content,fileName:T.fileName,data:T.data});I.value.push({id:m.id,type:f==="email"||f==="whatsapp"||f==="sms"?"communication":f,action:T.action,content:T.content,fileName:T.fileName,data:T.data,timestamp:m.timestamp,activityId:m.id})}A.value=null,w.value=null},y=()=>{A.value=null,w.value=null},V=T=>{r(T.type)&&(A.value=T.type==="email"||T.type==="whatsapp"||T.type==="sms"||T.type==="communication"?"communication":T.type,w.value=T)},C=async T=>{try{await t.deleteActivity(b.value,T)}catch(c){throw console.error("Error deleting item:",c),c}};return{activeTab:i,showInlineWidget:A,inlineWidgetType:q(()=>A.value),editingItem:w,isEditing:q(()=>w.value!==null),communicationType:o,inlineContent:I,filteredInlineContent:u,handleAddNewAction:n,handleWidgetSave:s,handleWidgetCancel:y,handleEditItem:V,handleDeleteItem:C}}const pi={class:"flex-1 flex flex-col overflow-hidden h-full"},vi={key:1,class:"flex-1 flex flex-row overflow-hidden"},gi={class:"flex-1 flex flex-col overflow-hidden min-w-0"},yi={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},xi={class:"mb-4"},bi={key:0},hi={key:0},ki={key:1,class:"mb-6"},wi={key:2,class:"space-y-4 mb-6 px-1"},$i={key:1},Ci={key:0},Ti={key:1},Ai={class:"relative flex items-center py-1 mb-4"},Ii={class:"relative mx-4"},Si={key:0,class:"animate-fade-in relative bg-surface border border-border rounded-xl p-5 shadow-nsc-card mb-6"},Di={class:"flex justify-between items-center mb-4"},qi={key:0,class:"space-y-4 mb-6 px-1"},Vi={class:"hidden lg:flex flex-col overflow-hidden border-l border-border shrink-0 w-80 h-full"},Li={key:2,class:"flex-1 flex flex-row overflow-hidden"},Mi={class:"flex-1 flex flex-col overflow-hidden min-w-0"},Oi={class:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide"},Ni={key:0,class:"grid grid-cols-1 lg:grid-cols-[80%_20%] gap-6 items-start"},Ei={class:"space-y-6"},ji={key:0},Ri={key:0,class:"lg:col-span-1 space-y-6"},Fi={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"},Ui={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:col-span-2"},Bi={class:"rounded-lg flex flex-col bg-muted"},Pi={class:"bg-white rounded-lg p-4 shadow-nsc-card flex flex-col flex-1 min-h-0"},Wi={class:"relative flex-1 min-h-0"},zi={key:0,class:"absolute left-5 top-0 bottom-0 w-0.5 bg-border z-0"},Hi={key:1,class:"text-center py-6 text-muted-foreground"},Yi={key:2,class:"space-y-6 h-full overflow-y-auto pr-2"},Gi={class:"flex-1 min-w-0"},Ki={class:"text-sm text-muted-foreground leading-snug"},Qi={class:"font-bold"},Ji={key:0,class:"mt-2 bg-orange-50/50 border border-orange-100 p-3 rounded-lg text-sm text-muted-foreground"},Xi={class:"text-xs text-muted-foreground mt-1"},Zi={key:2},_i={key:0,class:"space-y-4 mt-4"},ed={key:1,class:"text-center py-12 text-muted-foreground"},td={__name:"EntityDetailLayout",props:{task:{type:Object,required:!0},type:{type:String,required:!0},managementWidget:{type:Object,required:!0},storeAdapter:{type:Object,required:!0},addNewConfig:{type:Object,required:!0},showCloseButton:{type:Boolean,default:!1}},emits:["car-added","convert-to-lead","convert-to-opportunity","tag-updated","appointment-created","close"],setup(t,{emit:b}){const r=t,k=b,A=ns(),w=ge(),i=qt(),o=qs(),I=q(()=>r.task.id),u=q(()=>A.path.startsWith("/tasks")&&!A.path.startsWith("/customer")),n=N("manage"),s=[{key:"manage",label:"Manage"},{key:"request",label:"Request"},{key:"data",label:"Note"}];N(!1);const y=N(null),V=N(null),C=["note","attachment","tradein","purchase"],T=q(()=>{var K,_;const v=[],h=new Set,R=["note","attachment","tradein","purchase","purchase-method","financing"];return(_=(K=r.storeAdapter)==null?void 0:K.currentActivities)!=null&&_.value&&r.storeAdapter.currentActivities.value.filter(O=>R.includes(O.type)).forEach(O=>{h.has(O.id)||(h.add(O.id),v.push(O))}),r.task.activities&&r.task.activities.filter(O=>R.includes(O.type)).forEach(O=>{h.has(O.id)||(h.add(O.id),v.push(O))}),$e.value.filter(Q=>R.includes(Q.type)).forEach(Q=>{h.has(Q.id)||(h.add(Q.id),v.push(Q))}),v.sort((Q,O)=>{const Ae=new Date(Q.timestamp||0);return new Date(O.timestamp||0)-Ae})}),c=v=>{V.value=null,y.value=v},f=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:v.type,action:v.action,content:v.content,data:v.data,fileName:v.fileName,timestamp:v.timestamp||new Date().toISOString()}),$e.value.push({id:v.id||Date.now(),type:v.type,action:v.action,content:v.content,data:v.data,fileName:v.fileName,timestamp:v.timestamp||new Date().toISOString()}),y.value=null,V.value=null}catch(h){console.error("Error saving enrich data:",h)}},m=()=>{y.value=null,V.value=null},L=v=>{V.value=v,y.value=v.type==="purchase-method"?"purchase":v.type},U=async v=>{try{await r.storeAdapter.deleteActivity(r.task.id,v.id);const h=$e.value.findIndex(R=>R.id===v.id);h!==-1&&$e.value.splice(h,1)}catch(h){console.error("Error deleting enrich item:",h)}};q(()=>r.task.activities?r.task.activities.filter(v=>v.type==="note"):[]),q(()=>r.task.activities?r.task.activities.filter(v=>["email","call","sms","whatsapp"].includes(v.type)):[]),q(()=>r.task.activities?r.task.activities.filter(v=>v.type==="attachment"):[]),q(()=>r.task.activities?r.task.activities.filter(v=>v.type==="purchase"):[]),q(()=>r.task.activities?r.task.activities.filter(v=>v.type==="tradein"):[]);const te=q(()=>r.type==="contact"?"bg-blue-100 text-blue-600":r.type==="lead"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"),J=N(A.path.startsWith("/tasks")&&!A.path.startsWith("/customer"));ce(()=>A.path,v=>{J.value=v.startsWith("/tasks")&&!v.startsWith("/customer")});const ue=()=>{w.push({path:`/customer/${r.task.id}`,query:{type:r.type}})};async function ye(v){var ft,pt;const h=((ft=r.task.customer)==null?void 0:ft.id)??r.task.id,R=v.time||"10:00",W=R.length===5?`${R}:00`:R,K=`${v.date}T${W}`,[_,Q]=R.split(":").map(Number),O=_+1,Ae=`${v.date}T${String(O).padStart(2,"0")}:${String(Q||0).padStart(2,"0")}:00`;let Pe=null,We="user",ct=null,ze="",He=null;if(v.assignee){if(v.assignee.startsWith("user-")){const ke=parseInt(v.assignee.replace("user-",""),10),we=o.getUserById(ke);Pe=ke,We="user",ze=(we==null?void 0:we.name)||""}else if(v.assignee.startsWith("team-")){const ke=parseInt(v.assignee.replace("team-",""),10),we=o.getTeamById(ke);ct=ke,We="team",He=(we==null?void 0:we.name)||"",ze=He}}const Zt={type:v.type,title:v.title||`${v.type} - ${v.customer||"Customer"}`,customer:v.customer||((pt=r.task.customer)==null?void 0:pt.name)||"",customerId:h,start:K,end:Ae,assignee:ze,assigneeId:Pe,assigneeType:We,teamId:ct,team:He,dealership:v.dealership||"",status:"confirmed"};try{await Ls(Zt)}catch(ke){console.error("Failed to create appointment:",ke);return}pe.value=!1,le.value=!1,k("appointment-created")}const fe=()=>{$.value=!0},me=async v=>{var R,W,K,_;const h=v.name;r.type==="lead"?await((W=(R=r.storeAdapter).updateLead)==null?void 0:W.call(R,r.task.id,{assignee:h,assigneeType:v.type,teamId:v.type==="team"?v.id:null})):r.type==="opportunity"&&await((_=(K=r.storeAdapter).updateOpportunity)==null?void 0:_.call(K,r.task.id,{assignee:h,assigneeType:v.type,teamId:v.type==="team"?v.id:null})),$.value=!1},ne=()=>{B.value=!0},he=async v=>{var h,R,W,K;try{r.type==="lead"?await((R=(h=r.storeAdapter).updateLead)==null?void 0:R.call(h,r.task.id,{requestedCar:v})):r.type==="opportunity"&&await((K=(W=r.storeAdapter).updateOpportunity)==null?void 0:K.call(W,r.task.id,{requestedCar:v})),B.value=!1}catch(_){console.error("Error saving requested car:",_)}},de=N(!1),X=N(null),pe=N(!1),le=N(!1),$=N(!1),S=N(!1),B=N(!1),ee=N([]),ve=N(!1),xe=N(!1),oe=N(!1),re=N(!1),Oe=N(!1),Ee=N(!1),je=N({}),{activeTab:se,showInlineWidget:Re,editingItem:Fe,communicationType:Nt,inlineContent:$e,filteredInlineContent:Ne,handleAddNewAction:Et,handleWidgetSave:Le,handleWidgetCancel:Ue,handleEditItem:lt,handleDeleteItem:ot}=fi({store:r.storeAdapter,taskId:I,getTabForItemType:ci,isOverviewModalAction:v=>se.value==="overview"&&r.addNewConfig.overviewActions.includes(v)});ce(()=>r.task.id,()=>{se.value="overview"}),ce(se,v=>{v!=="appointments"&&(le.value=!1)});const jt=q(()=>new Date().toISOString().slice(0,10));Me(async()=>{if(!u.value)try{const v=await Vs();ee.value=v.dealerships||[]}catch(v){console.error("Failed to fetch calendar filter options:",v)}});const rt=()=>{u.value?n.value="request":se.value="overview"},Be=v=>{const h=Et(v);h&&h.modalAction&&(X.value=h.modalAction,de.value=!0)},it=v=>{if(v==="appointment"){pe.value=!0;return}if(v==="call"){Ee.value=!0;return}if(v==="note"){ve.value=!0;return}if(v==="attachment"){xe.value=!0;return}if(v==="whatsapp"){oe.value=!0;return}if(v==="sms"){re.value=!0;return}if(v==="email"){Oe.value=!0;return}const h={call:"communication",appointment:"overview"};if(["financing","tradein","purchase"].includes(v))X.value=v,de.value=!0;else{const R=h[v];R?(se.value=R,setTimeout(()=>{Be(v),setTimeout(()=>{try{const W=document.querySelector(".animate-fade-in");W&&W.parentNode&&W.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},100)},50)):Be(v)}},Ce=()=>{de.value=!1,X.value=null},Rt=async v=>{var h,R;try{const W=v.type==="FIN"?"Captive Financing":v.type==="LEA"?"Leasing":"Long-Term Rental",K=((h=v.fields)==null?void 0:h.monthlyInstalment)||0;await Le({type:"purchase-method",action:`added a ${W} purchase method`,content:`${W}: €${K.toLocaleString()}/month for ${((R=v.fields)==null?void 0:R.duration)||0} months`,data:{purchaseMethodId:v.id,type:v.type,...v.fields}}),Ce()}catch(W){console.error("Error saving purchase method:",W)}},dt=async v=>{if(X.value==="tradein")try{const{saveTradeInVehicle:h}=Ts(),R=await h(r.type,r.task.id,v.vehicle,v.valuation||{});$e.value.push({id:R.activity.id,type:"tradein",action:"added a trade-in",vehicleId:R.vehicle.id,data:R.activity.data,timestamp:R.activity.timestamp,activityId:R.activity.id}),Ce()}catch(h){console.error("Error saving trade-in:",h)}else X.value==="purchase"&&(await Le(v),Ce())},Ft=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:"note",content:v.content||v.message,message:v.content||v.message,timestamp:new Date().toISOString()}),ve.value=!1}catch(h){console.error("Error saving note:",h)}},Ut=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:"attachment",fileName:v.fileName,file:v.file,content:`Attachment: ${v.fileName}`,timestamp:new Date().toISOString()}),xe.value=!1}catch(h){console.error("Error saving attachment:",h)}},Bt=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:"whatsapp",message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),oe.value=!1}catch(h){console.error("Error saving WhatsApp:",h)}},Pt=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:"sms",message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),re.value=!1}catch(h){console.error("Error saving SMS:",h)}},Wt=async v=>{try{await r.storeAdapter.addActivity(r.task.id,{type:"email",subject:v.subject,message:v.message,content:v.message,template:v.template,timestamp:new Date().toISOString()}),Oe.value=!1}catch(h){console.error("Error saving email:",h)}},zt=v=>{console.log("Activity clicked:",v)},Ht=v=>{je.value[v]=!je.value[v]},Yt=v=>{it(v)},Gt=q(()=>{const v=[{key:"overview",label:"Overview"},{key:"data",label:"Note"},{key:"communication",label:"Communication"},{key:"attachment",label:"Attachments"}];return r.type==="contact"?[{key:"overview",label:"Overview"},{key:"negotiations",label:"Negotiations"},...v.slice(1),{key:"appointments",label:"Appointments"}]:v}),Te=q(()=>[...r.storeAdapter.currentActivities.value,...$e.value]);q(()=>X.value==="financing"?"Add Financing":X.value==="tradein"?"Add Trade-in":X.value==="purchase"?"Create Purchase Offer":"");const ut=async v=>{if(r.type==="opportunity")try{await r.storeAdapter.addVehicle(r.task.id,v.vehicleData),r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id)}catch(h){console.error("Error selecting vehicle:",h)}},mt=async v=>{if(r.type==="opportunity")try{await r.storeAdapter.createOffer(r.task.id,v.offerData),r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id)}catch(h){console.error("Error creating offer:",h)}},Kt=async v=>{var W,K,_,Q;const h=r.task.tags||[];if(h.includes(v)){S.value=!1;return}const R=[...h,v];try{if(r.type==="lead")await((K=(W=r.storeAdapter).updateLead)==null?void 0:K.call(W,r.task.id,{tags:R})),r.storeAdapter.loadLeadById&&await r.storeAdapter.loadLeadById(r.task.id);else if(r.type==="opportunity")await((Q=(_=r.storeAdapter).updateOpportunity)==null?void 0:Q.call(_,r.task.id,{tags:R})),r.storeAdapter.loadOpportunityById&&await r.storeAdapter.loadOpportunityById(r.task.id);else if(r.type==="contact"){const O=A.query.type==="account"?"account":"contact";await i.updateCustomer(r.task.id,{tags:R},O),await i.fetchCustomerById(r.task.id,O),k("tag-updated")}S.value=!1}catch(O){console.error("Error adding tag:",O)}},Qt=v=>{const h={call:"fa-solid fa-phone text-blue-600",email:"fa-solid fa-envelope text-green-600",note:"fa-solid fa-sticky-note text-yellow-600",meeting:"fa-solid fa-calendar text-purple-600",task:"fa-solid fa-check-circle text-indigo-600",attachment:"fa-solid fa-paperclip text-muted-foreground",status:"fa-solid fa-tag text-orange-600",default:"fa-solid fa-circle text-muted-foreground"};return h[v]||h.default},Jt=v=>{const h={call:"bg-blue-100 text-blue-600",email:"bg-green-100 text-green-600",note:"bg-yellow-100 text-yellow-600",meeting:"bg-purple-100 text-purple-600",task:"bg-indigo-100 text-indigo-600",attachment:"bg-muted text-muted-foreground",status:"bg-orange-100 text-orange-600",default:"bg-muted text-muted-foreground"};return h[v]||h.default},Xt=v=>v?new Date(v).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(v,h)=>{var R,W,K,_,Q;return a(),l("div",pi,[u.value?x("",!0):(a(),j(sa,{key:0,initials:t.task.customer.initials,name:t.task.customer.name,email:t.task.customer.email,phone:t.task.customer.phone,"third-field-value":t.task.customer.address,"avatar-color-class":te.value,"task-type":t.type,"customer-id":((R=t.task.customer)==null?void 0:R.id)||t.task.customerId||t.task.id,tags:t.task.tags||[],"show-close-button":t.showCloseButton,"email-label":"Email","phone-label":"Phone","third-field-label":"Address",onAddTag:h[0]||(h[0]=O=>S.value=!0),onClose:h[1]||(h[1]=O=>v.$emit("close"))},{"name-action":D(()=>[u.value?(a(),l("button",{key:0,onClick:ue,class:"w-6 h-6 flex items-center justify-center bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-blue-600 hover:text-blue-700 transition-colors shrink-0",title:"Open in new page","aria-label":"Open customer page"},[...h[24]||(h[24]=[e("i",{class:"fa-solid fa-external-link text-xs"},null,-1)])])):x("",!0)]),_:1},8,["initials","name","email","phone","third-field-value","avatar-color-class","task-type","customer-id","tags","show-close-button"])),u.value?u.value?(a(),l("div",Li,[e("div",Mi,[e("div",Oi,[p(wt,{modelValue:n.value,"onUpdate:modelValue":h[9]||(h[9]=O=>n.value=O),tabs:s,class:"mb-6"},null,8,["modelValue"]),n.value==="manage"?(a(),l("div",Ni,[e("div",Ei,[t.managementWidget?(a(),l("div",ji,[(a(),j(yt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Te.value,onCarAdded:h[10]||(h[10]=O=>v.$emit("car-added",O)),onConvertToLead:h[11]||(h[11]=O=>v.$emit("convert-to-lead")),onConvertToOpportunity:h[12]||(h[12]=O=>v.$emit("convert-to-opportunity")),onVehicleSelected:ut,onCreateOffer:mt,onViewHistory:rt},null,40,["lead","opportunity","contact","activities"]))])):x("",!0)]),t.type!=="contact"?(a(),l("div",Ri,[p($t,{task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:fe,onAddRequestedCar:ne},null,8,["task","entity-type","activities"]),p(Ct,{task:t.task,"entity-type":t.type},null,8,["task","entity-type"])])):x("",!0)])):x("",!0),n.value==="request"?(a(),l("div",Fi,[e("div",Ui,[t.type!=="contact"?(a(),j($t,{key:0,task:t.task,"entity-type":t.type,activities:t.task.activities||[],onReassign:fe,onAddRequestedCar:ne},null,8,["task","entity-type","activities"])):x("",!0),p(xs,{task:t.task,"task-type":t.type,"customer-id":((Q=t.task.customer)==null?void 0:Q.id)||t.task.customerId||t.task.id,onAction:it,onAddTag:h[13]||(h[13]=O=>S.value=!0)},null,8,["task","task-type","customer-id"])]),t.type!=="contact"?(a(),j(Ct,{key:0,task:t.task,"entity-type":t.type},null,8,["task","entity-type"])):x("",!0),e("div",Bi,[h[32]||(h[32]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Activity Summary")])],-1)),e("div",Pi,[e("div",Wi,[Te.value.length>0?(a(),l("div",zi)):x("",!0),Te.value.length===0?(a(),l("div",Hi,[...h[31]||(h[31]=[e("i",{class:"fa-solid fa-clock text-2xl mb-2"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No activities yet",-1)])])):(a(),l("div",Yi,[(a(!0),l(P,null,H(Te.value,O=>(a(),l("div",{key:O.id,class:"flex gap-4 relative"},[e("div",{class:E(["w-10 h-10 rounded-full flex items-center justify-center shrink-0 z-10 relative bg-surface",Jt(O.type)])},[e("i",{class:E([Qt(O.type),"text-sm"])},null,2)],2),e("div",Gi,[e("div",Ki,[e("span",Qi,g(O.user),1),M(" "+g(O.action),1)]),O.content?(a(),l("div",Ji,g(O.content),1)):x("",!0),e("div",Xi,g(Xt(O.timestamp)),1)])]))),128))]))])])])])):x("",!0),n.value==="data"?(a(),l("div",Zi,[p(Tt,{actions:C,"active-tab":"data",onAction:c}),e("div",null,[y.value==="note"?(a(),j(Ge,{key:0,item:V.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:m},null,8,["item","task-type","task-id"])):x("",!0),y.value==="attachment"?(a(),j(Ke,{key:1,item:V.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:m},null,8,["item","task-type","task-id"])):x("",!0),y.value==="tradein"?(a(),j(nr,{key:2,item:V.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:m},null,8,["item","task-type","task-id"])):x("",!0),y.value==="purchase"?(a(),j(Wr,{key:3,item:V.value,"task-type":t.type,"task-id":t.task.id,onSave:f,onCancel:m},null,8,["item","task-type","task-id"])):x("",!0)]),T.value.length>0?(a(),l("div",_i,[(a(!0),l(P,null,H(T.value,O=>{var Ae;return a(),j(Qe,{key:O.id,item:O,"task-type":t.type,"customer-initials":((Ae=t.task.customer)==null?void 0:Ae.initials)||"SK",onEdit:L,onDelete:U},null,8,["item","task-type","customer-initials"])}),128))])):y.value?x("",!0):(a(),l("div",ed,[...h[33]||(h[33]=[e("i",{class:"fa-solid fa-folder-open text-4xl mb-3"},null,-1),e("p",{class:"text-sm text-muted-foreground"},"No enrichment data yet",-1),e("p",{class:"text-xs text-muted-foreground mt-1"},"Click the + button above to add notes, attachments, trade-ins, or purchase methods",-1)])]))])):x("",!0)])])])):x("",!0):(a(),l("div",vi,[e("div",gi,[e("main",yi,[e("div",xi,[p(wt,{modelValue:d(se),"onUpdate:modelValue":h[2]||(h[2]=O=>ls(se)?se.value=O:null),tabs:Gt.value,class:"mb-0"},null,8,["modelValue","tabs"])]),d(se)==="overview"?(a(),l("div",bi,[t.type!=="contact"?(a(),l("div",hi,[p(ln,{stage:t.task.displayStage||t.task.stage,owner:t.task.assignee,source:t.task.source||"","delivery-substatus":t.task.deliverySubstatus,activities:t.task.activities||[],"entity-type":t.type,"request-type":t.task.requestType||((W=t.task.requestedCar)==null?void 0:W.requestType)||"","request-message":((K=t.task.requestedCar)==null?void 0:K.requestMessage)||"","requested-car":t.task.requestedCar,task:t.task,onReassign:fe},null,8,["stage","owner","source","delivery-substatus","activities","entity-type","request-type","request-message","requested-car","task"])])):x("",!0),Ye(v.$slots,"pinned-extra",{task:t.task}),t.managementWidget?(a(),l("div",ki,[(a(),j(yt(t.managementWidget),{lead:t.type==="lead"?t.task:void 0,opportunity:t.type==="opportunity"?t.task:void 0,contact:t.type==="contact"?t.task:void 0,activities:Te.value,onCarAdded:h[3]||(h[3]=O=>v.$emit("car-added",O)),onConvertToLead:h[4]||(h[4]=O=>v.$emit("convert-to-lead")),onConvertToOpportunity:h[5]||(h[5]=O=>v.$emit("convert-to-opportunity")),onViewHistory:rt,onVehicleSelected:ut,onCreateOffer:mt},null,40,["lead","opportunity","contact","activities"]))])):x("",!0),d(Ne).length>0?(a(),l("div",wi,[(a(!0),l(P,null,H(d(Ne),O=>(a(),j(Qe,{key:O.id,item:O,"task-type":t.type,"customer-initials":"SK",onEdit:d(lt),onDelete:d(ot)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)])):(a(),l("div",$i,[t.type==="contact"&&d(se)==="negotiations"?(a(),l("div",Ci,[Ye(v.$slots,"tab-negotiations")])):t.type==="contact"&&d(se)==="appointments"?(a(),l("div",Ti,[e("div",Ai,[h[26]||(h[26]=e("div",{class:"flex-grow border-t border"},null,-1)),e("div",Ii,[le.value?x("",!0):(a(),l("button",{key:0,onClick:h[6]||(h[6]=ae(O=>le.value=!0,["stop"])),class:"bg-surface hover:bg-muted text-muted-foreground font-medium rounded-full text-sm shadow-sm transition-all flex items-center justify-center px-4 py-2 h-9 border border-border"},[...h[25]||(h[25]=[e("i",{class:"fa-solid fa-plus text-xs text-muted-foreground"},null,-1),e("span",{class:"ml-1.5 text-muted-foreground"},"add appointment",-1)])]))]),h[27]||(h[27]=e("div",{class:"flex-grow border-t border"},null,-1))]),le.value?(a(),l("div",Si,[h[30]||(h[30]=e("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-t border-l border-border rotate-45"},null,-1)),e("div",Di,[h[29]||(h[29]=e("h5",{class:"text-sm font-semibold text-foreground"},"Add Appointment",-1)),e("button",{type:"button",onClick:h[7]||(h[7]=O=>le.value=!1),class:"text-muted-foreground hover:text-muted-foreground"},[...h[28]||(h[28]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),(a(),j(Ss,{key:"inline-appointment",customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],"initial-date":jt.value,dealerships:ee.value,"show-actions":!0,"reset-trigger":le.value,onCreate:ye,onCancel:h[8]||(h[8]=O=>le.value=!1)},null,8,["customer","assignee","initial-date","dealerships","reset-trigger"]))])):x("",!0),Ye(v.$slots,"tab-appointments")])):(a(),l(P,{key:2},[p(Tt,{actions:t.addNewConfig.tabActions,"active-tab":d(se),onAction:Be},null,8,["actions","active-tab"]),e("div",null,[d(Re)==="communication"?(a(),j(Ho,{key:0,type:d(Nt),"task-type":t.type,"task-id":t.task.id,"phone-number":((_=t.task.customer)==null?void 0:_.phone)||"",item:d(Fe),onSave:d(Le),onCancel:d(Ue)},null,8,["type","task-type","task-id","phone-number","item","onSave","onCancel"])):x("",!0),d(se)==="data"&&d(Re)==="note"?(a(),j(Ge,{key:1,item:d(Fe),"task-type":t.type,"task-id":t.task.id,onSave:d(Le),onCancel:d(Ue)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0),d(Re)==="attachment"?(a(),j(Ke,{key:2,item:d(Fe),"task-type":t.type,"task-id":t.task.id,onSave:d(Le),onCancel:d(Ue)},null,8,["item","task-type","task-id","onSave","onCancel"])):x("",!0)]),d(Ne).length>0?(a(),l("div",qi,[(a(!0),l(P,null,H(d(Ne),O=>(a(),j(Qe,{key:O.id,item:O,"task-type":t.type,"customer-initials":"SK",onEdit:d(lt),onDelete:d(ot)},null,8,["item","task-type","onEdit","onDelete"]))),128))])):x("",!0)],64))]))])]),e("div",Vi,[p(ys,{activities:Te.value,"expanded-summaries":je.value,onActivityClick:zt,onToggleSummaryExpanded:Ht,onAddActivity:Yt},null,8,["activities","expanded-summaries"])])])),p(bs,{show:X.value==="financing"&&de.value,"task-type":t.type,"task-id":t.task.id,onSave:Rt,onClose:Ce},null,8,["show","task-type","task-id"]),p(hs,{show:X.value==="tradein"&&de.value,mode:"tradein",item:null,"task-type":t.type,"task-id":t.task.id,onSave:dt,onClose:Ce},null,8,["show","task-type","task-id"]),p(ks,{show:X.value==="purchase"&&de.value,item:null,"task-type":t.type,"task-id":t.task.id,"requested-car":t.type==="lead"?t.task.requestedCar:null,customer:t.task.customer,"recommended-cars":[],onSave:dt,onClose:Ce},null,8,["show","task-type","task-id","requested-car","customer"]),p(Is,{show:$.value,onClose:h[14]||(h[14]=O=>$.value=!1),onConfirm:me},null,8,["show"]),p(li,{show:B.value,task:t.task,"task-type":t.type,"task-id":t.task.id,onClose:h[15]||(h[15]=O=>B.value=!1),onSave:he},null,8,["show","task","task-type","task-id"]),p(Ge,{modal:"",show:ve.value,"task-type":t.type,"task-id":t.task.id,onSave:Ft,onClose:h[16]||(h[16]=O=>ve.value=!1)},null,8,["show","task-type","task-id"]),p(Ke,{modal:"",show:xe.value,"task-type":t.type,"task-id":t.task.id,onSave:Ut,onClose:h[17]||(h[17]=O=>xe.value=!1)},null,8,["show","task-type","task-id"]),p(ws,{show:oe.value,onSave:Bt,onClose:h[18]||(h[18]=O=>oe.value=!1)},null,8,["show"]),p($s,{show:re.value,onSave:Pt,onClose:h[19]||(h[19]=O=>re.value=!1)},null,8,["show"]),p(Cs,{show:Oe.value,onSave:Wt,onClose:h[20]||(h[20]=O=>Oe.value=!1)},null,8,["show"]),p(Lt,{show:Ee.value,title:"Call Feature",onClose:h[21]||(h[21]=O=>Ee.value=!1)},null,8,["show"]),pe.value?(a(),j(Ds,{key:3,show:pe.value,customer:t.task.customer,assignee:t.task.assignee,"disabled-fields":["customer"],dealerships:ee.value,onCreate:ye,onCancel:h[22]||(h[22]=O=>pe.value=!1)},null,8,["show","customer","assignee","dealerships"])):x("",!0),p(mi,{show:S.value,"existing-tags":t.task.tags||[],onClose:h[23]||(h[23]=O=>S.value=!1),onAdd:Kt},null,8,["show","existing-tags"])])}}},sd={class:"flex items-center justify-between mb-4 px-1"},ad={class:"flex items-center gap-2"},nd={key:0,class:"space-y-4 mb-6 px-1"},ld=["onClick"],od={class:"flex-1 min-w-0"},rd={class:"flex items-center gap-2 mb-1"},id={class:"text-xs font-bold text-foreground"},dd={class:"ml-auto relative"},ud=["onClick"],md={class:"text-sm text-muted-foreground"},cd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},fd={key:0,class:"flex items-center gap-1"},pd={key:1,class:"flex items-center gap-1"},vd={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},gd={class:"flex items-center gap-2 min-w-0"},yd={class:"text-xs text-muted-foreground font-medium truncate"},xd={key:1,class:"text-center py-8 text-muted-foreground mb-6"},bd={__name:"CustomerLeadsWidget",props:{leads:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]}},emits:["add-lead"],setup(t,{emit:b}){const r=t,k=ge(),A=I=>{if(!I)return 0;const u=new Date(I),s=Math.abs(new Date-u);return Math.ceil(s/(1e3*60*60*24))},w=I=>{const u=[];return r.allTasks&&r.allTasks.length>0&&r.allTasks.filter(s=>s.leadId===I.id).forEach(s=>{u.push({id:s.id,type:s.title||"Task",description:s.description||s.title})}),I.stage==="Open Lead"&&A(I.createdAt)>=0&&u.push({id:`lead-${I.id}-lq`,type:"LQ",description:"Call to Verify Contact Details"}),u},i=I=>I==="Open Lead"||I==="Validated"||I==="Contacted"?"blue":"gray",o=I=>{const u=k.resolve({path:`/tasks/${I.id}`,query:{type:"lead"}});window.open(u.href,"_blank")};return(I,u)=>(a(),l("div",null,[e("div",sd,[e("div",ad,[u[1]||(u[1]=e("i",{class:"fa-solid fa-user-circle text-foreground"},null,-1)),u[2]||(u[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Leads",-1)),p(d(ie),{text:String(t.leads.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:u[0]||(u[0]=n=>I.$emit("add-lead")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...u[3]||(u[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Lead",-1)])])]),t.leads.length>0?(a(),l("div",nd,[(a(!0),l(P,null,H(t.leads,n=>(a(),l("div",{key:n.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:s=>o(n)},[u[8]||(u[8]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-orange-100 text-orange-600 border-orange-200"},[e("i",{class:"fa-solid fa-user-circle text-sm"})],-1)),e("div",od,[e("div",rd,[e("span",id,"Lead #"+g(n.id),1),p(d(ie),{text:n.stage,size:"small",theme:i(n.stage)},null,8,["text","theme"]),e("div",dd,[e("button",{onClick:ae(s=>o(n),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...u[4]||(u[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,ud)])]),e("div",md,[e("div",cd,[n.assignee?(a(),l("span",fd,[u[5]||(u[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+g(n.assignee),1)])):x("",!0),n.requestedCar?(a(),l("span",pd,[u[6]||(u[6]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+g(n.requestedCar.brand)+" "+g(n.requestedCar.model),1)])):x("",!0)]),w(n).length>0?(a(),l("div",vd,[(a(!0),l(P,null,H(w(n),s=>(a(),l("div",{key:s.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",gd,[p(d(ie),{text:s.type,size:"small",theme:s.type==="LQ"?"blue":"gray"},null,8,["text","theme"]),e("span",yd,g(s.description),1)]),u[7]||(u[7]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):x("",!0)])])],8,ld))),128))])):(a(),l("div",xd,[...u[9]||(u[9]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No leads associated with this customer",-1)])]))]))}},hd={class:"flex items-center justify-between mb-4 px-1"},kd={class:"flex items-center gap-2"},wd={key:0,class:"space-y-4 mb-6 px-1"},$d=["onClick"],Cd={class:"flex-1 min-w-0"},Td={class:"flex items-center gap-2 mb-1"},Ad={class:"text-xs font-bold text-foreground"},Id={class:"ml-auto relative"},Sd=["onClick"],Dd={class:"text-sm text-muted-foreground"},qd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground mb-2"},Vd={key:0,class:"flex items-center gap-1"},Ld={key:1,class:"flex items-center gap-1"},Md={key:2,class:"flex items-center gap-1"},Od={key:0,class:"mt-2 space-y-1.5 border-t border-gray-100 pt-2"},Nd={class:"flex items-center gap-2 min-w-0"},Ed={class:"text-xs text-muted-foreground font-medium truncate"},jd={key:1,class:"text-center py-8 text-muted-foreground mb-6"},Rd={__name:"CustomerOpportunitiesWidget",props:{opportunities:{type:Array,default:()=>[]},allTasks:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},emits:["add-opportunity"],setup(t,{emit:b}){const r=t,k=ge(),A=u=>{const n=[];r.allTasks&&r.allTasks.length>0&&r.allTasks.filter(T=>T.opportunityId===u.id).forEach(T=>{n.push({id:T.id,type:T.title||"Task",description:T.description||T.title})});const s=r.activities.filter(C=>C.opportunityId===u.id),y={opportunity:u,scheduledAppointment:u.scheduledAppointment||null,activities:s,hasOffers:s.some(C=>C.type==="offer")||!1,stage:u.displayStage||u.stage,deliverySubstatus:u.deliverySubstatus||null},V=As(y.stage,y);if(V){const C={OOFB:"Open Opportunity Feedback",UFB:"Unsold Feedback",NFU:"No Follow-Up",OFB:"Offer Feedback",CFB:"Contract Feedback",DFB:"Delivery Feedback",NS:"No-Show Follow-up"};n.push({id:`opp-${u.id}-${V}`,type:V,description:C[V]||V})}return n},w=u=>({OOFB:"blue",UFB:"gray",NFU:"red",OFB:"blue",CFB:"green",DFB:"blue",NS:"red"})[u]||"gray",i=u=>u==="Qualified"||u==="In Negotiation"?"blue":u==="Closed Won"?"green":u==="Closed Lost"?"red":"gray",o=u=>new Intl.NumberFormat("en-US").format(u),I=u=>{const n=k.resolve({path:`/tasks/${u.id}`,query:{type:"opportunity"}});window.open(n.href,"_blank")};return(u,n)=>(a(),l("div",null,[e("div",hd,[e("div",kd,[n[1]||(n[1]=e("i",{class:"fa-solid fa-briefcase text-foreground"},null,-1)),n[2]||(n[2]=e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Opportunities",-1)),p(d(ie),{text:String(t.opportunities.length),size:"small",theme:"blue"},null,8,["text"])]),e("button",{onClick:n[0]||(n[0]=s=>u.$emit("add-opportunity")),class:"text-xs text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"},[...n[3]||(n[3]=[e("i",{class:"fa-solid fa-plus text-xs"},null,-1),e("span",null,"Add Opportunity",-1)])])]),t.opportunities.length>0?(a(),l("div",wd,[(a(!0),l(P,null,H(t.opportunities,s=>(a(),l("div",{key:s.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:y=>I(s)},[n[9]||(n[9]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-briefcase text-sm"})],-1)),e("div",Cd,[e("div",Td,[e("span",Ad,"Opp #"+g(s.id),1),p(d(ie),{text:s.displayStage||s.stage,size:"small",theme:i(s.displayStage||s.stage)},null,8,["text","theme"]),e("div",Id,[e("button",{onClick:ae(y=>I(s),["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"Open in new tab"},[...n[4]||(n[4]=[e("i",{class:"fa-solid fa-external-link text-sm"},null,-1)])],8,Sd)])]),e("div",Dd,[e("div",qd,[s.assignee?(a(),l("span",Vd,[n[5]||(n[5]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+g(s.assignee),1)])):x("",!0),s.value?(a(),l("span",Ld,[n[6]||(n[6]=e("i",{class:"fa-solid fa-tag text-xs"},null,-1)),M(" € "+g(o(s.value)),1)])):x("",!0),s.vehicle?(a(),l("span",Md,[n[7]||(n[7]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+g(s.vehicle.brand)+" "+g(s.vehicle.model),1)])):x("",!0)]),A(s).length>0?(a(),l("div",Od,[(a(!0),l(P,null,H(A(s),y=>(a(),l("div",{key:y.id,class:"flex items-center justify-between p-2 bg-muted/50 border border-border rounded-md"},[e("div",Nd,[p(d(ie),{text:y.type,size:"small",theme:w(y.type)},null,8,["text","theme"]),e("span",Ed,g(y.description),1)]),n[8]||(n[8]=e("i",{class:"fa-solid fa-chevron-right text-xs text-muted-foreground opacity-50"},null,-1))]))),128))])):x("",!0)])])],8,$d))),128))])):(a(),l("div",jd,[...n[10]||(n[10]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No opportunities associated with this customer",-1)])]))]))}},Fd={key:0,class:"space-y-4 mb-6 px-1"},Ud=["onClick"],Bd={class:"flex-1 min-w-0"},Pd={class:"flex items-center gap-2 mb-1"},Wd={class:"text-xs font-bold text-foreground"},zd={class:"text-xs text-muted-foreground"},Hd={class:"ml-auto relative"},Yd=["onClick"],Gd={class:"text-sm text-muted-foreground"},Kd={class:"flex items-center gap-2 mb-1 flex-wrap"},Qd={class:"text-sm font-medium text-foreground mb-1"},Jd={class:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground"},Xd={class:"flex items-center gap-1"},Zd={key:0,class:"flex items-center gap-1"},_d={key:1,class:"flex items-center gap-1"},eu={key:1,class:"text-center py-8 text-muted-foreground"},tu={__name:"CustomerAppointmentsWidget",props:{appointments:{type:Array,default:()=>[]}},setup(t){const b=ge(),r=N({}),k={appointment:"Dealership Visit","test-drive":"Test Drive",meeting:"Meeting",call:"Call",delivery:"Delivery",offsite:"Offsite Visit",workshop:"Workshop"},A=s=>k[s]||s||"Appointment",w=s=>({appointment:"bg-blue-50 text-blue-600 border-blue-100","test-drive":"bg-green-50 text-green-600 border-green-100",meeting:"bg-purple-50 text-purple-600 border-purple-100",call:"bg-amber-50 text-amber-600 border-amber-100",delivery:"bg-teal-50 text-teal-600 border-teal-100",offsite:"bg-slate-50 text-slate-600 border-slate-100",workshop:"bg-orange-50 text-orange-600 border-orange-100"})[s]||"bg-muted text-muted-foreground border-gray-100",i=s=>{const y=(s||"").toLowerCase();return y==="confirmed"?"bg-green-50 text-green-600":y==="cancelled"?"bg-red-50 text-red-600":y==="no-show"?"bg-amber-50 text-amber-600":"bg-muted text-muted-foreground"},o=s=>{if(!s)return"";const y=new Date(s);return y.toLocaleDateString("en-US",{month:"short",day:"numeric",year:y.getFullYear()!==new Date().getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})},I=s=>{if(!s)return"Just now";const y=new Date(s),C=new Date-y,T=Math.floor(C/6e4),c=Math.floor(T/60),f=Math.floor(c/24);return T<1?"Just now":T<60?`${T} minutes ago`:c<24?`${c} hours ago`:f===1?"Yesterday":f<7?`${f} days ago`:y.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},u=s=>{var y;return s.customerInitials?s.customerInitials:(y=s.customer)!=null&&y.initials?s.customer.initials:"SK"},n=s=>{s.opportunityId?b.push({path:`/tasks/${s.opportunityId}`,query:{type:"opportunity"}}):s.leadId?b.push({path:`/tasks/${s.leadId}`,query:{type:"lead"}}):b.push({path:"/calendar"})};return(s,y)=>(a(),l("div",null,[t.appointments.length>0?(a(),l("div",Fd,[(a(!0),l(P,null,H(t.appointments,V=>(a(),l("div",{key:V.id,class:"bg-white border border-border rounded-xl p-4 shadow-nsc-card flex gap-4 animate-fade-in feed-item cursor-pointer transition-shadow",onClick:C=>n(V)},[y[5]||(y[5]=e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 border bg-purple-100 text-purple-600 border-purple-200"},[e("i",{class:"fa-solid fa-calendar text-sm"})],-1)),e("div",Bd,[e("div",Pd,[e("span",Wd,g(u(V)),1),y[1]||(y[1]=e("span",{class:"text-xs text-muted-foreground"},"scheduled",-1)),e("span",zd,"• "+g(I(V.start)),1),e("div",Hd,[e("button",{onClick:ae(C=>r.value[V.id]=!r.value[V.id],["stop"]),class:"text-gray-400 hover:text-muted-foreground transition-colors p-1",title:"More actions"},[...y[0]||(y[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical text-sm"},null,-1)])],8,Yd)])]),e("div",Gd,[e("div",Kd,[e("span",{class:E(["text-xs px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter border",w(V.type)])},g(A(V.type)),3),V.status?(a(),l("span",{key:0,class:E(["text-xs px-1.5 py-0.5 rounded font-medium capitalize",i(V.status)])},g(V.status),3)):x("",!0)]),e("div",Qd,g(V.title||"Appointment"),1),e("div",Jd,[e("span",Xd,[y[2]||(y[2]=e("i",{class:"fa-solid fa-clock text-xs"},null,-1)),M(" "+g(o(V.start)),1)]),V.assignee?(a(),l("span",Zd,[y[3]||(y[3]=e("i",{class:"fa-solid fa-user text-xs"},null,-1)),M(" "+g(V.assignee),1)])):x("",!0),V.vehicle?(a(),l("span",_d,[y[4]||(y[4]=e("i",{class:"fa-solid fa-car text-xs"},null,-1)),M(" "+g(V.vehicle),1)])):x("",!0)])])])],8,Ud))),128))])):(a(),l("div",eu,[...y[6]||(y[6]=[e("i",{class:"fa-solid fa-calendar-xmark text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No appointments for this customer",-1)])]))]))}},su={key:0,class:"mb-8"},au={class:"relative"},nu={class:"flex overflow-x-auto space-x-4 pb-4 scrollbar-hide scroll-smooth snap-x snap-mandatory",style:{"scrollbar-width":"thin"}},lu=["onClick"],ou={class:"w-full h-36 bg-surfaceTertiary flex items-center justify-center overflow-hidden"},ru=["src"],iu={key:1,class:"fa-solid fa-car text-4xl text-muted-foreground"},du={class:"p-6"},uu={class:"font-bold text-foreground text-sm mb-1"},mu={key:0,class:"text-xs text-muted-foreground mb-2"},cu={key:1,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-green-50 border border-green-100 text-green-700 text-xs font-semibold rounded-md mb-2"},fu={__name:"VehiclesCarousel",props:{cars:{type:Array,default:()=>[]}},emits:["car-click"],setup(t,{emit:b}){const r=b,k=N(!1),A=I=>new Intl.NumberFormat("en-US").format(I),w=I=>({owned:"Owned",requested:"Requested",offered:"Offered",drove:"Drove",purchased:"Purchased"})[I]||"Car",i=I=>({owned:"bg-orange-600",requested:"bg-blue-600",offered:"bg-purple-600",drove:"bg-green-600",purchased:"bg-teal-600"})[I]||"bg-gray-600",o=I=>{r("car-click",I),k.value=!0};return(I,u)=>t.cars.length>0?(a(),l("div",su,[u[2]||(u[2]=e("div",{class:"flex items-center gap-2 mb-4"},[e("i",{class:"fa-solid fa-thumbtack text-muted-foreground text-xs"}),e("h3",{class:"font-bold text-foreground text-sm"},"Cars")],-1)),e("div",au,[e("div",nu,[(a(!0),l(P,null,H(t.cars,(n,s)=>(a(),l("div",{key:n.id,class:"flex-none w-64 snap-start bg-surface border border-border rounded-lg shadow-nsc-card overflow-hidden transition-shadow cursor-pointer relative",onClick:y=>o(n)},[e("div",{class:E(["absolute top-2 right-2 z-10 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",i(n.type)])},g(w(n.type)),3),e("div",ou,[n.image?(a(),l("img",{key:0,src:n.image,alt:"Car",class:"w-full h-full object-cover"},null,8,ru)):(a(),l("i",iu))]),e("div",du,[e("h4",uu,g(n.brand)+" "+g(n.model)+" ("+g(n.year)+")",1),n.price?(a(),l("p",mu,"€ "+g(A(n.price)),1)):x("",!0),n.stockDays!==null&&n.stockDays!==void 0?(a(),l("div",cu,[u[1]||(u[1]=e("div",{class:"w-1 h-1 bg-green-500 rounded-full"},null,-1)),M(" In stock ("+g(n.stockDays)+" days) ",1)])):x("",!0)])],8,lu))),128))])]),p(Lt,{show:k.value,title:"Car Details",onClose:u[0]||(u[0]=n=>k.value=!1)},null,8,["show"])])):x("",!0)}},pu=os(fu,[["__scopeId","data-v-8d3d6751"]]),vu={class:"flex-1 overflow-y-auto px-6 py-4 w-full"},gu={__name:"AddLeadOpportunityModal",props:{show:{type:Boolean,default:!1},type:{type:String,required:!0},contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:b}){const r=t,k=b,A=N(null),w=q(()=>r.type==="lead"?"Add New Lead":"Add New Opportunity");q(()=>`Create a ${r.type} for ${r.contact.name}`);const i=I=>{I||k("close")},o=I=>{k("save",I)};return(I,u)=>(a(),j(d(nt),{open:t.show,"onUpdate:open":i},{default:D(()=>[p(d(Ze),null,{default:D(()=>[p(d(_e),{class:"fixed inset-0 z-50 bg-black/50"}),p(d(et),{class:"w-full sm:max-w-lg max-h-[calc(100vh-4rem)] flex flex-col"},{default:D(()=>[p(d(tt),{class:"flex-shrink-0"},{default:D(()=>[p(d(st),null,{default:D(()=>[M(g(w.value),1)]),_:1})]),_:1}),e("div",vu,[p(ds,{ref_key:"formRef",ref:A,"initial-contact":t.contact,"hide-contact-selection":!0,"force-type":t.type,onSubmit:o},null,8,["initial-contact","force-type"])]),p(d(at),{class:"flex-shrink-0 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3"},{default:D(()=>{var n,s,y,V;return[p(d(Z),{label:"Cancel",variant:"outline",size:"small",class:"rounded-sm w-full sm:w-auto",onClick:u[0]||(u[0]=C=>I.$emit("close"))}),p(d(Z),{label:(n=A.value)!=null&&n.isSubmitting?"Saving...":"Save",variant:"primary",size:"small",class:"rounded-sm w-full sm:w-auto !bg-brand-red !hover:bg-brand-red-dark !text-white !border-brand-red",disabled:((s=A.value)==null?void 0:s.isSubmitting)||!((y=A.value)!=null&&y.canSubmit),onClick:(V=A.value)==null?void 0:V.submit},null,8,["label","disabled","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}},yu={class:"rounded-lg flex flex-col mb-6 bg-muted"},xu={class:"bg-white rounded-lg p-2 shadow-nsc-card flex flex-col"},bu={class:"divide-y divide-gray-100"},hu={class:"p-3"},ku={key:0,class:"text-sm text-muted-foreground leading-relaxed whitespace-pre-line"},wu={key:1,class:"flex items-center gap-3 py-1 text-muted-foreground"},$u={key:0,class:"p-3"},Cu={class:"flex flex-wrap gap-2"},Tu={__name:"CustomerSummaryWidget",props:{summary:{type:String,default:null},preferences:{type:Array,default:()=>[]},customerData:{type:Object,default:null}},setup(t){const b=t,r=q(()=>{if(b.preferences&&b.preferences.length>0)return b.preferences;const k=[],A=b.customerData;if(!A)return k;if(A.preferredVehicleType&&k.push({icon:"fa-solid fa-car",label:`Prefers ${A.preferredVehicleType}s`}),A.preferredChannel){const w={whatsapp:"fa-brands fa-whatsapp",phone:"fa-solid fa-phone",email:"fa-solid fa-envelope",sms:"fa-solid fa-message"};k.push({icon:w[A.preferredChannel.toLowerCase()]||"fa-solid fa-comment",label:`Prefers ${A.preferredChannel}`})}return A.preferredContactTime&&k.push({icon:"fa-solid fa-clock",label:A.preferredContactTime}),A.budgetRange&&k.push({icon:"fa-solid fa-dollar-sign",label:A.budgetRange}),k});return(k,A)=>(a(),l("div",yu,[A[1]||(A[1]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Customer Insights")])],-1)),e("div",xu,[e("div",bu,[e("div",hu,[t.summary?(a(),l("p",ku,g(t.summary),1)):(a(),l("div",wu,[...A[0]||(A[0]=[e("i",{class:"fa-solid fa-circle-info text-sm opacity-20"},null,-1),e("p",{class:"text-xs italic"},"No customer insights available yet. Insights will appear as we learn more about this customer's preferences and behavior.",-1)])]))]),r.value&&r.value.length>0?(a(),l("div",$u,[e("div",Cu,[(a(!0),l(P,null,H(r.value,(w,i)=>(a(),l("span",{key:i,class:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-muted text-foreground text-xs font-semibold uppercase tracking-wider rounded border border-border"},[e("i",{class:E([w.icon,"text-xs text-primary"])},null,2),M(" "+g(w.label),1)]))),128))])])):x("",!0)])])]))}},Au={key:0,class:"rounded-lg flex flex-col mb-6 bg-muted"},Iu={class:"bg-white rounded-lg p-2 shadow-nsc-card flex flex-col"},Su={class:"divide-y divide-gray-100"},Du={class:"p-3"},qu={class:"text-sm text-muted-foreground leading-relaxed break-words"},Vu={key:0,class:"text-muted-foreground"},Lu={class:"font-medium text-foreground"},Mu={class:"text-xs text-muted-foreground ml-1"},Ou={class:"p-3"},Nu={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},Eu={__name:"SuggestedNextAction",props:{leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]}},setup(t){const b=t,r=ge(),k=q(()=>{if(!b.leads||b.leads.length===0)return null;const u=b.leads.filter(s=>{if(s.isDisqualified)return!1;const y=xt(s,"lead");return y!=="Closed - Invalid"&&y!=="Closed - Not Interested"&&y!=="Closed - Duplicate"});if(u.length===0)return null;const n={Hot:3,Medium:2,Low:1};return u.sort((s,y)=>{const V=n[s.priority]||0,C=n[y.priority]||0;if(V!==C)return C-V;const T=new Date(s.updatedAt||s.createdAt||0);return new Date(y.updatedAt||y.createdAt||0)-T}),u[0]}),A=q(()=>{if(!b.opportunities||b.opportunities.length===0)return null;const u=b.opportunities.filter(s=>{const y=s.displayStage||s.stage;return y!=="Closed Won"&&y!=="Closed Lost"&&y!=="Abandoned"});if(u.length===0)return null;const n={Hot:3,Medium:2,Low:1};return u.sort((s,y)=>{const V=n[s.priority]||0,C=n[y.priority]||0;if(V!==C)return C-V;const T=new Date(s.updatedAt||s.createdAt||0);return new Date(y.updatedAt||y.createdAt||0)-T}),u[0]}),w=q(()=>{if(!k.value)return null;const u=k.value,n={lead:u,displayStage:xt(u,"lead")},s=Mt(n);return s?{...s,type:"lead",entityId:u.id,entity:u}:null}),i=q(()=>{if(!A.value)return null;const u=A.value,n=b.activities.filter(V=>V.opportunityId===u.id),s={opportunity:u,scheduledAppointment:u.scheduledAppointment||null,activities:n,hasOffers:n.some(V=>V.type==="offer")||!1,stage:u.displayStage||u.stage,deliverySubstatus:u.deliverySubstatus||null,formatDateTime:V=>{if(!V)return"";const C=new Date(V);return C.toLocaleDateString()+" "+C.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},y=Ot(s.stage,s);return y?{...y,type:"opportunity",entityId:u.id,entity:u}:null}),o=q(()=>{const u=[];w.value&&u.push({...w.value,id:`lead-${w.value.entityId}`}),i.value&&u.push({...i.value,id:`opp-${i.value.entityId}`});const n={Hot:3,Medium:2,Low:1};return u.sort((s,y)=>{const V=s.entity,C=y.entity,T=n[V==null?void 0:V.priority]||0,c=n[C==null?void 0:C.priority]||0;return T!==c?c-T:s.type==="lead"&&y.type==="opportunity"?-1:s.type==="opportunity"&&y.type==="lead"?1:0}),u}),I=u=>{u.type==="lead"?r.push({path:`/tasks/${u.entityId}`,query:{type:"lead"}}):u.type==="opportunity"&&r.push({path:`/tasks/${u.entityId}`,query:{type:"opportunity"}})};return(u,n)=>o.value.length>0?(a(),l("div",Au,[n[2]||(n[2]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-lightbulb text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Suggested Next Action")])],-1)),e("div",Iu,[e("div",Su,[e("div",Du,[e("p",qu,[(a(!0),l(P,null,H(o.value,(s,y)=>(a(),l(P,{key:s.id},[y>0?(a(),l("span",Vu," or ")):x("",!0),e("span",Lu,g(s.title),1),e("span",Mu," ("+g(s.type==="lead"?"Lead":"Opp")+" #"+g(s.entityId)+") ",1)],64))),128))])]),e("div",Ou,[e("div",Nu,[o.value.length>0?(a(),l("button",{key:0,onClick:n[0]||(n[0]=s=>I(o.value[0])),class:"flex items-center justify-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-btn font-medium text-sm transition-all w-full sm:w-auto sm:shrink-0"},[e("i",{class:E([o.value[0].icon,"text-sm"])},null,2),e("span",null,g(o.value[0].label),1)])):x("",!0),o.value.length>1?(a(),l("button",{key:1,onClick:n[1]||(n[1]=s=>I(o.value[1])),class:"flex items-center justify-center gap-2 px-4 py-2 bg-surface border border-border hover:bg-muted text-foreground rounded-btn font-medium text-sm transition-colors w-full sm:w-auto sm:shrink-0"},[e("i",{class:E([o.value[1].icon,"text-sm"])},null,2),e("span",null,g(o.value[1].label),1)])):x("",!0)])])])])])):x("",!0)}},ju={class:"rounded-lg flex flex-col mb-6 bg-muted"},Ru={class:"bg-white rounded-lg p-2 shadow-nsc-card flex flex-col"},Fu={class:"divide-y divide-gray-100"},Uu={key:0,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Bu={class:"flex items-center gap-3 min-w-0"},Pu={class:"min-w-0"},Wu={class:"text-sm text-muted-foreground truncate"},zu={class:"text-xs text-muted-foreground truncate"},Hu={key:1,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Yu={class:"flex items-center gap-3 min-w-0"},Gu={class:"w-8 h-8 rounded bg-slate-100 flex items-center justify-center shrink-0"},Ku={class:"min-w-0"},Qu={class:"text-sm text-muted-foreground truncate"},Ju={class:"text-xs text-muted-foreground truncate"},Xu={key:2,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},Zu={class:"flex items-center gap-3 min-w-0"},_u={class:"min-w-0"},em={class:"text-sm text-muted-foreground truncate"},tm={class:"text-xs text-muted-foreground truncate"},sm={key:3,class:"flex items-center justify-between gap-3 p-3 hover:bg-muted transition-colors rounded-md group"},am={class:"flex items-center gap-3 min-w-0"},nm={class:"min-w-0"},lm={class:"text-sm text-muted-foreground truncate"},om={class:"text-xs text-muted-foreground truncate"},rm={key:0,class:"text-center py-6 text-muted-foreground"},im={__name:"RecentActivitiesWidget",props:{nextAppointment:{type:Object,default:null},activities:{type:Array,default:()=>[]},leads:{type:Array,default:()=>[]},opportunities:{type:Array,default:()=>[]},customerId:{type:[Number,String],default:null}},setup(t){const b=t,r=ge(),k=q(()=>{const c=["email","sms","whatsapp","call"],f=b.activities.filter(m=>c.includes(m.type)).sort((m,L)=>new Date(L.timestamp)-new Date(m.timestamp));return f.length>0?f[0]:null}),A=q(()=>{const c=b.leads.filter(f=>{var m;return!f.isDisqualified&&f.status!=="Disqualified"&&!((m=f.stage)!=null&&m.includes("Closed"))});return c.length>0?c[0]:null}),w=q(()=>{if(!A.value)return null;try{return Mt({lead:A.value,displayStage:A.value.stage})}catch(c){return console.error("Error getting lead next action:",c),null}}),i=q(()=>{const c=b.opportunities.filter(f=>f.stage!=="Closed Won"&&f.stage!=="Closed Lost");return c.length>0?c[0]:null}),o=q(()=>{if(!i.value)return null;try{const c=b.activities.filter(m=>m.opportunityId===i.value.id)||[];return Ot(i.value.stage,{opportunity:i.value,scheduledAppointment:i.value.scheduledAppointment||null,activities:c,hasOffers:c.some(m=>m.type==="offer")||!1,stage:i.value.stage,deliverySubstatus:i.value.deliverySubstatus||null,formatDateTime:m=>m?new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})}catch(c){return console.error("Error getting opportunity next action:",c),null}}),I=c=>({email:"fa-solid fa-envelope",sms:"fa-solid fa-message",whatsapp:"fa-brands fa-whatsapp",call:"fa-solid fa-phone"})[c]||"fa-solid fa-comment",u=c=>c.type==="call"?c.content||`Call with ${c.user||"customer"}`:c.type==="email"?c.subject||c.content||"Email communication":c.type==="sms"||c.type==="whatsapp"?c.content||`${c.type.toUpperCase()} message`:c.content||"Communication",n=c=>{if(!c)return"";const f=new Date(c),m=new Date,L=Math.abs(m-f),U=Math.ceil(L/(1e3*60*60*24));return U===1?"Today":U===2?"Yesterday":U<=7?`${U-1} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:f.getFullYear()!==m.getFullYear()?"numeric":void 0})},s=c=>{if(!c)return"";const f=new Date(c),m=new Date;if(f.toDateString()===m.toDateString())return`Today at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`;const U=new Date(m);return U.setDate(U.getDate()+1),f.toDateString()===U.toDateString()?`Tomorrow at ${f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:f.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},y=()=>{var c,f;(c=b.nextAppointment)!=null&&c.opportunityId?r.push({path:`/tasks/${b.nextAppointment.opportunityId}`,query:{type:"opportunity"}}):(f=b.nextAppointment)!=null&&f.leadId?r.push({path:`/tasks/${b.nextAppointment.leadId}`,query:{type:"lead"}}):r.push({path:"/calendar"})},V=()=>{var c,f;(c=k.value)!=null&&c.opportunityId?r.push({path:`/tasks/${k.value.opportunityId}`,query:{type:"opportunity"}}):(f=k.value)!=null&&f.leadId&&r.push({path:`/tasks/${k.value.leadId}`,query:{type:"lead"}})},C=()=>{var c;(c=A.value)!=null&&c.id&&r.push({path:`/tasks/${A.value.id}`,query:{type:"lead"}})},T=()=>{var c;(c=i.value)!=null&&c.id&&r.push({path:`/tasks/${i.value.id}`,query:{type:"opportunity"}})};return(c,f)=>{var m,L,U,te,J,ue;return a(),l("div",ju,[f[12]||(f[12]=e("div",{class:"px-4 py-4 flex items-center justify-between shrink-0"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-clock-rotate-left text-foreground"}),e("h2",{class:"text-sm font-semibold text-foreground leading-5"},"Recent Activities")])],-1)),e("div",Ru,[e("div",Fu,[t.nextAppointment?(a(),l("div",Uu,[e("div",Bu,[f[1]||(f[1]=e("div",{class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-calendar-check text-primary text-sm"})],-1)),e("div",Pu,[f[0]||(f[0]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Next Appointment",-1)),e("div",Wu,g(s(t.nextAppointment.start)),1),e("div",zu,g(t.nextAppointment.title||"Appointment"),1)])]),e("button",{onClick:y,class:"w-8 h-8 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-primary/30 text-muted-foreground hover:text-primary transition-all shrink-0",title:"View Details"},[...f[2]||(f[2]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),k.value?(a(),l("div",Hu,[e("div",Yu,[e("div",Gu,[e("i",{class:E([I(k.value.type),"text-slate-600 text-sm"])},null,2)]),e("div",Ku,[f[3]||(f[3]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Last Communication",-1)),e("div",Qu,g(u(k.value)),1),e("div",Ju,g(n(k.value.timestamp)),1)])]),e("button",{onClick:V,class:"w-8 h-8 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-slate-300 text-muted-foreground hover:text-slate-600 transition-all shrink-0",title:"View Details"},[...f[4]||(f[4]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),A.value?(a(),l("div",Xu,[e("div",Zu,[f[6]||(f[6]=e("div",{class:"w-8 h-8 rounded bg-brand-dark/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-user-clock text-brand-dark text-sm"})],-1)),e("div",_u,[f[5]||(f[5]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Lead Request",-1)),e("div",em,g(((m=w.value)==null?void 0:m.label)||"No action defined"),1),e("div",tm,g((L=A.value.requestedCar)==null?void 0:L.brand)+" "+g((U=A.value.requestedCar)==null?void 0:U.model),1)])]),e("button",{onClick:C,class:"w-8 h-8 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-brand-dark/30 text-muted-foreground hover:text-brand-dark transition-all shrink-0",title:"View Details"},[...f[7]||(f[7]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0),i.value?(a(),l("div",sm,[e("div",am,[f[9]||(f[9]=e("div",{class:"w-8 h-8 rounded bg-primary/10 flex items-center justify-center shrink-0"},[e("i",{class:"fa-solid fa-handshake text-primary text-sm"})],-1)),e("div",nm,[f[8]||(f[8]=e("div",{class:"text-xs font-semibold text-foreground uppercase tracking-wider mb-0.5"},"Active Opportunity",-1)),e("div",lm,g(((te=o.value)==null?void 0:te.label)||"No action defined"),1),e("div",om,g((J=i.value.vehicle)==null?void 0:J.brand)+" "+g((ue=i.value.vehicle)==null?void 0:ue.model)+" - "+g(i.value.stage),1)])]),e("button",{onClick:T,class:"w-8 h-8 flex items-center justify-center bg-surface border border-border rounded hover:bg-white hover:border-primary/30 text-muted-foreground hover:text-primary transition-all shrink-0",title:"View Details"},[...f[10]||(f[10]=[e("i",{class:"fa-solid fa-arrow-right text-xs"},null,-1)])])])):x("",!0)]),!t.nextAppointment&&!k.value&&!A.value&&!i.value?(a(),l("div",rm,[...f[11]||(f[11]=[e("i",{class:"fa-solid fa-inbox text-2xl mb-2 opacity-30"},null,-1),e("p",{class:"text-xs"},"No recent activities available",-1)])])):x("",!0)])])}}},dm={class:"h-full flex flex-col overflow-hidden bg-surface"},um={key:0,class:"flex-1 flex items-center justify-center"},mm={class:"flex flex-col gap-6"},cm={class:"flex flex-col gap-6 mb-6"},wm={__name:"CustomerProfile",props:{customerId:{type:Number,required:!0},customerType:{type:String,default:"contact",validator:t=>["contact","account"].includes(t)},showCloseButton:{type:Boolean,default:!1},closeOnConvert:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:b}){const r=t,k=b,A=ge();It(),Dt();const w=qt(),i=N(!1),o=N(null),I=N(null),u=N([]),n=N([]),s=N([]),y=N([]),V=N([]),C=N([]),T=q(()=>"contact"),c=q(()=>I.value||w.currentCustomer),f=q(()=>{const $=c.value;return $?{...$,id:$.id,type:"contact",customer:{id:$.id,name:$.name,email:$.email,phone:$.phone,address:$.address||"",initials:$.initials},source:$.source||"Direct",tags:$.tags||[],stage:"Contact",assignee:null,assigneeId:null}:null}),m=q(()=>{const $=new Date,S=(C.value||[]).filter(B=>(B==null?void 0:B.start)&&new Date(B.start)>=$);return S.sort((B,ee)=>new Date(B.start)-new Date(ee.start)),S.length>0?S[0]:null}),L=q(()=>null),U=q(()=>({currentActivities:q(()=>V.value),addActivity:async()=>{},updateActivity:async()=>{},deleteActivity:async()=>{}})),te=q(()=>({overviewActions:[],tabActions:["note","email","sms","whatsapp","attachment"]})),J=async()=>{if(r.customerId)try{i.value=!0;const[$,S,B,ee,ve]=await Promise.all([w.fetchCustomerById(r.customerId,r.customerType),Os(r.customerId),Ns(r.customerId),Es(r.customerId),js(r.customerId)]);I.value=$||w.currentCustomer,u.value=S.data||[],n.value=B.data||[],s.value=ee.data||[],y.value=ve.data||[];const xe=[];for(const oe of u.value)try{const re=await rs(oe.id);xe.push(...re)}catch(re){console.error(`Failed to load activities for lead ${oe.id}:`,re)}for(const oe of n.value)try{const re=await is(oe.id);xe.push(...re)}catch(re){console.error(`Failed to load activities for opportunity ${oe.id}:`,re)}V.value=xe;try{C.value=await Ms(r.customerId)}catch(oe){console.error("Failed to load appointments:",oe),C.value=[]}}catch($){console.error("Error loading customer data:",$),o.value=$.message||"Failed to load customer"}finally{i.value=!1}},ue=async $=>{try{await w.addRequestedCar(r.customerId,$),await J()}catch(S){console.error("Error adding car to customer:",S),o.value=S.message||"Failed to add car"}},ye=async()=>{try{i.value=!0;const $=await w.convertToLead(r.customerId);r.closeOnConvert&&k("close"),A.push({path:`/tasks/${$.id}`,query:{type:"lead"}})}catch($){console.error("Error converting to lead:",$),o.value=$.message||"Failed to convert to lead",i.value=!1}},fe=async()=>{try{i.value=!0;const $=await w.convertToOpportunity(r.customerId);r.closeOnConvert&&k("close"),A.push({path:`/tasks/${$.id}`,query:{type:"opportunity"}})}catch($){console.error("Error converting to opportunity:",$),o.value=$.message||"Failed to convert to opportunity",i.value=!1}},me=N(!1),ne=N("lead"),he=q(()=>{if(!c.value)return{id:null,name:"Unknown",email:"",phone:"",initials:"?"};const $=c.value;return{id:$.id,name:$.name||"Unknown",email:$.email||"",phone:$.phone||"",initials:$.initials||"?"}}),de=$=>{ne.value=$,me.value=!0},X=async $=>{try{if(i.value=!0,me.value=!1,!r.customerId)throw new Error("Customer ID not found");ne.value==="lead"?await w.convertToLead(r.customerId):await w.convertToOpportunity(r.customerId),await J(),i.value=!1}catch(S){console.error(`Error adding ${ne.value}:`,S),o.value=S.message||`Failed to add ${ne.value}`,i.value=!1}},pe=async()=>{await J()},le=async()=>{await J()};return Me(async()=>{await J()}),ce(()=>r.customerId,$=>{$&&J()}),($,S)=>(a(),l("div",dm,[i.value||!c.value?(a(),l("div",um,[...S[4]||(S[4]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent"},null,-1)])])):(a(),j(td,{key:1,task:f.value,type:T.value,"management-widget":L.value,"store-adapter":U.value,"add-new-config":te.value,"show-close-button":t.showCloseButton,onClose:S[2]||(S[2]=B=>$.$emit("close")),onCarAdded:ue,onConvertToLead:ye,onConvertToOpportunity:fe,onTagUpdated:pe,onAppointmentCreated:le},{"pinned-extra":D(({task:B})=>{var ee,ve;return[e("div",mm,[p(Tu,{summary:B.summary||((ee=I.value)==null?void 0:ee.summary),preferences:B.preferences||((ve=I.value)==null?void 0:ve.preferences),"customer-data":I.value},null,8,["summary","preferences","customer-data"]),p(Eu,{leads:u.value,opportunities:n.value,activities:V.value},null,8,["leads","opportunities","activities"]),p(im,{"next-appointment":m.value,activities:V.value,leads:u.value,opportunities:n.value,"customer-id":t.customerId},null,8,["next-appointment","activities","leads","opportunities","customer-id"]),y.value.length>0?(a(),j(pu,{key:0,cars:y.value},null,8,["cars"])):x("",!0)])]}),"tab-negotiations":D(()=>[e("div",cm,[p(bd,{leads:u.value,"all-tasks":s.value,onAddLead:S[0]||(S[0]=B=>de("lead"))},null,8,["leads","all-tasks"]),p(Rd,{opportunities:n.value,"all-tasks":s.value,activities:V.value,onAddOpportunity:S[1]||(S[1]=B=>de("opportunity"))},null,8,["opportunities","all-tasks","activities"])])]),"tab-appointments":D(()=>[p(tu,{appointments:C.value},null,8,["appointments"])]),_:1},8,["task","type","management-widget","store-adapter","add-new-config","show-close-button"])),c.value?(a(),j(gu,{key:2,show:me.value,type:ne.value,contact:he.value,onClose:S[3]||(S[3]=B=>me.value=!1),onSave:X},null,8,["show","type","contact"])):x("",!0)]))}};export{wm as _};
